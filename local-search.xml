<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>kotlinå§”æ‰˜</title>
    <link href="/2024/05/27/kotlin%E5%A7%94%E6%89%98/"/>
    <url>/2024/05/27/kotlin%E5%A7%94%E6%89%98/</url>
    
    <content type="html"><![CDATA[<p>ç»å¸¸åœ¨ Kotlin çš„æºç ä¸‰æ–¹åº“ä¸­çœ‹åˆ°<code>by</code>å…³é”®å­—ï¼Œè¿™ç§å†™æ³•å°±æ˜¯å§”æ‰˜ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªåº”ç”¨åœºæ™¯ï¼Œä¸€ä¸ªæ˜¯å§”æ‰˜ç±»ï¼Œå¦ä¸€ä¸ªæ˜¯å§”æ‰˜å±æ€§ï¼Œæ¯ä¸ªåœºæ™¯ä¸­åˆæœ‰ä¸åŒçš„ç”¨æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¯” Java çš„å§”æ‰˜æ¥å­¦ä¹  Kotlin çš„å§”æ‰˜ã€‚</p><span id="more"></span><h3 id="å§”æ‰˜-ç±»å§”æ‰˜ã€æ¥å£å§”æ‰˜"><a href="#å§”æ‰˜-ç±»å§”æ‰˜ã€æ¥å£å§”æ‰˜" class="headerlink" title="å§”æ‰˜(ç±»å§”æ‰˜ã€æ¥å£å§”æ‰˜)"></a>å§”æ‰˜(ç±»å§”æ‰˜ã€æ¥å£å§”æ‰˜)</h3><p>å…¶å®æˆ‘ä»¬åœ¨ Java å’Œ Android ä¸­ç»å¸¸ä¼šç”¨åˆ°å§”æ‰˜ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Delegated</span> &#123;<br><br>    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Base</span>&#123;<br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">()</span>;<br>    &#125;<br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Base</span>&#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> x;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">BaseImpl</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>            <span class="hljs-built_in">this</span>.x = x;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">()</span> &#123;<br>            System.out.println(x);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Base</span>&#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Base base;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">Derived</span><span class="hljs-params">(Base base)</span> &#123;<br>            <span class="hljs-built_in">this</span>.base = base;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">()</span> &#123;<br>            base.print();<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æœ‰ä¸€ä¸ªæ¥å£<code>Base</code>ï¼Œä¸€ä¸ªå®ç°ç±»<code>BaseImpl</code>ã€‚å‡å¦‚æˆ‘ä»¬æƒ³è¦åœ¨å®ç°ç±»ä¸­æ·»åŠ ä¸€äº›æ–¹æ³•ï¼Œä½†åˆä¸æƒ³é‡æ–°å†™ä¸€éæ¥å£å®ç°ï¼Œç¬¬ä¸€ç§æˆ‘ä»¬å¯ä»¥ç»§æ‰¿<code>BaseImpl</code>,å¦å¤–ä¸€ç§å°±æ˜¯å®ç°æ¥å£<code>Base</code>ï¼Œä¼ å…¥ä¸€ä¸ªå®ç°ç±»çš„å®ä¾‹ï¼Œå°†æ‰€æœ‰çš„æ¥å£è¯·æ±‚éƒ½äº¤ç»™å®ç°ç±»çš„å®ä¾‹æ¥å®Œæˆã€‚<br>è™½ç„¶å®˜æ–¹è¯´<strong>å§”æ‰˜æ¨¡å¼å·²ç»è¯æ˜æ˜¯å®ç°ç»§æ‰¿çš„ä¸€ä¸ªå¾ˆå¥½çš„æ›¿ä»£æ–¹å¼(The Delegation pattern has proven to be a good alternative to implementation inheritance)</strong>,ä½†é€‰æ‹©æƒè¿˜æ˜¯åœ¨å¤§å®¶æ‰‹ä¸Šï¼Œçœ‹æƒ…å†µè€Œå®šï¼Œæ²¡æœ‰é“¶å¼¹ã€‚<br>é‚£ä¹ˆåœ¨ kotlin ä¸­åº”è¯¥æ€ä¹ˆå†™å‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬ç”¨ java çš„æ€æƒ³æ¥å†™ï¼Œæ— éå°±æ˜¯æ¢æ¢å…³é”®å­—ï¼Œç„¶åä¸€å¨æ¨¡æ¿ä»£ç ï¼Œå…¶å®åœ¨ kotlin ä¸­æ˜¯å¯ä»¥é€šè¿‡<code>by</code>å…³é”®å­—é›¶æ¨¡æ¿ä»£ç æ”¯æŒçš„</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Base</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">print</span><span class="hljs-params">()</span></span><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseImpl</span></span>(<span class="hljs-keyword">val</span> x: <span class="hljs-built_in">Int</span>) : Base &#123;<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">print</span><span class="hljs-params">()</span></span> &#123;<br>        println(x)<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Derived</span></span>(b: Base) : Base <span class="hljs-keyword">by</span> b<br></code></pre></td></tr></table></figure><p><code>Derived</code>çš„è¶…ç±»å‹åˆ—è¡¨ä¸­çš„<code>by</code>å­å¥è¡¨ç¤º<code>b</code>å°†ä¼šåœ¨<code>Derived</code>ä¸­å†…éƒ¨å­˜å‚¨ï¼Œ å¹¶ä¸”ç¼–è¯‘å™¨å°†ç”Ÿæˆè½¬å‘ç»™<code>b</code>çš„æ‰€æœ‰<code>Base</code>çš„æ–¹æ³•ã€‚<br>è¿™ä¸ªå°±æ˜¯ kotlin ä¸­çš„å§”æ‰˜ï¼Œæœ‰çš„åœ°æ–¹ä¹Ÿå«å§”æ‰˜ç±»æˆ–è€…å§”æ‰˜æ¥å£ã€‚<br>è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ä¸‹ï¼Œè¦†ç›–(override)æ˜¯ç¬¦åˆé¢„æœŸçš„ï¼šç¼–è¯‘å™¨ä¼šä½¿ç”¨ override è¦†ç›–çš„å®ç°è€Œä¸æ˜¯å§”æ‰˜å¯¹è±¡ä¸­çš„.</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Base</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printMessage</span><span class="hljs-params">()</span></span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printMessageLine</span><span class="hljs-params">()</span></span><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseImpl</span></span>(<span class="hljs-keyword">val</span> x: <span class="hljs-built_in">Int</span>) : Base &#123;<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printMessage</span><span class="hljs-params">()</span></span> &#123; println(x) &#125;<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printMessageLine</span><span class="hljs-params">()</span></span> &#123; println(x) &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Derived2</span></span>(b: Base) : Base <span class="hljs-keyword">by</span> b &#123;<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printMessage</span><span class="hljs-params">()</span></span> &#123; println(<span class="hljs-string">&quot;abc&quot;</span>) &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> b = BaseImpl(<span class="hljs-number">10</span>)<br>    Derived2(b).printMessage()<br>    Derived2(b).printMessageLine()<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨<code>Derived2</code>ä¸­è¦†å†™äº†<code>printMessage</code>è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œå°±æ˜¯ç”¨çš„æˆ‘ä»¬è¦†å†™çš„æ–¹æ³•ã€‚</p><h3 id="å±æ€§å§”æ‰˜"><a href="#å±æ€§å§”æ‰˜" class="headerlink" title="å±æ€§å§”æ‰˜"></a>å±æ€§å§”æ‰˜</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Example</span> </span>&#123;<br>    <span class="hljs-keyword">var</span> p: String <span class="hljs-keyword">by</span> Delegate()<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯­æ³•æ˜¯ï¼š<code>val/var &lt;å±æ€§å&gt;: &lt;ç±»å‹&gt; by &lt;è¡¨è¾¾å¼&gt;</code>ã€‚åœ¨<code>by</code>åé¢çš„è¡¨è¾¾å¼æ˜¯è¯¥<code>å§”æ‰˜</code>ï¼Œ å› ä¸ºå±æ€§å¯¹åº”çš„<code>get()</code>ï¼ˆä¸<code>set()</code>ï¼‰ä¼šè¢«å§”æ‰˜ç»™å®ƒçš„<code>getValue()</code>ä¸<code>setValue()</code>æ–¹æ³•ã€‚ å±æ€§çš„å§”æ‰˜ä¸å¿…å®ç°æ¥å£ï¼Œä½†æ˜¯éœ€è¦æä¾›ä¸€ä¸ª<code>getValue()</code>å‡½æ•°ï¼ˆå¯¹äº<code>var</code>å±æ€§è¿˜æœ‰<code>setValue()</code>ï¼‰ã€‚<br>å…ˆä»æœ€ç®€å•çš„å§”æ‰˜å¼€å§‹ï¼Œæœ€åå†çœ‹è‡ªå®šä¹‰å§”æ‰˜ã€‚</p><h4 id="æ ‡å‡†å§”æ‰˜"><a href="#æ ‡å‡†å§”æ‰˜" class="headerlink" title="æ ‡å‡†å§”æ‰˜"></a>æ ‡å‡†å§”æ‰˜</h4><p>å€Ÿç”¨å®˜ç½‘çš„ä¸€ä¸ªä¾‹å­</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span> </span>&#123;<br>   <span class="hljs-keyword">var</span> newName: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span><br>   <span class="hljs-meta">@Deprecated(<span class="hljs-string">&quot;Use &#x27;newName&#x27; instead&quot;</span>, ReplaceWith(<span class="hljs-string">&quot;newName&quot;</span>)</span>)<br>   <span class="hljs-keyword">var</span> oldName: <span class="hljs-built_in">Int</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">this</span>::newName<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>   <span class="hljs-keyword">val</span> myClass = MyClass()<br>   <span class="hljs-comment">// é€šçŸ¥ï¼š&#x27;oldName: Int&#x27; is deprecated.</span><br>   <span class="hljs-comment">// Use &#x27;newName&#x27; instead</span><br>   myClass.oldName = <span class="hljs-number">42</span><br>   println(myClass.newName) <span class="hljs-comment">// 42</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ç§æœ€ç®€å•çš„å§”æ‰˜æ–¹å¼ã€‚é€šè¿‡æŸ¥çœ‹å¯¹åº”çš„ java ä»£ç ï¼Œå‘ç°å…¶å®å°±æ˜¯å¯¹åŒä¸€ä¸ªæˆå‘˜å˜é‡çš„è¯»å†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> &#123;<br>   <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> newName;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getNewName</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.newName;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNewName</span><span class="hljs-params">(<span class="hljs-type">int</span> var1)</span> &#123;<br>      <span class="hljs-built_in">this</span>.newName = var1;<br>   &#125;<br><br>   <span class="hljs-comment">/** <span class="hljs-doctag">@deprecated</span> */</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOldName</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.newName;<br>   &#125;<br><br>   <span class="hljs-comment">/** <span class="hljs-doctag">@deprecated</span> */</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOldName</span><span class="hljs-params">(<span class="hljs-type">int</span> var1)</span> &#123;<br>      <span class="hljs-built_in">this</span>.newName = var1;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>MyClass</code>ä¸­çš„å››ä¸ªæ–¹æ³•éƒ½æ˜¯å¯¹<code>newName</code>è¿™ä¸ªå­—æ®µçš„è¯»å†™ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œå§”æ‰˜å±æ€§å¯ä»¥æ˜¯ï¼š</p><ul><li>é¡¶å±‚å±æ€§</li><li>åŒä¸€ä¸ªç±»çš„æˆå‘˜æˆ–æ‰©å±•å±æ€§</li><li>å¦ä¸€ä¸ªç±»çš„æˆå‘˜æˆ–æ‰©å±•å±æ€§</li></ul><p>æ¯”å¦‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">var</span> topLevelInt: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ClassWithDelegate</span></span>(<span class="hljs-keyword">val</span> anotherClassInt: <span class="hljs-built_in">Int</span>)<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span></span>(<span class="hljs-keyword">var</span> memberInt: <span class="hljs-built_in">Int</span>, <span class="hljs-keyword">val</span> anotherClassInstance: ClassWithDelegate) &#123;<br>    <span class="hljs-keyword">var</span> delegatedToMember: <span class="hljs-built_in">Int</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">this</span>::memberInt<span class="hljs-comment">//åŒä¸€ä¸ªç±»çš„æˆå‘˜</span><br>    <span class="hljs-keyword">var</span> delegatedToTopLevel: <span class="hljs-built_in">Int</span> <span class="hljs-keyword">by</span> ::topLevelInt<span class="hljs-comment">//é¡¶å±‚å±æ€§</span><br><br>    <span class="hljs-keyword">val</span> delegatedToAnotherClass: <span class="hljs-built_in">Int</span> <span class="hljs-keyword">by</span> anotherClassInstance::anotherClassInt<span class="hljs-comment">//å¦ä¸€ä¸ªç±»çš„æˆå‘˜</span><br>&#125;<br><span class="hljs-keyword">var</span> MyClass.extDelegated: <span class="hljs-built_in">Int</span> <span class="hljs-keyword">by</span> ::topLevelInt<span class="hljs-comment">//é¡¶å±‚å±æ€§</span><br></code></pre></td></tr></table></figure><p>è¿™ç§å§”æ‰˜æ–¹å¼åœ¨æˆ‘ä»¬åšç‰ˆæœ¬å‡çº§ä¿®æ”¹å­—æ®µæ—¶æ˜¯æŒºå¸¸ç”¨çš„,å°†æ—§å­—æ®µå§”æ‰˜ç»™æ–°å­—æ®µï¼Œå¹¶å°†æ—§å­—æ®µæ ‡è®°ä¸ºè¿‡æ—¶ã€‚</p><h4 id="æ‡’åŠ è½½å§”æ‰˜"><a href="#æ‡’åŠ è½½å§”æ‰˜" class="headerlink" title="æ‡’åŠ è½½å§”æ‰˜"></a>æ‡’åŠ è½½å§”æ‰˜</h4><p>è¿™ç§æ–¹å¼å°±æ˜¯å½“æˆ‘ä»¬é¦–æ¬¡è®¿é—®è¿™ä¸ªå±æ€§çš„æ—¶å€™æ‰ä¼šå»åˆå§‹åŒ–è¿™ä¸ªå±æ€§ï¼Œä»è€Œé¿å…ä¸å¿…è¦çš„èµ„æºæ¶ˆè€—ï¼Œå’Œæˆ‘ä»¬ç”¨ java å†™å•ä¾‹æ¨¡å¼çš„æ‡’åŠ è½½æ˜¯ä¸€æ ·çš„ã€‚<br>åªä¼šåœ¨é¦–æ¬¡è®¿é—®çš„æ—¶å€™åˆå§‹åŒ–è¿™ä¸ªå±æ€§ï¼Œç„¶åç¼“å­˜èµ·æ¥ï¼Œä¸‹æ¬¡è®¿é—®æ—¶ç›´æ¥è¿”å›ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> lazyValue: String <span class="hljs-keyword">by</span> lazy &#123;<br>    println(<span class="hljs-string">&quot;computed!&quot;</span>)<br>    <span class="hljs-string">&quot;Hello&quot;</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    println(lazyValue)<br>    println(lazyValue)<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„ lazy æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">actual</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">lazy</span><span class="hljs-params">(initializer: () -&gt; <span class="hljs-type">T</span>)</span></span>: Lazy&lt;T&gt; = SynchronizedLazyImpl(initializer)<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">actual</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">lazy</span><span class="hljs-params">(mode: <span class="hljs-type">LazyThreadSafetyMode</span>, initializer: () -&gt; <span class="hljs-type">T</span>)</span></span>: Lazy&lt;T&gt; =<br>    <span class="hljs-keyword">when</span> (mode) &#123;<br>        LazyThreadSafetyMode.SYNCHRONIZED -&gt; SynchronizedLazyImpl(initializer)<br>        LazyThreadSafetyMode.PUBLICATION -&gt; SafePublicationLazyImpl(initializer)<br>        LazyThreadSafetyMode.NONE -&gt; UnsafeLazyImpl(initializer)<br>    &#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œlazyæ¥æ”¶ä¸€ä¸ª mode å‚æ•°ï¼Œå¦‚æœæ²¡æœ‰ä¼ å…¥çš„è¯ï¼Œé»˜è®¤æ˜¯<code>SynchronizedLazyImpl</code>çº¿ç¨‹å®‰å…¨çš„ï¼šè¯¥å€¼åªåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è®¡ç®—ï¼Œä½†æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šçœ‹åˆ°ç›¸åŒçš„å€¼ã€‚å¦‚æœåˆå§‹åŒ–å§”æ‰˜çš„åŒæ­¥é”ä¸æ˜¯å¿…éœ€çš„ï¼Œè¿™æ ·å¯ä»¥è®©å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œé‚£ä¹ˆå°†<code>LazyThreadSafetyMode.PUBLICATION</code>ä½œä¸ºå‚æ•°ä¼ ç»™ lazy()ã€‚<br>å¦‚æœæˆ‘ä»¬ç¡®å®šåˆå§‹åŒ–å°†æ€»æ˜¯å‘ç”Ÿåœ¨ä¸å±æ€§ä½¿ç”¨ä½äºç›¸åŒçš„çº¿ç¨‹ï¼Œ é‚£ä¹ˆå¯ä»¥ä½¿ç”¨<code>LazyThreadSafetyMode.NONE</code>æ¨¡å¼ã€‚å®ƒä¸ä¼šæœ‰ä»»ä½•çº¿ç¨‹å®‰å…¨çš„ä¿è¯ä»¥åŠç›¸å…³çš„å¼€é”€ã€‚<br>æ‰€ä»¥è¿™ä¸ªå‚æ•°çš„é€‰æ‹©ä¹Ÿè¦çœ‹å…·ä½“åº”ç”¨åœºæ™¯ã€‚</p><h4 id="å¯è§‚å¯Ÿå§”æ‰˜"><a href="#å¯è§‚å¯Ÿå§”æ‰˜" class="headerlink" title="å¯è§‚å¯Ÿå§”æ‰˜"></a>å¯è§‚å¯Ÿå§”æ‰˜</h4><p>å¦‚æœæˆ‘ä»¬æƒ³è¦è§‚å¯Ÿå±æ€§å€¼çš„å˜åŒ–ï¼Œå¯ä»¥ä½¿ç”¨<code>Delegates.observable()</code>ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼šåˆå§‹å€¼ä¸ä¿®æ”¹æ—¶å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span>  <span class="hljs-title">ObservableItem</span></span>&#123;<br>    <span class="hljs-keyword">var</span> name :String <span class="hljs-keyword">by</span> Delegates.observable(<span class="hljs-string">&quot;initialValue&quot;</span>)&#123;<br>        prop,old,new-&gt;<br>        println(<span class="hljs-string">&quot;<span class="hljs-variable">$prop</span>  <span class="hljs-variable">$old</span> -&gt; <span class="hljs-variable">$new</span>&quot;</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬ç»™<code>name</code>èµ‹å€¼çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘ä¼ å…¥çš„å¤„ç†ç¨‹åºï¼Œä½†è¿™é‡Œæˆ‘ä»¬åªèƒ½è§‚å¯Ÿåˆ°èµ‹å€¼ï¼Œä½†å¹¶ä¸èƒ½åšæ‹¦æˆªï¼Œå¦‚æœæƒ³è¦æˆªè·å–å€¼å¹¶<strong>å¦å†³</strong>,å¯ä»¥ä½¿ç”¨<code>vetoable()</code></p><h4 id="å¯å¦å†³å§”æ‰˜"><a href="#å¯å¦å†³å§”æ‰˜" class="headerlink" title="å¯å¦å†³å§”æ‰˜"></a>å¯å¦å†³å§”æ‰˜</h4><p>å¦‚æœæˆ‘ä»¬æƒ³åœ¨è§‚å¯Ÿå±æ€§å€¼å˜åŒ–çš„åŒæ—¶å†³å®šæ˜¯å¦ä½¿ç”¨æ–°çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨<code>Delegates.vetoable</code>,åŒæ ·çš„ï¼Œå®ƒä¹Ÿæ¥å—ä¸¤ä¸ªå‚æ•°ï¼šå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼šåˆå§‹å€¼ä¸ä¿®æ”¹æ—¶å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰ã€‚åªä¸è¿‡è¿™é‡Œçš„ handler éœ€è¦è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå‘Šè¯‰ç¨‹åºæ˜¯å¦ä½¿ç”¨æ–°å€¼ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VetoableItem</span></span>&#123;<br>    <span class="hljs-keyword">var</span> name :String <span class="hljs-keyword">by</span> Delegates.vetoable(<span class="hljs-string">&quot;initialValue&quot;</span>)&#123;<br>        prop,old,new-&gt;<br>        println(<span class="hljs-string">&quot;<span class="hljs-variable">$prop</span>  <span class="hljs-variable">$old</span> -&gt; <span class="hljs-variable">$new</span>&quot;</span>)<br>        new.length &gt; <span class="hljs-number">3</span><br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">val</span> vetoableItem = VetoableItem()<br>    println(vetoableItem.name)<br>    vetoableItem.name = <span class="hljs-string">&quot;123&quot;</span><br>    println(vetoableItem.name)<br>    vetoableItem.name = <span class="hljs-string">&quot;1234&quot;</span><br>    println(vetoableItem.name)<br>&#125;<br><span class="hljs-comment">//è¾“å‡º</span><br><span class="hljs-comment">// initialValue</span><br><span class="hljs-comment">// var com.huangyuanlove.VetoableItem.name: kotlin.String  initialValue -&gt; 123</span><br><span class="hljs-comment">// initialValue</span><br><span class="hljs-comment">// var com.huangyuanlove.VetoableItem.name: kotlin.String  initialValue -&gt; 1234</span><br><span class="hljs-comment">// 1234</span><br></code></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œåªæœ‰å½“<code>new</code>çš„é•¿åº¦å¤§äº 3 æ—¶ï¼Œæˆ‘ä»¬æ‰ä¼šå°†<code>new</code>èµ‹å€¼ç»™<code>name</code>ï¼Œ</p><h4 id="å°†å±æ€§å‚¨å­˜åœ¨æ˜ å°„ä¸­"><a href="#å°†å±æ€§å‚¨å­˜åœ¨æ˜ å°„ä¸­" class="headerlink" title="å°†å±æ€§å‚¨å­˜åœ¨æ˜ å°„ä¸­"></a>å°†å±æ€§å‚¨å­˜åœ¨æ˜ å°„ä¸­</h4><p>ä¸€ä¸ªå¸¸è§çš„ç”¨ä¾‹æ˜¯åœ¨ä¸€ä¸ªæ˜ å°„ï¼ˆmapï¼‰é‡Œå­˜å‚¨å±æ€§çš„å€¼ã€‚ è¿™ç»å¸¸å‡ºç°åœ¨åƒè§£æ JSON æˆ–è€…æ‰§è¡Œå…¶ä»–â€œåŠ¨æ€â€ä»»åŠ¡çš„åº”ç”¨ä¸­ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨æ˜ å°„å®ä¾‹è‡ªèº«ä½œä¸ºå§”æ‰˜æ¥å®ç°å§”æ‰˜å±æ€§ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MapItem</span></span>(map: Map&lt;String,Any?&gt;)&#123;<br>    <span class="hljs-keyword">val</span> name: String <span class="hljs-keyword">by</span> map<br>    <span class="hljs-keyword">val</span> age:<span class="hljs-built_in">Int</span> <span class="hljs-keyword">by</span> map<br>    <span class="hljs-keyword">val</span> address:String <span class="hljs-keyword">by</span> map<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>  <span class="hljs-keyword">val</span> map:Map&lt;String,Any?&gt; = mapOf(<br>    <span class="hljs-string">&quot;name&quot;</span> to <span class="hljs-string">&quot;xuan&quot;</span>,<br>    <span class="hljs-string">&quot;age&quot;</span> to <span class="hljs-number">18</span>,<br>  )<br>  <span class="hljs-keyword">val</span> mapItem = MapItem(map)<br>  println(<span class="hljs-string">&quot;<span class="hljs-subst">$&#123;mapItem.name&#125;</span>  <span class="hljs-subst">$&#123;mapItem.age&#125;</span>&quot;</span>)<br>  println(<span class="hljs-string">&quot;<span class="hljs-subst">$&#123;mapItem.name&#125;</span>  <span class="hljs-subst">$&#123;mapItem.age&#125;</span>  <span class="hljs-subst">$&#123;mapItem.address&#125;</span>&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå‡å¦‚æˆ‘ä»¬ä¼ å…¥çš„<code>map</code>é‡Œé¢æ²¡æœ‰å¯¹åº”å±æ€§ï¼Œå½“ç¨‹åºè¿è¡Œæ—¶ï¼Œè¿™ä¸ªå±æ€§æ²¡æœ‰è¢«ä½¿ç”¨æ˜¯æ²¡é—®é¢˜çš„ï¼Œæ¯”å¦‚ä¸Šé¢æ‰“å°<code>name</code>å’Œ<code>age</code>ã€‚ä½†æ˜¯å½“æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªå±æ€§çš„æ—¶å€™ï¼Œå°±æ˜¯ä¸Šé¢æ‰“å°<code>address</code>,ä¼šæŠ›å‡ºå¼‚å¸¸<code>Key address is missing in the map.</code>.å¦å¤–ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å°†ä¼ å…¥çš„ map çš„å€¼å£°æ˜ä¸ºäº†å¯ç©ºï¼Œè¿™å°±æ„å‘³ç€åœ¨è°ƒç”¨å‡ºä¼ å…¥äº†ç©ºå€¼ï¼Œæ¯”å¦‚<code>&quot;address&quot; to null,</code>,ä»£ç æ˜¯å¯ä»¥è¿è¡Œçš„ï¼Œä½†å¯¹<code>address</code>è¿™ä¸ªå±æ€§åšå¤„ç†çš„æ—¶å€™ä¼šæŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œè¿™äº›éƒ½æ˜¯éœ€è¦é¢å¤–æ³¨æ„çš„åœ°æ–¹ã€‚<br>è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œå¦‚æœæ˜¯å¯¹äº<code>var</code>å±æ€§ï¼Œéœ€è¦å°†<code>Map</code>æ›¿æ¢æˆ<code>MutableMap</code>,ä½†æ˜¯è¿™æ ·çš„è¯å®ƒä»¬ä¸¤ä¸ªå¯æ˜¯åŒå‘ç»‘å®šçš„å“Ÿï¼Œæ¯”å¦‚ä¸‹é¢è¿™ç§</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MutableMapItem</span></span>(map:MutableMap&lt;String,Any?&gt;)&#123;<br>    <span class="hljs-keyword">var</span> name: String <span class="hljs-keyword">by</span> map<br>    <span class="hljs-keyword">var</span> age: <span class="hljs-built_in">Int</span> <span class="hljs-keyword">by</span> map<br>    <span class="hljs-keyword">var</span> address: String <span class="hljs-keyword">by</span> map<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>      <span class="hljs-keyword">val</span> map:MutableMap&lt;String,Any?&gt; = mutableMapOf(<br>        <span class="hljs-string">&quot;name&quot;</span> to <span class="hljs-string">&quot;xuan&quot;</span>,<br>        <span class="hljs-string">&quot;age&quot;</span> to <span class="hljs-number">18</span>,<br>        <span class="hljs-string">&quot;address&quot;</span> to <span class="hljs-string">&quot;beijing&quot;</span><br>    )<br>    <span class="hljs-keyword">val</span> mutableMapItem = MutableMapItem(map)<br>    println(<span class="hljs-string">&quot;<span class="hljs-subst">$&#123;mutableMapItem.name&#125;</span>  <span class="hljs-subst">$&#123;mutableMapItem.age&#125;</span> <span class="hljs-subst">$&#123;mutableMapItem.address&#125;</span>&quot;</span>)<br>    println(map)<br>    mutableMapItem.name = <span class="hljs-string">&quot;huang&quot;</span><br>    println(<span class="hljs-string">&quot;<span class="hljs-subst">$&#123;mutableMapItem.name&#125;</span>  <span class="hljs-subst">$&#123;mutableMapItem.age&#125;</span> <span class="hljs-subst">$&#123;mutableMapItem.address&#125;</span>&quot;</span>)<br>    println(map)<br>    mutableMapItem.name = <span class="hljs-string">&quot;yuan&quot;</span><br>    println(<span class="hljs-string">&quot;<span class="hljs-subst">$&#123;mutableMapItem.name&#125;</span>  <span class="hljs-subst">$&#123;mutableMapItem.age&#125;</span> <span class="hljs-subst">$&#123;mutableMapItem.address&#125;</span>&quot;</span>)<br>    println(map)<br>&#125;<br><span class="hljs-comment">//è¾“å‡º</span><br><span class="hljs-comment">// xuan  18 beijing</span><br><span class="hljs-comment">// &#123;name=xuan, age=18, address=beijing&#125;</span><br><span class="hljs-comment">// huang  18 beijing</span><br><span class="hljs-comment">// &#123;name=huang, age=18, address=beijing&#125;</span><br><span class="hljs-comment">// yuan  18 beijing</span><br><span class="hljs-comment">// &#123;name=yuan, age=18, address=beijing&#125;</span><br></code></pre></td></tr></table></figure><h4 id="å±€éƒ¨å±æ€§å§”æ‰˜"><a href="#å±€éƒ¨å±æ€§å§”æ‰˜" class="headerlink" title="å±€éƒ¨å±æ€§å§”æ‰˜"></a>å±€éƒ¨å±æ€§å§”æ‰˜</h4><p>å¯ä»¥å°†å±€éƒ¨å˜é‡å£°æ˜ä¸ºå§”æ‰˜å±æ€§ã€‚ ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ä¸€ä¸ªå±€éƒ¨å˜é‡æƒ°æ€§åˆå§‹åŒ–ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">example</span><span class="hljs-params">(computeFoo: () -&gt; <span class="hljs-type">Int</span>)</span></span> &#123;<br>    <span class="hljs-keyword">val</span> memoizedFoo <span class="hljs-keyword">by</span> lazy(computeFoo)<br>    <span class="hljs-keyword">val</span> someCondition = <span class="hljs-literal">false</span><br><br>    <span class="hljs-keyword">if</span> (someCondition &amp;&amp; memoizedFoo&gt;<span class="hljs-number">0</span> ) &#123;<br>        println(memoizedFoo+<span class="hljs-number">1</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>memoizedFoo</code>å˜é‡åªä¼šåœ¨ç¬¬ä¸€æ¬¡è®¿é—®æ—¶è®¡ç®—ã€‚ å¦‚æœ<code>someCondition</code>å¤±è´¥ï¼Œé‚£ä¹ˆè¯¥å˜é‡æ ¹æœ¬ä¸ä¼šè®¡ç®—ã€‚</p><h4 id="è‡ªå®šä¹‰å§”æ‰˜"><a href="#è‡ªå®šä¹‰å§”æ‰˜" class="headerlink" title="è‡ªå®šä¹‰å§”æ‰˜"></a>è‡ªå®šä¹‰å§”æ‰˜</h4><p>å…ˆçœ‹ä¸€ä¸‹è‡ªå®šä¹‰å§”æ‰˜çš„è¦æ±‚æœ‰å“ªäº›ï¼Œç¤ºä¾‹æ˜¯è¿™æ ·çš„</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Resource</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Owner</span> </span>&#123;<br>    <span class="hljs-keyword">var</span> varResource: Resource <span class="hljs-keyword">by</span> ResourceDelegate()<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ResourceDelegate</span></span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> resource: Resource = Resource()) &#123;<br>    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getValue</span><span class="hljs-params">(thisRef: <span class="hljs-type">Owner</span>, property: <span class="hljs-type">KProperty</span>&lt;*&gt;)</span></span>: Resource &#123;<br>        <span class="hljs-keyword">return</span> resource<br>    &#125;<br>    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setValue</span><span class="hljs-params">(thisRef: <span class="hljs-type">Owner</span>, property: <span class="hljs-type">KProperty</span>&lt;*&gt;, value: <span class="hljs-type">Any</span>?)</span></span> &#123;<br>        <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">is</span> Resource) &#123;<br>            resource = value<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ€»ç»“ä¸€ä¸‹</p><ol><li>å¯¹äº<code>var</code>ä¿®é¥°çš„å±æ€§ï¼Œæˆ‘ä»¬å¿…é¡»è¦æœ‰<code>getValue</code>ã€<code>setValue</code>è¿™ä¸¤ä¸ªæ–¹æ³•ï¼ŒåŒæ—¶ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•å¿…é¡»ç”¨<code>operator</code>å…³é”®å­—ä¿®é¥°ã€‚</li><li>ç”±äº<code>varResource</code>æ˜¯<code>Owner</code>,å› æ­¤<code>getValue</code>ã€<code>setValue</code>è¿™ä¸¤ä¸ªæ–¹æ³•ä¸­çš„<code>thisRef</code>çš„ç±»å‹ï¼Œå¿…é¡»è¦æ˜¯<code>Owner</code>æˆ–è€…æ˜¯<code>Ownerçš„çˆ¶ç±»</code>ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸‰å¤„çš„ç±»å‹æ˜¯ä¸€è‡´çš„ï¼Œå½“æˆ‘ä»¬ä¸ç¡®å®šå§”æ‰˜å±æ€§ä¼šå¤„äºå“ªä¸ªç±»çš„æ—¶å€™ï¼Œå°±å¯ä»¥å°†<code>thisRef</code>çš„ç±»å‹å®šä¹‰ä¸º<code>Any?</code>ã€‚</li><li>ç”±äºå§”æ‰˜çš„å±æ€§æ˜¯<code>Resource</code>ç±»å‹ï¼Œé‚£ä¹ˆå¯¹äºè‡ªå®šä¹‰å§”æ‰˜ä¸­çš„<code>getValue</code>ã€<code>setValue</code>å‚æ•°åŠè¿”å›å€¼éœ€è¦æ˜¯<code>Stringç±»å‹æˆ–è€…æ˜¯å®ƒçš„çˆ¶ç±»</code></li></ol><p>æˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢çš„ä»£ç å½“æˆæ¨¡æ¿ä»£ç ï¼Œéƒ½æ˜¯è¿™æ ·å†™å°±å¥½äº†ã€‚å¦‚æœè§‰å¾—éº»çƒ¦ï¼Œå¯ä»¥ä½¿ç”¨æ ‡å‡†åº“ä¸­çš„æ¥å£<code>ReadOnlyProperty</code>å’Œ<code>ReadWriteProperty</code>å°†å§”æ‰˜åˆ›å»ºä¸ºåŒ¿åå¯¹è±¡ï¼Œè€Œæ— éœ€åˆ›å»ºæ–°ç±»ã€‚å®ƒä»¬æä¾›æ‰€éœ€çš„æ–¹æ³•:<code>getValue()</code>åœ¨<code>ReadOnlyProperty</code>ä¸­å£°æ˜ï¼›<code>ReadWriteProperty</code>æ‰©å±•äº†å®ƒå¹¶æ·»åŠ äº†<code>setValue()</code>ã€‚è¿™æ„å‘³ç€å¯ä»¥åœ¨éœ€è¦<code>ReadOnlyProperty</code>æ—¶ä¼ é€’ <code>ReadWriteProperty</code>ã€‚<br>æ¯”å¦‚åƒè¿™æ ·</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">resourceDelegate</span><span class="hljs-params">(resource: <span class="hljs-type">Resource</span>= Resource()</span></span>) :ReadWriteProperty&lt;Owner,Resource&gt; =<br>    <span class="hljs-keyword">object</span>:ReadWriteProperty&lt;Owner,Resource&gt;&#123;<br>        <span class="hljs-keyword">var</span> curValue = resource<br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getValue</span><span class="hljs-params">(thisRef: <span class="hljs-type">Owner</span>, property: <span class="hljs-type">KProperty</span>&lt;*&gt;)</span></span>: Resource=curValue<br>        <br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setValue</span><span class="hljs-params">(thisRef: <span class="hljs-type">Owner</span>, property: <span class="hljs-type">KProperty</span>&lt;*&gt;, value: <span class="hljs-type">Resource</span>)</span></span> &#123;<br>            curValue = value<br>        &#125;<br><br>    &#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Owner</span> </span>&#123;<br>    <span class="hljs-keyword">val</span> readOnlyResource: Resource <span class="hljs-keyword">by</span> resourceDelegate()  <span class="hljs-comment">// ReadWriteProperty as val</span><br>    <span class="hljs-keyword">var</span> readWriteResource: Resource <span class="hljs-keyword">by</span> resourceDelegate()<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="æä¾›å§”æ‰˜"><a href="#æä¾›å§”æ‰˜" class="headerlink" title="æä¾›å§”æ‰˜"></a>æä¾›å§”æ‰˜</h4><p>é€šè¿‡å®šä¹‰ provideDelegate æ“ä½œç¬¦ï¼Œå¯ä»¥æ‰©å±•åˆ›å»ºå±æ€§å®ç°æ‰€å§”æ‰˜å¯¹è±¡çš„é€»è¾‘ã€‚ å¦‚æœ by å³ä¾§æ‰€ä½¿ç”¨çš„å¯¹è±¡å°† provideDelegate å®šä¹‰ä¸ºæˆå‘˜æˆ–æ‰©å±•å‡½æ•°ï¼Œ é‚£ä¹ˆä¼šè°ƒç”¨è¯¥å‡½æ•°æ¥åˆ›å»ºå±æ€§å§”æ‰˜å®ä¾‹ã€‚æ¯”å¦‚åœ¨åˆå§‹åŒ–ä¹‹å‰æ£€æŸ¥ä¸€è‡´æ€§ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ResourceDelegate</span>&lt;<span class="hljs-type">T</span>&gt; : <span class="hljs-type">ReadOnlyProperty</span>&lt;<span class="hljs-type">MyUI, T</span>&gt; </span>&#123;<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getValue</span><span class="hljs-params">(thisRef: <span class="hljs-type">MyUI</span>, property: <span class="hljs-type">KProperty</span>&lt;*&gt;)</span></span>: T &#123; ... &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ResourceLoader</span>&lt;<span class="hljs-type">T</span>&gt;</span>(id: ResourceID&lt;T&gt;) &#123;<br>    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">provideDelegate</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            thisRef: <span class="hljs-type">MyUI</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">            prop: <span class="hljs-type">KProperty</span>&lt;*&gt;</span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span>: ReadOnlyProperty&lt;MyUI, T&gt; &#123;<br>        checkProperty(thisRef, prop.name)<br>        <span class="hljs-comment">// åˆ›å»ºå§”æ‰˜</span><br>        <span class="hljs-keyword">return</span> ResourceDelegate()<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">checkProperty</span><span class="hljs-params">(thisRef: <span class="hljs-type">MyUI</span>, name: <span class="hljs-type">String</span>)</span></span> &#123; â€¦â€¦ &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyUI</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">bindResource</span><span class="hljs-params">(id: <span class="hljs-type">ResourceID</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: ResourceLoader&lt;T&gt; &#123; â€¦â€¦ &#125;<br><br>    <span class="hljs-keyword">val</span> image <span class="hljs-keyword">by</span> bindResource(ResourceID.image_id)<br>    <span class="hljs-keyword">val</span> text <span class="hljs-keyword">by</span> bindResource(ResourceID.text_id)<br>&#125;<br></code></pre></td></tr></table></figure><p><code>provideDelegate</code>çš„å‚æ•°ä¸<code>getValue</code>çš„ç›¸åŒï¼š</p><ul><li><code>thisRef</code>å¿…é¡»ä¸<code>å±æ€§æ‰€æœ‰è€…</code>ç±»å‹ï¼ˆå¯¹äºæ‰©å±•å±æ€§å¿…é¡»æ˜¯è¢«æ‰©å±•çš„ç±»å‹ï¼‰ç›¸åŒæˆ–è€…æ˜¯å®ƒçš„è¶…ç±»å‹ï¼›</li><li><code>property</code>å¿…é¡»æ˜¯ç±»å‹<code>KProperty&lt;*&gt;</code>æˆ–å…¶è¶…ç±»å‹ã€‚</li></ul><hr><p>å‚è€ƒï¼š</p><p><a href="https://book.kotlincn.net/text/delegation.html">å§”æ‰˜</a><br><a href="https://kotlinlang.org/docs/delegation.html">Delegation</a></p><hr><p>å·²å­¦ä¹ ï¼š</p><ul><li><p>æ‰©å±•</p><ul><li><input type='checkbox' disabled='true' checked>æ‰©å±•å‡½æ•°</input></li><li><input type='checkbox' disabled='true' checked>æ‰©å±•å±æ€§</input></li><li><input type='checkbox' disabled='true' checked>ä½œç”¨åŸŸ</input></li></ul></li><li><p>å‡½æ•°ç±»å‹</p><ul><li><input type='checkbox' disabled='true' checked>å¸¦æœ‰æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹</input></li><li><input type='checkbox' disabled='true' checked>Lambdaè¡¨è¾¾å¼</input></li><li><input type='checkbox' disabled='true' checked>SAM è½¬æ¢</input></li></ul></li><li><p>æ³›å‹</p><ul><li><input type='checkbox' disabled='true' checked>é€†å˜</input></li><li><input type='checkbox' disabled='true' checked>åå˜</input></li><li><input type='checkbox' disabled='true' checked>ç±»å‹æŠ•å½±</input></li><li><input type='checkbox' disabled='true' checked>æ˜ŸæŠ•å½±</input></li><li><input type='checkbox' disabled='true' checked>æ³›å‹çº¦æŸ</input></li></ul></li><li><p>å…³é”®å­—</p><ul><li><input type='checkbox' disabled='true' checked>ä½œç”¨åŸŸå‡½æ•°ï¼šwithã€letã€runã€applyã€also</input></li></ul></li><li><p>å§”æ‰˜</p><ul><li><input type='checkbox' disabled='true' checked>å§”æ‰˜ç±»</input></li><li><input type='checkbox' disabled='true' checked>å§”æ‰˜å±æ€§</input></li><li><input type='checkbox' disabled='true' checked>è‡ªå®šä¹‰å§”æ‰˜</input></li></ul></li></ul><p>æœªå­¦ä¹ ï¼š</p><ul><li><p>å…³é”®å­—</p><ul><li>object</li><li>Unit</li><li>Nothing</li><li>inline,noinline,crossinline</li></ul></li><li><p>åç¨‹</p><ul><li>å¯åŠ¨</li><li>æŒ‚èµ·</li><li>Job</li><li>Context</li><li>Channel</li><li>Flow</li><li>select</li><li>å¹¶å‘ã€å¼‚å¸¸</li><li>launch</li><li>Dispatchers</li><li>CoroutineScope</li></ul></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Kotlin</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kotlinæ³›å‹:é€†å˜ä¸åå˜</title>
    <link href="/2024/04/30/kotlin%E6%B3%9B%E5%9E%8B-%E9%80%86%E5%8F%98%E4%B8%8E%E5%8D%8F%E5%8F%98/"/>
    <url>/2024/04/30/kotlin%E6%B3%9B%E5%9E%8B-%E9%80%86%E5%8F%98%E4%B8%8E%E5%8D%8F%E5%8F%98/</url>
    
    <content type="html"><![CDATA[<p>æ³›å‹ä¸­æ¶‰åŠåˆ°çš„æ¦‚å¿µä¹Ÿä¸å°‘,å‹å˜(Variance)ã€é€†å˜(Contravariance)ã€åå˜(Covariance)ã€ä¸å˜(Invariant).åœ¨ kotlin ä¸­è¿˜æœ‰ä¸‰ä¸ªå…³é”®å­—<code>in</code>ã€<code>out</code>ã€<code>where</code>ã€<code>reified</code>ç­‰,åœ¨javaä¸­åŒæ ·ä¹Ÿæœ‰<code>? extends</code>ã€<code>? super</code>ã€<code>?</code><br>è¿™äº›æ¦‚å¿µæ˜¯å•¥æ„æ€å˜ï¼Ÿå¼•ç”¨ç‚¹æ¦‚å¿µè¯´æ˜</p><blockquote><p>å‹å˜(Variance)ã€åå˜(Covariance)ã€é€†å˜(Contravariance)å’Œä¸å˜(Invariant)æ˜¯ç›¸å…³ä½†ä¸åŒçš„æ¦‚å¿µ.</p></blockquote><blockquote><p>å‹å˜æ˜¯æŒ‡æ³›å‹ç±»å‹å‚æ•°åœ¨å­ç±»å‹å…³ç³»ä¸­çš„è¡Œä¸º.å®ƒæè¿°äº†ä¸€ä¸ªæ³›å‹ç±»å‹æ˜¯å¦å…è®¸ç±»å‹å‚æ•°çš„å­ç±»å‹å…³ç³»ä¸æ³›å‹ç±»å‹å‚æ•°çš„å­ç±»å‹å…³ç³»ä¿æŒä¸€è‡´.åœ¨æ³›å‹ä¸­,å¯ä»¥æœ‰ä¸‰ç§å‹å˜ç±»å‹ï¼šåå˜ã€é€†å˜å’Œä¸å˜.</p></blockquote><blockquote><p>åå˜æ˜¯æŒ‡å¦‚æœä¸€ä¸ªæ³›å‹ç±»å‹çš„å­ç±»å‹å…³ç³»ä¸å…¶ç±»å‹å‚æ•°çš„å­ç±»å‹å…³ç³»ä¿æŒä¸€è‡´,åˆ™è¯¥æ³›å‹ç±»å‹æ˜¯åå˜çš„.ç®€è€Œè¨€ä¹‹,å¦‚æœå­ç±»å‹çš„æ³›å‹å‚æ•°æ˜¯çˆ¶ç±»å‹æ³›å‹å‚æ•°çš„å­ç±»å‹,å°±å¯ä»¥è¯´è¯¥æ³›å‹ç±»å‹æ˜¯åå˜çš„.</p></blockquote><blockquote><p>é€†å˜æ˜¯æŒ‡å¦‚æœä¸€ä¸ªæ³›å‹ç±»å‹çš„å­ç±»å‹å…³ç³»ä¸å…¶ç±»å‹å‚æ•°çš„å­ç±»å‹å…³ç³»ç›¸å,åˆ™è¯¥æ³›å‹ç±»å‹æ˜¯é€†å˜çš„.ç®€è€Œè¨€ä¹‹,å¦‚æœå­ç±»å‹çš„æ³›å‹å‚æ•°æ˜¯çˆ¶ç±»å‹æ³›å‹å‚æ•°çš„è¶…ç±»å‹,å°±å¯ä»¥è¯´è¯¥æ³›å‹ç±»å‹æ˜¯é€†å˜çš„.</p></blockquote><blockquote><p>ä¸å˜æ˜¯æŒ‡ä¸€ä¸ªæ³›å‹ç±»å‹çš„å­ç±»å‹å…³ç³»ä¸å…¶ç±»å‹å‚æ•°æ— å…³,å³ç±»å‹å‚æ•°çš„å­ç±»å‹å…³ç³»ä¸æ³›å‹ç±»å‹çš„å­ç±»å‹å…³ç³»æ— å…³.åœ¨ä¸å˜çš„æƒ…å†µä¸‹,ä¸èƒ½å°†çˆ¶ç±»å‹çš„å¯¹è±¡èµ‹å€¼ç»™å­ç±»å‹çš„å¯¹è±¡,ä¹Ÿä¸èƒ½å°†å­ç±»å‹çš„å¯¹è±¡èµ‹å€¼ç»™çˆ¶ç±»å‹çš„å¯¹è±¡.</p></blockquote><blockquote><p>å› æ­¤,å¯ä»¥è¯´åå˜å’Œé€†å˜æ˜¯å‹å˜çš„ä¸¤ç§å…·ä½“å½¢å¼,è€Œä¸å˜åˆ™æ˜¯å‹å˜çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µ.</p></blockquote><blockquote><p>æ€»ç»“èµ·æ¥,åå˜ã€é€†å˜å’Œä¸å˜æè¿°äº†æ³›å‹ç±»å‹å‚æ•°ä¸æ³›å‹ç±»å‹ä¹‹é—´å­ç±»å‹å…³ç³»çš„ä¸åŒè¡Œä¸º.åå˜å’Œé€†å˜æ˜¯å¯¹å­ç±»å‹å…³ç³»çš„å…·ä½“çº¦æŸ,è€Œä¸å˜åˆ™æ˜¯æ²¡æœ‰ä»»ä½•å­ç±»å‹å…³ç³»çš„çº¦æŸ.å®ƒä»¬ä¹‹é—´æ˜¯äº’ç›¸æ’æ–¥çš„å…³ç³»,ä¸æ˜¯åŒ…å«å…³ç³».</p></blockquote><p>ä¸€è„¸æ‡µäº†å§ğŸ˜³?é—®é¢˜ä¸å¤§,ç»“åˆä»£ç å…·ä½“çœ‹ä¸€ä¸‹å°±å·®ä¸å¤šäº†</p><p>æˆ‘ä»¬è¿˜æ˜¯ç»“åˆ java å’Œ kotlin å¯¹æ¯”æ¥çœ‹ä¸€ä¸‹</p><h3 id="Javaä¸­çš„æ³›å‹"><a href="#Javaä¸­çš„æ³›å‹" class="headerlink" title="Javaä¸­çš„æ³›å‹"></a>Javaä¸­çš„æ³›å‹</h3><p>æˆ‘ä»¬å…ˆç”¨Javaä»£ç æ¥çœ‹ä¸€ä¸‹,å‡å¦‚æˆ‘ä»¬æœ‰å¦‚ä¸‹ä¸‰ä¸ªç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> &#123;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span> &#123;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Poodle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Dog</span> &#123;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Bird</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”±äº java çš„å¤šæ€æ€§,æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Animal</span> <span class="hljs-variable">animalDog</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();<br><span class="hljs-type">Animal</span> <span class="hljs-variable">animalBird</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bird</span>();<br>ArrayList&lt;Animal&gt; animalList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>animalList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Bird</span>());<br>animalList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>());<br></code></pre></td></tr></table></figure><p>è¿™ä¹ˆå†™æ˜¯æ²¡é—®é¢˜çš„,æˆ‘ä»¬å¯ä»¥æŠŠå­ç±»æ·»åŠ åˆ°çˆ¶ç±»åˆ—è¡¨ä¸­,ä½†å½“æˆ‘ä»¬åœ¨<code>animalList</code>ä¸­è·å–æ•°æ®æ—¶è¿”å›çš„æ˜¯<code>Animal</code>ç±»å‹,å¦‚æœç”¨åˆ°å­ç±»çš„ç‰¹æ€§,è¿˜éœ€è¦ä½¿ç”¨<code>instanceof</code>æ¥åˆ¤æ–­ä¸€ä¸‹ç±»å‹.<br>ä½†å¦‚æœæˆ‘ä»¬è¿™ä¹ˆå†™æ˜¯ä¸è¡Œçš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Java">ArrayList&lt;Animal&gt; animalList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Dog&gt;();<br></code></pre></td></tr></table></figure><p>å› ä¸º java çš„æ³›å‹å…·æœ‰ä¸å˜æ€§,åœ¨Java é‡Œé¢è®¤ä¸º<code>ArrayList&lt;Animal&gt;</code>å’Œ<code>ArrayList&lt;Dog&gt;</code>æ²¡å•¥å…³ç³».<br>åŒæ ·çš„,å½“æˆ‘ä»¬æƒ³è¦ç”¨æ–¹æ³•é‡è½½æ—¶ä¹Ÿä¼šé‡åˆ°è¿™ç§æƒ…å†µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">animal</span><span class="hljs-params">(ArrayList&lt;Dog&gt; dogs)</span>&#123;<br>    <br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">animal</span><span class="hljs-params">(ArrayList&lt;Bird&gt; birds)</span>&#123;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬è¿™ä¹ˆå†™çš„è¯ä¼šæŠ¥é”™,IDE ä¼šæç¤ºæˆ‘ä»¬ç›¸åº”çš„ä¿¡æ¯</p><blockquote><p>animal(ArrayList<Dog>)â€™ clashes with â€˜animal(ArrayList<Bird>)â€™; both methods have same erasure</p></blockquote><p>ä¸¤ä¸ªæ–¹æ³•çš„å‚æ•°æœ‰ç›¸åŒçš„æ“¦é™¤ç±»å‹,ç¼–è¯‘åä¼šè¢«è®¤ä¸ºæ˜¯åŒä¸€ä¸ªæ–¹æ³•.<br>åŒæ ·çš„,æˆ‘ä»¬åœ¨<strong>æ•è·æ³›å‹å¼‚å¸¸</strong>æ—¶ä¹Ÿä¼šæœ‰ç±»ä¼¼çš„æŠ¥é”™ä¿¡æ¯.</p><h3 id="Javaä¸­çš„æ³›å‹æ“¦é™¤"><a href="#Javaä¸­çš„æ³›å‹æ“¦é™¤" class="headerlink" title="Javaä¸­çš„æ³›å‹æ“¦é™¤"></a>Javaä¸­çš„æ³›å‹æ“¦é™¤</h3><p>é¢è¯•å¸¸è§çš„å…«è‚¡æ–‡,æˆ‘ä»¬æ¥å¤ä¹ ä¸€ä¸‹,è¿™éƒ¨åˆ†å¯ä»¥è·³è¿‡ä¸çœ‹.<br>æ¯”å¦‚æˆ‘ä»¬åœ¨C#ä¸­æœ‰å¦‚ä¸‹ä»£ç </p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System; <br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>&#123; <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params">String[] args</span>)</span>&#123; <br>        test&lt;<span class="hljs-built_in">string</span>&gt;(); <br>    &#125;    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span>&lt;<span class="hljs-title">T</span>&gt;()</span>&#123; <br>        Console.WriteLine(<span class="hljs-keyword">typeof</span>(T)); <br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„æ³›å‹ T ç±»å‹string æ˜¯å¯ä»¥åœ¨è¿è¡Œæ—¶è·å–åˆ°çš„,å¹¶ä¸”åœ¨è¿™é‡Œæ˜¯ä¸€ä¸ªçœŸå®å¯ç”¨çš„ç±»å‹.<br>ä½†åœ¨Javaæ˜¯ä¸è¡Œçš„,ç”±äºå‘ä¸Šå…¼å®¹å†å²ä»£ç çš„åŸå›  Java é‡‡ç”¨äº†<code>Code sharing</code>çš„ç­–ç•¥,ä½¿å¾—æ³›å‹åªå­˜åœ¨äºæºç é˜¶æ®µ,ç¼–è¯‘è¿‡åçš„Classæ–‡ä»¶å¹¶ä¸å­˜åœ¨æ³›å‹,è™šæ‹Ÿæœºå¹¶ä¸çŸ¥é“æ³›å‹çš„å­˜åœ¨,æ‰€ä»¥è¯´Javaä¸­çš„æ³›å‹æ˜¯ä¸€ç§ä¼ªæ³›å‹,è¿™ç§å‚æ•°ç±»å‹åªå­˜åœ¨äºæºç é˜¶æ®µåœ¨ç¼–è¯‘åå¹¶ä¸å­˜åœ¨çš„æœºåˆ¶æˆ‘ä»¬å«åš<strong>æ³›å‹æ“¦é™¤</strong>.ä¸ºäº†ä¿æŒæ³›å‹ç»§æ‰¿æˆ–å®ç°å…³ç³»çš„æ­£ç¡®æ€§,java ä¸­è¿˜æœ‰ä¸€ç§ç­–ç•¥ï¼š<strong>æ¡¥æ–¹æ³•ç”Ÿæˆ(Bridge Method Generation)</strong>:<br>ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜æ¡¥æ–¹æ³•ç”Ÿæˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span>&lt;T&gt; &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">(T shape)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Drawing shape: &quot;</span> + shape.toString());<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span>&lt;String&gt; &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">(String shape)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Drawing circle: &quot;</span> + shape);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ç±»å‹æ“¦é™¤å,ç¼–è¯‘å™¨ä¼šç”Ÿæˆæ¡¥æ–¹æ³•æ¥ä¿æŒæ³›å‹ç»§æ‰¿å…³ç³»çš„æ­£ç¡®æ€§.åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­,ç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸€ä¸ªæ¡¥æ–¹æ³•,ä½¿å¾—Circleç±»çš„æ–¹æ³•ç­¾åä¸çˆ¶ç±»çš„æ–¹æ³•ç­¾åä¿æŒä¸€è‡´,ä½†è¿”å›ç±»å‹è¢«æ“¦é™¤ä¸ºçˆ¶ç±»çš„ç±»å‹å‚æ•°.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span>&lt;String&gt; &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">(String shape)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Drawing circle: &quot;</span> + shape);<br>    &#125;<br><br>    <span class="hljs-comment">// ç”Ÿæˆçš„æ¡¥æ–¹æ³•</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">(Object shape)</span> &#123;<br>        draw((String) shape);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡ç”Ÿæˆçš„æ¡¥æ–¹æ³•,å³draw(Object shape),åœ¨ç±»å‹æ“¦é™¤åä»ç„¶èƒ½å¤Ÿæ­£ç¡®åœ°è°ƒç”¨æ³›å‹æ–¹æ³•.è¿™æ ·,å³ä½¿åœ¨ç¼–è¯‘å™¨çœ‹ä¸åˆ°å…·ä½“çš„æ³›å‹ç±»å‹ä¿¡æ¯,ä»ç„¶å¯ä»¥é€šè¿‡æ¡¥æ–¹æ³•æ¥è°ƒç”¨æ­£ç¡®çš„æ–¹æ³•å®ç°.<br>æ„Ÿå…´è¶£çš„è¯å¯ä»¥æœä¸€ä¸‹å…³é”®å­—:æ³›å‹æ“¦é™¤ã€æ¡¥æ–¹æ³•ç”Ÿæˆã€Code sharinã€Code specialization</p><h3 id="Java-ä¸­çš„æ³›å‹é€šé…ç¬¦"><a href="#Java-ä¸­çš„æ³›å‹é€šé…ç¬¦" class="headerlink" title="Java ä¸­çš„æ³›å‹é€šé…ç¬¦"></a>Java ä¸­çš„æ³›å‹é€šé…ç¬¦</h3><p>å‡å¦‚æˆ‘ä»¬çœŸçš„æœ‰åƒä¸Šé¢é‚£ç§èµ‹å€¼éœ€æ±‚æ€ä¹ˆæï¼Ÿjava ç»™æˆ‘ä»¬æä¾›äº†<code>æ³›å‹é€šé…ç¬¦</code>: <strong>? extends</strong> å’Œ <strong>? super</strong> æ¥è§£å†³è¿™ä¸ªé—®é¢˜.<br>å•°å—¦ä¸€ä¸‹ï¼šåœ¨ç»§æ‰¿å…³ç³»ä¸Š,ä¸€èˆ¬æƒ…å†µä¸‹å°†çˆ¶ç±»æ”¾åœ¨ä¸Šæ–¹,å­ç±»æ”¾åœ¨ä¸‹æ–¹.æ¯”å¦‚ä¸Šé¢å®šä¹‰çš„ç±»</p><pre><code class="mermaid" >graph TBA(Animal)A10(Dog)A11(Bird)A20(Poodle)A-->A10A-->A11A10-->A20</code></pre><h4 id="extends"><a href="#extends" class="headerlink" title="? extends"></a>? extends</h4><p>æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Java">ArrayList&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span>&gt; arrayList ;<br>arrayList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Bird&gt;();<br>arrayList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Dog&gt;();<br>arrayList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Animal&gt;();<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>? extends</code>å«åš<strong>ä¸Šç•Œé€šé…ç¬¦</strong>,å¯ä»¥ä½¿ Java æ³›å‹å…·æœ‰<strong>åå˜æ€§ Covariance</strong>,åå˜å°±æ˜¯å…è®¸ä¸Šé¢çš„èµ‹å€¼æ˜¯åˆæ³•çš„.<br>ä¸è¿‡è¿™é‡Œçš„<code>extends</code>å’Œæˆ‘ä»¬å®šä¹‰<code>class</code>æ—¶ç»§æ‰¿æŸä¸ªç±»ç”¨çš„<code>extends</code>æœ‰ä¸€ç‚¹ç‚¹ä¸ä¸€æ ·,é™¤äº†ä¸Šç•Œæ‰€æœ‰çš„ç›´æ¥å­ç±»ã€é—´æ¥å­ç±»è¿˜åŒ…å«å®ƒæœ¬èº«,å¹¶ä¸”ä¸Šç•Œä¹Ÿå¯ä»¥æ˜¯ interface.<br>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­,<code>ArrayList&lt;? extends Animal&gt;</code>è¡¨ç¤ºåˆ—è¡¨ä¸­å¯ä»¥å­˜æ”¾ Animal åŠå…¶å­ç±»ã€é—´æ¥å­ç±»çš„ç±»å‹.ä¹Ÿå°±æ˜¯ç¡®è®¤äº†å®ƒçš„ä¸Šé™èƒ½åˆ°å“ªä¸€å±‚.<br>ä½†æˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ³›å‹é€šé…ç¬¦ä¹‹å,åœ¨ä½¿ç”¨ä¸Šä¼šæœ‰ä¸€äº›å°é—®é¢˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Java">arrayList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>());<span class="hljs-comment">//error</span><br>arrayList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Bird</span>());<span class="hljs-comment">//error</span><br>arrayList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>());<span class="hljs-comment">//error</span><br><span class="hljs-type">Animal</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span>  arrayList.get(<span class="hljs-number">0</span>);<span class="hljs-comment">//ok</span><br></code></pre></td></tr></table></figure><p>ç”±äº<code>arrayList</code>ä¸­å­˜æ”¾çš„å¯ä»¥æ˜¯<strong>Animal åŠå…¶å­ç±»ã€é—´æ¥å­ç±»çš„ç±»å‹</strong>,æ‰€ä»¥æˆ‘ä»¬å¹¶ä¸ç¡®å®šæ˜¯å“ªç§ç±»å‹,å› æ­¤æˆ‘ä»¬æ— æ³•å‘åˆ—è¡¨ä¸­æ·»åŠ å…ƒç´ ,ä½†å¯ä»¥ç¡®å®šçš„æ˜¯,å°†åˆ—è¡¨ä¸­çš„å…ƒç´ èµ‹å€¼ç»™ Animalç±»å‹çš„å˜é‡æ˜¯æ²¡é—®é¢˜çš„.<br>åƒè¿™ç§åªèƒ½ä»åˆ—è¡¨ä¸­è¯»å–æ•°æ®æä¾›,ä½†ä¸èƒ½å‘åˆ—è¡¨ä¸­å†™å…¥çš„æƒ…å†µæˆ‘ä»¬ç§°ä¹‹ä¸º<code>ç”Ÿäº§è€…</code></p><h4 id="super"><a href="#super" class="headerlink" title="? super"></a>? super</h4><p>æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Java">ArrayList&lt;? <span class="hljs-built_in">super</span> Dog&gt; list ;<br>list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Dog&gt;();<br>list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Animal&gt;();<br>list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Poodle&gt;();<span class="hljs-comment">//error</span><br><br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>? super</code>å«åš<strong>ä¸‹ç•Œé€šé…ç¬¦</strong>,å¯ä»¥ä½¿Javaæ³›å‹å…·<strong>é€†å˜æ€§ Contravariance</strong>,é€†å˜å°±æ˜¯å…è®¸ä¸Šé¢çš„èµ‹å€¼æ˜¯åˆæ³•çš„.<br>é€šè¿‡ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‹ç•Œé€šé…ç¬¦ç¡®å®šäº†åˆ—è¡¨çš„ä¸‹é™,ä¹Ÿå°±æ˜¯ç¡®è®¤äº†ä¸‹é™åœ¨å“ªä¸€å±‚,æˆ‘ä»¬å¯ä»¥å°†è¯¥å±‚åŠä»¥ä¸Šçš„ç±»å‹èµ‹å€¼ç»™ list.åŒæ ·çš„,æˆ‘ä»¬åœ¨ä½¿ç”¨ä¸Šä¹Ÿæœ‰ä¸€ç‚¹ç‚¹å°é—®é¢˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Java">list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>());<br>list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Poodle</span>());<br>list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>());<span class="hljs-comment">//error</span><br><br><span class="hljs-type">Object</span> <span class="hljs-variable">dog</span> <span class="hljs-operator">=</span> list.get(<span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><p>å› ä¸ºlist ä¸­å­˜æ”¾çš„è‚¯å®šæ˜¯<strong>Dogæˆ–è€…å…¶çˆ¶ç±»ã€é—´æ¥çˆ¶ç±»</strong>,æ ¹æ®é‡Œæ°æ›¿æ¢åŸåˆ™,ä»»ä½•ä½¿ç”¨çˆ¶ç±»çš„åœ°æ–¹å¯ä»¥è¢«å®ƒçš„å­ç±»æ›¿æ¢,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å‘ list ä¸­æ·»åŠ <strong>Dogæˆ–å…¶å­ç±»ã€é—´æ¥å­ç±»</strong>.ä½†æ˜¯å½“æˆ‘ä»¬ä» list ä¸­å–æ•°æ®çš„æ—¶å€™,ç”±äºä¸çŸ¥é“ list ä¸­å­˜æ”¾çš„å…·ä½“æ˜¯ä»€ä¹ˆç±»å‹,åœ¨ java ä¸­ Object æ˜¯æ‰€æœ‰ç±»å‹çš„çˆ¶ç±»,æ‰€ä»¥è¿™é‡Œå–åˆ°çš„æ•°æ®è¿”å›çš„<strong>Object</strong>ç±»å‹.</p><p>ä¸€èˆ¬æƒ…å†µä¸‹,æˆ‘ä»¬è·å–åˆ°Objectå¯ä»¥é€šè¿‡<code>className</code>æˆ–è€…<code>instanceof</code>æ¥åˆ¤æ–­å…·ä½“ç±»å‹,ä½†æˆ‘ä»¬å°±å…ˆå¿½ç•¥å§.<br>åƒè¿™ç§åªå†™å…¥è€Œä¸è¯»å–çš„æ³›å‹ç±»å‹å£°æ˜æƒ…å†µç§°ä¹‹ä¸º<strong>æ¶ˆè´¹è€… Consumer</strong>.</p><h4 id="æ— è¾¹ç•Œé€šé…ç¬¦"><a href="#æ— è¾¹ç•Œé€šé…ç¬¦" class="headerlink" title="æ— è¾¹ç•Œé€šé…ç¬¦"></a>æ— è¾¹ç•Œé€šé…ç¬¦</h4><p>è¿˜æœ‰ä¸€ç§æ— è¾¹ç•Œé€šé…ç¬¦,ç”¨å•é—®å·è¡¨ç¤ºï¼šList&lt;?&gt;,ä¹Ÿå°±æ˜¯æ²¡æœ‰ä»»ä½•é™å®š,ç›¸å½“äº<code>? extends Object</code>.éœ€è¦æ³¨æ„çš„æ˜¯,å®ƒå’Œä¸ä½¿ç”¨ç±»å‹çš„ List è¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼š</p><ul><li>List&lt;?&gt; listè¡¨ç¤ºçš„æ˜¯åˆ—è¡¨ä¿å­˜æŸä¸ªç‰¹å®šç±»å‹çš„å¯¹è±¡,ä½†æˆ‘ä»¬ä¸èƒ½å‘å…¶ä¸­æ·»åŠ ä»»ä½•å…ƒç´ ,å› ä¸ºæˆ‘ä»¬ä¸æ¸…æ¥š list ä¸­ä¿å­˜çš„æ˜¯é‚£ç§ç±»å‹</li><li>æ²¡æœ‰æ³›å‹å‚æ•°çš„ List è¡¨ç¤ºè¯¥åˆ—è¡¨æŒæœ‰çš„å…ƒç´ ç±»å‹æ˜¯ Object,å› æ­¤å¯ä»¥æ·»åŠ ä»»ä½•ç±»å‹çš„å¯¹è±¡,ä½†ç¼–è¯‘å™¨ä¼šæœ‰è­¦å‘Šä¿¡æ¯.</li></ul><h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>å°å°çš„æ€»ç»“ä¸€ä¸‹ï¼š<br>åˆ©ç”¨<code>? extends</code>å½¢å¼çš„é€šé…ç¬¦å¯ä»¥å®ç°æ³›å‹çš„å‘ä¸Šè½¬å‹,ä¹Ÿå°±æ˜¯æ”¯æŒåå˜.ä½†ä½¿ç”¨ä¸Šé€šé…ç¬¦åç¼–è¯‘å™¨ä¸ºäº†ä¿è¯è¿è¡Œæ—¶çš„å®‰å…¨,ä¼šé™å®šå¯¹å…¶å†™çš„æ“ä½œ,å¼€æ”¾è¯»çš„æ“ä½œä¹Ÿå°±æ˜¯<strong>åªèƒ½è¯»å–ä¸èƒ½ä¿®æ”¹</strong><br>åˆ©ç”¨<code>? super T</code>å½¢å¼çš„é€šé…ç¬¦å¯ä»¥å®ç°æ³›å‹çš„å‘ä¸‹è½¬å‹,ä¹Ÿå°±æ˜¯æ”¯æŒé€†å˜,ä¸ä¸Šé€šé…ç¬¦ç›¸å,ä¸‹è¾¹ç•Œé€šé…ç¬¦é€šå¸¸é™å®šè¯»çš„æ“ä½œ,å¼€æ”¾å†™çš„æ“ä½œ,ä¹Ÿå°±æ˜¯<strong>åªèƒ½ä¿®æ”¹ä¸èƒ½è¯»å–</strong></p><p>Joshua Bloch åœ¨å…¶è‘—ä½œã€ŠEffective Javaã€‹ç¬¬ä¸‰ç‰ˆ ä¸­å¾ˆå¥½åœ°è§£é‡Šäº†è¯¥é—®é¢˜ (ç¬¬ 31 æ¡ï¼šâ€œåˆ©ç”¨æœ‰é™åˆ¶é€šé…ç¬¦æ¥æå‡ API çš„çµæ´»æ€§â€). ä»–ç§°é‚£äº›ä½ åªèƒ½ä»ä¸­è¯»å–çš„å¯¹è±¡ä¸ºç”Ÿäº§è€…, å¹¶ç§°é‚£äº›åªèƒ½å‘å…¶å†™å…¥çš„å¯¹è±¡ä¸ºæ¶ˆè´¹è€….ä»–å»ºè®®ï¼š</p><blockquote><p>ä¸ºäº†çµæ´»æ€§æœ€å¤§åŒ–,åœ¨è¡¨ç¤ºç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…çš„è¾“å…¥å‚æ•°ä¸Šä½¿ç”¨é€šé…ç¬¦ç±»å‹.</p></blockquote><p>ä»–è¿˜æå‡ºäº†ä»¥ä¸‹åŠ©è®°ç¬¦ï¼šPECS ä»£è¡¨ç”Ÿäº§è€…-Extendsã€æ¶ˆè´¹è€…-Super(Producer-Extends, Consumer-Super).</p><h3 id="kotlin-ä¸­çš„æ³›å‹é€šé…ç¬¦"><a href="#kotlin-ä¸­çš„æ³›å‹é€šé…ç¬¦" class="headerlink" title="kotlin ä¸­çš„æ³›å‹é€šé…ç¬¦"></a>kotlin ä¸­çš„æ³›å‹é€šé…ç¬¦</h3><p>ç†æ¸…æ¥šäº† java ä¸­çš„æ³›å‹é€šé…ç¬¦,æ¥ç€æˆ‘ä»¬çœ‹ä¸€ä¸‹ kotlin ä¸­çš„é€šé…ç¬¦,ç›¸å¯¹äº Java çš„é€šé…ç¬¦æå‡ºäº†ä¸€ç§æ–°çš„å®šä¹‰ï¼š<strong>å£°æ˜å¤„å‹å˜(declaration-site variance)<strong>ä¸</strong>ç±»å‹æŠ•å½±(type projections)</strong><br>å…ˆä» kotlin ä¸­çš„é€šé…ç¬¦è¯´èµ·ï¼š<br>å’Œ java æ³›å‹ä¸€æ ·ï¼Œkotlin ä¸­çš„æ³›å‹ä¹Ÿæ˜¯ä¸å˜çš„ï¼ŒåŒæ ·çš„ï¼Œä¹Ÿæä¾›äº†ç›¸åº”çš„å…³é”®å­—æ¥æ”¯æŒ<strong>åå˜</strong>å’Œ<strong>é€†å˜</strong></p><ul><li>ä½¿ç”¨å…³é”®å­—<code>out</code>æ¥æ”¯æŒåå˜ï¼Œç­‰åŒäº Java ä¸­çš„ä¸Šç•Œé€šé…ç¬¦<code>? extends</code>ã€‚</li><li>ä½¿ç”¨å…³é”®å­—<code>in</code>æ¥æ”¯æŒé€†å˜ï¼Œç­‰åŒäº Java ä¸­çš„ä¸‹ç•Œé€šé…ç¬¦<code>? super</code>ã€‚</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> outList: MutableList&lt;<span class="hljs-keyword">out</span> TestMain.Animal&gt; = mutableListOf()<br><span class="hljs-keyword">val</span> outListItem: TestMain.Animal = outList[<span class="hljs-number">0</span>]<br><br><br><span class="hljs-keyword">val</span> inList: MutableList&lt;<span class="hljs-keyword">in</span> TestMain.Animal&gt; = mutableListOf()<br>inList.add(TestMain.Dog())<br>inList.add(TestMain.Bird())<br>inList.add(TestMain.Poodle())<br><span class="hljs-keyword">val</span> inListItem: Any? = inList[<span class="hljs-number">0</span>]<br></code></pre></td></tr></table></figure><p>æ— éæ˜¯æ¢äº†ä¸ªå†™æ³•è€Œå·²ï¼Œæ²¡å¤šå¤§å·®åˆ«.ä¸è¿‡éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œkotlin åŒæ—¶æ”¯æŒä½¿ç”¨å¤„å‹å˜å’Œå£°æ˜å¤„å‹å˜ã€‚<br>ä¸¾ä¸€ä¸ªç”¨çƒ‚äº†çš„ä¾‹å­</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Producer</span>&lt;<span class="hljs-type">out T</span>&gt; </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">produce</span><span class="hljs-params">()</span></span>: T &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span> <span class="hljs-keyword">as</span> T<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Consumer</span>&lt;<span class="hljs-type">in T</span>&gt; </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">consume</span><span class="hljs-params">(t: <span class="hljs-type">T</span>)</span></span> &#123;<br>        println(t)<br>    &#125;<br>&#125;<br><span class="hljs-keyword">val</span> producer: Producer&lt;TestMain.Animal&gt; = Producer()<br><span class="hljs-keyword">val</span> animal: TestMain.Animal = producer.produce()<br><br><span class="hljs-keyword">val</span> consumer: Consumer&lt;TestMain.Animal&gt; = Consumer()<br>consumer.consume(TestMain.Dog())<br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬ç¡®è®¤æ³›å‹å‚æ•°åªç”¨æ¥è¾“å…¥æˆ–è€…è¾“å‡ºï¼Œå¯ä»¥åœ¨å£°æ˜å¤„ç›´æ¥æ·»åŠ <code>in</code>æˆ–è€…<code>out</code>.å½“ç„¶ä¹Ÿå¯ä»¥åœ¨ä½¿ç”¨å¤„æ·»åŠ å£°æ˜</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Producer1</span>&lt;<span class="hljs-type">T</span>&gt; </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">produce</span><span class="hljs-params">()</span></span>: T? &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span><br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Consumer1</span>&lt;<span class="hljs-type">T</span>&gt; </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">consume</span><span class="hljs-params">(t: <span class="hljs-type">T</span>)</span></span> &#123;<br>        println(t)<br>    &#125;<br>&#125;<br><span class="hljs-keyword">val</span> producer1: Producer1&lt;<span class="hljs-keyword">out</span> TestMain.Animal&gt; = Producer1()<br><span class="hljs-keyword">val</span> animal1: TestMain.Animal? = producer1.produce()<br><br><span class="hljs-keyword">val</span> consumer1: Consumer1&lt;<span class="hljs-keyword">in</span> TestMain.Animal&gt; = Consumer1()<br>consumer1.consume(TestMain.Dog())<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¹Ÿå°±æ˜¯ç»å¸¸è¯´çš„ <strong>æ¶ˆè´¹è€… in, ç”Ÿäº§è€… out</strong></p><h4 id="ç±»å‹æŠ•å½±"><a href="#ç±»å‹æŠ•å½±" class="headerlink" title="ç±»å‹æŠ•å½±"></a>ç±»å‹æŠ•å½±</h4><p>è¿™ä¸ªä¸œè¥¿å¯ä»¥ç†è§£ä¸ºå°±æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œæ ¹æ®å®˜æ–¹æè¿°æ˜¯è¿™æ ·çš„:<br>å°†ç±»å‹å‚æ•°<code>T</code>å£°æ˜ä¸º<code>out</code>éå¸¸ç®€å•ï¼Œå¹¶ä¸”èƒ½é¿å…ä½¿ç”¨å¤„å­ç±»å‹åŒ–çš„éº»çƒ¦ï¼Œä½†æ˜¯æœ‰äº›ç±»å®é™…ä¸Šä¸èƒ½é™åˆ¶ä¸ºåªè¿”å›<code>T</code>ï¼ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯<code>Array</code>ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Array</span>&lt;<span class="hljs-type">T</span>&gt;</span>(<span class="hljs-keyword">val</span> size: <span class="hljs-built_in">Int</span>) &#123;<br>    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">get</span><span class="hljs-params">(index: <span class="hljs-type">Int</span>)</span></span>: T &#123; â€¦â€¦ &#125;<br>    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">set</span><span class="hljs-params">(index: <span class="hljs-type">Int</span>, value: <span class="hljs-type">T</span>)</span></span> &#123; â€¦â€¦ &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯¥ç±»åœ¨<code>T</code>ä¸Šæ—¢ä¸èƒ½æ˜¯åå˜çš„ä¹Ÿä¸èƒ½æ˜¯é€†å˜çš„ã€‚è¿™é€ æˆäº†ä¸€äº›ä¸çµæ´»æ€§ã€‚è€ƒè™‘ä¸‹è¿°å‡½æ•°ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">copy</span><span class="hljs-params">(from: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">Any</span>&gt;, to: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">Any</span>&gt;)</span></span> &#123;<br>    assert(from.size == to.size)<br>    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> from.indices)<br>        to[i] = from[i]<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°åº”è¯¥å°†é¡¹ç›®ä»ä¸€ä¸ªæ•°ç»„å¤åˆ¶åˆ°å¦ä¸€ä¸ªæ•°ç»„ã€‚è®©æˆ‘ä»¬å°è¯•åœ¨å®è·µä¸­åº”ç”¨å®ƒï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> ints: Array&lt;<span class="hljs-built_in">Int</span>&gt; = arrayOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br><span class="hljs-keyword">val</span> any = Array&lt;Any&gt;(<span class="hljs-number">3</span>) &#123; <span class="hljs-string">&quot;&quot;</span> &#125; <br>copy(ints, any)<br><span class="hljs-comment">//   ^ å…¶ç±»å‹ä¸º Array&lt;Int&gt; ä½†æ­¤å¤„æœŸæœ› Array&lt;Any&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬é‡åˆ°åŒæ ·ç†Ÿæ‚‰çš„é—®é¢˜ï¼š<code>Array&lt;T&gt;</code>åœ¨<code>T</code>ä¸Šæ˜¯<strong>ä¸å‹å˜</strong>çš„ï¼Œå› æ­¤<code>Array&lt;Int&gt;</code> ä¸ <code>Array&lt;Any&gt;</code> éƒ½ä¸æ˜¯å¦ä¸€ä¸ªçš„å­ç±»å‹ã€‚ä¸ºä»€ä¹ˆï¼Ÿ å†æ¬¡é‡å¤ï¼Œå› ä¸º<code>copy</code>å¯èƒ½æœ‰éé¢„æœŸè¡Œä¸ºï¼Œä¾‹å¦‚å®ƒå¯èƒ½å°è¯•å†™ä¸€ä¸ª<code>String</code>åˆ°<code>from</code>ï¼Œå¹¶ä¸”å¦‚æœæˆ‘ä»¬å®é™…ä¸Šä¼ é€’ä¸€ä¸ª<code>Int</code>çš„æ•°ç»„ï¼Œä»¥åä¼šæŠ›<code>ClassCastException</code>å¼‚å¸¸ã€‚<br>å¦‚æœéœ€è¦ç¦æ­¢<code>copy</code>åŠŸèƒ½å†™å…¥<code>from</code>ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œ:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">copy</span><span class="hljs-params">(from: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">out</span> <span class="hljs-type">Any</span>&gt;, to: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">Any</span>&gt;)</span></span> &#123; â€¦â€¦ &#125;<br></code></pre></td></tr></table></figure><p>è¿™å°±æ˜¯ç±»å‹æŠ•å½±ï¼šæ„å‘³ç€<code>from</code>ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè€Œæ˜¯ä¸€ä¸ª<code>å—é™åˆ¶</code>çš„<strong>ï¼ˆæŠ•å½±çš„ï¼‰</strong>æ•°ç»„ã€‚ åªå¯ä»¥è°ƒç”¨è¿”å›ç±»å‹ä¸ºç±»å‹å‚æ•°<code>T</code>çš„æ–¹æ³•ï¼Œå¦‚ä¸Šï¼Œè¿™æ„å‘³ç€åªèƒ½è°ƒç”¨<code>get()</code>ã€‚ è¿™å°±æ˜¯ä½¿ç”¨å¤„å‹å˜çš„ç”¨æ³•ï¼Œå¹¶ä¸”æ˜¯å¯¹åº”äº Java çš„ <code>Array&lt;? extends Object&gt;</code>, ä½†æ›´ç®€å•ã€‚</p><p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨<code>in</code>æŠ•å½±ä¸€ä¸ªç±»å‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fill</span><span class="hljs-params">(dest: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">in</span> <span class="hljs-type">String</span>&gt;, value: <span class="hljs-type">String</span>)</span></span> &#123; â€¦â€¦ &#125;<br></code></pre></td></tr></table></figure><p><code>Array&lt;in String&gt;</code> å¯¹åº”äº Java çš„<code>Array&lt;? super String&gt;</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥ä¼ é€’ä¸€ä¸ª<code>CharSequence</code>æ•°ç»„æˆ–ä¸€ä¸ª<code>Object</code>æ•°ç»„ç»™<code>fill()</code>å‡½æ•°ã€‚<br><strong>ä»¥ä¸Šä¿¡æ¯æ¥è‡ª <a href="(https://book.kotlincn.net/text/generics.html)">kotlin ä¸­æ–‡ç½‘</a></strong></p><h4 id="æ˜ŸæŠ•å½±"><a href="#æ˜ŸæŠ•å½±" class="headerlink" title="æ˜ŸæŠ•å½±"></a>æ˜ŸæŠ•å½±</h4><p>æœ‰æ—¶ä½ æƒ³è¯´ï¼Œä½ å¯¹ç±»å‹å‚æ•°ä¸€æ— æ‰€çŸ¥ï¼Œä½†ä»ç„¶å¸Œæœ›ä»¥å®‰å…¨çš„æ–¹å¼ä½¿ç”¨å®ƒã€‚ è¿™é‡Œçš„å®‰å…¨æ–¹å¼æ˜¯å®šä¹‰æ³›å‹ç±»å‹çš„è¿™ç§æŠ•å½±ï¼Œè¯¥æ³›å‹ç±»å‹çš„æ¯ä¸ªå…·ä½“å®ä¾‹åŒ–éƒ½ä¼šæ˜¯è¯¥æŠ•å½±çš„å­ç±»å‹ã€‚</p><p>Kotlin ä¸ºæ­¤æä¾›äº†æ‰€è°“çš„<strong>æ˜ŸæŠ•å½±</strong>è¯­æ³•ï¼š</p><ul><li>å¯¹äº<code>Foo &lt;out T : TUpper&gt;</code>ï¼Œå…¶ä¸­<code>T</code>æ˜¯ä¸€ä¸ªå…·æœ‰ä¸Šç•Œ<code>TUpper</code>çš„åå˜ç±»å‹å‚æ•°ï¼Œ<code>Foo &lt;*&gt;</code>ç­‰ä»·äº<code>Foo &lt;out TUpper&gt;</code>ã€‚ æ„å‘³ç€å½“<code>T</code>æœªçŸ¥æ—¶ï¼Œä½ å¯ä»¥å®‰å…¨åœ°ä»<code>Foo &lt;*&gt;</code>è¯»å–<code>TUpper</code>çš„å€¼ã€‚</li><li>å¯¹äº<code>Foo &lt;in T&gt;</code>ï¼Œå…¶ä¸­<code>T</code>æ˜¯ä¸€ä¸ªé€†å˜ç±»å‹å‚æ•°ï¼Œ<code>Foo &lt;*&gt;</code>ç­‰ä»·äº<code>Foo &lt;in Nothing&gt;</code>ã€‚ æ„å‘³ç€å½“<code>T</code>æœªçŸ¥æ—¶ï¼Œ æ²¡æœ‰ä»€ä¹ˆå¯ä»¥ä»¥å®‰å…¨çš„æ–¹å¼å†™å…¥<code>Foo &lt;*&gt;</code>ã€‚</li><li>å¯¹äº<code>Foo &lt;T : TUpper&gt;</code>ï¼Œå…¶ä¸­<code>T</code>æ˜¯ä¸€ä¸ªå…·æœ‰ä¸Šç•Œ<code>TUpper</code>çš„ä¸å‹å˜ç±»å‹å‚æ•°,<code>Foo&lt;*&gt;</code>å¯¹äºè¯»å–å€¼æ—¶ç­‰ä»·äº<code>Foo&lt;out TUpper&gt;</code> è€Œå¯¹äºå†™å€¼æ—¶ç­‰ä»·äº<code>Foo&lt;in Nothing&gt;</code>ã€‚</li></ul><p>å¦‚æœæ³›å‹ç±»å‹å…·æœ‰å¤šä¸ªç±»å‹å‚æ•°ï¼Œåˆ™æ¯ä¸ªç±»å‹å‚æ•°éƒ½å¯ä»¥å•ç‹¬æŠ•å½±ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœç±»å‹è¢«å£°æ˜ä¸º interface Function &lt;in T, out U&gt;ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ˜ŸæŠ•å½±ï¼š</p><ul><li><code>Function&lt;*, String&gt;</code> è¡¨ç¤º<code>Function&lt;in Nothing, String&gt;</code>ã€‚</li><li><code>Function&lt;Int, *&gt;</code> è¡¨ç¤º<code>Function&lt;Int, out Any?&gt;</code>ã€‚</li><li><code>Function&lt;*, *&gt;</code> è¡¨ç¤º<code>Function&lt;in Nothing, out Any?&gt;</code>ã€‚</li></ul><p><strong>ä»¥ä¸Šä¿¡æ¯æ¥è‡ª <a href="(https://book.kotlincn.net/text/generics.html)">kotlin ä¸­æ–‡ç½‘</a></strong></p><h4 id="æ³›å‹æ–¹æ³•"><a href="#æ³›å‹æ–¹æ³•" class="headerlink" title="æ³›å‹æ–¹æ³•"></a>æ³›å‹æ–¹æ³•</h4><p>ä¸ä»…ç±»å¯ä»¥æœ‰ç±»å‹å‚æ•°ã€‚å‡½æ•°ä¹Ÿå¯ä»¥æœ‰ã€‚ç±»å‹å‚æ•°è¦æ”¾åœ¨å‡½æ•°åç§°ä¹‹å‰ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">singletonList</span><span class="hljs-params">(item: <span class="hljs-type">T</span>)</span></span>: List&lt;T&gt; &#123;<br>    <span class="hljs-comment">// â€¦â€¦</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> T.<span class="hljs-title">basicToString</span><span class="hljs-params">()</span></span>: String &#123; <span class="hljs-comment">// æ‰©å±•å‡½æ•°</span><br>    <span class="hljs-comment">// â€¦â€¦</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¦è°ƒç”¨æ³›å‹å‡½æ•°ï¼Œåœ¨è°ƒç”¨å¤„å‡½æ•°åä¹‹åæŒ‡å®šç±»å‹å‚æ•°å³å¯ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> l = singletonList&lt;<span class="hljs-built_in">Int</span>&gt;(<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœç•¥èƒ½å¤Ÿä»ä¸Šä¸‹æ–‡ä¸­æ¨æ–­å‡ºæ¥çš„ç±»å‹å‚æ•°ï¼Œæ‰€ä»¥ä»¥ä¸‹ç¤ºä¾‹åŒæ ·é€‚ç”¨ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> l = singletonList(<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><h4 id="æ³›å‹çº¦æŸ"><a href="#æ³›å‹çº¦æŸ" class="headerlink" title="æ³›å‹çº¦æŸ"></a>æ³›å‹çº¦æŸ</h4><p>èƒ½å¤Ÿæ›¿æ¢ç»™å®šç±»å‹å‚æ•°çš„æ‰€æœ‰å¯èƒ½ç±»å‹çš„é›†åˆå¯ä»¥ç”±<strong>æ³›å‹çº¦æŸ</strong>é™åˆ¶ã€‚<br>æœ€å¸¸è§çš„çº¦æŸç±»å‹æ˜¯ä¸Šç•Œï¼Œä¸Javaçš„<code>extends</code>å…³é”®å­—å¯¹åº”ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : Comparable&lt;T&gt;</span>&gt; <span class="hljs-title">sort</span><span class="hljs-params">(list: <span class="hljs-type">List</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> &#123;  â€¦â€¦ &#125;<br></code></pre></td></tr></table></figure><p>å†’å·ä¹‹åæŒ‡å®šçš„ç±»å‹æ˜¯ä¸Šç•Œï¼Œè¡¨æ˜åªæœ‰<code>Comparable&lt;T&gt;</code>çš„å­ç±»å‹å¯ä»¥æ›¿ä»£<code>T</code>ã€‚ ä¾‹å¦‚ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">sort(listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)) <span class="hljs-comment">// OKã€‚Int æ˜¯ Comparable&lt;Int&gt; çš„å­ç±»å‹</span><br>sort(listOf(HashMap&lt;<span class="hljs-built_in">Int</span>, String&gt;())) <span class="hljs-comment">// é”™è¯¯ï¼šHashMap&lt;Int, String&gt; ä¸æ˜¯ Comparable&lt;HashMap&lt;Int, String&gt;&gt; çš„å­ç±»å‹</span><br></code></pre></td></tr></table></figure><p>é»˜è®¤çš„ä¸Šç•Œï¼ˆå¦‚æœæ²¡æœ‰å£°æ˜ï¼‰æ˜¯ Any?ã€‚åœ¨å°–æ‹¬å·ä¸­åªèƒ½æŒ‡å®šä¸€ä¸ªä¸Šç•Œã€‚ å¦‚æœåŒä¸€ç±»å‹å‚æ•°éœ€è¦å¤šä¸ªä¸Šç•Œï¼Œéœ€è¦ä¸€ä¸ªå•ç‹¬çš„ where-å­å¥ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">copyWhenGreater</span><span class="hljs-params">(list: <span class="hljs-type">List</span>&lt;<span class="hljs-type">T</span>&gt;, threshold: <span class="hljs-type">T</span>)</span></span>: List&lt;String&gt;<br>    <span class="hljs-keyword">where</span> T : CharSequence,<br>          T : Comparable&lt;T&gt; &#123;<br>    <span class="hljs-keyword">return</span> list.filter &#123; it &gt; threshold &#125;.map &#123; it.toString() &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰€ä¼ é€’çš„ç±»å‹å¿…é¡»åŒæ—¶æ»¡è¶³<code>where</code>å­å¥çš„æ‰€æœ‰æ¡ä»¶ã€‚åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œç±»å‹<code>T</code>å¿…é¡»<strong>æ—¢å®ç°äº† CharSequence ä¹Ÿå®ç°äº† Comparable</strong>ã€‚<br>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œwhere å­å¥åé¢çš„ç¬¬ä¸€ä¸ªç±»å‹å¯ä»¥æ˜¯æ¥å£ä¹Ÿå¯ä»¥æ˜¯æŠ½è±¡ç±»ã€å®ç°ç±»ï¼Œåç»­çš„ç±»å‹åªèƒ½æ˜¯æ¥å£ã€‚åœ¨ Java ä¸­ä¹Ÿä¸€æ ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyInterface</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAbstractClass</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> &lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">MyInterface</span> &amp; MyAbstractClass&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">(T t)</span>&#123; <span class="hljs-comment">//errpr</span><br>    t.test();<br>&#125;<br><span class="hljs-keyword">public</span> &lt;T <span class="hljs-keyword">extends</span>  <span class="hljs-title class_">MyAbstractClass</span> &amp; MyInterface &gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">(T t)</span>&#123;<br>    t.test();<br>&#125;<br>    <br></code></pre></td></tr></table></figure><p>åŸå› å°±æ˜¯ java ä¸­ä¸å¯ä»¥å¤šç»§æ‰¿ä½†å¯ä»¥å¤šå®ç°</p><h4 id="UnsafeVariance"><a href="#UnsafeVariance" class="headerlink" title="@UnsafeVariance"></a>@UnsafeVariance</h4><p>å·®ç‚¹å¿˜äº†è¿™ä¸œè¥¿ï¼Œè¿™ä¸ªæ³¨è§£å°±æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨æˆ‘çŸ¥é“æˆ‘åœ¨åšä»€ä¹ˆï¼Œå¹¶ä¸”ä¿è¯ä¸ä¼šå‡ºé—®é¢˜ï¼Œå¿½ç•¥åå˜å’Œé€†å˜çš„çº¦æŸå°±å¥½äº†<br>æ¯”å¦‚ kotlin ä¸­çš„<code>Collection</code>è¿™ä¸ªç±»ä¸­çš„<code>contains</code>ã€<code>containsAll</code>æ–¹æ³•</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Collection</span>&lt;<span class="hljs-type">out E</span>&gt; : <span class="hljs-type">Iterable</span>&lt;<span class="hljs-type">E</span>&gt; </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">contains</span><span class="hljs-params">(element: @<span class="hljs-type">UnsafeVariance</span> <span class="hljs-type">E</span>)</span></span>: <span class="hljs-built_in">Boolean</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">containsAll</span><span class="hljs-params">(elements: <span class="hljs-type">Collection</span>&lt;@<span class="hljs-type">UnsafeVariance</span> <span class="hljs-type">E</span>&gt;)</span></span>: <span class="hljs-built_in">Boolean</span><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>å¯¹äºåå˜çš„ç±»å‹ï¼Œé€šå¸¸æˆ‘ä»¬æ˜¯ä¸å…è®¸å°†æ³›å‹ç±»å‹ä½œä¸ºä¼ å…¥å‚æ•°çš„ç±»å‹çš„ï¼Œæˆ–è€…è¯´ï¼Œå¯¹äºåå˜ç±»å‹ï¼Œæˆ‘ä»¬é€šå¸¸æ˜¯ä¸å…è®¸å…¶æ¶‰åŠæ³›å‹å‚æ•°çš„éƒ¨åˆ†è¢«æ”¹å˜çš„ã€‚<br>è¿™ä¹Ÿå¾ˆå®¹æ˜“è§£&gt;é‡Šä¸ºä»€ä¹ˆ MutableCollection æ˜¯ä¸å˜çš„ï¼Œè€Œ Collection æ˜¯åå˜çš„ï¼Œå› ä¸ºåœ¨ Kotlin å½“ä¸­ï¼Œå‰è€…æ˜¯å¯è¢«ä¿®æ”¹çš„ï¼Œåè€…æ˜¯ä¸å¯è¢«ä¿®æ”¹çš„ã€‚<br>é€†å˜çš„æƒ…å½¢æ­£å¥½ç›¸åï¼Œå³ä¸å¯ä»¥å°†æ³›å‹å‚æ•°ä½œä¸ºæ–¹æ³•çš„è¿”å›å€¼ã€‚</p></blockquote><p>æ¯”å¦‚è¿™ç§æƒ…å½¢ï¼Œä¸ºäº†è®©ç¼–è¯‘å™¨æ”¾è¿‡ä¸€é©¬ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ @UnsafeVariance æ¥å‘Šè¯‰ç¼–è¯‘å™¨ï¼šâ€œæˆ‘çŸ¥é“æˆ‘åœ¨å¹²å•¥ï¼Œä¿è¯ä¸ä¼šå‡ºé”™ï¼Œä½ ä¸ç”¨æ‹…å¿ƒâ€ã€‚<br><strong>ä»¥ä¸Šä¿¡æ¯æ¥è‡ª<a href="https://zhuanlan.zhihu.com/p/143380842">æ·±å…¥è§£æKotlin æ³›å‹</a></strong></p><h4 id="reified-å…³é”®å­—"><a href="#reified-å…³é”®å­—" class="headerlink" title="reified å…³é”®å­—"></a>reified å…³é”®å­—</h4><p>ç”±äºå­˜åœ¨ç±»å‹æ“¦é™¤ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•åœ¨è¿è¡Œæ—¶è·å–æ³›å‹çš„å…·ä½“ç±»å‹ï¼Œæœ‰äº›æ“ä½œæ— æ³•å®ç°ï¼Œæ¯”å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">testOne</span><span class="hljs-params">(Object param)</span>&#123;<br>    <span class="hljs-keyword">if</span>(param <span class="hljs-keyword">instanceof</span> T)&#123;<br>        System.out.println(<span class="hljs-string">&quot;T&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œåœ¨ kotlin ä¸­ä¹Ÿä¸è¡Œã€‚<br>ä½†åœ¨ java ä¸­æˆ‘ä»¬é€šå¸¸ä¼šä¼ å…¥ä¸€ä¸ª<code>Class&lt;T&gt;</code>æ¥åšç›¸åº”çš„æ“ä½œï¼Œåœ¨ kotlin ä¸­åŒæ ·ä¹Ÿå¯ä»¥ï¼Œä¸è¿‡ kotlin ä¸­æœ‰ä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ³•:ä½¿ç”¨<code>reified</code>é…åˆ<code>inline</code>æ¥å®ç°</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T&gt;</span> <span class="hljs-title">printIfTypeMatch</span><span class="hljs-params">(item: <span class="hljs-type">Any</span>)</span></span> &#123;<br>    <span class="hljs-keyword">if</span> (item <span class="hljs-keyword">is</span> T) &#123; <span class="hljs-comment">// ğŸ‘ˆ è¿™é‡Œå°±ä¸ä¼šåœ¨æç¤ºé”™è¯¯äº†</span><br>        println(item)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ç»å¸¸ç”¨çš„ gsonè§£ææ•°æ®ã€ååºåˆ—åŒ–çš„æ—¶å€™ç»å¸¸é‡åˆ°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">fromJson</span><span class="hljs-params">(String json, Class&lt;T&gt; classOfT)</span> <span class="hljs-keyword">throws</span> JsonSyntaxException &#123; <br>    <br>&#125; <br></code></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ˜¯é€šè¿‡å¤šä¼ å…¥ä¸€ä¸ª<code>Class&lt;T&gt;</code>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨ kotlin ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰©å±•æ¥å˜åŒ–ä¸€ä¸‹</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T&gt;</span> Gson.<span class="hljs-title">fromJson</span><span class="hljs-params">(json: <span class="hljs-type">String</span>)</span></span>: T&#123; <br>     <span class="hljs-keyword">return</span> fromJson(json, T::<span class="hljs-keyword">class</span>.java) <br> &#125; <br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ç»™ Gson æ·»åŠ äº†ä¸€ä¸ªæ‰©å±•æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œé€šè¿‡<code>inline</code>å’Œ<code>reified</code>å…³é”®å­—å°†æ³›å‹<code>T</code>å˜æˆäº†ä¸€ä¸ªçœŸå®å¯ç”¨çš„ç±»å‹ï¼Œè¿™ä¸¤ä¸ªå…³é”®å­—ç¼ºä¸€ä¸å¯ã€‚è¿™é‡Œå°±ç®€å•çš„è®¤ä¸ºå†…è”æ–¹æ³•(inline)æ˜¯å°†æ–¹æ³•åœ¨ç¼–è¯‘æ—¶å¤åˆ¶åˆ°è°ƒç”¨å¤„ï¼Œä½¿å¾—æ³›å‹ T çš„ç±»å‹åœ¨ç¼–è¯‘æ—¶å°±å¯ä»¥ç¡®å®šã€‚å½“ç„¶è¿™ä¹ˆç†è§£ä¸æ˜¯ç‰¹åˆ«æ­£ç¡®ã€‚åé¢å­¦åˆ°<code>inline</code>ã€<code>noinline</code>ã€<code>crossinline</code>è¿™å‡ ä¸ªå…³é”®å­—çš„æ—¶å€™å†è¯´å§</p><p>å‚è€ƒï¼š</p><p><a href="https://book.kotlincn.net/text/generics.html">æ³›å‹ï¼šinã€outã€where</a><br><a href="https://kotlinlang.org/docs/generics.html">Generics: in, out, where</a><br><a href="https://ethanhua.github.io/2018/01/09/genericity/">æ·±å…¥ç†è§£Javaå’ŒKotlinä¸­çš„æ³›å‹</a><br><a href="https://zhuanlan.zhihu.com/p/143380842">æ·±å…¥è§£æKotlin æ³›å‹</a></p><hr><p>å·²å­¦ä¹ ï¼š</p><ul><li><p>æ‰©å±•</p><ul><li><input type='checkbox' disabled='true' checked>æ‰©å±•å‡½æ•°</input></li><li><input type='checkbox' disabled='true' checked>æ‰©å±•å±æ€§</input></li><li><input type='checkbox' disabled='true' checked>ä½œç”¨åŸŸ</input></li></ul></li><li><p>å‡½æ•°ç±»å‹</p><ul><li><input type='checkbox' disabled='true' checked>å¸¦æœ‰æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹</input></li><li><input type='checkbox' disabled='true' checked>Lambdaè¡¨è¾¾å¼</input></li><li><input type='checkbox' disabled='true' checked>SAM è½¬æ¢</input></li></ul></li><li><p>æ³›å‹</p><ul><li><input type='checkbox' disabled='true' checked>é€†å˜</input></li><li><input type='checkbox' disabled='true' checked>åå˜</input></li><li><input type='checkbox' disabled='true' checked>ç±»å‹æŠ•å½±</input></li><li><input type='checkbox' disabled='true' checked>æ˜ŸæŠ•å½±</input></li><li><input type='checkbox' disabled='true' checked>æ³›å‹çº¦æŸ</input></li></ul></li><li><p>å…³é”®å­—</p><ul><li><input type='checkbox' disabled='true' checked>ä½œç”¨åŸŸå‡½æ•°ï¼šwithã€letã€runã€applyã€also</input></li></ul></li></ul><p>æœªå­¦ä¹ ï¼š</p><ul><li><p>å…³é”®å­—</p><ul><li>object</li><li>Unit</li><li>Nothing</li><li>inline,noinline,crossinline</li></ul></li><li><p>å§”æ‰˜</p><ul><li>å§”æ‰˜ç±»</li><li>å§”æ‰˜å±æ€§</li><li>è‡ªå®šä¹‰å§”æ‰˜</li></ul></li><li><p>åç¨‹</p><ul><li>å¯åŠ¨</li><li>æŒ‚èµ·</li><li>Job</li><li>Context</li><li>Channel</li><li>Flow</li><li>select</li><li>å¹¶å‘ã€å¼‚å¸¸</li><li>launch</li><li>Dispatchers</li><li>CoroutineScope</li></ul></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Kotlin</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kotlinä½œç”¨åŸŸå‡½æ•°:runã€letã€alsoã€applyã€with</title>
    <link href="/2024/04/28/kotlin%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%87%BD%E6%95%B0-run%E3%80%81let%E3%80%81also%E3%80%81apply%E3%80%81with/"/>
    <url>/2024/04/28/kotlin%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%87%BD%E6%95%B0-run%E3%80%81let%E3%80%81also%E3%80%81apply%E3%80%81with/</url>
    
    <content type="html"><![CDATA[<p>åˆšå¼€å§‹å­¦ä¹  kotlin çš„æ—¶å€™ï¼Œå¯¹äºè¿™äº›ä½œç”¨åŸŸå‡½æ•°ä¸€å¤´é›¾æ°´ï¼Œæä¸æ˜ç™½ä¸ºä»€ä¹ˆè¦å¼„å‡ºæ¥è¿™ä¹ˆå¤šä¸œè¥¿ã€‚ç°åœ¨æ¥çœ‹çœ‹ä»–ä»¬å…·ä½“çš„åŒºåˆ«ä»¥åŠé€‚ç”¨çš„åœºæ™¯ã€‚<br>Kotlin æ ‡å‡†åº“åŒ…å«å‡ ä¸ªå‡½æ•°ï¼Œå®ƒä»¬çš„å”¯ä¸€ç›®çš„æ˜¯åœ¨å¯¹è±¡çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œä»£ç å—ã€‚ å½“å¯¹ä¸€ä¸ªå¯¹è±¡è°ƒç”¨è¿™æ ·çš„å‡½æ•°å¹¶æä¾›ä¸€ä¸ª<code>lambdaè¡¨è¾¾å¼</code>æ—¶ï¼Œå®ƒä¼šå½¢æˆä¸€ä¸ªä¸´æ—¶ä½œç”¨åŸŸã€‚åœ¨æ­¤ä½œç”¨åŸŸä¸­ï¼Œå¯ä»¥è®¿é—®è¯¥å¯¹è±¡è€Œæ— éœ€å…¶åç§°ã€‚è¿™äº›å‡½æ•°ç§°ä¸ºä½œç”¨åŸŸå‡½æ•°ã€‚ å…±æœ‰ä»¥ä¸‹äº”ç§ï¼š<code>let</code>ã€<code>run</code>ã€<code>with</code>ã€<code>apply</code>ä»¥åŠ<code>also</code>ã€‚<br>åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆæŠŠä» kotlin å®˜æ–¹ä¸Šæ‰’æ‹‰ä¸‹æ¥çš„ç»“è®ºæ”¾è¿™é‡Œ</p><span id="more"></span><p><a href="https://book.kotlincn.net/text/scope-functions.html">ä½œç”¨åŸŸå‡½æ•°ä¸­æ–‡ç‰ˆ</a><br><a href="https://kotlinlang.org/docs/scope-functions.html">ä½œç”¨åŸŸå‡½æ•°è‹±æ–‡ç‰ˆ</a></p><h3 id="æ€»ç»“åœ¨å‰é¢"><a href="#æ€»ç»“åœ¨å‰é¢" class="headerlink" title="æ€»ç»“åœ¨å‰é¢"></a>æ€»ç»“åœ¨å‰é¢</h3><p>æ–‡ç« å¤ªé•¿å¤ªå•°å—¦ï¼Œç›´æ¥çœ‹è¿™é‡Œçš„ç»“è®ºï¼š</p><table><thead><tr><th>å‡½æ•°</th><th>å¯¹è±¡å¼•ç”¨</th><th>è¿”å›å€¼</th><th>æ˜¯å¦æ˜¯æ‰©å±•å‡½æ•°</th></tr></thead><tbody><tr><td>let</td><td>it</td><td>Lambdaè¡¨è¾¾å¼ç»“æœ</td><td>æ˜¯</td></tr><tr><td>run</td><td>this</td><td>Lambdaè¡¨è¾¾å¼ç»“æœ</td><td>æ˜¯</td></tr><tr><td>run</td><td>-</td><td>Lambdaè¡¨è¾¾å¼ç»“æœ</td><td>ä¸æ˜¯ï¼šè°ƒç”¨æ— éœ€ä¸Šä¸‹æ–‡å¯¹è±¡</td></tr><tr><td>with</td><td>this</td><td>Lambdaè¡¨è¾¾å¼ç»“æœ</td><td>ä¸æ˜¯ï¼šæŠŠä¸Šä¸‹æ–‡å¯¹è±¡å½“åšå‚æ•°</td></tr><tr><td>apply</td><td>this</td><td>ä¸Šä¸‹æ–‡å¯¹è±¡</td><td>æ˜¯</td></tr><tr><td>also</td><td>it</td><td>ä¸Šä¸‹æ–‡å¯¹è±¡</td><td>æ˜¯</td></tr></tbody></table><p>ä»¥ä¸‹æ˜¯æ ¹æ®é¢„æœŸç›®çš„é€‰æ‹©ä½œç”¨åŸŸå‡½æ•°çš„ç®€çŸ­æŒ‡å—ï¼š</p><ul><li>å¯¹ä¸€ä¸ªéç©ºï¼ˆnon-nullï¼‰å¯¹è±¡æ‰§è¡Œ lambda è¡¨è¾¾å¼ï¼šlet</li><li>å°†è¡¨è¾¾å¼ä½œä¸ºå˜é‡å¼•å…¥ä¸ºå±€éƒ¨ä½œç”¨åŸŸä¸­ï¼šlet</li><li>å¯¹è±¡é…ç½®ï¼šapply</li><li>å¯¹è±¡é…ç½®å¹¶ä¸”è®¡ç®—ç»“æœï¼šrun</li><li>åœ¨éœ€è¦è¡¨è¾¾å¼çš„åœ°æ–¹è¿è¡Œè¯­å¥ï¼šéæ‰©å±•çš„ run</li><li>é™„åŠ æ•ˆæœï¼šalso</li><li>ä¸€ä¸ªå¯¹è±¡çš„ä¸€ç»„å‡½æ•°è°ƒç”¨ï¼šwith<br>ä¸åŒä½œç”¨åŸŸå‡½æ•°çš„ä½¿ç”¨åœºæ™¯å­˜åœ¨é‡å ï¼Œå¯ä»¥æ ¹æ®é¡¹ç›®æˆ–å›¢é˜Ÿä¸­ä½¿ç”¨çš„ç‰¹å®šçº¦å®šæ¥é€‰æ‹©ä½¿ç”¨å“ªäº›å‡½æ•°ã€‚</li></ul><p><font color='red'>è™½ç„¶ä½œç”¨åŸŸå‡½æ•°å¯ä»¥è®©ä»£ç æ›´åŠ ç®€æ´ï¼Œä½†æ˜¯è¦é¿å…è¿‡åº¦ä½¿ç”¨å®ƒä»¬ï¼šè¿™ä¼šä½¿ä»£ç éš¾ä»¥é˜…è¯»å¹¶å¯èƒ½å¯¼è‡´é”™è¯¯ã€‚ æˆ‘ä»¬è¿˜å»ºè®®é¿å…åµŒå¥—ä½œç”¨åŸŸå‡½æ•°ï¼ŒåŒæ—¶é“¾å¼è°ƒç”¨å®ƒä»¬æ—¶è¦å°å¿ƒï¼šå› ä¸ºå¾ˆå®¹æ˜“æ··æ·†å½“å‰ä¸Šä¸‹æ–‡å¯¹è±¡ä¸<code>this</code>æˆ–<code>it</code>çš„å€¼ã€‚</font></p><h3 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h3><p>å‡å¦‚æˆ‘ä»¬æœ‰è¿™ä¹ˆä¸€ä¸ªæ•°æ®ç±»</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">data</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span></span>(<span class="hljs-keyword">var</span> name: String, <span class="hljs-keyword">var</span> price: <span class="hljs-built_in">Int</span>) &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">changePrice</span><span class="hljs-params">(price: <span class="hljs-type">Int</span>)</span></span> &#123;<br>        <span class="hljs-keyword">this</span>.price = price<br>    &#125;<br>&#125;<br><span class="hljs-keyword">val</span> book = Book(<span class="hljs-string">&quot;book name&quot;</span>, <span class="hljs-number">68</span>)<br></code></pre></td></tr></table></figure><h4 id="å‡½æ•°å£°æ˜"><a href="#å‡½æ•°å£°æ˜" class="headerlink" title="å‡½æ•°å£°æ˜"></a>å‡½æ•°å£°æ˜</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> T.<span class="hljs-title">also</span><span class="hljs-params">(block: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span>: T<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> T.<span class="hljs-title">apply</span><span class="hljs-params">(block: <span class="hljs-type">T</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span>: T <br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T, R&gt;</span> T.<span class="hljs-title">let</span><span class="hljs-params">(block: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">R</span>)</span></span>: R<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T, R&gt;</span> T.<span class="hljs-title">run</span><span class="hljs-params">(block: <span class="hljs-type">T</span>.() -&gt; <span class="hljs-type">R</span>)</span></span>: R<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;R&gt;</span> <span class="hljs-title">run</span><span class="hljs-params">(block: () -&gt; <span class="hljs-type">R</span>)</span></span>: R<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T, R&gt;</span> <span class="hljs-title">with</span><span class="hljs-params">(receiver: <span class="hljs-type">T</span>, block: <span class="hljs-type">T</span>.() -&gt; <span class="hljs-type">R</span>)</span></span>: R<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æŠŠçœ‹èµ·æ¥ç›¸è¿‘çš„ä½œç”¨åŸŸå‡½æ•°çš„å£°æ˜æ”¾åœ¨ä¸€å—å¯¹æ¯”ç€çœ‹ï¼Œçœ‹åˆ°è¿™é‡Œå°±æ¸…æ¥šäº†çš„å°±ä¸è¦å¾€ä¸‹çœ‹äº†ï¼Œçœ‹äº†ä¹Ÿæ˜¯æµªè´¹æ—¶é—´ã€‚</p><h4 id="also"><a href="#also" class="headerlink" title="also"></a>also</h4><p>å‡½æ•°å£°æ˜</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> T.<span class="hljs-title">also</span><span class="hljs-params">(block: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span>: T<br></code></pre></td></tr></table></figure><p><code>also</code>å‡½æ•°æ˜¯å¯¹æ³›å‹ T çš„æ‰©å±•å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå‚æ•°ç±»å‹ä¸ºTã€æ— è¿”å›å€¼(è¿”å›å€¼ä¸ºUnitç±»å‹)çš„å‡½æ•°ï¼Œä¸”<code>also</code>å‡½æ•°çš„è¿”å›å€¼å°±æ˜¯è°ƒç”¨è€…ã€‚</p><ul><li>ä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸º lambda è¡¨è¾¾å¼çš„å‚æ•°ï¼ˆitï¼‰æ¥è®¿é—®ã€‚</li><li>è¿”å›å€¼æ˜¯ä¸Šä¸‹æ–‡å¯¹è±¡æœ¬èº«ã€‚</li></ul><p>å¯¹äºæ‰§è¡Œä¸€äº›å°†ä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸ºå‚æ•°çš„æ“ä½œå¾ˆæœ‰ç”¨ã€‚ å¯¹äºéœ€è¦å¼•ç”¨å¯¹è±¡è€Œä¸æ˜¯å…¶å±æ€§ä¸å‡½æ•°çš„æ“ä½œï¼Œæˆ–è€…ä¸æƒ³å±è”½æ¥è‡ªå¤–éƒ¨ä½œç”¨åŸŸçš„ this å¼•ç”¨æ—¶ï¼Œè¯·ä½¿ç”¨ alsoã€‚<br>å½“ä½ åœ¨ä»£ç ä¸­çœ‹åˆ° also æ—¶ï¼Œå¯ä»¥å°†å…¶ç†è§£ä¸º<strong>å¹¶ä¸”ç”¨è¯¥å¯¹è±¡æ‰§è¡Œä»¥ä¸‹æ“ä½œ</strong></p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> alsoResult = book.also &#123;<br>    it.changePrice(<span class="hljs-number">20</span>)<br>    it.name = <span class="hljs-string">&quot;alsoResult&quot;</span><br>&#125;<br>println(<span class="hljs-string">&quot;alsoResult <span class="hljs-variable">$alsoResult</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæ‰“å°ç»“æœæ˜¯<code>alsoResult Book(name=alsoResult, price=20)</code>,çœ‹æºç çš„è¯ï¼Œå¯ä»¥ç®€å•çš„é‡Œé¢ä¸ºè°ƒç”¨äº†ä¸€ä¸‹ä¼ å…¥çš„å‡½æ•°ï¼Œç„¶åè¿”å›äº†è°ƒç”¨è€…</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> T.<span class="hljs-title">also</span><span class="hljs-params">(block: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span>: T &#123;<br>    contract &#123;<br>        callsInPlace(block, InvocationKind.EXACTLY_ONCE)<br>    &#125;<br>    block(<span class="hljs-keyword">this</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h4><p>å‡½æ•°å£°æ˜</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> T.<span class="hljs-title">apply</span><span class="hljs-params">(block: <span class="hljs-type">T</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span>: T<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å¾—å‡ºæ¥<code>apply</code>æ˜¯æ³›å‹ T çš„æ‰©å±•å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå¸¦æœ‰ T ç±»å‹æ¥æ”¶è€…çš„æ— å‚ã€æ— è¿”å›å€¼çš„å‡½æ•°ï¼Œå¹¶ä¸”<code>apply</code>å‡½æ•°è¿”å›å€¼å°±æ˜¯ T ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨è€…çš„ç±»å‹ã€‚å› ä¸ºè¿™é‡Œå‚æ•°ä¸­çš„ T æ˜¯ä½œä¸ºæ¥æ”¶è€…ç±»å‹ï¼Œè€Œä¸æ˜¯å‚æ•°ï¼Œæ‰€ä»¥åœ¨ä¼ å…¥çš„å‡½æ•°ä¸­éœ€è¦ç”¨<code>this</code>è€Œé<code>it</code>æ¥æŒ‡ä»£è°ƒç”¨è€…ã€‚<br>ç”¨æ³•å’Œ<code>also</code>ç›¸å·®æ— å‡ ï¼Œåªä¸è¿‡ä¸€ä¸ªæ˜¯æ¥æ”¶è€…ç±»å‹ï¼Œä¸€ä¸ªæ˜¯å‚æ•°ã€‚</p><ul><li>ä¸Šä¸‹æ–‡å¯¹è±¡ ä½œä¸ºæ¥æ”¶è€…ï¼ˆthisï¼‰æ¥è®¿é—®ã€‚</li><li>è¿”å›å€¼ æ˜¯ä¸Šä¸‹æ–‡å¯¹è±¡æœ¬èº«ã€‚</li></ul><p>å¯¹äºä¸è¿”å›å€¼ä¸”ä¸»è¦åœ¨æ¥æ”¶è€…ï¼ˆthisï¼‰å¯¹è±¡çš„æˆå‘˜ä¸Šè¿è¡Œçš„ä»£ç å—ä½¿ç”¨å®ƒã€‚applyæœ€å¸¸è§çš„ä½¿ç”¨åœºæ™¯æ˜¯ç”¨äºå¯¹è±¡é…ç½®ã€‚è¿™æ ·çš„è°ƒç”¨å¯ä»¥ç†è§£ä¸º<strong>å°†ä»¥ä¸‹èµ‹å€¼æ“ä½œåº”ç”¨äºå¯¹è±¡</strong>ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> applyResult = book.apply &#123;<br>    changePrice(<span class="hljs-number">200</span>)<br>    name = <span class="hljs-string">&quot;applyResult&quot;</span><br>&#125;<br>println(<span class="hljs-string">&quot;applyResult <span class="hljs-variable">$applyResult</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæ‰“å°çš„ç»“æœæ˜¯<code>applyResult Book(name=applyResult, price=200)</code>.<br>æºç ä¹Ÿå’Œ<code>also</code>å‡ ä¹ä¸€æ ·</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> T.<span class="hljs-title">also</span><span class="hljs-params">(block: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span>: T &#123;<br>    contract &#123;<br>        callsInPlace(block, InvocationKind.EXACTLY_ONCE)<br>    &#125;<br>    block(<span class="hljs-keyword">this</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="let"><a href="#let" class="headerlink" title="let"></a>let</h4><p>å‡½æ•°ç±»å‹å£°æ˜å¦‚ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T, R&gt;</span> T.<span class="hljs-title">let</span><span class="hljs-params">(block: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">R</span>)</span></span>: R<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œlet æ˜¯å¯¹æ³›å‹ T çš„æ‰©å±•å‡½æ•°ï¼Œè¯¥æ‰©å±•å‡½æ•°æ¥æ”¶ä¸€ä¸ªå‡½æ•°å‚æ•°ï¼Œå¹¶ä¸”å‡½æ•°å‚æ•°çš„æ¥æ”¶ä¸€ä¸ª T ç±»å‹çš„å‚æ•°ï¼Œä¸”è¿”å›å€¼æ˜¯ R ç±»å‹ï¼Œä¹Ÿæ˜¯<code>let</code>è¿™ä¸ªæ‰©å±•å‡½æ•°çš„è¿”å›å€¼ç±»å‹ã€‚</p><ul><li>ä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸º lambda è¡¨è¾¾å¼çš„å‚æ•°ï¼ˆitï¼‰æ¥è®¿é—®ã€‚</li><li>è¿”å›å€¼æ˜¯ lambda è¡¨è¾¾å¼çš„ç»“æœã€‚</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> letResult = book.let &#123;<br>    it.changePrice(<span class="hljs-number">100</span>)<br>    it.name = <span class="hljs-string">&quot;letResult&quot;</span><br>&#125;<br>println(<span class="hljs-string">&quot;letResult <span class="hljs-variable">$letResult</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¼ å…¥çš„æ˜¯ä¸€ä¸ª Lambda è¡¨è¾¾å¼ï¼Œå‰é¢è¯´è¿‡ï¼Œå¯¹äºå•å‚æ•°å€¼çš„Lambda è¡¨è¾¾å¼ï¼Œå‚æ•°ä¼šè¢«éšå¼å£°æ˜ä¸º<code>it</code>,å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªå…·åæ„ä¹‰çš„å˜é‡ï¼Œæ¯”å¦‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> letResult = book.let &#123; bookEntry: Book -&gt;<br>    bookEntry.changePrice(<span class="hljs-number">100</span>)<br>    bookEntry.name = <span class="hljs-string">&quot;letResult&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæ‰“å°çš„ç»“æœæ˜¯<code>letResult kotlin.Unit</code>ã€‚å› ä¸ºå¯¹äº Lambda è¡¨è¾¾å¼æ¥è®²ï¼Œå¦‚æœæœ€åä¸€æ¡è¯­å¥æ˜¯éèµ‹å€¼è¯­å¥ï¼Œåˆ™è¿”å›è¯¥è¯­å¥çš„å€¼ï¼›å¦‚æœæ˜¯èµ‹å€¼è¯­å¥ï¼Œåˆ™è¿”å› Unitã€‚<br>æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™æ¥è¿”å›æˆ‘ä»¬éœ€è¦çš„å€¼ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> letResult = book.let &#123;<br>    it<span class="hljs-comment">//è¿”å›å€¼å°±æ˜¯ä¼ å…¥çš„ book å¯¹è±¡</span><br>&#125;<br><span class="hljs-keyword">val</span> letResult = book.let &#123;<br>    <span class="hljs-number">1</span><span class="hljs-comment">//è¿”å›å€¼å°±æ˜¯1</span><br>&#125;<br><span class="hljs-keyword">val</span> letResult = book.let &#123;<br>     <span class="hljs-keyword">return</span><span class="hljs-symbol">@let</span> <span class="hljs-number">1</span><span class="hljs-comment">//ä¹‹å‰çš„æ–‡ç« ä¸­è¯´è¿‡çš„æ˜¾ç¤ºæŒ‡å®šè¿”å›å€¼ï¼Œæ˜¯ 1</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä»å¦å¤–ä¸€ä¸ªè§’åº¦çœ‹ï¼Œ<code>let</code>å’Œ <code>also</code>ã€<code>apply</code>ä¹Ÿå·®ä¸å¤šï¼Œåªä¸è¿‡å¤šäº†ä¸€ä¸ªè¿”å›å€¼ç±»å‹ï¼Œè¿”å›å€¼å°±æ˜¯ä¼ å…¥çš„ Lambda è¡¨è¾¾å¼çš„è¿”å›å€¼<br>æºç ä¹Ÿå·®ä¸äº†å¤šå°‘</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T, R&gt;</span> T.<span class="hljs-title">let</span><span class="hljs-params">(block: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">R</span>)</span></span>: R &#123;<br>    contract &#123;<br>        callsInPlace(block, InvocationKind.EXACTLY_ONCE)<br>    &#125;<br>    <span class="hljs-keyword">return</span> block(<span class="hljs-keyword">this</span>)<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>let å¯ç”¨äºåœ¨è°ƒç”¨é“¾çš„ç»“æœä¸Šè°ƒç”¨ä¸€ä¸ªæˆ–å¤šä¸ªå‡½æ•°ã€‚</li><li>let ç»å¸¸ç”¨äºæ‰§è¡ŒåŒ…å«éç©ºå€¼ä»£ç å—ã€‚å¦‚éœ€å¯¹éç©ºå¯¹è±¡æ‰§è¡Œæ“ä½œï¼Œ å¯å¯¹å…¶ä½¿ç”¨å®‰å…¨è°ƒç”¨æ“ä½œç¬¦<code>?.</code>å¹¶è°ƒç”¨ let åœ¨ lambda è¡¨è¾¾å¼ä¸­æ‰§è¡Œæ“ä½œã€‚</li></ul><h4 id="run"><a href="#run" class="headerlink" title="run"></a>run</h4><p><code>run</code>è¿™ä¸ªå‡½æ•°ç»™äº†ä¸¤ç§æ–¹å¼</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T, R&gt;</span> T.<span class="hljs-title">run</span><span class="hljs-params">(block: <span class="hljs-type">T</span>.() -&gt; <span class="hljs-type">R</span>)</span></span>: R<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;R&gt;</span> <span class="hljs-title">run</span><span class="hljs-params">(block: () -&gt; <span class="hljs-type">R</span>)</span></span>: R<br></code></pre></td></tr></table></figure><p>å…ˆçœ‹ç¬¬ä¸€ç§ï¼Œçœ‹èµ·æ¥å°±æ˜¯æŠŠ<code>let</code>ä¸­å‡½æ•°å‚æ•°ä¸­çš„ T ç±»å‹å‚æ•°æ”¹æˆäº†æ¥æ”¶è€…ç±»å‹ï¼Œä¹Ÿæ˜¯è¿”å› R ç±»å‹ï¼›è¿™å’Œ<code>apply</code>ä¸<code>also</code>çš„åŒºåˆ«æ˜¯ä¸€æ ·çš„ã€‚</p><ul><li>ä¸Šä¸‹æ–‡å¯¹è±¡ ä½œä¸ºæ¥æ”¶è€…ï¼ˆthisï¼‰æ¥è®¿é—®ã€‚</li><li>è¿”å›å€¼ æ˜¯ lambda è¡¨è¾¾å¼ç»“æœã€‚</li></ul><p>å½“ lambda è¡¨è¾¾å¼åŒæ—¶åˆå§‹åŒ–å¯¹è±¡å¹¶è®¡ç®—è¿”å›å€¼æ—¶ï¼Œrun å¾ˆæœ‰ç”¨ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> runResult = book.run &#123;<br>    name = <span class="hljs-string">&quot;runResult&quot;</span><br>    changePrice(<span class="hljs-number">110</span>)<br>    <span class="hljs-keyword">this</span> <span class="hljs-comment">//ä½œä¸ºè¿”å›å€¼</span><br>&#125;<br>println(<span class="hljs-string">&quot;runResult <span class="hljs-variable">$runResult</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>æºç æ˜¯è¿™æ ·çš„</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T, R&gt;</span> T.<span class="hljs-title">run</span><span class="hljs-params">(block: <span class="hljs-type">T</span>.() -&gt; <span class="hljs-type">R</span>)</span></span>: R &#123;<br>    contract &#123;<br>        callsInPlace(block, InvocationKind.EXACTLY_ONCE)<br>    &#125;<br>    <span class="hljs-keyword">return</span> block()<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¬¬äºŒç§</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> otherRunResult =  run &#123;<br>    Book(<span class="hljs-string">&quot;run&quot;</span>, <span class="hljs-number">120</span>) <span class="hljs-comment">//ä½œä¸ºè¿”å›å€¼</span><br>&#125;<br>println(<span class="hljs-string">&quot;otherRunResult <span class="hljs-variable">$otherRunResult</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>æºç </p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;R&gt;</span> <span class="hljs-title">run</span><span class="hljs-params">(block: () -&gt; <span class="hljs-type">R</span>)</span></span>: R &#123;<br>    contract &#123;<br>        callsInPlace(block, InvocationKind.EXACTLY_ONCE)<br>    &#125;<br>    <span class="hljs-keyword">return</span> block()<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¹Ÿæ²¡å•¥å¥½è¯´çš„ï¼Œåªä¸è¿‡æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰è¾“å…¥å‚æ•°ï¼Œåªæ˜¯å¯ä»¥ä½¿ä½ åœ¨éœ€è¦è¡¨è¾¾å¼çš„åœ°æ–¹å°±å¯ä»¥æ‰§è¡Œä¸€ä¸ªè¯­å¥ã€‚</p><h4 id="with"><a href="#with" class="headerlink" title="with"></a>with</h4><p>å‡½æ•°å£°æ˜</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T, R&gt;</span> <span class="hljs-title">with</span><span class="hljs-params">(receiver: <span class="hljs-type">T</span>, block: <span class="hljs-type">T</span>.() -&gt; <span class="hljs-type">R</span>)</span></span>: R<br></code></pre></td></tr></table></figure><p><code>with</code>å¹¶ä¸æ˜¯æ‰©å±•å‡½æ•°ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªT ç±»å‹çš„receiverï¼Œå¯ä»¥åœ¨ block ä¸­è®¿é—®è¿™ä¸ªreceiverçš„æ–¹æ³•å’Œå±æ€§ï¼Œ</p><ul><li>ä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸ºæ¥æ”¶è€…ï¼ˆthisï¼‰ä½¿ç”¨ã€‚</li><li>è¿”å›å€¼æ˜¯ lambda è¡¨è¾¾å¼ç»“æœã€‚</li></ul><p>å»ºè®®å½“ä¸éœ€è¦ä½¿ç”¨ lambda è¡¨è¾¾å¼ç»“æœæ—¶ï¼Œä½¿ç”¨ with æ¥è°ƒç”¨ä¸Šä¸‹æ–‡å¯¹è±¡ä¸Šçš„å‡½æ•°ã€‚ åœ¨ä»£ç ä¸­ï¼Œwith å¯ä»¥ç†è§£ä¸º<strong>å¯¹äºè¿™ä¸ªå¯¹è±¡ï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œ.</strong></p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> withResult = with(book) &#123;<br>    changePrice(<span class="hljs-number">300</span>)<br>    name = <span class="hljs-string">&quot;withResult&quot;</span><br>    <span class="hljs-keyword">this</span> <span class="hljs-comment">//ä½œä¸ºè¿”å›å€¼</span><br>&#125;<br>println(<span class="hljs-string">&quot;withResult <span class="hljs-variable">$withResult</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„æ‰“å°ç»“æœæ˜¯<code>withResult Book(name=withResult, price=300)</code></p><h3 id="å¦‚ä½•é€‰æ‹©"><a href="#å¦‚ä½•é€‰æ‹©" class="headerlink" title="å¦‚ä½•é€‰æ‹©"></a>å¦‚ä½•é€‰æ‹©</h3><p>è¿™é‡Œå†æ¬è¿ä¸€ä¸ªæ€»ç»“çš„è¡¨æ ¼</p><table>    <tr>         <th >å‡½æ•°å</th>         <th >ä½œç”¨</th>         <th >åº”ç”¨åœºæ™¯</th>         <th >å¤‡æ³¨</th>     </tr>    <tr>      <td>let</td>      <td rowspan="2">å®šä¹‰ä¸€ä¸ªå˜é‡åœ¨ç‰¹å®šä½œç”¨åŸŸå†…<br/>ç»Ÿä¸€åšåˆ¤ç©ºå¤„ç†</td>      <td rowspan="2">æ˜ç¡®ä¸€ä¸ªå˜é‡æ‰€å¤„ç‰¹å®šçš„ä½œç”¨åŸŸèŒƒå›´å†…å¯ä½¿ç”¨<br/>é’ˆå¯¹ä¸€ä¸ªå¯ç©ºå¯¹è±¡ç»Ÿä¸€åšåˆ¤ç©ºå¤„ç†</td>      <td rowspan="2">åŒºåˆ«åœ¨äºè¿”å›å€¼<br/>letå‡½æ•°ï¼šè¿”å›å€¼=æœ€åä¸€è¡Œ|returnçš„è¡¨è¾¾å¼<br/>alsoå‡½æ•°ï¼šè¿”å›å€¼=ä¼ å…¥å¯¹è±¡æœ¬èº«</td>    </tr>    <tr>      <td>also</td>    </tr>    <tr>      <td>with</td>      <td>è°ƒç”¨åŒä¸€ä¸ªå¯¹è±¡çš„å¤šä¸ªæ–¹æ³•|å±æ€§æ—¶ï¼Œå¯ä»¥çœå»å¯¹è±¡åï¼Œç›´æ¥è°ƒç”¨æ–¹æ³•ã€è®¿é—®å±æ€§</td>      <td>éœ€è¦å¤šæ¬¡è°ƒç”¨åŒä¸€ä¸ªå¯¹è±¡çš„å±æ€§|æ–¹æ³•</td>      <td>è¿”å›å€¼=æœ€åä¸€è¡Œ|returnè¡¨è¾¾å¼</td>    </tr>    <tr>      <td>run</td>      <td rowspan="2">ç»“åˆäº†let å‡½æ•°å’Œ with å‡½æ•°çš„ä½œç”¨</td>      <td>1.è°ƒç”¨åŒä¸€ä¸ªå¯¹è±¡çš„å¤šä¸ªæ–¹æ³•/å±æ€§æ—¶å¯ä»¥çœå»å¯¹è±¡åé‡å¤ï¼Œç›´æ¥è°ƒç”¨æ–¹æ³•å /å±æ€§å³å¯<br/>2.å®šä¹‰ä¸€ä¸ªå˜é‡åœ¨ç‰¹å®šä½œç”¨åŸŸå†…<br/>3.ç»Ÿä¸€åšåˆ¤ç©ºå¤„</</td>      <td>ä¼˜ç‚¹:é¿å…äº†letå‡½æ•°å¿…é¡»ä½¿ç”¨itå‚æ•°æ›¿ä»£å¯¹è±¡å¼¥è¡¥äº†withå‡½æ•°æ— æ³•åˆ¤ç©ºçš„ç¼ºç‚¹</td>    </tr>    <tr>      <td>apply</td>      <td>å¯¹è±¡å®ä¾‹åˆå§‹åŒ–æ—¶éœ€è¦å¯¹å¯¹è±¡ä¸­çš„å±æ€§è¿›è¡Œèµ‹å€¼ä¸”è¿”å›è¯¥å¯¹è±¡</td>      <td>äºŒè€…åŒºåˆ«åœ¨äºè¿”å›å€¼:<br/>runå‡½æ•°è¿”å›æœ€åä¸€è¡Œçš„å€¼|è¡¨è¾¾å¼<br/>applyå‡½æ•°è¿”å›ä¼ å…¥çš„å¯¹è±¡çš„æœ¬èº«</td>    <tr></table><h3 id="å¦å¤–ä¸€ä¸ªè§’åº¦çš„é€‰æ‹©"><a href="#å¦å¤–ä¸€ä¸ªè§’åº¦çš„é€‰æ‹©" class="headerlink" title="å¦å¤–ä¸€ä¸ªè§’åº¦çš„é€‰æ‹©"></a>å¦å¤–ä¸€ä¸ªè§’åº¦çš„é€‰æ‹©</h3><h4 id="it-or-this"><a href="#it-or-this" class="headerlink" title="it or this"></a>it or this</h4><p>æ¯ä¸ªä½œç”¨åŸŸå‡½æ•°éƒ½ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼ä¹‹ä¸€æ¥å¼•ç”¨ä¸Šä¸‹æ–‡å¯¹è±¡</p><ol><li>ä½œä¸º lambda è¡¨è¾¾å¼çš„æ¥æ”¶è€… ï¼ˆthisï¼‰</li><li>ä½œä¸º lambda è¡¨è¾¾å¼çš„å‚æ•°ï¼ˆitï¼‰</li></ol><p>ä¸¤è€…éƒ½æä¾›äº†åŒæ ·çš„åŠŸèƒ½ï¼Œ<code>run</code>ã€<code>with</code>ä»¥åŠ<code>apply</code>é€šè¿‡å…³é”®å­—<code>this</code>å°†ä¸Šä¸‹æ–‡å¯¹è±¡å¼•ç”¨ä¸º<code>lambda</code>è¡¨è¾¾å¼çš„æ¥æ”¶è€…ã€‚ å› æ­¤ï¼Œåœ¨å®ƒä»¬çš„<code>lambdaè¡¨è¾¾å¼</code>ä¸­å¯ä»¥åƒåœ¨æ™®é€šçš„ç±»å‡½æ•°ä¸­ä¸€æ ·è®¿é—®ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚åœ¨å¤§å¤šæ•°åœºæ™¯ï¼Œå½“ä½ è®¿é—®æ¥æ”¶è€…å¯¹è±¡æ—¶ä½ å¯ä»¥çœç•¥<code>this</code>ï¼Œ æ¥è®©ä½ çš„ä»£ç æ›´ç®€çŸ­ã€‚ ç›¸å¯¹åœ°ï¼Œå¦‚æœçœç•¥äº†<code>this</code>ï¼Œå°±å¾ˆéš¾åŒºåˆ†æ¥æ”¶è€…å¯¹è±¡çš„æˆå‘˜åŠå¤–éƒ¨å¯¹è±¡æˆ–å‡½æ•°ã€‚å› æ­¤ï¼Œå¯¹äºä¸»è¦å¯¹å¯¹è±¡çš„æˆå‘˜è¿›è¡Œæ“ä½œï¼ˆè°ƒç”¨å…¶å‡½æ•°æˆ–èµ‹å€¼å…¶å±æ€§ï¼‰çš„lambdaè¡¨è¾¾å¼ï¼Œ å»ºè®®å°†ä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸ºæ¥æ”¶è€…ï¼ˆthisï¼‰ã€‚<br>åè¿‡æ¥ï¼Œ<code>let</code>åŠ<code>also</code>å°†ä¸Šä¸‹æ–‡å¯¹è±¡å¼•ç”¨ä¸º<code>lambdaè¡¨è¾¾å¼å‚æ•°</code>ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šå‚æ•°åï¼Œå¯¹è±¡å¯ä»¥ç”¨éšå¼é»˜è®¤åç§°<code>it</code>è®¿é—®ã€‚<code>it</code>æ¯”<code>this</code>ç®€çŸ­ï¼Œå¸¦æœ‰<code>it</code>çš„è¡¨è¾¾å¼é€šå¸¸æ›´æ˜“è¯»ã€‚ä¸è¿‡ï¼Œå½“è°ƒç”¨å¯¹è±¡å‡½æ•°æˆ–å±æ€§æ—¶ï¼Œä¸èƒ½åƒ<code>this</code>è¿™æ ·éšå¼åœ°è®¿é—®å¯¹è±¡ã€‚ å› æ­¤ï¼Œå½“ä¸Šä¸‹æ–‡å¯¹è±¡åœ¨ä½œç”¨åŸŸä¸­ä¸»è¦ç”¨ä½œå‡½æ•°è°ƒç”¨ä¸­çš„å‚æ•°æ—¶ï¼Œé€šè¿‡<code>it</code>è®¿é—®ä¸Šä¸‹æ–‡å¯¹è±¡ä¼šæ›´å¥½ã€‚ åœ¨ä»£ç å—ä¸­ä½¿ç”¨å¤šä¸ªå˜é‡æ—¶ï¼Œ<code>it</code>ä¹Ÿæ›´å¥½ä¸€äº›ã€‚</p><h4 id="è¿”å›å€¼"><a href="#è¿”å›å€¼" class="headerlink" title="è¿”å›å€¼"></a>è¿”å›å€¼</h4><p>æ ¹æ®è¿”å›ç»“æœï¼Œä½œç”¨åŸŸå‡½æ•°å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸¤ç±»ï¼š</p><p>apply åŠ also è¿”å›ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚<br>letã€run åŠ with è¿”å› lambda è¡¨è¾¾å¼ç»“æœ.<br>apply åŠ also çš„è¿”å›å€¼æ˜¯ä¸Šä¸‹æ–‡å¯¹è±¡æœ¬èº«ã€‚å› æ­¤ï¼Œå®ƒä»¬å¯ä»¥ä½œä¸ºè¾…åŠ©æ­¥éª¤åŒ…å«åœ¨è°ƒç”¨é“¾ä¸­ï¼šå¯ä»¥ç»§ç»­åœ¨åŒä¸€ä¸ªå¯¹è±¡ä¸Šä¸€ä¸ªæ¥ä¸€ä¸ªåœ°è¿›è¡Œé“¾å¼å‡½æ•°è°ƒç”¨ã€‚</p><h3 id="å†™åœ¨æœ€åçš„æ³¨æ„äº‹é¡¹"><a href="#å†™åœ¨æœ€åçš„æ³¨æ„äº‹é¡¹" class="headerlink" title="å†™åœ¨æœ€åçš„æ³¨æ„äº‹é¡¹"></a>å†™åœ¨æœ€åçš„æ³¨æ„äº‹é¡¹</h3><p>åœ¨æœ€å¼€å§‹çš„çº¢è‰²éƒ¨åˆ†ä¹Ÿæé«˜è¿‡å°½é‡ä¸è¦åµŒå¥—ä½¿ç”¨ä½œç”¨åŸŸå‡½æ•°ï¼Œè­¦æƒ•å¼•å‘çš„ä¸Šä¸‹æ–‡æ··æ·†ã€‚çœ‹ä¸‹é¢çš„ä»£ç çŒœä¸€ä¸‹æ‰“å°ç»“æœæ˜¯ä»€ä¹ˆã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> length = <span class="hljs-number">0</span><br>    <span class="hljs-string">&quot;hello&quot;</span>.apply &#123;<br>        println(<span class="hljs-string">&quot;this is apply <span class="hljs-variable">$length</span>&quot;</span>)<br>        println(<span class="hljs-string">&quot;this is apply <span class="hljs-subst">$&#123;this.length&#125;</span>&quot;</span>)<br>    &#125;<br><br>    <span class="hljs-string">&quot;hello&quot;</span>.let &#123;<br>        println(<span class="hljs-string">&quot;this is let <span class="hljs-variable">$it</span>&quot;</span>)<br>        <span class="hljs-string">&quot;world&quot;</span>.also &#123;<br>            println(<span class="hljs-string">&quot;this is run <span class="hljs-variable">$it</span>&quot;</span>)<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">innerFunc</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-string">&quot;hi&quot;</span>.apply &#123;<br>            println(<span class="hljs-string">&quot;this is innerFunc apply <span class="hljs-variable">$length</span>&quot;</span>)<br>            println(<span class="hljs-string">&quot;this is innerFunc apply <span class="hljs-subst">$&#123;this.length&#125;</span>&quot;</span>)<br><br>        &#125;<br>    &#125;<br>    innerFunc()<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»“æœæ˜¯å¦‚ä¸‹ï¼š</p><blockquote><p>this is apply 0<br>this is apply 5<br>this is let hello<br>this is run world<br>this is innerFunc apply 0<br>this is innerFunc apply 2</p></blockquote><p>è¿™é‡Œæˆ‘ä»¬åœ¨å†™ä»£ç çš„æ—¶å€™ï¼ŒIDE ç»™äº†æç¤º:<strong>Implicit parameter â€˜itâ€™ of enclosing lambda is shadowed</strong><br><img src="/image/kotlin/scope_func_implicit_param.png" alt="Implicit parameter &#39;it&#39; of enclosing lambda is shadowed "><br>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹éšå¼ it çš„åå­—æ¥é¿å…è¿™ä¸ªé—®é¢˜</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-string">&quot;hello&quot;</span>.let &#123;<br>    println(<span class="hljs-string">&quot;this is let <span class="hljs-variable">$it</span>&quot;</span>)<br>    <span class="hljs-string">&quot;world&quot;</span>.also &#123; world-&gt;<br>        println(<span class="hljs-string">&quot;this is run <span class="hljs-variable">$world</span>&quot;</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æœ€å¥½è¿˜æ˜¯é¿å…è¿™ç§åµŒå¥—è°ƒç”¨çš„æƒ…å†µ</p><hr><p>å·²å­¦ä¹ ï¼š</p><ul><li><p>æ‰©å±•</p><ul><li><input type='checkbox' disabled='true' checked>æ‰©å±•å‡½æ•°</input></li><li><input type='checkbox' disabled='true' checked>æ‰©å±•å±æ€§</input></li><li><input type='checkbox' disabled='true' checked>ä½œç”¨åŸŸ</input></li></ul></li><li><p>å‡½æ•°ç±»å‹</p><ul><li><input type='checkbox' disabled='true' checked>å¸¦æœ‰æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹</input></li><li><input type='checkbox' disabled='true' checked>Lambdaè¡¨è¾¾å¼</input></li><li><input type='checkbox' disabled='true' checked>SAM è½¬æ¢</input></li></ul></li><li><p>å…³é”®å­—</p><ul><li><input type='checkbox' disabled='true' checked>ä½œç”¨åŸŸå‡½æ•°ï¼šwithã€letã€runã€applyã€also</input></li></ul></li></ul><p>æœªå­¦ä¹ ï¼š</p><ul><li><p>å…³é”®å­—</p><ul><li>object</li><li>Unit</li><li>Nothing</li><li>inline,noinline,crossinline</li></ul></li><li><p>æ³›å‹</p><ul><li>é€†å˜</li><li>åå˜</li></ul></li><li><p>å§”æ‰˜</p><ul><li>å§”æ‰˜ç±»</li><li>å§”æ‰˜å±æ€§</li><li>è‡ªå®šä¹‰å§”æ‰˜</li></ul></li><li><p>åç¨‹</p><ul><li>å¯åŠ¨</li><li>æŒ‚èµ·</li><li>Job</li><li>Context</li><li>Channel</li><li>Flow</li><li>select</li><li>å¹¶å‘ã€å¼‚å¸¸</li><li>launch</li><li>Dispatchers</li><li>CoroutineScope</li></ul></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Kotlin</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kotlinä¸­çš„å‡½æ•°ç±»å‹åŠ Lambda è¡¨è¾¾å¼</title>
    <link href="/2024/04/23/Kotlin%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B%E5%8F%8A-Lambda-%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    <url>/2024/04/23/Kotlin%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B%E5%8F%8A-Lambda-%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<p>ç»§ç»­ä¸Šæ¬¡åœ¨æ‰©å±•å‡½æ•°ä¸­é—ç•™ä¸‹çš„é—®é¢˜ï¼šå‡½æ•°ç±»å‹ã€‚æ€»æ‰€å‘¨çŸ¥ï¼Œåœ¨Kotlin ä¸­å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯é«˜é˜¶å‡½æ•°å˜ï¼Ÿåˆ°å¤„ç¿»äº†ç¿»ï¼Œå‘ç°å·®ä¸å¤šæ˜¯è¿™ä¹ˆä¸ªæ„æ€ï¼š<strong>æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œæˆ–è€…è¿”å›ä¸€ä¸ªå‡½æ•°ã€‚</strong>åœ¨ Kotlin åç¨‹ä¸­çš„ launchã€asyncå‡½æ•°ä»¥åŠå„ç§å„æ ·çš„æ¡†æ¶ä¸­åˆ°å¤„éƒ½æ˜¯é«˜é˜¶å‡½æ•°çš„å½±å­ï¼Œç§°é«˜é˜¶å‡½æ•°æ˜¯ Kotlinå‡½æ•°å¼ç¼–ç¨‹ã€å„å¤§æ¡†æ¶çš„åŸºçŸ³ä¹Ÿä¸è¿‡åˆ†ã€‚</p><span id="more"></span><p>ä¸å¾—ä¸è¯´ï¼Œè¿™é‡Œé¢æ¦‚å¿µæŒºå¤šçš„ï¼Œæœ‰çš„æ—¶å€™æˆ‘ä»¬ä¼šç”¨ï¼Œä½†å¹¶ä¸çŸ¥é“å«ä»€ä¹ˆåå­—ã€‚æœ‰çš„çŸ¥é“åå­—ä½†ä¸çŸ¥é“æ˜¯ä»€ä¹ˆä¸œè¥¿ã€‚</p><ul><li>é«˜é˜¶å‡½æ•°</li><li>æ‰©å±•å‡½æ•°</li><li>Lambda</li><li>SAMè½¬æ¢</li><li>å¸¦æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹</li><li>å¸¦æœ‰æ¥æ”¶è€…çš„å‡½æ•°å­—é¢å€¼</li></ul><p>é—®é¢˜ä¸å¤§ï¼Œæ…¢æ…¢æ•´ï¼Œæ…¢æ…¢ç†è§£ï¼Œå¤šè¯»å‡ éæ–‡æ¡£ï¼Œå‚è€ƒä¸€ä¸‹åˆ«äººçš„çœ‹æ³•ï¼Œä¹Ÿå°±ç†Ÿæ‚‰äº†ã€‚</p><h3 id="å‡½æ•°ç±»å‹"><a href="#å‡½æ•°ç±»å‹" class="headerlink" title="å‡½æ•°ç±»å‹"></a>å‡½æ•°ç±»å‹</h3><p>è¿™é‡Œæƒ³è¡¨è¾¾çš„å¹¶ä¸æ˜¯è¯´kotlin ä¸­çš„å‡½æ•°åˆ†ç±»ï¼Œæ¯”å¦‚ä»€ä¹ˆå†…è”å‡½æ•°ã€æ‰©å±•å‡½æ•°ã€æ ‡å‡†å‡½æ•°ã€é«˜é˜¶å‡½æ•°ç­‰ç­‰è¿™ç§åˆ†ç±»ï¼Œè€Œæ˜¯è¯´åœ¨å‡½æ•°ä½œä¸ºè¿”å›å€¼æˆ–è€…å‚æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ€ä¹ˆç¡®è®¤è¿™ä¸ªå‡½æ•°å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç±»å‹ï¼Œæˆ–è€…è¯´å¦‚ä½•ä½¿ç”¨ç¼–ç¨‹è¯­è¨€æ¥æè¿°ä¸€ä¸ªå‡½æ•°ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨è°ƒç”¨å‡½æ•°çš„æ—¶å€™ä¼ å…¥çš„å‚æ•°ï¼Œæˆ‘ä»¬ä¼šè®²è¿™ä¸ªå‡½æ•°éœ€è¦ä¸€ä¸ª Int ç±»å‹çš„å‚æ•°ï¼Œé‚£å¦‚æœæˆ‘ä»¬è°ƒç”¨çš„å‡½æ•°éœ€è¦å¦å¤–ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°æˆ‘ä»¬åº”è¯¥æ€ä¹ˆè¡¨ç¤ºå˜ï¼Ÿè¿™é‡Œå°±å¼•å‡ºäº†å‡½æ•°ç±»å‹ã€‚<br>ä¸¾ä¸ªä¾‹å­</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">functionA</span><span class="hljs-params">()</span></span>:<span class="hljs-built_in">Unit</span>&#123;<br>    println(<span class="hljs-string">&quot;functionA&quot;</span>)<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">functionA1</span><span class="hljs-params">(name:<span class="hljs-type">String</span>)</span></span>:<span class="hljs-built_in">Unit</span>&#123;<br>    <br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">functionA11</span><span class="hljs-params">(name:<span class="hljs-type">String</span>)</span></span>:String&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hi <span class="hljs-variable">$name</span>&quot;</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åº”è¯¥å¦‚ä½•æè¿°ä¸Šé¢çš„ä¸‰ä¸ªæ–¹æ³•å˜ï¼Ÿ</p><blockquote><p>functionA,ä¸éœ€è¦å‚æ•°ï¼Œè¿”å›å€¼ä¸º Unit<br>functionA1, éœ€è¦ä¸€ä¸ªString ç±»å‹çš„å‚æ•°ï¼Œè¿”å›å€¼ä¸º Unit<br>functionA11,éœ€è¦ä¸€ä¸ªString ç±»å‹çš„å‚æ•°ï¼Œè¿”å›å€¼ä¸º String</p></blockquote><p>é‚£ä¹ˆåœ¨ kotlin ç¼–ç¨‹è¯­è¨€ä¸­åˆæ˜¯å¦‚ä½•æè¿°çš„ï¼Ÿ<br><img src="/image/kotlin/kotlin_function0%3CUnit%3E.png"><br><img src="/image/kotlin/kotlin_function1%3CString,Unit%3E.png"><br><img src="/image/kotlin/kotlin_function1%3CString,String%3E.png"></p><p>ä¸Šé¢çš„å›¾æ˜¯å°†é¼ æ ‡æ‚¬åœåœ¨å˜é‡ä¸Šå°±ä¼šå‡ºç°ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€‰ä¸­å˜é‡æˆ–è€…è¡¨è¾¾å¼ï¼ŒæŒ‰ ctrl+shift+pæ¥æ˜¾ç¤ºç±»å‹</p><p>å¯ä»¥çœ‹åˆ°åœ¨<code>kotlin</code>ä¸­æ˜¯ç”¨<code>KFunction0&lt;Unit&gt;</code>ã€<code>KFunction1&lt;String, Unit&gt;</code>ã€<code>KFunction1&lt;String, String&gt;</code>è¿™ç§å½¢å¼æ¥æè¿°ä¸€ä¸ªå‡½æ•°ã€‚è¿™é‡Œçš„ KFunction åé¢çš„æ•°å­—è¡¨ç¤ºè¿™ä¸ªå‡½æ•°çš„å‚æ•°ä¸ªæ•°ï¼Œå°–æ‹¬å·ä¸­çš„ç±»å‹è¡¨ç¤ºå‚æ•°çš„ç±»å‹ï¼Œæœ€åä¸€ä¸ªç±»å‹è¡¨ç¤ºå‡½æ•°çš„è¿”å›å€¼ç±»å‹ã€‚æ¯”å¦‚<code>KFunction1&lt;String, Unit&gt;</code>è¡¨ç¤ºè¿™ä¸ªå‡½æ•°éœ€è¦<code>1</code>ä¸ª<code>String</code>ç±»å‹çš„å‚æ•°ï¼Œè¿”å›å€¼ç±»å‹ä¸º<code>Unit</code>ã€‚è€Œ<code>KFunction1&lt;String, String&gt;</code>è¡¨ç¤ºè¿™ä¸ªå‡½æ•°éœ€è¦<code>1</code>ä¸ª<code>String</code>ç±»å‹çš„å‚æ•°ï¼Œè¿”å›å€¼ä¸º<code>String</code>ã€‚<br>å¦‚æœå‡½æ•°æ˜¯æŒ‚èµ·å‡½æ•°(è¢«suspendä¿®é¥°)ï¼Œåˆ™å¯¹åº”çš„ç±»å‹ä¸º<code> KSuspendFunction0&lt;Unit&gt;</code>,ä»¥æ­¤ç±»æ¨ã€‚<br>é‚£ä¹ˆå¦‚æœæ˜¯é«˜é˜¶å‡½æ•°å˜ï¼Ÿ</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">functionC</span><span class="hljs-params">(method:()-&gt;<span class="hljs-type">String</span>)</span></span>:String&#123;<br>    <span class="hljs-keyword">return</span> method()<br>&#125;<br><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span>  <span class="hljs-title">suspendFunctionC</span><span class="hljs-params">(method: () -&gt; <span class="hljs-type">String</span>)</span></span>: String &#123;<br>    <span class="hljs-keyword">return</span> method()<br>&#125;<br><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span>  <span class="hljs-title">suspendFunctionC1</span><span class="hljs-params">(method:<span class="hljs-type">suspend</span> () -&gt; <span class="hljs-type">String</span>)</span></span>: String &#123;<br>    <span class="hljs-keyword">return</span> method()<br>&#125;<br></code></pre></td></tr></table></figure><p>åŒæ ·çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°</p><blockquote><p><code>functionC</code>å¯¹åº”çš„æè¿°æ˜¯<code>KFunction1&lt;() -&gt; String, String&gt;</code><br><code>suspendFunctionC</code>å¯¹åº”çš„æè¿°æ˜¯<code> KSuspendFunction1&lt;() -&gt; String, String&gt;</code><br><code>suspendFunctionC1</code>å¯¹åº”çš„æè¿°æ˜¯<code> KSuspendFunction1&lt;suspend () -&gt; String, String&gt;</code>ã€‚</p></blockquote><p>å¯¹äºæ‰©å±•å‡½æ•°ä¹Ÿä¸€æ ·</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> String.<span class="hljs-title">A1</span><span class="hljs-params">()</span></span> &#123;<br>    println(<span class="hljs-keyword">this</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> String.<span class="hljs-title">A11</span><span class="hljs-params">()</span></span>: String &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span><br>&#125;    <br><span class="hljs-keyword">val</span> stringA1 = String::A1 <span class="hljs-comment">// KFunction1&lt;String, Unit&gt;</span><br><span class="hljs-keyword">val</span> stringA11 = String::A11 <span class="hljs-comment">// KFunction1&lt;String, String&gt;</span><br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨<code>typealias</code>ç»™å‡½æ•°ç±»å‹å–ä¸€ä¸ªåˆ«å<br><code>typealias ClickHandler = (Button, ClickEvent) -&gt; Unit</code></p><h3 id="å¸¦æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹"><a href="#å¸¦æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹" class="headerlink" title="å¸¦æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹"></a>å¸¦æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹</h3><p>ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ç±»å‹ï¼Œå®ƒå…è®¸æ‚¨åœ¨å‡½æ•°ç±»å‹ä¸­æŒ‡å®šä¸€ä¸ªæ¥æ”¶è€…å¯¹è±¡ï¼Œä½¿å¾—åœ¨å‡½æ•°ä½“å†…å¯ä»¥ç›´æ¥è®¿é—®è¯¥æ¥æ”¶è€…å¯¹è±¡çš„æˆå‘˜å‡½æ•°å’Œå±æ€§ã€‚è¿™ç§å‡½æ•°ç±»å‹çš„è¯­æ³•æ˜¯åœ¨å‡½æ•°ç±»å‹å£°æ˜ä¹‹å‰æ·»åŠ æ¥æ”¶è€…ç±»å‹ã€‚<br>å¸¦æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><blockquote><p>æ¥æ”¶è€…ç±»å‹.() -&gt; è¿”å›ç±»å‹</p></blockquote><p>é€šè¿‡ä½¿ç”¨å¸¦æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå…·æœ‰æ¥æ”¶è€…çš„å‡½æ•°å˜é‡ã€å‡½æ•°å‚æ•°æˆ–å‡½æ•°è¿”å›ç±»å‹ï¼Œä»¥ä¾¿åœ¨è°ƒç”¨å‡½æ•°æ—¶å¯ä»¥ç›´æ¥æ“ä½œæ¥æ”¶è€…å¯¹è±¡ã€‚è¿™æ ·å¯ä»¥å®ç°ä¸€ç§ç±»ä¼¼æ‰©å±•å‡½æ•°çš„æ•ˆæœã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">data</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span></span>(<span class="hljs-keyword">val</span> name: String)<br><br><span class="hljs-comment">// å¸¦æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹</span><br><span class="hljs-keyword">val</span> greeting: Person.() -&gt; String = &#123;<br>    <span class="hljs-string">&quot;Hello, <span class="hljs-variable">$name</span>!&quot;</span><br>&#125;<br><br><span class="hljs-comment">// æ‰©å±•å‡½æ•°</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> Person.<span class="hljs-title">greet</span><span class="hljs-params">()</span></span>: String &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello, <span class="hljs-variable">$name</span>!&quot;</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> person: Person = Person(<span class="hljs-string">&quot;huang&quot;</span>)<br><br>    <span class="hljs-comment">// ä½¿ç”¨å¸¦æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹è°ƒç”¨å‡½æ•°</span><br>    <span class="hljs-keyword">val</span> message1 = person.greeting()<br><br>    <span class="hljs-comment">// ä½¿ç”¨æ‰©å±•å‡½æ•°è°ƒç”¨å‡½æ•°</span><br>    <span class="hljs-keyword">val</span> message2 = person.greet()<br><br>    println(message1) <span class="hljs-comment">// è¾“å‡º: Hello, huang!</span><br>    println(message2) <span class="hljs-comment">// è¾“å‡º: Hello, huang!</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ€»ç»“èµ·æ¥ï¼Œå¸¦æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹æ›´é€‚åˆåœ¨å‡½æ•°ç±»å‹çš„å£°æ˜å’Œä¼ é€’ä¸­ä½¿ç”¨ï¼Œä»¥æä¾›ç‰¹å®šä¸Šä¸‹æ–‡çš„å‡½æ•°æ“ä½œã€‚è€Œæ‰©å±•å‡½æ•°åˆ™æ›´é€‚åˆåœ¨å·²æœ‰ç±»ä¸Šæ·»åŠ æ–°çš„å‡½æ•°ï¼Œä½¿å¾—åœ¨è°ƒç”¨è¯¥ç±»æ—¶å¯ä»¥ä½¿ç”¨è¿™äº›é¢å¤–çš„å‡½æ•°ã€‚</p><h3 id="å°æ€»ç»“"><a href="#å°æ€»ç»“" class="headerlink" title="å°æ€»ç»“"></a>å°æ€»ç»“</h3><p>å…ˆå°å°çš„æ€»ç»“ä¸€ä¸‹ï¼š</p><ul><li>æ‰€æœ‰å‡½æ•°ç±»å‹éƒ½æœ‰ä¸€ä¸ªåœ†æ‹¬å·æ‹¬èµ·æ¥çš„å‚æ•°ç±»å‹åˆ—è¡¨ä»¥åŠä¸€ä¸ªè¿”å›ç±»å‹ï¼š(A, B) -&gt; C è¡¨ç¤ºæ¥å—ç±»å‹åˆ†åˆ«ä¸º A ä¸ B ä¸¤ä¸ªå‚æ•°å¹¶è¿”å›ä¸€ä¸ª C ç±»å‹å€¼çš„å‡½æ•°ç±»å‹ã€‚ å‚æ•°ç±»å‹åˆ—è¡¨å¯ä»¥ä¸ºç©ºï¼Œå¦‚ () -&gt; Aã€‚Unit è¿”å›ç±»å‹ä¸å¯çœç•¥ã€‚</li><li>å‡½æ•°ç±»å‹å¯ä»¥æœ‰ä¸€ä¸ªé¢å¤–çš„æ¥æ”¶è€…ç±»å‹ï¼Œå®ƒåœ¨è¡¨ç¤ºæ³•ä¸­çš„ç‚¹ä¹‹å‰æŒ‡å®šï¼š ç±»å‹ A.(B) -&gt; C è¡¨ç¤ºå¯ä»¥åœ¨ A çš„æ¥æ”¶è€…å¯¹è±¡ä¸Šä»¥ä¸€ä¸ª B ç±»å‹å‚æ•°æ¥è°ƒç”¨å¹¶è¿”å›ä¸€ä¸ª C ç±»å‹å€¼çš„å‡½æ•°ã€‚ <code>å¸¦æœ‰æ¥æ”¶è€…çš„å‡½æ•°å­—é¢å€¼</code>é€šå¸¸ä¸è¿™äº›ç±»å‹ä¸€èµ·ä½¿ç”¨ã€‚</li><li>æŒ‚èµ·å‡½æ•°å±äºå‡½æ•°ç±»å‹çš„ç‰¹æ®Šç§ç±»ï¼Œå®ƒçš„è¡¨ç¤ºæ³•ä¸­æœ‰ä¸€ä¸ª suspend ä¿®é¥°ç¬¦ ï¼Œä¾‹å¦‚ suspend () -&gt; Unit æˆ–è€… suspend A.(B) -&gt; Cã€‚</li><li>å¦‚éœ€å°†å‡½æ•°ç±»å‹æŒ‡å®šä¸ºå¯ç©ºï¼Œè¯·ä½¿ç”¨åœ†æ‹¬å·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ((Int, Int) -&gt; Int)?ã€‚</li></ul><p>è¿™æ ·æˆ‘ä»¬åœ¨çœ‹å…¶ä»–æ¡†æ¶çš„æ—¶å€™å°±çŸ¥é“æ¡†æ¶ä¸­çš„é«˜é˜¶å‡½æ•°æ€ä¹ˆè°ƒç”¨äº†ï¼š</p><blockquote><p>å½“å‚æ•°ç±»å‹ä¸º<code>() -&gt; String</code>æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¼ å…¥ä¸€ä¸ªæ²¡æœ‰å‚æ•°ä¸”è¿”å›å€¼ä¸ºStringç±»å‹çš„å‡½æ•°ï¼Œå¯¹åº”çš„ç±»å‹æ˜¯<code>KFunction0&lt;String&gt;</code></p></blockquote><h3 id="å‡½æ•°å®ä¾‹åŒ–"><a href="#å‡½æ•°å®ä¾‹åŒ–" class="headerlink" title="å‡½æ•°å®ä¾‹åŒ–"></a>å‡½æ•°å®ä¾‹åŒ–</h3><p>æ—¢ç„¶å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œé‚£ä¹ˆç†æ‰€å½“ç„¶çš„å¯ä»¥è¢«å®ä¾‹åŒ–ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡ ç§æ–¹å¼è·å–å‡½æ•°ç±»å‹çš„å®ä¾‹</p><ul><li>ä½¿ç”¨å‡½æ•°å­—é¢å€¼çš„ä»£ç å—<ul><li>lambda è¡¨è¾¾å¼: { a, b -&gt; a + b },</li><li>åŒ¿åå‡½æ•°: fun(s: String): Int { return s.toIntOrNull() ?: 0 }</li></ul></li><li>ä½¿ç”¨å·²æœ‰å£°æ˜çš„å¯è°ƒç”¨å¼•ç”¨<ul><li>é¡¶å±‚ã€å±€éƒ¨ã€æˆå‘˜ã€æ‰©å±•å‡½æ•°ï¼š::isOddã€ String::toIntï¼Œ</li><li>é¡¶å±‚ã€æˆå‘˜ã€æ‰©å±•å±æ€§ï¼šList<Int>::sizeï¼Œ</li><li>æ„é€ å‡½æ•°ï¼š::Regex</li></ul></li><li>ä½¿ç”¨å®ç°å‡½æ•°ç±»å‹æ¥å£çš„è‡ªå®šä¹‰ç±»çš„å®ä¾‹ï¼š<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IntTransformer</span>: <span class="hljs-type"></span></span>(<span class="hljs-built_in">Int</span>) -&gt; <span class="hljs-built_in">Int</span> &#123;<br>  <span class="hljs-keyword">override</span> <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">invoke</span><span class="hljs-params">(x: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> = TODO()<br>&#125;<br><span class="hljs-keyword">val</span> intFunction: (<span class="hljs-built_in">Int</span>) -&gt; <span class="hljs-built_in">Int</span> = IntTransformer()<br></code></pre></td></tr></table></figure></li></ul><h3 id="æœ‰æ— Receiverçš„å‡½æ•°ç›¸äº’è½¬åŒ–"><a href="#æœ‰æ— Receiverçš„å‡½æ•°ç›¸äº’è½¬åŒ–" class="headerlink" title="æœ‰æ— Receiverçš„å‡½æ•°ç›¸äº’è½¬åŒ–"></a>æœ‰æ— Receiverçš„å‡½æ•°ç›¸äº’è½¬åŒ–</h3><p>å¸¦ä¸ä¸å¸¦æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹éå­—é¢å€¼å¯ä»¥äº’æ¢ï¼Œå…¶ä¸­æ¥æ”¶è€…å¯ä»¥æ›¿ä»£ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåä¹‹äº¦ç„¶ã€‚ä¾‹å¦‚ï¼Œ(A, B) -&gt; C ç±»å‹çš„å€¼å¯ä»¥ä¼ ç»™æˆ–èµ‹å€¼ç»™æœŸå¾… A.(B) -&gt; C ç±»å‹å€¼çš„åœ°æ–¹ï¼Œåä¹‹äº¦ç„¶ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ<code>String.A1()</code>æ˜æ˜æ²¡æœ‰å£°æ˜éœ€è¦å‚æ•°ï¼Œä¸ºå•¥å’Œä¸Šé¢çš„<code>functionA1</code>æ–¹æ³•æ˜¯ç›¸åŒçš„ç±»å‹å˜ï¼Ÿå¯ä»¥è¿™ä¹ˆè®¤ä¸º:Kotlinä¸­çš„æ‰©å±•å‡½æ•°å°†æ¥æ”¶è€…æœ¬èº«å½“åšç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ï¼Œè¦ä¸ç„¶ä¸ºå•¥åœ¨<code>String.A1()</code>é‡Œé¢å¯ä»¥ä½¿ç”¨<code>this</code>æ¥ä»£æ›¿è°ƒç”¨è€…æœ¬èº«å˜ï¼Ÿ<br>é‚£æ—¢ç„¶è¿™æ ·çš„è¯ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸¤è€…æ˜¯å¯ä»¥äº’æ¢çš„ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">d</span><span class="hljs-params">(block :(<span class="hljs-type">String</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span> &#123;<br>   block(<span class="hljs-string">&quot;hello&quot;</span>);<br>&#125;<br>d(String::A1)<br>d(::functionA1)<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œä»…é’ˆå¯¹åœ¨å¼•ç”¨å’Œè°ƒç”¨æ—¶å¯ä»¥äº’ç›¸è½¬æ¢ï¼Œæ¯”å¦‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> sayHi: (String) -&gt; <span class="hljs-built_in">Unit</span> = &#123; name:String-&gt;  println(<span class="hljs-string">&quot;hi <span class="hljs-variable">$name</span>&quot;</span>) &#125;<br>sayHi.invoke(<span class="hljs-string">&quot;huangyuan&quot;</span>)<br>sayHi(<span class="hljs-string">&quot;huangyuan&quot;</span>)<br><br><span class="hljs-keyword">val</span> sayHello: String.() -&gt; <span class="hljs-built_in">Unit</span> = &#123; println(<span class="hljs-string">&quot;hello <span class="hljs-variable">$this</span>&quot;</span>) &#125;<br>sayHello.invoke(<span class="hljs-string">&quot;huangyuan&quot;</span>)<br>sayHello(<span class="hljs-string">&quot;huangyuan&quot;</span>)<br><span class="hljs-string">&quot;huangyuan&quot;</span>.sayHello()<br><br><span class="hljs-keyword">val</span> sayHiRef:(String)-&gt;<span class="hljs-built_in">Unit</span> =sayHi<br><span class="hljs-keyword">val</span> sayHiRef1: String.() -&gt; <span class="hljs-built_in">Unit</span> = sayHi<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœå°† sayHello å’ŒsayHiè¿™ä¸¤ä¸ªå‡½æ•°ç­‰å·å³è¾¹äº’æ¢ä¸€ä¸‹åˆ™ä¼šæŠ¥é”™ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ¦‚å¿µï¼š<code>å¸¦æ¥æ”¶è€…çš„å‡½æ•°å­—é¢å€¼</code>ï¼ˆFunction Literals with Receiverï¼‰ï¼Œä¹Ÿç§°ä¸ºå¸¦æ¥æ”¶è€…çš„ Lambda è¡¨è¾¾å¼ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„ Lambda è¡¨è¾¾å¼ã€‚å®ƒå…è®¸åœ¨ Lambda è¡¨è¾¾å¼ä¸­è®¿é—®ç‰¹å®šç±»å‹çš„å¯¹è±¡çš„æˆå‘˜ï¼Œå°±åƒåœ¨è¯¥å¯¹è±¡çš„æˆå‘˜å‡½æ•°ä¸­ä¸€æ ·ã€‚é€šè¿‡ä½¿ç”¨å¸¦æ¥æ”¶è€…çš„å‡½æ•°å­—é¢å€¼ï¼Œå¯ä»¥åœ¨ Lambda è¡¨è¾¾å¼ä¸­ä»¥æ›´ç®€æ´çš„æ–¹å¼æ“ä½œç‰¹å®šç±»å‹çš„å¯¹è±¡ã€‚ä¸Šé¢å¯¹<code>sayHello</code>çš„å®šä¹‰å°±å±äºè¿™ç§å½¢å¼ã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼šå¸¦æœ‰æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹ï¼Œä¾‹å¦‚ A.(B) -&gt; Cï¼Œå¯ä»¥ç”¨ç‰¹æ®Šå½¢å¼çš„å‡½æ•°å­—é¢å€¼å®ä¾‹åŒ–â€”-å¸¦æœ‰æ¥æ”¶è€…çš„å‡½æ•°å­—é¢å€¼ã€‚<br>è¿™é‡Œè§£é‡Šä¸€ä¸‹ï¼šæ‰€è°“çš„å­—é¢é‡ï¼Œå°±æ˜¯ä¸ç”¨å˜é‡åç§°ç›´æ¥ç”¨ç›¸å¯¹åº”çš„å€¼å†™å‡ºæ¥ã€‚æ¯”å¦‚â€œhello worldâ€å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢é‡ã€12.23æ˜¯ä¸€ä¸ª Double çš„å­—é¢é‡ã€4æ˜¯ä¸€ä¸ª Int çš„å­—é¢é‡ã€‚</p><h3 id="å‡½æ•°ç±»å‹å®ä¾‹è°ƒç”¨"><a href="#å‡½æ•°ç±»å‹å®ä¾‹è°ƒç”¨" class="headerlink" title="å‡½æ•°ç±»å‹å®ä¾‹è°ƒç”¨"></a>å‡½æ•°ç±»å‹å®ä¾‹è°ƒç”¨</h3><p>æ—¢ç„¶èƒ½è·å–åˆ°å‡½æ•°ç±»å‹çš„å®ä¾‹ï¼Œé‚£ä¹ˆè‚¯å®šå°±å¯ä»¥è°ƒç”¨äº†ã€‚<br>è¿™é‡Œè°ƒç”¨æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯é€šè¿‡<code>invoke()</code>ï¼Œæ¯”å¦‚<code>func.invoke()</code>,æˆ–è€…ç›´æ¥åœ¨å¼•ç”¨åé¢åŠ ä¸Šæ‹¬å·<code>func()</code>:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> functionOne: <span class="hljs-built_in">Int</span>.() -&gt; <span class="hljs-built_in">Unit</span> = &#123; println(<span class="hljs-string">&quot;aaFunRefRec <span class="hljs-variable">$this</span>  &quot;</span>) &#125;<br>functionOne.invoke(<span class="hljs-number">10001</span>)<br>functionOne(<span class="hljs-number">10001</span>)<br><br><span class="hljs-keyword">val</span> functionTwo: <span class="hljs-built_in">Int</span>.(String) -&gt; <span class="hljs-built_in">Unit</span> = &#123; println(<span class="hljs-string">&quot;other <span class="hljs-variable">$this</span>  &quot;</span>) &#125;<br>functionTwo.invoke(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;other&quot;</span>)<br>functionTwo(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;other&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="Lambdaè¡¨è¾¾å¼"><a href="#Lambdaè¡¨è¾¾å¼" class="headerlink" title="Lambdaè¡¨è¾¾å¼"></a>Lambdaè¡¨è¾¾å¼</h3><p>æˆ‘ä»¬åœ¨ä½¿ç”¨Javaè¯­è¨€å¼€å‘Android åº”ç”¨çš„æ—¶å€™å¯èƒ½å·²ç»ä½“éªŒè¿‡ Lambda è¡¨è¾¾å¼äº†ï¼Œæœ€å¸¸è§çš„å°±æ˜¯ç»™ View è®¾ç½®ç‚¹å‡»ç›‘å¬çš„æ—¶å€™<br><img src="/image/kotlin/replace_with_lambda_tip.png" alt="replace_with_lambda_tip"><br>å½“æˆ‘ä»¬ç‚¹å‡»äº†ä¹‹åï¼Œä»£ç å°±æˆäº†è¿™æ ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Java">llShowMoreDialog.setOnClickListener(v -&gt; showToast(<span class="hljs-string">&quot;ç‚¹å‡»äº†&quot;</span>));<br></code></pre></td></tr></table></figure><p>ç›®å‰åœ¨ java ä¸­åªèƒ½ç®€åŒ–æˆè¿™æ ·çš„ï¼Œkotlin ä¸­è¿˜å¯ä»¥è¿›ä¸€æ­¥ç®€åŒ–ï¼Œåé¢å†è¯´ã€‚è¿™é‡Œå…ˆçœ‹çœ‹Lambdaè¡¨è¾¾å¼è¯­æ³•ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> sum: (<span class="hljs-built_in">Int</span>, <span class="hljs-built_in">Int</span>) -&gt; <span class="hljs-built_in">Int</span> = &#123; x: <span class="hljs-built_in">Int</span>, y: <span class="hljs-built_in">Int</span> -&gt; x + y &#125;<br></code></pre></td></tr></table></figure><ul><li>lambda è¡¨è¾¾å¼æ€»æ˜¯æ‹¬åœ¨èŠ±æ‹¬å·ä¸­ã€‚</li><li>å®Œæ•´è¯­æ³•å½¢å¼çš„å‚æ•°å£°æ˜æ”¾åœ¨èŠ±æ‹¬å·å†…ï¼Œå¹¶æœ‰å¯é€‰çš„ç±»å‹æ ‡æ³¨ã€‚</li><li>å‡½æ•°ä½“è·Ÿåœ¨ä¸€ä¸ª -&gt; ä¹‹åã€‚</li><li>å¦‚æœæ¨æ–­å‡ºçš„è¯¥ lambda çš„è¿”å›ç±»å‹ä¸æ˜¯ Unitï¼Œé‚£ä¹ˆè¯¥ lambda ä¸»ä½“ä¸­çš„æœ€åä¸€ä¸ªï¼ˆæˆ–å¯èƒ½æ˜¯å•ä¸ªï¼‰è¡¨è¾¾å¼ä¼šè§†ä¸ºè¿”å›å€¼ã€‚</li></ul><p>å¦‚æœLambda è¡¨è¾¾å¼çš„å‚æ•°å¯ä»¥æ¨æ–­å‡ºæ¥ï¼Œæˆ‘ä»¬å¯ä»¥çœç•¥ä¸€äº›ç±»å‹ï¼Œæ¯”å¦‚ä¸Šé¢çš„ sum å‡½æ•°å¯ä»¥çœç•¥ä¸º</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> sum1 = &#123; x: <span class="hljs-built_in">Int</span>, y: <span class="hljs-built_in">Int</span> -&gt; x + y &#125;<br><span class="hljs-keyword">val</span> sum2: (<span class="hljs-built_in">Int</span>, <span class="hljs-built_in">Int</span>) -&gt; <span class="hljs-built_in">Int</span> = &#123; x, y -&gt; x + y &#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨å†™ Android æ—¶ç»å¸¸ä¼šç”¨åˆ°ç»™æŸä¸ªæ§ä»¶è®¾ç½®ç‚¹å‡»äº‹ä»¶ï¼Œå°±åƒä¸Šé¢çš„ä¾‹å­ä¸€æ ·</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">view.setOnClickListener(<span class="hljs-keyword">object</span> :View.OnClickListener&#123;<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onClick</span><span class="hljs-params">(view: <span class="hljs-type">View</span>?)</span></span> &#123;<br>        println(<span class="hljs-string">&quot;click <span class="hljs-subst">$&#123;view?.id&#125;</span>&quot;</span>)<br>    &#125;<br>&#125;)<br>view.setOnClickListener &#123; println(<span class="hljs-string">&quot;click <span class="hljs-variable">$it</span> &quot;</span>) &#125;<br></code></pre></td></tr></table></figure><h4 id="SAMè½¬æ¢"><a href="#SAMè½¬æ¢" class="headerlink" title="SAMè½¬æ¢"></a>SAMè½¬æ¢</h4><p>é‚£ä¹ˆå®ƒæ˜¯æ€ä¹ˆä»ä¸Šé¢ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»å˜æˆä¸‹é¢æ ·å­çš„ï¼Ÿè¿™é‡Œå°±è¦æä¸€ä¸‹<code>SAMè½¬æ¢</code>äº†ï¼šSAMæ˜¯Single Abstract Methodçš„ç¼©å†™ï¼Œæ„æ€å°±æ˜¯åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„ç±»æˆ–è€…æ¥å£ã€‚ä½†åœ¨Kotlinå’ŒJava 8é‡Œï¼ŒSAMä»£è¡¨ç€åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ã€‚åªè¦æ˜¯ç¬¦åˆSAMè¦æ±‚çš„æ¥å£ï¼Œç¼–è¯‘å™¨å°±èƒ½è¿›è¡ŒSAMè½¬æ¢ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Lambdaè¡¨è¾¾å¼ï¼Œæ¥ç®€å†™æ¥å£ç±»çš„å‚æ•°ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒJava 8ä¸­çš„SAMæœ‰æ˜ç¡®çš„åç§°ï¼Œå«åš<code>å‡½æ•°å¼æ¥å£(FunctionalInterface)</code>ã€‚FunctionalInterfaceçš„é™åˆ¶å¦‚ä¸‹ï¼Œç¼ºä¸€ä¸å¯ï¼š</p><ul><li>å¿…é¡»æ˜¯æ¥å£ï¼ŒæŠ½è±¡ç±»ä¸è¡Œï¼›</li><li>è¯¥æ¥å£æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæŠ½è±¡çš„æ–¹æ³•ï¼ŒæŠ½è±¡æ–¹æ³•ä¸ªæ•°å¿…é¡»æ˜¯1ï¼Œé»˜è®¤å®ç°çš„æ–¹æ³•å¯ä»¥æœ‰å¤šä¸ªã€‚</li></ul><p>åŒæ ·çš„ï¼Œåœ¨kotlinä¸­ä¹Ÿæœ‰é™åˆ¶ï¼š</p><ul><li>å¿…é¡»æ˜¯å‡½æ•°æ¥å£ï¼Œä¹Ÿå°±æ˜¯å£°æ˜ä¸º<code>fun interface</code></li><li>åªèƒ½åŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå¹¶ä¸”ä¸èƒ½åŒ…å«é»˜è®¤æ–¹æ³•</li></ul><p>å› æ­¤,kotlin ç¼–è¯‘å™¨ä¼šå°†è¯¥æ–¹æ³•è‡ªåŠ¨è½¬åŒ–ä¸º<code>fun setOnClickListener(l: ((View!) -&gt; Unit)?)</code>ï¼Œæˆ‘ä»¬æ‰å¾—ä»¥ä½¿ç”¨ Lambdaè¡¨è¾¾å¼æ¥ç®€åŒ–ä»£ç ã€‚å¯ä»¥å°†ä»£ç å†™æˆè¿™æ ·</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">view.setOnClickListener(&#123;view:View?-&gt; println(<span class="hljs-string">&quot;click <span class="hljs-subst">$&#123;view?.id&#125;</span>&quot;</span>)&#125;)<br></code></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸‹ï¼Œç”±äº kotlin æ”¯æŒç±»å‹æ¨å¯¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†<code>View?</code>ä¹Ÿçœç•¥æ‰ï¼Œæ¥ç€è¿˜ä¼šè§¦å‘ä¸€ä¸ªè¢«ç§°ä¹‹ä¸º<code>å•ä¸ªå‚æ•°çš„éšå¼åç§°</code>çš„ä¸œè¥¿ï¼ŒåŸè¯æ˜¯è¿™ä¹ˆè¯´çš„</p><blockquote><p>If the compiler can parse the signature without any parameters, the parameter does not need to be declared and -&gt; can be omitted. è¯¥å‚æ•°ä¼šéšå¼å£°æ˜ä¸º it<br>å› æ­¤ï¼Œæˆ‘ä»¬å¾—åˆ°äº†è¿™æ ·å­çš„ä»£ç </p></blockquote><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">view.setOnClickListener(&#123;println(<span class="hljs-string">&quot;click <span class="hljs-subst">$&#123;it?.id&#125;</span>&quot;</span>)&#125;)<br></code></pre></td></tr></table></figure><p>æŒ‰ç…§ Kotlin æƒ¯ä¾‹ï¼Œå¦‚æœå‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆä½œä¸ºç›¸åº”å‚æ•°ä¼ å…¥çš„ lambda è¡¨è¾¾å¼å¯ä»¥æ”¾åœ¨åœ†æ‹¬å·ä¹‹å¤–ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">view.setOnClickListener()&#123;println(<span class="hljs-string">&quot;click <span class="hljs-subst">$&#123;it?.id&#125;</span>&quot;</span>)&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§è¯­æ³•ä¹Ÿç§°ä¸º<code>æ‹–å°¾lambda(trailing lambda)</code>è¡¨è¾¾å¼ã€‚<br>å¦‚æœè¯¥ lambda è¡¨è¾¾å¼æ˜¯è°ƒç”¨æ—¶å”¯ä¸€çš„å‚æ•°ï¼Œé‚£ä¹ˆåœ†æ‹¬å·å¯ä»¥å®Œå…¨çœç•¥ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">view.setOnClickListener&#123;println(<span class="hljs-string">&quot;click <span class="hljs-subst">$&#123;it?.id&#125;</span>&quot;</span>)&#125;<br></code></pre></td></tr></table></figure><p>è¿™å°±æ˜¯æˆ‘ä»¬æœ€ç»ˆå¾—åˆ°çš„ä»£ç æ ·å­</p><h4 id="ä»lambdaè¡¨è¾¾å¼ä¸­è¿”å›ä¸€ä¸ªå€¼"><a href="#ä»lambdaè¡¨è¾¾å¼ä¸­è¿”å›ä¸€ä¸ªå€¼" class="headerlink" title="ä»lambdaè¡¨è¾¾å¼ä¸­è¿”å›ä¸€ä¸ªå€¼"></a>ä»lambdaè¡¨è¾¾å¼ä¸­è¿”å›ä¸€ä¸ªå€¼</h4><p>è¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯éšå¼è¿”å›ï¼šå¦‚æœæˆ‘ä»¬ä»€ä¹ˆéƒ½ä¸åšï¼Œå°†è¿”å›æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚<br>å¦å¤–ä¸€ç§å°±æ˜¯ä½¿ç”¨é™å®šçš„è¿”å›è¯­æ³•ä»lambdaæ˜¾å¼è¿”å›ä¸€ä¸ªå€¼</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">ints.filter &#123;<br>    <span class="hljs-keyword">val</span> shouldFilter = it &gt; <span class="hljs-number">0</span><br>    shouldFilter<br>&#125;<br><br>ints.filter &#123;<br>    <span class="hljs-keyword">val</span> shouldFilter = it &gt; <span class="hljs-number">0</span><br>    <span class="hljs-keyword">return</span><span class="hljs-symbol">@filter</span> shouldFilter<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸¤ç§æ–¹å¼æ˜¯ç­‰ä»·çš„ã€‚<br>é‚£ä¹ˆè¿™ä¸ªæ ‡ç­¾ <strong>@filter</strong>æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿ<br>åœ¨ Kotlin ä¸­ä»»ä½•è¡¨è¾¾å¼éƒ½å¯ä»¥ç”¨æ ‡ç­¾æ¥æ ‡è®°ã€‚ æ ‡ç­¾çš„æ ¼å¼ä¸ºæ ‡è¯†ç¬¦åè·Ÿ @ ç¬¦å·ï¼Œä¾‹å¦‚ï¼šabc@ã€fooBar@ã€‚ è¦ä¸ºä¸€ä¸ªè¡¨è¾¾å¼åŠ æ ‡ç­¾ï¼Œæˆ‘ä»¬åªè¦åœ¨å…¶å‰åŠ æ ‡ç­¾å³å¯.<br>æ¯”å¦‚æˆ‘ä»¬åœ¨åµŒå¥—å‡½æ•°ä¸­ï¼Œæ ‡ç­¾é™å®šçš„ return å…è®¸æˆ‘ä»¬ä»å¤–å±‚å‡½æ•°è¿”å›ï¼Œæ¯”å¦‚ä» Lambda è¡¨è¾¾å¼ä¸­è¿”å›</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span></span> &#123;<br>    listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>).forEach &#123;<br>        <span class="hljs-keyword">if</span> (it == <span class="hljs-number">3</span>) <span class="hljs-keyword">return</span> <span class="hljs-comment">// éå±€éƒ¨ç›´æ¥è¿”å›åˆ° foo() çš„è°ƒç”¨è€…</span><br>        print(it)<br>    &#125;<br>    println(<span class="hljs-string">&quot;this point is unreachable&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span></span> &#123;<br>    listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>).forEach <span class="hljs-symbol">lit@</span>&#123;<br>        <span class="hljs-keyword">if</span> (it == <span class="hljs-number">3</span>) <span class="hljs-keyword">return</span><span class="hljs-symbol">@lit</span> <span class="hljs-comment">// å±€éƒ¨è¿”å›åˆ°è¯¥ lambda è¡¨è¾¾å¼çš„è°ƒç”¨è€…â€”â€”forEach å¾ªç¯</span><br>        print(it)<br>    &#125;<br>    print(<span class="hljs-string">&quot; done with explicit label&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šå¸¸æƒ…å†µä¸‹ä½¿ç”¨<strong>éšå¼æ ‡ç­¾</strong>æ›´æ–¹ä¾¿ï¼Œå› ä¸ºè¯¥æ ‡ç­¾ä¸æ¥å—è¯¥ lambda çš„å‡½æ•°åŒåã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span></span> &#123;<br>    listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>).forEach &#123;<br>        <span class="hljs-keyword">if</span> (it == <span class="hljs-number">3</span>) <span class="hljs-keyword">return</span><span class="hljs-symbol">@forEach</span> <span class="hljs-comment">// å±€éƒ¨è¿”å›åˆ°è¯¥ lambda è¡¨è¾¾å¼çš„è°ƒç”¨è€…â€”â€”forEach å¾ªç¯</span><br>        print(it)<br>    &#125;<br>    print(<span class="hljs-string">&quot; done with implicit label&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>å®˜æ–¹è¿™é‡Œä¹Ÿç»™äº†ä¸€ä¸ªæç¤ºï¼š<strong>æ³¨æ„ï¼Œè¿™ç§éå±€éƒ¨çš„è¿”å›åªæ”¯æŒä¼ ç»™å†…è”å‡½æ•°çš„ lambda è¡¨è¾¾å¼</strong>ï¼Œè¿™ä¸ªé—®é¢˜åé¢å†è¯´æŠŠï¼Œå°±æ˜¯<code>inline</code>ã€<code>noinline</code>ã€<code>crossinline</code>è¿™ä¸‰ä¸ªå…³é”®å­—å¸¦æ¥çš„ä¼˜åŒ–ä»¥åŠæ»¥ç”¨çš„åå¤„ã€‚<br>å¦å¤–è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå° tipï¼šå¦‚æœ lambda è¡¨è¾¾å¼çš„å‚æ•°æœªä½¿ç”¨ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ä¸‹åˆ’çº¿å–ä»£å…¶åç§°</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">map.forEach &#123; (_, value) -&gt; println(<span class="hljs-string">&quot;<span class="hljs-variable">$value</span>!&quot;</span>) &#125;<br></code></pre></td></tr></table></figure><h3 id="åŒ¿åå‡½æ•°"><a href="#åŒ¿åå‡½æ•°" class="headerlink" title="åŒ¿åå‡½æ•°"></a>åŒ¿åå‡½æ•°</h3><p>ä¸Šæ–‡ä¸­çš„ Lambda è¡¨è¾¾å¼ç¼ºå°‘æŒ‡å®šè¿”å›ç±»å‹çš„èƒ½åŠ›ï¼Œè™½ç„¶å¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿”å›å€¼ç±»å‹å¯ä»¥æ¨å¯¼å‡ºæ¥ï¼Œä½†å¦‚æœç¡®å®éœ€è¦æŒ‡å®šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>åŒ¿åå‡½æ•°</strong>ï¼Œ<br>å®ƒçœ‹èµ·æ¥éå¸¸åƒä¸€ä¸ªå¸¸è§„å‡½æ•°å£°æ˜ï¼Œé™¤äº†å…¶åç§°çœç•¥äº†ã€‚å…¶å‡½æ•°ä½“æ—¢å¯ä»¥æ˜¯è¡¨è¾¾å¼ä¹Ÿå¯ä»¥æ˜¯ä»£ç å—ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-title">fun</span><span class="hljs-params">(x: <span class="hljs-type">Int</span>, y: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> = x + y<br><span class="hljs-function"><span class="hljs-title">fun</span><span class="hljs-params">(x: <span class="hljs-type">Int</span>, y: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> &#123;<br>    <span class="hljs-keyword">return</span> x + y<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœå‚æ•°ç±»å‹å¯ä»¥æ¨æ–­å‡ºæ¥ï¼Œåˆ™å‚æ•°ç±»å‹å¯ä»¥çœç•¥</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">ints.filter(<span class="hljs-function"><span class="hljs-title">fun</span><span class="hljs-params">(item)</span></span> = item &gt; <span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><hr><p>å¯¹äºä¸Šé¢çš„å†…å®¹<br>å‡½æ•°å¼ï¼ˆSAMï¼‰æ¥å£ è‹±æ–‡ç‰ˆ: <a href="https://kotlinlang.org/docs/fun-interfaces.html">Functional (SAM) interfaces</a><br>å‡½æ•°å¼ï¼ˆSAMï¼‰æ¥å£ ä¸­æ–‡ç‰ˆ: <a href="https://book.kotlincn.net/text/fun-interfaces.html">å‡½æ•°å¼ï¼ˆSAMï¼‰æ¥å£</a><br>é«˜é˜¶å‡½æ•°å’ŒLambda è‹±æ–‡ç‰ˆ: <a href="https://kotlinlang.org/docs/lambdas.html">Higher-order functions and lambdas</a><br>é«˜é˜¶å‡½æ•°å’ŒLambda ä¸­æ–‡ç‰ˆ: <a href="https://book.kotlincn.net/text/lambdas.html">é«˜é˜¶å‡½æ•°ä¸ lambda è¡¨è¾¾å¼</a><br>è¿”å›ä¸è·³è½¬ ä¸­æ–‡ç‰ˆ: <a href="https://book.kotlincn.net/text/returns.html">è¿”å›ä¸è·³è½¬</a><br>è¿”å›ä¸è·³è½¬ è‹±æ–‡ç‰ˆ: <a href="https://kotlinlang.org/docs/returns.html">Returns and jumps</a></p><hr><p>å·²å­¦ä¹ ï¼š</p><ul><li><p>æ‰©å±•</p><ul><li><input type='checkbox' disabled='true' checked>æ‰©å±•å‡½æ•°</input></li><li><input type='checkbox' disabled='true' checked>æ‰©å±•å±æ€§</input></li><li><input type='checkbox' disabled='true' checked>ä½œç”¨åŸŸ</input></li></ul></li><li><p>å‡½æ•°ç±»å‹</p><ul><li><input type='checkbox' disabled='true' checked>å¸¦æœ‰æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹</input></li><li><input type='checkbox' disabled='true' checked>Lambdaè¡¨è¾¾å¼</input></li><li><input type='checkbox' disabled='true' checked>SAM è½¬æ¢</input></li></ul></li></ul><p>æœªå­¦ä¹ ï¼š</p><ul><li><p>å…³é”®å­—</p><ul><li>object</li><li>Unit</li><li>Nothing</li><li>withã€letã€runã€applyã€also</li><li>inline,noinline,crossinline</li></ul></li><li><p>æ³›å‹</p><ul><li>é€†å˜</li><li>åå˜</li></ul></li><li><p>å§”æ‰˜</p><ul><li>å§”æ‰˜ç±»</li><li>å§”æ‰˜å±æ€§</li><li>è‡ªå®šä¹‰å§”æ‰˜</li></ul></li><li><p>åç¨‹</p><ul><li>å¯åŠ¨</li><li>æŒ‚èµ·</li><li>Job</li><li>Context</li><li>Channel</li><li>Flow</li><li>select</li><li>å¹¶å‘ã€å¼‚å¸¸</li><li>launch</li><li>Dispatchers</li><li>CoroutineScope</li></ul></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Kotlin</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kotlinä¸­çš„å‡½æ•°ç±»å‹åŠæ‰©å±•å‡½æ•°</title>
    <link href="/2024/04/22/Kotlin%E4%B8%AD%E7%9A%84%E6%89%A9%E5%B1%95%E5%87%BD%E6%95%B0%E5%8F%8A%E6%89%A9%E5%B1%95%E5%B1%9E%E6%80%A7/"/>
    <url>/2024/04/22/Kotlin%E4%B8%AD%E7%9A%84%E6%89%A9%E5%B1%95%E5%87%BD%E6%95%B0%E5%8F%8A%E6%89%A9%E5%B1%95%E5%B1%9E%E6%80%A7/</url>
    
    <content type="html"><![CDATA[<p>ç»§ç»­kotlin çš„å­¦ä¹ ï¼Œä¹‹å‰åªæ˜¯å­¦äº†ç‚¹çš®æ¯›ä¸­çš„çš®æ¯›ï¼Œä¼šäº†ä¸€äº›ç®€å•è¯­æ³•è€Œå·²ã€‚æœ€åé¢åˆ—äº†ä¸€ä¸ªå¤§çº²ï¼Œè®¤çœŸçš„å­¦ä¹ ä¸€ä¸‹ã€‚<br>ä»Šå¤©çš„å†…å®¹æ˜¯<strong>æ‰©å±•</strong>ã€‚gradleï¼š8.5ï¼Œæ’ä»¶ï¼šid â€˜org.jetbrains.kotlin.jvmâ€™ version â€˜1.9.23â€™</p><span id="more"></span><h3 id="ç®€ä»‹å’Œä½¿ç”¨"><a href="#ç®€ä»‹å’Œä½¿ç”¨" class="headerlink" title="ç®€ä»‹å’Œä½¿ç”¨"></a>ç®€ä»‹å’Œä½¿ç”¨</h3><p>kotlin ä¸­æ‰©å±•å¯ä»¥ç»™å·²æœ‰çš„ç±»æ·»åŠ é¢å¤–çš„æ–¹æ³•å’Œå±æ€§ï¼Œçœ‹èµ·æ¥å°±åƒæ˜¯ä¿®æ”¹äº†ç±»çš„æºç ä¸€æ ·ï¼Œè€Œä¸æ˜¯åƒ java ä¸€æ ·éœ€è¦ç»§æ‰¿è¯¥ç±»ç„¶åæ·»åŠ è‡ªå·±çš„æ–¹æ³•ã€‚æ‰©å±•åˆåˆ†ä¸ºæ‰©å±•å‡½æ•°å’Œæ‰©å±•å±æ€§ã€‚<br>é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨å˜ï¼Ÿå…¶å®å’Œå£°æ˜æ™®é€šå‡½æ•°å‡ ä¹ä¸€è‡´ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ªå«åšâ€æ¥æ”¶è€…â€çš„ä¸œè¥¿ï¼Œä¹Ÿå°±æ˜¯æ–‡æ¡£ä¸­çš„Receiverï¼Œè¯´ç™½äº†ï¼Œå…¶å®å°±æ˜¯é™åˆ¶è¿™ä¸ªæ¥æ”¶è€…ç±»å‹æ‰èƒ½ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦å¯¹è¿™ä¸ªç±»å‹ <strong>â€œæ·»åŠ â€</strong> ä¸€ä¸ªæ–¹æ³•ã€‚<br>æ¯”å¦‚æˆ‘ä»¬æƒ³è¦ç»™å­—ç¬¦ä¸²ç±»å‹æ·»åŠ ä¸€ä¸ªè·å–æœ€åä¸€ä¸ªå…ƒç´ çš„æ–¹æ³•ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> String.<span class="hljs-title">lastChar</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Char</span>?&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.isEmpty())&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">get</span>(length - <span class="hljs-number">1</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ–¹æ³•å£°æ˜è¡¨ç¤ºï¼šå¯¹<code>String</code>ç±»å‹å®šä¹‰ä¸€ä¸ªæ— å‚çš„<code>lastChar</code>æ–¹æ³•ï¼Œè¿”å›å€¼æ˜¯<code>Char?</code>ï¼Œä½¿ç”¨çš„æ—¶å€™å°±åƒä½¿ç”¨ String ç±»ä¸­çš„æ–¹æ³•ä¸€æ ·ä½¿ç”¨å°±å¥½äº†ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> s = <span class="hljs-string">&quot;kotlin&quot;</span><br>    println(s.lastChar())<br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆæ‰©å±•å±æ€§æ€ä¹ˆä½¿ç”¨å˜ï¼Ÿå’Œæ‰©å±•å‡½æ•°å·®ä¸å¤šï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> String.firstChar:<span class="hljs-built_in">Char</span>?<br>    <span class="hljs-keyword">get</span>() = <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.isEmpty()) <span class="hljs-literal">null</span> <span class="hljs-keyword">else</span> <span class="hljs-keyword">get</span>(<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><p>å¯ä»¥ç®€å•çš„è®¤ä¸ºä¸Šé¢çš„å£°æ˜æ˜¯è¿™æ ·:å¯¹<code>String</code>ç±»å‹é¡¶ä¸€ä¸ª<code>firstChar</code>å±æ€§ï¼Œç±»å‹æ˜¯<code>Char?</code>,ä½¿ç”¨æ—¶å’Œä½¿ç”¨ String ç±»ä¸­çš„å±æ€§ä¸€æ ·å°±å¥½äº†:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> s = <span class="hljs-string">&quot;kotlin&quot;</span><br>    println(s.lastChar())<br>    println(s.firstChar)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ€è€ƒï¼šJavaä¸­å¦‚ä½•ä½¿ç”¨ï¼Ÿ"><a href="#æ€è€ƒï¼šJavaä¸­å¦‚ä½•ä½¿ç”¨ï¼Ÿ" class="headerlink" title="æ€è€ƒï¼šJavaä¸­å¦‚ä½•ä½¿ç”¨ï¼Ÿ"></a>æ€è€ƒï¼šJavaä¸­å¦‚ä½•ä½¿ç”¨ï¼Ÿ</h3><p>æ¥ä¸‹æ¥æ€è€ƒä¸€ä¸‹åœ¨ java ä¸­å¦‚ä½•è°ƒç”¨å˜ï¼Ÿå¾—å…ˆçœ‹çœ‹ kotlin æ˜¯å¦‚ä½•å®ç°æ‰©å±•çš„ã€‚æœ€ç®€å•çš„æ–¹æ³•ï¼Œçœ‹åç¼–è¯‘åçš„å­—èŠ‚ç æ–‡ä»¶ï¼š<br>é¡¶éƒ¨èœå•ä¸­ toolsâ€“&gt;kotlinâ€“&gt;Show Kotlin Bytecodeï¼Œç„¶åç‚¹Decompileå°±å¯ä»¥çœ‹åˆ°äº†<br><img src="/image/kotlin/show_kotlin_bytecode.png" alt="decompile kotlin bytecode"><br>ä»£ç å¤§è‡´å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainKt</span> &#123;<br>   <span class="hljs-meta">@Nullable</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Character <span class="hljs-title function_">lastChar</span><span class="hljs-params">(<span class="hljs-meta">@NotNull</span> String $<span class="hljs-built_in">this</span>$lastChar)</span> &#123;<br>      Intrinsics.checkNotNullParameter($<span class="hljs-built_in">this</span>$lastChar, <span class="hljs-string">&quot;&lt;this&gt;&quot;</span>);<br>      <span class="hljs-keyword">return</span> ((CharSequence)$<span class="hljs-built_in">this</span>$lastChar).length() == <span class="hljs-number">0</span> ? <span class="hljs-literal">null</span> : $<span class="hljs-built_in">this</span>$lastChar.charAt($<span class="hljs-built_in">this</span>$lastChar.length() - <span class="hljs-number">1</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Nullable</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Character <span class="hljs-title function_">getFirstChar</span><span class="hljs-params">(<span class="hljs-meta">@NotNull</span> String $<span class="hljs-built_in">this</span>$firstChar)</span> &#123;<br>      Intrinsics.checkNotNullParameter($<span class="hljs-built_in">this</span>$firstChar, <span class="hljs-string">&quot;&lt;this&gt;&quot;</span>);<br>      <span class="hljs-keyword">return</span> ((CharSequence)$<span class="hljs-built_in">this</span>$firstChar).length() == <span class="hljs-number">0</span> ? <span class="hljs-literal">null</span> : $<span class="hljs-built_in">this</span>$firstChar.charAt(<span class="hljs-number">0</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;kotlin&quot;</span>;<br>      <span class="hljs-type">Character</span> <span class="hljs-variable">var1</span> <span class="hljs-operator">=</span> lastChar(s);<br>      System.out.println(var1);<br>      var1 = getFirstChar(s);<br>      System.out.println(var1);<br>   &#125;<br><br>   <span class="hljs-comment">// $FF: synthetic method</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      main();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åç¼–è¯‘ä¹‹åçš„ä»£ç åªæ˜¯æ·»åŠ äº†ä¸¤ä¸ªé™æ€æ–¹æ³•è€Œå·²ï¼Œè¿™æ ·çš„è¯ï¼Œåœ¨ Java ä¸­æˆ‘ä»¬å°±å¯ä»¥è¿™ä¹ˆä½¿ç”¨äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestMain</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Hello World!&quot;</span>;<br>        System.out.println( MainKt.lastChar(s));<br>        System.out.println( MainKt.getFirstChar(s));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ€è€ƒï¼šä½œç”¨åŸŸï¼Œç»§æ‰¿ä¸é‡è½½"><a href="#æ€è€ƒï¼šä½œç”¨åŸŸï¼Œç»§æ‰¿ä¸é‡è½½" class="headerlink" title="æ€è€ƒï¼šä½œç”¨åŸŸï¼Œç»§æ‰¿ä¸é‡è½½"></a>æ€è€ƒï¼šä½œç”¨åŸŸï¼Œç»§æ‰¿ä¸é‡è½½</h3><p>æ¥ä¸‹æ¥æ€è€ƒå¦å¤–ä¸€ä¸ªé—®é¢˜ï¼šä½œç”¨åŸŸï¼Œæˆ–è€…è¯´æˆ‘ä»¬å¯ä»¥åœ¨å“ªé‡Œå£°æ˜ã€åœ¨å“ªé‡Œè°ƒç”¨æ‰©å±•å‡½æ•°ï¼Ÿ<br>ä¸Šé¢çš„ä¾‹å­ä¸­éƒ½æ˜¯å£°æ˜ä¸ºäº†é¡¶çº§å‡½æ•°(top level),æˆ‘ä»¬å¯ä»¥åœ¨ä»»æ„åœ°æ–¹ä½¿ç”¨å¯¹åº”çš„ç±»å‹è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœå£°æ˜åœ¨ç±»é‡Œé¢ä¼šæ€ä¹ˆæ ·ï¼Ÿ</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Example</span></span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> String.<span class="hljs-title">isEmail</span><span class="hljs-params">()</span></span>:<span class="hljs-built_in">Boolean</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.contains(<span class="hljs-string">&quot;@&quot;</span>)<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">test</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">val</span> email = <span class="hljs-string">&quot;a@a.com&quot;</span><br>        println(email.isEmail())<br>    &#125;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">test</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">val</span> email = <span class="hljs-string">&quot;a@a.com&quot;</span><br>    println(email.isEmail())<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨ç±»é‡Œé¢å®šä¹‰çš„æ‰©å±•å‡½æ•°ï¼Œåªèƒ½åœ¨ç±»é‡Œé¢è°ƒç”¨ï¼Œåœ¨ç±»å¤–æ˜¯æ— æ³•ä½¿ç”¨çš„ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç»§æ‰¿Exampleçš„ç±»ä¸­ä½¿ç”¨ï¼Œæ¯”å¦‚è¿™æ ·</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SubExample</span> :<span class="hljs-type">Example</span></span>()&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subTest</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">val</span> email = <span class="hljs-string">&quot;a@a&quot;</span><br>        println(email.isEmail())<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœå¯¹<code>Example</code>å®šä¹‰ä¸€ä¸ªæ‰©å±•å‡½æ•°ï¼Œé‚£ä¹ˆåœ¨å­ç±»SubExampleä¸­èƒ½è°ƒç”¨ä¹ˆï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ä¸èƒ½è¦†å†™ï¼Œå› ä¸ºkotlinä¸­çš„å‡½æ•°é»˜è®¤æ˜¯<code>final</code>ä¸èƒ½è¢«è¦†å†™çš„ï¼ŒåŒæ—¶å®šä¹‰æ‰©å±•å‡½æ•°æ—¶åˆä¸èƒ½è¢«<code>open</code>ä¿®é¥°ï¼Œä»è¯­æ³•ä¸Šè®²ï¼Œè¿™æ˜¯æ‰©å±•å‡½æ•°ä¸èƒ½è¢«è¦†å†™çš„åŸå› ã€‚çœ‹åç¼–è¯‘ä¹‹åçš„ä»£ç ï¼Œå®šä¹‰ä¸ºé¡¶çº§å‡½æ•°çš„æ‰©å±•å‡½æ•°æ˜¯ static çš„ï¼Œå› æ­¤ä¹Ÿä¸èƒ½è¢«è¦†å†™ã€‚<br>é‚£ä¹ˆåœ¨ Java ä¸­èƒ½ä¸èƒ½ç”¨å˜ï¼Ÿé‡äº‹ä¸å†³å…ˆçœ‹åç¼–è¯‘åçš„ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmail</span><span class="hljs-params">(<span class="hljs-meta">@NotNull</span> String $<span class="hljs-built_in">this</span>$isEmail)</span> &#123;<br>      Intrinsics.checkNotNullParameter($<span class="hljs-built_in">this</span>$isEmail, <span class="hljs-string">&quot;&lt;this&gt;&quot;</span>);<br>      <span class="hljs-keyword">return</span> StringsKt.contains$<span class="hljs-keyword">default</span>((CharSequence)$<span class="hljs-built_in">this</span>$isEmail, (CharSequence)<span class="hljs-string">&quot;@&quot;</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">2</span>, (Object)<span class="hljs-literal">null</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-type">String</span> <span class="hljs-variable">email</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;a@a.com&quot;</span>;<br>      <span class="hljs-type">boolean</span> <span class="hljs-variable">var2</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.isEmail(email);<br>      System.out.println(var2);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯å°±å¯ä»¥é€šè¿‡<code>Example</code>å®ä¾‹æ¥è°ƒç”¨äº†ã€‚åŒæ ·æ³¨æ„åˆ°åœ¨<code>Example</code>ç±»ä¸­å®šä¹‰çš„æ‰©å±•å‡½æ•°<code>isEmail</code>è¢« final ä¿®é¥°äº†ï¼Œå› æ­¤ä¹Ÿæ— æ³•é€šè¿‡ç»§æ‰¿æ¥è¦†å†™è¯¥æ–¹æ³•ã€‚</p><h3 id="æ€è€ƒï¼šæ‰©å±•å‡½æ•°å¦‚ä½•å¼•ç”¨ï¼Ÿ"><a href="#æ€è€ƒï¼šæ‰©å±•å‡½æ•°å¦‚ä½•å¼•ç”¨ï¼Ÿ" class="headerlink" title="æ€è€ƒï¼šæ‰©å±•å‡½æ•°å¦‚ä½•å¼•ç”¨ï¼Ÿ"></a>æ€è€ƒï¼šæ‰©å±•å‡½æ•°å¦‚ä½•å¼•ç”¨ï¼Ÿ</h3><p>å˜¿å˜¿å˜¿,æˆ‘ä»¬çŸ¥é“å‡½æ•°æ˜¯å¯ä»¥é€šè¿‡åŒå†’å·å¼•ç”¨çš„</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">sayHi</span><span class="hljs-params">(name: <span class="hljs-type">String</span>)</span></span> &#123;<br>    println(<span class="hljs-string">&quot;hi <span class="hljs-variable">$name</span>&quot;</span>)<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">referenceMethod</span><span class="hljs-params">(method: (<span class="hljs-type">String</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span> &#123;<br>    method(<span class="hljs-string">&quot;xuan&quot;</span>)<br>    method.invoke(<span class="hljs-string">&quot;yuan&quot;</span>)<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    referenceMethod(::sayHi)<br>    referenceMethod &#123; name -&gt; println(<span class="hljs-string">&quot;hello <span class="hljs-variable">$name</span>&quot;</span>) &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆæ‰©å±•å‡½æ•°åº”è¯¥å¦‚ä½•å¼•ç”¨å˜ï¼Ÿè¿™é‡Œå…ˆå­¦æ€ä¹ˆç”¨ï¼Œåé¢å†å­¦å‡½æ•°ç±»å‹å§<br>å¦‚æœæˆ‘ä»¬å°†æ‰©å±•å‡½æ•°å®šä¹‰ä¸ºé¡¶çº§å‡½æ•°ï¼Œé‚£ä¹ˆåœ¨åº”ç”¨çš„æ—¶å€™å’Œå¼•ç”¨è¿™ä¸ªç±»æœ¬èº«çš„æˆå‘˜å‡½æ•°æ²¡å•¥åŒºåˆ«,æ¯”å¦‚åœ¨ä¸€å¼€å§‹æˆ‘ä»¬å¯¹ String å®šä¹‰çš„æ‰©å±•å‡½æ•° lastChar,æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå¼•ç”¨ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-keyword">val</span> lastCharFun1 = String::lastChar<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å°†æ‰©å±•å‡½æ•°å®šä¹‰åœ¨ç±»é‡Œé¢åˆè¯¥å¦‚ä½•åº”å¯¹ï¼Ÿåº”å¯¹ä¸äº†ï¼Œæ²¡æ³•å¼•ç”¨ã€‚<br>ä¸ºä»€ä¹ˆï¼Ÿæ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œæ‰©å±•å‡½æ•°å±äºå“ªä¸ªç±»ï¼Ÿå®é™…ä¸Šå¯ä»¥è®¤ä¸ºæ‰©å±•å‡½æ•°è°éƒ½ä¸å±äºï¼Œåªæ˜¯åŠ äº†ä¸€ä¸ªé™å®šï¼Œé™å®šå“ªä¸ªç±»å‹çš„å¯¹è±¡å¯ä»¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚<br>å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œè¯­æ³•ä¸Šå¼•ç”¨ç±»çš„æˆå‘˜å‡½æ•°æ˜¯ç±»ååŒå†’å·å‡½æ•°åï¼Œé‚£å¼•ç”¨æ‰©å±•å‡½æ•°ä¹Ÿæ˜¯è¿™æ ·ï¼Œä½†æ˜¯æŠŠæ‰©å±•å‡½æ•°å®šä¹‰åœ¨å…¶ä»–ç±»ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥ç”¨å“ªä¸ªç±»åï¼Ÿå¹²è„†ä¸èƒ½å¼•ç”¨å°±å¥½äº†ã€‚</p><hr><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>äº†è§£äº†æ‰©å±•å‡½æ•°ã€æ‰©å±•å±æ€§ åŠå…¶ä½œç”¨åŸŸã€‚äº†è§£äº†åœ¨ Java å±‚é¢å¦‚ä½•å®ç°çš„ä»¥åŠ Java ä¸­å¦‚ä½•ä½¿ç”¨ã€‚ç¿»çœ‹ kotlin æºç ï¼Œæœ‰å¾ˆå¤šéƒ½æ˜¯åŸºäºæ‰©å±•æ¥å®ç°çš„ï¼Œæ¯”å¦‚ Stringã€æ¯”å¦‚ä¸€äº›æ•°å­—ç±»å‹ Floatã€Double ç­‰ã€‚</p><p>åˆ°æ­¤ï¼Œæ‰©å±•å°±å·®ä¸å¤šäº†ï¼Œåº”è¯¥è¿˜ä¼šæœ‰ä¸€äº›å°ç»†èŠ‚ä¸Šçš„é—®é¢˜ï¼Œä½†é—®é¢˜åº”è¯¥ä¸å¤§ã€‚æ¥ä¸‹æ¥åº”è¯¥ä¼šå­¦ä¹ ä¸€ä¸‹é—ç•™ä¸‹æ¥çš„é—®é¢˜ï¼šå‡½æ•°ç±»å‹ä»¥åŠlambda è¡¨è¾¾å¼</p><hr><p>å·²å­¦ä¹ ï¼š</p><ul><li>æ‰©å±•<ul><li><input type='checkbox' disabled='true' checked>æ‰©å±•å‡½æ•°</input></li><li><input type='checkbox' disabled='true' checked>æ‰©å±•å±æ€§</input></li><li><input type='checkbox' disabled='true' checked>ä½œç”¨åŸŸ</input></li></ul></li></ul><p>æœªå­¦ä¹ ï¼š</p><ul><li><p>Lambdaè¡¨è¾¾å¼</p><ul><li>SAM è½¬æ¢</li><li>å‡½æ•°ç±»å‹</li></ul></li><li><p>å‡½æ•°ç±»å‹</p><ul><li>å¸¦æœ‰æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹</li></ul></li><li><p>å…³é”®å­—</p><ul><li>object</li><li>Unit</li><li>Nothing</li><li>withã€letã€runã€applyã€also</li></ul></li><li><p>æ³›å‹</p><ul><li>é€†å˜</li><li>åå˜</li></ul></li><li><p>å§”æ‰˜</p><ul><li>å§”æ‰˜ç±»</li><li>å§”æ‰˜å±æ€§</li><li>è‡ªå®šä¹‰å§”æ‰˜</li></ul></li><li><p>åç¨‹</p><ul><li>å¯åŠ¨</li><li>æŒ‚èµ·</li><li>Job</li><li>Context</li><li>Channel</li><li>Flow</li><li>select</li><li>å¹¶å‘ã€å¼‚å¸¸</li><li>launch</li><li>Dispatchers</li><li>CoroutineScope</li></ul></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Kotlin</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Retrofitæµç¨‹åˆ†æ</title>
    <link href="/2024/04/07/Retrofit%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90/"/>
    <url>/2024/04/07/Retrofit%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<p>åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ä»‹ç»äº†ã€Šåœ¨kotlinåç¨‹ä¸­ä½¿ç”¨è‡ªå®šä¹‰CallAdapterå¤„ç†é”™è¯¯ã€‹ï¼Œæ—¢ç„¶é€‰æ‹©äº†å®ƒï¼Œå½“ç„¶å¾—å…ˆå…¨é¢äº†è§£ä¸€ä¸‹ã€‚<br>å…ˆä¸‹è½½ä¸€ä¸‹æºç ï¼Œæ­å»ºä¸€ä¸‹ç¯å¢ƒï¼Œä¹Ÿæ²¡å•¥å¥½è¯´çš„ï¼Œæˆ‘ä¸‹è½½çš„æ˜¯2.11.0 ç‰ˆæœ¬çš„ä»£ç ï¼Œä½¿ç”¨çš„ IDEA2023.3.6ã€‚è¿™éƒ½æ˜¯å°äº‹æƒ…ï¼Œåªè¦èƒ½æœ‰ä»£ç è·³è½¬åŠŸèƒ½å°±å¥½ã€‚é¦–æ¬¡é…ç½®éœ€è¦ä¸‹è½½ç›¸åº”ä¾èµ–ï¼Œæ—¶é—´ä¼šé•¿ä¸€äº›ï¼Œè¿™ä¸é‡è¦ã€‚ç­‰é…ç½®å®Œæˆåï¼Œæ‰¾åˆ° simple moduleï¼Œæœ‰å„ç§å„æ ·çš„ç¤ºä¾‹ä»£ç ã€‚æ˜¯å¯ä»¥ç›´æ¥è¿è¡Œçš„ã€‚</p><span id="more"></span><h2 id="åˆ›å»ºRetrofitå¯¹è±¡"><a href="#åˆ›å»ºRetrofitå¯¹è±¡" class="headerlink" title="åˆ›å»ºRetrofitå¯¹è±¡"></a>åˆ›å»ºRetrofitå¯¹è±¡</h2><p>æˆ‘ä»¬å…ˆä»å¦‚ä½•åˆ›å»ºçš„<code>Retrofit</code>å¯¹è±¡å¼€å§‹<br>å…ˆçœ‹ä¸€ä¸‹æˆ‘ä»¬å¯ä»¥è®¾ç½®å“ªäº›å‚æ•°ï¼Œæ’¸ä¸€ä¸‹æºç ï¼Œæ‰¾ä¸€ä¸‹<code>Retrofit.Builder</code>ç±»</p><h3 id="è®¾ç½®OkHttpClient"><a href="#è®¾ç½®OkHttpClient" class="headerlink" title="è®¾ç½®OkHttpClient"></a>è®¾ç½®<code>OkHttpClient</code></h3><p>è¿™é‡Œçš„<code>OkHttpClient</code>å®ç°äº†<code>Call.Factory</code>æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">client</span><span class="hljs-params">(OkHttpClient client)</span> &#123;<br>  <span class="hljs-keyword">return</span> callFactory(Objects.requireNonNull(client, <span class="hljs-string">&quot;client == null&quot;</span>));<br>&#125;<br><span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">callFactory</span><span class="hljs-params">(okhttp3.Call.Factory factory)</span> &#123;<br>  <span class="hljs-built_in">this</span>.callFactory = Objects.requireNonNull(factory, <span class="hljs-string">&quot;factory == null&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è®¾ç½®-baseUrl"><a href="#è®¾ç½®-baseUrl" class="headerlink" title="è®¾ç½® baseUrl"></a>è®¾ç½® baseUrl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">baseUrl</span><span class="hljs-params">(URL baseUrl)</span> &#123;<br>  Objects.requireNonNull(baseUrl, <span class="hljs-string">&quot;baseUrl == null&quot;</span>);<br>  <span class="hljs-keyword">return</span> baseUrl(HttpUrl.get(baseUrl.toString()));<br>&#125;<br><span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">baseUrl</span><span class="hljs-params">(String baseUrl)</span> &#123;<br>  Objects.requireNonNull(baseUrl, <span class="hljs-string">&quot;baseUrl == null&quot;</span>);<br>  <span class="hljs-keyword">return</span> baseUrl(HttpUrl.get(baseUrl));<br>&#125;<br><span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">baseUrl</span><span class="hljs-params">(HttpUrl baseUrl)</span> &#123;<br>  Objects.requireNonNull(baseUrl, <span class="hljs-string">&quot;baseUrl == null&quot;</span>);<br>  List&lt;String&gt; pathSegments = baseUrl.pathSegments();<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-string">&quot;&quot;</span>.equals(pathSegments.get(pathSegments.size() - <span class="hljs-number">1</span>))) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;baseUrl must end in /: &quot;</span> + baseUrl);<br>  &#125;<br>  <span class="hljs-built_in">this</span>.baseUrl = baseUrl;<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åºåˆ—åŒ–å’Œååºåˆ—åŒ–"><a href="#åºåˆ—åŒ–å’Œååºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–å’Œååºåˆ—åŒ–"></a>åºåˆ—åŒ–å’Œååºåˆ—åŒ–</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">addConverterFactory</span><span class="hljs-params">(Converter.Factory factory)</span> &#123;<br>  converterFactories.add(Objects.requireNonNull(factory, <span class="hljs-string">&quot;factory == null&quot;</span>));<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ”¯æŒâ€™Callâ€™å¯¹è±¡ä¹‹å¤–çš„è¿”å›ç±»å‹"><a href="#æ”¯æŒâ€™Callâ€™å¯¹è±¡ä¹‹å¤–çš„è¿”å›ç±»å‹" class="headerlink" title="æ”¯æŒâ€™Callâ€™å¯¹è±¡ä¹‹å¤–çš„è¿”å›ç±»å‹"></a>æ”¯æŒâ€™Callâ€™å¯¹è±¡ä¹‹å¤–çš„è¿”å›ç±»å‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">addCallAdapterFactory</span><span class="hljs-params">(CallAdapter.Factory factory)</span> &#123;<br>  callAdapterFactories.add(Objects.requireNonNull(factory, <span class="hljs-string">&quot;factory == null&quot;</span>));<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è°ƒç”¨-callBack-æ—¶ä½¿ç”¨çš„Executor"><a href="#è°ƒç”¨-callBack-æ—¶ä½¿ç”¨çš„Executor" class="headerlink" title="è°ƒç”¨ callBack æ—¶ä½¿ç”¨çš„Executor"></a>è°ƒç”¨ callBack æ—¶ä½¿ç”¨çš„Executor</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">callbackExecutor</span><span class="hljs-params">(Executor executor)</span> &#123;<br>  <span class="hljs-built_in">this</span>.callbackExecutor = Objects.requireNonNull(executor, <span class="hljs-string">&quot;executor == null&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ˜¯å¦æå‰éªŒè¯æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•"><a href="#æ˜¯å¦æå‰éªŒè¯æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•" class="headerlink" title="æ˜¯å¦æå‰éªŒè¯æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•"></a>æ˜¯å¦æå‰éªŒè¯æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">validateEagerly</span><span class="hljs-params">(<span class="hljs-type">boolean</span> validateEagerly)</span> &#123;<br>  <span class="hljs-built_in">this</span>.validateEagerly = validateEagerly;<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è°ƒç”¨-build-æ–¹æ³•åˆ›å»º-Retrofit-å¯¹è±¡"><a href="#è°ƒç”¨-build-æ–¹æ³•åˆ›å»º-Retrofit-å¯¹è±¡" class="headerlink" title="è°ƒç”¨ build()æ–¹æ³•åˆ›å»º Retrofit å¯¹è±¡"></a>è°ƒç”¨ build()æ–¹æ³•åˆ›å»º Retrofit å¯¹è±¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> Retrofit <span class="hljs-title function_">build</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-keyword">if</span> (baseUrl == <span class="hljs-literal">null</span>) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;Base URL required.&quot;</span>);<br>  &#125;<br><br>  okhttp3.Call.<span class="hljs-type">Factory</span> <span class="hljs-variable">callFactory</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.callFactory;<br>  <span class="hljs-keyword">if</span> (callFactory == <span class="hljs-literal">null</span>) &#123;<br>      callFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpClient</span>();<br>  &#125;<br><br>  <span class="hljs-type">Executor</span> <span class="hljs-variable">callbackExecutor</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.callbackExecutor;<br>  <span class="hljs-keyword">if</span> (callbackExecutor == <span class="hljs-literal">null</span>) &#123;<br>      callbackExecutor = Platform.callbackExecutor;<br>  &#125;<br><br>  <span class="hljs-type">BuiltInFactories</span> <span class="hljs-variable">builtInFactories</span> <span class="hljs-operator">=</span> Platform.builtInFactories;<br><br>  <span class="hljs-comment">// Make a defensive copy of the adapters and add the default Call adapter.</span><br>  List&lt;CallAdapter.Factory&gt; callAdapterFactories = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(<span class="hljs-built_in">this</span>.callAdapterFactories);<br>  List&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CallAdapter</span>.Factory&gt; defaultCallAdapterFactories =<br>  builtInFactories.createDefaultCallAdapterFactories(callbackExecutor);<br>  callAdapterFactories.addAll(defaultCallAdapterFactories);<br><br>  <span class="hljs-comment">// Make a defensive copy of the converters.</span><br>  List&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Converter</span>.Factory&gt; defaultConverterFactories =<br>  builtInFactories.createDefaultConverterFactories();<br>  <span class="hljs-type">int</span> <span class="hljs-variable">defaultConverterFactoriesSize</span> <span class="hljs-operator">=</span> defaultConverterFactories.size();<br>  List&lt;Converter.Factory&gt; converterFactories =<br>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(<span class="hljs-number">1</span> + <span class="hljs-built_in">this</span>.converterFactories.size() + defaultConverterFactoriesSize);<br><br>  <span class="hljs-comment">// Add the built-in converter factory first. This prevents overriding its behavior but also</span><br>  <span class="hljs-comment">// ensures correct behavior when using converters that consume all types.</span><br>  converterFactories.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BuiltInConverters</span>());<br>  converterFactories.addAll(<span class="hljs-built_in">this</span>.converterFactories);<br>  converterFactories.addAll(defaultConverterFactories);<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Retrofit</span>(<br>      callFactory,<br>      baseUrl,<br>      unmodifiableList(converterFactories),<br>      defaultConverterFactoriesSize,<br>      unmodifiableList(callAdapterFactories),<br>      defaultCallAdapterFactories.size(),<br>      callbackExecutor,<br>      validateEagerly);<br>&#125;<br></code></pre></td></tr></table></figure><ol><li>é¦–å…ˆæ£€æŸ¥æ˜¯å¦è®¾ç½®äº† baseUrlï¼Œæ²¡è®¾ç½®ç›´æ¥æŠ›å¼‚å¸¸</li><li>è®¾ç½®callFactoryï¼Œé»˜è®¤ä¸ºOkHttpClient</li><li>è®¾ç½®callbackExecutoré»˜è®¤ä¸ºplatform.defaultCallbackExecutor()ï¼ŒAndroidå¹³å°ä¸ºMainThreadExecutorï¼Œå…¶ä»–å¹³å°ä¸º nullã€‚è¿™é‡Œçš„ AndroidMainExecutor åªæ˜¯ç®€å•çš„ä½¿ç”¨ handler è½¬å‘åˆ°ä¸»çº¿ç¨‹<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AndroidMainExecutor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Executor</span> &#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Handler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>(Looper.getMainLooper());<br><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(Runnable r)</span> &#123;<br>      handler.post(r);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li>callAdapterFactories é»˜è®¤æ·»åŠ  platform.defaultCallAdapterFactories,è¿”å›å€¼ä¸ºDefaultCallAdapterFactoryï¼Œä¹‹ååœ¨ kotlin ä¸­ä½¿ç”¨å¯†é—­ç±»ä»£æ›¿ callback æ—¶å°±æ˜¯æŠ„çš„è¿™ä¸ªç±»ä¸­çš„æ–¹æ³•</li><li>converterFactories<br>  â—‹ å…ˆæ·»åŠ  new BuiltInConverters()<br>  â—‹ å†æ·»åŠ è‡ªå®šä¹‰çš„<br>  â—‹ æœ€åæ·»åŠ platform.defaultConverterFactories() é»˜è®¤æ˜¯ç©ºçš„<br>è¿™æ ·å°±é…ç½®å¥½çš„ Retrofit å¯¹è±¡</li></ol><h2 id="å¦‚ä½•å‘é€è¯·æ±‚"><a href="#å¦‚ä½•å‘é€è¯·æ±‚" class="headerlink" title="å¦‚ä½•å‘é€è¯·æ±‚"></a>å¦‚ä½•å‘é€è¯·æ±‚</h2><p>æˆ‘ä»¬åœ¨å®šä¹‰ç½‘ç»œè¯·æ±‚æ—¶æ˜¯è¿™ä¹ˆå†™çš„</p><h3 id="å®šä¹‰ç½‘ç»œè¯·æ±‚"><a href="#å®šä¹‰ç½‘ç»œè¯·æ±‚" class="headerlink" title="å®šä¹‰ç½‘ç»œè¯·æ±‚"></a>å®šä¹‰ç½‘ç»œè¯·æ±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GitHub</span> &#123;<br>  <span class="hljs-meta">@GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br>  Call&lt;List&lt;Contributor&gt;&gt; <span class="hljs-title function_">contributors</span><span class="hljs-params">(<span class="hljs-meta">@Path(&quot;owner&quot;)</span> String owner, <span class="hljs-meta">@Path(&quot;repo&quot;)</span> String repo)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åˆ›å»ºGitHubå¯¹è±¡-å’Œå‘é€è¯·æ±‚"><a href="#åˆ›å»ºGitHubå¯¹è±¡-å’Œå‘é€è¯·æ±‚" class="headerlink" title="åˆ›å»ºGitHubå¯¹è±¡ å’Œå‘é€è¯·æ±‚"></a>åˆ›å»º<strong>GitHubå¯¹è±¡</strong> å’Œå‘é€è¯·æ±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-comment">// Create an instance of our GitHub API interface.</span><br><span class="hljs-type">GitHub</span> <span class="hljs-variable">github</span> <span class="hljs-operator">=</span> retrofit.create(GitHub.class);<br><span class="hljs-comment">// Create a call instance for looking up Retrofit contributors.</span><br>Call&lt;List&lt;Contributor&gt;&gt; call = github.contributors(<span class="hljs-string">&quot;square&quot;</span>, <span class="hljs-string">&quot;retrofit&quot;</span>);<br><span class="hljs-comment">// Fetch and print a list of the contributors to the library.</span><br>List&lt;Contributor&gt; contributors = call.execute().body();<br></code></pre></td></tr></table></figure><p>é‡ç‚¹åœ¨æˆ‘ä»¬è°ƒç”¨<code>retrofit.create</code>æ–¹æ³•æ—¶ç”¨åˆ°çš„åŠ¨æ€ä»£ç†å•†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">create</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Class&lt;T&gt; service)</span> &#123;<br>  validateServiceInterface(service);<br>  <span class="hljs-keyword">return</span> (T)<br>      Proxy.newProxyInstance(<br>          service.getClassLoader(),<br>          <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>&lt;?&gt;[] &#123;service&#125;,<br>          <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvocationHandler</span>() &#123;<br>            <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object[] emptyArgs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[<span class="hljs-number">0</span>];<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-meta">@Nullable</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, <span class="hljs-meta">@Nullable</span> Object[] args)</span><br>                <span class="hljs-keyword">throws</span> Throwable &#123;<br>              <span class="hljs-comment">// If the method is a method from Object then defer to normal invocation.</span><br>              <span class="hljs-keyword">if</span> (method.getDeclaringClass() == Object.class) &#123;<br>                <span class="hljs-keyword">return</span> method.invoke(<span class="hljs-built_in">this</span>, args);<br>              &#125;<br>              args = args != <span class="hljs-literal">null</span> ? args : emptyArgs;<br>              <span class="hljs-type">Reflection</span> <span class="hljs-variable">reflection</span> <span class="hljs-operator">=</span> Platform.reflection;<br>              <span class="hljs-keyword">return</span> reflection.isDefaultMethod(method)<br>                  ? reflection.invokeDefaultMethod(method, service, proxy, args)<br>                  : loadServiceMethod(service, method).invoke(proxy, args);<br>            &#125;<br>          &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="validateServiceInterface"><a href="#validateServiceInterface" class="headerlink" title="validateServiceInterface"></a>validateServiceInterface</h3><p>åˆ›å»º Github å¯¹è±¡æ—¶ä½¿ç”¨äº†åŠ¨æ€ä»£ç†ï¼Œä¸è¿‡åœ¨åˆ›å»ºä¹‹å‰ï¼Œå…ˆè°ƒç”¨äº†<code>validateServiceInterface(service);</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validateServiceInterface</span><span class="hljs-params">(Class&lt;?&gt; service)</span> &#123;<br>    <span class="hljs-keyword">if</span> (!service.isInterface()) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;API declarations must be interfaces.&quot;</span>);<br>    &#125;<br><br>    Deque&lt;Class&lt;?&gt;&gt; check = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayDeque</span>&lt;&gt;(<span class="hljs-number">1</span>);<br>    check.add(service);<br>    <span class="hljs-keyword">while</span> (!check.isEmpty()) &#123;<br>      Class&lt;?&gt; candidate = check.removeFirst();<br>      <span class="hljs-keyword">if</span> (candidate.getTypeParameters().length != <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span><br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(<span class="hljs-string">&quot;Type parameters are unsupported on &quot;</span>).append(candidate.getName());<br>        <span class="hljs-keyword">if</span> (candidate != service) &#123;<br>          message.append(<span class="hljs-string">&quot; which is an interface of &quot;</span>).append(service.getName());<br>        &#125;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(message.toString());<br>      &#125;<br>      Collections.addAll(check, candidate.getInterfaces());<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (validateEagerly) &#123;<br>      <span class="hljs-type">Reflection</span> <span class="hljs-variable">reflection</span> <span class="hljs-operator">=</span> Platform.reflection;<br>      <span class="hljs-keyword">for</span> (Method method : service.getDeclaredMethods()) &#123;<br>        <span class="hljs-keyword">if</span> (!reflection.isDefaultMethod(method)<br>            &amp;&amp; !Modifier.isStatic(method.getModifiers())<br>            &amp;&amp; !method.isSynthetic()) &#123;<br>          loadServiceMethod(service, method);<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></figure><p>å…ˆæ£€æŸ¥ Github ç±»æ˜¯ä¸æ˜¯ Interfaceï¼Œæ¥ç€å®šä¹‰ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ï¼Œå¯¹å½“å‰æ¥å£åŠå…¶çˆ¶æ¥å£è¿›è¡Œé€’å½’æ£€æŸ¥ï¼Œè¿™é‡Œæ˜¯ä¸æ”¯æŒæ³›å‹å‚æ•°çš„ã€‚<br>åœ¨æ¥ä¸‹æ¥åˆ¤æ–­ä¸€ä¸‹åœ¨åˆ›å»º Retrofit æ—¶ä¼ å…¥çš„validateEagerlyå‚æ•°ï¼Œå¦‚æœæ˜¯ trueï¼Œå¹¶ä¸”å£°æ˜çš„æ–¹æ³•ä¸æ˜¯é»˜è®¤ã€ä¸æ˜¯é™æ€ã€ä¸æ˜¯åˆæˆæ–¹æ³•ï¼Œåˆ™è°ƒç”¨loadServiceMethodæ–¹æ³•è§£ææ¥å£ä¸­å£°æ˜çš„æ–¹æ³•ã€‚</p><h3 id="loadServiceMethod"><a href="#loadServiceMethod" class="headerlink" title="loadServiceMethod"></a>loadServiceMethod</h3><p>é¦–å…ˆè°ƒç”¨<code>ServiceMethod.parseAnnotations(this, service, method);</code>ï¼Œå…ˆä»ç¼“å­˜çš„mapä¸­è·å–æœ‰æ²¡æœ‰å·²ç»è§£æå¥½çš„ServiceMethodã€‚å¦‚æœæ²¡æœ‰åˆ™è°ƒç”¨ServiceMethod.parseAnnotations(this, method)æ–¹æ³•è¿›è¡Œè§£æã€‚</p><h4 id="ç¬¬ä¸€æ­¥åˆ›å»ºrequestFactoryå¯¹è±¡"><a href="#ç¬¬ä¸€æ­¥åˆ›å»ºrequestFactoryå¯¹è±¡" class="headerlink" title="ç¬¬ä¸€æ­¥åˆ›å»ºrequestFactoryå¯¹è±¡"></a>ç¬¬ä¸€æ­¥åˆ›å»ºrequestFactoryå¯¹è±¡</h4><p>è°ƒç”¨äº† <code>RequestFactory requestFactory = RequestFactory.parseAnnotations(retrofit, service, method); </code>ï¼Œè§£æäº†ä¾‹å¦‚è¯·æ±‚æ–¹å¼ï¼ˆå³ POST è¿˜æ˜¯ GET ç­‰è¯·æ±‚ï¼‰ï¼Œè¯·æ±‚å¤´ï¼ŒcontentType ç­‰ç­‰å‚æ•°å¹¶è¿”å›äº†ä¸€ä¸ª<code>RequestFactory</code>å¯¹è±¡</p><h4 id="ç¬¬äºŒæ­¥åˆ›å»ºHttpServiceMethodå­ç±»CallAdapted"><a href="#ç¬¬äºŒæ­¥åˆ›å»ºHttpServiceMethodå­ç±»CallAdapted" class="headerlink" title="ç¬¬äºŒæ­¥åˆ›å»ºHttpServiceMethodå­ç±»CallAdapted"></a>ç¬¬äºŒæ­¥åˆ›å»ºHttpServiceMethodå­ç±»CallAdapted</h4><p>æ¥ç€é€šè¿‡<code>HttpServiceMethod</code>çš„é™æ€æ–¹æ³•<code>parseAnnotations</code>è¿›ä¸€æ­¥è§£æï¼Œå…¥å‚æœ‰<code>Retrofit</code>å¯¹è±¡ï¼Œ<code>Method</code>å¯¹è±¡å’Œåˆšæ‰åˆ›å»ºçš„<code>RequestFactory </code>å¯¹è±¡ã€‚<code>HttpServiceMethod</code>ç»§æ‰¿è‡ª<code>ServiceMethod</code>ï¼Œä½†ä¹Ÿæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œè¿™ä¸ªç±»æä¾›çš„<code>parseAnnotations</code>æ–¹æ³•çš„ä¸»è¦å†…å®¹æ˜¯è¿›ä¸€æ­¥è§£æï¼Œå¹¶é€šè¿‡<code>createCallAdapter</code>åˆ›å»ºé€‚é…å™¨ã€é€šè¿‡<code>createResponseConverter</code>åˆ›å»ºè½¬æ¢å™¨ï¼Œæœ€ååˆ©ç”¨<code>RequestFactory</code>å¯¹è±¡ï¼Œ<code>OkHttp</code>å¯¹è±¡ï¼Œ<code>è½¬æ¢å™¨</code>å¯¹è±¡ï¼Œ<code>é€‚é…å™¨</code>å¯¹è±¡åˆ›å»ºäº†ä¸€ä¸ª<code>CallAdapted</code>ç±»å‹çš„å¯¹è±¡å¹¶è¿”å›ã€‚</p><h5 id="åˆ›å»ºé€‚é…å™¨"><a href="#åˆ›å»ºé€‚é…å™¨" class="headerlink" title="åˆ›å»ºé€‚é…å™¨"></a>åˆ›å»ºé€‚é…å™¨</h5><p>å¦‚æœæˆ‘ä»¬å‰é¢æ²¡æœ‰è°ƒç”¨<code>addCallAdapterFactory(CallAdapter.Factory factory)</code>æ·»åŠ è‡ªå®šä¹‰çš„Factoryçš„è¯ï¼Œè¿™é‡Œè¿”å›çš„æ˜¯é»˜è®¤çš„<code>DefaultCallAdapterFactory</code>å¯¹è±¡ã€‚<br>åœ¨è¯¥ç±»çš„<code>adapt</code>æ–¹æ³•ä¸­è¿”å›çš„<code>CallAdapter</code>å¯¹è±¡ä¸­ï¼Œå…ˆåˆ¤æ–­äº†<code>executor</code>æ˜¯ä¸æ˜¯ç©ºï¼Œè¿™é‡Œçš„<code>executor</code>å°±æ˜¯åœ¨åˆ›å»º<code>Retrofit</code>æ—¶è°ƒç”¨<code>public Builder callbackExecutor(Executor executor)</code>æ–¹æ³•æ—¶ä¼ å…¥çš„å¯¹è±¡ï¼Œå‰é¢ä¹Ÿè¯´è¿‡ï¼Œåœ¨**Android(Dalvik)**å¹³å°ä¸Šé»˜è®¤æ˜¯<code>AndroidMainExecutor</code>,å…¶ä»–å¹³å°é»˜è®¤ä¸ºç©ºã€‚</p><p>ç®€å•è®²ï¼Œ<code>DefaultCallAdapterFactory</code>å¤§è‡´å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultCallAdapterFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CallAdapter</span>.Factory &#123;<br>    <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-meta">@Nullable</span> CallAdapter&lt;?, ?&gt; get(Type returnType, Annotation[] annotations, Retrofit retrofit) &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">Executor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span><br>        Utils.isAnnotationPresent(annotations, SkipCallbackExecutor.class)<br>            ? <span class="hljs-literal">null</span><br>            : callbackExecutor;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CallAdapter</span>&lt;Object, Call&lt;?&gt;&gt;() &#123;<br>      <span class="hljs-meta">@Override</span><br>      <span class="hljs-keyword">public</span> Type <span class="hljs-title function_">responseType</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> responseType;<br>      &#125;<br><br>      <span class="hljs-meta">@Override</span><br>      <span class="hljs-keyword">public</span> Call&lt;Object&gt; <span class="hljs-title function_">adapt</span><span class="hljs-params">(Call&lt;Object&gt; call)</span> &#123;<br>        <span class="hljs-type">return</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span>= <span class="hljs-literal">null</span> ? call : <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutorCallbackCall</span>&lt;&gt;(executor, call);<br>      &#125;<br>    &#125;;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExecutorCallbackCall</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Call</span>&lt;T&gt; &#123;<br>   ExecutorCallbackCall(Executor callbackExecutor, Call&lt;T&gt; delegate) &#123;<br>      <span class="hljs-built_in">this</span>.callbackExecutor = callbackExecutor;<br>      <span class="hljs-built_in">this</span>.delegate = delegate;<br>    &#125;<br>    <span class="hljs-comment">//ã€‚ã€‚ã€‚ã€‚ä¸€ç³»åˆ—çš„æ–¹æ³•ï¼Œé™¤äº†enqueue(final Callback&lt;T&gt; callback)æ–¹æ³•å¤–ï¼Œéƒ½æ˜¯è°ƒç”¨delegateä¸­å¯¹åº”çš„æ–¹æ³•</span><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="åˆ›å»ºè½¬æ¢å™¨"><a href="#åˆ›å»ºè½¬æ¢å™¨" class="headerlink" title="åˆ›å»ºè½¬æ¢å™¨"></a>åˆ›å»ºè½¬æ¢å™¨</h5><p>æˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™ä¸€èˆ¬ä¼šä¼ å…¥ä¸€ä¸ªConverterFactoryå¯¹è±¡ï¼Œæ¯”å¦‚MoshiConverterFactoryã€GsonConverterFactoryç­‰ã€‚æœ€ä¸»è¦çš„å°±ä¸¤ä¸ªæ–¹æ³•<br><code>responseBodyConverter</code> and <code>requestBodyConverter</code>.åœ¨è°ƒç”¨<code>HttpServiceMethod.createResponseConverter</code>æ—¶ï¼Œå…œå…œè½¬è½¬æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨äº† <code>Retrofit.nextCallAdapter</code>æ–¹æ³•ï¼Œä»æˆ‘ä»¬ä¸€å¼€å§‹æ„å»ºçš„ Retrofit å¯¹è±¡ä¸­æŸ¥æ‰¾å¯¹åº”çš„è½¬æ¢å™¨</p><h5 id="åˆ›å»ºCallAdaptedå¯¹è±¡"><a href="#åˆ›å»ºCallAdaptedå¯¹è±¡" class="headerlink" title="åˆ›å»ºCallAdaptedå¯¹è±¡"></a>åˆ›å»ºCallAdaptedå¯¹è±¡</h5><p>è¿™é‡Œç›´æ¥è°ƒç”¨çš„æ„é€ æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CallAdapted</span>&lt;&gt;(requestFactory, callFactory, responseConverter, callAdapter);<br></code></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œä¼ å…¥çš„<code>callAdapter</code>å¯¹è±¡å°±æ˜¯å‰é¢æåˆ°çš„è°ƒç”¨<code>createCallAdapter</code>è¿”å›çš„é»˜è®¤<code>DefaultCallAdapterFactory</code>ç¤ºä¾‹ã€‚<br><code>CallAdapted</code>ç±»æ˜¯<code>HttpServiceMethod</code>çš„å­ç±»ï¼Œå®ç°äº†çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•<code>adapt</code>ã€‚è€Œ<code>HttpServiceMethod</code>åˆå®ç°äº†<code>ServiceMethod</code>çš„æŠ½è±¡æ–¹æ³•<code>invoke</code>ï¼Œåœ¨<code>invoke</code>æ–¹æ³•é‡Œè°ƒç”¨äº†<code>adapt</code>æ–¹æ³•ã€‚</p><h4 id="loadServiceMethodè¿‡ç¨‹æ€»ç»“"><a href="#loadServiceMethodè¿‡ç¨‹æ€»ç»“" class="headerlink" title="loadServiceMethodè¿‡ç¨‹æ€»ç»“"></a>loadServiceMethodè¿‡ç¨‹æ€»ç»“</h4><p>æ‰€ä»¥å‰é¢è¯´åˆ°çš„åŠ è½½è¿‡ç¨‹(loadServiceMethod)ï¼Œæœ€ç»ˆå°±æ˜¯è¿”å›äº†ä¸€ä¸ª<code>CallAdapted</code>ç±»å‹çš„å¯¹è±¡ï¼Œå¹¶å­˜åˆ°ç¼“å­˜ä¸­ã€‚æ¥ä¸‹å»å°±æ˜¯è°ƒç”¨äº†<code>CallAdapted</code>å¯¹è±¡çš„<code>invoke</code>æ–¹æ³•ï¼Œæ˜¾ç„¶æœ€ç»ˆè°ƒç”¨äº†<code>CallAdapted</code>è‡ªèº«çš„<code>adapt</code>æ–¹æ³•ã€‚<code>CallAdapted</code>æä¾›çš„<code>adapt</code>æ–¹æ³•é‡Œå°±ä¸€å¥ï¼Œé‚£å°±æ˜¯è°ƒç”¨é€‚é…å™¨çš„<code>adapt</code>æ–¹æ³•ï¼Œå¹¶è¿”å›ä¸€ä¸ªå€¼ã€‚è¿™ä¸ªå€¼å°±æ˜¯æˆ‘ä»¬å®šä¹‰çš„æ¥å£ç±»å‹çš„ä»£ç†å¯¹è±¡.ä¹‹åè°ƒç”¨è°ƒç”¨å®šä¹‰çš„æ¥å£æ–¹æ³•è·å–åˆ°Callå¯¹è±¡ï¼Œè°ƒç”¨enqueueå¼‚æ­¥æ‰§è¡Œï¼›è°ƒç”¨executeåŒæ­¥æ‰§è¡Œï¼›</p><h3 id="invokeè¿‡ç¨‹"><a href="#invokeè¿‡ç¨‹" class="headerlink" title="invokeè¿‡ç¨‹"></a>invokeè¿‡ç¨‹</h3><p>å‰é¢çŸ¥é“äº†<code>loadServiceMethod</code>è¿”å›çš„æ˜¯ä¸€ä¸ª<code>CallAdapted</code>å¯¹è±¡ï¼Œç„¶åç´§æ¥ç€è°ƒç”¨äº†<code>invoke</code>æ–¹æ³•ã€‚ä½†<code>CallAdapted</code>å¹¶æ²¡æœ‰é‡å†™è¯¥æ–¹æ³•ï¼Œæ‰€ä»¥å®é™…ä¸Šè¿˜æ˜¯è°ƒç”¨çš„<code>HttpServiceMethod</code>ç±»ä¸­çš„<code>invoke</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">final</span> <span class="hljs-meta">@Nullable</span> ReturnT <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object instance, Object[] args)</span> &#123;<br>  Call&lt;ResponseT&gt; call =<br>      <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpCall</span>&lt;&gt;(requestFactory, instance, args, callFactory, responseConverter);<br>  <span class="hljs-keyword">return</span> adapt(call, args);<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/image/Android/retrofit/NewOkHttpCall.png"><br><img src="/image/Android/retrofit/NewOkhttpCallArgs.png"></p><p>æ¥ç€è°ƒç”¨äº†<code>adapt(call, args)</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±éœ€è¦å­ç±»å®ç°äº†ï¼Œè¿™é‡Œçš„å­ç±»æ˜¯<code>CallAdapted</code>,åœ¨<code>CallAdapted</code>ä¸­æ¥ç€è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> ReturnT <span class="hljs-title function_">adapt</span><span class="hljs-params">(Call&lt;ResponseT&gt; call, Object[] args)</span> &#123;<br>  <span class="hljs-keyword">return</span> callAdapter.adapt(call);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯¥æ–¹æ³•ä¸­çš„<code>callAdapter</code>å¯¹è±¡å°±æ˜¯å‰é¢æåˆ°çš„<code>DefaultCallAdapterFactory.get</code>æ–¹æ³•ä¸­è¿”å›çš„<code>CallAdapter</code>,è°ƒç”¨äº†è¯¥å¯¹åº”çš„<code>adapt</code>æ–¹æ³•ã€‚åœ¨ä¸Šé¢çš„ä»‹ç»çš„<strong>åˆ›å»ºé€‚é…å™¨</strong>å°ç»“ä¸­æåˆ°ï¼Œåœ¨**Android(Dalvik)**å¹³å°ä¸Šé»˜è®¤æœ‰<code>AndroidMainExecutor</code>,å…¶ä»–å¹³å°é»˜è®¤ä¸ºç©ºã€‚æ‰€ä»¥åœ¨æ²¡æœ‰é¢å¤–æ·»åŠ <code>callbackExecutor</code>çš„æƒ…å†µä¸‹ï¼ŒAndroid å¹³å°ä¸Šè¿”å›çš„æ˜¯<code>ExecutorCallbackCall</code>,åœ¨å…¶ä»–å¹³å°ä¸Šé»˜è®¤è¿”å›çš„å°±æ˜¯å‚æ•°ä¸­çš„<code>call</code>å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯<code>retrofit2.OkHttpCall</code>ã€‚ è¿™ä¸ªå¯¹è±¡ä¹Ÿå°±æ˜¯æˆ‘ä»¬è°ƒç”¨æ¥å£ä¸­çš„æ–¹æ³•è¿”å›çš„å¯¹è±¡ã€‚</p><h4 id="å‘é€è¯·æ±‚"><a href="#å‘é€è¯·æ±‚" class="headerlink" title="å‘é€è¯·æ±‚"></a>å‘é€è¯·æ±‚</h4><p>ä¸Šé¢æåˆ°åœ¨ Android å¹³å°ä¸Šä¼šè¿”å›<code>ExecutorCallbackCall</code>å¯¹è±¡ï¼Œå…¶ä»–å¹³å°è¿”å›<code>retrofit2.OkHttpCall</code>å¯¹è±¡ã€‚ä½†åœ¨åˆ›å»º<code>ExecutorCallbackCall</code><br>å¯¹è±¡çš„æ—¶å€™ä¹Ÿä¼šå°†<code>retrofit2.OkHttpCall</code>ä¼ è¿›å»ï¼Œåœ¨è°ƒç”¨å„ç§æ–¹æ³•çš„æ—¶å€™è¿˜æ˜¯è°ƒç”¨çš„<code>retrofit2.OkHttpCall</code>å¯¹è±¡çš„æ–¹æ³•ï¼Œåªä¸è¿‡åœ¨è°ƒç”¨<code>void enqueue(Callback&lt;T&gt; callback);</code>æ–¹æ³•çš„<code>callback</code>å›è°ƒä¸­ä½¿ç”¨<code>callbackExecutor</code>å°†å›è°ƒåˆ‡æ¢å›ä¸»çº¿ç¨‹è€Œå·²ã€‚</p><p>åœ¨è°ƒç”¨<code>retrofit2.OkHttpCall</code>çš„<code>enqueue</code>æˆ–è€…<code>execute</code>æ–¹æ³•æ—¶ï¼Œä¼šè°ƒç”¨<code>createRawCall</code>æ–¹æ³•åˆ›å»ºä¸€ä¸ª<code>okhttp3.Call</code>å¯¹è±¡ï¼Œå®é™…ä¸Šçš„ç½‘ç»œè¯·æ±‚è¿˜æ˜¯ okhttp å‘å‡ºçš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">private</span> okhttp3.Call <span class="hljs-title function_">createRawCall</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>  okhttp3.<span class="hljs-type">Call</span> <span class="hljs-variable">call</span> <span class="hljs-operator">=</span> callFactory.newCall(requestFactory.create(instance, args));<br>  <span class="hljs-keyword">if</span> (call == <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>(<span class="hljs-string">&quot;Call.Factory returned null.&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> call;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>requestFactory</code>æ˜¯ä¸Šé¢æåˆ°çš„<code>parseAnnotations</code>æ—¶åˆ›å»ºçš„<code>RequestFactory</code>å¯¹è±¡ï¼ŒåŒ…å«äº†éƒ¨åˆ†è¯·æ±‚ä¿¡æ¯ã€‚è¿™é‡Œåˆç”¨å®ƒåˆ›å»ºäº†<code>okhttp3.Request</code>å¯¹è±¡ã€‚åˆ›å»ºå¥½ä¹‹åæ¥ç€å°±åˆ›å»ºäº†<code>okhttp3.Call</code>å¯¹è±¡ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è°ƒç”¨<code>enqueue</code>æˆ–è€…<code>execute</code>æ–¹æ³•å‘é€è¯·æ±‚ã€‚<br>å½“è¯·æ±‚æ•°æ®è¿”å›æ—¶ï¼Œä¼šè°ƒç”¨<code>parseResponse(okhttp3.Response rawResponse)</code>æ–¹æ³•ï¼Œæœ€ç»ˆè°ƒç”¨çš„æ˜¯<code>responseConverter.convert(catchingBody)</code>æ–¹æ³•ï¼Œè¿™é‡Œçš„<code>responseConverter</code>å°±æ˜¯æˆ‘ä»¬åœ¨åˆ›å»º<code>Retrofit</code>å¯¹è±¡è°ƒç”¨<code>addConverterFactory</code>æ—¶ä¼ å…¥çš„è§£ææ–¹æ³•.<br>è‡³æ­¤ï¼Œå®Œæˆäº†ä¸€æ¬¡ç½‘ç»œè¯·æ±‚ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Retrofit</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åœ¨kotlinåç¨‹ä¸­ä½¿ç”¨è‡ªå®šä¹‰CallAdapterå¤„ç†é”™è¯¯</title>
    <link href="/2024/03/29/kotlin%E4%B8%ADRetrofit2-x%E8%87%AA%E5%AE%9A%E4%B9%89CallAdapter%E5%81%9A%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/"/>
    <url>/2024/03/29/kotlin%E4%B8%ADRetrofit2-x%E8%87%AA%E5%AE%9A%E4%B9%89CallAdapter%E5%81%9A%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Retrofitåœ¨2019-06-05å‘å¸ƒçš„2.6.0ç‰ˆæœ¬ä¸­å°±å·²ç»æ”¯æŒKotlin ä¸­çš„ suspendä¿®é¥°ç¬¦äº†ï¼Œç›®å‰æ­£å‡†å¤‡åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ Kotlinï¼Œé¡ºä¾¿æ›¿æ¢ä¸€ä¸‹ç½‘ç»œåº“ã€‚è¿™é‡Œå…ˆåšä¸€ä¸‹è°ƒç ”å’ŒåŸºç¡€å»ºè®¾ï¼Œæ–¹ä¾¿åç»­çš„æ¥å…¥å·¥ä½œã€‚<br>é—®å°±æ˜¯15 å¹´ 16 å¹´çš„è€é¡¹ç›®ï¼Œä¹‹å‰å¹¶æ²¡æœ‰ä½¿ç”¨ Kotlin çš„æ‰“ç®—ã€‚</p><p>Retrofitå·²ç»åœ¨2024-03-28æ›´æ–°åˆ°2.11.0ç‰ˆæœ¬äº†ï¼Œå°±ç”¨è¿™ä¸ªæ¥åšè°ƒç ”å¥½äº†ã€‚</p><h3 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs groovy">implementation <span class="hljs-string">&#x27;com.squareup.retrofit2:retrofit:2.11.0&#x27;</span><br>implementation <span class="hljs-string">&#x27;com.squareup.retrofit2:converter-gson:2.11.0&#x27;</span><br>implementation <span class="hljs-string">&#x27;com.squareup.okhttp3:okhttp:4.12.0&#x27;</span><br></code></pre></td></tr></table></figure><p>ç”±äºéœ€è¦å¯¹ OKHttpClient åšä¸€äº›æ“ä½œå’Œå®šåˆ¶ï¼Œè¿™é‡Œæ·»åŠ äº† okhttp çš„ä¾èµ–ã€‚å®ä½“ç±»çš„è½¬æ¢ä½¿ç”¨äº† gsonï¼Œä¸ºå•¥ç”¨ gsonï¼Œé—®å°±æ˜¯é¡¹ç›®é‡Œé¢å°±æ˜¯ç”¨çš„ gsonï¼Œåé¢å†ä»‹ç»ä¸€ä¸‹å…¶ä»–çš„converterã€‚</p><ul><li>Gson: com.squareup.retrofit2:converter-gson</li><li>Jackson: com.squareup.retrofit2:converter-jackson</li><li>Moshi: com.squareup.retrofit2:converter-moshi</li><li>Protobuf: com.squareup.retrofit2:converter-protobuf</li><li>Wire: com.squareup.retrofit2:converter-wire</li><li>Simple XML: com.squareup.retrofit2:converter-simplexml</li><li>JAXB: com.squareup.retrofit2:converter-jaxb</li><li>Scalars (primitives, boxed, and String): com.squareup.retrofit2:converter-scalars</li></ul><h3 id="å£°æ˜è¯·æ±‚æ¥å£"><a href="#å£°æ˜è¯·æ±‚æ¥å£" class="headerlink" title="å£°æ˜è¯·æ±‚æ¥å£"></a>å£°æ˜è¯·æ±‚æ¥å£</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MainPageApi</span></span>&#123;<br>  <span class="hljs-meta">@GET(<span class="hljs-string">&quot;app_interface/home_pag/&quot;</span>)</span><br>  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getMainPageInfoWithRow</span><span class="hljs-params">()</span></span>:Call&lt;MainPageInfo&gt;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åˆ›å»º-Retrofit-å¯¹è±¡"><a href="#åˆ›å»º-Retrofit-å¯¹è±¡" class="headerlink" title="åˆ›å»º Retrofit å¯¹è±¡"></a>åˆ›å»º Retrofit å¯¹è±¡</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-keyword">val</span> retrofit = Retrofit.Builder()<br>    .baseUrl(BASE_URL)<br>    .addConverterFactory(GsonConverterFactory.create())<br>    .build()<br></code></pre></td></tr></table></figure><h3 id="å‘é€è¯·æ±‚"><a href="#å‘é€è¯·æ±‚" class="headerlink" title="å‘é€è¯·æ±‚"></a>å‘é€è¯·æ±‚</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-keyword">val</span> mainPageApi = retrofit.create(MainPageApi::<span class="hljs-keyword">class</span>.java)<br>mainPageApi.getMainPageInfoWithCall().enqueue(<span class="hljs-keyword">object</span>:retrofit2.Callback&lt;MainPageInfo&gt;&#123;<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onResponse</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        call: <span class="hljs-type">Call</span>&lt;<span class="hljs-type">MainPageInfo</span>&gt;,</span></span><br><span class="hljs-params"><span class="hljs-function">        response: <span class="hljs-type">retrofit2</span>.<span class="hljs-type">Response</span>&lt;<span class="hljs-type">MainPageInfo</span>&gt;</span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span> &#123;<br>        Log.e(<span class="hljs-string">&quot;KotlinActivity&quot;</span>,<span class="hljs-string">&quot;getMainPageInfoWithCall onResponse&quot;</span>)<br>    &#125;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onFailure</span><span class="hljs-params">(call: <span class="hljs-type">Call</span>&lt;<span class="hljs-type">MainPageInfo</span>&gt;, t: <span class="hljs-type">Throwable</span>)</span></span> &#123;<br>        Log.e(<span class="hljs-string">&quot;KotlinActivity&quot;</span>,<span class="hljs-string">&quot;getMainPageInfoWithCall onFailure&quot;</span>)<br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰ä½¿ç”¨ä»»ä½•åç¨‹ç›¸å…³çš„ç‰¹æ€§ï¼Œå¹¶ä¸”æ²¡æœ‰éƒ½å¾—å†™å›è°ƒï¼Œå’Œ Java å†™èµ·æ¥ä¹Ÿæ²¡å•¥å·®åˆ«ã€‚</p><h3 id="æ”¯æŒåç¨‹"><a href="#æ”¯æŒåç¨‹" class="headerlink" title="æ”¯æŒåç¨‹"></a>æ”¯æŒåç¨‹</h3><p>æˆ‘ä»¬å¯¹æ¥å£çš„å£°æ˜åŠ ä¸Š<code>suspend</code>ä¿®é¥°</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-meta">@GET(<span class="hljs-string">&quot;app_interface/home_pag/&quot;</span>)</span><br><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getMainPageInfoWithRow</span><span class="hljs-params">()</span></span>:Call&lt;MainPageInfo&gt;<br></code></pre></td></tr></table></figure><p>è¿™æ—¶å€™ä¸Šé¢ç›´æ¥å‘é€è¯·æ±‚çš„ä»£ç ä¼šæŠ¥é”™ï¼š<br><img src="/image/Android/kotlin/suspend_retrofit_error.png" alt="suspend_retrofit_error"><br>æç¤ºæˆ‘ä»¬éœ€è¦åœ¨åç¨‹ä¸­è°ƒç”¨ï¼Œè¿™ä¹Ÿç®€å•ï¼Œkotlin å¯¹ activity æœ‰ä¸ªæ‰©å±•çš„<code>lifecycleScope</code>æˆå‘˜å˜é‡ï¼Œç¨å¾®ä¿®æ”¹ä¸€ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin">lifecycleScope.launch(Dispatchers.IO) &#123;<br>  mainPageApi.getMainPageInfoWithCall().enqueue(.....)<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ä¹ æƒ¯è¿™ä¹ˆå†™çš„è¯ï¼Œå¯ä»¥å°†ç½‘ç»œè¯·æ±‚å†™åœ¨ ViewModel ä¸­ï¼Œé€šè¿‡ LiveDataåˆ›å»ºä¸€ä¸ªå¯è§‚å¯Ÿå¯¹è±¡å®ç°æ•°æ®ç»‘å®šã€‚</p><p>ä¸å‡ºæ„å¤–çš„å‡ºæ„å¤–äº†ï¼Œåº”ç”¨å´©æºƒï¼Œé”™è¯¯ä¿¡æ¯</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml">java.lang.IllegalArgumentException: Suspend functions should not return Call, as they already execute asynchronously.<br>Change its return type to class com.huangyuanlove.androidtest.kotlin.retrofit.MainPageInfo<br></code></pre></td></tr></table></figure><p>æ„æ€æ˜¯åœ¨åç¨‹ä¸­å‘èµ·è¯·æ±‚å·²ç»æ˜¯å¼‚æ­¥çš„äº†ï¼Œä¸éœ€è¦å†è¿”å› Call å¯¹è±¡äº†ï¼Œç›´æ¥è¿”å›å¯¹åº”çš„å®ä½“å³å¯ã€‚<br>ç®€å•ï¼Œä¿®æ”¹ä¸€ä¸‹æ¥å£å£°æ˜</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-meta">@GET(<span class="hljs-string">&quot;app_interface/home_page/&quot;</span>)</span><br><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getMainPageInfoWithRow</span><span class="hljs-params">()</span></span>:MainPageInfo<br></code></pre></td></tr></table></figure><p>ç„¶åä¿®æ”¹ä¸€ä¸‹è¯·æ±‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin">lifecycleScope.launch(Dispatchers.IO) &#123;<br>  <span class="hljs-keyword">val</span> mainPageInfo = mainPageApi.getMainPageInfo()<br>  withContext(Dispatchers.Main) &#123;<br>    refreshUI(mainPageInfo)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œä¸€ä¸‹ï¼Œä¸€åˆ‡æ­£å¸¸ã€‚æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹æ¥å£ï¼Œè¯·æ±‚ä¸€ä¸ªä¸å­˜åœ¨çš„åœ°å€ï¼Œä¼šè¿”å›404ï¼Œä¸å‡ºæ„å¤–ï¼Œåº”ç”¨è¿˜æ˜¯å´©æºƒ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml">retrofit2.HttpException: HTTP 404 <br>at retrofit2.KotlinExtensions$await$2$2.onResponse(KotlinExtensions.kt:53)<br>at retrofit2.OkHttpCall$1.onResponse(OkHttpCall.java:164)<br>at okhttp3.internal.connection.RealCall$AsyncCall.run(RealCall.kt:519)<br>at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)<br>at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641)<br>at java.lang.Thread.run(Thread.java:929)<br>Suppressed: kotlinx.coroutines.internal.DiagnosticCoroutineContextException: [StandaloneCoroutine&#123;Cancelling&#125;@ffa6ad2, Dispatchers.IO]<br></code></pre></td></tr></table></figure><p>å“¦~å¼‚å¸¸æ²¡æœ‰å¤„ç†ï¼Œç²—æš´ç‚¹ï¼Œç›´æ¥ try-catchï¼Œkotlin ä¸­è¿˜æœ‰<code>runCatching</code>è¿™ä¸ªè¯­æ³•ç³–</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-keyword">val</span> mainPageInfoRow = runCatching &#123; mainPageApi.getMainPageInfoWithRow() &#125;<br><span class="hljs-keyword">if</span> (mainPageInfoRow.isFailure) &#123;<br>    ToastUtils.showToast(<span class="hljs-string">&quot;è¯·æ±‚å¤±è´¥&quot;</span>)<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (mainPageInfoRow.isSuccess) &#123;<br>    ToastUtils.showToast(<span class="hljs-string">&quot;è¯·æ±‚æˆåŠŸ&quot;</span>)<br>    withContext(Dispatchers.Main) &#123;<br>        <span class="hljs-keyword">if</span> (mainPageInfoRow.getOrNull() == <span class="hljs-literal">null</span>) &#123;<br>            ToastUtils.showToast(<span class="hljs-string">&quot;è¯·æ±‚ç»“æœä¸ºç©º&quot;</span>)<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            refreshViewWithLaunch(mainPageInfoRow.getOrNull()!!)<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬ä¼šç”¨<code>HTTPçŠ¶æ€ç </code>æ¥è¡¨ç¤ºä¸€äº›ä¸šåŠ¡ä¸Šé€»è¾‘é”™è¯¯ï¼Œå¹¶ä¸”ä¸åŒçš„çŠ¶æ€ç è¿”å›çš„ JSON ç»“æ„è¿˜å¯èƒ½ä¸ä¸€æ ·ã€‚ åˆ«é—®ä¸ºå•¥è¦è¿™ä¹ˆæï¼Œåº”è¯¥æ˜¯HTTP çŠ¶æ€ç å°±åº”è¯¥è¡¨ç¤ºç½‘ç»œè¯·æ±‚çš„çŠ¶æ€ï¼Œä¸šåŠ¡çŠ¶æ€åº”è¯¥æ”¾åœ¨è¿”å›çš„æ•°æ®ä¸­çº¦å®šå­—æ®µæ¥å¤„ç†ã€‚é—®å°±æ˜¯15å¹´çš„è€ä»£ç ï¼Œä¹‹å‰å°±æ˜¯è¿™ä¹ˆæçš„ï¼Œå¹¶ä¸”å¤§èŒƒå›´åº”ç”¨ï¼Œæ¶‰åŠåˆ°çš„éƒ¨é—¨ã€ä¸šåŠ¡å åŠæ•°ä»¥ä¸Šã€‚<br>è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰<code>CallAdapter</code>äº†</p><h3 id="è‡ªå®šä¹‰-CallAdapter"><a href="#è‡ªå®šä¹‰-CallAdapter" class="headerlink" title="è‡ªå®šä¹‰ CallAdapter"></a>è‡ªå®šä¹‰ CallAdapter</h3><p>è¿™æ—¶å€™å°±åº”è¯¥ç¿»ä¸€ä¸‹æºç äº†ï¼Œåœ¨<code>example</code>æœ‰ä¸ª<code>ErrorHandlingAdapter.java</code>,è·¯å¾„åœ¨<a href="https://github.com/square/retrofit/blob/trunk/samples/src/main/java/com/example/retrofit/ErrorHandlingAdapter.java">samples&#x2F;src&#x2F;main&#x2F;java&#x2F;com&#x2F;example&#x2F;retrofit&#x2F;ErrorHandlingAdapter.java</a>ã€‚<br>æˆ‘ä»¬æ¥ä»¿å†™ä¸€ä¸‹ï¼Œæœ€å…³é”®çš„ç‚¹åœ¨å®ç°è‡ªå·±çš„ Call ç±»çš„æ—¶å€™ï¼Œå¯¹callback çš„å¤„ç†ã€‚</p><h4 id="å®šä¹‰ä¸åŒçš„è¿”å›çŠ¶æ€"><a href="#å®šä¹‰ä¸åŒçš„è¿”å›çŠ¶æ€" class="headerlink" title="å®šä¹‰ä¸åŒçš„è¿”å›çŠ¶æ€"></a>å®šä¹‰ä¸åŒçš„è¿”å›çŠ¶æ€</h4><p>ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºå¯†é—­ç±»ï¼Œæ¥è¡¨ç¤ºä¸åŒçš„çŠ¶æ€ï¼Œè¿™é‡Œæš‚ä¸”å®šä¹‰äº†ä¸‰ç§æƒ…å†µ</p><ul><li>Success:HTTPçŠ¶æ€ç åœ¨<code>[200,300)</code>è¿™ä¸ªåŒºé—´</li><li>NetError:HTTPçŠ¶æ€ç ä¸åœ¨<code>[200,300)</code>è¿™ä¸ªåŒºé—´</li><li>UnknownError:å…¶ä»–é”™è¯¯</li></ul><p>sealed class NetworkResponse&lt;out T : Any, out U : Any&gt; {<br>    data class Success<T : Any>(val body: T) : NetworkResponse&lt;T, Nothing&gt;()<br>    data class NetError(val httpCode:Int?,val errorMsg:String?,val exception: Throwable?) : NetworkResponse&lt;Nothing, Nothing&gt;()<br>    data class UnknownError(val error: Throwable?) : NetworkResponse&lt;Nothing, Nothing&gt;()<br>}</p><h4 id="åˆ›å»ºè‡ªå·±çš„Callç±»"><a href="#åˆ›å»ºè‡ªå·±çš„Callç±»" class="headerlink" title="åˆ›å»ºè‡ªå·±çš„Callç±»"></a>åˆ›å»ºè‡ªå·±çš„Callç±»</h4><p>è¿™é‡Œä¸ºäº†ç®€åŒ–æ–¹ä¾¿ï¼Œé™¤äº†<code>enqueue</code>ä¹‹å¤–å¿…é¡»é‡å†™çš„æ–¹æ³•ï¼Œéƒ½æ˜¯ç›´æ¥è°ƒç”¨<code>delegate</code>å¯¹åº”çš„æ–¹æ³•</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-keyword">internal</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NetworkResponseCall</span>&lt;<span class="hljs-type">S : Any, E : Any</span>&gt;</span>(<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> delegate: Call&lt;S&gt;,<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> errorConverter: Converter&lt;ResponseBody, E&gt;<br>) : Call&lt;NetworkResponse&lt;S, E&gt;&gt; &#123;<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">clone</span><span class="hljs-params">()</span></span>: Call&lt;NetworkResponse&lt;S, E&gt;&gt; &#123;<br>        <span class="hljs-keyword">return</span> NetworkResponseCall(delegate.clone(), errorConverter);<br>    &#125;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span></span>: Response&lt;NetworkResponse&lt;S, E&gt;&gt; &#123;<br>        <span class="hljs-keyword">throw</span> UnsupportedOperationException(<span class="hljs-string">&quot;NetworkResponseCall doesn&#x27;t support execute&quot;</span>)<br>    &#125;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isExecuted</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> &#123;<br>        <span class="hljs-keyword">return</span> delegate.isExecuted;<br>    &#125;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">cancel</span><span class="hljs-params">()</span></span> &#123;<br>        delegate.cancel()<br>    &#125;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isCanceled</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> &#123;<br>        <span class="hljs-keyword">return</span> delegate.isCanceled<br>    &#125;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">request</span><span class="hljs-params">()</span></span>: Request &#123;<br>        <span class="hljs-keyword">return</span> delegate.request()<br>    &#125;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">timeout</span><span class="hljs-params">()</span></span>: Timeout &#123;<br>        <span class="hljs-keyword">return</span> delegate.timeout();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯å…³é”®çš„<code>enqueue</code>æ–¹æ³•,åœ¨è¿™é‡Œé¢ï¼Œå°†æ‰€æœ‰çš„è¯·æ±‚éƒ½ç”¨<code>Response.success</code>è¿”å›ï¼Œä¸å†èµ°<code>Response.error</code>.å¹¶ä¸”æ ¹æ®ä¸åŒçš„ HTTP çŠ¶æ€ç ï¼Œè¿”å›çš„æ•°æ®ç­‰æ¡ä»¶è½¬æˆä¸€å¼€å§‹å®šä¹‰çš„å¯†é—­ç±»ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><br><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">enqueue</span><span class="hljs-params">(callback: <span class="hljs-type">Callback</span>&lt;<span class="hljs-type">NetworkResponse</span>&lt;<span class="hljs-type">S</span>, E&gt;&gt;)</span></span> &#123;<br>    <span class="hljs-keyword">return</span> delegate.enqueue(<span class="hljs-keyword">object</span> : Callback&lt;S&gt; &#123;<br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onResponse</span><span class="hljs-params">(call: <span class="hljs-type">Call</span>&lt;<span class="hljs-type">S</span>&gt;, response: <span class="hljs-type">Response</span>&lt;<span class="hljs-type">S</span>&gt;)</span></span> &#123;<br>            <span class="hljs-keyword">val</span> body = response.body()<br>            <span class="hljs-keyword">val</span> code = response.code()<br>            <span class="hljs-keyword">val</span> error = response.errorBody()<br><br>            <span class="hljs-keyword">if</span> (response.isSuccessful) &#123;<br>                <span class="hljs-keyword">if</span> (body != <span class="hljs-literal">null</span>) &#123;<br>                    callback.onResponse(<br>                        <span class="hljs-keyword">this</span><span class="hljs-symbol">@NetworkResponseCall</span>,<br>                        Response.success(NetworkResponse.Success(body))<br>                    )<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <br>                    callback.onResponse(<br>                        <span class="hljs-keyword">this</span><span class="hljs-symbol">@NetworkResponseCall</span>,<br>                        Response.success(NetworkResponse.UnknownError(<span class="hljs-literal">null</span>))<br>                    )<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">val</span> errorBody = <span class="hljs-keyword">when</span> &#123;<br>                    error == <span class="hljs-literal">null</span> -&gt; <span class="hljs-literal">null</span><br>                    error.contentLength() == <span class="hljs-number">0L</span> -&gt; <span class="hljs-literal">null</span><br>                    <span class="hljs-keyword">else</span> -&gt; NetworkResponse.NetError(code, error.toString(), <span class="hljs-literal">null</span>)<br>                &#125;<br>                <span class="hljs-keyword">if</span> (errorBody != <span class="hljs-literal">null</span>) &#123;<br>                    callback.onResponse(<br>                        <span class="hljs-keyword">this</span><span class="hljs-symbol">@NetworkResponseCall</span>,<br>                        Response.success(errorBody)<br>                    )<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    callback.onResponse(<br>                        <span class="hljs-keyword">this</span><span class="hljs-symbol">@NetworkResponseCall</span>,<br>                        Response.success(NetworkResponse.UnknownError(<span class="hljs-literal">null</span>))<br>                    )<br>                &#125;<br>            &#125;<br><br><br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onFailure</span><span class="hljs-params">(call: <span class="hljs-type">Call</span>&lt;<span class="hljs-type">S</span>&gt;, t: <span class="hljs-type">Throwable</span>)</span></span> &#123;<br>            <span class="hljs-keyword">val</span> networkResponse = <span class="hljs-keyword">when</span> (t) &#123;<br>                <span class="hljs-keyword">is</span> Exception -&gt; NetworkResponse.NetError(<span class="hljs-literal">null</span>,<span class="hljs-literal">null</span>,t)<br>                <span class="hljs-keyword">else</span> -&gt; NetworkResponse.UnknownError(t)<br>            &#125;<br>            callback.onResponse(<span class="hljs-keyword">this</span><span class="hljs-symbol">@NetworkResponseCall</span>, Response.success(networkResponse))<br>        &#125;<br><br>    &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åˆ›å»º-CallAdapter"><a href="#åˆ›å»º-CallAdapter" class="headerlink" title="åˆ›å»º CallAdapter"></a>åˆ›å»º CallAdapter</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NetworkResponseAdapter</span>&lt;<span class="hljs-type">S : Any, E : Any</span>&gt;</span>(<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> successType: Type,<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> errorBodyConverter: Converter&lt;ResponseBody, E&gt;<br>) : CallAdapter&lt;S, Call&lt;NetworkResponse&lt;S, E&gt;&gt;&gt; &#123;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">responseType</span><span class="hljs-params">()</span></span>: Type = successType<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">adapt</span><span class="hljs-params">(call: <span class="hljs-type">Call</span>&lt;<span class="hljs-type">S</span>&gt;)</span></span>: Call&lt;NetworkResponse&lt;S, E&gt;&gt; &#123;<br>        <span class="hljs-keyword">return</span> NetworkResponseCall(call, errorBodyConverter)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åˆ›å»ºCallAdapterFactory"><a href="#åˆ›å»ºCallAdapterFactory" class="headerlink" title="åˆ›å»ºCallAdapterFactory"></a>åˆ›å»ºCallAdapterFactory</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span>  <span class="hljs-title">NetworkResponseAdapterFactory</span>:<span class="hljs-type">CallAdapter.Factory</span></span>()&#123;<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">get</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        returnType: <span class="hljs-type">Type</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">        annotations: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">out</span> <span class="hljs-type">Annotation</span>&gt;,</span></span><br><span class="hljs-params"><span class="hljs-function">        retrofit: <span class="hljs-type">Retrofit</span></span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span>: CallAdapter&lt;*, *&gt;? &#123;<br>        <span class="hljs-comment">// suspend functions wrap the response type in `Call`</span><br>        <span class="hljs-keyword">if</span>(Call::<span class="hljs-keyword">class</span>.java != getRawType(returnType))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span><br>        &#125;<br>        check(returnType <span class="hljs-keyword">is</span> ParameterizedType)&#123;<br>            <span class="hljs-string">&quot;return type must be parameterized as Call&lt;NetworkResponse&lt;&lt;Foo&gt;&gt; or Call&lt;NetworkResponse&lt;out Foo&gt;&gt;&quot;</span><br>        &#125;<br>        <span class="hljs-comment">// get the response type inside the `Call` type</span><br>        <span class="hljs-keyword">val</span> responseType = getParameterUpperBound(<span class="hljs-number">0</span>,returnType)<br>        <span class="hljs-comment">// if the response type is not ApiResponse then we can&#x27;t handle this type, so we return null</span><br>        <span class="hljs-keyword">if</span>(getRawType(responseType) != NetworkResponse::<span class="hljs-keyword">class</span>.java)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span><br>        &#125;<br><br><br>        <span class="hljs-comment">// the response type is ApiResponse and should be parameterized</span><br>        check(responseType <span class="hljs-keyword">is</span> ParameterizedType) &#123; <span class="hljs-string">&quot;Response must be parameterized as NetworkResponse&lt;Foo&gt; or NetworkResponse&lt;out Foo&gt;&quot;</span> &#125;<br><br>        <span class="hljs-keyword">val</span> successBodyType = getParameterUpperBound(<span class="hljs-number">0</span>, responseType)<br>        <span class="hljs-keyword">val</span> errorBodyType = getParameterUpperBound(<span class="hljs-number">1</span>, responseType)<br><br>        <span class="hljs-keyword">val</span> errorBodyConverter =<br>            retrofit.nextResponseBodyConverter&lt;Any&gt;(<span class="hljs-literal">null</span>, errorBodyType, annotations)<br><br>        <span class="hljs-keyword">return</span> NetworkResponseAdapter&lt;Any, Any&gt;(successBodyType, errorBodyConverter)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ„å»º-Retrofit-å®ä¾‹æ—¶æ·»åŠ è¯¥-Factory"><a href="#æ„å»º-Retrofit-å®ä¾‹æ—¶æ·»åŠ è¯¥-Factory" class="headerlink" title="æ„å»º Retrofit å®ä¾‹æ—¶æ·»åŠ è¯¥ Factory"></a>æ„å»º Retrofit å®ä¾‹æ—¶æ·»åŠ è¯¥ Factory</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-keyword">val</span> retrofit = Retrofit.Builder()<br>    .baseUrl(BASE_URL)<br>    .addCallAdapterFactory(NetworkResponseAdapterFactory())<br>    .addConverterFactory(GsonConverterFactory.create())<br>    .build()<br></code></pre></td></tr></table></figure><h4 id="ä½¿ç”¨typealiasç®€åŒ–è¿”å›ç±»å‹-å¯é€‰"><a href="#ä½¿ç”¨typealiasç®€åŒ–è¿”å›ç±»å‹-å¯é€‰" class="headerlink" title="ä½¿ç”¨typealiasç®€åŒ–è¿”å›ç±»å‹(å¯é€‰)"></a>ä½¿ç”¨typealiasç®€åŒ–è¿”å›ç±»å‹(å¯é€‰)</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-keyword">data</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HttpError</span></span>(<span class="hljs-keyword">val</span> httpCode:<span class="hljs-built_in">Int</span>,<span class="hljs-keyword">val</span> errorMsg:String?,<span class="hljs-keyword">val</span> exception: Throwable?)<br><span class="hljs-comment">// before</span><br><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">DemoApiService</span> </span>&#123;<br>    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">mainPageInfo</span><span class="hljs-params">()</span></span>: NetworkResponse&lt;MainPageInfo, HttpError&gt;<br>&#125;<br><span class="hljs-comment">// after</span><br><span class="hljs-keyword">typealias</span> GenericResponse&lt;S&gt; = NetworkResponse&lt;S, HttpError&gt;<br><br><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ApiService</span> </span>&#123;<br>    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">mainPageInfo</span><span class="hljs-params">()</span></span>: GenericResponse&lt;MainPageInfo&gt;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>åœ¨ Activity ä¸­ç›´æ¥ä½¿ç”¨lifecycleScopeå¯åŠ¨åç¨‹ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin">lifecycleScope.launch(Dispatchers.IO) &#123;<br>    Log.e(<span class="hljs-string">&quot;KotlinActivity&quot;</span>, <span class="hljs-string">&quot;lifecycleScope.launch --&gt;&gt;&quot;</span> + Thread.currentThread().name);<br>    <span class="hljs-keyword">val</span> mainPageInfo = mainPageApi.getMainPageInfo()<br><br>    withContext(Dispatchers.Main) &#123;<br>        Log.e(<br>            <span class="hljs-string">&quot;KotlinActivity&quot;</span>,<br>            <span class="hljs-string">&quot;withContext(Dispatchers.Main) --&gt;&gt;&quot;</span> + Thread.currentThread().name<br>        );<br>        <span class="hljs-keyword">when</span>(mainPageInfo)&#123;<br><br>            <span class="hljs-keyword">is</span> NetworkResponse.NetError -&gt; Log.e(<span class="hljs-string">&quot;KotlinActivity&quot;</span>,<br>                <span class="hljs-string">&quot;NetError-&gt;<span class="hljs-variable">$mainPageInfo</span>&quot;</span><br>            )<br>            <span class="hljs-keyword">is</span> NetworkResponse.Success -&gt;  refreshViewWithLaunch(mainPageInfo.body)<br>            <span class="hljs-keyword">is</span> NetworkResponse.UnknownError -&gt; Log.e(<span class="hljs-string">&quot;KotlinActivity&quot;</span>,<span class="hljs-string">&quot;UnknownError-&gt;&quot;</span> + mainPageInfo.error)<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ–è€…åœ¨ ViewModel ä¸­å€ŸåŠ© LiveData å°†è¿”å›å€¼è½¬åŒ–ä¸ºå¯è§‚å¯Ÿå¯¹è±¡</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainPageInfoViewModel</span>:<span class="hljs-type">ViewModel</span></span>() &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _mainPageInfo  = MutableLiveData&lt;MainPageInfo&gt;()<br>    <span class="hljs-keyword">val</span> mainPageInfo: LiveData&lt;MainPageInfo&gt; <span class="hljs-keyword">get</span>() = _mainPageInfo<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getMainPageInfo</span><span class="hljs-params">()</span></span>&#123;<br>        viewModelScope.launch(Dispatchers.IO)&#123;<br>            <span class="hljs-keyword">val</span> result = mainPageApi.getMainPageInfo()<br>            withContext(Dispatchers.Main)&#123;<br>                <span class="hljs-keyword">when</span>(result)&#123;<br>                    <span class="hljs-keyword">is</span> NetworkResponse.NetError -&gt; Log.e(<span class="hljs-string">&quot;MainPageInfoViewModel&quot;</span>,<br>                        <span class="hljs-string">&quot;NetError-&gt;<span class="hljs-variable">$result</span>&quot;</span><br>                    )<br>                    <span class="hljs-keyword">is</span> NetworkResponse.Success -&gt;  _mainPageInfo.value =  result.body<br>                    <span class="hljs-keyword">is</span> NetworkResponse.UnknownError -&gt; Log.e(<span class="hljs-string">&quot;MainPageInfoViewModel&quot;</span>,<span class="hljs-string">&quot;UnknownError-&gt;&quot;</span> + result.error)<br>                &#125;<br><br>            &#125;<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ Activity ä¸­ä½¿ç”¨</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin">mainPageInfoModel = ViewModelProvider(<span class="hljs-keyword">this</span>).<span class="hljs-keyword">get</span>(MainPageInfoViewModel::<span class="hljs-keyword">class</span>.java)<br>mainPageInfoModel.mainPageInfo.observe(<span class="hljs-keyword">this</span>, Observer &#123;<br>    <span class="hljs-keyword">if</span> (it != <span class="hljs-literal">null</span>) &#123;<br>        Log.e(<span class="hljs-string">&quot;KotlinActivity&quot;</span>, <span class="hljs-string">&quot;viewmodelè·å–ç»“æœæˆåŠŸ&quot;</span>)<br>        refreshViewWithViewModelResult(it);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        Log.e(<span class="hljs-string">&quot;KotlinActivity&quot;</span>, <span class="hljs-string">&quot;viewmodelè·å–ç»“æœä¸ºç©º&quot;</span>)<br>    &#125;<br>&#125;)<br>mainPageInfoModel.getMainPageInfo()<br></code></pre></td></tr></table></figure><p>æš‚æ—¶å…ˆè¿™æ ·å§ï¼ŒåŸºæœ¬ä¸Šå¤Ÿç”¨äº†</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Kotlin</tag>
      
      <tag>Retrofit</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¸¿è’™ArkUI-X è·¨å¹³å°é€šä¿¡ï¼šä»å…¥åœŸåˆ°å¤æ´»</title>
    <link href="/2024/03/27/%E9%B8%BF%E8%92%99ArkUI-X-%E8%B7%A8%E5%B9%B3%E5%8F%B0%E9%80%9A%E4%BF%A1%EF%BC%9A%E4%BB%8E%E5%85%A5%E5%9C%9F%E5%88%B0%E5%A4%8D%E6%B4%BB/"/>
    <url>/2024/03/27/%E9%B8%BF%E8%92%99ArkUI-X-%E8%B7%A8%E5%B9%B3%E5%8F%B0%E9%80%9A%E4%BF%A1%EF%BC%9A%E4%BB%8E%E5%85%A5%E5%9C%9F%E5%88%B0%E5%A4%8D%E6%B4%BB/</url>
    
    <content type="html"><![CDATA[<hr><p>2024.01.31 æ›´æ–°<br>åœ¨ä¸Šä¸€ç¯‡ <a href="https://juejin.cn/post/7327910163628294154">é¸¿è’™è·¨å¹³å° ArkUI-Xä»å…¥é—¨åˆ°å…¥åœŸ </a>ä¸­æåˆ°åˆ›å»º Bridge å¯¹è±¡æ—¶å¤±è´¥çš„é—®é¢˜ï¼Œåœ¨æœ¬æ–‡ä¸­æåˆ°çš„é—®é¢˜åˆé‡æ–°éªŒè¯äº†å‡ æ¬¡ï¼Œå’¨è¯¢äº†ä¸€ä¸‹ç›¸å…³äººå‘˜ï¼Œç»“è®ºæ˜¯è¿™æ ·çš„</p><ol><li>åœ¨ Arkui-X ä¸­ï¼Œå¦‚æœ Bridge å¯¹è±¡å£°æ˜ä¸ºæˆå‘˜å˜é‡å¹¶ä¸”ç«‹å³åˆ›å»ºï¼Œè¿™æ—¶å€™ preview ä¼šç™½å±ï¼Œæ˜¯åŠ è½½ç•Œé¢æ—¶å°±æŒ‚äº†ï¼Œå› ä¸ºè¿™ä¸ªbridgeå¯¹è±¡ï¼Œæ˜¯éœ€è¦ native ä¾§çš„æ–‡ä»¶æ”¯æŒçš„ï¼Œæ¯”å¦‚Androidä¸­çš„libbridge.so(é›†æˆäº§ç‰©åˆ° Android å·¥ç¨‹æ—¶å¤åˆ¶è¿‡å»çš„)ã€‚è¿™æ—¶å€™é›†æˆåˆ° Android å·¥ç¨‹ä¸­æ˜¯æ­£å¸¸è¿è¡Œçš„ã€‚</li><li>DevEco ä¸­çš„ preview ç›¸å½“äºçº¯é¸¿è’™ç³»ç»Ÿ(HarmonyOS next),åœ¨çº¯é¸¿è’™ç³»ç»Ÿä¸­æ˜¯æ— æ³•ä½¿ç”¨Bridge çš„ï¼Œå› ä¸ºçº¯é¸¿è’™ä¸Šæ²¡æœ‰è¿™ä¸ª so åº“ã€‚æ‰€ä»¥åœ¨åˆ›å»ºè¿™ä¸ª Bridge å¯¹è±¡çš„æ—¶å€™éœ€è¦åˆ¤æ–­ä¸€ä¸‹æ˜¯ä¸æ˜¯è·¨å¹³å°ï¼Œä¸€èˆ¬ä»deviceInfo.osFullNameåˆ¤æ–­ï¼š<br><code>let osName: string = deviceInfo.osFullName;</code>è·å–å¯¹åº”OSåå­—ï¼Œè¯¥æ¥å£å·²æ”¯æŒè·¨å¹³å°ï¼Œä¸åŒå¹³å°ä¸Šå…¶è¿”å›å€¼å¦‚ä¸‹:</li></ol><ul><li>OpenHarmonyä¸Šï¼ŒosNameç­‰äº<code>OpenHarmony XXX</code></li><li>Androidä¸Šï¼ŒosNameç­‰äº<code>Android XXX</code></li><li>iOSä¸Šï¼ŒosNameç­‰äº<code>iOS XXX</code><br>å…·ä½“æ–‡æ¡£åœ¨è¿™é‡Œ <a href="https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/quick-start/platform-different-introduction.md#%E5%B9%B3%E5%8F%B0%E5%B7%AE%E5%BC%82%E5%8C%96">å¹³å°å·®å¼‚åŒ–</a></li></ul><hr><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>è¯è¯´å‰ä¸¤å¤©åˆšè°ƒç ”äº† ArkUI-X è·¨å¹³å°æ–¹æ¡ˆï¼Œæœ€ç»ˆå¡æ­»åœ¨äº†è·¨å¹³å°å’Œ native é€šä¿¡ä¸Šï¼Œæ–‡ç« åœ¨è¿™é‡Œ<a href="https://juejin.cn/post/7327910163628294154">é¸¿è’™è·¨å¹³å° ArkUI-Xä»å…¥é—¨åˆ°å…¥åœŸ</a>ï¼Œä»Šå¤©åœ¨ç¤¾åŒºçš„å¸®åŠ©ä¸‹è·‘é€šäº†é€šä¿¡æ–¹æ¡ˆï¼Œè¯¥æŒ–å‡ºæ¥å¤æ´»äº†ã€‚<br><strong>æ³¨æ„æ–‡ç« æ‰€è¯´çš„å®˜æ–¹æ˜¯æŒ‡ç¤¾åŒºï¼Œå¹¶ä¸æ˜¯æŒ‡åä¸ºå…¬å¸ï¼Œæ›´ä¸æ˜¯å…¶ä»–</strong></p><h3 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h3><p>è¿™é‡Œåªå¯¹ Android ä¾§è¿›è¡Œäº†å®ç°ï¼ŒiOS ä¾§å› ä¸ºæ²¡æœ‰å®ä½“æœºçš„åŸå› ï¼Œå…ˆæ”¾ä¸€æ”¾ï¼ŒåŸç†éƒ½ä¸€æ ·ï¼Œä»£ç ä¹Ÿå·®ä¸å¤šã€‚å®˜æ–¹æ–‡æ¡£å…ˆæ”¾åœ¨è¿™é‡Œäº† <a href="https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/tutorial/how-to-use-bridge-on-android.md#%E5%B9%B3%E5%8F%B0%E6%A1%A5%E6%8E%A5%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97">å¹³å°æ¡¥æ¥å¼€å‘æŒ‡å—</a></p><blockquote><p>å¹³å°æ¡¥æ¥ç”¨äºå®¢æˆ·ç«¯ï¼ˆArkUIï¼‰å’Œå¹³å°ï¼ˆAndroidæˆ–iOSï¼‰ä¹‹é—´ä¼ é€’æ¶ˆæ¯ï¼Œå³ç”¨äºArkUIä¸å¹³å°åŒå‘æ•°æ®ä¼ é€’ã€ArkUIä¾§è°ƒç”¨å¹³å°çš„æ–¹æ³•ã€å¹³å°è°ƒç”¨ArkUIä¾§çš„æ–¹æ³•ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»Androidå¹³å°ä¸ArkUIäº¤äº’ï¼ŒArkUIä¾§å…·ä½“ç”¨æ³•è¯·å‚è€ƒ<a href="https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/reference/apis/js-apis-bridge.md">Bridge API</a>ï¼ŒAndroidä¾§å‚è€ƒ<a href="https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/reference/arkui-for-android/BridgePlugin.md">BridgePlugin</a>ã€‚</p></blockquote><p>å®˜æ–¹åœ¨ Android ä¾§æä¾›äº†ä¸€ä¸ªæŠ½è±¡ç±»<code>BridgePlugin</code>ï¼Œæˆ‘ä»¬éœ€è¦ç»§æ‰¿å®ƒå®ç°ä¸€äº›æ–¹æ³•æ¥è¿›è¡Œé€šä¿¡ã€‚åœ¨ ArkUI-X ä¾§åŒæ ·æä¾›äº†<code>&#39;@arkui-x.bridge</code>åŒ…æ¥è¿›è¡Œé€šä¿¡ã€‚</p><h4 id="ArkUI-X-ä¾§-Bridge"><a href="#ArkUI-X-ä¾§-Bridge" class="headerlink" title="ArkUI-X ä¾§ Bridge"></a>ArkUI-X ä¾§ Bridge</h4><p>å…ˆçœ‹ä¸‹ArkUI-X ä¾§æä¾›çš„æ–¹æ¡ˆï¼Œå®˜æ–¹æ–‡æ¡£åœ¨è¿™é‡Œ <a href="https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/reference/apis/js-apis-bridge.md#arkui-xbridgedts-%E5%B9%B3%E5%8F%B0%E6%A1%A5%E6%8E%A5">@arkui-x.bridge.d.ts (å¹³å°æ¡¥æ¥)</a>ã€‚<br>åœ¨å®˜æ–¹æä¾›çš„<a href="https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/tutorial/how-to-use-bridge-on-android.md#%E5%9C%BA%E6%99%AF%E7%A4%BA%E4%BE%8B">åœºæ™¯ç¤ºä¾‹ä¸­</a>ä¸­ï¼Œæ˜¯åœ¨é¡µé¢(ä¹Ÿå°±æ˜¯è¢«<code>@Entry</code>è£…é¥°çš„ç±»)ä¸­åˆ›å»ºçš„ï¼Œä½†æ˜¯åœ¨å®è·µä¸­å‘ç°ä¸èƒ½æ­£å¸¸è¿è¡Œï¼Œä¼šåˆ›å»º Bridge å¯¹è±¡æ—¶ä¼šæŠ¥é”™</p><blockquote><p>Error message: Cannot read property createBridge of undefined</p></blockquote><p>æŒ‡å‘äº†<code>private bridgeImpl = bridge.createBridge(&#39;Bridge&#39;);</code>è¿™ä¸€è¡Œä»£ç ï¼Œå‘å®˜æ–¹æäº¤äº† issueï¼Œåœ¨å…¶å¸®åŠ©ä¸‹ï¼Œå°†åˆ›å»º Bridge å¯¹è±¡çš„ä»£ç æ”¾åœ¨äº†å¦å¤–çš„ ets æ–‡ä»¶ä¸­å¯ä»¥æ­£å¸¸è¿è¡Œã€‚</p><h5 id="åˆ›å»º-Bridge"><a href="#åˆ›å»º-Bridge" class="headerlink" title="åˆ›å»º Bridge"></a>åˆ›å»º Bridge</h5><p>å…ˆå¯¼åŒ… <code>import Bridge from &#39;@arkui-x.bridge&#39;;</code><br>å†åˆ›å»º<code> bridgeObj: BridgeObject = Bridge.createBridge(&#39;Bridge&#39;);</code><br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œä¼ å…¥çš„å‚æ•°å€¼éœ€è¦<strong>å’Œ native ä¾§ä¸€è‡´ï¼Œå¦åˆ™æ— æ³•è°ƒç”¨</strong>ã€‚ </p><h4 id="Android-ä¾§-BridgePlugin"><a href="#Android-ä¾§-BridgePlugin" class="headerlink" title="Android ä¾§ BridgePlugin"></a>Android ä¾§ BridgePlugin</h4><p>çœ‹å…ˆ Android ä¾§æä¾›çš„æ–¹æ¡ˆï¼Œå®˜æ–¹æ–‡æ¡£åœ¨è¿™é‡Œ <a href="https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/reference/arkui-for-android/BridgePlugin.md#bridgeplugin-%E5%B9%B3%E5%8F%B0%E6%A1%A5%E6%8E%A5">BridgePlugin (å¹³å°æ¡¥æ¥)</a> ã€‚<br>æš´éœ²çš„ api ä¹Ÿä¸å¤šï¼ŒåŒ…æ‹¬æ„é€ æ–¹æ³•ã€callMethodã€sendMessageï¼Œä¸¤ä¸ªå›è°ƒç›‘å¬ï¼šsetMessageListenerå’ŒsetMethodResultListenerã€‚</p><h5 id="åˆ›å»º-BridgePlugin"><a href="#åˆ›å»º-BridgePlugin" class="headerlink" title="åˆ›å»º BridgePlugin"></a>åˆ›å»º BridgePlugin</h5><p>ä¸€èˆ¬æ¥è®²ï¼Œæˆ‘ä»¬ä¼šè‡ªå·±å†™ä¸ªç±»ç»§æ‰¿<code>BridgePlugin</code>æ¥è¿›è¡Œæ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArkUIBridge</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BridgePlugin</span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ArkUIBridge&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ArkUIBridge</span><span class="hljs-params">(Context context, String bridgeName, <span class="hljs-type">int</span> instanceId)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context, bridgeName, instanceId);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œçš„<code>bridgeName</code>å‚æ•°ï¼Œä¼ å…¥çš„å€¼<strong>å¿…é¡»</strong>ä¸ ArkUI-X ä¾§ä¸€è‡´ï¼Œè‡³äº instanceId åˆ™æ˜¯<code>StageActivity</code>è¿™ä¸ªç”¨æ¥å±•ç¤º ArkUI-X å†…å®¹çš„å®¹å™¨æä¾›çš„æ–¹æ³•ï¼Œå…¶å®ä¹Ÿå°±æ˜¯è°ƒç”¨çš„<code>InstanceIdGenerator.getAndIncrement()</code>ï¼Œå…·ä½“å®ç°å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">package</span> ohos.stage.ability.adapter;<br><br><span class="hljs-keyword">import</span> java.util.concurrent.atomic.AtomicInteger;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InstanceIdGenerator</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">ID_GENERATOR</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">1</span>);<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">InstanceIdGenerator</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAndIncrement</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> ID_GENERATOR.getAndIncrement();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">get</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> ID_GENERATOR.get();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥åœ¨å…¶ä»–ä½ç½®è°ƒç”¨<code>InstanceIdGenerator.get()</code>æ¥è·å–åˆ° idã€‚ä½†éœ€è¦æ³¨æ„ï¼Œæ¯æ¬¡åˆ›å»º ArkUI-X äº§ç‰©çš„å®¹å™¨é¡µé¢ä¹Ÿå°±æ˜¯StageActivityæ—¶ï¼Œè¯¥ id éƒ½ä¼šè‡ªå¢ï¼Œå¦‚æœ id æ— æ³•å¯¹åº”åˆ™æ— æ³•äº’ç›¸é€šä¿¡</p><h4 id="ArkUIä¾§å‘Androidä¾§ä¼ é€’æ•°æ®"><a href="#ArkUIä¾§å‘Androidä¾§ä¼ é€’æ•°æ®" class="headerlink" title="ArkUIä¾§å‘Androidä¾§ä¼ é€’æ•°æ®"></a>ArkUIä¾§å‘Androidä¾§ä¼ é€’æ•°æ®</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-comment">// xxx.ets</span><br>bridgeImpl.<span class="hljs-title function_">sendMessage</span>(<span class="hljs-string">&#x27;text&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>)=&gt;</span>&#123;<br>    <span class="hljs-comment">// ç›‘å¬Androidä¾§çš„å›æ‰§</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;response: &#x27;</span> + res);<br>&#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;error: &#x27;</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));<br>&#125;);<br></code></pre></td></tr></table></figure><p>åœ¨ Android ä¾§æ¥æ”¶æ¶ˆæ¯,åœ¨æ„é€ æ–¹æ³•é‡Œé¢è®¾ç½®ä¸€ä¸‹ç›‘å¬äº‹ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-comment">//ArkUIBridge extends BridgePlugin</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">ArkUIBridge</span><span class="hljs-params">(Context context, String bridgeName, <span class="hljs-type">int</span> instanceId)</span> &#123;<br>    <span class="hljs-built_in">super</span>(context, bridgeName, instanceId);<br>    setMessageListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">IMessageListener</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">onMessage</span><span class="hljs-params">(Object o)</span> &#123;<br>            Log.e(TAG,<span class="hljs-string">&quot;onMessage--&gt;&quot;</span> + o.toString());<br>            <span class="hljs-type">JSONObject</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONObject</span>();<br>            <span class="hljs-keyword">try</span> &#123;<br>                result.put(<span class="hljs-string">&quot;platform&quot;</span>,<span class="hljs-string">&quot;Android&quot;</span>);<br>                result.put(<span class="hljs-string">&quot;result_code&quot;</span>,<span class="hljs-number">0</span>);<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>            <span class="hljs-keyword">return</span> result.toString();<br>        &#125;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessageResponse</span><span class="hljs-params">(Object o)</span> &#123;<br>            Log.e(TAG,<span class="hljs-string">&quot;onMessageResponse--&gt;&quot;</span> + o.toString());<br>        &#125;<br>    &#125;);<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="Androidä¾§å‘ArkUI-Xä¾§ä¼ é€’æ•°æ®"><a href="#Androidä¾§å‘ArkUI-Xä¾§ä¼ é€’æ•°æ®" class="headerlink" title="Androidä¾§å‘ArkUI-Xä¾§ä¼ é€’æ•°æ®"></a>Androidä¾§å‘ArkUI-Xä¾§ä¼ é€’æ•°æ®</h4><p>æ–¹å¼éƒ½ä¸€æ ·ï¼Œéœ€è¦åœ¨ ArkUI-X ä¾§è®¾ç½®ä¸€ä¸‹ç›‘å¬äº‹ä»¶</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-variable language_">this</span>.<span class="hljs-property">bridge</span> = <span class="hljs-title class_">Bridge</span>.<span class="hljs-title function_">createBridge</span>(<span class="hljs-string">&#x27;BridgeCommon&#x27;</span>);<br><span class="hljs-variable language_">this</span>.<span class="hljs-property">bridge</span>!.<span class="hljs-title function_">setMessageListener</span>(<span class="hljs-function">(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) =&gt;</span> &#123;<br><span class="hljs-keyword">if</span> (message) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`receive messageï¼š<span class="hljs-subst">$&#123;message&#125;</span>`</span>);<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">scanResult</span> = message<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ArkUI-X setMessageListener&quot;</span>;<br>&#125;)<br></code></pre></td></tr></table></figure><p>åœ¨ Android ä¾§ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-comment">////ArkUIBridge extends BridgePlugin</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMessageToArkUI</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">JSONObject</span> <span class="hljs-variable">jsonObject</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONObject</span>();<br>    <span class="hljs-keyword">try</span> &#123;<br>        jsonObject.put(<span class="hljs-string">&quot;code&quot;</span>,<span class="hljs-string">&quot;0&quot;</span>);<br>        jsonObject.put(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;æ‰«æç»“æœ&quot;</span>);<br>        jsonObject.put(<span class="hljs-string">&quot;data&quot;</span>,<span class="hljs-string">&quot;scan result from Android&quot;</span>);<br><br>    &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>        e.printStackTrace();<br>    &#125;<br>    Log.e(TAG,<span class="hljs-string">&quot;toScan before sendMessage&quot;</span> );<br>    sendMessage(jsonObject.toString());<br><br>&#125;<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ Android ä¸­è°ƒç”¨ sendMessage æ–¹æ³•æ˜¯æ²¡æœ‰è¿”å›å€¼çš„ï¼ŒArkUI-X ä¾§æ”¶åˆ°æ¶ˆæ¯åçš„è¿”å›å€¼æ˜¯åœ¨<code>setMessageListener</code>çš„<code>onMessageResponse</code>å›è°ƒä¸­æ¥æ”¶çš„ã€‚</p><h4 id="ArkUI-X-ä¾§è°ƒç”¨-Android-ä¾§çš„æ–¹æ³•"><a href="#ArkUI-X-ä¾§è°ƒç”¨-Android-ä¾§çš„æ–¹æ³•" class="headerlink" title="ArkUI-X ä¾§è°ƒç”¨ Android ä¾§çš„æ–¹æ³•"></a>ArkUI-X ä¾§è°ƒç”¨ Android ä¾§çš„æ–¹æ³•</h4><p>åœ¨ ArkUI-X ä¸­</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">getAppVersion</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initBridge</span>();<span class="hljs-comment">//åˆ›å»º bridge å¯¹è±¡</span><br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">params</span>:<span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>,<span class="hljs-title class_">Bridge</span>.<span class="hljs-property">Parameter</span>&gt; =&#123;<br>    <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;xuan&quot;</span>,<br>    <span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">18</span><br>  &#125;<br>  <span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">bridge</span>!.<span class="hljs-title function_">callMethod</span>(<span class="hljs-string">&#x27;getAppVersion&#x27;</span>,params);<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;getAppVersionè¿”å›å€¼ï¼š&#x27;</span> + result)<br>  <span class="hljs-keyword">return</span> result!.<span class="hljs-title function_">toString</span>();<br>&#125;<br><br></code></pre></td></tr></table></figure><p>åœ¨ Android</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getAppVersion</span><span class="hljs-params">(JSONObject params)</span>&#123;<br>    Log.e(TAG,<span class="hljs-string">&quot;getAppVersion from arkui-xï¼Œparams--&gt; &quot;</span>  );<br>    <span class="hljs-keyword">if</span>(params == <span class="hljs-literal">null</span>)&#123;<br>        Log.e(TAG,<span class="hljs-string">&quot;is null&quot;</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        Log.e(TAG,params.toString());<br>    &#125;<br>    <span class="hljs-type">JSONObject</span> <span class="hljs-variable">jsonObject</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONObject</span>();<br>    <span class="hljs-keyword">try</span> &#123;<br>        jsonObject.put(<span class="hljs-string">&quot;version&quot;</span>,BuildConfig.VERSION_NAME);<br>        jsonObject.put(<span class="hljs-string">&quot;buildVersion&quot;</span>,<span class="hljs-string">&quot;getAppVersion(Object params)&quot;</span>);<br><br>    &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>        e.printStackTrace();<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> jsonObject.toString();<br>&#125;<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸¤ä¾§éƒ½ä¸æ”¯æŒæ–¹æ³•é‡è½½ï¼Œåœ¨ Android ä¾§æ˜¯é€šè¿‡ HashMap ä¿å­˜çš„åœ¨ BridgePlugin ä¸­çš„æ–¹æ³•å¹¶ä¸”æ˜¯ä»¥æ–¹æ³•åä¸º keyï¼Œjava.lang.reflect.Methodä¸ºå€¼ã€‚åœ¨ Android ä¾§çš„æ–¹æ³•ä¼šè¢«è‡ªåŠ¨æ³¨å†Œï¼Œä¸éœ€è¦æˆ‘ä»¬è°ƒç”¨ä»£ç æ³¨å†Œã€‚</p><h4 id="Android-ä¾§è°ƒç”¨-ArkUI-X-ä¾§-çš„æ–¹æ³•"><a href="#Android-ä¾§è°ƒç”¨-ArkUI-X-ä¾§-çš„æ–¹æ³•" class="headerlink" title="Android ä¾§è°ƒç”¨ ArkUI-X ä¾§ çš„æ–¹æ³•"></a>Android ä¾§è°ƒç”¨ ArkUI-X ä¾§ çš„æ–¹æ³•</h4><p>åœ¨ ArkUI-X ä¸­ï¼Œéœ€è¦è‡ªå·±è°ƒç”¨registerMethodæ–¹æ³•æ¥æ³¨å†Œä¾› native è°ƒç”¨çš„æ–¹æ³•ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-comment">//æ–¹æ³•å£°æ˜</span><br><span class="hljs-title function_">getString</span>(parameters?: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>,<span class="hljs-title class_">Bridge</span>.<span class="hljs-property">Message</span>&gt;):<span class="hljs-title class_">Bridge</span>.<span class="hljs-property">ResultValue</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`----è°ƒç”¨ getStringï¼šparameters--&gt;<span class="hljs-subst">$&#123;<span class="hljs-built_in">JSON</span>.stringify(parameters)&#125;</span>`</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;call js getString success&#x27;</span>;<br>&#125;<br><span class="hljs-comment">//æ³¨å†Œæ–¹æ³•</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">bridge</span>!.<span class="hljs-title function_">registerMethod</span>(&#123;<span class="hljs-attr">name</span>:<span class="hljs-string">&quot;getString&quot;</span>,<span class="hljs-attr">method</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">getString</span>&#125;)<br></code></pre></td></tr></table></figure><p>åœ¨ Android ä¾§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-type">JSONObject</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONObject</span>();<br><span class="hljs-keyword">try</span> &#123;<br>    params.put(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;xuan&quot;</span>);<br>    params.put(<span class="hljs-string">&quot;age&quot;</span>,<span class="hljs-number">18</span>);<br>&#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>    e.printStackTrace();<br>&#125;<br>Object[] paramObject = &#123;params&#125;;<br><span class="hljs-type">MethodData</span> <span class="hljs-variable">methodData</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MethodData</span>(<span class="hljs-string">&quot;getString&quot;</span>, paramObject);<br>callMethod(methodData);<br></code></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼ŒAndroid è°ƒç”¨ ArkUI çš„æ–¹æ³•å¹¶æ²¡æœ‰è¿”å›å€¼ï¼Œéœ€è¦åœ¨<code>setMethodResultListener</code>çš„<code>onSuccess</code>æ–¹æ³•ä¸­è·å–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-comment">//è®¾ç½®è°ƒç”¨ ArkUI-X æ–¹æ³•çš„ç»“æœå›è°ƒ</span><br>setMethodResultListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">IMethodResult</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(Object o)</span> &#123;<br>        Log.e(TAG,<span class="hljs-string">&quot;IMethodResult#onSuccess--&gt;&quot;</span> +o.toString());<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(String s, <span class="hljs-type">int</span> i, String s1)</span> &#123;<br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMethodCancel</span><span class="hljs-params">(String s)</span> &#123;<br><br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><h4 id="BridgePlugin-ä¸­æä¾›ç»™-ArkUI-X-è°ƒç”¨çš„æ–¹æ³•ä¸æ”¯æŒæ–¹æ³•é‡è½½"><a href="#BridgePlugin-ä¸­æä¾›ç»™-ArkUI-X-è°ƒç”¨çš„æ–¹æ³•ä¸æ”¯æŒæ–¹æ³•é‡è½½" class="headerlink" title="BridgePlugin ä¸­æä¾›ç»™ ArkUI-X è°ƒç”¨çš„æ–¹æ³•ä¸æ”¯æŒæ–¹æ³•é‡è½½"></a>BridgePlugin ä¸­æä¾›ç»™ ArkUI-X è°ƒç”¨çš„æ–¹æ³•ä¸æ”¯æŒæ–¹æ³•é‡è½½</h4><p>åŸå› ä¸Šé¢ä¹Ÿè¯´äº†ï¼Œæ˜¯å› ä¸ºä¿å­˜çš„æ—¶å€™æ˜¯ç”¨æ–¹æ³•åä½œä¸º key ä¿å­˜åœ¨ HashMap ä¸­çš„ï¼Œé‡è½½ä¹Ÿæ²¡ç”¨ï¼Œè™½ç„¶å†™äº†ä¸æŠ¥é”™ï¼Œä½†ç»“æœä¸ä¿è¯ã€‚ä¹Ÿçœ‹ä¸€ä¸‹ä¸ºå•¥ Android ä¸ç”¨è‡ªå·±å†™ä»£ç æ³¨å†Œä¾› ArkUI-Xè°ƒç”¨çš„æ–¹æ³•ã€‚<br>åœ¨<code>ohos.ace.adapter.capability.bridge.BridgePlugin</code>è¿™ä¸ªç±»ä¸­ï¼Œé‡ç‚¹å…³æ³¨<code>HashMap&lt;String, Method&gt; methodsMap_</code>è¿™ä¸ªæˆå‘˜å˜é‡å’Œè¿™å‡ ä¸ªæ–¹æ³•ï¼š  </p><ul><li>protected Object jsCallMethod(Object object, MethodData methodData) </li><li>private Method findMethod(String methodName)</li><li>private void registerMethod(String methodName, Method methods)</li></ul><p>å½“ ArkUI-X è°ƒç”¨ Android æ–¹æ³•æ—¶ï¼Œé¦–å…ˆè°ƒç”¨çš„æ˜¯<code>jsCallMethod</code>ï¼Œåœ¨<code>jsCallMethod</code>ä¸­é¦–å…ˆè°ƒç”¨<code>findMethod</code>æ–¹æ³•ä»<code>methodsMap_</code>ä¸­è·å–å¯¹åº”çš„æ–¹æ³•ï¼Œæ‰¾äº†åˆ™ç›´æ¥è°ƒç”¨ã€‚æ²¡æ‰¾åˆ°åˆ™åå°„è·å– BridgePlugin å®ç°ç±»ä¸­çš„æ–¹æ³•ï¼Œç„¶åä½¿ç”¨æ–¹æ³•ååšåŒ¹é…ï¼Œæ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•ã€‚åˆ°è¿™é‡Œä¹Ÿå°±è§£é‡Šäº†ä¸ºå•¥ä¸æ”¯æŒæ–¹æ³•é‡è½½ã€‚ä¹Ÿè§£é‡Šäº†ä¸ºå•¥æ–¹æ³•å‚æ•°å¯¹åº”ä¸ä¸Šä¼šæœ‰å¼‚å¸¸ã€‚<br>cpp çš„æºç åœ¨ <a href="https://gitee.com/arkui-x/arkui_for_android/tree/master/capability/java/jni/bridge">https://gitee.com/arkui-x/arkui_for_android&#x2F;tree&#x2F;master&#x2F;capability&#x2F;java&#x2F;jni&#x2F;bridge</a><br>Java æºç åœ¨ <a href="https://gitee.com/arkui-x/arkui_for_android/tree/master/capability/java/src/ohos/ace/adapter/capability/bridge">https://gitee.com/arkui-x/arkui_for_android&#x2F;tree&#x2F;master&#x2F;capability&#x2F;java&#x2F;src&#x2F;ohos&#x2F;ace&#x2F;adapter&#x2F;capability&#x2F;bridge</a></p><p><img src="/image/HarmonyOS/arkui-x_debug.png" alt="image.png"></p><h4 id="å‚æ•°ç±»å‹å¯¹åº”å…³ç³»"><a href="#å‚æ•°ç±»å‹å¯¹åº”å…³ç³»" class="headerlink" title="å‚æ•°ç±»å‹å¯¹åº”å…³ç³»"></a>å‚æ•°ç±»å‹å¯¹åº”å…³ç³»</h4><p>Arkui-X ä¸­callMethodæ˜¯è¿™ä¹ˆå£°æ˜çš„</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-title function_">callMethod</span>(<span class="hljs-attr">methodName</span>: <span class="hljs-built_in">string</span>, parameters?: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Parameter</span>&gt;):<br><span class="hljs-title function_">callMethod</span>(<span class="hljs-attr">methodName</span>: <span class="hljs-built_in">string</span>, ...<span class="hljs-attr">parameters</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">any</span>&gt;): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ResultValue</span>&gt;;<br></code></pre></td></tr></table></figure><p>sendMessageæ˜¯è¿™ä¹ˆå£°æ˜çš„</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-title function_">sendMessage</span>(<span class="hljs-attr">message</span>: <span class="hljs-title class_">Message</span>, <span class="hljs-attr">callback</span>: <span class="hljs-title class_">AsyncCallback</span>&lt;<span class="hljs-title class_">Response</span>&gt;): <span class="hljs-built_in">void</span>;<br><span class="hljs-title function_">sendMessage</span>(<span class="hljs-attr">message</span>: <span class="hljs-title class_">Message</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Response</span>&gt;;<br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-keyword">type</span> S = <span class="hljs-built_in">number</span> | <span class="hljs-built_in">boolean</span> | <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">type</span> T = S | <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; | <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">boolean</span>&gt; | <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Message</span> = T | <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, T&gt;;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Parameter</span> = <span class="hljs-title class_">Message</span>;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Response</span> = <span class="hljs-title class_">Message</span>;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ResultValue</span> = T | <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, T&gt;;<br></code></pre></td></tr></table></figure><p>åœ¨ Android ä¸­sendMessage</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMessage</span><span class="hljs-params">(Object data)</span>&#123;&#125;<br></code></pre></td></tr></table></figure><p>callMethod</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">callMethod</span><span class="hljs-params">(MethodData methodData)</span><br></code></pre></td></tr></table></figure><p>è€Œ MethodData åªæœ‰ä¸¤ä¸ªæˆå‘˜å˜é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MethodData</span> &#123;<br>    <span class="hljs-keyword">private</span> String methodName_;<br>    <span class="hljs-keyword">private</span> Object[] Parameters_;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MethodData</span><span class="hljs-params">(String methodName, Object[] parameter)</span> &#123;<br>        <span class="hljs-built_in">this</span>.methodName_ = methodName;<br>        <span class="hljs-built_in">this</span>.Parameters_ = parameter;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getMethodName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.methodName_;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Object[] getMethodParameter() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.Parameters_;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆåœ¨ä½¿ç”¨çš„æ—¶å€™å¯ä»¥è¿™æ ·:  </p><h5 id="ArkUI-Xä¸»åŠ¨è°ƒç”¨-Android"><a href="#ArkUI-Xä¸»åŠ¨è°ƒç”¨-Android" class="headerlink" title="ArkUI-Xä¸»åŠ¨è°ƒç”¨ Android"></a>ArkUI-Xä¸»åŠ¨è°ƒç”¨ Android</h5><p>åœ¨ ArkUI-X ä¸­è°ƒç”¨</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-keyword">let</span> <span class="hljs-attr">params</span>:<span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>,<span class="hljs-title class_">Bridge</span>.<span class="hljs-property">Parameter</span>&gt; =&#123;<br>  <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;xuan&quot;</span>,<br>  <span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">18</span><br>&#125;<br><span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">bridge</span>!.<span class="hljs-title function_">callMethod</span>(<span class="hljs-string">&#x27;getAppVersion&#x27;</span>,params);<br><br></code></pre></td></tr></table></figure><p>åœ¨ Android ç«¯å¯¹åº”å‚æ•°ç±»å‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getAppVersion</span><span class="hljs-params">(JSONObject params)</span>&#123;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="Android-ä¸»åŠ¨è°ƒç”¨-ArkUI-X"><a href="#Android-ä¸»åŠ¨è°ƒç”¨-ArkUI-X" class="headerlink" title="Android ä¸»åŠ¨è°ƒç”¨ ArkUI-X"></a>Android ä¸»åŠ¨è°ƒç”¨ ArkUI-X</h5><p>åœ¨ Android ä¸­è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-type">JSONObject</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONObject</span>();<br><span class="hljs-keyword">try</span> &#123;<br>    params.put(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;xuan&quot;</span>);<br>    params.put(<span class="hljs-string">&quot;age&quot;</span>,<span class="hljs-number">18</span>);<br>&#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>    e.printStackTrace();<br>&#125;<br>Object[] paramObject = &#123;params&#125;;<br><span class="hljs-type">MethodData</span> <span class="hljs-variable">methodData</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MethodData</span>(<span class="hljs-string">&quot;getString&quot;</span>, paramObject);<br>callMethod(methodData);<br></code></pre></td></tr></table></figure><p>åœ¨ ArkUI-X ä¸­å¯¹åº”ç±»å‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-title function_">getString</span>(parameters?: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>,<span class="hljs-title class_">Bridge</span>.<span class="hljs-property">Message</span>&gt;):<span class="hljs-title class_">Bridge</span>.<span class="hljs-property">ResultValue</span> &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`----è°ƒç”¨ getStringï¼šparameters--&gt;<span class="hljs-subst">$&#123;<span class="hljs-built_in">JSON</span>.stringify(parameters)&#125;</span>`</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;call js getString success&#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="BrigePluginçš„bridgeType"><a href="#BrigePluginçš„bridgeType" class="headerlink" title="BrigePluginçš„bridgeType_"></a>BrigePluginçš„bridgeType_</h4><p>BrigePluginæä¾›äº†ä¸€ä¸ªå¯ä»¥æŒ‡å®š<code>bridgeType_</code>çš„æ„é€ æ–¹æ³•ï¼Œ<br><img src="/image/HarmonyOS/arkui-x_bridge_type.png" alt="image.png"><br>å¦‚æœæˆ‘ä»¬ä¸æŒ‡å®šç±»å‹çš„è¯ï¼Œé»˜è®¤å°±æ˜¯ <code>BridgeType.JSON_TYPE</code>ï¼Œä¼ ä¸€äº›éäºŒè¿›åˆ¶çš„æ•°æ®ã€‚ä½†å‡å¦‚æˆ‘ä»¬éœ€è¦ç©¿ä¸€äº›äºŒè¿›åˆ¶æ•°æ®ï¼Œæ¯”å¦‚å›¾ç‰‡ã€éŸ³è§†é¢‘æ•°æ®ç­‰ï¼Œå¯ä»¥æŒ‡å®šä¸º<code>BridgeType.BINARY_TYPE</code>ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>HarmonyOS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¸¿è’™è·¨å¹³å° ArkUI-Xä»å…¥é—¨åˆ°å…¥åœŸ</title>
    <link href="/2024/03/27/%E9%B8%BF%E8%92%99%E8%B7%A8%E5%B9%B3%E5%8F%B0-ArkUI-X%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/"/>
    <url>/2024/03/27/%E9%B8%BF%E8%92%99%E8%B7%A8%E5%B9%B3%E5%8F%B0-ArkUI-X%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/</url>
    
    <content type="html"><![CDATA[<hr><p>2024.01.31 æ›´æ–°<br>ç å®Œäº†<br><a href="https://juejin.cn/post/7329310941106421811">é¸¿è’™ArkUI-X è·¨å¹³å°é€šä¿¡ï¼šä»å…¥åœŸåˆ°å¤æ´»</a><br>åœ¨æœ¬æ–‡ä¸­æåˆ°çš„é—®é¢˜åˆé‡æ–°éªŒè¯äº†å‡ æ¬¡ï¼Œå’¨è¯¢äº†ä¸€ä¸‹ç›¸å…³äººå‘˜ï¼Œç»“è®ºæ˜¯è¿™æ ·çš„</p><ol><li>åœ¨ Arkui-X ä¸­ï¼Œå¦‚æœ Bridge å¯¹è±¡å£°æ˜ä¸ºæˆå‘˜å˜é‡å¹¶ä¸”ç«‹å³åˆ›å»ºï¼Œè¿™æ—¶å€™ preview ä¼šç™½å±ï¼Œæ˜¯åŠ è½½ç•Œé¢æ—¶å°±æŒ‚äº†ï¼Œå› ä¸ºè¿™ä¸ªbridgeå¯¹è±¡ï¼Œæ˜¯éœ€è¦ native ä¾§çš„æ–‡ä»¶æ”¯æŒçš„ï¼Œæ¯”å¦‚Androidä¸­çš„libbridge.so(é›†æˆäº§ç‰©åˆ° Android å·¥ç¨‹æ—¶å¤åˆ¶è¿‡å»çš„)ã€‚è¿™æ—¶å€™é›†æˆåˆ° Android å·¥ç¨‹ä¸­æ˜¯æ­£å¸¸è¿è¡Œçš„ã€‚</li><li>DevEco ä¸­çš„ preview ç›¸å½“äºçº¯é¸¿è’™ç³»ç»Ÿ(HarmonyOS next),åœ¨çº¯é¸¿è’™ç³»ç»Ÿä¸­æ˜¯æ— æ³•ä½¿ç”¨Bridge çš„ï¼Œå› ä¸ºçº¯é¸¿è’™ä¸Šæ²¡æœ‰è¿™ä¸ª so åº“ã€‚æ‰€ä»¥åœ¨åˆ›å»ºè¿™ä¸ª Bridge å¯¹è±¡çš„æ—¶å€™éœ€è¦åˆ¤æ–­ä¸€ä¸‹æ˜¯ä¸æ˜¯è·¨å¹³å°ï¼Œä¸€èˆ¬ä»deviceInfo.osFullNameåˆ¤æ–­ï¼š<br><code>let osName: string = deviceInfo.osFullName;</code>è·å–å¯¹åº”OSåå­—ï¼Œè¯¥æ¥å£å·²æ”¯æŒè·¨å¹³å°ï¼Œä¸åŒå¹³å°ä¸Šå…¶è¿”å›å€¼å¦‚ä¸‹:</li></ol><ul><li>OpenHarmonyä¸Šï¼ŒosNameç­‰äº<code>OpenHarmony XXX</code></li><li>Androidä¸Šï¼ŒosNameç­‰äº<code>Android XXX</code></li><li>iOSä¸Šï¼ŒosNameç­‰äº<code>iOS XXX</code><br>å…·ä½“æ–‡æ¡£åœ¨è¿™é‡Œ <a href="https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/quick-start/platform-different-introduction.md#%E5%B9%B3%E5%8F%B0%E5%B7%AE%E5%BC%82%E5%8C%96">å¹³å°å·®å¼‚åŒ–</a></li></ul><hr><p>2024.01.28 æ›´æ–°<br><del>ä¸Šé¢</del>æ–‡ç« ä¸­æåˆ°è·¨å¹³å°é€šä¿¡(Bridge)çš„é—®é¢˜åœ¨ç¤¾åŒºçš„å¸®åŠ©ä¸‹è§£å†³äº†ï¼Œæ–¹æ¡ˆå°±ä¸è¦åœ¨é¡µé¢(ä¹Ÿå°±æ˜¯@Entryä¿®é¥°)ä¸­è¿›è¡Œåˆå§‹åŒ–ï¼Œå¯ä»¥å†™ä¸ªå·¥å…·ç±»ï¼Œåœ¨å·¥å…·ç±»ä¸­åˆå§‹åŒ–ï¼Œè™½ç„¶ debug ä¹Ÿæ˜¯æç¤º undefinedï¼Œä½†è¿è¡Œçš„æ—¶å€™å¯ä»¥æ­£å¸¸å·¥ä½œã€‚<br>æ–°çš„åšå®¢è®°å½•å·²ç»åœ¨ç äº†ã€‚ã€‚ã€‚ã€‚</p><hr><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>å–Šäº†å¥½é•¿æ—¶é—´è¦åšé¸¿è’™åº”ç”¨ï¼Œè‡ªå·±ä¹Ÿå†™äº†ä¸€ç‚¹ï¼Œä½†è¦åŒæ—¶ç…§é¡¾ä¸‰ä¸ªç§»åŠ¨å¹³å°æœ‰ç‚¹æ¶å¿ƒï¼Œå¤§è‡´çœ‹äº†ä¸€ä¸‹é¸¿è’™ç¤¾åŒºçš„ arkui-x è·¨å¹³å°æ–¹æ¡ˆ <a href="https://gitee.com/arkui-x">https://gitee.com/arkui-x</a> ,å…ˆè°ƒç ”ä¸€ä¸‹è¯•è¯•æ°´<br><strong>æ³¨æ„æ–‡ç« æ‰€è¯´çš„å®˜æ–¹æ˜¯æŒ‡ç¤¾åŒºï¼Œå¹¶ä¸æ˜¯æŒ‡åä¸ºå…¬å¸ï¼Œæ›´ä¸æ˜¯å…¶ä»–</strong></p><h3 id="é™åˆ¶"><a href="#é™åˆ¶" class="headerlink" title="é™åˆ¶"></a>é™åˆ¶</h3><p>ä¸‘è¯è¯´åœ¨å‰å¤´ï¼Œå…ˆè¯´é™åˆ¶ï¼ŒæŒ‰ç…§å®˜æ–¹æ–‡æ¡£è¯´æ³•ï¼Œå¿˜è®°åœ¨å“ªé‡Œçœ‹åˆ°äº†<br>Androidç³»ç»Ÿç‰ˆæœ¬8+ ä¸”ä»… arm è®¾å¤‡æ”¯æŒ<br>iOSç³»ç»Ÿç‰ˆæœ¬ 10+ ä¸”ä»… arm è®¾å¤‡æ”¯æŒ</p><h3 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h3><p>å®˜æ–¹æ–‡æ¡£çœ‹è¿™é‡Œï¼š<a href="https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/README.md">https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/README.md</a></p><p>å®˜æ–¹ä»“åº“åœ¨è¿™é‡Œï¼š<a href="https://gitee.com/arkui-x">https://gitee.com/arkui-x</a></p><p>ä½¿ç”¨å®˜æ–¹çš„å¥—ä»¶è¿˜æ˜¯éœ€è¦ç”³è¯·ï¼Œæ–¹å¼å’Œä¹‹å‰ä¸€æ ·ï¼Œå°±æ˜¯æ‰¾å•†åŠ¡è°ˆåˆä½œï¼Œç­¾åè®®ã€‚ç„¶åç»™è´¦å·å¼€é€šä¸‹è½½æƒé™ç„¶åå»ä¸‹è½½ã€‚</p><h4 id="IDE"><a href="#IDE" class="headerlink" title="IDE"></a>IDE</h4><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ OpenHarmony ç¤¾åŒºæä¾›çš„å¼€å‘å¥—ä»¶</p><p><img src="/image/HarmonyOS/deveco.png" alt="image.png"><br>ä¸‹è½½é“¾æ¥ï¼š</p><p><a href="https://gitee.com/openharmony/docs/blob/master/zh-cn/release-notes/OpenHarmony-v4.0-release.md#%E9%85%8D%E5%A5%97%E5%85%B3%E7%B3%BB">https://gitee.com/openharmony/docs/blob/master/zh-cn/release-notes/OpenHarmony-v4.0-release.md#%E9%85%8D%E5%A5%97%E5%85%B3%E7%B3%BB</a></p><p>å®‰è£…æ­¥éª¤éƒ½ä¸€æ ·ï¼Œ<strong>æ³¨æ„ node å’Œohpmç‰ˆæœ¬</strong>ï¼Œé€‰æ‹©ideå»ºè®®çš„ç‰ˆæœ¬ï¼Œå¯ä»¥é‡æ–°ä¸‹è½½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æœ¬æœºä¸Šå·²ç»å®‰è£…å¥½çš„ï¼Œæˆ‘è¿™é‡Œç”¨çš„ nodeæ˜¯ 16.20.0ï¼Œä¸è¦å¤´é“æä¸ª 18.x.x 20.x.xçš„ç‰ˆæœ¬ï¼Œå¯èƒ½ä¼šæœ‰ä¸€äº›è¯¡å¼‚çš„é—®é¢˜</p><h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>å¯åŠ¨ IDEï¼Œé¡µé¢å·¦ä¾§æœ‰diagnoseå¯ä»¥æ£€æµ‹ä¸€äº›åŸºç¡€é…ç½®å’Œç½‘ç»œè¿æ¥æƒ…å†µã€‚ç‚¹å‡»å·¦ä¾§Customizeï¼Œåœ¨å³ä¾§åº•éƒ¨ç‚¹å‡»â€All settingsâ€è¿›å…¥é¦–é€‰é¡¹é…ç½®</p><p><img src="/image/HarmonyOS/deveco_customize.png" alt="image.png"></p><p>é€‰æ‹© SDKï¼Œå®‰è£… OpenHarmony SDK api 10ï¼Œå®‰è£…å®Œæˆä¹‹åå†å®‰è£… ArkUI-X</p><p><img src="/image/HarmonyOS/deveco_sdk.png" alt="image.png"></p><p>å®‰è£…å®Œæˆåå°±å¯ä»¥äº†ï¼Œæ²¡æœ‰å…¶ä»–éœ€è¦å®‰è£…çš„äº†</p><h3 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h3><h4 id="åˆ›å»ºå·¥ç¨‹"><a href="#åˆ›å»ºå·¥ç¨‹" class="headerlink" title="åˆ›å»ºå·¥ç¨‹"></a>åˆ›å»ºå·¥ç¨‹</h4><p>æ²¡æœ‰æä¾›ç›´æ¥åˆ›å»ºè·¨å¹³å°åº”ç”¨çš„åœ°æ–¹ï¼Œç›®å‰åªèƒ½ç”¨ import çš„å½¢å¼</p><p><img src="/image/HarmonyOS/deveco_import_project.png" alt="image.png"></p><p>æ‰¾åˆ° import Sample,æ–°é¡µé¢å·¦ä¸Šè§’é€‰æ‹© OpenHarmonyï¼Œä¸‹é¢ä¼šå‡ºç° ArkUI-Xï¼Œè¿™é‡Œç”¨ HelloWorld æ¥åšç¤ºä¾‹ã€‚</p><p><img src="/image/HarmonyOS/select_sample_to_improt.png" alt="image.png"></p><p>æ‰“å¼€å·¥ç¨‹åå¼€å§‹è‡ªåŠ¨åŒæ­¥ï¼Œä½†è¿™é‡Œä¼šå¤±è´¥ï¼Œå› ä¸ºå„ç§æ’ä»¶ç‰ˆæœ¬ä¸é€‚é…ï¼Œç‚¹ä¸€ä¸‹è“è‰²çš„æ–‡å­—ï¼Œä¼šå¸®ä½ å…¨éƒ¨ä¿®æ”¹å¥½ï¼Œé‡æ–°åŒæ­¥ï¼Œåˆ°è¿™é‡Œå°±å·²ç»å…¨éƒ¨å‡†å¤‡å¥½äº†ã€‚</p><p><img src="/image/HarmonyOS/sync_failed.png" alt="image.png"></p><h4 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h4><p>çª—å£é¡¶éƒ¨èœå• Buildâ€“&gt; Build Hap(s)&#x2F;APP(s)â€“&gt;Build APP(s)ã€‚ä¼šåŒæ—¶æ„å»º Android å’Œ iOS äº§ç‰©</p><p><img src="/image/HarmonyOS/build_result.png" alt="image.png"></p><p>ä¸å‡ºæ„å¤–çš„è¯å‡ºæ„å¤–äº†ï¼Œæ‰“åŒ…å¤±è´¥ï¼Œä½†è¿™æ—¶å¯¹åº”çš„èµ„æºéƒ½å·²ç»å¤åˆ¶åˆ°ç›¸åº”çš„æ–‡ä»¶å¤¹ä¸­äº†ã€‚å¯¹åº”çš„è¯´æ˜å¯ä»¥çœ‹è¿™é‡Œ</p><p><a href="https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/quick-start/package-structure-guide.md">https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/quick-start/package-structure-guide.md</a></p><p>è¿™æ—¶å€™æˆ‘ä»¬è¿›å…¥åˆ°é¡¹ç›®å·¥ç¨‹çš„ .arkui-x&#x2F;androidç›®å½•ä¸‹ï¼Œæ‰§è¡Œ <strong>.&#x2F;gradlew assembleDebug</strong> æ¥ç¼–è¯‘ android å®‰è£…åŒ…ã€‚æ³¨æ„è¿™é‡Œ gradlew å¯èƒ½æ²¡æœ‰æ‰§è¡Œæƒé™ï¼Œ<strong>chmod +x gradlew</strong> ç»™ä¸€ä¸‹æ‰§è¡Œæƒé™å°±å¥½äº†ã€‚</p><p>å¯¹äº iOS å·¥ç¨‹ï¼Œå¯ä»¥ç”¨ Xcode æ‰“å¼€ä¹‹åé…ç½®ä¸€ä¸‹ç­¾åç„¶åæ‰“åŒ…ã€‚</p><p>åˆ°è¿™é‡Œï¼Œæ–°å»ºå·¥ç¨‹ç¼–è¯‘å¤šå¹³å°å°±å·²ç»å®Œæˆäº†ã€‚ä½†æˆ‘ä»¬æœ‰å¾ˆå¤šé¡¹ç›®ä¸æ˜¯ä»å¤´å¼€å§‹ï¼Œéƒ¨åˆ†æ–°å¢å†…å®¹éœ€è¦ä½¿ç”¨ add-onæ–¹å¼ï¼Œè¿™é‡Œä»¥ Android ä¸ºä¾‹</p><h3 id="æ·»åŠ åˆ°ç°æœ‰å·¥ç¨‹"><a href="#æ·»åŠ åˆ°ç°æœ‰å·¥ç¨‹" class="headerlink" title="æ·»åŠ åˆ°ç°æœ‰å·¥ç¨‹"></a>æ·»åŠ åˆ°ç°æœ‰å·¥ç¨‹</h3><p>æ¥ä¸Šé¢ <strong>çª—å£é¡¶éƒ¨èœå• Buildâ€“&gt; Build Hap(s)&#x2F;APP(s)â€“&gt;Build APP(s)ã€‚ä¼šåŒæ—¶æ„å»º Android å’Œ iOS äº§ç‰©</strong> ä¹‹åï¼Œå¯¹åº”èµ„æºæ–‡ä»¶å·²ç»å¤åˆ¶åˆ°å¯¹ç›¸åº”æ–‡ä»¶å¤¹äº†ã€‚</p><p>å…ˆå‡†å¤‡ä¸€ä¸ª Android é¡¹ç›®ï¼Œæ³¨æ„ä¸€ä¸ª ArkUI-x è·¨å¹³å°çš„ç‰ˆæœ¬è¦æ±‚ï¼ŒAndroid ç³»ç»Ÿ 8 ä»¥ä¸Šï¼Œåªæ”¯æŒ arm è®¾å¤‡ã€‚</p><p>çœ‹ä¸€ä¸‹ .arkui-x&#x2F;androidçš„ä»£ç ï¼Œå°±ä¸€ä¸ª<strong>ç»§æ‰¿è‡ªStageApplicationçš„MyApplication</strong>å’Œä¸€ä¸ªç»§æ‰¿è‡ª <strong>Activity çš„EntryEntryAbilityActivityï¼Œ</strong> è¯¥ç±»åé€šè¿‡é€šè¿‡moduleåå’Œabilityåæ‹¼æ¥è€Œå¾—ï¼Œä¸€ä¸ªabilityå¯¹åº”ä¸€ä¸ªAndroidå·¥ç¨‹ä¾§çš„Activityç±»ã€‚</p><h4 id="é›†æˆ"><a href="#é›†æˆ" class="headerlink" title="é›†æˆ"></a>é›†æˆ</h4><ol><li>libs ä¸‹é¢çš„ jar åŒ…å’Œso æ–‡ä»¶å¤åˆ¶åˆ° Android å·¥ç¨‹ä¸­ï¼Œæ³¨æ„arkui-x çš„ Android å·¥ç¨‹ä¸­æŒ‡å®šäº†å­˜æ”¾ so æ–‡ä»¶çš„æ–‡ä»¶å¤¹å°±æ˜¯ libsï¼Œå¤åˆ¶åˆ° Android å·¥ç¨‹ä¸­çš„æ—¶å€™åˆ«æ•´é”™äº†</li><li>assetsæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ä¹ŸåŸå°ä¸åŠ¨çš„å¤åˆ¶åˆ° Android å·¥ç¨‹çš„ assets æ–‡ä»¶å¤¹ä¸­</li><li>Android å·¥ç¨‹ä¸­çš„ Applicationæ”¹é€ ï¼Œè¿™é‡Œæä¾›äº†ä¸‰ç§æ–¹å¼<br>  3.1 ç»§æ‰¿StageApplication</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">import</span> ohos.stage.ability.adapter.StageApplication;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HiStageApplication</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">StageApplication</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>   3.2 åœ¨ Application ä¸­ä½¿ç”¨StageApplicationDelegate</p><p>è¿™ä¸ªæ–¹æ³•å’Œ StageApplication æºç ä¸€æ ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplication</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Application</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">StageApplicationDelegate</span> <span class="hljs-variable">appDelegate</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">StageApplication</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">()</span> &#123;<br>        Log.i(<span class="hljs-string">&quot;StageApplication&quot;</span>, <span class="hljs-string">&quot;StageApplication onCreate called&quot;</span>);<br>        <span class="hljs-built_in">super</span>.onCreate();<br>        <span class="hljs-built_in">this</span>.appDelegate = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StageApplicationDelegate</span>();<br>        <span class="hljs-built_in">this</span>.appDelegate.initApplication(<span class="hljs-built_in">this</span>);<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onConfigurationChanged</span><span class="hljs-params">(Configuration newConfig)</span> &#123;<br>        Log.i(<span class="hljs-string">&quot;StageApplication&quot;</span>, <span class="hljs-string">&quot;StageApplication onConfigurationChanged called&quot;</span>);<br>        <span class="hljs-built_in">super</span>.onConfigurationChanged(newConfig);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.appDelegate == <span class="hljs-literal">null</span>) &#123;<br>            Log.e(<span class="hljs-string">&quot;StageApplication&quot;</span>, <span class="hljs-string">&quot;appDelegate is null&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-built_in">this</span>.appDelegate.onConfigurationChanged(newConfig);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>3.3 åœ¨ Activity ä¸­ä½¿ç”¨ StageApplicationDelegat</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> android.app.Activity;<br><span class="hljs-keyword">import</span> ohos.stage.ability.adapter.StageApplicationDelegate;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryEntryAbilityActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> &#123;<br><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">StageApplicationDelegate</span> <span class="hljs-variable">appDelegate_</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        appDelegate_ = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StageApplicationDelegate</span>();<br>        appDelegate_.initApplication(<span class="hljs-built_in">this</span>.getApplication());<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="4"><li>ç”¨äºå±•ç¤ºå†…å®¹çš„ Activity</li></ol><p>ç›´æ¥å¤åˆ¶ä¹Ÿè¡Œï¼Œè‡ªå·±åˆ›å»ºä¸€ä¸ªåŒå Activity æŠŠå†…å®¹å¤åˆ¶è¿‡æ¥ï¼Œæ¸…å•æ–‡ä»¶ä¸­æ³¨å†Œä¸€ä¸‹ä¹Ÿè¡Œã€‚</p><ol><li>åŸç”Ÿæ‹‰èµ· arkui-x è·¨å¹³å°é¡µé¢å¹¶ä¼ å‚</li></ol><p>ä½¿ç”¨åŸç”ŸActivityæ‹‰èµ·Abilityæ—¶ï¼Œéœ€ä½¿ç”¨åŸç”Ÿåº”ç”¨çš„startActivityæ–¹æ³•ï¼Œå‚æ•°çš„ä¼ é€’éœ€è¦é€šè¿‡Intentä¸­çš„putExtra()è¿›è¡Œè®¾ç½®ï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</p><p>keyå€¼ä¸ºparams</p><p>valueä¸ºjsonæ ¼å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>();<br>        intent.setClass(<span class="hljs-built_in">this</span>, EntryEntryAbilityTwoActivity.class);<br>        intent.putExtra(<span class="hljs-string">&quot;params&quot;</span>,<br>                <span class="hljs-string">&quot;&#123;&quot;</span>params<span class="hljs-string">&quot;:[&#123;&quot;</span>key<span class="hljs-string">&quot;:&quot;</span>bool<span class="hljs-string">&quot;,&quot;</span>type<span class="hljs-string">&quot;:1,&quot;</span>value<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal">true</span><span class="hljs-string">&quot;&#125;,&quot;</span> +<br>                <span class="hljs-string">&quot;&#123;&quot;</span>key<span class="hljs-string">&quot;:&quot;</span><span class="hljs-type">double</span><span class="hljs-string">&quot;,&quot;</span>type<span class="hljs-string">&quot;:9,&quot;</span>value<span class="hljs-string">&quot;:&quot;</span><span class="hljs-number">2.3</span><span class="hljs-string">&quot;&#125;,&quot;</span> +<br>                <span class="hljs-string">&quot;&#123;&quot;</span>key<span class="hljs-string">&quot;:&quot;</span><span class="hljs-type">int</span><span class="hljs-string">&quot;,&quot;</span>type<span class="hljs-string">&quot;:5,&quot;</span>value<span class="hljs-string">&quot;:&quot;</span><span class="hljs-number">2</span><span class="hljs-string">&quot;&#125;,&quot;</span> +<br>                <span class="hljs-string">&quot;&#123;&quot;</span>key<span class="hljs-string">&quot;:&quot;</span>string<span class="hljs-string">&quot;,&quot;</span>type<span class="hljs-string">&quot;:10,&quot;</span>value<span class="hljs-string">&quot;:&quot;</span>test<span class="hljs-string">&quot;&#125;]&#125;&quot;</span>);<br>        startActivity(intent);<br></code></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œé›†æˆå®Œæˆã€‚<br>åœ¨ Android é¡¹ç›®ä¸­è°ƒç”¨ä¸€ä¸‹å°±å¯ä»¥çœ‹åˆ°é¡µé¢äº†</p><h3 id="arkui-x-å’Œ-native-é€šä¿¡"><a href="#arkui-x-å’Œ-native-é€šä¿¡" class="headerlink" title="arkui-x å’Œ native é€šä¿¡"></a>arkui-x å’Œ native é€šä¿¡</h3><p>åŸç”Ÿå’Œè·¨å¹³å°é€šä¿¡æ˜¯éå¸¸é‡è¦çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œä¹Ÿæ˜¯ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ï¼Œå®˜æ–¹ç»™å‡ºäº†æ¡¥æ¥å¹³å° Bridgeï¼Œåœ¨ Androidã€iOS å’Œ arkui-x ä¾§éƒ½æœ‰é…å¥—è¯´æ˜ï¼š</p><blockquote><p>å¹³å°æ¡¥æ¥ç”¨äºå®¢æˆ·ç«¯ï¼ˆArkUIï¼‰å’Œå¹³å°ï¼ˆAndroidæˆ–iOSï¼‰ä¹‹é—´ä¼ é€’æ¶ˆæ¯ï¼Œå³ç”¨äºArkUIä¸å¹³å°åŒå‘æ•°æ®ä¼ é€’ã€ArkUIä¾§è°ƒç”¨å¹³å°çš„æ–¹æ³•ã€å¹³å°è°ƒç”¨ArkUIä¾§çš„æ–¹æ³•ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»Androidå¹³å°ä¸ArkUIäº¤äº’ï¼ŒArkUIä¾§å…·ä½“ç”¨æ³•è¯·å‚è€ƒBridge APIï¼ŒAndroidä¾§å‚è€ƒBridgePluginã€‚  </p></blockquote><p>è¿™é‡Œä¹Ÿç»™å‡ºäº†ä¸€ä¸ª<br><a href="https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/tutorial/how-to-use-bridge-on-android.md#%E5%9C%BA%E6%99%AF%E7%A4%BA%E4%BE%8B">åœºæ™¯ç¤ºä¾‹</a>ï¼Œä½†å¥‡æ€ªçš„æ˜¯ä¸èƒ½æ­£å¸¸è¿è¡Œï¼Œå¤ç°æ­¥éª¤å’Œç°è±¡æ”¾åœ¨è¿™ä¸ª <a href="https://gitee.com/arkui-x/docs/issues/I8YWM2?from=project-issue">issue</a> ä¸­äº†ã€‚ç›®å‰æ˜¯å¾…ç¡®è®¤çŠ¶æ€ã€‚</p><p>åˆ°è¿™é‡Œä¹Ÿæ²¡æœ‰éœ€è¦ç»§ç»­ä¸‹å»çš„ä¸œè¥¿ï¼Œå°±å…ˆå…¥åœŸå§ï¼Œä¸Šé¢è¿™ä¸ªé—®é¢˜æœ‰ç­”æ¡ˆäº†å†æŒ–å‡ºæ¥ç»§ç»­ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>HarmonyOS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¸¿è’™--canvas ç”»æ—¶é’Ÿ</title>
    <link href="/2024/03/27/%E9%B8%BF%E8%92%99-canvas-%E7%94%BB%E6%97%B6%E9%92%9F/"/>
    <url>/2024/03/27/%E9%B8%BF%E8%92%99-canvas-%E7%94%BB%E6%97%B6%E9%92%9F/</url>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>ä½ åœ¨ Android ä¸Šèƒ½ç”»å‡ºæ¥çš„ä¸œè¥¿ï¼Œåœ¨é¸¿è’™ä¸Šç”»ä¸å‡ºæ¥ï¼Ÿ<br>ç”»ä¸ªæ—¶é’Ÿå˜›ï¼Œæœ‰å•¥éš¾çš„ï¼Ÿ<br>ä½ è¡Œä½ ä¸Šï¼<br>ç»™é’±å°±ä¸Šï¼<br>ç»™é’±ï¼Ÿæ—©è¯´å˜›ï¼Œæ¥æ¥æ¥ï¼Œç°åœ¨å°±ç”»</p><h3 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h3><p>ç”»æ—¶é’Ÿéœ€è¦ç”»å“ªäº›å…ƒç´ ï¼Ÿ<br>åœ†åœˆã€ç›´çº¿ï¼Œæ²¡äº†ï¼Œå°±è¿™äº›ï¼Œä¸´æ—¶çœ‹ä¸€ä¸‹canvas ç›¸å…³çš„ apiï¼Œè¿™ä¸éƒ½æœ‰ä¹ˆï¼Ÿç›´æ¥ç”»ã€‚<br>çœ‹çœ‹éœ€è¦ç”¨çš„æ–¹æ³•  </p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-title function_">arc</span>(<span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">radius</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">startAngle</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">endAngle</span>: <span class="hljs-built_in">number</span>, counterclockwise?: <span class="hljs-built_in">boolean</span>): <span class="hljs-built_in">void</span><br></code></pre></td></tr></table></figure><p>çœ‹ä¸‹å‚æ•°å«ä¹‰</p><table><thead><tr><th align="left">å‚æ•°</th><th align="left">ç±»å‹</th><th align="left">å¿…å¡«</th><th align="left">é»˜è®¤å€¼</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">x</td><td align="left">number</td><td align="left">æ˜¯</td><td align="left">0</td><td align="left">å¼§çº¿åœ†å¿ƒçš„xåæ ‡å€¼ã€‚</td></tr><tr><td align="left">y</td><td align="left">number</td><td align="left">æ˜¯</td><td align="left">0</td><td align="left">å¼§çº¿åœ†å¿ƒçš„yåæ ‡å€¼ã€‚</td></tr><tr><td align="left">radius</td><td align="left">number</td><td align="left">æ˜¯</td><td align="left">0</td><td align="left">å¼§çº¿çš„åœ†åŠå¾„ã€‚</td></tr><tr><td align="left">startAngle</td><td align="left">number</td><td align="left">æ˜¯</td><td align="left">0</td><td align="left">å¼§çº¿çš„èµ·å§‹å¼§åº¦ã€‚</td></tr><tr><td align="left">endAngle</td><td align="left">number</td><td align="left">æ˜¯</td><td align="left">0</td><td align="left">å¼§çº¿çš„ç»ˆæ­¢å¼§åº¦ã€‚</td></tr><tr><td align="left">counterclockwise</td><td align="left">boolean</td><td align="left">å¦</td><td align="left">false</td><td align="left">æ˜¯å¦é€†æ—¶é’ˆç»˜åˆ¶åœ†å¼§ã€‚</td></tr></tbody></table><p>å¼§åº¦åˆ¶ï¼Œä¸€åœˆæ˜¯ 2Ï€ï¼Œè¿™ä¸ªéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œè¿˜æœ‰endAngleï¼Œæ˜¯ç»ˆæ­¢å¼§åº¦ï¼Œè€Œä¸æ˜¯éœ€è¦ç”»å¤šå°‘å¼§åº¦ï¼Œæµ…æµ…çš„å°è¯•ã€‚  </p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><br>struct <span class="hljs-title class_">ClockViewTest</span> &#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">settings</span>: <span class="hljs-title class_">RenderingContextSettings</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderingContextSettings</span>(<span class="hljs-literal">true</span>)<br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">canvasRendering</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasRenderingContext2D</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>)<br><br>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">&quot;100%&quot;</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">&quot;100%&quot;</span>)<br>      .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> &#123;<br><br>        <span class="hljs-keyword">let</span> width = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">width</span><br>        <span class="hljs-keyword">let</span> height = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">height</span><br><br>        <span class="hljs-keyword">let</span> centerX = width / <span class="hljs-number">2</span><br>        <span class="hljs-keyword">let</span> centerY = height / <span class="hljs-number">2</span><br>        <span class="hljs-comment">//å–é•¿å®½ä¸­å°çš„ä¸€ä¸ªåšç›´å¾„</span><br>        <span class="hljs-keyword">let</span> maxRadius = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(width, height) / <span class="hljs-number">2</span><br><br>        <span class="hljs-comment">//è®¾ç½®çº¿çš„ç²—ç»†</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">4</span><br><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">arc</span>(centerX, centerY, maxRadius-<span class="hljs-number">50</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">false</span>)<br>        <span class="hljs-comment">//è®¾ç½®çº¿çš„é¢œè‰²</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">&quot;#ff0000&quot;</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">stroke</span>()<br><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">beginPath</span>()<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">arc</span>(centerX, centerY, maxRadius - <span class="hljs-number">30</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>)<br>        <span class="hljs-comment">//è®¾ç½®çº¿çš„é¢œè‰²</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">&quot;#00ff00&quot;</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">stroke</span>()<br><br>      &#125;)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ•ˆæœæ˜¯è¿™æ ·çš„ï¼š  </p><p><img src="/image/HarmonyOS/canvas_circle.png" alt="image.png"><br>ç”»ç›´çº¿å°±ä¸ç”¨å¤šè¯´äº†ï¼Œå¼€å¹²~~  </p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="ç»„æˆéƒ¨åˆ†"><a href="#ç»„æˆéƒ¨åˆ†" class="headerlink" title="ç»„æˆéƒ¨åˆ†"></a>ç»„æˆéƒ¨åˆ†</h4><p>æŒ‡é’ˆæ˜¯éœ€è¦æ ¹æ®æ—¶é—´å˜åŒ–æ¥è½¬åŠ¨çš„ï¼Œè¡¨ç›˜ç”»å¥½ä¸€æ¬¡å°±ä¸éœ€è¦é‡ç»˜äº†ï¼Œå·ä¸ªæ‡’ï¼Œæä¸¤ä¸ª canvas æ‘èµ·æ¥ï¼Œåº•å±‚ç”»è¡¨ç›˜ï¼Œä¸Šå±‚ç”»æŒ‡é’ˆï¼Œæ—¶é—´å˜äº†åªé‡ç”»ä¸Šå±‚æŒ‡é’ˆå°±è¡Œäº†ã€‚  </p><h4 id="æ•°å€¼è®¡ç®—"><a href="#æ•°å€¼è®¡ç®—" class="headerlink" title="æ•°å€¼è®¡ç®—"></a>æ•°å€¼è®¡ç®—</h4><p>ç®€å•çš„ä¸‰è§’å‡½æ•°ï¼Œä½†è¦æ³¨æ„æ˜¯å¼§åº¦åˆ¶ï¼Œæ•°å€¼åˆ«æé”™äº†ã€‚<br>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ç”»å¸ƒå·¦ä¸Šè§’åæ ‡æ˜¯(0,0)ï¼Œå³ä¸‹è§’åæ ‡ä¸º(width,height)ã€‚  </p><h4 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h4><ol><li>å…ˆç”»ä¸€å¤§ä¸€å°ä¸¤ä¸ªåœ†åœˆç»„æˆä¸€ä¸ªåœ†ç¯ã€‚  </li><li>å†åˆ’çº¿æŠŠåœ†ç¯å‡åˆ† 60 ä»½ï¼Œæ¯ 5 æ¡çº¿åŠ ç²—ä¸€ä¸‹ã€‚  </li><li>å†æŠŠåœ†å‘¨åˆ†æˆ 12 ä»½ï¼Œå¯¹åº”ä½ç½®ç”»ä¸Š1~12 æ•°å­—ã€‚  </li><li>è·å–å½“å‰æ—¶é—´ï¼Œè®¡ç®—å‡ºæŒ‡é’ˆä½ç½®ï¼Œåˆ’çº¿ã€‚  </li><li>å®šæ—¶æ›´æ–°æŒ‡é’ˆä½ç½®ã€‚  </li><li>ç»“æŸã€‚</li></ol><h3 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h3><h4 id="ç¬¬ä¸€æ­¥-ç”»åœ†ç¯"><a href="#ç¬¬ä¸€æ­¥-ç”»åœ†ç¯" class="headerlink" title="ç¬¬ä¸€æ­¥ ç”»åœ†ç¯"></a>ç¬¬ä¸€æ­¥ ç”»åœ†ç¯</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">&quot;100%&quot;</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">&quot;100%&quot;</span>)<br>  .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> &#123;<br><br>    <span class="hljs-keyword">let</span> width = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">width</span><br>    <span class="hljs-keyword">let</span> height = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">height</span><br><br>    <span class="hljs-keyword">let</span> centerX = width / <span class="hljs-number">2</span><br>    <span class="hljs-keyword">let</span> centerY = height / <span class="hljs-number">2</span><br>    <span class="hljs-comment">//å–é•¿å®½ä¸­å°çš„ä¸€ä¸ªåšç›´å¾„</span><br>    <span class="hljs-keyword">let</span> maxRadius = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(centerX, centerY)<br><br>    <span class="hljs-comment">//ç•™ä¸€äº›å¤–è¾¹è·</span><br>    <span class="hljs-keyword">let</span> outerCircleRadius = maxRadius - <span class="hljs-number">20</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">&quot;#1b91e0&quot;</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">2</span><br>    <span class="hljs-comment">//æœ€ä¸­é—´çš„å°åœˆåœˆ</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">arc</span>(centerX, centerY, <span class="hljs-number">10</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">false</span>)<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">stroke</span>()<br><br>    <span class="hljs-comment">//ç”»å†…åœˆ</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">beginPath</span>()<br>    <span class="hljs-keyword">let</span> innerCircleRadius = outerCircleRadius -<span class="hljs-number">20</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">arc</span>(centerX, centerY, innerCircleRadius, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">false</span>)<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">stroke</span>()<br><br>    <span class="hljs-comment">//ç”»å¤–åœˆ</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">beginPath</span>()<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">arc</span>(centerX, centerY, outerCircleRadius, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">false</span>);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">stroke</span>()<br>    <br>  &#125;)<br></code></pre></td></tr></table></figure><p>æ•ˆæœå›¾  </p><p><img src="/image/HarmonyOS/canvas_ring.png" alt="image.png"></p><p>çœ‹ç€è¿˜è¡Œï¼Œé¢œè‰²å’Œç²—ç»†å¤§å®¶è‡ªå·±è°ƒã€‚</p><h4 id="ç¬¬äºŒæ­¥-ç”»æ ¼å­"><a href="#ç¬¬äºŒæ­¥-ç”»æ ¼å­" class="headerlink" title="ç¬¬äºŒæ­¥ ç”»æ ¼å­"></a>ç¬¬äºŒæ­¥ ç”»æ ¼å­</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-comment">//ç”» 60 ä¸ªæ ¼å­ï¼Œ5 çš„å€æ•°åˆ™çº¿æ¡ç²—ä¸€äº›</span><br><span class="hljs-keyword">let</span> perMinuteDegree = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span> / <span class="hljs-number">60</span><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>;i &lt;= <span class="hljs-number">60</span>; i++) &#123;<br>  <span class="hljs-comment">//ç»“æŸåæ ‡ï¼Œä¹Ÿå°±æ˜¯åœ¨å¤–åœ†ä¸Šçš„ç‚¹</span><br>  <span class="hljs-keyword">let</span> endX = centerX + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(i * perMinuteDegree) * outerCircleRadius<br>  <span class="hljs-keyword">let</span> endY = centerY + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(i * perMinuteDegree + <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>) * outerCircleRadius<br>  <span class="hljs-comment">//èµ·å§‹åæ ‡ï¼Œä¹Ÿå°±æ˜¯åœ¨å†…åœ†ä¸Šçš„ç‚¹</span><br>  <span class="hljs-keyword">let</span> startX = centerX + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(i * perMinuteDegree) * innerCircleRadius<br>  <span class="hljs-keyword">let</span> startY = centerY + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(i * perMinuteDegree + <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>) * innerCircleRadius<br><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">&quot;#000000&quot;</span><br>  <span class="hljs-keyword">let</span> path2D = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path2D</span>()<br>  path2D.<span class="hljs-title function_">moveTo</span>(startX, startY)<br>  path2D.<span class="hljs-title function_">lineTo</span>(endX, endY)<br>  <span class="hljs-keyword">if</span> (i % <span class="hljs-number">5</span> == <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">6</span><br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">2</span><br>  &#125;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">stroke</span>(path2D)<br>&#125;<br></code></pre></td></tr></table></figure><p>æ•ˆæœå›¾  </p><p><img src="/image/HarmonyOS/canvas_ring_clock.png" alt="image.png"><br>é©¬é©¬è™è™ï¼Œä¸å¤ªå¥½çœ‹ã€‚<br>è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œç”»å¸ƒæ˜¯ä»¥å‚ç›´å‘ä¸‹ä¸º Y è½´çš„æ­£æ–¹å‘ï¼Œè®¡ç®—æ—¶åŠ äº† <code>Math.PI</code> å¼§åº¦çº æ­£ä¸€ä¸‹  </p><h4 id="ç¬¬ä¸‰æ­¥-ç”»æ•°å­—"><a href="#ç¬¬ä¸‰æ­¥-ç”»æ•°å­—" class="headerlink" title="ç¬¬ä¸‰æ­¥ ç”»æ•°å­—"></a>ç¬¬ä¸‰æ­¥ ç”»æ•°å­—</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-comment">//ç”» 1~12 æ•°å­—åœ†å½¢åˆ†å¸ƒ</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">font</span> = <span class="hljs-string">&quot;40px&quot;</span><br><span class="hljs-keyword">let</span> perNumberDegree = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span> / <span class="hljs-number">12</span><br><span class="hljs-keyword">let</span> numberRadius = outerCircleRadius - <span class="hljs-number">40</span><br><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>;i &lt;= <span class="hljs-number">12</span>; i++) &#123;<br>  <span class="hljs-keyword">let</span> x = centerX + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(i * perNumberDegree) * numberRadius<br>  <span class="hljs-keyword">let</span> y = centerY + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(i * perNumberDegree + <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>) * numberRadius<br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span> = i + <span class="hljs-string">&quot;&quot;</span><br><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">&quot;#000000&quot;</span><br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">textMetrics</span>: <span class="hljs-title class_">TextMetrics</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">measureText</span>(text)<br>  <span class="hljs-comment">//å¡«å……æ–‡å­—æ—¶ï¼Œä¼ å…¥çš„åæ ‡æ˜¯æ–‡å­—çš„å·¦ä¸‹è§’åæ ‡</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">fillText</span>(text, x-textMetrics.<span class="hljs-property">width</span>/<span class="hljs-number">2</span> , y+textMetrics.<span class="hljs-property">height</span>/<span class="hljs-number">2</span>)<br>  <span class="hljs-comment">//æŠŠä¸‹é¢è¿™ä¸¤è¡Œæ³¨é‡Šæ‰å°±æ²¡æœ‰å°æ–¹å—äº†</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">&quot;#aaff6134&quot;</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">fillRect</span>(x,y,textMetrics.<span class="hljs-property">width</span>,textMetrics.<span class="hljs-property">height</span>)<br><br>&#125;<br></code></pre></td></tr></table></figure><p>æ•ˆæœå›¾</p><p><img src="/image/HarmonyOS/canvas_ring_clock_number.png" alt="image.png"><br>å›¾ä¸Šçš„æ–¹å—æ˜¯ä¸ºäº†å¯¹æ¯”ç”»æ–‡å­—å’Œç”»æ–¹å—çš„åæ ‡åŒºåˆ«å±•ç¤ºå‡ºæ¥çš„ï¼šå¡«å……æ–‡å­—æ—¶ä¼ å…¥çš„åæ ‡æ˜¯<code>æ–‡å­—å·¦ä¸‹è§’çš„åæ ‡</code>ï¼Œè€Œç”»æ–¹å—æ—¶æ˜¯ä¼ å…¥çš„<code>æ–¹å—å·¦ä¸Šè§’åæ ‡</code>,è¿™é‡Œæ³¨æ„ä¸€ä¸‹å°±å¥½äº†ï¼Œä»£ç ä¸­æµ‹é‡äº†ä¸€ä¸‹æ–‡å­—å®½é«˜ï¼Œç²—æš´çš„åšäº†ä¸€ä¸‹çº åã€‚  </p><h4 id="ç¬¬å››ã€äº”æ­¥-ç”»æŒ‡é’ˆ-amp-å®šæ—¶æ›´æ–°"><a href="#ç¬¬å››ã€äº”æ­¥-ç”»æŒ‡é’ˆ-amp-å®šæ—¶æ›´æ–°" class="headerlink" title="ç¬¬å››ã€äº”æ­¥ ç”»æŒ‡é’ˆ&amp;å®šæ—¶æ›´æ–°"></a>ç¬¬å››ã€äº”æ­¥ ç”»æŒ‡é’ˆ&amp;å®šæ—¶æ›´æ–°</h4><p>ä¸Šé¢ä¹Ÿè¯´è¦æŠŠæŒ‡é’ˆç”»åœ¨å¦å¤–ä¸€ä¸ª <code>canvas</code> ä¸Šï¼Œå‡å°‘ä¸€ä¸‹ç»˜åˆ¶æ—¶çš„å†…å®¹ï¼Œæ²¡åšå¯¹æ¯”ï¼Œä¹Ÿä¸çŸ¥é“æœ‰æ²¡æœ‰ä½œç”¨ã€‚<br>å‡†å¤‡å¦å¤–ä¸ªç”»å¸ƒï¼ŒæŠŠä¸¤ä¸ªç”»å¸ƒç”¨ <code>Stack</code> åŒ…ä¸€ä¸‹ã€‚  </p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRenderingClock</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">&quot;100%&quot;</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">&quot;100%&quot;</span>).<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">timer</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-attr">date</span>: <span class="hljs-title class_">Date</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">minute</span> = date.<span class="hljs-title function_">getMinutes</span>()<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hour</span> = date.<span class="hljs-title function_">getHours</span>()<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">second</span> = date.<span class="hljs-title function_">getSeconds</span>()<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">draw</span>()<br>  &#125;.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), <span class="hljs-number">500</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æŠŠç¬¬ä¸€å—ä»£ç ä¸­çš„ <code>innerCircleRadius</code> å˜é‡æåˆ°å¤–éƒ¨ï¼Œä½œä¸ºç±»æˆå‘˜ä¸¤ä¸ªç”»å¸ƒå…±ç”¨ä¸€ä¸‹ï¼Œä¸»è¦æ˜¯è®¡ç®—æŒ‡é’ˆç»ˆç‚¹åæ ‡ç”¨çš„ã€‚<code>centerX</code> å’Œ <code>centerY</code> æ— æ‰€è°“ï¼Œåªè¦ä¸¤ä¸ªç”»å¸ƒå¯¹é½äº†ï¼Œç”¨å“ªä¸ªéƒ½è¡Œï¼Œè¿™é‡Œè¿˜æ˜¯æåˆ°äº†å¤–éƒ¨ï¼Œç”¨çš„ç¬¬ä¸€å—ç”»å¸ƒçš„ã€‚  </p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-keyword">private</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) &#123;<br>  æ¸…ç©ºä¸€ä¸‹ç”»å¸ƒ<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRenderingClock</span>.<span class="hljs-title function_">clearRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerX</span> * <span class="hljs-number">2</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerY</span> * <span class="hljs-number">2</span>)<br><br>  <span class="hljs-comment">//ç”»ç§’é’ˆ</span><br>  <span class="hljs-comment">//è®¡ç®—ç§’é’ˆçš„è§’åº¦</span><br>  <span class="hljs-keyword">let</span> secondDegree = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span> / <span class="hljs-number">60</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">second</span><br>  <span class="hljs-keyword">let</span> secondStartX = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerX</span><br>  <span class="hljs-keyword">let</span> secondStartY = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerY</span><br>  <span class="hljs-keyword">let</span> secondEndX = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerX</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(secondDegree) * <span class="hljs-variable language_">this</span>.<span class="hljs-property">innerCircleRadius</span><br>  <span class="hljs-keyword">let</span> secondEndY = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerY</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(secondDegree + <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>) * <span class="hljs-variable language_">this</span>.<span class="hljs-property">innerCircleRadius</span><br>  <span class="hljs-keyword">let</span> secondPath = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path2D</span>()<br>  secondPath.<span class="hljs-title function_">moveTo</span>(secondStartX, secondStartY)<br>  secondPath.<span class="hljs-title function_">lineTo</span>(secondEndX, secondEndY)<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRenderingClock</span>.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">2</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRenderingClock</span>.<span class="hljs-title function_">stroke</span>(secondPath)<br><br><br>  <span class="hljs-comment">//ç”»åˆ†é’ˆ é¢œè‰²å¼„ç‚¹é€æ˜åº¦ï¼Œè¦ä¸ç„¶é‡åˆçš„æ—¶å€™çœ‹ä¸æ¸…æ¥š</span><br>  <span class="hljs-comment">//ç§’é’ˆèµ°ä¸€åœˆï¼Œåˆ†é’ˆèµ°ä¸€æ ¼ï¼Œå…¶å®å¯ä»¥å¿½ç•¥ä¸è®¡</span><br>  <span class="hljs-keyword">let</span> minuteDegree = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span> / <span class="hljs-number">60</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">minute</span><br>  <span class="hljs-keyword">let</span> minuteStartX = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerX</span><br>  <span class="hljs-keyword">let</span> minuteStartY = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerY</span><br>  <span class="hljs-keyword">let</span> minuteEndX = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerX</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(minuteDegree) * (<span class="hljs-variable language_">this</span>.<span class="hljs-property">innerCircleRadius</span> / <span class="hljs-number">5</span> * <span class="hljs-number">4</span>)<br>  <span class="hljs-keyword">let</span> minuteEndY = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerY</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(minuteDegree + <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>) * (<span class="hljs-variable language_">this</span>.<span class="hljs-property">innerCircleRadius</span> / <span class="hljs-number">5</span> * <span class="hljs-number">4</span>)<br>  <span class="hljs-keyword">let</span> minutePath = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path2D</span>()<br>  minutePath.<span class="hljs-title function_">moveTo</span>(minuteStartX, minuteStartY)<br>  minutePath.<span class="hljs-title function_">lineTo</span>(minuteEndX, minuteEndY)<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRenderingClock</span>.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">&quot;#aa1b91e0&quot;</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRenderingClock</span>.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">4</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRenderingClock</span>.<span class="hljs-title function_">stroke</span>(minutePath)<br><br>  <span class="hljs-comment">//ç”»æ—¶é’ˆ</span><br>  <span class="hljs-comment">//åˆ†é’ˆèµ°ä¸€åœˆï¼Œæ—¶é’ˆèµ° 5 å°æ ¼</span><br>  <span class="hljs-keyword">let</span> hourDegree = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span> / <span class="hljs-number">12</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">hour</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">minute</span> / <span class="hljs-number">60</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span> / <span class="hljs-number">12</span><br>  <span class="hljs-keyword">let</span> hourStartX = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerX</span><br>  <span class="hljs-keyword">let</span> hourStartY = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerY</span><br>  <span class="hljs-keyword">let</span> hourEndX = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerX</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(hourDegree) * (<span class="hljs-variable language_">this</span>.<span class="hljs-property">innerCircleRadius</span> / <span class="hljs-number">4</span> * <span class="hljs-number">3</span>)<br>  <span class="hljs-keyword">let</span> hourEndY = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerY</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(hourDegree + <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>) * (<span class="hljs-variable language_">this</span>.<span class="hljs-property">innerCircleRadius</span> / <span class="hljs-number">4</span> * <span class="hljs-number">3</span>)<br>  <span class="hljs-keyword">let</span> hourPath = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path2D</span>()<br>  hourPath.<span class="hljs-title function_">moveTo</span>(hourStartX, hourStartY)<br>  hourPath.<span class="hljs-title function_">lineTo</span>(hourEndX, hourEndY)<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRenderingClock</span>.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">6</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRenderingClock</span>.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">&quot;#aa39d167&quot;</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRenderingClock</span>.<span class="hljs-title function_">stroke</span>(hourPath)<br>&#125;<br></code></pre></td></tr></table></figure><p>è®¡ç®—æŒ‡é’ˆè§’åº¦çš„æ—¶å€™ä¹Ÿå·æ‡’äº†ï¼Œæ—¶é’ˆåªè€ƒè™‘äº†å½“å‰åˆ†é’Ÿæ•°ï¼Œæ²¡æœ‰è€ƒè™‘ç§’æ•°ï¼Œå®é™…å·®ä¸å¤šï¼Œå…ˆè¿™æ ·å§ã€‚  </p><h4 id="æœ€åä¸€æ­¥"><a href="#æœ€åä¸€æ­¥" class="headerlink" title="æœ€åä¸€æ­¥"></a>æœ€åä¸€æ­¥</h4><p>æ•ˆæœå›¾</p><p><img src="/image/HarmonyOS/canvas_clock_finish.png" alt="image.png"><br>å°±å…ˆè¿™æ ·å§ï¼Œå‹‰å‹‰å¼ºå¼ºï¼Œå¯ä»¥è‡ªå·±è°ƒè°ƒé¢œè‰²ï¼Œè°ƒè°ƒæ ·å¼ï¼Œæˆ–è€…æä¸€äº›å›¾ç‰‡æ¥ä»£æ›¿è¿™äº›å…ƒç´ ä¹Ÿè¡Œã€‚  </p><p>æºç åœ¨è¿™é‡Œ <a href="https://github.com/huangyuanlove/HelloArkUI/blob/main/entry/src/main/ets/pages/playground/AlarmClockPage.ets">github</a> ,<br><a href="https://gitee.com/huangyuan/HelloArkUI/blob/main/entry/src/main/ets/pages/playground/AlarmClockPage.ets">gitee</a></p><p>ä»“åº“åœ°å€ï¼š<a href="https://github.com/huangyuanlove/HelloArkUI">https://github.com/huangyuanlove/HelloArkUI</a>  </p><p><a href="https://gitee.com/huangyuan/HelloArkUI">https://gitee.com/huangyuan/HelloArkUI</a></p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>HarmonyOS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¸¿è’™--canvas å®ç°æ³¢æµªæ•ˆæœ</title>
    <link href="/2024/03/27/%E9%B8%BF%E8%92%99-canvas-%E5%AE%9E%E7%8E%B0%E6%B3%A2%E6%B5%AA%E6%95%88%E6%9E%9C/"/>
    <url>/2024/03/27/%E9%B8%BF%E8%92%99-canvas-%E5%AE%9E%E7%8E%B0%E6%B3%A2%E6%B5%AA%E6%95%88%E6%9E%9C/</url>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>Android ä¸­ canvas èƒ½ç”»å‡ºæ¥çš„ä¸œè¥¿é¸¿è’™çš„ canvas è¿˜ç”»ä¸äº†ï¼Œä¸å¤§å¯èƒ½å§ï¼Ÿæœ‰ä¸ªæœ‹å‹é—®é¸¿è’™åº”ç”¨ä¸­æƒ³å®ç°æ³¢æµªæ•ˆæœï¼Œåº”è¯¥å’‹ç”»ï¼Ÿè¿™ä¸ªé—®é¢˜ï¼Œä½ èƒ½åœ¨ Android ä¸Šç”¨ canvas ç”»å‡ºæ¥ï¼Œåœ¨é¸¿è’™é‡Œé¢ç”¨ canvas ç”»ä¸å‡ºæ¥ï¼Ÿè¿˜æ˜¯ api ä¸ç†Ÿæ‚‰å§ï¼Ÿ</p><h3 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h3><p>æ³¢æµªæ•ˆæœå˜›ï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯æ­£å¼¦ã€ä½™å¼¦å‡½æ•°ã€è´å¡å°”æ›²çº¿ï¼Œè¿˜æœ‰ä¸€ä¸ªå‚…é‡Œå¶å˜æ¢ï¼Œä¸è¿‡è¿™ä¸ªæœ‰ç‚¹æä¸å®šã€‚è¿™é‡Œé€‰æ‹©ä½¿ç”¨è´å¡å°”æ›²çº¿ï¼Œå› ä¸ºä¹‹å‰åœ¨ Android ä¸­ç”»è¿‡ï¼Œåº”è¯¥å¯ä»¥å¾ˆä¸æ»‘çš„è¿ç§»è¿‡æ¥<br>å…ˆå¤ä¹ ä¸€ä¸‹åœ¨ Android ä¸­æ€ä¹ˆå®ç°ï¼š<a href="https://blog.huangyuanlove.com/2019/01/20/%E8%87%AA%E5%AE%9A%E4%B9%89View-%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF%E3%80%81Shader/">https://blog.huangyuanlove.com/2019/01/20/%E8%87%AA%E5%AE%9A%E4%B9%89View-%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF%E3%80%81Shader/</a></p><p>ç¡®è®¤èµ·å§‹ç‚¹ï¼Œç¡®è®¤ç»ˆç‚¹ï¼Œè®¡ç®—æ§åˆ¶ç‚¹ï¼Œç„¶åè°ƒç”¨ api åˆ’çº¿ï¼Œæœ€åå¡«å……ä¸€ä¸‹å°±å¥½äº†ã€‚<br>æ€ä¹ˆåŠ¨èµ·æ¥ï¼ŸAndroid è¿™è¾¹ç”¨çš„åŠ¨ç”»ï¼Œå…¶å®ç”¨ handler æˆ–è€…å…¶ä»–ä¸œè¥¿æä¸ªå®šæ—¶æ›´æ–°ä¹Ÿè¡Œã€‚<br>å…ˆçœ‹æ•ˆæœå›¾<br><img src="/image/HarmonyOS/wave.gif" alt="wave.gif">  </p><p>çœ‹ä¸‹é¸¿è’™å¯¹åº”çš„ apiï¼Œç›®å‰å¼€æ”¾çš„æœ€æ–°çš„HarmonyOSæ–‡æ¡£æ˜¯ 3.1&#x2F;4.0çš„ï¼Œå¯¹åº”åœ°å€æ˜¯è¿™ä¸ª <a href="https://developer.harmonyos.com/cn/docs/documentation/doc-references-V3/ts-canvasrenderingcontext2d-0000001478181441-V3#ZH-CN_TOPIC_0000001573928937__quadraticcurveto">https://developer.harmonyos.com/cn/docs/documentation/doc-references-V3/ts-canvasrenderingcontext2d-0000001478181441-V3#ZH-CN_TOPIC_0000001573928937__quadraticcurveto</a><br>ç›®å‰å¼€æ”¾çš„æœ€æ–°çš„ OpenHarmony æ–‡æ¡£æ˜¯4.0 çš„ï¼Œå¯¹åº”åœ°å€åœ¨è¿™é‡Œ <a href="https://docs.openharmony.cn/pages/v4.0/zh-cn/application-dev/ui/arkts-drawing-customization-on-canvas.md/#%E7%94%BB%E5%B8%83%E7%BB%84%E4%BB%B6%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95">https://docs.openharmony.cn/pages/v4.0/zh-cn/application-dev/ui/arkts-drawing-customization-on-canvas.md/#%E7%94%BB%E5%B8%83%E7%BB%84%E4%BB%B6%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95</a><br>æ­¥éª¤éƒ½å·®ä¸å¤šï¼Œåªä¸è¿‡é¸¿è’™ä¸­æ²¡æœ‰ç”»ç¬”çš„æ¦‚å¿µï¼Œéœ€è¦å¯¹<code>CanvasRenderingContext2D</code>å¯¹è±¡è¿›è¡Œæ“ä½œè®¾ç½®ï¼ŒåŒ…æ‹¬è®¾ç½®çº¿æ¡é¢œè‰²ã€çº¿æ¡å®½åº¦ã€å›¾å‹å¡«å……é¢œè‰²ç­‰ã€‚<br>æƒ³è¦ç”»çº¿ã€ç”»å‡ºå„ç§å½¢çŠ¶ï¼Œå¯ä»¥ç›´æ¥æ“ä½œ<code>CanvasRenderingContext2D</code>å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥åˆ›å»º<code>Path2D</code>å¯¹è±¡è¿›è¡Œæ“ä½œã€‚å…¶ä½™ api å¯ä»¥æŸ¥çœ‹å¯¹åº”çš„æ–‡æ¡£ã€‚  </p><h3 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h3><p>è¿™è¿˜æœ‰å•¥å¥½è®¾è®¡çš„ï¼Œç›´æ¥<del>æŠ„</del>ç§»æ¤ Android ä¸Šé¢çš„å®ç°å°±å¥½äº†<br>ç”±äºéœ€è¦åŠ¨èµ·æ¥ï¼Œä¸ºäº†é¿å…ç§»åŠ¨åå·¦å³æœ‰ç©ºç™½ï¼Œè¿™é‡Œéœ€è¦<strong>å¤šç”»ä¸€ä¸ªæ³¢æµª</strong></p><p><img src="/image/HarmonyOS/wave.png" alt="WX20240108-233545@2x.png">  </p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦ä¸Šé¢è¿™æ¡è“è‰²çš„çº¿ï¼Œè€Œä¸æ˜¯ä¸‹é¢è¿™æ¡ç»¿è‰²çš„ã€‚</p><p>åœ¨ Android ä¸­ç”»äºŒé˜¶è´å¡å°”æ›²çº¿æœ‰ä¸¤ä¸ª api,ä¸€ä¸ªæ˜¯<br><code>public void rQuadTo(float dx1, float dy1, float dx2, float dy2)</code><br>è¿™ä¸ªè¡¨ç¤ºçš„æ˜¯æ§åˆ¶ç‚¹å’Œç»ˆç‚¹ç›¸å¯¹äºä¸Šä¸€ä¸ªæ§åˆ¶ç‚¹å’Œç»ˆç‚¹çš„åç§»é‡<br>å¦å¤–ä¸€ä¸ªæ˜¯<br><code>public void quadTo(float x1, float y1, float x2, float y2)</code><br>è¿™ä¸ªè¡¨ç¤ºæ˜¯æ§åˆ¶ç‚¹å’Œç»ˆç‚¹çš„ç»å¯¹åæ ‡å€¼<br>ä½†åœ¨é¸¿è’™ä¸­æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ apiï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±è®¡ç®—ä¸€ä¸‹ï¼šè¿™é‡Œçš„æ§åˆ¶ç‚¹çš„æ¨ªåæ ‡æ˜¯èµ·ç‚¹å’Œç»ˆç‚¹çš„ä¸­é—´å€¼ï¼Œæ§åˆ¶ç‚¹çš„çºµåæ ‡å–çš„æ˜¯æ³¢æµªé«˜åº¦<br>æ‰€ä»¥ä¸Šé¢ä¸¤æ¡çº¿çš„ç”»æ³•æ˜¯è¿™æ ·çš„</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">&quot;100%&quot;</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">&quot;30%&quot;</span>)<br>        .<span class="hljs-title function_">onAreaChange</span>(<span class="hljs-function">(<span class="hljs-params">oldValue,newValue</span>)=&gt;</span>&#123;<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">&quot;#39d167&quot;</span><br><br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">&quot;#39d167&quot;</span><br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">10</span><br>          <span class="hljs-keyword">let</span> canvasWidth = <span class="hljs-built_in">parseInt</span>(newValue.<span class="hljs-property">width</span>.<span class="hljs-title function_">toString</span>())<br>          <span class="hljs-keyword">let</span> canvasHeight = <span class="hljs-built_in">parseInt</span>(newValue.<span class="hljs-property">height</span>.<span class="hljs-title function_">toString</span>())<br><br>          <span class="hljs-keyword">let</span> waveWidth = canvasWidth/<span class="hljs-number">2</span><br>          <span class="hljs-keyword">let</span> waveHeight = <span class="hljs-number">100</span><br>          <span class="hljs-keyword">let</span> baseHeight =canvasHeight<br><br>          <span class="hljs-keyword">let</span> <span class="hljs-attr">path</span>:<span class="hljs-title class_">Path2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path2D</span>()<br>          <br>          path.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">0</span>,baseHeight)<br>          <span class="hljs-comment">//æ³¢æµªå®½åº¦æ˜¯ç”»å¸ƒçš„ä¸€åŠï¼Œè¿™é‡Œå·æ‡’ç›´æ¥å†™äº†</span><br>          path.<span class="hljs-title function_">quadraticCurveTo</span>( waveWidth/<span class="hljs-number">2</span>,baseHeight-waveHeight ,waveWidth,baseHeight)<br>          path.<span class="hljs-title function_">quadraticCurveTo</span>(waveWidth+waveWidth/<span class="hljs-number">2</span>,  baseHeight-waveHeight ,canvasWidth,baseHeight)<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">stroke</span>(path)<br><br><br>          path = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path2D</span>()<br>          baseHeight /=<span class="hljs-number">3</span><br>          path.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">0</span>,baseHeight)<br>          <span class="hljs-comment">//æ³¢æµªå®½åº¦æ˜¯ç”»å¸ƒçš„ä¸€åŠï¼Œè¿™é‡Œå·æ‡’ç›´æ¥å†™äº†</span><br>          path.<span class="hljs-title function_">quadraticCurveTo</span>( waveWidth/<span class="hljs-number">2</span>,baseHeight-waveHeight ,waveWidth,baseHeight)<br>          path.<span class="hljs-title function_">quadraticCurveTo</span>(waveWidth+waveWidth/<span class="hljs-number">2</span>,  baseHeight+waveHeight ,canvasWidth,baseHeight)<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">&quot;#1b91e0&quot;</span><br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">stroke</span>(path)<br>          <br>        &#125;)<br></code></pre></td></tr></table></figure><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>å®ç°ä¹Ÿä¸€æ ·ï¼Œç›´æ¥<del>æŠ„</del> ç§»æ¤è¿‡æ¥å°±å¥½äº†ï¼Œå¯¹åº”çš„ api æ€ä¹ˆç”¨ä¹Ÿæå®šäº†ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">WaveView</span>&#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">settings</span>: <span class="hljs-title class_">RenderingContextSettings</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderingContextSettings</span>(<span class="hljs-literal">true</span>)<br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">canvasRendering</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasRenderingContext2D</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>)<br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">canvasHeight</span>: <span class="hljs-built_in">number</span> = -<span class="hljs-number">1</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">canvasWidth</span>: <span class="hljs-built_in">number</span> = -<span class="hljs-number">1</span><br>  <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-attr">dx</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span> <span class="hljs-comment">//æœ€å¤§å€¼ç­‰äº waveWidthï¼Œæ¯æ¬¡ç§»åŠ¨çš„è·ç¦»</span><br>  <span class="hljs-keyword">private</span> waveHeight = <span class="hljs-number">50</span> <span class="hljs-comment">//æ‹è„‘è¢‹è®¢çš„æ•°å€¼</span><br>  <span class="hljs-keyword">private</span> baseHeight = <span class="hljs-number">300</span> <span class="hljs-comment">//æ‹è„‘è¢‹è®¢çš„æ•°å€¼</span><br>  <span class="hljs-keyword">private</span> waveWidth = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">intervalTimer</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span><br>  <span class="hljs-title function_">drawWave</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dx</span> += <span class="hljs-number">4</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">dx</span> &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">waveWidth</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">dx</span> = <span class="hljs-number">0</span><br>    &#125;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">clearRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span>)<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">waveWidth</span> == <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">waveWidth</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span> / <span class="hljs-number">2</span><br>    &#125;<br><br>    <span class="hljs-keyword">let</span> <span class="hljs-attr">path</span>: <span class="hljs-title class_">Path2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path2D</span>()<br>    <span class="hljs-comment">//éœ€è¦åœ¨å±å¹•å¤–å¤šç”»ä¸€ä¸ªæ³¢æµªï¼Œè¿™é‡Œå…ˆå°†ç”»ç¬”ç§»åŠ¨åˆ°ç”»å¸ƒ|å±å¹•å¤–ï¼Œè®°å¾—åŠ ä¸ŠåŠ¨ç”»çš„åç§»é‡ dx</span><br>    path.<span class="hljs-title function_">moveTo</span>(-<span class="hljs-variable language_">this</span>.<span class="hljs-property">waveWidth</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">dx</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseHeight</span>)<br>    <span class="hljs-keyword">let</span> startX = -<span class="hljs-variable language_">this</span>.<span class="hljs-property">waveWidth</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">dx</span><span class="hljs-comment">//è®°å½•å¼€å§‹ç‚¹çš„æ¨ªåæ ‡</span><br>    <span class="hljs-comment">//éœ€è¦å¤šç”»ä¸€ä¸ªæ³¢æµªï¼Œç›´æ¥å¾ªç¯å¼€å§‹ç”»å°±å¥½äº†</span><br>    <span class="hljs-keyword">while</span> (startX &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">dx</span>) &#123;<br><br>      <span class="hljs-keyword">let</span> endY = <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseHeight</span><br>      <span class="hljs-comment">//ç”»å‘ä¸‹å’Œå‘ä¸Šçš„æ³¢æµªï¼Œå…¨é æ§åˆ¶ç‚¹çš„çºµåæ ‡æ§åˆ¶æ³¢æµªçš„ä¸Šçº¿</span><br>      path.<span class="hljs-title function_">quadraticCurveTo</span>(startX + <span class="hljs-variable language_">this</span>.<span class="hljs-property">waveWidth</span> / <span class="hljs-number">4</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseHeight</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">waveHeight</span>, startX + <span class="hljs-variable language_">this</span>.<span class="hljs-property">waveWidth</span>/<span class="hljs-number">2</span>, endY)<br>      path.<span class="hljs-title function_">quadraticCurveTo</span>(startX + <span class="hljs-variable language_">this</span>.<span class="hljs-property">waveWidth</span> / <span class="hljs-number">4</span>*<span class="hljs-number">3</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseHeight</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">waveHeight</span>, startX + <span class="hljs-variable language_">this</span>.<span class="hljs-property">waveWidth</span>, endY)<br>      <span class="hljs-comment">//ç”»å®Œä¸€ä¸Šä¸€ä¸‹è¿™ä¸€ç»„æ³¢æµªåæ›´æ–°èµ·å§‹ç‚¹åæ ‡</span><br>      startX += <span class="hljs-variable language_">this</span>.<span class="hljs-property">waveWidth</span><br>    &#125;<br>    <span class="hljs-comment">//éœ€è¦å°†æ³¢æµªçº¿ä¸‹æ–¹çš„åŒºåŸŸå¡«æ»¡é¢œè‰²ï¼Œè¿™é‡Œå–å·§åœˆèµ·æ¥ä¸€ä¸ªæ¡†ï¼Œä½¿ç”¨ fill æ–¹æ³•å¡«å……</span><br>    path.<span class="hljs-title function_">lineTo</span>(startX ,<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span>) <span class="hljs-comment">//æ³¢æµªçº¿æœ€å³ä¾§ç”»ä¸€æ¡åˆ°ç”»å¸ƒåº•éƒ¨çš„å‚çº¿</span><br>    path.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">0</span> ,<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span>)<span class="hljs-comment">//ç”»å¸ƒåº•éƒ¨çš„æ¨ªçº¿</span><br>    path.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">0</span> ,<span class="hljs-variable language_">this</span>.<span class="hljs-property">baseHeight</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">waveHeight</span>) <span class="hljs-comment">//æ³¢æµªçº¿æœ€å·¦ä¾§åˆ°ç”»å¸ƒåº•éƒ¨çš„å‚çº¿</span><br><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">&quot;#39d167&quot;</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">&quot;#39d167&quot;</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">10</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">fill</span>(path)<br><br>  &#125;<br><br>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Column</span>() &#123;<br>      <span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>).<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">&quot;100%&quot;</span>)<br>        .<span class="hljs-title function_">onAreaChange</span>(<span class="hljs-function">(<span class="hljs-params">oldValue, newValue</span>) =&gt;</span> &#123;<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span> = <span class="hljs-built_in">parseInt</span>(newValue.<span class="hljs-property">width</span>.<span class="hljs-title function_">toString</span>())<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span> = <span class="hljs-built_in">parseInt</span>(newValue.<span class="hljs-property">height</span>.<span class="hljs-title function_">toString</span>())<br><br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseHeight</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span> - <span class="hljs-number">300</span><br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">waveWidth</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span> / <span class="hljs-number">2</span><br>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawWave</span>()<br><br>        &#125;)<br>      <span class="hljs-title class_">Row</span>() &#123;<br>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">&quot;å¼€å§‹&quot;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">intervalTimer</span> != <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">intervalTimer</span>)<br>          &#125;<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">intervalTimer</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawWave</span>()<br>          &#125;.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), <span class="hljs-number">10</span>)<br>        &#125;)<br>        <span class="hljs-title class_">Blank</span>().<span class="hljs-title function_">width</span>(<span class="hljs-number">15</span>)<br>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">&quot;åœæ­¢&quot;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">intervalTimer</span> != <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">intervalTimer</span>)<br>          &#125;<br>        &#125;)<br>      &#125;.<span class="hljs-title function_">margin</span>(&#123; <span class="hljs-attr">bottom</span>: <span class="hljs-number">10</span> &#125;)<br><br>    &#125;<br>  &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä¸Šé¢å°±æ˜¯å®Œæ•´çš„ä»£ç äº†ï¼Œgithub ä»“åº“åœ¨è¿™é‡Œï¼š<a href="https://github.com/huangyuanlove/HelloArkUI/blob/main/entry/src/main/ets/pages/playground/WaveView.ets">https://github.com/huangyuanlove/HelloArkUI/blob/main/entry/src/main/ets/pages/playground/WaveView.ets</a><br><a href="https://github.com/huangyuanlove/HelloArkUI/blob/main/entry/src/main/ets/pages/playground/WaveLinePage.ets">https://github.com/huangyuanlove/HelloArkUI/blob/main/entry/src/main/ets/pages/playground/WaveLinePage.ets</a></p><h3 id="è¿›åŒ–"><a href="#è¿›åŒ–" class="headerlink" title="è¿›åŒ–"></a>è¿›åŒ–</h3><p>ç¨å¾®ä¿®æ”¹ä¸€ä¸‹å°±å¯ä»¥åšæˆå…¶ä»–æ•ˆæœ<br>æ¯”å¦‚å°†<code>baseHeight</code>ä¹Ÿç”¨<code>@State</code>ä¿®é¥°ä¸€ä¸‹ï¼ŒåŒæ—¶åœ¨å®šæ—¶å™¨ä¸­æ›´æ–°ä¸€ä¸‹ï¼Œå°±å¯ä»¥å®ç°æ³¨æ°´æ•ˆæœ<br>å†å°†ç”»å¸ƒè£æˆåœ†å½¢ï¼Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„å……ç”µã€å†…å­˜åŠ é€Ÿçƒæ•ˆæœã€‚å†åšç‚¹éšæœºçš„ç²’å­æ•ˆæœæˆ–è€…å¤šç”»å‡ æ¡æµ…è‰²çš„æ³¢æµªçº¿ï¼Œæ•ˆæœå°±æ›´å¥½äº†</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>HarmonyOS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>riverpod2ä¸­çš„ä¿®é¥°ç¬¦åŠæ³¨è§£</title>
    <link href="/2024/03/27/riverpod2%E4%B8%AD%E7%9A%84%E4%BF%AE%E9%A5%B0%E7%AC%A6%E5%8F%8A%E6%B3%A8%E8%A7%A3/"/>
    <url>/2024/03/27/riverpod2%E4%B8%AD%E7%9A%84%E4%BF%AE%E9%A5%B0%E7%AC%A6%E5%8F%8A%E6%B3%A8%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<p>åŸæ–‡æ¥è‡ªï¼š<a href="https://codewithandrea.com/articles/flutter-state-management-riverpod/">https://codewithandrea.com/articles/flutter-state-management-riverpod/</a></p><h3 id="ç›‘å¬ã€è§‚å¯Ÿã€é€‰æ‹©ã€è®°å½•ã€é‡å»º"><a href="#ç›‘å¬ã€è§‚å¯Ÿã€é€‰æ‹©ã€è®°å½•ã€é‡å»º" class="headerlink" title="ç›‘å¬ã€è§‚å¯Ÿã€é€‰æ‹©ã€è®°å½•ã€é‡å»º"></a>ç›‘å¬ã€è§‚å¯Ÿã€é€‰æ‹©ã€è®°å½•ã€é‡å»º</h3><h4 id="ref-read-or-ref-watch"><a href="#ref-read-or-ref-watch" class="headerlink" title="ref.read or ref.watch"></a>ref.read or ref.watch</h4><p>åœ¨ä¸Šä¸€ç¯‡ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† ref.readå’Œ ref.watchï¼Œé‚£ä¹ˆè¿™ä¸¤è€…åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨ï¼Ÿ<br>ä¸€èˆ¬æ¥è®²ï¼Œå¦‚æœéœ€è¦åœ¨Provider å€¼å‘ç”Ÿæ”¹å˜æ—¶æ›´æ–°ä¾èµ–å®ƒçš„ widgetï¼Œå°±ä½¿ç”¨ watchã€‚æ¯”å¦‚ æˆ‘ä»¬åœ¨ build å‡½æ•°ä¸­ä½¿ç”¨watch,è¿™ç¡®ä¿äº†å¦‚æœæä¾›è€…çš„å€¼å‘ç”Ÿæ›´æ”¹ï¼Œæˆ‘ä»¬ä¼šé‡å»ºä¾èµ–å®ƒçš„widget.</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> counterStateProvider = StateProvider&lt;<span class="hljs-built_in">int</span>&gt;((_) =&gt; <span class="hljs-number">0</span>);<br>  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CounterWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>    <span class="hljs-meta">@override</span><br>    Widget build(BuildContext context, WidgetRef ref) &#123;<br>      <span class="hljs-comment">// 1. watch the provider and rebuild when the value changes</span><br>      <span class="hljs-keyword">final</span> counter = ref.watch(counterStateProvider);<br>      <span class="hljs-keyword">return</span> ElevatedButton(<br>        <span class="hljs-comment">// 2. use the value</span><br>        child: Text(<span class="hljs-string">&#x27;Value: <span class="hljs-subst">$counter</span>&#x27;</span>),<br>        <span class="hljs-comment">// 3. change the state inside a button callback</span><br>        onPressed: () =&gt; ref.read(counterStateProvider.notifier).state++,<br>      );<br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬åªæ˜¯è¯»å–åˆ° Provider çš„å€¼åšæ“ä½œï¼Œä¸€èˆ¬ä½¿ç”¨ readï¼Œæ¯”å¦‚ä¸Šé¢ç‚¹å‡» ElevatedButton æ—¶æˆ‘ä»¬è·å–åˆ° notifier ä¹‹åå¯¹count åšäº†++æ“ä½œ<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šnotifierè¯­æ³•ä»…é€‚ç”¨äºStateProviderå’ŒStateNotifierProviderï¼Œå…¶å·¥ä½œæ–¹å¼å¦‚ä¸‹ï¼š</p><ul><li>åœ¨StateProviderä¸Šè°ƒç”¨ref.read(provider.notifier)ï¼Œä»¥è¿”å›åº•å±‚çš„StateControllerï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥ä¿®æ”¹çŠ¶æ€ã€‚</li><li>åœ¨StateNotifierProviderä¸Šè°ƒç”¨ref.read(provider.notifier)ï¼Œä»¥è¿”å›åº•å±‚çš„StateNotifierï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥è°ƒç”¨å…¶æ–¹æ³•ã€‚</li></ul><h4 id="select"><a href="#select" class="headerlink" title="select"></a>select</h4><p>æˆ‘ä»¬æœ‰æ—¶å€™ä¹Ÿä¼šé‡åˆ°è¿™ç§éœ€æ±‚ï¼šä¸€ä¸ªå¯¹è±¡æœ‰å¤šä¸ªå±æ€§ï¼Œå¸Œæœ›åªæœ‰ç‰¹å®šå±æ€§å‘ç”Ÿå˜åŒ–æ—¶æ‰æ›´æ–°é¡µé¢ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ select æ¥å®Œæˆ</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> </span>&#123;<br>  Student(<span class="hljs-keyword">this</span>.firstName, <span class="hljs-keyword">this</span>.lastName, <span class="hljs-keyword">this</span>.age);<br><br>  <span class="hljs-built_in">String</span> firstName;<br>  <span class="hljs-built_in">String</span> lastName;<br>  <span class="hljs-built_in">int</span> age;<br>  Student copy() &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Student(firstName, lastName, age);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åªéœ€è¦åœ¨å¹´é¾„å‘ç”Ÿæ”¹å˜æ—¶æ›´æ–°é¡µé¢</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart">Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> age = ref.watch( provider.select((value) =&gt; value.age) );<br>    <span class="hljs-keyword">return</span> Text(<span class="hljs-string">&quot;<span class="hljs-subst">$age</span>&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="listen"><a href="#listen" class="headerlink" title="listen"></a>listen</h4><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜æœ‰ listenï¼Œ æ¯”å¦‚æˆ‘ä»¬å¸Œæœ›åœ¨ Provider å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶å¼¹å‡ºä¸€ä¸ª SnakeBaræç¤ºç”¨æˆ·ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åš:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> counterStateProvider = StateProvider&lt;<span class="hljs-built_in">int</span>&gt;((_) =&gt; <span class="hljs-number">0</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CounterWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-comment">// if we use a StateProvider&lt;T&gt;, the type of the previous and current </span><br>    <span class="hljs-comment">// values is StateController&lt;T&gt;</span><br>    ref.listen&lt;StateController&lt;<span class="hljs-built_in">int</span>&gt;&gt;(counterStateProvider.state, (previous, current) &#123;<br>      <span class="hljs-comment">// note: this callback executes when the provider value changes,</span><br>      <span class="hljs-comment">// not when the build method is called</span><br>      ScaffoldMessenger.of(context).showSnackBar(<br>        SnackBar(content: Text(<span class="hljs-string">&#x27;Value is <span class="hljs-subst">$&#123;current.state&#125;</span>&#x27;</span>)),<br>      );<br>    &#125;);<br>    <span class="hljs-comment">// watch the provider and rebuild when the value changes</span><br>    <span class="hljs-keyword">final</span> counter = ref.watch(counterStateProvider);<br>    <span class="hljs-keyword">return</span> ElevatedButton(<br>      <span class="hljs-comment">// use the value</span><br>      child: Text(<span class="hljs-string">&#x27;Value: <span class="hljs-subst">$counter</span>&#x27;</span>),<br>      <span class="hljs-comment">// change the state inside a button callback</span><br>      onPressed: () =&gt; ref.read(counterStateProvider.notifier).state++,<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h4><p>æˆ‘ä»¬éœ€è¦åœ¨ Provider å†…å®¹å‘ç”Ÿæ”¹å˜æ—¶æ‰“å°æ—¥å¿—ï¼Œä»¥æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œè°ƒè¯•ï¼Œä½†åˆä¸æƒ³åœ¨æ¯ä¸ª Provider ä¸­éƒ½åŠ ä¸Šæ‰“å°ä»£ç ï¼Œåº”è¯¥æ€ä¹ˆåŠï¼Ÿ<br>åœ¨ Rivepod ä¸­æœ‰ä¸€ä¸ªProviderObserverç±»ï¼Œæˆ‘ä»¬å¯ä»¥ç»§æ‰¿å®ƒå®ç°è‡ªå·±çš„é€»è¾‘</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProviderLogger</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ProviderObserver</span> </span>&#123;<br>    <span class="hljs-meta">@override</span><br>    <span class="hljs-keyword">void</span> didUpdateProvider(<br>      ProviderBase provider,<br>      <span class="hljs-built_in">Object?</span> previousValue,<br>      <span class="hljs-built_in">Object?</span> newValue,<br>      ProviderContainer container,<br>    ) &#123;<br>      <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[<span class="hljs-subst">$&#123;provider.name ?? provider.runtimeType&#125;</span>] value: <span class="hljs-subst">$newValue</span>&#x27;</span>);<br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼Œéœ€è¦å°†å®ƒæ·»åŠ åˆ° ProviderScopeå†…çš„è§‚å¯Ÿè€…åˆ—è¡¨ä¸­</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> main() &#123;<br>    runApp(<br>      ProviderScope(observers: [ProviderLogger()], child: MyApp()),<br>    );<br>  &#125;<br></code></pre></td></tr></table></figure><p>ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬åŒºåˆ†æ˜¯å“ªä¸€ä¸ª Provider çš„æ—¥å¿—ï¼Œæˆ‘ä»¬åœ¨å£°æ˜ Provider æ—¶å¯ä»¥æä¾›ä¸€ä¸ªåå­—</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> counterStateProvider = StateProvider&lt;<span class="hljs-built_in">int</span>&gt;((ref) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;, name: <span class="hljs-string">&#x27;main_page_counter&#x27;</span>);<br></code></pre></td></tr></table></figure><h3 id="ä¿®é¥°ç¬¦"><a href="#ä¿®é¥°ç¬¦" class="headerlink" title="ä¿®é¥°ç¬¦"></a>ä¿®é¥°ç¬¦</h3><h4 id="autoDispose"><a href="#autoDispose" class="headerlink" title="autoDispose"></a>autoDispose</h4><p>ä¸Šä¸€ç¯‡ä¸­æåˆ°Riverpod ä½œè€…å¼ºçƒˆå»ºè®®å°† Provider å£°æ˜ä¸ºå…¨å±€çš„è€Œä¸æ˜¯ç±»å†…éƒ¨ï¼Œè¿™æ ·æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé¡µé¢é”€æ¯æ—¶ä¹Ÿå°±æ˜¯provideræ²¡æœ‰ä»»ä½•ç›‘å¬è€…æ—¶å¹¶ä¸ä¼šè¢«é‡ç½®ã€‚å†æ¬¡è¿›å…¥é¡µé¢åè¿˜æ˜¯é¡µé¢é”€æ¯ä¹‹å‰çš„å€¼ï¼Œæ¯”å¦‚ StateProvider å®ç°çš„è®¡æ•°åŠŸèƒ½ã€‚å½“æˆ‘ä»¬åœ¨é¡µé¢ä¸­ç‚¹å‡»åŠ å·ï¼Œå°†æ•°å­—å˜ä¸º 5 åï¼Œè¿”å›ä¸Šä¸€ä¸ªé¡µé¢åå†æ¬¡æ‰“å¼€è¯¥é¡µé¢ï¼Œä¼šå‘ç°é¡µé¢è¿˜æ˜¯ 5ã€‚è¿™æœ‰æ—¶ä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨autoDisposeæ¥å®ç°ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> autoDisposeProvider = StateProvider.autoDispose&lt;<span class="hljs-built_in">int</span>&gt;(((ref) &#123;<br>  ref.onDispose(() &#123;<br>    debugPrint(<span class="hljs-string">&quot;countProvider onDispose&quot;</span>);<br>  &#125;);<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;));<br><br><span class="hljs-keyword">final</span> countProvider = StateProvider&lt;<span class="hljs-built_in">int</span>&gt;((ref) =&gt; <span class="hljs-number">1</span>);<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RiverpodAutoDisposeWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-keyword">final</span> autoDisposeValue = ref.watch(autoDisposeProvider);<br>    <span class="hljs-keyword">final</span> normalValue = ref.watch(countProvider);<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;AutoDispose&quot;</span>),<br>        centerTitle: <span class="hljs-keyword">true</span>,<br>      ),<br>      body: Column(children: [<br>        Text(<span class="hljs-string">&quot;autoDispose:å½“privderä¸è¢«ä½¿ç”¨æ—¶ï¼Œå¯ä»¥è¢«è‡ªåŠ¨é‡Šæ”¾&quot;</span>),<br>        Text(<span class="hljs-string">&quot;autoDisposeValue-&gt; <span class="hljs-subst">$&#123;autoDisposeValue&#125;</span>&quot;</span>),<br>        Text(<span class="hljs-string">&quot;normalValue-&gt; <span class="hljs-subst">$&#123;normalValue&#125;</span>&quot;</span>),<br>        Row(<br>          children: [<br>            ElevatedButton(<br>                onPressed: (() &#123;<br>                  ref.read(autoDisposeProvider.notifier).state++;<br>                  ref.read(countProvider.notifier).state++;<br>                &#125;),<br>                child: Text(<span class="hljs-string">&quot;å¢åŠ è®¡æ•°&quot;</span>))<br>          ],<br>        )<br>      ]),<br>    );<br>  &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å½“é¡µé¢è¢«é”€æ¯æ—¶ï¼Œè¢«autoDisposeä¿®é¥°çš„ provider ä¼šè¢«é‡Šæ”¾å¹¶é‡ç½®ã€‚è¿™é‡Œçš„ ref.onDisposeä¼šåœ¨æ²¡æœ‰ç›‘å¬è€…ä¹‹åè°ƒç”¨ã€‚</p><h4 id="keepAlive"><a href="#keepAlive" class="headerlink" title="keepAlive"></a>keepAlive</h4><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ref.keepAliveå®ç°è¶…æ—¶ç¼“å­˜ã€‚<br>ç®€å•ç²—æš´ç‚¹å°±æ˜¯è¿™æ ·ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> tmpProvider = StateProvider.autoDispose&lt;<span class="hljs-built_in">int</span>&gt;((ref)&#123;<br><br>    <span class="hljs-comment">// get the [KeepAliveLink]</span><br>    <span class="hljs-keyword">final</span> link = ref.keepAlive();<br>    <span class="hljs-comment">// start a 30 second timer</span><br>    <span class="hljs-keyword">final</span> timer = Timer(<span class="hljs-keyword">const</span> <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">30</span>), () &#123;<br>      <span class="hljs-comment">// dispose on timeout</span><br>      link.close();<br>    &#125;);<br>    <span class="hljs-comment">// make sure to cancel the timer when the provider state is disposed</span><br>    <span class="hljs-comment">// (prevents undesired test failures)</span><br>    ref.onDispose(() =&gt; timer.cancel());<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;);<br><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>extension</code>å°è£…ä¸€ä¸‹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">extension</span> AutoDisposeRefCache <span class="hljs-keyword">on</span> AutoDisposeRef &#123;<br>  <span class="hljs-keyword">void</span> cacheFor(<span class="hljs-built_in">Duration</span> duration) &#123;<br>    <span class="hljs-keyword">final</span> link = keepAlive();<br>    <span class="hljs-keyword">final</span> timer = Timer(duration, () &#123;<br>      link.close();<br>    &#125;);<br>    onDispose(() &#123;<br>      timer.cancel();<br>    &#125;);<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">//ä½¿ç”¨</span><br><span class="hljs-keyword">final</span> timerCachedProvider = Provider.autoDispose&lt;<span class="hljs-built_in">int</span>&gt;((ref) &#123;<br>  ref.cacheFor(<span class="hljs-built_in">Duration</span>(minutes: <span class="hljs-number">5</span>));<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="family"><a href="#family" class="headerlink" title="family"></a>family</h4><p>æˆ‘ä»¬å¯ä»¥ç”¨å®ƒå‘ Provider æä¾›å‚æ•°ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„è®¡æ•°å™¨ç¤ºä¾‹ï¼Œæ¯”å¦‚æƒ³ä»æŒ‡å®šçš„æ•°å­—å¼€å§‹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> countProviderBase = StateProvider.autoDispose.family&lt;<span class="hljs-built_in">int</span>,<span class="hljs-built_in">int</span>&gt; ((ref,start)&#123;<br>  <span class="hljs-keyword">return</span> start;<br>&#125;);<br><span class="hljs-comment">//ä½¿ç”¨</span><br><span class="hljs-keyword">final</span> startValue =  ref.watch(countProviderBase(<span class="hljs-number">10</span>));<br></code></pre></td></tr></table></figure><h4 id="ä¾èµ–è¦†ç›–"><a href="#ä¾èµ–è¦†ç›–" class="headerlink" title="ä¾èµ–è¦†ç›–"></a>ä¾èµ–è¦†ç›–</h4><p>æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ Provider å­˜å‚¨æ— æ³•ç«‹å³è·å–çš„å¯¹è±¡æˆ–è€…å€¼ï¼Œæ¯”å¦‚åšæœ¬åœ°å­˜å‚¨æ—¶ç”¨çš„<code>shared_preferences</code>ã€‚ä½†æ˜¯å®ƒçš„åˆå§‹åŒ–æ˜¯å¼‚æ­¥çš„ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥åœ¨ Provider ä¸­ä½¿ç”¨åˆ™ä¼šæç¤º</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> spProvider = Provider&lt;SharedPreferences&gt;((ref) &#123;<br>  <span class="hljs-keyword">return</span> SharedPreferences.getInstance();<span class="hljs-comment">//ä¸å¯ä»¥è¿™æ ·ä½¿ç”¨</span><br>  <span class="hljs-comment">//The return type &#x27;Future&lt;SharedPreferences&gt;&#x27; isn&#x27;t a &#x27;SharedPreferences&#x27;, as required by the closure&#x27;s context.</span><br>&#125;);<br></code></pre></td></tr></table></figure><p>è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥å…ˆæŠ›å‡ºä¸€ä¸ªä¸ºå®ç°çš„å¼‚å¸¸</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> sharedPreferencesProvider = Provider&lt;SharedPreferences&gt;((ref) &#123;<br>    <span class="hljs-keyword">throw</span> UnimplementedError();<br>  &#125;);<br></code></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨ ProviderScope ç»„ä»¶ä¸­è¿›è¡Œä¾èµ–è¦†ç›–</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dart">Future&lt;<span class="hljs-keyword">void</span>&gt; main() <span class="hljs-keyword">async</span> &#123;<br>  WidgetsFlutterBinding.ensureInitialized();<br>  <span class="hljs-keyword">final</span> sharedPreferences = <span class="hljs-keyword">await</span> SharedPreferences.getInstance();<br>  runApp(ProviderScope(<br>    overrides: [<br>      <span class="hljs-comment">// override the previous value with the new object</span><br>      sharedPreferencesProvider.overrideWithValue(sharedPreferences),<br>    ],<br>    child: MyApp(),<br>  ));<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è§‚å¯ŸsharedPreferencesProviderå¯¹è±¡ï¼Œè€Œæ— éœ€ä½¿ç”¨åŸºäºFutureçš„API</p><h3 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h3><p>æˆ‘ä»¬åœ¨ä½¿ç”¨ Provider æ—¶éƒ½éœ€è¦æ‰‹åŠ¨ç¼–å†™ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥ä½¿ç”¨ build_runnerç”Ÿæˆï¼ŸRiverpod ä¸­å·²ç»æä¾›äº†è¿™ç§æ–¹å¼ï¼Œä½†å½“å‰åªæ”¯æŒä»¥ä¸‹å‡ ç§</p><ul><li>Provider</li><li>FutureProvider</li><li>StreamProvider</li><li>NotifierProvider</li><li>AsyncNotifierProvider</li></ul><h4 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-comment"># or flutter_riverpod/hooks_riverpod as per https://riverpod.dev/docs/getting_started</span><br>  <span class="hljs-attr">riverpod:</span> <span class="hljs-string">^2.4.10</span><br>  <span class="hljs-comment"># the annotation package containing @riverpod</span><br>  <span class="hljs-attr">riverpod_annotation:</span> <span class="hljs-string">^2.3.4</span><br><span class="hljs-attr">dev_dependencies:</span><br>  <span class="hljs-comment"># a tool for running code generators</span><br>  <span class="hljs-attr">build_runner:</span><br>  <span class="hljs-comment"># the code generator</span><br>  <span class="hljs-attr">riverpod_generator:</span> <span class="hljs-string">^2.3.9</span><br>  <span class="hljs-comment"># riverpod_lint makes it easier to work with Riverpod</span><br>  <span class="hljs-attr">riverpod_lint:</span> <span class="hljs-string">^2.3.7</span><br>  <span class="hljs-comment"># import custom_lint too as riverpod_lint depends on it</span><br>  <span class="hljs-attr">custom_lint:</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­<code>riverpod_lint</code>å’Œ<code>custom_lint</code>è¿™ä¸¤ä¸ªåŒ…æ˜¯å¯é€‰çš„ã€‚<br>ä¹‹åæˆ‘ä»¬éœ€è¦åœ¨<code>watch</code>æ¨¡å¼ä¸‹å¯åŠ¨ä»£ç ç”Ÿæˆå™¨<br><code>flutter pub run build_runner watch -d</code>,è¾ƒæ–°çš„flutterç‰ˆæœ¬ä¼šæç¤ºä½¿ç”¨<code>dart run build_runner watch -d</code>ã€‚</p><h4 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h4><p>æˆ‘ä»¬æ¥çœ‹ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œä» Provider å¼€å§‹<br>æ²¡æœ‰ä½¿ç”¨æ³¨è§£ç”Ÿæˆå™¨ä¹‹å‰ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// dio_provider.dart</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:dio/dio.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_riverpod/flutter_riverpod.dart&#x27;</span>;<br><span class="hljs-comment">// a provider for the Dio client to be used by the rest of the app</span><br><span class="hljs-keyword">final</span> dioProvider = Provider&lt;Dio&gt;((ref) &#123;<br>  <span class="hljs-keyword">return</span> Dio();<br>&#125;);<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ³¨è§£ç”Ÿæˆå™¨ä¹‹å</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:dio/dio.dart&#x27;</span>;<br><span class="hljs-comment">// 1. import the riverpod_annotation package</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:riverpod_annotation/riverpod_annotation.dart&#x27;</span>;<br><span class="hljs-comment">// 2. add a part file</span><br><span class="hljs-keyword">part</span> <span class="hljs-string">&#x27;dio_provider.g.dart&#x27;</span>;<br><br><br><span class="hljs-comment">//éœ€è¦æ‰§è¡Œ flutter pub run build_runner watch -d æ¥ç”Ÿæˆå¯¹åº”ä»£ç </span><br><span class="hljs-meta">@riverpod</span><br>Dio dio(DioRef ref)&#123;<br>  <span class="hljs-keyword">return</span> Dio();<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¼šç”Ÿæˆ<code>dio_provider.g.dart</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// GENERATED CODE - DO NOT MODIFY BY HAND</span><br><br><span class="hljs-keyword">part</span> of <span class="hljs-string">&#x27;dio_provider.dart&#x27;</span>;<br><br><span class="hljs-comment">// **************************************************************************</span><br><span class="hljs-comment">// RiverpodGenerator</span><br><span class="hljs-comment">// **************************************************************************</span><br><br><span class="hljs-built_in">String</span> _$dioHash() =&gt; <span class="hljs-string">r&#x27;58eeefbd0832498ca2574c1fe69ed783c58d1d8f&#x27;</span>;<br><br><span class="hljs-comment">/// <span class="language-markdown">See also [dio].</span></span><br><span class="hljs-meta">@ProviderFor</span>(dio)<br><span class="hljs-keyword">final</span> dioProvider = AutoDisposeProvider&lt;Dio&gt;.internal(<br>  dio,<br>  name: <span class="hljs-string">r&#x27;dioProvider&#x27;</span>,<br>  debugGetCreateSourceHash:<br>      <span class="hljs-keyword">const</span> <span class="hljs-built_in">bool</span>.fromEnvironment(<span class="hljs-string">&#x27;dart.vm.product&#x27;</span>) ? <span class="hljs-keyword">null</span> : _$dioHash,<br>  dependencies: <span class="hljs-keyword">null</span>,<br>  allTransitiveDependencies: <span class="hljs-keyword">null</span>,<br>);<br><br><span class="hljs-keyword">typedef</span> DioRef = AutoDisposeProviderRef&lt;Dio&gt;;<br><span class="hljs-comment">// ignore_for_file: type=lint</span><br><span class="hljs-comment">// ignore_for_file: subtype_of_sealed_class, invalid_use_of_internal_member, invalid_use_of_visible_for_testing_member</span><br><br></code></pre></td></tr></table></figure><h4 id="autoDisposeå’Œ-keepAlive"><a href="#autoDisposeå’Œ-keepAlive" class="headerlink" title="autoDisposeå’Œ keepAlive"></a>autoDisposeå’Œ keepAlive</h4><p>åœ¨ä½¿ç”¨æ³¨è§£ç”Ÿæˆä»£ç æ—¶ï¼ŒautoDispose ç°åœ¨é»˜è®¤å¯ç”¨ï¼Œå¹¶å·²é‡å‘½åä¸º keepAliveã€‚å¦‚æœä¸æƒ³é”€æ¯ providerï¼Œå¯ä»¥å°†keepAliveè®¾ç½®ä¸º true</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@Riverpod</span>(keepAlive: <span class="hljs-keyword">true</span>)<br><span class="hljs-built_in">int</span> counter(CounterRef ref)&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆçš„ä»£ç æ˜¯è¿™æ ·çš„</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-built_in">String</span> _$counterHash() =&gt; <span class="hljs-string">r&#x27;6b26baf29ab7c65258c6367ad62133458d88a2b3&#x27;</span>;<br><br><span class="hljs-comment">/// <span class="language-markdown">See also [counter].</span></span><br><span class="hljs-meta">@ProviderFor</span>(counter)<br><span class="hljs-keyword">final</span> counterProvider = Provider&lt;<span class="hljs-built_in">int</span>&gt;.internal(<br>  counter,<br>  name: <span class="hljs-string">r&#x27;counterProvider&#x27;</span>,<br>  debugGetCreateSourceHash:<br>      <span class="hljs-keyword">const</span> <span class="hljs-built_in">bool</span>.fromEnvironment(<span class="hljs-string">&#x27;dart.vm.product&#x27;</span>) ? <span class="hljs-keyword">null</span> : _$counterHash,<br>  dependencies: <span class="hljs-keyword">null</span>,<br>  allTransitiveDependencies: <span class="hljs-keyword">null</span>,<br>);<br><br><span class="hljs-keyword">typedef</span> CounterRef = ProviderRef&lt;<span class="hljs-built_in">int</span>&gt;;<br><span class="hljs-comment">// ignore_for_file: type=lint</span><br><span class="hljs-comment">// ignore_for_file: subtype_of_sealed_class, invalid_use_of_internal_member, invalid_use_of_visible_for_testing_member</span><br><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“ keepAlive æ˜¯é»˜è®¤å€¼(true)æ—¶ï¼Œä½¿ç”¨çš„æ˜¯<code>AutoDisposeProvider</code>,ä¸º false æ—¶ï¼Œä½¿ç”¨çš„æ˜¯<code>Provider</code></p><h4 id="FutureProvider-å’Œ-StreamProvider"><a href="#FutureProvider-å’Œ-StreamProvider" class="headerlink" title="FutureProvider å’Œ StreamProvider"></a>FutureProvider å’Œ StreamProvider</h4><p>å‡ ä¹æ˜¯ä¸€æ ·çš„å†™æ³•</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@riverpod</span><br>Future&lt;<span class="hljs-built_in">String</span>&gt; generateName(GenerateNameRef ref) <span class="hljs-keyword">async</span> &#123;<br>    <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">5</span>));<br>    <span class="hljs-keyword">final</span> wordPair = generateWordPairs().first;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;wordPair.first&#125;</span>  <span class="hljs-subst">$&#123;wordPair.second&#125;</span>&quot;</span>;<br>&#125;<br><br><span class="hljs-meta">@riverpod</span><br>Stream&lt;<span class="hljs-built_in">int</span>&gt; timeCount(TimeCountRef ref)&#123;<br>  <span class="hljs-keyword">return</span> Stream.periodic(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">1</span>),(number)&#123;<br>    <span class="hljs-keyword">return</span> number +<span class="hljs-number">1</span>;<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="NotifierProvider"><a href="#NotifierProvider" class="headerlink" title="NotifierProvider"></a>NotifierProvider</h4><p>æˆ‘ä»¬æŠŠä¸Šä¸€ç¯‡ä¸­<code>NotifierProvider</code>ä¾‹å­ç®€åŒ–ä¸€ä¸‹ï¼Œè¿˜æ˜¯é‚£ä¸ªä¸‡èƒ½çš„è®¡æ•°å™¨</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//å£°æ˜ä¸€ä¸ªNotifierå¯¹è±¡</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Counter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Notifier</span>&lt;<span class="hljs-title">int</span>&gt;</span>&#123;<br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-built_in">int</span> build() &#123;<br>   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br><br> <span class="hljs-comment">//å¯¹ state è¿›è¡Œæ“ä½œï¼Œä¹Ÿå¯ä»¥åœ¨å¤–éƒ¨ç›´æ¥æ“ä½œ</span><br>  <span class="hljs-keyword">void</span> increment()&#123;<br>    state ++;<br>  &#125;<br><br>&#125;<br><span class="hljs-comment">//ä¸¤ç§ provider çš„å£°æ˜æ–¹å¼</span><br><span class="hljs-keyword">final</span> counterProvider = NotifierProvider&lt;Counter, <span class="hljs-built_in">int</span>&gt;(() &#123;<br>  <span class="hljs-keyword">return</span> Counter();<br>&#125;);<br><span class="hljs-comment">// final counterProvider = NotifierProvider&lt;Counter, int&gt;(Counter.new);</span><br></code></pre></td></tr></table></figure><p>åœ¨ widget ä¸­ä½¿ç”¨</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RiverpodGeneratorWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span></span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-keyword">final</span> count = ref.watch(counterProvider);<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(title: Text(<span class="hljs-string">&quot;RiverpodGeneratorWidget&quot;</span>),centerTitle: <span class="hljs-keyword">true</span>,),<br>      body: Column(children: [<br>        Text(<span class="hljs-string">&quot;count <span class="hljs-subst">$count</span>&quot;</span>)<br>      ],),<br>      floatingActionButton: FloatingActionButton(onPressed: ()&#123;<br>        <span class="hljs-comment">//è°ƒç”¨ notifier ä¸­å®šä¹‰çš„æ–¹æ³•</span><br>        ref.read(counterProvider.notifier).increment();<br>        <span class="hljs-comment">//ç›´æ¥è·å–åˆ° state è¿›è¡Œæ“ä½œ</span><br>        ref.read(counterProvider.notifier).state++;<br>      &#125;,child: Icon(Icons.add),<br>      ),<br>    );<br>  &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬å¦‚æ˜¯ç”¨æ³¨è§£ä»£ç ç”Ÿæˆï¼Ÿ</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//counter.dart</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:riverpod_annotation/riverpod_annotation.dart&#x27;</span>;<br><span class="hljs-keyword">part</span> <span class="hljs-string">&#x27;counter.g.dart&#x27;</span>;<br><span class="hljs-meta">@riverpod</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Counter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">_</span>$<span class="hljs-title">Counter</span></span>&#123;<br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-built_in">int</span> build() &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">void</span> increment()&#123;<br>    state ++;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦ç»§æ‰¿<code>_$Counter</code>è€Œä¸æ˜¯<code>Notifier</code>ã€‚<br>å› ä¸º <code>Counter</code>ä¸­çš„ <code>build</code> æ–¹æ³•è¿”å›å€¼æ˜¯<code>int</code>ç±»å‹ï¼Œç”Ÿæˆçš„ä»£ç ä¸­ä¹Ÿå°±ä½¿ç”¨äº† <code>int</code>ç±»å‹ã€‚ç®€å•æ¥è®²å°±æ˜¯<code>build</code>æ–¹æ³•çš„è¿”å›å€¼ç±»å‹å†³å®šäº† <code>state</code> çš„ç±»å‹.</p><p>è¿˜æ˜¯éœ€è¦è¿è¡Œ <code>flutter pub run build_runner watch</code> æˆ–è€… <code>dart run build_runner watch</code>,è¿™æ—¶ä¼šç”Ÿæˆ<code>counter.g.dart</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// GENERATED CODE - DO NOT MODIFY BY HAND</span><br><br><span class="hljs-keyword">part</span> of <span class="hljs-string">&#x27;counter.dart&#x27;</span>;<br><br><span class="hljs-comment">// **************************************************************************</span><br><span class="hljs-comment">// RiverpodGenerator</span><br><span class="hljs-comment">// **************************************************************************</span><br><br><span class="hljs-built_in">String</span> _$counterHash() =&gt; <span class="hljs-string">r&#x27;7015b4a05f8ed24a914f6b3aad12be335d0c73d7&#x27;</span>;<br><br><span class="hljs-comment">/// <span class="language-markdown">See also [Counter].</span></span><br><span class="hljs-meta">@ProviderFor</span>(Counter)<br><span class="hljs-keyword">final</span> counterProvider = AutoDisposeNotifierProvider&lt;Counter, <span class="hljs-built_in">int</span>&gt;.internal(<br>  Counter.<span class="hljs-keyword">new</span>,<br>  name: <span class="hljs-string">r&#x27;counterProvider&#x27;</span>,<br>  debugGetCreateSourceHash:<br>      <span class="hljs-keyword">const</span> <span class="hljs-built_in">bool</span>.fromEnvironment(<span class="hljs-string">&#x27;dart.vm.product&#x27;</span>) ? <span class="hljs-keyword">null</span> : _$counterHash,<br>  dependencies: <span class="hljs-keyword">null</span>,<br>  allTransitiveDependencies: <span class="hljs-keyword">null</span>,<br>);<br><br><span class="hljs-keyword">typedef</span> _$Counter = AutoDisposeNotifier&lt;<span class="hljs-built_in">int</span>&gt;;<br><span class="hljs-comment">// ignore_for_file: type=lint</span><br><span class="hljs-comment">// ignore_for_file: subtype_of_sealed_class, invalid_use_of_internal_member, invalid_use_of_visible_for_testing_member</span><br><br></code></pre></td></tr></table></figure><h4 id="AsyncNotifierProvider"><a href="#AsyncNotifierProvider" class="headerlink" title="AsyncNotifierProvider"></a>AsyncNotifierProvider</h4><p>ä¹Ÿæ˜¯åŒæ ·çš„</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@riverpod</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AsyncCounters</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">_</span>$<span class="hljs-title">AsyncCounters</span></span>&#123;<br>  <span class="hljs-meta">@override</span><br>  FutureOr&lt;<span class="hljs-built_in">int</span>&gt; build()&#123;<br>    <span class="hljs-keyword">return</span> Future.delayed(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">3</span>),()&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆçš„ä»£ç å¦‚ä¸‹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// GENERATED CODE - DO NOT MODIFY BY HAND</span><br><br><span class="hljs-keyword">part</span> of <span class="hljs-string">&#x27;async_counter.dart&#x27;</span>;<br><br><span class="hljs-comment">// **************************************************************************</span><br><span class="hljs-comment">// RiverpodGenerator</span><br><span class="hljs-comment">// **************************************************************************</span><br><br><span class="hljs-built_in">String</span> _$asyncCountersHash() =&gt; <span class="hljs-string">r&#x27;787b7c6513c7794fa310550d32594b97238e7e3c&#x27;</span>;<br><br><span class="hljs-comment">/// <span class="language-markdown">See also [AsyncCounters].</span></span><br><span class="hljs-meta">@ProviderFor</span>(AsyncCounters)<br><span class="hljs-keyword">final</span> asyncCountersProvider =<br>    AutoDisposeAsyncNotifierProvider&lt;AsyncCounters, <span class="hljs-built_in">int</span>&gt;.internal(<br>  AsyncCounters.<span class="hljs-keyword">new</span>,<br>  name: <span class="hljs-string">r&#x27;asyncCountersProvider&#x27;</span>,<br>  debugGetCreateSourceHash: <span class="hljs-keyword">const</span> <span class="hljs-built_in">bool</span>.fromEnvironment(<span class="hljs-string">&#x27;dart.vm.product&#x27;</span>)<br>      ? <span class="hljs-keyword">null</span><br>      : _$asyncCountersHash,<br>  dependencies: <span class="hljs-keyword">null</span>,<br>  allTransitiveDependencies: <span class="hljs-keyword">null</span>,<br>);<br><br><span class="hljs-keyword">typedef</span> _$AsyncCounters = AutoDisposeAsyncNotifier&lt;<span class="hljs-built_in">int</span>&gt;;<br><span class="hljs-comment">// ignore_for_file: type=lint</span><br><span class="hljs-comment">// ignore_for_file: subtype_of_sealed_class, invalid_use_of_internal_member, invalid_use_of_visible_for_testing_member</span><br><br></code></pre></td></tr></table></figure><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><h4 id="Notifier-å’Œ-AsyncNotifierï¼šæ˜¯å¦å€¼å¾—ä½¿ç”¨ï¼Ÿ"><a href="#Notifier-å’Œ-AsyncNotifierï¼šæ˜¯å¦å€¼å¾—ä½¿ç”¨ï¼Ÿ" class="headerlink" title="Notifier å’Œ AsyncNotifierï¼šæ˜¯å¦å€¼å¾—ä½¿ç”¨ï¼Ÿ"></a>Notifier å’Œ AsyncNotifierï¼šæ˜¯å¦å€¼å¾—ä½¿ç”¨ï¼Ÿ</h4><p>é•¿æ—¶é—´ä»¥æ¥ï¼ŒStateNotifier ä¸€ç›´åœ¨ä¸ºæˆ‘ä»¬æä¾›æœåŠ¡ï¼Œæä¾›äº†ä¸€ä¸ªå­˜å‚¨å¤æ‚çŠ¶æ€å’Œä¿®æ”¹çŠ¶æ€é€»è¾‘çš„åœ°æ–¹ï¼Œä½¿å…¶ä¸å†ä¾èµ–äºå°éƒ¨ä»¶æ ‘ã€‚</p><p>Notifier å’Œ AsyncNotifier æ—¨åœ¨å–ä»£ StateNotifier å¹¶å¸¦æ¥ä¸€äº›æ–°çš„å¥½å¤„ï¼š</p><p>æ›´å®¹æ˜“æ‰§è¡Œå¤æ‚çš„å¼‚æ­¥åˆå§‹åŒ–<br>æ›´ç¬¦åˆäººä½“å·¥ç¨‹å­¦çš„ APIï¼šä¸å†éœ€è¦ä¼ é€’ ref<br>ä¸å†éœ€è¦æ‰‹åŠ¨å£°æ˜æä¾›è€…ï¼ˆå¦‚æœä½¿ç”¨ Riverpod Generatorï¼‰<br>å¯¹äºæ–°é¡¹ç›®æ¥è¯´ï¼Œè¿™äº›å¥½å¤„æ˜¯å€¼å¾—çš„ï¼Œå› ä¸ºæ–°çš„ç±»å¯ä»¥å¸®åŠ©æ‚¨ç”¨æ›´å°‘çš„ä»£ç å®ç°æ›´å¤šçš„åŠŸèƒ½ã€‚</p><p>ä½†å¦‚æœæ‚¨æœ‰å¾ˆå¤šç°æœ‰ä»£ç ä½¿ç”¨ StateNotifierï¼Œåˆ™ç”±æ‚¨å†³å®šæ˜¯å¦ï¼ˆæˆ–ä½•æ—¶ï¼‰è¿ç§»åˆ°æ–°çš„è¯­æ³•ã€‚</p><p>æ— è®ºå¦‚ä½•ï¼ŒStateNotifier è¿˜ä¼šå­˜åœ¨ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœæ‚¨æ„¿æ„ï¼Œå¯ä»¥é€ä¸ªè¿ç§»æ‚¨çš„æä¾›è€…ã€‚</p><h4 id="ä½¿ç”¨-generator-è¿˜æ˜¯æ‰‹åŠ¨ç¼–å†™-provider"><a href="#ä½¿ç”¨-generator-è¿˜æ˜¯æ‰‹åŠ¨ç¼–å†™-provider" class="headerlink" title="ä½¿ç”¨ generator è¿˜æ˜¯æ‰‹åŠ¨ç¼–å†™ provider"></a>ä½¿ç”¨ generator è¿˜æ˜¯æ‰‹åŠ¨ç¼–å†™ provider</h4><p>ä½¿ç”¨ generator éœ€è¦æˆ‘ä»¬æ‰§è¡Œé¢å¤–çš„ä»£ç æ¥ç”Ÿæˆå¯¹åº”çš„ä»£ç æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨ç¼–å†™ç”Ÿæˆä»£ç æ—¶ä½“éªŒä¸æ˜¯é‚£ä¹ˆçš„å‹å¥½ã€‚ä½†å¦å¤–ä¸€æ–¹é¢ï¼Œèƒ½çœå»æˆ‘ä»¬ç¼–å†™æ¨¡æ¿çš„ä»£ç çš„æ—¶é—´ã€‚å¦‚ä½•ä½¿ç”¨ï¼Œçœ‹ä¸ªäººå–œå¥½ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Flutter</tag>
      
      <tag>riverpod</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>riverpod2.xä¸­çš„ Provider ç®€ä»‹</title>
    <link href="/2024/03/27/riverpod2-x%E4%B8%AD%E7%9A%84-Provider-%E7%AE%80%E4%BB%8B/"/>
    <url>/2024/03/27/riverpod2-x%E4%B8%AD%E7%9A%84-Provider-%E7%AE%80%E4%BB%8B/</url>
    
    <content type="html"><![CDATA[<p>åŸæ–‡æ¥è‡ªï¼š<a href="https://codewithandrea.com/articles/flutter-state-management-riverpod/">https://codewithandrea.com/articles/flutter-state-management-riverpod/</a></p><h3 id="æ˜¯ä»€ä¹ˆ"><a href="#æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h3><p>Riverpodæ˜¯ä¸€ä¸ªå“åº”å¼ç¼“å­˜å’Œæ•°æ®ç»‘å®šæ¡†æ¶ï¼Œç”±Providerè½¯ä»¶åŒ…æ¼”åŒ–è€Œæ¥ã€‚æ ¹æ®å®˜æ–¹æ–‡æ¡£çš„è¯´æ³•ï¼Œriverpod æ˜¯æŠŠ provider é‡å†™äº†ï¼Œå®ç°äº†åŸæ¥æ— æ³•å®ç°çš„åŠŸèƒ½ã€‚</p><h3 id="ä¸ºä»€ä¹ˆä½¿ç”¨-riverpod"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨-riverpod" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨ riverpod"></a>ä¸ºä»€ä¹ˆä½¿ç”¨ riverpod</h3><p>ä»è®¾è®¡ä¸Šæ¥è¯´ï¼ŒProvideræ˜¯å¯¹<code>InheritedWidget</code>çš„æ”¹è¿›ï¼Œå› æ­¤å®ƒä¾èµ–äºå°éƒ¨ä»¶æ ‘ã€‚<br>è¿™æ˜¯ä¸€ä¸ªä¸å¹¸çš„è®¾è®¡å†³ç­–ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¸¸è§çš„<code>ProviderNotFoundException</code>ï¼š<br><img src="/image/riverpod/provider_demo.png" alt="provider_demo"><br>å¦ä¸€æ–¹é¢ï¼ŒRiverpodæ˜¯ç¼–è¯‘æ—¶å®‰å…¨çš„ï¼Œå› ä¸ºæ‰€æœ‰çš„ provider éƒ½è¢«å£°æ˜ä¸ºå…¨å±€çš„ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è®¿é—®ï¼Œè¿™ä¹Ÿæ„å‘³ç€è¿™äº› provider å¯ä»¥ä¸ä¾èµ–äºwidget tree æ¥å­˜å‚¨åº”ç”¨çŠ¶æ€å’Œä¸šåŠ¡é€»è¾‘ã€‚ç”±äº Riverpod æ˜¯ä¸€ä¸ªååº”å¼æ¡†æ¶ï¼Œå› æ­¤åªéœ€åœ¨éœ€è¦æ—¶é‡å»ºproviderså’Œwidgetså³å¯ã€‚</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>3.0 å·²ç»æœ‰ preview ç‰ˆæœ¬äº†ï¼Œä½†è¿˜æ²¡æœ‰å‡ºæ­£å¼ç‰ˆï¼Œè¿™é‡Œä½¿ç”¨ç¨å¾®æ—§ä¸€ç‚¹çš„ç‰ˆæœ¬</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-attr">flutter_riverpod:</span> <span class="hljs-string">^2.4.10</span><br></code></pre></td></tr></table></figure><p>ä¸ºäº†ç®€å•èµ·è§ï¼Œè¿™é‡Œæ²¡æœ‰ä½¿ç”¨<code>hooks_riverpod</code>,è‡³äºä½¿ç”¨æ³¨è§£æ¥ç”Ÿæˆ provierï¼Œä¼šåœ¨åç»­ä»‹ç»ã€‚</p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦æ”¹é€ ä¸€ä¸‹ç¨‹åºå…¥å£ï¼Œæä¾›ä¸€ä¸ª<code>ProviderScope</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(<br>    ProviderScope(<br>      child: MyApp(),<br>    ),<br>  );<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€å£°æ˜ä¸€ä¸ªå…¨å±€çš„<code>Provider</code>ï¼Œå’Œè¿™ä¸ª main æ–¹æ³•å¹³çº§å°±å¯ä»¥</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> authorNameProvider = Provider&lt;<span class="hljs-built_in">String</span>&gt;(<br>  (ref) =&gt; <span class="hljs-string">&quot;xuan&quot;</span>,<br>);<br></code></pre></td></tr></table></figure><p>ç„¶åæ”¹é€ ä¸€ä¸‹<code>MyApp</code>,è®©å®ƒå¯ä»¥è¯»å–åˆ°æ•°æ®ã€‚æ”¹é€ å‰æ˜¯ç»§æ‰¿<code>StatelessWidget</code>,è¿™é‡Œéœ€è¦æ”¹æˆç»§æ‰¿è‡ª<code>ConsumerWidget</code>.</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> value = ref.watch(helloWorldProvider);<br><br>    <span class="hljs-keyword">return</span> MaterialApp(<br>      home: Scaffold(<br>        appBar: AppBar(title:  Text(<span class="hljs-string">&#x27;ProviderWidget&#x27;</span>)),<br>        body: Center(<br>          child: Text(value),<br>        ),<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œç»§æ‰¿<code>ConsumerWidget</code>ä¹‹åï¼Œ<code>build</code>æ–¹æ³•çš„ç­¾åå˜äº†ï¼Œå¤šäº†ä¸€ä¸ª<code>WidgetRef</code>å¯¹è±¡ï¼Œæˆ‘ä»¬å°±æ˜¯ä½¿ç”¨è¿™ä¸ªå¯¹è±¡æ¥è¯»å–ã€è§‚å¯Ÿã€ç›‘å¬å„ç§ providerã€‚</p><p>é™¤äº†ç»§æ‰¿<code>ConsumerWidget</code>ä¹‹å¤–ï¼Œè¿˜æœ‰å…¶ä»–æ–¹æ¡ˆå¯ä¾›ä½¿ç”¨</p><h4 id="ä½¿ç”¨-Consumer"><a href="#ä½¿ç”¨-Consumer" class="headerlink" title="ä½¿ç”¨ Consumer"></a>ä½¿ç”¨ Consumer</h4><p>åœ¨æ—§ä»£ç ä¸­æ–°å¢ä½¿ç”¨ riverpodï¼Œä½†åˆä¸æ‰“ç®—å¤§é¢ç§¯é‡æ„æ—¶ï¼Œå¯ä»¥è€ƒè™‘è¿™ç§æ–¹æ¡ˆ:ä½¿ç”¨<code>Consumer</code>åŒ…è£¹éœ€è¦æ›´æ–°çš„æ§ä»¶ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_riverpod/flutter_riverpod.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_widget/third_part/riverpod/riverpod_widget.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:widget_with_codeview/widget_with_codeview.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProviderWithConsumer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;ProviderWithConsumer&quot;</span>),<br>        centerTitle: <span class="hljs-keyword">true</span>,<br>      ),<br>      body: WidgetWithCodeView(<br>        child: Column(children: [<br>          Text(<br>            <span class="hljs-string">&quot;æœ‰ä¸€ä¸ªåŒ…å«å¤æ‚å¸ƒå±€çš„å¤§å‹å°éƒ¨ä»¶ç±»ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Consumer æ¥ä»…é‡æ–°æ„å»ºä¾èµ–äºæä¾›è€…çš„å°éƒ¨ä»¶\nåˆ›å»ºå°è€Œå¯é‡ç”¨çš„å°éƒ¨ä»¶æœ‰åˆ©äºç»„åˆï¼Œä½¿ä»£ç æ›´åŠ ç®€æ´ã€æ€§èƒ½æ›´é«˜ï¼Œæ›´æ˜“äºç†è§£ã€‚\nå¦‚æœæ‚¨éµå¾ªè¿™ä¸€åŸåˆ™å¹¶åˆ›å»ºå°è€Œå¯é‡ç”¨çš„å°éƒ¨ä»¶ï¼Œé‚£ä¹ˆå¤§éƒ¨åˆ†æ—¶é—´æ‚¨å°†è‡ªç„¶è€Œç„¶åœ°ä½¿ç”¨ ConsumerWidgetã€‚&quot;</span>,<br>            style: TextStyle(color: Colors.blue, fontSize: <span class="hljs-number">16</span>),<br>          ),<br>          Consumer(builder: (_, ref, __) &#123;<br>            <span class="hljs-keyword">return</span> Text(ref.read(helloWorldProvider));<br>          &#125;)<br>        ]),<br>        filePath: <span class="hljs-string">&quot;lib/third_part/riverpod/provider_with_consumer.dart&quot;</span>,<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸­çš„<code>WidgetWithCodeView</code>æ˜¯ä¸‰æ–¹åº“<code>widget_with_codeview</code>ç”¨æ¥å±•ç¤ºä»£ç çš„æ§ä»¶ã€‚å»é™¤åæ²¡æœ‰å½±å“ã€‚</p><h4 id="ä½¿ç”¨ConsumerStatefulWidget"><a href="#ä½¿ç”¨ConsumerStatefulWidget" class="headerlink" title="ä½¿ç”¨ConsumerStatefulWidget"></a>ä½¿ç”¨ConsumerStatefulWidget</h4><p>ç›¸å¯¹äº<code>ConsumerWidget</code>æ¥ä»£æ›¿<code>StatelessWidget</code>,<code>ä½¿ç”¨ConsumerStatefulWidget</code>æ˜¯ç”¨æ¥ä»£æ›¿<code>StatefulWidget</code>.</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_riverpod/flutter_riverpod.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_widget/third_part/riverpod/riverpod_widget.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:widget_with_codeview/widget_with_codeview.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProviderWithConsumerStatefulWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerStatefulWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  ConsumerState&lt;ProviderWithConsumerStatefulWidget&gt; createState() &#123;<br>    <span class="hljs-keyword">return</span> ProviderWithConsumerStatefulWidgetState();<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProviderWithConsumerStatefulWidgetState</span></span><br><span class="hljs-class">    <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerState</span>&lt;<span class="hljs-title">ProviderWithConsumerStatefulWidget</span>&gt; </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> initState() &#123;<br>    <span class="hljs-keyword">super</span>.initState();<br>    <span class="hljs-comment">// 3. if needed, we can read the provider inside initState</span><br>    <span class="hljs-keyword">final</span> helloWorld = ref.read(helloWorldProvider);<br>    <span class="hljs-built_in">print</span>(helloWorld); <span class="hljs-comment">// &quot;Hello world&quot;</span><br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-comment">// 4. use ref.watch() to get the value of the provider</span><br>    <span class="hljs-keyword">final</span> helloWorld = ref.watch(helloWorldProvider);<br><br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;ProviderWithConsumerStatefulWidget&quot;</span>),<br>        centerTitle: <span class="hljs-keyword">true</span>,<br>      ),<br>      body: WidgetWithCodeView(<br>        child: Column(<br>          children: [<br>            Text(<br>              <span class="hljs-string">&quot;ConsumerStatefulWidgetå¯ä»¥ç”¨æ¥ä»£æ›¿StatefulWidget\nå½“æˆ‘ä»¬ä»ConsumerStateè¿›è¡Œå­ç±»åŒ–æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ‰€æœ‰å°éƒ¨ä»¶ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­è®¿é—®refå¯¹è±¡ã€‚è¿™æ˜¯å› ä¸ºConsumerStateå£°æ˜WidgetRefä½œä¸ºå±æ€§ï¼Œç±»ä¼¼äºFlutterçš„Stateç±»å£°æ˜BuildContextä½œä¸ºå¯ä»¥åœ¨æ‰€æœ‰å°éƒ¨ä»¶ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­ç›´æ¥è®¿é—®çš„å±æ€§ã€‚&quot;</span>,<br>              style: TextStyle(color: Colors.blue, fontSize: <span class="hljs-number">16</span>),<br>            ),<br>            Text(helloWorld),<br>          ],<br>        ),<br>        filePath:<br>            <span class="hljs-string">&quot;lib/third_part/riverpod/provider_with_consumerStatefulWidget.dart&quot;</span>,<br>      ),<br>    );<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>åŒæ ·çš„éœ€è¦ä½¿ç”¨<code>ConsumerState</code>ä»£æ›¿åŸæ¥çš„<code>State</code>.éœ€è¦æ³¨æ„çš„æ˜¯,åœ¨è¿™é‡Œé¢æˆ‘ä»¬å¹¶æ²¡æœ‰çœ‹åˆ°<code>WidgetRef</code>,ä½†æˆ‘ä»¬ä¾æ—§å¯ä»¥åœ¨æ•´ä¸ªé¡µé¢å£°æ˜å‘¨æœŸå†…è®¿é—®<code>WidgetRef</code>å¯¹è±¡çš„å®ä¾‹<code>ref</code>,è¿™æ˜¯å› ä¸º<code>ConsumerState</code>å°†<code>WidgetRef</code>å£°æ˜ä¸ºå±æ€§ã€‚</p><h3 id="WidgetRefæ˜¯ä»€ä¹ˆ"><a href="#WidgetRefæ˜¯ä»€ä¹ˆ" class="headerlink" title="WidgetRefæ˜¯ä»€ä¹ˆ"></a>WidgetRefæ˜¯ä»€ä¹ˆ</h3><p>å®˜æ–¹æ–‡æ¡£å®šä¹‰<code>WidgetRef</code>ä¸ºå…è®¸Widgetså’ŒProvideräº¤äº’çš„å¯¹è±¡ã€‚å¯ä»¥ç”¨æ¥è§‚å¯Ÿ(watch)Provider å€¼çš„æ”¹å˜ï¼Œä¹Ÿå¯ä»¥ä½œä¸º<code>Consumer</code>å’Œ<code>ConsumerWidget</code>çš„å‚æ•°ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥ä½œä¸º<code>ConsumerState</code>çš„å±æ€§ã€‚<br>å°†<code>WidgetRef</code>å’Œ<code>BuildContext</code>åšä¸€ä¸‹æ¯”è¾ƒï¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>BuildContext</code>åœ¨ Widget tree ä¸­è®¿é—®ç¥–å…ˆèŠ‚ç‚¹ï¼Œæ¯”å¦‚<code>Theme.of(context)</code> å’Œ <code>MediaQuery.of(context)</code><br>è€Œ<code>WidgetRef</code>å¯ä»¥è®©æˆ‘ä»¬åœ¨ app ä¸­è®¿é—®ä»»æ„providerï¼Œå‰ææ˜¯providerè¢«å£°æ˜ä¸ºå…¨å±€çš„ã€‚è¿™ä¹Ÿæ˜¯è®¾è®¡çš„åˆè¡·ã€‚<br>å½“ç„¶ï¼Œå°† provider å£°æ˜åœ¨ç±»å†…éƒ¨ï¼Œåªå…è®¸è¯¥ç±»è®¿é—®åœ¨ç¼–è¯‘ã€è¿è¡Œæ—¶ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œä½†è¿™ä¼šå½±å“å…³æ³¨ç‚¹åˆ†ç¦»çš„åŸåˆ™ã€‚</p><h3 id="å…«ä¸­ä¸åŒçš„-Provider"><a href="#å…«ä¸­ä¸åŒçš„-Provider" class="headerlink" title="å…«ä¸­ä¸åŒçš„ Provider"></a>å…«ä¸­ä¸åŒçš„ Provider</h3><ul><li>Provider</li><li><del>StateProvider</del> (è¢«NotifierProviderä»£æ›¿)</li><li><del>StateNotifierProvider</del> (è¢«NotifierProviderä»£æ›¿)</li><li>FutureProvider</li><li>StreamProvider</li><li><del>ChangeNotifierProvider</del> (è¢«NotifierProviderä»£æ›¿)</li><li>NotifierProvider (Riverpod 2.0æ–°å¢)</li><li>AsyncNotifierProvider (Riverpod 2.0æ–°å¢)</li></ul><p>ä»¥åä¼šæåˆ°ä½¿ç”¨<code>riverpod_generator</code>åŒ…ä¸­çš„<code>@riverpod</code>æ³¨è§£æ¥ä»£æ›¿æˆ‘ä»¬çš„æ‰‹åŠ¨å£°æ˜provider</p><h4 id="Provider"><a href="#Provider" class="headerlink" title="Provider"></a>Provider</h4><p>ä¸Šé¢ç¤ºä¾‹ä¸­çš„ä»£ç å°±æ˜¯ç”¨çš„è¿™ä¸€ä¸ªï¼Œæ›´é€‚åˆæä¾›ä¸€äº›ä¸ä¼šå˜çš„å¸¸é‡å€¼ï¼Œæ¯”å¦‚ Dio å®ä¾‹ã€ç‰ˆæœ¬å·ã€æ ¼å¼åŒ–å¯¹è±¡ã€æ•°æ®åº“å¯¹è±¡ç­‰</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> dateFormatterProvider = Provider&lt;DateFormat&gt;((ref) &#123;<br>  <span class="hljs-keyword">return</span> DateFormat.MMMEd();<br>&#125;);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-comment">// retrieve the formatter</span><br>    <span class="hljs-keyword">final</span> formatter = ref.watch(dateFormatterProvider);<br>    <span class="hljs-comment">// use it</span><br>    <span class="hljs-keyword">return</span> Text(formatter.format(<span class="hljs-built_in">DateTime</span>.now()));<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="StateProvider"><a href="#StateProvider" class="headerlink" title="StateProvider"></a>StateProvider</h4><p>å¯ä»¥ç”¨æ¥å­˜å‚¨ä¸€äº›ç®€å•çš„å˜é‡ï¼Œæ¯”å¦‚è®¡æ•°å™¨</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_riverpod/flutter_riverpod.dart&#x27;</span>;<br><br><span class="hljs-keyword">final</span> globalStateProvider = StateProvider((ref) =&gt; <span class="hljs-number">1</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StateProviderDemoWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>  <span class="hljs-comment">//ä¸æ¨è</span><br>  <span class="hljs-keyword">final</span> localStateProvider = StateProvider((ref) =&gt; <span class="hljs-number">1</span>);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;StateProviderDemoWidget&quot;</span>),<br>        centerTitle: <span class="hljs-keyword">true</span>,<br>      ),<br>      body: Center(<br>          child: Flex(<br>        direction: Axis.vertical,<br>        children: [<br>          Text(<span class="hljs-string">&quot;globalStateProvider count <span class="hljs-subst">$&#123;ref.watch(globalStateProvider)&#125;</span>&quot;</span>),<br>          Text(<span class="hljs-string">&quot;localStateProvider count <span class="hljs-subst">$&#123;ref.watch(localStateProvider)&#125;</span>&quot;</span>),<br>          Text(<br>            <span class="hljs-string">&quot;StateProvider.stateæ ‡è®°ä¸ºè¿‡æ—¶ï¼Œå¹¶å°†åœ¨3.0ç§»é™¤&quot;</span>,<br>            style: TextStyle(color: Colors.red, fontSize: <span class="hljs-number">14</span>),<br>          ),<br>          Text(<span class="hljs-string">&quot;å£°æ˜ä¸ºå…¨å±€ï¼Œåˆ™çŠ¶æ€ä¸€ç›´è¢«ä¿å­˜ï¼Œç›´åˆ°åº”ç”¨é‡å¯ã€‚&quot;</span>,<br>              style: TextStyle(color: Colors.blue, fontSize: <span class="hljs-number">14</span>)),<br>          Text(<span class="hljs-string">&quot;å£°æ˜ä¸ºç±»æˆå‘˜ï¼Œåˆ™é¡µé¢é‡å¯åˆ™é‡æ–°åˆå§‹åŒ–ã€‚&quot;</span>,<br>              style: TextStyle(color: Colors.blue, fontSize: <span class="hljs-number">14</span>)),<br>          Text(<span class="hljs-string">&quot;StateProvideré€‚ç”¨äºå­˜å‚¨ç®€å•çš„çŠ¶æ€å˜é‡ï¼Œå¦‚æšä¸¾ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼å’Œæ•°å­—&quot;</span>,<br>              style: TextStyle(color: Colors.blue, fontSize: <span class="hljs-number">14</span>)),<br>          IconButton(<br>            icon: Icon(Icons.plus_one_sharp),<br>            onPressed: () &#123;<br>              ref.read(globalStateProvider.notifier).state++;<br>              ref.read(localStateProvider.notifier).state++;<br>            &#125;,<br>          ),<br>        ],<br>      )),<br>    );<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€äº›æœ‰æ„æ€çš„äº‹æƒ…ã€‚æˆ‘ä»¬å£°æ˜äº†ä¸¤ä¸ª Providerï¼Œä¸€ä¸ªæ˜¯å…¨å±€çš„ï¼Œä¸€ä¸ªæ˜¯ç±»å†…éƒ¨çš„ã€‚<br>å½“æˆ‘ä»¬æ‰“å¼€é¡µé¢ç‚¹å‡»å‡ æ¬¡æŒ‰é’®ä¹‹åï¼Œé¡µé¢å†…å®¹æ›´æ–°ï¼Œè¿™æ—¶å€™æˆ‘ä»¬è¿”å›ä¸Šä¸€é¡µå†æ¬¡æ‰“å¼€è¿™ä¸ªé¡µé¢ï¼Œä¼šå‘ç°<code>globalStateProvider</code>æä¾›çš„å€¼è¿˜æ˜¯ä¸Šä¸€æ¬¡è¿”å›æ—¶å€™çš„å€¼ï¼Œè€Œ<code>localStateProvider</code>æä¾›çš„å€¼æ˜¯åˆå§‹å€¼ã€‚å› ä¸º<code>localStateProvider</code>åœ¨é¡µé¢å…³é—­æ—¶å°±è¢«é”€æ¯äº†ï¼Œè¿™ç§æƒ…å†µä¼¼ä¹æ›´ç¬¦åˆæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ riverpod çš„ä¹ æƒ¯ã€‚è¿™é‡Œå¯ä»¥ä½¿ç”¨ autoDispose è®©<code>globalStateProvider</code>åœ¨æ‰€æœ‰ watcher è¢«é”€æ¯ä¹Ÿå¯ä»¥é‡ç½®ã€‚</p><h4 id="StateNotifierProvider"><a href="#StateNotifierProvider" class="headerlink" title="StateNotifierProvider"></a>StateNotifierProvider</h4><p>å¯ä»¥ç”¨å®ƒæ¥ç›‘å¬å’Œå¯¼å‡ºä¸€ä¸ª <code>StateNotifier</code> ,<code>StateNotifierProvider</code> å’Œ <code>StateNotifier</code> éå¸¸é€‚åˆç®¡ç†å› äº‹ä»¶æˆ–ç”¨æˆ·äº¤äº’è€Œæ”¹å˜çš„çŠ¶æ€ã€‚è¿™é‡Œæœ‰ä¸€ä¸ª <code>todolist</code>ç¤ºä¾‹ã€‚<br>æˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ª todo çš„å¯¹è±¡,å®ç°ä¸€ä¸ª copyWith æ–¹æ³•æ¥å¤åˆ¶å½“å‰å¯¹è±¡ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@immutable</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Todo</span> </span>&#123;<br>  <span class="hljs-keyword">const</span> Todo(<br>      &#123;<span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.id, <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.description, <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.completed&#125;);<br><br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> id;<br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> description;<br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> completed;<br>  Todo copyWith(&#123;<span class="hljs-built_in">String?</span> id, <span class="hljs-built_in">String?</span> description, <span class="hljs-built_in">bool?</span> completed&#125;) &#123;<br>    <span class="hljs-keyword">return</span> Todo(<br>      id: id ?? <span class="hljs-keyword">this</span>.id,<br>      description: description ?? <span class="hljs-keyword">this</span>.description,<br>      completed: completed ?? <span class="hljs-keyword">this</span>.completed,<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬ç»§æ‰¿<code>StateNotifier</code>å®ç°è‡ªå·±çš„<code>TodosNotifier</code>ç±»ï¼Œå¹¶å®Œå–„æ‰€éœ€é€»è¾‘</p><ol><li>ç»Ÿè®¡å·²å®Œæˆçš„å¾…åŠ</li><li>æ·»åŠ å¾…åŠ</li><li>åˆ é™¤å¾…åŠ</li><li>å®Œæˆã€å–æ¶ˆå®Œæˆå¾…åŠ</li><li>å…¨é€‰ï¼Œåå…¨é€‰</li><li>æ˜¯å¦é€‰ä¸­å…¨éƒ¨</li></ol><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs dart"><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TodosNotifier</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StateNotifier</span>&lt;<span class="hljs-title">List</span>&lt;<span class="hljs-title">Todo</span>&gt;&gt; </span>&#123;<br>  TodosNotifier() : <span class="hljs-keyword">super</span>([]);<br><br>  <span class="hljs-keyword">void</span> addTodo(Todo todo) &#123;<br>    state = [...state, todo];<br>  &#125;<br><br>  <span class="hljs-built_in">int</span> completedCount() &#123;<br>    <span class="hljs-built_in">int</span> count = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> todo <span class="hljs-keyword">in</span> state) &#123;<br>      <span class="hljs-keyword">if</span> (todo.completed) &#123;<br>        count++;<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> count;<br>  &#125;<br><br>  <span class="hljs-keyword">void</span> removeTodo(<span class="hljs-built_in">String</span> todoId) &#123;<br>    state = [<br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> todo <span class="hljs-keyword">in</span> state)<br>        <span class="hljs-keyword">if</span> (todo.id != todoId) todo,<br>    ];<br>  &#125;<br><br>  <span class="hljs-keyword">void</span> toggle(<span class="hljs-built_in">String</span> todoID) &#123;<br>    state = [<br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> todo <span class="hljs-keyword">in</span> state)<br>        <span class="hljs-keyword">if</span> (todo.id == todoID)<br>          todo.copyWith(completed: !todo.completed)<br>        <span class="hljs-keyword">else</span><br>          todo<br>    ];<br>  &#125;<br><br>  <span class="hljs-keyword">void</span> selectAll() &#123;<br>    state = [<span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> todo <span class="hljs-keyword">in</span> state) todo.copyWith(completed: <span class="hljs-keyword">true</span>)];<br>  &#125;<br><br>  <span class="hljs-keyword">void</span> unSelectAll() &#123;<br>    state = [<span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> todo <span class="hljs-keyword">in</span> state) todo.copyWith(completed: <span class="hljs-keyword">false</span>)];<br>  &#125;<br><br>  <span class="hljs-built_in">bool</span> isSelectAll() &#123;<br>    <span class="hljs-built_in">bool</span> result = <span class="hljs-keyword">true</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> todo <span class="hljs-keyword">in</span> state) &#123;<br>      <span class="hljs-keyword">if</span> (!todo.completed) &#123;<br>        result = <span class="hljs-keyword">false</span>;<br>        <span class="hljs-keyword">break</span>;<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> result;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€å£°æ˜ä¸€ä¸ªå…¨å±€çš„<code>StateNotifierProvider</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> todoProvider =<br>    StateNotifierProvider&lt;TodosNotifier, <span class="hljs-built_in">List</span>&lt;Todo&gt;&gt;((ref) =&gt; TodosNotifier());<br></code></pre></td></tr></table></figure><p>æœ€åæˆ‘ä»¬å°±å¯ä»¥åœ¨é¡µé¢ä¸­ä½¿ç”¨äº†</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_riverpod/flutter_riverpod.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StateNotifierProviderWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-built_in">List</span>&lt;Todo&gt; todos = ref.watch(todoProvider);<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;State Notifier Provider Widget&quot;</span>),<br>        centerTitle: <span class="hljs-keyword">true</span>,<br>      ),<br>      body: Column(<br>        children: [<br>          Text(<span class="hljs-string">&quot;StateNotifierProviderå’ŒStateNotifieréå¸¸é€‚åˆç®¡ç†å¯èƒ½ä¼šå› äº‹ä»¶æˆ–ç”¨æˆ·äº¤äº’è€Œå‘ç”Ÿå˜åŒ–çš„çŠ¶æ€ã€‚&quot;</span>),<br>          Text(<span class="hljs-string">&quot;æ³¨æ„StateNotifierä¸­é€šçŸ¥æ›´æ–°æ—¶æ˜¯æ¯”è¾ƒçš„å¯¹è±¡å†…å­˜åœ°å€&quot;</span>),<br>          Divider(),<br>          Container(<br>            child: Text(<br>                <span class="hljs-string">&quot;å…±<span class="hljs-subst">$&#123;todos.length.toString()&#125;</span>,å®Œæˆ-ã€‹<span class="hljs-subst">$&#123;ref.read(todoProvider.notifier).completedCount()&#125;</span>&quot;</span>),<br>          ),<br>          CheckboxListTile(<br>            value: ref.read(todoProvider.notifier).isSelectAll(),<br>            onChanged: (value) &#123;<br>              <span class="hljs-keyword">if</span> (value ?? <span class="hljs-keyword">false</span>) &#123;<br>                ref.read(todoProvider.notifier).selectAll();<br>              &#125; <span class="hljs-keyword">else</span> &#123;<br>                ref.read(todoProvider.notifier).unSelectAll();<br>              &#125;<br>            &#125;,<br>            title: Text(<span class="hljs-string">&quot;å…¨é€‰&quot;</span>),<br>          ),<br>          Expanded(<br>              child: ListView(<br>            shrinkWrap: <span class="hljs-keyword">true</span>,<br>            children: [<br>              <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> todo <span class="hljs-keyword">in</span> todos)<br>                Dismissible(<br>                  key: Key(todo.id),<br>                  child: CheckboxListTile(<br>                    value: todo.completed,<br>                    onChanged: (value) =&gt;<br>                        ref.read(todoProvider.notifier).toggle(todo.id),<br>                    title: Text(todo.description),<br>                  ),<br>                  onDismissed: (direction) =&gt;<br>                      &#123;ref.read(todoProvider.notifier).removeTodo(todo.id)&#125;,<br>                ),<br>            ],<br>          )),<br>        ],<br>      ),<br>      floatingActionButton: FloatingActionButton(<br>        child: <span class="hljs-keyword">const</span> Icon(Icons.add),<br>        onPressed: () &#123;<br>          <span class="hljs-keyword">final</span> notifier = ref.read(todoProvider.notifier);<br>          notifier.addTodo(Todo(<br>              id: <span class="hljs-built_in">DateTime</span>.now().microsecond.toString(),<br>              description: <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;DateTime.now().microsecondsSinceEpoch&#125;</span>&quot;</span>,<br>              completed: <span class="hljs-keyword">false</span>));<br>        &#125;,<br>      ),<br>    );<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†ä¸€ä¸ªç®€æ˜“ç‰ˆçš„å¾…åŠé¡µé¢</p><p><img src="/image/riverpod/state_notifier_demo.png" alt="state_notifier_demo"></p><h4 id="FutureProvider"><a href="#FutureProvider" class="headerlink" title="FutureProvider"></a>FutureProvider</h4><p>æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸€äº›è€—æ—¶æ“ä½œï¼Œæ¯”å¦‚è¯·æ±‚æœåŠ¡å™¨æ¥å£è·å–åˆ°æ•°æ®åå±•ç¤ºåœ¨é¡µé¢ä¸Šï¼›æ¯”å¦‚è¯»å–é…ç½®æ–‡ä»¶ç­‰ã€‚è¿™ç§æƒ…å†µæˆ‘ä»¬å°±éœ€è¦ <code>FutureProvider</code>äº†ã€‚<br>è¿™é‡Œä»¥è¯»å– assets ä¸­çš„é…ç½®æ–‡ä»¶ä¸ºä¾‹:<br>é¦–å…ˆå£°æ˜ä¸€ä¸ª<code>FutureProvider</code>æ³›å‹ä¸­å¡«å…¥è¿”å›å€¼ï¼Œä½¿ç”¨<code>rootBundle.loadString</code>æ¥è¯»å–èµ„æºæ–‡ä»¶çš„å†…å®¹ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> getConfigFutureProvider =<br>    FutureProvider&lt;<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;&gt;((ref) <span class="hljs-keyword">async</span> &#123;<br>  <span class="hljs-built_in">String</span> configContant =<br>      <span class="hljs-keyword">await</span> rootBundle.loadString(<span class="hljs-string">&quot;assets/fake_configurations.json&quot;</span>);<br>  <span class="hljs-keyword">final</span> configMap = jsonDecode(configContant) <span class="hljs-keyword">as</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;;<br>  <span class="hljs-keyword">return</span> configMap;<br>&#125;);<br></code></pre></td></tr></table></figure><p>ç„¶åå†å£°æ˜ä¸€ä¸ªç”¨æ¥æ¨¡æ‹Ÿè¯·æ±‚æœåŠ¡ç«¯çš„<code>FutureProvider</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> wordPairProvider = FutureProvider&lt;<span class="hljs-built_in">String</span>&gt;((ref)  <span class="hljs-keyword">async</span>&#123;<br>  <span class="hljs-keyword">final</span> wordPair = generateWordPairs().first;<br>  <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">2</span>));<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;wordPair.first&#125;</span> - <span class="hljs-subst">$&#123;wordPair.second&#125;</span>&quot;</span>;<br>&#125;);<br></code></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œçš„<code>generateWordPairs</code>æ˜¯ä¸‰æ–¹åŒ…<code>english_words: ^4.0.0</code>æä¾›çš„ã€‚åœ¨<code>wordPairProvider</code>ä¸­æˆ‘ä»¬å»¶è¿Ÿ 2 ç§’è¿”å›äº†ç»“æœï¼Œç”¨ä»¥æ¨¡æ‹Ÿç½‘ç»œè€—æ—¶ã€‚<br>åœ¨é¡µé¢ä¸­æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆä½¿ç”¨:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs dart"><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FutureProviderWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-keyword">final</span> AsyncValue&lt;<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;&gt; getConfigResult =<br>        ref.watch(getConfigFutureProvider);<br>    <span class="hljs-keyword">final</span> AsyncValue&lt;<span class="hljs-built_in">String</span>&gt; wordPairResult = ref.watch(wordPairProvider);<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;FutureProvider&quot;</span>),<br>        centerTitle: <span class="hljs-keyword">true</span>,<br>      ),<br>      body: RefreshIndicator(<br>        onRefresh: () =&gt; ref.refresh(wordPairProvider.future),<br>        child: ListView(<br>          children: [<br>            getConfigResult.when(<br>                data: (data) &#123;<br>                  <span class="hljs-keyword">return</span> Text(data.toString());<br>                &#125;,<br>                error: (error, stack) &#123;<br>                  <span class="hljs-keyword">return</span> Text(error.toString());<br>                &#125;,<br>                loading: () =&gt; <span class="hljs-keyword">const</span> CircularProgressIndicator()),<br>            wordPairResult.when(data: (data) &#123;<br>              <span class="hljs-keyword">return</span> Text(data);<br>            &#125;, error: (error, stack) &#123;<br>              <span class="hljs-keyword">return</span> ElevatedButton(<br>                  onPressed: () &#123;<br>                    ref.refresh(wordPairProvider.future);<br>                  &#125;,<br>                  child: Text(<span class="hljs-string">&quot;ç‚¹å‡»åˆ·æ–°&quot;</span>));<br>            &#125;, loading: () &#123;<br>              <span class="hljs-keyword">return</span> CircularProgressIndicator();<br>            &#125;),<br>          ],<br>        ),<br>      ),<br>    );<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<code>ref.watch(FutureProvider)</code>çš„è¿”å›å€¼æ˜¯AsyncValueç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡å¼åŒ¹é…çš„æ–¹å¼æ¥æ›´æ–°UIã€‚è¿™é‡Œä¼šæœ‰ä¸‰ä¸ªçŠ¶æ€:data,loading,errorã€‚<br>æˆ‘ä»¬åœ¨é¡µé¢ä¸Šæ·»åŠ äº†ä¸€ä¸ªä¸‹æ‹‰åˆ·æ–°çš„æ§ä»·æ¥åˆ·æ–°æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚çš„ provider:<code>ref.refresh(wordPairProvider.future)</code>ã€‚</p><ul><li>FutureProvideråŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œå¯ä»¥ç”¨å®ƒæ¥</li><li>æ‰§è¡Œå’Œç¼“å­˜å¼‚æ­¥æ“ä½œï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ï¼‰</li><li>å¤„ç†å¼‚æ­¥æ“ä½œçš„é”™è¯¯å’ŒåŠ è½½çŠ¶æ€</li><li>å°†å¤šä¸ªå¼‚æ­¥å€¼åˆå¹¶ä¸ºå¦ä¸€ä¸ªå€¼</li><li>é‡æ–°è·å–å’Œåˆ·æ–°æ•°æ®ï¼ˆé€‚ç”¨äºæ‹‰åˆ°åˆ·æ–°æ“ä½œï¼‰<br>å¦‚æœé€€å‡ºé¡µé¢éœ€è¦é‡æ–°è¿›è¡Œåˆ·æ–°ï¼Œæˆ‘ä»¬å¯ä»¥é…åˆautoDisposeä½¿ç”¨:<code>FutureProvider.autoDispose&lt;String&gt;((ref) async &#123;&#125;</code></li></ul><h4 id="StreamProvider"><a href="#StreamProvider" class="headerlink" title="StreamProvider"></a>StreamProvider</h4><p>è¿™é‡Œä¾‹å­ä¸å¤§å¥½å†™ï¼Œå®ƒå’Œ FutureProvider ç±»ä¼¼ï¼Œè¢« watch æ—¶è¿”å›çš„ä¹Ÿæ˜¯ AsyncValue ç±»å‹ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªè®¡æ—¶å™¨çš„ç¤ºä¾‹ã€‚<br>åŒæ ·çš„ï¼Œå…ˆå£°æ˜ä¸€ä¸ª<code>StreamProvider</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> streamProvider = StreamProvider.autoDispose&lt;<span class="hljs-built_in">int</span>&gt;((ref) &#123;<br>    ref.onDispose(() &#123;<br>      debugPrint(<span class="hljs-string">&quot;streamProvider autoDispose&quot;</span>);<br>    &#125;);<br><br>    <span class="hljs-keyword">return</span> Stream.periodic(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">1</span>), (number) &#123;<br>      <span class="hljs-keyword">return</span> number + <span class="hljs-number">1</span>;<br>    &#125;);<br>  &#125;);<br><br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨é¡µé¢ä¸­ä½¿ç”¨</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs dart"><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StreamProviderWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-keyword">final</span> AsyncValue&lt;<span class="hljs-built_in">int</span>&gt; streamResult = ref.watch(streamProvider);<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;StreamProviderWidget&quot;</span>),<br>        centerTitle: <span class="hljs-keyword">true</span>,<br>      ),<br>      body: Column(<br>        children: [<br>          Text(streamResult.toString()),<br>          streamResult.when(<br>                  data: (data) &#123;<br>                    <span class="hljs-keyword">return</span> Text(data.toString());<br>                  &#125;,<br>                  error: (error, stack) &#123;<br>                    <span class="hljs-keyword">return</span> Text(error.toString());<br>                  &#125;,<br>                  loading: () =&gt; CircularProgressIndicator())<br>        ],<br>      ),<br>    );<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="ChangeNotifierProvider"><a href="#ChangeNotifierProvider" class="headerlink" title="ChangeNotifierProvider"></a>ChangeNotifierProvider</h4><p>å»ºè®®ä½¿ç”¨ NotifierProvider ä»£æ›¿ã€‚<br>è¿™é‡Œæ˜¯ä¸€ä¸ªè®¡æ•°å™¨ç¤ºä¾‹ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs dart"><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CounterNotifier</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ChangeNotifier</span> </span>&#123;<br>  <span class="hljs-built_in">int</span> _count = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">int</span> <span class="hljs-keyword">get</span> count =&gt; _count;<br>  <span class="hljs-keyword">void</span> increment() &#123;<br>    _count++;<br>    notifyListeners(); <span class="hljs-comment">// å½“è®¡æ•°å™¨å€¼æ”¹å˜æ—¶é€šçŸ¥æ‰€æœ‰ç›‘å¬è€…</span><br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// å®šä¹‰ChangeNotifierProvider</span><br><span class="hljs-keyword">final</span> counterProvider = ChangeNotifierProvider&lt;CounterNotifier&gt;((ref) &#123;<br>  <span class="hljs-keyword">return</span> CounterNotifier();<br>&#125;);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChangeNotifierProviderWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span></span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-keyword">return</span>  Scaffold(<br>        appBar: AppBar(title: Text(<span class="hljs-string">&#x27;ChangeNotifierProviderWidget&#x27;</span>)),<br>        body: Center(<br>          child: Consumer(builder: (context, ref, _) &#123; <span class="hljs-comment">// ä½¿ç”¨Consumerè¯»å–å¹¶æ˜¾ç¤ºçŠ¶æ€</span><br>            <span class="hljs-keyword">final</span> counter = ref.watch(counterProvider);<br>            <span class="hljs-keyword">return</span> Text(<span class="hljs-string">&#x27;Count: <span class="hljs-subst">$&#123;counter.count&#125;</span>&#x27;</span>);<br>          &#125;),<br>        ),<br>        floatingActionButton: FloatingActionButton(<br>          onPressed: () &#123;<br>            <span class="hljs-comment">// åœ¨ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œé€šè¿‡refè°ƒç”¨notifierçš„æ–¹æ³•æ›´æ–°çŠ¶æ€</span><br>            ref.read(counterProvider.notifier).increment();<br>          &#125;,<br>          child: Icon(Icons.add),<br>        ),<br>      );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="NotifierProvider"><a href="#NotifierProvider" class="headerlink" title="NotifierProvider"></a>NotifierProvider</h4><p>ç”¨æ¥ä»£æ›¿ StateProvider å’Œ ChangeNotifierProviderã€‚<br>åŒæ ·çš„ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªæ•°æ®ç±» Student</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> </span>&#123;<br>  Student(&#123;<span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.name, <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.id&#125;);<br>  <span class="hljs-built_in">String</span> name;<br>  <span class="hljs-built_in">String</span> id;<br><br>  Student copyWith(&#123;<span class="hljs-built_in">String?</span> copyID, <span class="hljs-built_in">String?</span> copyName&#125;) &#123;<br>    <span class="hljs-keyword">return</span> Student(name: copyName ?? <span class="hljs-keyword">this</span>.name, id: copyID ?? <span class="hljs-keyword">this</span>.id);<br>  &#125;<br>  <span class="hljs-built_in">String</span> toString()&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;<span class="hljs-subst">$id</span> : <span class="hljs-subst">$name</span>&quot;</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®šä¹‰ä¸€ä¸ªç»§æ‰¿è‡ª Notifier çš„ç±»</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs dart"><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StudentNotifier</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Notifier</span>&lt;<span class="hljs-title">Student</span>&gt; </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Student build() &#123;<br>    <span class="hljs-keyword">return</span> generateStudent();<br>  &#125;<br><br>  Student generateStudent() &#123;<br>    <span class="hljs-keyword">final</span> wordPair = generateWordPairs().first;<br>    <span class="hljs-keyword">final</span> id = Random().nextInt(<span class="hljs-number">100</span>);<br><br>    <span class="hljs-keyword">return</span> Student(<br>        name: <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;wordPair.first&#125;</span> - <span class="hljs-subst">$&#123;wordPair.second&#125;</span>&quot;</span>, id: id.toString());<br>  &#125;<br><br>  <span class="hljs-built_in">String</span> toString() &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;state.id&#125;</span> : <span class="hljs-subst">$&#123;state.name&#125;</span>&quot;</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">void</span> change() &#123;<br>    state = generateStudent();<br>  &#125;<br><br>  <span class="hljs-keyword">void</span> changeNameWithCopy(<span class="hljs-built_in">String</span> name) &#123;<br>    state = state.copyWith(copyName: name);<br>  &#125;<br><br>  <span class="hljs-keyword">void</span> justChangeName(<span class="hljs-built_in">String</span> name) &#123;<br>    state.name = name;<br>  &#125;<br><br>  <span class="hljs-keyword">void</span> changeIdWithCopy(<span class="hljs-built_in">String</span> id) &#123;<br>    state = state.copyWith(copyID: id);<br>  &#125;<br><br>  <span class="hljs-keyword">void</span> justChangeId(<span class="hljs-built_in">String</span> id) &#123;<br>    state.id = id;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œè¿™é‡Œçš„ build æ–¹æ³•æ˜¯å¿…é¡»çš„ã€‚åŒæ—¶ä¸ºäº†è§£é‡Šåˆ·æ–°é¡µé¢çš„æ¡ä»¶ï¼Œè¿™é‡Œå®šä¹‰äº†å‡ ä¸ªæ”¹å˜å±æ€§çš„æ–¹æ³•ã€‚xxxWithCopyæ˜¯é‡æ–°ç”Ÿæˆäº†å¯¹è±¡ï¼Œjustxxx åˆ™æ˜¯åœ¨åŸå¯¹è±¡ä¸Šç›´æ¥ä¿®æ”¹å±æ€§å€¼ã€‚<br>ç„¶åå£°æ˜<code>NotifierProvider</code>,è¿™é‡Œæä¾›äº†ä¸¤ç§æ–¹å¼ï¼Œå“ªä¸€ç§éƒ½å¯ä»¥ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> counterProvider = NotifierProvider&lt;StudentNotifier, Student&gt;(() &#123;<br>  <span class="hljs-keyword">return</span> StudentNotifier();<br>&#125;);<br><span class="hljs-keyword">final</span> counterProviderOther =<br>    NotifierProvider&lt;StudentNotifier, Student&gt;(StudentNotifier.<span class="hljs-keyword">new</span>);<br></code></pre></td></tr></table></figure><p>åœ¨é¡µé¢ä¸­æˆ‘ä»¬è¿™æ ·ä½¿ç”¨</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs dart"><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CounterNotifierWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-keyword">final</span> student = ref.watch(counterProvider);<br>    ref.listen(counterProvider, (oldValue, newValue) &#123;<br>      logger.d(<br>          <span class="hljs-string">&quot;oldValue--&gt; <span class="hljs-subst">$&#123;oldValue?.id.toString()&#125;</span> \n newValue--&gt; <span class="hljs-subst">$&#123;newValue.id&#125;</span>&quot;</span>);<br>    &#125;);<br><br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;CounterNotifierWidget&quot;</span>),<br>        centerTitle: <span class="hljs-keyword">true</span>,<br>      ),<br>      body: Column(<br>        children: [<br>          Text(<span class="hljs-string">&quot;student <span class="hljs-subst">$&#123;student.id.toString()&#125;</span> : <span class="hljs-subst">$&#123;student.name&#125;</span>  --&gt; <span class="hljs-subst">$&#123;student.toString()&#125;</span>&quot;</span>),<br><br>          ElevatedButton(<br>              onPressed: () &#123;<br>                ref<br>                    .read(counterProvider.notifier)<br>                    .changeIdWithCopy(Random().nextInt(<span class="hljs-number">100</span>).toString());<br>              &#125;,<br>              child: Text(<span class="hljs-string">&quot;changeIdWithCopy&quot;</span>)),<br>          ElevatedButton(<br>              onPressed: () &#123;<br>                <span class="hljs-keyword">final</span> wordPair = generateWordPairs().first;<br>                ref.read(counterProvider.notifier).changeNameWithCopy(<br>                    <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;wordPair.first&#125;</span> - -<span class="hljs-subst">$&#123;wordPair.second&#125;</span>&quot;</span>);<br>              &#125;,<br>              child: Text(<span class="hljs-string">&quot;changeNameWithCopy&quot;</span>)),<br><br>          ElevatedButton(<br>              onPressed: () &#123;<br>                ref<br>                    .read(counterProvider.notifier)<br>                    .justChangeId(Random().nextInt(<span class="hljs-number">100</span>).toString());<br>              &#125;,<br>              child: Text(<span class="hljs-string">&quot;justChangeId&quot;</span>)),<br>          ElevatedButton(<br>              onPressed: () &#123;<br>                <span class="hljs-keyword">final</span> wordPair = generateWordPairs().first;<br>                ref<br>                    .read(counterProvider.notifier)<br>                    .justChangeName(<span class="hljs-string">&quot;<span class="hljs-subst">$&#123;wordPair.first&#125;</span> - -<span class="hljs-subst">$&#123;wordPair.second&#125;</span>&quot;</span>);<br>              &#125;,<br>              child: Text(<span class="hljs-string">&quot;justChangeName&quot;</span>)),<br>        ],<br>      ),<br>      floatingActionButton: FloatingActionButton(<br>        onPressed: () &#123;<br>          ref.read(counterProvider.notifier).change();<br>        &#125;,<br>        child: Icon(Icons.change_circle),<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œä¹‹åå¯ä»¥çœ‹åˆ°ï¼Œåªæœ‰å½“æˆ‘ä»¬è°ƒç”¨<code>xxxwithCopy</code>æ—¶æ‰ä¼šåˆ·æ–°é¡µé¢ã€‚æˆ³åˆ°<code>NotifierProviderElement</code>æºç ä¸­æŸ¥çœ‹<code>updateShouldNotify</code>æ–¹æ³•ï¼Œå‘ç°æ˜¯è°ƒç”¨çš„identical(previous, next)æ–¹æ³•æ¥åšåˆ¤æ–­çš„ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@protected</span><br><span class="hljs-built_in">bool</span> updateShouldNotify(State previous, State next) &#123;<br>  <span class="hljs-keyword">return</span> !identical(previous, next);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="AsyncNotifierProvider"><a href="#AsyncNotifierProvider" class="headerlink" title="AsyncNotifierProvider"></a>AsyncNotifierProvider</h4><p>ç›¸æ¯”<code>NotifierProvider</code>,å®ƒæ˜¯å¼‚æ­¥è€Œå·².<br>è¿˜æ˜¯å…ˆå£°æ˜ä¸€ä¸ªæ•°æ®ç±»Student</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span></span>&#123;<br>  Student(&#123;<span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.name,<span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.id&#125;);<br>  <span class="hljs-built_in">String</span> name;<br>  <span class="hljs-built_in">String</span> id;<br><br>  <span class="hljs-built_in">String</span> toString()&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;<span class="hljs-subst">$id</span> - <span class="hljs-subst">$name</span>&quot;</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å£°æ˜ä¸€ä¸ªç»§æ‰¿è‡ªAsyncNotifierçš„ç±»</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs dart"><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StudentAsyncNotifier</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AsyncNotifier</span>&lt;<span class="hljs-title">Student</span>&gt;</span>&#123;<br>  <span class="hljs-meta">@override</span><br>  FutureOr&lt;Student&gt; build() <span class="hljs-keyword">async</span> &#123;<br><br>      <span class="hljs-keyword">return</span> getInfo();<br>  &#125;<br><br> Future&lt;Student&gt; getInfo()<span class="hljs-keyword">async</span>&#123;<br>    <br>    <span class="hljs-keyword">await</span>  Future.delayed(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">3</span>));<br>    <span class="hljs-keyword">final</span> wordPair = generateWordPairs().first;<br>    <span class="hljs-keyword">return</span> Student(name: <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;wordPair.first&#125;</span> - <span class="hljs-subst">$&#123;wordPair.second&#125;</span>&quot;</span>, id: Random().nextInt(<span class="hljs-number">100</span>).toString());<br>    <br>  &#125; <br><br>  Future&lt;<span class="hljs-keyword">void</span>&gt; refresh() <span class="hljs-keyword">async</span>&#123;<br>      state = AsyncValue.loading();<br>      state = <span class="hljs-keyword">await</span> AsyncValue.guard(()<span class="hljs-keyword">async</span> &#123;<br>        <span class="hljs-keyword">return</span> getInfo();<br>      &#125;);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å£°æ˜ä¸€ä¸ª Provider</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> studentAsyncNotifier = AsyncNotifierProvider&lt;StudentAsyncNotifier, Student&gt;(() &#123;<br>  <span class="hljs-keyword">return</span> StudentAsyncNotifier();<br>&#125;);<br></code></pre></td></tr></table></figure><p>åœ¨é¡µé¢ä¸­ä½¿ç”¨</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs dart"><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AsyncNotifierProviderWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span></span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br><br>    <span class="hljs-keyword">final</span> asyncValue = ref.watch(studentAsyncNotifier);<br><br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(title: Text(<span class="hljs-string">&quot;AsyncNotifierProviderWidget&quot;</span>),centerTitle: <span class="hljs-keyword">false</span>,),<br>      body: asyncValue.when(data: (data)&#123;<br>       <span class="hljs-keyword">return</span> Center(child: Text(data .toString()),);<br>      &#125;, error: (error,stack)&#123;<br>       <span class="hljs-keyword">return</span> Center(child: Text(error.toString()),);<br>      &#125;, loading: ()&#123;<br>        <span class="hljs-keyword">return</span> Center(child: CircularProgressIndicator());<br>      &#125;),<br>      floatingActionButton: FloatingActionButton(onPressed: ()&#123;<br>        ref.read(studentAsyncNotifier.notifier).refresh();<br>      &#125;,child: Icon(Icons.refresh),),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šä½¿ç”¨AsyncNotifierä¸autoDisposeçš„æ­£ç¡®æ–¹å¼æ˜¯ç»§æ‰¿ AutoDisposeAsyncNotifierç±»è€Œä¸æ˜¯ä½¿ç”¨ autoDispose ä¿®é¥°ç¬¦ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯ riverpod ä¸­å¸¸è§çš„ Provider çš„ç”¨æ³•ç¤ºä¾‹ï¼Œåé¢ä¼šä»‹ç»ä¸€äº›ä¿®é¥°ç¬¦ã€æ³¨è§£ç›¸å…³çš„ä¿¡æ¯ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Flutter</tag>
      
      <tag>riverpod</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¸¿è’™åº”ç”¨å¼€å‘ä½¿ç”¨canvaså®ç°çƒé¢è¿åŠ¨åŠ¨ç”»</title>
    <link href="/2023/12/24/%E9%B8%BF%E8%92%99%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E4%BD%BF%E7%94%A8canvas%E5%AE%9E%E7%8E%B0%E7%90%83%E9%9D%A2%E8%BF%90%E5%8A%A8%E5%8A%A8%E7%94%BB/"/>
    <url>/2023/12/24/%E9%B8%BF%E8%92%99%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E4%BD%BF%E7%94%A8canvas%E5%AE%9E%E7%8E%B0%E7%90%83%E9%9D%A2%E8%BF%90%E5%8A%A8%E5%8A%A8%E7%94%BB/</url>
    
    <content type="html"><![CDATA[<h3 id="åæ§½"><a href="#åæ§½" class="headerlink" title="åæ§½"></a>åæ§½</h3><p>ä¹ æƒ¯äº† Android çš„ Canvas,ç”¨é¸¿è’™çš„ canvas å¤šå°‘æœ‰ç‚¹åˆ«æ‰­<br>æ•ˆæœå›¾<br><img src="/image/HarmonyOS/canvas_ball_animation.gif" alt="canvas_ball_animation.gif"><br>ä¸Šé¢çš„å›¾æ˜¯ç”¨ transform å±æ€§åšçš„åŠ¨ç”»<br>ä¸‹é¢çš„å›¾æ˜¯ç”¨ canvas ç”»çš„ï¼Œå‚è€ƒè‡ª<a href="https://mp.weixin.qq.com/s/p_gy8s1SqPUTAa3wCIk7FQ">https://mp.weixin.qq.com/s/p_gy8s1SqPUTAa3wCIk7FQ</a></p><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œæˆ‘ä»¬åœ¨æ‰‹æœºæˆ–è€…å¹³æ¿ä¸Šçœ‹åˆ°çš„ 3D åŠ¨ç”»åªæ˜¯åœ¨äºŒç»´çš„æŠ•å½±ï¼Œæˆ‘ä»¬åªéœ€è¦è®¡ç®—å¥½è¿åŠ¨ç‰©ä½“çš„å¤§å°å’Œä½ç½®çš„å¯¹åº”å…³ç³»ï¼Œå°±å¯ä»¥å®ç°ç±»ä¼¼ 3D çš„æ•ˆæœã€‚æƒ³è¦äº†è§£å…·ä½“çš„ç®—æ³•ä»¥åŠæ˜ å°„å…³ç³»ï¼Œå¯ä»¥é˜…è¯»åŸæ–‡ã€‚<br>æ ¹æ®å‚è€ƒæ–‡ç« ä¸­çš„è®¡ç®—æ–¹å¼ï¼Œæˆ‘ä»¬åªéœ€è¦ç§»æ¤ä¸€ä¸‹å°±è¡Œã€‚è¿™é‡Œæ˜¯æ ¹æ®<code>æ€»ç»“</code>ä¸­çš„ä»£ç å®ç°çš„<br>åŸæ–‡ä¸­çš„å…³é”®ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-type">double</span>Â <span class="hljs-variable">xr</span>Â <span class="hljs-operator">=</span>Â Math.toRadians(<span class="hljs-number">5</span>);Â Â <span class="hljs-comment">//ç»•xè½´æ—‹è½¬åˆ™æŠŠè¿™ä¸ªå€¼è®¾ç½®ä¸ºå¤§äº 0</span><br>Â Â Â Â <span class="hljs-type">double</span>Â <span class="hljs-variable">yr</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-number">0</span>;Â Â <span class="hljs-comment">//ç»•yè½´æ—‹è½¬åˆ™æŠŠè¿™ä¸ªå€¼è®¾ç½®ä¸ºå¤§äº 0;  </span><br>Â Â Â Â <span class="hljs-type">double</span>Â <span class="hljs-variable">zr</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-number">0</span>;  <span class="hljs-comment">//ç»•zè½´æ—‹è½¬åˆ™æŠŠè¿™ä¸ªå€¼è®¾ç½®ä¸ºå¤§äº 0;  </span><br><br><span class="hljs-comment">//ä¿å­˜å°çƒçš„ä½ç½®ã€é¢œè‰²åŠç¼©æ”¾</span><br><span class="hljs-keyword">static</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">Point</span>Â &#123;  <br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-type">int</span>Â color;  <br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-type">float</span>Â x;  <br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-type">float</span>Â y;  <br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-type">float</span>Â z;   <br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-type">float</span>Â <span class="hljs-variable">scale</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-number">1f</span>;  <br>Â Â Â Â &#125;<br><span class="hljs-comment">//pointList ä¿å­˜çš„æ˜¯éšæœºç”Ÿæˆçš„å°çƒç›¸å…³ä¿¡æ¯</span><br><span class="hljs-keyword">for</span>Â (<span class="hljs-type">int</span>Â <span class="hljs-variable">i</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-number">0</span>;Â iÂ &lt;Â pointList.size();Â i++)Â &#123;  <br>  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">Point</span>Â <span class="hljs-variable">point</span>Â <span class="hljs-operator">=</span>Â pointList.get(i);  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">x</span>Â <span class="hljs-operator">=</span>Â point.x;  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">y</span>Â <span class="hljs-operator">=</span>Â point.y;  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">z</span>Â <span class="hljs-operator">=</span>Â point.z;  <br>  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//ç»•Xè½´æ—‹è½¬ï¼Œä¹˜ä»¥Xè½´çš„æ—‹è½¬çŸ©é˜µ  </span><br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">rx1</span>Â <span class="hljs-operator">=</span>Â x;  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">ry1</span>Â <span class="hljs-operator">=</span>Â (<span class="hljs-type">float</span>)Â (yÂ *Â Math.cos(xr)Â +Â zÂ *Â -Math.sin(xr));  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">rz1</span>Â <span class="hljs-operator">=</span>Â (<span class="hljs-type">float</span>)Â (yÂ *Â Math.sin(xr)Â +Â zÂ *Â Math.cos(xr));  <br>  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â ç»•Yè½´æ—‹è½¬,ä¹˜ä»¥Yè½´çš„æ—‹è½¬çŸ©é˜µ  </span><br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">rx2</span>Â <span class="hljs-operator">=</span>Â (<span class="hljs-type">float</span>)Â (rx1Â *Â Math.cos(yr)Â +Â rz1Â *Â Math.sin(yr));  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">ry2</span>Â <span class="hljs-operator">=</span>Â ry1;  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">rz2</span>Â <span class="hljs-operator">=</span>Â (<span class="hljs-type">float</span>)Â (rx1Â *Â -Math.sin(yr)Â +Â rz1Â *Â Math.cos(yr));  <br>  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â ç»•Zè½´æ—‹è½¬,ä¹˜ä»¥Zè½´çš„æ—‹è½¬çŸ©é˜µ  </span><br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">rx3</span>Â <span class="hljs-operator">=</span>Â (<span class="hljs-type">float</span>)Â (rx2Â *Â Math.cos(zr)Â +Â ry2Â *Â -Math.sin(zr));  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">ry3</span>Â <span class="hljs-operator">=</span>Â (<span class="hljs-type">float</span>)Â (rx2Â *Â Math.sin(zr)Â +Â ry2Â *Â Math.cos(zr));  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">rz3</span>Â <span class="hljs-operator">=</span>Â rz2;  <br>  <br>  <br>Â Â Â Â Â Â Â Â Â Â Â Â point.xÂ =Â rx3;  <br>Â Â Â Â Â Â Â Â Â Â Â Â point.yÂ =Â ry3;  <br>Â Â Â Â Â Â Â Â Â Â Â Â point.zÂ =Â rz3;  <br>  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â é€è§†é™¤æ³•ï¼Œzè½´å‘å†…çš„æ–¹å‘  </span><br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">scale</span>Â <span class="hljs-operator">=</span>Â (<span class="hljs-number">2</span>Â *Â radius)Â /Â ((<span class="hljs-number">2</span>Â *Â radius)Â +Â rz3);  <br>Â Â Â Â Â Â Â Â Â Â Â Â point.scaleÂ =Â scale;  <br>        <span class="hljs-comment">//åˆ°è¿™é‡Œå°±å®Œæˆäº†å°çƒä½ç½®çš„è®¡ç®—ï¼Œæ¥ä¸‹æ¥å°±æ˜¯éœ€è¦å®šæ—¶æ›´æ–°ä¸Šé¢xrã€yrã€zrçš„å€¼å°±å¯ä»¥å®ç°å°çƒæ²¿çƒé¢è¿åŠ¨äº†</span><br>  <br>Â Â Â Â Â Â Â Â &#125;<br><br></code></pre></td></tr></table></figure><h3 id="é¸¿è’™-transform-å®ç°"><a href="#é¸¿è’™-transform-å®ç°" class="headerlink" title="é¸¿è’™ transform å®ç°"></a>é¸¿è’™ transform å®ç°</h3><p>æ¸…æ¥šäº†åŸç†åŠè®¡ç®—æ–¹å¼ï¼Œå®ç°èµ·æ¥å°±ç®€å•äº†<br>å…ˆ stack å †å ä¸¤ä¸ªåœ†çƒï¼Œå°çƒéœ€è¦ä¸æ–­è¿åŠ¨ï¼Œxã€yã€zéœ€è¦ä¸€ç›´å˜åŒ–ï¼Œä½¿ç”¨<code>@State</code>ä¿®é¥°ä¸€ä¸‹ã€‚å€¼çš„å˜åŒ–è¿‡ç¨‹å°±ç”¨ä¸Šé¢åŸæ–‡ä¸­çš„è®¡ç®—æ–¹æ³•ã€‚å®šæ—¶æ›´æ–°å°±ç”¨<code>setInterval</code>,ç»„ä»¶çš„ä½ç§»å˜åŒ–ç»™æˆ‘ä»¬æä¾›äº†<code>transform</code>æ–¹æ³•ï¼Œéœ€è¦ä¸€ä¸ª<code>matrix4</code>å¯¹è±¡ï¼Œç§»åŠ¨å˜åŒ–ä¹Ÿä¸éœ€è¦æˆ‘ä»¬å»å¡«å……çŸ©é˜µï¼Œæœ‰å¯¹åº”çš„<code>translate</code>æ–¹æ³•ï¼Œç»„åˆèµ·æ¥ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-keyword">import</span> matrix4 <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@ohos.matrix4&#x27;</span><br><br><span class="hljs-meta">@Preview</span><br><span class="hljs-meta">@Entry</span><br><span class="hljs-meta">@Component</span><br>struct <span class="hljs-title class_">AnimationOfSphericalPaths</span> &#123;<br>  <span class="hljs-meta">@State</span> <span class="hljs-attr">angleX</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span><br>  <span class="hljs-meta">@State</span> <span class="hljs-attr">translateX</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span><br>  <span class="hljs-meta">@State</span> <span class="hljs-attr">translateY</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span><br>  <span class="hljs-meta">@State</span> <span class="hljs-attr">translateZ</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span><br>  <span class="hljs-meta">@State</span> <span class="hljs-attr">ballRadius</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">30</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">timerInterval</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span><br>  <span class="hljs-keyword">private</span> radius = <span class="hljs-number">200</span><br>  <span class="hljs-keyword">private</span> a = <span class="hljs-number">90</span><br>  <span class="hljs-keyword">private</span> b = <span class="hljs-number">0</span><br><br><br>  <span class="hljs-title function_">toRadians</span>(degrees): <span class="hljs-built_in">number</span> &#123;<br>    <span class="hljs-keyword">return</span> degrees * (<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>)<br>  &#125;<br><br>  <span class="hljs-title function_">changeAngle</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">b</span> += <span class="hljs-number">3</span><br>    <span class="hljs-comment">// this.a += 3</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">a</span> &gt; <span class="hljs-number">360</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">a</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">a</span> - <span class="hljs-number">360</span><br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">b</span> &gt; <span class="hljs-number">360</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">b</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">b</span> - <span class="hljs-number">360</span><br>    &#125;<br><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateX</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">toRadians</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">a</span>)) * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">toRadians</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">b</span>)) * <span class="hljs-number">2</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateY</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">toRadians</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">a</span>)) * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">toRadians</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">b</span>)) * <span class="hljs-number">2</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateZ</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">toRadians</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">b</span>)) * <span class="hljs-number">2</span><br><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ballRadius</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateZ</span> / <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> * <span class="hljs-number">10</span> + <span class="hljs-number">50</span><br><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`translateX-&gt; <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.translateX&#125;</span> ,translateY-&gt; <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.translateY&#125;</span> ,translateZ-&gt; <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.translateZ&#125;</span>`</span>)<br><br>  &#125;<br><br>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Column</span>() &#123;<br>      <span class="hljs-title class_">Stack</span>() &#123;<br>        <span class="hljs-title class_">Circle</span>(&#123; <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> * <span class="hljs-number">2</span>, <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> * <span class="hljs-number">2</span> &#125;).<span class="hljs-title function_">fill</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Yellow</span>)<br>        <span class="hljs-title class_">Circle</span>(&#123; <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">ballRadius</span>, <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">ballRadius</span> &#125;).<span class="hljs-title function_">fill</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>)<br>          .<span class="hljs-title function_">transform</span>(matrix4.<span class="hljs-title function_">identity</span>().<span class="hljs-title function_">translate</span>(&#123; <span class="hljs-attr">x</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateX</span>, <span class="hljs-attr">y</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateY</span>, <span class="hljs-attr">z</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateZ</span> &#125;))<br>      &#125;.<span class="hljs-title function_">alignContent</span>(<span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Center</span>).<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> * <span class="hljs-number">2</span>).<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> * <span class="hljs-number">2</span>)<br><br>      <span class="hljs-title class_">Row</span>() &#123;<br>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">&quot;start&quot;</span>)<br>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">timerInterval</span> &gt; <span class="hljs-number">0</span>) &#123;<br>              <span class="hljs-keyword">return</span><br>            &#125;<br><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">timerInterval</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br><br>              <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">changeAngle</span>()<br><br>            &#125;.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), <span class="hljs-number">20</span>)<br>          &#125;)<br>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">&quot;stop&quot;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>          <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">timerInterval</span>)<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">timerInterval</span> = <span class="hljs-number">0</span><br>        &#125;).<span class="hljs-title function_">margin</span>(&#123; <span class="hljs-attr">left</span>: <span class="hljs-number">48</span> &#125;)<br>      &#125;.<span class="hljs-title function_">margin</span>(&#123; <span class="hljs-attr">top</span>: <span class="hljs-number">48</span> &#125;)<br><br>    &#125;.<span class="hljs-title function_">width</span>(<span class="hljs-string">&quot;100%&quot;</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">&quot;100%&quot;</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)<br>  &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="é¸¿è’™canvaså®ç°"><a href="#é¸¿è’™canvaså®ç°" class="headerlink" title="é¸¿è’™canvaså®ç°"></a>é¸¿è’™canvaså®ç°</h3><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé¸¿è’™é‡Œé¢çš„ math åŒ…ä¸‹æ²¡æœ‰<code>toRadians</code>æ–¹æ³•ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±å®ç°ä¸€ä¸‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-title function_">toRadians</span>(degrees): <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">return</span> degrees * (<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>å®šæ—¶æ›´æ–°è¿™é‡Œç”¨äº†<code>setInterval</code><br>é¸¿è’™çš„ canvas ä¸­ä¹Ÿæ²¡æœ‰ç”»ç¬”çš„æ¦‚å¿µï¼Œéœ€è¦è®¾ç½®<code>RenderingContextSettings</code>å®ä¾‹çš„å¡«å……æ–¹å¼åŠå¡«å……é¢œè‰²<br>é¸¿è’™çš„ canvas ä¸­ä¹Ÿæ²¡æœ‰ drawcircle æ–¹æ³•ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯<code>Path2D</code>å¯¹è±¡ä¸­ç”»åœ†å¼§æ–¹æ³•(arc)ç„¶åå¡«å……é¢œè‰²çš„æ–¹å¼ï¼Œéœ€è¦æ³¨æ„æ˜¯<code>Path2D.arc()</code>ä¸­çš„è§’åº¦å•ä½  </p><p>æ•´ä½“æµç¨‹å¦‚ä¸‹</p><ol><li>å…ˆç”Ÿæˆéšæœºçš„å°çƒï¼Œåˆ†å¸ƒåœ¨ä¸€ä¸ªåœ†ä¸ŠgenerateBall()</li><li>è®¡ç®—å°çƒçš„ç¼©æ”¾æ¯”ä¾‹åŠä½ç½®calculateRotateValue()</li><li>å¯¹å°çƒæ’åºï¼Œz è½´è¶Šå¤§ï¼Œè¶Šé è¿‘æˆ‘ä»¬ï¼Œå°çƒè¶Šå¤§ï¼Œè¶Šè¦é®ç›–ä½å…¶ä»–å°çƒï¼Œè¶Šè¦æœ€åç”»</li><li>æ‰€ä»¥å…ˆç”»èƒŒé¢çš„ï¼Œå†ç”»æ­£é¢çš„ã€‚è¿™é‡Œçš„æ­£é¢å’ŒèƒŒé¢æ˜¯ç›¸å¯¹äºä¸­é—´çš„å¤§çƒæ¥è¯´çš„ï¼Œä¸ºäº†é€è§†æ•ˆæœï¼ŒèƒŒé¢çš„å°çƒåŠ ä¸Šé€æ˜åº¦ï¼Œæ­£é¢çš„å°çƒä¸é€æ˜</li><li>å®šæ—¶æ›´æ–°å°±å¯ä»¥äº†</li></ol><p>ä¸‹é¢æ˜¯å…¨éƒ¨ä»£ç </p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-meta">@Preview</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">CanvasBallAnimation</span> &#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">settings</span>: <span class="hljs-title class_">RenderingContextSettings</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderingContextSettings</span>(<span class="hljs-literal">true</span>)<br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">canvasRendering</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasRenderingContext2D</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>)<br>  <span class="hljs-keyword">private</span> canvasWidth = <span class="hljs-number">0</span><br>  <span class="hljs-keyword">private</span> canvasHeight = <span class="hljs-number">0</span><br>  <span class="hljs-meta">@State</span> <span class="hljs-attr">canvasBallRoundRadius</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">canvasBallAnimationTimer</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">startDegree</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">5</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">xr</span>: <span class="hljs-built_in">number</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">toRadians</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">startDegree</span>)<br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">yr</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">zr</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">pointList</span>: <span class="hljs-title class_">Point</span>[] = []<br><br>  <span class="hljs-title function_">toRadians</span>(degrees): <span class="hljs-built_in">number</span> &#123;<br>    <span class="hljs-keyword">return</span> degrees * (<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>)<br>  &#125;<br><br>  <span class="hljs-title function_">canvasBallAnimation</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">startDegree</span> += <span class="hljs-number">5</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">startDegree</span> &gt; <span class="hljs-number">360</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">startDegree</span> -= <span class="hljs-number">360</span><br>    &#125;<br><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">clearRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span>)<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calculateRotateValue</span>()<br>    <span class="hljs-comment">//æ’åºï¼Œå…ˆç”»èƒŒé¢çš„ï¼Œå†ç”»æ­£é¢çš„</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pointList</span>.<span class="hljs-title function_">sort</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">comparator</span>)<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawFrontBall</span>()<br><br>    <span class="hljs-comment">//åœ¨ä¸­é—´ç”»ä¸€ä¸ªå¤§åœ†</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawCenterBall</span>()<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawBackBall</span>()<br><br><br>  &#125;<br><br>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Column</span>() &#123;<br><br><br>      <span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>)<br>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">&quot;100%&quot;</span>)<br>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">&quot;40%&quot;</span>)<br>        .<span class="hljs-title function_">onAreaChange</span>(<span class="hljs-function">(<span class="hljs-params">oldValue: Area, newValue: Area</span>) =&gt;</span> &#123;<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span> = <span class="hljs-built_in">parseInt</span>(newValue.<span class="hljs-property">width</span>.<span class="hljs-title function_">toString</span>())<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span> = <span class="hljs-built_in">parseInt</span>(newValue.<span class="hljs-property">height</span>.<span class="hljs-title function_">toString</span>())<br><br>          <span class="hljs-comment">//å°çƒè¿åŠ¨çš„åŠå¾„</span><br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallRoundRadius</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span>) / <span class="hljs-number">3</span><br>          <span class="hljs-comment">// this.canvasRendering.translate(this.canvasWidth / 2, this.canvasHeight / 2)</span><br>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">generateBall</span>()<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calculateRotateValue</span>()<br>          <span class="hljs-comment">//æ’åºï¼Œå…ˆç”»èƒŒé¢çš„ï¼Œå†ç”»æ­£é¢çš„</span><br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">pointList</span>.<span class="hljs-title function_">sort</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">comparator</span>)<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawFrontBall</span>()<br><br>          <span class="hljs-comment">//åœ¨ä¸­é—´ç”»ä¸€ä¸ªå¤§åœ†</span><br>         <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawCenterBall</span>()<br><br>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawBackBall</span>()<br><br><br>        &#125;)<br>      <span class="hljs-title class_">Row</span>() &#123;<br>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">&quot;canvas ball start&quot;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallAnimationTimer</span> &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span><br>          &#125;<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallAnimationTimer</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">canvasBallAnimation</span>()<br>          &#125;.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), <span class="hljs-number">20</span>)<br>        &#125;)<br>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">&quot;canvas ball end&quot;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>          <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallAnimationTimer</span>)<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallAnimationTimer</span> = <span class="hljs-number">0</span><br>        &#125;)<br>      &#125;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-title function_">comparator</span>(<span class="hljs-attr">left</span>: <span class="hljs-title class_">Point</span>, <span class="hljs-attr">right</span>: <span class="hljs-title class_">Point</span>): <span class="hljs-built_in">number</span> &#123;<br>    <span class="hljs-keyword">if</span> (left.<span class="hljs-property">z</span> - right.<span class="hljs-property">z</span> &lt; <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (left.<span class="hljs-property">z</span> == right.<span class="hljs-property">z</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br><br>  &#125;<br><br>  <span class="hljs-title function_">randomColor</span>(): <span class="hljs-built_in">string</span> &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-attr">r</span>: <span class="hljs-built_in">string</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">256</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)<br>    <span class="hljs-keyword">let</span> <span class="hljs-attr">g</span>: <span class="hljs-built_in">string</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">256</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)<br>    <span class="hljs-keyword">let</span> <span class="hljs-attr">b</span>: <span class="hljs-built_in">string</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">256</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)<br>    <span class="hljs-keyword">let</span> result = <span class="hljs-string">`<span class="hljs-subst">$&#123;r&#125;</span><span class="hljs-subst">$&#123;g&#125;</span><span class="hljs-subst">$&#123;b&#125;</span>`</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`éšæœºé¢œè‰²--&gt; <span class="hljs-subst">$&#123;result&#125;</span>`</span>)<br>    <span class="hljs-keyword">return</span> result<br>  &#125;<br><br>  <span class="hljs-title function_">generateBall</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">pointList</span>.<span class="hljs-property">length</span> == <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-keyword">let</span> maxBallCount = <span class="hljs-number">10</span><br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pointList</span> = []<br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; maxBallCount; i++) &#123;<br><br>        <span class="hljs-keyword">let</span> v = -<span class="hljs-number">1.0</span> + (<span class="hljs-number">2.0</span> * i - <span class="hljs-number">1.0</span>) / maxBallCount;<br>        <span class="hljs-keyword">if</span> (v &lt; -<span class="hljs-number">1.0</span>) &#123;<br>          v = <span class="hljs-number">1.0</span><br>        &#125;<br><br>        <span class="hljs-keyword">let</span> delta = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">acos</span>(v)<br>        <span class="hljs-keyword">let</span> alpha = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(maxBallCount * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>) * delta<br>        <span class="hljs-keyword">let</span> point = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Point</span>()<br>        point.<span class="hljs-property">x</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallRoundRadius</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(alpha) * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(delta)<br>        point.<span class="hljs-property">y</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallRoundRadius</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(alpha) * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(delta)<br>        point.<span class="hljs-property">z</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallRoundRadius</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(delta)<br>        point.<span class="hljs-property">color</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">randomColor</span>()<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">pointList</span>.<span class="hljs-title function_">push</span>(point)<br>      &#125;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-title function_">calculateRotateValue</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">pointList</span>.<span class="hljs-property">length</span>; i++) &#123;<br><br>      <span class="hljs-keyword">let</span> point = <span class="hljs-variable language_">this</span>.<span class="hljs-property">pointList</span>[i];<br>      <span class="hljs-keyword">let</span> x = point.<span class="hljs-property">x</span>;<br>      <span class="hljs-keyword">let</span> y = point.<span class="hljs-property">y</span>;<br>      <span class="hljs-keyword">let</span> z = point.<span class="hljs-property">z</span>;<br><br>      <span class="hljs-comment">//ç»•Xè½´æ—‹è½¬ï¼Œä¹˜ä»¥Xè½´çš„æ—‹è½¬çŸ©é˜µ</span><br>      <span class="hljs-keyword">let</span> rx1 = x;<br>      <span class="hljs-keyword">let</span> ry1 = (y * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">xr</span>) + z * -<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">xr</span>));<br>      <span class="hljs-keyword">let</span> rz1 = (y * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">xr</span>) + z * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">xr</span>));<br><br>      <span class="hljs-comment">// ç»•Yè½´æ—‹è½¬,ä¹˜ä»¥Yè½´çš„æ—‹è½¬çŸ©é˜µ</span><br>      <span class="hljs-keyword">let</span> rx2 = (rx1 * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">yr</span>) + rz1 * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">yr</span>));<br>      <span class="hljs-keyword">let</span> ry2 = ry1;<br>      <span class="hljs-keyword">let</span> rz2 = (rx1 * -<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">yr</span>) + rz1 * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">yr</span>));<br><br>      <span class="hljs-comment">// ç»•Zè½´æ—‹è½¬,ä¹˜ä»¥Zè½´çš„æ—‹è½¬çŸ©é˜µ</span><br>      <span class="hljs-keyword">let</span> rx3 = (rx2 * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">zr</span>) + ry2 * -<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">zr</span>));<br>      <span class="hljs-keyword">let</span> ry3 = (rx2 * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">zr</span>) + ry2 * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">zr</span>));<br>      <span class="hljs-keyword">let</span> rz3 = rz2;<br><br><br>      point.<span class="hljs-property">x</span> = rx3;<br>      point.<span class="hljs-property">y</span> = ry3;<br>      point.<span class="hljs-property">z</span> = rz3;<br><br>      <span class="hljs-comment">// é€è§†é™¤æ³•ï¼Œzè½´å‘å†…çš„æ–¹å‘</span><br>      <span class="hljs-keyword">let</span> scale = (<span class="hljs-number">2</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallRoundRadius</span>) / ((<span class="hljs-number">2</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallRoundRadius</span>) + rz3);<br>      point.<span class="hljs-property">scale</span> = scale;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-title function_">drawFrontBall</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">pointList</span>.<span class="hljs-property">length</span>; i++) &#123;<br>      <span class="hljs-keyword">let</span> point = <span class="hljs-variable language_">this</span>.<span class="hljs-property">pointList</span>[i];<br>      <span class="hljs-keyword">if</span> (point.<span class="hljs-property">z</span> &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawBall</span>(point)<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">break</span>;<br>      &#125;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-title function_">drawBall</span>(<span class="hljs-params">point: Point</span>) &#123;<br>    <span class="hljs-keyword">if</span> (point.<span class="hljs-property">scale</span> &gt; <span class="hljs-number">1</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">`#FF<span class="hljs-subst">$&#123;point.color&#125;</span>`</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">let</span> fillColor = <span class="hljs-string">`#<span class="hljs-subst">$&#123; <span class="hljs-built_in">Math</span>.round(point.scale * <span class="hljs-number">255</span>).toString(<span class="hljs-number">16</span>)&#125;</span><span class="hljs-subst">$&#123;point.color&#125;</span>`</span><br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">fillStyle</span> = fillColor<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;å¡«å……é¢œè‰²--&gt;&quot;</span> +fillColor)<br>    &#125;<br><br>    <span class="hljs-keyword">let</span> ballPath2D = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path2D</span>()<br>    ballPath2D.<span class="hljs-title function_">arc</span>(point.<span class="hljs-property">x</span> * point.<span class="hljs-property">scale</span> +<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span> / <span class="hljs-number">2</span> , point.<span class="hljs-property">y</span> * point.<span class="hljs-property">scale</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span> / <span class="hljs-number">2</span>, <span class="hljs-number">5</span> + <span class="hljs-number">25</span> * point.<span class="hljs-property">scale</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>)<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">beginPath</span>()<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">fill</span>(ballPath2D)<br>  &#125;<br><br>  <span class="hljs-title function_">drawBackBall</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-variable language_">this</span>.<span class="hljs-property">pointList</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) &#123;<br>      <span class="hljs-keyword">let</span> point = <span class="hljs-variable language_">this</span>.<span class="hljs-property">pointList</span>[i];<br>      <span class="hljs-keyword">if</span> (point.<span class="hljs-property">z</span> &lt;= <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawBall</span>(point)<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">break</span>;<br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-title function_">drawCenterBall</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">let</span> circlePath2D = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path2D</span>()<br>    circlePath2D.<span class="hljs-title function_">arc</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span>/<span class="hljs-number">2</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span>/<span class="hljs-number">2</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallRoundRadius</span>,<span class="hljs-number">0</span>,<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>)<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">beginPath</span>()<br><br>    <span class="hljs-keyword">let</span> radialGradient = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">createRadialGradient</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span>/<span class="hljs-number">2</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span>/<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span>/<span class="hljs-number">2</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span>/<span class="hljs-number">2</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallRoundRadius</span>)<br>    radialGradient.<span class="hljs-title function_">addColorStop</span>(<span class="hljs-number">0.0</span>,<span class="hljs-string">&quot;#ff0000&quot;</span>)<br>    radialGradient.<span class="hljs-title function_">addColorStop</span>(<span class="hljs-number">0.3</span>,<span class="hljs-string">&quot;#aaec5533&quot;</span>)<br>    radialGradient.<span class="hljs-title function_">addColorStop</span>(<span class="hljs-number">0.9</span>,<span class="hljs-string">&quot;#11000000&quot;</span>)<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">fillStyle</span>=radialGradient<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">fill</span>(circlePath2D)<br>  &#125;<br>&#125;<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Point</span> &#123;<br>  <span class="hljs-attr">color</span>: <span class="hljs-built_in">string</span><br>  <span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span><br>  <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span><br>  <span class="hljs-attr">z</span>: <span class="hljs-built_in">number</span><br>  <span class="hljs-attr">scale</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>HarmonyOS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¸¿è’™åº”ç”¨å¼€å‘è¸©å‘è®°å½•</title>
    <link href="/2023/11/29/%E9%B8%BF%E8%92%99%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/"/>
    <url>/2023/11/29/%E9%B8%BF%E8%92%99%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨HarmonyOS4+ArkUI+Stageæ¨¡å‹è¿›è¡Œå¼€å‘çš„ç¿»è¯‘è½¯ä»¶ï¼Œç›®å‰åªæ˜¯åŠæˆå“ï¼Œä»£ç å†™çš„å¾ˆæŒ«ã€‚è®°å½•ä¸€ä¸‹å¼€å‘è¿‡ç¨‹ä¸­è¸©è¿‡çš„å‘ã€‚<br>é¡¹ç›®åœ°å€ï¼š<br>ç äº‘<br><a href="https://gitee.com/huangyuan/HarmonyTranslator">https://gitee.com/huangyuan/HarmonyTranslator</a><br>github<br><a href="https://github.com/huangyuanlove/HarmonyTranslator">https://github.com/huangyuanlove/HarmonyTranslator</a><br>ç äº‘é¡¹ç›®æ˜¯ä»githubå¯¼å…¥çš„ï¼Œå¶å°”ä¼šå¿˜è®°åŒæ­¥</p><h4 id="å†»å±ã€é»‘å±ã€å‡æ­»"><a href="#å†»å±ã€é»‘å±ã€å‡æ­»" class="headerlink" title="å†»å±ã€é»‘å±ã€å‡æ­»"></a>å†»å±ã€é»‘å±ã€å‡æ­»</h4><p>è¿è¡Œç¯å¢ƒæ˜¯MetaPadPro 2019 é¸¿è’™4.0.0ï¼Œä½¿ç”¨api9+stageæ¨¡å‹å¼€å‘ï¼Œè¿è¡Œåœ¨æ¨¡æ‹Ÿå™¨ä¸Šæ­£å¸¸ï¼Œä½†æ˜¯è¿è¡Œåœ¨è¯¥è®¾å¤‡ä¸Šå‡ºç°å†»å±ç°è±¡ï¼Œé¡µé¢è½®æ’­å›¾æ— æ³•è½®æ’­ï¼Œæ»‘åŠ¨ç»„ä»¶æ— æ³•å‘æ»‘åŠ¨ï¼Œå°±åƒå¡åœ¨äº†è¿™ä¸€å¸§ä¸Šä¸€æ ·ã€‚ç‚¹å‡»è¾“å…¥æ¡†é”®ç›˜èƒ½å¼¹å‡ºï¼Œä½†é¡µé¢æ˜¯é»‘çš„ã€‚å¯ä»¥é€šè¿‡é”å±ã€è§£é”æˆ–è€…éŸ³é‡é”®åˆ·æ–°é¡µé¢ã€‚</p><p>æ„Ÿè§‰ä¸Šå°±æ˜¯å±å¹•ä¸ä¼šä¸»åŠ¨åˆ·æ–°ï¼Œéœ€è¦æŒ‰ç‰©ç†é”®è®©å±å¹•åˆ·æ–°ä¸€æ¬¡ä¼¼çš„ã€‚  </p><p>è¯¢é—®è¿‡æœ‹å‹åå‘ç°ï¼Œè¿™ä¸ªç°è±¡åªä¼šå‡ºç°åœ¨éº’éºŸç³»åˆ—èŠ¯ç‰‡çš„æ‰‹æœºæˆ–å¹³æ¿ä¸Šï¼Œçœ‹åˆ°è®ºå›ä¹Ÿæœ‰äººå’¨è¯¢ç›¸åŒçš„é—®é¢˜ã€‚å‘å®˜æ–¹æå·¥å•åå®˜æ–¹å›å¤æ˜¯å·²çŸ¥é—®é¢˜ï¼Œå°†ä¼šåœ¨HarmonyOS nextç³»ç»Ÿä¸­ä¿®å¤  </p><p>å¦‚æœåªæ˜¯è‡ªå·±å†™ç€ç©ï¼Œå¯ä»¥å®‰è£… <a href="https://github.com/Genymobile/scrcpy">scrcpy</a> å°†å±å¹•å†…å®¹åŒæ­¥åˆ°ç”µè„‘ä¸Šï¼Œåœ¨ç”µè„‘ä¸Šæ“ä½œæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚  </p><p>å¦‚æœæ˜¯å…¬å¸ç”¨ï¼Œå»ºè®®å’¨è¯¢é¸¿è’™è¿è¥ï¼Œæˆä¸ºåˆä½œä¼™ä¼´ï¼Œç›´æ¥ä¸ŠHarmonyOS Nextè¿›è¡Œå¼€å‘ã€‚æˆ–è€…é™ä½apiç‰ˆæœ¬ã€‚</p><h4 id="PersistentStorageå’Œ-StorageLink"><a href="#PersistentStorageå’Œ-StorageLink" class="headerlink" title="PersistentStorageå’Œ@StorageLink"></a>PersistentStorageå’Œ@StorageLink</h4><p>é¡¹ç›®ä¸­æœ‰äº›è®¾ç½®éœ€è¦æŒä¹…åŒ–å­˜å‚¨ï¼Œäºæ˜¯é€‰æ‹©äº†PersistentStorageå’Œ@StorageLinkæ–¹å¼è¿›è¡Œå­˜å‚¨ï¼Œå¤§è‡´å¦‚ä¸‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age<br>  &#125;<br>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span><br>  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span><br>&#125;<br><br><span class="hljs-title class_">PersistentStorage</span>.<span class="hljs-property">PersistProp</span>&lt;<span class="hljs-title class_">User</span>&gt;(<span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&#x27;xuan&#x27;</span>,<span class="hljs-number">18</span>))<br><span class="hljs-meta">@Entry</span><br><span class="hljs-meta">@Component</span><br>struct <span class="hljs-title class_">Tmp</span> &#123;<br>  <span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">&#x27;user&#x27;</span>) <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&#x27;xuan&#x27;</span>, <span class="hljs-number">18</span>)<br>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.user.name&#125;</span> : <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.user.age&#125;</span>`</span>)<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å½“æˆ‘ç¬¬ä¸€è¿è¡Œçš„æ—¶å€™ï¼Œé¡µé¢æ˜¾ç¤ºæ­£å¸¸ï¼ŒTextæ˜¾ç¤ºçš„å†…å®¹æ˜¯<code>xuan : 18</code><br/><br>ä½†æ˜¯å½“æˆ‘é‡æ–°æ‰“å¼€åº”ç”¨(ä¸æ˜¯é‡æ–°ç¼–è¯‘ï¼Œå°±æ˜¯ç®€å•çš„åœ¨è®¾å¤‡ä¸Šå…³æ‰åº”ç”¨ç„¶åç‚¹å‡»æ¡Œé¢å›¾æ ‡æ‰“å¼€åº”ç”¨)çš„æ—¶å€™ï¼ŒTextæ˜¾ç¤ºå†…å®¹æ˜¯ <code>undefined : undefined</code><br/><br>æ‰“ä¸Šæ–­ç‚¹å‘ç°é‡æ–°æ‰“å¼€åº”ç”¨çš„æ—¶å€™ <code>user</code> æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹ï¼Œå€¼ä¸º {â€˜nameâ€™:â€™xuanâ€™,â€™ageâ€™:18}ï¼Œä½†å­—ç¬¦ä¸²å¯¹è±¡æ²¡æœ‰nameå’Œageå±æ€§ï¼Œæ‰€ä»¥æ˜¾ç¤ºäº† undefined.<br/><br>çœ‹åˆ°æ–‡æ¡£ä¸­æœ‰å†™ <a href="https://developer.harmonyos.com/cn/docs/documentation/doc-references-V3/arkts-state-management-0000001504151156-V3#ZH-CN_TOPIC_0000001523808562__persistprop">https://developer.harmonyos.com/cn/docs/documentation/doc-references-V3/arkts-state-management-0000001504151156-V3#ZH-CN_TOPIC_0000001523808562__persistprop</a></p><blockquote><p>AppStorageçš„å±æ€§å‘PersistentStorageä¸­æŒä¹…åŒ–çš„å…è®¸çš„ç±»å‹æ˜¯ï¼š<br/><br>numberï¼Œstringï¼Œbooleanï¼ŒenumåŸºç¡€ç±»å‹ã€‚<br/><br>Objectä¸­å¯åºåˆ—åŒ–çš„å±æ€§ã€‚<br/><br>ä¸å…è®¸undefinedå’Œnullã€‚</p></blockquote><p>ä½†åŒæ ·çš„ï¼Œåœ¨æŒ‡å—ä¸­åŒæ ·æœ‰PersistentStorageæè¿° <a href="https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V3/arkts-persiststorage-0000001474017166-V3#section610120319595">https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V3/arkts-persiststorage-0000001474017166-V3#section610120319595</a></p><blockquote><p>PersistentStorageå…è®¸çš„ç±»å‹å’Œå€¼æœ‰ï¼š<br/><br>number, string, boolean, enum ç­‰ç®€å•ç±»å‹ã€‚<br/><br>å¯ä»¥è¢«JSON.stringify()å’ŒJSON.parse()é‡æ„çš„å¯¹è±¡ã€‚ä¾‹å¦‚Date, Map, Setç­‰å†…ç½®ç±»å‹åˆ™ä¸æ”¯æŒï¼Œä»¥åŠå¯¹è±¡çš„å±æ€§æ–¹æ³•ä¸æ”¯æŒæŒä¹…åŒ–ã€‚<br/></p></blockquote><p>çœ‹åˆ°è®ºå›æœ‰åŒæ ·çš„æ±‚åŠ©ï¼Œæœ‰å¼€å‘è€…å›å¤è¯´ä»–æ˜¯å°†å¯¹è±¡è½¬æˆå­—ç¬¦ä¸²ä¿å­˜çš„ï¼Œä½¿ç”¨çš„æ—¶å€™å†parseä¸€ä¸‹ã€‚</p><h4 id="å‰ªè´´æ¿-pasteboard-getSystemPasteboard"><a href="#å‰ªè´´æ¿-pasteboard-getSystemPasteboard" class="headerlink" title="å‰ªè´´æ¿ pasteboard.getSystemPasteboard()"></a>å‰ªè´´æ¿ pasteboard.getSystemPasteboard()</h4><p>åœ¨ä½¿ç”¨å‰ªè´´æ¿æ—¶éœ€è¦å…ˆåˆ›å»ºå‰ªè´´æ¿æ•°æ®ï¼Œ<br>åˆ›å»ºæ–¹æ³•å¦‚ä¸‹ </p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-title function_">createData</span>(<span class="hljs-attr">mimeType</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">value</span>: <span class="hljs-title class_">ValueType</span>): <span class="hljs-title class_">PasteData</span>  <br><span class="hljs-title function_">createRecord</span>(<span class="hljs-attr">mimeType</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">value</span>: <span class="hljs-title class_">ValueType</span>):<span class="hljs-title class_">PasteDataRecord</span><br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªå‚æ•°å«ä¹‰ä¸ºï¼šè‡ªå®šä¹‰æ•°æ®çš„MIMEç±»å‹ã€‚ æ–‡æ¡£ä¸­ <a href="https://developer.harmonyos.com/cn/docs/documentation/doc-references-V3/js-apis-pasteboard-0000001544384177-V3#ZH-CN_TOPIC_0000001523648478__pasteboardcreatedata9">é¸¿è’™å¼€å‘apiå‚è€ƒ</a><br>ä¸­å†™çš„ç¤ºä¾‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> pasteboard <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@ohos.pasteboard&#x27;</span>;<br><span class="hljs-keyword">let</span> dataXml = <span class="hljs-string">&#x27;Hello World&#x27;</span>;<br><span class="hljs-keyword">let</span> pasteDataRecord = pasteboard.<span class="hljs-title function_">createRecord</span>(<span class="hljs-string">&#x27;app/xml&#x27;</span>, dataXml);<br></code></pre></td></tr></table></figure><p>å®é™…ä¸­å‘ç°æ—¶ä¸èƒ½ä½¿ç”¨è¿™è‡ªå®šä¹‰çš„<code>app/xml</code>å€¼ï¼Œä¼šå´©æºƒï¼Œåªèƒ½ä½¿ç”¨pasteboardä¸­é¢„å®šä¹‰çš„MIMEç±»å‹</p><h4 id="å¯¹è±¡å±æ€§ä»æœ‰å€¼å˜ä¸ºç©ºï¼Œåº”ç”¨ä¼šå´©æºƒ"><a href="#å¯¹è±¡å±æ€§ä»æœ‰å€¼å˜ä¸ºç©ºï¼Œåº”ç”¨ä¼šå´©æºƒ" class="headerlink" title="å¯¹è±¡å±æ€§ä»æœ‰å€¼å˜ä¸ºç©ºï¼Œåº”ç”¨ä¼šå´©æºƒ"></a>å¯¹è±¡å±æ€§ä»æœ‰å€¼å˜ä¸ºç©ºï¼Œåº”ç”¨ä¼šå´©æºƒ</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Entry</span><br><span class="hljs-meta">@Component</span><br>struct <span class="hljs-title class_">PlayGround</span> &#123;<br>  <span class="hljs-meta">@State</span> <span class="hljs-attr">people</span>:<span class="hljs-title class_">People</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">People</span>()<br>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">log</span>(<span class="hljs-attr">log</span>:<span class="hljs-built_in">string</span>):<span class="hljs-built_in">boolean</span>&#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`---------<span class="hljs-subst">$&#123;log&#125;</span>---------`</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>  &#125;<br><br>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-title class_">Column</span>() &#123;<br>      <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">people</span>)&#123;<br>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`å§“åï¼š <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.people.name&#125;</span>  å¹´é¾„ï¼š<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.people.age&#125;</span>`</span>)<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">people</span>.<span class="hljs-property">address</span>)&#123;<br>          <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;address æœ‰å€¼&#x27;</span>))&#123;<br>            <span class="hljs-title class_">Text</span>( <span class="hljs-string">`åœ°å€ï¼š <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.people.address.name&#125;</span>  é‚®ç¼–ï¼š<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.people.address.zipCode&#125;</span>`</span>)<br>          &#125;<br>          <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">&#x27;address ä¸ºç©º å†…éƒ¨&#x27;</span>)<br>          &#125;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>          <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;address ä¸ºç©º æœ€å¤–å±‚&#x27;</span>))&#123;<br>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">&#x27;address ä¸ºç©º æœ€å¤–å±‚&#x27;</span>)<br>          &#125;<br>        &#125;<br>      &#125;<br>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">&#x27;ç½‘ç»œè¯·æ±‚è¿”å›ä¸€ä¸ªæœ‰åœ°å€çš„å¯¹è±¡&#x27;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>&#123;<br>        <span class="hljs-keyword">let</span> tmpPeople = <span class="hljs-keyword">new</span> <span class="hljs-title class_">People</span>()<br>        <span class="hljs-keyword">let</span> tmpAddress = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>()<br>        tmpAddress.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;æµ‹è¯•åœ°å€&#x27;</span><br>        tmpAddress.<span class="hljs-property">zipCode</span> = -<span class="hljs-number">1000</span><br>        tmpPeople.<span class="hljs-property">address</span> = tmpAddress<br><br>        tmpPeople.<span class="hljs-property">age</span> = <span class="hljs-number">10</span><br>        tmpPeople.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;æœ‰åœ°å€&#x27;</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">people</span> = tmpPeople<br>      &#125;)<br><br>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">&#x27;ç½‘ç»œè¯·æ±‚è¿”å›ä¸€ä¸ªæ²¡æœ‰åœ°å€çš„å¯¹è±¡&#x27;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>&#123;<br>        <span class="hljs-keyword">let</span> tmpPeople = <span class="hljs-keyword">new</span> <span class="hljs-title class_">People</span>()<br>        tmpPeople.<span class="hljs-property">age</span> = <span class="hljs-number">10</span><br>        tmpPeople.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;æ²¡æœ‰åœ°å€&#x27;</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">people</span> = tmpPeople<br>      &#125;)<br>    &#125;.<span class="hljs-title function_">margin</span>(&#123;<span class="hljs-attr">top</span>:<span class="hljs-number">48</span>&#125;)<br>  &#125;<br>&#125;<br><span class="hljs-keyword">class</span>  <span class="hljs-title class_">Address</span>&#123;<br>  <span class="hljs-attr">zipCode</span>:<span class="hljs-built_in">number</span><br>  <span class="hljs-attr">name</span>:<span class="hljs-built_in">string</span><br>&#125;<br><span class="hljs-keyword">class</span>  <span class="hljs-title class_">People</span>&#123;<br>  <span class="hljs-attr">name</span>:<span class="hljs-built_in">string</span><br>  <span class="hljs-attr">age</span>:<span class="hljs-built_in">number</span><br>  address :<span class="hljs-title class_">Address</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¾ˆç®€å•çš„é¡µé¢ï¼Œå±•ç¤ºå¯¹è±¡å±æ€§ï¼Œ<br>åˆšå¼€å§‹è¿è¡Œï¼Œä¸€åˆ‡æ­£å¸¸ã€‚ç‚¹å‡»è¿”å›æœ‰åœ°å€çš„å¯¹è±¡ï¼Œé¡µé¢æ­£å¸¸åˆ·æ–°å¹¶ä¸”å±•ç¤ºã€‚ç„¶åç‚¹å‡»è¿”å›æ²¡æœ‰åœ°å€çš„å¯¹è±¡ï¼Œè¿™æ—¶å€™ä¼šå´©æºƒã€‚<br>æ—¥å¿—æŒ‡å‘äº† Text( <code>åœ°å€ï¼š $&#123;this.people.address.name&#125;  é‚®ç¼–ï¼š$&#123;this.people.address.zipCode&#125;</code>)<br>è¯´æ˜¯<code>ä¸èƒ½ä»undefinedå¯¹è±¡ä¸­è¯»å–nameå±æ€§</code> å…·ä½“å¯ä»¥çœ‹è¿™é‡Œï¼š<a href="https://developer.huawei.com/consumer/cn/forum/topic/0204136377582311317?fid=0102683795438680754">å¼€å‘è¿™è®ºå›</a><br>è§„é¿æ–¹æ¡ˆï¼šæˆ‘æœ‰ä¸€ä¸ªæœ‹å‹ï¼Œå°è¯•å‡ºäº†ä½¿ç”¨ <code>?.</code>æ¥è§„é¿çš„æ–¹æ³•ã€‚ å–å¯¹è±¡å±æ€§é™¤äº†è¦ç”¨ifåˆ¤æ–­æ¥æ§åˆ¶æ¸²æŸ“ä¹‹å¤–ï¼Œéœ€è¦ç”¨ <code>?.</code>æ¥å–å€¼ï¼Œé˜²å´©æºƒï¼Œå°†ä¸Šé¢çš„ä»£ç ä¿®æ”¹ä¸º<br>Text( <code>åœ°å€ï¼š $&#123;this.people.address?.name&#125;  é‚®ç¼–ï¼š$&#123;this.people.address?.zipCode&#125;</code>)<br>åº”ç”¨ä¸ä¼šå´©æºƒï¼Œè¿™ä¸ªå¯¹è±¡ä¹Ÿä¸ä¼šæ¸²æŸ“åœ¨é¡µé¢ä¸Š<br/><br>ä½†æ ¹æ®æ–‡æ¡£æè¿°ï¼Œæ—¢ç„¶ifæ¡ä»¶ä¸æˆç«‹ï¼Œä¸‹é¢çš„Textç»„ä»¶å°±ä¸åº”è¯¥è¢«æ¸²æŸ“ï¼Œä¹Ÿä¸åº”è¯¥è¯»å–addressçš„nameå±æ€§ã€‚åŒæ ·æå·¥å•ï¼Œå›å¤è¯´æ˜¯åŒæ¡†æ¶é—®é¢˜ï¼Œå°†åœ¨HarmonyOS Nextç‰ˆæœ¬è§£å†³</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ–‡æ¡£ä¸Šå†™çš„è¢«çŠ¶æ€ç®¡ç†è£…é¥°å™¨ä¿®é¥°çš„å˜é‡ï¼ŒåŸºæœ¬ä¸Šéƒ½ä¸æ”¯æŒanyã€undefinedã€nullå€¼ï¼Œä½†å®é™…å†™ä»£ç çš„è¿‡ç¨‹ä¸­æ˜¯æ²¡æœ‰æ ¡éªŒçš„ï¼Œç›®å‰æ¥çœ‹å³ä½¿æ˜¯è¿™äº›ç±»å‹æˆ–è€…å€¼ï¼Œä¹Ÿæ˜¯æ²¡ä»€ä¹ˆå¤§é—®é¢˜çš„ï¼Œä½†è¿˜æ˜¯å»ºè®®å¤§å®¶æŒ‰æ–‡æ¡£å†™ï¼Œæœ‰é—®é¢˜å’¨è¯¢ç›¸å…³æŠ€æœ¯äººå‘˜æˆ–è€…è®ºå›ã€æå·¥å•ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>HarmonyOS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaä½¿ç”¨Protocol Bufferä¸æœåŠ¡ç«¯äº¤äº’</title>
    <link href="/2023/05/09/Java%E4%BD%BF%E7%94%A8Protocol-Buffer%E4%B8%8E%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%BA%A4%E4%BA%92/"/>
    <url>/2023/05/09/Java%E4%BD%BF%E7%94%A8Protocol-Buffer%E4%B8%8E%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%BA%A4%E4%BA%92/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘å’Œä¸‰æ–¹å¯¹æ¥æ—¶ï¼Œå¯¹æ–¹ç»™å‡ºçš„æ¥å£æ–‡æ¡£æ˜¯ä½¿ç”¨protol bufferè¿›è¡Œäº¤äº’çš„ï¼Œå¹¶éæ˜¯æˆ‘ä»¬å¸¸è§çš„jsonã€xmlè¿™ç§æ ¼å¼ï¼Œäº†è§£äº†ä¸€ä¸‹è¿™ç§æ ¼å¼æˆ–è€…è¯´äº¤åè®®çš„ç‰¹ç‚¹ã€‚<br>é¦–å…ˆï¼ŒProtocol Bufferåºåˆ—åŒ–ä¹‹åæ˜¯äºŒè¿›åˆ¶æµï¼Œä¸è¿›è¡Œååºåˆ—åŒ–åŸºæœ¬ä¸å¯è¯»ã€‚<br>å…¶æ¬¡ï¼Œåºåˆ—åŒ–ä¹‹åçš„ä½“ç§¯å¾ˆå°ï¼Œé€‚åˆç½‘ç»œä¼ è¾“æˆ–è€…è®¾å¤‡ä¹‹é—´ä¼ è¾“<br>æœ€åï¼Œå¯ä»¥è·¨å¹³å°ã€è·¨è¯­è¨€ä½¿ç”¨<br>ä¸è¿‡è¿™äº›ç‰¹ç‚¹æ—¢æ˜¯ä¼˜ç‚¹ä¹Ÿæ˜¯ç¼ºç‚¹ï¼šåºåˆ—åŒ–ä¹‹åçš„æ•°æ®ä¸å¯è¯»ï¼Œè¿˜åŸåºåˆ—åŒ–ä¹‹åçš„æ•°æ®éœ€è¦äº‹å…ˆå®šä¹‰å¥½çš„æ•°æ®æ ¼å¼</p><span id="more"></span><h4 id="å®‰è£…Protocol-Bufferçš„ç¼–è¯‘å™¨"><a href="#å®‰è£…Protocol-Bufferçš„ç¼–è¯‘å™¨" class="headerlink" title="å®‰è£…Protocol Bufferçš„ç¼–è¯‘å™¨"></a>å®‰è£…Protocol Bufferçš„ç¼–è¯‘å™¨</h4><p>æˆ‘ä»¬éœ€è¦ä½¿ç”¨ç›¸åº”çš„ç¼–è¯‘å™¨å°†<code>.proto</code>æ–‡ä»¶è½¬åŒ–ä¸ºå¯¹åº”çš„ç¼–ç¨‹è¯­è¨€çš„ä»£ç ã€‚<br>ç¼–è¯‘å™¨å¯ä»¥åœ¨è¿™é‡Œä¸‹è½½<a href="https://github.com/protocolbuffers/protobuf">https://github.com/protocolbuffers/protobuf</a><br>è¿™é‡Œæˆ‘ä¸‹è½½çš„ç‰ˆæœ¬æ˜¯22.3ã€‚ä¸‹è½½å®Œæˆåè§£å‹ã€æ·»åŠ ç¯å¢ƒå˜é‡ï¼Œå‘½ä»¤è¡Œæ‰§è¡Œ <code>protoc --version</code>èƒ½å¤Ÿè¾“å‡ºç‰ˆæœ¬å·å°±å¯ä»¥äº†</p><h4 id="ç¼–å†™-protoæ–‡ä»¶"><a href="#ç¼–å†™-protoæ–‡ä»¶" class="headerlink" title="ç¼–å†™ .protoæ–‡ä»¶"></a>ç¼–å†™ .protoæ–‡ä»¶</h4><p>æ–‡ä»¶å†…å®¹åŠæ ¼å¼å¯ä»¥å‚è€ƒè¿™é‡Œ<a href="https://protobuf.dev/">https://protobuf.dev/</a><br>ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs protocol">syntax = &quot;proto2&quot;;<br><br>package tutorial;<br><br>option java_multiple_files = true;<br>option java_package = &quot;com.example.tutorial.protos&quot;;<br>option java_outer_classname = &quot;AddressBookProtos&quot;;<br><br>message Person &#123;<br>  optional string name = 1;<br>  optional int32 id = 2;<br>  optional string email = 3;<br><br>  enum PhoneType &#123;<br>    MOBILE = 0;<br>    HOME = 1;<br>    WORK = 2;<br>  &#125;<br><br>  message PhoneNumber &#123;<br>    optional string number = 1;<br>    optional PhoneType type = 2 [default = HOME];<br>  &#125;<br><br>  repeated PhoneNumber phones = 4;<br>&#125;<br><br>message AddressBook &#123;<br>  repeated Person people = 1;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸Šé¢å®‰è£…å¥½çš„ç¼–è¯‘å·¥å…·å°†æ–‡ä»¶ç¼–è¯‘è½¬åŒ–ä¸ºå¯¹åº”ç¼–ç¨‹è¯­è¨€çš„æ–‡ä»¶ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯java</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><br>protocol --java_out=src/main/java src/main/protobuf/AddressBookProtos.proto<br><br></code></pre></td></tr></table></figure><p><code>src/main/java</code>æ˜¯è¾“å‡ºæ–‡ä»¶çš„ä½ç½®ï¼Œ<code>src/main/protobuf/tgssp.proto</code>æ˜¯æ•°æ®æ ¼å¼æ–‡ä»¶çš„ä½ç½®</p><p>æ²¡æœ‰æŠ¥é”™çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è¾“å‡ºæ–‡ä»¶çš„ä½ç½®çœ‹åˆ°ç”Ÿæˆçš„javaæ–‡ä»¶äº†</p><h4 id="å¦‚ä½•ä½¿ç”¨"><a href="#å¦‚ä½•ä½¿ç”¨" class="headerlink" title="å¦‚ä½•ä½¿ç”¨"></a>å¦‚ä½•ä½¿ç”¨</h4><p>æƒ³è¦ä½¿ç”¨è¯¥æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å·¥ç¨‹ä¸­å¼•å…¥ç›¸åº”çš„ä¾èµ–åº“ï¼Œè¿™é‡Œè¿˜æ˜¯ç”¨javaä¸¾ä¾‹</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">implementation <span class="hljs-attr">group:</span> <span class="hljs-string">&#x27;com.google.protobuf&#x27;</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;protobuf-java&#x27;</span>, <span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.22.3&#x27;</span><br></code></pre></td></tr></table></figure><p>å› ä¸ºä¸Šé¢çš„<code>.proto</code>æ–‡ä»¶ä¸­å®šä¹‰çš„<code>java_multiple_files</code>ä¸ºtrueï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯åˆ†å¼€ç”Ÿæˆçš„æ–‡ä»¶ã€‚<br>ç„¶åæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> Person.newBuilder()<br>        .setEmail(<span class="hljs-string">&quot;123@123.com&quot;</span>)<br>        .setId(<span class="hljs-number">1</span>)<br>        .setName(<span class="hljs-string">&quot;null&quot;</span>)<br>        .build();<br><span class="hljs-type">AddressBook</span> <span class="hljs-variable">addressBook</span> <span class="hljs-operator">=</span> AddressBook.newBuilder()<br>        .addPeople(person)<br>        .build();<br>System.out.println(addressBook);<br></code></pre></td></tr></table></figure><p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†<code>addressBook</code>å¯¹è±¡è°ƒç”¨<code>toByteArray()</code>æ–¹æ³•åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶æ•°æ®æµ;ä¹Ÿå¯ä»¥è°ƒç”¨<code>AddressBook.parseFrom(byte[] bytes)</code>ä»äºŒè¿›åˆ¶æ•°æ®ä¸­ååºåˆ—åŒ–</p><h4 id="ä¸æœåŠ¡å™¨äº¤äº’"><a href="#ä¸æœåŠ¡å™¨äº¤äº’" class="headerlink" title="ä¸æœåŠ¡å™¨äº¤äº’"></a>ä¸æœåŠ¡å™¨äº¤äº’</h4><p>è¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œç›´æ¥ä½¿ç”¨çš„apacheçš„ç½‘ç»œè¯·æ±‚åº“ï¼Œä½¿ç”¨å…¶ä»–åº“åŸç†æ˜¯ä¸€æ ·çš„<br>ä¾èµ–</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs groovy">implementation <span class="hljs-attr">group:</span> <span class="hljs-string">&#x27;org.apache.httpcomponents&#x27;</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;httpcore&#x27;</span>, <span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;4.4.14&#x27;</span><br>implementation <span class="hljs-attr">group:</span> <span class="hljs-string">&#x27;org.apache.httpcomponents&#x27;</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;httpclient&#x27;</span>, <span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;4.5.13&#x27;</span><br></code></pre></td></tr></table></figure><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">HttpPost</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpPost</span>(<span class="hljs-string">&quot;https://a.b.com&quot;</span>);<br>request.setEntity(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayEntity</span>(tgrequest.toByteArray()));<br><span class="hljs-type">CloseableHttpClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> HttpClients.createDefault();<br><span class="hljs-type">CloseableHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.execute(request);<br><span class="hljs-comment">// å¤„ç† HTTP å“åº”</span><br><span class="hljs-type">HttpEntity</span> <span class="hljs-variable">entity</span> <span class="hljs-operator">=</span> response.getEntity();<br><span class="hljs-keyword">if</span> (entity != <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-comment">// å°†å“åº”å®ä½“è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„</span><br>    <span class="hljs-type">byte</span>[] data = toByteArray(entity.getContent());<br>    <span class="hljs-type">AddressBook</span> <span class="hljs-variable">addressBook</span> <span class="hljs-operator">=</span> AddressBook.parseFrom(data);<br>    System.out.println(addressBook);<br>&#125;<br><br><span class="hljs-comment">//è¯»å–å“åº”</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] toByteArray(InputStream in) <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>    <span class="hljs-type">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">4096</span>];<br>    <span class="hljs-type">int</span> len;<br>    <span class="hljs-keyword">while</span> ((len = in.read(buffer)) != -<span class="hljs-number">1</span>) &#123;<br>        out.write(buffer, <span class="hljs-number">0</span>, len);<br>    &#125;<br>    <span class="hljs-keyword">return</span> out.toByteArray();<br>&#125;<br><br></code></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œå°±ç®—æ˜¯å®Œæˆäº†ä¸€æ¬¡ä½¿ç”¨protocol bufferçš„äº¤äº’</p><h4 id="å…¶ä»–æ–¹å¼"><a href="#å…¶ä»–æ–¹å¼" class="headerlink" title="å…¶ä»–æ–¹å¼"></a>å…¶ä»–æ–¹å¼</h4><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>protostuff</code>è¿™ä¸ªåº“ï¼Œä»è€Œä¸å€ŸåŠ©<code>.proto</code>æ–‡ä»¶å°±å¯ä»¥ç›´æ¥å¯¹POJOè¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚<br>è¯¦æƒ…å¯ä»¥æŸ¥çœ‹è¿™ä¸ªä»“åº“ <a href="https://github.com/protostuff/protostuff">https://github.com/protostuff/protostuff</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>flutter_Key</title>
    <link href="/2023/01/23/flutter-Key/"/>
    <url>/2023/01/23/flutter-Key/</url>
    
    <content type="html"><![CDATA[<p>å®˜æ–¹è§†é¢‘åœ¨è¿™é‡Œï¼Œæœ‰æ¡ä»¶çš„å¯ä»¥çœ‹ä¸‹<br><a href="https://www.youtube.com/watch?v=kn0EOS-ZiIc">https://www.youtube.com/watch?v=kn0EOS-ZiIc</a><br>ä¹Ÿå¯ä»¥çœ‹ä¸‹è¿™ä¸ªå¯¹diffç®—æ³•çš„è¯¦è§£<br><a href="https://juejin.cn/post/6935422635194974244">https://juejin.cn/post/6935422635194974244</a><br>ä¸»è¦ä»£ç å¦‚ä¸‹</p><span id="more"></span><p>ä¸€ä¸ªç”¨äºè·å–é¢œè‰²çš„RandomColor</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RandomColor</span> </span>&#123;<br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Random _random = Random();<br><br>  <span class="hljs-keyword">static</span> Color getColor() &#123;<br>    <span class="hljs-keyword">return</span> Color.fromRGBO(<br>      _random.nextInt(<span class="hljs-number">256</span>),<br>      _random.nextInt(<span class="hljs-number">256</span>),<br>      _random.nextInt(<span class="hljs-number">256</span>),<br>      <span class="hljs-number">1</span>,<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªç»§æ‰¿è‡ªStatefulWidgetçš„widgetï¼Œä½¿ç”¨Stateä¿å­˜äº†é¢œè‰²ä¿¡æ¯</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RandomColorBoxStateful</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  RandomColorBoxStateful(&#123;Key? key&#125;) : <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-meta">@override</span><br>  State&lt;RandomColorBoxStateful&gt; createState() =&gt; RandomColorBoxState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RandomColorBoxState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">RandomColorBoxStateful</span>&gt; </span>&#123;<br><br>  <span class="hljs-keyword">late</span> Color myColor;<br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> initState() &#123;<br>    <span class="hljs-keyword">super</span>.initState();<br>    myColor = RandomColor.getColor();<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Text(<span class="hljs-string">&quot;<span class="hljs-subst">$myColor</span>&quot;</span>,style: TextStyle(color: myColor),);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªç»§æ‰¿è‡ªStatelessWidgetçš„widgetï¼Œå†…å®¹å·®ä¸å¤š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RandomColorBoxStateless</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>   RandomColorBoxStateless(&#123;Key? key&#125;) : <span class="hljs-keyword">super</span>(key: key);<br>  Color myColor = RandomColor.getColor();<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>      <span class="hljs-keyword">return</span> Text(<span class="hljs-string">&quot;<span class="hljs-subst">$myColor</span>&quot;</span>,style: TextStyle(color: myColor),););<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªç”¨æ¥æ˜¾ç¤ºç•Œé¢çš„SwapColorBox</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SwapColorBox</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  State&lt;StatefulWidget&gt; createState() =&gt; SwapColorBoxState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SwapColorBoxState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">SwapColorBox</span>&gt; </span>&#123;<br>  <span class="hljs-built_in">List</span>&lt;Widget&gt; tiles = [ RandomColorBoxStateful(), RandomColorBoxStateful() ];<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      body: SafeArea(child: Column(children: tiles)),<br>      floatingActionButton: FloatingActionButton(<br>        child: Icon(Icons.sentiment_very_satisfied),<br>        onPressed: swapTiles,<br>      ),<br>    );<br>  &#125;<br><br>  <span class="hljs-keyword">void</span> swapTiles() &#123;<br>    setState(() &#123;<br>      <span class="hljs-built_in">List</span>&lt;Widget&gt; tmp = [tiles[<span class="hljs-number">1</span>],tiles[<span class="hljs-number">0</span>]];<br>      tiles = tmp;<br>    &#125;);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ—¶ç‚¹å‡»floatingActionButtonä¼šå‘ç°é¡µé¢æ²¡æœ‰å˜åŒ–ã€‚</p><h3 id="å¦‚ä½•ä¿®æ”¹"><a href="#å¦‚ä½•ä¿®æ”¹" class="headerlink" title="å¦‚ä½•ä¿®æ”¹"></a>å¦‚ä½•ä¿®æ”¹</h3><p>å¥½å‡ ç§åŠæ³•</p><ul><li>å°†SwapColorBoxStateä¸­çš„tilesæ”¹ä¸º List<Widget> tiles &#x3D; [ RandomColorBoxStateless(), RandomColorBoxStateless() ]</li><li>å°†SwapColorBoxStateä¸­çš„tilesä¸­RandomColorBoxStatefulåŠ ä¸ŠUniqueKey: List<Widget> tiles &#x3D; [ RandomColorBoxStateful(key: UniqueKey(),), RandomColorBoxStateful(key: UniqueKey(),) ];</li><li>å°†RandomColorBoxStatefulä¸­çš„myColoræ”¾åœ¨RandomColorBoxStatefulä¸­è€Œä¸æ˜¯RandomColorBoxStateä¸­</li></ul><h3 id="ä¸ºä»€ä¹ˆ"><a href="#ä¸ºä»€ä¹ˆ" class="headerlink" title="ä¸ºä»€ä¹ˆ"></a>ä¸ºä»€ä¹ˆ</h3><p>å…ƒç´ æ ‘æ²¡æœ‰äº¤æ¢ï¼Œè™½ç„¶æˆ‘ä»¬äº¤æ¢äº†Widgetï¼Œä½†æ˜¯å…¶Elementå¹¶æ²¡æœ‰äº¤æ¢ï¼Œè€Œé¢œè‰²çŠ¶æ€åˆæ˜¯ç”±Stateç»´æŠ¤ï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œbuildçš„æ—¶å€™é¢œè‰²å¹¶æ²¡æœ‰å˜åŒ–ã€‚<br>å…ˆçœ‹ä¸‹æ›´æ–°çš„ä»£ç </p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">Element</span>&gt; updateChildren(<span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">Element</span>&gt; oldChildren, <span class="hljs-built_in">List</span>&lt;Widget&gt; newWidgets, &#123; <span class="hljs-built_in">Set</span>&lt;<span class="hljs-built_in">Element</span>&gt;? forgottenChildren, <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">Object?</span>&gt;? slots &#125;) &#123;<br><br><br>  <span class="hljs-built_in">Element?</span> replaceWithNullIfForgotten(<span class="hljs-built_in">Element</span> child) &#123;<br>    <span class="hljs-keyword">return</span> forgottenChildren != <span class="hljs-keyword">null</span> &amp;&amp; forgottenChildren.contains(child) ? <span class="hljs-keyword">null</span> : child;<br>  &#125;<br><br>  <span class="hljs-built_in">Object?</span> slotFor(<span class="hljs-built_in">int</span> newChildIndex, <span class="hljs-built_in">Element?</span> previousChild) &#123;<br>    <span class="hljs-keyword">return</span> slots != <span class="hljs-keyword">null</span><br>      ? slots[newChildIndex]<br>      : IndexedSlot&lt;<span class="hljs-built_in">Element?</span>&gt;(newChildIndex, previousChild);<br>  &#125;<br><br><br>  <span class="hljs-built_in">int</span> newChildrenTop = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">int</span> oldChildrenTop = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">int</span> newChildrenBottom = newWidgets.length - <span class="hljs-number">1</span>;<br>  <span class="hljs-built_in">int</span> oldChildrenBottom = oldChildren.length - <span class="hljs-number">1</span>;<br><br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">Element</span>&gt; newChildren = oldChildren.length == newWidgets.length ?<br>      oldChildren : <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">Element</span>&gt;.filled(newWidgets.length, _NullElement.instance);<br><br>  <span class="hljs-built_in">Element?</span> previousChild;<br><br>  <span class="hljs-comment">// Update the top of the list.</span><br>  <span class="hljs-keyword">while</span> ((oldChildrenTop &lt;= oldChildrenBottom) &amp;&amp; (newChildrenTop &lt;= newChildrenBottom)) &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">Element?</span> oldChild = replaceWithNullIfForgotten(oldChildren[oldChildrenTop]);<br>    <span class="hljs-keyword">final</span> Widget newWidget = newWidgets[newChildrenTop];<br>   <br>    <span class="hljs-keyword">if</span> (oldChild == <span class="hljs-keyword">null</span> || !Widget.canUpdate(oldChild.widget, newWidget))<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">Element</span> newChild = updateChild(oldChild, newWidget, slotFor(newChildrenTop, previousChild))!;<br>    <br>    newChildren[newChildrenTop] = newChild;<br>    previousChild = newChild;<br>    newChildrenTop += <span class="hljs-number">1</span>;<br>    oldChildrenTop += <span class="hljs-number">1</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// Scan the bottom of the list.</span><br>  <span class="hljs-keyword">while</span> ((oldChildrenTop &lt;= oldChildrenBottom) &amp;&amp; (newChildrenTop &lt;= newChildrenBottom)) &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">Element?</span> oldChild = replaceWithNullIfForgotten(oldChildren[oldChildrenBottom]);<br>    <span class="hljs-keyword">final</span> Widget newWidget = newWidgets[newChildrenBottom];<br>    <br>    <span class="hljs-keyword">if</span> (oldChild == <span class="hljs-keyword">null</span> || !Widget.canUpdate(oldChild.widget, newWidget))<br>      <span class="hljs-keyword">break</span>;<br>    oldChildrenBottom -= <span class="hljs-number">1</span>;<br>    newChildrenBottom -= <span class="hljs-number">1</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// Scan the old children in the middle of the list.</span><br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> haveOldChildren = oldChildrenTop &lt;= oldChildrenBottom;<br>  <span class="hljs-built_in">Map</span>&lt;Key, <span class="hljs-built_in">Element</span>&gt;? oldKeyedChildren;<br>  <span class="hljs-keyword">if</span> (haveOldChildren) &#123;<br>    oldKeyedChildren = &lt;Key, <span class="hljs-built_in">Element</span>&gt;&#123;&#125;;<br>    <span class="hljs-keyword">while</span> (oldChildrenTop &lt;= oldChildrenBottom) &#123;<br>      <span class="hljs-keyword">final</span> <span class="hljs-built_in">Element?</span> oldChild = replaceWithNullIfForgotten(oldChildren[oldChildrenTop]);<br>     <br>      <span class="hljs-keyword">if</span> (oldChild != <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-keyword">if</span> (oldChild.widget.key != <span class="hljs-keyword">null</span>)<br>          oldKeyedChildren[oldChild.widget.key!] = oldChild;<br>        <span class="hljs-keyword">else</span><br>          deactivateChild(oldChild);<br>      &#125;<br>      oldChildrenTop += <span class="hljs-number">1</span>;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-comment">// Update the middle of the list.</span><br>  <span class="hljs-keyword">while</span> (newChildrenTop &lt;= newChildrenBottom) &#123;<br>    <span class="hljs-built_in">Element?</span> oldChild;<br>    <span class="hljs-keyword">final</span> Widget newWidget = newWidgets[newChildrenTop];<br>    <span class="hljs-keyword">if</span> (haveOldChildren) &#123;<br>      <span class="hljs-keyword">final</span> Key? key = newWidget.key;<br>      <span class="hljs-keyword">if</span> (key != <span class="hljs-keyword">null</span>) &#123;<br>        oldChild = oldKeyedChildren![key];<br>        <span class="hljs-keyword">if</span> (oldChild != <span class="hljs-keyword">null</span>) &#123;<br>          <span class="hljs-keyword">if</span> (Widget.canUpdate(oldChild.widget, newWidget)) &#123;<br>            <span class="hljs-comment">// we found a match!</span><br>            <span class="hljs-comment">// remove it from oldKeyedChildren so we don&#x27;t unsync it later</span><br>            oldKeyedChildren.remove(key);<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// Not a match, let&#x27;s pretend we didn&#x27;t see it for now.</span><br>            oldChild = <span class="hljs-keyword">null</span>;<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>   <br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">Element</span> newChild = updateChild(oldChild, newWidget, slotFor(newChildrenTop, previousChild))!;<br>   <br>    newChildren[newChildrenTop] = newChild;<br>    previousChild = newChild;<br>    newChildrenTop += <span class="hljs-number">1</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// We&#x27;ve scanned the whole list.</span><br>  <br>  newChildrenBottom = newWidgets.length - <span class="hljs-number">1</span>;<br>  oldChildrenBottom = oldChildren.length - <span class="hljs-number">1</span>;<br><br>  <span class="hljs-comment">// Update the bottom of the list.</span><br>  <span class="hljs-keyword">while</span> ((oldChildrenTop &lt;= oldChildrenBottom) &amp;&amp; (newChildrenTop &lt;= newChildrenBottom)) &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">Element</span> oldChild = oldChildren[oldChildrenTop];<br>   <br>    <span class="hljs-keyword">final</span> Widget newWidget = newWidgets[newChildrenTop];<br>   <br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">Element</span> newChild = updateChild(oldChild, newWidget, slotFor(newChildrenTop, previousChild))!;<br>   <br>    newChildren[newChildrenTop] = newChild;<br>    previousChild = newChild;<br>    newChildrenTop += <span class="hljs-number">1</span>;<br>    oldChildrenTop += <span class="hljs-number">1</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// Clean up any of the remaining middle nodes from the old list.</span><br>  <span class="hljs-keyword">if</span> (haveOldChildren &amp;&amp; oldKeyedChildren!.isNotEmpty) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> <span class="hljs-built_in">Element</span> oldChild <span class="hljs-keyword">in</span> oldKeyedChildren.values) &#123;<br>      <span class="hljs-keyword">if</span> (forgottenChildren == <span class="hljs-keyword">null</span> || !forgottenChildren.contains(oldChild))<br>        deactivateChild(oldChild);<br>    &#125;<br>  &#125;<br> <br>  <span class="hljs-keyword">return</span> newChildren;<br>&#125;<br></code></pre></td></tr></table></figure><p>å‰ç½®æ¡ä»¶ï¼š</p><h4 id="Widget-canUpdate"><a href="#Widget-canUpdate" class="headerlink" title="Widget.canUpdate()"></a>Widget.canUpdate()</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> canUpdate(Widget oldWidget, Widget newWidget) &#123;<br>  <span class="hljs-keyword">return</span> oldWidget.runtimeType == newWidget.runtimeType<br>      &amp;&amp; oldWidget.key == newWidget.key;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¯”è¾ƒä¸¤ä¸ªWidgetçš„runtimeTypeå’Œkeyæ˜¯å¦ç›¸åŒ</p><h4 id="Element-update"><a href="#Element-update" class="headerlink" title="Element.update()"></a>Element.update()</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> update(<span class="hljs-keyword">covariant</span> Widget newWidget) &#123;<br>   _widget = newWidget;<br>&#125;<br></code></pre></td></tr></table></figure><p>åªæ˜¯ç®€å•çš„æ›¿æ¢æ‰€æŒæœ‰Widgetï¼Œå¹¶æ²¡æœ‰æ›´æ–°è‡ªå·±çš„å…¶ä»–å±æ€§</p><h3 id="æ›´æ–°ç®—æ³•"><a href="#æ›´æ–°ç®—æ³•" class="headerlink" title="æ›´æ–°ç®—æ³•"></a>æ›´æ–°ç®—æ³•</h3><p>framworkä¸­å°†èŠ‚ç‚¹åˆ—è¡¨åˆ†æˆäº†ä¸‰éƒ¨åˆ†ï¼šé¡¶éƒ¨ã€ä¸­é—´éƒ¨åˆ†ã€åº•éƒ¨ï¼Œå½“å‘ç”Ÿæ›´æ–°æ—¶ï¼Œå°½æœ€å¤§å¯èƒ½çš„å¤ç”¨Elementï¼Œæ— æ³•å¤ç”¨çš„æ‰ä¼šå»åˆ›å»ºæ–°çš„Element</p><ol><li>é¦–å…ˆè‡ªé¡¶å‘ä¸‹çš„è¿›è¡Œdiffå¹¶æ›´æ–°å­èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªwhileå¾ªç¯ï¼Œæ˜¯å¦èƒ½å¤ç”¨å°±æ˜¯è°ƒç”¨çš„canUpdate</li><li>ç„¶åè‡ªåº•å‘ä¸Šçš„è¿›è¡Œdiff(è¿™é‡Œæ²¡æœ‰æ›´æ–°å­èŠ‚ç‚¹)ï¼Œä¹Ÿå°±æ˜¯ç¬¬äºŒä¸ªwhileå¾ªç¯ï¼Œä¾ç„¶æ˜¯ç”¨canUpdateçœ‹åˆ¤æ–­æ˜¯å¦å¯ä»¥å¤ç”¨</li><li>ç„¶ååœ¨è¿™ä¸¤ä¸ªä¸­é—´çš„éƒ¨åˆ†å¯»æ‰¾å¯ä»¥å¤ç”¨çš„Elementï¼Œå¹¶è¿›è¡Œå­˜å‚¨</li><li>è¿™æ—¶å€™å°±å·²ç»æ‰«æå®Œæ•´æ£µæ ‘äº†ï¼Œæ¥ä¸‹æ¥æ›´æ–°ä¸­é—´éƒ¨åˆ†</li><li>æœ€åæ›´æ–°åº•éƒ¨</li></ol><p>ä¸ºä»€ä¹ˆåœ¨è‡ªåº•å‘ä¸Šçš„è¿›è¡Œdiffæ—¶å€™æ²¡æœ‰æ›´æ–°ï¼šå› ä¸ºè¿™æ—¶å€™æ‹¿ä¸åˆ°Slotä¿¡æ¯<br>å›åˆ°æˆ‘ä»¬ä¸Šé¢æåˆ°çš„ä¾‹å­ä¸­ç‚¹å‡»æŒ‰é’®æ—¶ä¼šè§¦å‘<code>Column</code>çš„æ›´æ–°ï¼Œä¹Ÿå°±æ˜¯<code>MultiChildRenderObjectElement</code>çš„æ›´æ–°ï¼Œå°±ä¼šè§¦å‘ä¸Šé¢çš„<code>updateChildren()</code>æ–¹æ³•<br>æ‰€ä»¥åœ¨è‡ªé¡¶å‘ä¸‹çš„æ›´æ–°ä¸­ï¼Œ<code>canUpdate()</code>è¿”å›çš„æ˜¯<code>true</code>(å½“æˆ‘ä»¬è®¾ç½®äº†Keyä¹‹åï¼Œè¿™é‡Œä¼šè¿”å›falseï¼Œä¸è¿›è¡Œå¤ç”¨)ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å¤ç”¨<code>element</code>ï¼Œæ¥ç€æ‰§è¡Œäº†<code>updateChild(Element? child, Widget? newWidget, Object? newSlot)</code><br>è¿™é‡Œçš„<code>child</code>æ˜¯<em>æ—§element</em>ï¼Œ<code>newWidget</code>ä¹Ÿå°±æ˜¯è¦æ˜¾ç¤ºçš„<em>widget</em>ï¼Œä¸¤è€…å¹¶ä¸ç›¸ç­‰ï¼Œæ‰€ä»¥å°±æ‰§è¡Œäº†<code>child.update(newWidget);</code>åªæ˜¯ç®€å•çš„å¯¹æ‰€æŒæœ‰çš„<code>widget</code>è¿›è¡Œäº†èµ‹å€¼ã€‚æˆ‘ä»¬çŸ¥é“<code>StatefullWidget</code>ä¸­<code>State</code>å’Œ<code>StatefulElement</code>äº’ç›¸æŒæœ‰ï¼Œå¹¶ä¸”ä¸¤è€…éƒ½æŒæœ‰<code>StatefulWidget</code>ã€‚æ‰€ä»¥<code>State</code>å¹¶æ²¡æœ‰è¢«æ›´æ–°ï¼Œæ‰€æŒæœ‰çš„é¢œè‰²å€¼è¿˜æ˜¯äº¤æ¢ä¹‹å‰çš„é¢œè‰²å€¼ï¼Œæ‰€ä»¥ç‚¹å‡»äº¤æ¢æŒ‰é’®åï¼Œ<code>Widget</code>è™½ç„¶äº¤æ¢äº†ä½ç½®ï¼Œä½†æ˜¯<code>Element</code>å¹¶æ²¡æœ‰æ›´æ–°ã€‚<br>æœ‰ç‚¹åƒæ˜¯Aæœºå™¨ç”Ÿäº§Aç‰©å“ï¼ŒBæœºå™¨ç”Ÿäº§Bç‰©å“ï¼›åŸæ¥æ“ä½œæœºå™¨Açš„å»æ“ä½œæœºå™¨Bï¼ŒåŸæ¥æ“ä½œæœºå™¨Bçš„å»æ“ä½œæœºå™¨Aï¼Œè™½ç„¶æ¢äº†æ“ä½œå‘˜ï¼Œä½†ç”Ÿäº§Açš„æœºå™¨è¿˜æ˜¯ç”Ÿäº§Aï¼Œç”Ÿäº§Bçš„æœºå™¨è¿˜æ˜¯ç”Ÿäº§Bã€‚</p><h3 id="key"><a href="#key" class="headerlink" title="key"></a>key</h3><p>è¿™é‡Œçš„keyå°±ä¸¤ä¸ªåˆ†æ”¯<code>LocalKey</code> å’Œ<code>GlobalKey</code> ã€‚æˆ‘ä»¬çŸ¥é“<em>key</em>çš„ä½œç”¨å°±æ˜¯ä¸º<code>Widget</code>ç¡®è®¤å”¯ä¸€çš„èº«ä»½ï¼Œå¯ä»¥åœ¨å¤šå­ç»„ä»¶æ›´æ–°ä¸­è¢«è¯†åˆ«ï¼Œè¿™å°±æ˜¯<code>LocalKey</code>çš„ä½œç”¨ã€‚æ‰€ä»¥<code>LocalKey</code>ä¿è¯çš„æ˜¯ <strong>ç›¸åŒçˆ¶çº§</strong>ç»„ä»¶çš„èº«ä»½å”¯ä¸€æ€§ã€‚è€Œ <code>GlobalKey</code> æ˜¯æ•´ä¸ªåº”ç”¨ä¸­ï¼Œç»„ä»¶çš„èº«ä»½å”¯ä¸€ã€‚</p><p><code>LocalKey</code>ä¸‹é¢æœ‰<code>UniqueKey</code>ã€<code>ValueKey&lt;T&gt;</code>ã€<code>ObjectKey</code>,åŒºåˆ«ä¹Ÿå¾ˆç®€å•ï¼Œæˆ³è¿›å»çœ‹ä¸‹æºç å°±å¥½äº†</p><h4 id="Globalkey"><a href="#Globalkey" class="headerlink" title="Globalkey"></a>Globalkey</h4><p>å¯¹äº<code>GlobalKey</code>æ¥è®²ï¼Œåªè¦è·å–åˆ°äº†<code>Element</code>ï¼Œå°±èƒ½è·å–åˆ°<code>Widget</code>å¯¹è±¡ã€‚åªè¦<code>Element</code>æ˜¯<code>StatefulElement</code>ï¼Œå°±èƒ½è·å–åˆ°<code>State</code>.<br>é‚£ä¹ˆå¦‚ä½•è·å–åˆ°Elementå‘¢ï¼Ÿ</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-built_in">Element?</span> <span class="hljs-keyword">get</span> _currentElement =&gt; WidgetsBinding.instance.buildOwner!._globalKeyRegistry[<span class="hljs-keyword">this</span>];<br><br><span class="hljs-comment">///<span class="language-markdown">BuildOwner</span></span><br><span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;GlobalKey, <span class="hljs-built_in">Element</span>&gt; _globalKeyRegistry = &lt;GlobalKey, <span class="hljs-built_in">Element</span>&gt;&#123;&#125;;<br><span class="hljs-keyword">void</span> _registerGlobalKey(GlobalKey key, <span class="hljs-built_in">Element</span> element) &#123;<br>  _globalKeyRegistry[key] = element;<br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨_registerGlobalKeyæ³¨å†Œçš„å‘¢ï¼Ÿå‰é¢æåˆ°çš„mountæ–¹æ³•ä¸­</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">if</span> (key <span class="hljs-keyword">is</span> GlobalKey) &#123;<br>  owner!._registerGlobalKey(key, <span class="hljs-keyword">this</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° å°±æ˜¯åœ¨è¿™é‡Œæ³¨å†Œçš„ã€‚<br>å¹¶ä¸”ä¼šåœ¨unmountä¸­è¿›è¡Œåæ³¨å†Œ</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> Key? key = _widget?.key;<br><span class="hljs-keyword">if</span> (key <span class="hljs-keyword">is</span> GlobalKey) &#123;<br>  owner!._unregisterGlobalKey(key, <span class="hljs-keyword">this</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>æºç ä¸­ä¹Ÿå¯¹<code>GlobalKey</code>çš„ä½¿ç”¨åœºæ™¯åšå‡ºäº†ä»‹ç»ï¼Œå½“ä½ çœŸçš„éœ€è¦è·å–æŸä¸ª<code>BuildContext</code>æˆ–<code>State</code>æ—¶ï¼Œç”¨<code>GlobalKey</code>æ˜¯å®Œå…¨æ²¡æœ‰é—®é¢˜çš„ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>flutter_StatefulWidget</title>
    <link href="/2023/01/18/flutter-StatefulWidget/"/>
    <url>/2023/01/18/flutter-StatefulWidget/</url>
    
    <content type="html"><![CDATA[<h3 id="createState-æ˜¯ä½•æ—¶è¢«è°ƒç”¨çš„ï¼Ÿ"><a href="#createState-æ˜¯ä½•æ—¶è¢«è°ƒç”¨çš„ï¼Ÿ" class="headerlink" title="createState()æ˜¯ä½•æ—¶è¢«è°ƒç”¨çš„ï¼Ÿ"></a>createState()æ˜¯ä½•æ—¶è¢«è°ƒç”¨çš„ï¼Ÿ</h3><p>æ–­ç‚¹æŸ¥çœ‹è°ƒç”¨æ ˆï¼Œå‘ç°æ˜¯åœ¨<code>StatefulElement</code>çš„æ„é€ æ–¹æ³•ä¸­åˆ›å»ºçš„,è€Œ<code>element</code>çš„åˆ›å»ºåˆ™æ˜¯åœ¨çˆ¶å…ƒç´ è°ƒç”¨<code>inflateWidget</code>æ—¶è§¦å‘å­å…ƒç´ çš„<code>createElement</code>æ–¹æ³•åˆ›å»ºçš„</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dart">StatefulElement(StatefulWidget widget)<br>    : _state = widget.createState(),<br>      <span class="hljs-keyword">super</span>(widget) &#123;<br>  state._element = <span class="hljs-keyword">this</span>;<br>  state._widget = widget;<br>&#125;<br></code></pre></td></tr></table></figure><p>å»æ‰æ–­è¨€ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ„é€ æ–¹æ³•ä¸­è°ƒç”¨äº†<code>createState()</code>æ¥åˆ›å»º<code>State</code>å¯¹è±¡ï¼Œæ¥ç€å¯¹<code>_state</code>å¯¹è±¡çš„<code>_element</code>å’Œ<code>_widget</code>æˆå‘˜è¿›è¡Œèµ‹å€¼ã€‚<br>åˆ°è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ¸…æ¥šçš„çŸ¥é“:<code>State</code>å’Œ<code>StatefulElement</code>äº’ç›¸æŒæœ‰ï¼Œå¹¶ä¸”ä¸¤è€…éƒ½æŒæœ‰<code>StatefulWidget</code>ã€‚</p><h3 id="Stateç±»ä¸­çš„æ–¹æ³•"><a href="#Stateç±»ä¸­çš„æ–¹æ³•" class="headerlink" title="Stateç±»ä¸­çš„æ–¹æ³•"></a>Stateç±»ä¸­çš„æ–¹æ³•</h3><p>è¿™é‡Œé¢å®šä¹‰äº†ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</p><ul><li>initState()</li><li>didUpdateWidget(covariant T oldWidget)</li><li>void reassemble()</li><li>void deactivate()</li><li>void activate()</li><li>void dispose()</li><li>Widget build(BuildContext context)</li><li>void didChangeDependencies()</li></ul><p>å…¶å®çœ‹ä¸€ä¸‹è¿™äº›æ–¹æ³•ä¸Šé¢çš„æ³¨é‡ŠåŸºæœ¬ä¸Šå°±èƒ½ç†è§£çš„å·®ä¸å¤šï¼Œæ–­ç‚¹èµ°ä¸€éæµç¨‹ï¼Œä¹Ÿå°±éƒ½äº†è§£äº†</p><h3 id="å›è°ƒæ—¶æœº"><a href="#å›è°ƒæ—¶æœº" class="headerlink" title="å›è°ƒæ—¶æœº"></a>å›è°ƒæ—¶æœº</h3><p><code>StatefulElement</code>ç»§æ‰¿è‡ª<code>ComponentElement</code>ç±»ï¼Œè¯¥ç±»åœ¨<code>mount()</code>æ—¶è°ƒç”¨çš„äº†<code>_firstBuild()</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è¢«<code>StatefulElement</code>è¦†å†™ï¼Œå¯ä»¥çœ‹åˆ°åœ¨è¿™é‡Œé‡Œé¢è°ƒç”¨äº†<code>state.initState()</code>æ–¹æ³•</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@override</span><br><span class="hljs-keyword">void</span> _firstBuild() &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    _debugSetAllowIgnoredCallsToMarkNeedsBuild(<span class="hljs-keyword">true</span>);<br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">Object?</span> debugCheckForReturnedFuture = state.initState() <span class="hljs-keyword">as</span> <span class="hljs-built_in">dynamic</span>;<br>  &#125; <span class="hljs-keyword">finally</span> &#123;<br>    _debugSetAllowIgnoredCallsToMarkNeedsBuild(<span class="hljs-keyword">false</span>);<br>  &#125;<br>  state.didChangeDependencies();<br>  <span class="hljs-keyword">super</span>._firstBuild();<br>&#125;<br></code></pre></td></tr></table></figure><p>ç´§ç€è¿™å°±è°ƒç”¨äº†<code>state.didChangeDependencies()</code>æ–¹æ³•,æœ€åè°ƒç”¨äº†<code>super._firstBuild()</code>;<br>è¿˜æ˜¯åœ¨<code>ComponentElement</code>ç±»ä¸­çš„<code>_firstBuild()</code>æ–¹æ³•ä¸­è°ƒç”¨äº†<code>rebuild()--&gt;performRebuild</code>,è¿™é‡Œ<code>performRebuild()</code>åœ¨<code>StatefulElement</code>æœ‰è¢«é‡å†™</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@override</span><br><span class="hljs-keyword">void</span> performRebuild() &#123;<br>  <span class="hljs-keyword">if</span> (_didChangeDependencies) &#123;<br>    state.didChangeDependencies();<br>    _didChangeDependencies = <span class="hljs-keyword">false</span>;<br>  &#125;<br>  <span class="hljs-keyword">super</span>.performRebuild();<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>_didChangeDependencies</code>é»˜è®¤ä¸º<code>false</code>ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡è¿›æ¥å¹¶ä¸ä¼šè§¦å‘<code>state.didChangeDependencies()</code>æ–¹æ³•;æ¥ä¸‹æ¥æ‰§è¡Œäº†<code>super.performRebuild()</code>;<br>åŒæ ·çš„åœ¨<code>ComponentElement</code>ç±»ä¸­çš„<code>performRebuild()</code>æ–¹æ³•ä¸­è°ƒç”¨äº†<code>build()</code>æ–¹æ³•,å½“ç„¶è¿™é‡Œçš„<code>build</code>æ–¹æ³•å·²ç»è¢«å­ç±»<code>StatefulElement</code>é‡å†™ï¼Œè°ƒç”¨äº†<code>state.build(this)</code>æ–¹æ³•ï¼Œç„¶åè°ƒç”¨äº†<code>updateChild()</code>æ–¹æ³•</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> performRebuild() &#123;<br>  <span class="hljs-keyword">assert</span>(_debugSetAllowIgnoredCallsToMarkNeedsBuild(<span class="hljs-keyword">true</span>));<br>  Widget? built;<br>  <span class="hljs-keyword">try</span> &#123;<br>    built = build();<br>    debugWidgetBuilderValue(widget, built);<br>  &#125; <span class="hljs-keyword">catch</span> (e, stack) &#123;<br>    _debugDoingBuild = <span class="hljs-keyword">false</span>;<br>    built = ErrorWidget.builder(...);<br>  &#125; <span class="hljs-keyword">finally</span> &#123;<br>     _dirty = <span class="hljs-keyword">false</span>;<br>    <br>  &#125;<br>  <span class="hljs-keyword">try</span> &#123;<br>    _child = updateChild(_child, built, slot);<br>    <br>  &#125; <span class="hljs-keyword">catch</span> (e, stack) &#123;<br>    built = ErrorWidget.builder();<br>    _child = updateChild(<span class="hljs-keyword">null</span>, built, slot);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ¥ä¸Šäº†æ§ä»¶æ˜¯å¦‚ä½•è¿›è¡ŒæŒ‚è½½çš„</p><h3 id="å¦‚ä½•æ›´æ–°"><a href="#å¦‚ä½•æ›´æ–°" class="headerlink" title="å¦‚ä½•æ›´æ–°"></a>å¦‚ä½•æ›´æ–°</h3><p>æˆ‘ä»¬çŸ¥é“åœ¨<code>StatefulWidget</code>ä¸­å¯ä»¥ä½¿ç”¨<code>setState()</code>æ¥æ›´æ–°é¡µé¢å†…å®¹ï¼Œé‚£ä¹ˆè¡¨ç¤ºçŠ¶æ€çš„å±æ€§æ˜¯åœ¨ä»€ä¹ˆæ—¶æœºèµ‹å€¼ï¼Œè¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">_color = Colors.red;<br>setState(()&#123;<br>&#125;);<br></code></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">setStaate(()&#123;<br>  _color = Colors.red;<br>&#125;);<br></code></pre></td></tr></table></figure><p>æˆ³è¿›å»çœ‹æºç </p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> setState(VoidCallback fn) &#123;<br>  <span class="hljs-keyword">assert</span>(fn != <span class="hljs-keyword">null</span>);<br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Object?</span> result = fn() <span class="hljs-keyword">as</span> <span class="hljs-built_in">dynamic</span>;<br>  <span class="hljs-keyword">assert</span>(() &#123;<br>    <span class="hljs-keyword">if</span> (result <span class="hljs-keyword">is</span> Future) &#123;<br>      <span class="hljs-keyword">throw</span> FlutterError.fromParts(&lt;DiagnosticsNode&gt;[<br>        ErrorSummary(<span class="hljs-string">&#x27;setState() callback argument returned a Future.&#x27;</span>),<br>        ErrorDescription(<br>          <span class="hljs-string">&#x27;The setState() method on <span class="hljs-subst">$this</span> was called with a closure or method that &#x27;</span><br>          <span class="hljs-string">&#x27;returned a Future. Maybe it is marked as &quot;async&quot;.&#x27;</span>,<br>        ),<br>        ErrorHint(<br>          <span class="hljs-string">&#x27;Instead of performing asynchronous work inside a call to setState(), first &#x27;</span><br>          <span class="hljs-string">&#x27;execute the work (without updating the widget state), and then synchronously &#x27;</span><br>          <span class="hljs-string">&#x27;update the state inside a call to setState().&#x27;</span>,<br>        ),<br>      ]);<br>    &#125;<br>    <span class="hljs-comment">// We ignore other types of return values so that you can do things like:</span><br>    <span class="hljs-comment">//   setState(() =&gt; x = 3);</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>  &#125;());<br>  _element!.markNeedsBuild();<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸€å¨æ–­è¨€ï¼Œåˆ¤æ–­<code>callback</code>æ˜¯ä¸æ˜¯ç©ºï¼Œ<code>callback</code>çš„è¿”å›å€¼æ˜¯ä¸æ˜¯<code>Future</code>ç±»å‹;ç„¶åè°ƒç”¨<code>_element!.markNeedsBuild()</code>ã€‚æ‰€ä»¥å°±è¿™æ®µä»£ç æ¥çœ‹ï¼Œä¸Šé¢ä¸¤ç§å†™æ³•éƒ½å¯ä»¥ï¼Œä½†è¿˜æ˜¯å»ºè®®å‘æºç çœ‹é½ï¼šçŠ¶æ€å±æ€§çš„æ”¹å˜å†™åœ¨<code>callback</code>ä¸­ï¼Œç¡®ä¿åœ¨<code>markNeedsBuild()</code>ä¹‹å‰ï¼ŒçŠ¶æ€å€¼æ˜¯è‡ªå·±æœŸæœ›çš„ç»“æœï¼›</p><h3 id="æ›´æ–°"><a href="#æ›´æ–°" class="headerlink" title="æ›´æ–°"></a>æ›´æ–°</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> markNeedsBuild() &#123;<br>  <span class="hljs-keyword">if</span> (_lifecycleState != _ElementLifecycle.active)<br>    <span class="hljs-keyword">return</span>;<br>  <span class="hljs-keyword">if</span> (dirty)<br>    <span class="hljs-keyword">return</span>;<br>  _dirty = <span class="hljs-keyword">true</span>;<br>  owner!.scheduleBuildFor(<span class="hljs-keyword">this</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœå½“å‰çŠ¶æ€ä¸æ˜¯activeåˆ™ä¸æ ‡è®°ï¼Œå¦‚æœå·²ç»æ ‡è®°è¿‡ä¹Ÿä¸åœ¨æ ‡è®°ï¼›</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">/// <span class="language-markdown">Adds an element to the dirty elements list so that it will be rebuilt</span></span><br><span class="hljs-comment">/// <span class="language-markdown">when [WidgetsBinding.drawFrame] calls [buildScope].</span></span><br><span class="hljs-keyword">void</span> scheduleBuildFor(<span class="hljs-built_in">Element</span> element) &#123;<br><br>  <span class="hljs-keyword">if</span> (element._inDirtyList) &#123;<br>    _dirtyElementsNeedsResorting = <span class="hljs-keyword">true</span>;<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (!_scheduledFlushDirtyElements &amp;&amp; onBuildScheduled != <span class="hljs-keyword">null</span>) &#123;<br>    _scheduledFlushDirtyElements = <span class="hljs-keyword">true</span>;<br>    onBuildScheduled!();<br>  &#125;<br>  _dirtyElements.add(element);<br>  element._inDirtyList = <span class="hljs-keyword">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¹Ÿæ˜¯è¿›è¡Œäº†äºŒæ¬¡åˆ¤æ–­ï¼Œä¿è¯ä¸ä¼šè¢«å¤šæ¬¡é‡ç»˜ã€‚æ³¨æ„<code>onBuildScheduled()</code>çš„è°ƒç”¨ï¼Œå®ƒçš„å®šä¹‰æ˜¯<code>VoidCallback? onBuildScheduled</code>;å¹¶ä¸”æ˜¯åœ¨<code>BuildOwner</code>ç±»ä¸­çš„æ„é€ æ–¹æ³•ä¸­åˆå§‹åŒ–çš„ï¼Œé‚£ä¹ˆè¿™ä¸ª<code>onBuildScheduled</code>åˆ°åº•æ˜¯ä»€ä¹ˆæ–¹æ³•?æ–­ç‚¹çœ‹ä¸€ä¸‹æ˜¯<code>WidgetsBinding#_handleBuildScheduled</code>è¿™ä¸ªæ–¹æ³•ã€‚å®ƒæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™è¢«èµ‹å€¼çš„ï¼Ÿ<code>owner</code>æ˜¯<code>element</code>å¯¹è±¡ä¸­çš„ä¸€ä¸ªæˆå‘˜å˜é‡<code>_owner</code>,æœä¸€ä¸‹çœ‹ä¸€çœ‹åˆ°æ˜¯åœ¨<code>mount()</code>æ–¹æ³•ä¸­èµ‹å€¼çš„ï¼Œå€¼ä¸º<code>parent.owner</code>ã€‚è¿˜è®°çš„ä¹‹å‰åˆå§‹åŒ–æ ¹èŠ‚ç‚¹çš„çš„æ—¶å€™è°ƒç”¨çš„<code>WidgetsBinding#attachRootWidget(Widget rootWidget)</code>è¿™ä¸ªæ–¹æ³•ä¸­åˆ›å»º<code>RenderObjectToWidgetAdapter</code>å¯¹è±¡åè°ƒç”¨çš„<code>attachToRenderTree()</code>æ–¹æ³•ä¸­æœ‰ä¼ å…¥<code>BuildOwner</code>å¯¹è±¡ï¼Œæ¥ç€å‘ä¸ŠæŸ¥æ‰¾ï¼Œå‘ç°æ˜¯åœ¨<code>initInstances()</code>æ–¹æ³•ä¸­åˆ›å»ºçš„.</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> initInstances() &#123;<br>  <span class="hljs-keyword">super</span>.initInstances();<br>  _instance = <span class="hljs-keyword">this</span>;<br>  <span class="hljs-comment">// Initialization of [_buildOwner] has to be done after</span><br>  <span class="hljs-comment">// [super.initInstances] is called, as it requires [ServicesBinding] to</span><br>  <span class="hljs-comment">// properly setup the [defaultBinaryMessenger] instance.</span><br>  _buildOwner = BuildOwner();<br>  buildOwner!.onBuildScheduled = _handleBuildScheduled;<br>  platformDispatcher.onLocaleChanged = handleLocaleChanged;<br>  platformDispatcher.onAccessibilityFeaturesChanged = handleAccessibilityFeaturesChanged;<br>  SystemChannels.navigation.setMethodCallHandler(_handleNavigationInvocation);<br><br>  platformMenuDelegate = DefaultPlatformMenuDelegate();<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨<code>_handleBuildScheduled</code> ä¸­å°±åªæ˜¯è°ƒç”¨äº†<code>ensureVisualUpdate()</code>æ–¹æ³•ï¼Œç„¶åè°ƒç”¨äº†<code>scheduleFrame()</code>;</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> scheduleFrame() &#123;<br>  <span class="hljs-keyword">if</span> (_hasScheduledFrame || !framesEnabled)<br>    <span class="hljs-keyword">return</span>;<br>  ensureFrameCallbacksRegistered();<br>  platformDispatcher.scheduleFrame();<br>  _hasScheduledFrame = <span class="hljs-keyword">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå…ˆç¡®ä¿ä¸¤ä¸ªå›è°ƒç¡®å®è¢«æ³¨å†Œäº†ï¼Œç„¶åé€šè¿‡<code>platformDispatcher.scheduleFrame()</code>è¿™ä¸ª<em>native</em>æ–¹æ³•å‘ç³»ç»Ÿå‘é€ä¸€ä¸ªå¸§è°ƒåº¦çš„è¯·æ±‚ã€‚<br>ç„¶åä¼šå›è°ƒ<code>_handleDrawFrame()</code>æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯<code>ensureFrameCallbacksRegistered()</code>æ–¹æ³•ä¸­ç¡®ä¿ä¸¤ä¸ªå›è°ƒæ–¹æ³•</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> handleDrawFrame() &#123;<br>  <span class="hljs-keyword">assert</span>(_schedulerPhase == SchedulerPhase.midFrameMicrotasks);<br>  _frameTimelineTask?.finish(); <span class="hljs-comment">// end the &quot;Animate&quot; phase</span><br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-comment">// PERSISTENT FRAME CALLBACKS</span><br>    _schedulerPhase = SchedulerPhase.persistentCallbacks;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> FrameCallback callback <span class="hljs-keyword">in</span> _persistentCallbacks)<br>      _invokeFrameCallback(callback, _currentFrameTimeStamp!);<br><br>    <span class="hljs-comment">// POST-FRAME CALLBACKS</span><br>    _schedulerPhase = SchedulerPhase.postFrameCallbacks;<br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;FrameCallback&gt; localPostFrameCallbacks =<br>        <span class="hljs-built_in">List</span>&lt;FrameCallback&gt;.of(_postFrameCallbacks);<br>    _postFrameCallbacks.clear();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> FrameCallback callback <span class="hljs-keyword">in</span> localPostFrameCallbacks)<br>      _invokeFrameCallback(callback, _currentFrameTimeStamp!);<br>  &#125; <span class="hljs-keyword">finally</span> &#123;<br>    _schedulerPhase = SchedulerPhase.idle;<br>    _frameTimelineTask?.finish(); <span class="hljs-comment">// end the Frame</span><br>    <span class="hljs-keyword">assert</span>(() &#123;<br>      <span class="hljs-keyword">if</span> (debugPrintEndFrameBanner)<br>        debugPrint(<span class="hljs-string">&#x27;â–€&#x27;</span> * _debugBanner!.length);<br>      _debugBanner = <span class="hljs-keyword">null</span>;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>    &#125;());<br>    _currentFrameTimeStamp = <span class="hljs-keyword">null</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åæ˜¯è°ƒç”¨ <code>_invokeFrameCallback</code>ï¼Œè¿™é‡Œçš„<code>_persistentCallbacks</code>æ˜¯ä¸ª<code>list</code>ï¼Œé€šè¿‡</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> addPersistentFrameCallback(FrameCallback callback) &#123;<br>  _persistentCallbacks.add(callback);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•æ·»åŠ å›è°ƒï¼›è¿™é‡Œçš„å›è°ƒæ˜¯åœ¨<code>RendererBinding</code>ç±»ä¸­çš„<code>initInstances()</code>æ–¹æ³•ä¸­æ³¨å†Œçš„ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ–¹æ³•æ˜¯</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart">_handlePersistentFrameCallback<br>  <span class="hljs-keyword">void</span> _handlePersistentFrameCallback(<span class="hljs-built_in">Duration</span> timeStamp) &#123;<br>    drawFrame();<br>    _scheduleMouseTrackerUpdate();<br>  &#125;<br></code></pre></td></tr></table></figure><p>ç„¶åè°ƒç”¨äº†<code>drawFrame();</code>æ–¹æ³•,éœ€è¦æ³¨æ„çš„æ˜¯:<code>RendererBinding</code>æ˜¯ä¸€ä¸ª<em>mixin</em>çš„ç±»ï¼Œè¢«<code>WidgetsBinding</code>æ··å…¥ï¼Œå¹¶ä¸”<code>WidgetsBinding</code>ç±»ä¸­é‡å†™äº†<code>drawFrame()</code>æ–¹æ³•ï¼Œæ‰€ä»¥æœ€åèµ°çš„æ˜¯<code>WidgetsBinding</code>ç±»ä¸­çš„<code>drawFrame()</code>æ–¹æ³•ï¼›åœ¨è¿™é‡Œé¢è°ƒç”¨äº†<code>buildOwner!.buildScope(renderViewElement!);</code><br>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å…ˆå¯¹è„åˆ—è¡¨è¿›è¡Œæ’åº</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> _sort(<span class="hljs-built_in">Element</span> a, <span class="hljs-built_in">Element</span> b) &#123;<br>  <span class="hljs-keyword">if</span> (a.depth &lt; b.depth)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  <span class="hljs-keyword">if</span> (b.depth &lt; a.depth)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span> (b.dirty &amp;&amp; !a.dirty)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  <span class="hljs-keyword">if</span> (a.dirty &amp;&amp; !b.dirty)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åå¾ªç¯è°ƒç”¨<code>element.rebuild();</code>è§¦å‘<code>performRebuild()</code>æ¥ç€å°±æ˜¯<code>widget</code>çš„<code>build()</code>æ–¹æ³•è¢«è§¦å‘.</p>]]></content>
    
    
    
    <tags>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>flutter_runAppåˆ°æŒ‚è½½æ ¹èŠ‚ç‚¹</title>
    <link href="/2023/01/18/flutter-runApp%E5%88%B0%E6%8C%82%E8%BD%BD%E6%A0%B9%E8%8A%82%E7%82%B9/"/>
    <url>/2023/01/18/flutter-runApp%E5%88%B0%E6%8C%82%E8%BD%BD%E6%A0%B9%E8%8A%82%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<h2 id="å…¥å£"><a href="#å…¥å£" class="headerlink" title="å…¥å£"></a>å…¥å£</h2><p>flutteråº”ç”¨çš„å…¥å£ç‚¹åœ¨mainæ–¹æ³•ä¸­è°ƒç”¨çš„<code>runApp(Widget app)</code>æ–¹æ³•ä¸­</p><figure class="highlight dart"><figcaption><span>widgets.binding.runApp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> runApp(Widget app) &#123;<br>  WidgetsFlutterBinding.ensureInitialized()<br>    ..scheduleAttachRootWidget(app)<br>    ..scheduleWarmUpFrame();<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>WidgetsFlutterBinding</code>æ··å…¥äº†ä¸ƒä¸ª <code>xxxbinding</code></p><ul><li>[GestureBinding], which implements the basics of hit testing.</li><li>[SchedulerBinding], which introduces the concepts of frames.</li><li>[ServicesBinding], which provides access to the plugin subsystem.</li><li>[PaintingBinding], which enables decoding images.</li><li>[SemanticsBinding], which supports accessibility.</li><li>[RendererBinding], which handles the render tree.</li><li>[WidgetsBinding], which handles the widget tree.</li></ul><p>å¹¶ä¸”ç±»ä¸­åªæœ‰ä¸€ä¸ª<code>ensureInitialized()</code>æ–¹æ³•ç”¨æ¥åˆå§‹åŒ–<code>WidgetsBinding</code>å¯¹è±¡,æ¥ç€å»æ‰§è¡Œäº†<code>scheduleAttachRootWidget</code>ã€<code>scheduleWarmUpFrame</code>æ–¹æ³•<br>åœ¨<code>ensureInitialized</code>æ–¹æ³•ä¸­è°ƒç”¨<code>WidgetsFlutterBinding</code>è¿›è¡Œäº†åˆå§‹åŒ–</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">static</span> WidgetsBinding ensureInitialized() &#123;<br>  <span class="hljs-keyword">if</span> (WidgetsBinding._instance == <span class="hljs-keyword">null</span>)<br>    WidgetsFlutterBinding();<br>  <span class="hljs-keyword">return</span> WidgetsBinding.instance;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="scheduleAttachRootWidget"><a href="#scheduleAttachRootWidget" class="headerlink" title="scheduleAttachRootWidget"></a>scheduleAttachRootWidget</h3><p>æ¥ç€çœ‹ scheduleAttachRootWidgetè¿™ä¸ªæ–¹æ³•ä¸­æ‰§è¡Œäº†</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">Timer.run(() &#123;<br>  attachRootWidget(rootWidget);<br>&#125;);<br></code></pre></td></tr></table></figure><p>åœ¨attachRootWidgetæ–¹æ³•ä¸­</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> attachRootWidget(Widget rootWidget) &#123;<br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> isBootstrapFrame = renderViewElement == <span class="hljs-keyword">null</span>;<br>  _readyToProduceFrames = <span class="hljs-keyword">true</span>;<br>  _renderViewElement = RenderObjectToWidgetAdapter&lt;RenderBox&gt;(<br>    container: renderView,<br>    debugShortDescription: <span class="hljs-string">&#x27;[root]&#x27;</span>,<br>    child: rootWidget,<br>  ).attachToRenderTree(buildOwner!, renderViewElement <span class="hljs-keyword">as</span> RenderObjectToWidgetElement&lt;RenderBox&gt;?);<br>  <span class="hljs-keyword">if</span> (isBootstrapFrame) &#123;<br>    SchedulerBinding.instance.ensureVisualUpdate();<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„çœ‹è¿™é‡Œçš„<code>_renderViewElement</code>å¯¹è±¡æ˜¯ç”±<code>RenderObjectToWidgetAdapter.attachToRenderTree()</code>è¿”å›çš„;<br>åœ¨åˆå§‹åŒ–<code>RenderObjectToWidgetAdapter</code>å¯¹è±¡æ—¶ä¼ å…¥äº†<code>renderView</code> å’Œ<code>rootWidget</code>ä½œä¸ºå‚æ•°,è¿™é‡Œçš„<code>rootWidget</code>å°±æ˜¯æˆ‘ä»¬<code>runApp</code>ä¸­ä¼ å…¥çš„å‚æ•°;<br>é‚£ä¹ˆè¿™é‡Œçš„<code>renderView</code>æ˜¯ä»€ä¹ˆæ—¶å€™åˆå§‹åŒ–çš„?æˆ‘ä»¬åœ¨ä¸Šé¢æåˆ°çš„<code>WidgetsFlutterBinding</code>æ··å…¥äº†ä¸ƒä¸ª<code>xxxbinding</code>,è¿™é‡Œéœ€è¦äº†è§£mixinçš„æ‰§è¡Œé¡ºåº:<br>è™½ç„¶é¦–å…ˆæ‰§è¡Œçš„æ˜¯<code>WidgetsBinding</code>çš„<code>initInstances</code>æ–¹æ³•,ä½†ç”±äºç¬¬ä¸€å°±æ‰§è¡Œäº†<code>super.initInstances()</code>,æ‰€ä»¥ä¼šå…ˆæ‰§è¡Œå‰ä¸€ä¸ª<code>RenderBinding</code>çš„<code>initInstances</code>,ç„¶åä¸æ–­super,æ‰€ä»¥æœ€ç»ˆ<code>initInstances</code>å®é™…çš„é€»è¾‘æ‰§è¡Œé¡ºåº,å¯ä»¥çœ‹æˆæ˜¯ä»å‰é¢çš„Bindingå¾€åé¢çš„Binding,æ‰€ä»¥åœ¨<code>WidgetsBinding</code>çš„<code>attachRootWidget</code>æ–¹æ³•å†…<code>renderView</code>å·²ç»è¢«åˆå§‹åŒ–äº†.</p><h3 id="RenderObjectToWidgetAdapter"><a href="#RenderObjectToWidgetAdapter" class="headerlink" title="RenderObjectToWidgetAdapter"></a>RenderObjectToWidgetAdapter</h3><p>ç»§æ‰¿è‡ª<code>RenderObjectWidget</code>,å®ƒæœ‰ä¸¤ä¸ªå…³é”®çš„æŠ½è±¡æ–¹æ³•</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dart">RenderObjectElement createElement();<br>RenderObject createRenderObject(BuildContext context);<br></code></pre></td></tr></table></figure><p>çœ‹ä¸‹æ˜¯æ€ä¹ˆè¦†å†™çš„</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@override</span><br>RenderObjectToWidgetElement&lt;T&gt; createElement() =&gt; RenderObjectToWidgetElement&lt;T&gt;(<span class="hljs-keyword">this</span>);<br><br><span class="hljs-meta">@override</span><br>RenderObjectWithChildMixin&lt;T&gt; createRenderObject(BuildContext context) =&gt; container;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥ç€çœ‹attachToRenderTree</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs dart">RenderObjectToWidgetElement&lt;T&gt; attachToRenderTree(BuildOwner owner, [ RenderObjectToWidgetElement&lt;T&gt;? element ]) &#123;<br>  <span class="hljs-keyword">if</span> (element == <span class="hljs-keyword">null</span>) &#123;<br>    owner.lockState(() &#123;<br>      element = createElement();<br>      <span class="hljs-keyword">assert</span>(element != <span class="hljs-keyword">null</span>);<br>      element!.assignOwner(owner);<br>    &#125;);<br>    owner.buildScope(element!, () &#123;<br>      element!.mount(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>);<br>    &#125;);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    element._newWidget = <span class="hljs-keyword">this</span>;<br>    element.markNeedsBuild();<br>  &#125;<br>  <span class="hljs-keyword">return</span> element!;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¼ å…¥äº†<code>BuildOwner</code>çš„å®ä¾‹<code>owner</code>å’Œæ ¹å…ƒç´ å¯¹è±¡.é¦–å…ˆæ‰§è¡Œäº†<code>owner.lockState</code>,è¿™ä¸ªæ–¹æ³•åªæ˜¯è¿›è¡Œäº†ä¸€äº›æ–­è¨€æ¥ä¿è¯æ‰§è¡Œ<code>callback</code>æœŸé—´çŠ¶æ€çš„é”å®š,è¿™é‡Œ<code>callback</code>å°±æ˜¯4~6è¡Œä»£ç ;<br>åœ¨è¿™ä¸ª<code>callback</code>ä¸­æ‰§è¡Œäº†<code>createElement()</code>,ç”¨äºåˆ›å»ºå…ƒç´ ,åˆ›å»ºå‡ºæ¥çš„å…ƒç´ ä¹Ÿå°±æ˜¯æ ‘çš„æ ¹èŠ‚ç‚¹;è¿™é‡Œæ³¨æ„ä¸€ä¸‹<code>createElement</code>æ˜¯<code>RenderObjectToWidgetAdapter</code>å®ä¾‹çš„æ–¹æ³•,çœ‹ä¸‹ä¸Šé¢çš„æ–¹æ³•ä¸­ä¼ å…¥çš„<code>this</code>ä¹Ÿå°±æ˜¯<code>RenderObjectToWidgetAdapter</code>å¯¹è±¡æœ¬èº«;é‚£ä¹ˆåœ¨åˆ›å»ºElementæ—¶ä¸ºå•¥è¦ä¼ å…¥Widgetå¯¹è±¡ï¼Ÿè·Ÿè¸ªåˆ°æœ€çˆ¶çº§çš„Elementå‘ç°æ˜¯ä¸ºäº†ç»™_widgetèµ‹å€¼.<em>ä¹Ÿå°±æ˜¯è¯´ElementæŒæœ‰äº†Widgetå¯¹è±¡,å¹¶ä¸”è¯¥å…ƒç´ ç”±è¯¥ç»„ä»¶åˆ›å»º</em></p><h2 id="æŒ‚è½½"><a href="#æŒ‚è½½" class="headerlink" title="æŒ‚è½½"></a>æŒ‚è½½</h2><p>æ¥ä¸‹æ¥æ˜¯<code>owner.buildScope</code>,è¿™é‡Œä¼ å…¥äº†æ ¹å…ƒç´ å’Œå›è°ƒå‡½æ•°,åŒæ ·çš„æ˜¯è¿›è¡Œäº†ä¸€äº›æ–­è¨€åå›è°ƒäº†<code>callback</code>,åœ¨<code>callback</code>ä¸­æ‰§è¡Œäº†å…ƒç´ çš„æŒ‚è½½,æ³¨æ„è¿™é‡Œä¼ å…¥çš„ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯<code>null</code>.</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@override</span><br><span class="hljs-keyword">void</span> mount(<span class="hljs-built_in">Element?</span> parent, <span class="hljs-built_in">Object?</span> newSlot) &#123;<br>  <span class="hljs-keyword">assert</span>(parent == <span class="hljs-keyword">null</span>);<br>  <span class="hljs-keyword">super</span>.mount(parent, newSlot);<br>  _rebuild();<br>  <span class="hljs-keyword">assert</span>(_child != <span class="hljs-keyword">null</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>mount</code>æ–¹æ³•æ˜¯<code>RenderObjectToWidgetElement</code>ç±»è¦†å†™çš„<code>Element</code>ä¸­å®šä¹‰çš„æ–¹æ³•,è¿™é‡Œæ‰§è¡Œäº†çˆ¶ç±»çš„<code>mount</code>æ–¹æ³•å’Œ<code>_rebuild</code>æ–¹æ³•;<br>å…ˆçœ‹mountçš„è°ƒç”¨è·¯å¾„<br><code>RootRenderObjectElement--&gt;RenderObjectElement--&gt;Element</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> mount(<span class="hljs-built_in">Element?</span> parent, <span class="hljs-built_in">Object?</span> newSlot) &#123;<br>  <span class="hljs-keyword">assert</span>(_lifecycleState == _ElementLifecycle.initial);<br>  <span class="hljs-keyword">assert</span>(widget != <span class="hljs-keyword">null</span>);<br>  <span class="hljs-keyword">assert</span>(_parent == <span class="hljs-keyword">null</span>);<br>  <span class="hljs-keyword">assert</span>(parent == <span class="hljs-keyword">null</span> || parent._lifecycleState == _ElementLifecycle.active);<br>  <span class="hljs-keyword">assert</span>(slot == <span class="hljs-keyword">null</span>);<br>  _parent = parent;<br>  _slot = newSlot;<br>  _lifecycleState = _ElementLifecycle.active;<br>  _depth = _parent != <span class="hljs-keyword">null</span> ? _parent!.depth + <span class="hljs-number">1</span> : <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span> (parent != <span class="hljs-keyword">null</span>) &#123;<br>    <span class="hljs-comment">// Only assign ownership if the parent is non-null. If parent is null</span><br>    <span class="hljs-comment">// (the root node), the owner should have already been assigned.</span><br>    <span class="hljs-comment">// See RootRenderObjectElement.assignOwner().</span><br>    _owner = parent.owner;<br>  &#125;<br>  <span class="hljs-keyword">assert</span>(owner != <span class="hljs-keyword">null</span>);<br>  <span class="hljs-keyword">final</span> Key? key = widget.key;<br>  <span class="hljs-keyword">if</span> (key <span class="hljs-keyword">is</span> GlobalKey) &#123;<br>    owner!._registerGlobalKey(key, <span class="hljs-keyword">this</span>);<br>  &#125;<br>  _updateInheritance();<br>  attachNotificationTree();<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œç»´æŠ¤äº†ä¸€äº›æˆå‘˜ä¿¡æ¯,å¹¶å°†æ ‘çš„æ·±åº¦_depthåŠ 1,åˆ°è¿™é‡Œä¹Ÿå°±ä»¥ä¸ºç€æ ¹å…ƒç´ èŠ‚ç‚¹æŒ‚è½½å®Œæˆ<br>å½“<code>Element#mount</code>æ‰§è¡Œå®Œæˆå,å›åˆ°<code>RenderObjectToWidgetElement#mount</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@override</span><br><span class="hljs-keyword">void</span> mount(<span class="hljs-built_in">Element?</span> parent, <span class="hljs-built_in">Object?</span> newSlot) &#123;<br>  <span class="hljs-keyword">super</span>.mount(parent, newSlot);<br>  <span class="hljs-keyword">assert</span>(() &#123;<br>    _debugDoingBuild = <span class="hljs-keyword">true</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>  &#125;());<br>  _renderObject = (widget <span class="hljs-keyword">as</span> RenderObjectWidget).createRenderObject(<span class="hljs-keyword">this</span>);<br>  <span class="hljs-keyword">assert</span>(!_renderObject!.debugDisposed!);<br>  <span class="hljs-keyword">assert</span>(() &#123;<br>    _debugDoingBuild = <span class="hljs-keyword">false</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>  &#125;());<br>  <span class="hljs-keyword">assert</span>(() &#123;<br>    _debugUpdateRenderObjectOwner();<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>  &#125;());<br>  <span class="hljs-keyword">assert</span>(_slot == newSlot);<br>  attachRenderObject(newSlot);<br>  _dirty = <span class="hljs-keyword">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œé¢æ‰§è¡Œäº†<code>widget</code>çš„<code>createRenderObject(this)</code>æ–¹æ³•æ¥åˆ›å»º<code>_renderObject</code>;æ³¨æ„ä¸€ä¸‹,è¿™é‡Œçš„<code>widget</code>å…¶å®å°±æ˜¯æ ¹ç»„ä»¶.ä¹Ÿå°±æ˜¯<code>RenderObjectToWidgetAdapter</code>çš„å®ä¾‹å¯¹è±¡,è°ƒç”¨å…¶<code>createRenderObject</code>æ–¹æ³•è¿”å›çš„æ˜¯å…¶å®ä¾‹ä¸­çš„<code>container</code>å¯¹è±¡,ä¹Ÿå°±æ˜¯è¯´<code>Element</code>ä¸­çš„<code>_renderObject</code>æ˜¯åœ¨<code>mount</code>æ–¹æ³•ä¸­é€šè¿‡<code>widget.createRenderObject</code>æ–¹æ³•åˆ›å»ºçš„</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@override</span><br>RenderObjectWithChildMixin&lt;T&gt; createRenderObject(BuildContext context) =&gt; container;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>container</code>å¯¹è±¡ä¹Ÿå°±æ˜¯å‰é¢æåˆ°çš„<code>attachRootWidget</code>ä¸­ä¼ å…¥çš„<code>renderView</code>å¯¹è±¡.<br>å¯¹äºæ ¹èŠ‚ç‚¹çš„ä¸‰æ£µæ ‘æ¥è®²,å·²ç»å®Œæˆäº†åˆ›å»ºè¿‡ç¨‹,å•ç€å¹¶ä¸ä»£è¡¨æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æ˜¯è¿™ä¸­æƒ…å†µ.ä¸€èˆ¬æƒ…å†µä¸‹,ç»„ä»¶ä¸ä¼šæŒæœ‰æ¸²æŸ“å¯¹è±¡,åªä¸è¿‡æ ¹ç»„ä»¶æ¯”è¾ƒç‰¹æ®Š,éœ€è¦æœ‰ä¸€ä¸ªå¼€å§‹æ¸²æŸ“çš„èŠ‚ç‚¹,<code>createRenderObject</code>æ–¹æ³•è¿”å›çš„RenderViewä¹Ÿæœ‰ç‰¹æ®Šæ€§</p><p>æ€»ç»“ä¸€ä¸‹</p><ul><li><code>RenderObjectToWidgetAdapter</code>é€šè¿‡æ„é€ æ–¹æ³•æŒæœ‰<code>RenderView</code>å¯¹è±¡</li><li><code>RenderObjectToWidgetAdapter</code>é€šè¿‡<code>createElement</code>æ–¹æ³•åˆ›å»º<code>RenderObjectToWidgetElement</code>å¯¹è±¡</li><li><code>RenderObjectToWidgetElement</code>é€šè¿‡<code>mount</code>æ–¹æ³•æŒæœ‰<code>RenderView</code></li><li><code>RenderObjectToWidgetElement</code>é€šè¿‡æ„é€ æ–¹æ³•(Element)æŒæœ‰<code>RenderObjectToWidgetAdapter</code></li></ul><h3 id="æ ¹æ¸²æŸ“å¯¹è±¡çš„å…³è”"><a href="#æ ¹æ¸²æŸ“å¯¹è±¡çš„å…³è”" class="headerlink" title="æ ¹æ¸²æŸ“å¯¹è±¡çš„å…³è”"></a>æ ¹æ¸²æŸ“å¯¹è±¡çš„å…³è”</h3><p>æŒ‚è½½å®Œäº†æˆ‘ä»¬æ¥ç€çœ‹<code>RenderObjectElement#mount</code>æ–¹æ³•ä¸­è°ƒç”¨çš„<code>attachRenderObject(newSlot)</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@override</span><br><span class="hljs-keyword">void</span> attachRenderObject(<span class="hljs-built_in">Object?</span> newSlot) &#123;<br>  <span class="hljs-keyword">assert</span>(_ancestorRenderObjectElement == <span class="hljs-keyword">null</span>);<br>  _slot = newSlot;<br>  _ancestorRenderObjectElement = _findAncestorRenderObjectElement();<br>  _ancestorRenderObjectElement?.insertRenderObjectChild(renderObject, newSlot);<br>  <span class="hljs-keyword">final</span> ParentDataElement&lt;ParentData&gt;? parentDataElement = _findAncestorParentDataElement();<br>  <span class="hljs-keyword">if</span> (parentDataElement != <span class="hljs-keyword">null</span>)<br>    _updateParentData(parentDataElement.widget <span class="hljs-keyword">as</span> ParentDataWidget&lt;ParentData&gt;);<br>&#125;<br></code></pre></td></tr></table></figure><p>å…ˆè°ƒç”¨<code>_findAncestorRenderObjectElementä»</code>å…ƒç´ æ ‘ä¸­å‘ä¸ŠæŸ¥æ‰¾ç¬¬ä¸€ä¸ª<code>RenderObjectElement</code>ç±»å‹çš„å…ƒç´ èŠ‚ç‚¹ä½œä¸ºå…ˆç¥–èŠ‚ç‚¹,ç„¶åè°ƒç”¨å…¶<code>insertRenderObjectChild</code>æ–¹æ³•å°†è‡ªèº«æŒæœ‰çš„<code>renderObject</code>æ’å…¥çš„æ¸²æŸ“æ ‘ä¸­;<br>ç„¶åè°ƒç”¨<code>_findAncestorParentDataElement</code>æ–¹æ³•ä»å…ƒç´ æ ‘ä¸­å‘ä¸ŠæŸ¥æ‰¾ç¬¬ä¸€ä¸ª<code>ParentDataElement&lt;ParentData&gt;</code>ç±»å‹çš„èŠ‚ç‚¹,å¦‚æœéç©º,åˆ™æ‰§è¡Œ<code>_updateParentData</code>æ–¹æ³•;ç”±äºå½“å‰æ˜¯æ ¹èŠ‚ç‚¹,è¿™ä¸¤ä¸ªæŸ¥æ‰¾çš„æ–¹æ³•è¿”å›çš„éƒ½æ˜¯ç©º</p><h3 id="èŠ‚ç‚¹æŒ‚è½½"><a href="#èŠ‚ç‚¹æŒ‚è½½" class="headerlink" title="èŠ‚ç‚¹æŒ‚è½½"></a>èŠ‚ç‚¹æŒ‚è½½</h3><p>å½“çˆ¶ç±»çš„mountæ–¹æ³•æ‰§è¡Œå®Œæ¯•å,å›è¿‡å¤´æ¥çœ‹<code>RenderObjectToWidgetElement#mount</code>æ–¹æ³•ä¸­è°ƒç”¨çš„<code>_rebuild()</code>æ–¹æ³•.</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> _rebuild() &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    _child = updateChild(_child, (widget <span class="hljs-keyword">as</span> RenderObjectToWidgetAdapter&lt;T&gt;).child, _rootChildSlot);<br>  &#125; <span class="hljs-keyword">catch</span> (exception, stack) &#123;<br>    <span class="hljs-keyword">final</span> FlutterErrorDetails details = FlutterErrorDetails(<br>      exception: exception,<br>      stack: stack,<br>      <span class="hljs-keyword">library</span>: <span class="hljs-string">&#x27;widgets library&#x27;</span>,<br>      context: ErrorDescription(<span class="hljs-string">&#x27;attaching to the render tree&#x27;</span>),<br>    );<br>    FlutterError.reportError(details);<br>    <span class="hljs-keyword">final</span> Widget error = ErrorWidget.builder(details);<br>    _child = updateChild(<span class="hljs-keyword">null</span>, error, _rootChildSlot);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨äº†<code>updateChild</code>æ–¹æ³•,è¿™é‡Œé¢æœ‰ä¸‰ä¸ªå‚æ•°.ç¬¬ä¸€ä¸ªå‚æ•°<code>_child</code>ç°åœ¨ä¸º<code>null</code>,æœ€åä¸€ä¸ª<code>_rootChildSlot</code>æ˜¯ä¸€ä¸ª<code>object</code>,æ³¨æ„ä¸€ä¸‹ç¬¬äºŒä¸ªå‚æ•°<code>widget.child</code>:è¿™é‡Œçš„widgetæ˜¯rootä¹Ÿå°±æ˜¯<code>RenderObjectToWidgetAdapter</code>å¯¹è±¡çš„å®ä¾‹,å®ƒçš„<code>child</code>ä¹Ÿå°±æ˜¯æ˜¯æˆ‘ä»¬åœ¨<code>runApp</code>ä¸­ä¼ å…¥çš„<code>widget</code>å¯¹è±¡,ä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨å‰é¢<code>attachRootWidget</code>æ–¹æ³•ä¸­åˆ›å»º<code>RenderObjectToWidgetAdapter</code>æ—¶ä¼ å…¥çš„<code>child</code>å‚æ•°.</p><p>æ¥ç€çœ‹updateChildæ–¹æ³•,æˆ‘ä»¬åœ¨æ³¨é‡Šä¸­æ‰¾åˆ°äº†è¡Œä¸ºè¯´æ˜</p><table><thead><tr><th></th><th>newWidget &#x3D;&#x3D; null</th><th>newWidget !&#x3D; null</th></tr></thead><tbody><tr><td>child &#x3D;&#x3D; null</td><td>Returns null</td><td>Returns new [Element]</td></tr><tr><td>child !&#x3D; null</td><td>Old child is removed, returns null</td><td>Old child updated if possible, returns child or new [Element]</td></tr></tbody></table><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-built_in">Element?</span> updateChild(<span class="hljs-built_in">Element?</span> child, Widget? newWidget, <span class="hljs-built_in">Object?</span> newSlot) &#123;<br>  <span class="hljs-keyword">if</span> (newWidget == <span class="hljs-keyword">null</span>) &#123;...&#125;<br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Element</span> newChild;<br>  <span class="hljs-keyword">if</span> (child != <span class="hljs-keyword">null</span>) &#123;...&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">// The [debugProfileBuildsEnabled] code for this branch is inside</span><br>    <span class="hljs-comment">// [inflateWidget], since some [Element]s call [inflateWidget] directly</span><br>    <span class="hljs-comment">// instead of going through [updateChild].</span><br>    newChild = inflateWidget(newWidget, newSlot);<br>  &#125;<br>  <span class="hljs-keyword">assert</span>(...);<br>  <span class="hljs-keyword">return</span> newChild;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ºäº†èŠ‚çœç¯‡å¹…,è¿™é‡Œåˆ é™¤äº†æ²¡æœ‰æ‰§è¡Œçš„ä»£ç ;å› ä¸ºè¿™é‡Œçš„childä¸ºç©º,æ‰€ä»¥ä¼šèµ°inflateWidget(newWidget, newSlot)æ–¹æ³•</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-built_in">Element</span> inflateWidget(Widget newWidget, <span class="hljs-built_in">Object?</span> newSlot) &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">final</span> Key? key = newWidget.key;<br>    <span class="hljs-keyword">if</span> (key <span class="hljs-keyword">is</span> GlobalKey) &#123;<br>      <span class="hljs-keyword">final</span> <span class="hljs-built_in">Element?</span> newChild = _retakeInactiveElement(key, newWidget);<br>      <span class="hljs-keyword">if</span> (newChild != <span class="hljs-keyword">null</span>) &#123;<br>        newChild._activateWithParent(<span class="hljs-keyword">this</span>, newSlot);<br>        <span class="hljs-keyword">final</span> <span class="hljs-built_in">Element?</span> updatedChild = updateChild(newChild, newWidget, newSlot);<br>        <span class="hljs-keyword">return</span> updatedChild!;<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">Element</span> newChild = newWidget.createElement();<br>    newChild.mount(<span class="hljs-keyword">this</span>, newSlot);<br>    <span class="hljs-keyword">return</span> newChild;<br>  &#125; <span class="hljs-keyword">finally</span> &#123;<br>    <span class="hljs-keyword">if</span> (isTimelineTracked)<br>      Timeline.finishSync();<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæ£€æŸ¥äº†ç»„ä»¶æ˜¯å¦æœ‰keyå¹¶ä¸”keyæ˜¯ä¸æ˜¯GlobalKey.è¿™é‡Œå…ˆæ”¾ä¸€ä¸‹<br>åé¢è°ƒç”¨<code>newWidget.createElement()</code>åˆ›å»ºäº†<code>element</code>,å¹¶ä¸”è°ƒç”¨å…¶<code>mount</code>è¿›è¡ŒæŒ‚è½½.<br>ç„¶åå°±å¼€å§‹äº†æ ‘çš„éå†è¿›è¡ŒæŒ‚è½½,æ ¹æ®æˆ‘ä»¬åœ¨<code>runApp</code>ä¸­ä¼ å…¥çš„ç»„ä»¶ä¸åŒ,è°ƒç”¨ä¸åŒå¯¹è±¡çš„æ–¹æ³•,</p>]]></content>
    
    
    
    <tags>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å†™åœ¨2023å¹´åˆ--2022æ€»ç»“</title>
    <link href="/2023/01/07/%E5%86%99%E5%9C%A82023%E5%B9%B4%E5%88%9D-2022%E6%80%BB%E7%BB%93/"/>
    <url>/2023/01/07/%E5%86%99%E5%9C%A82023%E5%B9%B4%E5%88%9D-2022%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<p>2022å¹´ï¼Œæ–°å† ä¸‰å¹´ï¼Œæ–°å† è¯Šç–—æ–¹æ¡ˆç¬¬åç‰ˆå°†å…¶æ›´åä¸ºæ–°å‹å† çŠ¶ç—…æ¯’æ„ŸæŸ“ï¼›<br>è¿™ä¸€å¹´ä¸­æ–­äº†æ¯æœˆå­¦ä¹ è®¡åˆ’ï¼Œåšå®¢ä¹Ÿåœæ›´äº†ä¸€å¹´ï¼Œä¹Ÿä¸æ˜¯å¿™ï¼Œåªæ˜¯æ‡’æ•£ï¼Œæ¯•ç«Ÿå†å¿™ä¹Ÿä¸ä¼šå¿™åˆ°å†™ç‚¹ä¸œè¥¿çš„æ—¶é—´éƒ½æŒ¤ä¸å‡ºæ¥çš„åœ°æ­¥ã€‚å·¥ä½œä¸­ä¹Ÿåªæ˜¯åŠ å¼ºäº†ä¹‹å‰å­¦è¿‡çš„ä¸œè¥¿ï¼Œç†Ÿç»ƒåº¦æé«˜äº†è€Œå·²ã€‚<br>ç¿»éäº†è¿‡å»ä¸€å¹´ï¼Œä¹Ÿåªæ˜¯åˆ·äº†å‡ é“é¢˜ï¼Œå­¦å®Œäº†æå®¢æ—¶é—´å‡ ä¸ªè¯¾ç¨‹è€Œå·²ã€‚æ–°çš„ä¸€å¹´æœ‰æ–°çš„è®¡åˆ’ã€‚ä¸ä»…è¦æé«˜è‡ªå·±çš„æŠ€æœ¯ç¡¬å®åŠ›ï¼Œä¹Ÿéœ€è¦æé«˜è½¯æŠ€èƒ½ã€‚</p><h4 id="2023"><a href="#2023" class="headerlink" title="2023"></a>2023</h4><p>è¿˜æ˜¯å›´ç»•å¤§å‰ç«¯è¿›è¡Œ</p><ol><li>flutter<ol><li>æ˜é‡‘å°å†Œ</li><li>Bç«™è§†é¢‘ ç‹å”ä¸ç§ƒ <a href="https://space.bilibili.com/589533168">https://space.bilibili.com/589533168</a>?</li></ol></li><li>å‰ç«¯<ol><li>æå®¢æ—¶é—´è¯¾ç¨‹</li></ol></li><li>iOS</li><li>è½¯æŠ€èƒ½<ol><li>æå®¢æ—¶é—´è¯¾ç¨‹</li></ol></li></ol><p>å…±è®¡60ä¸ªè¯¾ç¨‹ï¼Œä¹è§‚ä¼°è®¡ä¹Ÿå°±åªèƒ½å®Œæˆ10ä¸ªï¼Œæ‚²è§‚å…ˆä¹Ÿå°±å››äº”ä¸ªçš„æ ·å­</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br></pre></td><td class="code"><pre><code class="hljs json"><br><span class="hljs-punctuation">[</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æœ±èµŸçš„æŠ€æœ¯ç®¡ç†è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»æŠ€æœ¯åˆ°ç®¡ç†ï¼Œè®©ä½ çš„ç›®æ ‡å‡½æ•°è¾¾åˆ°æœ€ä¼˜è§£&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æŠ€æœ¯é¢†å¯¼åŠ›å®æˆ˜ç¬”è®°&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;é€šå¾€ä¼˜ç§€æŠ€æœ¯é¢†å¯¼è€…ä¹‹è·¯&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç¡…è°·äº§å“å®æˆ˜36è®²&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç”¨å®ä¾‹æ­ç¤ºå¦‚ä½•æ‰“é€ ä¸–ç•Œçº§äº§å“&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»0å¼€å§‹å­¦æ¶æ„&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å‰é˜¿é‡ŒP9æŠ€æœ¯ä¸“å®¶çš„å®æˆ˜æ¶æ„å¿ƒæ³•&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Javaæ ¸å¿ƒæŠ€æœ¯é¢è¯•ç²¾è®²&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å‰Oracleé¦–å¸­å·¥ç¨‹å¸ˆå¸¦ä½ ä¿®ç‚¼Javaå†…åŠŸ&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è¶£è°ˆç½‘ç»œåè®®&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;åƒå°è¯´ä¸€æ ·çš„ç½‘ç»œåè®®å…¥é—¨è¯¾&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è½¯ä»¶æµ‹è¯•52è®²&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»å°å·¥åˆ°ä¸“å®¶çš„å®æˆ˜å¿ƒæ³•&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ·±å…¥æ‹†è§£Javaè™šæ‹Ÿæœº&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Oracle é«˜çº§ç ”ç©¶å‘˜æ‰‹æŠŠæ‰‹å¸¦ä½ å…¥é—¨JVM&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç¨‹åºå‘˜è¿›é˜¶æ”»ç•¥&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ¯ä¸ªç¨‹åºå‘˜éƒ½åº”è¯¥çŸ¥é“çš„æˆé•¿æ³•åˆ™&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æŠ€æœ¯ç®¡ç†å®æˆ˜36è®²&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å‰ç™¾åº¦æœ€ä½³ç»ç†äººçš„æˆ˜åœ°ç¬”è®°&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»£ç ç²¾è¿›ä¹‹è·¯&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä½ å†™çš„æ¯ä¸€è¡Œä»£ç éƒ½æ˜¯ä½ çš„åç‰‡&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç®—æ³•é¢è¯•é€šå…³40è®²&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å‰Facebookå·¥ç¨‹å¸ˆå¸¦ä½ åƒé€å¤§å‚é¢è¯•é¢˜&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br> <br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç©è½¬Gitä¸‰å‰‘å®¢&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¸¦ä½ æ·±å…¥æŒæ¡Gitã€GitHubå’ŒGitLab&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;10xç¨‹åºå‘˜å·¥ä½œæ³•&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æŒæ¡ä¸»åŠ¨æƒï¼Œå¿™åˆ°ç‚¹å­ä¸Š&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;é‡å­¦å‰ç«¯&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ¯å¤©10åˆ†é’Ÿï¼Œé‡æ„ä½ çš„å‰ç«¯çŸ¥è¯†ä½“ç³»&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç©è½¬Springå…¨å®¶æ¡¶&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä¸€ç«™é€šå…³Springã€Spring Bootä¸Spring Cloud&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è½¯ä»¶å·¥ç¨‹ä¹‹ç¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;é‡æ–°ç†è§£è½¯ä»¶å·¥ç¨‹&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å…¨é¢ç³»ç»Ÿæå‡ä½ çš„å¹¶å‘ç¼–ç¨‹èƒ½åŠ›&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br> <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;iOSå¼€å‘é«˜æ‰‹è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»åŸç†åˆ°å®æˆ˜ï¼Œå¸¦ä½ è§£å†³80%çš„å¼€å‘éš¾é¢˜&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»0å¼€å§‹åšå¢é•¿&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»0åˆ°1çš„å¢é•¿å®æˆ˜æ–¹æ³•è®º&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;é€è§†HTTPåè®®&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ·±å…¥ç†è§£HTTPåè®®æœ¬è´¨ä¸åº”ç”¨&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç©è½¬webpack&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å…¨æ–¹ä½æŒæ¡webpackæ ¸å¿ƒæŠ€èƒ½å’Œä¼˜åŒ–ç­–ç•¥&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;TypeScriptå¼€å‘å®æˆ˜&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç³»ç»ŸæŒæ¡TypeScriptæ ¸å¿ƒæŠ€æœ¯&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç½‘ç»œç¼–ç¨‹å®æˆ˜&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»åº•å±‚åˆ°å®æˆ˜ï¼Œæ·±åº¦è§£æç½‘ç»œç¼–ç¨‹&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æµè§ˆå™¨å·¥ä½œåŸç†ä¸å®è·µ&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;é€è¿‡æµè§ˆå™¨çœ‹æ‡‚å‰ç«¯æœ¬è´¨&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br> <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å…¨æ ˆå·¥ç¨‹å¸ˆä¿®ç‚¼æŒ‡å—&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»å…¨æ ˆå…¥é—¨åˆ°æŠ€èƒ½å®æˆ˜&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Node.jså¼€å‘å®æˆ˜&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¸¦ä½ å¼€å‘ä¸€ä¸ªå®Œæ•´çš„Node.jsé¡¹ç›®&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è¯´é€ä¸­å°&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»æ¦‚å¿µåˆ°è½åœ°ä¸€ç«™é€šå…³&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è‹æ°çš„äº§å“åˆ›æ–°è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä¸€æ¬¡ä»æƒ³æ³•åˆ°äº§å“çš„ä½æˆæœ¬å®éªŒ&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç§»åŠ¨ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•å®æˆ˜&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä¸€æ­¥ä¸€æ­¥å¸¦ä½ æˆä¸ºæµ‹è¯•é«˜æ‰‹&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;é›·è““è““çš„é¡¹ç›®ç®¡ç†å®æˆ˜è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä½¿ä¼—äººè¡Œï¼Œå¦‚ä½•å¸¦é¢†ä¸€ç¾¤äººæˆäº‹&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ€§èƒ½å·¥ç¨‹é«˜æ‰‹è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¾—æ€§èƒ½è€…å¾—å¤©ä¸‹&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ€§èƒ½æµ‹è¯•å®æˆ˜30è®²&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å‘Šåˆ«é‡è·¯å­ï¼Œæˆä¸ºçœŸæ­£çš„æ€§èƒ½æµ‹è¯•é«˜æ‰‹&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è¯´é€æ•æ·&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»åŸç†åˆ°å®æˆ˜å¸¦ä½ è½åœ°æ•æ·&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ¥å£æµ‹è¯•å…¥é—¨è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»åŸç†åˆ°å®æˆ˜ï¼Œå¸¦ä½ è¿›é˜¶æ¥å£æµ‹è¯•&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Javaä¸šåŠ¡å¼€å‘å¸¸è§é”™è¯¯100ä¾‹&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å…¨é¢é¿å‘ + æœ€ä½³å®è·µ=å¥å£®ä»£ç &quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å›¾è§£ Google V8&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä¸€é—¨è¯¾ææ‡‚ JavaScript æ‰§è¡Œé€»è¾‘&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;SREå®æˆ˜æ‰‹å†Œ&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»0åˆ°1å¸¦ä½ æå®šç³»ç»Ÿç¨³å®šæ€§&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;äº’è”ç½‘äººçš„è‹±è¯­ç§æ•™è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è®©ä½ å¿«é€Ÿæå‡è‹±è¯­é˜…è¯»èƒ½åŠ›&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¾®ä¿¡å°ç¨‹åºå…¨æ ˆå¼€å‘å®æˆ˜&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ‰‹æŠŠæ‰‹å¸¦ä½ å®ç°ä¸€æ¬¾ç”µå•†å°ç¨‹åº&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è½¯ä»¶è®¾è®¡ä¹‹ç¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¤šä¸€ç‚¹è®¾è®¡ï¼Œå°‘ä¸€ç‚¹é—®é¢˜&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æŠ€æœ¯ç®¡ç†æ¡ˆä¾‹è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è¸©å‘å¤ç›˜+æ¡ˆä¾‹åˆ†æ+ç²¾è¿›æ”»ç•¥=é«˜æ•ˆç®¡ç†&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç”¨æˆ·ä½“éªŒè®¾è®¡å®æˆ˜è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;äººäººå¯ç”¨çš„ä½“éªŒåˆ›æ–°æ€ç»´&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;WebAssemblyå…¥é—¨è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»0åˆ°1å®ç°ä¸€ä¸ªWebAssemblyå¤šåª’ä½“åº”ç”¨&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;åŠ¨æ€è§„åˆ’é¢è¯•å®å…¸&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å­¦å¥½åŠ¨æ€è§„åˆ’ï¼Œé¢è¯•æ™‹å‡éƒ½ä¸æ€•&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä¹”æ–°äº®çš„CTOæˆé•¿å¤ç›˜&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;åƒä¸‡å¹´è–ªCTOæ˜¯å¦‚ä½•ç‚¼æˆçš„&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;A/Bæµ‹è¯•ä»0åˆ°1&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»åŸç†åˆ°å®æˆ˜ï¼Œåƒé€A/Bæµ‹è¯•&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»£ç ä¹‹ä¸‘&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è¯†åˆ«åå‘³é“ï¼Œé‡æ„é—®é¢˜ä»£ç &quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä½“éªŒè®¾è®¡æ¡ˆä¾‹è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç”¨é‡åŒ–æ–¹å¼ï¼Œé‡æ–°å®šä¹‰ä½“éªŒè®¾è®¡&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æŠ€æœ¯é¢è¯•å®˜è¯†äººæ‰‹å†Œ&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è¾¨è¯†ç²¾è‹±ï¼Œæ‰“é€ é«˜æ•ˆèƒ½å›¢é˜Ÿ&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ€§èƒ½ä¼˜åŒ–é«˜æ‰‹è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä¸€ç«™é€šå…³ä»è®¾è®¡åˆ°äº¤ä»˜çš„æ€§èƒ½é—®é¢˜&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¦‚ä½•è½åœ°ä¸šåŠ¡å»ºæ¨¡&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Thoughtworks CTOå¸¦ä½ é‡æ„å»ºæ¨¡æŠ€èƒ½&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç¨‹åºå‘˜çš„æµ‹è¯•è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æŒæ¡æµ‹è¯•ï¼Œå†™å¥½é«˜è´¨é‡ä»£ç &quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç©è½¬Vue 3å…¨å®¶æ¡¶&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;åŸºç¡€+å®æˆ˜+æºç ï¼Œå…¨æ–¹ä½å­¦é€Vue 3&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ·±å…¥å‰–æJavaæ–°ç‰¹æ€§&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ‰‹æŠŠæ‰‹å¸¦ä½ åƒé€Javaæ–°ç‰¹æ€§&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ”»å…‹è§†é¢‘æŠ€æœ¯&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;é«˜æ‰‹å¸¦è·¯ï¼Œè½»æ¾å­¦ä¹ è§†é¢‘åŸç†&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æå®šéŸ³é¢‘æŠ€æœ¯&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ·±å…¥æµ…å‡ºéŸ³é¢‘æ ¸å¿ƒåŸç†åŠåº”ç”¨&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è‡ªåŠ¨åŒ–æµ‹è¯•é«˜æ‰‹è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ–°æ¨¡å‹+å…¨æ ˆè§†è§’\u003dé«˜æ•ˆè¿›é˜¶&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;é—ç•™ç³»ç»Ÿç°ä»£åŒ–å®æˆ˜&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¸®ä½ èµ°å‡ºé—ç•™ç³»ç»Ÿçš„æ³¥æ½­&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¤§å‚è®¾è®¡è¿›é˜¶å®æˆ˜è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è®©ä½ çªç ´ç“¶é¢ˆçš„é«˜è–ªè®¾è®¡è¯¾&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>ä¹±ä¸ƒå…«ç³Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>riverpod1.0+ç®€ä»‹</title>
    <link href="/2022/01/04/riverpod1-0-%E7%AE%80%E4%BB%8B/"/>
    <url>/2022/01/04/riverpod1-0-%E7%AE%80%E4%BB%8B/</url>
    
    <content type="html"><![CDATA[<p>Flutteræ›´æ–°åˆ°2.8äº†ï¼Œæœ€è¿‘æ‰“ç®—é‡æ‹¾ä¸€ä¸‹flutterï¼Œå†™ç‚¹ä¸œè¥¿ç»ƒç»ƒæ‰‹ã€‚å¤§å®¶éƒ½æ¸…æ¥šåœ¨flutterä¸­çŠ¶æ€ç®¡ç†ç¡®å®æŒºéº»çƒ¦çš„ï¼Œä»ä¸€å¼€å§‹çš„BLoCåˆ°provideã€Providerï¼Œè¿˜æœ‰getXã€Riverpodç­‰ç­‰å„å¼å„æ ·çš„çŠ¶æ€ç®¡ç†åº“ï¼Œæˆ‘ä¸ªäººå€¾å‘äºä½¿ç”¨riverpodï¼Œå®ƒæ›´åƒä¸€ä¸ªçŠ¶æ€ç®¡ç†åº“ï¼›è€ŒgetXæ›´åƒä¸€ä¸ªå¼€å‘çš„æ¡†æ¶ï¼Œå®åœ¨æ˜¯å¤ªå¤§äº†:å½“ä½ ä½¿ç”¨getXçš„æ—¶å€™ï¼Œä½ æ˜¯åœ¨ç”¨getXè€Œä¸æ˜¯flutterå†™åº”ç”¨ã€‚</p><span id="more"></span><h2 id="å¼•å…¥riverpod"><a href="#å¼•å…¥riverpod" class="headerlink" title="å¼•å…¥riverpod"></a>å¼•å…¥riverpod</h2><p>demoä¸­æ²¡æœ‰åŒ…å«flutter_hook,æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©å¼•å…¥flutter_riverpodå³å¯</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">environment:</span><br>  <span class="hljs-attr">sdk:</span> <span class="hljs-string">&quot;&gt;=2.15.1 &lt;3.0.0&quot;</span><br>  <span class="hljs-attr">flutter:</span> <span class="hljs-string">&quot;&gt;=2.0.0&quot;</span><br><br><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-attr">flutter:</span><br>    <span class="hljs-attr">sdk:</span> <span class="hljs-string">flutter</span><br>  <span class="hljs-attr">flutter_riverpod:</span> <span class="hljs-string">^1.0.3</span><br></code></pre></td></tr></table></figure><h2 id="hello-world"><a href="#hello-world" class="headerlink" title="hello world"></a>hello world</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>ProviderScope</code>æ¥åŒ…è£¹æ•´ä¸ªåº”ç”¨ï¼Œä¹Ÿå°±æ˜¯åœ¨mainæ–¹æ³•ä¸­</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(ProviderScope(child: Home()));<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å¯ä»¥å£°æ˜ä¸€ä¸ªProviderã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šæŠŠå„ç§å„æ ·çš„providerä½œä¸ºå…¨å±€å˜é‡æ¥å¼•ç”¨ï¼Œå£°æ˜ä¸€ä¸ªproviderå’Œå£°æ˜ä¸€ä¸ªå‡½æ•°æ²¡æœ‰å¤šå¤§çš„åŒºåˆ«ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> helloWorldProvider = Provider((_) =&gt; <span class="hljs-string">&#x27;Hello world&#x27;</span>);<br></code></pre></td></tr></table></figure><p>æœ€åæˆ‘ä»¬å°±å¯ä»¥è¯»å–Providerä¸­çš„æ•°æ®äº†ã€‚<br>åœ¨1.0.0ä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼ŒConsumerWidgetçš„buildæ–¹æ³•ä¸­æä¾›äº†<code>WidgetRef</code>å¯¹è±¡ï¼Œç”¨æ¥å–ä»£0.14ç‰ˆæœ¬ä¸­çš„<code>useProvider</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_riverpod/flutter_riverpod.dart&#x27;</span>;<br><br><span class="hljs-keyword">final</span> helloWorldProvider  = Provider((_)=&gt;<span class="hljs-string">&quot;hello world&quot;</span>);<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(<span class="hljs-keyword">const</span> ProviderScope(child: Home()));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Home</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span></span>&#123;<br>  <span class="hljs-keyword">const</span> Home(&#123;Key? key&#125;) : <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br><br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> value = ref.watch(helloWorldProvider);<br><br>    <span class="hljs-keyword">return</span> MaterialApp(<br>      home: Scaffold(<br>        appBar: AppBar(title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&quot;riverpod demo&quot;</span>),),<br>        body: Center(<br>          child: Text(value),<br>        ),<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Provider"><a href="#Provider" class="headerlink" title="Provider"></a>Provider</h2><h3 id="å„ç§å„æ ·çš„Provider"><a href="#å„ç§å„æ ·çš„Provider" class="headerlink" title="å„ç§å„æ ·çš„Provider"></a>å„ç§å„æ ·çš„Provider</h3><p>å…·ä½“å¯ä»¥çœ‹è¿™é‡Œï¼Œ<a href="https://pub.dev/documentation/flutter_riverpod/latest/flutter_riverpod/flutter_riverpod-library.html">https://pub.dev/documentation/flutter_riverpod/latest/flutter_riverpod/flutter_riverpod-library.html</a></p><p>ä¸‹é¢åˆ—ä¸¾äº†ä¸€äº›å¸¸ç”¨çš„Providerç±»å‹</p><ul><li><p>Provider</p><p><a href="https://pub.dev/documentation/riverpod/latest/riverpod/Provider-class.html">https://pub.dev/documentation/riverpod/latest/riverpod/Provider-class.html</a></p></li><li><p>StateProvider</p></li></ul><p><a href="https://pub.dev/documentation/riverpod/latest/riverpod/StateProvider-class.html">https://pub.dev/documentation/riverpod/latest/riverpod/StateProvider-class.html</a></p><ul><li><p>StateNotifierProvider<br><a href="https://pub.dev/documentation/riverpod/latest/riverpod/StateNotifierProvider-class.html">https://pub.dev/documentation/riverpod/latest/riverpod/StateNotifierProvider-class.html</a></p></li><li><p>FutureProvider<br><a href="https://pub.dev/documentation/riverpod/latest/riverpod/FutureProvider-class.html">https://pub.dev/documentation/riverpod/latest/riverpod/FutureProvider-class.html</a></p></li><li><p>StreamProvider<br><a href="https://pub.dev/documentation/riverpod/latest/riverpod/StreamProvider-class.html">https://pub.dev/documentation/riverpod/latest/riverpod/StreamProvider-class.html</a></p></li></ul><h3 id="Providerçš„ä¿®é¥°ç¬¦"><a href="#Providerçš„ä¿®é¥°ç¬¦" class="headerlink" title="Providerçš„ä¿®é¥°ç¬¦"></a>Providerçš„ä¿®é¥°ç¬¦</h3><h4 id="family"><a href="#family" class="headerlink" title=".family"></a>.family</h4><h5 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><p>è¯¥ä¿®é¥°ç¬¦é€‚ç”¨äºé€‚ç”¨å¤–éƒ¨æ•°æ®æ¥æ„å»ºproviderçš„æƒ…å†µ</p><p>ä¸€äº›å¸¸ç”¨æƒ…å†µ</p><ul><li>å’Œ<a href="https://pub.dev/documentation/riverpod/latest/riverpod/FutureProvider-class.html">FutureProvider</a> ç»„åˆï¼Œæ¥æ ¹æ®idè·å–æ¶ˆæ¯</li><li>æŠŠå½“å‰Localeå¯¹è±¡ä¼ ç»™providerï¼Œç”¨æ¥è¿›è¡Œå›½é™…åŒ–</li><li>åœ¨ä¸è®¿é—®å¯¹æ–¹å±æ€§çš„å‰æä¸‹è¿æ¥ä¸¤ä¸ªprovider</li></ul><p>åœ¨ä½¿ç”¨familyæ—¶ï¼Œä¼šé¢å¤–çš„å‘provideræä¾›ä¸€ä¸ªå±æ€§ï¼Œåœ¨providerä¸­æˆ‘ä»¬å¯ä»¥è‡ªç”±çš„ä½¿ç”¨è¯¥å±æ€§æ¥åˆ›å»ºæŸäº›çŠ¶æ€</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> messagesFamily = FutureProvider.family&lt;Message, <span class="hljs-built_in">String</span>&gt;((ref, id) <span class="hljs-keyword">async</span> &#123;<br>  <span class="hljs-keyword">return</span> dio.<span class="hljs-keyword">get</span>(<span class="hljs-string">&#x27;http://my_api.dev/messages/<span class="hljs-subst">$id</span>&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸‹åœ¨ä½¿ç”¨<code>messagesFamily</code>æ—¶ä¼šæœ‰ç‚¹è¯­æ³•ä¸Šçš„å˜åŒ–ï¼Œæˆ‘ä»¬éœ€è¦é¢å¤–æä¾›ä¸€ä¸ªå‚æ•°</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">Widget build(BuildContext context, WidgetRef ref) &#123;<br>  <span class="hljs-keyword">final</span> response = ref.watch(messagesFamily(<span class="hljs-string">&#x27;id&#x27;</span>));<br>&#125;<br></code></pre></td></tr></table></figure><p>å®ƒè¿˜æ”¯æŒåŒæ—¶è·å–ä¸åŒçš„å±æ€§</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@override</span><br>Widget build(BuildContext context, WidgetRef ref) &#123;<br>  <span class="hljs-keyword">final</span> frenchTitle = ref.watch(titleFamily(<span class="hljs-keyword">const</span> Locale(<span class="hljs-string">&#x27;fr&#x27;</span>)));<br>  <span class="hljs-keyword">final</span> englishTitle = ref.watch(titleFamily(<span class="hljs-keyword">const</span> Locale(<span class="hljs-string">&#x27;en&#x27;</span>)));<br><br>  <span class="hljs-keyword">return</span> Text(<span class="hljs-string">&#x27;fr: <span class="hljs-subst">$frenchTitle</span> en: <span class="hljs-subst">$englishTitle</span>&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="å‚æ•°é™åˆ¶"><a href="#å‚æ•°é™åˆ¶" class="headerlink" title="å‚æ•°é™åˆ¶"></a>å‚æ•°é™åˆ¶</h5><p>å‚æ•°ä¸é™åˆ¶ç±»å‹ï¼Œä½†å¿…é¡»å®ç°<code>==</code>å’Œ<code>hashCode</code>ä¸¤ä¸ªæ–¹æ³•ï¼›</p><p>å¦‚æœå‚æ•°ä¸æ˜¯constantçš„ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³å°†è¾“å…¥æ¡†å†…å®¹ä¼ ç»™Providerï¼Œä½†æ˜¯è¾“å…¥æ¡†çš„å†…å®¹ä¼šå˜åŒ–çš„ç‰¹åˆ«é¢‘ç¹å¹¶ä¸”ä¸èƒ½å¤ç”¨ï¼Œè¿™ç§æƒ…å†µå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„éœ²ï¼Œå¯ä»¥ä½¿ç”¨<code>.autoDispose</code>ä¿®é¥°ç¬¦æ¥ä¿®å¤è¿™ä¸ªé—®é¢˜</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> characters = FutureProvider.autoDispose.family&lt;<span class="hljs-built_in">List</span>&lt;Character&gt;, <span class="hljs-built_in">String</span>&gt;((ref, filter) <span class="hljs-keyword">async</span> &#123;<br>  <span class="hljs-keyword">return</span> fetchCharacters(filter: filter);<br>&#125;);<br></code></pre></td></tr></table></figure><h5 id="ä¼ é€’å¤šä¸ªå‚æ•°"><a href="#ä¼ é€’å¤šä¸ªå‚æ•°" class="headerlink" title="ä¼ é€’å¤šä¸ªå‚æ•°"></a>ä¼ é€’å¤šä¸ªå‚æ•°</h5><p>.familyä¿®é¥°ç¬¦å¹¶æ²¡æœ‰å†…ç½®æä¾›è¿‡ä¸ªå‚æ•°çš„æ–¹æ³•ï¼Œå¦å¤–ä¸€æ–¹é¢ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥æ˜¯ä»»æ„ç¬¦åˆä¸Šé¢æåˆ°çš„é™åˆ¶çš„ç±»å‹ã€‚<br>æ¯”å¦‚</p><ul><li>å…ƒç»„</li><li>ä½¿ç”¨ Freezed æˆ– built_value ç”Ÿæˆçš„å¯¹è±¡</li><li>ä½¿ç”¨ equatable çš„å¯¹è±¡</li></ul><p>** freezed **</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@freezed</span><br><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyParameter</span> <span class="hljs-title">with</span> <span class="hljs-title">_</span>$<span class="hljs-title">MyParameter</span> </span>&#123;<br>  <span class="hljs-keyword">factory</span> MyParameter(&#123;<br>    <span class="hljs-keyword">required</span> <span class="hljs-built_in">int</span> userId,<br>    <span class="hljs-keyword">required</span> Locale locale,<br>  &#125;) = _MyParameter;<br>&#125;<br><br><span class="hljs-keyword">final</span> exampleProvider = Provider.autoDispose.family&lt;Something, MyParameter&gt;((ref, myParameter) &#123;<br>  <span class="hljs-built_in">print</span>(myParameter.userId);<br>  <span class="hljs-built_in">print</span>(myParameter.locale);<br>  <span class="hljs-comment">// Do something with userId/locale</span><br>&#125;);<br><br><span class="hljs-meta">@override</span><br>Widget build(BuildContext context, WidgetRef ref) &#123;<br>  <span class="hljs-built_in">int</span> userId; <span class="hljs-comment">// Read the user ID from somewhere</span><br>  <span class="hljs-keyword">final</span> locale = Localizations.localeOf(context);<br><br>  <span class="hljs-keyword">final</span> something = ref.watch(<br>    exampleProvider(MyParameter(userId: userId, locale: locale)),<br>  );<br><br>  ...<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>Equatable</strong></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyParameter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Equatable</span>  </span>&#123;<br>  MyParameter(&#123;<br>    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.userId,<br>    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.locale,<br>  &#125;);<br><br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> userId;<br>  <span class="hljs-keyword">final</span> Locale locale;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">Object</span>&gt; <span class="hljs-keyword">get</span> props =&gt; [userId, locale];<br>&#125;<br><br><span class="hljs-keyword">final</span> exampleProvider = Provider.family&lt;Something, MyParameter&gt;((ref, myParameter) &#123;<br>  <span class="hljs-built_in">print</span>(myParameter.userId);<br>  <span class="hljs-built_in">print</span>(myParameter.locale);<br>  <span class="hljs-comment">// Do something with userId/locale</span><br>&#125;);<br><br><span class="hljs-meta">@override</span><br>Widget build(BuildContext context, WidgetRef ref) &#123;<br>  <span class="hljs-built_in">int</span> userId; <span class="hljs-comment">// Read the user ID from somewhere</span><br>  <span class="hljs-keyword">final</span> locale = Localizations.localeOf(context);<br><br>  <span class="hljs-keyword">final</span> something = ref.watch(<br>    exampleProvider(MyParameter(userId: userId, locale: locale)),<br>  );<br><br>  ...<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="autoDispose"><a href="#autoDispose" class="headerlink" title=".autoDispose"></a>.autoDispose</h4><p>ä¸€ä¸ªé€šç”¨åœºæ™¯æ˜¯èƒ½å¤Ÿè‡ªåŠ¨é‡Šæ”¾é•¿æ—¶é—´ä¸é€‚ç”¨Providerï¼›</p><p>æœ‰å¾ˆå¤šä¸ªè®©æˆ‘ä»¬è¿™ä¹ˆåšå¾—ç†ç”±ï¼Œæ¯”å¦‚ï¼š</p><ul><li>åœ¨ä½¿ç”¨Firebaseæ—¶ï¼Œå…³é—­è¿æ¥é¿å…ä¸å¿…è¦çš„å¼€é”€</li><li>å½“ç”¨æˆ·ç¦»å¼€é¡µé¢å†è¿›å…¥é¡µé¢æ—¶é‡ç½®çŠ¶æ€</li></ul><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å†…åµŒçš„<code>.autoDispose</code>ä¿®é¥°ç¬¦æ¥æ”¯æŒä¸Šè¿°åœºæ™¯</p><h5 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><p>æƒ³è¦å‘Šè¯‰Riverpodåœ¨ä¸å†ä½¿ç”¨provideræ—¶å°†å…¶é”€æ¯ï¼Œåªéœ€è¦åœ¨Providerä¹‹å‰åŠ ä¸Š<code>.autoDispose</code>å³å¯</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> userProvider = StreamProvider.autoDispose&lt;User&gt;((ref) &#123;<br><br>&#125;);<br></code></pre></td></tr></table></figure><p>å°±è¿™æ ·ï¼Œå½“<code>userProvider</code>ä¸å†ä½¿ç”¨æ—¶å°†ä¼šè¢«è‡ªåŠ¨é”€æ¯</p><p>æ³¨æ„é€šç”¨å‚æ•°æ˜¯å¦‚ä½•åœ¨autoDisposeä¹‹åè€Œä¸æ˜¯ä¹‹å‰ä¼ é€’çš„â€“autoDisposeä¸æ˜¯ä¸€ä¸ªå‘½åçš„æ„é€ å‡½æ•°ã€‚</p><p>å½“ç„¶ï¼Œä¸Šé¢ä¹Ÿæåˆ°å¯ä»¥å’Œå…¶ä»–ä¿®é¥°ç¬¦ä¸€èµ·</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> userProvider = StreamProvider.autoDispose.family&lt;User, <span class="hljs-built_in">String</span>&gt;((ref, id) &#123;<br><br>&#125;);<br></code></pre></td></tr></table></figure><h5 id="ref-maintainState"><a href="#ref-maintainState" class="headerlink" title="ref.maintainState"></a>ref.maintainState</h5><p>ç”¨<code>autoDispose</code>æ ‡è®°ä¸€ä¸ªæä¾›è€…ï¼Œä¹Ÿä¼šåœ¨refä¸Šå¢åŠ ä¸€ä¸ªé¢å¤–çš„å±æ€§ï¼š <code>maintainState</code>ã€‚</p><p>è¯¥å±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆé»˜è®¤ä¸ºfalseï¼‰ï¼Œå…è®¸æä¾›è€…å‘Šè¯‰Riverpodå³ä½¿ä¸å†è¢«ç›‘å¬ï¼Œæ˜¯å¦åº”è¯¥ä¿ç•™æä¾›è€…çš„çŠ¶æ€ã€‚</p><p>ä¸€ä¸ªç”¨ä¾‹æ˜¯åœ¨ä¸€ä¸ªHTTPè¯·æ±‚å®Œæˆåï¼Œå°†è¿™ä¸ªæ ‡å¿—è®¾ç½®ä¸ºtrue:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> myProvider = FutureProvider.autoDispose((ref) <span class="hljs-keyword">async</span> &#123;<br>  <span class="hljs-keyword">final</span> response = <span class="hljs-keyword">await</span> dio.<span class="hljs-keyword">get</span>(...);<br>  ref.maintainState = <span class="hljs-keyword">true</span>;<br>  <span class="hljs-keyword">return</span> response;<br>&#125;);<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œå¦‚æœè¯·æ±‚å¤±è´¥ï¼Œç”¨æˆ·ç¦»å¼€å±å¹•ååˆé‡æ–°è¿›å…¥ï¼Œé‚£ä¹ˆè¯·æ±‚å°†è¢«å†æ¬¡æ‰§è¡Œã€‚ä½†å¦‚æœè¯·æ±‚æˆåŠŸå®Œæˆï¼ŒçŠ¶æ€å°†è¢«ä¿ç•™ï¼Œé‡æ–°è¿›å…¥å±å¹•å°†ä¸ä¼šè§¦å‘æ–°çš„è¯·æ±‚ã€‚</p><h5 id="ç¤ºä¾‹ï¼šå–æ¶ˆhttpè¯·æ±‚"><a href="#ç¤ºä¾‹ï¼šå–æ¶ˆhttpè¯·æ±‚" class="headerlink" title="ç¤ºä¾‹ï¼šå–æ¶ˆhttpè¯·æ±‚"></a>ç¤ºä¾‹ï¼šå–æ¶ˆhttpè¯·æ±‚</h5><p>autoDisposeä¿®æ”¹å™¨å¯ä»¥ä¸FutureProviderå’Œref.onDisposeç›¸ç»“åˆï¼Œä»¥ä¾¿åœ¨ä¸å†éœ€è¦HTTPè¯·æ±‚æ—¶è½»æ¾å–æ¶ˆã€‚</p><p>è¦æ±‚ï¼š</p><ul><li>å½“ç”¨æˆ·è¿›å…¥ä¸€ä¸ªå±å¹•æ—¶ï¼Œå¯åŠ¨ä¸€ä¸ªHTTPè¯·æ±‚</li><li>å¦‚æœç”¨æˆ·åœ¨è¯·æ±‚å®Œæˆå‰ç¦»å¼€å±å¹•ï¼Œåˆ™å–æ¶ˆHTTPè¯·æ±‚</li><li>å¦‚æœè¯·æ±‚æˆåŠŸï¼Œç¦»å¼€å¹¶é‡æ–°è¿›å…¥å±å¹•ä¸ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„è¯·æ±‚</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> myProvider = FutureProvider.autoDispose((ref) <span class="hljs-keyword">async</span> &#123;<br>  <span class="hljs-comment">// An object from package:dio that allows cancelling http requests</span><br>  <span class="hljs-keyword">final</span> cancelToken = CancelToken();<br>  <span class="hljs-comment">// When the provider is destroyed, cancel the http request</span><br>  ref.onDispose(() =&gt; cancelToken.cancel());<br><br>  <span class="hljs-comment">// Fetch our data and pass our `cancelToken` for cancellation to work</span><br>  <span class="hljs-keyword">final</span> response = <span class="hljs-keyword">await</span> dio.<span class="hljs-keyword">get</span>(<span class="hljs-string">&#x27;path&#x27;</span>, cancelToken: cancelToken);<br>  <span class="hljs-comment">// If the request completed successfully, keep the state</span><br>  ref.maintainState = <span class="hljs-keyword">true</span>;<br>  <span class="hljs-keyword">return</span> response;<br>&#125;);<br></code></pre></td></tr></table></figure><h5 id="å‚æ•°ç±»å‹â€™AutoDisposeProviderâ€™ä¸èƒ½åˆ†é…ç»™å‚æ•°ç±»å‹â€™AlwaysAliveProviderBaseâ€™ã€‚"><a href="#å‚æ•°ç±»å‹â€™AutoDisposeProviderâ€™ä¸èƒ½åˆ†é…ç»™å‚æ•°ç±»å‹â€™AlwaysAliveProviderBaseâ€™ã€‚" class="headerlink" title="å‚æ•°ç±»å‹â€™AutoDisposeProviderâ€™ä¸èƒ½åˆ†é…ç»™å‚æ•°ç±»å‹â€™AlwaysAliveProviderBaseâ€™ã€‚"></a>å‚æ•°ç±»å‹â€™AutoDisposeProviderâ€™ä¸èƒ½åˆ†é…ç»™å‚æ•°ç±»å‹â€™AlwaysAliveProviderBaseâ€™ã€‚</h5><p>å½“ä½¿ç”¨.autoDisposeæ—¶ï¼Œä½ å¯èƒ½ä¼šå‘ç°è‡ªå·±çš„åº”ç”¨ç¨‹åºæ— æ³•ç¼–è¯‘ï¼Œå‡ºç°ç±»ä¼¼çš„é”™è¯¯ã€‚</p><blockquote><p>The argument type â€˜AutoDisposeProviderâ€™ canâ€™t be assigned to the parameter type â€˜AlwaysAliveProviderBaseâ€™</p></blockquote><p>å¯èƒ½æ˜¯å› ä¸ºä½ è¯•å›¾åœ¨ä¸€ä¸ªæ²¡æœ‰æ ‡è®°ä¸º.autoDisposeçš„æä¾›è€…ä¸­ç›‘å¬ä¸€ä¸ªæ ‡è®°ä¸º.autoDisposeçš„æä¾›è€…ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> firstProvider = Provider.autoDispose((ref) =&gt; <span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">final</span> secondProvider = Provider((ref) &#123;<br>  <span class="hljs-comment">// The argument type &#x27;AutoDisposeProvider&lt;int&gt;&#x27; can&#x27;t be assigned to the</span><br>  <span class="hljs-comment">// parameter type &#x27;AlwaysAliveProviderBase&lt;Object, Null&gt;&#x27;</span><br>  ref.watch(firstProvider);<br>&#125;);<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸å¯å–çš„ï¼Œå› ä¸ºå®ƒå°†å¯¼è‡´firstProvideræ°¸è¿œä¸ä¼šè¢«disposeã€‚æˆ‘ä»¬å¯ä»¥è€ƒè™‘å°† <code>secondProvider</code> æ ‡è®°ä¸º &#96;.autoDisposeæ¥ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> firstProvider = Provider.autoDispose((ref) =&gt; <span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">final</span> secondProvider = Provider.autoDispose((ref) &#123;<br>  ref.watch(firstProvider);<br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="WidgetRef"><a href="#WidgetRef" class="headerlink" title="WidgetRef"></a>WidgetRef</h2><h3 id="è·å–WidgetRefå¯¹è±¡"><a href="#è·å–WidgetRefå¯¹è±¡" class="headerlink" title="è·å–WidgetRefå¯¹è±¡"></a>è·å–WidgetRefå¯¹è±¡</h3><h4 id="ä»å…¶ä»–Providerå¯¹è±¡ä¸­è·å–"><a href="#ä»å…¶ä»–Providerå¯¹è±¡ä¸­è·å–" class="headerlink" title="ä»å…¶ä»–Providerå¯¹è±¡ä¸­è·å–"></a>ä»å…¶ä»–Providerå¯¹è±¡ä¸­è·å–</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> provider = Provider((ref) &#123;<br>  <span class="hljs-comment">// use ref to obtain other providers</span><br>  <span class="hljs-keyword">final</span> repository = ref.watch(repositoryProvider);<br>  <span class="hljs-keyword">return</span> SomeValue(repository);<br>&#125;)<br></code></pre></td></tr></table></figure><p><code>ref</code>å¯¹è±¡å¯ä»¥å¾ˆå®‰å…¨çš„åœ¨providerä¹‹é—´ä¼ é€’ï¼Œä¸€ä¸ªå¸¸è§çš„ç”¨æ³•å°±æ˜¯è®²<code>ref</code>ä¼ é€’ç»™ <a href="https://pub.dev/documentation/state_notifier/latest/state_notifier/StateNotifier-class.html">StateNotifier</a></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> counter = StateNotifierProvider&lt;Counter, <span class="hljs-built_in">int</span>&gt;((ref) &#123;<br>  <span class="hljs-keyword">return</span> Counter(ref);<br>&#125;);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Counter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StateNotifier</span>&lt;<span class="hljs-title">int</span>&gt; </span>&#123;<br>  Counter(<span class="hljs-keyword">this</span>.ref): <span class="hljs-keyword">super</span>(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">final</span> Ref ref;<br><br>  <span class="hljs-keyword">void</span> increment() &#123;<br>    <span class="hljs-comment">// Counter can use the &quot;ref&quot; to read other providers</span><br>    <span class="hljs-keyword">final</span> repository = ref.read(repositoryProvider);<br>    repository.post(<span class="hljs-string">&#x27;...&#x27;</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¹ˆåšå¯ä»¥è®©Counterå†…éƒ¨è¯»å–providerçŠ¶æ€</p><h4 id="ä»Widgetå¯¹è±¡ä¸­è·å–ref"><a href="#ä»Widgetå¯¹è±¡ä¸­è·å–ref" class="headerlink" title="ä»Widgetå¯¹è±¡ä¸­è·å–ref"></a>ä»Widgetå¯¹è±¡ä¸­è·å–ref</h4><p>ä¸€èˆ¬æƒ…å†µä¸‹Widgetå¯¹è±¡ä¸­æ˜¯æ²¡æœ‰refå¯¹è±¡ä¸­ï¼Œä½†riverpodæä¾›äº†å‡ ç§è§£å†³æ–¹æ¡ˆ</p><ul><li>ä½¿ç”¨ConsumerWidgetæ›¿æ¢StatelessWidget</li></ul><p>ConsumerWidgetå’ŒStatelessWidgetåŸºæœ¬ç›¸åŒ(è™½ç„¶æ˜¯ç»§æ‰¿äº†StatefulWidget)ï¼Œåªæ˜¯åœ¨buildæ–¹æ³•ä¸­å¤šäº†ä¸€ä¸ªWidgetRefå¯¹è±¡</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>  <span class="hljs-keyword">const</span> HomeView(&#123;Key? key&#125;): <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-comment">// use ref to listen to a provider</span><br>    <span class="hljs-keyword">final</span> counter = ref.watch(counterProvider);<br>    <span class="hljs-keyword">return</span> Text(<span class="hljs-string">&#x27;<span class="hljs-subst">$counter</span>&#x27;</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ConsumerStatefulWidget+ConsumerState æ›¿æ¢ StatefulWidget+State</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerStatefulWidget</span> </span>&#123;<br>  <span class="hljs-keyword">const</span> HomeView(&#123;Key? key&#125;): <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-meta">@override</span><br>  HomeViewState createState() =&gt; HomeViewState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeViewState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerState</span>&lt;<span class="hljs-title">HomeView</span>&gt; </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> initState() &#123;<br>    <span class="hljs-keyword">super</span>.initState();<br>    <span class="hljs-comment">// &quot;ref&quot; can be used in all life-cycles of a StatefulWidget.</span><br>    ref.read(counterProvider);<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-comment">// We can also use &quot;ref&quot; to listen to a provider inside the build method</span><br>    <span class="hljs-keyword">final</span> counter = ref.watch(counterProvider);<br>    <span class="hljs-keyword">return</span> Text(<span class="hljs-string">&#x27;<span class="hljs-subst">$counter</span>&#x27;</span>);<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ HookConsumerWidget æ›¿æ¢ HookWidget</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HookConsumerWidget</span> </span>&#123;<br>  <span class="hljs-keyword">const</span> HomeView(&#123;Key? key&#125;): <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-comment">// HookConsumerWidget allows using hooks inside the build method</span><br>    <span class="hljs-keyword">final</span> state = useState(<span class="hljs-number">0</span>);<br><br>    <span class="hljs-comment">// We can also use the ref parameter to listen to providers.</span><br>    <span class="hljs-keyword">final</span> counter = ref.watch(counterProvider);<br>    <span class="hljs-keyword">return</span> Text(<span class="hljs-string">&#x27;<span class="hljs-subst">$counter</span>&#x27;</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="WidgetRefå¯¹è±¡çš„æ–¹æ³•"><a href="#WidgetRefå¯¹è±¡çš„æ–¹æ³•" class="headerlink" title="WidgetRefå¯¹è±¡çš„æ–¹æ³•"></a>WidgetRefå¯¹è±¡çš„æ–¹æ³•</h3><p>è¿™é‡Œçš„<code>WidgetRef</code>å¯¹è±¡åœ¨è¯»å–Providerä¸­çš„æ•°æ®æ—¶ï¼Œæä¾›äº†<code>read</code>ã€<code>listen</code>å’Œ<code>watch</code>æ–¹æ³•ã€‚è‡³äºä»€ä¹ˆæƒ…å†µä¸‹é€‰ç”¨å“ªä¸ªæ–¹æ³•ï¼Œè¿™é‡Œæœ‰ä¸‰ä¸ªå»ºè®®</p><blockquote><ul><li>å½“æˆ‘ä»¬éœ€è¦ç›‘å¬å˜åŒ–å¹¶ä¸”ä»Providerä¸­è·å–æ•°æ®æ—¶ï¼Œæ¯”å¦‚å½“æ•°æ®å˜åŒ–æ—¶æˆ‘ä»¬éœ€è¦é‡æ–°æ„å»ºWidgetï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>ref.watch</code></li><li>å½“æˆ‘ä»¬éœ€è¦ç›‘å¬å˜åŒ–å»æ‰§è¡ŒæŸä¸ªåŠ¨ä½œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>ref.listen</code></li><li>å½“æˆ‘ä»¬ä»…éœ€è¦è¯»å–æ•°æ®ä¸å…³å¿ƒæ•°æ®çš„å˜åŒ–æ—¶ï¼Œæ¯”å¦‚ç‚¹å‡»æŸä¸ªæŒ‰é’®æ—¶ï¼Œæ ¹æ®çŠ¶æ€æ¥åˆ¤æ–­ä¸‹ä¸€æ­¥åŠ¨ä½œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>ref.read</code></li></ul></blockquote><ul><li>ref.watch<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> counterProvider = StateProvider((_)=&gt; <span class="hljs-number">0</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Home</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span></span>&#123;<br>  <span class="hljs-keyword">const</span> Home(&#123;Key? key&#125;) : <span class="hljs-keyword">super</span>(key: key);<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> count = ref.watch(counterProvider);<br>    <span class="hljs-keyword">return</span> MaterialApp(<br>      home: Scaffold(<br>        appBar: AppBar(title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&quot;riverpod demo&quot;</span>),),<br>        body: Center(<br>          child: Column(<br>            children: [<br>              Text(<span class="hljs-string">&#x27;<span class="hljs-subst">$count</span>&#x27;</span>)<br>            ],<br>          ),<br>        ),<br>        floatingActionButton: FloatingActionButton(onPressed: ()=&gt;&#123;<br>          ref.read(counterProvider.state).state++<br>        &#125;,child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&quot;ç‚¹å‡»&quot;</span>),),<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li>ref.read</li></ul><p>ä½¿ç”¨è¯¥æ–¹æ³•å¯ä»¥æ²¡æœ‰ä»»ä½•å½±å“çš„è·å–ä¸€æ¬¡providerçš„çŠ¶æ€ï¼Œä½†æ˜¯ä½œè€…æç¤ºæˆ‘ä»¬å°½é‡ä¸è¦ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œå®ƒåªæ˜¯ç”¨æ¥è§£å†³ä½¿ç”¨<code>watch|listen</code>ä¸æ–¹ä¾¿çš„é—®é¢˜ï¼Œå¦‚æœå¯ä»¥ï¼Œå°½é‡ä½¿ç”¨<code>watch|listen.</code>è¿™é‡Œæœ‰ä¸ªä½¿ç”¨readæ–¹æ³•çš„ç¤ºä¾‹<a href="https://riverpod.dev/docs/concepts/combining_providers#can-i-read-a-provider-without-listening-to-it">https://riverpod.dev/docs/concepts/combining_providers#can-i-read-a-provider-without-listening-to-it</a></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> counterProvider = StateNotifierProvider&lt;Counter, <span class="hljs-built_in">int</span>&gt;((ref) =&gt; Counter());<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>  <span class="hljs-keyword">const</span> HomeView(&#123;Key? key&#125;): <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      floatingActionButton: FloatingActionButton(<br>        onPressed: () &#123;<br>          <span class="hljs-comment">// Call `increment()` on the `Counter` class</span><br>          ref.read(counterProvider.notifier).increment();<br>        &#125;,<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ref.listen</li></ul><p>å’Œ<code>ref.watch</code>ç›¸ä¼¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨<code>ref.listen</code>æ¥è§‚å¯Ÿproviderã€‚ä»–ä»¬çš„åŒºåˆ«å°±æ˜¯å½“providerçŠ¶æ€å˜åŒ–æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨è‡ªå·±å®šä¹‰çš„æ–¹æ³•ã€‚è¯¥æ–¹æ³•éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦ç›‘å¬çš„providerå¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å›è°ƒæ–¹æ³•ï¼Œ</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> counterProvider = StateNotifierProvider&lt;Counter, <span class="hljs-built_in">int</span>&gt;((ref) =&gt; Counter());<br><br><span class="hljs-keyword">final</span> anotherProvider = Provider((ref) &#123;<br>  ref.listen&lt;<span class="hljs-built_in">int</span>&gt;(counterProvider, (<span class="hljs-built_in">int?</span> previousCount, <span class="hljs-built_in">int</span> newCount) &#123;<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;The counter changed <span class="hljs-subst">$&#123;newCount&#125;</span>&#x27;</span>);<br>  &#125;);<br>  ...<br>&#125;);<br></code></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> counterProvider = StateNotifierProvider&lt;Counter, <span class="hljs-built_in">int</span>&gt;((ref) =&gt; Counter());<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>  <span class="hljs-keyword">const</span> HomeView(&#123;Key? key&#125;): <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    ref.listen&lt;<span class="hljs-built_in">int</span>&gt;(counterProvider, (<span class="hljs-built_in">int?</span> previousCount, <span class="hljs-built_in">int</span> newCount) &#123;<br>      <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;The counter changed <span class="hljs-subst">$&#123;newCount&#125;</span>&#x27;</span>);<br>    &#125;);<br>    ...<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å†³å®šè®¢é˜…ä»€ä¹ˆ"><a href="#å†³å®šè®¢é˜…ä»€ä¹ˆ" class="headerlink" title="å†³å®šè®¢é˜…ä»€ä¹ˆ"></a>å†³å®šè®¢é˜…ä»€ä¹ˆ</h3><p>æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªStreamProvider</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> userProvider = StreamProvider&lt;User&gt;(...);<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå»è®¢é˜…</p><ul><li>é€šè¿‡ç›‘å¬provideræœ¬èº«æ¥åŒæ­¥è·å–å½“å‰çŠ¶æ€</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dart">Widget build(BuildContext context, WidgetRef ref) &#123;<br>  AsyncValue&lt;User&gt; user = ref.watch(userProvider);<br><br>  <span class="hljs-keyword">return</span> user.when(<br>    loading: () =&gt; <span class="hljs-keyword">const</span> CircularProgressIndicator(),<br>    error: (error, stack) =&gt; <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&#x27;Oops&#x27;</span>),<br>    data: (user) =&gt; Text(user.name),<br>  );<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>é€šè¿‡ç›‘å¬<code>userProvider.stream</code>æ¥è·å–å¯¹åº”çš„stream</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">Widget build(BuildContext context, WidgetRef ref) &#123;<br>  Stream&lt;User&gt; user = ref.watch(userProvider.stream);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>é€šè¿‡ç›‘å¬<code>userProvider.future</code>æ¥è·å–ä¸€ä¸ªèƒ½å¾—åˆ°æœ€æ–°çŠ¶æ€çš„Future</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">Widget build(BuildContext context, WidgetRef ref) &#123;<br>  Future&lt;User&gt; user = ref.watch(userProvider.future);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨â€selectâ€-æ¥å†³å®šå“ªäº›å€¼å˜åŒ–æ—¶è¿›è¡Œé‡å»º"><a href="#ä½¿ç”¨â€selectâ€-æ¥å†³å®šå“ªäº›å€¼å˜åŒ–æ—¶è¿›è¡Œé‡å»º" class="headerlink" title="ä½¿ç”¨â€selectâ€ æ¥å†³å®šå“ªäº›å€¼å˜åŒ–æ—¶è¿›è¡Œé‡å»º"></a>ä½¿ç”¨â€selectâ€ æ¥å†³å®šå“ªäº›å€¼å˜åŒ–æ—¶è¿›è¡Œé‡å»º</h3><p>æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªUserå¯¹è±¡</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br>  <span class="hljs-built_in">String</span> <span class="hljs-keyword">get</span> name;<br>  <span class="hljs-built_in">int</span> <span class="hljs-keyword">get</span> age;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘ä»¬åœ¨æ¸²æŸ“é¡µé¢æ—¶åªç”¨åˆ°äº†nameå±æ€§</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart">Widget build(BuildContext context, WidgetRef ref) &#123;<br>  User user = ref.watch(userProvider);<br>  <span class="hljs-keyword">return</span> Text(user.name);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœ<code>age</code>å±æ€§å‘ç”Ÿäº†å˜åŒ–ï¼Œè¯¥Widgetå°±ä¼šé‡å»ºï¼Œæ˜¾ç„¶è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>select</code>æ¥é€‰æ‹©å¯¹è±¡çš„æŸäº›å±æ€§æ¥ç›‘å¬</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart">Widget build(BuildContext context, WidgetRef ref) &#123;<br>  <span class="hljs-built_in">String</span> name = ref.watch(userProvider.select((user) =&gt; user.name))<br>  <span class="hljs-keyword">return</span> Text(name);<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œ<code>select</code>åŒæ ·é€‚ç”¨äº<code>listen</code>æ–¹æ³•</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dart">ref.listen&lt;<span class="hljs-built_in">String</span>&gt;(<br>  userProvider.select((user) =&gt; user.name),<br>  (<span class="hljs-built_in">String?</span> previousName, <span class="hljs-built_in">String</span> newName) &#123;<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;The user name changed <span class="hljs-subst">$newName</span>&#x27;</span>);<br>  &#125;<br>);<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæ²¡å¿…è¦ä¸€å®šè¿”å›å¯¹è±¡çš„å±æ€§ï¼Œåªè¦å¤å†™äº†<code>==</code>çš„å€¼éƒ½å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œæ¯”å¦‚</p><pre><code class="dart">final label = ref.watch(userProvider.select((user) =&gt; &#39;Mr $&#123;user.name&#125;&#39;));</code></pre>]]></content>
    
    
    
    <tags>
      
      <tag>Flutter</tag>
      
      <tag>riverpod</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å†™åœ¨2022å¹´åˆ--2021æ€»ç»“</title>
    <link href="/2022/01/01/%E5%86%99%E5%9C%A82022%E5%B9%B4%E5%88%9D-2021%E6%80%BB%E7%BB%93/"/>
    <url>/2022/01/01/%E5%86%99%E5%9C%A82022%E5%B9%B4%E5%88%9D-2021%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<p>2021å¹´ï¼Œå¨ƒå¨ƒå‡ºç”Ÿäº†ï¼Œå˜¿å˜¿å˜¿<br>ä»Šå¹´ä¼¼ä¹ä¹Ÿæ²¡æœ‰å­¦å•¥ï¼Œä½†åˆä¸çŸ¥é“æ—¶é—´éƒ½èŠ±åœ¨å“ªé‡Œäº†ã€‚<br>æµ…å°è¾„æ­¢çš„å­¦ä¹ äº†ä¸€äº›æŠ€æœ¯</p><ul><li>vue</li><li>react</li><li>å°ç¨‹åº</li><li>é¸¿è’™</li></ul><p>ç¿»äº†ä¸€ä¸¢ä¸¢æºç </p><ul><li>okhttp</li><li>retrofit</li><li>gson</li></ul><p>äº†è§£äº†ä¸€ä¸‹Androidç³»ç»Ÿå¯åŠ¨æµç¨‹ã€åº”ç”¨å¯åŠ¨æµç¨‹ã€‚ç„¶åå°±æ˜¯å‡†å¤‡é‡æ‹¾flutterï¼Œå­¦ä¹ ä¸€ä¸‹è·¨å¹³å°æŠ€æœ¯</p><span id="more"></span><h4 id="2022å¹´"><a href="#2022å¹´" class="headerlink" title="2022å¹´"></a>2022å¹´</h4><p>æ·±å…¥å­¦ä¹ ä¸€ä¸‹fluterå’Œkotlin<br>å¤šåˆ·ä¸€äº›ç®—æ³•é¢˜ï¼Œç”¨çš„æ—¶å€™æ˜¯çœŸæœ‰ç”¨</p>]]></content>
    
    
    
    <tags>
      
      <tag>ä¹±ä¸ƒå…«ç³Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Androidæ…¢ç½‘ç»œåŠé¡µé¢ç›‘æ§</title>
    <link href="/2021/06/19/Android%E6%85%A2%E7%BD%91%E7%BB%9C%E5%8F%8A%E9%A1%B5%E9%9D%A2%E7%9B%91%E6%8E%A7/"/>
    <url>/2021/06/19/Android%E6%85%A2%E7%BD%91%E7%BB%9C%E5%8F%8A%E9%A1%B5%E9%9D%A2%E7%9B%91%E6%8E%A7/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨æAndroidåº”ç”¨å¤§ç›˜ç›‘æ§ï¼Œç›®å‰éœ€è¦ç›‘æ§çš„æ˜¯æ…¢ç½‘ç»œè¯·æ±‚åŠé¡µé¢çš„æ‰“å¼€å’Œå…³é—­ã€‚ç”±äºåº”ç”¨ä¸­ä½¿ç”¨çš„OkHttpè¿›è¡Œç½‘ç»œè¯·æ±‚ï¼Œç€é‡çœ‹äº†ä¸€ä¸‹OkHttpæºç ï¼Œè¿˜æœ‰åˆ«äººå†™çš„ä¸€äº›æ€»ç»“ã€‚å¯¹äºé¡µé¢çš„æ‰“å¼€å…³é—­è¡Œä¸ºï¼Œæˆ‘ä»¬å¯ä»¥æä¸ªBaseActivityæˆ–è€…åœ¨Applicationä¸­æ³¨å†Œç”Ÿå‘½å‘¨æœŸå›è°ƒå°±å¥½äº†ã€‚é—®é¢˜åœ¨äºæ…¢ç½‘ç»œç›‘æ§éœ€è¦å®æ—¶ä¸ŠæŠ¥ï¼Œè€Œç”¨æˆ·è¡Œä¸ºç›‘æ§åˆ™éœ€è¦æœ¬åœ°è½ç›˜ä¿å­˜ï¼Œåœ¨éœ€è¦çš„æ—¶å€™å†ä¸ŠæŠ¥ï¼Œæ‰€ä»¥å¦‚ä½•è½ç›˜ä¿å­˜åˆ™æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºæ­¤äº†è§£äº†java IOå’Œmmapã€‚</p><span id="more"></span><h2 id="æ…¢ç½‘ç»œç›‘æ§"><a href="#æ…¢ç½‘ç»œç›‘æ§" class="headerlink" title="æ…¢ç½‘ç»œç›‘æ§"></a>æ…¢ç½‘ç»œç›‘æ§</h2><p><strong>å«Œé•¿ä¸çœ‹ç›´æ¥çœ‹ç»“è®ºï¼Œä»£ç åœ¨è¿™ä¸€æ®µçš„æœ€åã€‚</strong></p><p>åœ¨æ„å»º<code>OkHttpClient</code>å¯¹è±¡æ—¶åŠ å…¥<code>eventListener</code>å³å¯ï¼Œå¦‚æœä¼šæœ‰å¤šä¸ªå¼‚æ­¥ç½‘ç»œåŒæ—¶è¯·æ±‚ï¼Œå°±æ·»åŠ <code>eventListenerFactory</code>ã€‚ä¸è®ºæ˜¯ä¸æ˜¯åŒæ—¶ä¼šæœ‰å¤šä¸ªå¼‚æ­¥ç½‘ç»œè¯·æ±‚ï¼Œä½¿ç”¨<code>eventListenerFactory</code>å·®è·ä¸å¤§ã€‚</p><p><strong>æ¯”è¾ƒå•°å—¦çš„è¯¦è§£ç¯‡</strong></p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ç½‘ç»œåŸºç¡€å†…å®¹ï¼š</p><ul><li>OSIä¸ƒå±‚æ¨¡å‹å’Œå®é™…åº”ç”¨ä¸­çš„äº”å±‚æ¨¡å‹</li><li>ä»€ä¹ˆæ˜¯Http</li><li>è¯·æ±‚æ–¹å¼ã€æŠ¥æ–‡ç»“æ„</li><li>TCPçš„ä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹</li><li>ä¸€æ¬¡å®Œæ•´çš„httpè¯·æ±‚è¿‡ç¨‹</li><li>Httpä¸åŒç‰ˆæœ¬çš„å·®å¼‚ã€ä¼˜ç¼ºç‚¹</li><li>httpå’Œhttpsçš„åŒºåˆ«</li></ul><p>ç›¸å…³çš„çŸ¥è¯†ç‚¹æ”¾åœ¨è¿™é‡Œäº†ï¼Œåˆ«äººå·²ç»å†™å¾—æ¯”è¾ƒå…¨é¢äº†ï¼Œå†æŠ„ä¸€éä¹Ÿæ²¡å•¥æ„æ€ :smiley:</p><p><a href="https://juejin.cn/post/6877362691350986766">é¢è¯•å®˜çš„è¿™ä»½HTTPçµé­‚è¿½é—®ä½ Holdä½å—ï¼Ÿ</a></p><p><a href="https://www.jianshu.com/p/b0aa797608c0">å…³äºHTTPè¯·æ±‚ä½ éœ€è¦çŸ¥é“çš„ä¸€åˆ‡</a></p><p>å½“æˆ‘ä»¬ä½¿ç”¨OkHttpè¿›è¡Œç½‘ç»œè¯·æ±‚çš„æ—¶å€™ï¼Œè¿‡ç¨‹ä¸€èˆ¬æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>æ„å»º<code>OkHttpClient</code></li><li>æ„å»º<code>Request</code></li><li>æ„å»º<code>Call</code></li><li>ä½¿ç”¨<code>Call</code>å¯¹è±¡è¿›è¡Œç½‘ç»œè¯·æ±‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">OkHttpClient</span> <span class="hljs-variable">okHttpClient</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpClient</span>.Builder()<br>        .eventListenerFactory(NetworkListener.get())<br>.addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Interceptor</span>() &#123;<br>    <span class="hljs-meta">@NotNull</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Response <span class="hljs-title function_">intercept</span><span class="hljs-params">(<span class="hljs-meta">@NotNull</span> Chain chain)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        Log.e(TAG,<span class="hljs-string">&quot;addInterceptor before proceed&quot;</span>);<br>        <span class="hljs-type">Response</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> chain.proceed(chain.request());<br>        Log.e(TAG,<span class="hljs-string">&quot;addInterceptor after proceed &quot;</span>);<br>        <span class="hljs-keyword">return</span> response;<br>    &#125;<br>&#125;)<br>.addNetworkInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Interceptor</span>() &#123;<br>    <span class="hljs-meta">@NotNull</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Response <span class="hljs-title function_">intercept</span><span class="hljs-params">(<span class="hljs-meta">@NotNull</span> Chain chain)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        Log.e(TAG,<span class="hljs-string">&quot;addNetworkInterceptor before proceed&quot;</span>);<br>        <span class="hljs-type">Response</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> chain.proceed(chain.request());<br>        Log.e(TAG,<span class="hljs-string">&quot;addNetworkInterceptor after proceed &quot;</span>);<br>        <span class="hljs-keyword">return</span> response;<br>    &#125;<br>&#125;)<br>        .build();<br><br><span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder()<br>        .url(<span class="hljs-string">&quot;.....&quot;</span>)<br>        .build();<br><span class="hljs-type">Call</span> <span class="hljs-variable">call</span> <span class="hljs-operator">=</span> okHttpClient.newCall(request);<br>call.enqueue(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Callback</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailure</span><span class="hljs-params">(<span class="hljs-meta">@NotNull</span> Call call, <span class="hljs-meta">@NotNull</span> IOException e)</span> &#123;<br>        <br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onResponse</span><span class="hljs-params">(<span class="hljs-meta">@NotNull</span> Call call, <span class="hljs-meta">@NotNull</span> Response response)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br><br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p>æµç¨‹å›¾å¦‚ä¸‹ï¼š</p><p><img src="/image/Android/okhttp/OkHttp%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt="OkHttpæµç¨‹å›¾"></p><p>æœ€ç»å…¸çš„åº”è¯¥æ˜¯æ‹¦æˆªå™¨éƒ¨åˆ†äº†ï¼Œç½‘ç»œå¯¹æ‹¦æˆªå™¨çš„åˆ†æä¹ŸæŒºå¤šäº†ï¼Œå¯ä»¥è‡ªå·±ç¿»ä¸€ä¸‹æºç æ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä¹Ÿå†™ä¸å‡ºèŠ±æ¥ :hushed:</p><p><img src="/image/Android/okhttp/OkHttp%E6%8B%A6%E6%88%AA%E5%99%A8.png" alt="OkHttpæµç¨‹å›¾"></p><p>å›¾ç‰‡æˆ‘æ˜¯ç”¨drawioç”»çš„ï¼Œæºæ–‡ä»¶æ”¾åœ¨äº†githubä¸Šï¼Œè·¯å¾„ <a href="https://github.com/huangyuanlove/huangyuanlove.github.io/tree/master/image/Android/okhttp">https://github.com/huangyuanlove/huangyuanlove.github.io/tree/master/image/Android/okhttp</a></p><p>ä¸‹é¢çš„æºç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkListener</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">EventListener</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;NetworkListener&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Factory <span class="hljs-title function_">get</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Factory</span>() &#123;<br>            <span class="hljs-meta">@NotNull</span><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> EventListener <span class="hljs-title function_">create</span><span class="hljs-params">(<span class="hljs-meta">@NotNull</span> Call call)</span> &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkListener</span>();<br>            &#125;<br>        &#125;;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">callStart</span><span class="hljs-params">(<span class="hljs-meta">@NotNull</span> Call call)</span> &#123;<br>        <span class="hljs-built_in">super</span>.callStart(call);<br>        Log.e(TAG,<span class="hljs-string">&quot;-------callStart---requestId-----&quot;</span>+mRequestId);<br>    &#125;<br><br><span class="hljs-comment">//é‡å†™çš„Nä¸ªå›è°ƒæ–¹æ³•</span><br>  .<br>  .<br>  .<br>  .<br>  .<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">callFailed</span><span class="hljs-params">(<span class="hljs-meta">@NotNull</span> Call call, <span class="hljs-meta">@NotNull</span> IOException ioe)</span> &#123;<br>        <span class="hljs-built_in">super</span>.callFailed(call, ioe);<br>        ioe.printStackTrace();<br>        Log.e(TAG, <span class="hljs-string">&quot;callFailed&quot;</span>);<br><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥åœ¨è¿™äº›å›è°ƒæ–¹æ³•ä¸­åšæ—¶é—´ç»Ÿè®¡ï¼Œè¶…è¿‡æŒ‡å®šæ—¶é•¿åˆ™è®¤ä¸ºæ˜¯æ…¢ç½‘ç»œè¯·æ±‚ã€‚</p><h2 id="é¡µé¢æ‰“å¼€å…³é—­ç›‘æ§"><a href="#é¡µé¢æ‰“å¼€å…³é—­ç›‘æ§" class="headerlink" title="é¡µé¢æ‰“å¼€å…³é—­ç›‘æ§"></a>é¡µé¢æ‰“å¼€å…³é—­ç›‘æ§</h2><p>ç»“è®ºï¼šåœ¨è‡ªå®šä¹‰çš„applicationä¸­è°ƒç”¨ä¸€ä¸‹<code>registerActivityLifecycleCallbacks(ActivityLifecycleCallbacks callback);</code>å°±å¥½ã€‚åœ¨æ¯ä¸ªActivityçš„ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œçš„æ—¶å€™éƒ½ä¼šå›è°ƒ<code>callback</code>.</p><h4 id="æ”¶é›†ä¿¡æ¯"><a href="#æ”¶é›†ä¿¡æ¯" class="headerlink" title="æ”¶é›†ä¿¡æ¯"></a>æ”¶é›†ä¿¡æ¯</h4><p>åœ¨Applicationä¸­æ³¨å†Œä¸€ä¸‹ç”Ÿå‘½å‘¨æœŸå›è°ƒæ¥å£:<code>registerActivityLifecycleCallbacks(ActivityLifecycleCallbacks callback);</code>å¹¶é‡å†™å„ç§å›è°ƒæ–¹æ³•ï¼Œè®°å½•å¯¹åº”çš„æ—¶é—´æˆ³+ç±»åã€‚ç”±äºç”Ÿå‘½å‘¨æœŸéƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹å›è°ƒï¼Œæˆ‘ä»¬ä¸å¿…æ‹…å¿ƒå¤šçº¿ç¨‹ç«äº‰é—®é¢˜ã€‚æä¸ªlistç›´æ¥å­˜ã€‚</p><h4 id="è½ç›˜ä¿å­˜"><a href="#è½ç›˜ä¿å­˜" class="headerlink" title="è½ç›˜ä¿å­˜"></a>è½ç›˜ä¿å­˜</h4><ol><li>åœ¨ä»€ä¹ˆæ—¶æœºä¿å­˜</li><li>å¦‚ä½•ä¿å­˜</li></ol><p>å¯¹äºé—®é¢˜1ï¼Œæˆ‘ä»¬åœ¨äº†è§£Handleræœºåˆ¶çš„æ—¶å€™ï¼Œæåˆ°è¿‡åœ¨<code>MessageQueue</code>é‡Œé¢æœ‰ä¸ªå¼€å‘è¿‡ç¨‹ä¸­ä¸å¸¸ç”¨çš„å¯¹è±¡:<code>IdleHandle</code>rï¼ŒæŸ¥çœ‹æºç å’Œæ³¨é‡Šæˆ‘ä»¬å¾—çŸ¥ï¼Œæ˜¯åœ¨çº¿ç¨‹çš„MessageQueueä¸­æ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ï¼Œä¼šå»è°ƒç”¨è¿™ä¸ªç±»çš„â€queueIdle()â€æ–¹æ³•ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•è¿”å›trueæ—¶ï¼Œä¸ä¼šè¢«ç§»é™¤é˜Ÿåˆ—ã€‚</p><p>æˆ‘ä»¬åœ¨Applicationä¸­å‘MainLooperçš„MessageQueueä¸­æ·»åŠ ä¸€ä¸ªIdleHandler</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">Looper.myQueue().addIdleHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageQueue</span>.IdleHandler() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">queueIdle</span><span class="hljs-params">()</span> &#123;<br>                Log.e(TAG,<span class="hljs-string">&quot;queueIdle,å½“å‰çº¿ç¨‹åç§°&quot;</span> + Thread.currentThread().getName()+<span class="hljs-string">&quot;,çº¿ç¨‹id:&quot;</span> +Thread.currentThread().getId());<br>                BehaviorRepository.getInstance(MyApplication.<span class="hljs-built_in">this</span>).storeLifeEvent();<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;);<br></code></pre></td></tr></table></figure><p>å¯¹äºå¦‚ä½•ä¿å­˜ï¼Œä¸€å¼€å§‹è€ƒè™‘çš„æ˜¯å†™åˆ°æ•°æ®åº“ï¼Œå› ä¸ºæœ‰äº‹åŠ¡ã€‚åæ¥ç»“åˆä¸šåŠ¡å‘ç°å¹¶ä¸éœ€è¦è¿™ä¹ˆæï¼Œç›´æ¥å†™æ–‡ä»¶å°±å¥½ï¼Œéœ€è¦çš„æ—¶å€™ç›´æ¥ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å»å†™æ–‡ä»¶ï¼Ÿæƒ³åˆ°äº†mmapè¿™è´§ã€‚å½“ä½¿ç”¨mmapæ–¹å¼å†™æ–‡ä»¶å¤±è´¥å†è€ƒè™‘ä½¿ç”¨æ™®é€šjava ioã€‚äºæ˜¯æœ‰äº†ä¸‹é¢ï¼šä¸‹é¢ä»£ç æ¥æºäºï¼š<a href="https://www.cnblogs.com/rustfisher/p/11551372.html">https://www.cnblogs.com/rustfisher/p/11551372.html</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogWriter</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;activityLifeRecorder&quot;</span>;<br><br><br>    <span class="hljs-comment">// æ³¨æ„ç”³è¯·SDå¡è¯»å†™æƒé™</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String logFileDir;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String fileName;<br><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> HandlerThread handlerThread;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Handler writerHandler;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">LOG_FILE_GROW_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">1024</span> * <span class="hljs-number">10</span>; <span class="hljs-comment">// logæ–‡ä»¶æ¯æ¬¡å¢é•¿çš„å¤§å°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-variable">gCurrentLogPos</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;                  <span class="hljs-comment">// logæ–‡ä»¶å½“å‰å†™åˆ°çš„ä½ç½® - æ³¨æ„è¦å•çº¿ç¨‹å¤„ç†</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä½¿ç”¨å‰å¿…é¡»è°ƒç”¨æ­¤æ–¹æ³•è¿›è¡Œå‡†å¤‡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(Context context)</span>&#123;<br>        gCurrentLogPos = <span class="hljs-number">0</span>;<br>        logFileDir = context.getCacheDir() + File.separator + <span class="hljs-string">&quot;logs&quot;</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == handlerThread) &#123;<br>            handlerThread = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HandlerThread</span>(<span class="hljs-string">&quot;LL&quot;</span>);<br>            handlerThread.start();<br>        &#125;<br>        writerHandler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>(handlerThread.getLooper());<br><br><br>        <span class="hljs-comment">//å¯ä»¥ä¿å­˜æœ¬æ¬¡æ‰“å¼€çš„æ—¥å¿—ï¼Œåªä¿å­˜ä¸‰äº”æ¬¡æ‰“å¼€çš„æ—¥å¿—</span><br>        fileName = <span class="hljs-string">&quot;_&quot;</span> +  <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>,Locale.CHINA).format(System.currentTimeMillis()) + <span class="hljs-string">&quot;.txt&quot;</span>;<br>        Log.d(TAG, <span class="hljs-string">&quot;[prepare] file: &quot;</span> + fileName);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getFileName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> fileName;<br>    &#125;<br><br>    <span class="hljs-comment">// é€€å‡º</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quit</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (writerHandler != <span class="hljs-literal">null</span>) &#123;<br>            writerHandler.removeCallbacksAndMessages(<span class="hljs-literal">null</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (handlerThread != <span class="hljs-literal">null</span>) &#123;<br>            handlerThread.quit();<br>        &#125;<br>    &#125;<br><br><br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeToFile</span><span class="hljs-params">(String content)</span>&#123;<br>        <span class="hljs-keyword">if</span> (writerHandler != <span class="hljs-literal">null</span>) &#123;<br>            writerHandler.post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WriteRunnable</span>(content));<br>        &#125;<br>    &#125;<br><br><br><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WriteRunnable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> &#123;<br>        String  content;<br><br>        WriteRunnable( String content) &#123;<br>            <span class="hljs-built_in">this</span>.content = content;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">File</span> <span class="hljs-variable">dir</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(logFileDir);<br>                <span class="hljs-keyword">if</span> (!dir.exists()) &#123;<br>                    <span class="hljs-type">boolean</span> <span class="hljs-variable">mk</span> <span class="hljs-operator">=</span> dir.mkdirs();<br>                    Log.d(TAG, <span class="hljs-string">&quot;make dir &quot;</span> + mk);<br>                &#125;<br>                <span class="hljs-type">File</span> <span class="hljs-variable">eFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(logFileDir + File.separator + fileName);<br>                <span class="hljs-type">byte</span>[] strBytes = content.getBytes();<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-type">RandomAccessFile</span> <span class="hljs-variable">randomAccessFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RandomAccessFile</span>(eFile, <span class="hljs-string">&quot;rw&quot;</span>);<br>                    MappedByteBuffer mappedByteBuffer;<br>                    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">inputLen</span> <span class="hljs-operator">=</span> strBytes.length;<br>                    <span class="hljs-keyword">if</span> (!eFile.exists()) &#123;<br>                        <span class="hljs-type">boolean</span> <span class="hljs-variable">nf</span> <span class="hljs-operator">=</span> eFile.createNewFile();<br>                        Log.d(TAG, <span class="hljs-string">&quot;new log file &quot;</span> + nf);<br>                        mappedByteBuffer = randomAccessFile.getChannel().map(FileChannel.MapMode.READ_WRITE, gCurrentLogPos, LOG_FILE_GROW_SIZE);<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        mappedByteBuffer = randomAccessFile.getChannel().map(FileChannel.MapMode.READ_WRITE, gCurrentLogPos, inputLen);<br>                    &#125;<br>                    <span class="hljs-keyword">if</span> (mappedByteBuffer.remaining() &lt; inputLen) &#123;<br>                        mappedByteBuffer = randomAccessFile.getChannel().map(FileChannel.MapMode.READ_WRITE, gCurrentLogPos, LOG_FILE_GROW_SIZE + inputLen);<br>                    &#125;<br>                    mappedByteBuffer.put(strBytes);<br>                    gCurrentLogPos += inputLen;<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    Log.e(TAG, <span class="hljs-string">&quot;WriteRunnable run: &quot;</span>, e);<br>                    <span class="hljs-keyword">if</span> (!eFile.exists()) &#123;<br>                        <span class="hljs-type">boolean</span> <span class="hljs-variable">nf</span> <span class="hljs-operator">=</span> eFile.createNewFile();<br>                        Log.d(TAG, <span class="hljs-string">&quot;new log file &quot;</span> + nf);<br>                    &#125;<br>                    <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">os</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(eFile, <span class="hljs-literal">true</span>);<br>                    os.write(content.getBytes());<br>                    os.flush();<br>                    os.close();<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>                Log.e(TAG, <span class="hljs-string">&quot;å†™logæ–‡ä»¶å‡ºé”™: &quot;</span>, e);<br>            &#125;<br>        &#125;<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Sentryæ­å»ºåŠAndroidæ¥å…¥</title>
    <link href="/2021/05/22/Sentry%E6%90%AD%E5%BB%BA%E5%8F%8AAndroid%E6%8E%A5%E5%85%A5/"/>
    <url>/2021/05/22/Sentry%E6%90%AD%E5%BB%BA%E5%8F%8AAndroid%E6%8E%A5%E5%85%A5/</url>
    
    <content type="html"><![CDATA[<p>å› ä¸ºsentryå¯ä»¥ç§æœ‰åŒ–éƒ¨ç½²ï¼Œç›¸æ¯”èµ·buglyï¼Œæˆ‘ä»¬å¯ä»¥åšè·Ÿå¤šçš„å•ç‹¬å®šåˆ¶åŠŸèƒ½ï¼Œæ‰€ä»¥å†³å®šå°†éœ€è¦å³æ—¶ä¸ŠæŠ¥çš„æ—¥å¿—æ”¾åœ¨sentryä¸Šã€‚</p><p>æ­å»ºç¯å¢ƒï¼š</p><ol><li>Ubuntu18.04 64ä½</li><li>sentryç‰ˆæœ¬21.5.1</li></ol><p>ç¯å¢ƒè¦æ±‚ï¼š</p><ul><li>Docker 19.03.6+</li><li>Compose 1.24.1+</li><li>4 CPU Cores</li><li>8 GB RAM</li><li>20 GB Free Disk Space</li></ul><p>ç”±äºsentryéœ€è¦ä½¿ç”¨redisã€postgreSQLï¼Œæ‰€ä»¥é€‰åœ¨äº†åœ¨æ–°çš„è™šæ‹Ÿæœºä¸Šè¿›è¡Œéƒ¨ç½²</p><span id="more"></span><h4 id="å®‰è£…docker"><a href="#å®‰è£…docker" class="headerlink" title="å®‰è£…docker"></a>å®‰è£…docker</h4><p>ç›®å‰æ˜¯åœ¨Ubuntu18.04ä¸Šä½¿ç”¨debæ–‡ä»¶å®‰è£…çš„ã€‚å®˜æ–¹æŒ‡å¯¼åœ¨è¿™é‡Œ<a href="https://docs.docker.com/engine/install/ubuntu/">https://docs.docker.com/engine/install/ubuntu/</a></p><p>åœ¨ <a href="https://download.docker.com/linux/ubuntu/dists/">https://download.docker.com/linux/ubuntu/dists/</a> è¿™é‡Œé€‰æ‹©ä¸€ä¸‹è‡ªå·±ubuntuçš„ç³»ç»Ÿå¯¹åº”çš„æ–‡ä»¶å¤¹(ä¹Ÿå°±æ˜¯ç³»ç»Ÿç‰ˆæœ¬ä»£å·)ï¼Œæ¯”å¦‚18.04å¯¹åº”<code>bionic</code>ï¼Œç„¶åè¿›å…¥<code>pool/stable</code>æ–‡ä»¶å¤¹ï¼Œé€‰æ‹©å¯¹åº”çš„ç³»ç»Ÿç¯å¢ƒï¼Œæ¯”å¦‚ubuntu 18.04 64ä½ï¼Œå¯¹åº”çš„åœ°å€åº”è¯¥æ˜¯<code>https://download.docker.com/linux/ubuntu/dists/bionic/pool/stable/amd64/</code>,ç„¶åä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„è½¯ä»¶ï¼Œæˆ‘ç°åœ¨ä¸‹è½½çš„æ˜¯</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">containerd</span>.io_1.<span class="hljs-number">4</span>.<span class="hljs-number">4</span>-<span class="hljs-number">1</span>_amd64.deb <br><span class="hljs-attribute">docker</span>-ce-cli_20.<span class="hljs-number">10</span>.<span class="hljs-number">6</span>~<span class="hljs-number">3</span>-<span class="hljs-number">0</span>~ubuntu-bionic_amd64.deb <br><span class="hljs-attribute">docker</span>-ce_20.<span class="hljs-number">10</span>.<span class="hljs-number">6</span>~<span class="hljs-number">3</span>-<span class="hljs-number">0</span>~ubuntu-bionic_amd64.deb<br></code></pre></td></tr></table></figure><p>ç„¶åæŒ‰ç…§é¡ºåºå®‰è£…ï¼Œå®‰è£…å®Œæˆåç¡®è®¤æ˜¯å¦å®‰è£…æˆåŠŸï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo docker run hello-world<br></code></pre></td></tr></table></figure><p>è¿™æ¡å‘½ä»¤ä¼šä¸‹è½½æµ‹è¯•é•œåƒå¹¶è¿è¡Œï¼Œå¦‚æœå®‰è£…æˆåŠŸï¼Œåˆ™ä¼šåœ¨ç»ˆç«¯æ‰“å°å¯¹åº”ä¿¡æ¯</p><p>å¦‚æœä¸Šé¢çš„ä¸‹è½½åœ°å€æ— æ³•è®¿é—®çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨å›½å†…çš„æ¸…åå¤§å­¦é•œåƒæºï¼Œåœ°å€æ˜¯ <code>https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/ubuntu/dists/bionic/pool/stable/amd64/</code></p><h4 id="å®‰è£…docker-compose"><a href="#å®‰è£…docker-compose" class="headerlink" title="å®‰è£…docker-compose"></a>å®‰è£…docker-compose</h4><p>è®¿é—® <a href="https://github.com/docker/compose/releases/tag/1.29.2">https://github.com/docker/compose/releases/tag/1.29.2</a> ä¸‹è½½linuxç‰ˆæœ¬ï¼Œæ–‡ä»¶åå­—æ”¹æˆ<code>docker-compose</code>ï¼Œæ·»åŠ æ‰§è¡Œæƒé™ï¼Œå¹¶å¤åˆ¶åˆ°<code> /usr/local/bin/</code>æ–‡ä»¶å¤¹ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">mv docker-compose-Linux-x86_64 docker-compose<br>chmox +x docker-compose<br>sudo cp docker-compose  /usr/local/bin/<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œ <code>docker-compose -v</code>å‘½ä»¤ï¼Œèƒ½æ‰“å°å‡ºç‰ˆæœ¬ä¿¡æ¯è¯æ˜å®‰è£…ç¨‹å›½å¹³</p><h4 id="å®‰è£…sentry"><a href="#å®‰è£…sentry" class="headerlink" title="å®‰è£…sentry"></a>å®‰è£…sentry</h4><p>è®¿é—® <a href="https://github.com/getsentry/onpremise">https://github.com/getsentry/onpremise</a> å¹¶å…‹éš†ä¸‹æ¥è¯¥ä»“åº“ï¼Œä»“åº“åœ°å€ä¸ºï¼š<code>git@github.com:getsentry/onpremise.git</code> æˆ–è€…<code> https://github.com/getsentry/onpremise.git</code>,æ‰§è¡Œæ–‡ä»¶å¤¹ä¸­çš„<code>install.sh</code>ã€‚è¿‡ç¨‹ä¼šæ¯”è¾ƒæ¼«é•¿ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šè®©ä½ åˆ›å»ºsentryçš„ç”¨æˆ·ï¼Œè¾“å…¥é‚®ç®±å’Œå¯†ç ã€‚è¿™ä¸ªç”¨æˆ·ä¹Ÿå°±æ˜¯ä½ ä¹‹åç™»é™†sentryç½‘é¡µä½¿ç”¨çš„è´¦å·å¯†ç ã€‚</p><p>å®‰è£…è¿‡ç¨‹ä¸­éœ€è¦æ‹‰å–dockeré•œåƒï¼Œä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œæœ‰å¾ˆå¤§å¯èƒ½ä¼šå¤±è´¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†dockerçš„é•œåƒæºæ›¿æ¢ä¸ºå›½å†…çš„ï¼Œæ¯”å¦‚ä¸­ç§‘å¤§ã€‚ubuntuä¸‹æ›¿æ¢æ–¹å¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">vi /etc/docker/daemon.json<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ–‡ä»¶å†…å®¹</span><br>&#123;<br>    &quot;registry-mirrors&quot;: [&quot;https://docker.mirrors.ustc.edu.cn&quot;]<br>&#125;<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿å­˜åæ‰§è¡Œ</span><br>systemctl restart docker.service<br></code></pre></td></tr></table></figure><h4 id="å¯åŠ¨åŠä½¿ç”¨"><a href="#å¯åŠ¨åŠä½¿ç”¨" class="headerlink" title="å¯åŠ¨åŠä½¿ç”¨"></a>å¯åŠ¨åŠä½¿ç”¨</h4><p>åœ¨ä¸Šä¸€æ­¥å®‰è£…å®Œæˆåçš„æ§åˆ¶å°ä¼šå‘Šè¯‰ä½ å¯åŠ¨sentryæœåŠ¡çš„å‘½ä»¤<code>docker-compose up -d</code>ï¼Œ</p><p>åœ¨æµè§ˆå™¨ä¸­è®¿é—®sentryæœåŠ¡å™¨çš„ip:9000ï¼Œ è¾“å…¥ä¸Šä¸€æ­¥åˆ›å»ºçš„é‚®ç®±å’Œå¯†ç å°±å¯ä»¥ç™»å½•äº†ã€‚æ¥ä¸‹æ¥å¯ä»¥è·Ÿç€å¼•å¯¼æŸ¥çœ‹ä¸€ä¸‹åŸºæœ¬åŠŸèƒ½çš„ä½¿ç”¨ã€‚</p><p>ç°åœ¨æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªAndroidåº”ç”¨ï¼Œåˆ›å»ºå¥½äº†ä¹‹åä¼šæœ‰å¯¹åº”çš„å¼•å¯¼æç¤ºå¦‚ä½•åœ¨Androidä¸­ä½¿ç”¨sentryã€‚</p><ol><li><p>æ·»åŠ ä»“åº“</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs groovy">repositories &#123;<br>  mavenCentral()<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ·»åŠ ä¾èµ–</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">implementation <span class="hljs-string">&#x27;io.sentry:sentry-android:4.3.0&#x27;</span><br></code></pre></td></tr></table></figure></li><li><p>åœ¨Androidmanifest.xmlä¸­æ·»åŠ åº”ç”¨ä¿¡æ¯</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">application</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta-data</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;io.sentry.dsn&quot;</span> <span class="hljs-attr">android:value</span>=<span class="hljs-string">&quot;http://b3a3844e753f4734b7ca1d6b154e6e06@192.168.102.181:9000/2&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">application</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„valueå€¼å¯ä»¥åœ¨sentryé¡¹ç›®è®¾ç½®ä¸­æ‰¾åˆ°ã€‚</p></li><li><p>ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> io.sentry.Breadcrumb;<br><span class="hljs-keyword">import</span> io.sentry.Sentry;<br><span class="hljs-keyword">import</span> io.sentry.SentryEvent;<br><span class="hljs-keyword">import</span> io.sentry.SentryLevel;<br><span class="hljs-keyword">import</span> io.sentry.protocol.Message;<br><span class="hljs-keyword">import</span> io.sentry.protocol.User;<br><br>Sentry.captureMessage(<span class="hljs-string">&quot;captureMessage INFO&quot;</span>, SentryLevel.INFO);<br>Sentry.captureException(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(<span class="hljs-string">&quot;exception&quot;</span>));<br>Sentry.captureEvent(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SentryEvent</span>());<br><span class="hljs-comment">//è®¾ç½®å…¨å±€ç”¨æˆ·ä¿¡æ¯</span><br><span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>user.setEmail(<span class="hljs-string">&quot;a@a.com&quot;</span>);<br><span class="hljs-type">String</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();<br>user.setId(userId);<br>Sentry.setUser(user);<br></code></pre></td></tr></table></figure></li></ol><h4 id="å…³äºæ··æ·†"><a href="#å…³äºæ··æ·†" class="headerlink" title="å…³äºæ··æ·†"></a>å…³äºæ··æ·†</h4><p>å¦‚æœåº”ç”¨ç»è¿‡æ··æ·†ï¼Œæˆ‘ä»¬éœ€è¦å°†mappingæ–‡ä»¶ä¸Šä¼ åˆ°sentryå¹³å°ï¼Œæ‰èƒ½å®šä½åˆ°é”™è¯¯ä»£ç æ‰€åœ¨ä½ç½®ã€‚</p><p>é¦–å…ˆåœ¨<code>app/build.gradle</code>ä¸­æ·»åŠ pluginï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;io.sentry.android.gradle&#x27;</span><br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨å·¥ç¨‹æ ¹ç›®å½•ä¸‹çš„<code>build.gradle</code>æ–‡ä»¶ä¸­æ·»åŠ </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs groovy">dependencies &#123;<br>        classpath <span class="hljs-string">&#x27;io.sentry:sentry-android-gradle-plugin:1.7.36&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜éœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ·»åŠ ä¸€ä¸ª<code>sentry.properties</code>æ–‡ä»¶ï¼Œç”¨æ¥é…ç½®æˆ‘ä»¬çš„mappingæ–‡ä»¶ä¸Šä¼ åˆ°å“ªä¸ªé¡¹ç›®ä¸­</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">defaults.project</span>=<span class="hljs-string">your-project</span><br><span class="hljs-attr">defaults.org</span>=<span class="hljs-string">your-org</span><br><span class="hljs-attr">auth.token</span>=<span class="hljs-string">YOUR_AUTH_TOKEN</span><br><span class="hljs-attr">defaults.url</span>=<span class="hljs-string">your sentry service address</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„orgçš„å€¼åœ¨<code>Organization Settings</code>ä¸­æŸ¥çœ‹ï¼Œæ˜¯<code>Organization Slug</code>çš„å€¼ï¼Œè€Œä¸æ˜¯<code>Display Name</code>çš„å€¼</p><p><img src="/image/sentry_upload_mapping.png" alt="sentry_upload_mapping"></p><p>tokenå€¼åœ¨ä¸Šå›¾ä¸­çš„ <code>API keys</code>é‡Œé¢ï¼Œæ²¡æœ‰çš„è¯åˆ›å»ºä¸€ä¸ªæ–°çš„å°±å¥½ï¼Œæƒé™æˆ‘æ˜¯ç”¨çš„é»˜è®¤ã€‚</p><p>ç„¶åæˆ‘ä»¬æ‰“ä¸ªreleaseåŒ…ï¼Œä¸Šä¼ æˆåŠŸåä¼šåœ¨æ§åˆ¶å°æ‰“å°å‡ºå¯¹åº”ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥åœ¨é¡¹ç›®è®¾ç½® <code>ProGuard</code>ä¸­æ‰¾åˆ°ä¸Šä¼ çš„mappingæ–‡ä»¶ã€‚</p><p>å¦‚æœä¸å¸Œæœ›è‡ªåŠ¨ä¸Šä¼ mappingï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶å…³é—­ï¼Œä½¿ç”¨<code>sentry-cli</code>è¿›è¡Œæ‰‹åŠ¨ä¸Šä¼ </p><p>åœ¨<code>app/build.gradle</code>ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs groovy">sentry &#123;<br>    <span class="hljs-comment">// Disables or enables the automatic configuration of ProGuard</span><br>    <span class="hljs-comment">// for Sentry.  This injects a default config for ProGuard so</span><br>    <span class="hljs-comment">// you don&#x27;t need to do it manually.</span><br><br>    <span class="hljs-comment">// Only enable it if you are using sentry-android &lt;= v1.7,</span><br>    <span class="hljs-comment">// sentry-android &gt;= v2.0 already does it automatically.</span><br>    autoProguardConfig <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment">// Enables or disables the automatic upload of mapping files</span><br>    <span class="hljs-comment">// during a build.  If you disable this, you&#x27;ll need to manually</span><br>    <span class="hljs-comment">// upload the mapping files with sentry-cli when you do a release.</span><br>    autoUpload <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment">// Disables or enables the automatic configuration of Native Symbols</span><br>    <span class="hljs-comment">// for Sentry. This executes sentry-cli automatically so</span><br>    <span class="hljs-comment">// you don&#x27;t need to do it manually.</span><br>    <span class="hljs-comment">// Default is disabled.</span><br>    uploadNativeSymbols <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment">// Does or doesn&#x27;t include the source code of native code for Sentry.</span><br>    <span class="hljs-comment">// This executes sentry-cli with the --include-sources param. automatically so</span><br>    <span class="hljs-comment">// you don&#x27;t need to do it manually.</span><br>    <span class="hljs-comment">// Default is disabled.</span><br>    includeNativeSources <span class="hljs-literal">false</span><br>&#125;<br></code></pre></td></tr></table></figure><p>sentry-cliçš„å®‰è£…åœ¨è¿™é‡Œ <a href="https://docs.sentry.io/product/cli/installation/">https://docs.sentry.io/product/cli/installation/</a></p><p>sentry-cliçš„é…ç½® <a href="https://docs.sentry.io/product/cli/configuration/">https://docs.sentry.io/product/cli/configuration/</a></p><p>sentry-cli çš„ä½¿ç”¨ <a href="https://docs.sentry.io/product/cli/dif/#proguard-mapping-upload">https://docs.sentry.io/product/cli/dif/#proguard-mapping-upload</a></p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>è¿ç»´</tag>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Androidä¸­çš„å•å…ƒæµ‹è¯•</title>
    <link href="/2021/04/25/Android%E4%B8%AD%E7%9A%84%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/"/>
    <url>/2021/04/25/Android%E4%B8%AD%E7%9A%84%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<h4 id="çº¯javaä»£ç çš„å•å…ƒæµ‹è¯•"><a href="#çº¯javaä»£ç çš„å•å…ƒæµ‹è¯•" class="headerlink" title="çº¯javaä»£ç çš„å•å…ƒæµ‹è¯•"></a>çº¯javaä»£ç çš„å•å…ƒæµ‹è¯•</h4><p>è¿™é‡Œçš„çº¯javaä»£ç æŒ‡çš„æ˜¯ä¸åŒ…å«AndroidåŒ…ä¸­çš„ä»£ç ï¼Œæˆ‘ä»¬ä½¿ç”¨Junitå†™å•å…ƒæµ‹è¯•å³å¯ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥æ ¼å¼åŒ–æ•°å­—ï¼Œè¿”å›ä¿ç•™ä¸¤ä½å°æ•°åçš„å­—ç¬¦ä¸²ï¼Œæ–¹æ³•å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">numberFormat</span><span class="hljs-params">(<span class="hljs-type">double</span> number)</span>&#123;<br>  <span class="hljs-keyword">return</span> String.format(Locale.getDefault(),<span class="hljs-string">&quot;%.2f&quot;</span>,number);<br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬çš„å•å…ƒæµ‹è¯•å¯ä»¥è¿™ä¹ˆå†™ï¼Œä¾èµ–ä¸€ä¸‹junitæµ‹è¯•æ¡†æ¶<code>testImplementation &#39;junit:junit:4.+&#39;</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.junit.Test;<br><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.junit.Assert.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExampleUnitTest</span> &#123;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testNumberFormat</span><span class="hljs-params">()</span>&#123;<br>        assertEquals(<span class="hljs-string">&quot;0.23&quot;</span>,Util.numberFormat(<span class="hljs-number">0.232323</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><span id="more"></span><p>è¿™é‡Œè¯´æ˜ä¸€ä¸‹ï¼Œæˆ‘ä»¬åœ¨å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œç»å¸¸ä¼šéœ€è¦åˆå§‹åŒ–ä¸€äº›æ•°æ®ï¼Œä½†æˆ‘ä»¬åˆä¸æƒ³åœ¨æ¯ä¸ªæµ‹è¯•æ–¹æ³•ä¸­éƒ½è°ƒç”¨ä¸€éåˆå§‹åŒ–çš„æ–¹æ³•ï¼Œè¿™é‡Œæµ‹è¯•æ¡†æ¶ç»™å‡ºäº†å››ä¸ªæ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@BeforeClass</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> &#123;<br><br>&#125;<br><span class="hljs-meta">@Before</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUp</span><span class="hljs-params">()</span>&#123;<br><br>&#125;<br><span class="hljs-meta">@After</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">tearDown</span><span class="hljs-params">()</span>&#123;<br><br>&#125;<br><span class="hljs-meta">@AfterClass</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span>&#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>@BeforeClass:åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œä¿®é¥°çš„æ–¹æ³•å¿…é¡»æ˜¯é™æ€çš„</li><li>@AfterClassï¼šåªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œä¿®é¥°çš„æ–¹æ³•å¿…é¡»æ˜¯é™æ€çš„</li><li>@Beforeï¼šæ¯æ¬¡è°ƒç”¨æµ‹è¯•æ–¹æ³•æ—¶éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡</li><li>@Afterï¼šæ¯æ¬¡æµ‹è¯•æ–¹æ³•æ‰§è¡Œå®Œæˆåéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡</li></ul><h4 id="ä»£ç ä¸­åŒ…å«Androidä»£ç "><a href="#ä»£ç ä¸­åŒ…å«Androidä»£ç " class="headerlink" title="ä»£ç ä¸­åŒ…å«Androidä»£ç "></a>ä»£ç ä¸­åŒ…å«Androidä»£ç </h4><p>ä½†æ˜¯ï¼Œå‡å¦‚æˆ‘ä»¬çš„ä»£ç ä¸­ä¸å°å¿ƒâ€æ··å…¥â€äº†ä¸€äº›è°ƒç”¨AndroidåŒ…çš„åŠŸèƒ½ï¼Œæ¯”å¦‚éªŒè¯é‚®ç®±çš„æœ‰æ•ˆæ€§ï¼Œä»£ç å¯èƒ½æ˜¯è¿™æ ·çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> android.util.Patterns;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmailAddress</span><span class="hljs-params">(String address)</span>&#123;<br>  <span class="hljs-keyword">return</span> Patterns.EMAIL_ADDRESS.matcher(address).matches();<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå¯¼å…¥äº† android.utilåŒ…ï¼Œå¦‚æœä½¿ç”¨junitçš„è¯ï¼Œåœ¨å•å…ƒæµ‹è¯•ä»£ç ä¸­ä¼šæŠ¥ä¸€ä¸ªç©ºæŒ‡é’ˆå¼‚å¸¸</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testEmailAddress</span><span class="hljs-params">()</span>&#123;<br>  Assert.assertTrue(Util.isEmailAddress(<span class="hljs-string">&quot;gg@gg.com&quot;</span>));<br>  Assert.assertTrue(Util.isEmailAddress(<span class="hljs-string">&quot;huangyuan@chunyu.me&quot;</span>));<br>  Assert.assertFalse(Util.isEmailAddress(<span class="hljs-string">&quot;wwww&quot;</span>));<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs verilog">java<span class="hljs-variable">.lang</span><span class="hljs-variable">.NullPointerException</span><br>at com<span class="hljs-variable">.huangyuanlove</span><span class="hljs-variable">.tdd_demo</span><span class="hljs-variable">.Util</span><span class="hljs-variable">.isEmailAddress</span>(Util<span class="hljs-variable">.java</span>:<span class="hljs-number">15</span>)<br>at com<span class="hljs-variable">.huangyuanlove</span><span class="hljs-variable">.tdd_demo</span><span class="hljs-variable">.ExampleUnitTest</span><span class="hljs-variable">.testEmailAddress</span>(ExampleUnitTest<span class="hljs-variable">.java</span>:<span class="hljs-number">27</span>)<br>at sun<span class="hljs-variable">.reflect</span><span class="hljs-variable">.NativeMethodAccessorImpl</span><span class="hljs-variable">.invoke0</span>(Native Method)<br>at sun<span class="hljs-variable">.reflect</span><span class="hljs-variable">.NativeMethodAccessorImpl</span><span class="hljs-variable">.invoke</span>(NativeMethodAccessorImpl<span class="hljs-variable">.java</span>:<span class="hljs-number">62</span>)<br>at sun<span class="hljs-variable">.reflect</span><span class="hljs-variable">.DelegatingMethodAccessorImpl</span><span class="hljs-variable">.invoke</span>(DelegatingMethodAccessorImpl<span class="hljs-variable">.java</span>:<span class="hljs-number">43</span>)<br>at java<span class="hljs-variable">.lang</span><span class="hljs-variable">.reflect</span><span class="hljs-variable">.Method</span><span class="hljs-variable">.invoke</span>(Method<span class="hljs-variable">.java</span>:<span class="hljs-number">498</span>)<br>at org<span class="hljs-variable">.junit</span><span class="hljs-variable">.runners</span><span class="hljs-variable">.model</span><span class="hljs-variable">.FrameworkMethod</span>$<span class="hljs-number">1</span><span class="hljs-variable">.runReflectiveCall</span>(FrameworkMethod<span class="hljs-variable">.java</span>:<span class="hljs-number">59</span>)<br>at org<span class="hljs-variable">.junit</span><span class="hljs-variable">.internal</span><span class="hljs-variable">.runners</span><span class="hljs-variable">.model</span><span class="hljs-variable">.ReflectiveCallable</span><span class="hljs-variable">.run</span>(ReflectiveCallable<span class="hljs-variable">.java</span>:<span class="hljs-number">12</span>)<br>at org<span class="hljs-variable">.junit</span><span class="hljs-variable">.runners</span><span class="hljs-variable">.model</span><span class="hljs-variable">.FrameworkMethod</span><span class="hljs-variable">.invokeExplosively</span>(FrameworkMethod<span class="hljs-variable">.java</span>:<span class="hljs-number">56</span>)<br>at org<span class="hljs-variable">.junit</span><span class="hljs-variable">.internal</span><span class="hljs-variable">.runners</span><span class="hljs-variable">.statements</span><span class="hljs-variable">.InvokeMethod</span><span class="hljs-variable">.evaluate</span>(InvokeMethod<span class="hljs-variable">.java</span>:<span class="hljs-number">17</span>)<br>at org<span class="hljs-variable">.junit</span><span class="hljs-variable">.runners</span><span class="hljs-variable">.ParentRunner</span>$<span class="hljs-number">3</span><span class="hljs-variable">.evaluate</span>(ParentRunner<span class="hljs-variable">.java</span>:<span class="hljs-number">306</span>)<br>at org<span class="hljs-variable">.junit</span><span class="hljs-variable">.runners</span><span class="hljs-variable">.BlockJUnit4ClassRunner</span>$<span class="hljs-number">1</span><span class="hljs-variable">.evaluate</span>(BlockJUnit4ClassRunner<span class="hljs-variable">.java</span>:<span class="hljs-number">100</span>)<br>at org<span class="hljs-variable">.junit</span><span class="hljs-variable">.runners</span><span class="hljs-variable">.ParentRunner</span><span class="hljs-variable">.runLeaf</span>(ParentRunner<span class="hljs-variable">.java</span>:<span class="hljs-number">366</span>)<br>at org<span class="hljs-variable">.junit</span><span class="hljs-variable">.runners</span><span class="hljs-variable">.BlockJUnit4ClassRunner</span><span class="hljs-variable">.runChild</span>(BlockJUnit4ClassRunner<span class="hljs-variable">.java</span>:<span class="hljs-number">103</span>)<br>at org<span class="hljs-variable">.junit</span><span class="hljs-variable">.runners</span><span class="hljs-variable">.BlockJUnit4ClassRunner</span><span class="hljs-variable">.runChild</span>(BlockJUnit4ClassRunner<span class="hljs-variable">.java</span>:<span class="hljs-number">63</span>)<br>at org<span class="hljs-variable">.junit</span><span class="hljs-variable">.runners</span><span class="hljs-variable">.ParentRunner</span>$<span class="hljs-number">4</span><span class="hljs-variable">.run</span>(ParentRunner<span class="hljs-variable">.java</span>:<span class="hljs-number">331</span>)<br>at org<span class="hljs-variable">.junit</span><span class="hljs-variable">.runners</span><span class="hljs-variable">.ParentRunner</span>$<span class="hljs-number">1</span><span class="hljs-variable">.schedule</span>(ParentRunner<span class="hljs-variable">.java</span>:<span class="hljs-number">79</span>)<br>at org<span class="hljs-variable">.junit</span><span class="hljs-variable">.runners</span><span class="hljs-variable">.ParentRunner</span><span class="hljs-variable">.runChildren</span>(ParentRunner<span class="hljs-variable">.java</span>:<span class="hljs-number">329</span>)<br>at org<span class="hljs-variable">.junit</span><span class="hljs-variable">.runners</span><span class="hljs-variable">.ParentRunner</span><span class="hljs-variable">.access</span>$<span class="hljs-number">100</span>(ParentRunner<span class="hljs-variable">.java</span>:<span class="hljs-number">66</span>)<br>at org<span class="hljs-variable">.junit</span><span class="hljs-variable">.runners</span><span class="hljs-variable">.ParentRunner</span>$<span class="hljs-number">2</span><span class="hljs-variable">.evaluate</span>(ParentRunner<span class="hljs-variable">.java</span>:<span class="hljs-number">293</span>)<br>at org<span class="hljs-variable">.junit</span><span class="hljs-variable">.runners</span><span class="hljs-variable">.ParentRunner</span>$<span class="hljs-number">3</span><span class="hljs-variable">.evaluate</span>(ParentRunner<span class="hljs-variable">.java</span>:<span class="hljs-number">306</span>)<br>at org<span class="hljs-variable">.junit</span><span class="hljs-variable">.runners</span><span class="hljs-variable">.ParentRunner</span><span class="hljs-variable">.run</span>(ParentRunner<span class="hljs-variable">.java</span>:<span class="hljs-number">413</span>)<br>at org<span class="hljs-variable">.junit</span><span class="hljs-variable">.runner</span><span class="hljs-variable">.JUnitCore</span><span class="hljs-variable">.run</span>(JUnitCore<span class="hljs-variable">.java</span>:<span class="hljs-number">137</span>)<br>at com<span class="hljs-variable">.intellij</span><span class="hljs-variable">.junit4</span><span class="hljs-variable">.JUnit4IdeaTestRunner</span><span class="hljs-variable">.startRunnerWithArgs</span>(JUnit4IdeaTestRunner<span class="hljs-variable">.java</span>:<span class="hljs-number">68</span>)<br>at com<span class="hljs-variable">.intellij</span><span class="hljs-variable">.rt</span><span class="hljs-variable">.junit</span><span class="hljs-variable">.IdeaTestRunner</span>$Repeater<span class="hljs-variable">.startRunnerWithArgs</span>(IdeaTestRunner<span class="hljs-variable">.java</span>:<span class="hljs-number">33</span>)<br>at com<span class="hljs-variable">.intellij</span><span class="hljs-variable">.rt</span><span class="hljs-variable">.junit</span><span class="hljs-variable">.JUnitStarter</span><span class="hljs-variable">.prepareStreamsAndStart</span>(JUnitStarter<span class="hljs-variable">.java</span>:<span class="hljs-number">230</span>)<br>at com<span class="hljs-variable">.intellij</span><span class="hljs-variable">.rt</span><span class="hljs-variable">.junit</span><span class="hljs-variable">.JUnitStarter</span><span class="hljs-variable">.main</span>(JUnitStarter<span class="hljs-variable">.java</span>:<span class="hljs-number">58</span>)<br></code></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘ä»¬çš„junitæ˜¯è·‘åœ¨jvmä¸Šçš„ï¼Œé»˜è®¤å¹¶æ²¡æœ‰åŠ è½½androidçš„åŒ…ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<a href="http://robolectric.org/">Robolectric</a>è¿™ä¸ªä¸‰æ–¹åŒ…æ¥åšæµ‹è¯•ã€‚åœ¨gradleä¸­æ·»åŠ ä¸€ä¸‹ä¾èµ–<code>testImplementation &#39;org.robolectric:robolectric:4.2&#39;</code>,<strong>åˆ«é—®ä¸ºå•¥ä¸ç”¨4.4,å› ä¸ºæˆ‘è¿˜æ²¡æ•´æ˜ç™½ï¼ŒShadowsæ–¹æ³•ä¸èƒ½ç”¨</strong></p><p>åœ¨æˆ‘ä»¬çš„å•å…ƒæµ‹è¯•ç±»ä¸ŠåŠ ä¸‹æ³¨è§£ï¼Œå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RunWith(RobolectricTestRunner.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UtilTestWithRobolectric</span> &#123;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testEmailAddress</span><span class="hljs-params">()</span>&#123;<br>        Assert.assertTrue(Util.isEmailAddress(<span class="hljs-string">&quot;gg@gg.com&quot;</span>));<br>        Assert.assertTrue(Util.isEmailAddress(<span class="hljs-string">&quot;huangyuan@chunyu.me&quot;</span>));<br>        Assert.assertFalse(Util.isEmailAddress(<span class="hljs-string">&quot;wwww&quot;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é™¤äº†è¿™ä¸ªï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨Robolectricæ¥æµ‹è¯•ä¸€äº›é¡µé¢è¡Œä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> androidx.test.core.app.ActivityScenario;<br><span class="hljs-keyword">import</span> androidx.test.core.app.ApplicationProvider;<br><span class="hljs-keyword">import</span> org.junit.Assert;<br><span class="hljs-keyword">import</span> org.junit.Before;<br><span class="hljs-keyword">import</span> org.junit.Test;<br><span class="hljs-keyword">import</span> org.junit.runner.RunWith;<br><span class="hljs-keyword">import</span> org.robolectric.RobolectricTestRunner;<br><span class="hljs-keyword">import</span> org.robolectric.Shadows;<br><span class="hljs-keyword">import</span> org.robolectric.shadows.ShadowAlertDialog;<br><span class="hljs-keyword">import</span> org.robolectric.shadows.ShadowToast;<br><span class="hljs-meta">@RunWith(RobolectricTestRunner.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UtilTestWithRobolectric</span> &#123;<br>    <span class="hljs-keyword">private</span> ActivityScenario&lt;MainActivity&gt; scenario;<br><br>    <span class="hljs-meta">@Before</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initScenario</span><span class="hljs-params">()</span>&#123;<br>         scenario = ActivityScenario.launch(MainActivity.class);<br>    &#125;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testScenario</span><span class="hljs-params">()</span>&#123;<br>        Assert.assertNotNull(scenario);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testEmailAddress</span><span class="hljs-params">()</span>&#123;<br>        Assert.assertTrue(Util.isEmailAddress(<span class="hljs-string">&quot;gg@gg.com&quot;</span>));<br>        Assert.assertTrue(Util.isEmailAddress(<span class="hljs-string">&quot;huangyuan@chunyu.me&quot;</span>));<br>        Assert.assertFalse(Util.isEmailAddress(<span class="hljs-string">&quot;wwww&quot;</span>));<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-comment">//æ˜¯å¦å¼¹å‡ºtoast</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testShowToast</span><span class="hljs-params">()</span>&#123;<br>        scenario.onActivity(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ActivityScenario</span>.ActivityAction&lt;MainActivity&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">perform</span><span class="hljs-params">(MainActivity activity)</span> &#123;<br>                <span class="hljs-type">Toast</span> <span class="hljs-variable">toast</span> <span class="hljs-operator">=</span> ShadowToast.getLatestToast();<br>                Assert.assertNull(toast);<br><br>                activity.findViewById(R.id.show_toast).performClick();<br>                toast = ShadowToast.getLatestToast();<br>                Assert.assertNotNull(toast);<br><br>                <span class="hljs-type">ShadowToast</span> <span class="hljs-variable">shadowToast</span> <span class="hljs-operator">=</span> Shadows.shadowOf(toast);<br>                Assert.assertEquals(<span class="hljs-string">&quot;show_toast&quot;</span>,ShadowToast.getTextOfLatestToast());<br>                Assert.assertEquals(Toast.LENGTH_SHORT,toast.getDuration());<br><br>            &#125;<br>        &#125;);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>  <span class="hljs-comment">//æ˜¯å¦å±•ç¤ºDialog</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testShowDialog</span><span class="hljs-params">()</span>&#123;<br>        scenario.onActivity(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ActivityScenario</span>.ActivityAction&lt;MainActivity&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">perform</span><span class="hljs-params">(MainActivity activity)</span> &#123;<br>                <span class="hljs-type">AlertDialog</span> <span class="hljs-variable">dialog</span> <span class="hljs-operator">=</span> ShadowAlertDialog.getLatestAlertDialog();<br>                Assert.assertNull(dialog);<br>                activity.findViewById(R.id.show_toast).performClick();<br><br>                dialog = ShadowAlertDialog.getLatestAlertDialog();<br>                Assert.assertNotNull(dialog);<br><br>                <span class="hljs-type">ShadowAlertDialog</span> <span class="hljs-variable">shadowDialog</span> <span class="hljs-operator">=</span> Shadows.shadowOf(dialog);<br>                Assert.assertEquals(<span class="hljs-string">&quot;Helloï¼&quot;</span>, shadowDialog.getMessage());<br><br>            &#125;<br>        &#125;);<br><br>    &#125;<br><br><br>    <span class="hljs-meta">@Test</span><br>  <span class="hljs-comment">//æ˜¯å¦è·³è½¬åˆ°äº†æŒ‡å®šé¡µé¢</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGoToLogin</span><span class="hljs-params">()</span>&#123;<br><br>        scenario.onActivity(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ActivityScenario</span>.ActivityAction&lt;MainActivity&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">perform</span><span class="hljs-params">(MainActivity activity)</span> &#123;<br>                activity.findViewById(R.id.login).performClick();<br>                <span class="hljs-type">Intent</span> <span class="hljs-variable">expectedIntent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(activity, LoginActivity.class);<br>                <span class="hljs-type">Intent</span> <span class="hljs-variable">actual</span> <span class="hljs-operator">=</span> Shadows.shadowOf(activity).getNextStartedActivity();<br>                Assert.assertEquals(expectedIntent.getComponent(),actual.getComponent());<br>            &#125;<br>        &#125;);<br><br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>ActivityScenario</code>æ˜¯ä½¿ç”¨çš„ androidx.test.core.appåŒ…ä¸‹çš„ç±»ï¼Œéœ€è¦ä¾èµ–<code>testImplementation &#39;androidx.test:core:1.1.0&#39;</code></p><p>å½“ç„¶åœ¨<code>Robolectric</code>ä¸­ä¹Ÿæœ‰å¯¹åº”çš„åˆ›å»ºActivityçš„æ–¹æ³•ï¼Œä¸è¿‡åœ¨4.4ç‰ˆæœ¬ä¸­è¢«åºŸå¼ƒäº†ï¼Œä¹Ÿæ¨èä½¿ç”¨androidx.teståŒ…ä¸­åˆ›å»ºActivityçš„æ–¹æ³•ã€‚</p><h4 id="Mockå’ŒMockito"><a href="#Mockå’ŒMockito" class="headerlink" title="Mockå’ŒMockito"></a>Mockå’ŒMockito</h4><p>å¦‚ä½•æµ‹è¯•ä¸€ä¸ªæ²¡æœ‰è¿”å›å€¼çš„æ–¹æ³•ï¼Œä¸€èˆ¬æ˜¯æ¥çœ‹è¿™ä¸ªæ–¹æ³•æœ‰æ²¡æœ‰å¾—åˆ°è°ƒç”¨ã€‚<br>å‡å¦‚æˆ‘ä»¬æœ‰å¦‚ä¸‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginPresenter</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUserManager</span><span class="hljs-params">(UserManager userManager)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userManager = userManager;<br>    &#125;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">login</span><span class="hljs-params">(String userName,String password)</span>&#123;<br>        userManager.performLogin(userName,password);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦éªŒè¯<code>mUserManager</code>çš„ä¸€äº›è¡Œä¸ºï¼Œé¦–å…ˆè¦ mock UserManager è¿™ä¸ªç±»ï¼Œmock è¿™ä¸ªç±»çš„æ–¹å¼æ˜¯ï¼š<br><code>Mockito.mock(UserManager.class);</code><br>mock äº†<code>UserManager</code>ç±»ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹æµ‹è¯•äº†,éªŒè¯ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨æƒ…å†µçš„æ–¹æ³•æ˜¯ï¼š<br><code>Mockito.verify(objectToVerify).methodToVerify(arguments);</code><br>å…¶ä¸­ï¼Œ<code>objectToVerify</code>å’Œ<code>methodToVerify</code>åˆ†åˆ«æ˜¯ä½ æƒ³è¦éªŒè¯çš„å¯¹è±¡å’Œæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testLogin</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-type">UserManager</span> <span class="hljs-variable">userManager</span> <span class="hljs-operator">=</span> Mockito.mock(UserManager.class);<br>  <span class="hljs-type">LoginPresenter</span> <span class="hljs-variable">loginPresenter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginPresenter</span>();<br>  loginPresenter.setUserManager(userManager);<br>  loginPresenter.login(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>);<br>  Mockito.verify(userManager).performLogin(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å†å‡å¦‚æˆ‘ä»¬åœ¨ç™»å½•çš„æ—¶å€™éœ€è¦å…ˆéªŒè¯å¯†ç å¼ºåº¦ï¼Œä½†æ˜¯æˆ‘ä»¬æµ‹è¯•çš„æ—¶å€™ä¸å…³å¿ƒè¿™ä¸ªéªŒè¯é€»è¾‘ï¼Œå¸Œæœ›ä¸ç®¡ä¼ å…¥çš„å¯†ç æ˜¯å•¥ï¼Œéƒ½å¯ä»¥é€šè¿‡éªŒè¯ã€‚æˆ‘ä»¬å°±éœ€è¦å¹²é¢„æŸäº›mockå¯¹è±¡çš„æ–¹æ³•è¡Œä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loginWithVerifyPassword</span><span class="hljs-params">(PasswordValidator passwordValidator, String userName,String password)</span>&#123;<br>  <span class="hljs-keyword">if</span>(passwordValidator.verifyPassword(password))&#123;<br>    userManager.performLogin(userName,password);<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;å¯†ç ä¸æ­£ç¡®&quot;</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PasswordValidator</span>&#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">verifyPassword</span><span class="hljs-params">(String password)</span>&#123;<br>    <span class="hljs-keyword">return</span> password != <span class="hljs-literal">null</span> &amp;&amp; password.length() &gt;<span class="hljs-number">5</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦mockä¸€ä¸‹PasswordValidatorè¿™ä¸ªç±»ä¸­verifyPasswordçš„è¡Œä¸º,è¿™ç§æŒ‡å®š mock å¯¹è±¡çš„æŸä¸ªæ–¹æ³•ï¼Œè®©å®ƒè¿”å›ç‰¹å®šå€¼çš„å†™æ³•å¦‚ä¸‹ï¼š<br><code>Mockito.when(mockObject.targetMethod(args)).thenReturn(desiredReturnValue);</code>ä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testLoginWithPasswordValidator</span><span class="hljs-params">()</span> &#123;<br>  LoginPresenter.<span class="hljs-type">PasswordValidator</span> <span class="hljs-variable">passwordValidator</span> <span class="hljs-operator">=</span> Mockito.mock(LoginPresenter.PasswordValidator.class);<br>  <span class="hljs-comment">//éªŒè¯æ–¹æ³•è¡Œä¸ºæ˜¯å¦è¢«æ”¹å˜</span><br>  Mockito.when(passwordValidator.verifyPassword(ArgumentMatchers.any())).thenReturn(<span class="hljs-literal">true</span>);<br>  Assert.assertTrue(passwordValidator.verifyPassword(<span class="hljs-string">&quot;&quot;</span>));<br>  Assert.assertTrue(passwordValidator.verifyPassword(<span class="hljs-literal">null</span>));<br>  Assert.assertTrue(passwordValidator.verifyPassword(<span class="hljs-string">&quot;123&quot;</span>));<br>  Assert.assertTrue(passwordValidator.verifyPassword(<span class="hljs-string">&quot;321321321&quot;</span>));<br><br>  <span class="hljs-comment">//éªŒè¯ç™»å½•æ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨</span><br>  <span class="hljs-type">UserManager</span> <span class="hljs-variable">userManager</span> <span class="hljs-operator">=</span> Mockito.mock(UserManager.class);<br>  <span class="hljs-type">LoginPresenter</span> <span class="hljs-variable">loginPresenter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginPresenter</span>();<br>  loginPresenter.setUserManager(userManager);<br>  loginPresenter.loginWithVerifyPassword(passwordValidator, <span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>);<br>  Mockito.verify(userManager).performLogin(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>);<br><br><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="Androidx-test"><a href="#Androidx-test" class="headerlink" title="Androidx.test"></a>Androidx.test</h4><p>æœ€è¿‘åœ¨çœ‹AndroidxåŒ…ä¸‹çš„æµ‹è¯•æ¡†æ¶ï¼Œå¯¹äºæˆ‘ä»¬æ¥è®²ï¼Œå•å…ƒæµ‹è¯•ä¸æ˜¯å¾ˆå¤šï¼Œæµ‹è¯•ä»£ç è·‘åœ¨æ¨¡æ‹Ÿå™¨æˆ–è€…çœŸæœºä¸Šå¸¦æ¥çš„æ—¶é—´æ¶ˆè€—è¿˜æ˜¯å¯ä»¥æ¥å—çš„ã€‚æœ‰æ—¶é—´æ’¸ä¸€ä¸‹å¯¹åº”çš„ä»£ç </p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PMSåŠapkå®‰è£…è¿‡ç¨‹</title>
    <link href="/2021/04/05/PMS%E5%8F%8Aapk%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B/"/>
    <url>/2021/04/05/PMS%E5%8F%8Aapk%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<p>å…ˆä»å¦‚ä½•ä½¿ç”¨ä»£ç å®‰è£…ä¸€ä¸ªapkå¼€å§‹ã€‚</p><p>åœ¨7.0ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŒ‡å®šapkçš„è·¯å¾„è¿›è¡Œå®‰è£…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(Intent.Action_View);<br><span class="hljs-type">String</span> <span class="hljs-variable">filepath</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;/sdcard/a.apk&quot;</span>;<br>intent.setDataAndType(Uri.parse(<span class="hljs-string">&quot;file://&quot;</span> + filepath),<span class="hljs-string">&quot;application/vnd.android.package-archive&quot;</span>);<br>startActivity(intent);<br></code></pre></td></tr></table></figure><p>åœ¨7.0åŠä»¥åï¼Œéœ€è¦ä½¿ç”¨FileProviderè¿›è¡Œå®‰è£…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">File</span> <span class="hljs-variable">apk</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(...);<br><span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(Intent.ACTION_VIEW);<br>intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);<br>intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);<br><span class="hljs-type">Uri</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> FileProvider.getUriForFile(<span class="hljs-built_in">this</span>, <span class="hljs-string">&quot;com.example.demo.fileprovider&quot;</span>, apk);<br>intent.setDataAndType(uri, <span class="hljs-string">&quot;application/vnd.android.package-archive&quot;</span>);<br>startActivity(intent);<br></code></pre></td></tr></table></figure><p>ä¸ç®¡æ˜¯å“ªä¸ªç‰ˆæœ¬ï¼Œæˆ‘ä»¬éƒ½éœ€è¦è°ƒç”¨<code>intent.setDataAndType</code>æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨aospæºç ä¸­æ‰¾åˆ°äº†å¯¹åº”çš„Activityï¼šåœ¨<code>packages/apps/PackageInstaller</code>æ–‡ä»¶å¤¹ä¸‹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">activity</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;.InstallStart&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">android:exported</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">android:excludeFromRecents</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span> <span class="hljs-attr">android:priority</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.intent.action.VIEW&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.intent.action.INSTALL_PACKAGE&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">category</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.intent.category.DEFAULT&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">data</span> <span class="hljs-attr">android:scheme</span>=<span class="hljs-string">&quot;file&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">data</span> <span class="hljs-attr">android:scheme</span>=<span class="hljs-string">&quot;content&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">data</span> <span class="hljs-attr">android:mimeType</span>=<span class="hljs-string">&quot;application/vnd.android.package-archive&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span> <span class="hljs-attr">android:priority</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.intent.action.INSTALL_PACKAGE&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">category</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.intent.category.DEFAULT&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">data</span> <span class="hljs-attr">android:scheme</span>=<span class="hljs-string">&quot;file&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">data</span> <span class="hljs-attr">android:scheme</span>=<span class="hljs-string">&quot;package&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">data</span> <span class="hljs-attr">android:scheme</span>=<span class="hljs-string">&quot;content&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span> <span class="hljs-attr">android:priority</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.content.pm.action.CONFIRM_PERMISSIONS&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">category</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.intent.category.DEFAULT&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">activity</span>&gt;</span><br></code></pre></td></tr></table></figure><span id="more"></span><h3 id="PackageInstallerå‡†å¤‡å·¥ä½œ"><a href="#PackageInstallerå‡†å¤‡å·¥ä½œ" class="headerlink" title="PackageInstallerå‡†å¤‡å·¥ä½œ"></a>PackageInstallerå‡†å¤‡å·¥ä½œ</h3><h4 id="com-android-packageinstaller-InstallStart"><a href="#com-android-packageinstaller-InstallStart" class="headerlink" title="com.android.packageinstaller.InstallStart"></a>com.android.packageinstaller.InstallStart</h4><p><code>InstallStart</code>ç»§æ‰¿è‡ªActivityï¼Œå…ˆçœ‹æ³¨é‡Šï¼š</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Select which activity is the first visible activity of the installation and forward the intent to</span><br><span class="hljs-comment"> * it.</span><br><span class="hljs-comment"> */</span><br></code></pre></td></tr></table></figure><p>å¾ˆæ¸…æ¥šäº†ï¼Œåˆ¤æ–­éœ€è¦æ‰“å¼€å“ªä¸ªé¡µé¢ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹<code>onCreate</code>æ–¹æ³•ä¸­çš„å…³é”®åœ°æ–¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Intent</span> <span class="hljs-variable">nextActivity</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(intent);<br>nextActivity.setFlags(Intent.FLAG_ACTIVITY_FORWARD_RESULT);<br><br><span class="hljs-comment">// The the installation source as the nextActivity thinks this activity is the source, hence</span><br><span class="hljs-comment">// set the originating UID and sourceInfo explicitly</span><br>nextActivity.putExtra(PackageInstallerActivity.EXTRA_CALLING_PACKAGE, callingPackage);<br>nextActivity.putExtra(PackageInstallerActivity.EXTRA_ORIGINAL_SOURCE_INFO, sourceInfo);<br>nextActivity.putExtra(Intent.EXTRA_ORIGINATING_UID, originatingUid);<br><br><span class="hljs-keyword">if</span> (PackageInstaller.ACTION_CONFIRM_PERMISSIONS.equals(intent.getAction())) &#123;<br>    nextActivity.setClass(<span class="hljs-built_in">this</span>, PackageInstallerActivity.class);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-type">Uri</span> <span class="hljs-variable">packageUri</span> <span class="hljs-operator">=</span> intent.getData();<br><br>    <span class="hljs-keyword">if</span> (packageUri != <span class="hljs-literal">null</span> &amp;&amp; (packageUri.getScheme().equals(ContentResolver.SCHEME_FILE)<br>                               || packageUri.getScheme().equals(ContentResolver.SCHEME_CONTENT))) &#123;<br>        <span class="hljs-comment">// Copy file to prevent it from being changed underneath this process</span><br>        nextActivity.setClass(<span class="hljs-built_in">this</span>, InstallStaging.class);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (packageUri != <span class="hljs-literal">null</span> &amp;&amp; packageUri.getScheme().equals(<br>        PackageInstallerActivity.SCHEME_PACKAGE)) &#123;<br>        nextActivity.setClass(<span class="hljs-built_in">this</span>, PackageInstallerActivity.class);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-type">Intent</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>();<br>        result.putExtra(Intent.EXTRA_INSTALL_RESULT,<br>                        PackageManager.INSTALL_FAILED_INVALID_URI);<br>        setResult(RESULT_FIRST_USER, result);<br><br>        nextActivity = <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (nextActivity != <span class="hljs-literal">null</span>) &#123;<br>    startActivity(nextActivity);<br>&#125;<br>finish();<br></code></pre></td></tr></table></figure><p>åœ¨7.0ä¹‹åçš„ç‰ˆæœ¬ä¸Šï¼Œç”±äºä½¿ç”¨FIleProviderï¼Œä¼šéšè—å…±äº«æ–‡ä»¶çš„çœŸå®è·¯å¾„ï¼Œå¹¶å°†è·¯å¾„è½¬æ¢æˆ:Uriè·¯å¾„ï¼Œè¿™æ ·å°±ä¼šè·³è½¬åˆ°<code>InstallStaging</code>è¿™ä¸ªç±»</p><h4 id="com-android-packageinstaller-InstallStaging"><a href="#com-android-packageinstaller-InstallStaging" class="headerlink" title="com.android.packageinstaller.InstallStaging"></a>com.android.packageinstaller.InstallStaging</h4><p>åŒæ ·å…ˆçœ‹é¡¶éƒ¨æ³¨é‡Š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs applescript">/**<br> * If a package gets installed <span class="hljs-keyword">from</span> an content URI this step loads <span class="hljs-keyword">the</span> package <span class="hljs-keyword">and</span> turns <span class="hljs-keyword">it</span> <span class="hljs-keyword">into</span><br> * <span class="hljs-keyword">and</span> installation <span class="hljs-keyword">from</span> a <span class="hljs-built_in">file</span>. Then <span class="hljs-keyword">it</span> re-starts <span class="hljs-keyword">the</span> installation <span class="hljs-keyword">as</span> usual.<br> */<br></code></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ä»Uriå®‰è£…çš„ï¼Œä¼šå…ˆè½¬åŒ–æˆæ–‡ä»¶ï¼Œç„¶åå†è¿›è¡Œå®‰è£…</p><p>æˆ‘ä»¬æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•ï¼Œæ˜¯åœ¨onResumeä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onResume</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-built_in">super</span>.onResume();<br><br>    <span class="hljs-comment">// This is the first onResume in a single life of the activity</span><br>    <span class="hljs-keyword">if</span> (mStagingTask == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">// File does not exist, or became invalid</span><br>        <span class="hljs-keyword">if</span> (mStagedFile == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// Create file delayed to be able to show error</span><br>            <span class="hljs-keyword">try</span> &#123;<br>                mStagedFile = TemporaryFileManager.getStagedFile(<span class="hljs-built_in">this</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                showError();<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>        &#125;<br><br>        mStagingTask = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StagingAsyncTask</span>();<br>        mStagingTask.execute(getIntent().getData());<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StagingAsyncTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AsyncTask</span>&lt;Uri, Void, Boolean&gt; &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> Boolean <span class="hljs-title function_">doInBackground</span><span class="hljs-params">(Uri... params)</span> &#123;<br>        <span class="hljs-keyword">if</span> (params == <span class="hljs-literal">null</span> || params.length &lt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-type">Uri</span> <span class="hljs-variable">packageUri</span> <span class="hljs-operator">=</span> params[<span class="hljs-number">0</span>];<br>        <span class="hljs-keyword">try</span> (<span class="hljs-type">InputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> getContentResolver().openInputStream(packageUri)) &#123;<br>            <span class="hljs-comment">// Despite the comments in ContentResolver#openInputStream the returned stream can</span><br>            <span class="hljs-comment">// be null.</span><br>            <span class="hljs-keyword">if</span> (in == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">try</span> (<span class="hljs-type">OutputStream</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(mStagedFile)) &#123;<br>                <span class="hljs-type">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>];<br>                <span class="hljs-type">int</span> bytesRead;<br>                <span class="hljs-keyword">while</span> ((bytesRead = in.read(buffer)) &gt;= <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-comment">// Be nice and respond to a cancellation</span><br>                    <span class="hljs-keyword">if</span> (isCancelled()) &#123;<br>                        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>                    &#125;<br>                    out.write(buffer, <span class="hljs-number">0</span>, bytesRead);<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException | SecurityException | IllegalStateException e) &#123;<br>            Log.w(LOG_TAG, <span class="hljs-string">&quot;Error staging apk from content URI&quot;</span>, e);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onPostExecute</span><span class="hljs-params">(Boolean success)</span> &#123;<br>        <span class="hljs-keyword">if</span> (success) &#123;<br>            <span class="hljs-comment">// Now start the installation again from a file</span><br>            <span class="hljs-type">Intent</span> <span class="hljs-variable">installIntent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(getIntent());<br>            installIntent.setClass(InstallStaging.<span class="hljs-built_in">this</span>, DeleteStagedFileOnResult.class);<br>            installIntent.setData(Uri.fromFile(mStagedFile));<br><br>            <span class="hljs-keyword">if</span> (installIntent.getBooleanExtra(Intent.EXTRA_RETURN_RESULT, <span class="hljs-literal">false</span>)) &#123;<br>                installIntent.addFlags(Intent.FLAG_ACTIVITY_FORWARD_RESULT);<br>            &#125;<br><br>            installIntent.addFlags(Intent.FLAG_ACTIVITY_NO_ANIMATION);<br>            startActivity(installIntent);<br><br>            InstallStaging.<span class="hljs-built_in">this</span>.finish();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            showError();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œåˆ›å»ºäº†<code>StagingAsyncTask</code>, å°†uri(æœ€å¼€å§‹ä¼ å…¥çš„apkæ–‡ä»¶çš„uriï¼Œä¹Ÿæ˜¯taskä¸­çš„packageUri)ä¸­çš„å†…å®¹å†™å…¥åˆ°mStagedFileä¸­ï¼›å¦‚æœå†™å…¥æˆåŠŸï¼Œåˆ™è·³è½¬åˆ°<code>DeleteStagedFileOnResult</code>é¡µé¢</p><h4 id="com-android-packageinstaller-DeleteStagedFileOnResult"><a href="#com-android-packageinstaller-DeleteStagedFileOnResult" class="headerlink" title="com.android.packageinstaller.DeleteStagedFileOnResult"></a>com.android.packageinstaller.DeleteStagedFileOnResult</h4><p>å…ˆçœ‹é¡¶éƒ¨æ³¨é‡Š</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Trampoline activity. Calls PackageInstallerActivity and deletes staged install file onResult.</span><br><span class="hljs-comment"> */</span><br></code></pre></td></tr></table></figure><p>ä½œä¸ºä¸­é—´å±‚çš„é¡µé¢ï¼Œæ‰“å¼€PackageInstallerActivityï¼Œå¹¶ä¸”åœ¨è¿”å›çš„æ—¶å€™åˆ é™¤æš‚å­˜æ–‡ä»¶ã€‚æ²¡å•¥å¥½è¯´çš„ï¼Œç›´æ¥åˆ°PackageInstallerActivity</p><h4 id="com-android-packageinstaller-PackageInstallerActivity"><a href="#com-android-packageinstaller-PackageInstallerActivity" class="headerlink" title="com.android.packageinstaller.PackageInstallerActivity"></a>com.android.packageinstaller.PackageInstallerActivity</h4><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * This activity is launched when a new application is installed via side loading</span><br><span class="hljs-comment"> * The package is first parsed and the user is notified of parse errors via a dialog.</span><br><span class="hljs-comment"> * If the package is successfully parsed, the user is notified to turn on the install unknown</span><br><span class="hljs-comment"> * applications setting. A memory check is made at this point and the user is notified of out</span><br><span class="hljs-comment"> * of memory conditions if any. If the package is already existing on the device,</span><br><span class="hljs-comment"> * a confirmation dialog (to replace the existing package) is presented to the user.</span><br><span class="hljs-comment"> * Based on the user response the package is then installed by launching InstallAppConfirm</span><br><span class="hljs-comment"> * sub activity. All state transitions are handled in this activity</span><br><span class="hljs-comment"> */</span><br></code></pre></td></tr></table></figure><p>ç²—ç•¥çš„æè¿°äº†åº”ç”¨ç¨‹åºçš„å®‰è£…è¿‡ç¨‹ï¼šå…ˆå¯¹å®‰è£…åŒ…è¿›è¡Œè§£æï¼Œè§£æå¤±è´¥åˆ™å¼¹çª—é€šçŸ¥ï¼›è§£ææˆåŠŸåï¼Œé€šçŸ¥ç”¨æˆ·æ‰“å¼€â€å®‰è£…æœªçŸ¥åº”ç”¨ç¨‹åºâ€è®¾ç½®ï¼Œè¿›è¡Œå†…å®¹æ£€æŸ¥ï¼Œå¦‚æœå†…å­˜ä¸è¶³ï¼Œåˆ™é€šçŸ¥ç”¨æˆ·ï¼›å¦‚æœè®¾å¤‡ä¸Šå·²ç»å­˜åœ¨è¯¥åº”ç”¨ï¼Œåˆ™é€šçŸ¥ç”¨æˆ·è¿›è¡Œæ›¿æ¢ï¼Œç„¶åæ ¹æ®ç”¨æˆ·å“åº”ï¼Œé€šè¿‡å¯åŠ¨InstallAppConfirmæ¥å®‰è£…è½¯ä»¶åŒ…ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹onCreateæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java">  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle icicle)</span> &#123;<br>      <span class="hljs-built_in">super</span>.onCreate(<span class="hljs-literal">null</span>);<br><br>      <span class="hljs-keyword">if</span> (icicle != <span class="hljs-literal">null</span>) &#123;<br>          mAllowUnknownSources = icicle.getBoolean(ALLOW_UNKNOWN_SOURCES_KEY);<br>      &#125;<br><br>      mPm = getPackageManager();<br>      mIpm = AppGlobals.getPackageManager();<br>      mAppOpsManager = (AppOpsManager) getSystemService(Context.APP_OPS_SERVICE);<br>      mInstaller = mPm.getPackageInstaller();<br>      mUserManager = (UserManager) getSystemService(Context.USER_SERVICE);<br>ã€‚<br>      ã€‚<br>      ã€‚<br>      <span class="hljs-type">boolean</span> <span class="hljs-variable">wasSetUp</span> <span class="hljs-operator">=</span> processPackageUri(packageUri);<br>      <span class="hljs-keyword">if</span> (!wasSetUp) &#123;<br>          <span class="hljs-keyword">return</span>;<br>      &#125;<br><br>      <span class="hljs-comment">// load dummy layout with OK button disabled until we override this layout in</span><br>      <span class="hljs-comment">// startInstallConfirm</span><br>      bindUi(R.layout.install_confirm, <span class="hljs-literal">false</span>);<br>      checkIfAllowedAndInitiateInstall();<br>  &#125;<br></code></pre></td></tr></table></figure><p>ä¸€å¼€å§‹åˆå§‹åŒ–éœ€è¦çš„å„ç§å¯¹è±¡ï¼ŒPackageManagerã€IPackageManagerã€IPackageManagerã€UserManagerã€PackageInstallerç­‰ï¼›</p><p>ç„ä¸€çœ¼<code>processPackageUri</code>æ–¹æ³•ï¼šæ ¹æ®Uriæ‹¿åˆ°scheme,ç„¶åæ ¹æ®schemeç±»å‹æ‹¿åˆ°packageInfo;å¦‚æœschemeæ—¢ä¸æ˜¯<code>package</code>ä¹Ÿä¸æ˜¯<code>file</code>ï¼Œåˆ™æŠ›å‡º<code>IllegalArgumentException</code>å¼‚å¸¸ã€‚</p><p><code>bindUi</code>æ˜¯è®¾ç½®é¡µé¢æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ã€‚</p><p>çœ‹ä¸‹<code>checkIfAllowedAndInitiateInstall</code>æ–¹æ³•ï¼šå¦‚æœå…è®¸å®‰è£…æœªçŸ¥æ¥æºæˆ–è€…è¯¥åº”ç”¨ä¸æ˜¯æœªçŸ¥æ¥æºï¼Œåˆ™è°ƒç”¨<code>initiateInstall</code>æ–¹æ³•è¿›è¡Œå®‰è£…ï¼›åœ¨<code>initiateInstall</code>æ–¹æ³•ä¸­ï¼Œè·å–åŒ…åä¿¡æ¯ï¼Œè¿›å…¥åˆ¤æ–­è®¾å¤‡ä¸Šæ˜¯å¦å·²ç»å®‰è£…è¯¥åº”ç”¨æµç¨‹ï¼Œæœ€åè°ƒç”¨<code>startInstallConfirm</code>åˆå§‹åŒ–ç¡®è®¤å®‰è£…ç•Œé¢ï¼Œåˆ—å‡ºåº”ç”¨æ‰€éœ€æƒé™ä¿¡æ¯</p><p>æ€»ç»“ä¸€ä¸‹è¿™äº›æ­¥éª¤ï¼š</p><ul><li>æ ¹æ®Uriä¸­çš„schemeä¸åŒï¼Œè·³è½¬åˆ°ä¸åŒé¡µé¢</li><li>InstallStartå°†contentåè®®è½¬åŒ–ä¸ºfileåè®®ï¼Œè·³è½¬åˆ°InstallStagingï¼Œç„¶åè·³è½¬åˆ°PackageInstallerActivity</li><li>åœ¨PackageInstallerActivityï¼Œå¯¹åè®®è¿›è¡Œå¤„ç†ï¼Œè§£ææ–‡ä»¶å¾—åˆ°PackageInfo</li><li>å¯¹æœªçŸ¥æ¥æºapkè¿›è¡Œå¤„ç†ï¼Œåˆå§‹åŒ–é¡µé¢</li></ul><h3 id="PackageInstallerå®‰è£…apk"><a href="#PackageInstallerå®‰è£…apk" class="headerlink" title="PackageInstallerå®‰è£…apk"></a>PackageInstallerå®‰è£…apk</h3><p>å½“æˆ‘ä»¬ç‚¹å‡»å®‰è£…é¡µé¢ä¸­ç¡®è®¤æŒ‰é’®æ—¶ï¼Œè°ƒç”¨<code>onClick</code>æ–¹æ³•ï¼Œæ¥ç€è°ƒç”¨<code>startInstall</code>æ‰“å¼€<code>InstallInstalling</code>é¡µé¢è¿›è¡Œå®‰è£…ã€‚è€è§„çŸ©ï¼Œå…ˆçœ‹é¡¶éƒ¨æ³¨é‡Š</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs perl">/**<br> * Send <span class="hljs-keyword">package</span> to the <span class="hljs-keyword">package</span> manager <span class="hljs-keyword">and</span> handle results from <span class="hljs-keyword">package</span> manager. Once the<br> * installation succeeds, start &#123;@link InstallSuccess&#125; <span class="hljs-keyword">or</span> &#123;@link InstallFailed&#125;.<br> * &lt;p&gt;This has two phases: First <span class="hljs-keyword">send</span> the data to the <span class="hljs-keyword">package</span> manager, then <span class="hljs-keyword">wait</span> <span class="hljs-keyword">until</span> the <span class="hljs-keyword">package</span><br> * manager processed the result.&lt;<span class="hljs-regexp">/p&gt;</span><br><span class="hljs-regexp"> */</span><br></code></pre></td></tr></table></figure><p>ä¸»è¦ç”¨äºå‘åŒ…ç®¡ç†å™¨å‘é€åŒ…çš„ä¿¡æ¯ï¼Œå¹¶å¤„ç†å›è°ƒï¼Œå®‰è£…æˆåŠŸåˆ™æ‰“å¼€<code>InstallSuccess</code>,å¤±è´¥åˆ™æ‰“å¼€<code>InstallFailed</code></p><h4 id="com-android-packageinstaller-InstallInstalling"><a href="#com-android-packageinstaller-InstallInstalling" class="headerlink" title="com.android.packageinstaller.InstallInstalling"></a>com.android.packageinstaller.InstallInstalling</h4><p>çœ‹ä¸‹onCreateåšäº†å•¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Bundle savedInstanceState)</span> &#123;<br>    <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br><br>    setContentView(R.layout.install_installing);<br><br>    <span class="hljs-type">ApplicationInfo</span> <span class="hljs-variable">appInfo</span> <span class="hljs-operator">=</span> getIntent()<br>            .getParcelableExtra(PackageUtil.INTENT_ATTR_APPLICATION_INFO);<br>    mPackageURI = getIntent().getData();<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;package&quot;</span>.equals(mPackageURI.getScheme())) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            getPackageManager().installExistingPackage(appInfo.packageName);<br>            launchSuccess();<br>        &#125; <span class="hljs-keyword">catch</span> (PackageManager.NameNotFoundException e) &#123;<br>            launchFailure(PackageManager.INSTALL_FAILED_INTERNAL_ERROR, <span class="hljs-literal">null</span>);<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">File</span> <span class="hljs-variable">sourceFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(mPackageURI.getPath());<br>        PackageUtil.initSnippetForNewApp(<span class="hljs-built_in">this</span>, PackageUtil.getAppSnippet(<span class="hljs-built_in">this</span>, appInfo,<br>                sourceFile), R.id.app_snippet);<br><br>        <span class="hljs-keyword">if</span> (savedInstanceState != <span class="hljs-literal">null</span>) &#123;<span class="hljs-comment">//----1------</span><br>            mSessionId = savedInstanceState.getInt(SESSION_ID);<br>            mInstallId = savedInstanceState.getInt(INSTALL_ID);<br><br>            <span class="hljs-comment">// Reregister for result; might instantly call back if result was delivered while</span><br>            <span class="hljs-comment">// activity was destroyed</span><br>            <span class="hljs-keyword">try</span> &#123;<br>                InstallEventReceiver.addObserver(<span class="hljs-built_in">this</span>, mInstallId,<br>                        <span class="hljs-built_in">this</span>::launchFinishBasedOnResult);<br>            &#125; <span class="hljs-keyword">catch</span> (EventResultPersister.OutOfIdsException e) &#123;<br>                <span class="hljs-comment">// Does not happen</span><br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            PackageInstaller.<span class="hljs-type">SessionParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PackageInstaller</span>.SessionParams(<br>                    PackageInstaller.SessionParams.MODE_FULL_INSTALL);<br>            params.installFlags = PackageManager.INSTALL_FULL_APP;<br>            params.referrerUri = getIntent().getParcelableExtra(Intent.EXTRA_REFERRER);<br>            params.originatingUri = getIntent()<br>                    .getParcelableExtra(Intent.EXTRA_ORIGINATING_URI);<br>            params.originatingUid = getIntent().getIntExtra(Intent.EXTRA_ORIGINATING_UID,<br>                    UID_UNKNOWN);<br>            params.installerPackageName =<br>                    getIntent().getStringExtra(Intent.EXTRA_INSTALLER_PACKAGE_NAME);<br><br>            <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(mPackageURI.getPath());<br>            <span class="hljs-keyword">try</span> &#123;<br>                PackageParser.<span class="hljs-type">PackageLite</span> <span class="hljs-variable">pkg</span> <span class="hljs-operator">=</span> PackageParser.parsePackageLite(file, <span class="hljs-number">0</span>);<br>                params.setAppPackageName(pkg.packageName);<br>                params.setInstallLocation(pkg.installLocation);<br>                params.setSize(<br>                        PackageHelper.calculateInstalledSize(pkg, <span class="hljs-literal">false</span>, params.abiOverride));<br>            &#125; <span class="hljs-keyword">catch</span> (PackageParser.PackageParserException e) &#123;<br>                Log.e(LOG_TAG, <span class="hljs-string">&quot;Cannot parse package &quot;</span> + file + <span class="hljs-string">&quot;. Assuming defaults.&quot;</span>);<br>                Log.e(LOG_TAG,<br>                        <span class="hljs-string">&quot;Cannot calculate installed size &quot;</span> + file + <span class="hljs-string">&quot;. Try only apk size.&quot;</span>);<br>                params.setSize(file.length());<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                Log.e(LOG_TAG,<br>                        <span class="hljs-string">&quot;Cannot calculate installed size &quot;</span> + file + <span class="hljs-string">&quot;. Try only apk size.&quot;</span>);<br>                params.setSize(file.length());<br>            &#125;<br><br>            <span class="hljs-keyword">try</span> &#123;<span class="hljs-comment">//-------2-------</span><br>                mInstallId = InstallEventReceiver<br>                        .addObserver(<span class="hljs-built_in">this</span>, EventResultPersister.GENERATE_NEW_ID,<br>                                <span class="hljs-built_in">this</span>::launchFinishBasedOnResult);<br>            &#125; <span class="hljs-keyword">catch</span> (EventResultPersister.OutOfIdsException e) &#123;<br>                launchFailure(PackageManager.INSTALL_FAILED_INTERNAL_ERROR, <span class="hljs-literal">null</span>);<br>            &#125;<br><br>            <span class="hljs-keyword">try</span> &#123;<span class="hljs-comment">//-------3-------</span><br>                mSessionId = getPackageManager().getPackageInstaller().createSession(params);<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                launchFailure(PackageManager.INSTALL_FAILED_INTERNAL_ERROR, <span class="hljs-literal">null</span>);<br>            &#125;<br>        &#125;<br><br>        mSessionCallback = <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstallSessionCallback</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨onCreateæ–¹æ³•ä¸­ä¼šå¯¹<code>package</code>å’Œ<code>content</code>åè®®çš„Uriè¿›è¢­å§‘å¨˜å¤„ç†ï¼Œæˆ‘ä»¬å…³æ³¨ä¸€ä¸‹contentåè®®çš„uriå¤„ç†éƒ¨åˆ†:</p><p>é¦–å…ˆåˆ¤æ–­savedInstanceStateæ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºåˆ™ä»ä¸­è·å–mSessionIdå’ŒmInstallIdï¼Œç„¶åå‘InstallEventReceiveræ³¨å†Œä¸€ä¸ªè§‚å¯Ÿè€…ã€‚</p><p>å¦‚æœä¸ºç©ºï¼Œåˆ™æ„å»ºä¸€ä¸ª PackageInstaller.SessionParamså¯¹è±¡ï¼Œåœ¨æ³¨é‡Š2å¤„åŒæ ·æ³¨å†Œäº†ä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œç„¶ååœ¨æ³¨é‡Š3å¤„åˆ›å»ºå¹¶è¿”å›sessionId</p><ul><li><p>è¿™é‡Œåˆ›å»ºmSessionIdæ—¶ï¼Œåœ¨createSessionæ–¹æ³•å†…éƒ¨ä¼šé€šè¿‡<code>IPackageInstaller</code>ä¸<code>PackageInstallerService</code>è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ï¼Œæœ€ç»ˆè°ƒç”¨çš„æ˜¯<code>PackageInstaller</code>çš„<code>createSession</code>æ–¹æ³•æ¥åˆ›å»ºå¹¶è¿”å›çš„sessionId</p></li><li><p>è¿™é‡Œæ³¨å†Œçš„è§‚å¯Ÿè€…æ˜¯<code>launchFinishBasedOnResult</code>æ–¹æ³•ï¼Œæ ¹æ®å®‰è£…ç»“æœä¸åŒï¼Œè·³è½¬åˆ°ä¸åŒçš„é¡µé¢(å®‰è£…æˆåŠŸã€å®‰è£…å¤±è´¥)</p></li><li><p>è¿™é‡Œçš„InstallEventReceiveræ˜¯ç»§æ‰¿è‡ªBroadcastReceiverçš„å¹¿æ’­æ¥æ”¶å™¨ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªä¸­é—´å±‚ï¼ŒçœŸæ­£ä¿å­˜è§‚å¯Ÿè€…çš„ç±»æ˜¯EventResultPersisterï¼Œå¯¹äº<code>EventResultPersister</code>æ³¨é‡Šæ˜¯è¿™æ ·çš„ï¼š<strong>Persists results of events and calls back observers when a matching result arrives.</strong></p></li></ul><p>æˆ‘ä»¬æ¥ç€çœ‹InstallInstallingçš„onResumeæ–¹æ³•</p><h4 id="com-android-packageinstaller-InstallInstalling-1"><a href="#com-android-packageinstaller-InstallInstalling-1" class="headerlink" title="com.android.packageinstaller.InstallInstalling"></a>com.android.packageinstaller.InstallInstalling</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onResume</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-built_in">super</span>.onResume();<br><br>    <span class="hljs-comment">// This is the first onResume in a single life of the activity</span><br>    <span class="hljs-keyword">if</span> (mInstallingTask == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-type">PackageInstaller</span> <span class="hljs-variable">installer</span> <span class="hljs-operator">=</span> getPackageManager().getPackageInstaller();<br>        PackageInstaller.<span class="hljs-type">SessionInfo</span> <span class="hljs-variable">sessionInfo</span> <span class="hljs-operator">=</span> installer.getSessionInfo(mSessionId);<br><br>        <span class="hljs-keyword">if</span> (sessionInfo != <span class="hljs-literal">null</span> &amp;&amp; !sessionInfo.isActive()) &#123;<br>            mInstallingTask = <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstallingAsyncTask</span>();<br>            mInstallingTask.execute();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// we will receive a broadcast when the install is finished</span><br>            mCancelButton.setEnabled(<span class="hljs-literal">false</span>);<br>            setFinishOnTouchOutside(<span class="hljs-literal">false</span>);<br>        &#125;<br>    &#125;<br>&#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Send the package to the package installer and then register a event result observer that</span><br><span class="hljs-comment">     * will call &#123;<span class="hljs-doctag">@link</span> #launchFinishBasedOnResult(int, int, String)&#125;</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InstallingAsyncTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AsyncTask</span>&lt;Void, Void,<br>            PackageInstaller.Session&gt; &#123;<br>        <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> isDone;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">protected</span> PackageInstaller.Session <span class="hljs-title function_">doInBackground</span><span class="hljs-params">(Void... params)</span> &#123;<br>            PackageInstaller.Session session;<br>            <span class="hljs-keyword">try</span> &#123;<br>                session = getPackageManager().getPackageInstaller().openSession(mSessionId);<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>            &#125;<br><br>            session.setStagingProgress(<span class="hljs-number">0</span>);<br><br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(mPackageURI.getPath());<br><br>                <span class="hljs-keyword">try</span> (<span class="hljs-type">InputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(file)) &#123;<br>                    <span class="hljs-type">long</span> <span class="hljs-variable">sizeBytes</span> <span class="hljs-operator">=</span> file.length();<br>                    <span class="hljs-keyword">try</span> (<span class="hljs-type">OutputStream</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> session<br>                            .openWrite(<span class="hljs-string">&quot;PackageInstaller&quot;</span>, <span class="hljs-number">0</span>, sizeBytes)) &#123;<br>                        <span class="hljs-type">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>];<br>                        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>                            <span class="hljs-type">int</span> <span class="hljs-variable">numRead</span> <span class="hljs-operator">=</span> in.read(buffer);<br><br>                            <span class="hljs-keyword">if</span> (numRead == -<span class="hljs-number">1</span>) &#123;<br>                                session.fsync(out);<br>                                <span class="hljs-keyword">break</span>;<br>                            &#125;<br><br>                            <span class="hljs-keyword">if</span> (isCancelled()) &#123;<br>                                session.close();<br>                                <span class="hljs-keyword">break</span>;<br>                            &#125;<br><br>                            out.write(buffer, <span class="hljs-number">0</span>, numRead);<br>                            <span class="hljs-keyword">if</span> (sizeBytes &gt; <span class="hljs-number">0</span>) &#123;<br>                                <span class="hljs-type">float</span> <span class="hljs-variable">fraction</span> <span class="hljs-operator">=</span> ((<span class="hljs-type">float</span>) numRead / (<span class="hljs-type">float</span>) sizeBytes);<br>                                session.addProgress(fraction);<br>                            &#125;<br>                        &#125;<br>                    &#125;<br>                &#125;<br><br>                <span class="hljs-keyword">return</span> session;<br>            &#125; <span class="hljs-keyword">catch</span> (IOException | SecurityException e) &#123;<br>                Log.e(LOG_TAG, <span class="hljs-string">&quot;Could not write package&quot;</span>, e);<br><br>                session.close();<br><br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>                    isDone = <span class="hljs-literal">true</span>;<br>                    notifyAll();<br>                &#125;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onPostExecute</span><span class="hljs-params">(PackageInstaller.Session session)</span> &#123;<br>            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-type">Intent</span> <span class="hljs-variable">broadcastIntent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(BROADCAST_ACTION);<br>                broadcastIntent.setFlags(Intent.FLAG_RECEIVER_FOREGROUND);<br>                broadcastIntent.setPackage(<br>                        getPackageManager().getPermissionControllerPackageName());<br>                broadcastIntent.putExtra(EventResultPersister.EXTRA_ID, mInstallId);<br><br>                <span class="hljs-type">PendingIntent</span> <span class="hljs-variable">pendingIntent</span> <span class="hljs-operator">=</span> PendingIntent.getBroadcast(<br>                        InstallInstalling.<span class="hljs-built_in">this</span>,<br>                        mInstallId,<br>                        broadcastIntent,<br>                        PendingIntent.FLAG_UPDATE_CURRENT);<br><br>                session.commit(pendingIntent.getIntentSender());<br>                mCancelButton.setEnabled(<span class="hljs-literal">false</span>);<br>                setFinishOnTouchOutside(<span class="hljs-literal">false</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                getPackageManager().getPackageInstaller().abandonSession(mSessionId);<br><br>                <span class="hljs-keyword">if</span> (!isCancelled()) &#123;<br>                    launchFailure(PackageManager.INSTALL_FAILED_INVALID_APK, <span class="hljs-literal">null</span>);<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæ ¹æ®mSessionIdè·å–åˆ°å®‰è£…ä¼šè¯çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚æœsessionInfoä¸ç©ºå¹¶ä¸”æ˜¯æ´»åŠ¨çš„ï¼Œæ¥ç€ä¼šåˆ›å»º<code>InstallingAsyncTask</code>ä»»åŠ¡å¹¶ç«‹å³æ‰§è¡Œã€‚è¯¥ä»»åŠ¡å°†APKä¿¡æ¯é€šè¿‡IOæµçš„å½¢å¼å†™å…¥ PackageInstaller.Sessionä¸­ã€‚</p><p>ä¹‹åï¼Œåœ¨onPostExecuteæ–¹æ³•ä¸­åˆ›å»ºä¸€ä¸ªPendingIntentï¼Œå¹¶é€šè¿‡ PackageInstaller.Session çš„commitæ–¹æ³•å°†IntentSenderå‘é€å‡ºå»ã€‚è¿™é‡Œçš„ <code>PackageInstaller.Session.commit</code>æ–¹æ³•ï¼Œè°ƒç”¨çš„æ˜¯<code>IPackageInstallerSession</code>çš„commitæ–¹æ³•ï¼Œè¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ï¼Œæœ€ç»ˆä¼šè°ƒç”¨PackageInstallerSessionçš„commitæ–¹æ³•ã€‚</p><h4 id="com-android-server-pm-PackageInstallerSession"><a href="#com-android-server-pm-PackageInstallerSession" class="headerlink" title="com.android.server.pm.PackageInstallerSession"></a>com.android.server.pm.PackageInstallerSession</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-meta">@Override</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">commit</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> IntentSender statusReceiver, <span class="hljs-type">boolean</span> forTransfer)</span> &#123;<br>     Preconditions.checkNotNull(statusReceiver);<br><br>     <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> wasSealed;<br>     <span class="hljs-keyword">synchronized</span> (mLock) &#123;<br>        <br>         <span class="hljs-keyword">final</span> <span class="hljs-type">PackageInstallObserverAdapter</span> <span class="hljs-variable">adapter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PackageInstallObserverAdapter</span>(<br>                 mContext, statusReceiver, sessionId,<br>                 isInstallerDeviceOwnerOrAffiliatedProfileOwnerLocked(), userId);<br>         mRemoteObserver = adapter.getBinder();<br><span class="hljs-comment">//Â·Â·Â·Â·Â·Â·Â·çœç•¥ä¸€äº›ä»£ç Â·Â·Â·Â·Â·Â·Â·//</span><br>         <span class="hljs-comment">// Client staging is fully done at this point</span><br>         mClientProgress = <span class="hljs-number">1f</span>;<br>         computeProgressLocked(<span class="hljs-literal">true</span>);<br><br>         <span class="hljs-comment">// This ongoing commit should keep session active, even though client</span><br>         <span class="hljs-comment">// will probably close their end.</span><br>         mActiveCount.incrementAndGet();<br><br>         mCommitted = <span class="hljs-literal">true</span>;<br>         mHandler.obtainMessage(MSG_COMMIT).sendToTarget();<br>     &#125;<br><br>     <span class="hljs-keyword">if</span> (!wasSealed) &#123;<br>         <span class="hljs-comment">// Persist the fact that we&#x27;ve sealed ourselves to prevent</span><br>         <span class="hljs-comment">// mutations of any hard links we create. We do this without holding</span><br>         <span class="hljs-comment">// the session lock, since otherwise it&#x27;s a lock inversion.</span><br>         mCallback.onSessionSealedBlocking(<span class="hljs-built_in">this</span>);<br>     &#125;<br> &#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œå°†ç›¸å…³ä¿¡æ¯å°è£…ä¸ºPackageInstallObserverAdapterå¯¹è±¡ï¼Œç„¶åå†å‘mHandlerå‘é€ä¸€ä¸ª<code>MSG_COMMIT</code>çš„æ¶ˆæ¯ï¼Œåœ¨è¿™ä¸ªhandlerçš„callbackä¸­æ˜¯è¿™ä¹ˆå¤„ç†çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Handler.<span class="hljs-type">Callback</span> <span class="hljs-variable">mHandlerCallback</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>.Callback() &#123;<br>       <span class="hljs-meta">@Override</span><br>       <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(Message msg)</span> &#123;<br>           <span class="hljs-keyword">switch</span> (msg.what) &#123;<br>         <br>               <span class="hljs-keyword">case</span> MSG_COMMIT:<br>                   <span class="hljs-keyword">synchronized</span> (mLock) &#123;<br>                       <span class="hljs-keyword">try</span> &#123;<br>                           commitLocked();<span class="hljs-comment">//-------1-------</span><br>                       &#125; <span class="hljs-keyword">catch</span> (PackageManagerException e) &#123;<br>                           <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">completeMsg</span> <span class="hljs-operator">=</span> ExceptionUtils.getCompleteMessage(e);<br>                           Slog.e(TAG,<br>                                   <span class="hljs-string">&quot;Commit of session &quot;</span> + sessionId + <span class="hljs-string">&quot; failed: &quot;</span> + completeMsg);<br>                           destroyInternal();<br>                           dispatchSessionFinished(e.error, completeMsg, <span class="hljs-literal">null</span>);<br>                       &#125;<br>                   &#125;<br>                   <span class="hljs-keyword">break</span>;<br>           &#125;<br>           <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>       &#125;<br>   &#125;;<br></code></pre></td></tr></table></figure><p>åœ¨æ³¨é‡Š1å¤„è°ƒç”¨äº†commitLockedï¼Œåœ¨è¯¥æ–¹æ³•ä¸­è°ƒç”¨äº†PackageManagerServiceå¯¹è±¡çš„installStageæ–¹æ³•</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">mPm.installStage(mPackageName, stageDir, localObserver, params,<br><span class="hljs-built_in">        mInstallerPackageName,</span> mInstallerUid, user, mSigningDetails)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>åœ¨commitLockedæ–¹æ³•ä¸­å¦‚æœæŠ›å‡ºäº†PackageManagerExceptionï¼Œåˆ™ä¼šè°ƒç”¨<code>dispatchSessionFinished</code>æ–¹æ³•ï¼Œå‘mHandlerå‘é€ä¸€ä¸ª<code>MSG_ON_PACKAGE_INSTALLED</code>æ¶ˆæ¯ï¼Œè°ƒç”¨<code>observer.onPackageInstalled(packageName, returnCode, message, extras);</code>è¿™é‡Œçš„<code>observer</code>å¯¹è±¡æ˜¯<code>.PackageInstallerSession.commit</code>æ–¹æ³•é€šè¿‡<code>adapter.getBinder()</code>æ–¹æ³•è·å–åˆ°çš„<code>IPackageInstallObserver2</code>å¯¹è±¡ã€‚</p><p>ç®€å•æ¥è®²ï¼Œä¹Ÿå°±ä¸¤ä¸ªæ­¥éª¤ï¼š</p><ul><li>å°†APKä¿¡æ¯é€šè¿‡IOæµå†™å…¥åˆ°PackageInstaller.Sessionä¸­</li><li>è°ƒç”¨PackageInstaller.Sessionçš„commitæ–¹æ³•ï¼Œå‘é€æ¶ˆæ¯åˆ°handlerï¼Œæœ€ç»ˆäº¤ç»™PMSå¤„ç†ã€‚</li></ul><h3 id="PMSä»‹å…¥å®‰è£…è¿‡ç¨‹"><a href="#PMSä»‹å…¥å®‰è£…è¿‡ç¨‹" class="headerlink" title="PMSä»‹å…¥å®‰è£…è¿‡ç¨‹"></a>PMSä»‹å…¥å®‰è£…è¿‡ç¨‹</h3><p>ä¸Šé¢æåˆ°åœ¨commitLockedæ–¹æ³•ä¸­ï¼Œè°ƒç”¨äº†<code>PackageManagerService</code>å¯¹è±¡çš„installStageæ–¹æ³•ã€‚è€è§„çŸ©ï¼Œå…ˆçœ‹ä¸‹<code>PackageManagerService</code>ç±»çš„é¡¶éƒ¨æ³¨é‡Šï¼ŒæŒºé•¿çš„ä¸è´´äº†ï¼Œä¸»è¦ä»‹ç»äº†ä¸¤ä¸ªé”å¯¹è±¡ä»¥åŠè¿™ä¸¤ä¸ªé”å¯¹è±¡çš„ä½¿ç”¨æ–¹æ³•æ³¨æ„äº‹é¡¹ã€‚çœ‹ä¸‹installStageæ–¹æ³•</p><h4 id="com-android-server-pm-PackageManagerService"><a href="#com-android-server-pm-PackageManagerService" class="headerlink" title="com.android.server.pm.PackageManagerService"></a>com.android.server.pm.PackageManagerService</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">installStage</span><span class="hljs-params">(String packageName, File stagedDir,</span><br><span class="hljs-params">                  IPackageInstallObserver2 observer, PackageInstaller.SessionParams sessionParams,</span><br><span class="hljs-params">                  String installerPackageName, <span class="hljs-type">int</span> installerUid, UserHandle user,</span><br><span class="hljs-params">                  PackageParser.SigningDetails signingDetails)</span> &#123;<br>    <span class="hljs-keyword">if</span> (DEBUG_INSTANT) &#123;<br>        <span class="hljs-keyword">if</span> ((sessionParams.installFlags &amp; PackageManager.INSTALL_INSTANT_APP) != <span class="hljs-number">0</span>) &#123;<br>            Slog.d(TAG, <span class="hljs-string">&quot;Ephemeral install of &quot;</span> + packageName);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">VerificationInfo</span> <span class="hljs-variable">verificationInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VerificationInfo</span>(<br>        sessionParams.originatingUri, sessionParams.referrerUri,<br>        sessionParams.originatingUid, installerUid);<br><br>    <span class="hljs-keyword">final</span> <span class="hljs-type">OriginInfo</span> <span class="hljs-variable">origin</span> <span class="hljs-operator">=</span> OriginInfo.fromStagedFile(stagedDir);<br><br>    <span class="hljs-keyword">final</span> <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> mHandler.obtainMessage(INIT_COPY);<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">installReason</span> <span class="hljs-operator">=</span> fixUpInstallReason(installerPackageName, installerUid,<br>                                                 sessionParams.installReason);<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">InstallParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstallParams</span>(origin, <span class="hljs-literal">null</span>, observer,<br>                                                   sessionParams.installFlags, installerPackageName, sessionParams.volumeUuid,<br>                                                   verificationInfo, user, sessionParams.abiOverride,<br>                                                   sessionParams.grantedRuntimePermissions, signingDetails, installReason);<br>    params.setTraceMethod(<span class="hljs-string">&quot;installStage&quot;</span>).setTraceCookie(System.identityHashCode(params));<br>    msg.obj = params;<span class="hljs-comment">//-------1-------</span><br><br>    Trace.asyncTraceBegin(TRACE_TAG_PACKAGE_MANAGER, <span class="hljs-string">&quot;installStage&quot;</span>,<br>                          System.identityHashCode(msg.obj));<br>    Trace.asyncTraceBegin(TRACE_TAG_PACKAGE_MANAGER, <span class="hljs-string">&quot;queueInstall&quot;</span>,<br>                          System.identityHashCode(msg.obj));<br><br>    mHandler.sendMessage(msg);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸»è¦æ˜¯åˆ›å»ºäº†ä¸€ä¸ªç±»å‹ä¸º<code>INIT_COPY</code>çš„Messageå¯¹è±¡ï¼Œç„¶åé€šè¿‡å‘é€åˆ°mHandlerã€‚æ³¨æ„æ³¨é‡Š1å¤„çš„msg.objçš„å€¼ï¼Œæ˜¯ä¸€ä¸ª<code>InstallParams</code>å¯¹è±¡(ç»§æ‰¿è‡ªHandlerParams)ï¼Œåé¢ä¼šç”¨åˆ°ã€‚æˆ‘ä»¬æ¥ç€çœ‹mHanlderçš„å¤„ç†</p><h4 id="com-android-server-pm-PackageManagerService-1"><a href="#com-android-server-pm-PackageManagerService-1" class="headerlink" title="com.android.server.pm.PackageManagerService"></a>com.android.server.pm.PackageManagerService</h4><p>è¿™é‡Œçš„mHandleræ˜¯ç»§æ‰¿è‡ªHandlerçš„<code>PackageHandler</code>å¯¹è±¡ï¼Œæ˜¯PMSçš„å†…éƒ¨ç±»ï¼Œæˆ‘ä»¬çœ‹ä¸‹å…·ä½“çš„å¤„ç†é€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">doHandleMessage</span><span class="hljs-params">(Message msg)</span> &#123;<br>           <span class="hljs-keyword">switch</span> (msg.what) &#123;<br>               <span class="hljs-keyword">case</span> INIT_COPY: &#123;<br>                   <span class="hljs-type">HandlerParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> (HandlerParams) msg.obj;<br>                   <span class="hljs-type">int</span> <span class="hljs-variable">idx</span> <span class="hljs-operator">=</span> mPendingInstalls.size();<br>                   <span class="hljs-keyword">if</span> (DEBUG_INSTALL) Slog.i(TAG, <span class="hljs-string">&quot;init_copy idx=&quot;</span> + idx + <span class="hljs-string">&quot;: &quot;</span> + params);<br>                   <span class="hljs-comment">// If a bind was already initiated we dont really</span><br>                   <span class="hljs-comment">// need to do anything. The pending install</span><br>                   <span class="hljs-comment">// will be processed later on.</span><br>                   <span class="hljs-keyword">if</span> (!mBound) &#123;<br>                       Trace.asyncTraceBegin(TRACE_TAG_PACKAGE_MANAGER, <span class="hljs-string">&quot;bindingMCS&quot;</span>,<br>                               System.identityHashCode(mHandler));<br>                       <span class="hljs-comment">// If this is the only one pending we might</span><br>                       <span class="hljs-comment">// have to bind to the service again.</span><br>                       <span class="hljs-keyword">if</span> (!connectToService()) &#123;<br>                           Slog.e(TAG, <span class="hljs-string">&quot;Failed to bind to media container service&quot;</span>);<br>                           params.serviceError();<br>                           Trace.asyncTraceEnd(TRACE_TAG_PACKAGE_MANAGER, <span class="hljs-string">&quot;bindingMCS&quot;</span>,<br>                                   System.identityHashCode(mHandler));<br>                           <span class="hljs-keyword">if</span> (params.traceMethod != <span class="hljs-literal">null</span>) &#123;<br>                               Trace.asyncTraceEnd(TRACE_TAG_PACKAGE_MANAGER, params.traceMethod,<br>                                       params.traceCookie);<br>                           &#125;<br>                           <span class="hljs-keyword">return</span>;<br>                       &#125; <span class="hljs-keyword">else</span> &#123;<br>                           <span class="hljs-comment">// Once we bind to the service, the first</span><br>                           <span class="hljs-comment">// pending request will be processed.</span><br>                           mPendingInstalls.add(idx, params);<br>                       &#125;<br>                   &#125; <span class="hljs-keyword">else</span> &#123;<br>                       mPendingInstalls.add(idx, params);<br>                       <span class="hljs-comment">// Already bound to the service. Just make</span><br>                       <span class="hljs-comment">// sure we trigger off processing the first request.</span><br>                       <span class="hljs-keyword">if</span> (idx == <span class="hljs-number">0</span>) &#123;<br>                           mHandler.sendEmptyMessage(MCS_BOUND);<br>                       &#125;<br>                   &#125;<br>                   <span class="hljs-keyword">break</span>;<br>               &#125;<br>           &#125;<br></code></pre></td></tr></table></figure><p>mBoundè¡¨ç¤ºæ˜¯å¦ç»‘å®šäº†<code>DefaultContainerService</code>æœåŠ¡ï¼Œæ²¡æœ‰ç»‘å®šçš„è¯åˆ™é‡æ–°ç»‘å®šï¼Œç»‘å®šæˆåŠŸååˆ™å°†å‚æ•°æ·»åŠ åˆ°<code>mPendingInstalls</code>ä¸­ç­‰å¾…å¤„ç†ï¼›</p><p>ç»‘å®šæœåŠ¡çš„ä»£ç åœ¨è¿™é‡Œ:<code>DefaultContainerConnection</code>ä¹Ÿæ˜¯PMSçš„å†…éƒ¨ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">private</span> <span class="hljs-type">DefaultContainerConnection</span> <span class="hljs-variable">mDefContainerConn</span> <span class="hljs-operator">=</span><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultContainerConnection</span>();<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultContainerConnection</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ServiceConnection</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onServiceConnected</span><span class="hljs-params">(ComponentName name, IBinder service)</span> &#123;<br>        <span class="hljs-keyword">if</span> (DEBUG_SD_INSTALL) Log.i(TAG, <span class="hljs-string">&quot;onServiceConnected&quot;</span>);<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">IMediaContainerService</span> <span class="hljs-variable">imcs</span> <span class="hljs-operator">=</span> IMediaContainerService.Stub<br>                .asInterface(Binder.allowBlocking(service));<br>        mHandler.sendMessage(mHandler.obtainMessage(MCS_BOUND, imcs));<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onServiceDisconnected</span><span class="hljs-params">(ComponentName name)</span> &#123;<br>        <span class="hljs-keyword">if</span> (DEBUG_SD_INSTALL) Log.i(TAG, <span class="hljs-string">&quot;onServiceDisconnected&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œç»‘å®šæˆåŠŸåä¼šå‘é€ä¸€ä¸ªç±»å‹ä¸º<code>MCS_BOUND</code>çš„Messageå¯¹è±¡åˆ°mHandlerã€‚å½“ç„¶è¿™é‡Œå‘é€çš„æ¶ˆæ¯æ˜¯å¸¦æœ‰Objectå‚æ•°ï¼Œè€Œä¸Šé¢<code>INIT_COPY</code>ä¸­çš„æœ€åå‘é€çš„æ¶ˆæ¯æ˜¯ä¸å¸¦æœ‰Objectå‚æ•°çš„ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ç›´æ¥æ¢è®¨æ­£å¸¸æµç¨‹ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡å·²ç»ç»‘å®šï¼Œå¹¶ä¸”mPendingInstallsä¸­æœ‰å¾…å¤„ç†çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯èµ°<code>INIT_COPY</code>ä¸­çš„æœ€åä¸€æ¡åˆ†æ”¯ã€‚</p><p>è¿™æ—¶å€™åœ¨PackageHandleré‡Œé¢ä¼šèµ°è¿™ä¸ªåˆ†æ”¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (mPendingInstalls.size() &gt; <span class="hljs-number">0</span>) &#123;<br>                        <span class="hljs-type">HandlerParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> mPendingInstalls.get(<span class="hljs-number">0</span>);<br>                        <span class="hljs-keyword">if</span> (params != <span class="hljs-literal">null</span>) &#123;<br>                            Trace.asyncTraceEnd(TRACE_TAG_PACKAGE_MANAGER, <span class="hljs-string">&quot;queueInstall&quot;</span>,<br>                                    System.identityHashCode(params));<br>                            Trace.traceBegin(TRACE_TAG_PACKAGE_MANAGER, <span class="hljs-string">&quot;startCopy&quot;</span>);<br>                            <span class="hljs-keyword">if</span> (params.startCopy()) &#123;<br>                                <span class="hljs-comment">// We are done...  look for more work or to</span><br>                                <span class="hljs-comment">// go idle.</span><br>                                <span class="hljs-keyword">if</span> (DEBUG_SD_INSTALL) Log.i(TAG,<br>                                        <span class="hljs-string">&quot;Checking for more work or unbind...&quot;</span>);<br>                                <span class="hljs-comment">// Delete pending install</span><br>                                <span class="hljs-keyword">if</span> (mPendingInstalls.size() &gt; <span class="hljs-number">0</span>) &#123;<br>                                    mPendingInstalls.remove(<span class="hljs-number">0</span>);<br>                                &#125;<br>                                <span class="hljs-keyword">if</span> (mPendingInstalls.size() == <span class="hljs-number">0</span>) &#123;<br>                                    <span class="hljs-keyword">if</span> (mBound) &#123;<br>                                        <span class="hljs-keyword">if</span> (DEBUG_SD_INSTALL) Log.i(TAG,<br>                                                <span class="hljs-string">&quot;Posting delayed MCS_UNBIND&quot;</span>);<br>                                        removeMessages(MCS_UNBIND);<br>                                        <span class="hljs-type">Message</span> <span class="hljs-variable">ubmsg</span> <span class="hljs-operator">=</span> obtainMessage(MCS_UNBIND);<br>                                        <span class="hljs-comment">// Unbind after a little delay, to avoid</span><br>                                        <span class="hljs-comment">// continual thrashing.</span><br>                                        sendMessageDelayed(ubmsg, <span class="hljs-number">10000</span>);<br>                                    &#125;<br>                                &#125; <span class="hljs-keyword">else</span> &#123;<br>                                    <span class="hljs-comment">// There are more pending requests in queue.</span><br>                                    <span class="hljs-comment">// Just post MCS_BOUND message to trigger processing</span><br>                                    <span class="hljs-comment">// of next pending install.</span><br>                                    <span class="hljs-keyword">if</span> (DEBUG_SD_INSTALL) Log.i(TAG,<br>                                            <span class="hljs-string">&quot;Posting MCS_BOUND for next work&quot;</span>);<br>                                    mHandler.sendEmptyMessage(MCS_BOUND);<br>                                &#125;<br>                            &#125;<br>                            Trace.traceEnd(TRACE_TAG_PACKAGE_MANAGER);<br>                        &#125;<br>                    &#125;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨<code>params.startCopy()</code>ä¹‹åï¼Œä¼šå°†å½“å‰å®‰è£…ä»»åŠ¡ä»åˆ—è¡¨ä¸­ç§»é™¤ï¼Œæ¥ç€å¤„ç†ä¸‹ä¸€ä¸ªå®‰è£…ä»»åŠ¡ï¼›è¿™é‡Œçš„paramsæ˜¯ä¸Šé¢è¯´åˆ°çš„<code>InstallParams</code>å®ä¾‹ã€‚</p><p>çœ‹ä¸‹<code>HandlerParams.startCopy</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">startCopy</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">boolean</span> res;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">if</span> (DEBUG_INSTALL) Slog.i(TAG, <span class="hljs-string">&quot;startCopy &quot;</span> + mUser + <span class="hljs-string">&quot;: &quot;</span> + <span class="hljs-built_in">this</span>);<br><br>        <span class="hljs-keyword">if</span> (++mRetries &gt; MAX_RETRIES) &#123;<br>            Slog.w(TAG, <span class="hljs-string">&quot;Failed to invoke remote methods on default container service. Giving up&quot;</span>);<br>            mHandler.sendEmptyMessage(MCS_GIVE_UP);<br>            handleServiceError();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            handleStartCopy();<br>            res = <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (RemoteException e) &#123;<br>        <span class="hljs-keyword">if</span> (DEBUG_INSTALL) Slog.i(TAG, <span class="hljs-string">&quot;Posting install MCS_RECONNECT&quot;</span>);<br>        mHandler.sendEmptyMessage(MCS_RECONNECT);<br>        res = <span class="hljs-literal">false</span>;<br>    &#125;<br>    handleReturnCode();<br>    <span class="hljs-keyword">return</span> res;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„MAX_RETRIESå€¼è¢«å®šä¹‰ä¸º4ï¼Œå°è¯•æ¬¡æ•°è¶…è¿‡4æ¬¡ï¼Œåˆ™æ”¾å¼ƒè¿™ä¸ªå®‰è£…è¯·æ±‚ã€‚å¦‚æœæ²¡æœ‰è¶…è¿‡ï¼Œåˆ™æ‰§è¡Œ<code>handleStartCopy</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„å…·ä½“å®ç°åœ¨<code>InstallParams</code>ä¸­ã€‚è¯¥æ–¹æ³•çš„å…·ä½“å®ç°ä»£ç å¾ˆé•¿ï¼Œè¿™é‡ŒæŠ„ä¸€ä¸‹æ³¨é‡Š</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Invoke remote method to get package information and install</span><br><span class="hljs-comment"> * location values. Override install location based on default</span><br><span class="hljs-comment"> * policy if needed and then create install arguments based</span><br><span class="hljs-comment"> * on the install location.</span><br><span class="hljs-comment"> */</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡IMediaContainerServiceè·¨è¿›ç¨‹è°ƒç”¨DefaultContainerServiceçš„getMinimalPackageInfoæ–¹æ³•ï¼Œè½»é‡çº§è§£æapkå¹¶è·å–åˆ°apkçš„å°‘é‡ä¿¡æ¯ï¼Œå°è£…åˆ°PackageInfoLiteå¯¹è±¡ä¸­ã€‚ç„¶åç¡®è®¤å®‰è£…æœªçŸ¥ï¼Œåˆ›å»ºInstallArgså¯¹è±¡ã€‚è¿™é‡Œçš„InstallArgsæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œåœ¨PMSæœ‰ä¸‰ä¸ªå¯¹åº”çš„å­ç±»ï¼š</p><ul><li>FileInstallArgs:å¤„ç†å®‰è£…åˆ°éASECå­˜å‚¨ç©ºé—´çš„APKï¼Œä¹Ÿå°±æ˜¯å†…éƒ¨å­˜å‚¨ç©ºé—´(Dataåˆ†åŒº)</li><li>AsecInstallArgs:å¤„ç†å®‰è£…åˆ°ASECä¸­(mnt&#x2F;asecï¼Œä¹Ÿå°±æ˜¯å­˜å‚¨å¡)ä¸­çš„apk</li><li>MoveInstallArgs:å¤„ç†å·²å®‰è£…çš„APKåœ¨å­˜å‚¨ä¸­ç§»åŠ¨çš„é€»è¾‘</li></ul><p>å¤åˆ¶å®Œæˆåï¼Œä¼šæ¥ç€è°ƒç”¨<code>handleReturnCode</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸­åªæ˜¯è°ƒç”¨äº†<code>processPendingInstall</code>æ–¹æ³•ï¼Œçœ‹ä¸‹è¿™ä¸ªæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java">mHandler.post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>           <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>               mHandler.removeCallbacks(<span class="hljs-built_in">this</span>);<br>                <span class="hljs-comment">// Result object to be returned</span><br>               <span class="hljs-type">PackageInstalledInfo</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PackageInstalledInfo</span>();<br>               res.setReturnCode(currentStatus);<br>               res.uid = -<span class="hljs-number">1</span>;<br>               res.pkg = <span class="hljs-literal">null</span>;<br>               res.removedInfo = <span class="hljs-literal">null</span>;<br>               <span class="hljs-keyword">if</span> (res.returnCode == PackageManager.INSTALL_SUCCEEDED) &#123;<br>                   args.doPreInstall(res.returnCode);<span class="hljs-comment">//-------1-------</span><br>                   <span class="hljs-keyword">synchronized</span> (mInstallLock) &#123;<br>                       installPackageTracedLI(args, res);<span class="hljs-comment">//-------2-------</span><br>                   &#125;<br>                   args.doPostInstall(res.returnCode, res.uid);<span class="hljs-comment">//-------3-------</span><br>               &#125;<br>               ......<br>           &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><p>æ³¨é‡Š1å¤„ä¼šæ£€æŸ¥apkçŠ¶æ€ï¼Œç¡®ä¿å®‰è£…ç¯å¢ƒå¯é ï¼Œå¦åˆ™æ¸…é™¤å¤åˆ¶çš„apkæ–‡ä»¶ï¼Œåœ¨æ³¨é‡Š3å¤„è¿›è¡Œå®‰è£…åçš„æ”¶å°¾å·¥ä½œï¼›</p><p>ä¸»è¦çœ‹ä¸‹æ³¨é‡Š2å¤„çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å†…éƒ¨ä¼šè°ƒç”¨PMSçš„installPackageLIæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¹ŸæŒºé•¿çš„ï¼Œç®€å•è¯´ä¸‹è¿™ä¸ªæ–¹æ³•åšäº†ä»€ä¹ˆï¼š</p><ul><li>åˆ›å»ºPackageParserï¼Œè§£æapk</li><li>æ£€æŸ¥APKæ˜¯å¦å·²ç»å®‰è£…</li><li>å¦‚æœPackageSettingä¸­å­˜åœ¨è¦å®‰è£…çš„apkä¿¡æ¯ï¼Œåˆ™è¡¨ç¤ºè¦æ›¿æ¢å®‰è£…ï¼Œéœ€è¦è¿›è¡Œç­¾åæ ¡éªŒï¼Œç¡®ä¿æ›¿æ¢å®‰è£…æ˜¯å®‰å…¨çš„</li><li>å¦‚æœæ˜¯æ›¿æ¢å®‰è£…ï¼Œåˆ™è°ƒç”¨replacePackageLIFæ–¹æ³•ï¼Œå¦‚æœæ˜¯å®‰è£…æ–°çš„apkï¼Œè°ƒç”¨installNewPackageLIFæ–¹æ³•ã€‚</li></ul><p>æˆ‘ä»¬ä»¥å®‰è£…æ–°çš„apkä¸ºä¾‹</p><ol><li>æ‰«æAPKï¼Œå°†apkä¿¡æ¯å­˜å‚¨åœ¨PackageParser.Packageç±»å‹çš„newPackageä¸­ï¼Œä¸€ä¸ªPackageçš„ä¿¡æ¯åŒ…å«äº†ä¸€ä¸ªbase apkå’ŒNä¸ªsplit APK</li><li>æ›´æ–°è¯¥APKå¯¹åº”çš„PackageSettingä¿¡æ¯</li><li>å¦‚æœå®‰è£…æˆåŠŸï¼Œåˆ™ä¸ºæ–°åº”ç”¨å‡†å¤‡æ•°æ®ï¼›å¦‚æœå®‰è£…å¤±è´¥ï¼Œåˆ™åˆ é™¤APK</li></ol><p>æ€»ç»“ä¸€ä¸‹</p><ol><li>PackageINstallerå®‰è£…APKæ—¶ä¼šå°†APKçš„ä¿¡æ¯äº¤ç”±PMSå¤„ç†ï¼ŒPMSåˆ™é€šè¿‡PackageHandlerå‘é€æ¶ˆæ¯æ¥é©±åŠ¨APKçš„å¤åˆ¶å’Œå®‰è£…å·¥ä½œ</li><li>PMSå‘é€INIT_COPYå’ŒMCS_BOUNDç±»å‹çš„æ¶ˆæ¯ï¼Œé©±åŠ¨PackageHandleræ¥ç»‘å®šDefaultContainerServiceï¼Œå®ŒæˆAPKçš„å¤åˆ¶ç­‰å·¥ä½œ</li><li>è¿›è¡ŒAPKçš„å®‰è£…å‰æ£€æŸ¥ï¼Œå®‰è£…APKåŠå®‰è£…åçš„æ”¶å°¾å·¥ä½œ</li></ol><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Androidå¯åŠ¨è¿‡ç¨‹</title>
    <link href="/2021/03/04/Android%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B/"/>
    <url>/2021/03/04/Android%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="Androidå¯åŠ¨è¿‡ç¨‹"><a href="#Androidå¯åŠ¨è¿‡ç¨‹" class="headerlink" title="Androidå¯åŠ¨è¿‡ç¨‹"></a>Androidå¯åŠ¨è¿‡ç¨‹</h2><p>ä»Zygoteå¯åŠ¨è¿‡ç¨‹å¼€å§‹ï¼Œçœç•¥æ‰äº†å‰é¢çš„è§£æ.rcæ–‡ä»¶ç­‰æ­¥éª¤</p><span id="more"></span><h4 id="Zygote-å¯åŠ¨è¿‡ç¨‹"><a href="#Zygote-å¯åŠ¨è¿‡ç¨‹" class="headerlink" title="Zygote å¯åŠ¨è¿‡ç¨‹"></a>Zygote å¯åŠ¨è¿‡ç¨‹</h4><div id="sequence-0"></div><p><img src="/image/Android/aosp/zygote_start.png" alt="zygote_startr"></p><p>è§£é‡Šä¸€ä¸‹ï¼š</p><ol><li>è§£æinit.zygote.rcä¸­çš„å‚æ•°ï¼Œåˆ›å»ºAppRuntimeå¹¶è°ƒç”¨AppRuntime.start()æ–¹æ³•</li><li>è°ƒç”¨AndroidRuntimeçš„startVM()æ–¹æ³•åˆ›å»ºè™šæ‹Ÿæœºï¼Œå†è°ƒç”¨startReg()æ³¨å†ŒJNIå‡½æ•°</li><li>é€šè¿‡JNIæ–¹å¼è°ƒç”¨ZygoteInit.main()ï¼Œç¬¬ä¸€æ¬¡è¿›å…¥javaä¸–ç•Œ</li><li>registerZygoteSocket()å»ºç«‹socketé€šé“ï¼Œzygoteä½œä¸ºé€šä¿¡çš„æœåŠ¡ç«¯ï¼Œç”¨äºå“åº”å®¢æˆ·ç«¯è¯·æ±‚</li><li>preload()é¢„åŠ è½½é€šç”¨ç±»ã€drawableå’Œcolorèµ„æºã€openGLä»¥åŠå…±äº«åº“ä»¥åŠWebViewï¼Œç”¨äºæé«˜appå¯åŠ¨æ•ˆç‡</li><li>zygoteå®Œæˆå¤§éƒ¨åˆ†å·¥ä½œï¼Œæ¥ä¸‹æ¥å†é€šè¿‡startSystemServer(),forkå¾—åŠ›åŠ©æ‰‹system-serverè¿›è¡Œï¼Œä¹Ÿæ˜¯ä¸Šå±‚frameworkçš„è¿è¡Œè½½ä½“</li><li>zygoteåŠŸæˆèº«é€€ï¼Œè°ƒç”¨runSelectLoop()ï¼Œéšæ—¶å¾…å‘½ï¼Œå½“æ¥æ”¶åˆ°è¯·æ±‚åˆ›å»ºæ–°è¿›è¡Œè¯·æ±‚æ—¶ç«‹å³å”¤é†’å¹¶æ‰§è¡Œç›¸åº”å·¥ä½œã€‚</li></ol><h4 id="SystemService-å¯åŠ¨æµç¨‹"><a href="#SystemService-å¯åŠ¨æµç¨‹" class="headerlink" title="SystemService å¯åŠ¨æµç¨‹"></a>SystemService å¯åŠ¨æµç¨‹</h4><p><img src="/image/Android/aosp/start_system_server.png" alt="start_system_server"></p><p>ä¸Šå›¾å‰4ä¸ªæ­¥éª¤è¿è¡Œåœ¨Zygoteè¿›è¡Œï¼Œä»ç¬¬äº”æ­¥å¼€å§‹æ˜¯è¿è¡Œåœ¨æ–°åˆ›å»ºçš„system_server,è¿™æ˜¯forkæœºåˆ¶å®ç°çš„ã€‚</p><p>RuntimeInit.java ä¸­ invokeStaticMain æ–¹æ³•é€šè¿‡åˆ›å»ºå¹¶æŠ›å‡ºå¼‚å¸¸ ZygoteInit.MethodAndArgsCallerï¼Œåœ¨ ZygoteInit.java ä¸­çš„ main()æ–¹æ³•ä¼šæ•æ‰è¯¥å¼‚å¸¸ï¼Œå¹¶è°ƒç”¨ caller.run()ï¼Œå†é€šè¿‡åå°„ä¾¿ä¼šè°ƒç”¨åˆ° SystemServer.main()æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­åˆ›å»ºSystemServerå¯¹è±¡å¹¶æ‰§è¡Œrunæ–¹æ³•ã€‚<br>åœ¨è¯¥æ–¹æ³•ä¸­æ‰§è¡Œäº†å¦‚ä¸‹æ“ä½œ</p><ul><li><p>è®¾ç½®ç³»ç»Ÿæ—¶é—´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (System.currentTimeMillis() &lt; EARLIEST_SUPPORTED_TIME) &#123;<br>              Slog.w(TAG, <span class="hljs-string">&quot;System clock is before 1970; setting to 1970.&quot;</span>);<br>              SystemClock.setCurrentTimeMillis(EARLIEST_SUPPORTED_TIME);<br>          &#125;<br></code></pre></td></tr></table></figure></li><li><p>å˜æ›´è™šæ‹Ÿæœºåº“æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">SystemProperties.set(<span class="hljs-string">&quot;persist.sys.dalvik.vm.lib.2&quot;</span>, VMRuntime.getRuntime().vmLibrary());<br></code></pre></td></tr></table></figure></li><li><p>Mmmmmmâ€¦ more memory!ï¼ˆæ¸…é™¤vmå†…å­˜å¢é•¿é™åˆ¶ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">VMRuntime.getRuntime().clearGrowthLimit();<br></code></pre></td></tr></table></figure></li><li><p>Prepare the main looper thread (this thread)</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">android.os.Process.setThreadPriority(<br>             android.os.Process.THREAD_PRIORITY_FOREGROUND);<br>         android.os.Process.setCanSelfBackground(<span class="hljs-literal">false</span>);<br>         Looper.prepareMainLooper();<br>         Looper.getMainLooper().setSlowLogThresholdMs(<br>                 SLOW_DISPATCH_THRESHOLD_MS, SLOW_DELIVERY_THRESHOLD_MS);<br></code></pre></td></tr></table></figure></li><li><p>Initialize native services</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">System.loadLibrary(<span class="hljs-string">&quot;android_servers&quot;</span>);<br></code></pre></td></tr></table></figure></li><li><p>æ£€æµ‹ä¸Šæ¬¡å…³æœºè¿‡ç¨‹æ˜¯å¦å¤±è´¥ï¼Œè¯¥æ–¹æ³•å¯èƒ½ä¸ä¼šè¿”å›</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">performPendingShutdown();<br></code></pre></td></tr></table></figure></li><li><p>Initialize the system context</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">createSystemContext();<span class="hljs-comment">//è¿™é‡Œéœ€è¦åŒºåˆ†system_serverè¿›ç¨‹å’Œappè¿›ç¨‹ï¼šhttp://gityuan.com/2017/04/02/android-application/</span><br></code></pre></td></tr></table></figure></li><li><p>Create the system service manager</p></li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">mSystemServiceManager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SystemServiceManager</span>(mSystemContext);<br><span class="hljs-comment">//å°† mSystemServiceManager æ·»åŠ åˆ°æœ¬åœ°æœåŠ¡çš„æˆå‘˜ sLocalServiceObjects</span><br>LocalServices.addService(SystemServiceManager.class, mSystemServiceManage<br>r);<br></code></pre></td></tr></table></figure><ul><li>Start services  startBootstrapServices();<blockquote><p>è¯¥æ–¹æ³•æ‰€åˆ›å»ºçš„æœåŠ¡:DeviceIdentifiersPolicyServiceã€ActivityManagerServiceã€PowerManagerServiceã€RecoverySystemServiceã€LightsServiceã€DisplayManagerServiceã€PackageManagerServiceã€ UserManagerServiceã€ SensorService.</p></blockquote><p>  startCoreServices();</p><blockquote><p>å¯åŠ¨æœåŠ¡ BatteryServiceï¼ŒUsageStatsServiceï¼ŒWebViewUpdateServiceã€‚</p></blockquote><p>  startOtherServices();</p><blockquote><p>è¿™é‡Œå¯åŠ¨çš„æœåŠ¡æŒºå¤šçš„ï¼Œæ¡ä¸»è¦çš„å†™ä¸€ä¸‹ï¼šVibratorServiceã€NetworkManagementServiceã€IpSecServiceã€NetworkStatsServiceã€WindowManagerServiceã€InputManagerServiceã€AlarmManagerService</p></blockquote></li></ul><p>SystemServer å¯åŠ¨å„ç§æœåŠ¡ä¸­æœ€åçš„ä¸€ä¸ªç¯èŠ‚ä¾¿æ˜¯ AMS.systemReady()ï¼Œåˆ°æ­¤, System_server ä¸»çº¿ç¨‹çš„å¯åŠ¨å·¥ä½œæ€»ç®—å®Œæˆ, è¿›å…¥ Looper.loop()çŠ¶æ€,ç­‰å¾… å…¶ä»–çº¿ç¨‹é€šè¿‡ handler å‘é€æ¶ˆæ¯åˆ°ä¸»çº¿å†å¤„ç†ã€‚<script src="https://cdnjs.cloudflare.com/ajax/libs/webfont/1.6.27/webfontloader.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/snap.svg/0.4.1/snap.svg-min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/js-sequence-diagrams/1.0.6/sequence-diagram-min.js"></script><textarea id="sequence-0-code" style="display: none">title:Zygoteå¯åŠ¨è¿‡ç¨‹participant App_main.cppparticipant AndroidRuntime.cppparticipant ZygoteInit.javaparticipant ZygoteConnection.javaparticipant Zygote.javaApp_main.cpp -> App_main.cpp : 1:mainApp_main.cpp -> AndroidRuntime.cpp: 2:startAndroidRuntime.cpp -> AndroidRuntime.cpp:3:startVMAndroidRuntime.cpp -> AndroidRuntime.cpp: 4:startRegAndroidRuntime.cpp -> ZygoteInit.java: 5:mainZygoteInit.java -> ZygoteInit.java : 6:registerZygoteSocketZygoteInit.java -> ZygoteInit.java : 7:preloadZygoteInit.java -> ZygoteInit.java : 8:startSystemServerZygoteInit.java -> Zygote.java : 9:forkSystemServerZygoteInit.java -> ZygoteInit.java : 10:runSelectLoopZygoteInit.java -> ZygoteConnection.java: 11:runOnceZygoteConnection.java -> Zygote.java: 12:forkAndSpecialize</textarea><textarea id="sequence-0-options" style="display: none">{"theme":"simple"}</textarea><script>  var code = document.getElementById("sequence-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("sequence-0-options").value));  var diagram = Diagram.parse(code);  diagram.drawSVG("sequence-0", options);</script></p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å†™åœ¨2021å¹´åˆ-2020æ€»ç»“</title>
    <link href="/2021/01/02/%E5%86%99%E5%9C%A82021%E5%B9%B4%E5%88%9D-2020%E6%80%BB%E7%BB%93/"/>
    <url>/2021/01/02/%E5%86%99%E5%9C%A82021%E5%B9%B4%E5%88%9D-2020%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<p>2020å¹´ï¼Œå¤šç¾å¤šéš¾çš„ä¸€å¹´ï¼Œä½†æ˜¯åœ¨è¿™ä¸€å¹´å®Œæˆäº†äººç”Ÿçš„ä¸€ä»¶å¤§äº‹ï¼šä¸¾åŠäº†å©šç¤¼.</p><span id="more"></span><h4 id="2020å¹´å¹²äº†å•¥"><a href="#2020å¹´å¹²äº†å•¥" class="headerlink" title="2020å¹´å¹²äº†å•¥"></a>2020å¹´å¹²äº†å•¥</h4><ul><li>äº†è§£äº†ä»¥ä¸‹Android Jetpack</li><li>é‡æ¸©æ•°æ®ç»“æ„ï¼Œçœ‹äº†ç‚¹ç®—æ³•è¯¾ç¨‹</li><li>ç®€å•çš„å­¦äº†iOSå¼€å‘</li><li>ç®€å•å­¦ä¹ äº†æ­£åˆ™</li><li>ç®€å•äº†è§£é¸¿è’™åº”ç”¨å¼€å‘</li><li>äº†è§£Gradleæ’ä»¶å¼€å‘</li></ul><p>ã€Šè½¯æŠ€èƒ½ ä»£ç ä¹‹å¤–çš„ç”Ÿå­˜æŒ‡å—ã€‹</p><p>ã€Šä»£ç æ•´æ´ä¹‹é“ã€‹</p><p>ã€ŠAndroidè®¾è®¡æ¨¡å¼ä¹‹ç¦…ã€‹</p><p>æ€»ä½“æ¥çœ‹ï¼Œä¼¼ä¹ä¹Ÿæ²¡å¹²å•¥</p><h4 id="2021å¹´ç›®æ ‡"><a href="#2021å¹´ç›®æ ‡" class="headerlink" title="2021å¹´ç›®æ ‡"></a>2021å¹´ç›®æ ‡</h4><ol><li>Androidç³»ç»Ÿæ¶æ„ã€å¯åŠ¨æµç¨‹ã€ç³»ç»ŸæœåŠ¡</li><li>ç®—æ³•ï¼Œä¸€å®šè¦åˆ·é¢˜</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>ä¹±ä¸ƒå…«ç³Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AndroidStudioæ’ä»¶å¼€å‘</title>
    <link href="/2020/12/13/AndroidStudio%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/"/>
    <url>/2020/12/13/AndroidStudio%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/</url>
    
    <content type="html"><![CDATA[<p>å†™äº†ä¸ªç±»ä¼¼<code>Butter Knife</code>çš„<a href="https://github.com/huangyuanlove/AndroidAnnotation">å¼€å‘åº“</a>ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä¸å…¶é…å¥—çš„AndroidStudioæ’ä»¶ï¼ŒæŠ½æ—¶é—´ç ”ç©¶äº†ä»¥ä¸‹IDEAçš„apiæ–‡æ¡£ï¼Œæ’¸äº†ä¸€ä¸ªå¯¹åº”çš„æ’ä»¶ï¼Œ<a href="https://github.com/huangyuanlove/AndroidAnnotation-Plugin">æºç åœ¨è¿™é‡Œ</a></p><p>ä»£ç å‚è€ƒ<a href="https://github.com/avast/android-butterknife-zelezny">https://github.com/avast/android-butterknife-zelezny</a></p><p>æ‰€ç”¨åˆ°çš„çŸ¥è¯†ç‚¹ï¼š</p><ol><li>æŸ¥æ‰¾æ–‡ä»¶</li><li>è§£æxml</li><li>å†™æ–‡ä»¶<br>IDEAæ’ä»¶å¼€å‘æ–‡æ¡£ï¼š<a href="https://jetbrains.org/intellij/sdk/docs/intro/welcome.html">https://jetbrains.org/intellij/sdk/docs/intro/welcome.html</a><span id="more"></span></li></ol><h4 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h4><p>å®˜æ–¹æ¨èåˆ›å»ºgradleé¡¹ç›®ï¼Œè¿™é‡Œè´´ä¸ªå›¾ï¼Œåˆ›å»ºè¿‡ç¨‹æŒ‰ç…§å®˜ç½‘å™è¿°çš„åˆ›å»ºå°±å¥½</p><p><a href="https://jetbrains.org/intellij/sdk/docs/tutorials/build_system/prerequisites.html">https://jetbrains.org/intellij/sdk/docs/tutorials/build_system/prerequisites.html</a></p><p>è¿™é‡Œè¯´æ˜ä¸€ä¸‹ï¼Œå¦‚æœæƒ³è¦åœ¨AndroidStudioä¸­è¿›è¡Œdebugï¼Œé˜…è¯»ä¸€ä¸‹è¿™ä¸ª</p><p><a href="https://jetbrains.org/intellij/sdk/docs/products/android_studio.html">https://jetbrains.org/intellij/sdk/docs/products/android_studio.html</a></p><p>ä¹Ÿå°±æ˜¯åœ¨é¡¹ç›®æ ¹ç›®å½•çš„çš„<code>build.gradle</code>ä¸­é…ç½® <code>intellij</code>å’Œ<code>runIde</code>ï¼Œå…·ä½“å«ä¹‰å¯åœ¨ç½‘é¡µä¸­æ‰¾åˆ°ï¼Œè¿™é‡Œä¸å†èµ˜è¿°</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">// See https://github.com/JetBrains/gradle-intellij-plugin/</span><br>intellij &#123;<br>    version <span class="hljs-string">&#x27;201.8743.12&#x27;</span><br>    type <span class="hljs-string">&#x27;IC&#x27;</span><br>    plugins = [<span class="hljs-string">&#x27;android&#x27;</span>, <span class="hljs-string">&#x27;java&#x27;</span>]<br>&#125;<br>runIde &#123;<br>    <span class="hljs-comment">// Absolute path to installed target 3.5 Android Studio to use as IDE Development Instance</span><br>    <span class="hljs-comment">// The &quot;Contents&quot; directory is macOS specific.</span><br><span class="hljs-comment">//    ideDirectory &#x27;/Applications/Android Studio.app/Contents&#x27; //for mac</span><br><span class="hljs-comment">//    ideDirectory &#x27;/home/huangyuan/androidStudio&#x27; //for linux</span><br>    ideDirectory <span class="hljs-string">&#x27;G:\\AndroidStudio&#x27;</span> <span class="hljs-comment">//for window</span><br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/image/Android/AndroidStudioPlugin/create_plugin_gradle.png" alt="create_plugin_gradle"></p><h4 id="åˆ›å»ºç±»"><a href="#åˆ›å»ºç±»" class="headerlink" title="åˆ›å»ºç±»"></a>åˆ›å»ºç±»</h4><p>åˆ›å»ºä¸€ä¸ªç»§æ‰¿AnAction çš„ç±»ï¼Œè¿™é‡Œåˆ›å»ºçš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ä¸ªæ˜¯ç›´æ¥åˆ›å»ºjavaç±»ï¼Œç„¶åå†å»æ³¨å†Œï¼›å¦å¤–ä¸€ä¸ªå°±æ˜¯é€šè¿‡æƒ³åˆ°ç›´æ¥åˆ›å»º(å°±åƒæˆ‘ä»¬åˆ›å»ºActivityä¸€æ ·)ï¼›</p><p>å…·ä½“å¯ä»¥çœ‹è¿™é‡Œ <a href="https://jetbrains.org/intellij/sdk/docs/tutorials/action_system/working_with_custom_actions.html">https://jetbrains.org/intellij/sdk/docs/tutorials/action_system/working_with_custom_actions.html</a></p><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦è§£ælayoutæ–‡ä»¶(xmlæ–‡ä»¶)å¹¶ä¸”è¿˜è¦å†™å…¥æ–‡ä»¶ï¼Œæ‰€ä»¥å°±ç›´æ¥ç»§æ‰¿<code>BaseGenerateAction</code>ï¼Œé‡å†™å…¶ä¸­çš„ä¸¤ä¸ªæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-meta">@NotNull</span> AnActionEvent e)</span> &#123;<br>   <span class="hljs-comment">// Using the event, evaluate the context, and enable or disable the action.</span><br>    e.getPresentation().setEnabledAndVisible(e.getProject() != <span class="hljs-literal">null</span>);<br>&#125;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">actionPerformed</span><span class="hljs-params">(<span class="hljs-meta">@NotNull</span> AnActionEvent event)</span> &#123;<br>    <span class="hljs-comment">// Using the event, implement an action. For example, create and show a dialog.</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å½“å·¥ç¨‹å¤„äºindexingçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸æƒ³è®©æ’ä»¶ç”Ÿæ•ˆï¼Œå¯ä»¥å®ç°<code>DumbAware</code>æ¥å£ï¼Œç»§ç»­å‘<code>actionPerformed</code>æ–¹æ³•ä¸­æ·»åŠ é€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">actionPerformed</span><span class="hljs-params">(<span class="hljs-meta">@NotNull</span> AnActionEvent event)</span> &#123;<br>    <span class="hljs-comment">//è·å–å·¥ç¨‹å¯¹è±¡ï¼Œå…·ä½“ä¿¡æ¯å¯ä»¥çœ‹è¿™é‡Œ https://jetbrains.org/intellij/sdk/docs/basics/project_structure.html</span><br>    <span class="hljs-type">Project</span> <span class="hljs-variable">project</span> <span class="hljs-operator">=</span> event.getData(PlatformDataKeys.PROJECT);<br>    <span class="hljs-keyword">if</span>(project ==<span class="hljs-literal">null</span>)&#123;<br>        <span class="hljs-keyword">return</span> ;<br>    &#125;<br>    <span class="hljs-type">Editor</span> <span class="hljs-variable">editor</span> <span class="hljs-operator">=</span> event.getData(PlatformDataKeys.EDITOR);<br>    <span class="hljs-keyword">if</span>(editor ==<span class="hljs-literal">null</span>)&#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-type">DumbService</span> <span class="hljs-variable">dumbService</span> <span class="hljs-operator">=</span> DumbService.getInstance(project);<br>    <span class="hljs-keyword">if</span> (dumbService.isDumb()) &#123;<br>        dumbService.showDumbModeNotification(<span class="hljs-string">&quot;ViewInject plugin is not available during indexing&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-comment">//è¿™é‡Œæ˜¯æˆ‘ä»¬è‡ªå·±çš„é€»è¾‘</span><br>    analyze(project, editor);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="è·å–æ–‡ä»¶"><a href="#è·å–æ–‡ä»¶" class="headerlink" title="è·å–æ–‡ä»¶"></a>è·å–æ–‡ä»¶</h4><p>æˆ‘ä»¬å¯ä»¥è·å–åˆ°å½“å‰å…‰æ ‡æ‰€æŒ‡å‘çš„ä½ç½®ï¼Œä¹Ÿå¯ä»¥è·å–å½“å‰é€‰ä¸­çš„å­—ç¬¦ï¼Œæˆ‘ä»¬ä»å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°æˆ‘ä»¬è‡ªå·±éœ€è¦çš„ä¸œè¥¿ï¼šéœ€è¦çœ‹ä¸€ä¸‹PSI(Program Structure Interface),å…·ä½“ä¿¡æ¯åœ¨è¿™é‡Œ<a href="https://jetbrains.org/intellij/sdk/docs/basics/architectural_overview/psi.html">https://jetbrains.org/intellij/sdk/docs/basics/architectural_overview/psi.html</a></p><p>å…³é”®ä¿¡æ¯åœ¨<a href="https://jetbrains.org/intellij/sdk/docs/basics/architectural_overview/psi_elements.html">PSI element</a> å’Œ <a href="https://jetbrains.org/intellij/sdk/docs/basics/architectural_overview/psi_files.html">PSI Files</a>ï¼Œé¡¹ç›®çš„ä¸­çš„å…·ä½“é€»è¾‘åœ¨<code>GetLayoutFileUtil.java</code>ï¼Œè¿™é‡Œæ¯”è¾ƒéº»çƒ¦ä¸€äº›ï¼Œç”¨åˆ°äº†<code>Module</code>å’Œ<code>GlobalSearchScope</code>è¿™ä¸¤ä¸ªç±»ï¼Œ<a href="https://jetbrains.org/intellij/sdk/docs/reference_guide/project_model/module.html">å…·ä½“å¯ä»¥çœ‹è¿™é‡Œhttps://jetbrains.org/intellij/sdk/docs/reference_guide&#x2F;project_model&#x2F;module.html</a>ï¼Œå°±ä¸å†æŠ„ä¸€é+ç¿»è¯‘äº†</p><h4 id="è§£ææ–‡ä»¶"><a href="#è§£ææ–‡ä»¶" class="headerlink" title="è§£ææ–‡ä»¶"></a>è§£ææ–‡ä»¶</h4><p>è¿™é‡Œæˆ‘ä»¬æ‹¿åˆ°äº†å¯¹åº”çš„<code>layout.xml</code>æ–‡ä»¶å¯¹è±¡ï¼Œä¸€ä¸ª<code>PsiFile</code>å¯¹è±¡ï¼Œè°ƒç”¨æ–‡ä»¶çš„éå†æ–¹æ³•<code>layoutFile.accept(PsiElementVisitor visitor)</code>ï¼Œè¿™é‡Œæˆ‘ä»¬ä¼ å…¥<code>XmlRecursiveElementVisitor</code>å®ä¾‹å¯¹è±¡ï¼Œåœ¨è§£æxmlçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°<code>&lt;include&gt;</code>æ ‡ç­¾ï¼Œéœ€è¦ç»§ç»­è§£æè¯¥æ ‡ç­¾ä¸‹çš„xmlæ–‡ä»¶ï¼Œè¿™é‡Œæä¸ªé€’å½’ã€‚</p><h4 id="å±•ç¤ºè§£æå†…å®¹"><a href="#å±•ç¤ºè§£æå†…å®¹" class="headerlink" title="å±•ç¤ºè§£æå†…å®¹"></a>å±•ç¤ºè§£æå†…å®¹</h4><p>è§£æå‡ºæ¥çš„æ•°æ®å­˜å…¥ArrayListä¸­ï¼Œåœ¨è§£æè¿‡ç¨‹ä¸­ï¼Œä¿å­˜äº†å¯¹åº”idã€åˆ¤æ–­æ˜¯å¦å¼•ç”¨äº†android name spaceä¸­idã€å°†idçš„å€¼è½¬åŒ–ä¸ºå¯¹åº”çš„å­—æ®µåå­—ã€ä¿å­˜äº†æ˜¯æ˜¯å¦ä¸ºè‡ªå®šä¹‰çš„viewç­‰ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> String id;<br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">isAndroidNS</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><span class="hljs-keyword">public</span> String nameFull; <span class="hljs-comment">// element name with package</span><br><span class="hljs-keyword">public</span> String name; <span class="hljs-comment">// element name</span><br><span class="hljs-keyword">public</span> String fieldName; <span class="hljs-comment">// name of variable</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">isValid</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">used</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">isClick</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br></code></pre></td></tr></table></figure><p>å±•ç¤ºè§£æå†…å®¹ä½¿ç”¨<code>javax.swing</code>ç»„ä»¶ï¼Œè¿™ä¸ªä¹Ÿæ²¡ä»€ä¹ˆå¥½è¯´çš„ã€‚</p><p><img src="/image/Android/AndroidStudioPlugin/AndroidAnnotation.png" alt="show_android_annotation_info"></p><p>åœ¨å±•ç¤ºé¢æ¿ä¸Šæä¾›çš„å…¨é€‰åŠŸèƒ½ï¼›æä¾›äº†ç”Ÿæˆä»£ç çš„ä¸¤ç§æ ¼å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@BindView(idStr = &quot;xxxx&quot;)</span> <span class="hljs-comment">//å¯åœ¨libraryã€applicationä¸­ä½¿ç”¨</span><br><span class="hljs-meta">@BindView(id = R.id.xxx)</span> <span class="hljs-comment">//ä»…åœ¨applicationä¸­ä½¿ç”¨</span><br></code></pre></td></tr></table></figure><p>å› ä¸ºåœ¨libraryä¸­ç”Ÿæˆçš„Ræ–‡ä»¶ä¸­çš„å˜é‡ä¸æ˜¯finalç±»å‹ï¼Œå¹¶ä¸”applicationä¸­çš„Ræ–‡ä»¶å˜é‡ï¼Œåœ¨gradle plugin  5.0ä¹‹åä¹Ÿä¸å†æ˜¯finalçš„ï¼Œæ‰€ä»¥å»ºè®®ä½¿ç”¨idStrçš„æ–¹å¼ï¼Œä¹Ÿæ˜¯é»˜è®¤ç”Ÿæˆçš„ä»£ç </p><h4 id="å†™å…¥æ–‡ä»¶"><a href="#å†™å…¥æ–‡ä»¶" class="headerlink" title="å†™å…¥æ–‡ä»¶"></a>å†™å…¥æ–‡ä»¶</h4><p>ä¸ºäº†æ–¹ä¾¿ï¼Œå†™å…¥æ–‡ä»¶çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯<code>PsiClass</code>å¯¹è±¡è¿›è¡Œæ“ä½œçš„ï¼Œ<a href="https://upsource.jetbrains.com/idea-ce/file/idea-ce-4b94ba01122752d7576eb9d69638b6e89d1671b7/java/java-psi-api/src/com/intellij/psi/PsiClass.java">æºç åœ¨è¿™é‡Œ</a>ï¼Œè‡³äºå¦‚ä½•æ“ä½œPsiFileï¼Œ<a href="https://jetbrains.org/intellij/sdk/docs/basics/architectural_overview/psi.html">å¯ä»¥çœ‹è¿™é‡Œ</a>ã€‚å†™å…¥æ–‡ä»¶çš„è¿‡ç¨‹ï¼Œçœ‹èµ·æ¥ä¸ªä½¿ç”¨<code>javapoet</code>å·®ä¸å¤šï¼Œ<a href="https://github.com/square/javapoet">javapoetå¯ä»¥çœ‹è¿™é‡Œï¼Œgithubä¸Šç›´æ¥æœç´¢å³å¯</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">generateClick</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-keyword">for</span> (ElementBean element : mElements) &#123;<br>    <span class="hljs-keyword">if</span> (element.isClick) &#123;<br>      <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>      method.append(<span class="hljs-string">&quot;@ClickResponder(&quot;</span> + element.getGenerateValue(generateId) + <span class="hljs-string">&quot;)&quot;</span>);<br>      method.append(<span class="hljs-string">&quot;public void onClick&quot;</span> + Utils.capitalize(element.fieldName) + <span class="hljs-string">&quot; (View v) &#123;&#125;&quot;</span>);<br>      mClass.add(mFactory.createMethodFromText(method.toString(), mClass));<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨å†™å…¥ç±»å­—æ®µçš„æ—¶å€™ï¼Œéœ€è¦åˆ¤æ–­æ˜¯å¦éœ€è¦æ·»åŠ å‰ç¼€ï¼Œåœ¨<code>Constant</code>ä¸­åˆ—ä¸¾äº†ä¸€äº›éœ€è¦ç‰¹æ®Šå¤„ç†çš„å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">generateFields</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">for</span> (ElementBean element : mElements) &#123;<br>        <span class="hljs-keyword">if</span> (!element.used) &#123;<br>            <span class="hljs-keyword">continue</span>;<br>        &#125;<br><br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">injection</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>        injection.append(<span class="hljs-string">&quot;@BindView&quot;</span>);<br>        injection.append(<span class="hljs-string">&#x27;(&#x27;</span>);<br>        injection.append(element.getGenerateValue(generateId));<br>        injection.append(<span class="hljs-string">&quot;)&quot;</span>);<br>        <span class="hljs-keyword">if</span> (element.nameFull != <span class="hljs-literal">null</span> &amp;&amp; element.nameFull.length() &gt; <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">// custom package+class</span><br>            injection.append(element.nameFull);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Constant.paths.containsKey(element.name)) &#123; <span class="hljs-comment">// listed class</span><br>            injection.append(Constant.paths.get(element.name));<br>        &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// android.widget</span><br>            injection.append(<span class="hljs-string">&quot;android.widget.&quot;</span>);<br>            injection.append(element.name);<br>        &#125;<br>        injection.append(<span class="hljs-string">&quot; &quot;</span>);<br>        injection.append(element.fieldName);<br>        injection.append(<span class="hljs-string">&quot;;&quot;</span>);<br>        mClass.add(mFactory.createFieldFromText(injection.toString(), mClass));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å†™å…¥å®Œæˆåæ ¼å¼åŒ–ä¸€ä¸‹ä»£ä¹°ï¼Œè¦ä¸ç„¶å†™å…¥çš„å­—æ®µä¼šæ˜¯è¿™æ ·ï¼š<code>android.widget.TextView userNameTextView</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">JavaCodeStyleManager</span> <span class="hljs-variable">styleManager</span> <span class="hljs-operator">=</span> JavaCodeStyleManager.getInstance(mProject);<br>styleManager.optimizeImports(mFile);<br>styleManager.shortenClassReferences(mClass);<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">ReformatCodeProcessor</span>(mProject, mClass.getContainingFile(), <span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>).runWithoutProgress();<br></code></pre></td></tr></table></figure><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œå°±å·²ç»å®Œæˆäº†æˆ‘ä»¬çš„å·¥ä½œã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Plugin</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gradleè‡ªå®šä¹‰æ’ä»¶</title>
    <link href="/2020/11/26/gradle%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%92%E4%BB%B6/"/>
    <url>/2020/11/26/gradle%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%92%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<p><a href="https://blog.huangyuanlove.com/2018/11/09/groovy%E8%AF%AD%E6%B3%95%E5%85%A5%E9%97%A8/">groovy è¯­æ³•å…¥é—¨</a><br><a href="https://blog.huangyuanlove.com/2018/11/11/gradle%E5%9F%BA%E7%A1%80/">gradle åŸºç¡€</a><br><a href="https://blog.huangyuanlove.com/2018/11/19/gradle%E4%BB%BB%E5%8A%A1/">gradle ä»»åŠ¡</a><br><a href="https://blog.huangyuanlove.com/2018/12/09/gradle%E6%8F%92%E4%BB%B6/">gradle æ’ä»¶</a><br><a href="https://blog.huangyuanlove.com/2018/12/19/gradle-java%E6%8F%92%E4%BB%B6/">gradle-java æ’ä»¶</a><br><a href="https://blog.huangyuanlove.com/2018/12/22/gradle-android%E6%8F%92%E4%BB%B6/">gradle-android æ’ä»¶</a></p><p>å‰é¢ç®€å•çš„å†™äº†ç‚¹å…³äºgradleçš„ä»¥åŠgradleæ’ä»¶çš„ä¸œè¥¿,ç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•è‡ªå®šä¹‰æ’ä»¶,<strong>æœ¬ç¯‡æ–‡ç« æ˜¯åŸºäºAndroidStudioã€Androidå·¥ç¨‹è¿›è¡Œè®²è¿°</strong>ã€‚</p><span id="more"></span><h4 id="å­˜æ”¾æ’ä»¶æºç "><a href="#å­˜æ”¾æ’ä»¶æºç " class="headerlink" title="å­˜æ”¾æ’ä»¶æºç "></a>å­˜æ”¾æ’ä»¶æºç </h4><p>æˆ‘ä»¬å¯ä»¥åœ¨ä»¥ä¸‹å‡ ä¸ªåœ°æ–¹å­˜æ”¾æˆ‘ä»¬çš„æ’ä»¶æºç </p><h5 id="Build-Script"><a href="#Build-Script" class="headerlink" title="Build Script"></a>Build Script</h5><p>æ¯ä¸ªmoduleä¸­éƒ½ä¼šæœ‰build.gradleæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¯¥æ–‡ä»¶ä¸­ç¼–å†™ä¸€äº›æ‰€éœ€è¦çš„æ’ä»¶åŠŸèƒ½ï¼Œå¥½å¤„æ˜¯å¯ä»¥è¢«è‡ªåŠ¨ç¼–è¯‘å¹¶ä¸”åŒ…å«åœ¨æ„å»ºè„šæœ¬çš„class pathä¸­(é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„build.gradleä¸­buildScriptä¸­ä½¿ç”¨classPathä¾èµ–çš„æ’ä»¶)ï¼Œåå¤„æ˜¯ä¸èƒ½è¢«å…¶ä»–æ¨¡å—è®¿é—®ï¼Œæ’ä»¶åŠŸèƒ½æ²¡åŠæ³•é‡ç”¨ã€‚</p><h5 id="buildSrc-Module"><a href="#buildSrc-Module" class="headerlink" title="buildSrc Module"></a><code>buildSrc</code> Module</h5><p>æ ¹æ®æ‰€é€‰è¯­è¨€çš„ä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ’ä»¶ä»£ç æ”¾åœ¨<code>rootProjectDir/buildSrc/src/main/java</code>ã€<code>rootProjectDir/buildSrc/src/main/groovy</code>ã€<code>rootProjectDir/buildSrc/src/main/kotlin</code> æ–‡ä»¶å¤¹ä¸‹ï¼ŒåŒæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦åšé¢å¤–çš„æ“ä½œå°±å¯ä»¥åœ¨å…¶ä»–moduleä¸­ä½¿ç”¨ï¼Œä½†æ˜¯ä¸èƒ½åœ¨å…¶ä»–é¡¹ç›®ä¸­å¼•ç”¨</p><h5 id="Standalone-Project"><a href="#Standalone-Project" class="headerlink" title="Standalone Project"></a>Standalone Project</h5><p>æˆ‘ä»¬å¯ä»¥ä¸ºæ’ä»¶å•ç‹¬åˆ›å»ºä¸€ä¸ªé¡¹ç›®æˆ–è€…ä¸€ä¸ªmoduleï¼Œå°†å®ƒç¼–è¯‘ä¸ºjaråŒ…æˆ–è€…å…¶ä»–å½¢å¼å‘å¸ƒå‡ºå»ï¼Œä½¿å¾—å…¶ä»–é¡¹ç›®å¯ä»¥å¼•ç”¨</p><h4 id="ç¼–å†™æ’ä»¶ä»£ç "><a href="#ç¼–å†™æ’ä»¶ä»£ç " class="headerlink" title="ç¼–å†™æ’ä»¶ä»£ç "></a>ç¼–å†™æ’ä»¶ä»£ç </h4><h5 id="å…ˆçœ‹ä¸‹å†™åœ¨Build-Scriptä¸­çš„æ„å»ºè„šæœ¬ã€‚"><a href="#å…ˆçœ‹ä¸‹å†™åœ¨Build-Scriptä¸­çš„æ„å»ºè„šæœ¬ã€‚" class="headerlink" title="å…ˆçœ‹ä¸‹å†™åœ¨Build Scriptä¸­çš„æ„å»ºè„šæœ¬ã€‚"></a>å…ˆçœ‹ä¸‹å†™åœ¨<code>Build Script</code>ä¸­çš„æ„å»ºè„šæœ¬ã€‚</h5><p>è¿™é‡Œçš„<code>Build Script</code>æŒ‡çš„æ˜¯æ¯ä¸ªmoduleéƒ½ä¼šæœ‰<code>build.gradle</code>æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯¹æ¯ä¸ªmoduleçš„æŸäº›ç¼–è¯‘é…ç½®é€‰é¡¹ä¹Ÿä¼šåœ¨è¿™é‡Œé…ç½®.<br><strong>é¦–å…ˆéœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>build.gradle</code>æ–‡ä»¶ç¼–å†™Groovyã€Javaä»£ç </strong>ï¼Œè¿˜å¯ä»¥å›é¡¾ä¸€ä¸‹ä¹‹å‰å†™çš„ä¸€å¨æ–‡ç« çœ‹ä¸€ä¸‹ã€‚<br><strong>ä»¥ä¸‹ä»£ç æˆ‘æ˜¯åœ¨resource1æ¨¡å—çš„build.gradleæ–‡ä»¶ä¸­ç¼–å†™</strong><br>å…ˆå£°æ˜ä¸€ä¸ªç»§æ‰¿è‡ª<code>org.gradle.api.Plugin.Plugin</code>çš„ç±»</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Plugin</span>&lt;Project&gt; &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-type">void</span> apply(Project project) &#123;<br>        project.task(<span class="hljs-string">&quot;greeting&quot;</span>) &#123;<br>            doLast &#123;<br>                println(<span class="hljs-string">&quot;hello &quot;</span>)<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åapplyä¸€ä¸‹</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">apply <span class="hljs-attr">plugin:</span> MyPlugin<br></code></pre></td></tr></table></figure><p>è¿™æ—¶å€™ç‚¹å‡»<code>Sync Now</code>,ä¼šåœ¨å¯¹åº”çš„moduleä¸­Tasksâ€“&gt;otheråˆ†ç»„ä¸­å±•ç¤ºï¼›åŒå‡»è¯¥ä»»åŠ¡æˆ–è€…ä½¿ç”¨å‘½ä»¤è¡Œå¯æ‰§è¡Œ(.&#x2F;gradlew resource1:greeting);<br>å¦‚æœæƒ³è¦åƒ<code>apply plugin: &#39;com.android.library&#39;</code>è¿™ç§è¿›è¡Œé…ç½®è¯¥å¦‚æœåŠï¼Ÿæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåš</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Plugin</span>&lt;Project&gt; &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-type">void</span> apply(Project project) &#123;<br>        <span class="hljs-keyword">def</span> extension = project.extensions.create(<span class="hljs-string">&quot;myPlugin&quot;</span>, MyPluginExtension)<br>        project.task(<span class="hljs-string">&quot;greeting&quot;</span>) &#123;<br>            doLast &#123;<br>                println(<span class="hljs-string">&quot;$extension.greeter ,$extension.message&quot;</span>)<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPluginExtension</span> &#123;<br>    <span class="hljs-keyword">def</span> message = <span class="hljs-string">&quot;default message from MyPluginExtension&quot;</span><br>    <span class="hljs-keyword">def</span> greeter = <span class="hljs-string">&quot;default greeter from MyPluginExtension&quot;</span><br>&#125;<br><br>apply <span class="hljs-attr">plugin:</span> MyPlugin<br>myPlugin &#123;<br>    message = <span class="hljs-string">&quot;hi&quot;</span><br>    greeter = <span class="hljs-string">&quot;xuan&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>project.extensions.create</code>æ–¹æ³•ä¸­ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬åœ¨<code>build.gradle</code>æ–‡ä»¶é…ç½®å—çš„åå­—ï¼›<br>å¦å¤–ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„ä¸€ä¸ªä½œç”¨åŸŸçš„é—®é¢˜ï¼šå¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨å®šä¹‰çš„ç±»ä¸­ä½¿ç”¨ä¸€äº›ä¸‰æ–¹çš„ä¾èµ–åŒ…ï¼Œéœ€è¦åœ¨<strong>å·¥ç¨‹æ ¹ç›®å½•ä¸‹çš„build.gralde</strong>æ–‡ä»¶ä¸­<strong>buildscript</strong>ä½¿ç”¨classpathæ·»åŠ ä¾èµ–ï¼Œæ¯”å¦‚æˆ‘æƒ³ä½¿ç”¨<code>commons-lang3</code>ä¸­çš„StringUtilæ¥åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºï¼Œåˆ™</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy">buildscript &#123;<br>    dependencies &#123;<br>        classpath <span class="hljs-string">&#x27;org.apache.commons:commons-lang3:3.11&#x27;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨moduleä¸­çš„build.gradleæ–‡ä»¶ä¸­ä½¿ç”¨ï¼Œåˆ«å¿˜äº†å¯¼å…¥åŒ…ã€‚</p><h5 id="åœ¨buildSrc-Moduleä¸­"><a href="#åœ¨buildSrc-Moduleä¸­" class="headerlink" title="åœ¨buildSrc Moduleä¸­"></a>åœ¨<code>buildSrc</code> Moduleä¸­</h5><p>æˆ‘ä»¬åœ¨å·¥ç¨‹ä¸­æ–°å»ºä¸€ä¸ªåå­—ä¸º<code>buildSrc</code>çš„æ–‡ä»¶å¤¹ï¼Œå’Œå„ä¸ªmoduleåŒçº§ï¼Œç„¶åæŒ‰ç…§moduleçš„æ ¼å¼ï¼Œåˆ›å»ºsrc&#x2F;main&#x2F;groovy|java|kotlin&#x2F;package_nameã€build.gradleæ–‡ä»¶ï¼Œå°†ä¸Šé¢å†™çš„æ’ä»¶å®ç°å¤åˆ¶è¿‡æ¥ï¼Œ<br>æ–‡ä»¶å¤¹ç»“æ„çœ‹èµ·åƒè¿™æ ·<br><img src="/image/gradle/gradle-plugin/gradle-plugin-with-buildSrc.png" alt="gradle-plugin-buildSrc"><br>ç„¶ååœ¨build.gradleæ–‡ä»¶ä¸­å¼•å…¥æˆ‘ä»¬æ‰€éœ€è¦çš„ä¾èµ–ã€pluginç­‰ï¼Œçœ‹èµ·æ¥åƒè¿™æ ·</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs groovy">plugins &#123;<br>    id <span class="hljs-string">&#x27;java-gradle-plugin&#x27;</span><br>&#125;<br>java &#123;<br>    sourceCompatibility = JavaVersion.VERSION_1_7<br>    targetCompatibility = JavaVersion.VERSION_1_7<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„plugindsç›¸å½“äº <code>apply plugin:&#39;java-gradle-plugin&#39;</code>,è¿™ä¸ªæ’ä»¶æ˜¯å®˜æ–¹æ¨èä½¿ç”¨çš„ï¼Œç›¸å½“äºæˆ‘ä»¬å¼•ç”¨äº†<code>java</code>å’Œ<code>groovy</code>ï¼Œå¹¶ä¸”æ·»åŠ äº†<code>gradleApi()</code>çš„ä¾èµ–,å¯ä»¥çœ‹è¿™é‡Œ<a href="https://docs.gradle.org/nightly/userguide/custom_plugins.html">https://docs.gradle.org/nightly/userguide/custom_plugins.html</a>ã€‚<br>æˆ‘ä»¬è¿˜éœ€è¦ç»™æˆ‘ä»¬çš„pluginå–ä¸ªåå­—ï¼Œè¿™é‡Œæœ‰ä¸¤ç§æ–¹æ¡ˆ</p><ol><li>å®˜æ–¹ç°åœ¨æ¨è<br>åœ¨<code>build.gradle</code>ä¸­é…ç½®<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs groovy">gradlePlugin &#123;<br>    plugins &#123;<br>        simplePlugin &#123;<br>            id = <span class="hljs-string">&#x27;first-plugin&#x27;</span><br>            implementationClass = <span class="hljs-string">&#x27;com.huangyuanlove.plugin.FirstPlugin&#x27;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li>ä¹‹å‰çš„å†™æ³•<br>åˆ›å»º<code>main/resources/META-INF/gradle-plugins</code>æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹æ–°å»º<code>first-plugin.properties</code>æ–‡ä»¶(è¿™é‡Œçš„first-pluginå°±æ˜¯æ’ä»¶çš„id)ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­å£°æ˜å®ç°æ’ä»¶çš„ç±»<code>implementation-class=com.huangyuanlove.plugin.FirstPlugin</code></li></ol><p>å¼•ç”¨è¿™ä¸ªæ’ä»¶ï¼š<br>åœ¨ä½¿ç”¨è¿™ä¸ªæ’ä»¶çš„moudleä¸­ï¼Œ</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy">apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;first-plugin&#x27;</span><br>greeting&#123;<br>    message=<span class="hljs-string">&quot;hi&quot;</span><br>    greeter=<span class="hljs-string">&quot;xuan&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶ååŒæ­¥ä¸€ä¸‹å°±å¯ä»¥ä½¿ç”¨äº†</p><h5 id="ä½œä¸ºä¸€ä¸ªç‹¬ç«‹æ¨¡å—"><a href="#ä½œä¸ºä¸€ä¸ªç‹¬ç«‹æ¨¡å—" class="headerlink" title="ä½œä¸ºä¸€ä¸ªç‹¬ç«‹æ¨¡å—"></a>ä½œä¸ºä¸€ä¸ªç‹¬ç«‹æ¨¡å—</h5><ol><li>ç¼–å†™ã€æ„å»ºã€å‘å¸ƒ<br>å’Œä¸Šé¢å·®ä¸å¤šï¼Œæ–°å»ºä¸€ä¸ª<code>java library module</code>,ç„¶ååƒä¸Šé¢ä¸€æ ·å¼•å…¥<code>java-gradle-plugin</code>,é…ç½®å¥½æ’ä»¶idã€‚<br>åœ¨ç‹¬ç«‹æ¨¡å—ä¸­æˆ‘ä»¬éœ€è¦å°†æ’ä»¶å‘å¸ƒä¸€ä¸‹ï¼Œç„¶åå†ä¾èµ–.<br>æ–‡ä»¶å¤¹ç»“æ„çœ‹èµ·æ¥åƒä¸‹é¢è¿™æ ·<br><img src="/image/gradle/gradle-plugin/gradle-plugin-with-module.png" alt="gradle-plugin-module"></li></ol><p>å¼•å…¥<code>maven</code>,é…ç½®ä¸€ä¸‹å‘å¸ƒä¿¡æ¯ï¼Œçœ‹èµ·æ¥åƒä¸‹é¢è¿™æ ·</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs groovy">plugins &#123;<br>    id <span class="hljs-string">&#x27;java-library&#x27;</span><br>    id <span class="hljs-string">&#x27;kotlin&#x27;</span><br>    id <span class="hljs-string">&#x27;java-gradle-plugin&#x27;</span><br>    id <span class="hljs-string">&#x27;maven&#x27;</span><br>&#125;<br><br>java &#123;<br>    sourceCompatibility = JavaVersion.VERSION_1_7<br>    targetCompatibility = JavaVersion.VERSION_1_7<br>&#125;<br><br>dependencies &#123;<br>    implementation <span class="hljs-string">&quot;org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version&quot;</span><br>&#125;<br>uploadArchives&#123; <span class="hljs-comment">//å½“å‰é¡¹ç›®å¯ä»¥å‘å¸ƒåˆ°æœ¬åœ°æ–‡ä»¶å¤¹ä¸­</span><br>    repositories &#123;<br>        mavenDeployer &#123;<br>            repository(<span class="hljs-attr">url:</span> uri(<span class="hljs-string">&#x27;/Users/huangyuan/maven_repo&#x27;</span>)) <span class="hljs-comment">//å®šä¹‰æœ¬åœ°mavenä»“åº“çš„åœ°å€</span><br>            pom.groupId = <span class="hljs-string">&#x27;com.example.mygradleplugin&#x27;</span>   <span class="hljs-comment">//groupId</span><br>            pom.artifactId = <span class="hljs-string">&#x27;myplugin&#x27;</span>  <span class="hljs-comment">//artifactId</span><br>            pom.version = <span class="hljs-string">&#x27;1.0.2&#x27;</span> <span class="hljs-comment">//ç‰ˆæœ¬å·</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åŒæ­¥ä¸€ä¸‹ï¼Œå°±ä¼šçœ‹åˆ°è¯¥æ¨¡å—çš„taskä¸­å¤šäº†ä¸€ä¸ªupload.uploadArchivesä»»åŠ¡ï¼Œæ‰§è¡Œä¹‹åä¼šåœ¨mavenä»“åº“å¯¹åº”çš„æ–‡ä»¶å¤¹ä¸‹çœ‹åˆ°å‘å¸ƒçš„jaråŒ…</p><ol start="2"><li>ä¾èµ–ã€å¼•ç”¨<br>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­ï¼Œæ·»åŠ ä¸€ä¸‹ä»“åº“åœ°å€ï¼Œç„¶åä½¿ç”¨classpathè¿›è¡Œä¾èµ–<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs groovy">buildscript &#123;<br>    repositories &#123;<br>        <span class="hljs-comment">//æ·»åŠ è¯¥mavenä»“åº“ï¼Œ</span><br>        maven &#123;<br>            url uri(<span class="hljs-string">&#x27;/Users/huangyuan/maven_repo&#x27;</span>)<br>        &#125;<br>    &#125;<br>    dependencies &#123;<br>        <span class="hljs-comment">//æ·»åŠ å‘å¸ƒçš„pluginçš„ä¾èµ–</span><br>        classpath <span class="hljs-string">&#x27;com.example.mygradleplugin:myplugin:1.0.2&#x27;</span><br>    &#125;<br>&#125;<br><br>allprojects &#123;<br>    repositories &#123;<br>        maven &#123;<br>            url uri(<span class="hljs-string">&#x27;/Users/huangyuan/maven_repo&#x27;</span>)<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>å¼•ç”¨å’Œä¸Šé¢ä¸€æ ·ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„</li></ol><h4 id="è¿›è¡Œè°ƒè¯•"><a href="#è¿›è¡Œè°ƒè¯•" class="headerlink" title="è¿›è¡Œè°ƒè¯•"></a>è¿›è¡Œè°ƒè¯•</h4><p>å½“æ’ä»¶å·¥ä½œä¸æ˜¯é¢„æœŸçš„ç»“æœæ—¶ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦è¿›è¡Œæ–­ç‚¹è°ƒè¯•(å½“ç„¶æ‰“æ—¥å¿—çš„æ–¹æ³•ä¹Ÿä¸é”™)ï¼Œåœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­è¿˜éœ€è¦æ–°å¢remoteé…ç½®ï¼Œç„¶åä»¥debugæ–¹å¼æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œç°åœ¨åœ¨AndroidStudioä¸­(4.1.1ç‰ˆæœ¬)ä¸­ï¼Œåªéœ€è¦åœ¨ä¾§è¾¹æ‰¾æ‰“è¿™ä¸ªä»»åŠ¡ï¼Œå³é”®èœå•debugæ‰§è¡Œå°±å¥½äº†</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Gradle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Androidæ‰“åŒ…æµç¨‹</title>
    <link href="/2020/11/11/Android%E6%89%93%E5%8C%85%E6%B5%81%E7%A8%8B/"/>
    <url>/2020/11/11/Android%E6%89%93%E5%8C%85%E6%B5%81%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<p>ç°åœ¨çš„Androidå¼€å‘å¤§éƒ¨åˆ†æ˜¯åœ¨AndroidStudioä¸­è¿›è¡Œçš„ï¼Œå½“æˆ‘ä»¬æƒ³è¦å¾—åˆ°APKæ–‡ä»¶çš„æ—¶å€™ï¼Œç‚¹ä¸€ä¸‹RUNï¼Œæˆ–è€…æ‰§è¡Œä¸€ä¸‹<code>gradlew assembleDebug</code> å°±å¯ä»¥äº†ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Œæˆ‘ä»¬æ¥è¯¦ç»†çœ‹ä¸€ä¸‹ã€‚<br>æ„å»ºçš„è¿‡ç¨‹å¤§è‡´å¯ä»¥åˆ’åˆ†ä¸ºä¸¤ä¸ªè¿‡ç¨‹ï¼šç¼–è¯‘å’Œæ‰“åŒ…<br>ç¼–è¯‘ï¼šç¼–è¯‘å™¨(compileer)é€šè¿‡ç¼–è¯‘source codeã€AIDL filesã€source filseã€dependednce filesï¼Œæœ€ç»ˆç”ŸæˆDex(s)æ–‡ä»¶å’Œç¼–è¯‘åçš„èµ„æºæ–‡ä»¶<br>æ‰“åŒ…ï¼šæ‰“åŒ…å™¨(APK packager)åˆ©ç”¨ç­¾åæ–‡ä»¶(KeyStore)å’Œä¸Šä¸€æ­¥ç¼–è¯‘è¿‡ç¨‹ä¸­ç”Ÿæˆçš„Dex(s)æ–‡ä»¶ã€ç¼–è¯‘åçš„èµ„æºæ–‡ä»¶æ‰“åŒ…æˆæœ€ç»ˆçš„APKæ–‡ä»¶</p><span id="more"></span><h4 id="æ„å»ºè¿‡ç¨‹"><a href="#æ„å»ºè¿‡ç¨‹" class="headerlink" title="æ„å»ºè¿‡ç¨‹"></a>æ„å»ºè¿‡ç¨‹</h4><p>ä¸€ä¸ªå‡ ä¹æ˜¯æœ€ç®€åŒ–çš„æ„å»ºæµç¨‹<br><img src="/image/gradle/apk%E6%89%93%E5%8C%85%E6%B5%81%E7%A8%8B--%E6%9C%80%E7%AE%80.png" alt="æœ€ç®€åŒ–çš„æ„å»ºæµç¨‹" title="æœ€ç®€åŒ–çš„æ„å»ºæµç¨‹"><br>ä¸Šå›¾ä¸­çš„è±å½¢è¡¨ç¤ºä¸€äº›æ„å»ºæ“ä½œï¼ŒçŸ©å½¢è¡¨ç¤ºè¾“å…¥æˆ–è€…è¾“å‡ºæ–‡ä»¶</p><h4 id="åˆè§ç»†èŠ‚"><a href="#åˆè§ç»†èŠ‚" class="headerlink" title="åˆè§ç»†èŠ‚"></a>åˆè§ç»†èŠ‚</h4><p><img src="/image/gradle/apk%E6%89%93%E5%8C%85%E6%B5%81%E7%A8%8B.png" alt="ç¨å¾®æœ‰ç‚¹ç»†èŠ‚çš„æ„å»ºæµç¨‹" title="ç¨å¾®æœ‰ç‚¹ç»†èŠ‚çš„æ„å»ºæµç¨‹"></p><p>ç¼–è¯‘æ‰“åŒ…æµç¨‹</p><ol><li><p>ä½¿ç”¨aapt&#x2F;aapt2ç¼–è¯‘èµ„æºæ–‡ä»¶ç”Ÿæˆresource.arscå’ŒR.java</p></li><li><p>ä½¿ç”¨AIDLå¤„ç†aidlæ–‡ä»¶ï¼Œç”Ÿæˆjavaæ–‡ä»¶</p></li><li><p>ä½¿ç”¨javacç¼–è¯‘javaæ–‡ä»¶ï¼Œç”Ÿæˆclassæ–‡ä»¶</p></li><li><p>(proguardæ··æ·†å¦‚æœæœ‰)ä½¿ç”¨DX&#x2F;D8&#x2F;R8å¤„ç†classæ–‡ä»¶ï¼Œç”Ÿæˆæœ€ç»ˆéœ€è¦çš„dexæ–‡ä»¶</p></li><li><p>ä½¿ç”¨Android NDKå¤„ç†nativeä»£ç ç”Ÿæˆ.soæ–‡ä»¶</p></li><li><p>ä½¿ç”¨apkbuilderç”Ÿæˆæœªç­¾åçš„apkæ–‡ä»¶</p></li><li><p>ä½¿ç”¨apksignerå¯¹apkè¿›è¡Œç­¾åï¼Œç”Ÿæˆç­¾ååçš„apkæ–‡ä»¶</p></li><li><p>ä½¿ç”¨zipalignå·¥å…·ï¼Œå¯¹å·²ç­¾åçš„apkæ–‡ä»¶è¿›è¡Œä¼˜åŒ–(åªæœ‰v1ç­¾åæ‰æœ‰è¿™ä¸€æ­¥ï¼Œv2ç­¾åçš„apkä¼šåœ¨zipalignåç­¾åè¢«ç ´åï¼‰ã€‚</p></li></ol><h4 id="ç»ˆç« "><a href="#ç»ˆç« " class="headerlink" title="ç»ˆç« "></a>ç»ˆç« </h4><p>è¿™æ˜¯ä¸€å¼ æµä¼ å·²ä¹…çš„ç½‘å›¾ï¼Œæ‰¾åˆ°çš„å›¾å·²ç»æœ‰åŒ…æµ†äº†ï¼Œåˆé‡æ–°ç”»äº†ä¸€é<br>åœ¨å›¾çš„æœ€ä¸‹æ–¹æœ‰ç¤ºä¾‹è¯´æ˜ï¼š</p><ol><li>çŸ©å½¢è¡¨ç¤ºæ–‡ä»¶</li><li>æ¤­åœ†è¡¨ç¤ºå·¥å…·</li><li>ç®­å¤´è¡¨ç¤ºè¾“å‡º</li><li>ç©ºå¿ƒåœ†è¡¨ç¤ºè¾“å…¥</li></ol><p><img src="/image/gradle/apk%E6%89%93%E5%8C%85%E6%B5%81%E7%A8%8Bfinal.png" alt="æœ€ç»ˆæ„å»ºæµç¨‹" title="æœ€ç»ˆæ„å»ºæµç¨‹"></p><p>æ—¢ç„¶éƒ½æ˜¯è°ƒç”¨çš„å·¥å…·ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥è‡ªå·±å†™è„šæœ¬è¿è¡Œè¿™äº›å·¥å…·è¿›è¡Œæ‰“åŒ…ï¼Œè°ƒç”¨çš„å·¥å…·è¯¦ç»†ä¿¡æ¯å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ° <a href="https://developer.android.com/studio/command-line?hl=zh_cn">https://developer.android.com/studio/command-line?hl=zh_cn</a></p><p>æ–‡ä¸­å›¾ç‰‡çš„æºæ–‡ä»¶åœ¨ &#x2F;image&#x2F;apkæ‰“åŒ…æµç¨‹.drawio ,ä½¿ç”¨drawioç»˜åˆ¶;</p><hr><p>ä»¥ä¸Š</p><p>å‚è€ƒï¼š</p><ol><li><a href="https://www.zhihu.com/search?type=content&amp;q=Android%E6%89%93%E5%8C%85%E6%B5%81%E7%A8%8B">https://www.zhihu.com/search?type=content&amp;q=Android%E6%89%93%E5%8C%85%E6%B5%81%E7%A8%8B</a></li><li><a href="https://juejin.im/post/6882328361294069773">https://juejin.im/post/6882328361294069773</a></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Gradle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ­£åˆ™è¡¨è¾¾å¼--ä¸Š</title>
    <link href="/2020/09/24/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F-%E4%B8%8A/"/>
    <url>/2020/09/24/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F-%E4%B8%8A/</url>
    
    <content type="html"><![CDATA[<p>å¦‚æœä½ æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä½ æƒ³åˆ°å¯ä»¥ç”¨æ­£åˆ™æ¥è§£å†³ï¼Œé‚£ä¹ˆä½ æœ‰ä¸¤ä¸ªé—®é¢˜äº†ã€‚</p><p>Some people, when confronted with a problem, think â€œI know,iâ€™ll use regular expressions.â€ Now they have two problems</p><span id="more"></span><h3 id="å†™æ­£åˆ™è¿‡ç¨‹"><a href="#å†™æ­£åˆ™è¿‡ç¨‹" class="headerlink" title="å†™æ­£åˆ™è¿‡ç¨‹"></a>å†™æ­£åˆ™è¿‡ç¨‹</h3><ol><li><p>å…ˆåˆ†è§£</p><p>è¿™ä¸ªé—®é¢˜å¯ä»¥åˆ†æˆå‡ ä¸ªå­é—®é¢˜ï¼Œæ˜¯å¦å¯ä»¥ç”¨å¤šä¸ªæ­£åˆ™æ¥å®Œæˆ(å¯†ç å¼ºåº¦æ ¡éªŒï¼Œä¸€ä¸ªæ ¡éªŒå¤§å°å†™ï¼Œä¸€ä¸ªæ ¡éªŒæ•°å­—æ ‡ç‚¹ï¼Œä¸€ä¸ªæ ¡éªŒå¼ºåº¦)</p></li><li><p>è§£å†³å­é—®é¢˜</p><p>æŸä¸ªä½ç½®ä¸Šå¯èƒ½æœ‰å¤šä¸ªå­—ç¬¦ï¼Ÿé‚£å°±ç”¨å­—ç¬¦ç»„ã€‚æŸä¸ªä½ç½®ä¸Šå¯èƒ½æœ‰å¤šä¸ªå­—ç¬¦ä¸²ï¼Ÿé‚£å°±ç”¨å¤šé€‰ç»“æ„ã€‚å‡ºç°çš„æ¬¡æ•°ä¸ç¡®å®šï¼Ÿé‚£å°±ç”¨é‡è¯ã€‚å¯¹å‡ºç°çš„ä½ç½®æœ‰è¦æ±‚ï¼Ÿé‚£å°±ç”¨é”šç‚¹é”å®šä½ç½®</p></li><li><p>å¥—çš®</p><p>ä¹Ÿå°±æ˜¯æŠŠå¦‚ä½•è§£å†³å­é—®é¢˜è½¬åŒ–ä¸ºæ­£åˆ™è¡¨è¾¾å¼</p></li><li><p>è°ƒè¯•</p><p>å¤æ‚â¼€ç‚¹çš„æ­£åˆ™è¡¨è¾¾å¼ä¸èƒ½â¼€æ¬¡å†™å¯¹ï¼Œè¿™æ˜¯å¾ˆæ­£å¸¸çš„</p></li></ol><p>æµ‹è¯•ç½‘é¡µï¼š<a href="https://regex101.com/">https://regex101.com/</a></p><h3 id="æ­£åˆ™åŠŸèƒ½s"><a href="#æ­£åˆ™åŠŸèƒ½s" class="headerlink" title="æ­£åˆ™åŠŸèƒ½s"></a>æ­£åˆ™åŠŸèƒ½s</h3><pre><code class="mermaid" >graph TBA(æ­£åˆ™åŠŸèƒ½)A1(æ ¡éªŒæ•°æ®çš„æœ‰æ•ˆæ€§)A2(æŸ¥æ‰¾ç¬¦åˆè¦æ±‚çš„æ–‡æœ¬å†…å®¹)A3(å¯¹æ–‡æœ¬è¿›è¡Œåˆ‡å‰²,æ›¿æ¢ç­‰æ“ä½œ)A-->A1A-->A2A-->A3</code></pre><h3 id="æ­£åˆ™å…ƒå­—ç¬¦"><a href="#æ­£åˆ™å…ƒå­—ç¬¦" class="headerlink" title="æ­£åˆ™å…ƒå­—ç¬¦"></a>æ­£åˆ™å…ƒå­—ç¬¦</h3><pre><code class="mermaid" >graph LRA(æ­£åˆ™å…ƒå­—ç¬¦)A-->B(ç‰¹æ®Šå•å­—ç¬¦)B-->B1(.ä»»æ„å­—ç¬¦)B-->B2(\d ä»»æ„æ•°å­—\D ä»»æ„éæ•°å­—)B-->B3(\w ä»»æ„å­—æ¯æ•°å­—ä¸‹åˆ’çº¿ \Wä»»æ„éå­—æ¯è°ä¸‹åˆ’çº¿)B-->B4(\sä»»æ„ç©ºç™½ç¬¦  \S ä»»æ„éç©ºç™½ç¬¦)A-->C(ç©ºç™½ç¬¦)C-->C1(\r å›è½¦ç¬¦)C-->C2(\n æ¢è¡Œç¬¦)C-->C3(\f æ¢é¡µç¬¦)C-->C4(\t åˆ¶è¡¨ç¬¦)C-->C5(\v å‚ç›´åˆ¶è¡¨ç¬¦)C-->C6(\s ä»»æ„ç©ºç™½ç¬¦)A-->D(èŒƒå›´)D-->D1("|æˆ–,å¦‚ab|bc ä»£è¡¨abæˆ–bc")D-->D2("[...]å¤šé€‰ä¸€ï¼Œæ‹¬å·ä¸­ä»»æ„å•ä¸ªå…ƒç´ ")D-->D3("[a-z]åŒ¹é…aåˆ°zä¹‹é—´çš„ä»»æ„å•ä¸ªå…ƒç´ (æŒ‰ASCIIè¡¨ï¼ŒåŒ…å«a,z)")D-->D4("[^...]å–åï¼Œä¸èƒ½æ˜¯æ‹¬å·ä¸­çš„ä»»æ„å•ä¸ªå…ƒç´ ")A-->E(é‡è¯)E-->E1(*å«ä¹‰: 0åˆ°å¤šæ¬¡)E-->E2(+å«ä¹‰: 1åˆ°å¤šæ¬¡)E-->E3(?å«ä¹‰: 0åˆ°1æ¬¡)E-->E4("{m}å«ä¹‰: å‡ºç°mæ¬¡")E-->E5("{m,}å«ä¹‰: å‡ºç°è‡³å°‘mæ¬¡")E-->E6("{m,n}å«ä¹‰: måˆ°næ¬¡")A-->F(æ–­è¨€)F-->F1(å•è¯è¾¹ç•Œ)F-->F2(è¡Œçš„å¼€å§‹/ç»“æŸ)F-->F3(ç¯è§†)</code></pre><p>ç¤ºä¾‹ï¼š</p><ol><li>åŒ¹é…æŸä¸ªç½‘ç»œèµ„æºï¼šä»¥ http:&#x2F;&#x2F; æˆ–è€…https:&#x2F;&#x2F; æˆ–è€…ftp:&#x2F;&#x2F;å¼€å¤´</li><li>ç¬¬ä¸€ä½å›ºå®šä¸º1ï¼Œç¬¬äºŒä½å¯èƒ½æ˜¯3-9ï¼Œç¬¬ä¸‰ä½åˆ°ç¬¬11ä½å¯ä»¥æ˜¯ä»»æ„æ•°å­—</li></ol><h3 id="é‡è¯ä¸è´ªå©ª"><a href="#é‡è¯ä¸è´ªå©ª" class="headerlink" title="é‡è¯ä¸è´ªå©ª"></a>é‡è¯ä¸è´ªå©ª</h3><p>ä¸¾ä¾‹ï¼š<br>æœ‰å­—ç¬¦ä¸²â€aaabbâ€ï¼Œæœ‰æ­£åˆ™è¡¨è¾¾å¼â€a+â€ï¼Œé—®æœ‰å¤šå°‘ä¸ªåŒ¹é…ç»“æœ<br>æœ‰å­—ç¬¦ä¸²â€aaabbâ€ï¼Œæœ‰æ­£åˆ™è¡¨è¾¾å¼â€a*â€ï¼Œé—®æœ‰å¤šå°‘ä¸ªåŒ¹é…ç»“æœ</p><h4 id="è´ªå©ªåŒ¹é…-Greedy"><a href="#è´ªå©ªåŒ¹é…-Greedy" class="headerlink" title="è´ªå©ªåŒ¹é…(Greedy)"></a>è´ªå©ªåŒ¹é…(Greedy)</h4><p>æœ‰å­—ç¬¦ä¸²â€aaabbâ€ï¼Œæœ‰æ­£åˆ™è¡¨è¾¾å¼â€a*â€ï¼Œé—®æœ‰å¤šå°‘ä¸ªåŒ¹é…ç»“æœ çš„åŒ¹é…è¿‡ç¨‹</p><table><thead><tr><th>åŒ¹é…</th><th>å¼€å§‹</th><th>ç»“æŸ</th><th>è¯´æ˜</th><th>åŒ¹é…å†…å®¹</th></tr></thead><tbody><tr><td>ç¬¬ä¸€æ¬¡</td><td>0</td><td>3</td><td>åˆ°ç¬¬ä¸€ä¸ªå­—æ¯bå‘ç°ä¸æ»¡è¶³ï¼Œè¾“å‡ºaaa</td><td>aaa</td></tr><tr><td>ç¬¬äºŒæ¬¡</td><td>3</td><td>3</td><td>åŒ¹é…å‰©ä¸‹çš„bbï¼Œå‘ç°åŒ¹é…ä¸ä¸Šï¼Œè¾“å‡ºç©ºå­—ç¬¦ä¸²</td><td>ç©ºå­—ç¬¦ä¸²</td></tr><tr><td>ç¬¬ä¸‰æ¬¡</td><td>4</td><td>4</td><td>åŒ¹é…å‰©ä¸‹çš„bï¼Œå‘ç°åŒ¹é…ä¸ä¸Šï¼Œè¾“å‡ºç©ºå­—ç¬¦ä¸²</td><td>ç©ºå­—ç¬¦ä¸²</td></tr><tr><td>ç¬¬å››æ¬¡</td><td>5</td><td>5</td><td>åŒ¹é…å‰©ä¸‹ç©ºå­—ç¬¦ä¸²ï¼Œå‘ç°åŒ¹é…ä¸ä¸Šï¼Œè¾“å‡ºç©ºå­—ç¬¦ä¸²</td><td>ç©ºå­—ç¬¦ä¸²</td></tr></tbody></table><h4 id="éè´ªå©ªæ¨¡å¼-Lazy"><a href="#éè´ªå©ªæ¨¡å¼-Lazy" class="headerlink" title="éè´ªå©ªæ¨¡å¼(Lazy)"></a>éè´ªå©ªæ¨¡å¼(Lazy)</h4><p>æœ‰å­—ç¬¦ä¸²â€aaabbâ€ï¼Œæœ‰æ­£åˆ™è¡¨è¾¾å¼â€a*?â€ï¼Œé—®æœ‰å¤šå°‘ä¸ªåŒ¹é…ç»“æœ<br>9ä¸ªç»“æœ</p><p>åœ¨python2.7ä¸­åªèƒ½åŒ¹é…åˆ°ç©ºä¸²ï¼Œåœ¨java8ä¸­åªèƒ½åŒ¹é…åˆ°ç©ºä¸²ï¼Œ  åœ¨python3.7.7ä¸­å¯ä»¥åŒ¹é…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>re.findall(<span class="hljs-string">r&quot;a*?&quot;</span>,<span class="hljs-string">&quot;aaabb&quot;</span>)<br>[<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>]<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>re.findall(<span class="hljs-string">r&quot;a*?&quot;</span>,<span class="hljs-string">&quot;aaabb&quot;</span>)<br>[<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>]<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼šæŸ¥æ‰¾åŒå¼•å·ä¹‹é—´çš„å•è¯</p><p>å­—ç¬¦ä¸²å¦‚ä¸‹ â€œthe little catâ€ is a toy,it looks â€œa little badâ€</p><p>è´ªå©ªï¼šâ€.*â€</p><p>éè´ªå©ª:â€.*?â€</p><h4 id="ç‹¬å æ¨¡å¼"><a href="#ç‹¬å æ¨¡å¼" class="headerlink" title="ç‹¬å æ¨¡å¼"></a>ç‹¬å æ¨¡å¼</h4><p>ä¸€èˆ¬ä¸æ€ä¹ˆç”¨</p><p>ç¤ºä¾‹ï¼š</p><p>we found â€œthe little catâ€ is in the hat, we like â€œthe little catâ€</p><p>å…¶ä¸­åŒå¼•å·ä¸­çš„å•è¯çœ‹æˆä¸€ä¸ªå•è¯ï¼Œå³the little cat æ˜¯ä¸€ä¸ªå•è¯</p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><pre><code class="mermaid" >graph LRA("è´ªå©ªã€éè´ªå©ªã€ç‹¬å ")A-->A1(è´ªå©ªåŒ¹é…)A1-->A11("è¡¨ç¤ºæ¬¡æ•°çš„é‡è¯ï¼Œé»˜è®¤æ˜¯è´ªå©ªçš„<br/>æ»¡è¶³è¦æ±‚çš„æƒ…å†µä¸‹ï¼Œå°½å¯èƒ½æŒ‰æœ€é•¿å»åŒ¹é…")A1-->A12("å›æº¯ï¼šåé¢åŒ¹é…ä¸ä¸Šï¼Œä¼šåå‡ºå·²åŒ¹é…çš„å†å°è¯•")A-->A2(éè´ªå©ªåŒ¹é…)A2-->A21("é‡è¯å…ƒå­—ç¬¦ååŠ ?(è‹±æ–‡é—®å·),<br/>æ»¡è¶³è¦æ±‚çš„æƒ…å†µä¸‹ï¼Œå°½å¯èƒ½æŒ‰æœ€çŸ­å»è¿›è¡ŒåŒ¹é…")A2-->A22("å›æº¯ï¼šåé¢åŒ¹é…ä¸ä¸Šï¼Œä¼šåŒ¹é…æ›´é•¿å†æ¥ç€å°è¯•")A-->A3(ç‹¬å æ¨¡å¼)A3-->A31("é‡è¯å…ƒå­—ç¬¦ååŠ +(è‹±æ–‡åŠ å·)<br/>æ»¡è¶³è¦æ±‚çš„æƒ…å†µä¸‹ï¼Œå°½å¯èƒ½æŒ‰æœ€é•¿å»åŒ¹é…")A3-->A32(ä¸ä¼šå‘ç”Ÿå›æº¯,åŒ¹é…ä¸ä¸Šå³å¤±è´¥)</code></pre><h3 id="åˆ†ç»„ä¸å¼•ç”¨"><a href="#åˆ†ç»„ä¸å¼•ç”¨" class="headerlink" title="åˆ†ç»„ä¸å¼•ç”¨"></a>åˆ†ç»„ä¸å¼•ç”¨</h3><p>åŒ¹é…èº«ä»½è¯å·ï¼š15ä½æˆ–18ä½æ•°å­—</p><h4 id="åˆ†ç»„ä¸ç¼–å·"><a href="#åˆ†ç»„ä¸ç¼–å·" class="headerlink" title="åˆ†ç»„ä¸ç¼–å·"></a>åˆ†ç»„ä¸ç¼–å·</h4><p>æ‹¬å·åœ¨æ­£åˆ™ä¸­å¯ä»¥ç”¨äºåˆ†ç»„ï¼Œè¢«æ‹¬å·æ‹¬èµ·æ¥çš„éƒ¨åˆ†â€œå­è¡¨è¾¾å¼â€ä¼šè¢«ä¿å­˜æˆä¸€ä¸ªå­ç»„ã€‚ç¬¬å‡ ä¸ªæ‹¬å·å°±æ˜¯ç¬¬å‡ ä¸ªåˆ†ç»„</p><h4 id="ä¸ä¿å­˜å­ç»„"><a href="#ä¸ä¿å­˜å­ç»„" class="headerlink" title="ä¸ä¿å­˜å­ç»„"></a>ä¸ä¿å­˜å­ç»„</h4><p>å¯ä»¥åœ¨æ‹¬å·é‡Œé¢ä½¿ç”¨ ?: ä¸ä¿å­˜å­ç»„ã€‚</p><h4 id="æ‹¬å·åµŒå¥—"><a href="#æ‹¬å·åµŒå¥—" class="headerlink" title="æ‹¬å·åµŒå¥—"></a>æ‹¬å·åµŒå¥—</h4><p>æˆ‘ä»¬åªéœ€è¦æ•°å·¦æ‹¬å·ï¼ˆå¼€æ‹¬å·ï¼‰æ˜¯ç¬¬å‡ ä¸ªï¼Œå°±å¯ä»¥ç¡®å®šæ˜¯ç¬¬å‡ ä¸ªå­ç»„</p><p>å‡è®¾æ—¶é—´æ ¼å¼æ˜¯ 2020-05-10 20:23:05 ã€‚</p><p>((\d{4})-(\d{2})-(\d{2})) ((\d{2}):(\d{2}):(\d{2}))</p><p>æ—¥æœŸåˆ†ç»„ç¼–å·æ˜¯ 1ï¼Œæ—¶é—´åˆ†ç»„ç¼–å·æ˜¯ 5ï¼Œå¹´æœˆæ—¥å¯¹åº”çš„åˆ†ç»„ç¼–å·åˆ†åˆ«æ˜¯ 2ï¼Œ3ï¼Œ4ï¼Œæ—¶åˆ†ç§’çš„åˆ†ç»„ç¼–å·åˆ†åˆ«æ˜¯ 6ï¼Œ7ï¼Œ8ã€‚</p><h4 id="å‘½ååˆ†ç»„"><a href="#å‘½ååˆ†ç»„" class="headerlink" title="å‘½ååˆ†ç»„"></a>å‘½ååˆ†ç»„</h4><p>ç”±äºç¼–å·å¾—æ•°åœ¨ç¬¬å‡ ä¸ªä½ç½®ï¼Œåç»­å¦‚æœå‘ç°æ­£åˆ™æœ‰é—®é¢˜ï¼Œæ”¹åŠ¨äº†æ‹¬å·çš„ä¸ªæ•°ï¼Œè¿˜å¯èƒ½å¯¼è‡´ç¼–å·å‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤ä¸€äº›ç¼–ç¨‹è¯­è¨€æä¾›äº†å‘½ååˆ†ç»„ï¼ˆnamed groupingï¼‰ï¼Œè¿™æ ·å’Œæ•°å­—ç›¸æ¯”æ›´å®¹æ˜“è¾¨è¯†ï¼Œä¸å®¹æ˜“å‡ºé”™ã€‚å‘½ååˆ†ç»„çš„æ ¼å¼ä¸º(<code>?P&lt;åˆ†ç»„å&gt;æ­£åˆ™</code>)ã€‚</p><h4 id="åˆ†ç»„å¼•ç”¨"><a href="#åˆ†ç»„å¼•ç”¨" class="headerlink" title="åˆ†ç»„å¼•ç”¨"></a>åˆ†ç»„å¼•ç”¨</h4><p>åœ¨çŸ¥é“äº†åˆ†ç»„å¼•ç”¨çš„ç¼–å· ï¼ˆnumberï¼‰åï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ â€œåæ–œæ‰› + ç¼–å·â€ï¼Œå³ \number çš„æ–¹å¼æ¥è¿›è¡Œå¼•ç”¨</p><h4 id="åˆ†ç»„å¼•ç”¨åœ¨æŸ¥æ‰¾ä¸­ä½¿ç”¨"><a href="#åˆ†ç»„å¼•ç”¨åœ¨æŸ¥æ‰¾ä¸­ä½¿ç”¨" class="headerlink" title="åˆ†ç»„å¼•ç”¨åœ¨æŸ¥æ‰¾ä¸­ä½¿ç”¨"></a>åˆ†ç»„å¼•ç”¨åœ¨æŸ¥æ‰¾ä¸­ä½¿ç”¨</h4><p>å‰é¢å‡ºç°çš„å•è¯å†æ¬¡å‡ºç°ï¼š(\w+)\1</p><p><a href="https://regex101.com/r/Adg1Og/4">https://regex101.com/r/Adg1Og/4</a></p><h4 id="åˆ†ç»„å¼•ç”¨åœ¨æ›¿æ¢ä¸­ä½¿ç”¨"><a href="#åˆ†ç»„å¼•ç”¨åœ¨æ›¿æ¢ä¸­ä½¿ç”¨" class="headerlink" title="åˆ†ç»„å¼•ç”¨åœ¨æ›¿æ¢ä¸­ä½¿ç”¨"></a>åˆ†ç»„å¼•ç”¨åœ¨æ›¿æ¢ä¸­ä½¿ç”¨</h4><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åå‘å¼•ç”¨ï¼Œåœ¨å¾—åˆ°çš„ç»“æœä¸­ï¼Œå»æ‹¼å‡ºæ¥æˆ‘ä»¬æƒ³è¦çš„ç»“æœ</p><p><a href="https://regex101.com/r/Adg1Og/5">https://regex101.com/r/Adg1Og/5</a></p><pre><code class="mermaid" >graph LRA("æ­£åˆ™åˆ†ç»„")A-->A1("åŠŸèƒ½")A1-->A11("å°†æŸéƒ¨åˆ†å­è¡¨è¾¾å¼çœ‹æˆä¸€ä¸ªæ•´ä½“ï¼Œåœ¨åç»­æŸ¥æ‰¾æˆ–æ›¿æ¢å¼•ç”¨åˆ†ç»„")A-->A2("åˆ†ç»„ç¼–å·")A2-->A21(ç¬¬å‡ ä¸ªæ‹¬å·å°±æ˜¯ç¬¬å‡ ä¸ªåˆ†ç»„)A2-->A22("éæ•è·åˆ†ç»„ä½¿ç”¨(?:æ­£åˆ™)")A2-->A23("æ‹¬å·åµŒå¥—åªéœ€è¦çœ‹å·¦æ‹¬å·çš„åºå·")A2-->A24("å‘½ååˆ†ç»„(?P[åç§°]æ­£åˆ™)")A-->A3("åˆ†ç»„å¼•ç”¨")A3-->A31("æŸ¥æ‰¾ï¼šæŸ¥æ‰¾é‡å¤å‡ºç°çš„éƒ¨åˆ†")A3-->A32("æ›¿æ¢ï¼šå¯¹åŸæœ‰å†…å®¹æ ¼å¼è¿›è¡Œæ”¹å†™")A-->A4("æ–‡æœ¬ç¼–è¾‘")</code></pre><h3 id="åŒ¹é…æ¨¡å¼"><a href="#åŒ¹é…æ¨¡å¼" class="headerlink" title="åŒ¹é…æ¨¡å¼"></a>åŒ¹é…æ¨¡å¼</h3><h4 id="ä¸åŒºåˆ†å¤§å°å†™æ¨¡å¼ï¼ˆCase-Insensitiveï¼‰"><a href="#ä¸åŒºåˆ†å¤§å°å†™æ¨¡å¼ï¼ˆCase-Insensitiveï¼‰" class="headerlink" title="ä¸åŒºåˆ†å¤§å°å†™æ¨¡å¼ï¼ˆCase-Insensitiveï¼‰"></a>ä¸åŒºåˆ†å¤§å°å†™æ¨¡å¼ï¼ˆCase-Insensitiveï¼‰</h4><p>ç¤ºä¾‹ï¼šå¦‚è¦æŸ¥æ‰¾å•è¯ catï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦å…³å¿ƒå•è¯æ˜¯ CATã€Catï¼Œè¿˜æ˜¯ cat</p><p>reg &#x3D; <code>[Cc][Aa][Tt]</code></p><p>å½“æˆ‘ä»¬æŠŠæ¨¡å¼ä¿®é¥°ç¬¦æ”¾åœ¨æ•´ä¸ªæ­£åˆ™å‰é¢æ—¶ï¼Œå°±è¡¨ç¤ºæ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼éƒ½æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ã€‚æ¨¡å¼ä¿®é¥°ç¬¦æ˜¯é€šè¿‡ (? æ¨¡å¼æ ‡è¯†) çš„æ–¹å¼æ¥è¡¨ç¤ºçš„ã€‚  æˆ‘ä»¬åªéœ€è¦æŠŠæ¨¡å¼ä¿®é¥°ç¬¦æ”¾åœ¨å¯¹åº”çš„æ­£åˆ™å‰ï¼Œå°±å¯ä»¥ä½¿ç”¨æŒ‡å®šçš„æ¨¡å¼äº†ã€‚</p><p>ç”±äºä¸åˆ†å¤§å°å†™çš„è‹±æ–‡æ˜¯ Case-Insensitiveï¼Œé‚£ä¹ˆå¯¹åº”çš„æ¨¡å¼æ ‡è¯†å°±æ˜¯ I çš„å°å†™å­—æ¯ iï¼Œæ‰€ä»¥ä¸åŒºåˆ†å¤§å°å†™çš„ cat å°±å¯ä»¥å†™æˆ (?i)catã€‚</p><p>text&#x3D;<code>cat\n CAT\nCat</code></p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨å®ƒæ¥å°è¯•åŒ¹é…ä¸¤ä¸ªè¿ç»­å‡ºç°çš„ catï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä½ ä¼šå‘ç°ï¼Œå³ä¾¿æ˜¯ç¬¬ä¸€ä¸ª cat å’Œç¬¬äºŒä¸ª cat å¤§å°å†™ä¸ä¸€è‡´ï¼Œä¹Ÿå¯ä»¥åŒ¹é…ä¸Šã€‚</p><p><a href="https://regex101.com/r/x1lg4P/1">https://regex101.com/r/x1lg4P/1</a></p><p>å¦‚æœæˆ‘ä»¬æƒ³è¦å‰é¢åŒ¹é…ä¸Šçš„ç»“æœï¼Œå’Œç¬¬äºŒæ¬¡é‡å¤æ—¶çš„å¤§å°å†™ä¸€è‡´ï¼Œé‚£è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿæˆ‘ä»¬åªéœ€è¦ç”¨æ‹¬å·æŠŠ**ä¿®é¥°ç¬¦å’Œæ­£åˆ™ cat **éƒ¨åˆ†æ‹¬èµ·æ¥ï¼ŒåŠ æ‹¬å·ç›¸å½“äºä½œç”¨èŒƒå›´çš„é™å®šï¼Œè®©ä¸åŒºåˆ†å¤§å°å†™åªä½œç”¨äºè¿™ä¸ªæ‹¬å·é‡Œçš„å†…å®¹</p><p><a href="https://regex101.com/r/x1lg4P/2">https://regex101.com/r/x1lg4P/2</a></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæ­£åˆ™å†™æˆäº† ((?i)cat) \1ï¼Œè€Œä¸æ˜¯ ((?i)(cat)) \1ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ç»™ä¿®é¥°ç¬¦å’Œ cat æ•´ä½“åŠ äº†ä¸ªæ‹¬å·ï¼Œè€ŒåŸæ¥ cat éƒ¨åˆ†çš„æ‹¬å·å»æ‰äº†ã€‚å¦‚æœ cat ä¿ç•™åŸæ¥çš„æ‹¬å·ï¼Œå³ ((?i)(cat)) \1ï¼Œè¿™æ ·æ­£åˆ™ä¸­å°±ä¼šæœ‰ä¸¤ä¸ªå­ç»„ï¼Œè™½ç„¶ç»“æœä¹Ÿæ˜¯å¯¹çš„ï¼Œä½†è¿™å…¶å®æ²¡å¿…è¦</p><p>å¦‚æœç”¨æ­£åˆ™åŒ¹é…ï¼Œå®ç°éƒ¨åˆ†åŒºåˆ†å¤§å°å†™ï¼Œå¦ä¸€éƒ¨åˆ†ä¸åŒºåˆ†å¤§å°å†™ï¼Œè¿™è¯¥å¦‚ä½•æ“ä½œå‘¢ï¼Ÿå°±æ¯”å¦‚è¯´æˆ‘ç°åœ¨æƒ³è¦ï¼Œthe cat ä¸­çš„ the ä¸åŒºåˆ†å¤§å°å†™ï¼Œcat åŒºåˆ†å¤§å°å†™</p><p>ä¹Ÿå°±æ˜¯ ((?i)the) cat</p><p><a href="https://regex101.com/r/x1lg4P/3">https://regex101.com/r/x1lg4P/3</a></p><h4 id="å•è¡Œæ¨¡å¼"><a href="#å•è¡Œæ¨¡å¼" class="headerlink" title="å•è¡Œæ¨¡å¼"></a>å•è¡Œæ¨¡å¼</h4><p>å•è¡Œçš„è‹±æ–‡è¡¨ç¤ºæ˜¯ Single Lineï¼Œå•è¡Œæ¨¡å¼å¯¹åº”çš„ä¿®é¥°ç¬¦æ˜¯ (?s)</p><p><a href="https://regex101.com/r/Adg1Og/1">https://regex101.com/r/Adg1Og/1</a></p><h4 id="å¤šè¡ŒåŒ¹é…æ¨¡å¼ï¼ˆMultilineï¼‰"><a href="#å¤šè¡ŒåŒ¹é…æ¨¡å¼ï¼ˆMultilineï¼‰" class="headerlink" title="å¤šè¡ŒåŒ¹é…æ¨¡å¼ï¼ˆMultilineï¼‰"></a>å¤šè¡ŒåŒ¹é…æ¨¡å¼ï¼ˆMultilineï¼‰</h4><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œ^åŒ¹é…æ•´ä¸ªå­—ç¬¦ä¸²çš„å¼€å¤´ï¼Œ$ åŒ¹é…æ•´ä¸ªå­—ç¬¦ä¸²çš„ç»“å°¾ã€‚å¤šè¡ŒåŒ¹é…æ¨¡å¼æ”¹å˜çš„å°±æ˜¯ ^ å’Œ $ çš„åŒ¹é…è¡Œä¸º</p><p><a href="https://regex101.com/r/Adg1Og/2">https://regex101.com/r/Adg1Og/2</a></p><p>å¤šè¡Œæ¨¡å¼çš„ä½œç”¨åœ¨äºï¼Œä½¿ ^ å’Œ $ èƒ½åŒ¹é…ä¸Šæ¯è¡Œçš„å¼€å¤´æˆ–ç»“å°¾ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡å¼ä¿®é¥°ç¬¦å· (?m) æ¥æŒ‡å®šè¿™ä¸ªæ¨¡å¼ã€‚</p><p><a href="https://regex101.com/r/Adg1Og/3">https://regex101.com/r/Adg1Og/3</a></p><h4 id="æ³¨é‡Šæ¨¡å¼ï¼ˆCommentï¼‰"><a href="#æ³¨é‡Šæ¨¡å¼ï¼ˆCommentï¼‰" class="headerlink" title="æ³¨é‡Šæ¨¡å¼ï¼ˆCommentï¼‰"></a>æ³¨é‡Šæ¨¡å¼ï¼ˆCommentï¼‰</h4><p>æ­£åˆ™ä¸­æ³¨é‡Šæ¨¡å¼æ˜¯ä½¿ç”¨ (?#comment) æ¥è¡¨ç¤ºã€‚</p><pre><code class="mermaid" >graph LRA(æ­£åˆ™åŒ¹é…æ¨¡å¼<br>Match Mode)A-->A1(ä¸åŒºåˆ†å¤§å°å†™æ¨¡å¼<br>Case-Insensitive)A1-->A11("ä½œç”¨ï¼šæ­£åˆ™ä¸åŒºåˆ†è‹±æ–‡å­—æ¯çš„å¤§å°å†™")A1-->A12("ä¿®é¥°ç¬¦ï¼š(?i)")A-->A2(ç‚¹å·é€šé…æ¨¡å¼<br>Dot All)A2-->A21("ä½œç”¨ï¼šè‹±æ–‡çš„ç‚¹å·å¯ä»¥åŒ¹é…ä»»æ„å­—ç¬¦ï¼ŒåŒ…æ‹¬æ¢è¡Œ")A2-->A22("ä¿®é¥°ç¬¦ï¼š(?s)")A-->A3(å¤šè¡Œæ¨¡å¼<br>Multiline)A3-->A31("ä½œç”¨ï¼š^æˆ–$é»˜è®¤æ˜¯åŒ¹é…æ•´ä¸ªå­—ç¬¦ä¸²çš„å¼€å¤´æˆ–ç»“å°¾<br>å¤šè¡Œæ¨¡å¼ä½¿å¾—ä»–ä»¬èƒ½åŒ¹é…æ¯è¡Œçš„å¼€å¤´æˆ–ç»“å°¾")A3-->A32("ä¿®é¥°ç¬¦ï¼š(?m)")A-->A4(æ³¨é‡Šæ¨¡å¼<br>Comment)A4-->A41("ä½œç”¨ï¼šæ·»åŠ æ³¨é‡Š")A4-->A42("ä¿®é¥°ç¬¦ï¼š(?#comment)")</code></pre><p>é—®é¢˜ï¼š</p><p>æå–htmlä¸­headæ ‡ç­¾ä¸­çš„æ‰€æœ‰å†…å®¹</p><h3 id="æ–­è¨€"><a href="#æ–­è¨€" class="headerlink" title="æ–­è¨€"></a>æ–­è¨€</h3><p>ç®€å•æ¥è¯´ï¼Œæ–­è¨€æ˜¯æŒ‡å¯¹åŒ¹é…åˆ°çš„æ–‡æœ¬ä½ç½®æœ‰è¦æ±‚ã€‚æ¯”å¦‚ï¼Œå»æŸ¥æ‰¾ä¸€ä¸ªå•è¯ï¼Œæˆ‘ä»¬è¦æŸ¥æ‰¾ tomï¼Œä½†å…¶å®ƒçš„å•è¯ï¼Œæ¯”å¦‚ tomorrow ä¸­ä¹ŸåŒ…å«äº† tomã€‚</p><h4 id="å•è¯è¾¹ç•Œï¼ˆWord-Boundaryï¼‰"><a href="#å•è¯è¾¹ç•Œï¼ˆWord-Boundaryï¼‰" class="headerlink" title="å•è¯è¾¹ç•Œï¼ˆWord Boundaryï¼‰"></a>å•è¯è¾¹ç•Œï¼ˆWord Boundaryï¼‰</h4><p>æˆ‘ä»¬æƒ³è¦æŠŠä¸‹é¢æ–‡æœ¬ä¸­çš„ tom æ›¿æ¢æˆ jerryã€‚æ³¨æ„ä¸€ä¸‹ï¼Œåœ¨æ–‡æœ¬ä¸­å‡ºç°äº† tomorrow è¿™ä¸ªå•è¯ï¼Œtomorrow ä¹Ÿæ˜¯ä»¥ tom å¼€å¤´çš„ã€‚</p><blockquote><p>tom asked me if I would go fishing with him tomorrow.</p></blockquote><p>åˆ©ç”¨å‰é¢å­¦åˆ°çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬å¦‚æœç›´æ¥æ›¿æ¢ï¼Œä¼šå‡ºç°ä¸‹é¢è¿™ç§ç»“æœã€‚</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tex">æ›¿æ¢å‰ï¼štom asked me if I would go fishing with him tomorrow.<br>æ›¿æ¢åï¼šjerry asked me if I would go fishing with him jerryorrow.<br></code></pre></td></tr></table></figure><p>å•è¯çš„ç»„æˆä¸€èˆ¬å¯ä»¥ç”¨å…ƒå­—ç¬¦ \w+ æ¥è¡¨ç¤ºï¼Œ\w åŒ…æ‹¬äº†å¤§å°å†™å­—æ¯ã€ä¸‹åˆ’çº¿å’Œæ•°å­—ï¼ˆå³ [A-Za-z0-9_]ï¼‰ã€‚é‚£å¦‚æœæˆ‘ä»¬èƒ½æ‰¾å‡ºå•è¯çš„è¾¹ç•Œï¼Œä¹Ÿå°±æ˜¯å½“å‡ºç°äº†\w è¡¨ç¤ºçš„èŒƒå›´ä»¥å¤–çš„å­—ç¬¦ï¼Œæ¯”å¦‚å¼•å·ã€ç©ºæ ¼ã€æ ‡ç‚¹ã€æ¢è¡Œç­‰è¿™äº›ç¬¦å·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æ­£åˆ™ä¸­ä½¿ç”¨\b æ¥è¡¨ç¤ºå•è¯çš„è¾¹ç•Œã€‚ \b ä¸­çš„ b å¯ä»¥ç†è§£ä¸ºæ˜¯è¾¹ç•Œï¼ˆBoundaryï¼‰è¿™ä¸ªå•è¯çš„é¦–å­—æ¯ã€‚</p><table><thead><tr><th></th><th>tom</th><th>\btom</th><th>tom\b</th><th>\btom\b</th></tr></thead><tbody><tr><td>tom</td><td>âˆš</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr><tr><td>tomorrow</td><td>âˆš</td><td>âˆš</td><td>Ã—</td><td>Ã—</td></tr><tr><td>atom</td><td>âˆš</td><td>Ã—</td><td>âˆš</td><td>Ã—</td></tr><tr><td>atomic</td><td>âˆš</td><td>Ã—</td><td>Ã—</td><td>Ã—</td></tr></tbody></table><h4 id="è¡Œçš„å¼€å§‹æˆ–ç»“æŸ"><a href="#è¡Œçš„å¼€å§‹æˆ–ç»“æŸ" class="headerlink" title="è¡Œçš„å¼€å§‹æˆ–ç»“æŸ"></a>è¡Œçš„å¼€å§‹æˆ–ç»“æŸ</h4><p>å¯ä»¥å‚è€ƒ<strong>ç©ºç™½ç¬¦</strong>å’Œ<strong>åŒ¹é…æ¨¡å¼</strong></p><h4 id="ç¯è§†ï¼ˆ-Look-Aroundï¼‰"><a href="#ç¯è§†ï¼ˆ-Look-Aroundï¼‰" class="headerlink" title="ç¯è§†ï¼ˆ Look Aroundï¼‰"></a>ç¯è§†ï¼ˆ Look Aroundï¼‰</h4><p>æ¯”å¦‚æˆ‘ä»¬è¦æå–å…­ä½æ•°å­—çš„é‚®æ”¿ç¼–ç ï¼Œä¸èƒ½ç®€å•çš„å†™<code>\d&#123;6&#125;</code>ï¼Œè¿™æ ·çš„è¯ï¼Œ11ä½æ•°å­—çš„æ‰‹æœºå·ç ä¹Ÿèƒ½åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œé™¤äº†æ–‡æœ¬æœ¬èº«ç»„æˆç¬¦åˆè¿™ 6 ä½æ•°çš„è§„åˆ™å¤–ï¼Œè¿™ 6 ä½æ•°å·¦è¾¹æˆ–å³è¾¹éƒ½ä¸èƒ½æ˜¯æ•°å­—ã€‚æ­£åˆ™æ˜¯é€šè¿‡ç¯è§†æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„</p><table><thead><tr><th>æ­£åˆ™</th><th>åç§°</th><th>å«ä¹‰</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>(?&lt;=Y)</code></td><td>è‚¯å®šé€†åºç¯è§†<br>positive-lookbehind</td><td>å·¦è¾¹æ˜¯Y</td><td><code>(?&lt;=\d)th</code>:å·¦è¾¹æ˜¯æ•°å­—çš„thï¼Œèƒ½åŒ¹é…9th</td></tr><tr><td><code>(?&lt;!Y)</code></td><td>å¦å®šé€†åºç¯è§†<br>negative-lookbehind</td><td>å·¦è¾¹ä¸æ˜¯Y</td><td><code>(?&lt;!\d)th</code>:å·¦è¾¹ä¸æ˜¯æ•°å­—çš„thï¼Œèƒ½åŒ¹é…health</td></tr><tr><td><code>(?=Y)</code></td><td>è‚¯å®šé¡ºåºç¯è§†<br>positive-lookhead</td><td>å³è¾¹æ˜¯Y</td><td><code>six(?=\d)</code>:å³è¾¹æ˜¯æ•°å­—çš„sizï¼Œèƒ½åŒ¹é…six6</td></tr><tr><td><code>(?!Y)</code></td><td>å¦å®šé€†åºç¯è§†<br>negative-lookhead</td><td>å³è¾¹ä¸æ˜¯Y</td><td><code>hi(?!\d)</code>:å³è¾¹ä¸æ˜¯æ•°å­—çš„hiï¼Œèƒ½åŒ¹é…high</td></tr></tbody></table><h4 id="ç¯è§†ä¸å­ç»„"><a href="#ç¯è§†ä¸å­ç»„" class="headerlink" title="ç¯è§†ä¸å­ç»„"></a>ç¯è§†ä¸å­ç»„</h4><p>ç¯è§†ä¸­è™½ç„¶ä¹Ÿæœ‰æ‹¬å·ï¼Œä½†ä¸ä¼šä¿å­˜æˆå­ç»„ã€‚ä¿å­˜æˆå­ç»„çš„ä¸€èˆ¬æ˜¯åŒ¹é…åˆ°çš„æ–‡æœ¬å†…å®¹ï¼Œåç»­ç”¨äºæ›¿æ¢ç­‰æ“ä½œï¼Œè€Œç¯è§†æ˜¯è¡¨ç¤ºå¯¹æ–‡æœ¬å·¦å³ç¯å¢ƒçš„è¦æ±‚ï¼Œå³ç¯è§†åªåŒ¹é…ä½ç½®ï¼Œä¸åŒ¹é…æ–‡æœ¬å†…å®¹</p><pre><code class="mermaid" >graph LRA(æ–­è¨€)--> A1(å•è¯è¾¹ç•Œ)A1-->A11(\båŒ¹é…å•è¯è¾¹ç•Œ)A-->A2(è¡Œçš„å¼€å§‹/ç»“æŸ)A2-->A21("^åŒ¹é…è¡Œçš„å¼€å§‹<br>å¤šè¡Œæ¨¡å¼æ—¶ï¼Œå¯ä»¥åŒ¹é…ä»»æ„è¡Œå¼€å¤´")A2-->A22("$åŒ¹é…è¡Œçš„ç»“æŸ<br>å¤šè¡Œæ¨¡å¼æ—¶ï¼Œå¯ä»¥åŒ¹é…ä»»æ„è¡Œç»“å°¾")A2-->A23("\Aä»…åŒ¹é…æ•´ä¸ªå­—ç¬¦ä¸²çš„å¼€å§‹<br/>ä¸æ”¯æŒå¤šè¡Œæ¨¡å¼")A2-->A24("\Zä»…åŒ¹é…æ•´ä¸ªå­—ç¬¦ä¸²ç»“æŸ<br/>ä¸æ”¯æŒå¤šè¡Œæ¨¡å¼")A-->A3(ç¯è§†)A3-->A31("(?=Y)X:åŒ¹é…å‰é¢æ˜¯Yçš„X")A3-->A32("(?!Y)X:åŒ¹é…å‰é¢ä¸æ˜¯Yçš„X")A3-->A33("X(?=Y):åŒ¹é…åé¢æ˜¯Yçš„X")A3-->A34("X(?!Y):åŒ¹é…åé¢ä¸æ˜¯Yçš„X")</code></pre><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>æ­£åˆ™</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MMKVä¸SharedPreference</title>
    <link href="/2020/08/23/MMKV%E4%B8%8ESharedPreference/"/>
    <url>/2020/08/23/MMKV%E4%B8%8ESharedPreference/</url>
    
    <content type="html"><![CDATA[<p>é‰´äºSPçš„â€ç§ç§é—®é¢˜â€,èŒå‘äº†æƒ³è¦ä½¿ç”¨å†™æ–‡ä»¶çš„æ–¹å¼æ›¿æ¢æ‰spçš„æƒ³æ³•ï¼Œå‘ç°è…¾è®¯å¼€æºMMKVæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p><span id="more"></span><h5 id="å­˜å‚¨æ–¹å¼"><a href="#å­˜å‚¨æ–¹å¼" class="headerlink" title="å­˜å‚¨æ–¹å¼"></a>å­˜å‚¨æ–¹å¼</h5><ol><li>SharedPreferences</li><li>ContentProvider</li><li>æ–‡ä»¶</li><li>æ•°æ®åº“</li></ol><h5 id="å¦‚ä½•é€‰æ‹©"><a href="#å¦‚ä½•é€‰æ‹©" class="headerlink" title="å¦‚ä½•é€‰æ‹©"></a>å¦‚ä½•é€‰æ‹©</h5><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>æ—¶é—´å¼€é”€</td><td>è¿™é‡Œè¯´çš„æ—¶é—´å¼€é”€åŒ…æ‹¬äº†CPUæ—¶é—´å’Œ&#x2F;0æ—¶é—´ï¼Œåœ¨I&#x2F;Oä¼˜åŒ–ä¸­æˆ‘å°±å¤šæ¬¡æåˆ°ç›¸æ¯”CPUå’Œå†…å­˜ï¼ŒI&#x2F;0å­˜å‚¨çš„é€Ÿåº¦æ˜¯éå¸¸æ…¢çš„ã€‚ä½†æ˜¯å¦‚æœå­˜å‚¨æ–¹æ³•ä¸­æ¯”å¦‚ç¼–è§£ç æˆ–è€…åŠ å¯†&#x2F;è§£å¯†ç­‰è®¾è®¡çš„æ¯”è¾ƒå¤æ‚ï¼Œæ•´ä¸ªæ•°æ®å­˜å‚¨è¿‡ç¨‹ä¹Ÿä¼šå‡ºç°CPUæ—¶é—´å˜å¾—æ›´é•¿çš„æƒ…å†µ</td></tr><tr><td>æ­£ç¡®æ€§</td><td>é€‰æ‹©å­˜å‚¨æ–¹æ¡ˆçš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªéœ€è¦åˆ¤æ–­å®ƒæ˜¯å¦é è°±ã€‚è¿™å¥—å­˜å‚¨æ–¹æ¡ˆè®¾è®¡æ˜¯å¦å®Œå¤‡ï¼Œæœ‰æ²¡æœ‰æ”¯æŒå¤šçº¿ç¨‹æˆ–è€…è·¨è¿›ç¨‹åŒæ­¥æ“ä½œã€‚å†…éƒ¨æ˜¯å¦å¥å£®ï¼Œæœ‰æ²¡æœ‰è€ƒè™‘å¼‚å¸¸æƒ…å†µä¸‹æ•°æ®çš„æ ¡éªŒå’Œæ¢å¤ï¼Œæ¯”å¦‚é‡‡ç”¨åŒå†™æˆ–è€…å¤‡ä»½æ–‡ä»¶ç­–ç•¥ï¼Œå³ä½¿ä¸»æ–‡ä»¶å› ä¸ºç³»ç»Ÿåº•å±‚å¯¼è‡´æŸåï¼Œä¹Ÿå¯ä»¥ä¸€å®šç¨‹åº¦ ä¸Šæ¢å¤å¤§éƒ¨åˆ†æ•°æ®</td></tr><tr><td>ç©ºé—´å¼€é”€</td><td>å³ä½¿ç›¸åŒçš„æ•°æ®å¦‚æœä½¿ç”¨ä¸åŒçš„ç¼–ç æ–¹å¼ï¼Œæœ€åå ç”¨çš„å­˜å‚¨ç©ºé—´ä¹Ÿä¼šæœ‰æ‰€ä¸åŒã€‚ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œç›¸åŒçš„æ•°æ®æ‰€å çš„ç©ºé—´å¤§å°æ˜¯XML&gt;JSON&gt;ProtocolBufferã€‚é™¤äº†ç¼–ç æ–¹å¼çš„å·®å¼‚ï¼Œåœ¨ä¸€äº›åœºæ™¯æˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦å¼•å…¥å‹ç¼©ç­–ç•¥æ¥è¿›-æ­¥å‡å°‘å­˜å‚¨ç©ºé—´ï¼Œä¾‹å¦‚zipã€lzmaç­‰ã€‚æ•°æ®å­˜å‚¨çš„ç©ºé—´å¼€é”€è¿˜éœ€è¦è€ƒè™‘å†…å­˜ç©ºé—´çš„å ç”¨é‡ï¼Œæ•´ä¸ªå­˜å‚¨è¿‡ç¨‹ä¼šä¸ä¼šå¯¼è‡´åº”ç”¨å‡ºç°å¤§é‡GCã€OOMç­‰</td></tr><tr><td>å®‰å…¨</td><td>åº”ç”¨ä¸­å¯èƒ½ä¼šæœ‰ä¸€äº›éå¸¸æ•æ„Ÿçš„æ•°æ®,å³ä½¿å®ƒä»¬å­˜å‚¨åœ¨&#x2F;data&#x2F;dataä¸­ï¼Œæˆ‘ä»¬ä¾ç„¶å¿…é¡»å°†å®ƒä»¬åŠ å¯†ã€‚ä¾‹å¦‚å¾®ä¿¡çš„èŠå¤©æ•°æ®æ˜¯å­˜å‚¨åœ¨åŠ å¯†çš„æ•°æ®åº“ä¸­ï¼Œä¸€äº›äº›è´¦å·ç›¸å…³çš„æ•°æ®æˆ‘ä»¬ä¹Ÿè¦å•ç‹¬åšåŠ å¯†è½åœ°ã€‚æ ¹æ®åŠ å¯†å¼ºåº¦çš„ä¸åŒï¼Œå¯ä»¥é€‰æ‹©RSAã€AESã€chacha20ã€ TEAè¿™äº›å¸¸ç”¨çš„åŠ å¯†ç®—æ³•</td></tr><tr><td>å¼€å‘æˆæœ¬</td><td>æœ‰äº›å­˜å‚¨æ–¹æ¡ˆçœ‹èµ·æ¥éå¸¸é«˜å¤§ä¸Šï¼Œä½†æ˜¯éœ€è¦ä¸šåŠ¡åšå¾ˆå¤§æ”¹é€ æ‰èƒ½æ¥å…¥ã€‚è¿™é‡Œæˆ‘ä»¬å½“ç„¶å¸Œæœ›èƒ½æ— ç¼çš„æ¥å…¥åˆ°ä¸šåŠ¡ä¸­ï¼Œåœ¨æ•´ä¸ªå¼€å‘è¿‡ç¨‹è¶Šç®€å•è¶Šå¥½</td></tr><tr><td>å…¼å®¹æ€§</td><td>ä¸šåŠ¡ä¸åœåœ°å‘å‰æ¼”è¿›ï¼Œæˆ‘ä»¬çš„å­˜å‚¨å­—æ®µæˆ–è€…æ ¼å¼æœ‰æ—¶å€™ä¹Ÿä¼šä¸å¾—ä¸æœ‰æ‰€å˜åŒ–ã€‚å…¼å®¹æ€§é¦–å…ˆè¦è€ƒè™‘çš„æ˜¯å‘å‰ã€å‘åçš„å…¼å®¹æ€§ï¼Œè€çš„æ•°æ®åœ¨å‡çº§æ—¶èƒ½å¦è¿ç§»è¿‡æ¥ï¼Œæ–°çš„æ•°æ®åœ¨è€ç‰ˆæœ¬èƒ½å¦é™çº§ä½¿ç”¨ã€‚å…¼å®¹æ€§å¦å¤–ä¸€ä¸ªéœ€è¦è€ƒè™‘çš„å¯èƒ½æ˜¯å¤šè¯­è¨€çš„é—®é¢˜ï¼Œä¸åŒçš„è¯­è¨€æ˜¯å¦æ”¯æŒè½¬æ¢</td></tr></tbody></table><h4 id="spçš„Nå®—ç½ª"><a href="#spçš„Nå®—ç½ª" class="headerlink" title="spçš„Nå®—ç½ª"></a>spçš„Nå®—ç½ª</h4><ol><li>è·¨è¿›ç¨‹ä¸å®‰å…¨</li><li>åŠ è½½ç¼“æ…¢ï¼šå¼‚æ­¥åŠ è½½ï¼Œä½†æ˜¯å¼‚æ­¥åŠ è½½çº¿ç¨‹æ²¡æœ‰è®¾ç½®ä¼˜å…ˆçº§ï¼Œå¦‚æœè¿™æ—¶å€™ä¸»çº¿ç¨‹è¯»å–æ•°æ®éœ€è¦ç­‰å¾…åŠ è½½çº¿ç¨‹æ‰§è¡Œå®Œæ¯•(ä¹Ÿå°±æ˜¯ä¸»çº¿ç¨‹ç­‰å¾…ä½ä¼˜å…ˆçº§çº¿ç¨‹é”çš„é—®é¢˜)</li><li>å…¨é‡å†™å…¥ï¼šæ— è®ºæ˜¯commitè¿˜æ˜¯applyï¼Œå³ä½¿æ”¹åŠ¨ä¸€ä¸ªæ¡ç›®ï¼Œä¹Ÿä¼šæŠŠå…¨éƒ¨å†…å®¹å†™åˆ°æ–‡ä»¶</li><li>å¡é¡¿ï¼šå¼‚æ­¥è½ç›˜æœºåˆ¶åœ¨åº”ç”¨å´©æºƒæ—¶ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±</li></ol><p>ä¸‹é¢æ˜¯SPæ“ä½œæºç çš„ç®€ä»‹å›¾ï¼Œæ¥æºï¼š<a href="https://juejin.im/entry/6844903488271417351">https://juejin.im/entry/6844903488271417351</a></p><p><img src="/image/Android/MMKV/apply.png" alt="linux-io"></p><p><img src="/image/Android/MMKV/commit.png" alt="linux-io"></p><h4 id="SPä¼˜åŒ–"><a href="#SPä¼˜åŒ–" class="headerlink" title="SPä¼˜åŒ–"></a>SPä¼˜åŒ–</h4><p>å¯ä»¥åœ¨Applicationä¸­é‡å†™getSharedPreferenceæ–¹æ³•ï¼Œè¿”å›è‡ªå·±å®ç°çš„spã€‚æˆ‘ä»¬å¯ä»¥è‡ªå·±å°†å¤šæ¬¡è¯»å†™è¿›è¡Œåˆå¹¶</p><h4 id="MMKVä¸SP"><a href="#MMKVä¸SP" class="headerlink" title="MMKVä¸SP"></a>MMKVä¸SP</h4><table><thead><tr><th>å…³é”®è¦ç´ </th><th>SP</th><th>MMKV</th></tr></thead><tbody><tr><td>æ­£ç¡®æ€§</td><td>å·®<br>è·¨è¿›ç¨‹å’Œapplyæœºåˆ¶å¯¼è‡´æ•°æ®ä¸¢å¤±</td><td>ä¼˜<br>ä½¿ç”¨mmapå’Œæ–‡ä»¶ é”ä¿è¯æ•°æ®å®Œæ•´</td></tr><tr><td>æ—¶é—´å¼€é”€</td><td>å·®<br>å…¨é‡å†™å…¥ã€å¡é¡¿</td><td>ä¼˜<br>1.ä½¿ç”¨mmap<br/>2.ä¿®æ”¹æ’å…¥æ–‡ä»¶å°¾éƒ¨ï¼Œæ— éœ€å…¨é‡å†™å…¥</td></tr><tr><td>ç©ºé—´å¼€é”€</td><td>å·®<br>ä½¿ç”¨XMLï¼Œæ ¼å¼æ¯”è¾ƒå†—ä½™</td><td>è‰¯<br/>ä½¿ç”¨Protocol Buffer,ä½†æ˜¯å¢é‡æ›´æ–°å¯èƒ½ä¼šå¯¼è‡´éƒ¨åˆ†å†—ä½™</td></tr><tr><td>å®‰å…¨</td><td>å·®<br/>å®Œå…¨æ˜æ–‡å­˜å‚¨ï¼Œæ²¡æœ‰æ”¯æŒåŠ å¯†ä¸æƒé™æ ¡éªŒï¼Œä¸é€‚åˆå­˜æ”¾æ•æ„Ÿæ•°æ®</td><td>è‰¯<br/>ä½¿ç”¨Protocol Buffer,ä¸æ˜¯å®Œå…¨æ˜æ–‡ã€‚æ²¡æœ‰æ”¯æŒåŠ å¯†ä¸æƒé™æ ¡éªŒï¼Œä¸é€‚åˆå­˜æ”¾æ•æ„Ÿæ•°æ®</td></tr><tr><td>å¼€å‘æˆæœ¬</td><td>ä¼˜<br/>ç³»ç»Ÿæ”¯æŒï¼Œéå¸¸ç®€å•</td><td>è‰¯<br/>éœ€è¦å¼•å…¥å•ç‹¬åº“ï¼Œæœ‰ä¸€å®šçš„æ”¹é€ æˆæœ¬</td></tr><tr><td>å…¼å®¹æ€§</td><td>ä¼˜<br/>æ”¯æŒå‰åå…¼å®¹</td><td>ä¼˜<br/>æ”¯æŒå‰åå…¼å®¹ï¼Œæ”¯æŒå¯¼å…¥<br/>SharedPreferenceså†å²æ•°æ®ï¼Œä½†æ³¨æ„<br/>è½¬æ¢åç‰ˆæœ¬æ— æ³•å›é€€</td></tr></tbody></table><h4 id="MMKVåŸç†ï¼šæ¥æºhttps-github-com-Tencent-MMKV"><a href="#MMKVåŸç†ï¼šæ¥æºhttps-github-com-Tencent-MMKV" class="headerlink" title="MMKVåŸç†ï¼šæ¥æºhttps://github.com/Tencent/MMKV"></a>MMKVåŸç†ï¼šæ¥æº<a href="https://github.com/Tencent/MMKV">https://github.com/Tencent/MMKV</a></h4><ol><li><p>å†…å­˜å‡†å¤‡</p><p>é€šè¿‡ mmap å†…å­˜æ˜ å°„æ–‡ä»¶ï¼Œæä¾›ä¸€æ®µå¯ä¾›éšæ—¶å†™å…¥çš„å†…å­˜å—ï¼ŒApp åªç®¡å¾€é‡Œé¢å†™æ•°æ®ï¼Œç”±æ“ä½œç³»ç»Ÿè´Ÿè´£å°†å†…å­˜å›å†™åˆ°æ–‡ä»¶ï¼Œä¸å¿…æ‹…å¿ƒ crash å¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</p><p><img src="/image/Android/MMKV/Linux-storage-stack.png" alt="Linux-storage-stack"></p></li></ol><p>ç®€åŒ–ç‰ˆ<br>   <img src="/image/Android/MMKV/linux-io.png" alt="linux-io"></p><ol start="2"><li><p>æ•°æ®ç»„ç»‡</p><p>æ•°æ®åºåˆ—åŒ–æ–¹é¢æˆ‘ä»¬é€‰ç”¨ protobuf åè®®ï¼Œpb åœ¨æ€§èƒ½å’Œç©ºé—´å ç”¨ä¸Šéƒ½æœ‰ä¸é”™çš„è¡¨ç°ã€‚è€ƒè™‘åˆ°æˆ‘ä»¬è¦æä¾›çš„æ˜¯é€šç”¨ kv ç»„ä»¶ï¼Œkey å¯ä»¥é™å®šæ˜¯ string å­—ç¬¦ä¸²ç±»å‹ï¼Œvalue åˆ™å¤šç§å¤šæ ·ï¼ˆint&#x2F;bool&#x2F;double ç­‰ï¼‰ã€‚è¦åšåˆ°é€šç”¨çš„è¯ï¼Œè€ƒè™‘å°† value é€šè¿‡ protobuf åè®®åºåˆ—åŒ–æˆç»Ÿä¸€çš„å†…å­˜å—ï¼ˆbufferï¼‰ï¼Œç„¶åå°±å¯ä»¥å°†è¿™äº› KV å¯¹è±¡åºåˆ—åŒ–åˆ°å†…å­˜ä¸­ã€‚</p></li><li><p>å†™å…¥ä¼˜åŒ–</p><p>æ ‡å‡† protobuf ä¸æä¾›å¢é‡æ›´æ–°çš„èƒ½åŠ›ï¼Œæ¯æ¬¡å†™å…¥éƒ½å¿…é¡»å…¨é‡å†™å…¥ã€‚è€ƒè™‘åˆ°ä¸»è¦ä½¿ç”¨åœºæ™¯æ˜¯é¢‘ç¹åœ°è¿›è¡Œå†™å…¥æ›´æ–°ï¼Œæˆ‘ä»¬éœ€è¦æœ‰å¢é‡æ›´æ–°çš„èƒ½åŠ›ï¼šå°†å¢é‡ kv å¯¹è±¡åºåˆ—åŒ–åï¼Œç›´æ¥ append åˆ°å†…å­˜æœ«å°¾ï¼›è¿™æ ·åŒä¸€ä¸ª key ä¼šæœ‰æ–°æ—§è‹¥å¹²ä»½æ•°æ®ï¼Œæœ€æ–°çš„æ•°æ®åœ¨æœ€åï¼›é‚£ä¹ˆåªéœ€åœ¨ç¨‹åºå¯åŠ¨ç¬¬ä¸€æ¬¡æ‰“å¼€ mmkv æ—¶ï¼Œä¸æ–­ç”¨åè¯»å…¥çš„ value æ›¿æ¢ä¹‹å‰çš„å€¼ï¼Œå°±å¯ä»¥ä¿è¯æ•°æ®æ˜¯æœ€æ–°æœ‰æ•ˆçš„ã€‚</p></li><li><p>ç©ºé—´å¢é•¿</p><p>ä½¿ç”¨ append å®ç°å¢é‡æ›´æ–°å¸¦æ¥äº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œå°±æ˜¯ä¸æ–­ append çš„è¯ï¼Œæ–‡ä»¶å¤§å°ä¼šå¢é•¿å¾—ä¸å¯æ§ã€‚ä¾‹å¦‚åŒä¸€ä¸ª key ä¸æ–­æ›´æ–°çš„è¯ï¼Œæ˜¯å¯èƒ½è€—å°½å‡ ç™¾ M ç”šè‡³ä¸Š G ç©ºé—´ï¼Œè€Œäº‹å®ä¸Šæ•´ä¸ª kv æ–‡ä»¶å°±è¿™ä¸€ä¸ª keyï¼Œä¸åˆ° 1k ç©ºé—´å°±å­˜å¾—ä¸‹ã€‚è¿™æ˜æ˜¾æ˜¯ä¸å¯å–çš„ã€‚æˆ‘ä»¬éœ€è¦åœ¨æ€§èƒ½å’Œç©ºé—´ä¸Šåšä¸ªæŠ˜ä¸­ï¼šä»¥å†…å­˜ pagesize ä¸ºå•ä½ç”³è¯·ç©ºé—´ï¼Œåœ¨ç©ºé—´ç”¨å°½ä¹‹å‰éƒ½æ˜¯ append æ¨¡å¼ï¼›å½“ append åˆ°æ–‡ä»¶æœ«å°¾æ—¶ï¼Œè¿›è¡Œæ–‡ä»¶é‡æ•´ã€key æ’é‡ï¼Œå°è¯•åºåˆ—åŒ–ä¿å­˜æ’é‡ç»“æœï¼›æ’é‡åç©ºé—´è¿˜æ˜¯ä¸å¤Ÿç”¨çš„è¯ï¼Œå°†æ–‡ä»¶æ‰©å¤§ä¸€å€ï¼Œç›´åˆ°ç©ºé—´è¶³å¤Ÿã€‚</p></li><li><p>æ•°æ®æœ‰æ•ˆæ€§</p><p>è€ƒè™‘åˆ°æ–‡ä»¶ç³»ç»Ÿã€æ“ä½œç³»ç»Ÿéƒ½æœ‰ä¸€å®šçš„ä¸ç¨³å®šæ€§ï¼Œæˆ‘ä»¬å¦å¤–å¢åŠ äº† crc æ ¡éªŒï¼Œå¯¹æ— æ•ˆæ•°æ®è¿›è¡Œç”„åˆ«ã€‚åœ¨ iOS å¾®ä¿¡ç°ç½‘ç¯å¢ƒä¸Šï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°æœ‰å¹³å‡çº¦ 70ä¸‡æ—¥æ¬¡çš„æ•°æ®æ ¡éªŒä¸é€šè¿‡ã€‚</p></li></ol><h4 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h4><p><a href="https://github.com/Tencent/MMKV">https://github.com/Tencent/MMKV</a> githubä¸Šæœ‰å¯¹åº”çš„ç¤ºä¾‹</p><h4 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h4><p><a href="http://www.0xffffff.org/2017/05/01/41-linux-io/">èŠèŠ Linux IO</a><br><a href="https://tech.meituan.com/2017/05/19/about-desk-io.html">ç£ç›˜I&#x2F;Oé‚£äº›äº‹</a><br><a href="https://www.ibm.com/developerworks/cn/linux/l-cache/index.html">Linux å†…æ ¸çš„æ–‡ä»¶ Cache ç®¡ç†æœºåˆ¶ä»‹ç»</a><br><a href="https://www.ibm.com/developerworks/cn/linux/l-cn-directio/index.html">Linux ä¸­ç›´æ¥ I&#x2F;O æœºåˆ¶çš„ä»‹ç»</a><br><a href="https://developer.android.com/reference/android/os/MemoryFile">MemoryFile</a><br><a href="https://developer.android.com/reference/java/nio/MappedByteBuffer">MappedByteBuffer</a><br><a href="https://juejin.im/entry/6844903488271417351">å½»åº•ææ‡‚ SharedPreferences</a><br><a href="https://developer.ibm.com/zh/articles/j-5things1/">Java å¯¹è±¡åºåˆ—åŒ–</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flutterå¼‚å¸¸å¤„ç†</title>
    <link href="/2020/07/27/Flutter%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/"/>
    <url>/2020/07/27/Flutter%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/</url>
    
    <content type="html"><![CDATA[<p>Flutterå¼‚å¸¸å’ŒJavaå¼‚å¸¸ç±»ä¼¼ï¼Œéƒ½æ˜¯ä»£ç è¿è¡Œæ—¶å‘ç”Ÿçš„é”™è¯¯äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸Javaç±»ä¼¼çš„try-catchæœºåˆ¶æ¥æ•è·è¿™ä¸ªå¼‚å¸¸ï¼Œå’Œjavaä¸åŒçš„åœ°æ–¹åœ¨äº Dart é‡‡ç”¨äº‹ä»¶å¾ªç¯çš„æœºåˆ¶æ¥è¿è¡Œä»»åŠ¡ï¼Œå„ä¸ªä»»åŠ¡çš„è¿è¡ŒçŠ¶æ€æ˜¯äº’ç›¸ç‹¬ç«‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä¾¿æŸä¸ªä»»åŠ¡å‡ºç°äº†å¼‚å¸¸æˆ‘ä»¬æ²¡æœ‰æ•è·å®ƒï¼ŒDart ç¨‹åºä¹Ÿä¸ä¼šé€€å‡ºï¼Œåªä¼šå¯¼è‡´å½“å‰ä»»åŠ¡åç»­çš„ä»£ç ä¸ä¼šè¢«æ‰§è¡Œï¼Œç”¨æˆ·ä»å¯ä»¥ç»§ç»­ä½¿ç”¨å…¶ä»–åŠŸèƒ½ã€‚</p><span id="more"></span><p>dartä¸­çš„å¼‚å¸¸åˆ†ä¸ºAppå¼‚å¸¸å’ŒFrameworkå¼‚å¸¸ï¼Œæ ¹æ®æ¥æºä¸åŒï¼Œæ•è·æ–¹å¼ä¹Ÿä¸åŒã€‚Appå¼‚å¸¸æˆ‘ä»¬å¯ä»¥é€šè¿‡tryâ€“catchæˆ–è€…å¼‚æ­¥è°ƒç”¨ä¸­çš„catchErroræ•è·ï¼›Frameworkä¸­çš„å¼‚å¸¸å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ErrorWidget.builderè¿›è¡Œæ•è·+å±•ç¤º</p><h3 id="Appå¼‚å¸¸çš„æ•è·æ–¹å¼"><a href="#Appå¼‚å¸¸çš„æ•è·æ–¹å¼" class="headerlink" title="Appå¼‚å¸¸çš„æ•è·æ–¹å¼"></a>Appå¼‚å¸¸çš„æ•è·æ–¹å¼</h3><p>Appå¼‚å¸¸ï¼Œå°±æ˜¯åº”ç”¨ä»£ç çš„å¼‚å¸¸ï¼Œé€šå¸¸ç”±æœªå¤„ç†åº”ç”¨å±‚å…¶ä»–æ¨¡å—æ‰€æŠ›å‡ºçš„å¼‚å¸¸å¼•èµ·ã€‚æ ¹æ®å¼‚å¸¸ä»£ç çš„æ‰§è¡Œæ—¶åºï¼ŒAppå¼‚å¸¸å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼Œå³åŒæ­¥å¼‚å¸¸å’Œå¼‚æ­¥å¼‚å¸¸:åŒæ­¥å¼‚å¸¸å¯ä»¥é€šè¿‡try-catchæœºåˆ¶æ•è·ï¼Œå¼‚æ­¥å¼‚å¸¸åˆ™éœ€è¦é‡‡ç”¨Future æä¾›çš„catchErrorè¯­å¥æ•è·ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//å¼‚å¸¸æ•è·</span><br><span class="hljs-keyword">try</span>&#123;<br>  <span class="hljs-keyword">throw</span> StateError(<span class="hljs-string">&quot;this is a dart exception&quot;</span>);<br><br>&#125;<span class="hljs-keyword">catch</span> (e)&#123;<br>  <span class="hljs-built_in">print</span>(e);<br>&#125;<br><br><br>Future.delayed(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">1</span>))<br>.then((value) =&gt; <span class="hljs-keyword">throw</span> StateError(<span class="hljs-string">&quot;this is a dart exception in future&quot;</span>) )<br>.catchError((e)=&gt;<span class="hljs-built_in">print</span>(e));<br><br><br><span class="hljs-comment">//æ— æ³•æ•è·</span><br><span class="hljs-keyword">try</span>&#123;<br>  Future.delayed(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">1</span>))<br>      .then((value) =&gt; <span class="hljs-keyword">throw</span> StateError(<span class="hljs-string">&quot;this is a dart exception in future by try catch&quot;</span>) );<br>&#125;<span class="hljs-keyword">catch</span>(e)&#123;<br>  <span class="hljs-built_in">print</span>(e);<br>&#125;<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸¤ç§æ–¹å¼æ˜¯ä¸èƒ½æ··ç”¨çš„ã€‚æ— æ³•ä½¿ç”¨try- -catchå»æ•è·ä¸€ä¸ªå¼‚æ­¥è°ƒç”¨æ‰€æŠ›å‡ºçš„å¼‚å¸¸çš„ã€‚å¦‚æœæˆ‘ä»¬æƒ³é›†ä¸­ç®¡ç†ä»£ç ä¸­çš„æ‰€æœ‰å¼‚å¸¸ï¼ŒFlutter ä¹Ÿæä¾›äº†Zone.runZoned æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥ç»™ä»£ç æ‰§è¡Œå¯¹è±¡æŒ‡å®šä¸€-ä¸ªZoneï¼Œåœ¨Dartä¸­ï¼ŒZoneè¡¨ç¤ºä¸€ä¸ªä»£ç æ‰§è¡Œçš„ç¯å¢ƒèŒƒå›´ï¼Œå…¶æ¦‚å¿µç±»ä¼¼æ²™ç›’ï¼Œä¸åŒæ²™ç›’ä¹‹é—´æ˜¯äº’ç›¸éš”ç¦»çš„ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦è§‚å¯Ÿæ²™ç›’ä¸­ä»£ç æ‰§è¡Œå‡ºç°çš„å¼‚å¸¸ï¼Œæ²™ç›’æä¾›äº†onErrorå›è°ƒå‡½æ•°ï¼Œæ‹¦æˆªé‚£äº›åœ¨ä»£ç æ‰§è¡Œå¯¹è±¡ä¸­çš„æœªæ•è·å¼‚å¸¸ã€‚<br>åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°†å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„è¯­å¥æ”¾ç½®åœ¨äº†Zoneé‡Œã€‚å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ²¡æœ‰ä½¿ç”¨try-catchå’ŒcatchErrorçš„æƒ…å†µä¸‹ï¼Œæ— è®ºæ˜¯åŒæ­¥å¼‚å¸¸è¿˜æ˜¯å¼‚æ­¥å¼‚å¸¸ï¼Œéƒ½å¯ä»¥é€šè¿‡Zoneç›´æ¥æ•è·åˆ°:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//runZoned</span><br>runZoned(() &#123;<br>  <span class="hljs-keyword">throw</span> StateError(<span class="hljs-string">&quot;this is a dart exception in future&quot;</span>);<br>  <br>&#125;, onError: (<span class="hljs-built_in">dynamic</span> e, StackTrace stack) &#123;<br>  <span class="hljs-built_in">print</span>(e);<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;catch exception by zone&quot;</span>);<br>&#125;);<br><br><br>runZoned(() &#123;<br>  Future.delayed(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">1</span>))<br>      .then((value) =&gt;<br>  <span class="hljs-keyword">throw</span> StateError(<span class="hljs-string">&quot;this is a dart exception in future by try catch&quot;</span>));<br>&#125;, onError: (<span class="hljs-built_in">dynamic</span> e, StackTrace stack) &#123;<br>  <span class="hljs-built_in">print</span>(e);<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;catch future exception by zone&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="Framework-å¼‚å¸¸æ•è·"><a href="#Framework-å¼‚å¸¸æ•è·" class="headerlink" title="Framework å¼‚å¸¸æ•è·"></a>Framework å¼‚å¸¸æ•è·</h2><p>Frameworkå¼‚å¸¸ï¼Œå°±æ˜¯Flutteræ¡†æ¶å¼•å‘çš„å¼‚å¸¸ï¼Œé€šå¸¸æ˜¯ç”±åº”ç”¨ä»£ç è§¦å‘äº†Flutter æ¡†æ¶åº•å±‚çš„å¼‚å¸¸åˆ¤æ–­å¼•èµ·çš„ã€‚æ¯”å¦‚ï¼Œå½“å¸ƒå±€é”™è¯¯æ—¶(å…·ä½“ä¸€ç‚¹å°±æ˜¯Textæ§ä»¶çš„æ„é€ æ–¹æ³•ä¼ å…¥null)ï¼ŒFlutter å°±ä¼šè‡ªåŠ¨å±•ç¤ºä¸€ä¸ªåŒ…å«é”™è¯¯ä¿¡æ¯çš„çº¢è‰²é¡µé¢ï¼Œè¿™å…¶å®æ˜¯å› ä¸ºï¼ŒFlutter æ¡†æ¶åœ¨è°ƒç”¨buildæ–¹æ³•æ„å»ºé¡µé¢æ—¶è¿›è¡Œäº†try- -catchçš„å¤„ç†ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªErrorWidgetï¼Œç”¨äºåœ¨å‡ºç°å¼‚å¸¸æ—¶è¿›è¡Œä¿¡æ¯æç¤º:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//abstract class ComponentElement extends Element </span><br><span class="hljs-comment">//StatelessElement extends  ComponentElement</span><br><span class="hljs-comment">// StatefulElement extends  ComponentElement</span><br><br>built = ErrorWidget.builder(<br>        _debugReportException(<br>          ErrorDescription(<span class="hljs-string">&#x27;building <span class="hljs-subst">$this</span>&#x27;</span>),<br>          e,<br>          stack,<br>          informationCollector: () <span class="hljs-keyword">sync</span>* &#123;<br>            <span class="hljs-keyword">yield</span> DiagnosticsDebugCreator(DebugCreator(<span class="hljs-keyword">this</span>));<br>          &#125;,<br>        )<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªé¡µé¢åé¦ˆçš„ä¿¡æ¯æ¯”è¾ƒä¸°å¯Œï¼Œé€‚åˆå¼€å‘æœŸå®šä½é—®é¢˜ã€‚ä½†æˆ‘ä»¬å¹¶ä¸æƒ³è®©ç”¨æˆ·çœ‹åˆ°è¿™ç§é”™è¯¯ä¿¡æ¯ï¼Œå¸Œæœ›ç»™ç”¨æˆ·å±•ç¤ºä¸€ä¸ªæ›´åŠ å‹å¥½çš„é¡µé¢ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šé‡å†™ErrorWidget.builderæ–¹æ³•ï¼Œè¿”å›æˆ‘ä»¬è‡ªå®šä¹‰çš„å±•ç¤ºä¿¡æ¯ï¼Œä¸‹é¢æˆ‘ä»¬ç›´æ¥è¿”å›äº†ä¸€ä¸ªå±…ä¸­çš„Textæ§ä»¶:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dart">ErrorWidget.builder = (FlutterErrorDetails flutterErrorDetails) &#123;<br>     <span class="hljs-keyword">return</span> Scaffold(<br>       body: Center(<br>         child: Text(<span class="hljs-string">&quot;<span class="hljs-subst">$&#123;flutterErrorDetails.exception&#125;</span>&quot;</span>),<br>       ),<br>     );<br>   &#125;;<br></code></pre></td></tr></table></figure><h4 id="å¼‚å¸¸ç»Ÿä¸€å¤„ç†"><a href="#å¼‚å¸¸ç»Ÿä¸€å¤„ç†" class="headerlink" title="å¼‚å¸¸ç»Ÿä¸€å¤„ç†"></a>å¼‚å¸¸ç»Ÿä¸€å¤„ç†</h4><p>ä¸ºäº†é›†ä¸­å¤„ç†æ¡†æ¶å¼‚å¸¸ï¼ŒFlutter æä¾›äº†FlutterErrorç±»ï¼Œè¿™ä¸ªç±»çš„onErrorå±æ€§ä¼šåœ¨æ¥æ”¶åˆ°æ¡†æ¶å¼‚å¸¸æ—¶æ‰§è¡Œç›¸åº”çš„å›è°ƒã€‚å› æ­¤ï¼Œè¦å®ç°è‡ªå®šä¹‰æ•è·é€»è¾‘ï¼Œæˆ‘ä»¬åªè¦ä¸ºå®ƒæä¾›ä¸€ä¸ªè‡ªå®šä¹‰çš„é”™è¯¯å¤„ç†å›è°ƒå³å¯ã€‚<br>åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Zoneæä¾›çš„handleUncaughtErrorè¯­å¥ï¼Œå°†Flutteræ¡†æ¶çš„å¼‚å¸¸ç»Ÿ- -è½¬å‘åˆ°å½“å‰çš„Zoneä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç»Ÿä¸€ä½¿ç”¨Zoneå»å¤„ç†åº”ç”¨å†…çš„æ‰€æœ‰å¼‚å¸¸äº†:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs dart"><br><span class="hljs-keyword">void</span> main() &#123;<br>  FlutterError.onError = (FlutterErrorDetails details) <span class="hljs-keyword">async</span> &#123;<br>    <span class="hljs-comment">//è½¬å‘è‡³zone</span><br>    Zone.current.handleUncaughtError(details.exception, details.stack);<br>  &#125;;<br><br>  runZoned&lt;Future&lt;<span class="hljs-built_in">Null</span>&gt;&gt;(() <span class="hljs-keyword">async</span> &#123;<br>    runApp(MyApp());<br>  &#125;, onError: (error, stackTrace) <span class="hljs-keyword">async</span> &#123;<br>    <span class="hljs-comment">//åœ¨è¿™é‡Œå¤„ç†å¼‚å¸¸ æä¸ªchannelï¼Œè½¬å‘åˆ°åŸç”Ÿï¼Œä¸ŠæŠ¥åˆ°buglyå¹³å°</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-------&quot;</span>);<br>    <span class="hljs-built_in">print</span>(error);<br>    <span class="hljs-built_in">print</span>(stackTrace);<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-------&quot;</span>);<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JetPack-sunflower</title>
    <link href="/2020/03/12/JetPack-sunflower/"/>
    <url>/2020/03/12/JetPack-sunflower/</url>
    
    <content type="html"><![CDATA[<p>2018å¹´è°·æ­ŒI&#x2F;O å‘å¸ƒäº†ä¸€ç³»åˆ—è¾…åŠ©androidå¼€å‘è€…çš„å®ç”¨å·¥å…·ï¼Œåˆç§°Jetpackï¼Œä»¥å¸®åŠ©å¼€å‘è€…æ„å»ºå‡ºè‰²çš„ Android åº”ç”¨ã€‚<br>sunflower with javaï¼ŒA gardening app illustrating Android development best practices with Android Jetpack.<br>sunflowerçš„javaç‰ˆæœ¬ï¼šå›­è‰ºåº”ç”¨ç¨‹åºï¼Œè¯´æ˜äº†ä½¿ç”¨Android Jetpackè¿›è¡ŒAndroidå¼€å‘çš„æœ€ä½³åšæ³•ã€‚<br>æºç åœ°å€ <a href="https://github.com/huangyuanlove/sunflower_java">https://github.com/huangyuanlove/sunflower_java</a> æœ¬é¡¹ç›®å®Œå…¨æ¥è‡ªäºkotlinç‰ˆæœ¬çš„<strong>ä»£ç ç¿»è¯‘</strong><br>kotlinç‰ˆæœ¬ <a href="https://github.com/android/sunflower">https://github.com/android/sunflower</a></p><span id="more"></span><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><ol><li>ä¸»é¡µåˆ†ä¸ºä¸¤ä¸ªtabï¼Œé»˜è®¤tabå±•ç¤ºå·²ç»æ ½ç§çš„æ¤ç‰©ï¼Œå¦å¤–ä¸€ä¸ªtabå±•ç¤ºæ‰€æœ‰å¯æ ½ç§æ¤ç‰©ï¼›</li><li>ç‚¹å‡»æ¯ä¸ªæ¤ç‰©è¿›å…¥åˆ°æ¤ç‰©è¯¦æƒ…</li><li>å•Activity</li><li>ViewModelä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®ï¼Œè¿”å›LiveDataå¯¹è±¡ï¼Œå¹¶å°†å¯¹è±¡ç»‘å®šåˆ°è§†å›¾ä¸­</li><li>å±•ç¤ºäº†åˆ›å»ºæ•°æ®åº“ã€æ•°æ®å¯¹è±¡ä»¥åŠViewModelã€Repositoryè¿‡ç¨‹<h4 id="JetPackç»„ä»¶"><a href="#JetPackç»„ä»¶" class="headerlink" title="JetPackç»„ä»¶"></a>JetPackç»„ä»¶</h4></li><li>lifecycle</li><li>navigation</li><li>room</li><li>work</li><li>liveData</li><li>databinding</li></ol><h4 id="æ¡†æ¶æ­å»º"><a href="#æ¡†æ¶æ­å»º" class="headerlink" title="æ¡†æ¶æ­å»º"></a>æ¡†æ¶æ­å»º</h4><ol><li>ä¸»é¡µï¼šMainActivity -&gt; HomeViewPagerFragment</li><li>æˆ‘çš„èŠ±å›­ï¼šGardenFragment</li><li>æ¤ç‰©ç›®å½•ï¼šPlantListFragment</li><li>æ¤ç‰©è¯¦æƒ…ï¼šPlantDetailFragment</li><li>æ•°æ®æ¥æºï¼šassetsä¸­çš„plants.json</li></ol><h4 id="ç»“æ„ç®€ä»‹"><a href="#ç»“æ„ç®€ä»‹" class="headerlink" title="ç»“æ„ç®€ä»‹"></a>ç»“æ„ç®€ä»‹</h4><ol><li>adapter:åŒ…å«DatabindingAdapter,ListViewAdapter</li><li>data:æ•°æ®åº“ã€å®ä½“ç±»ã€DAO</li><li>utilities:å¸¸é‡å­—æ®µ</li><li>viewmodels:å„ä¸ªè§†å›¾æ‰€éœ€çš„ViewModel</li><li>widget:è‡ªå®šä¹‰æ§ä»¶</li><li>workers:åˆå§‹åŒ–æ•°æ®åº“</li><li>*Fragment:è§†å›¾UI</li></ol><h4 id="æµç¨‹ç®€ä»‹"><a href="#æµç¨‹ç®€ä»‹" class="headerlink" title="æµç¨‹ç®€ä»‹"></a>æµç¨‹ç®€ä»‹</h4><ol><li>AppDatabaseå•ä¾‹æ¨¡å¼ï¼Œåœ¨GardenFragmentä¸­ä¼šè¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™æ—¶ä¼šå°†plants.jsonå†™å…¥æ•°æ®åº“ï¼›</li><li>åœ¨PlantListFragmentä¸­ï¼Œè¯»å–æ•°æ®åº“ä¸­æ¤ç‰©ä¿¡æ¯å¹¶å±•ç¤ºåœ¨é¡µé¢ä¸Šï¼›ç‚¹å‡»å³ä¸Šè§’æŒ‰é’®ï¼Œä¼šç­›é€‰æ¤ç‰©</li><li>ç‚¹å‡»æ¤ç‰©è¿›å…¥è¯¦æƒ…</li><li>åœ¨è¯¦æƒ…é¡µç‚¹å‡»åŠ å·æ·»åŠ æ¤ç‰©ï¼Œåˆ™ä¼šå‡ºç°åœ¨GardenFragmentä¸­ï¼ŒåŒæ—¶åŠ å·éšè—</li></ol><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JetPackä¸­çš„WorkManager</title>
    <link href="/2020/02/25/JetPack%E4%B8%AD%E7%9A%84WorkManager/"/>
    <url>/2020/02/25/JetPack%E4%B8%AD%E7%9A%84WorkManager/</url>
    
    <content type="html"><![CDATA[<p>2018å¹´è°·æ­ŒI&#x2F;O å‘å¸ƒäº†ä¸€ç³»åˆ—è¾…åŠ©androidå¼€å‘è€…çš„å®ç”¨å·¥å…·ï¼Œåˆç§°Jetpackï¼Œä»¥å¸®åŠ©å¼€å‘è€…æ„å»ºå‡ºè‰²çš„ Android åº”ç”¨ã€‚<br>è¿™æ¬¡å‘å¸ƒçš„ Android Jetpack ç»„ä»¶è¦†ç›–ä»¥ä¸‹ 4 ä¸ªæ–¹é¢ï¼šArchitectureã€Foundationã€Behavior ä»¥åŠ UIã€‚<br>è¯¥ç³»åˆ—åšå®¢ä»‹ç»ä¸€ä¸‹Jetpackä¸­å¸¸ç”¨ç»„ä»¶ï¼Œæœ¬ç¯‡ä»‹ç»LiveDataã€ViewModelã€LifeCycleã€‚æœ€åå€ŸåŠ©äº<a href="https://github.com/android/sunflower">https://github.com/android/sunflower</a> æ¥å†™ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨</p><span id="more"></span><p>åŸæ–‡ <a href="https://developer.android.com/topic/libraries/architecture/workmanager?hl=zh-cn">https://developer.android.com/topic/libraries/architecture/workmanager?hl=zh-cn</a></p><p>ä½¿ç”¨ WorkManager API å¯ä»¥è½»æ¾åœ°è°ƒåº¦å³ä½¿åœ¨åº”ç”¨é€€å‡ºæˆ–è®¾å¤‡é‡å¯æ—¶ä»åº”è¿è¡Œçš„å¯å»¶è¿Ÿå¼‚æ­¥ä»»åŠ¡ã€‚</p><p><strong>ä¸»è¦åŠŸèƒ½</strong>ï¼š</p><ul><li>æœ€é«˜å‘åå…¼å®¹åˆ° API 14<ul><li>åœ¨è¿è¡Œ API 23 åŠä»¥ä¸Šçº§åˆ«çš„è®¾å¤‡ä¸Šä½¿ç”¨ JobScheduler</li><li>åœ¨è¿è¡Œ API 14-22 çš„è®¾å¤‡ä¸Šç»“åˆä½¿ç”¨ BroadcastReceiver å’Œ AlarmManager</li></ul></li><li>æ·»åŠ ç½‘ç»œå¯ç”¨æ€§æˆ–å……ç”µçŠ¶æ€ç­‰å·¥ä½œçº¦æŸ</li><li>è°ƒåº¦ä¸€æ¬¡æ€§æˆ–å‘¨æœŸæ€§å¼‚æ­¥ä»»åŠ¡</li><li>ç›‘æ§å’Œç®¡ç†è®¡åˆ’ä»»åŠ¡</li><li>å°†ä»»åŠ¡é“¾æ¥èµ·æ¥</li><li>ç¡®ä¿ä»»åŠ¡æ‰§è¡Œï¼Œå³ä½¿åº”ç”¨æˆ–è®¾å¤‡é‡å¯ä¹ŸåŒæ ·æ‰§è¡Œä»»åŠ¡</li><li>éµå¾ªä½ç”µè€—æ¨¡å¼ç­‰çœç”µåŠŸèƒ½</li></ul><p>WorkManager æ—¨åœ¨ç”¨äº<strong>å¯å»¶è¿Ÿ</strong>è¿è¡Œï¼ˆå³ä¸éœ€è¦ç«‹å³è¿è¡Œï¼‰å¹¶ä¸”åœ¨åº”ç”¨é€€å‡ºæˆ–è®¾å¤‡é‡å¯æ—¶å¿…é¡»èƒ½å¤Ÿå¯é è¿è¡Œçš„ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼š</p><ul><li>å‘åç«¯æœåŠ¡å‘é€æ—¥å¿—æˆ–åˆ†ææ•°æ®</li><li>å®šæœŸå°†åº”ç”¨æ•°æ®ä¸æœåŠ¡å™¨åŒæ­¥</li></ul><h3 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h3><p>ç›¸å…³ç±»ï¼š</p><ul><li><p>Worker<br> ä»»åŠ¡çš„æ‰§è¡Œè€…ï¼Œæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œéœ€è¦ç»§æ‰¿å®ƒå®ç°è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚</p></li><li><p>WorkRequest<br> æŒ‡å®šè®©å“ªä¸ª Woker æ‰§è¡Œä»»åŠ¡ï¼ŒæŒ‡å®šæ‰§è¡Œçš„ç¯å¢ƒï¼Œæ‰§è¡Œçš„é¡ºåºç­‰ã€‚<br> è¦ä½¿ç”¨å®ƒçš„å­ç±» OneTimeWorkRequest æˆ– PeriodicWorkRequestã€‚</p></li><li><p>WorkManager<br> ç®¡ç†ä»»åŠ¡è¯·æ±‚å’Œä»»åŠ¡é˜Ÿåˆ—ï¼Œå‘èµ·çš„ WorkRequest ä¼šè¿›å…¥å®ƒçš„ä»»åŠ¡é˜Ÿåˆ—ã€‚</p></li><li><p>WorkStatus<br> åŒ…å«æœ‰ä»»åŠ¡çš„çŠ¶æ€å’Œä»»åŠ¡çš„ä¿¡æ¯ï¼Œä»¥ LiveData çš„å½¢å¼æä¾›ç»™è§‚å¯Ÿè€…ã€‚</p></li></ul><h3 id="å…¥é—¨æŒ‡å—"><a href="#å…¥é—¨æŒ‡å—" class="headerlink" title="å…¥é—¨æŒ‡å—"></a>å…¥é—¨æŒ‡å—</h3><h4 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h4><p><code>implementation &quot;androidx.work:work-runtime:2.3.2&quot;</code></p><h4 id="åˆ›å»ºåå°ä»»åŠ¡"><a href="#åˆ›å»ºåå°ä»»åŠ¡" class="headerlink" title="åˆ›å»ºåå°ä»»åŠ¡"></a>åˆ›å»ºåå°ä»»åŠ¡</h4><p>åˆ›å»ºä¸€ä¸ªç±»ï¼Œç»§æ‰¿è‡ª<code>androidx.work.Worker</code>ï¼Œå¹¶è¦†å†™å…¶<code>public Result doWork()</code>æ–¹æ³•ï¼Œä» <code>doWork()</code> è¿”å›çš„ <code>Result</code>ä¼šé€šçŸ¥ WorkManager ä»»åŠ¡æ˜¯å¦ï¼š</p><ul><li>å·²æˆåŠŸå®Œæˆï¼š<code>Result.success()</code></li><li>å·²å¤±è´¥ï¼š<code>Result.failure()</code></li><li>éœ€è¦ç¨åé‡è¯•ï¼š<code>Result.retry()</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UploadWorker</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Worker</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UploadWorker</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Context context, <span class="hljs-meta">@NonNull</span> WorkerParameters workerParams)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context, workerParams);<br>    &#125;<br><br>    <span class="hljs-meta">@NonNull</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">doWork</span><span class="hljs-params">()</span> &#123;<br>        Log.e(<span class="hljs-string">&quot;UploadWorker input&quot;</span>,getInputData().getString(<span class="hljs-string">&quot;time&quot;</span>));<br><span class="hljs-comment">//do something</span><br>      <span class="hljs-keyword">return</span> Result.success();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="é…ç½®è¿è¡Œä»»åŠ¡çš„æ–¹å¼å’Œæ—¶é—´"><a href="#é…ç½®è¿è¡Œä»»åŠ¡çš„æ–¹å¼å’Œæ—¶é—´" class="headerlink" title="é…ç½®è¿è¡Œä»»åŠ¡çš„æ–¹å¼å’Œæ—¶é—´"></a>é…ç½®è¿è¡Œä»»åŠ¡çš„æ–¹å¼å’Œæ—¶é—´</h4><p><code>Worker</code> å®šä¹‰å·¥ä½œå•å…ƒï¼Œ<a href="https://developer.android.com/reference/androidx/work/WorkRequest?hl=zh-cn"><code>WorkRequest</code></a> åˆ™å®šä¹‰å·¥ä½œçš„è¿è¡Œæ–¹å¼å’Œæ—¶é—´ã€‚ä»»åŠ¡å¯ä»¥æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å‘¨æœŸæ€§çš„ã€‚å¯¹äºä¸€æ¬¡æ€§ <code>WorkRequest</code>ï¼Œè¯·ä½¿ç”¨ <a href="https://developer.android.com/reference/androidx/work/OneTimeWorkRequest?hl=zh-cn"><code>OneTimeWorkRequest</code></a>ï¼Œå¯¹äºå‘¨æœŸæ€§å·¥ä½œï¼Œè¯·ä½¿ç”¨ <a href="https://developer.android.com/reference/androidx/work/PeriodicWorkRequest?hl=zh-cn"><code>PeriodicWorkRequest</code></a>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">OneTimeWorkRequest</span> <span class="hljs-variable">uploadWorkRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OneTimeWorkRequest</span>.Builder(UploadWorker.class)<br>            .build()<br>    <br></code></pre></td></tr></table></figure><h4 id="å°†ä»»åŠ¡æäº¤ç»™ç³»ç»Ÿ"><a href="#å°†ä»»åŠ¡æäº¤ç»™ç³»ç»Ÿ" class="headerlink" title="å°†ä»»åŠ¡æäº¤ç»™ç³»ç»Ÿ"></a>å°†ä»»åŠ¡æäº¤ç»™ç³»ç»Ÿ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">WorkManager.getInstance(myContext).enqueue(uploadWorkRequest);<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œ Worker çš„ç¡®åˆ‡æ—¶é—´å–å†³äº <code>WorkRequest</code> ä¸­ä½¿ç”¨çš„çº¦æŸä»¥åŠç³»ç»Ÿä¼˜åŒ–ã€‚</p><h3 id="å®šä¹‰å·¥ä½œè¯·æ±‚"><a href="#å®šä¹‰å·¥ä½œè¯·æ±‚" class="headerlink" title="å®šä¹‰å·¥ä½œè¯·æ±‚"></a>å®šä¹‰å·¥ä½œè¯·æ±‚</h3><h4 id="å·¥ä½œçº¦æŸ"><a href="#å·¥ä½œçº¦æŸ" class="headerlink" title="å·¥ä½œçº¦æŸ"></a>å·¥ä½œçº¦æŸ</h4><p>å¯ä»¥å‘å·¥ä½œæ·»åŠ  <code>Constraints</code>ï¼Œä»¥æŒ‡æ˜å·¥ä½œä½•æ—¶å¯ä»¥è¿è¡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">Constraints constraints=    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Constraints</span>.Builder()<br>  .setRequiredNetworkType(NetworkType.CONNECTED)  <span class="hljs-comment">// ç½‘ç»œçŠ¶æ€</span><br>  .setRequiresBatteryNotLow(<span class="hljs-literal">true</span>)                 <span class="hljs-comment">// ä¸åœ¨ç”µé‡ä¸è¶³æ—¶æ‰§è¡Œ</span><br>  .setRequiresCharging(<span class="hljs-literal">true</span>)                      <span class="hljs-comment">// åœ¨å……ç”µæ—¶æ‰§è¡Œ</span><br>  .setRequiresStorageNotLow(<span class="hljs-literal">true</span>)                 <span class="hljs-comment">// ä¸åœ¨å­˜å‚¨å®¹é‡ä¸è¶³æ—¶æ‰§è¡Œ</span><br>  <span class="hljs-comment">//.setRequiresDeviceIdle(true)                    // åœ¨å¾…æœºçŠ¶æ€ä¸‹æ‰§è¡Œï¼Œéœ€è¦ API 23</span><br>  .build();<br><span class="hljs-type">OneTimeWorkRequest</span> <span class="hljs-variable">compressionWork</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OneTimeWorkRequest</span>.Builder(UploadWorker.class)<br>  .setConstraints(constraints)<br>  .build();<br></code></pre></td></tr></table></figure><p>å¦‚æœæŒ‡å®šäº†å¤šä¸ªçº¦æŸï¼Œä»»åŠ¡å°†ä»…åœ¨æ»¡è¶³æ‰€æœ‰çº¦æŸæ—¶æ‰ä¼šè¿è¡Œã€‚</p><p>å¦‚æœåœ¨ä»»åŠ¡è¿è¡ŒæœŸé—´æŸä¸ªçº¦æŸä¸å†å¾—åˆ°æ»¡è¶³ï¼Œåˆ™ WorkManager å°†åœæ­¢å·¥ä½œå™¨ã€‚å½“çº¦æŸç»§ç»­å¾—åˆ°æ»¡è¶³æ—¶ï¼Œç³»ç»Ÿå°†é‡æ–°å°è¯•æ‰§è¡Œè¯¥ä»»åŠ¡ã€‚</p><h4 id="åˆå§‹å»¶è¿Ÿ"><a href="#åˆå§‹å»¶è¿Ÿ" class="headerlink" title="åˆå§‹å»¶è¿Ÿ"></a>åˆå§‹å»¶è¿Ÿ</h4><p>å¦‚æœWorkeræ²¡æœ‰çº¦æŸï¼Œæˆ–è€…å·¥ä½œåŠ å…¥é˜Ÿåˆ—æ—¶æ‰€æœ‰çº¦æŸå‡å·²å¾—åˆ°æ»¡è¶³ï¼Œåˆ™ç³»ç»Ÿå¯èƒ½ä¼šé€‰æ‹©ç«‹å³è¿è¡Œä»»åŠ¡ã€‚å¦‚æœä¸å¸Œæœ›ä»»åŠ¡ç«‹å³è¿è¡Œï¼Œåˆ™å¯ä»¥å°†å·¥ä½œæŒ‡å®šä¸ºåœ¨ç»è¿‡æœ€çŸ­çš„åˆå§‹å»¶è¿Ÿåå¯åŠ¨ã€‚</p><p>ä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å°†ä»»åŠ¡è®¾ç½®ä¸ºåœ¨åŠ å…¥é˜Ÿåˆ—åè‡³å°‘ç»è¿‡ 10 åˆ†é’Ÿå†è¿è¡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">OneTimeWorkRequest</span> <span class="hljs-variable">uploadWorkRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OneTimeWorkRequest</span>.Builder(UploadWorker.class)<br>  .setInitialDelay(<span class="hljs-number">10</span>, TimeUnit.MINUTES)<br>  .build();<br></code></pre></td></tr></table></figure><h4 id="é‡è¯•å’Œé€€é¿æ”¿ç­–"><a href="#é‡è¯•å’Œé€€é¿æ”¿ç­–" class="headerlink" title="é‡è¯•å’Œé€€é¿æ”¿ç­–"></a>é‡è¯•å’Œé€€é¿æ”¿ç­–</h4><p>å¦‚æœéœ€è¦è®© WorkManager é‡æ–°å°è¯•æ‰§è¡Œä»»åŠ¡ï¼Œå¯ä»¥ä»å·¥ä½œå™¨è¿”å› <a href="https://developer.android.com/reference/androidx/work/ListenableWorker.Result?hl=zh-cn#retry()"><code>Result.retry()</code></a>ã€‚</p><p>ç„¶åï¼Œç³»ç»Ÿä¼šæ ¹æ®é»˜è®¤çš„é€€é¿å»¶è¿Ÿæ—¶é—´å’Œæ”¿ç­–é‡æ–°è°ƒåº¦å·¥ä½œã€‚é€€é¿å»¶è¿Ÿæ—¶é—´æŒ‡å®šé‡è¯•å·¥ä½œå‰çš„æœ€çŸ­ç­‰å¾…æ—¶é—´ã€‚<a href="https://developer.android.com/reference/androidx/work/BackoffPolicy?hl=zh-cn">é€€é¿æ”¿ç­–</a>å®šä¹‰äº†åœ¨åç»­é‡è¯•çš„å°è¯•è¿‡ç¨‹ä¸­ï¼Œé€€é¿å»¶è¿Ÿæ—¶é—´éšæ—¶é—´ä»¥æ€æ ·çš„æ–¹å¼å¢é•¿ï¼›é»˜è®¤æƒ…å†µä¸‹æŒ‰ <a href="https://developer.android.com/reference/androidx/work/BackoffPolicy?hl=zh-cn"><code>EXPONENTIAL</code></a> å»¶é•¿ã€‚</p><p>ä»¥ä¸‹æ˜¯è‡ªå®šä¹‰é€€é¿å»¶è¿Ÿæ—¶é—´å’Œæ”¿ç­–çš„ç¤ºä¾‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">OneTimeWorkRequest</span> <span class="hljs-variable">uploadWorkRequest</span> <span class="hljs-operator">=</span><br>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">OneTimeWorkRequest</span>.Builder(UploadWorker.class)<br>  .setBackoffCriteria(BackoffPolicy.LINEAR,<br>  OneTimeWorkRequest.MIN_BACKOFF_MILLIS,<br>  TimeUnit.MILLISECONDS)<br>  .build();<br></code></pre></td></tr></table></figure><h4 id="å®šä¹‰ä»»åŠ¡çš„è¾“å…¥-x2F-è¾“å‡º"><a href="#å®šä¹‰ä»»åŠ¡çš„è¾“å…¥-x2F-è¾“å‡º" class="headerlink" title="å®šä¹‰ä»»åŠ¡çš„è¾“å…¥&#x2F;è¾“å‡º"></a>å®šä¹‰ä»»åŠ¡çš„è¾“å…¥&#x2F;è¾“å‡º</h4><p>å¯ä»¥é€šè¿‡ä½¿ç”¨<code>androidx.work.Data</code>æ¥å®šä¹‰è¾“å…¥æˆ–è€…è¾“å‡º</p><p>åœ¨<code>UploadWorker</code>ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">doWork</span><span class="hljs-params">()</span> &#123;<br>  Log.e(<span class="hljs-string">&quot;UploadWorker input&quot;</span>,getInputData().getString(<span class="hljs-string">&quot;time&quot;</span>));<br>  <span class="hljs-type">Data</span> <span class="hljs-variable">outputData</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Data</span>.Builder()<br>    .putLong(<span class="hljs-string">&quot;timestamp&quot;</span>,System.currentTimeMillis())<br>    .build();<br>  <span class="hljs-keyword">return</span> Result.success(outputData); <br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è°ƒç”¨æ—¶ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Data</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Data</span>.Builder()<br>  .putString(<span class="hljs-string">&quot;time&quot;</span>,simpleDateFormat.format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()))<br>  .build();<br><br><span class="hljs-type">OneTimeWorkRequest</span> <span class="hljs-variable">uploadWorkRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OneTimeWorkRequest</span>.Builder(UploadWorker.class)<br>  .setConstraints(constraints)<br>  .setInputData(data) <span class="hljs-comment">//å®šä¹‰è¾“å…¥</span><br>  .build();<br>WorkManager.getInstance(<span class="hljs-built_in">this</span>).enqueue(uploadWorkRequest);<br>        WorkManager.getInstance(<span class="hljs-built_in">this</span>).getWorkInfoByIdLiveData(uploadWorkRequest.getId()).observe(<span class="hljs-built_in">this</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>&lt;WorkInfo&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onChanged</span><span class="hljs-params">(WorkInfo workInfo)</span> &#123;<br><br>                 <span class="hljs-type">long</span> <span class="hljs-variable">timeStamp</span> <span class="hljs-operator">=</span> workInfo.getOutputData().getLong(<span class="hljs-string">&quot;timestamp&quot;</span>,<span class="hljs-number">0</span>);<br>                Log.e(<span class="hljs-string">&quot;UploadWorker output&quot;</span>,simpleDateFormat.format(timeStamp) +<span class="hljs-string">&quot;---&gt;&quot;</span>+workInfo.getState());<br>            &#125;<br>        &#125;);<br></code></pre></td></tr></table></figure><p>éå¸¸é‡è¦çš„ä¸€ç‚¹ï¼š</p><p><strong>æŒ‰ç…§è®¾è®¡ï¼Œ<code>Data</code> å¯¹è±¡åº”è¯¥å¾ˆå°ï¼Œå€¼å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€åŸºå…ƒç±»å‹æˆ–æ•°ç»„å˜ä½“ã€‚å¦‚æœéœ€è¦å°†æ›´å¤šæ•°æ®ä¼ å…¥å’Œä¼ å‡ºå·¥ä½œå™¨ï¼Œåº”è¯¥å°†æ•°æ®æ”¾åœ¨å…¶ä»–ä½ç½®ï¼Œä¾‹å¦‚ Room æ•°æ®åº“ã€‚Data å¯¹è±¡çš„å¤§å°ä¸Šé™ä¸º 10KBã€‚</strong></p><h4 id="æ ‡è®°å·¥ä½œ"><a href="#æ ‡è®°å·¥ä½œ" class="headerlink" title="æ ‡è®°å·¥ä½œ"></a>æ ‡è®°å·¥ä½œ</h4><p>å¯ä»¥é€šè¿‡ä¸ºä»»æ„ <a href="https://developer.android.com/reference/androidx/work/WorkRequest?hl=zh-cn"><code>WorkRequest</code></a> å¯¹è±¡åˆ†é…æ ‡è®°å­—ç¬¦ä¸²ï¼ŒæŒ‰é€»è¾‘å¯¹ä»»åŠ¡è¿›è¡Œåˆ†ç»„ã€‚è¿™æ ·å°±å¯ä»¥å¯¹ä½¿ç”¨ç‰¹å®šæ ‡è®°çš„æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œæ“ä½œã€‚</p><p>ä¾‹å¦‚ï¼Œ<a href="https://developer.android.com/reference/androidx/work/WorkManager?hl=zh-cn#cancelAllWorkByTag(java.lang.String)"><code>WorkManager.cancelAllWorkByTag(String)</code></a> ä¼šå–æ¶ˆä½¿ç”¨ç‰¹å®šæ ‡è®°çš„æ‰€æœ‰ä»»åŠ¡ï¼Œè€Œ <a href="https://developer.android.com/reference/androidx/work/WorkManager?hl=zh-cn#getWorkInfosByTagLiveData(java.lang.String)"><code>WorkManager.getWorkInfosByTagLiveData(String)</code></a> ä¼šè¿”å› <a href="https://developer.android.com/reference/androidx/lifecycle/LiveData?hl=zh-cn"><code>LiveData</code></a> å’Œå…·æœ‰è¯¥æ ‡è®°çš„æ‰€æœ‰ä»»åŠ¡çš„çŠ¶æ€åˆ—è¡¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">OneTimeWorkRequest</span> <span class="hljs-variable">cacheCleanupTask</span> <span class="hljs-operator">=</span><br>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">OneTimeWorkRequest</span>.Builder(CacheCleanupWorker.class)<br>  .setConstraints(constraints)<br>  .addTag(<span class="hljs-string">&quot;cleanup&quot;</span>)<br>  .build();<br></code></pre></td></tr></table></figure><h4 id="å·¥ä½œçŠ¶æ€"><a href="#å·¥ä½œçŠ¶æ€" class="headerlink" title="å·¥ä½œçŠ¶æ€"></a>å·¥ä½œçŠ¶æ€</h4><ul><li>å¦‚æœæœ‰å°šæœªå®Œæˆçš„<a href="https://developer.android.com/topic/libraries/architecture/workmanager/how-to/chain-work?hl=zh-cn">å‰ææ€§å·¥ä½œ</a>ï¼Œåˆ™å·¥ä½œå¤„äº <a href="https://developer.android.com/reference/androidx/work/WorkInfo.State?hl=zh-cn#BLOCKED"><code>BLOCKED</code></a> <code>State</code>ã€‚</li><li>å¦‚æœå·¥ä½œèƒ½å¤Ÿåœ¨æ»¡è¶³ <a href="https://developer.android.com/reference/androidx/work/Constraints?hl=zh-cn"><code>Constraints</code></a> å’Œæ—¶æœºæ¡ä»¶åç«‹å³è¿è¡Œï¼Œåˆ™è¢«è§†ä¸ºå¤„äº <a href="https://developer.android.com/reference/androidx/work/WorkInfo.State?hl=zh-cn#ENQUEUED"><code>ENQUEUED</code></a> çŠ¶æ€ã€‚</li><li>å½“å·¥ä½œå™¨åœ¨æ´»è·ƒåœ°æ‰§è¡Œæ—¶ï¼Œå…¶å¤„äº <a href="https://developer.android.com/reference/androidx/work/WorkInfo.State?hl=zh-cn#RUNNING"><code>RUNNING</code></a> <code>State</code>ã€‚</li><li>å¦‚æœå·¥ä½œå™¨è¿”å› <a href="https://developer.android.com/reference/androidx/work/ListenableWorker.Result?hl=zh-cn#success()"><code>Result.success()</code></a>ï¼Œåˆ™è¢«è§†ä¸ºå¤„äº <a href="https://developer.android.com/reference/androidx/work/WorkInfo.State?hl=zh-cn#SUCCEEDED"><code>SUCCEEDED</code></a> çŠ¶æ€ã€‚è¿™æ˜¯ä¸€ç§ç»ˆæ­¢ <code>State</code>ï¼›åªæœ‰ <a href="https://developer.android.com/reference/androidx/work/OneTimeWorkRequest?hl=zh-cn"><code>OneTimeWorkRequest</code></a> å¯ä»¥è¿›å…¥è¿™ç§ <code>State</code>ã€‚</li><li>ç›¸åï¼Œå¦‚æœå·¥ä½œå™¨è¿”å› <a href="https://developer.android.com/reference/androidx/work/ListenableWorker.Result?hl=zh-cn#failure()"><code>Result.failure()</code></a>ï¼Œåˆ™è¢«è§†ä¸ºå¤„äº <a href="https://developer.android.com/reference/androidx/work/WorkInfo.State?hl=zh-cn#FAILED"><code>FAILED</code></a> çŠ¶æ€ã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªç»ˆæ­¢ <code>State</code>ï¼›åªæœ‰ <a href="https://developer.android.com/reference/androidx/work/OneTimeWorkRequest?hl=zh-cn"><code>OneTimeWorkRequest</code></a> å¯ä»¥è¿›å…¥è¿™ç§ <code>State</code>ã€‚æ‰€æœ‰ä¾èµ–å·¥ä½œä¹Ÿä¼šè¢«æ ‡è®°ä¸º <code>FAILED</code>ï¼Œå¹¶ä¸”ä¸ä¼šè¿è¡Œã€‚</li><li>å½“æ˜ç¡®<a href="https://developer.android.com/topic/libraries/architecture/workmanager/how-to/cancel-stop-work?hl=zh-cn">å–æ¶ˆ</a>å°šæœªç»ˆæ­¢çš„ <code>WorkRequest</code> æ—¶ï¼Œå®ƒä¼šè¿›å…¥ <a href="https://developer.android.com/reference/androidx/work/WorkInfo.State?hl=zh-cn#CANCELLED"><code>CANCELLED</code></a> <code>State</code>ã€‚æ‰€æœ‰ä¾èµ–å·¥ä½œä¹Ÿä¼šè¢«æ ‡è®°ä¸º <code>CANCELLED</code>ï¼Œå¹¶ä¸”ä¸ä¼šè¿è¡Œã€‚</li></ul><h4 id="è§‚å¯Ÿå·¥ä½œ"><a href="#è§‚å¯Ÿå·¥ä½œ" class="headerlink" title="è§‚å¯Ÿå·¥ä½œ"></a>è§‚å¯Ÿå·¥ä½œ</h4><p>å°†å·¥ä½œåŠ å…¥é˜Ÿåˆ—åï¼Œå¯ä»¥é€šè¿‡ WorkManager æ£€æŸ¥å…¶çŠ¶æ€ã€‚ç›¸å…³ä¿¡æ¯åœ¨ <a href="https://developer.android.com/reference/androidx/work/WorkInfo?hl=zh-cn"><code>WorkInfo</code></a> å¯¹è±¡ä¸­æä¾›ï¼ŒåŒ…æ‹¬å·¥ä½œçš„ <code>id</code>ã€æ ‡ç­¾ã€å½“å‰ <a href="https://developer.android.com/reference/androidx/work/WorkInfo.State?hl=zh-cn"><code>State</code></a> å’Œä»»ä½•è¾“å‡ºæ•°æ®ã€‚</p><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹å¼ä¹‹ä¸€æ¥è·å– <code>WorkInfo</code>ï¼š</p><ul><li>å¯¹äºç‰¹å®šçš„ <a href="https://developer.android.com/reference/androidx/work/WorkRequest?hl=zh-cn"><code>WorkRequest</code></a>ï¼Œå¯ä»¥åˆ©ç”¨ <a href="https://developer.android.com/reference/androidx/work/WorkManager?hl=zh-cn#getWorkInfoById(java.util.UUID)"><code>WorkManager.getWorkInfoById(UUID)</code></a> æˆ– <a href="https://developer.android.com/reference/androidx/work/WorkManager?hl=zh-cn#getWorkInfoByIdLiveData(java.util.UUID)"><code>WorkManager.getWorkInfoByIdLiveData(UUID)</code></a> æ¥é€šè¿‡ <code>WorkRequest</code> <code>id</code> æ£€ç´¢å…¶ <code>WorkInfo</code>ã€‚</li><li>å¯¹äºæŒ‡å®šçš„<a href="https://developer.android.com/topic/libraries/architecture/workmanager/how-to/define-work?hl=zh-cn#tag">æ ‡è®°</a>ï¼Œå¯ä»¥åˆ©ç”¨ <a href="https://developer.android.com/reference/androidx/work/WorkManager?hl=zh-cn#getWorkInfosByTag(java.lang.String)"><code>WorkManager.getWorkInfosByTag(String)</code></a> æˆ– <a href="https://developer.android.com/reference/androidx/work/WorkManager?hl=zh-cn#getWorkInfosByTagLiveData(java.lang.String)"><code>WorkManager.getWorkInfosByTagLiveData(String)</code></a> æ£€ç´¢æ‰€æœ‰åŒ¹é…çš„ <code>WorkRequest</code> çš„ <code>WorkInfo</code> å¯¹è±¡ã€‚</li><li>å¯¹äº<a href="https://developer.android.com/topic/libraries/architecture/workmanager/how-to/unique-work?hl=zh-cn">å”¯ä¸€å·¥ä½œåç§°</a>ï¼Œå¯ä»¥åˆ©ç”¨ <a href="https://developer.android.com/reference/androidx/work/WorkManager?hl=zh-cn#getWorkInfosForUniqueWork(java.lang.String)"><code>WorkManager.getWorkInfosForUniqueWork(String)</code></a> æˆ– <a href="https://developer.android.com/reference/androidx/work/WorkManager?hl=zh-cn#getWorkInfosForUniqueWorkLiveData(java.lang.String)"><code>WorkManager.getWorkInfosForUniqueWorkLiveData(String)</code></a> æ£€ç´¢æ‰€æœ‰åŒ¹é…çš„ <code>WorkRequest</code> çš„ <code>WorkInfo</code> å¯¹è±¡ã€‚</li></ul><p>åˆ©ç”¨æ¯ä¸ªæ–¹æ³•çš„ <a href="https://developer.android.com/topic/libraries/architecture/livedata?hl=zh-cn"><code>LiveData</code></a> å˜é‡ï¼Œå¯ä»¥é€šè¿‡æ³¨å†Œç›‘å¬å™¨æ¥è§‚å¯Ÿ <code>WorkInfo</code> çš„å˜åŒ–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">WorkManager.getInstance(myContext).getWorkInfoByIdLiveData(uploadWorkRequest.getId())<br>  .observe(lifecycleOwner, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>&lt;WorkInfo&gt;() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onChanged</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> WorkInfo workInfo)</span> &#123;<br>      <span class="hljs-keyword">if</span> (workInfo != <span class="hljs-literal">null</span> &amp;&amp; workInfo.state == WorkInfo.State.SUCCEEDED) &#123;<br>        displayMessage(<span class="hljs-string">&quot;Work finished!&quot;</span>)<br>      &#125;<br>    &#125;<br>  &#125;);<br></code></pre></td></tr></table></figure><h4 id="æ›´æ–°è¿›åº¦"><a href="#æ›´æ–°è¿›åº¦" class="headerlink" title="æ›´æ–°è¿›åº¦"></a>æ›´æ–°è¿›åº¦</h4><p>å¯¹äºä½¿ç”¨ <a href="https://developer.android.com/reference/androidx/work/ListenableWorker?hl=zh-cn"><code>ListenableWorker</code></a> æˆ– <a href="https://developer.android.com/reference/androidx/work/Worker?hl=zh-cn"><code>Worker</code></a> çš„ Java å¼€å‘è€…ï¼Œ<a href="https://developer.android.com/reference/androidx/work/ListenableWorker?hl=zh-cn#setProgressAsync(androidx.work.Data)"><code>setProgressAsync()</code></a> API ä¼šè¿”å› <code>ListenableFuture</code>ï¼›æ›´æ–°è¿›åº¦æ˜¯å¼‚æ­¥è¿‡ç¨‹ï¼Œå› ä¸ºæ›´æ–°è¿‡ç¨‹åŒ…æ‹¬å°†è¿›åº¦ä¿¡æ¯å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚</p><p>æ­¤ç¤ºä¾‹å±•ç¤ºäº†ä¸€ä¸ªç®€å•çš„ <code>ProgressWorker</code>ã€‚è¯¥ <code>Worker</code> å¯åŠ¨æ—¶å°†è¿›åº¦è®¾ç½®ä¸º 0ï¼Œå®Œæˆæ—¶å°†è¿›åº¦å€¼æ›´æ–°ä¸º 100ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProgressWorker</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Worker</span> &#123;<br><br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PROGRESS</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;PROGRESS&quot;</span>;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">DELAY</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000L</span>;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">ProgressWorker</span><span class="hljs-params">(</span><br><span class="hljs-params">    <span class="hljs-meta">@NonNull</span> Context context,</span><br><span class="hljs-params">    <span class="hljs-meta">@NonNull</span> WorkerParameters parameters)</span> &#123;<br>    <span class="hljs-built_in">super</span>(context, parameters);<br>    <span class="hljs-comment">// Set initial progress to 0</span><br>    setProgressAsync(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Data</span>.Builder().putInt(PROGRESS, <span class="hljs-number">0</span>).build());<br>  &#125;<br><br>  <span class="hljs-meta">@NonNull</span><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">doWork</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-comment">// Doing work.</span><br>      Thread.sleep(DELAY);<br>    &#125; <span class="hljs-keyword">catch</span> (InterruptedException exception) &#123;<br>      <span class="hljs-comment">// ... handle exception</span><br>    &#125;<br>    <span class="hljs-comment">// Set progress to 100 after you are done doing your work.</span><br>    setProgressAsync(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Data</span>.Builder().putInt(PROGRESS, <span class="hljs-number">100</span>).build());<br>    <span class="hljs-keyword">return</span> Result.success();<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="è§‚å¯Ÿè¿›åº¦"><a href="#è§‚å¯Ÿè¿›åº¦" class="headerlink" title="è§‚å¯Ÿè¿›åº¦"></a>è§‚å¯Ÿè¿›åº¦</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">WorkManager.getInstance(getApplicationContext())<br>  .getWorkInfoByIdLiveData(uploadWorkRequest.getId())<br>  .observe(lifecycleOwner, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>&lt;WorkInfo&gt;() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onChanged</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> WorkInfo workInfo)</span> &#123;<br>      <span class="hljs-keyword">if</span> (workInfo != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-type">Data</span> <span class="hljs-variable">progress</span> <span class="hljs-operator">=</span> workInfo.getProgress();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> progress.getInt(PROGRESS, <span class="hljs-number">0</span>)<br>          <span class="hljs-comment">// Do something with progress</span><br>      &#125;<br>    &#125;<br>  &#125;);<br>    <br></code></pre></td></tr></table></figure><h3 id="é“¾æ¥å·¥ä½œ"><a href="#é“¾æ¥å·¥ä½œ" class="headerlink" title="é“¾æ¥å·¥ä½œ"></a>é“¾æ¥å·¥ä½œ</h3><p>å°±åƒåŠ¨ç”»çš„æ‰§è¡Œå¯ä»¥ç¡®å®šé¡ºåºã€ä¾èµ–ä¸€æ ·ï¼ŒWorkerçš„æ‰§è¡Œä¹Ÿå¯ä»¥è¿™ä¹ˆæ“ä½œ</p><p>å¯ä»¥ä½¿ç”¨ <a href="https://developer.android.com/reference/androidx/work/WorkManager?hl=zh-cn">WorkManager</a> åˆ›å»ºå·¥ä½œé“¾å¹¶ä¸ºå…¶æ’é˜Ÿã€‚å·¥ä½œé“¾ç”¨äºæŒ‡å®šå¤šä¸ªå…³è”ä»»åŠ¡å¹¶å®šä¹‰è¿™äº›ä»»åŠ¡çš„è¿è¡Œé¡ºåºã€‚å½“éœ€è¦ä»¥ç‰¹å®šçš„é¡ºåºè¿è¡Œå¤šä¸ªä»»åŠ¡æ—¶ï¼Œè¿™å°¤å…¶æœ‰ç”¨ã€‚</p><p>è¦åˆ›å»ºå·¥ä½œé“¾ï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://developer.android.com/reference/androidx/work/WorkManager?hl=zh-cn#beginWith(androidx.work.OneTimeWorkRequest)"><code>WorkManager.beginWith(OneTimeWorkRequest)</code></a> æˆ– <a href="https://developer.android.com/reference/androidx/work/WorkManager?hl=zh-cn#beginWith(java.util.List)"><code>WorkManager.beginWith(List)</code></a>ï¼Œè¿™ä¼šè¿”å› <a href="https://developer.android.com/reference/androidx/work/WorkContinuation?hl=zh-cn"><code>WorkContinuation</code></a> å®ä¾‹ã€‚</p><p>ç„¶åï¼Œå¯ä»¥é€šè¿‡ <code>WorkContinuation</code> ä½¿ç”¨ <a href="https://developer.android.com/reference/androidx/work/WorkContinuation?hl=zh-cn#then(androidx.work.OneTimeWorkRequest)"><code>WorkContinuation.then(OneTimeWorkRequest)</code></a> æˆ– <a href="https://developer.android.com/reference/androidx/work/WorkContinuation?hl=zh-cn#then(java.util.List)"><code>WorkContinuation.then(List)</code></a> æ¥æ·»åŠ ä»å± <code>OneTimeWorkRequest</code>ã€‚</p><p>æ¯æ¬¡è°ƒç”¨ <code>WorkContinuation.then(...)</code> éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ <code>WorkContinuation</code> å®ä¾‹ã€‚å¦‚æœæ·»åŠ äº† <code>OneTimeWorkRequest</code> çš„ <code>List</code>ï¼Œè¿™äº›è¯·æ±‚å¯èƒ½ä¼šå¹¶è¡Œè¿è¡Œã€‚</p><p>æœ€åï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://developer.android.com/reference/androidx/work/WorkContinuation?hl=zh-cn#enqueue()"><code>WorkContinuation.enqueue()</code></a> æ–¹æ³•ä¸º <code>WorkContinuation</code> é“¾æ’é˜Ÿã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">WorkManager.getInstance(myContext)<br>  .beginWith(Arrays.asList(filter1, filter2, filter3)) <br>  .then(compress)<br>  .then(upload)<br>  .enqueue();<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„filteræ˜¯OneTimeWorkRequestå®ä¾‹å¯¹è±¡</p><h4 id="Input-Merger"><a href="#Input-Merger" class="headerlink" title="Input Merger"></a>Input Merger</h4><p>åœ¨ä½¿ç”¨ <code>OneTimeWorkRequest</code> é“¾æ—¶ï¼Œçˆ¶çº§ <code>OneTimeWorkRequest</code> çš„è¾“å‡ºå°†ä½œä¸ºè¾“å…¥ä¼ é€’ç»™å­çº§ã€‚å› æ­¤åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>filter1</code>ã€<code>filter2</code> å’Œ <code>filter3</code> çš„è¾“å‡ºå°†ä½œä¸ºè¾“å…¥ä¼ é€’ç»™ <code>compress</code> è¯·æ±‚ã€‚</p><p>ä¸ºäº†ç®¡ç†æ¥è‡ªå¤šä¸ªçˆ¶çº§ <code>OneTimeWorkRequest</code> çš„è¾“å…¥ï¼ŒWorkManager ä½¿ç”¨ <a href="https://developer.android.com/reference/androidx/work/InputMerger?hl=zh-cn"><code>InputMerger</code></a>ã€‚</p><p>WorkManager æä¾›ä¸¤ç§ä¸åŒç±»å‹çš„ <code>InputMerger</code>ï¼š</p><ul><li><a href="https://developer.android.com/reference/androidx/work/OverwritingInputMerger?hl=zh-cn"><code>OverwritingInputMerger</code></a> ä¼šå°è¯•å°†æ‰€æœ‰è¾“å…¥ä¸­çš„æ‰€æœ‰é”®æ·»åŠ åˆ°è¾“å‡ºä¸­ã€‚å¦‚æœå‘ç”Ÿå†²çªï¼Œå®ƒä¼šè¦†ç›–å…ˆå‰è®¾ç½®çš„é”®ã€‚</li><li><a href="https://developer.android.com/reference/androidx/work/ArrayCreatingInputMerger?hl=zh-cn"><code>ArrayCreatingInputMerger</code></a> ä¼šå°è¯•åˆå¹¶è¾“å…¥ï¼Œå¹¶åœ¨å¿…è¦æ—¶åˆ›å»ºæ•°ç»„ã€‚</li></ul><p>å¯¹äºä¸Šé¢çš„ç¤ºä¾‹ï¼Œå‡è®¾æˆ‘ä»¬è¦ä¿ç•™æ‰€æœ‰å›¾åƒæ»¤é•œçš„è¾“å‡ºï¼Œåˆ™åº”ä½¿ç”¨ <code>ArrayCreatingInputMerger</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">OneTimeWorkRequest</span> <span class="hljs-variable">compress</span> <span class="hljs-operator">=</span><br>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">OneTimeWorkRequest</span>.Builder(CompressWorker.class)<br>  .setInputMerger(ArrayCreatingInputMerger.class)<br>  .setConstraints(constraints)<br>  .build();<br></code></pre></td></tr></table></figure><h4 id="é“¾æ¥å’Œå·¥ä½œçŠ¶æ€"><a href="#é“¾æ¥å’Œå·¥ä½œçŠ¶æ€" class="headerlink" title="é“¾æ¥å’Œå·¥ä½œçŠ¶æ€"></a>é“¾æ¥å’Œå·¥ä½œçŠ¶æ€</h4><p>åˆ›å»º <code>OneTimeWorkRequest</code> é“¾æ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>ä»å± <code>OneTimeWorkRequest</code> ä»…åœ¨å…¶æ‰€æœ‰çˆ¶çº§ <code>OneTimeWorkRequest</code> éƒ½æˆåŠŸå®Œæˆï¼ˆå³è¿”å› <code>Result.success()</code>ï¼‰æ—¶æ‰ä¼šè¢«è§£é™¤é˜»å¡ï¼ˆå˜ä¸º <code>ENQUEUED</code> çŠ¶æ€ï¼‰ã€‚</li><li>å¦‚æœæœ‰ä»»ä½•çˆ¶çº§ <code>OneTimeWorkRequest</code> å¤±è´¥ï¼ˆè¿”å› <code>Result.failure()</code>ï¼‰ï¼Œåˆ™æ‰€æœ‰ä»å± <code>OneTimeWorkRequest</code> ä¹Ÿä¼šè¢«æ ‡è®°ä¸º <code>FAILED</code>ã€‚</li><li>å¦‚æœæœ‰ä»»ä½•çˆ¶çº§ <code>OneTimeWorkRequest</code> è¢«å–æ¶ˆï¼Œåˆ™æ‰€æœ‰ä»å± <code>OneTimeWorkRequest</code> ä¹Ÿä¼šè¢«æ ‡è®°ä¸º <code>CANCELLED</code></li></ul><h3 id="å–æ¶ˆå’Œåœæ­¢å·¥ä½œ"><a href="#å–æ¶ˆå’Œåœæ­¢å·¥ä½œ" class="headerlink" title="å–æ¶ˆå’Œåœæ­¢å·¥ä½œ"></a>å–æ¶ˆå’Œåœæ­¢å·¥ä½œ</h3><p>å¦‚æœä¸å†éœ€è¦è¿è¡Œå…ˆå‰åŠ å…¥é˜Ÿåˆ—çš„ä½œä¸šï¼Œåˆ™å¯ä»¥ç”³è¯·å–æ¶ˆã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨å…¶ <code>id</code> å¹¶è°ƒç”¨ <a href="https://developer.android.com/reference/androidx/work/WorkManager?hl=zh-cn#cancelWorkById(java.util.UUID)"><code>WorkManager.cancelWorkById(UUID)</code></a> æ¥å–æ¶ˆå•ä¸ª WorkRequestï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">WorkManager.cancelWorkById(workRequest.getId());<br></code></pre></td></tr></table></figure><p>åœ¨åå°ï¼ŒWorkManager ä¼šæ£€æŸ¥å·¥ä½œçš„ <a href="https://developer.android.com/reference/androidx/work/WorkInfo.State?hl=zh-cn"><code>State</code></a>ã€‚å¦‚æœå·¥ä½œå·²ç»<a href="https://developer.android.com/reference/androidx/work/WorkInfo.State?hl=zh-cn#isFinished()">å®Œæˆ</a>ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿä»»ä½•å˜åŒ–ã€‚å¦åˆ™ï¼Œå…¶çŠ¶æ€å°†æ›´æ”¹ä¸º <a href="https://developer.android.com/reference/androidx/work/WorkInfo.State?hl=zh-cn#CANCELLED"><code>CANCELLED</code></a>ï¼Œä¹‹åå°±ä¸ä¼šè¿è¡Œè¿™ä¸ªå·¥ä½œã€‚ä»»ä½•<a href="https://developer.android.com/topic/libraries/architecture/workmanager/how-to/chain-work?hl=zh-cn">ä¾èµ–äºè¿™é¡¹å·¥ä½œ</a>çš„ <a href="https://developer.android.com/reference/androidx/work/WorkRequest?hl=zh-cn"><code>WorkRequests</code></a> çš„çŠ¶æ€ä¹Ÿå°†å˜ä¸º <code>CANCELLED</code>ã€‚</p><p>æ­¤å¤–ï¼Œå¦‚æœå·¥ä½œå½“å‰çš„çŠ¶æ€ä¸º <a href="https://developer.android.com/reference/androidx/work/WorkInfo.State?hl=zh-cn#RUNNING"><code>RUNNING</code></a>ï¼Œåˆ™å·¥ä½œå™¨ä¹Ÿä¼šæ”¶åˆ°å¯¹ <a href="https://developer.android.com/reference/androidx/work/ListenableWorker?hl=zh-cn#onStopped()"><code>ListenableWorker.onStopped()</code></a> çš„è°ƒç”¨ã€‚æ›¿æ¢æ­¤æ–¹æ³•ä»¥å¤„ç†ä»»ä½•å¯èƒ½çš„æ¸…ç†æ“ä½œã€‚</p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <a href="https://developer.android.com/reference/androidx/work/WorkManager?hl=zh-cn#cancelAllWorkByTag(java.lang.String)"><code>WorkManager.cancelAllWorkByTag(String)</code></a> æŒ‰æ ‡è®°å–æ¶ˆ WorkRequestã€‚è¯·æ³¨æ„ï¼Œæ­¤æ–¹æ³•ä¼šå–æ¶ˆæ‰€æœ‰å…·æœ‰æ­¤æ ‡è®°çš„å·¥ä½œã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <a href="https://developer.android.com/reference/androidx/work/WorkManager?hl=zh-cn#cancelUniqueWork(java.lang.String)"><code>WorkManager.cancelUniqueWork(String)</code></a> å–æ¶ˆå…·æœ‰å”¯ä¸€åç§°çš„æ‰€æœ‰å·¥ä½œã€‚</p><h4 id="åœæ­¢æ­£åœ¨è¿è¡Œçš„å·¥ä½œå™¨"><a href="#åœæ­¢æ­£åœ¨è¿è¡Œçš„å·¥ä½œå™¨" class="headerlink" title="åœæ­¢æ­£åœ¨è¿è¡Œçš„å·¥ä½œå™¨"></a>åœæ­¢æ­£åœ¨è¿è¡Œçš„å·¥ä½œå™¨</h4><p>WorkManager åœæ­¢æ­£åœ¨è¿è¡Œçš„å·¥ä½œå™¨å¯èƒ½æœ‰å‡ ç§ä¸åŒçš„åŸå› ï¼š</p><ul><li>æ˜ç¡®è¦æ±‚å–æ¶ˆå®ƒï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡è°ƒç”¨ <code>WorkManager.cancelWorkById(UUID)</code> å–æ¶ˆï¼‰ã€‚</li><li>å¦‚æœæ˜¯<a href="https://developer.android.com/topic/libraries/architecture/workmanager/how-to/unique-work?hl=zh-cn">å”¯ä¸€å·¥ä½œ</a>ï¼Œä½¿ç”¨ <a href="https://developer.android.com/reference/androidx/work/ExistingWorkPolicy?hl=zh-cn"><code>ExistingWorkPolicy</code></a> <a href="https://developer.android.com/topic/libraries/architecture/workmanager/how-to/'reference/androidx/work/ExistingWorkPolicy#REPLACE"><code>REPLACE</code></a> æ˜ç¡®åœ°å°†æ–°çš„ <code>WorkRequest</code> åŠ å…¥é˜Ÿåˆ—ã€‚æ—§çš„ <code>WorkRequest</code> ä¼šç«‹å³è¢«è§†ä¸ºå·²ç»ˆæ­¢ã€‚</li><li>å·¥ä½œçº¦æŸå·²ä¸å†å¾—åˆ°æ»¡è¶³ã€‚</li><li>ç³»ç»Ÿå‡ºäºæŸç§åŸå› æŒ‡ç¤ºæ‚¨çš„åº”ç”¨åœæ­¢å·¥ä½œã€‚å¦‚æœè¶…è¿‡ 10 åˆ†é’Ÿçš„æ‰§è¡ŒæœŸé™ï¼Œå¯èƒ½ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚ç³»ç»Ÿå°†å·¥ä½œå®‰æ’åœ¨ç¨åé‡è¯•ã€‚</li></ul><p>åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œä¼šæ”¶åˆ°å¯¹ <a href="https://developer.android.com/reference/androidx/work/ListenableWorker?hl=zh-cn#onStopped()"><code>ListenableWorker.onStopped()</code></a> çš„è°ƒç”¨ã€‚å¦‚æœæ“ä½œç³»ç»Ÿå†³å®šå…³é—­åº”ç”¨ï¼Œåº”æ‰§è¡Œæ¸…ç†å·¥ä½œå¹¶ä»¥åä½œæ–¹å¼å®Œæˆå·¥ä½œå™¨ã€‚ä¾‹å¦‚ï¼Œåº”è¯¥åœ¨æ­¤æ—¶æˆ–è€…å°½æ—©å…³é—­æ•°æ®åº“å’Œæ–‡ä»¶çš„æ‰“å¼€å¥æŸ„ã€‚æ­¤å¤–ï¼Œå¦‚æœæƒ³è¦ç¡®è®¤ç³»ç»Ÿæ˜¯å¦å·²ç»åœæ­¢ä½ åº”ç”¨ï¼Œéƒ½å¯ä»¥è°ƒç”¨ <a href="https://developer.android.com/reference/androidx/work/ListenableWorker?hl=zh-cn#isStopped()"><code>ListenableWorker.isStopped()</code></a>ã€‚å³ä½¿é€šè¿‡åœ¨è°ƒç”¨ <code>onStopped()</code> åè¿”å› <a href="https://developer.android.com/reference/androidx/work/Result?hl=zh-cn"><code>Result</code></a> æ¥æŒ‡ç¤ºå·¥ä½œå·²å®Œæˆï¼ŒWorkManager éƒ½ä¼šå¿½ç•¥è¯¥ <code>Result</code>ï¼Œå› ä¸ºå·¥ä½œå™¨å·²ç»è¢«è§†ä¸ºåœæ­¢ã€‚</p><h3 id="é‡å¤æ€§å·¥ä½œ"><a href="#é‡å¤æ€§å·¥ä½œ" class="headerlink" title="é‡å¤æ€§å·¥ä½œ"></a>é‡å¤æ€§å·¥ä½œ</h3><p>åº”ç”¨æœ‰æ—¶å¯èƒ½éœ€è¦å®šæœŸè¿è¡ŒæŸäº›ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½è¦å®šæœŸå¤‡ä»½æ•°æ®ã€ä¸‹è½½åº”ç”¨ä¸­çš„æ–°é²œå†…å®¹ï¼Œæˆ–è€…ä¸Šä¼ æ—¥å¿—åˆ°æœåŠ¡å™¨ã€‚ <a href="https://developer.android.com/reference/androidx/work/PeriodicWorkRequest?hl=zh-cn"><code>PeriodicWorkRequest</code></a> ç”¨äºè¿™ç§éœ€è¦å®šæœŸæ‰§è¡Œçš„ä»»åŠ¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯<code>PeriodicWorkRequest</code> æ— æ³•å’Œå…¶ä»–ä»»åŠ¡è¿›è¡Œé“¾æ¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Constraints</span> <span class="hljs-variable">constraints</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Constraints</span>.Builder().setRequiresCharging(<span class="hljs-literal">true</span>).build();<br><br><span class="hljs-type">PeriodicWorkRequest</span> <span class="hljs-variable">saveRequest</span> <span class="hljs-operator">=</span><br>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">PeriodicWorkRequest</span>.Builder(SaveImageFileWorker.class, <span class="hljs-number">1</span>, TimeUnit.HOURS)<br>  .setConstraints(constraints)<br>  .build();<br><br>WorkManager.getInstance(myContext)<br>  .enqueue(saveRequest);<br></code></pre></td></tr></table></figure><h3 id="å”¯ä¸€å·¥ä½œ"><a href="#å”¯ä¸€å·¥ä½œ" class="headerlink" title="å”¯ä¸€å·¥ä½œ"></a>å”¯ä¸€å·¥ä½œ</h3><p>å”¯ä¸€å·¥ä½œæ˜¯ä¸€ä¸ªæ¦‚å¿µæ€§éå¸¸å¼ºçš„æœ¯è¯­ï¼Œå¯ç¡®ä¿ä¸€æ¬¡åªæœ‰ä¸€ä¸ªå…·æœ‰ç‰¹å®šåç§°çš„å·¥ä½œé“¾ã€‚ä¸ <code>id</code> ä¸åŒçš„æ˜¯ï¼Œå”¯ä¸€åç§°æ˜¯äººç±»å¯è¯»çš„ï¼Œç”±å¼€å‘è€…æŒ‡å®šï¼Œè€Œä¸æ˜¯ç”± WorkManager è‡ªåŠ¨ç”Ÿæˆã€‚ä¸<a href="https://developer.android.com/topic/libraries/architecture/workmanager/how-to/define-work?hl=zh-cn#tag">æ ‡è®°</a>ä¸åŒï¼Œå”¯ä¸€åç§°ä»…ä¸â€œä¸€ä¸ªâ€å·¥ä½œé“¾å…³è”ã€‚</p><p>å¯ä»¥é€šè¿‡è°ƒç”¨ [<code>WorkManager.enqueueUniqueWork(String, ExistingWorkPolicy, OneTimeWorkRequest)</code>](<a href="https://developer.android.com/reference/androidx/work/WorkManager?hl=zh-cn#enqueueUniqueWork">https://developer.android.com/reference/androidx/work/WorkManager?hl=zh-cn#enqueueUniqueWork</a>(java.lang.String, androidx.work.ExistingWorkPolicy, androidx.work.OneTimeWorkRequest)) æˆ– [<code>WorkManager.enqueueUniquePeriodicWork(String, ExistingPeriodicWorkPolicy, PeriodicWorkRequest)</code>](<a href="https://developer.android.com/reference/androidx/work/WorkManager?hl=zh-cn#enqueueUniquePeriodicWork">https://developer.android.com/reference/androidx/work/WorkManager?hl=zh-cn#enqueueUniquePeriodicWork</a>(java.lang.String, androidx.work.ExistingPeriodicWorkPolicy, androidx.work.PeriodicWorkRequest)) åˆ›å»ºå”¯ä¸€å·¥ä½œåºåˆ—ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å”¯ä¸€åç§° - è¿™æ˜¯æˆ‘ä»¬ç”¨æ¥æ ‡è¯† <code>WorkRequest</code> çš„é”®ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯å†²çªè§£å†³ç­–ç•¥ï¼Œå®ƒæŒ‡å®šäº†å¦‚æœå·²ç»å­˜åœ¨ä¸€ä¸ªå…·æœ‰è¯¥å”¯ä¸€åç§°çš„æœªå®Œæˆå·¥ä½œé“¾ï¼ŒWorkManager åº”è¯¥å¦‚ä½•å¤„ç†ï¼š</p><ul><li>å–æ¶ˆç°æœ‰å·¥ä½œé“¾ï¼Œå¹¶å°†å…¶ <a href="https://developer.android.com/reference/androidx/work/ExistingWorkPolicy?hl=zh-cn#REPLACE"><code>REPLACE</code></a> ä¸ºæ–°å·¥ä½œé“¾ã€‚</li><li><a href="https://developer.android.com/reference/androidx/work/ExistingWorkPolicy?hl=zh-cn#KEEP"><code>KEEP</code></a> ç°æœ‰åºåˆ—å¹¶å¿½ç•¥æ‚¨çš„æ–°è¯·æ±‚ã€‚</li><li>å°†æ–°åºåˆ— <a href="https://developer.android.com/reference/androidx/work/ExistingWorkPolicy?hl=zh-cn#APPEND"><code>APPEND</code></a> åˆ°ç°æœ‰åºåˆ—ï¼Œåœ¨ç°æœ‰åºåˆ—çš„æœ€åä¸€ä¸ªä»»åŠ¡å®Œæˆåè¿è¡Œæ–°åºåˆ—çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ã€‚æ‚¨ä¸èƒ½å°† <code>APPEND</code> ä¸ <code>PeriodicWorkRequest</code> ä¸€èµ·ä½¿ç”¨ã€‚</li></ul><p>å½“æœ‰ä¸èƒ½å¤Ÿå¤šæ¬¡æ’é˜Ÿçš„ä»»åŠ¡æ—¶ï¼Œå”¯ä¸€å·¥ä½œå°†éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåº”ç”¨éœ€è¦å°†å…¶æ•°æ®åŒæ­¥åˆ°ç½‘ç»œï¼Œå¯èƒ½éœ€è¦å¯¹ä¸€ä¸ªåä¸ºâ€œsyncâ€çš„åºåˆ—è¿›è¡Œæ’é˜Ÿï¼Œå¹¶æŒ‡å®šå½“å·²ç»å­˜åœ¨å…·æœ‰è¯¥åç§°çš„åºåˆ—æ—¶ï¼Œåº”è¯¥å¿½ç•¥æ–°çš„ä»»åŠ¡ã€‚å½“éœ€è¦é€æ­¥æ„å»ºä¸€ä¸ªé•¿ä»»åŠ¡é“¾æ—¶ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨å”¯ä¸€å·¥ä½œåºåˆ—ã€‚ä¾‹å¦‚ï¼Œç…§ç‰‡ç¼–è¾‘åº”ç”¨å¯èƒ½å…è®¸ç”¨æˆ·æ’¤æ¶ˆä¸€é•¿ä¸²æ“ä½œã€‚å…¶ä¸­çš„æ¯ä¸€é¡¹æ’¤æ¶ˆæ“ä½œå¯èƒ½éƒ½éœ€è¦ä¸€äº›æ—¶é—´æ¥å®Œæˆï¼Œä½†å¿…é¡»æŒ‰æ­£ç¡®çš„é¡ºåºæ‰§è¡Œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”ç”¨å¯ä»¥åˆ›å»ºä¸€ä¸ªâ€œæ’¤æ¶ˆâ€é“¾ï¼Œå¹¶æ ¹æ®éœ€è¦å°†æ¯ä¸ªæ’¤æ¶ˆæ“ä½œé™„åŠ åˆ°è¯¥é“¾ä¸Šã€‚</p><p>æœ€åï¼Œå¦‚æœéœ€è¦åˆ›å»ºä¸€ä¸ªå”¯ä¸€å·¥ä½œé“¾ï¼Œå¯ä»¥ä½¿ç”¨ [<code>WorkManager.beginUniqueWork(String, ExistingWorkPolicy, OneTimeWorkRequest)</code>](<a href="https://developer.android.com/reference/androidx/work/WorkManager?hl=en#beginUniqueWork">https://developer.android.com/reference/androidx/work/WorkManager?hl=en#beginUniqueWork</a>(java.lang.String, androidx.work.ExistingWorkPolicy, androidx.work.OneTimeWorkRequest)) ä»£æ›¿ <code>beginWith()</code>ã€‚</p><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p><a href="https://developer.android.com/topic/libraries/architecture/workmanager/how-to/testing?hl=zh-cn">https://developer.android.com/topic/libraries/architecture/workmanager/how-to/testing?hl=zh-cn</a></p><h4 id="ç®€ä»‹ä¸è®¾ç½®"><a href="#ç®€ä»‹ä¸è®¾ç½®" class="headerlink" title="ç®€ä»‹ä¸è®¾ç½®"></a>ç®€ä»‹ä¸è®¾ç½®</h4><p><a href="https://developer.android.com/topic/libraries/architecture/workmanager?hl=zh-cn">WorkManager</a> æä¾›äº†ä¸€ä¸ª <code>work-testing</code> å·¥ä»¶ï¼Œå¯ä»¥ååŠ©è¿›è¡Œ Android æ’æ¡©æµ‹è¯•ä¸­çš„å·¥ä½œå™¨å•å…ƒæµ‹è¯•ã€‚</p><p>è¦ä½¿ç”¨ <code>work-testing</code> å·¥ä»¶ï¼Œæ‚¨åº”è¯¥å°†å®ƒä½œä¸º <code>androidTestImplementation</code> ä¾èµ–é¡¹æ·»åŠ åˆ° <code>build.gradle</code> ä¸­ã€‚</p><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p><code>work-testing</code> ä¸ºæµ‹è¯•æ¨¡å¼æä¾›äº†ä¸€ç§ç‰¹æ®Šçš„ WorkManager å®ç°ï¼Œå®ƒé€šè¿‡ä½¿ç”¨ <a href="https://developer.android.com/reference/androidx/work/testing/WorkManagerTestInitHelper?hl=zh-cn"><code>WorkManagerTestInitHelper</code></a> æ¥åˆå§‹åŒ–ã€‚</p><p><code>work-testing</code> å·¥ä»¶è¿˜æä¾›äº† <a href="https://developer.android.com/reference/androidx/work/testing/SynchronousExecutor?hl=zh-cn"><code>SynchronousExecutor</code></a>ï¼Œè®©æ‚¨å¯ä»¥æ›´åŠ è½»æ¾åœ°ä»¥åŒæ­¥æ–¹å¼ç¼–å†™æµ‹è¯•ï¼Œè€Œæ— éœ€å¤„ç†å¤šä¸ªçº¿ç¨‹ã€é”å®šæˆ–é”å­˜ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å°†æ‰€æœ‰è¿™äº›ç±»ä¸€èµ·ä½¿ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RunWith(AndroidJUnit4.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicInstrumentationTest</span> &#123;<br>  <span class="hljs-meta">@Before</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setup</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Context</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> InstrumentationRegistry.getTargetContext();<br>    <span class="hljs-type">Configuration</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>.Builder()<br>      <span class="hljs-comment">// Set log level to Log.DEBUG to</span><br>      <span class="hljs-comment">// make it easier to see why tests failed</span><br>      .setMinimumLoggingLevel(Log.DEBUG)<br>      <span class="hljs-comment">// Use a SynchronousExecutor to make it easier to write tests</span><br>      .setExecutor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronousExecutor</span>())<br>      .build();<br><br>    <span class="hljs-comment">// Initialize WorkManager for instrumentation tests.</span><br>    WorkManagerTestInitHelper.initializeTestWorkManager(<br>      context, config);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ„é€ æµ‹è¯•"><a href="#æ„é€ æµ‹è¯•" class="headerlink" title="æ„é€ æµ‹è¯•"></a>æ„é€ æµ‹è¯•</h4><p>ç°åœ¨ WorkManager å·²åœ¨æµ‹è¯•æ¨¡å¼ä¸­åˆå§‹åŒ–ï¼Œæ‚¨å¯ä»¥æµ‹è¯•æ‚¨çš„å·¥ä½œå™¨äº†ã€‚</p><p>å‡è®¾æ‚¨æœ‰ä¸€ä¸ª <code>EchoWorker</code>ï¼Œå®ƒéœ€è¦ä¸€äº› <code>inputData</code> å¹¶ç®€å•åœ°å°†å…¶è¾“å…¥å¤åˆ¶ï¼ˆå›æ˜¾ï¼‰åˆ°å…¶ <code>outputData</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EchoWorker</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Worker</span> &#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">EchoWorker</span><span class="hljs-params">(Context context, WorkerParameters parameters)</span> &#123;<br>    <span class="hljs-built_in">super</span>(context, parameters);<br>  &#125;<br><br>  <span class="hljs-meta">@NonNull</span><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">doWork</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Data</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> getInputData();<br>    <span class="hljs-keyword">if</span> (input.size() == <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-keyword">return</span> Result.failure();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">return</span> Result.success(input);<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åŸºæœ¬æµ‹è¯•"><a href="#åŸºæœ¬æµ‹è¯•" class="headerlink" title="åŸºæœ¬æµ‹è¯•"></a>åŸºæœ¬æµ‹è¯•</h4><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå¯¹ <code>EchoWorker</code> è¿›è¡Œæµ‹è¯•çš„ Android æ’æ¡©æµ‹è¯•ã€‚è¿™é‡Œçš„è¦ç‚¹æ˜¯ï¼Œåœ¨æµ‹è¯•æ¨¡å¼ä¸­æµ‹è¯• <code>EchoWorker</code> ä¸åœ¨çœŸå®åº”ç”¨ä¸­ä½¿ç”¨ <code>EchoWorker</code> éå¸¸ç›¸ä¼¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSimpleEchoWorker</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>  <span class="hljs-comment">// Define input data</span><br>  <span class="hljs-type">Data</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Data</span>.Builder()<br>    .put(KEY_1, <span class="hljs-number">1</span>)<br>    .put(KEY_2, <span class="hljs-number">2</span>)<br>    .build();<br><br>  <span class="hljs-comment">// Create request</span><br>  <span class="hljs-type">OneTimeWorkRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">OneTimeWorkRequest</span>.Builder(EchoWorker.class)<br>    .setInputData(input)<br>    .build();<br><br>  <span class="hljs-type">WorkManager</span> <span class="hljs-variable">workManager</span> <span class="hljs-operator">=</span> WorkManager.getInstance(getApplicationContext());<br>  <span class="hljs-comment">// Enqueue and wait for result. This also runs the Worker synchronously</span><br>  <span class="hljs-comment">// because we are using a SynchronousExecutor.</span><br>  workManager.enqueue(request).getResult().get();<br>  <span class="hljs-comment">// Get WorkInfo and outputData</span><br>  <span class="hljs-type">WorkInfo</span> <span class="hljs-variable">workInfo</span> <span class="hljs-operator">=</span> workManager.getWorkInfoById(request.getId()).get();<br>  <span class="hljs-type">Data</span> <span class="hljs-variable">outputData</span> <span class="hljs-operator">=</span> workInfo.getOutputData();<br>  <span class="hljs-comment">// Assert</span><br>  assertThat(workInfo.getState(), is(WorkInfo.State.SUCCEEDED));<br>  assertThat(outputData, is(input));<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥ç¼–å†™å¦ä¸€ä¸ªæµ‹è¯•ï¼Œå®ƒå°†ç¡®ä¿åœ¨ <code>EchoWorker</code> æ²¡æœ‰è·å¾—ä»»ä½•è¾“å…¥æ•°æ®æ—¶ï¼Œå…¶é¢„æœŸçš„ <code>Result</code> ä¸º <code>Result.failure()</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testEchoWorkerNoInput</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>  <span class="hljs-comment">// Create request</span><br>  <span class="hljs-type">OneTimeWorkRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">OneTimeWorkRequest</span>.Builder(EchoWorker.class)<br>    .build();<br><br>  <span class="hljs-type">WorkManager</span> <span class="hljs-variable">workManager</span> <span class="hljs-operator">=</span> WorkManager.getInstance(getApplicationContext());<br>  <span class="hljs-comment">// Enqueue and wait for result. This also runs the Worker synchronously</span><br>  <span class="hljs-comment">// because we are using a SynchronousExecutor.</span><br>  workManager.enqueue(request).getResult().get();<br>  <span class="hljs-comment">// Get WorkInfo</span><br>  <span class="hljs-type">WorkInfo</span> <span class="hljs-variable">workInfo</span> <span class="hljs-operator">=</span> workManager.getWorkInfoById(request.getId()).get();<br>  <span class="hljs-comment">// Assert</span><br>  assertThat(workInfo.getState(), is(WorkInfo.State.FAILED));<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ¨¡æ‹Ÿçº¦æŸã€å»¶è¿Ÿå’Œå®šæœŸå·¥ä½œ"><a href="#æ¨¡æ‹Ÿçº¦æŸã€å»¶è¿Ÿå’Œå®šæœŸå·¥ä½œ" class="headerlink" title="æ¨¡æ‹Ÿçº¦æŸã€å»¶è¿Ÿå’Œå®šæœŸå·¥ä½œ"></a>æ¨¡æ‹Ÿçº¦æŸã€å»¶è¿Ÿå’Œå®šæœŸå·¥ä½œ</h4><p><code>WorkManagerTestInitHelper</code> ä¸ºæ‚¨æä¾›äº†ä¸€ä¸ª <a href="https://developer.android.com/reference/androidx/work/testing/TestDriver?hl=zh-cn"><code>TestDriver</code></a> å®ä¾‹ï¼Œå¯ç”¨äºæ¨¡æ‹Ÿ <code>initialDelay</code>ã€<code>ListenableWorker</code> æ»¡è¶³ <code>Constraint</code> çš„æ¡ä»¶ï¼Œä»¥åŠ <code>PeriodicWorkRequest</code> çš„é—´éš”ã€‚</p><p>æµ‹è¯•åˆå§‹å»¶è¿Ÿ</p><p><code>Worker</code> å¯ä»¥å…·æœ‰åˆå§‹å»¶è¿Ÿã€‚è¦æµ‹è¯•å«æœ‰ <code>EchoWorker</code> çš„ <code>initialDelay</code>ï¼Œè€Œä¸å¿…åœ¨æµ‹è¯•ä¸­ç­‰å¾… <code>initialDelay</code>ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>TestDriver</code> å°† <code>WorkRequest</code> åˆå§‹å»¶è¿Ÿæ ‡è®°ä¸ºå·²æ»¡è¶³æ¡ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testWithInitialDelay</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>  <span class="hljs-comment">// Define input data</span><br>  <span class="hljs-type">Data</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Data</span>.Builder()<br>    .put(KEY_1, <span class="hljs-number">1</span>)<br>    .put(KEY_2, <span class="hljs-number">2</span>)<br>    .build();<br><br>  <span class="hljs-comment">// Create request</span><br>  <span class="hljs-type">OneTimeWorkRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OneTimeWorkRequest</span>.Builder(EchoWorker.class)<br>    .setInputData(input)<br>    .setInitialDelay(<span class="hljs-number">10</span>, TimeUnit.SECONDS)<br>    .build();<br><br>  <span class="hljs-type">WorkManager</span> <span class="hljs-variable">workManager</span> <span class="hljs-operator">=</span> WorkManager.getInstance(myContext);<br>  <span class="hljs-comment">// Get the TestDriver</span><br>  <span class="hljs-type">TestDriver</span> <span class="hljs-variable">testDriver</span> <span class="hljs-operator">=</span> WorkManagerTestInitHelper.getTestDriver();<br>  <span class="hljs-comment">// Enqueue</span><br>  workManager.enqueue(request).getResult().get();<br>  <span class="hljs-comment">// Tells the WorkManager test framework that initial delays are now met.</span><br>  testDriver.setInitialDelayMet(request.getId());<br>  <span class="hljs-comment">// Get WorkInfo and outputData</span><br>  <span class="hljs-type">WorkInfo</span> <span class="hljs-variable">workInfo</span> <span class="hljs-operator">=</span> workManager.getWorkInfoById(request.getId()).get();<br>  <span class="hljs-type">Data</span> <span class="hljs-variable">outputData</span> <span class="hljs-operator">=</span> workInfo.getOutputData();<br>  <span class="hljs-comment">// Assert</span><br>  assertThat(workInfo.getState(), is(WorkInfo.State.SUCCEEDED));<br>  assertThat(outputData, is(input));<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æµ‹è¯•çº¦æŸ"><a href="#æµ‹è¯•çº¦æŸ" class="headerlink" title="æµ‹è¯•çº¦æŸ"></a>æµ‹è¯•çº¦æŸ</h4><p><code>TestDriver</code> ä¹Ÿå¯ç”¨äºåˆ©ç”¨ <code>setAllConstraintsMet</code> å°†çº¦æŸæ ‡è®°ä¸ºå·²æ»¡è¶³æ¡ä»¶ã€‚ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•æµ‹è¯•å«æœ‰çº¦æŸçš„ <code>Worker</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testWithConstraints</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>  <span class="hljs-comment">// Define input data</span><br>  <span class="hljs-type">Data</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Data</span>.Builder()<br>    .put(KEY_1, <span class="hljs-number">1</span>)<br>    .put(KEY_2, <span class="hljs-number">2</span>)<br>    .build();<br><br>  <span class="hljs-comment">// Define constraints</span><br>  <span class="hljs-type">Constraints</span> <span class="hljs-variable">constraints</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Constraints</span>.Builder()<br>    .setRequiresDeviceIdle(<span class="hljs-literal">true</span>)<br>    .build();<br><br>  <span class="hljs-comment">// Create request</span><br>  <span class="hljs-type">OneTimeWorkRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OneTimeWorkRequest</span>.Builder(EchoWorker.class)<br>    .setInputData(input)<br>    .setConstraints(constraints)<br>    .build();<br><br>  <span class="hljs-type">WorkManager</span> <span class="hljs-variable">workManager</span> <span class="hljs-operator">=</span> WorkManager.getInstance(myContext);<br>  <span class="hljs-type">TestDriver</span> <span class="hljs-variable">testDriver</span> <span class="hljs-operator">=</span> WorkManagerTestInitHelper.getTestDriver();<br>  <span class="hljs-comment">// Enqueue</span><br>  workManager.enqueue(request).getResult().get();<br>  <span class="hljs-comment">// Tells the testing framework that all constraints are met.</span><br>  testDriver.setAllConstraintsMet(request.getId());<br>  <span class="hljs-comment">// Get WorkInfo and outputData</span><br>  <span class="hljs-type">WorkInfo</span> <span class="hljs-variable">workInfo</span> <span class="hljs-operator">=</span> workManager.getWorkInfoById(request.getId()).get();<br>  <span class="hljs-type">Data</span> <span class="hljs-variable">outputData</span> <span class="hljs-operator">=</span> workInfo.getOutputData();<br>  <span class="hljs-comment">// Assert</span><br>  assertThat(workInfo.getState(), is(WorkInfo.State.SUCCEEDED));<br>  assertThat(outputData, is(input));<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æµ‹è¯•å®šæœŸå·¥ä½œ"><a href="#æµ‹è¯•å®šæœŸå·¥ä½œ" class="headerlink" title="æµ‹è¯•å®šæœŸå·¥ä½œ"></a>æµ‹è¯•å®šæœŸå·¥ä½œ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testPeriodicWork</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>  <span class="hljs-comment">// Define input data</span><br>  <span class="hljs-type">Data</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Data</span>.Builder()<br>    .put(KEY_1, <span class="hljs-number">1</span>)<br>    .put(KEY_2, <span class="hljs-number">2</span>)<br>    .build();<br><br>  <span class="hljs-comment">// Create request</span><br>  <span class="hljs-type">PeriodicWorkRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">PeriodicWorkRequest</span>.Builder(EchoWorker.class, <span class="hljs-number">15</span>, MINUTES)<br>    .setInputData(input)<br>    .build();<br><br>  <span class="hljs-type">WorkManager</span> <span class="hljs-variable">workManager</span> <span class="hljs-operator">=</span> WorkManager.getInstance(myContext);<br>  <span class="hljs-type">TestDriver</span> <span class="hljs-variable">testDriver</span> <span class="hljs-operator">=</span> WorkManagerTestInitHelper.getTestDriver();<br>  <span class="hljs-comment">// Enqueue</span><br>  workManager.enqueue(request).getResult().get();<br>  <span class="hljs-comment">// Tells the testing framework the period delay is met</span><br>  testDriver.setPeriodDelayMet(request.getId());<br>  <span class="hljs-comment">// Get WorkInfo and outputData</span><br>  <span class="hljs-type">WorkInfo</span> <span class="hljs-variable">workInfo</span> <span class="hljs-operator">=</span> workManager.getWorkInfoById(request.getId()).get();<br>  <span class="hljs-comment">// Assert</span><br>  assertThat(workInfo.getState(), is(WorkInfo.State.ENQUEUED));<br>&#125;<br></code></pre></td></tr></table></figure><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JetPackä¸­çš„Navigation</title>
    <link href="/2020/02/25/JetPack%E4%B8%AD%E7%9A%84Navigation/"/>
    <url>/2020/02/25/JetPack%E4%B8%AD%E7%9A%84Navigation/</url>
    
    <content type="html"><![CDATA[<p>2018å¹´è°·æ­ŒI&#x2F;O å‘å¸ƒäº†ä¸€ç³»åˆ—è¾…åŠ©androidå¼€å‘è€…çš„å®ç”¨å·¥å…·ï¼Œåˆç§°Jetpackï¼Œä»¥å¸®åŠ©å¼€å‘è€…æ„å»ºå‡ºè‰²çš„ Android åº”ç”¨ã€‚<br>è¿™æ¬¡å‘å¸ƒçš„ Android Jetpack ç»„ä»¶è¦†ç›–ä»¥ä¸‹ 4 ä¸ªæ–¹é¢ï¼šArchitectureã€Foundationã€Behavior ä»¥åŠ UIã€‚<br>è¯¥ç³»åˆ—åšå®¢ä»‹ç»ä¸€ä¸‹Jetpackä¸­å¸¸ç”¨ç»„ä»¶ï¼Œæœ¬ç¯‡ä»‹ç»LiveDataã€ViewModelã€LifeCycleã€‚æœ€åå€ŸåŠ©äº<a href="https://github.com/android/sunflower">https://github.com/android/sunflower</a> æ¥å†™ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨</p><span id="more"></span><p>åŸæ–‡<a href="https://developer.android.com/guide/navigation/?hl=zh-cn%EF%BC%8C%E5%B0%B1%E5%83%8F%E5%AE%83%E7%9A%84%E5%90%8D%E5%AD%97%E4%B8%80%E6%A0%B7%EF%BC%8C%E7%94%A8%E6%9D%A5%E5%81%9A%E5%AF%BC%E8%88%AA%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%94%A8%E6%9D%A5%E5%81%9A%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%BA%94%E7%94%A8(%E4%B8%80%E4%B8%AAActivity%E4%B8%AD%E5%A4%9A%E4%B8%AAFragment%E8%BF%9B%E8%A1%8C%E5%88%87%E6%8D%A2)">https://developer.android.com/guide/navigation/?hl=zh-cnï¼Œå°±åƒå®ƒçš„åå­—ä¸€æ ·ï¼Œç”¨æ¥åšå¯¼èˆªï¼Œå¯ä»¥ç”¨æ¥åšå•é¡µé¢åº”ç”¨(ä¸€ä¸ªActivityä¸­å¤šä¸ªFragmentè¿›è¡Œåˆ‡æ¢)</a></p><p>å¯¼èˆªç»„ä»¶ç”±ä»¥ä¸‹ä¸‰ä¸ªå…³é”®éƒ¨åˆ†ç»„æˆï¼š</p><ul><li>å¯¼èˆªå›¾ï¼šåœ¨ä¸€ä¸ªé›†ä¸­ä½ç½®åŒ…å«æ‰€æœ‰å¯¼èˆªç›¸å…³ä¿¡æ¯çš„ XML èµ„æºã€‚è¿™åŒ…æ‹¬åº”ç”¨å†…æ‰€æœ‰å•ä¸ªå†…å®¹åŒºåŸŸï¼ˆç§°ä¸º<em>ç›®æ ‡</em>ï¼‰ä»¥åŠç”¨æˆ·å¯ä»¥é€šè¿‡åº”ç”¨è·å–çš„å¯èƒ½è·¯å¾„ã€‚</li><li><code>NavHost</code>ï¼šæ˜¾ç¤ºå¯¼èˆªå›¾ä¸­ç›®æ ‡çš„ç©ºç™½å®¹å™¨ã€‚å¯¼èˆªç»„ä»¶åŒ…å«ä¸€ä¸ªé»˜è®¤ <code>NavHost</code> å®ç° (<a href="https://developer.android.com/reference/androidx/navigation/fragment/NavHostFragment?hl=zh-cn"><code>NavHostFragment</code></a>)ï¼Œå¯æ˜¾ç¤º Fragment ç›®æ ‡</li><li><code>NavController</code>ï¼šåœ¨ <code>NavHost</code> ä¸­ç®¡ç†åº”ç”¨å¯¼èˆªçš„å¯¹è±¡ã€‚å½“ç”¨æˆ·åœ¨æ•´ä¸ªåº”ç”¨ä¸­ç§»åŠ¨æ—¶ï¼Œ<code>NavController</code> ä¼šå®‰æ’ <code>NavHost</code> ä¸­ç›®æ ‡å†…å®¹çš„äº¤æ¢ã€‚</li></ul><h3 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h3><h4 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs groovy">dependencies &#123;<br>      <span class="hljs-keyword">def</span> nav_version = <span class="hljs-string">&quot;2.3.0-alpha01&quot;</span><br><br>      <span class="hljs-comment">// Java language implementation</span><br>      implementation <span class="hljs-string">&quot;androidx.navigation:navigation-fragment:$nav_version&quot;</span><br>      implementation <span class="hljs-string">&quot;androidx.navigation:navigation-ui:$nav_version&quot;</span><br><br>      <span class="hljs-comment">// Kotlin</span><br>      implementation <span class="hljs-string">&quot;androidx.navigation:navigation-fragment-ktx:$nav_version&quot;</span><br>      implementation <span class="hljs-string">&quot;androidx.navigation:navigation-ui-ktx:$nav_version&quot;</span><br><br>      <span class="hljs-comment">// Dynamic Feature Module Support</span><br>      implementation <span class="hljs-string">&quot;androidx.navigation:navigation-dynamic-features-fragment:$nav_version&quot;</span><br><br>      <span class="hljs-comment">// Testing Navigation</span><br>      androidTestImplementation <span class="hljs-string">&quot;androidx.navigation:navigation-testing:$nav_version&quot;</span><br>    &#125;<br></code></pre></td></tr></table></figure><h4 id="åˆ›å»ºå¯¼èˆªå›¾"><a href="#åˆ›å»ºå¯¼èˆªå›¾" class="headerlink" title="åˆ›å»ºå¯¼èˆªå›¾"></a>åˆ›å»ºå¯¼èˆªå›¾</h4><p>åœ¨<code>res/navigation</code>ä¸‹åˆ›å»ºä¸€ä¸ª<code>Navigation source file</code>ï¼Œæ ¹èŠ‚ç‚¹å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">navigation</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:app</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res-auto&quot;</span> </span><br><span class="hljs-tag">    <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/test_navigation&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">navigation</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="å‘-Activity-æ·»åŠ -NavHost"><a href="#å‘-Activity-æ·»åŠ -NavHost" class="headerlink" title="å‘ Activity æ·»åŠ  NavHost"></a>å‘ Activity æ·»åŠ  NavHost</h4><p>å¯¼èˆªå®¿ä¸»æ˜¯ Navigation ç»„ä»¶çš„æ ¸å¿ƒéƒ¨åˆ†ä¹‹ä¸€ã€‚å¯¼èˆªå®¿ä¸»æ˜¯ä¸€ä¸ªç©ºå®¹å™¨ï¼Œç”¨æˆ·åœ¨æ‚¨çš„åº”ç”¨ä¸­å¯¼èˆªæ—¶ï¼Œç›®çš„åœ°ä¼šåœ¨è¯¥å®¹å™¨ä¸­äº¤æ¢è¿›å‡ºã€‚</p><p>å¯¼èˆªå®¿ä¸»å¿…é¡»æ´¾ç”Ÿäº <a href="https://developer.android.com/reference/androidx/navigation/NavHost?hl=zh-cn"><code>NavHost</code></a>ã€‚Navigation ç»„ä»¶çš„é»˜è®¤ <code>NavHost</code> å®ç° (<a href="https://developer.android.com/reference/androidx/navigation/fragment/NavHostFragment?hl=zh-cn"><code>NavHostFragment</code></a>) è´Ÿè´£å¤„ç† Fragment ç›®çš„åœ°çš„äº¤æ¢ã€‚</p><p>åœ¨Activitçš„å¸ƒå±€æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹æ§ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">fragment</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/fragment_first&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;androidx.navigation.fragment.NavHostFragment&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:defaultNavHost</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:navGraph</span>=<span class="hljs-string">&quot;@navigation/test_navi&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li><code>android:name</code> å±æ€§åŒ…å« <code>NavHost</code> å®ç°çš„ç±»åç§°ã€‚</li><li><code>app:navGraph</code> å±æ€§å°† <code>NavHostFragment</code> ä¸å¯¼èˆªå›¾ç›¸å…³è”ã€‚å¯¼èˆªå›¾ä¼šåœ¨æ­¤ <code>NavHostFragment</code> ä¸­æŒ‡å®šç”¨æˆ·å¯ä»¥å¯¼èˆªåˆ°çš„æ‰€æœ‰ç›®çš„åœ°ã€‚</li><li><code>app:defaultNavHost=&quot;true&quot;</code> å±æ€§ç¡®ä¿æ‚¨çš„ <code>NavHostFragment</code> ä¼šæ‹¦æˆªç³»ç»Ÿè¿”å›æŒ‰é’®ã€‚è¯·æ³¨æ„ï¼Œåªèƒ½æœ‰ä¸€ä¸ªé»˜è®¤ <code>NavHost</code>ã€‚å¦‚æœåŒä¸€å¸ƒå±€ï¼ˆä¾‹å¦‚ï¼ŒåŒçª—æ ¼å¸ƒå±€ï¼‰ä¸­æœ‰å¤šä¸ªä¸»æœºï¼Œè¯·åŠ¡å¿…ä»…æŒ‡å®šä¸€ä¸ªé»˜è®¤ <code>NavHost</code>ã€‚</li></ul><p>åœ¨Activitä¸­è®¾ç½®æ”¯æŒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>       <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>       setContentView(R.layout.activity_navigation);<br>   &#125;<br><br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onSupportNavigateUp</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-keyword">return</span> Navigation.findNavController(<span class="hljs-built_in">this</span>, R.id.fragment_first).navigateUp();<br>   &#125;<br></code></pre></td></tr></table></figure><h4 id="æ·»åŠ Fragment"><a href="#æ·»åŠ Fragment" class="headerlink" title="æ·»åŠ Fragment"></a>æ·»åŠ Fragment</h4><p>æˆ‘ä»¬æ·»åŠ FragmentAï¼ŒFragmentBï¼ŒFragmentCï¼Œæ¯ä¸ªFragmentä¸­åªæœ‰ä¸€ä¸ªæ–‡æœ¬æŒ‰é’®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FragmentA</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Fragment</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">FragmentA</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> View <span class="hljs-title function_">onCreateView</span><span class="hljs-params">(LayoutInflater inflater, ViewGroup container,</span><br><span class="hljs-params">                             Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-type">View</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span><br>                inflater.inflate(R.layout.fragment_a, container, <span class="hljs-literal">false</span>);<br>        view.findViewById(R.id.jump).setOnClickListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnClickListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> &#123;<br>                FragmentBArgs.Builder builder= <span class="hljs-keyword">new</span>  <span class="hljs-title class_">FragmentBArgs</span>.Builder();<br>                builder.setNum(<span class="hljs-number">11111</span>);<br>                builder.setTitle(<span class="hljs-string">&quot;FragmentB&quot;</span>);<br>                Navigation.findNavController(v).navigate(R.id.action_fragmentA_to_fragmentB,builder.build().toBundle());<br>            &#125;<br>        &#125;);<br><br>        <span class="hljs-keyword">return</span> view;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ·»åŠ å¯¼èˆª"><a href="#æ·»åŠ å¯¼èˆª" class="headerlink" title="æ·»åŠ å¯¼èˆª"></a>æ·»åŠ å¯¼èˆª</h4><p>åœ¨æˆ‘ä»¬å‰é¢æ­¥éª¤åˆ›å»ºçš„Navigation Resourceæ–‡ä»¶ä¸­</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">navigation</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:app</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">&quot;http://schemas.android.com/tools&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/test_navi&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:startDestination</span>=<span class="hljs-string">&quot;@id/fragmentA&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">fragment</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/fragmentA&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;com.huangyuanlove.androidjetpack.architecture.navigation.FragmentA&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:label</span>=<span class="hljs-string">&quot;fragmentA&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">tools:layout</span>=<span class="hljs-string">&quot;@layout/fragment_a&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">action</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/action_fragmentA_to_fragmentB&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">app:destination</span>=<span class="hljs-string">&quot;@id/fragmentB&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">app:exitAnim</span>=<span class="hljs-string">&quot;@android:anim/slide_out_right&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">fragment</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">fragment</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/fragmentB&quot;</span></span><br><span class="hljs-tag"></span><br><span class="hljs-tag">        <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;com.huangyuanlove.androidjetpack.architecture.navigation.FragmentB&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:label</span>=<span class="hljs-string">&quot;fragmentB&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">tools:layout</span>=<span class="hljs-string">&quot;@layout/fragment_b&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">argument</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;title&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:defaultValue</span>=<span class="hljs-string">&quot;test&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">app:argType</span>=<span class="hljs-string">&quot;string&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">argument</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;num&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:defaultValue</span>=<span class="hljs-string">&quot;100&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">app:argType</span>=<span class="hljs-string">&quot;integer&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">action</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/action_fragmentB_to_fragmentC&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">app:destination</span>=<span class="hljs-string">&quot;@id/fragmentC&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">app:exitAnim</span>=<span class="hljs-string">&quot;@android:anim/slide_out_right&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">fragment</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">fragment</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/fragmentC&quot;</span></span><br><span class="hljs-tag"></span><br><span class="hljs-tag">        <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;com.huangyuanlove.androidjetpack.architecture.navigation.FragmentC&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:label</span>=<span class="hljs-string">&quot;fragmentC&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">tools:layout</span>=<span class="hljs-string">&quot;@layout/fragment_c&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">action</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/action_fragmentC_to_fragmentA&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">app:destination</span>=<span class="hljs-string">&quot;@id/fragmentA&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">app:exitAnim</span>=<span class="hljs-string">&quot;@android:anim/slide_out_right&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">fragment</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">navigation</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><strong>Type</strong> å­—æ®µæŒ‡ç¤ºåœ¨æ‚¨çš„æºä»£ç ä¸­ï¼Œè¯¥ç›®çš„åœ°æ˜¯ä½œä¸º Fragmentã€Activity è¿˜æ˜¯å…¶ä»–è‡ªå®šä¹‰ç±»å®ç°çš„ã€‚</li><li><strong>Label</strong> å­—æ®µåŒ…å«è¯¥ç›®çš„åœ°çš„ XML å¸ƒå±€æ–‡ä»¶çš„åç§°ã€‚</li><li><strong>ID</strong> å­—æ®µåŒ…å«è¯¥ç›®çš„åœ°çš„ IDï¼Œå®ƒç”¨äºåœ¨ä»£ç ä¸­å¼•ç”¨è¯¥ç›®çš„åœ°ã€‚</li><li><strong>Class</strong> ä¸‹æ‹‰åˆ—è¡¨æ˜¾ç¤ºä¸è¯¥ç›®çš„åœ°ç›¸å…³è”çš„ç±»çš„åç§°ã€‚æ‚¨å¯ä»¥ç‚¹å‡»æ­¤ä¸‹æ‹‰åˆ—è¡¨ï¼Œå°†ç›¸å…³è”çš„ç±»æ›´æ”¹ä¸ºå…¶ä»–ç›®çš„åœ°ç±»å‹ã€‚</li></ul><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>å¯¼èˆªåˆ°ç›®çš„åœ°æ˜¯ä½¿ç”¨ <a href="https://developer.android.com/reference/androidx/navigation/NavController?hl=zh-cn"><code>NavController</code></a> å®Œæˆçš„ï¼Œåè€…æ˜¯ä¸€ä¸ªåœ¨ <code>NavHost</code> ä¸­ç®¡ç†åº”ç”¨å¯¼èˆªçš„å¯¹è±¡ã€‚æ¯ä¸ª <code>NavHost</code> å‡æœ‰è‡ªå·±çš„ç›¸åº” <code>NavController</code>ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ä¹‹ä¸€æ£€ç´¢ <code>NavController</code>ï¼š</p><ul><li><a href="https://developer.android.com/reference/androidx/navigation/fragment/NavHostFragment?hl=zh-cn#findNavController(android.support.v4.app.Fragment)">NavHostFragment.findNavController(Fragment)</a></li><li>[Navigation.findNavController(Activity, @IdRes int viewId)](<a href="https://developer.android.com/reference/androidx/navigation/Navigation?hl=zh-cn#findNavController">https://developer.android.com/reference/androidx/navigation/Navigation?hl=zh-cn#findNavController</a>(android.app.Activity, int))</li><li><a href="https://developer.android.com/reference/androidx/navigation/Navigation?hl=zh-cn#findNavController(android.view.View)">Navigation.findNavController(View)</a></li></ul><p>æ¯”å¦‚æˆ‘ä»¬æ‰“ç®—åœ¨FragmentAä¸­å¯¼èˆªåˆ°FragmentBï¼Œåˆ™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">tv.setOnClickListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnClickListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> &#123;<br>                Navigation.findNavController(v)<br>                        .navigate(R.id.action_fragmentA_to_fragmentB);<br>            &#125;<br>        &#125;);<br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬éœ€è¦ä¼ é€’å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ Safe Args æ¥ç¡®ä¿ç±»å‹å®‰å…¨ã€‚</p><p>åœ¨é¡¶çº§<code>build.gradle</code>ä¸­æ·»åŠ classPath:<code>classpath &quot;androidx.navigation:navigation-safe-args-gradle-plugin:2.3.0-alpha02&quot;</code></p><p>åœ¨å¯¹åº”moduleçš„<code>build.gradle</code>ä¸­æ·»åŠ plugin:<code>apply plugin: &#39;androidx.navigation.safeargs&#39;</code></p><p>æˆ‘ä»¬åœ¨ä¸Šé¢çš„Navigation Resourceä¸­çš„<code>fragmentB</code>ä¸­æ·»åŠ äº†ä¸‰ä¸ª<code>argument</code>èŠ‚ç‚¹ï¼Œæ’ä»¶ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆ<code>FragmentBArgs</code>ç±»ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">view.findViewById(R.id.jump).setOnClickListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnClickListener() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> &#123;<br>        FragmentBArgs.Builder builder= <span class="hljs-keyword">new</span>  <span class="hljs-title class_">FragmentBArgs</span>.Builder();<br>        builder.setNum(<span class="hljs-number">11111</span>);<br>        builder.setTitle(<span class="hljs-string">&quot;FragmentB&quot;</span>);<br>        Navigation.findNavController(v).navigate(R.id.action_fragmentA_to_fragmentB,builder.build().toBundle());<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="é—ç•™é—®é¢˜"><a href="#é—ç•™é—®é¢˜" class="headerlink" title="é—ç•™é—®é¢˜"></a>é—ç•™é—®é¢˜</h4><p>å°½ç®¡é€šè¿‡Navigationæ–¹å¼ç®¡ç†Fragmentçš„ä»£ç ç®€æ´è€Œä¸”ç›´è§‚ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªéå¸¸è‡´å‘½çš„é—®é¢˜ï¼Œå°±æ˜¯åŒä¸€ä¸ªFragmentä¼šè¢«é‡å¤åˆ›å»ºï¼Œæ¯”å¦‚Aåˆ°Bï¼ŒBå†åˆ°Cï¼Œç„¶åç‚¹å‡»è¿”å›é”®è¿”å›åˆ°Bï¼Œè¿™æ—¶Bä¼šè¢«é‡å»ºï¼Œå†ç‚¹å‡»è¿”å›é”®è¿”å›åˆ°Aï¼ŒAä¹Ÿä¼šè¢«é‡å»ºï¼Œç›®å‰è¿˜æ‰¾ä¸åˆ°è§£å†³æ–¹æ¡ˆï¼Œæˆ–è®¸æ˜¯æˆ‘çš„ä½¿ç”¨æ–¹å¼ä¸å¯¹</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JetPackä¸­çš„Room</title>
    <link href="/2020/01/08/JetPack-Room/"/>
    <url>/2020/01/08/JetPack-Room/</url>
    
    <content type="html"><![CDATA[<p>2018å¹´è°·æ­ŒI&#x2F;O å‘å¸ƒäº†ä¸€ç³»åˆ—è¾…åŠ©androidå¼€å‘è€…çš„å®ç”¨å·¥å…·ï¼Œåˆç§°Jetpackï¼Œä»¥å¸®åŠ©å¼€å‘è€…æ„å»ºå‡ºè‰²çš„ Android åº”ç”¨ã€‚<br>è¿™æ¬¡å‘å¸ƒçš„ Android Jetpack ç»„ä»¶è¦†ç›–ä»¥ä¸‹ 4 ä¸ªæ–¹é¢ï¼šArchitectureã€Foundationã€Behavior ä»¥åŠ UIã€‚è¯¥ç³»åˆ—åšå®¢ä»‹ç»ä¸€ä¸‹Jetpackä¸­å¸¸ç”¨ç»„ä»¶ï¼Œæœ¬ç¯‡ä»‹ç»Roomï¼Œç»“åˆViewModelå’ŒLiveDataå®Œæˆä¸Šå›¾çš„ç»“æ„ã€‚æœ€åå€ŸåŠ©äº<a href="https://github.com/android/sunflower">https://github.com/android/sunflower</a> æ¥å†™ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨</p><span id="more"></span><h4 id="Roomç®€ä»‹"><a href="#Roomç®€ä»‹" class="headerlink" title="Roomç®€ä»‹"></a>Roomç®€ä»‹</h4><p>åŸæ–‡åœ°å€ï¼š<a href="https://developer.android.google.cn/training/data-storage/room/index.html">https://developer.android.google.cn/training/data-storage/room/index.html</a></p><p>Room æŒä¹…æ€§åº“åœ¨ SQLite çš„åŸºç¡€ä¸Šæä¾›äº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿåœ¨å……åˆ†åˆ©ç”¨ SQLite çš„å¼ºå¤§åŠŸèƒ½çš„åŒæ—¶ï¼Œè·äº«æ›´å¼ºå¥çš„æ•°æ®åº“è®¿é—®æœºåˆ¶ã€‚<br>Room åŒ…å« 3 ä¸ªä¸»è¦ç»„ä»¶ï¼š</p><ul><li><p>æ•°æ®åº“ï¼šåŒ…å«æ•°æ®åº“æŒæœ‰è€…ï¼Œå¹¶ä½œä¸ºåº”ç”¨å·²ä¿ç•™çš„æŒä¹…å…³ç³»å‹æ•°æ®çš„åº•å±‚è¿æ¥çš„ä¸»è¦æ¥å…¥ç‚¹ã€‚</p><p>ä½¿ç”¨ @Database æ³¨é‡Šçš„ç±»åº”æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p><ul><li><p>æ˜¯æ‰©å±• RoomDatabase çš„æŠ½è±¡ç±»ã€‚</p></li><li><p>åœ¨æ³¨é‡Šä¸­æ·»åŠ ä¸æ•°æ®åº“å…³è”çš„å®ä½“åˆ—è¡¨ã€‚</p></li><li><p>åŒ…å«å…·æœ‰ 0 ä¸ªå‚æ•°ä¸”è¿”å›ä½¿ç”¨ @Dao æ³¨é‡Šçš„ç±»çš„æŠ½è±¡æ–¹æ³•ã€‚</p></li></ul><p> åœ¨è¿è¡Œæ—¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨ Room.databaseBuilder() æˆ– Room.inMemoryDatabaseBuilder() è·å– Database çš„å®ä¾‹ã€‚</p></li><li><p>Entityï¼šè¡¨ç¤ºæ•°æ®åº“ä¸­çš„è¡¨ã€‚</p></li><li><p>DAOï¼šåŒ…å«ç”¨äºè®¿é—®æ•°æ®åº“çš„æ–¹æ³•ã€‚</p></li></ul><h4 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h4><p>é€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">// Room components</span><br>implementation <span class="hljs-string">&quot;androidx.room:room-runtime:2.2.3&quot;</span><br>annotationProcessor <span class="hljs-string">&quot;androidx.room:room-compiler:2.2.3&quot;</span><br>androidTestImplementation <span class="hljs-string">&quot;androidx.room:room-testing:2.2.3&quot;</span><br><br><span class="hljs-comment">// Lifecycle components</span><br>implementation <span class="hljs-string">&quot;androidx.lifecycle:lifecycle-extensions:2.1.0&quot;</span><br>annotationProcessor <span class="hljs-string">&quot;androidx.lifecycle:lifecycle-compiler:2.1.0&quot;</span><br><br><span class="hljs-comment">// UI</span><br>implementation <span class="hljs-string">&quot;com.google.android.material:material:1.0.0&quot;</span><br></code></pre></td></tr></table></figure><h4 id="åˆ›å»ºå®ä½“ç±»"><a href="#åˆ›å»ºå®ä½“ç±»" class="headerlink" title="åˆ›å»ºå®ä½“ç±»"></a>åˆ›å»ºå®ä½“ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Entity(tableName = &quot;word_table&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Word</span> &#123;<br><br>   <span class="hljs-meta">@PrimaryKey</span><br>   <span class="hljs-meta">@NonNull</span><br>   <span class="hljs-meta">@ColumnInfo(name = &quot;word&quot;)</span><br>   <span class="hljs-keyword">private</span> String mWord;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">Word</span><span class="hljs-params">(String word)</span> &#123;<span class="hljs-built_in">this</span>.mWord = word;&#125;<br><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getWord</span><span class="hljs-params">()</span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.mWord;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è§£é‡Šä¸€ä¸‹å¸¸ç”¨çš„æ³¨è§£ï¼š</p><p><strong>@Entity</strong> :æ•°æ®è¡¨çš„å®ä½“ç±»ã€‚<br><strong>@PrimaryKey</strong>: æ¯ä¸€ä¸ªå®ä½“ç±»éƒ½éœ€è¦ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ã€‚<br><strong>@ColumnInfo</strong> :æ•°æ®è¡¨ä¸­å­—æ®µåç§°ã€‚<br><strong>@Ignore</strong> :æ ‡æ³¨ä¸éœ€è¦æ·»åŠ åˆ°æ•°æ®è¡¨ä¸­çš„å±æ€§ã€‚<br><strong>@Embedded</strong> :å®ä½“ç±»ä¸­å¼•ç”¨å…¶ä»–å®ä½“ç±»ã€‚<br><strong>@ForeignKey</strong>:å¤–é”®çº¦æŸã€‚</p><h4 id="åˆ›å»ºDAO"><a href="#åˆ›å»ºDAO" class="headerlink" title="åˆ›å»ºDAO"></a>åˆ›å»ºDAO</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Dao</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">WordDao</span> &#123;<br><br>   <span class="hljs-comment">// allowing the insert of the same word multiple times by passing a </span><br>   <span class="hljs-comment">// conflict resolution strategy</span><br>   <span class="hljs-meta">@Insert(onConflict = OnConflictStrategy.IGNORE)</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(Word word)</span>;<br><br>   <span class="hljs-meta">@Query(&quot;DELETE FROM word_table&quot;)</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteAll</span><span class="hljs-params">()</span>;<br><br>   <span class="hljs-meta">@Query(&quot;SELECT * from word_table ORDER BY word ASC&quot;)</span><br>   List&lt;Word&gt; <span class="hljs-title function_">getAlphabetizedWords</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>@Dao</strong> ï¼šæ•°æ®åº“æ“ä½œçš„ç±»ã€‚<br><strong>@Query</strong> ï¼š åŒ…å«æ‰€æœ‰Sqliteè¯­å¥æ“ä½œã€‚<br><strong>@Insert</strong> ï¼š æ’å…¥æ“ä½œã€‚<br><strong>@Delete</strong> ï¼š åˆ é™¤æ“ä½œã€‚<br><strong>@Update</strong> ï¼š æ›´æ–°æ“ä½œã€‚</p><p><strong>å†²çªæ¡æ¬¾</strong> :æˆ‘ä»¬åœ¨<code>@Insert</code>ä¸­æ·»åŠ çš„å±æ€§å€¼ã€‚ å°±æ˜¯é’ˆå¯¹å‡ºç°**çº¦æŸå¼‚å¸¸(ROLLBACK, ABORT, FAIL, IGNORE, and REPLACE)**çš„éæ ‡å‡†å¤„ç†ã€‚</p><p><strong>ABORT</strong> ï¼š  é»˜è®¤å€¼ï¼Œä¸å¤„ç†çº¦æŸå¼‚å¸¸ã€‚<br><strong>ROLLBACK</strong>ï¼š  ä¸ABORTç›¸ä¼¼ï¼Œä¸å¸¸ç”¨ã€‚<br><strong>FAIL</strong> ï¼š  åœ¨æ‰¹é‡æ›´æ–°æˆ–è€…ä¿®æ”¹æ—¶ï¼Œä¸­é€”å‡ºç°äº†çº¦æŸå¼‚å¸¸ï¼Œå°±ä¼šç»ˆæ­¢åç»­æ‰§è¡Œï¼Œä½†ä¼šä¿ç•™å·²æ‰§è¡Œçš„sqlè¯­å¥ã€‚<br><strong>IGNORE</strong> ï¼š  å¿½ç•¥çº¦æŸå¼‚å¸¸ï¼Œä¸åšä»»ä½•å¤„ç†ä¿ç•™åŸæ•°æ®ã€‚<br><strong>REPLACE</strong>ï¼š  å½“å‡ºç°çº¦æŸå¼‚å¸¸æ—¶ï¼Œç§»é™¤åŸæ•°æ® &amp; å°†æ–°æ•°æ®è¦†ç›–ã€‚</p><p>è§£é‡Šä¸€æ³¢ï¼š</p><ul><li>è¢«<code>@Dao</code>æ³¨è§£çš„ç±»ä¸€å®šæ˜¯æ¥å£æˆ–è€…æŠ½è±¡ç±»ï¼Œ</li><li><code>void insert(Word word);</code>å£°æ˜ä¸€ä¸ªæ’å…¥çš„æ–¹æ³•ï¼Œä¸éœ€è¦æˆ‘ä»¬æä¾›SQLè¯­å¥ï¼Œåªéœ€è¦ç”¨<code>@Insert</code>æ ‡è®°ä¸€ä¸‹å°±å¥½</li><li><code>@Query(&quot;DELETE FROM word_table&quot;)</code>:<code>@Query</code>éœ€è¦æˆ‘ä»¬æä¾›ä¸€ä¸‹SQLè¯­å¥</li></ul><p>è¿™é‡Œçš„<code>WordDao</code>ä¼šåœ¨ç¼–è¯‘æ—¶ç”Ÿæˆ<code>WordDAO_Impl</code>ç±»ï¼Œ</p><h4 id="Room-database"><a href="#Room-database" class="headerlink" title="Room database"></a>Room database</h4><p>æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„Room databaseå¿…é¡»æ˜¯ç»§æ‰¿è‡ª<code>RoomDatabase</code>çš„æŠ½è±¡ç±»ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šæŠŠè¯¥ç±»åšæˆå•ä¾‹æ¨¡å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Database(entities = &#123;Word.class&#125;, version = 1, exportSchema = false)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WordRoomDatabase</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RoomDatabase</span> &#123;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> WordDao <span class="hljs-title function_">wordDao</span><span class="hljs-params">()</span>;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> WordRoomDatabase INSTANCE;<br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">NUMBER_OF_THREADS</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;<br>   <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">databaseWriteExecutor</span> <span class="hljs-operator">=</span><br>        Executors.newFixedThreadPool(NUMBER_OF_THREADS);<br><br>   <span class="hljs-keyword">static</span> WordRoomDatabase <span class="hljs-title function_">getDatabase</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Context context)</span> &#123;<br>        <span class="hljs-keyword">if</span> (INSTANCE == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">synchronized</span> (WordRoomDatabase.class) &#123;<br>                <span class="hljs-keyword">if</span> (INSTANCE == <span class="hljs-literal">null</span>) &#123;<br>                    INSTANCE = Room.databaseBuilder(context.getApplicationContext(),<br>                            WordRoomDatabase.class, <span class="hljs-string">&quot;word_database&quot;</span>)<br>                            .build();<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> INSTANCE;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä½¿ç”¨<code>@Database</code>æ³¨è§£æ¥å£°æ˜è¿™æ˜¯ä¸€ä¸ªRoom database ï¼Œå¹¶ä¸”ä½¿ç”¨å‚æ•°ä¸­çš„entitieså±æ€§ï¼Œå£°æ˜è¯¥æ•°æ®åº“ä¸­çš„æ˜ å°„è¡¨ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªè¡¨ï¼ŒåŒæ—¶è®¾ç½®æ•°æ®åº“ç‰ˆæœ¬ï¼Œæ–¹ä¾¿ä¹‹åè¿›è¡Œå‡çº§ã€‚</p><h4 id="åˆ›å»º-Repository"><a href="#åˆ›å»º-Repository" class="headerlink" title="åˆ›å»º Repository"></a>åˆ›å»º Repository</h4><p><img src="/image/Android/jetpack/room_repository.png" alt="room_repository"></p><p>Repositoryæ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ•°æ®è®¿é—®å±‚ï¼Œæ•°æ®å¯ä»¥æ¥æºäºæ•°æ®åº“ï¼Œä¹Ÿå¯ä»¥æ¥æºäºç½‘ç»œï¼Œè¿™ä¸€æ¬¡å±‚å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†è¿˜æ˜¯æ¨èæœ‰è¿™ä¹ˆä¸€å±‚ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WordRepository</span> &#123;<br><br>    <span class="hljs-keyword">private</span> WordDAO wordDAO;<br>    <span class="hljs-keyword">private</span> LiveData&lt;List&lt;Word&gt;&gt; allWords;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">WordRepository</span><span class="hljs-params">(Application application)</span>&#123;<br>        <span class="hljs-type">WordRoomDatabase</span> <span class="hljs-variable">db</span> <span class="hljs-operator">=</span> WordRoomDatabase.getDatabase(application);<br>        wordDAO = db.wordDAO();<br>        allWords = wordDAO.getAlphabetizedWords();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> LiveData&lt;List&lt;Word&gt;&gt; <span class="hljs-title function_">getAllWords</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> allWords;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Word word)</span>&#123;<br>        WordRoomDatabase.databaseWriteExecutor.execute(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                wordDAO.insert(word);<br>            &#125;<br>        &#125;);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åˆ›å»ºViewModel"><a href="#åˆ›å»ºViewModel" class="headerlink" title="åˆ›å»ºViewModel"></a>åˆ›å»ºViewModel</h4><p><img src="/image/Android/jetpack/room_view_model.png" alt="room_view_model"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WordViewModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AndroidViewModel</span> &#123;<br><br>    <span class="hljs-keyword">private</span> WordRepository wordRepository;<br>    <span class="hljs-keyword">private</span> LiveData&lt;List&lt;Word&gt;&gt; allWords;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">WordViewModel</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Application application)</span> &#123;<br>        <span class="hljs-built_in">super</span>(application);<br>        wordRepository = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WordRepository</span>(application);<br>        allWords = wordRepository.getAllWords();<br><br>    &#125;<br>    <span class="hljs-keyword">public</span> LiveData&lt;List&lt;Word&gt;&gt; <span class="hljs-title function_">getAllWords</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> allWords;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(Word word)</span> &#123;<br>        wordRepository.insert(word);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="åˆ›å»ºé¡µé¢"><a href="#åˆ›å»ºé¡µé¢" class="headerlink" title="åˆ›å»ºé¡µé¢"></a>åˆ›å»ºé¡µé¢</h4><p>é¡µé¢åŒ…å«ä¸€ä¸ª<code>RecyclerView</code>ï¼Œç”¨äºå±•ç¤ºæ•°æ®åº“ä¿å­˜çš„å†…å®¹ï¼Œä¸€ä¸ª<code>button</code>,ç‚¹å‡»åè·³è½¬æ–°é¡µé¢ï¼Œæ·»åŠ æ–°çš„<code>Word</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RoomWordActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br><br><br>    <span class="hljs-keyword">private</span> WordViewModel mWordViewModel;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">NEW_WORD_ACTIVITY_REQUEST_CODE</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_room_word);<br>        <span class="hljs-type">RecyclerView</span> <span class="hljs-variable">recyclerView</span> <span class="hljs-operator">=</span> findViewById(R.id.recyclerview);<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">WordListAdapter</span> <span class="hljs-variable">adapter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WordListAdapter</span>(<span class="hljs-built_in">this</span>);<br>        recyclerView.setAdapter(adapter);<br>        recyclerView.setLayoutManager(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LinearLayoutManager</span>(<span class="hljs-built_in">this</span>));<br><br><br>        mWordViewModel = ViewModelProviders.of (<span class="hljs-built_in">this</span>).get(WordViewModel.class);<br>        mWordViewModel.getAllWords().observe(<span class="hljs-built_in">this</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>&lt;List&lt;Word&gt;&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onChanged</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> <span class="hljs-keyword">final</span> List&lt;Word&gt; words)</span> &#123;<br>                <span class="hljs-comment">// Update the cached copy of the words in the adapter.</span><br>                adapter.setWords(words);<br>            &#125;<br>        &#125;);<br><br><br>        <span class="hljs-type">FloatingActionButton</span> <span class="hljs-variable">fab</span> <span class="hljs-operator">=</span> findViewById(R.id.fab);<br>        fab.setOnClickListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnClickListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View view)</span> &#123;<br>                <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(RoomWordActivity.<span class="hljs-built_in">this</span>, NewWordActivity.class);<br>                startActivityForResult(intent, NEW_WORD_ACTIVITY_REQUEST_CODE);<br>            &#125;<br>        &#125;);<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onActivityResult</span><span class="hljs-params">(<span class="hljs-type">int</span> requestCode, <span class="hljs-type">int</span> resultCode, Intent data)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onActivityResult(requestCode, resultCode, data);<br><br>        <span class="hljs-keyword">if</span> (requestCode == NEW_WORD_ACTIVITY_REQUEST_CODE &amp;&amp; resultCode == RESULT_OK) &#123;<br>            <span class="hljs-type">Word</span> <span class="hljs-variable">word</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Word</span>(data.getStringExtra(NewWordActivity.EXTRA_REPLY));<br>            mWordViewModel.insert(word);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            Toast.makeText(<br>                    getApplicationContext(),<br>                    R.string.empty_not_saved,<br>                    Toast.LENGTH_LONG).show();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å½“æˆ‘ä»¬æ·»åŠ å®Œæ•°æ®ä¹‹åï¼Œä¼šåœ¨é¡µé¢ä¸Šæ˜¾ç¤ºã€‚</p><h4 id="Daoç¼–è¯‘åçš„äº§ç‰©"><a href="#Daoç¼–è¯‘åçš„äº§ç‰©" class="headerlink" title="@Daoç¼–è¯‘åçš„äº§ç‰©"></a>@Daoç¼–è¯‘åçš„äº§ç‰©</h4><p>æˆ‘ä»¬åœ¨WordDAOä¸­æ·»åŠ äº†å‡ å¤©æ— å…³ç´§è¦çš„æ–¹æ³•ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Insert(onConflict = OnConflictStrategy.IGNORE)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(Word word)</span>;<br><br><span class="hljs-meta">@Update</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">updateWord</span><span class="hljs-params">(Word word)</span>;<br><br><span class="hljs-meta">@Query(&quot;DELETE FROM word_table&quot;)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteAll</span><span class="hljs-params">()</span>;<br><br><span class="hljs-meta">@Query(&quot;SELECT * from word_table ORDER BY word ASC&quot;)</span><br>LiveData&lt;List&lt;Word&gt;&gt; <span class="hljs-title function_">getAlphabetizedWords</span><span class="hljs-params">()</span>;<br><br><span class="hljs-meta">@Query(&quot;select * from word_table where word=:word&quot;)</span><br>LiveData&lt;Word&gt; <span class="hljs-title function_">getWordByContent</span><span class="hljs-params">(String word)</span>;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç¼–è¯‘æ—¶ç”Ÿæˆçš„ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WordDAO_Impl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WordDAO</span> &#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RoomDatabase __db;<br><br>  <span class="hljs-comment">//å¯¹åº”ç€ void insert(Word word);æ–¹æ³•</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> EntityInsertionAdapter&lt;Word&gt; __insertionAdapterOfWord;<br><span class="hljs-comment">//å¯¹åº”ç€  void updateWord(Word word);æ–¹æ³•</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> EntityDeletionOrUpdateAdapter&lt;Word&gt; __updateAdapterOfWord;<br><span class="hljs-comment">//å¯¹åº”ç€ void deleteAll();æ–¹æ³•</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SharedSQLiteStatement __preparedStmtOfDeleteAll;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">WordDAO_Impl</span><span class="hljs-params">(RoomDatabase __db)</span> &#123;<br>    <span class="hljs-built_in">this</span>.__db = __db;<br>    <span class="hljs-comment">//å’ŒJDBCä¸­PreparedStatementå¾ˆåƒï¼Œå·®ä¸å¤šæ˜¯ä¸€è‡´çš„</span><br>    <span class="hljs-built_in">this</span>.__insertionAdapterOfWord = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EntityInsertionAdapter</span>&lt;Word&gt;(__db) &#123;<br>      <span class="hljs-meta">@Override</span><br>      <span class="hljs-keyword">public</span> String <span class="hljs-title function_">createQuery</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;INSERT OR IGNORE INTO `word_table` (`word`) VALUES (?)&quot;</span>;<br>      &#125;<br><br>      <span class="hljs-meta">@Override</span><br>      <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bind</span><span class="hljs-params">(SupportSQLiteStatement stmt, Word value)</span> &#123;<br>        <span class="hljs-keyword">if</span> (value.getWord() == <span class="hljs-literal">null</span>) &#123;<br>          stmt.bindNull(<span class="hljs-number">1</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          stmt.bindString(<span class="hljs-number">1</span>, value.getWord());<br>        &#125;<br>      &#125;<br>    &#125;;<br>    <span class="hljs-comment">//è¿™é‡Œä¹Ÿæ˜¯è¿›è¡Œé¢„ç¼–è¯‘</span><br>    <span class="hljs-built_in">this</span>.__updateAdapterOfWord = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EntityDeletionOrUpdateAdapter</span>&lt;Word&gt;(__db) &#123;<br>      <span class="hljs-meta">@Override</span><br>      <span class="hljs-keyword">public</span> String <span class="hljs-title function_">createQuery</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;UPDATE OR ABORT `word_table` SET `word` = ? WHERE `word` = ?&quot;</span>;<br>      &#125;<br><br>      <span class="hljs-meta">@Override</span><br>      <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bind</span><span class="hljs-params">(SupportSQLiteStatement stmt, Word value)</span> &#123;<br>        <span class="hljs-keyword">if</span> (value.getWord() == <span class="hljs-literal">null</span>) &#123;<br>          stmt.bindNull(<span class="hljs-number">1</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          stmt.bindString(<span class="hljs-number">1</span>, value.getWord());<br>        &#125;<br>        <span class="hljs-keyword">if</span> (value.getWord() == <span class="hljs-literal">null</span>) &#123;<br>          stmt.bindNull(<span class="hljs-number">2</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          stmt.bindString(<span class="hljs-number">2</span>, value.getWord());<br>        &#125;<br>      &#125;<br>    &#125;;<br>    <span class="hljs-comment">//è¿™é‡Œæ˜¯åˆ é™¤æ‰€æœ‰ï¼Œå¹¶æ²¡æœ‰å‚æ•°ï¼Œæ‰€ä»¥æ²¡æœ‰é¢„ç¼–è¯‘è¯­å¥</span><br>    <span class="hljs-built_in">this</span>.__preparedStmtOfDeleteAll = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SharedSQLiteStatement</span>(__db) &#123;<br>      <span class="hljs-meta">@Override</span><br>      <span class="hljs-keyword">public</span> String <span class="hljs-title function_">createQuery</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">_query</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;DELETE FROM word_table&quot;</span>;<br>        <span class="hljs-keyword">return</span> _query;<br>      &#125;<br>    &#125;;<br>  &#125;<br><br>  <span class="hljs-comment">//è¿™é‡Œæ˜¯å¤å†™WordDAOä¸­çš„æ–¹æ³•ï¼Œè°ƒç”¨ä¸Šé¢çš„é¢„ç¼–è¯‘å¥½çš„è¯­å¥è¿›è¡Œsqlæ“ä½œï¼Œæ²¡å•¥å¥½è¯´çš„ï¼›ç¯‡å¹…åŸå› ï¼Œ</span><br>  <span class="hljs-comment">//public LiveData&lt;List&lt;Word&gt;&gt; getAlphabetizedWords() </span><br>  <span class="hljs-comment">//public LiveData&lt;Word&gt; getWordByContent(final String word)</span><br>  <span class="hljs-comment">//æ²¡æœ‰æŠ„è¿‡æ¥</span><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Word word)</span> &#123;<br>    __db.assertNotSuspendingTransaction();<br>    __db.beginTransaction();<br>    <span class="hljs-keyword">try</span> &#123;<br>      __insertionAdapterOfWord.insert(word);<br>      __db.setTransactionSuccessful();<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>      __db.endTransaction();<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateWord</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Word word)</span> &#123;<br>    __db.assertNotSuspendingTransaction();<br>    __db.beginTransaction();<br>    <span class="hljs-keyword">try</span> &#123;<br>      __updateAdapterOfWord.handle(word);<br>      __db.setTransactionSuccessful();<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>      __db.endTransaction();<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteAll</span><span class="hljs-params">()</span> &#123;<br>    __db.assertNotSuspendingTransaction();<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">SupportSQLiteStatement</span> <span class="hljs-variable">_stmt</span> <span class="hljs-operator">=</span> __preparedStmtOfDeleteAll.acquire();<br>    __db.beginTransaction();<br>    <span class="hljs-keyword">try</span> &#123;<br>      _stmt.executeUpdateDelete();<br>      __db.setTransactionSuccessful();<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>      __db.endTransaction();<br>      __preparedStmtOfDeleteAll.release(_stmt);<br>    &#125;<br>  &#125;<br><br></code></pre></td></tr></table></figure><h4 id="Databaseç¼–è¯‘åç”Ÿæˆçš„ç±»"><a href="#Databaseç¼–è¯‘åç”Ÿæˆçš„ç±»" class="headerlink" title="@Databaseç¼–è¯‘åç”Ÿæˆçš„ç±»"></a>@Databaseç¼–è¯‘åç”Ÿæˆçš„ç±»</h4><p>æˆ‘ä»¬å®šä¹‰çš„<code>WordRoomDatabase</code>ç±»åœ¨ç¼–è¯‘åç”Ÿæˆäº†<code>WordRoomDatabase_Impl</code>ç±»ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç±»çš„å†…å®¹,åˆ é™¤äº†æ–¹æ³•çš„å®ç°ï¼Œåªä¿ç•™äº†æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WordRoomDatabase_Impl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WordRoomDatabase</span> &#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> WordDAO _wordDAO;<br><br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> ManDAO _manDAO;<br><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">protected</span> SupportSQLiteOpenHelper <span class="hljs-title function_">createOpenHelper</span><span class="hljs-params">(DatabaseConfiguration configuration)</span> &#123;<br>   <br>      <span class="hljs-meta">@Override</span><br>      <span class="hljs-keyword">protected</span> RoomOpenHelper.ValidationResult <span class="hljs-title function_">onValidateSchema</span><span class="hljs-params">(SupportSQLiteDatabase _db)</span> &#123;<br>        <br>    <span class="hljs-keyword">final</span> SupportSQLiteOpenHelper.<span class="hljs-type">Configuration</span> <span class="hljs-variable">_sqliteConfig</span> <span class="hljs-operator">=</span> SupportSQLiteOpenHelper.Configuration.builder(configuration.context)<br>        .name(configuration.name)<br>        .callback(_openCallback)<br>        .build();<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">SupportSQLiteOpenHelper</span> <span class="hljs-variable">_helper</span> <span class="hljs-operator">=</span> configuration.sqliteOpenHelperFactory.create(_sqliteConfig);<br>    <span class="hljs-keyword">return</span> _helper;<br>  &#125;<br><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">protected</span> InvalidationTracker <span class="hljs-title function_">createInvalidationTracker</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">final</span> HashMap&lt;String, String&gt; _shadowTablesMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, String&gt;(<span class="hljs-number">0</span>);<br>    HashMap&lt;String, Set&lt;String&gt;&gt; _viewTables = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, Set&lt;String&gt;&gt;(<span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvalidationTracker</span>(<span class="hljs-built_in">this</span>, _shadowTablesMap, _viewTables, <span class="hljs-string">&quot;word_table&quot;</span>,<span class="hljs-string">&quot;man&quot;</span>);<br>  &#125;<br><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clearAllTables</span><span class="hljs-params">()</span> &#123;<br>    <br>  &#125;<br><br> <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> WordDAO <span class="hljs-title function_">wordDAO</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">if</span> (_wordDAO != <span class="hljs-literal">null</span>) &#123;<br>      <span class="hljs-keyword">return</span> _wordDAO;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">synchronized</span>(<span class="hljs-built_in">this</span>) &#123;<br>        <span class="hljs-keyword">if</span>(_wordDAO == <span class="hljs-literal">null</span>) &#123;<br>          _wordDAO = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WordDAO_Impl</span>(<span class="hljs-built_in">this</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> _wordDAO;<br>      &#125;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> ManDAO <span class="hljs-title function_">ManDAO</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">if</span> (_manDAO != <span class="hljs-literal">null</span>) &#123;<br>      <span class="hljs-keyword">return</span> _manDAO;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">synchronized</span>(<span class="hljs-built_in">this</span>) &#123;<br>        <span class="hljs-keyword">if</span>(_manDAO == <span class="hljs-literal">null</span>) &#123;<br>          _manDAO = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ManDAO_Impl</span>(<span class="hljs-built_in">this</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> _manDAO;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œé¢æˆ‘ä»¬å‘ç°äº†è·å–æˆ‘ä»¬å®šä¹‰çš„ä¸¤ä¸ª<code>DAO</code>çš„æ–¹æ³•ï¼Œè¿”å›äº†<code>DAO_Impl</code>çš„å®ç°ç±»ã€‚</p><p><code>createInvalidationTracker</code>æ˜¯åœ¨åˆ›å»ºRoomDatabaseæ—¶è°ƒç”¨çš„ ï¼Œä»£ç åœ¨<code>RoomDatabase</code>ç±»ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">RoomDatabase</span><span class="hljs-params">()</span> &#123;<br>       mInvalidationTracker = createInvalidationTracker();<br>   &#125;<br></code></pre></td></tr></table></figure><p><code>createOpenHelper</code>æ˜¯åœ¨æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„RoomDatabaseä¸­è°ƒç”¨<code>Room.databaseBuilder().build()</code>æ–¹æ³•æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•å†…éƒ¨è°ƒç”¨çš„ã€‚</p><h4 id="è°ƒç”¨æµç¨‹"><a href="#è°ƒç”¨æµç¨‹" class="headerlink" title="è°ƒç”¨æµç¨‹"></a>è°ƒç”¨æµç¨‹</h4><p>ä¸Šé¢ç®€å•è¯´æ˜äº†è°ƒç”¨è¿‡ç¨‹ä¸­æ‰€æ¶‰åŠåˆ°çš„ç±»ï¼Œä¸‹é¢ç®€å•æ‹ä¸€ä¸‹è°ƒç”¨è¿‡ç¨‹ï¼š</p><ol><li>æˆ‘ä»¬çš„<code>WordRoomDatabase</code>ç»§æ‰¿è‡ª<code>RoomDatabase</code>,å¹¶ä¸”åœ¨<code>getDatabase</code>æ–¹æ³•ä¸­è°ƒç”¨äº†<code>Room.databaseBuilder().build()</code>æ–¹æ³•ã€‚è¿™é‡Œçš„<code>Room.databaseBuilder()</code>æ–¹æ³•è¿”å›çš„æ˜¯<code>RoomDatabase.Builder</code>ç±»å‹ï¼Œè¿™è°ƒç”¨<code>build()</code>æ–¹æ³•</li><li>åœ¨<code>RoomDatabase.Builder.build</code>æ–¹æ³•ä¸­ï¼Œåªçœ‹æœ€åå‡ è¡Œï¼Œå‰é¢æ˜¯å¯¹æ•°æ®åº“è¿›è¡Œçš„é…ç½®</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">T</span> <span class="hljs-variable">db</span> <span class="hljs-operator">=</span> Room.getGeneratedImplementation(mDatabaseClass, DB_IMPL_SUFFIX);<br>db.init(configuration);<br><span class="hljs-keyword">return</span> db;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>DB_IMPL_SUFFIX</code>æ˜¯ä¸€ä¸ªå…¨å±€é™æ€å˜é‡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DB_IMPL_SUFFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;_Impl&quot;</span>;<br></code></pre></td></tr></table></figure><ol start="3"><li>åœ¨è¿”å›æ•°æ®åº“å®ä¾‹ä¹‹å‰ï¼Œè°ƒç”¨äº†<code>db.init</code>æ–¹æ³•ï¼Œåœ¨<code>init</code>æ–¹æ³•ä¸­è°ƒç”¨äº†<code>createOpenHelper</code>æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢</li></ol><p>æåˆ°çš„<code>WordRoomDatabase_Impl</code>ä¸­å®ç°çš„<code>createOpenHelper</code>æ–¹æ³•ã€‚</p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨DAOä¸­çš„æ–¹æ³•å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œäº†</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å†™åœ¨2020å¹´åˆ-2019æ€»ç»“</title>
    <link href="/2020/01/06/%E5%86%99%E5%9C%A82020%E5%B9%B4%E5%88%9D-2019%E6%80%BB%E7%BB%93/"/>
    <url>/2020/01/06/%E5%86%99%E5%9C%A82020%E5%B9%B4%E5%88%9D-2019%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<p>ä¸å‡ºæ‰€æ–™ã€æ¯«ä¸æ„å¤–çš„2019å¹´çš„æ€»ç»“æ²¡æœ‰åœ¨å…ƒæ—¦å†™å®Œï¼Œè·³ç¥¨äº†ï¼Œä¸€å‘¨ï¼Œè¿˜å¥½ï¼Œä»Šå¤©è¡¥ä¸Šã€‚<br>2020å¹´è®¡åˆ’è‚¯å®šä¸æ˜¯æŠŠå»å¹´çš„è®¡åˆ’æ”¹ä¸ªå¹´ä»½å°±è¡Œäº†ã€‚ã€‚ã€‚</p><span id="more"></span><h4 id="2019å¹´å¹²äº†å•¥"><a href="#2019å¹´å¹²äº†å•¥" class="headerlink" title="2019å¹´å¹²äº†å•¥"></a>2019å¹´å¹²äº†å•¥</h4><p>è¿˜æœ‰è‡ªå·±æœ‰è®°å½•ä¸€ä¸‹ï¼Œæ¯ä¸ªæœˆçš„æœˆæœ«æˆ–è€…æœˆåˆæ€»ç»“ä¸€ä¸‹ä¸Šä¸ªæœˆå¹²äº†å•¥ï¼Œä¸‹ä¸ªæœˆçš„ç›®æ ‡æ˜¯å•¥ã€‚<a href="https://book.huangyuanlove.com/">https://book.huangyuanlove.com</a><br>æ€»ä½“ä¸Šä¹Ÿæ˜¯æŠŠå¹´åº¦ç›®æ ‡åˆ†è§£äº†ä¸€ä¸‹ã€‚ä¸è¿‡è®¡åˆ’èµ¶ä¸ä¸Šå˜åŒ–ï¼Œæ¯æ¬¡è®¡åˆ’éƒ½å’Œå·¥ä½œå†²çªã€‚æƒ³å­¦çš„ä¸œè¥¿ä¹Ÿåªèƒ½è‡ªå·±æ‰¾æ—¶é—´å»å­¦ã€‚å› ä¸ºæƒ³å­¦çš„ä¸œè¥¿å’Œå…¬å¸è¦ç”¨çš„ä¸œè¥¿é‡åˆåº¦ä¸æ€ä¹ˆé«˜ï¼Œè¿™å°±å¾ˆè›‹ç–¼äº†ã€‚</p><ul><li>ç†Ÿæ‚‰flutterå¸¸è§æ§ä»¶ã€flutter_channelã€BLoCã€Provider</li><li>å›¾è§£è®¾è®¡æ¨¡å¼(è¯´å®è¯æ²¡å•¥å°è±¡ï¼Œéœ€è¦åœ¨å·¥ç¨‹ä¸­å¤šå®è·µï¼Œåªçœ‹ä¹¦æ²¡å•¥æ•ˆæœ)</li><li>å…¥æ‰‹æ ‘è“æ´¾3B+ï¼Œç©äº†ä¸€å‘¨ï¼Œç„¶ååƒç°äº†</li><li>AndroidAnnotationç¼–è¯‘æ—¶æ³¨è§£æ¡†æ¶ï¼Œå’Œé…å¥—åšå®¢ï¼Œ<a href="https://github.com/huangyuanlove/AndroidAnnotation">https://github.com/huangyuanlove/AndroidAnnotation</a></li><li>çœ‹äº†ã€ŠAndroidè‡ªå®šä¹‰æ§ä»¶å¼€å‘å…¥é—¨ä¸å®æˆ˜ã€‹ æ²¡å•¥æ„Ÿè§‰</li><li>çœ‹äº†ã€ŠRxJava2.xå®æˆ˜ã€‹æ²¡å•¥æ„Ÿè§‰</li><li>çœ‹äº†ã€ŠiOSå¼€å‘ç¬¬å››ç‰ˆã€‹ï¼Œç»ƒæ‰‹é¡¹ç›®â€ç…è›‹â€åˆšå¼€äº†å¤´</li><li>20å¤šç¯‡åšå®¢ï¼Œ(ä¹Ÿæ²¡å•¥ç‰¹æ®Šäº§å‡ºï¼Œè®°å½•äº†ä¸€ä¸‹è‡ªå·±å­¦è¿‡å¾—ä¸œè¥¿)</li></ul><p>æ€»ç»“ä¸€ä¸‹2019ï¼šçœ‹èµ·æ¥æŒºå¤šï¼Œå®é™…ä¸Šæ²¡å¹²å•¥ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚<br>è‡ªæ§åŠ›å·®ï¼Œä¸èƒ½æ¨åŠ¨è‡ªå·±æ‰§è¡Œè®¡åˆ’ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚<br>ç›®å‰å­¦çš„ä¸œè¥¿åªæ˜¯æµ®äºè¡¨é¢ï¼Œåªæ˜¯ä¼šç”¨å°±è¡Œï¼Œå¹¶æ²¡æœ‰ç†Ÿæ‚‰åº•å±‚æœºåˆ¶å’ŒåŸç†ï¼Œå‡ºäº†é—®é¢˜åªèƒ½å‡­ç»éªŒå»æã€‚ã€‚ã€‚ã€‚ã€‚</p><h4 id="2020-ç›®æ ‡"><a href="#2020-ç›®æ ‡" class="headerlink" title="2020 ç›®æ ‡"></a>2020 ç›®æ ‡</h4><ul><li>iOSåŸºç¡€ï¼Œå…ˆæŠŠâ€ç…è›‹â€å†™å®Œ</li><li>æ•°æ®ç»“æ„ä¸ç®—æ³•ï¼Œæµ™æ±Ÿå¤§å­¦å…¬å¼€è¯¾ï¼ŒæŠŠä¹ é¢˜åšä¸€éï¼Œä¸èƒ½æ‰‹é«˜çœ¼ä½</li><li>LeetCodeåˆ·ä¸€åˆ·ï¼Œæœ€èµ·ç ç®€å•çš„é¢˜è¦ä¿¡æ‰‹æ‹ˆæ¥</li><li>AndroidéŸ³è§†é¢‘ã€Androidæºç è®¾è®¡æ¨¡å¼(åº”è¯¥ä¼šåæºç )</li><li>Androidå’Œflutterç³»ç»Ÿæ¶æ„</li></ul><p>æœ€åä¸¤æ¡éœ€è¦å¹³æ—¶å¤šæ€»ç»“ï¼Œå¹¶ä¸åªæ˜¯å»ç¿»æºç ï¼Œéœ€è¦å»è®°å½•ã€åˆ†æã€æ€»ç»“ã€åé¦ˆ</p><p>åšæŒå§ã€‚ã€‚ã€‚ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>ä¹±ä¸ƒå…«ç³Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è‡ªå®šä¹‰æ³¨è§£ï¼Œæ‰“é€ è‡ªå·±çš„æ¡†æ¶-æœ€ç»ˆç¯‡</title>
    <link href="/2019/12/12/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3%EF%BC%8C%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E6%A1%86%E6%9E%B6-%E6%9C%80%E7%BB%88%E7%AF%87/"/>
    <url>/2019/12/12/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3%EF%BC%8C%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E6%A1%86%E6%9E%B6-%E6%9C%80%E7%BB%88%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<p>è¯¥ç³»åˆ—ä»‹ç»è‡ªå®šä¹‰æ³¨è§£ï¼Œå®Œæˆå¦‚ä¸‹åŠŸèƒ½ã€‚</p><ul><li><input checked="" disabled="" type="checkbox"> @BindView ä»£æ›¿  findViewById </li><li><input checked="" disabled="" type="checkbox"> @ClickResponder ä»£æ›¿ setOnClickListener</li><li><input checked="" disabled="" type="checkbox"> @LongClickResponder ä»£æ›¿ setOnLongClickListener</li><li><input checked="" disabled="" type="checkbox"> @IntentValue ä»£æ›¿ getIntent().getXXX</li><li><input checked="" disabled="" type="checkbox"> @UriValue ä»£æ›¿ getQueryParameter</li><li><input checked="" disabled="" type="checkbox"> @BroadcastResponder ä»£æ›¿ registerReceiver</li><li><input checked="" disabled="" type="checkbox"> @RouterModuleã€@RouterPath æ¥è¿›è¡Œåä¾èµ–ä¼ é€’è°ƒç”¨<br>è¯¥ç³»åˆ—æºç åœ¨<a href="https://github.com/huangyuanlove/AndroidAnnotation">https://github.com/huangyuanlove/AndroidAnnotation</a><br>å‰å‡ ç¯‡ä»‹ç»äº†<code>@BindView</code>ã€<code>@ClickResponder</code>ã€<code>@LongClickResponder</code>ã€<code>@IntentValue</code>ã€<code>@UriValue</code>çš„å®ç°ï¼Œè¿™ä¸€ç¯‡ä»‹ç»ä¸€ä¸‹<code>@RouterModule</code> å’Œ<code>@RouterPath</code>çš„å®ç°ã€‚<span id="more"></span></li></ul><h4 id="å‰æ"><a href="#å‰æ" class="headerlink" title="å‰æ"></a>å‰æ</h4><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸å¾—ä¸ä¸ºäº†æŸäº›æƒ…å½¢è€Œåœ¨ä»£ç å±‚é¢å¦¥åï¼Œå†™å‡ºäº†ä¸€å¨åˆä¸€å¨çš„åäººç±»ä»£ç ã€‚æ¯”å¦‚æ¥æ‰‹äº†ä¸€ä¸ªå¤è€çš„å·¥ç¨‹ï¼ŒAæ¨¡å—ä¾èµ–Bæ¨¡å—ï¼Œä½†æ˜¯ç°åœ¨çš„éœ€æ±‚éœ€è¦åœ¨Bé‡Œé¢æ‰“å¼€Aé¡µé¢ï¼Œæˆ–è€…è°ƒç”¨Açš„æ–¹æ³•æ¥åšå¤æ‚çš„è®¡ç®—ç­‰ç­‰ï¼Œäºæ˜¯å°±å‚¬ç”Ÿäº†è¿™ä¸ªæ³¨è§£ã€‚ã€‚ã€‚</p><h4 id="å£°æ˜æ³¨è§£"><a href="#å£°æ˜æ³¨è§£" class="headerlink" title="å£°æ˜æ³¨è§£"></a>å£°æ˜æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(ElementType.TYPE)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.CLASS)</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> RouterModule &#123;<br>    String <span class="hljs-title function_">host</span><span class="hljs-params">()</span>;<br><br>    String <span class="hljs-title function_">schema</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;App&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(ElementType.METHOD)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.CLASS)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> RouterPath &#123;<br>    String <span class="hljs-title function_">value</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="å¤„ç†æ³¨è§£é€»è¾‘"><a href="#å¤„ç†æ³¨è§£é€»è¾‘" class="headerlink" title="å¤„ç†æ³¨è§£é€»è¾‘"></a>å¤„ç†æ³¨è§£é€»è¾‘</h4><p>è¿™é‡Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªå¤„ç†å™¨ï¼Œä¸“é—¨ç”¨æ¥å¤„ç†è¿™ç§é€»è¾‘ï¼Œä¹Ÿé‡æ–°ç”Ÿæˆå¦å¤–ä¸€ä¸ªè¾…åŠ©ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-meta">@AutoService(Processor.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RouterProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractProcessor</span> &#123;<br>    <span class="hljs-keyword">private</span> Elements elementUtils;<br><br>    <span class="hljs-keyword">private</span> Map&lt;Element, TypeSpecWrapper&gt; typeSpecWrapperMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Set&lt;String&gt; <span class="hljs-title function_">getSupportedAnnotationTypes</span><span class="hljs-params">()</span> &#123;<br>        Set&lt;String&gt; set = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashSet</span>&lt;&gt;();<br>        set.add(RouterModule.class.getCanonicalName());<br>        set.add(RouterPath.class.getCanonicalName());<br><br>        <span class="hljs-keyword">return</span> set;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> SourceVersion <span class="hljs-title function_">getSupportedSourceVersion</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> SourceVersion.RELEASE_7;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(ProcessingEnvironment processingEnv)</span> &#123;<br>        <span class="hljs-built_in">super</span>.init(processingEnv);<br>        elementUtils = processingEnv.getElementUtils();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">process</span><span class="hljs-params">(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment roundEnv)</span> &#123;<br><br>        typeSpecWrapperMap.clear();<br><br>        Set&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Element</span>&gt; routerModuleSet = roundEnv.getElementsAnnotatedWith(RouterModule.class);<br><br>        <span class="hljs-keyword">for</span> (Element element : routerModuleSet) &#123;<br>            <span class="hljs-type">RouterModule</span> <span class="hljs-variable">routerModule</span> <span class="hljs-operator">=</span> element.getAnnotation(RouterModule.class);<br>            <span class="hljs-type">TypeSpecWrapper</span> <span class="hljs-variable">typeSpecWrapper</span> <span class="hljs-operator">=</span> typeSpecWrapperMap.get(element);<br>            <span class="hljs-keyword">if</span> (typeSpecWrapper == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-type">String</span> <span class="hljs-variable">packageName</span> <span class="hljs-operator">=</span> elementUtils.getPackageOf(element).getQualifiedName().toString();<br>                <span class="hljs-type">ClassName</span> <span class="hljs-variable">hashMapClassName</span> <span class="hljs-operator">=</span> ClassName.bestGuess(<span class="hljs-string">&quot;java.util.HashMap&quot;</span>);<br>                <span class="hljs-type">ClassName</span> <span class="hljs-variable">methodClassName</span> <span class="hljs-operator">=</span> ClassName.bestGuess(<span class="hljs-string">&quot;java.lang.reflect.Method&quot;</span>);<br>                <span class="hljs-type">ClassName</span> <span class="hljs-variable">stringClassName</span> <span class="hljs-operator">=</span> ClassName.bestGuess(<span class="hljs-string">&quot;java.lang.String&quot;</span>);<br>                <span class="hljs-type">ParameterizedTypeName</span> <span class="hljs-variable">routerMapClassName</span> <span class="hljs-operator">=</span> ParameterizedTypeName.get(hashMapClassName, stringClassName, methodClassName);<br><br>                <span class="hljs-type">ClassName</span> <span class="hljs-variable">targetClassName</span> <span class="hljs-operator">=</span> ClassName.get(packageName, element.getSimpleName().toString());<br><br>                TypeSpec.<span class="hljs-type">Builder</span> <span class="hljs-variable">typeSpecBuilder</span> <span class="hljs-operator">=</span> TypeSpec.classBuilder(routerModule.schema() + routerModule.host() + <span class="hljs-string">&quot;$$Router&quot;</span>)<br>                        .addField(routerMapClassName, <span class="hljs-string">&quot;routerMap&quot;</span>, Modifier.PRIVATE)<br>                        .addField(targetClassName, <span class="hljs-string">&quot;target&quot;</span>);<br>                typeSpecWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeSpecWrapper</span>(typeSpecBuilder, <span class="hljs-string">&quot;com.huangyuanlove.router&quot;</span>);<br>                typeSpecWrapperMap.put(element, typeSpecWrapper);<br><br><br>                MethodSpec.<span class="hljs-type">Builder</span> <span class="hljs-variable">constructorBuilder</span> <span class="hljs-operator">=</span> typeSpecWrapper.getMethodBuilder(MethodSpec.constructorBuilder().toString());<br>                <span class="hljs-keyword">if</span> (constructorBuilder == <span class="hljs-literal">null</span>) &#123;<br>                    constructorBuilder = MethodSpec.constructorBuilder().addModifiers(Modifier.PUBLIC).addException(Exception.class);<br>                &#125;<br>                constructorBuilder.addStatement(<span class="hljs-string">&quot;this.target =  new $T()&quot;</span>, targetClassName)<br>                        .addStatement(<span class="hljs-string">&quot;this.routerMap = new $T()&quot;</span>, routerMapClassName);<br><br><br>                List&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Element</span>&gt; lists = element.getEnclosedElements();<br>                <span class="hljs-keyword">for</span> (Element element1 : lists) &#123;<br>                    <span class="hljs-type">ExecutableElement</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> (ExecutableElement) element1;<br><br>                    <span class="hljs-type">RouterPath</span> <span class="hljs-variable">routerPath</span> <span class="hljs-operator">=</span> temp.getAnnotation(RouterPath.class);<br>                    <span class="hljs-keyword">if</span> (routerPath != <span class="hljs-literal">null</span>) &#123;<br>                        constructorBuilder.addStatement(<span class="hljs-string">&quot;this.routerMap.put($S,target.getClass().getMethod($S,$L))&quot;</span>, routerPath.value(), element1.getSimpleName().toString(), paramsClassString(temp));<br>                    &#125;<br><br>                &#125;<br><br>                typeSpecWrapper.putMethodBuilder(constructorBuilder);<br><br>                <span class="hljs-type">ClassName</span> <span class="hljs-variable">paramWrapperName</span> <span class="hljs-operator">=</span> ClassName.bestGuess(<span class="hljs-string">&quot;com.huangyuanlove.view_inject_api.router.RouterParamWrapper&quot;</span>);<br>                <span class="hljs-type">ClassName</span> <span class="hljs-variable">routerDelegateName</span> <span class="hljs-operator">=</span> ClassName.bestGuess(<span class="hljs-string">&quot;com.huangyuanlove.view_inject_api.router.RouterDelegate&quot;</span>);<br><br>                MethodSpec.<span class="hljs-type">Builder</span> <span class="hljs-variable">invokeBuilder</span> <span class="hljs-operator">=</span> MethodSpec.methodBuilder(<span class="hljs-string">&quot;invoke&quot;</span>)<br>                        .addModifiers(Modifier.PUBLIC)<br>                        .addException(Exception.class)<br>                        .addParameter(String.class, <span class="hljs-string">&quot;path&quot;</span>)<br>                        .addParameter(paramWrapperName, <span class="hljs-string">&quot;paramWrapper&quot;</span>)<br>                        .addStatement(<span class="hljs-string">&quot;$T method = this.routerMap.get($L)&quot;</span>, methodClassName, <span class="hljs-string">&quot;path&quot;</span>)<br>                        .beginControlFlow(<span class="hljs-string">&quot;if(method == null)&quot;</span>)<br>                        .addStatement(<span class="hljs-string">&quot; throw new Exception(\&quot;can not find method which map \&quot; +path)&quot;</span>)<br>                        .endControlFlow()<br>                        .addStatement(<span class="hljs-string">&quot;return $T.invoke(method,target,paramWrapper)&quot;</span>, routerDelegateName)<br>                        .returns(Object.class);<br><br>                typeSpecWrapper.putMethodBuilder(invokeBuilder);<br><br>            &#125;<br><br>        &#125;<br><br><br>        <span class="hljs-keyword">for</span> (Map.Entry&lt;Element, TypeSpecWrapper&gt; entry : typeSpecWrapperMap.entrySet()) &#123;<br><br>            entry.getValue().writeTo(processingEnv.getFiler());<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">paramsClassString</span><span class="hljs-params">(ExecutableElement temp)</span> &#123;<br><br>        <span class="hljs-keyword">if</span> (temp == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br><br>        List&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">VariableElement</span>&gt; parameters = temp.getParameters();<br><br>        <span class="hljs-keyword">if</span> (parameters == <span class="hljs-literal">null</span> || parameters.size() == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br><br>        String[] result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[parameters.size()];<br><br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; parameters.size(); i++) &#123;<br>            result[i] = parameters.get(i).asType().toString() + <span class="hljs-string">&quot;.class&quot;</span>;<br>            sb.append(parameters.get(i).asType().toString() + <span class="hljs-string">&quot;.class&quot;</span>);<br>            sb.append(<span class="hljs-string">&quot;,&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> sb.deleteCharAt(sb.length() - <span class="hljs-number">1</span>).toString();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸»è¦å°±æ˜¯æ”¶é›†æ³¨è§£ä¿¡æ¯ï¼Œç”Ÿæˆæ³¨è§£ç±»ï¼Œåœ¨è°ƒç”¨å¯¹åº”æ³¨è§£è·¯å¾„æ—¶ï¼Œè°ƒç”¨<code>api</code>æ¨¡å—ä¸­å¯¹åº”çš„ä»£ç†ç±»<code>RouterDelegate</code>ï¼Œæœ€ç»ˆç”±ä½¿ç”¨è€…è°ƒç”¨<code>Router</code>ä¸­çš„<code>RouterBuilder</code>æ¥è°ƒç”¨å¯¹åº”è·¯å¾„æ³¨è§£çš„æ–¹æ³•ã€‚</p><h4 id="ç»™ä½¿ç”¨è€…æä¾›è°ƒç”¨æ–¹æ³•"><a href="#ç»™ä½¿ç”¨è€…æä¾›è°ƒç”¨æ–¹æ³•" class="headerlink" title="ç»™ä½¿ç”¨è€…æä¾›è°ƒç”¨æ–¹æ³•"></a>ç»™ä½¿ç”¨è€…æä¾›è°ƒç”¨æ–¹æ³•</h4><p>åœ¨<code>api</code>æ¨¡å—ä¸­ï¼Œæ–°å»º<code>RouterParamWrapper</code>ä½œä¸ºæˆ‘ä»¬æ³¨è§£å‚æ•°çš„åŒ…è£…ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RouterParamWrapper</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Object []paramArray;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RouterParamWrapper</span><span class="hljs-params">(Object [] paramArray)</span> &#123;<br>        <span class="hljs-built_in">this</span>.paramArray = paramArray;<br>    &#125;<br>    <span class="hljs-keyword">public</span> Object[] getParamArray() &#123;<br>        <span class="hljs-keyword">return</span> paramArray;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨<code>api</code>æ¨¡å—ä¸­ï¼Œæ–°å»º<code>RouterDelegate</code>ä½œä¸ºæˆ‘ä»¬æ³¨è§£çš„ä»£ç†ç±»ï¼Œå®é™…ä¸Šä¹Ÿå°±æ˜¯ä¸€ä¸ªä¸­é—´å±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RouterDelegate</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Method method, Object target, RouterParamWrapper paramWrapper)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>       <span class="hljs-keyword">return</span>  method.invoke(target,paramWrapper.getParamArray());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åæä¾›ç»™è°ƒç”¨è€…ä¸€ä¸ªè°ƒç”¨æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Router</span> &#123;<br><br>    <span class="hljs-keyword">public</span>  <span class="hljs-keyword">interface</span>  <span class="hljs-title class_">InvokeResultListener</span>&lt;T&gt;&#123;<br>        <span class="hljs-keyword">void</span>  <span class="hljs-title function_">onError</span><span class="hljs-params">(Exception e)</span>;<br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">( T result)</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PACKAGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;com.huangyuanlove.router&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RouterBuilder <span class="hljs-title function_">to</span><span class="hljs-params">(String path)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RouterBuilder</span>(path);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RouterBuilder</span>&#123;<br>        <span class="hljs-keyword">private</span> String path;<br>        <span class="hljs-keyword">private</span> Object[] paramArray;<br><br>        <span class="hljs-keyword">private</span> <span class="hljs-title function_">RouterBuilder</span><span class="hljs-params">(String path)</span> &#123;<br>            <span class="hljs-built_in">this</span>.path = path;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> RouterBuilder <span class="hljs-title function_">addParam</span><span class="hljs-params">(Object ... paramArray)</span>&#123;<br>            <span class="hljs-built_in">this</span>. paramArray = paramArray;<br>            <span class="hljs-keyword">return</span>  <span class="hljs-built_in">this</span>;<br><br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">done</span><span class="hljs-params">()</span>&#123;<br>            done(<span class="hljs-literal">null</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">done</span><span class="hljs-params">(InvokeResultListener listener)</span>&#123;<br><br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">Uri</span> <span class="hljs-variable">uri</span>  <span class="hljs-operator">=</span> Uri.parse(path);<br>                <span class="hljs-type">String</span> <span class="hljs-variable">schema</span> <span class="hljs-operator">=</span> uri.getScheme();<br>                <span class="hljs-type">String</span> <span class="hljs-variable">host</span> <span class="hljs-operator">=</span> uri.getHost();<br>                <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> uri.getPath();<br><br>                <span class="hljs-type">Class</span> <span class="hljs-variable">routerInject</span> <span class="hljs-operator">=</span> Class.forName(PACKAGE_NAME +<span class="hljs-string">&quot;.&quot;</span> + schema + host +<span class="hljs-string">&quot;$$Router&quot;</span>);<br>                <span class="hljs-type">Constructor</span> <span class="hljs-variable">constructor</span> <span class="hljs-operator">=</span>  routerInject.getConstructor();<br>                constructor.setAccessible(<span class="hljs-literal">true</span>);<br>                <span class="hljs-type">RouterParamWrapper</span> <span class="hljs-variable">paramWrapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RouterParamWrapper</span>(paramArray);<br><br>                <span class="hljs-type">Method</span> <span class="hljs-variable">invokeMethod</span> <span class="hljs-operator">=</span> routerInject.getMethod(<span class="hljs-string">&quot;invoke&quot;</span>,String.class,RouterParamWrapper.class);<br>                invokeMethod.setAccessible(<span class="hljs-literal">true</span>);<br>                <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> invokeMethod.invoke(constructor.newInstance(),path,paramWrapper);<br>                <span class="hljs-keyword">if</span>(listener!=<span class="hljs-literal">null</span>)&#123;<br>                    listener.onSuccess(result);<br>                &#125;<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br><br>                <span class="hljs-keyword">if</span>(listener!=<span class="hljs-literal">null</span>)&#123;<br>                    listener.onError(e);<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·ä½¿ç”¨è€…è°ƒç”¨<code>Router.to(String path).addParam(Object ... param).done</code>å°±å¯ä»¥è°ƒç”¨äº†ã€‚</p><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªæ¨¡å—ä¸­æä¾›ä¸€ä¸ªåŠŸèƒ½ç±»ï¼Œç”¨æ¥æš´éœ²å‡ºæä¾›ç»™å…¶ä»–æ¨¡å—ä½¿ç”¨çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RouterModule(schema = &quot;App&quot;,host = &quot;main&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainProvider</span> &#123;<br><br>    <span class="hljs-meta">@RouterPath(value = &quot;/toMain&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startMain</span><span class="hljs-params">(Activity context, <span class="hljs-type">int</span> id)</span>&#123;<br>        <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(context, MainActivity.class);<br>        intent.putExtra(<span class="hljs-string">&quot;id&quot;</span>,id);<br>        context.startActivity(intent);<br>    &#125;<br><br>    <span class="hljs-meta">@RouterPath(value = &quot;/toMainWithResult&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startMain</span><span class="hljs-params">(Activity context, String title,<span class="hljs-type">int</span> requestCode)</span>&#123;<br>        <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(context, MainActivity.class);<br>        intent.putExtra(<span class="hljs-string">&quot;title&quot;</span>,title);<br>        context.startActivity(intent);<br>    &#125;<br><br>    <span class="hljs-meta">@RouterPath(value = &quot;/getInt&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getIntValue</span><span class="hljs-params">(String s)</span>&#123;<br>        <span class="hljs-keyword">return</span> s.length();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥åœ¨å…¶ä»–æ¨¡å—ä¸­ä½¿ç”¨<code>Router</code>è¿›è¡Œä»»æ„è°ƒç”¨äº†ï¼Œæ¯”å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ClickResponder(idStr = &quot;toAppMainActivity&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">toAppMainActivity</span><span class="hljs-params">(View v)</span>&#123;<br><br>    Router.to(<span class="hljs-string">&quot;App://main/toMain&quot;</span>).addParam(<span class="hljs-built_in">this</span>,<span class="hljs-number">123</span>).done(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>.InvokeResultListener() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Exception e)</span> &#123;<br>            Toast.makeText(EXT_MainActivity.<span class="hljs-built_in">this</span>,e.toString(),Toast.LENGTH_SHORT).show();<br><br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(Object o)</span> &#123;<br><br>        &#125;<br>    &#125;);<br><br>&#125;<br><br><span class="hljs-meta">@ClickResponder(idStr = &quot;invoke_main_method&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invokeMainMethod</span><span class="hljs-params">(View v)</span>&#123;<br><br>    Router.to(<span class="hljs-string">&quot;App://main/getInt&quot;</span>).addParam(<span class="hljs-string">&quot;12345678&quot;</span>).done(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>.InvokeResultListener&lt;Integer&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Exception e)</span> &#123;<br>            Toast.makeText(EXT_MainActivity.<span class="hljs-built_in">this</span>,e.toString(),Toast.LENGTH_SHORT).show();<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(Integer result)</span> &#123;<br>            Toast.makeText(EXT_MainActivity.<span class="hljs-built_in">this</span>,result+<span class="hljs-string">&quot;&quot;</span>,Toast.LENGTH_SHORT).show();<br><br>        &#125;<br>    &#125;);<br><br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶å®æˆ‘ä¹Ÿä¸æƒ³æå‡ºæ¥è¿™ç§ä¸œè¥¿ï¼Œä½†æ¯•ç«Ÿæ˜¯æ—¶é—´ç´§ã€ä»»åŠ¡é‡ï¼Œå…ˆè¿™ä¹ˆç”¨ç€å§ã€‚</p><h4 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h4><p>ç»ˆäºæŠŠæ³¨è§£è¿™ä¸€å—å†™å®Œäº†ï¼Œä¹Ÿç®—æ˜¯å¯¹è‡ªå·±å†™æ³¨è§£çš„ä¸€ä¸ªæ€»ç»“å§ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è‡ªå®šä¹‰æ³¨è§£ï¼Œæ‰“é€ è‡ªå·±çš„æ¡†æ¶-ä¸‹ä¸‹ä¸‹ç¯‡</title>
    <link href="/2019/12/10/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3%EF%BC%8C%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E6%A1%86%E6%9E%B6-%E4%B8%8B%E4%B8%8B%E4%B8%8B%E7%AF%87/"/>
    <url>/2019/12/10/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3%EF%BC%8C%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E6%A1%86%E6%9E%B6-%E4%B8%8B%E4%B8%8B%E4%B8%8B%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<p>è¯¥ç³»åˆ—ä»‹ç»è‡ªå®šä¹‰æ³¨è§£ï¼Œå®Œæˆå¦‚ä¸‹åŠŸèƒ½ã€‚</p><ul><li><input checked="" disabled="" type="checkbox"> @BindView ä»£æ›¿  findViewById </li><li><input checked="" disabled="" type="checkbox"> @ClickResponder ä»£æ›¿ setOnClickListener</li><li><input checked="" disabled="" type="checkbox"> @LongClickResponder ä»£æ›¿ setOnLongClickListener</li><li><input checked="" disabled="" type="checkbox"> @IntentValue ä»£æ›¿ getIntent().getXXX</li><li><input checked="" disabled="" type="checkbox"> @UriValue ä»£æ›¿ getQueryParameter</li><li><input checked="" disabled="" type="checkbox"> @BroadcastResponder ä»£æ›¿ registerReceiver</li><li><input disabled="" type="checkbox"> @RouterModuleã€@RouterPath æ¥è¿›è¡Œåä¾èµ–ä¼ é€’è°ƒç”¨<br>è¯¥ç³»åˆ—æºç åœ¨<a href="https://github.com/huangyuanlove/AndroidAnnotation">https://github.com/huangyuanlove/AndroidAnnotation</a><br>å‰å‡ ç¯‡ä»‹ç»äº†<code>@BindView</code>ã€<code>@ClickResponder</code>ã€<code>@LongClickResponder</code>ã€<code>@IntentValue</code> ã€<code>@UriValue</code>çš„å®ç°ï¼Œè¿™ä¸€ç¯‡ä»‹ç»ä¸€ä¸‹<code>BroadcastResponder </code>çš„å®ç°ã€‚</li></ul><span id="more"></span><p>å…¶å®æœ¬æ¥ä¸æƒ³å†™è¿™ä¸ªçš„ï¼Œå› ä¸ºæœ‰å¤ªå¤šçš„é€‰æ‹©å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šä»£æ›¿å¹¿æ’­æ¥æ”¶å™¨(æ¥æ”¶éç³»ç»Ÿå¹¿æ’­ï¼Œä¹Ÿå°±æ˜¯è·¨é¡µé¢ä¼ å€¼)ï¼Œæ¯”å¦‚EventBusï¼ŒRxBusç­‰ã€‚<br>æƒ³æƒ³é¡¹ç›®ä¸­å¯èƒ½ä¼šç”¨åˆ°ï¼Œå°±å†™ä¸€å†™å§ã€‚</p><h4 id="å‰æ"><a href="#å‰æ" class="headerlink" title="å‰æ"></a>å‰æ</h4><p>å¹¿æ’­åˆ†ä¸ºæœ¬åœ°å¹¿æ’­å’Œå…¨å±€å¹¿æ’­ï¼Œæœ¬åœ°å¹¿æ’­ä½¿ç”¨<code>LocalBroadcastManager.getInstance(Context context).sendBroadcast()</code>æ¥å‘é€ï¼Œå…¨å±€å¹¿æ’­ä½¿ç”¨<code>Context.sendBroadcast()</code>å‘é€ã€‚</p><p>åŒæ ·åœ¨æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨æ—¶ï¼Œæœ¬åœ°å¹¿æ’­ä½¿ç”¨<code>LocalBroadcastManager.getInstance(Context context).registerReceiver</code>æ¥æ³¨å†Œï¼Œå…¨å±€å¹¿æ’­ä½¿ç”¨<code>Context.registerReceiver()</code>æ¥æ³¨å†Œã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œéœ€è¦å†é€‚å½“çš„æ—¶æœºï¼Œè§£æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”Ÿæˆçš„è¾…åŠ©ä»£ç éœ€è¦ä¿å­˜ä¸€ä¸‹æ¥æ”¶å™¨ã€‚ä»¥ä¾¿ä½¿ç”¨è€…å¯ä»¥å»è§£æ³¨å†Œã€‚</p><h4 id="å£°æ˜æ³¨è§£"><a href="#å£°æ˜æ³¨è§£" class="headerlink" title="å£°æ˜æ³¨è§£"></a>å£°æ˜æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(&#123;ElementType.METHOD&#125;)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.CLASS)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> BroadcastResponder &#123;<br><br>    <span class="hljs-type">int</span> <span class="hljs-variable">LOCAL_BROADCAST</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">GLOBAL_BROADCAST</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br><br>    String[] action();<br>    <span class="hljs-type">int</span> <span class="hljs-title function_">type</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> LOCAL_BROADCAST;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦åŒºåˆ†ä¸€ä¸‹æ³¨å†Œçš„æ˜¯å“ªç§å¹¿æ’­ï¼Œé»˜è®¤æ˜¯æœ¬åœ°å¹¿æ’­ã€‚</p><h4 id="å¤„ç†æ³¨è§£é€»è¾‘"><a href="#å¤„ç†æ³¨è§£é€»è¾‘" class="headerlink" title="å¤„ç†æ³¨è§£é€»è¾‘"></a>å¤„ç†æ³¨è§£é€»è¾‘</h4><p>æˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ä¸Šä¸€ç¯‡ä¸­çš„æ³¨è§£å¤„ç†å™¨ï¼Œéœ€è¦æ·»åŠ å±æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> Map&lt;TypeElement, List&lt;Element&gt;&gt; broadCastResponderMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br></code></pre></td></tr></table></figure><p>æ·»åŠ ä¸€ä¸‹æ³¨è§£æ”¯æŒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">set.add(BroadcastResponder.class.getCanonicalName());<br></code></pre></td></tr></table></figure><p>åŒæ ·åœ¨<code>process</code>ä¸­å¤„ç†æ³¨è§£é€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">broadCastResponderMap.clear();<br>Set&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Element</span>&gt; broadCastResponderSet = roundEnvironment.getElementsAnnotatedWith(BroadcastResponder.class);<br>collectBroadCastResponderMapInfo(broadCastResponderSet);<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">collectBroadCastResponderMapInfo</span><span class="hljs-params">(Set&lt;? extends Element&gt; elements)</span> &#123;<br>  <span class="hljs-keyword">for</span> (Element element : elements) &#123;<br>    <span class="hljs-type">TypeElement</span> <span class="hljs-variable">typeElement</span> <span class="hljs-operator">=</span> (TypeElement) element.getEnclosingElement();<br>    List&lt;Element&gt; elementList = broadCastResponderMap.get(typeElement);<br>    <span class="hljs-keyword">if</span> (elementList == <span class="hljs-literal">null</span>) &#123;<br>      elementList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>      broadCastResponderMap.put(typeElement, elementList);<br>    &#125;<br>    elementList.add(element);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨<code>generateCode()</code>æ–¹æ³•ä¸­è°ƒç”¨<code>generateBroadcastResponderCode();</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">generateBroadcastResponderCode</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-keyword">for</span> (TypeElement typeElement : broadCastResponderMap.keySet()) &#123;<br><br>    MethodSpec.<span class="hljs-type">Builder</span> <span class="hljs-variable">methodBuilder</span> <span class="hljs-operator">=</span> generateRegisterReceiverMethodBuilder(typeElement);<br><br><br>    <span class="hljs-type">ClassName</span> <span class="hljs-variable">broadcastReceiverClassName</span> <span class="hljs-operator">=</span> ClassName.bestGuess(<span class="hljs-string">&quot;android.content.BroadcastReceiver&quot;</span>);<br>    <span class="hljs-type">ClassName</span> <span class="hljs-variable">contextClassName</span> <span class="hljs-operator">=</span> ClassName.bestGuess(<span class="hljs-string">&quot;android.content.Context&quot;</span>);<br>    <span class="hljs-type">ClassName</span> <span class="hljs-variable">intentClassName</span> <span class="hljs-operator">=</span> ClassName.bestGuess(<span class="hljs-string">&quot;android.content.Intent&quot;</span>);<br>    <span class="hljs-type">ClassName</span> <span class="hljs-variable">localBroadcastManagerClassName</span> <span class="hljs-operator">=</span> ClassName.bestGuess(<span class="hljs-string">&quot;androidx.localbroadcastmanager.content.LocalBroadcastManager&quot;</span>);<br><br><br>    List&lt;Element&gt; elements = broadCastResponderMap.get(typeElement);<br><br>    HashMap&lt;String, String&gt; localBroadCast = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    HashMap&lt;String, String&gt; globalBroadCast = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">for</span> (Element element : elements) &#123;<br>      <span class="hljs-type">ExecutableElement</span> <span class="hljs-variable">executableElement</span> <span class="hljs-operator">=</span> (ExecutableElement) element;<br>      <span class="hljs-type">BroadcastResponder</span> <span class="hljs-variable">broadcastResponder</span> <span class="hljs-operator">=</span> executableElement.getAnnotation(BroadcastResponder.class);<br>      <span class="hljs-type">int</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> broadcastResponder.type();<br>      String[] actions = broadcastResponder.action();<br>      <span class="hljs-keyword">for</span> (String action : actions) &#123;<br><br>        <span class="hljs-keyword">if</span> (BroadcastResponder.LOCAL_BROADCAST == type) &#123;<br>          methodBuilder.addStatement(<span class="hljs-string">&quot;localBroadcastFilter.addAction(($S))&quot;</span>, action);<br>          localBroadCast.put(action, element.getSimpleName().toString());<br><br><br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (BroadcastResponder.GLOBAL_BROADCAST == type) &#123;<br>          globalBroadCast.put(action, element.getSimpleName().toString());<br>          methodBuilder.addStatement(<span class="hljs-string">&quot;globalBroadcastFilter.addAction(($S))&quot;</span>, action);<br>        &#125;<br><br>      &#125;<br><br><br>    &#125;<br><br><br>    <span class="hljs-keyword">if</span> (globalBroadCast.size() &gt; <span class="hljs-number">0</span>) &#123;<br>      CodeBlock.<span class="hljs-type">Builder</span> <span class="hljs-variable">caseBlockBuilder</span> <span class="hljs-operator">=</span> CodeBlock.builder().beginControlFlow(<span class="hljs-string">&quot;switch (intent.getAction())&quot;</span>);<br>      <span class="hljs-keyword">for</span> (Map.Entry&lt;String, String&gt; entry : globalBroadCast.entrySet()) &#123;<br>        caseBlockBuilder.add(<span class="hljs-string">&quot;case $S:\n&quot;</span>, entry.getKey())<br>          .addStatement(<span class="hljs-string">&quot;target.$L(context,intent)&quot;</span>, entry.getValue())<br>          .addStatement(<span class="hljs-string">&quot;break&quot;</span>);<br>      &#125;<br><br><br>      caseBlockBuilder.endControlFlow();<br>      <span class="hljs-type">MethodSpec</span> <span class="hljs-variable">broadcastReceiverMethod</span> <span class="hljs-operator">=</span> MethodSpec.methodBuilder(<span class="hljs-string">&quot;onReceive&quot;</span>)<br>        .addModifiers(Modifier.PUBLIC)<br>        .addParameter(contextClassName, <span class="hljs-string">&quot;context&quot;</span>)<br>        .addParameter(intentClassName, <span class="hljs-string">&quot;intent&quot;</span>)<br>        .addCode(caseBlockBuilder.build())<br>        .returns(<span class="hljs-keyword">void</span>.class)<br>        .build();<br>      <span class="hljs-type">TypeSpec</span> <span class="hljs-variable">innerTypeSpec</span> <span class="hljs-operator">=</span> TypeSpec.anonymousClassBuilder(<span class="hljs-string">&quot;&quot;</span>)<br>        .addSuperinterface(broadcastReceiverClassName)<br>        .addMethod(broadcastReceiverMethod)<br>        .build();<br>      methodBuilder.addStatement(<span class="hljs-string">&quot;$T globalBroadcastReceiver = $L&quot;</span>, broadcastReceiverClassName, innerTypeSpec);<br>      methodBuilder.addStatement(<span class="hljs-string">&quot;target.registerReceiver(globalBroadcastReceiver,globalBroadcastFilter)&quot;</span>);<br>      methodBuilder.addStatement(<span class="hljs-string">&quot;hashMap.put($L,globalBroadcastReceiver)&quot;</span>, BroadcastResponder.GLOBAL_BROADCAST);<br>    &#125;<br><br><br>    <span class="hljs-keyword">if</span> (localBroadCast.size() &gt; <span class="hljs-number">0</span>) &#123;<br>      CodeBlock.<span class="hljs-type">Builder</span> <span class="hljs-variable">caseBlockBuilder</span> <span class="hljs-operator">=</span> CodeBlock.builder().beginControlFlow(<span class="hljs-string">&quot;switch (intent.getAction())&quot;</span>);<br>      <span class="hljs-keyword">for</span> (Map.Entry&lt;String, String&gt; entry : localBroadCast.entrySet()) &#123;<br>        caseBlockBuilder.add(<span class="hljs-string">&quot;case $S:\n&quot;</span>, entry.getKey())<br>          .addStatement(<span class="hljs-string">&quot;target.$L(context,intent)&quot;</span>, entry.getValue())<br>          .addStatement(<span class="hljs-string">&quot;break&quot;</span>);<br>      &#125;<br><br><br>      caseBlockBuilder.endControlFlow();<br><br><br>      <span class="hljs-type">MethodSpec</span> <span class="hljs-variable">broadcastReceiverMethod</span> <span class="hljs-operator">=</span> MethodSpec.methodBuilder(<span class="hljs-string">&quot;onReceive&quot;</span>)<br>        .addModifiers(Modifier.PUBLIC)<br>        .addParameter(contextClassName, <span class="hljs-string">&quot;context&quot;</span>)<br>        .addParameter(intentClassName, <span class="hljs-string">&quot;intent&quot;</span>)<br>        .addCode(caseBlockBuilder.build())<br>        .returns(<span class="hljs-keyword">void</span>.class)<br>        .build();<br>      <span class="hljs-type">TypeSpec</span> <span class="hljs-variable">innerTypeSpec</span> <span class="hljs-operator">=</span> TypeSpec.anonymousClassBuilder(<span class="hljs-string">&quot;&quot;</span>)<br>        .addSuperinterface(broadcastReceiverClassName)<br>        .addMethod(broadcastReceiverMethod)<br>        .build();<br>      methodBuilder.addStatement(<span class="hljs-string">&quot;$T localBroadcastReceiver = $L&quot;</span>, broadcastReceiverClassName, innerTypeSpec);<br>      methodBuilder.addStatement(<span class="hljs-string">&quot;$T.getInstance(target).registerReceiver(localBroadcastReceiver,localBroadcastFilter)&quot;</span>, localBroadcastManagerClassName);<br>      methodBuilder.addStatement(<span class="hljs-string">&quot;hashMap.put($L,localBroadcastReceiver)&quot;</span>, BroadcastResponder.LOCAL_BROADCAST);<br>    &#125;<br><br>    methodBuilder.addStatement(<span class="hljs-string">&quot;return hashMap&quot;</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> MethodSpec.Builder <span class="hljs-title function_">generateRegisterReceiverMethodBuilder</span><span class="hljs-params">(TypeElement typeElement)</span> &#123;<br><br>  <span class="hljs-type">TypeSpecWrapper</span> <span class="hljs-variable">typeSpecWrapper</span> <span class="hljs-operator">=</span> generateTypeSpecWrapper(typeElement);<br>  MethodSpec.<span class="hljs-type">Builder</span> <span class="hljs-variable">methodBuilder</span> <span class="hljs-operator">=</span> typeSpecWrapper.getMethodBuilder(<span class="hljs-string">&quot;registerReceiver&quot;</span>);<br>  <span class="hljs-type">ClassName</span> <span class="hljs-variable">intentFilterClassName</span> <span class="hljs-operator">=</span> ClassName.bestGuess(<span class="hljs-string">&quot;android.content.IntentFilter&quot;</span>);<br>  <span class="hljs-type">ClassName</span> <span class="hljs-variable">broadcastReceiverClassName</span> <span class="hljs-operator">=</span> ClassName.bestGuess(<span class="hljs-string">&quot;android.content.BroadcastReceiver&quot;</span>);<br><br><br>  <span class="hljs-keyword">if</span> (methodBuilder == <span class="hljs-literal">null</span>) &#123;<br><br><br>    <span class="hljs-type">TypeName</span> <span class="hljs-variable">methodReturns</span> <span class="hljs-operator">=</span> ParameterizedTypeName.get(<br>      ClassName.get(HashMap.class),<br>      ClassName.get(Integer.class),<br>      broadcastReceiverClassName<br>    );<br><br><br>    methodBuilder = MethodSpec.methodBuilder(<span class="hljs-string">&quot;registerReceiver&quot;</span>)<br>      .addParameter(ClassName.get(typeElement.asType()), <span class="hljs-string">&quot;target&quot;</span>)<br>      .addModifiers(Modifier.PUBLIC, Modifier.STATIC)<br>      .addStatement(<span class="hljs-string">&quot;HashMap&lt;Integer,BroadcastReceiver&gt; hashMap = new HashMap&lt;&gt;()&quot;</span>)<br><br>      .addStatement(<span class="hljs-string">&quot;$T localBroadcastFilter = new $T()&quot;</span>, intentFilterClassName, intentFilterClassName)<br>      .addStatement(<span class="hljs-string">&quot;$T globalBroadcastFilter = new $T()&quot;</span>, intentFilterClassName, intentFilterClassName)<br>      .returns(methodReturns);<br>    typeSpecWrapper.putMethodBuilder(methodBuilder);<br>  &#125;<br>  <span class="hljs-keyword">return</span> methodBuilder;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ç»™ä½¿ç”¨è€…æä¾›è°ƒç”¨æ–¹æ³•"><a href="#ç»™ä½¿ç”¨è€…æä¾›è°ƒç”¨æ–¹æ³•" class="headerlink" title="ç»™ä½¿ç”¨è€…æä¾›è°ƒç”¨æ–¹æ³•"></a>ç»™ä½¿ç”¨è€…æä¾›è°ƒç”¨æ–¹æ³•</h4><p>è¿˜æ˜¯åœ¨apiæ¨¡å—ä¸­çš„<code>ViewInjector</code>ç±»ä¸­æ·»åŠ å¦‚ä¸‹æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;Class&lt;?&gt;, Method&gt; BROADCAST_MAP = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> HashMap&lt;Integer, BroadcastReceiver&gt; <span class="hljs-title function_">registerReceiver</span><span class="hljs-params">(Activity activity)</span> &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> findRegisterReceiverMethodForClass(activity.getClass());<br>    <span class="hljs-keyword">return</span> (HashMap&lt;Integer,BroadcastReceiver&gt;)method.invoke(<span class="hljs-literal">null</span>,activity);<br>  &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>    e.printStackTrace();<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method <span class="hljs-title function_">findRegisterReceiverMethodForClass</span><span class="hljs-params">(Class&lt;?&gt; cls)</span> &#123;<br>  <span class="hljs-type">Method</span> <span class="hljs-variable">registerReceiver</span> <span class="hljs-operator">=</span> BROADCAST_MAP.get(cls);<br>  <span class="hljs-keyword">if</span> (registerReceiver == <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      Class&lt;?&gt; bindingClass = Class.forName(cls.getName() + <span class="hljs-string">&quot;$ViewInjector&quot;</span>);<br>      registerReceiver=   bindingClass.getDeclaredMethod(<span class="hljs-string">&quot;registerReceiver&quot;</span>,cls);<br>      BROADCAST_MAP.put(cls, registerReceiver);<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>      e.printStackTrace();<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> registerReceiver;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>é¦–å…ˆï¼Œåœ¨éœ€è¦æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨çš„ç±»ä¸­æ³¨å†Œä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">HashMap&lt;Integer, BroadcastReceiver&gt; broadcastReceiverHashMap = ViewInjector.registerReceiver(<span class="hljs-built_in">this</span>);<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨<code>@BroadcastResponder</code>æ³¨è§£å¤„ç†å¹¿æ’­çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@BroadcastResponder(action = &#123;&quot;com.huangyuanblog&quot;,&quot;com.huangyuanblog.www&quot;&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onReceiveBroadcast</span><span class="hljs-params">(Context context, Intent intent)</span>&#123;<br>  Toast.makeText(context,intent.getAction(),Toast.LENGTH_SHORT).show();<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€ååœ¨åˆé€‚çš„æ—¶æœº(onDestroyæˆ–è€…onStop)ä¸­è§£æ³¨å†Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-built_in">super</span>.onDestroy();<br>  <span class="hljs-keyword">if</span>(broadcastReceiverHashMap!=<span class="hljs-literal">null</span>)&#123;<br>    <span class="hljs-keyword">if</span>(broadcastReceiverHashMap.get(BroadcastResponder.GLOBAL_BROADCAST) !=<span class="hljs-literal">null</span>)&#123;<br>      unregisterReceiver(broadcastReceiverHashMap.get(BroadcastResponder.GLOBAL_BROADCAST));<br>    &#125;<br>    <span class="hljs-keyword">if</span>(broadcastReceiverHashMap.get(BroadcastResponder.LOCAL_BROADCAST) !=<span class="hljs-literal">null</span>)&#123;<br>    LocalBroadcastManager.getInstance(<span class="hljs-built_in">this</span>).unregisterReceiver(broadcastReceiverHashMap.get(BroadcastResponder.LOCAL_BROADCAST));<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å†™è¿™ç§è‡ªå®šä¹‰æ³¨è§£éš¾åº¦å¹¶ä¸å¤§ï¼Œéº»çƒ¦çš„åœ°æ–¹åœ¨äºéœ€è¦è€ƒè™‘å¥½ç»™è°ƒç”¨è€…æä¾›ä¸€ä¸ªä»€ä¹ˆæ ·çš„æ¥å£ï¼Œç„¶åæ€ä¹ˆå®ç°æ³¨è§£çš„åŠŸèƒ½(éœ€è¦ç”Ÿæˆä»€ä¹ˆæ ·çš„è¾…åŠ©ä»£ç )</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è‡ªå®šä¹‰æ³¨è§£ï¼Œæ‰“é€ è‡ªå·±çš„æ¡†æ¶-ä¸‹ä¸‹ç¯‡</title>
    <link href="/2019/12/09/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3%EF%BC%8C%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E6%A1%86%E6%9E%B6-%E4%B8%8B%E4%B8%8B%E7%AF%87/"/>
    <url>/2019/12/09/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3%EF%BC%8C%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E6%A1%86%E6%9E%B6-%E4%B8%8B%E4%B8%8B%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<p>è¯¥ç³»åˆ—ä»‹ç»è‡ªå®šä¹‰æ³¨è§£ï¼Œå®Œæˆå¦‚ä¸‹åŠŸèƒ½ã€‚</p><ul><li><input checked="" disabled="" type="checkbox"> @BindView ä»£æ›¿  findViewById </li><li><input checked="" disabled="" type="checkbox"> @ClickResponder ä»£æ›¿ setOnClickListener</li><li><input checked="" disabled="" type="checkbox"> @LongClickResponder ä»£æ›¿ setOnLongClickListener</li><li><input checked="" disabled="" type="checkbox"> @IntentValue ä»£æ›¿ getIntent().getXXX</li><li><input checked="" disabled="" type="checkbox"> @UriValue ä»£æ›¿ getQueryParameter</li><li><input disabled="" type="checkbox"> @BroadcastResponder ä»£æ›¿ registerReceiver</li><li><input disabled="" type="checkbox"> @RouterModuleã€@RouterPath æ¥è¿›è¡Œåä¾èµ–ä¼ é€’è°ƒç”¨<br>è¯¥ç³»åˆ—æºç åœ¨<a href="https://github.com/huangyuanlove/AndroidAnnotation">https://github.com/huangyuanlove/AndroidAnnotation</a><br>å‰å‡ ç¯‡ä»‹ç»äº†<code>@BindView</code>ã€<code>@ClickResponder</code>ã€<code>@LongClickResponder</code>çš„å®ç°ï¼Œè¿™ä¸€ç¯‡ä»‹ç»ä¸€ä¸‹<code>@IntentValue</code> å’Œ<code>@UriValue</code>çš„å®ç°ã€‚</li></ul><span id="more"></span><h4 id="å‰æ"><a href="#å‰æ" class="headerlink" title="å‰æ"></a>å‰æ</h4><p>æˆ‘ä»¬çŸ¥é“æ‰§è¡Œ<code>Intent.putExtra()</code>æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šæ˜¯æŠŠæ•°æ®å¡è¿›Bundleä¸­çš„ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•æœ‰ä¸åŒçš„é‡è½½ç±»å‹ï¼Œæ–¹ä¾¿å¼€å‘è¿™å­˜å‚¨ä¸åŒçš„æ•°æ®ã€‚å½“æˆ‘ä»¬ä»ä¸­å–æ•°æ®æ—¶ï¼Œéœ€è¦è°ƒç”¨ä¸åŒçš„æ–¹æ³•æ¥è·å–ä¸åŒç±»å‹çš„æ•°æ®ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬åœ¨ç”Ÿæˆè¾…åŠ©ä»£ç æ—¶ï¼Œæ ¹æ®æ³¨è§£å­—æ®µçš„ç±»å‹æ¥è°ƒç”¨ä¸åŒçš„æ–¹æ³•ã€‚</p><p>è€ŒUriä¸­çš„èƒ½ä¼ é€’çš„å‚æ•°åªæœ‰æœ‰é™çš„å‡ ç§ç±»å‹ï¼Œæœ€å¸¸è§çš„å°±æ˜¯Stringå’Œint</p><h4 id="å£°æ˜æ³¨è§£"><a href="#å£°æ˜æ³¨è§£" class="headerlink" title="å£°æ˜æ³¨è§£"></a>å£°æ˜æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(ElementType.FIELD)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.CLASS)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> IntentValue &#123;<br><br>    <span class="hljs-type">int</span> <span class="hljs-variable">DEFAULT_TYPE</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">PARCELABLE_OBJECT</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">PARCELABLE_ARRAY_OBJECT</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">PARCELABLE_ARRAYLIST_OBJECT</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">SERIALIZABLE_OBJECT</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;<br><br><br>    String <span class="hljs-title function_">key</span><span class="hljs-params">()</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-title function_">type</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> DEFAULT_TYPE;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¿™é‡Œåœ¨æ³¨è§£ç±»ä¸­å£°æ˜äº†å‡ ç§ç±»å‹ï¼Œæ¥é…åˆæ³¨è§£ä½¿ç”¨ï¼Œä¸»è¦æ˜¯ä¸ºäº†åœ¨ç”Ÿæˆè¾…åŠ©ä»£ç æ—¶ç®€å•ï¼Œå› ä¸º<code>javax.lang.model.type.TypeKind</code>åªå£°æ˜äº†æœ‰é™çš„å‡ ç§ç±»å‹ï¼Œå…¶ä½™çš„éœ€è¦æˆ‘ä»¬è‡ªå·±å–åˆ¤æ–­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(ElementType.FIELD)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.CLASS)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> UriValue &#123;<br>    String <span class="hljs-title function_">key</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="å¤„ç†æ³¨è§£é€»è¾‘"><a href="#å¤„ç†æ³¨è§£é€»è¾‘" class="headerlink" title="å¤„ç†æ³¨è§£é€»è¾‘"></a>å¤„ç†æ³¨è§£é€»è¾‘</h4><p>æˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ä¸Šä¸€ç¯‡ä¸­çš„æ³¨è§£å¤„ç†å™¨ï¼Œéœ€è¦æ·»åŠ ä¸¤ä¸ªå±æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> Map&lt;TypeElement, List&lt;Element&gt;&gt; intentValueMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><span class="hljs-keyword">private</span> Map&lt;TypeElement, List&lt;Element&gt;&gt; uriValueMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br></code></pre></td></tr></table></figure><p>åœ¨ <code>getSupportedAnnotationTypes</code>æ–¹æ³•ä¸­æ·»åŠ æ”¯æŒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">set.add(IntentValue.class.getCanonicalName());<br>set.add(UriValue.class.getCanonicalName());<br></code></pre></td></tr></table></figure><p>åœ¨<code>process</code>æ–¹æ³•ä¸­åŠ å…¥æˆ‘ä»¬çš„æ³¨è§£å¤„ç†é€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java">intentValueMap.clear();<br>uriValueMap.clear();<br><br>Set&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Element</span>&gt; intentValueSet = roundEnvironment.getElementsAnnotatedWith(IntentValue.class);<br>Set&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Element</span>&gt; uriValueSet = roundEnvironment.getElementsAnnotatedWith(UriValue.class);<br><br>collectIntentValueInfo(intentValueSet);<br>collectUriValueMapInfo(uriValueSet);<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">collectIntentValueInfo</span><span class="hljs-params">(Set&lt;? extends Element&gt; elements)</span> &#123;<br>        <span class="hljs-keyword">for</span> (Element element : elements) &#123;<br>            <span class="hljs-type">TypeElement</span> <span class="hljs-variable">typeElement</span> <span class="hljs-operator">=</span> (TypeElement) element.getEnclosingElement();<br>            List&lt;Element&gt; elementList = intentValueMap.get(typeElement);<br>            <span class="hljs-keyword">if</span> (elementList == <span class="hljs-literal">null</span>) &#123;<br>                elementList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>                intentValueMap.put(typeElement, elementList);<br>            &#125;<br>            elementList.add(element);<br>        &#125;<br>    &#125;<br><br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">collectUriValueMapInfo</span><span class="hljs-params">(Set&lt;? extends Element&gt; elements)</span> &#123;<br>    <span class="hljs-keyword">for</span> (Element element : elements) &#123;<br>        <span class="hljs-type">TypeElement</span> <span class="hljs-variable">typeElement</span> <span class="hljs-operator">=</span> (TypeElement) element.getEnclosingElement();<br>        List&lt;Element&gt; elementList = uriValueMap.get(typeElement);<br>        <span class="hljs-keyword">if</span> (elementList == <span class="hljs-literal">null</span>) &#123;<br>            elementList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>            uriValueMap.put(typeElement, elementList);<br>        &#125;<br>        elementList.add(element);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„è¿™äº›æ”¶é›†ä¿¡æ¯çš„å·¥ä½œéƒ½å·®ä¸å¤šï¼ŒæŠŠæˆ‘ä»¬éœ€è¦çš„æ•°æ®å­˜æ”¾åœ¨mapä¸­ã€‚</p><p>åœ¨<code>generateCode()</code>æ–¹æ³•ä¸­è°ƒç”¨</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-built_in">generateIntentValueCode</span>();<br><span class="hljs-built_in">generateUriValueCode</span>();<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">generateIntentValueCode</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">for</span> (TypeElement typeElement : intentValueMap.keySet()) &#123;<br>        MethodSpec.<span class="hljs-type">Builder</span> <span class="hljs-variable">methodBuilder</span> <span class="hljs-operator">=</span> generateParseBundleMethodCode(typeElement);<br><br>        List&lt;Element&gt; elements = intentValueMap.get(typeElement);<br>        <span class="hljs-keyword">for</span> (Element element : elements) &#123;<br>            processorIntentValue(element, methodBuilder);<br>        &#125;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">generateUriValueCode</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">for</span> (TypeElement typeElement : uriValueMap.keySet()) &#123;<br>        MethodSpec.<span class="hljs-type">Builder</span> <span class="hljs-variable">methodBuilder</span> <span class="hljs-operator">=</span> generateParseUriMethodCode(typeElement);<br><br>        List&lt;Element&gt; elements = uriValueMap.get(typeElement);<br>        <span class="hljs-keyword">for</span> (Element element : elements) &#123;<br>            processorUriValue(element, methodBuilder);<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹æ¯”è¾ƒç®€å•çš„å¤„ç†Uriå‚æ•°çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processorUriValue</span><span class="hljs-params">(Element element, MethodSpec.Builder methodBuilder)</span> &#123;<br>    <span class="hljs-type">VariableElement</span> <span class="hljs-variable">variableElement</span> <span class="hljs-operator">=</span> (VariableElement) element;<br>    <br>    <span class="hljs-comment">//æ³¨è§£çš„å­—æ®µåå­—</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">varName</span> <span class="hljs-operator">=</span> variableElement.getSimpleName().toString();<br><br>    <span class="hljs-type">UriValue</span> <span class="hljs-variable">uriValue</span> <span class="hljs-operator">=</span> variableElement.getAnnotation(UriValue.class);<br><br>    <span class="hljs-comment">//è·å–åˆ°æ³¨è§£çš„keyï¼Œä»Uriä¸­è·å–å¯¹åº”çš„å€¼</span><br>    methodBuilder.addStatement(<span class="hljs-string">&quot;temp = uri.getQueryParameter($S)&quot;</span>, uriValue.key());<br>    <br>    <span class="hljs-comment">//å¦‚æœæ˜¯Stringç±»å‹ï¼Œç›´æ¥èµ‹å€¼</span><br>    <span class="hljs-keyword">if</span> (element.asType().toString().equals(<span class="hljs-string">&quot;java.lang.String&quot;</span>)) &#123;<br>        methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L=temp&quot;</span>,varName);<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">//å…¶ä»–ç±»å‹éœ€è¦è½¬æ¢ä¸€ä¸‹ï¼Œç„¶åå†èµ‹å€¼</span><br>        <span class="hljs-keyword">switch</span> (element.asType().getKind())&#123;<br>            <span class="hljs-keyword">case</span> BOOLEAN:<br>                methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L=Boolean.valueOf(temp)&quot;</span>,varName);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> INT:<br>                methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L= Integer.valueOf(temp)&quot;</span>,varName);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> DOUBLE:<br>                methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L= Double.valueOf(temp)&quot;</span>,varName);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> FLOAT:<br>                methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L= Float.valueOf(temp)&quot;</span>,varName);<br>                <span class="hljs-keyword">break</span>;<br><br>            <span class="hljs-keyword">case</span> LONG:<br>                methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L= Long.valueOf(temp)&quot;</span>,varName);<br>                <span class="hljs-keyword">break</span>;<br><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åŸºäºåŒæ ·çš„æ–¹å¼ï¼Œæˆ‘ä»¬æ¥å¤„ç†ä¸€ä¸‹IntentValueï¼Œå› ä¸ºBundleä¸­å¯ä»¥å­˜å‚¨çš„æ•°æ®ç±»å‹è¾ƒå¤šï¼Œæ–¹æ³•æ¯”è¾ƒé•¿ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processorIntentValue</span><span class="hljs-params">(Element element, MethodSpec.Builder methodBuilder)</span> &#123;<br>    <span class="hljs-type">VariableElement</span> <span class="hljs-variable">variableElement</span> <span class="hljs-operator">=</span> (VariableElement) element;<br>    <br>    <span class="hljs-comment">//æ³¨è§£å­—æ®µçš„åå­—</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">varName</span> <span class="hljs-operator">=</span> variableElement.getSimpleName().toString();<br>    <span class="hljs-comment">//æ³¨è§£å­—æ®µçš„ç±»å‹å</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">varType</span> <span class="hljs-operator">=</span> variableElement.asType().toString();<br><br><br>    <span class="hljs-type">IntentValue</span> <span class="hljs-variable">intentValue</span> <span class="hljs-operator">=</span> variableElement.getAnnotation(IntentValue.class);<br><br><br>    methodBuilder.beginControlFlow(<span class="hljs-string">&quot;if(bundle.containsKey($S))&quot;</span>, intentValue.key());<br><br>    <span class="hljs-keyword">if</span> (intentValue.type() == IntentValue.DEFAULT_TYPE) &#123;<br><br><span class="hljs-comment">//åŸºæœ¬æ•°æ®ç±»å‹å¯ä»¥ç›´æ¥åˆ¤æ–­ï¼Œä¸éœ€è¦ç±»å‹å</span><br>        <span class="hljs-keyword">switch</span> (element.asType().getKind()) &#123;<br>            <span class="hljs-keyword">case</span> BOOLEAN:<br>                methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = bundle.getBoolean($S)&quot;</span>, varName, intentValue.key());<br>                <span class="hljs-keyword">break</span>;<br><br><br>            <span class="hljs-keyword">case</span> SHORT:<br>                methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = bundle.getShort($S)&quot;</span>, varName, intentValue.key());<br>                <span class="hljs-keyword">break</span>;<br><br>            <span class="hljs-keyword">case</span> BYTE:<br>                methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = bundle.getByte($S)&quot;</span>, varName, intentValue.key());<br>                <span class="hljs-keyword">break</span>;<br><br>            <span class="hljs-keyword">case</span> INT:<br>                methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = bundle.getInt($S)&quot;</span>, varName, intentValue.key());<br>                <span class="hljs-keyword">break</span>;<br><br>            <span class="hljs-keyword">case</span> CHAR:<br>                methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = bundle.getChar($S)&quot;</span>, varName, intentValue.key());<br>                <span class="hljs-keyword">break</span>;<br><br>            <span class="hljs-keyword">case</span> LONG:<br>                methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = bundle.getLong($S)&quot;</span>, varName, intentValue.key());<br>                <span class="hljs-keyword">break</span>;<br><br>            <span class="hljs-keyword">case</span> FLOAT:<br>                methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = bundle.getFloat($S)&quot;</span>, varName, intentValue.key());<br>                <span class="hljs-keyword">break</span>;<br><br>            <span class="hljs-keyword">case</span> DOUBLE:<br>                methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = bundle.getDouble($S)&quot;</span>, varName, intentValue.key());<br>                <span class="hljs-keyword">break</span>;<br><br>                <span class="hljs-comment">//ARRAYç±»å‹åˆ†å¥½å¤šä¸­ï¼Œéœ€è¦ç±»å‹çš„åå­—å…·ä½“åˆ¤æ–­</span><br>            <span class="hljs-keyword">case</span> ARRAY:<br>                <span class="hljs-keyword">switch</span> (element.asType().toString()) &#123;<br>                    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;byte[]&quot;</span>:<br>                        methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = bundle.getByteArray($S)&quot;</span>, varName, intentValue.key());<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;short[]&quot;</span>:<br><br>                        methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = bundle.getShortArray($S)&quot;</span>, varName, intentValue.key());<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;boolean[]&quot;</span>:<br>                        methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = bundle.getBooleanArray($S)&quot;</span>, varName, intentValue.key());<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;int[]&quot;</span>:<br>                        methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = bundle.getIntArray($S)&quot;</span>, varName, intentValue.key());<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;long[]&quot;</span>:<br>                        methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = bundle.getLongArray($S)&quot;</span>, varName, intentValue.key());<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;char[]&quot;</span>:<br>                        methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = bundle.getCharArray($S)&quot;</span>, varName, intentValue.key());<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;java.lang.CharSequence[]&quot;</span>:<br>                        methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = bundle.getCharSequenceArray($S)&quot;</span>, varName, intentValue.key());<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;float[]&quot;</span>:<br>                        methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = bundle.getFloatArray($S)&quot;</span>, varName, intentValue.key());<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;double[]&quot;</span>:<br>                        methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = bundle.getDoubleArray($S)&quot;</span>, varName, intentValue.key());<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;java.lang.String[]&quot;</span>:<br>                        methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = bundle.getStringArray($S)&quot;</span>, varName, intentValue.key());<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">default</span>:<br>                        methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = ($L) bundle.getParcelableArray($S)&quot;</span>, varName, varType, intentValue.key());<br>                        <span class="hljs-keyword">break</span>;<br><br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br><br>                <span class="hljs-comment">//å…¶ä½™çš„ä¼šè¢«å½“åš`DECLARED`ç±»å‹</span><br>            <span class="hljs-keyword">case</span> DECLARED:<br>                <span class="hljs-keyword">switch</span> (element.asType().toString()) &#123;<br>                    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;java.util.ArrayList&lt;java.lang.Integer&gt;&quot;</span>:<br>                        methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = bundle.getIntegerArrayList($S)&quot;</span>, varName, intentValue.key());<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;java.lang.CharSequence&quot;</span>:<br><br>                        methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = bundle.getCharSequence($S)&quot;</span>, varName, intentValue.key());<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;java.util.ArrayList&lt;java.lang.CharSequence&gt;&quot;</span>:<br>                        methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = bundle.getCharSequenceArrayList($S)&quot;</span>, varName, intentValue.key());<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;java.lang.String&quot;</span>:<br>                        methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = bundle.getString($S)&quot;</span>, varName, intentValue.key());<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;java.util.ArrayList&lt;java.lang.String&gt;&quot;</span>:<br>                        methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = bundle.getStringArrayList($S)&quot;</span>, varName, intentValue.key());<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">default</span>:<br><br>                        <span class="hljs-keyword">break</span>;<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">//è¿™é‡Œçš„å°±æ˜¯æ–¹ä¾¿é€šè¿‡ç±»å‹æˆ–è€…ç±»å‹åæ¥åˆ¤æ–­çš„ï¼Œé€šè¿‡æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ç±»å‹æ¥åšåˆ¤æ–­</span><br>        <span class="hljs-keyword">switch</span> (intentValue.type()) &#123;<br>            <span class="hljs-keyword">case</span> IntentValue.SERIALIZABLE_OBJECT:<br>                methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L  = ($L) bundle.getSerializable($S)&quot;</span>, varName, varType, intentValue.key());<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> IntentValue.PARCELABLE_OBJECT:<br>                methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L  = bundle.getParcelable($S)&quot;</span>, varName, intentValue.key());<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> IntentValue.PARCELABLE_ARRAY_OBJECT:<br><br>                methodBuilder.addStatement(<span class="hljs-string">&quot; android.os.Parcelable[] temp = bundle.getParcelableArray($S)&quot;</span>, intentValue.key());<br>                methodBuilder.beginControlFlow(<span class="hljs-string">&quot;if(temp!=null &amp;&amp; temp.length&gt;0)&quot;</span>);<br>                methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = new $L[temp.length]&quot;</span>, varName, varType.substring(<span class="hljs-number">0</span>, varType.length() - <span class="hljs-number">2</span>));<br>                methodBuilder.beginControlFlow(<span class="hljs-string">&quot;for(int i = 0 ; i &lt; temp.length;i++)&quot;</span>);<br>                methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L[i] = ($L) temp[i]&quot;</span>, varName, varType.substring(<span class="hljs-number">0</span>, varType.length() - <span class="hljs-number">2</span>));<br>                methodBuilder.endControlFlow();<br>                methodBuilder.endControlFlow();<br><br><br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> IntentValue.PARCELABLE_ARRAYLIST_OBJECT:<br>                methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L  = bundle.getParcelableArrayList($S)&quot;</span>, varName, intentValue.key());<br><br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    methodBuilder.endControlFlow();<br><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ç»™ä½¿ç”¨è€…æä¾›è°ƒç”¨æ–¹æ³•"><a href="#ç»™ä½¿ç”¨è€…æä¾›è°ƒç”¨æ–¹æ³•" class="headerlink" title="ç»™ä½¿ç”¨è€…æä¾›è°ƒç”¨æ–¹æ³•"></a>ç»™ä½¿ç”¨è€…æä¾›è°ƒç”¨æ–¹æ³•</h4><p>è¿˜æ˜¯åœ¨apiæ¨¡å—ä¸­çš„<code>ViewInjector</code>ç±»ä¸­æ·»åŠ å¦‚ä¸‹æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;Class&lt;?&gt;, Method&gt; BUNDLES = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parseBundle</span><span class="hljs-params">(Activity activity)</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> findParseBundleMethodForClass(activity.getClass(),activity.getClass());<br>        method.invoke(<span class="hljs-literal">null</span>,activity,activity.getIntent()==<span class="hljs-literal">null</span>?<span class="hljs-literal">null</span>:activity.getIntent().getExtras());<br>    &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>        e.printStackTrace();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parseBundle</span><span class="hljs-params">(Fragment fragment)</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span>findParseBundleMethodForClass(fragment.getClass(),fragment.getClass());<br>        method .invoke(<span class="hljs-literal">null</span>,fragment,fragment.getArguments());<br><br>    &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>        e.printStackTrace();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method <span class="hljs-title function_">findParseBundleMethodForClass</span><span class="hljs-params">(Class&lt;?&gt; cls,Class clazz)</span> &#123;<br>    <span class="hljs-type">Method</span> <span class="hljs-variable">parseBundle</span> <span class="hljs-operator">=</span> BUNDLES.get(cls);<br>    <span class="hljs-keyword">if</span> (parseBundle == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Class&lt;?&gt; bindingClass = Class.forName(cls.getName() + <span class="hljs-string">&quot;$ViewInjector&quot;</span>);<br>            parseBundle=   bindingClass.getDeclaredMethod(<span class="hljs-string">&quot;parseBundle&quot;</span>,clazz, Bundle.class);<br>            BUNDLES.put(cls, parseBundle);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> parseBundle;<br>&#125;<br><br><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;Class&lt;?&gt;, Method&gt; URIS = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parseUri</span><span class="hljs-params">(Activity activity)</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> findParseUriMethodForClass(activity.getClass(),activity.getClass());<br>        method.invoke(<span class="hljs-literal">null</span>,activity,activity.getIntent()==<span class="hljs-literal">null</span>?<span class="hljs-literal">null</span>:activity.getIntent().getData());<br>    &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>        e.printStackTrace();<br>    &#125;<br>&#125;<br><br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method <span class="hljs-title function_">findParseUriMethodForClass</span><span class="hljs-params">(Class&lt;?&gt; cls,Class clazz)</span> &#123;<br>    <span class="hljs-type">Method</span> <span class="hljs-variable">parseUri</span> <span class="hljs-operator">=</span> URIS.get(cls);<br>    <span class="hljs-keyword">if</span> (parseUri == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Class&lt;?&gt; bindingClass = Class.forName(cls.getName() + <span class="hljs-string">&quot;$ViewInjector&quot;</span>);<br>            parseUri=  bindingClass.getDeclaredMethod(<span class="hljs-string">&quot;parseUri&quot;</span>,clazz, Uri.class);<br>            URIS.put(cls, parseUri);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> parseUri;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>åªéœ€è¦åœ¨å¯¹åº”çš„ç±»ä¸­è°ƒç”¨<code>ViewInjector.parseBundle(this);</code>å’Œ<code>ViewInjector.parseUri(this);</code>æ–¹æ³•å°±å¥½äº†</p><p>å…¶å®åº”è¯¥æŠŠUriValueå½“æˆç»ƒæ‰‹è®©å¤§å®¶è‡ªå·±å†™çš„ã€‚ã€‚ã€‚ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è‡ªå®šä¹‰æ³¨è§£ï¼Œæ‰“é€ è‡ªå·±çš„æ¡†æ¶-ä¸‹ç¯‡</title>
    <link href="/2019/12/04/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3%EF%BC%8C%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E6%A1%86%E6%9E%B6-%E4%B8%8B%E7%AF%87/"/>
    <url>/2019/12/04/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3%EF%BC%8C%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E6%A1%86%E6%9E%B6-%E4%B8%8B%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<p>è¯¥ç³»åˆ—ä»‹ç»è‡ªå®šä¹‰æ³¨è§£ï¼Œå®Œæˆå¦‚ä¸‹åŠŸèƒ½ã€‚</p><ul><li><input checked="" disabled="" type="checkbox"> @BindView ä»£æ›¿  findViewById </li><li><input checked="" disabled="" type="checkbox"> @ClickResponder ä»£æ›¿ setOnClickListener</li><li><input checked="" disabled="" type="checkbox"> @LongClickResponder ä»£æ›¿ setOnLongClickListener</li><li><input disabled="" type="checkbox"> @IntentValue ä»£æ›¿ getIntent().getXXX</li><li><input disabled="" type="checkbox"> @UriValue ä»£æ›¿ getQueryParameter</li><li><input disabled="" type="checkbox"> @BroadcastResponder ä»£æ›¿ registerReceiver</li><li><input disabled="" type="checkbox"> @RouterModuleã€@RouterPath æ¥è¿›è¡Œåä¾èµ–ä¼ é€’è°ƒç”¨</li></ul><p>è¯¥ç³»åˆ—æºç åœ¨<a href="https://github.com/huangyuanlove/AndroidAnnotation">https://github.com/huangyuanlove/AndroidAnnotation</a></p><p>å‰ä¸¤ç¯‡ä»‹ç»äº†ä¸€ä¸¢ä¸¢è‡ªå®šä¹‰æ³¨è§£è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°çš„ä¸œè¥¿ï¼Œç°åœ¨æˆ‘ä»¬æ­£å¼å¼€å§‹å†™æ¡†æ¶ã€‚</p><span id="more"></span><h4 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h4><p>ä¸€èˆ¬æ¥è®²ï¼Œæ³¨è§£ç±»æ¡†æ¶(åœ¨Android)ä¼šåˆ†æˆä¸‰ä¸ªéƒ¨åˆ†ï¼Œ</p><ul><li><p>annotationæ¨¡å—(java lib)</p><p>ç”¨æ¥å­˜æ”¾æ³¨è§£ç±»çš„ï¼Œå¯¹åº”gradleå¼•ç”¨<code>annotationProcessor xxxx</code></p></li><li><p>compileræ¨¡å—(java lib)</p><p>ç”¨æ¥å­˜æ”¾ç”Ÿæˆè¾…åŠ©ç±»çš„ï¼Œå¯¹åº”gradleå¼•ç”¨<code>implementation  xxxx</code></p></li><li><p>apiæ¨¡å—(Android lib)</p><p>ç”¨æ¥æä¾›ç»™ä½¿ç”¨è€…çš„æ¥å£ï¼Œå¯¹åº”gradleå¼•ç”¨<code>implementation  xxxx</code>ï¼Œè¿™ä¸ªæ¨¡å—ä¸­ä¼šå­˜åœ¨å¤§é‡çš„åå°„è°ƒç”¨ï¼Œä¸»è¦æ˜¯è°ƒç”¨ç”Ÿæˆçš„è¾…åŠ©ç±»ä¸­çš„æ–¹æ³•ã€‚</p></li><li><p>example(lib)æ¨¡å—å’Œapp(application)æ¨¡å—</p><p>ç”¨æ¥å­˜æ”¾demoçš„ï¼Œä¸€èˆ¬ä¼šåŒºåˆ†åœ¨libå’Œapplicationä¸­çš„ä½¿ç”¨</p></li></ul><p>ä¹Ÿæœ‰ä¸€äº›æ¡†æ¶ä¼šæŠŠapiæ¨¡å—å’Œcompileræ¨¡å—æ”¾åœ¨ä¸€å—ï¼Œæ— æ‰€è°“äº†ã€‚ã€‚ã€‚ã€‚</p><p>é¦–å…ˆæ¥åˆ›å»ºæ–°çš„å·¥ç¨‹ï¼Œç„¶ååˆ›å»ºå¯¹åº”çš„æ¨¡å—ï¼Œæ³¨æ„ï¼š<strong>annotationå’Œcompileræ¨¡å—æ˜¯java libï¼Œä¸è¦åˆ›å»ºæˆAndroid lib</strong></p><p><strong>æˆ‘ä»¬å…ˆæ¥å®ç°ä¸€ä¸‹<code>BindView </code>å’Œ<code>ClickResponder </code>è¿™ä¸¤ä¸ªæ³¨è§£</strong></p><h4 id="å£°æ˜æ³¨è§£"><a href="#å£°æ˜æ³¨è§£" class="headerlink" title="å£°æ˜æ³¨è§£"></a>å£°æ˜æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.lang.annotation.ElementType;<br><span class="hljs-keyword">import</span> java.lang.annotation.Retention;<br><span class="hljs-keyword">import</span> java.lang.annotation.RetentionPolicy;<br><span class="hljs-keyword">import</span> java.lang.annotation.Target;<br><br><span class="hljs-meta">@Target(ElementType.FIELD)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.CLASS)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> BindView &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-title function_">id</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> -<span class="hljs-number">1</span>;<br>    <span class="hljs-comment">//åœ¨Android libä¸­ç”Ÿæˆçš„Ræ–‡ä»¶ä¸­èµ„æºidä¸æ˜¯finalç±»å‹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¢ä¸ªæ€è·¯ï¼Œ</span><br>    <span class="hljs-comment">//é€šè¿‡`getResources().getIdentifier()`æ¥å®ç°</span><br>    String <span class="hljs-title function_">idStr</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;&quot;</span>; <br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.lang.annotation.ElementType;<br><span class="hljs-keyword">import</span> java.lang.annotation.Retention;<br><span class="hljs-keyword">import</span> java.lang.annotation.RetentionPolicy;<br><span class="hljs-keyword">import</span> java.lang.annotation.Target;<br><br><span class="hljs-meta">@Target(ElementType.METHOD)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.CLASS)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> ClickResponder &#123;<br>    <span class="hljs-type">int</span>[] id() <span class="hljs-keyword">default</span> &#123;&#125;;<br>    String[] idStr() <span class="hljs-keyword">default</span> &#123;<span class="hljs-string">&quot;&quot;</span>&#125;;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="å£°æ˜æ³¨è§£å¤„ç†å™¨"><a href="#å£°æ˜æ³¨è§£å¤„ç†å™¨" class="headerlink" title="å£°æ˜æ³¨è§£å¤„ç†å™¨"></a>å£°æ˜æ³¨è§£å¤„ç†å™¨</h4><p>å£°æ˜ä¸€ä¸ªprocesserç±»ç»§æ‰¿<code>avax.annotation.processing.AbstractProcessor</code>ç±»ï¼Œå¯¹è¿™ä¸ªç±»ä½¿ç”¨<code>@AutoService(Processor.class)</code>æ³¨è§£ã€‚<br>æˆ‘ä»¬éœ€è¦å®ç°å››ä¸ªæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@AutoService(Processor.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewInjectProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractProcessor</span>&#123;<br><br>     <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ¯ä¸ªAnnotation Processorå¿…é¡»æœ‰ä¸€ä¸ªç©ºçš„æ„é€ å‡½æ•°ã€‚</span><br><span class="hljs-comment">     * ç¼–è¯‘æœŸé—´ï¼Œinit()ä¼šè‡ªåŠ¨è¢«æ³¨è§£å¤„ç†å·¥å…·è°ƒç”¨ï¼Œå¹¶ä¼ å…¥ProcessingEnvironmentå‚æ•°ï¼Œ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(ProcessingEnvironment processingEnvironment)</span> &#123;<br>        <span class="hljs-built_in">super</span>.init(processingEnvironment);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”¨äºæŒ‡å®šè¯¥å¤„ç†å™¨æ”¯æŒå“ªäº›æ³¨è§£</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Set&lt;String&gt; <span class="hljs-title function_">getSupportedAnnotationTypes</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getSupportedAnnotationTypes();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”¨äºæŒ‡å®šæ”¯æŒçš„javaç‰ˆæœ¬ï¼Œ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> SourceVersion <span class="hljs-title function_">getSupportedSourceVersion</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> SourceVersion.latestSupported();<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Annotation Processoræ‰«æå‡ºçš„ç»“æœä¼šå­˜å‚¨è¿›roundEnvironmentä¸­ï¼Œå¯ä»¥åœ¨è¿™é‡Œè·å–åˆ°æ³¨è§£å†…å®¹ï¼Œç¼–å†™ä½ çš„æ“ä½œé€»è¾‘ã€‚</span><br><span class="hljs-comment">     * æ³¨æ„:process()å‡½æ•°ä¸­ä¸èƒ½ç›´æ¥è¿›è¡Œå¼‚å¸¸æŠ›å‡º,å¹¶ä¸”è¯¥æ–¹æ³•ä¼šæ‰§è¡Œå¤šæ¬¡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">process</span><span class="hljs-params">(Set&lt;? extends TypeElement&gt; set, RoundEnvironment roundEnvironment)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="å¤„ç†æ³¨è§£é€»è¾‘"><a href="#å¤„ç†æ³¨è§£é€»è¾‘" class="headerlink" title="å¤„ç†æ³¨è§£é€»è¾‘"></a>å¤„ç†æ³¨è§£é€»è¾‘</h4><p>å£°æ˜å‡ ä¸ªå±æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> Elements elementUtils;<br><span class="hljs-keyword">private</span> Map&lt;TypeElement, List&lt;Element&gt;&gt; bindViewMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><span class="hljs-keyword">private</span> Map&lt;TypeElement, List&lt;Element&gt;&gt; clickResponderMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br></code></pre></td></tr></table></figure><p>åœ¨<code>init</code>æ–¹æ³•ä¸­åˆå§‹åŒ–ç”¨åˆ°çš„å­—æ®µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(ProcessingEnvironment processingEnv)</span> &#123;<br>    <span class="hljs-built_in">super</span>.init(processingEnv);<br>    elementUtils = processingEnv.getElementUtils();<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨<code>getSupportedSourceVersion</code>æ–¹æ³•ä¸­è¿”å›æ”¯æŒçš„javaç‰ˆæœ¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> SourceVersion <span class="hljs-title function_">getSupportedSourceVersion</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> SourceVersion.RELEASE_7;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ <code>getSupportedAnnotationTypes</code>æ–¹æ³•ä¸­è¿”å›æ”¯æŒçš„æ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Set&lt;String&gt; <span class="hljs-title function_">getSupportedAnnotationTypes</span><span class="hljs-params">()</span> &#123;<br>    Set&lt;String&gt; set = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashSet</span>&lt;&gt;();<br>    set.add(BindView.class.getCanonicalName());<br>    set.add(ClickResponder.class.getCanonicalName());<br>    <span class="hljs-keyword">return</span> set;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¸ºäº†æ–¹ä¾¿ä»¥ååœ¨è¾…åŠ©ç±»ä¸­æ·»åŠ å„ç§æ–¹æ³•ï¼Œå®šä¹‰äº†<code>TypeSpecWrapper</code>ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TypeSpecWrapper</span> &#123;<br><br>    <span class="hljs-keyword">private</span> TypeSpec.Builder typeSpecBuilder;<br>    <span class="hljs-keyword">private</span> String packageName;<br>    <span class="hljs-keyword">private</span> HashMap&lt;String, MethodSpec.Builder&gt; methodBuildMap;<br><br>    <span class="hljs-keyword">public</span> TypeSpec <span class="hljs-title function_">build</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">for</span>(Map.Entry&lt;String,MethodSpec.Builder&gt; entry:methodBuildMap.entrySet())&#123;<br>            typeSpecBuilder.addMethod(entry.getValue().build());<br>        &#125;<br>        <span class="hljs-keyword">return</span> typeSpecBuilder.build();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> TypeSpec.Builder <span class="hljs-title function_">setTypeSpecBuilder</span><span class="hljs-params">(TypeSpec.Builder builder)</span>&#123;<br>        <span class="hljs-built_in">this</span>.typeSpecBuilder = builder;<br>        <span class="hljs-keyword">return</span> builder;<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> MethodSpec.Builder <span class="hljs-title function_">putMethodBuilder</span><span class="hljs-params">(MethodSpec.Builder builder)</span>&#123;<br><br>        <span class="hljs-keyword">return</span> methodBuildMap.put(builder.build().name,builder);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> MethodSpec.Builder <span class="hljs-title function_">getMethodBuilder</span><span class="hljs-params">(String methodName)</span>&#123;<br>        <span class="hljs-keyword">return</span> methodBuildMap.get(methodName);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeTo</span><span class="hljs-params">(Filer filer)</span>&#123;<br>        <span class="hljs-type">JavaFile</span> <span class="hljs-variable">javaFile</span> <span class="hljs-operator">=</span> JavaFile.builder(packageName, build())<br>                .build();<br>        <span class="hljs-keyword">try</span> &#123;<br>            javaFile.writeTo(filer);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Map&lt;String, MethodSpec.Builder&gt; getMethodBuildMap()&#123;<br>        <span class="hljs-keyword">return</span>  methodBuildMap;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> TypeSpec.Builder <span class="hljs-title function_">getTypeSpecBuilder</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> typeSpecBuilder;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TypeSpecWrapper</span><span class="hljs-params">(TypeSpec.Builder typeSpecBuilder,String packageName)</span>&#123;<br>        <span class="hljs-built_in">this</span>.typeSpecBuilder = typeSpecBuilder;<br>        <span class="hljs-built_in">this</span>.packageName = packageName;<br>        methodBuildMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p>åœ¨<code>process</code>ä¸­ç”Ÿæˆè¾…åŠ©ç±»å¹¶å†™å…¥æ–‡ä»¶,</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">process</span><span class="hljs-params">(Set&lt;? extends TypeElement&gt; set, RoundEnvironment roundEnvironment)</span> &#123;<br>bindViewMap.clear();<br>clickResponderMap.clear();<br>Set&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Element</span>&gt; bindViewSet = roundEnvironment.getElementsAnnotatedWith(BindView.class);<br>Set&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Element</span>&gt; onClickSet = roundEnvironment.getElementsAnnotatedWith(ClickResponder.class);<br><br><span class="hljs-comment">//æ”¶é›†BindViewå¯¹åº”çš„ä¿¡æ¯</span><br>collectBindViewInfo(bindViewSet);<br><span class="hljs-comment">//æ”¶é›†ClickResponderå¯¹åº”çš„ä¿¡æ¯</span><br>collectClickResponderInfo(onClickSet);<br><span class="hljs-comment">//ç”Ÿæˆè¾…åŠ©ç±»ä»£ç </span><br>generateCode();<br><span class="hljs-comment">//å°†ç”Ÿæˆä»£ç å†™å…¥æ–‡ä»¶</span><br><span class="hljs-keyword">for</span> (Map.Entry&lt;TypeElement, TypeSpecWrapper&gt; entry : typeSpecWrapperMap.entrySet()) &#123;<br>          entry.getValue().writeTo(processingEnv.getFiler());<br>      &#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å› ä¸ºä¼šæœ‰å¤šä¸ªç±»ä½¿ç”¨åŒä¸€ä¸ªæ³¨è§£ï¼Œè¿™é‡Œéœ€è¦æ ¹æ®ä½¿ç”¨è¯¥æ³¨è§£çš„ç±»åæ¥ä¿å­˜å¯¹åº”çš„æ³¨è§£ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">collectBindViewInfo</span><span class="hljs-params">(Set&lt;? extends Element&gt; elements)</span> &#123;<br>    <span class="hljs-keyword">for</span> (Element element : elements) &#123;<br>        <span class="hljs-type">TypeElement</span> <span class="hljs-variable">typeElement</span> <span class="hljs-operator">=</span> (TypeElement) element.getEnclosingElement();<br>        List&lt;Element&gt; elementList = bindViewMap.get(typeElement);<br>        <span class="hljs-keyword">if</span> (elementList == <span class="hljs-literal">null</span>) &#123;<br>            elementList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>            bindViewMap.put(typeElement, elementList);<br>        &#125;<br>        elementList.add(element);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">collectClickResponderInfo</span><span class="hljs-params">(Set&lt;? extends Element&gt; elements)</span> &#123;<br>    <span class="hljs-keyword">for</span> (Element element : elements) &#123;<br>        <span class="hljs-type">TypeElement</span> <span class="hljs-variable">typeElement</span> <span class="hljs-operator">=</span> (TypeElement) element.getEnclosingElement();<br>        List&lt;Element&gt; elementList = clickResponderMap.get(typeElement);<br>        <span class="hljs-keyword">if</span> (elementList == <span class="hljs-literal">null</span>) &#123;<br>            elementList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>            clickResponderMap.put(typeElement, elementList);<br>        &#125;<br>        elementList.add(element);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ç”Ÿæˆè¾…åŠ©ç±»çš„å†…å®¹ï¼Œè¿™é‡Œä¸ºäº†ç®€å•ï¼Œå°†<code>BindView</code>ã€<code>ClickResponder</code>ä»¥åŠä¹‹åçš„<code>LongClickResponderCode</code>æ³¨è§£å¤„ç†éƒ½æ”¾åœ¨äº†<code>bind</code>æ–¹æ³•ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">generateCode</span><span class="hljs-params">()</span> &#123;<br>    generateBindViewCode();<br>    generateClickResponderCode();<br> &#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">generateBindViewCode</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">for</span> (TypeElement typeElement : bindViewMap.keySet()) &#123;<br>        MethodSpec.<span class="hljs-type">Builder</span> <span class="hljs-variable">methodBuilder</span> <span class="hljs-operator">=</span> generateBindMethodBuilder(typeElement);<br><br>        List&lt;Element&gt; elements = bindViewMap.get(typeElement);<br>        <span class="hljs-keyword">for</span> (Element element : elements) &#123;<br>            processorBindView(element, methodBuilder);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">generateClickResponderCode</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">for</span> (TypeElement typeElement : clickResponderMap.keySet()) &#123;<br>        MethodSpec.<span class="hljs-type">Builder</span> <span class="hljs-variable">methodBuilder</span> <span class="hljs-operator">=</span> generateBindMethodBuilder(typeElement);<br><br>        List&lt;Element&gt; elements = clickResponderMap.get(typeElement);<br>        <span class="hljs-keyword">for</span> (Element element : elements) &#123;<br>            processorClickResponder(element, methodBuilder);<br><br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆå¯¹åº”çš„è¾…åŠ©ç±»ï¼Œç±»åä¸ºä½¿ç”¨è¯¥æ³¨è§£çš„ç±»å+<code>$ViewInjector</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> TypeSpecWrapper <span class="hljs-title function_">generateTypeSpecWrapper</span><span class="hljs-params">(TypeElement typeElement)</span> &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">pkgName</span> <span class="hljs-operator">=</span> getPackageName(typeElement);<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">clsName</span> <span class="hljs-operator">=</span> getClassName(typeElement, pkgName) + <span class="hljs-string">&quot;$ViewInjector&quot;</span>;<br>    TypeSpec.<span class="hljs-type">Builder</span> <span class="hljs-variable">typeSpecBuilder</span> <span class="hljs-operator">=</span> TypeSpec.classBuilder(clsName)<br>            .addModifiers(Modifier.PUBLIC);<br><br>    <span class="hljs-type">TypeSpecWrapper</span> <span class="hljs-variable">typeSpecWrapper</span> <span class="hljs-operator">=</span> typeSpecWrapperMap.get(typeElement);<br>    <span class="hljs-keyword">if</span> (typeSpecWrapper == <span class="hljs-literal">null</span>) &#123;<br>        typeSpecWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeSpecWrapper</span>(typeSpecBuilder, pkgName);<br>        typeSpecWrapperMap.put(typeElement, typeSpecWrapper);<br>    &#125;<br>    <span class="hljs-keyword">return</span> typeSpecWrapper;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆè¾…åŠ©ç±»çš„<code>bind</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> MethodSpec.Builder <span class="hljs-title function_">generateBindMethodBuilder</span><span class="hljs-params">(TypeElement typeElement)</span> &#123;<br>    <span class="hljs-type">TypeSpecWrapper</span> <span class="hljs-variable">typeSpecWrapper</span> <span class="hljs-operator">=</span> generateTypeSpecWrapper(typeElement);<br>    MethodSpec.<span class="hljs-type">Builder</span> <span class="hljs-variable">methodBuilder</span> <span class="hljs-operator">=</span> typeSpecWrapper.getMethodBuilder(<span class="hljs-string">&quot;bind&quot;</span>);<br>    <span class="hljs-keyword">if</span> (methodBuilder == <span class="hljs-literal">null</span>) &#123;<br>        methodBuilder = MethodSpec.methodBuilder(<span class="hljs-string">&quot;bind&quot;</span>)<br>                .addModifiers(Modifier.PUBLIC, Modifier.STATIC)<br>                .addParameter(ClassName.get(typeElement.asType()), <span class="hljs-string">&quot;target&quot;</span>, Modifier.FINAL)<br>                .addParameter(ClassName.get(<span class="hljs-string">&quot;android.view&quot;</span>, <span class="hljs-string">&quot;View&quot;</span>), <span class="hljs-string">&quot;view&quot;</span>)<br>                .addStatement(<span class="hljs-string">&quot;int resourceID = 0&quot;</span>);<br>        typeSpecWrapper.putMethodBuilder(methodBuilder);<br>    &#125;<br>    <span class="hljs-keyword">return</span> methodBuilder;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹äº<code>BindView</code>æ¥è®²ï¼Œå°±æ˜¯é€šè¿‡<code>findViewById</code>æ¥è·å–åˆ°å¯¹åº”çš„æ§ä»¶ï¼Œç„¶åèµ‹å€¼ç»™å¯¹åº”çš„å­—æ®µã€‚<br>è¿™é‡Œæˆ‘ä»¬ä¸ºäº†èƒ½åœ¨libä¸­ä½¿ç”¨ï¼Œå¯¹äºæ²¡æœ‰ä¼ å…¥idçš„å±æ€§ï¼Œé€šè¿‡<code>getIdentifier</code>æ–¹æ³•æ¥è·å–åˆ°å¯¹åº”çš„èµ„æºidã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processorBindView</span><span class="hljs-params">(Element element, MethodSpec.Builder methodBuilder)</span> &#123;<br>    <span class="hljs-type">VariableElement</span> <span class="hljs-variable">variableElement</span> <span class="hljs-operator">=</span> (VariableElement) element;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">varName</span> <span class="hljs-operator">=</span> variableElement.getSimpleName().toString();<br>    <span class="hljs-type">String</span> <span class="hljs-variable">varType</span> <span class="hljs-operator">=</span> variableElement.asType().toString();<br>    <span class="hljs-type">BindView</span> <span class="hljs-variable">bindView</span> <span class="hljs-operator">=</span> variableElement.getAnnotation(BindView.class);<br><br>    <span class="hljs-type">int</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> bindView.id();<br>    <span class="hljs-comment">//ä½¿ç”¨æ³¨è§£æ²¡æœ‰ä¼ å…¥idçš„å±æ€§å€¼ï¼Œåˆ™ä½¿ç”¨isStrå€¼æ¥è·å–å¯¹åº”çš„èµ„æºidã€‚</span><br>    <span class="hljs-comment">//ä¸¥è°¨æ¥è®²ï¼Œè¿™é‡Œéœ€è¦åˆ¤æ–­ä¸€ä¸‹isStræ˜¯ä¸æ˜¯ç©ºä¸²ï¼Œå¦‚æœæ˜¯ç©ºä¸²ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œç»ˆæ­¢ç¼–è¯‘</span><br>    <span class="hljs-keyword">if</span> (params &lt;= <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">idStr</span> <span class="hljs-operator">=</span> bindView.idStr();<br>        methodBuilder.addStatement(<span class="hljs-string">&quot;resourceID = view.getResources().getIdentifier($S,$S, view.getContext().getPackageName())&quot;</span>, idStr, <span class="hljs-string">&quot;id&quot;</span>);<br><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        methodBuilder.addStatement(<span class="hljs-string">&quot;resourceID = ($L)&quot;</span>, params);<br>    &#125;<br>    methodBuilder.addStatement(<span class="hljs-string">&quot;target.$L = ($L) view.findViewById(resourceID)&quot;</span>, varName, varType);<br><br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹äº<code>ClickResponder</code>æ¥è®²ï¼Œå°±æ˜¯é€šè¿‡<code>setOnClickListener</code>å¯¹å¯¹åº”çš„æ§ä»¶è®¾ç½®ç‚¹å‡»æ–¹æ³•ã€‚ç”±äºå¯èƒ½å­˜åœ¨å¤šä¸ªæ§ä»¶ä½¿ç”¨åŒä¸€ä¸ªå“åº”ç‚¹å‡»çš„æ–¹æ³•ï¼Œè¿™é‡Œä¼ å…¥çš„éƒ½æ˜¯èµ„æºæ•°ç»„<br>åŒæ ·æˆ‘ä»¬ä¸ºäº†èƒ½åœ¨libä¸­ä½¿ç”¨ï¼Œå¯¹äºæ²¡æœ‰ä¼ å…¥idçš„å±æ€§ï¼Œé€šè¿‡<code>getIdentifier</code>æ–¹æ³•æ¥è·å–åˆ°å¯¹åº”çš„èµ„æºidã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processorClickResponder</span><span class="hljs-params">(Element element, MethodSpec.Builder methodBuilder)</span> &#123;<br>    <span class="hljs-type">ExecutableElement</span> <span class="hljs-variable">executableElement</span> <span class="hljs-operator">=</span> (ExecutableElement) element;<br>    <span class="hljs-type">ClickResponder</span> <span class="hljs-variable">clickView</span> <span class="hljs-operator">=</span> executableElement.getAnnotation(ClickResponder.class);<br>    <span class="hljs-type">int</span>[] ids = clickView.id();<br>    String[] idStrs = clickView.idStr();<br><br><br>    <span class="hljs-keyword">if</span> (ids.length &gt; <span class="hljs-number">0</span>) &#123;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> id : ids) &#123;<br>            <span class="hljs-keyword">if</span> (id == <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-type">MethodSpec</span> <span class="hljs-variable">innerMethodSpec</span> <span class="hljs-operator">=</span> MethodSpec.methodBuilder(<span class="hljs-string">&quot;onClick&quot;</span>)<br>                    .addAnnotation(Override.class)<br>                    .addModifiers(Modifier.PUBLIC)<br>                    .returns(<span class="hljs-keyword">void</span>.class)<br>                    .addParameter(ClassName.get(<span class="hljs-string">&quot;android.view&quot;</span>, <span class="hljs-string">&quot;View&quot;</span>), <span class="hljs-string">&quot;v&quot;</span>)<br>                    .addStatement(<span class="hljs-string">&quot;target.$L($L)&quot;</span>, executableElement.getSimpleName().toString(), <span class="hljs-string">&quot;v&quot;</span>)<br>                    .build();<br>            <span class="hljs-type">TypeSpec</span> <span class="hljs-variable">innerTypeSpec</span> <span class="hljs-operator">=</span> TypeSpec.anonymousClassBuilder(<span class="hljs-string">&quot;&quot;</span>)<br>                    .addSuperinterface(ClassName.bestGuess(<span class="hljs-string">&quot;View.OnClickListener&quot;</span>))<br>                    .addMethod(innerMethodSpec)<br>                    .build();<br>            methodBuilder.addStatement(<span class="hljs-string">&quot;view.findViewById($L).setOnClickListener($L)&quot;</span>, id, innerTypeSpec);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (idStrs.length &gt; <span class="hljs-number">0</span>) &#123;<br><br>        <span class="hljs-keyword">for</span> (String idStr : idStrs) &#123;<br>            <span class="hljs-keyword">if</span> (idStr == <span class="hljs-literal">null</span> || idStr.length() &lt;= <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br><br>            <span class="hljs-type">MethodSpec</span> <span class="hljs-variable">innerMethodSpec</span> <span class="hljs-operator">=</span> MethodSpec.methodBuilder(<span class="hljs-string">&quot;onClick&quot;</span>)<br>                    .addAnnotation(Override.class)<br>                    .addModifiers(Modifier.PUBLIC)<br>                    .returns(<span class="hljs-keyword">void</span>.class)<br>                    .addParameter(ClassName.get(<span class="hljs-string">&quot;android.view&quot;</span>, <span class="hljs-string">&quot;View&quot;</span>), <span class="hljs-string">&quot;v&quot;</span>)<br>                    .addStatement(<span class="hljs-string">&quot;target.$L($L)&quot;</span>, executableElement.getSimpleName().toString(), <span class="hljs-string">&quot;v&quot;</span>)<br>                    .build();<br>            <span class="hljs-type">TypeSpec</span> <span class="hljs-variable">innerTypeSpec</span> <span class="hljs-operator">=</span> TypeSpec.anonymousClassBuilder(<span class="hljs-string">&quot;&quot;</span>)<br>                    .addSuperinterface(ClassName.bestGuess(<span class="hljs-string">&quot;View.OnClickListener&quot;</span>))<br>                    .addMethod(innerMethodSpec)<br>                    .build();<br><br>            methodBuilder.addStatement(<span class="hljs-string">&quot;resourceID = view.getResources().getIdentifier($S,$S, view.getContext().getPackageName())&quot;</span>, idStr, <span class="hljs-string">&quot;id&quot;</span>);<br><br>            methodBuilder.addStatement(<span class="hljs-string">&quot;view.findViewById($L).setOnClickListener($L)&quot;</span>, <span class="hljs-string">&quot;resourceID&quot;</span>, innerTypeSpec);<br><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ç»™ä½¿ç”¨è€…æä¾›è°ƒç”¨æ–¹æ³•"><a href="#ç»™ä½¿ç”¨è€…æä¾›è°ƒç”¨æ–¹æ³•" class="headerlink" title="ç»™ä½¿ç”¨è€…æä¾›è°ƒç”¨æ–¹æ³•"></a>ç»™ä½¿ç”¨è€…æä¾›è°ƒç”¨æ–¹æ³•</h4><p>åœ¨<code>api</code>æ¨¡å—ä¸­å®šä¹‰æä¾›ç»™ä½¿ç”¨è€…çš„æ–¹æ³•ã€‚<br>æ–°å»ºä¸€ä¸ª<code>ViewInjector</code>ç±»ï¼Œè°ƒç”¨è€…é€šè¿‡è°ƒç”¨è¿™ä¸ªç±»ä¸­çš„æ–¹æ³•ï¼Œå®Œæˆè°ƒç”¨ç”Ÿæˆè¾…åŠ©ç±»çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewInjector</span> &#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;Class&lt;?&gt;, Method&gt; BINDINGS = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bind</span><span class="hljs-params">(Activity activity)</span> &#123;<br>        bind(activity, activity.getWindow().getDecorView());<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bind</span><span class="hljs-params">(Object target, View view)</span> &#123;<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">constructor</span> <span class="hljs-operator">=</span> findBindMethodForClass(target);<br>        <span class="hljs-keyword">try</span> &#123;<br>            constructor.invoke(<span class="hljs-literal">null</span>,target, view);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method <span class="hljs-title function_">findBindMethodForClass</span><span class="hljs-params">(Object target)</span> &#123;<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">constructor</span> <span class="hljs-operator">=</span> BINDINGS.get(target.getClass());<br>        <span class="hljs-keyword">if</span> (constructor == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                Class&lt;?&gt; bindingClass = Class.forName(target.getClass().getName() + <span class="hljs-string">&quot;$ViewInjector&quot;</span>);<br>                constructor = bindingClass.getMethod(<span class="hljs-string">&quot;bind&quot;</span>,target.getClass(), View.class);<br>                BINDINGS.put(target.getClass(), constructor);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> constructor;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>åœ¨æˆ‘ä»¬é¡¹ç›®çš„ä¸»æ¨¡å—(applicationæ¨¡å—)ä¸­æ–°å»ºä¸€ä¸ªActivityï¼Œå°±å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestViewInjectActivityTwo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> &#123;<br>    <span class="hljs-meta">@BindView(id = R.id.test_view_inject_one)</span><br>    <span class="hljs-keyword">protected</span> Button buttonOne;<br>    <span class="hljs-meta">@BindView(idStr = &quot;test_view_inject_two&quot;)</span><br>    <span class="hljs-keyword">protected</span> Button buttonTwo;<br>    ã€‚<br>    ã€‚<br>    ã€‚<br>    <span class="hljs-meta">@ClickResponder(id = &#123;R.id.test_view_inject_one&#125;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClickButtonOne</span><span class="hljs-params">(View v)</span> &#123;<br>        Toast.makeText(TestViewInjectActivity.<span class="hljs-built_in">this</span>, <span class="hljs-string">&quot;test_view_inject_one&quot;</span>, Toast.LENGTH_SHORT).show();<br>    &#125;<br><br>    <span class="hljs-meta">@ClickResponder(idStr = &#123;&quot;test_view_inject_two&quot;&#125;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClickButtonTwo</span><span class="hljs-params">(View v)</span> &#123;<br>        Toast.makeText(TestViewInjectActivity.<span class="hljs-built_in">this</span>, <span class="hljs-string">&quot;test_view_inject_two&quot;</span>, Toast.LENGTH_SHORT).show();<br>    &#125;<br><br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä¸€ä¸‹<code>assembleDebug</code>ä»»åŠ¡ï¼Œå°±å¯ä»¥æ‰¾åˆ°<code>TestViewInjectActivityTwo$ViewInjector</code>ç±»äº†(ä¸€èˆ¬æ˜¯åœ¨å¯¹ç”¨æ¨¡å—ä¸­çš„<code>build/generated/source/apt/debug</code>)æ–‡ä»¶å¤¹ä¸‹ï¼Œå½“ç„¶ï¼Œ<code>assembleRelease</code>ä¼šåœ¨<code>build/generated/source/apt/release</code>æ–‡ä»¶å¤¹ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestViewInjectActivity$ViewInjector</span> &#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bind</span><span class="hljs-params">(<span class="hljs-keyword">final</span> TestViewInjectActivity target, View view)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">resourceID</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    resourceID = (<span class="hljs-number">2131165388</span>);<br>    target.buttonOne = (android.widget.Button) view.findViewById(resourceID);<br>    resourceID = view.getResources().getIdentifier(<span class="hljs-string">&quot;test_view_inject_two&quot;</span>,<span class="hljs-string">&quot;id&quot;</span>, view.getContext().getPackageName());<br>    target.buttonTwo = (android.widget.Button) view.findViewById(resourceID);<br><br>    view.findViewById(<span class="hljs-number">2131165388</span>).setOnClickListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnClickListener() &#123;<br>      <span class="hljs-meta">@Override</span><br>      <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> &#123;<br>        target.onClickButtonOne(v);<br>      &#125;<br>    &#125;);<br>    resourceID = view.getResources().getIdentifier(<span class="hljs-string">&quot;test_view_inject_two&quot;</span>,<span class="hljs-string">&quot;id&quot;</span>, view.getContext().getPackageName());<br>    view.findViewById(resourceID).setOnClickListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnClickListener() &#123;<br>      <span class="hljs-meta">@Override</span><br>      <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> &#123;<br>        target.onClickButtonTwo(v);<br>      &#125;<br>    &#125;);<br>  &#125;<br></code></pre></td></tr></table></figure><p>å…¶å®ç”Ÿæˆçš„ä»£ç è¿˜æ˜¯æœ‰ä¼˜åŒ–ç©ºé—´çš„ï¼Œæ¯”å¦‚å¯¹äºä¸€ä¸ªæ—¢ç”¨äº†BindViewåˆç”¨äº†ClickResponderçš„æ§ä»¶ï¼Œå¯¹åº”çš„findViewByIdä¼šæ‰§è¡Œä¸¤æ¬¡ï¼Œè¿™é‡Œå¯ä»¥ä¼˜åŒ–ä¸€ä¸‹.</p><p>å¯ä»¥è‡ªå·±å†™ä¸€ä¸‹<code>LongClickResponder</code>æ³¨è§£å‘€ï¼Œä»£ç åœ¨<a href="https://github.com/huangyuanlove/AndroidAnnotation">https://github.com/huangyuanlove/AndroidAnnotation</a></p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è‡ªå®šä¹‰æ³¨è§£ï¼Œæ‰“é€ è‡ªå·±çš„æ¡†æ¶ (ä¸­ç¯‡)</title>
    <link href="/2019/12/01/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3%EF%BC%8C%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E6%A1%86%E6%9E%B6-%E4%B8%AD%E7%AF%87/"/>
    <url>/2019/12/01/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3%EF%BC%8C%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E6%A1%86%E6%9E%B6-%E4%B8%AD%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<p>è¯¥ç³»åˆ—ä»‹ç»è‡ªå®šä¹‰æ³¨è§£ï¼Œå®Œæˆå¦‚ä¸‹åŠŸèƒ½ã€‚</p><ul><li><input disabled="" type="checkbox"> @BindView ä»£æ›¿  findViewById </li><li><input disabled="" type="checkbox"> @ClickResponder ä»£æ›¿ setOnClickListener</li><li><input disabled="" type="checkbox"> @LongClickResponder ä»£æ›¿ setOnLongClickListener</li><li><input disabled="" type="checkbox"> @IntentValue ä»£æ›¿ getIntent().getXXX</li><li><input disabled="" type="checkbox"> @UriValue ä»£æ›¿ getQueryParameter</li><li><input disabled="" type="checkbox"> @BroadcastResponder ä»£æ›¿ registerReceiver</li><li><input disabled="" type="checkbox"> @RouterModuleã€@RouterPath æ¥è¿›è¡Œåä¾èµ–ä¼ é€’è°ƒç”¨<br>è¯¥ç³»åˆ—æºç åœ¨<a href="https://github.com/huangyuanlove/AndroidAnnotation">https://github.com/huangyuanlove/AndroidAnnotation</a><br>ä½¿ç”¨ç¼–è¯‘æ—¶æ³¨è§£ï¼Œç”Ÿæˆè¾…åŠ©ç±»æ¥å®Œæˆè¿™äº›æ“ä½œï¼Œå°½é‡å°‘çš„ä½¿ç”¨çš„åå°„åŠŸèƒ½ã€‚</li></ul><p><strong>æœ¬ç« å…ˆä»‹ç»   <a href="https://github.com/square/javapoet">javapoet </a> å’Œä¸€ä¸¢ä¸¢åå°„ç›¸å…³çš„ä¸œè¥¿</strong></p><span id="more"></span><h4 id="javapoet"><a href="#javapoet" class="headerlink" title="javapoet"></a>javapoet</h4><p>ç”¨æ¥è¾…åŠ©ç”Ÿæˆjavaä»£ç çš„åº“ï¼Œ<a href="https://github.com/square/javapoet">å¯ä»¥çœ‹è¿™é‡Œ</a>ï¼Œæœ‰ç‰¹åˆ«è¯¦ç»†çš„ç¤ºä¾‹ã€‚å¤§è‡´è¿‡äº†ä¸€éï¼Œå¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestJavaPoet</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">TypeSpec</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> clazz(builtinTypeField(),          <span class="hljs-comment">// int</span><br>                arrayTypeField(),            <span class="hljs-comment">// int[]</span><br>                refTypeField(),              <span class="hljs-comment">// File</span><br>                typeField(),                 <span class="hljs-comment">// T</span><br>                parameterizedTypeField(),    <span class="hljs-comment">// List&lt;String&gt;</span><br>                wildcardTypeField(),         <span class="hljs-comment">// List&lt;? extends String&gt;</span><br>                constructor(),               <span class="hljs-comment">// æ„é€ å‡½æ•°</span><br>                method(code()));             <span class="hljs-comment">// æ™®é€šæ–¹æ³•</span><br>        <span class="hljs-type">JavaFile</span> <span class="hljs-variable">javaFile</span> <span class="hljs-operator">=</span> JavaFile.builder(<span class="hljs-string">&quot;com.huangyuanlove.view_inject_compiler.test&quot;</span>, clazz).build();<br><br>        System.out.println(javaFile.toString());<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * `public abstract class Clazz&lt;T&gt; extends String implements Serializable, Comparable&lt;String&gt;, Comparable&lt;? extends String&gt; &#123;</span><br><span class="hljs-comment">     * ...</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> TypeSpec <span class="hljs-title function_">clazz</span><span class="hljs-params">(FieldSpec builtinTypeField, FieldSpec arrayTypeField, FieldSpec refTypeField,</span><br><span class="hljs-params">                                 FieldSpec typeField, FieldSpec parameterizedTypeField, FieldSpec wildcardTypeField,</span><br><span class="hljs-params">                                 MethodSpec constructor, MethodSpec methodSpec)</span> &#123;<br>        <span class="hljs-keyword">return</span> TypeSpec.classBuilder(<span class="hljs-string">&quot;Clazz&quot;</span>)<br>                <span class="hljs-comment">// é™å®šç¬¦</span><br>                .addModifiers(Modifier.PUBLIC, Modifier.ABSTRACT)<br>                <span class="hljs-comment">// æ³›å‹</span><br>                .addTypeVariable(TypeVariableName.get(<span class="hljs-string">&quot;T&quot;</span>))<br><br>                <span class="hljs-comment">// ç»§æ‰¿ä¸æ¥å£</span><br>                .superclass(String.class)<br>                .addSuperinterface(Serializable.class)<br>                .addSuperinterface(ParameterizedTypeName.get(Comparable.class, String.class))<br>                .addSuperinterface(ParameterizedTypeName.get(ClassName.get(Map.class),<br>                        TypeVariableName.get(<span class="hljs-string">&quot;T&quot;</span>),<br>                        WildcardTypeName.subtypeOf(String.class)))<br><br>                <span class="hljs-comment">// åˆå§‹åŒ–å—</span><br>                .addStaticBlock(CodeBlock.builder().build())<br>                .addInitializerBlock(CodeBlock.builder().build())<br><br>                <span class="hljs-comment">// å±æ€§</span><br>                .addField(builtinTypeField)<br>                .addField(arrayTypeField)<br>                .addField(refTypeField)<br>                .addField(typeField)<br>                .addField(parameterizedTypeField)<br>                .addField(wildcardTypeField)<br><br>                <span class="hljs-comment">// æ–¹æ³• ï¼ˆæ„é€ å‡½æ•°ä¹Ÿåœ¨æ­¤å®šä¹‰ï¼‰</span><br>                .addMethod(constructor)<br>                .addMethod(methodSpec)<br><br>                <span class="hljs-comment">// å†…éƒ¨ç±»</span><br>                .addType(TypeSpec.classBuilder(<span class="hljs-string">&quot;InnerClass&quot;</span>).build())<br><br>                .build();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å†…ç½®ç±»å‹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> FieldSpec <span class="hljs-title function_">builtinTypeField</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// private int mInt;</span><br>        <span class="hljs-keyword">return</span> FieldSpec.builder(<span class="hljs-type">int</span>.class, <span class="hljs-string">&quot;mInt&quot;</span>, Modifier.PRIVATE).build();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ•°ç»„ç±»å‹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> FieldSpec <span class="hljs-title function_">arrayTypeField</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// private int[] mArr;</span><br>        <span class="hljs-keyword">return</span> FieldSpec.builder(<span class="hljs-type">int</span>[].class, <span class="hljs-string">&quot;mArr&quot;</span>, Modifier.PRIVATE).build();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * éœ€è¦å¯¼å…¥ import çš„ç±»å‹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> FieldSpec <span class="hljs-title function_">refTypeField</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// private File mRef;</span><br>        <span class="hljs-keyword">return</span> FieldSpec.builder(File.class, <span class="hljs-string">&quot;mRef&quot;</span>, Modifier.PRIVATE).build();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ³›å‹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> FieldSpec <span class="hljs-title function_">typeField</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// private File mT;</span><br>        <span class="hljs-keyword">return</span> FieldSpec.builder(TypeVariableName.get(<span class="hljs-string">&quot;T&quot;</span>), <span class="hljs-string">&quot;mT&quot;</span>, Modifier.PRIVATE).build();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å‚æ•°åŒ–ç±»å‹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> FieldSpec <span class="hljs-title function_">parameterizedTypeField</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// private List&lt;String&gt; mParameterizedField;</span><br>        <span class="hljs-keyword">return</span> FieldSpec.builder(ParameterizedTypeName.get(List.class, String.class),<br>                <span class="hljs-string">&quot;mParameterizedField&quot;</span>,<br>                Modifier.PRIVATE)<br>                .build();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é€šé…ç¬¦å‚æ•°åŒ–ç±»å‹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> FieldSpec <span class="hljs-title function_">wildcardTypeField</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// private List&lt;? extends String&gt; mWildcardField;</span><br>        <span class="hljs-keyword">return</span> FieldSpec.builder(ParameterizedTypeName.get(ClassName.get(List.class),<br>                WildcardTypeName.subtypeOf(String.class)),<br>                <span class="hljs-string">&quot;mWildcardField&quot;</span>,<br>                Modifier.PRIVATE)<br>                .build();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ„é€ å‡½æ•°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> MethodSpec <span class="hljs-title function_">constructor</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> MethodSpec.constructorBuilder()<br>                .addModifiers(Modifier.PUBLIC)<br>                .build();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * `<span class="hljs-doctag">@Override</span></span><br><span class="hljs-comment">     * public &lt;T&gt; Integer method(String string, T t, Map&lt;Integer, ? extends T&gt; map) throws IOException, RuntimeException &#123;</span><br><span class="hljs-comment">     * ...</span><br><span class="hljs-comment">     * &#125;`</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> MethodSpec <span class="hljs-title function_">method</span><span class="hljs-params">(CodeBlock codeBlock)</span> &#123;<br>        <span class="hljs-keyword">return</span> MethodSpec.methodBuilder(<span class="hljs-string">&quot;method&quot;</span>)<br>                .addAnnotation(Override.class)<br>                .addTypeVariable(TypeVariableName.get(<span class="hljs-string">&quot;T&quot;</span>))<br>                .addModifiers(Modifier.PUBLIC)<br>                .returns(<span class="hljs-type">int</span>.class)<br>                .addParameter(String.class, <span class="hljs-string">&quot;string&quot;</span>)<br>                .addParameter(TypeVariableName.get(<span class="hljs-string">&quot;T&quot;</span>), <span class="hljs-string">&quot;t&quot;</span>)<br>                .addParameter(ParameterizedTypeName.get(ClassName.get(Map.class),<br>                        ClassName.get(Integer.class),<br>                        WildcardTypeName.subtypeOf(TypeVariableName.get(<span class="hljs-string">&quot;T&quot;</span>))),<br>                        <span class="hljs-string">&quot;map&quot;</span>)<br>                .addException(IOException.class)<br>                .addException(RuntimeException.class)<br>                .addCode(codeBlock)<br>                .build();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * â€˜methodâ€™ æ–¹æ³•ä¸­çš„å…·ä½“è¯­å¥</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> CodeBlock <span class="hljs-title function_">code</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> CodeBlock.builder()<br>                .addStatement(<span class="hljs-string">&quot;int foo = 1&quot;</span>)<br>                .addStatement(<span class="hljs-string">&quot;$T bar = $S&quot;</span>, String.class, <span class="hljs-string">&quot;a string&quot;</span>)<br><br>                <span class="hljs-comment">// Object obj = new HashMap&lt;Integer, ? extends T&gt;(5);</span><br>                .addStatement(<span class="hljs-string">&quot;$T obj = new $T(5)&quot;</span>,<br>                        Object.class, ParameterizedTypeName.get(ClassName.get(HashMap.class),<br>                                ClassName.get(Integer.class),<br>                                WildcardTypeName.subtypeOf(TypeVariableName.get(<span class="hljs-string">&quot;T&quot;</span>))))<br><br>                <span class="hljs-comment">// method(new Runnable(String param) &#123;</span><br>                <span class="hljs-comment">//   @Override</span><br>                <span class="hljs-comment">//   void run() &#123;</span><br>                <span class="hljs-comment">//   &#125;</span><br>                <span class="hljs-comment">// &#125;);</span><br>                .addStatement(<span class="hljs-string">&quot;baz($L)&quot;</span>, TypeSpec.anonymousClassBuilder(<span class="hljs-string">&quot;$T param&quot;</span>, String.class)<br>                        .superclass(Runnable.class)<br>                        .addMethod(MethodSpec.methodBuilder(<span class="hljs-string">&quot;run&quot;</span>)<br>                                .addAnnotation(Override.class)<br>                                .returns(TypeName.VOID)<br>                                .build())<br>                        .build())<br><br>                <span class="hljs-comment">// for</span><br>                .beginControlFlow(<span class="hljs-string">&quot;for (int i = 0; i &lt; 5; i++)&quot;</span>)<br>                .endControlFlow()<br><br>                <span class="hljs-comment">// while</span><br>                .beginControlFlow(<span class="hljs-string">&quot;while (false)&quot;</span>)<br>                .endControlFlow()<br><br>                <span class="hljs-comment">// do... while</span><br>                .beginControlFlow(<span class="hljs-string">&quot;do&quot;</span>)<br>                .endControlFlow(<span class="hljs-string">&quot;while (false)&quot;</span>)<br><br>                <span class="hljs-comment">// if... else if... else...</span><br>                .beginControlFlow(<span class="hljs-string">&quot;if (false)&quot;</span>)<br>                .nextControlFlow(<span class="hljs-string">&quot;else if (false)&quot;</span>)<br>                .nextControlFlow(<span class="hljs-string">&quot;else&quot;</span>)<br>                .endControlFlow()<br><br>                <span class="hljs-comment">// try... catch... finally</span><br>                .beginControlFlow(<span class="hljs-string">&quot;try&quot;</span>)<br>                .nextControlFlow(<span class="hljs-string">&quot;catch ($T e)&quot;</span>, Exception.class)<br>                .addStatement(<span class="hljs-string">&quot;e.printStackTrace()&quot;</span>)<br>                .nextControlFlow(<span class="hljs-string">&quot;finally&quot;</span>)<br>                .endControlFlow()<br><br>                .addStatement(<span class="hljs-string">&quot;return 0&quot;</span>)<br>                .build();<br>    &#125;<br><br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±çœå»äº†æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨è¯„ä»·ä»£ç å—çš„éº»çƒ¦ï¼Œæé«˜æ•ˆç‡ï¼Œå¹¶ä¸”ä¹Ÿæ¯”è¾ƒå®¹æ˜“æŸ¥é”™ã€‚</p><h4 id="åå°„"><a href="#åå°„" class="headerlink" title="åå°„"></a>åå°„</h4><p>è¿™ç©æ„è¯´èµ·æ¥å¯å°±é•¿äº†ï¼Œè¿™é‡Œåªåšç¤ºä¾‹</p><p>ä¸€ä¸ªPersonç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.huangyuanlove;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br>    <span class="hljs-keyword">public</span> String name;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getAddress</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;getAddress without param&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getAddress</span><span class="hljs-params">(String zipCode)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;getAddress with param:&quot;</span> + zipCode;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ç©ä¸€ä¸‹åå°„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.huangyuanlove;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//å¦‚æœæ²¡æœ‰å¯¹åº”ç±»çš„ä¾èµ–çš„è¯(ä¸èƒ½ç›´æ¥import),å¯ä»¥ç”¨Class.forName</span><br>            <span class="hljs-comment">//Class personClass = Class.forName(&quot;com.huangyuanlove.Person&quot;);</span><br>            Class&lt;Person&gt; personClass = Person.class;<br><br>            <span class="hljs-comment">//è°ƒç”¨ç§æœ‰æ— å‚æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡</span><br>            Constructor&lt;Person&gt; personConstructor = personClass.getDeclaredConstructor();<br>            personConstructor.setAccessible(<span class="hljs-literal">true</span>);<br>            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> personConstructor.newInstance();<br>            <span class="hljs-comment">//åå°„è·å–å…¬å…±æ–¹æ³•å¹¶è°ƒç”¨</span><br>            <span class="hljs-type">Method</span> <span class="hljs-variable">getAddressWithoutParamMethod</span> <span class="hljs-operator">=</span> personClass.getMethod(<span class="hljs-string">&quot;getAddress&quot;</span>);<br>            System.out.println( getAddressWithoutParamMethod.invoke(person));<br><br>            <span class="hljs-comment">//åå°„è·å–ç§æœ‰æ–¹æ³•å¹¶è°ƒç”¨</span><br>            <span class="hljs-type">Method</span> <span class="hljs-variable">getAddressMethod</span> <span class="hljs-operator">=</span> personClass.getDeclaredMethod(<span class="hljs-string">&quot;getAddress&quot;</span>, String.class);<br>            getAddressMethod.setAccessible(<span class="hljs-literal">true</span>);<br>            System.out.println(getAddressMethod.invoke(person, <span class="hljs-string">&quot;zipCode&quot;</span>));<br><br>            <span class="hljs-comment">//åå°„è·å–ç§æœ‰å­—æ®µå¹¶èµ‹å€¼</span><br>            <span class="hljs-type">Field</span> <span class="hljs-variable">ageField</span> <span class="hljs-operator">=</span>  personClass.getDeclaredField(<span class="hljs-string">&quot;age&quot;</span>);<br>            ageField.setAccessible(<span class="hljs-literal">true</span>);<br>            ageField.set(person,<span class="hljs-number">11</span>);<br>            System.out.println(person.getAge());<br><br>            <span class="hljs-comment">//åå°„è·å–ç§æœ‰é™æ€æ–¹æ³•å¹¶è°ƒç”¨</span><br>            <span class="hljs-type">Method</span> <span class="hljs-variable">sayHiMethod</span> <span class="hljs-operator">=</span> personClass.getDeclaredMethod(<span class="hljs-string">&quot;saySomething&quot;</span>,String.class);<br>            sayHiMethod.setAccessible(<span class="hljs-literal">true</span>);<br>            sayHiMethod.invoke(<span class="hljs-literal">null</span>,<span class="hljs-string">&quot;reflect&quot;</span>);<br><br><br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è‡ªå®šä¹‰æ³¨è§£,æ‰“é€ è‡ªå·±çš„æ¡†æ¶(ä¸Šç¯‡)</title>
    <link href="/2019/11/23/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3-%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E6%A1%86%E6%9E%B6-%E4%B8%8A%E7%AF%87/"/>
    <url>/2019/11/23/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3-%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E6%A1%86%E6%9E%B6-%E4%B8%8A%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<p>è¯¥ç³»åˆ—ä»‹ç»è‡ªå®šä¹‰æ³¨è§£ï¼Œå®Œæˆå¦‚ä¸‹åŠŸèƒ½ã€‚</p><ul><li><input disabled="" type="checkbox"> @BindView ä»£æ›¿  findViewById </li><li><input disabled="" type="checkbox"> @ClickResponder ä»£æ›¿ setOnClickListener</li><li><input disabled="" type="checkbox"> @LongClickResponder ä»£æ›¿ setOnLongClickListener</li><li><input disabled="" type="checkbox"> @IntentValue ä»£æ›¿ getIntent().getXXX</li><li><input disabled="" type="checkbox"> @UriValue ä»£æ›¿ getQueryParameter</li><li><input disabled="" type="checkbox"> @BroadcastResponder ä»£æ›¿ registerReceiver</li><li><input disabled="" type="checkbox"> @RouterModuleã€@RouterPath æ¥è¿›è¡Œåä¾èµ–ä¼ é€’è°ƒç”¨</li></ul><p>ä½¿ç”¨ç¼–è¯‘æ—¶æ³¨è§£ï¼Œç”Ÿæˆè¾…åŠ©ç±»æ¥å®Œæˆè¿™äº›æ“ä½œï¼Œå°½é‡å°‘çš„ä½¿ç”¨çš„åå°„åŠŸèƒ½ã€‚<br>è¯¥ç³»åˆ—æºç åœ¨<a href="https://github.com/huangyuanlove/AndroidAnnotation">https://github.com/huangyuanlove/AndroidAnnotation</a></p><p><strong>æœ¬ç« å…ˆä»‹ç»ä¸€ä¸¢ä¸¢æ³¨è§£ç›¸å…³çš„ä¸œè¥¿ï¼Œå¹¶ä¸”å®ç°è¿è¡Œæ—¶æ³¨è§£</strong></p><span id="more"></span><h4 id="å¸¸è§çš„æ³¨è§£ï¼š"><a href="#å¸¸è§çš„æ³¨è§£ï¼š" class="headerlink" title="å¸¸è§çš„æ³¨è§£ï¼š"></a>å¸¸è§çš„æ³¨è§£ï¼š</h4><p>@Overrideï¼šè¢«æ ‡è®°çš„æ–¹æ³•ä¸€å®šæ˜¯é‡å†™çš„çˆ¶ç±»æ–¹æ³•ï¼Œåä¹‹ä¸ä¸€å®šï¼›</p><p>@Deprecatedï¼šè¢«æ ‡è®°çš„æ–¹æ³•ä¸ºè¿‡æ—¶æ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•æ—¶ç¼–è¾‘å™¨ä¼šæœ‰è­¦å‘Š</p><p>@SuppressWarnings æŒ‡ç¤ºç¼–è¯‘å™¨å»å¿½ç•¥æ³¨è§£ä¸­å£°æ˜çš„è­¦å‘Šã€‚</p><p>å…ƒæ³¨è§£ ï¼šä½œç”¨åœ¨å…¶ä»–æ³¨è§£çš„æ³¨è§£</p><p>@Retention - æ ‡è¯†è¿™ä¸ªæ³¨è§£æ€ä¹ˆä¿å­˜ï¼Œæ˜¯åªåœ¨ä»£ç ä¸­ï¼Œè¿˜æ˜¯ç¼–å…¥classæ–‡ä»¶ä¸­ï¼Œæˆ–è€…æ˜¯åœ¨è¿è¡Œæ—¶å¯ä»¥é€šè¿‡åå°„è®¿é—®ã€‚å€¼æœ‰ä¸‰ç§ç±»å‹(RetentionPolicy.SOURCE;RetentionPolicy.CLASS;RetentionPolicy.RUNTIME)</p><p>@Target - æ ‡è®°è¿™ä¸ªæ³¨è§£åº”è¯¥æ˜¯å“ªç§ Java æˆå‘˜ã€‚å¸¸è§çš„å€¼ElementType.TYPE(ä½œç”¨äºç±»)ã€ElementType.FIELD(ä½œç”¨äºå­—æ®µ)ã€ElementType.METHOD(ä½œç”¨äºæ–¹æ³•)ç­‰</p><p><strong>æ›´å¤šå…³äºæ³¨è§£çš„ä¸œè¥¿è‡ªå·±æœä¸€ä¸‹ï¼Œæœä¸åˆ°çš„è¯ä¸è¦å¾€ä¸‹çœ‹äº†</strong></p><h4 id="å¤ªé•¿ä¸çœ‹ç³»åˆ—æ€»ç»“"><a href="#å¤ªé•¿ä¸çœ‹ç³»åˆ—æ€»ç»“" class="headerlink" title="å¤ªé•¿ä¸çœ‹ç³»åˆ—æ€»ç»“"></a>å¤ªé•¿ä¸çœ‹ç³»åˆ—æ€»ç»“</h4><ol><li>å£°æ˜æ³¨è§£</li><li>è§£æè¿è¡Œæ—¶æ³¨è§£<br> 2.1 è·å–ç±»çš„å±æ€§å’Œæ–¹æ³•<br> 2.2 æ‰¾åˆ°æ·»åŠ æ³¨è§£çš„å±æ€§æˆ–è€…æ–¹æ³•<br> 2.3 åšè‡ªå®šä¹‰æ³¨è§£éœ€è¦åšçš„äº‹æƒ…</li><li>è§£æç¼–è¯‘æ—¶æ³¨è§£(éœ€è¦ç¼–å†™æ³¨è§£å¤„ç†å™¨)<br> 3.1 æ³¨å†Œæ³¨è§£å¤„ç†å™¨(@AutoService)<br> 3.2 æ‹¿åˆ°æ³¨è§£çš„å±æ€§å’Œæ–¹æ³•<br> 3.3 ç”Ÿæˆè¾…åŠ©æ–‡ä»¶çš„å†…å®¹(é€šå¸¸ä¼šä½¿ç”¨javapoet)<br> 3.4 å†™å…¥æ–‡ä»¶<br> 3.5 ç¼–å†™æä¾›ç»™ç”¨æˆ·è°ƒç”¨çš„æ–¹æ³•</li></ol><h4 id="æ³¨è§£çš„å£°æ˜"><a href="#æ³¨è§£çš„å£°æ˜" class="headerlink" title="æ³¨è§£çš„å£°æ˜"></a>æ³¨è§£çš„å£°æ˜</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.lang.annotation.ElementType;<br><span class="hljs-keyword">import</span> java.lang.annotation.Retention;<br><span class="hljs-keyword">import</span> java.lang.annotation.RetentionPolicy;<br><span class="hljs-keyword">import</span> java.lang.annotation.Target;<br><br><span class="hljs-meta">@Target(ElementType.FIELD)</span><span class="hljs-comment">//è¯¥æ³¨è§£å¯ä»¥æ ‡è®°å­—æ®µ</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span> <span class="hljs-comment">//è¯¥æ³¨è§£å¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡åå°„æ‹¿åˆ°</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç”¨æ¥ä»£æ›¿findViewById</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> BindView &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-title function_">value</span><span class="hljs-params">()</span> ; <span class="hljs-comment">//è¿™é‡Œå¯ä»¥å£°æ˜é»˜è®¤å€¼   int value() default -1;</span><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(ElementType.METHOD)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç”¨æ¥ä»£æ›¿setOnClickListener</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> OnClick &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-title function_">id</span><span class="hljs-params">()</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(ElementType.METHOD)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç”¨æ¥ä»£æ›¿ssetOnLongClickListener</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> OnLongClick &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-title function_">id</span><span class="hljs-params">()</span>;<br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">result</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åå°„"><a href="#åå°„" class="headerlink" title="åå°„"></a>åå°„</h4><p>javaä¸­çš„åå°„çœŸæ˜¯ä¸ªæ¯èª‰å‚åŠçš„ä¸œè¥¿ï¼Œè‡³äºæ€ä¹ˆç”¨ï¼Œè‡ªå·±æœä¸€ä¸‹å§ã€‚ä½¿ç”¨åå°„è°ƒç”¨éé™æ€æ–¹æ³•æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–¹æ³•æ‰€åœ¨ç±»çš„å®ä¾‹ï¼›è°ƒç”¨é™æ€æ–¹æ³•æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼ nullå³å¯ã€‚</p><h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>æ–°å»ºActivityï¼Œéšä¾¿å†™ç‚¹å¸ƒå±€ã€æ§ä»¶ä»€ä¹ˆçš„ã€‚</p><p>ä½¿ç”¨æ–¹å¼å’ŒButterknifeå·®ä¸å¤šã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@BindView(value = R.id.test_runtime_annotation)</span><br>Button testRuntimeAnnotation;<br><br><span class="hljs-meta">@OnLongClick(id = R.id.test_runtime_annotation)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testRuntimeAnnotationOnLongClick</span><span class="hljs-params">(View v)</span> &#123;<br>    Toast.makeText(<span class="hljs-built_in">this</span>, <span class="hljs-string">&quot;æµ‹è¯•è¿è¡Œæ—¶æ³¨è§£ï¼šonLongClick&quot;</span>, Toast.LENGTH_LONG).show();<br>&#125;<br><br><span class="hljs-meta">@OnClick(id = R.id.test_runtime_annotation)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">setTestRuntimeAnnotationOnClick</span><span class="hljs-params">(View v)</span> &#123;<br>    Toast.makeText(<span class="hljs-built_in">this</span>, <span class="hljs-string">&quot;æµ‹è¯•è¿è¡Œæ—¶æ³¨è§£:onClick&quot;</span>, Toast.LENGTH_LONG).show();<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦åœ¨onCreateä¸­å¯¹æ³¨è§£è¿›è¡Œæ“ä½œï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initAnnotation</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">//åå°„è·å–æ‰€æœ‰å£°æ˜çš„å­—æ®µ</span><br>    Field fields[] = <span class="hljs-built_in">this</span>.getClass().getDeclaredFields();<br><br>    <span class="hljs-keyword">for</span> (Field field : fields) &#123;<br>        field.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-comment">//åˆ¤æ–­å­—æ®µæ˜¯å¦æœ‰BindViewæ³¨è§£</span><br>        <span class="hljs-type">BindView</span> <span class="hljs-variable">bindView</span> <span class="hljs-operator">=</span> field.getAnnotation(BindView.class);<br>        <span class="hljs-keyword">if</span> (bindView != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">//å¯¹å­—æ®µèµ‹å€¼</span><br>                field.set(<span class="hljs-built_in">this</span>, findViewById(bindView.value()));<br>            &#125; <span class="hljs-keyword">catch</span> (IllegalAccessException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br><span class="hljs-comment">//åå°„è·å–æ‰€æœ‰æ–¹æ³•</span><br>    Method methods[] = <span class="hljs-built_in">this</span>.getClass().getDeclaredMethods();<br>    <span class="hljs-keyword">for</span> (Method method : methods) &#123;<br>        method.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-comment">//åˆ¤æ–­æ–¹æ³•æ˜¯å¦æœ‰OnLongClickæ³¨è§£</span><br>        <span class="hljs-type">OnLongClick</span> <span class="hljs-variable">onLongClick</span> <span class="hljs-operator">=</span> method.getAnnotation(OnLongClick.class);<br>        <span class="hljs-keyword">if</span> (onLongClick != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">//å¯¹è¯¥æ–¹æ³•çš„æ³¨è§£å€¼å¯¹åº”çš„æ§ä»¶ è®¾ç½®OnLongClickListener</span><br>            findViewById(onLongClick.id()).setOnLongClickListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnLongClickListener() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onLongClick</span><span class="hljs-params">(View v)</span> &#123;<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        <span class="hljs-comment">//æ–¹æ³•è°ƒç”¨</span><br>                        method.invoke(v.getContext(), v);<br><br>                    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                        e.printStackTrace();<br>                    &#125;<br>                    <span class="hljs-keyword">return</span> onLongClick.result();<br><br>                &#125;<br>            &#125;);<br>        &#125;<br>         <span class="hljs-comment">//åˆ¤æ–­æ–¹æ³•æ˜¯å¦æœ‰OnClickæ³¨è§£</span><br>        <span class="hljs-type">OnClick</span> <span class="hljs-variable">onClick</span> <span class="hljs-operator">=</span> method.getAnnotation(OnClick.class);<br>        <span class="hljs-keyword">if</span> (onClick != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">//å¯¹è¯¥æ–¹æ³•çš„æ³¨è§£å€¼å¯¹åº”çš„æ§ä»¶ è®¾ç½®OnClickListener</span><br>            findViewById(onClick.id()).setOnClickListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnClickListener() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> &#123;<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        <span class="hljs-comment">//æ–¹æ³•è°ƒç”¨</span><br>                        method.invoke(v.getContext(), v);<br>                    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                        e.printStackTrace();<br>                    &#125;<br>                &#125;<br>            &#125;);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢å°±ç®€å•çš„å®ç°äº†oâ€™nClick,onLongClick,BindViewæ³¨è§£ï¼Œåªä¸è¿‡ä½¿ç”¨çš„è¿è¡Œæ—¶æ³¨è§£ï¼Œé€šè¿‡åå°„æ¥å¯¹å­—æ®µå’Œæ³¨è§£è¿›è¡Œæ“ä½œã€‚å¦‚æœé‡å¤§çš„è¯ï¼Œåå°„ä¼šæ¶ˆè€—æ€§èƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ³¨è§£åœ¨ç¼–è¯‘æœŸé—´ç”Ÿæˆè¾…åŠ©ç±»æ¥è¿›è¡Œæ“ä½œï¼Œæ¯”å¦‚ <a href="https://github.com/permissions-dispatcher/PermissionsDispatcher"><strong>PermissionsDispatcher</strong></a></p><p>ä¸‹ä¸€ç¯‡ä»‹ç»ä¸€ä¸‹è¿™ç§æ–¹å¼ï¼Œéœ€è¦ç”¨åˆ° <a href="https://github.com/square/javapoet">javapoet </a> è¿™ä¹ˆä¸ªä¸œè¥¿</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å‘å¸ƒå¼€æºåº“åˆ°jcenter</title>
    <link href="/2019/11/04/%E5%8F%91%E5%B8%83%E5%BC%80%E6%BA%90%E5%BA%93%E5%88%B0jcenter/"/>
    <url>/2019/11/04/%E5%8F%91%E5%B8%83%E5%BC%80%E6%BA%90%E5%BA%93%E5%88%B0jcenter/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘å­¦ä¹ äº†ä¸€ä¸‹Annotationå’ŒAPTï¼Œç®€å•çš„å†™äº†ä¸ªåº“ï¼Œæƒ³è¦å‘å¸ƒåˆ°å…¬å…±ä»“åº“ä¾›å¤§å®¶ä½¿ç”¨(è™½ç„¶æ²¡äººç”¨ï¼Œä½†å°±æ˜¯æƒ³å°è¯•ä¸€ä¸‹)ï¼Œæœ€ç®€å•çš„æ˜¯é€šè¿‡<a href="https://jitpack.io/">https://jitpack.io/</a>ç›´æ¥ä»githubä¸ŠæŠ“å–releaseä»£ç æ‰“åŒ…ï¼Œå¹¶ä¸”ç›®å‰å·²ç»æ”¯æŒ<a href="https://gitee.com/">https://gitee.com/</a>ã€‚ä½†æ˜¯ï¼Œå‘å¸ƒç®€å•çš„çº¯javaåº“æˆ–è€…Android Applicationåº“éƒ½æ¯”è¾ƒç®€å•ï¼Œåœ¨githubä»“åº“ä¸­æ‰“ä¸ªtagæˆ–è€…å‘å¸ƒä¸€ä¸‹releaseï¼Œåœ¨jitpackä¸ŠæŠ“å–ä¸€ä¸‹å°±å¥½ï¼Œæ•™ç¨‹åœ¨è¿™é‡Œ<a href="https://jitpack.io/docs/#publishing-on-jitpack">https://jitpack.io/docs/#publishing-on-jitpack</a>ï¼Œå¯¹äºæœ‰å¤šä¸ªä¾èµ–çš„Android Lib,æŠ±æ­‰ï¼Œæˆ‘æ˜¯çœŸçš„æ²¡æå®šï¼Œäºæ˜¯è½¬æˆ˜<a href="https://bintray.com/">https://bintray.com</a></p><span id="more"></span><h4 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h4><ol><li>é¦–å…ˆæ³¨å†Œä¸ªè´¦å·ï¼Œæ‰“å¼€å®˜ç½‘é¦–é¡µï¼Œç‚¹å‡»ç™½è‰²çš„<code>Sign Up Here</code>è€Œä¸æ˜¯é‚£ä¸ªå¤§ç»¿è‰²çš„æŒ‰é’®(START YOUR FREE TRIAL)</li><li>å¡«å®Œä¿¡æ¯ååˆ°é‚®ç®±æ¿€æ´»ä¸€ä¸‹è´¦å·ã€ç™»å½•ã€‚</li><li>åˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œä»“åº“åéšæ„ï¼ŒTypeé€‰æ‹©Mavenï¼ŒLicenseså’ŒDescriptioné€‰å¡«ã€‚</li><li>å¤åˆ¶è‡ªå·±çš„api keyã€‚<br><img src="/image/jcenter/get_jfrog_api_key.png" alt="api key"><br>åœ¨é¦–é¡µç‚¹å‡»â€editâ€ï¼Œåœ¨æ–°é¡µé¢å·¦ä¾§<code>API Key</code>,è¾“å…¥å¯†ç ï¼Œå¤åˆ¶ä¸€ä¸‹</li></ol><h4 id="ä¸Šä¼ åˆ°bintray"><a href="#ä¸Šä¼ åˆ°bintray" class="headerlink" title="ä¸Šä¼ åˆ°bintray"></a>ä¸Šä¼ åˆ°bintray</h4><ol><li><p>åœ¨AndroidStudioå·¥ç¨‹å’Œmoduleä¸­é…ç½®<br> åœ¨å·¥ç¨‹çš„build.gradleä¸­æ·»åŠ <code>classpath &#39;com.novoda:bintray-release:0.9.1&#39;</code><br> åœ¨è¦ä¸Šä¼ çš„lib moduleä¸­æ·»åŠ </p> <figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs groovy">apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;java-library&#x27;</span><br>apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;com.novoda.bintray-release&#x27;</span> <span class="hljs-comment">//æ·»åŠ </span><br>dependencies &#123;<br>    implementation fileTree(<span class="hljs-attr">dir:</span> <span class="hljs-string">&#x27;libs&#x27;</span>, <span class="hljs-attr">include:</span> [<span class="hljs-string">&#x27;*.jar&#x27;</span>])<br>&#125;<br>...<br>...<br><br><span class="hljs-comment">//æ·»åŠ </span><br><span class="hljs-comment">//å…¶ä»–äººå¼•ç”¨çš„æ ¼å¼ä¸º groupId:artifactId:publishVersion</span><br>publish &#123;<br>    userOrg = <span class="hljs-string">&#x27;huangyuanlove&#x27;</span> <span class="hljs-comment">//JFrogBintrayçš„ç”¨æˆ·å</span><br>    repoName = <span class="hljs-string">&#x27;AndroidAnnotation&#x27;</span> <span class="hljs-comment">//ä¸Šé¢åˆ›å»ºçš„ä»“åº“å</span><br>    groupId = <span class="hljs-string">&#x27;com.huangyuanlove&#x27;</span> <br>    artifactId = <span class="hljs-string">&#x27;view-inject-annotation&#x27;</span><br>    publishVersion = <span class="hljs-string">&#x27;0.0.2&#x27;</span><br>    desc = <span class="hljs-string">&#x27;Make flow layouts simpler&#x27;</span><br>    website = <span class="hljs-string">&#x27;https://github.com/huangyuanlove/AndroidAnnotation&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œ<code>./gradlew clean build bintrayUpload -PbintrayUser=username -PbintrayKey=apiKey -PdryRun=false</code></p></li><li><p>ç­‰å¾…æ‰§è¡ŒæˆåŠŸï¼Œæç¤ºsuccessful</p></li></ol><h4 id="å‘å¸ƒåˆ°jcenter"><a href="#å‘å¸ƒåˆ°jcenter" class="headerlink" title="å‘å¸ƒåˆ°jcenter"></a>å‘å¸ƒåˆ°jcenter</h4><p><img src="/image/jcenter/package_in_repository.png" alt="packages in repository"></p><ol><li><p>åœ¨è‡ªå·±çš„bintrayä»“åº“ä¸­æ‰¾åˆ°è¿™ä¸ªåŒ…ï¼Œè¿›å…¥è¯¦æƒ…é¡µ</p><p><img src="/image/jcenter/add_to_jcenter.png" alt="packages in repository"></p></li><li><p>ç‚¹å‡»å³ä¸Šè§’<code>Actions</code>èœå•ï¼Œé€‰æ‹©<code>Add to Jcenter</code>ï¼Œåœ¨å¼¹å‡ºæ¡†ç‚¹å‡»<code>send</code></p></li><li><p>å®¡æ ¸ç»“æœä¼šä»¥ç«™å†…ä¿¡çš„å½¢å¼é€šçŸ¥ä½ ï¼Œä¸é€šè¿‡çš„è¯ä¼šå‘Šè¯‰ä½ åŸå› ã€‚è‡ªå·±åˆšå¼€å§‹å‘å¸ƒçš„ç‰ˆæœ¬å«æœ‰<code>preview</code>ï¼Œå®¡æ ¸ä¸é€šè¿‡ï¼Œå»ºè®®ç»è¿‡è¯¦ç»†æµ‹è¯•ä¹‹åå†æäº¤</p></li></ol><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>jcenter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>flutter_pluginå¼€å‘</title>
    <link href="/2019/09/16/flutter_plugin%E5%BC%80%E5%8F%91/"/>
    <url>/2019/09/16/flutter_plugin%E5%BC%80%E5%8F%91/</url>
    
    <content type="html"><![CDATA[<p>ä¸€ä¸ªå¼€å‘Flutter plugin  å’Œ åœ¨Flutterä¸­åµŒå…¥åŸç”Ÿæ§ä»¶çš„ç¬”è®°ã€‚å®Œå…¨æ˜¯ç…§ç€çš„å®˜ç½‘æ¥å®è·µçš„ã€‚</p><p><a href="https://flutter.dev/docs/development/packages-and-plugins/developing-packages">https://flutter.dev/docs/development/packages-and-plugins/developing-packages</a></p><p>Flutterä¸­çš„packageåˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯çº¯dartè¯­è¨€çš„çš„packageï¼Œæ¯”å¦‚ <a href="https://pub.dev/packages/fluro"><code>fluro</code></a>ï¼Œç§°ä¹‹ä¸º<em>Dart packages</em></p><p>è¿˜æœ‰ä¸€ç§æ˜¯ç”±åŸç”Ÿå¹³å°ä»£ç (Android:java or kotlinï¼ŒiOSï¼šOC or swift)ï¼Œæ¯”å¦‚<a href="https://pub.dev/packages/battery"><code>battery</code></a>ï¼Œç§°ä¹‹ä¸º<em>Plugin packages</em>ã€‚</p><p>ä¸‹é¢æ˜¯å¯¹<em>Plugin packages</em>å¼€å‘çš„å®è·µ</p><span id="more"></span><h3 id="Create-the-package"><a href="#Create-the-package" class="headerlink" title="Create the package"></a>Create the package</h3><p>åˆ›å»ºå·¥ç¨‹ï¼Œå‘½ä»¤è¡Œ</p><p><code>flutter create --org com.example --template=plugin name</code></p><p>é»˜è®¤Androidæ˜¯javaï¼ŒiOSæ˜¯OCï¼Œä¹Ÿå¯ä»¥æŒ‡å®šé»˜è®¤è¯­è¨€</p><p><code>flutter create --template=plugin -i swift -a kotlin name</code></p><p>ä¹Ÿå¯ä»¥åŒè¿‡ASåˆ›å»ºï¼Œé€‰æ‹©<code>Flutter plugin</code>å°±å¥½ã€‚</p><p>ä¸»è¦æ–‡ä»¶å¦‚ä¸‹(ä»¥å·¥ç¨‹æ ¹ç›®å½•ä¸ºåŸºç¡€ç›®å½•æ¥è¯´çš„)ï¼š</p><ul><li><p>lib</p><p>åˆšåˆ›å»ºå¥½çš„é¡¹ç›®ä¸­ï¼Œè¯¥æ–‡ä»¶å¤¹ä¸‹åªæœ‰ä¸€ä¸ªä»¥é¡¹ç›®åå‘½åçš„dartæ–‡ä»¶ï¼Œåˆ›å»ºäº†ä¸€ä¸ªMethodChannel å’Œå®ç°äº†ä¸€ä¸ª<code>platformVersion</code>æ–¹æ³•</p></li><li><p>android</p><p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œåœ¨AndroidStudioä¸­ä»¥Projectæ–¹å¼é¢„è§ˆå·¥ç¨‹æ—¶ï¼Œè¯¥ç›®å½•ä¸‹çš„src.mainæ–‡ä»¶å¤¹ä¸‹åªæœ‰ä¸€ä¸ªæ¸…å•æ–‡ä»¶ï¼Œå¯ä»¥åˆ‡æ¢åˆ°Androidæ–¹å¼é¢„è§ˆã€‚å¯ä»¥çœ‹åˆ°src.mainä¸‹æœ‰ä¸€ä¸ªå®ç°<code>MethodCallHandler</code>æ¥å£çš„ç±»ï¼Œå¹¶ä¸”å·²ç»å®ç°äº†<code>getPlatformVersion</code>çš„è°ƒç”¨ï¼Œæˆ‘ä»¬å¼€å‘æ’ä»¶åŸç”Ÿä»£ç å°±æ˜¯åœ¨è¿™é‡Œå†™çš„</p></li><li><p>iOS</p><p>åœ¨AndroidStudioä¸‹çœ‹åˆ°åªæœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹Assetså’ŒClassesï¼Œåœ¨Classesä¸‹æœ‰ä¸ª<code>.h</code> å’Œ<code>.m</code>ï¼Œä¹Ÿæ˜¯åˆ›å»ºäº†<code>FlutterMethodChannel</code>å’Œå®ç°äº†<code>platformVersion</code>è°ƒç”¨</p></li><li><p>Example</p><p>åœ¨è¿™é‡Œæµ‹è¯•æˆ‘ä»¬è‡ªå·±å†™çš„æ’ä»¶ï¼Œå¹¶ä¸”ç»™ä½¿ç”¨è¿™æä¾›ç¤ºä¾‹ã€‚è¯¥æ–‡ä»¶å¤¹ä¸‹åŒ…å«Androidã€iOSå’ŒFlutterä»£ç </p></li></ul><h3 id="Implement-the-package"><a href="#Implement-the-package" class="headerlink" title="Implement the package"></a>Implement the package</h3><p>As a plugin package contains code for several platforms written in several programming languages, some specific steps are needed to ensure a smooth experience.</p><h4 id="Define-the-package-API"><a href="#Define-the-package-API" class="headerlink" title="Define the package API"></a>Define the package API</h4><p>å‡å¦‚æˆ‘ä»¬è¦å¼€å‘ä¸€ä¸ªæ‰“å¼€æŸäº›åŸç”Ÿç•Œé¢çš„æ’ä»¶ï¼Œæ¯”å¦‚æ‰“å¼€åŸç”Ÿè®¾ç½®é¡µé¢ã€æ‹¨å·é¡µé¢ã€æµè§ˆå™¨ç­‰</p><p>åœ¨<code>lib</code>ä¸‹çš„dartæ–‡ä»¶ä¸­ï¼Œå¢åŠ ä¸€ä¸ªåå­—ä¸º<code>openOSView</code>çš„æ–¹æ³•è°ƒç”¨ï¼Œå¹¶ä¸”ä¼ é€’ä¸€ä¸ªStringç±»å‹çš„urlå‚æ•°</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FlutterPluginOpenNative</span> </span>&#123;<br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> MethodChannel _channel =<br>      <span class="hljs-keyword">const</span> MethodChannel(<span class="hljs-string">&#x27;flutter_plugin_open_native&#x27;</span>);<br><br>  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-built_in">String</span>&gt; <span class="hljs-keyword">get</span> platformVersion <span class="hljs-keyword">async</span> &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> version = <span class="hljs-keyword">await</span> _channel.invokeMethod(<span class="hljs-string">&#x27;getPlatformVersion&#x27;</span>);<br>    <span class="hljs-keyword">return</span> version;<br>  &#125;<br><br>  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt;  openNative(<span class="hljs-built_in">String</span> url) <span class="hljs-keyword">async</span> &#123;<br>    <span class="hljs-keyword">await</span> _channel.invokeMethod(<span class="hljs-string">&#x27;openOSView&#x27;</span>,url);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="Add-Android-platform-code"><a href="#Add-Android-platform-code" class="headerlink" title="Add Android platform code"></a>Add Android platform code</h4><p>åœ¨Androidä¸‹å®ç°äº†<code>MethodCallHandler</code>æ¥å£çš„ç±»ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMethodCall</span><span class="hljs-params">(MethodCall call, Result result)</span> &#123;<br>    <span class="hljs-keyword">if</span> (call.method.equals(<span class="hljs-string">&quot;getPlatformVersion&quot;</span>)) &#123;<br>      result.success(<span class="hljs-string">&quot;Android &quot;</span> + android.os.Build.VERSION.RELEASE);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(call.method.equals(<span class="hljs-string">&quot;openOSView&quot;</span>))&#123;<br>      <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>();<br>      intent.setAction(Intent.ACTION_VIEW);<br>      intent.setData(Uri.parse(call.arguments.toString()));<br>      activity.startActivity(intent);<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>      result.notImplemented();<br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></figure><h4 id="Add-iOS-platform-code"><a href="#Add-iOS-platform-code" class="headerlink" title="Add iOS platform code"></a>Add iOS platform code</h4><p>åœ¨iOS</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs objective-c">- (void)handleMethodCall:(FlutterMethodCall*)call result:(FlutterResult)result &#123;<br>    if ([@&quot;getPlatformVersion&quot; isEqualToString:call.method]) &#123;<br>        result([@&quot;iOS &quot; stringByAppendingString:[[UIDevice currentDevice] systemVersion]]);<br>    &#125;<br>    else if([@&quot;openOSView&quot; isEqualToString:call.method])&#123;<br>        NSString * phoneUri = call.arguments;<br>        [[UIApplication sharedApplication] openURL:[NSURL URLWithString:phoneUri]];<br>    &#125;<br>    <br>    else &#123;<br>        result(FlutterMethodNotImplemented);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ç”¨XCodeå¼€å‘çš„è¯ï¼Œé€‰æ‹©æ‰“å¼€exampleâ€“&gt;iosâ€“&gt;Runner.xcworkspaceï¼Œè¯¥æ–‡ä»¶å­˜åœ¨äº</p><p><code>Pods--&gt;Development Pods--&gt;projectname</code>ä¸‹</p><p><img src="/image/flutter/flutter_plugin_project_in_xcode.png" alt="project in xcode"></p><p>ç¬¬ä¸€ä¸ªçº¢æ¡†æ˜¯é¡¹ç›®ä¸­exampleâ€“&gt;iosä¸­çš„å†…å®¹</p><p>ç¬¬äºŒä¸ªçº¢æ¡†æ˜¯é¡¹ç›®ä¸­iosæ–‡ä»¶å¤¹ä¸‹å†…å®¹</p><hr><p>è¿™æ ·ï¼Œä¸€ä¸ªç®€å•çš„æ’ä»¶å°±å¼€å‘å®Œäº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨exampleä¸­æµ‹è¯•ä¸€ä¸‹ï¼Œç”±äºæ’ä»¶ç‰¹åˆ«ç®€å•ï¼Œä¸éœ€è¦åœ¨åŸç”Ÿä¾§åšåˆå§‹åŒ–ä¹‹ç±»çš„å·¥ä½œï¼Œä½¿ç”¨åˆ›å»ºé¡¹ç›®æ—¶ç”Ÿæˆçš„ä»£ç å°±å¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€è¦ã€‚</p><p>åœ¨<code>example--&gt;lib--&gt;main.dart</code>ä¸­æ”¾ä¸€ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»çš„æ—¶å€™è°ƒç”¨<code>FlutterPluginOpenNative.openNative(&quot;https://blog.huangyuanlove.com&quot;);</code>ç„¶åè¿è¡Œåˆ°è®¾å¤‡ï¼ŒæŸ¥çœ‹ä¸€ä¸‹æ•ˆæœ</p><p><code>flutter run -d all</code> å¯ä»¥è¿è¡Œåˆ°æ‰€æœ‰å·²è¿æ¥çš„è®¾å¤‡</p><hr><h3 id="FlutteråµŒå…¥åŸç”Ÿæ§ä»¶"><a href="#FlutteråµŒå…¥åŸç”Ÿæ§ä»¶" class="headerlink" title="FlutteråµŒå…¥åŸç”Ÿæ§ä»¶"></a>FlutteråµŒå…¥åŸç”Ÿæ§ä»¶</h3><p>ä¸Šé¢æ˜¯å¼€å‘çš„æ’ä»¶ï¼Œä¸‹é¢æ˜¯å¦‚æœåœ¨flutterä¸­åµŒå…¥åŸç”Ÿæ§ä»¶</p><p>è¿™é‡Œç”¨åˆ°äº†Flutterä¸­çš„ä¸¤ä¸ªç±»<code>AndroidView</code>å’Œ<code>UiKitView</code>ï¼Œæ‡’å¾—ç¿»è¯‘ç›´æ¥çœ‹å®˜æ–¹ç‰ˆ<a href="https://api.flutter.dev/flutter/widgets/AndroidView-class.html">https://api.flutter.dev/flutter/widgets/AndroidView-class.html</a>  å’Œ<a href="https://api.flutter.dev/flutter/widgets/UiKitView-class.html">https://api.flutter.dev/flutter/widgets/UiKitView-class.html</a></p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦åµŒå…¥åŸç”Ÿå±•ç¤ºæ–‡å­—çš„æ§ä»¶ï¼Œå¯¹äºAndroidæ¥è®²ï¼Œä¸€èˆ¬æ˜¯TextViewï¼Œå¯¹äºiOSæ¥è®²ï¼Œä¸€èˆ¬æ˜¯UILabelã€‚</p><h4 id="åœ¨-flutterä¾§"><a href="#åœ¨-flutterä¾§" class="headerlink" title="åœ¨ flutterä¾§"></a>åœ¨ flutterä¾§</h4><p>ä¸€èˆ¬æ˜¯ä¸€ä¸ªControllerå’Œä¸€ä¸ªStatefulWidgetï¼Œå½“ç„¶è¿™é‡Œçš„Controlleråªæ˜¯ä¸€ä¸ªæ™®é€šç±»ï¼Œç”¨æ¥åˆ›å»ºchannelå’ŒåŸç”Ÿé€šä¿¡</p><p>ä»£ç å¦‚ä¸‹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs dart"><br><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">void</span> TextViewCreatedCallback(TextViewController controller);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TextViewController</span> </span>&#123;<br>  TextViewController._(<span class="hljs-built_in">int</span> id)<br>      : _channel = <span class="hljs-keyword">new</span> MethodChannel(<span class="hljs-string">&#x27;me.chunyu.textview/textview&#x27;</span>);<br><br>  <span class="hljs-keyword">final</span> MethodChannel _channel;<br><br>  <span class="hljs-comment">//è°ƒç”¨setTextæ–¹æ³•ç»™æ§ä»¶è®¾ç½®æ–‡å­—ï¼Œéœ€è¦åŸç”Ÿä¾§è¿›è¡Œå®ç°</span><br>  Future&lt;<span class="hljs-keyword">void</span>&gt; setText(<span class="hljs-built_in">String</span> text) <span class="hljs-keyword">async</span> &#123;<br>    <span class="hljs-keyword">assert</span>(text != <span class="hljs-keyword">null</span>);<br>    <span class="hljs-keyword">return</span> _channel.invokeMethod(<span class="hljs-string">&#x27;setText&#x27;</span>, text);<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AndroidTextView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br><br>  <span class="hljs-keyword">final</span> TextViewCreatedCallback onTextViewCreated;<br>  <span class="hljs-keyword">const</span> AndroidTextView(&#123;<br>    Key key,<br>    <span class="hljs-keyword">this</span>.onTextViewCreated,<br>  &#125;) : <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-meta">@override</span><br>  _AndroidTextViewState createState() =&gt; _AndroidTextViewState();<br>&#125;<br><br><span class="hljs-comment">//å¯¹Androidå¹³å°è¿”å›AndroidViewï¼Œå¯¹iOSå¹³å°è¿”å›UiKitViewï¼Œå¹¶ä¸”åˆ¶å®šviewType</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_AndroidTextViewState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">AndroidTextView</span>&gt; </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">if</span> (defaultTargetPlatform == TargetPlatform.android) &#123;<br>      <span class="hljs-keyword">return</span> AndroidView(<br>        viewType: <span class="hljs-string">&#x27;me.chunyu.textview/textview&#x27;</span>,<br>        onPlatformViewCreated: _onPlatformViewCreated,<br>      );<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (defaultTargetPlatform == TargetPlatform.iOS)&#123;<br>      <span class="hljs-keyword">return</span> UiKitView(<br>        viewType: <span class="hljs-string">&#x27;me.chunyu.textview/textview&#x27;</span>,<br>        onPlatformViewCreated: _onPlatformViewCreated,<br>      );<br>    &#125;<br>    <span class="hljs-keyword">return</span> Text(<br>        <span class="hljs-string">&#x27;<span class="hljs-subst">$defaultTargetPlatform</span> is not yet supported by the text_view plugin&#x27;</span>);<br><br>  &#125;<br>  <span class="hljs-keyword">void</span> _onPlatformViewCreated(<span class="hljs-built_in">int</span> id) &#123;<br>    <span class="hljs-keyword">if</span> (widget.onTextViewCreated == <span class="hljs-keyword">null</span>) &#123;<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;id _onPlatformViewCreated :--&gt; <span class="hljs-subst">$id</span>&quot;</span>);<br><br><br>    widget.onTextViewCreated(<span class="hljs-keyword">new</span> TextViewController._(id));<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åœ¨Androidä¾§"><a href="#åœ¨Androidä¾§" class="headerlink" title="åœ¨Androidä¾§"></a>åœ¨Androidä¾§</h4><p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå®ç°äº†<code>PlatformViewFactory</code>çš„ç±» å’Œä¸€ä¸ªå®ç°äº†<code>PlatformView</code>ã€<code>MethodCallHandler</code>æ¥å£çš„ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TextViewFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PlatformViewFactory</span>&#123;<br><br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BinaryMessenger messenger;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">TextViewFactory</span><span class="hljs-params">(BinaryMessenger messenger)</span> &#123;<br>    <span class="hljs-built_in">super</span>(StandardMessageCodec.INSTANCE);<br>    <span class="hljs-built_in">this</span>.messenger = messenger;<br>  &#125;<br><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> PlatformView <span class="hljs-title function_">create</span><span class="hljs-params">(Context context, <span class="hljs-type">int</span> id, Object o)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FlutterTextView</span>(context, messenger, id);<br>  &#125;<br><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">FlutterTextView</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PlatformView</span>, MethodCallHandler  &#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> TextView textView;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MethodChannel methodChannel;<br><br>  FlutterTextView(Context context, BinaryMessenger messenger, <span class="hljs-type">int</span> id) &#123;<br>    Log.e(<span class="hljs-string">&quot;id&quot;</span>,<span class="hljs-string">&quot;id :--&gt;&quot;</span> +id);<br>    textView = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextView</span>(context);<br>    textView.setTextColor(Color.BLUE);<br>    textView.setBackgroundColor(Color.GREEN);<br>    methodChannel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MethodChannel</span>(messenger, <span class="hljs-string">&quot;me.chunyu.textview/textview&quot;</span>);<br>    methodChannel.setMethodCallHandler(<span class="hljs-built_in">this</span>);<br>  &#125;<br><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> View <span class="hljs-title function_">getView</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> textView;<br>  &#125;<br><br>  <span class="hljs-comment">//å®ç°ä»¥ä¸‹flutteré€šè¿‡channelè°ƒç”¨çš„`setText`æ–¹æ³•</span><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMethodCall</span><span class="hljs-params">(MethodCall methodCall, MethodChannel.Result result)</span> &#123;<br>    <span class="hljs-keyword">switch</span> (methodCall.method) &#123;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;setText&quot;</span>:<br>        setText(methodCall, result);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">default</span>:<br>        result.notImplemented();<br>    &#125;<br><br>  &#125;<br><br>  <span class="hljs-comment">//è®¾ç½®æ–‡å­—ï¼Œå¹¶è¿”å›æˆåŠŸ</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setText</span><span class="hljs-params">(MethodCall methodCall, Result result)</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> (String) methodCall.arguments;<br>    textView.setText(text);<br>    result.success(<span class="hljs-literal">null</span>);<br>  &#125;<br><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dispose</span><span class="hljs-params">()</span> &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œåœ¨æ’ä»¶çš„<code>registerWith</code>æ–¹æ³•ä¸­æ³¨å†Œä¸€ä¸‹<code>channel</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">registrar.platformViewRegistry().registerViewFactory(<span class="hljs-string">&quot;me.chunyu.textview/textview&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">TextViewFactory</span>(registrar.messenger()));<br></code></pre></td></tr></table></figure><h4 id="åœ¨iOSä¾§"><a href="#åœ¨iOSä¾§" class="headerlink" title="åœ¨iOSä¾§"></a>åœ¨iOSä¾§</h4><p>ä¸€ä¸ª<code>.h</code>æ–‡ä»¶ï¼Œå£°æ˜ä¸€ä¸‹å®ç°<code>NSObject&lt;FlutterPlatformView&gt;</code></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs objc"><span class="hljs-meta">#import <span class="hljs-string">&lt;Foundation/Foundation.h&gt;</span></span><br><span class="hljs-meta">#import <span class="hljs-string">&lt;Flutter/Flutter.h&gt;</span></span><br><span class="hljs-built_in">NS_ASSUME_NONNULL_BEGIN</span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">AndroidTextView</span> : <span class="hljs-title">NSObject</span>&lt;<span class="hljs-title">FlutterPlatformView</span>&gt;</span><br>- (<span class="hljs-keyword">instancetype</span>)initWithWithFrame:(<span class="hljs-built_in">CGRect</span>)frame<br>                   viewIdentifier:(int64_t)viewId<br>                        arguments:(<span class="hljs-type">id</span> _Nullable)args<br>                  binaryMessenger:(<span class="hljs-built_in">NSObject</span>&lt;FlutterBinaryMessenger&gt;*)messenger;<br><br><span class="hljs-keyword">@end</span><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">FlutterAndroidTextViewFactory</span> : <span class="hljs-title">NSObject</span>&lt;<span class="hljs-title">FlutterPlatformViewFactory</span>&gt;</span><br><br>- (<span class="hljs-keyword">instancetype</span>)initWithMessenger:(<span class="hljs-built_in">NSObject</span>&lt;FlutterBinaryMessenger&gt;*)messager;<br><br><span class="hljs-keyword">@end</span><br><br><span class="hljs-built_in">NS_ASSUME_NONNULL_END</span><br></code></pre></td></tr></table></figure><p>ä¸€ä¸ª<code>.m</code>æ–‡ä»¶ï¼Œå®ç°ä»¥ä¸Šæ–¹æ³•</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs objc"><br><span class="hljs-meta">#import <span class="hljs-string">&quot;AndroidTextView.h&quot;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">FlutterAndroidTextViewFactory</span></span>&#123;<br>    <span class="hljs-built_in">NSObject</span>&lt;FlutterBinaryMessenger&gt;*_messenger;<br>&#125;<br><br>- (<span class="hljs-keyword">instancetype</span>)initWithMessenger:(<span class="hljs-built_in">NSObject</span>&lt;FlutterBinaryMessenger&gt; *)messager&#123;<br>    <span class="hljs-keyword">self</span> = [<span class="hljs-variable language_">super</span> init];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>) &#123;<br>        _messenger = messager;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;<br>&#125;<br><br>-(<span class="hljs-built_in">NSObject</span>&lt;FlutterMessageCodec&gt; *)createArgsCodec&#123;<br>    <span class="hljs-keyword">return</span> [FlutterStandardMessageCodec sharedInstance];<br>&#125;<br><br>-(<span class="hljs-built_in">NSObject</span>&lt;FlutterPlatformView&gt; *)createWithFrame:(<span class="hljs-built_in">CGRect</span>)frame viewIdentifier:(int64_t)viewId arguments:(<span class="hljs-type">id</span>)args&#123;<br>    AndroidTextView * androidTextView = [[AndroidTextView alloc] initWithWithFrame:frame viewIdentifier:viewId arguments:args binaryMessenger:_messenger];<br>    <br>    <span class="hljs-keyword">return</span> androidTextView;<br>    <br>&#125;<br><br><span class="hljs-keyword">@end</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">AndroidTextView</span></span>&#123;<br>    int64_t _viewId;<br>    FlutterMethodChannel* _channel;<br>    <span class="hljs-built_in">UILabel</span> * _label;<br>    <br>&#125;<br><br>- (<span class="hljs-keyword">instancetype</span>)initWithWithFrame:(<span class="hljs-built_in">CGRect</span>)frame viewIdentifier:(int64_t)viewId arguments:(<span class="hljs-type">id</span>)args binaryMessenger:(<span class="hljs-built_in">NSObject</span>&lt;FlutterBinaryMessenger&gt; *)messenger&#123;<br>    <span class="hljs-keyword">if</span> ([<span class="hljs-variable language_">super</span> init]) &#123;<br>        _label = [[<span class="hljs-built_in">UILabel</span> alloc] init];<br>        _label.textColor = <span class="hljs-built_in">UIColor</span>.redColor;<br>        _label.backgroundColor = <span class="hljs-built_in">UIColor</span>.blueColor;<br>        _label.font = [<span class="hljs-built_in">UIFont</span> fontWithName:<span class="hljs-string">@&quot;Arial&quot;</span> size:<span class="hljs-number">30</span>];<br>        _viewId = viewId;<br>        <span class="hljs-built_in">NSString</span>* channelName =  <span class="hljs-string">@&quot;me.chunyu.textview/textview&quot;</span>;<br>        _channel = [FlutterMethodChannel methodChannelWithName:channelName binaryMessenger:messenger];<br>        __<span class="hljs-keyword">weak</span> __typeof__(<span class="hljs-keyword">self</span>) weakSelf = <span class="hljs-keyword">self</span>;<br>        [_channel setMethodCallHandler:^(FlutterMethodCall *  call, FlutterResult  result) &#123;<br>            [weakSelf onMethodCall:call result:result];<br>        &#125;];   <br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;<br>&#125;<br><br>-(<span class="hljs-built_in">UIView</span> *)view&#123;<br>    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;invoke view()&quot;</span>);<br>    <span class="hljs-keyword">return</span> _label;<br>&#125;<br><span class="hljs-comment">//å®ç°flutterä¾§é€šè¿‡channelè°ƒç”¨çš„`setText`æ–¹æ³•</span><br>-(<span class="hljs-type">void</span>)onMethodCall:(FlutterMethodCall*)call result:(FlutterResult)result&#123;<br>    <span class="hljs-keyword">if</span> ([[call method] isEqualToString:<span class="hljs-string">@&quot;setText&quot;</span>]) &#123;<br>        _label.text = [call arguments];<br>        <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;%@&quot;</span>, call.arguments);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">@end</span><br></code></pre></td></tr></table></figure><p>åœ¨pluginä¸­çš„<code>registerWithRegistrar</code>æ–¹æ³•ä¸­æ³¨å†Œä¸€ä¸‹<code>channel</code></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs objc">[registrar registerViewFactory:[[FlutterAndroidTextViewFactory alloc] initWithMessenger:registrar.messenger] withId:<span class="hljs-string">@&quot;me.chunyu.textview/textview&quot;</span>];<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæƒ³è¦åœ¨iOSä¸­æ˜¾ç¤ºè¿™ç§flutteråµŒå…¥åŸç”Ÿçš„ç©ºé—´ï¼Œéœ€è¦åœ¨info.plistæ–‡ä»¶ä¸­åŠ å…¥</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs objc">&lt;key&gt;io.flutter.embedded_views_preview&lt;/key&gt;<br>&lt;<span class="hljs-literal">true</span>/&gt;<br></code></pre></td></tr></table></figure><p>åœ¨flutterä¸­åµŒå…¥åŸç”Ÿæ§ä»¶å¹¶ä¸æ¨èï¼Œæ€§èƒ½è·Ÿä¸ä¸Šï¼Œæ¶ˆè€—å¤ªå¤§äº†ï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ä¸å¾—ä¸è¿™ä¹ˆæã€‚ã€‚ã€‚ã€‚ã€‚</p><h3 id="Adding-documentation"><a href="#Adding-documentation" class="headerlink" title="Adding documentation"></a>Adding documentation</h3><p>è¿™ä¸ªæ²¡å•¥å¥½è¯´çš„ï¼Œè·Ÿç€å®˜æ–¹åšå°±å¥½äº†</p><p>When you publish a package, API documentation is automatically generated and published to dartdocs.org, see for example the <a href="https://pub.dev/documentation/device_info/latest">device_info docs</a></p><h3 id="Adding-licenses-to-the-LICENSE-file"><a href="#Adding-licenses-to-the-LICENSE-file" class="headerlink" title="Adding licenses to the LICENSE file"></a>Adding licenses to the LICENSE file</h3><p>æ·»åŠ åè®®</p><h3 id="Publishing-packages"><a href="#Publishing-packages" class="headerlink" title="Publishing packages"></a>Publishing packages</h3><p>å‘å¸ƒä¹‹å‰è¿è¡Œä¸€ä¸‹ <code>flutter pub pub publish --dry-run</code>ï¼Œæ ¹æ®æç¤ºä¿®æ”¹ä¸æ»¡è¶³éœ€æ±‚çš„åœ°æ–¹ã€‚</p><p>ä¹‹åæ‰§è¡Œ<code>flutter pub pub publish</code>ï¼Œå…·ä½“å¯ä»¥çœ‹For details on publishing, see the <a href="https://dart.dev/tools/pub/publishing">publishing docs</a> for the Pub site.</p>]]></content>
    
    
    
    <tags>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>flutter_boostæ¥å…¥åŠåˆ†æ</title>
    <link href="/2019/09/12/flutter-boost%E6%8E%A5%E5%85%A5%E5%8F%8A%E5%88%86%E6%9E%90/"/>
    <url>/2019/09/12/flutter-boost%E6%8E%A5%E5%85%A5%E5%8F%8A%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<p>flutter_boost åœ°å€ï¼š<a href="https://github.com/alibaba/flutter_boost">https://github.com/alibaba/flutter_boost</a><br>é›†æˆä¹‹åçš„é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/huangyuanlove/flutter_boost_demo">https://github.com/huangyuanlove/flutter_boost_demo</a><br>flutterç‰ˆæœ¬ï¼š v1.5.4-hotfix.2<br>flutter_boostç‰ˆæœ¬ï¼š0.1.52</p><span id="more"></span><h4 id="é›†æˆè¿‡ç¨‹"><a href="#é›†æˆè¿‡ç¨‹" class="headerlink" title="é›†æˆè¿‡ç¨‹"></a>é›†æˆè¿‡ç¨‹</h4><p>å‰æï¼š<strong>é¡¹ç›®å·²ç»é›†æˆflutterï¼Œå¹¶ä¸”å¯ä»¥è¿è¡Œ</strong></p><h5 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h5><p>æ ¹æ®å®˜æ–¹è¯´æ³•ï¼š<br>æ‰“å¼€pubspec.yamlå¹¶å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ°ä¾èµ–é¡¹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">flutter_boost:</span> <span class="hljs-string">^0.1.52</span><br></code></pre></td></tr></table></figure><p>æˆ–è€…å¯ä»¥ç›´æ¥ä¾èµ–githubçš„é¡¹ç›®çš„ç‰ˆæœ¬ï¼ŒTagï¼Œpubå‘å¸ƒä¼šæœ‰å»¶è¿Ÿï¼Œæ¨èç›´æ¥ä¾èµ–Githubé¡¹ç›®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><br><span class="hljs-attr">flutter_boost:</span><br>        <span class="hljs-attr">git:</span><br>            <span class="hljs-attr">url:</span> <span class="hljs-string">&#x27;https://github.com/alibaba/flutter_boost.git&#x27;</span><br>            <span class="hljs-attr">ref:</span> <span class="hljs-string">&#x27;0.1.52&#x27;</span><br>            <br></code></pre></td></tr></table></figure><p>ç„¶å <code>flutter packages get</code>ä¸€ä¸‹</p><p>åœ¨ä¸»å·¥ç¨‹çš„build.gradleä¸­ä¾èµ–ä¸€ä¸‹<br><code>implementation project(path: &#39;:flutter_boost&#39;)</code>,å®˜æ–¹æ²¡æœ‰æè¿™ä¸ªï¼Œä½†æ˜¯æˆ‘åœ¨é¡¹ç›®ä¸­ä¸æ·»åŠ è¿™ä¸ªä¾èµ–ï¼Œæ‰¾ä¸åˆ°å¯¹åº”çš„ç±»</p><h5 id="åœ¨flutter-noduleä¾§"><a href="#åœ¨flutter-noduleä¾§" class="headerlink" title="åœ¨flutter_noduleä¾§"></a>åœ¨flutter_noduleä¾§</h5><p>åœ¨<code>main.dart</code>ä¸­æ³¨å†Œä¸€ä¸‹è·¯ç”±ï¼Œè¿‡ç¨‹å’Œä½¿ç”¨å‘½åè·¯ç”±ç›¸ä¼¼</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs dart"><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_MyAppState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">MyApp</span>&gt; </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> initState() &#123;<br>    <span class="hljs-keyword">super</span>.initState();<br><br>    FlutterBoost.singleton.registerPageBuilders(&#123;<br>      <span class="hljs-string">&#x27;first&#x27;</span>: (pageName, params, _) =&gt; FirstRouteWidget(),<br>      <span class="hljs-string">&#x27;second&#x27;</span>: (pageName, params, _) =&gt; SecondRouteWidget(params),<br>      <span class="hljs-string">&#x27;tab&#x27;</span>: (pageName, params, _) =&gt; TabRouteWidget(),<br>      <span class="hljs-string">&#x27;flutterFragment&#x27;</span>: (pageName, params, _) =&gt; FragmentRouteWidget(params),<br><br>      <span class="hljs-comment">///<span class="language-markdown">å¯ä»¥åœ¨nativeå±‚é€šè¿‡ getContainerParams æ¥ä¼ é€’å‚æ•°</span></span><br>      <span class="hljs-string">&#x27;flutterPage&#x27;</span>: (pageName, params, _) &#123;<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;flutterPage params:<span class="hljs-subst">$params</span>&quot;</span>);<br><br>        <span class="hljs-keyword">return</span> FlutterRouteWidget();<br>      &#125;,<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> MaterialApp(<br>        title: <span class="hljs-string">&#x27;Flutter Boost example&#x27;</span>,<br>        builder: FlutterBoost.init(postPush: _onRoutePushed),<br>        home: Container());<br>  &#125;<br><br>  <span class="hljs-keyword">void</span> _onRoutePushed(<br>      <span class="hljs-built_in">String</span> pageName, <span class="hljs-built_in">String</span> uniqueId, <span class="hljs-built_in">Map</span> params, Route route, Future _) &#123;<br>  &#125;<br>  <br></code></pre></td></tr></table></figure><p>å…¶ä¸­ <code>FirstRouteWidget</code>ã€<code>SecondRouteWidget</code> ã€<code>TabRouteWidget</code>ã€<code>FragmentRouteWidget</code>ã€<code>FlutterRouteWidget</code>ä»£ç å¯ä»¥åœ¨<code>simple_page_widgets.dart</code>ä¸­æ‰¾åˆ°</p><h5 id="åœ¨åŸç”ŸAndroidä¾§"><a href="#åœ¨åŸç”ŸAndroidä¾§" class="headerlink" title="åœ¨åŸç”ŸAndroidä¾§"></a>åœ¨åŸç”ŸAndroidä¾§</h5><p>ä¿®æ”¹<code>Application</code>ç»§æ‰¿<code>FlutterApplication</code>,å¹¶ä¸”åœ¨<code>onCreate</code>åˆå§‹åŒ–<code>FlutterBoost</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java">FlutterBoost.init(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Platform</span>() &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Application <span class="hljs-title function_">getApplication</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> MyApplication.<span class="hljs-built_in">this</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isDebug</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">openContainer</span><span class="hljs-params">(Context context, String url, Map&lt;String, Object&gt; urlParams, <span class="hljs-type">int</span> requestCode, Map&lt;String, Object&gt; exts)</span> &#123;<br>        <span class="hljs-comment">//åœ¨flutterä¸­è°ƒç”¨FlutterBoost.singleton.open()æ–¹æ³•ï¼Œæœ€ç»ˆä¼šèµ°åˆ°è¿™é‡Œè¿›è¡Œå¤„ç†</span><br>        PageRouter.openPageByUrl(context,url,urlParams,requestCode);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> IFlutterEngineProvider <span class="hljs-title function_">engineProvider</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BoostEngineProvider</span>()&#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> BoostFlutterEngine <span class="hljs-title function_">createEngine</span><span class="hljs-params">(Context context)</span> &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BoostFlutterEngine</span>(context, <span class="hljs-keyword">new</span> <span class="hljs-title class_">DartExecutor</span>.DartEntrypoint(<br>                        context.getResources().getAssets(),<br>                        FlutterMain.findAppBundlePath(context),<br>                        <span class="hljs-string">&quot;main&quot;</span>),<span class="hljs-string">&quot;/&quot;</span>);<br>            &#125;<br>        &#125;;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">whenEngineStart</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> ANY_ACTIVITY_CREATED;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerPlugins</span><span class="hljs-params">(PluginRegistry registry)</span> &#123;<br>        <span class="hljs-built_in">super</span>.registerPlugins(registry);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p>Androidä¾§åŒ…å«flutter_viewçš„å®¹å™¨ï¼Œæ¯”å¦‚Activityéœ€è¦ç»§æ‰¿<code>BoostFlutterActivity</code>ï¼Œå¹¶å®ç°<code>getContainerUrl()</code>å’Œ<code>getContainerUrlParams()</code>æ–¹æ³•<br>å…¶ä¸­<code>getContainerUrl</code>æ–¹æ³•è¿”å›çš„å€¼å°±æ˜¯åœ¨<code>main.dart</code>ä¸­æ³¨å†Œçš„è·¯ç”±ï¼Œ<code>getContainerUrlParams</code>æ–¹æ³•è¿”å›å€¼åˆ™æ˜¯å¯¹åº”çš„<code>params</code>ã€‚</p><h4 id="å°è¯•"><a href="#å°è¯•" class="headerlink" title="å°è¯•"></a>å°è¯•</h4><p>ç›®å‰çš„åšæ³•æ˜¯åœ¨Androidè¿™è¾¹é…ç½®æ‰“å¼€çš„åè®®ï¼Œå’ŒiOSç»Ÿä¸€ï¼Œæ‰“å¼€é¡µé¢ä¹‹åä¼ é€’çš„å‚æ•°å…¨éƒ¨é™„åŠ åœ¨Uriä¸Šï¼Œ<br>æ¯”å¦‚åœ¨flutterä¸­çš„è°ƒç”¨æ‰“å¼€å¦å¤–ä¸€ä¸ªflutterç•Œé¢ï¼Œç¬¬ä¸€ä¸ªå‚æ•°uriå°±æ˜¯<code>sample://flutter/launch</code>,å¦‚æœæ˜¯æ‰“å¼€nativeé¡µé¢ï¼Œåˆ™æ˜¯<code>sample://native/launch</code><br>è¿™æ ·ä¸¤ç«¯å„è‡ªå¤„ç†å„è‡ªçš„é€»è¾‘å°±å¥½äº†ã€‚<br>åœ¨Androidç«¯ï¼Œ <code>PageRouter</code>ç±»ç”¨æ¥å¤„ç†nativeå’Œflutteré¡µé¢äº’ç›¸æ‰“å¼€çš„é€»è¾‘ï¼Œå°†ä¼ é€’è¿›æ¥çš„å‚æ•°æ‹¼æ¥æˆUriçš„å½¢å¼ï¼Œé€šè¿‡Intent.setData()æ–¹å¼ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªé¡µé¢ï¼Œè€Œä¸ç”¨å…³ç³»æ˜¯æ‰“å¼€nativeè¿˜æ˜¯flutterï¼Œ<br>åœ¨FlutterViewçš„å®¹å™¨<code>FlutterPageActivity</code>ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è§£æUriï¼Œè¿˜åŸä¸€ä¸‹è¦æ‰“å¼€çš„flutteré¡µé¢çš„routerä»¥åŠéœ€è¦çš„å‚æ•°ï¼Œé€šè¿‡ä¸Šé¢è¯´çš„ä¸¤ä¸ªæ–¹æ³•ä¼ é€’ç»™flutterã€‚</p><h4 id="flutter-boostæµç¨‹"><a href="#flutter-boostæµç¨‹" class="headerlink" title="flutter_boostæµç¨‹"></a>flutter_boostæµç¨‹</h4><h5 id="åœ¨flutterä¸­æ‰“å¼€flutteræˆ–è€…åŸç”Ÿ"><a href="#åœ¨flutterä¸­æ‰“å¼€flutteræˆ–è€…åŸç”Ÿ" class="headerlink" title="åœ¨flutterä¸­æ‰“å¼€flutteræˆ–è€…åŸç”Ÿ"></a>åœ¨flutterä¸­æ‰“å¼€flutteræˆ–è€…åŸç”Ÿ</h5><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">FlutterBoost.singleton.open(<span class="hljs-string">&quot;sample://nativePage&quot;</span>, urlParams:&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<span class="hljs-string">&quot;aaa&quot;</span>: <span class="hljs-string">&quot;bbb&quot;</span>&#125;<br>&#125;)<br></code></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dart">Future&lt;<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>,<span class="hljs-built_in">dynamic</span>&gt;&gt; open(<span class="hljs-built_in">String</span> url,&#123;<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>,<span class="hljs-built_in">dynamic</span>&gt; urlParams,<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>,<span class="hljs-built_in">dynamic</span>&gt; exts&#125;)&#123;<br><br>  <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; properties = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;();<br>  properties[<span class="hljs-string">&quot;url&quot;</span>] = url;<br>  properties[<span class="hljs-string">&quot;urlParams&quot;</span>] = urlParams;<br>  properties[<span class="hljs-string">&quot;exts&quot;</span>] = exts;<br>  <span class="hljs-keyword">return</span> channel.invokeMethod&lt;<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>,<span class="hljs-built_in">dynamic</span>&gt;&gt;(<br>      <span class="hljs-string">&#x27;openPage&#x27;</span>, properties);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¹Ÿæ˜¯é€šè¿‡channelè°ƒç”¨åŸç”Ÿçš„æ–¹æ³•ï¼Œæ–¹æ³•åå­—æ˜¯<strong>openPage</strong></p><p>åœ¨FlutterBoost.BoostMethodHandlerä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;openPage&quot;</span>:<br>                &#123;<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        Map&lt;String,Object&gt; params = methodCall.argument(<span class="hljs-string">&quot;urlParams&quot;</span>);<br>                        Map&lt;String,Object&gt; exts = methodCall.argument(<span class="hljs-string">&quot;exts&quot;</span>);<br>                        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> methodCall.argument(<span class="hljs-string">&quot;url&quot;</span>);<br><br>                        mManager.openContainer(url, params, exts, <span class="hljs-keyword">new</span> <span class="hljs-title class_">FlutterViewContainerManager</span>.OnResult() &#123;<br>                            <span class="hljs-meta">@Override</span><br>                            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onResult</span><span class="hljs-params">(Map&lt;String, Object&gt; rlt)</span> &#123;<br>                                <span class="hljs-keyword">if</span> (result != <span class="hljs-literal">null</span>) &#123;<br>                                    result.success(rlt);<br>                                &#125;<br>                            &#125;<br>                        &#125;);<br>                    &#125;<span class="hljs-keyword">catch</span> (Throwable t)&#123;<br>                        result.error(<span class="hljs-string">&quot;open page error&quot;</span>,t.getMessage(),t);<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„mManageræ˜¯<code>FlutterViewContainerManager</code>ä¸€ä¸ªå®ä¾‹ï¼Œ<code>openContainer</code>æ–¹æ³•çš„å®ç°æ˜¯è¿™æ ·çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">openContainer</span><span class="hljs-params">(String url, Map&lt;String, Object&gt; urlParams, Map&lt;String, Object&gt; exts,OnResult onResult)</span> &#123;<br>    ã€‚ã€‚ã€‚<br>    FlutterBoost.singleton().platform().openContainer(context,url,urlParams,requestCode,exts);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„æœ€åä¸€å¥<code>FlutterBoost.singleton().platform()</code>è¿™é‡Œçš„<code>platform</code>è¿”å›çš„æ˜¯ <code>IPlatform</code>ç±»å‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨Applicationä¸­åˆå§‹åŒ–<code>FlutterBoost</code>æ—¶ä¼ å…¥çš„å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">FlutterBoost.init(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Platform</span>()&#123;...&#125;)<br></code></pre></td></tr></table></figure><p>æœ€ç»ˆè°ƒç”¨äº†è¿™é‡Œé¢çš„<code>openContainer</code>æ–¹æ³•ï¼Œå°†è·¯ç”±å¤„ç†äº¤ç»™äº†åŸç”Ÿã€‚</p><p>æ€»ç»“ï¼š</p><p>åœ¨flutterä¸­è°ƒç”¨ <code>FlutterBoost.singleton.open</code> æ–¹æ³•ï¼Œé€šè¿‡<code>channel</code>è°ƒç”¨åŸç”Ÿï¼Œè¿™é‡Œçš„channelçš„å®ç°ç±»æ˜¯<code>BoostChannel</code>,åœ¨å…¶åˆå§‹åŒ–æ—¶æ³¨å†Œçš„methodHandlerã€‚ è°ƒç”¨åŸç”Ÿ<code>FlutterBoost.BoostMethodHandler</code>ä¸­çš„<code>onMethodCall()</code>ä¸­çš„<code>case  &#39;openPage&#39;</code>,ç„¶å<code>mManager.openContainer</code>ï¼Œä¹‹åå°±æ˜¯ <code>FlutterBoost.singleton().platform().openContainer(context,url,urlParams,requestCode,exts);</code></p><h5 id="åœ¨flutterä¸­å…³é—­é¡µé¢"><a href="#åœ¨flutterä¸­å…³é—­é¡µé¢" class="headerlink" title="åœ¨flutterä¸­å…³é—­é¡µé¢"></a>åœ¨flutterä¸­å…³é—­é¡µé¢</h5><p>è°ƒç”¨</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dart">BoostContainerSettings settings = BoostContainer.of(context).settings;<br>FlutterBoost.singleton.close(settings.uniqueId,result: &#123;<span class="hljs-string">&quot;result&quot;</span>:<span class="hljs-string">&quot;data from second&quot;</span>&#125;);<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„flutteræ‰“å¼€åŸç”Ÿæˆ–è€…flutteré¡µé¢æ—¶ä¼ çš„mapå‚æ•°ï¼Œæ‰“ä¸‹æ–­ç‚¹æˆ–è€…è¾“å‡ºä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°é‡Œé¢ä¼šæœ‰ä¸€ä¸ª<code>__container_uniqueid_key__</code>,<br>è¿™ä¸ªkeyæ˜¯flutter_boostç”¨æ¥æ ‡ç¤ºflutterviewçš„å®¹å™¨ï¼Œå½“æˆ‘ä»¬éœ€è¦åœ¨flutterä¸­å…³é—­é¡µé¢çš„æ—¶å€™ï¼Œéœ€è¦ä¼ å…¥è¿™ä¸ªkeyã€‚<br>è€Œå…³é—­é¡µé¢çš„æ—¶å€™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;closePage&quot;</span>:<br>            &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">uniqueId</span> <span class="hljs-operator">=</span> methodCall.argument(<span class="hljs-string">&quot;uniqueId&quot;</span>);<br>                    Map&lt;String,Object&gt; resultData = methodCall.argument(<span class="hljs-string">&quot;result&quot;</span>);<br>                    Map&lt;String,Object&gt; exts = methodCall.argument(<span class="hljs-string">&quot;exts&quot;</span>);<br><br>                    mManager.closeContainer(uniqueId, resultData,exts);<br>                    result.success(<span class="hljs-literal">true</span>);<br>                &#125;<span class="hljs-keyword">catch</span> (Throwable t)&#123;<br>                    result.error(<span class="hljs-string">&quot;close page error&quot;</span>,t.getMessage(),t);<br>                &#125;<br>            &#125;<br></code></pre></td></tr></table></figure><p>ä¹Ÿæ˜¯é€šè¿‡<code>FlutterViewContainerManager</code>çš„å®ä¾‹è¿›è¡Œå…³é—­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java">IContainerRecord <span class="hljs-title function_">closeContainer</span><span class="hljs-params">(String uniqueId, Map&lt;String, Object&gt; result,Map&lt;String,Object&gt; exts)</span> &#123;<br>    <span class="hljs-type">IContainerRecord</span> <span class="hljs-variable">targetRecord</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">for</span> (Map.Entry&lt;IFlutterViewContainer, IContainerRecord&gt; entry : mRecordMap.entrySet()) &#123;<br>        <span class="hljs-keyword">if</span> (TextUtils.equals(uniqueId, entry.getValue().uniqueId())) &#123;<br>            targetRecord = entry.getValue();<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(targetRecord == <span class="hljs-literal">null</span>) &#123;<br>        Debuger.exception(<span class="hljs-string">&quot;closeContainer can not find uniqueId:&quot;</span> + uniqueId);<br>    &#125;<br><br>    FlutterBoost.singleton().platform().closeContainer(targetRecord,result,exts);<br>    <span class="hljs-keyword">return</span> targetRecord;<br>&#125;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨FlutterBoost.singleton().platform()çš„å…³é—­å®¹å™¨æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">closeContainer</span><span class="hljs-params">(IContainerRecord record, Map&lt;String, Object&gt; result, Map&lt;String, Object&gt; exts)</span> &#123;<br>    <span class="hljs-keyword">if</span>(record == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;<br><br>    record.getContainer().finishContainer(result);<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨çš„recordä¸­containerçš„finishæ–¹æ³•ã€‚<br>è€Œåœ¨ContainerRecordç±»(IContainerRecordçš„å®ç°ç±»)çš„onAppearæ–¹æ³•ä¸­ï¼Œä¼šå°†å½“å‰é¡µé¢æ”¾å…¥è‡ªå·±ç»´æŠ¤çš„æ ˆä¸­ã€‚<br>å…·ä½“æ‰§è¡Œé¡ºåºï¼š<br>å½“æ‰“å¼€FlutterViewçš„å®¹å™¨(è¿™é‡Œæ˜¯æˆ‘ä»¬è‡ªå·±ç»§æ‰¿è‡ª<code>BoostFlutterActivity</code>çš„ç±»ï¼Œå®ç°äº†<code>finishContainer()</code>æ–¹æ³•)ï¼Œåœ¨<code>BoostFlutterActivity.onCreate()</code>ä¸­ï¼Œè°ƒç”¨<br><code> FlutterBoost.singleton().containerManager().generateSyncer(this);</code>,å°†å½“å‰çš„å®¹å™¨æ”¾åœ¨<code>FlutterViewContainerManager</code>ä¸­ï¼Œå¹¶ä¸”è®°å½•ä¸Šé¢è®²åˆ°å”¯ä¸€æ ‡ç¤º<br>å½“å…³é—­å®¹å™¨çš„æ—¶å€™ï¼Œåˆ™ä»é‡Œé¢æŸ¥æ‰¾åˆ°å¯¹åº”çš„å®¹å™¨ï¼Œæ‰§è¡ŒfinishContainer()ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ ‘è“æ´¾å®‰è£…owncloud</title>
    <link href="/2019/08/03/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%89%E8%A3%85owncloud/"/>
    <url>/2019/08/03/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%89%E8%A3%85owncloud/</url>
    
    <content type="html"><![CDATA[<p>ä¹°äº†ä¸ªæ–°ç©å…·ï¼šæ ‘è“æ´¾3b+ï¼ŒæŒºå¥½ç©ã€‚</p><ol><li>ä¸€ä¸ªå¼€å‘æ¿(åŒ…å«cpuã€å†…å­˜ã€ç½‘å¡ã€usbæ¥å£)ã€‚</li><li>ä¸€å¼ æ‰©å±•å¡(å†…å­˜å¡ï¼Œå°±æ˜¯ä¹‹å‰æ‰‹æœºä¸Šç”¨çš„é‚£ç§TFæ‹“å±•å¡ï¼Œç”¨æ¥è£…ç³»ç»Ÿï¼Œå¼€å‘æ¿ä¸Šæœ‰ä¸“é—¨çš„å¡æ§½ç”¨æ¥å®‰è£…æ‰©å±•å¡)ã€‚</li><li>ä¸€æ ¹ç½‘çº¿(å…¶å®å¼€å‘æ¿ä¸Šæ˜¯æœ‰æ— çº¿ç½‘å¡çš„ï¼Œæ®è¯´é…ç½®èµ·æ¥å¬éº»çƒ¦ï¼Œå°±ç”¨ç½‘çº¿ä¸Šï¼Œæ’ä¸Šå°±èƒ½ç”¨)</li><li>ä¸€æ ¹HDMIè§†é¢‘çº¿ï¼Œæ¯•ç«Ÿå®‰è£…ç³»ç»Ÿçš„æ—¶å€™å¯èƒ½ä¼šç”¨åˆ°</li><li>å…¶ä»–é…ä»¶ï¼Œæ¯”å¦‚æ•£çƒ­é£æ‰‡ã€å¤–å£³ã€æ‘„åƒå¤´ä»€ä¹ˆçš„éšæ„ï¼Œæ¯•ç«Ÿä¸æ˜¯å¿…é¡»çš„</li></ol><span id="more"></span><h3 id="å®‰è£…ç³»ç»Ÿ"><a href="#å®‰è£…ç³»ç»Ÿ" class="headerlink" title="å®‰è£…ç³»ç»Ÿ"></a>å®‰è£…ç³»ç»Ÿ</h3><ol><li>ç³»ç»Ÿï¼š å¯ä»¥åœ¨<a href="https://www.raspberrypi.org/downloads/">https://www.raspberrypi.org/downloads/</a> æŸ¥çœ‹ï¼Œæˆ‘æ˜¯ä¹ æƒ¯äº†ubuntuï¼Œä¸‹è½½çš„æ˜¯ <a href="https://ubuntu.com/download/iot/raspberry-pi-2-3">https://ubuntu.com/download/iot/raspberry-pi-2-3</a> è¿™ä¸ªç³»ç»Ÿï¼Œ</li><li>éœ€è¦çš„è½¯ä»¶ï¼šä¸“é—¨çš„æ ¼å¼åŒ–å·¥å…·SDFormatteræ ¼å¼åŒ–å†…å­˜å¡ï¼›windowsç³»ç»Ÿä¸‹å®‰è£…çƒ§å†™é•œåƒçš„å·¥å…·ï¼šWin32DiskImager</li><li>å°†ä¸‹è½½çš„ç³»ç»Ÿå†™åˆ°tfå¡ä¸Šï¼Œå°†å¡æ’å…¥å¼€å‘ç‰ˆï¼Œé€šç”µï¼Œå¯åŠ¨çš„æ¯”è¾ƒæ…¢ï¼Œå¯ä»¥åœ¨å±å¹•ä¸Šçœ‹åˆ°ä¸€äº›è¾“å‡ºï¼Œæ ¹æ®è‡ªå·±çš„éœ€è¦é…ç½®ä¸€ä¸‹å°±å¥½ã€‚</li></ol><h3 id="å®‰è£…-owncloud"><a href="#å®‰è£…-owncloud" class="headerlink" title="å®‰è£… owncloud"></a>å®‰è£… owncloud</h3><h4 id="æ‰€éœ€ç¯å¢ƒ"><a href="#æ‰€éœ€ç¯å¢ƒ" class="headerlink" title="æ‰€éœ€ç¯å¢ƒ"></a>æ‰€éœ€ç¯å¢ƒ</h4><ol><li>phpç¯å¢ƒåŠå¿…é¡»çš„ç»„ä»¶</li></ol><blockquote><p>å®‰è£…Apache ç½‘é¡µæœåŠ¡å™¨</p><p><strong>$ sudo apt-get install apache2</strong></p></blockquote><blockquote><p>å®‰è£…Mysql æ•°æ®åº“</p><p><strong>$ sudo apt-get install mysql-server mysql-client</strong></p></blockquote><blockquote><p>å®‰è£…PHP</p><p><strong>$ sudo apt-get install php7.2-mysql php7.2-curl php7.2-json php7.2-cgi libapache2-mod-php7.2 php7.2</strong></p><p><strong>$ sudo apt-get install php7.2-gd php7.2-intl php7.2-imagick</strong></p></blockquote><blockquote><p>å®‰è£…phpmyadminå¹¶è®¾ç½®mysqlçš„å¯†ç </p><p><strong>$ sudo apt-get install phpmyadmin</strong></p></blockquote><p>æ ¹æ®è¿”å›çš„æ¶ˆæ¯æç¤ºè¿›è¡Œæ“ä½œå°±å¥½ï¼Œé‡åˆ°é—®é¢˜å¯è‡ªè¡Œæœç´¢è§£å†³ï¼Œè§£å†³ä¸äº†ï¼Œå¯ä»¥é€€å‡ºäº†ã€‚</p><h4 id="æ£€æŸ¥phpç¯å¢ƒæ˜¯å¦å¯ç”¨"><a href="#æ£€æŸ¥phpç¯å¢ƒæ˜¯å¦å¯ç”¨" class="headerlink" title="æ£€æŸ¥phpç¯å¢ƒæ˜¯å¦å¯ç”¨"></a>æ£€æŸ¥phpç¯å¢ƒæ˜¯å¦å¯ç”¨</h4><p>åœ¨ <code>/var/www/html/</code>ä¸‹æ–°å»ºä¸€ä¸ªphpæ–‡ä»¶ï¼Œæ¯”å¦‚<code>test.php</code>ï¼Œè¾“å…¥ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?</span> php<br>    <span class="hljs-title function_ invoke__">phpinfo</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>ä¿å­˜ä¸€ä¸‹ï¼Œé‡å¯apacheæœåŠ¡ï¼Œ<code>sudo /etc/init.d/apache2 restart</code>ï¼Œè®¿é—® <code>http://ip/test.php</code>ï¼Œå¦‚æœèƒ½çœ‹åˆ°phpç‰ˆæœ¬ï¼Œåˆ™è¯´æ˜ç¯å¢ƒæ²¡é—®é¢˜ã€‚å¦‚æœçœ‹ä¸åˆ°ï¼Œè¯·è‡ªè¡Œè§£å†³ï¼›è§£å†³ä¸äº†ï¼Œå¯ä»¥é€€å‡ºäº†ã€‚</p><h4 id="ä¸‹è½½owncloudæºç å¹¶éƒ¨ç½²"><a href="#ä¸‹è½½owncloudæºç å¹¶éƒ¨ç½²" class="headerlink" title="ä¸‹è½½owncloudæºç å¹¶éƒ¨ç½²"></a>ä¸‹è½½owncloudæºç å¹¶éƒ¨ç½²</h4><blockquote><p> ä¸‹è½½å®‰è£…åŒ…ã€‚</p><p> <strong>$ wget</strong> <strong><a href="https://download.owncloud.org/community/owncloud-10.0.9.tar.bz2">https://download.owncloud.org/community/owncloud-10.0.9.tar.bz2</a></strong></p><p> è§£å‹å®‰è£…åŒ…</p><p> <strong>$ tar -xvf owncloud-10.0.9.tar.bz2</strong></p><p> å°†æ‰€æœ‰è§£å‹åçš„æ–‡ä»¶ç§»åˆ° &#x2F;var&#x2F;www&#x2F;html</p><p> <strong>$ sudo mv owncloud&#x2F;*  &#x2F;var&#x2F;www&#x2F;html</strong></p><p> ä¿®æ”¹Apacheçš„é…ç½®æ–‡ä»¶apache2.confï¼š</p><p> <strong>$ sudo nano &#x2F;etc&#x2F;apache2&#x2F;apache2.conf</strong></p><p> å‘ä¸‹æŸ¥æ‰¾åˆ°<code>AllowOverride</code>ï¼Œå°†Noneä¿®æ”¹ä¸ºAll</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">Directory</span> /<span class="hljs-attr">var</span>/<span class="hljs-attr">www</span>/&gt;</span><br>Options Indexes FollowSysmLinks<br>AllowOverride All<br>Require all granted<br><span class="hljs-tag">&lt;/<span class="hljs-name">Directory</span>&gt;</span><br></code></pre></td></tr></table></figure><p> åˆ›å»ºdataæ–‡ä»¶å¤¹ï¼Œç”¨äºä¿å­˜æ•°æ®</p><p> <strong>$cd &#x2F;var&#x2F;www&#x2F;html</strong></p><p> <strong>$sudo mkdir data</strong></p><p> ä¿®æ”¹Owncloudæ–‡ä»¶å¤¹çš„æ–‡ä»¶æƒé™ï¼š</p><p> <strong>$sudo chown -R www-data:www-data &#x2F;var&#x2F;www&#x2F;html&#x2F;</strong></p><p> <strong>$sudo chmod 777 &#x2F;var&#x2F;www&#x2F;html&#x2F;config&#x2F;</strong></p><p> åœ¨MySqlä¸Šåˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œä¿å­˜æ¥è‡ªOwnCloudçš„æ•°æ®ã€‚</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">$ sudo mysql -u root -p<br>create database owncloud;<br>GRANT ALL ON owncloud.*TO username@localhost IDENTIFIED BY &#x27;password&#x27;;<br>flush privileges;<br>exit<br></code></pre></td></tr></table></figure><p> é‡å¯ApacheæœåŠ¡å™¨</p><p> <strong>$</strong> <strong>sudo &#x2F;etc&#x2F;init.d&#x2F;apache2 restart</strong></p></blockquote><h4 id="è®¿é—®owncloudå¹¶é…ç½®"><a href="#è®¿é—®owncloudå¹¶é…ç½®" class="headerlink" title="è®¿é—®owncloudå¹¶é…ç½®"></a>è®¿é—®owncloudå¹¶é…ç½®</h4><p>åœ¨æµè§ˆå™¨ä¸Šè¾“å…¥æ ‘è“æ´¾çš„IPåœ°å€</p><p><img src="/image/raspberry_pi/owncloud_page_config.png" alt="owncloud index"></p><p>ç‚¹å‡»é…ç½®å®Œæˆåï¼Œç­‰å¾…çš„æ—¶é—´å¯èƒ½ä¼šç¨å¾®é•¿ä¸€ç‚¹ï¼Œå¯ä»¥å¦å¼€ä¸€ä¸ªtabè®¿é—®ä¸€ä¸‹è¯•è¯•ã€‚</p><h4 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><ol><li><p>å¦‚æœé€‰æ‹©çš„å­˜æ”¾æ•°æ®çš„åœ°æ–¹ï¼Œæ˜¯æŒ‚è½½åˆ°linuxçš„nftsæ ¼å¼çš„ç¡¬ç›˜ï¼Œä¼šå‡ºç°æ— æ³•ä¿®æ”¹å…¶æƒé™çš„é—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆå¯ä»¥æœä¸€ä¸‹<code>linuxæ— æ³•ä¿®æ”¹ntfsæƒé™</code>ï¼Œç½‘ä¸Šè§£å†³æ–¹æ¡ˆå¤§éƒ¨åˆ†æ˜¯ä¿®æ”¹ &#x2F;etc&#x2F;fstabæ¥å®ç°æŒ‚è½½æ—¶æŒ‡å®šæƒé™ã€‚æˆ‘æ˜¯æŠŠntfsæ ¼å¼ä¿®æ”¹æˆext4å°±å¥½äº†ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p></li><li><p>owncloud8ä¹‹åï¼Œç›´æ¥å°†æ–‡ä»¶æ”¾åœ¨ç”¨æˆ·çš„å…±äº«æ–‡ä»¶å¤¹ä¸‹ï¼Œä¼šå‘ç°åœ¨ç½‘é¡µä¸Šå¹¶ä¸èƒ½çœ‹åˆ°è¯¥æ–‡ä»¶ã€‚</p><p>ç¬¬ä¸€ç§æ˜¯æ‰§è¡ŒOwncloudçš„CLIå‘½ä»¤ã€‚å…·ä½“ä½ç½®æ˜¯åœ¨Owncloudæ ¹ç›®å½•ï¼Œæœ‰ä¸ªæ–‡ä»¶å«OCCï¼Œå®é™…è°ƒç”¨çš„æ˜¯console.phpï¼Œæ˜¯ä¸ªPHPè„šæœ¬ã€‚é€šè¿‡å‘½ä»¤ PHP OCC fils:scan â€“allå³å¯é‡æ–°æ‰«ææ–‡ä»¶ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶äº†ã€‚ä»£ä»·æ˜¯æ‰€æœ‰æ–‡ä»¶çš„IDä¼šé‡ç½®ï¼Œå¯¼è‡´åŒæ­¥çš„æ¡Œé¢å®¢æˆ·ç«¯ä¼šè®¤ä¸ºéƒ½æ˜¯æ–°æ–‡ä»¶ï¼Œç»§è€Œå…¨éƒ¨é‡æ–°ä¸‹è½½ã€‚</p><p>å­˜æ”¾å…±äº«æ–‡ä»¶æ•°æ®çš„æ•°æ®åº“æ˜¯<code>oc_filecache</code>è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆtruncateæ‰è¿™å¼ è¡¨ï¼Œä¹‹åé‡æ–°ç™»å½•OwnCloudï¼ŒOwncloudç³»ç»Ÿä¼šè‡ªåŠ¨é‡æ–°å¡«å……æ•°æ®ã€‚</p></li></ol><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>æ ‘è“æ´¾</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flutter InheritedWidgetå’ŒNotification</title>
    <link href="/2019/07/08/Flutter-InheritedWidget%E5%92%8CNotification/"/>
    <url>/2019/07/08/Flutter-InheritedWidget%E5%92%8CNotification/</url>
    
    <content type="html"><![CDATA[<p>InheritedWidgetæ˜¯Flutterä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªåŠŸèƒ½å‹Widgetï¼Œå®ƒå¯ä»¥é«˜æ•ˆçš„å°†æ•°æ®åœ¨Widgetæ ‘ä¸­å‘ä¸‹ä¼ é€’(åªèƒ½å‘ä¸‹ä¼ é€’ï¼Œæ— æ³•å‘ä¸Šä¼ é€’ï¼Œå¦‚æœéœ€è¦å‘ä¸Šä¼ é€’å¯ä»¥ä½¿ç”¨Notification)ã€å…±äº«ï¼Œè¿™åœ¨ä¸€äº›éœ€è¦åœ¨Widgetæ ‘ä¸­å…±äº«æ•°æ®çš„åœºæ™¯ä¸­éå¸¸æ–¹ä¾¿ï¼Œå¦‚Flutterä¸­ï¼Œæ­£æ˜¯é€šè¿‡InheritedWidgetæ¥å…±äº«åº”ç”¨ä¸»é¢˜(Theme)å’ŒLocale(å½“å‰è¯­è¨€ç¯å¢ƒ)ä¿¡æ¯çš„ã€‚è¿™é‡Œå»ºè®®é˜…è¯»ä»¥ä¸‹<code>theme.dart</code>çš„æºç </p><span id="more"></span><p>ç°åœ¨æœ‰ä¸€éœ€æ±‚ï¼Œä»Aç•Œé¢æ‰“å¼€Bç•Œé¢ï¼Œåœ¨Bç•Œé¢å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œè¿”å›Aç•Œé¢çš„æ—¶å€™ï¼ŒAç•Œé¢æ˜¾ç¤ºçš„æ•°æ®ä¹Ÿæ˜¯ä¿®æ”¹ä¹‹åçš„ã€‚</p><p>ä¸¤ç§æ–¹å¼ï¼šç¬¬ä¸€ç§æˆ‘ä»¬å¯ä»¥åœ¨Bç•Œé¢ä¿®æ”¹æ•°æ®ä¹‹ååšæŒä¹…åŒ–å­˜å‚¨ï¼Œæˆ–è€…ä¿®æ”¹çš„æ•°æ®åšæˆå…¨å±€é™æ€å­—æ®µï¼Œè¿”å›Aç•Œé¢åç”±Aç•Œé¢åˆ·æ–°</p><p>ç¬¬äºŒç§å°±æ˜¯ä½¿ç”¨InheritedWidgetè¿›è¡Œæ•°æ®å…±äº«å®ç°ã€‚</p><h3 id="InheritedWidget"><a href="#InheritedWidget" class="headerlink" title="InheritedWidget"></a>InheritedWidget</h3><h4 id="åˆ›å»ºæ•°æ®modelå’Œå…±äº«Widget"><a href="#åˆ›å»ºæ•°æ®modelå’Œå…±äº«Widget" class="headerlink" title="åˆ›å»ºæ•°æ®modelå’Œå…±äº«Widget"></a>åˆ›å»ºæ•°æ®modelå’Œå…±äº«Widget</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">InheritedTestModel</span> </span>&#123;<br>  <span class="hljs-built_in">String</span> name;<br>  <span class="hljs-built_in">int</span> age;<br>  <span class="hljs-built_in">String</span> sex;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ç»§æ‰¿InheritedWidgetæ¥å…±äº«æ•°æ®"><a href="#ç»§æ‰¿InheritedWidgetæ¥å…±äº«æ•°æ®" class="headerlink" title="ç»§æ‰¿InheritedWidgetæ¥å…±äº«æ•°æ®"></a>ç»§æ‰¿InheritedWidgetæ¥å…±äº«æ•°æ®</h4><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦ç»§æ‰¿<code>InheritedWidget</code>ï¼Œå¹¶ä¸”å£°æ˜ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œç”¨æ¥ä»BuildContextä¸­è·å–å…±äº«æ•°æ®ã€‚</p><p>è¿˜éœ€è¦é‡å†™updateShouldNotifyæ–¹æ³•ï¼Œå¦‚æœè¿”å›trueï¼Œåˆ™å­æ ‘ä¸­ä¾èµ–(buildå‡½æ•°ä¸­æœ‰è°ƒç”¨)æœ¬widgetçš„å­widgetçš„<code>state.didChangeDependencies</code>ä¼šè¢«è°ƒç”¨ã€‚</p><p>ä¸‹é¢æ˜¯è¯¦ç»†ä»£ç ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">InheritedModelContext</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">InheritedWidget</span> </span>&#123;<br>  <span class="hljs-keyword">final</span> InheritedTestModel model;<br><br>  InheritedModelContext(&#123;Key key, <span class="hljs-meta">@required</span> <span class="hljs-keyword">this</span>.model, <span class="hljs-meta">@required</span> Widget child&#125;)<br>      : <span class="hljs-keyword">super</span>(key: key, child: child);<br><br>  <span class="hljs-keyword">static</span> InheritedModelContext of(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> context.inheritFromWidgetOfExactType(InheritedModelContext);<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-built_in">bool</span> updateShouldNotify(InheritedModelContext oldWidget) &#123;<br>    <span class="hljs-keyword">return</span> model.age != oldWidget.model.age ||<br>        model.name != oldWidget.model.name ||<br>        model.sex != oldWidget.model.sex;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªçº¦å®šä¿—æˆçš„ <code>of</code>æ–¹æ³•ç”¨æ¥è®©å­æ ‘è·å–åˆ°å…±äº«æ•°æ®ã€‚è‡³äºä¸ºä»€ä¹ˆå¯ä»¥è·å–çš„æ•°æ®ï¼Œ</p><blockquote><p>åœ¨ <code>Element</code> çš„å†…éƒ¨æœ‰ä¸€ä¸ª <code>Map&lt;Type, InheritedElement&gt; _inheritedWidgets;</code> å‚æ•°ï¼Œ**_inheritedWidgets ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ç©ºçš„ï¼Œåªæœ‰å½“çˆ¶æ§ä»¶æ˜¯ InheritedWidget æˆ–è€…æœ¬èº«æ˜¯ InheritedWidgets æ—¶ï¼Œå®ƒæ‰ä¼šæœ‰è¢«åˆå§‹åŒ–ï¼Œè€Œå½“çˆ¶æ§ä»¶æ˜¯ InheritedWidget  æ—¶ï¼Œè¿™ä¸ª Map ä¼šè¢«ä¸€çº§ä¸€çº§å¾€ä¸‹ä¼ é€’ä¸åˆå¹¶ã€‚**</p><p>æ‰€ä»¥å½“æˆ‘ä»¬é€šè¿‡ <code>context</code> è°ƒç”¨ <code>inheritFromWidgetOfExactType</code> æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡è¿™ä¸ª <code>Map</code>  å¾€ä¸ŠæŸ¥æ‰¾ï¼Œä»è€Œæ‰¾åˆ°è¿™ä¸ªä¸Šçº§çš„ <code>InheritedWidget</code> ã€‚</p><p>ä½œè€…ï¼šæ‹çŒ«deå°éƒ­é“¾æ¥ï¼š<a href="https://juejin.im/post/5d0634c7f265da1b91639232%E6%9D%A5%E6%BA%90%EF%BC%9A%E6%8E%98%E9%87%91%E8%91%97%E4%BD%9C%E6%9D%83%E5%BD%92%E4%BD%9C%E8%80%85%E6%89%80%E6%9C%89%E3%80%82%E5%95%86%E4%B8%9A%E8%BD%AC%E8%BD%BD%E8%AF%B7%E8%81%94%E7%B3%BB%E4%BD%9C%E8%80%85%E8%8E%B7%E5%BE%97%E6%8E%88%E6%9D%83%EF%BC%8C%E9%9D%9E%E5%95%86%E4%B8%9A%E8%BD%AC%E8%BD%BD%E8%AF%B7%E6%B3%A8%E6%98%8E%E5%87%BA%E5%A4%84%E3%80%82">https://juejin.im/post/5d0634c7f265da1b91639232æ¥æºï¼šæ˜é‡‘è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</a></p></blockquote><h4 id="åœ¨Aç•Œé¢åˆ›å»ºæ•°æ®ï¼Œå¹¶å…±äº«åˆ°ä¸‹ä¸€ä¸ªç•Œé¢"><a href="#åœ¨Aç•Œé¢åˆ›å»ºæ•°æ®ï¼Œå¹¶å…±äº«åˆ°ä¸‹ä¸€ä¸ªç•Œé¢" class="headerlink" title="åœ¨Aç•Œé¢åˆ›å»ºæ•°æ®ï¼Œå¹¶å…±äº«åˆ°ä¸‹ä¸€ä¸ªç•Œé¢"></a>åœ¨Aç•Œé¢åˆ›å»ºæ•°æ®ï¼Œå¹¶å…±äº«åˆ°ä¸‹ä¸€ä¸ªç•Œé¢</h4><p>æˆ‘ä»¬é¦–å…ˆåœ¨ç•Œé¢Aåˆ›å»ºä¸€ä¸ªå…±äº«çš„æ•°æ®modelï¼Œæ˜¾ç¤ºåœ¨ç•Œé¢ä¸Šï¼Œç„¶åé€šè¿‡ä¸Šé¢å®šä¹‰çš„<code>InheritedModelContext</code>å…±äº«ç»™ä¸‹ä¸€ä¸ªç•Œé¢ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">InheritedWidgetTestRouteState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">InheritedWidgetTestRoute</span>&gt; </span>&#123;<br>  InheritedTestModel model;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> initState() &#123;<br>    model = <span class="hljs-keyword">new</span> InheritedTestModel();<br>    model.age = <span class="hljs-number">10</span>;<br>    model.name = <span class="hljs-string">&quot;abc&quot;</span>;<br>    model.sex = <span class="hljs-string">&quot;f&quot;</span>;<br>    <span class="hljs-keyword">super</span>.initState();<br>  &#125;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;InheritedWidget&quot;</span>),<br>      ),<br>      body: Center(<br>        child: Column(<br>          children: &lt;Widget&gt;[<br>            Text(<span class="hljs-string">&quot;age: <span class="hljs-subst">$&#123;model.age&#125;</span>&quot;</span>),<br>            Text(<span class="hljs-string">&quot;name: <span class="hljs-subst">$&#123;model.name&#125;</span>&quot;</span>),<br>            Text(<span class="hljs-string">&quot;sex: <span class="hljs-subst">$&#123;model.sex&#125;</span>&quot;</span>),<br>          ],<br>        ),<br>      ),<br>      floatingActionButton: FloatingActionButton(<br>        onPressed: () &#123;<br>          Navigator.of(context).push(MaterialPageRoute(builder: (context)&#123;<br>          <span class="hljs-keyword">return</span>  InheritedModelContext(<br>            model: model,<br>            child: InheritedSecondPage(),<br>          );<br>          &#125;));<br>        &#125;,<br>        child: Icon(Icons.navigate_next),<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åœ¨Bç•Œé¢è·å–å…±äº«æ•°æ®ï¼Œå¹¶ä½œå‡ºä¿®æ”¹"><a href="#åœ¨Bç•Œé¢è·å–å…±äº«æ•°æ®ï¼Œå¹¶ä½œå‡ºä¿®æ”¹" class="headerlink" title="åœ¨Bç•Œé¢è·å–å…±äº«æ•°æ®ï¼Œå¹¶ä½œå‡ºä¿®æ”¹"></a>åœ¨Bç•Œé¢è·å–å…±äº«æ•°æ®ï¼Œå¹¶ä½œå‡ºä¿®æ”¹</h4><p>æˆ‘ä»¬åœ¨Bç•Œé¢è·å–åˆ°å…±äº«æ•°æ®å¹¶å±•ç¤ºå‡ºæ¥ï¼Œé€šè¿‡ç‚¹å‡»æŒ‰é’®ï¼Œæ”¹å˜å…±äº«æ•°æ®çš„å€¼ï¼Œå½“æˆ‘ä»¬è¿”å›ä¸Šä¸€ä¸ªç•Œé¢çš„æ—¶å€™ä¼šå‘ç°ä¸Šä¸ªç•Œé¢çš„æ˜¾ç¤ºä¹Ÿè¢«æ”¹å˜äº†</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs dart"><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">InheritedSecondPageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">InheritedSecondPage</span>&gt; </span>&#123;<br>  InheritedModelContext modelContext;<br>  InheritedTestModel model;<br><br>  <span class="hljs-built_in">String</span> name = <span class="hljs-string">&quot;&quot;</span>;<br>  <span class="hljs-built_in">int</span> age = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">String</span> sex = <span class="hljs-string">&quot;&quot;</span>;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> initState() &#123;<br>    <span class="hljs-keyword">super</span>.initState();<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    modelContext = InheritedModelContext.of(context);<br>    model = modelContext.model;<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;ç¬¬äºŒé¡µ&quot;</span>),<br>      ),<br>      body: Center(<br>        child: Column(<br>          children: &lt;Widget&gt;[<br>            Text(<span class="hljs-string">&quot;age: <span class="hljs-subst">$&#123;model.age&#125;</span>&quot;</span>),<br>            Text(<span class="hljs-string">&quot;name: <span class="hljs-subst">$&#123;model.name&#125;</span>&quot;</span>),<br>            Text(<span class="hljs-string">&quot;sex: <span class="hljs-subst">$&#123;model.sex&#125;</span>&quot;</span>),<br>            Column(<br>              children: &lt;Widget&gt;[<br>                FlatButton(<br>                  onPressed: () &#123;<br>                    setState(() &#123;<br>                      model.name = <span class="hljs-built_in">DateTime</span>.now().toLocal().toString();<br>                    &#125;);<br>                  &#125;,<br>                  child: Text(<span class="hljs-string">&quot;æ”¹å˜Name&quot;</span>),<br>                ),<br>                FlatButton(<br>                  onPressed: () &#123;<br>                    setState(() &#123;<br>                      model.age = <span class="hljs-built_in">DateTime</span>.now().millisecondsSinceEpoch;<br>                    &#125;);<br>                  &#125;,<br>                  child: Text(<span class="hljs-string">&quot;æ”¹å˜Age&quot;</span>),<br>                ),<br>                FlatButton(<br>                  onPressed: () &#123;<br>                    setState(() &#123;<br>                      model.sex = <span class="hljs-built_in">DateTime</span>.now().toString();<br>                    &#125;);<br>                  &#125;,<br>                  child: Text(<span class="hljs-string">&quot;æ”¹å˜sex&quot;</span>),<br>                ),<br>              ],<br>            ),<br>          ],<br>        ),<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Notification"><a href="#Notification" class="headerlink" title="Notification"></a>Notification</h3><blockquote><p>Notificationæ˜¯Flutterä¸­ä¸€ä¸ªé‡è¦çš„æœºåˆ¶ï¼Œåœ¨Widgetæ ‘ä¸­ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥åˆ†å‘é€šçŸ¥ï¼Œé€šçŸ¥ä¼šæ²¿ç€å½“å‰èŠ‚ç‚¹ï¼ˆcontextï¼‰å‘ä¸Šä¼ é€’ï¼Œæ‰€æœ‰çˆ¶èŠ‚ç‚¹éƒ½å¯ä»¥é€šè¿‡NotificationListeneræ¥ç›‘å¬é€šçŸ¥ï¼ŒFlutterä¸­ç§°è¿™ç§é€šçŸ¥ç”±å­å‘çˆ¶çš„ä¼ é€’ä¸ºâ€œé€šçŸ¥å†’æ³¡â€ï¼ˆNotification Bubblingï¼‰ï¼Œè¿™ä¸ªå’Œç”¨æˆ·è§¦æ‘¸äº‹ä»¶å†’æ³¡æ˜¯ç›¸ä¼¼çš„ï¼Œä½†æœ‰ä¸€ç‚¹ä¸åŒï¼šé€šçŸ¥å†’æ³¡å¯ä»¥ä¸­æ­¢ï¼Œä½†ç”¨æˆ·è§¦æ‘¸äº‹ä»¶ä¸è¡Œã€‚</p><p>æºè‡ª  ï¼š<a href="https://book.flutterchina.club/chapter8/notification.html">https://book.flutterchina.club/chapter8/notification.html</a></p></blockquote><h4 id="åˆ›å»ºModelã€InheritedWidgetå’Œä¸Šé¢ä¸€è‡´"><a href="#åˆ›å»ºModelã€InheritedWidgetå’Œä¸Šé¢ä¸€è‡´" class="headerlink" title="åˆ›å»ºModelã€InheritedWidgetå’Œä¸Šé¢ä¸€è‡´"></a>åˆ›å»ºModelã€InheritedWidgetå’Œä¸Šé¢ä¸€è‡´</h4><h4 id="å®šä¹‰Notification"><a href="#å®šä¹‰Notification" class="headerlink" title="å®šä¹‰Notification"></a>å®šä¹‰Notification</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyNotification</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Notification</span></span>&#123;<br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> msg;<br>  MyNotification(<span class="hljs-keyword">this</span>.msg);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="å®šä¹‰ä¸¤ä¸ªWidgetï¼Œæ”¾åœ¨åŒä¸€ä¸ªç•Œé¢ä¸­"><a href="#å®šä¹‰ä¸¤ä¸ªWidgetï¼Œæ”¾åœ¨åŒä¸€ä¸ªç•Œé¢ä¸­" class="headerlink" title="å®šä¹‰ä¸¤ä¸ªWidgetï¼Œæ”¾åœ¨åŒä¸€ä¸ªç•Œé¢ä¸­"></a>å®šä¹‰ä¸¤ä¸ªWidgetï¼Œæ”¾åœ¨åŒä¸€ä¸ªç•Œé¢ä¸­</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WidgetA</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  State&lt;StatefulWidget&gt; createState() &#123;<br>    <span class="hljs-keyword">return</span> WidgetAState();<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WidgetAState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">WidgetA</span>&gt; </span>&#123;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> initState() &#123;<br>    <span class="hljs-keyword">super</span>.initState();<br><br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">final</span> InheritedContext inheritedContext = InheritedContext.of(context);<br>    <span class="hljs-keyword">final</span> SinglePageModel model = inheritedContext.model;<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;WidgetA build&quot;</span>);<br>    <span class="hljs-keyword">return</span> Center(<br>      child: Column(<br>        children: &lt;Widget&gt;[<br>          Text(<span class="hljs-string">&quot;å½“å‰é¡µ<span class="hljs-subst">$&#123;model.page&#125;</span>&quot;</span>),<br>          Text(<span class="hljs-string">&quot;å†…å®¹ï¼š<span class="hljs-subst">$&#123;model.content&#125;</span>&quot;</span>),<br>          FlatButton(<br>            onPressed: () &#123;<br>              <span class="hljs-keyword">if</span>(model.page==<span class="hljs-keyword">null</span>)&#123;<br>                model.page = <span class="hljs-number">1</span>;<br>              &#125;<span class="hljs-keyword">else</span> &#123;<br>                model.page += <span class="hljs-number">1</span>;<br>              &#125;<br>              MyNotification(<span class="hljs-string">&quot;refresh&quot;</span>).dispatch(context);<br>              setState(() &#123;<br><br>              &#125;);<br><br><br>            &#125;,<br>            child: Icon(Icons.add),<br>          ),<br>          FlatButton(<br>            onPressed: () &#123;<br>              model.content = <span class="hljs-built_in">DateTime</span>.now().toLocal().toString();<br>              <span class="hljs-comment">//å‘é€é€šçŸ¥</span><br>              MyNotification(<span class="hljs-string">&quot;refresh&quot;</span>).dispatch(context);<br>              setState(() &#123;<br><br>              &#125;);<br>            &#125;,<br>            child: Text(<span class="hljs-string">&quot;æ”¹å˜content&quot;</span>),<br>          ),<br>        ],<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åˆ›å»ºç•Œé¢å¹¶ä¸”ç›‘å¬è‡ªå®šä¹‰çš„é€šçŸ¥"><a href="#åˆ›å»ºç•Œé¢å¹¶ä¸”ç›‘å¬è‡ªå®šä¹‰çš„é€šçŸ¥" class="headerlink" title="åˆ›å»ºç•Œé¢å¹¶ä¸”ç›‘å¬è‡ªå®šä¹‰çš„é€šçŸ¥"></a>åˆ›å»ºç•Œé¢å¹¶ä¸”ç›‘å¬è‡ªå®šä¹‰çš„é€šçŸ¥</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">InheritedWidgetInSinglePage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  State&lt;StatefulWidget&gt; createState() &#123;<br>    <span class="hljs-keyword">return</span> InheritedWidgetInSinglePageState();<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">InheritedWidgetInSinglePageState</span></span><br><span class="hljs-class">    <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">InheritedWidgetInSinglePage</span>&gt; </span>&#123;<br>  SinglePageModel model = SinglePageModel();<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;åŒä¸€é¡µé¢å…±äº«æ•°æ®&quot;</span>),<br>      ),<br>      body: NotificationListener&lt;MyNotification&gt;(<br>      <span class="hljs-comment">//ç›‘å¬é€šçŸ¥</span><br>        onNotification: (notification) &#123;<br>          setState(() &#123;&#125;);<br>        &#125;,<br>        child: InheritedContext(<br>          model: model,<br>          child: Column(<br>            children: &lt;Widget&gt;[<br>              Text(<span class="hljs-string">&quot;page:<span class="hljs-subst">$&#123;model.page&#125;</span>&quot;</span>),<br>              Text(<span class="hljs-string">&quot;content:<span class="hljs-subst">$&#123;model.content&#125;</span>&quot;</span>),<br>              FlatButton(<br>                onPressed: () &#123;<br>                  <span class="hljs-keyword">if</span> (model.page == <span class="hljs-keyword">null</span>) &#123;<br>                    model.page = <span class="hljs-number">1</span>;<br>                  &#125; <span class="hljs-keyword">else</span> &#123;<br>                    model.page += <span class="hljs-number">1</span>;<br>                  &#125;<br>                  setState(() &#123;&#125;);<br>                &#125;,<br>                child: Icon(Icons.add),<br>              ),<br>              WidgetA(),<br>              WidgetB(),<br>            ],<br>          ),<br>        ),<br>      ),<br>      floatingActionButton: FloatingActionButton(<br>        onPressed: () &#123;<br>          Navigator.of(context).push(MaterialPageRoute(builder: (context) &#123;<br>            <span class="hljs-keyword">return</span> InheritedContext(<br>              model: model,<br>              child: SecondPageWidget(),<br>            );<br>          &#125;));<br>        &#125;,<br>        child: Icon(Icons.navigate_next),<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>SecondPageWidget</code>å’Œä¸Šé¢æåˆ°çš„Bç•Œé¢å·®ä¸å¤šï¼Œéƒ½æ˜¯è·å–åˆ°å…±äº«æ•°æ®åå±•ç¤ºï¼Œç‚¹å‡»æŒ‰é’®åšå‡ºæ”¹å˜ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flutterä¸­çš„provider</title>
    <link href="/2019/07/01/Flutter%E4%B8%AD%E7%9A%84provider/"/>
    <url>/2019/07/01/Flutter%E4%B8%AD%E7%9A%84provider/</url>
    
    <content type="html"><![CDATA[<p>ä½œä¸ºä¸€ä¸ªçŠ¶æ€å…±äº«çš„è§£å†³æ–¹æ¡ˆï¼Œ<strong>ä¸å¤æ‚ï¼Œå¥½ç†è§£ï¼Œä»£ç é‡ä¸å¤§çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æ–¹ä¾¿ç»„åˆå’Œæ§åˆ¶åˆ·æ–°é¢—ç²’åº¦</strong> ï¼Œ è€ŒåŸ Google å®˜æ–¹ä»“åº“çš„çŠ¶æ€ç®¡ç† <a href="https://link.juejin.im/?target=https://github.com/google/flutter-provide">flutter-provide</a> å·²å®£å‘ŠGG ï¼Œ <a href="https://link.juejin.im/?target=https://github.com/rrousselGit/provider">provider</a> æˆäº†å®ƒçš„æ›¿ä»£å“ã€‚å’Œ<code>scoped_moded</code>æ¯”èµ·æ¥ï¼Œå…¥ä¾µæ€§æ¯”è¾ƒå°ï¼Œä¹Ÿé€‚åˆæ¯”è¾ƒå¤æ‚çš„åº”ç”¨åœºæ™¯ã€‚</p><p>å…·ä½“çš„ä»£ç åœ¨ <a href="https://github.com/huangyuanlove/test_flutter/tree/master/lib/provider">https://github.com/huangyuanlove/test_flutter/tree/master/lib/provider</a> </p><span id="more"></span><h4 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h4><p>åœ¨pubspec.yamlä¸­æ·»åŠ provideré•œåƒï¼šå…·ä½“ç‰ˆæœ¬å·å¯ä»¥åœ¨<code>https://pub.dev/packages/provider#-installing-tab-</code>æŸ¥çœ‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-attr">flutter:</span><br>    <span class="hljs-attr">sdk:</span> <span class="hljs-string">flutter</span><br><br>  <span class="hljs-comment"># The following adds the Cupertino Icons font to your application.</span><br>  <span class="hljs-comment"># Use with the CupertinoIcons class for iOS style icons.</span><br>  <span class="hljs-attr">cupertino_icons:</span> <span class="hljs-string">^0.1.2</span><br>  <span class="hljs-attr">provider:</span> <span class="hljs-string">^3.0.0+1</span><br><span class="hljs-attr">dev_dependencies:</span><br>  <span class="hljs-attr">flutter_test:</span><br>    <span class="hljs-attr">sdk:</span> <span class="hljs-string">flutter</span><br></code></pre></td></tr></table></figure><h4 id="åˆ›å»ºæ•°æ®model"><a href="#åˆ›å»ºæ•°æ®model" class="headerlink" title="åˆ›å»ºæ•°æ®model"></a>åˆ›å»ºæ•°æ®model</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CounterModel</span> <span class="hljs-title">with</span> <span class="hljs-title">ChangeNotifier</span></span>&#123;<br>  <span class="hljs-built_in">int</span> _count = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-built_in">int</span> <span class="hljs-keyword">get</span> value =&gt; _count;<br><br>  <span class="hljs-keyword">void</span> increment()&#123;<br>    _count ++;<br>    notifyListeners();<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨äº† mixin æ··å…¥äº† <code>ChangeNotifier</code>ï¼Œè¿™ä¸ªç±»èƒ½å¤Ÿå¸®é©»æˆ‘ä»¬è‡ªåŠ¨ç®¡ç†æ‰€æœ‰å¬ä¼—ã€‚å½“è°ƒç”¨<code>notifyListeners()</code> æ—¶ï¼Œå®ƒä¼šé€šçŸ¥æ‰€æœ‰å¬ä¼—è¿›è¡Œåˆ·æ–°ã€‚</p><p>ä¸ºäº†èƒ½æ›´åŠ ç›´è§‚çš„çœ‹åˆ°æ¯ä¸ªwidgetçš„buildè¿‡ç¨‹ï¼Œåšä¸ªåŒ…è£…çš„widgetï¼Œä¸æ˜¯ä¾é <code>debugPrintLayouts = true;</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestTextWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span></span>&#123;<br><br>  TestTextWidget(&#123;<span class="hljs-meta">@required</span> <span class="hljs-keyword">this</span>.logTag,<span class="hljs-meta">@required</span> <span class="hljs-keyword">this</span>.child&#125;);<br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> logTag;<br>  <span class="hljs-keyword">final</span> Widget child;<br><br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-built_in">print</span>(logTag);<br>    <span class="hljs-keyword">return</span> child;<br>  &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨æ¯æ¬¡buildçš„æ—¶å€™æ‰“å°ä¸€ä¸‹æ—¥å¿—,å¹¶ä¸”åœ¨æºç çš„<code>text.dart</code>ä¸­çš„buildæ–¹æ³•æ‰“å°äº†ä¸€ä¸‹å†…å®¹<code>print(&quot;Text build:$&#123;data&#125;&quot;);</code></p><h4 id="å¦‚ä½•ä¼ é€’ã€å…±äº«æ•°æ®"><a href="#å¦‚ä½•ä¼ é€’ã€å…±äº«æ•°æ®" class="headerlink" title="å¦‚ä½•ä¼ é€’ã€å…±äº«æ•°æ®"></a>å¦‚ä½•ä¼ é€’ã€å…±äº«æ•°æ®</h4><h5 id="å‘å­èŠ‚ç‚¹ä¼ é€’æ•°æ®"><a href="#å‘å­èŠ‚ç‚¹ä¼ é€’æ•°æ®" class="headerlink" title="å‘å­èŠ‚ç‚¹ä¼ é€’æ•°æ®"></a>å‘å­èŠ‚ç‚¹ä¼ é€’æ•°æ®</h5><p>æˆ‘ä»¬åœ¨ä¸»é¡µä¸­åŠ ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»åè¿›å…¥è®¡æ•°ç•Œé¢</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:provider/provider.dart&#x27;</span>;<br>FlatButton(<br>              child: Text(<span class="hljs-string">&quot;TestProvider&quot;</span>),<br>              onPressed: () &#123;<br>                <span class="hljs-keyword">final</span> counter = CounterModel();<br>                <span class="hljs-keyword">final</span> textSize = <span class="hljs-number">48</span>;<br>                Navigator.push(context, MaterialPageRoute(builder: (context) &#123;<br>                  <span class="hljs-keyword">return</span> Provider&lt;<span class="hljs-built_in">int</span>&gt;.value(<br>                    value: textSize,<br>                    child: ChangeNotifierProvider.value(<br>                      value: counter,<br>                      child: CounterFirstScreen(),<br>                    ),<br>                  );<br>                &#125;)).then((onValue) &#123;<br>                  <span class="hljs-built_in">print</span>(onValue);<br>                &#125;);<br>              &#125;,<br>            ),<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬å‘å­èŠ‚ç‚¹ä¼ é€’äº†ä¸¤ä¸ªå€¼ï¼š<code>textSize</code>å’Œ<code>counter</code>ï¼Œå¯¹äºéœ€æ±‚æ¥è®²ï¼Œ<code>textSize</code>æ˜¯å›ºå®šä¸å˜çš„ï¼Œå¯ä»¥é€šè¿‡<code>Provider&lt;T&gt;.value</code>æ¥ä¼ å…¥ï¼Œè€Œ<code>counter</code>æ˜¯æˆ‘ä»¬éœ€è¦å¤šä¸ªç•Œé¢å…±äº«çš„æ•°æ®(æŸä¸ªç•Œé¢æ”¹å˜å…¶ä¸­çš„å­—æ®µï¼Œå…¶ä»–ç•Œé¢ä¹Ÿéœ€è¦è·Ÿç€æ”¹å˜)ã€‚ä½¿ç”¨<code>ChangeNotifierProvider&lt;T&gt;.value</code>æ¥ä¼ å…¥å’Œå…±äº«ï¼Œ</p><ul><li>1ã€ <strong>Provider</strong>  çš„å†…éƒ¨ <code>DelegateWidget</code> æ˜¯ä¸€ä¸ª <code>StatefulWidget</code> ï¼Œæ‰€ä»¥å¯ä»¥æ›´æ–°ä¸”å…·æœ‰ç”Ÿå‘½å‘¨æœŸã€‚</li><li>2ã€çŠ¶æ€å…±äº«æ˜¯ä½¿ç”¨äº† <code>InheritedProvider</code> è¿™ä¸ª <code>InheritedWidget</code> å®ç°çš„ã€‚</li><li>3ã€å·§å¦™åˆ©ç”¨ <code>MultiProvider</code> å’Œ <code>Consumer</code> å°è£…ï¼Œå®ç°äº†ç»„åˆä¸åˆ·æ–°é¢—ç²’åº¦æ§åˆ¶ã€‚</li></ul><p>å…·ä½“å¯ä»¥çœ‹ <a href="https://juejin.im/post/5d0634c7f265da1b91639232">https://juejin.im/post/5d0634c7f265da1b91639232</a></p><p>å’Œ <a href="https://juejin.im/post/5d00a84fe51d455a2f22023f">https://juejin.im/post/5d00a84fe51d455a2f22023f</a></p><h4 id="åœ¨å­èŠ‚ç‚¹ä¸­è·å–æ•°æ®"><a href="#åœ¨å­èŠ‚ç‚¹ä¸­è·å–æ•°æ®" class="headerlink" title="åœ¨å­èŠ‚ç‚¹ä¸­è·å–æ•°æ®"></a>åœ¨å­èŠ‚ç‚¹ä¸­è·å–æ•°æ®</h4><p>æˆ‘ä»¬åœ¨<code>CounterFirstScreen</code>çš„buildæ–¹æ³•ä¸­è·å–ä¸Šä¸ªç•Œé¢ä¼ è¿›æ¥çš„å€¼ï¼Œå¹¶ä¸”åœ¨ç•Œé¢ä¸Šä»¥ä¸åŒçš„æ–¹å¼æ˜¾ç¤ºå‡ºæ¥</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CounterFirstScreen</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">final</span> _counter = Provider.of&lt;CounterModel&gt;(context);<br>    <span class="hljs-keyword">final</span> _textSize = Provider.of&lt;<span class="hljs-built_in">int</span>&gt;((context)).toDouble();<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;first screen rebuild&#x27;</span>);<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&#x27;FirstPage&#x27;</span>),<br>      ),<br>      body: Center(<br>        child: Column(<br>          mainAxisSize: MainAxisSize.max,<br>          children: &lt;Widget&gt;[<br>            TestTextWidget(<br>              logTag: <span class="hljs-string">&quot;first page text counter&quot;</span>,<br><br>              child: Text(<br>                <span class="hljs-string">&#x27;Value: <span class="hljs-subst">$&#123;_counter.value&#125;</span>&#x27;</span>,<br>                style: TextStyle(fontSize: _textSize),<br>              ),<br>            ),<br>            TestTextWidget(<br>              logTag: <span class="hljs-string">&quot;first page text fix&quot;</span>,<br><br>              child: Text(<br>                <span class="hljs-string">&quot;å›ºå®šæ–‡æœ¬ï¼Œä¸éœ€è¦é‡ç»˜&quot;</span><br>              ),<br>            ),<br>          ],<br>        ),<br>      ),<br>      floatingActionButton: FloatingActionButton(<br>        onPressed: () =&gt; &#123;<br>              Navigator.of(context).push(MaterialPageRoute(builder: (context) &#123;<br><span class="hljs-comment">//                return Provider&lt;int&gt;.value(</span><br><span class="hljs-comment">//                  value: _textSize.toInt(),</span><br><span class="hljs-comment">//                  child: ChangeNotifierProvider.value(</span><br><span class="hljs-comment">//                    value: _counter,</span><br><span class="hljs-comment">//                    child: Provider&lt;Color&gt;.value(</span><br><span class="hljs-comment">//                      value: Colors.red.shade50,</span><br><span class="hljs-comment">//                      child: SecondPage(),</span><br><span class="hljs-comment">//                    ),</span><br><span class="hljs-comment">//                  ),</span><br><span class="hljs-comment">//                );</span><br>              <span class="hljs-keyword">return</span> MultiProvider(<br>                providers: [<br>                  Provider&lt;<span class="hljs-built_in">int</span>&gt;.value(value: _textSize.toInt()),<br>                  ChangeNotifierProvider.value(value: _counter),<br>                  Provider.value(value: Colors.red.shade50),<br><br>                ],<br>                child: SecondPage(),<br>              );<br>              &#125;))<br>            &#125;,<br><br>        child: Icon(Icons.navigate_next),<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨buildä¸­æˆ‘ä»¬é€šè¿‡<code>Provider.of&lt;T&gt;(context);</code>æ¥è·å–é¡¶å±‚æ•°æ®ï¼Œè¿™é‡Œæ³›å‹TæŒ‡å®šäº†è·å–è·ç¦»è¯¥ç•Œé¢æœ€è¿‘çš„å­˜å‚¨äº†Tçš„ç¥–å…ˆèŠ‚ç‚¹çš„æ•°æ®ã€‚è¿™é‡Œå¼ºçƒˆå»ºè®®åœ¨ä¼ å…¥å’Œè·å–å€¼æ—¶åŠ ä¸Šæ³›å‹ï¼Œç»æµ‹è¯•ï¼Œä¼ å…¥ç›¸åŒç±»å‹çš„å€¼ï¼Œåé¢çš„å›è¦†ç›–å‰é¢çš„ã€‚</p><p>å½“æˆ‘ä»¬ç‚¹å‡»floatingActionButtonçš„æ—¶å€™è¿›å…¥ç¬¬äºŒä¸ªç•Œé¢ï¼Œè¿™é‡Œä¼ å…¥çš„æ•°æ®æ¯”è¾ƒå¤šï¼Œå¯ä»¥é€šè¿‡MultiProvideræˆ–è€…åµŒå¥—Provideræ¥åšï¼Œåœ¨æˆ–è€…ï¼ŒæŠŠè¦ä¼ å…¥çš„å€¼å°è£…æˆä¸€ä¸ªmodelæ¥ä¼ å…¥ã€‚åœ¨æˆ‘ä»¬çš„ä¸šåŠ¡ä¸Šæ¥çœ‹ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆå›ºå®šå€¼éœ€è¦ä»¥Providerçš„æ–¹å¼æ¥ä¼ é€’ï¼Œå¯ä»¥é€šè¿‡æ„é€ æ–¹æ³•ã€‚</p><h5 id="Consumer"><a href="#Consumer" class="headerlink" title="Consumer"></a>Consumer</h5><p>æˆ‘ä»¬åœ¨ç¬¬äºŒä¸ªç•Œé¢ä¸­ä½¿ç”¨Consumeræ¥è·å–å…±äº«æ•°æ®ï¼Œæ¥è¾¾åˆ°æ§åˆ¶å±€éƒ¨åˆ·æ–°çš„ç›®çš„ã€‚</p><p>æˆ‘ä»¬éœ€è¦åœ¨ç¬¬äºŒä¸ªç•Œé¢ä¸­ä½¿ç”¨ä¸Šä¸€ä¸ªç•Œé¢ä¸­ä¼ è¿‡æ¥çš„å­—ä½“å¤§å°ã€æ–‡å­—å†…å®¹ã€æ–‡å­—é¢œè‰²ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dart">Consumer&lt;<span class="hljs-built_in">int</span>&gt;(<br>              builder: (context, <span class="hljs-built_in">int</span> textSize, _) &#123;<br>                <span class="hljs-keyword">return</span> TestTextWidget(<br>                  logTag: <span class="hljs-string">&quot;secondPage.Consumer&lt;int&gt;&quot;</span>,<br>                  child: Text(<br>                    <span class="hljs-string">&quot;textSize <span class="hljs-subst">$&#123;textSize + <span class="hljs-number">5</span>&#125;</span>&quot;</span>,<br>                    style: TextStyle(fontSize: (textSize + <span class="hljs-number">5</span>).toDouble()),<br>                  ),<br>                );<br>              &#125;,<br>            ),<br></code></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dart">Consumer3&lt;CounterModel, <span class="hljs-built_in">int</span>, Color&gt;(<br>              builder: (context, CounterModel counter, <span class="hljs-built_in">int</span> textSize,<br>                  Color color, _) &#123;<br>                <span class="hljs-keyword">return</span> TestTextWidget(<br>                  logTag: <span class="hljs-string">&quot;SecondPage Consumer3&lt;CounterModel, int, Color&gt;&quot;</span>,<br>                  child: Text(<br>                    <span class="hljs-string">&#x27;Value:<span class="hljs-subst">$&#123;counter.value&#125;</span>&#x27;</span>,<br>                    style:<br>                        TextStyle(fontSize: textSize.toDouble(), color: color),<br>                  ),<br>                );<br>              &#125;,<br>            ),<br></code></pre></td></tr></table></figure><p>Consumer ä½¿ç”¨äº† <a href="https://link.juejin.im/?target=https://en.wikipedia.org/wiki/Builder_pattern"><strong>Builder</strong></a> æ¨¡å¼ï¼Œæ”¶åˆ°æ›´æ–°é€šçŸ¥å°±ä¼šé€šè¿‡ builder é‡æ–°æ„å»ºã€‚<code>Consumer&lt;T&gt;</code> ä»£è¡¨äº†å®ƒè¦è·å–ç¥–å…ˆä¸­çš„å“ªç§Modelã€‚</p><p>ä»æºç ä¸­å¯ä»¥çœ‹å‡ºï¼Œä½œè€…å¸®æˆ‘ä»¬åšåˆ°äº† Consumer6ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚å¹¶ä¸”è¿˜èƒ½çœ‹å‡ºæ¥ï¼ŒConsumerä¸­å°±æ˜¯ä½¿ç”¨Providerå®ç°çš„ï¼Œå®ƒçš„ç»å…¸ä¹‹å¤„åœ¨äºèƒ½å¤Ÿåœ¨å¤æ‚é¡¹ç›®ä¸­ï¼Œ<strong>æå¤§åœ°ç¼©å°ä½ çš„æ§ä»¶åˆ·æ–°èŒƒå›´</strong>ã€‚<code>Provider.of&lt;T&gt;(context)</code> å°†ä¼šæŠŠè°ƒç”¨äº†è¯¥æ–¹æ³•çš„ context ä½œä¸ºå¬ä¼—ï¼Œå¹¶åœ¨ <code>notifyListeners</code> çš„æ—¶å€™é€šçŸ¥å…¶åˆ·æ–°ã€‚</p><p>æˆ‘ä»¬ä¸Šé¢ä¹Ÿæåˆ°äº†åœ¨Textçš„buildæ–¹æ³•ä¸­åŠ äº†æ—¥å¿—ï¼Œå½“æˆ‘ä»¬è¿›å…¥ç¬¬ä¸€é¡µçš„æ—¶å€™ï¼Œæ§åˆ¶å°è¾“å‡ºï¼š</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs verilog">I/flutter (<span class="hljs-number">26320</span>): first screen rebuild                                 <br>I/flutter (<span class="hljs-number">26320</span>): tag:ç¬¬ä¸€ä¸ªç•Œé¢ä¸­æ˜¾ç¤ºè®¡æ•°çš„TestTextWidget             <br>I/flutter (<span class="hljs-number">26320</span>): Text build:Value: <span class="hljs-number">0</span>                                  <br>I/flutter (<span class="hljs-number">26320</span>): tag:ç¬¬ä¸€ä¸ªç•Œé¢ä¸­å›ºå®šçš„æ–‡æœ¬                           <br>I/flutter (<span class="hljs-number">26320</span>): Text build:å›ºå®šæ–‡æœ¬ï¼Œä¸éœ€è¦é‡ç»˜                      <br>I/flutter (<span class="hljs-number">26320</span>): Text build:FirstPage  <br></code></pre></td></tr></table></figure><p>è¿›å…¥ç¬¬äºŒä¸ªç•Œé¢çš„æ—¶å€™ï¼š</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs verilog">I/flutter (<span class="hljs-number">26320</span>): second screen rebuild<br>I/flutter (<span class="hljs-number">26320</span>): SecondPage Consumer3&lt;CounterModel, <span class="hljs-keyword">int</span>, Color&gt;<br>I/flutter (<span class="hljs-number">26320</span>): Text build:Value:<span class="hljs-number">0</span><br>I/flutter (<span class="hljs-number">26320</span>): secondPage<span class="hljs-variable">.Consumer</span>&lt;<span class="hljs-keyword">int</span>&gt;<br>I/flutter (<span class="hljs-number">26320</span>): Text build:textSize <span class="hljs-number">53</span><br>I/flutter (<span class="hljs-number">26320</span>): tag:ç¬¬äºŒä¸ªç•Œé¢ä¸­å›ºå®šä¸å˜çš„TestTextWidget<br>I/flutter (<span class="hljs-number">26320</span>): Text build:ç¬¬äºŒä¸ªç•Œé¢çš„å›ºå®šæ–‡æœ¬ TestTextWidget<span class="hljs-variable">.child</span><br>I/flutter (<span class="hljs-number">26320</span>): Text build:SecondPage fix text<br>I/flutter (<span class="hljs-number">26320</span>): Text build:Second Page<br>I/flutter (<span class="hljs-number">26320</span>): first screen rebuild<br>I/flutter (<span class="hljs-number">26320</span>): tag:ç¬¬ä¸€ä¸ªç•Œé¢ä¸­æ˜¾ç¤ºè®¡æ•°çš„TestTextWidget<br>I/flutter (<span class="hljs-number">26320</span>): Text build:Value: <span class="hljs-number">0</span><br>I/flutter (<span class="hljs-number">26320</span>): tag:ç¬¬ä¸€ä¸ªç•Œé¢ä¸­å›ºå®šçš„æ–‡æœ¬<br>I/flutter (<span class="hljs-number">26320</span>): Text build:å›ºå®šæ–‡æœ¬ï¼Œä¸éœ€è¦é‡ç»˜<br>I/flutter (<span class="hljs-number">26320</span>): Text build:FirstPage<br></code></pre></td></tr></table></figure><p>åœ¨ç¬¬äºŒä¸ªç•Œé¢ç‚¹å‡»åŠ å·çš„æ—¶å€™</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><br>I/flutter (<span class="hljs-number">26320</span>): first screen rebuild<br>I/flutter (<span class="hljs-number">26320</span>): tag:ç¬¬ä¸€ä¸ªç•Œé¢ä¸­æ˜¾ç¤ºè®¡æ•°çš„TestTextWidget<br>I/flutter (<span class="hljs-number">26320</span>): Text build:Value: <span class="hljs-number">1</span><br>I/flutter (<span class="hljs-number">26320</span>): tag:ç¬¬ä¸€ä¸ªç•Œé¢ä¸­å›ºå®šçš„æ–‡æœ¬<br>I/flutter (<span class="hljs-number">26320</span>): Text build:å›ºå®šæ–‡æœ¬ï¼Œä¸éœ€è¦é‡ç»˜<br>I/flutter (<span class="hljs-number">26320</span>): Text build:FirstPage<br>I/flutter (<span class="hljs-number">26320</span>): SecondPage Consumer3&lt;CounterModel, <span class="hljs-keyword">int</span>, Color&gt;<br>I/flutter (<span class="hljs-number">26320</span>): Text build:Value:<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>å†æ¬¡ç‚¹å‡»åŠ å·</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs verilog">I/flutter (<span class="hljs-number">26320</span>): first screen rebuild<br>I/flutter (<span class="hljs-number">26320</span>): tag:ç¬¬ä¸€ä¸ªç•Œé¢ä¸­æ˜¾ç¤ºè®¡æ•°çš„TestTextWidget<br>I/flutter (<span class="hljs-number">26320</span>): Text build:Value: <span class="hljs-number">2</span><br>I/flutter (<span class="hljs-number">26320</span>): tag:ç¬¬ä¸€ä¸ªç•Œé¢ä¸­å›ºå®šçš„æ–‡æœ¬<br>I/flutter (<span class="hljs-number">26320</span>): Text build:å›ºå®šæ–‡æœ¬ï¼Œä¸éœ€è¦é‡ç»˜<br>I/flutter (<span class="hljs-number">26320</span>): Text build:FirstPage<br>I/flutter (<span class="hljs-number">26320</span>): SecondPage Consumer3&lt;CounterModel, <span class="hljs-keyword">int</span>, Color&gt;<br>I/flutter (<span class="hljs-number">26320</span>): Text build:Value:<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œç¬¬ä¸€ä¸ªç•Œé¢æ˜¯å…¨éƒ¨é‡å»ºå¯ä¸€æ¬¡ï¼Œè€Œåœ¨ç¬¬äºŒä¸ªç•Œé¢ä¸­ï¼Œåªæœ‰ç›‘å¬äº†CountModelçš„Texté‡å»ºäº†ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>flutterè·¯ç”±ç®€ä»‹</title>
    <link href="/2019/06/27/flutter%E8%B7%AF%E7%94%B1%E7%AE%80%E4%BB%8B/"/>
    <url>/2019/06/27/flutter%E8%B7%AF%E7%94%B1%E7%AE%80%E4%BB%8B/</url>
    
    <content type="html"><![CDATA[<p>ç®¡ç†å¤šä¸ªé¡µé¢æ—¶æœ‰ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µå’Œç±»ï¼š<a href="https://docs.flutter.io/flutter/widgets/Route-class.html">Route</a>å’Œ <a href="https://docs.flutter.io/flutter/widgets/Navigator-class.html">Navigator</a>ã€‚ ä¸€ä¸ªrouteæ˜¯ä¸€ä¸ªå±å¹•æˆ–é¡µé¢çš„æŠ½è±¡ï¼ŒNavigatoræ˜¯ç®¡ç†routeçš„Widgetã€‚Navigatorå¯ä»¥é€šè¿‡routeå…¥æ ˆå’Œå‡ºæ ˆæ¥å®ç°é¡µé¢ä¹‹é—´çš„è·³è½¬ã€‚æ‰€è°“è·¯ç”±ç®¡ç†ï¼Œå°±æ˜¯ç®¡ç†é¡µé¢ä¹‹é—´å¦‚ä½•è·³è½¬ï¼Œé€šå¸¸ä¹Ÿå¯è¢«ç§°ä¸ºå¯¼èˆªç®¡ç†ã€‚è¿™å’ŒåŸç”Ÿå¼€å‘ç±»ä¼¼ï¼Œæ— è®ºæ˜¯Androidè¿˜æ˜¯iOSï¼Œå¯¼èˆªç®¡ç†éƒ½ä¼šç»´æŠ¤ä¸€ä¸ªè·¯ç”±æ ˆï¼Œè·¯ç”±å…¥æ ˆ(push)æ“ä½œå¯¹åº”æ‰“å¼€ä¸€ä¸ªæ–°é¡µé¢ï¼Œè·¯ç”±å‡ºæ ˆ(pop)æ“ä½œå¯¹åº”é¡µé¢å…³é—­æ“ä½œï¼Œè€Œè·¯ç”±ç®¡ç†ä¸»è¦æ˜¯æŒ‡å¦‚ä½•æ¥ç®¡ç†è·¯ç”±æ ˆã€‚</p><span id="more"></span><h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><p>æ¯”å¦‚æˆ‘ä»¬æƒ³è¦ä»Aç•Œé¢æ‰“å¼€Bç•Œé¢ï¼Œå¹¶ä¸”ä»Bç•Œé¢è¿”å›æ—¶éœ€è¦æºå¸¦æ•°æ®ç»™Aç•Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart">Navigator.push(context, MaterialPageRoute(builder: (context) &#123;<br><span class="hljs-keyword">return</span> SaveImageWidget();<br>&#125;)).then((onValue) &#123;<br><span class="hljs-built_in">print</span>(onValue);<br>&#125;);<br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬ä»Bç•Œé¢è¿”å›çš„æ—¶å€™</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart">Navigator.of(context).pop(<span class="hljs-string">&quot;Bç•Œé¢è¿”å›çš„æ•°æ®&quot;</span>);<br></code></pre></td></tr></table></figure><p><code>MaterialPageRoute</code>ç»§æ‰¿è‡ª<code>PageRoute</code>ç±»ï¼Œ<code>PageRoute</code>ç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè¡¨ç¤ºå æœ‰æ•´ä¸ªå±å¹•ç©ºé—´çš„ä¸€ä¸ªæ¨¡æ€è·¯ç”±é¡µé¢ï¼Œå®ƒè¿˜å®šä¹‰äº†è·¯ç”±æ„å»ºåŠåˆ‡æ¢æ—¶è¿‡æ¸¡åŠ¨ç”»çš„ç›¸å…³æ¥å£åŠå±æ€§ã€‚</p><h4 id="Navigator"><a href="#Navigator" class="headerlink" title="Navigator"></a>Navigator</h4><p><code>Navigator</code>æ˜¯ä¸€ä¸ªè·¯ç”±ç®¡ç†çš„widgetï¼Œå®ƒé€šè¿‡ä¸€ä¸ªæ ˆæ¥ç®¡ç†ä¸€ä¸ªè·¯ç”±widgeté›†åˆã€‚é€šå¸¸å½“å‰å±å¹•æ˜¾ç¤ºçš„é¡µé¢å°±æ˜¯æ ˆé¡¶çš„è·¯ç”±ã€‚æ–¹æ³•å¤§è‡´åˆ†ä¸ºä¸¤ç§ï¼špush:æ‰“å¼€æ–°é¡µé¢ï¼ŒåŒ…æ‹¬<code>pushAndRemoveUntil</code>,<code>pushNamed</code>,<code>pushNamedAndRemoveUntil</code>,<code>pushReplacement</code>,<code>pushReplacementNamed</code>,ï¼›popï¼šå¼¹å‡ºå½“å‰ç•Œé¢,åŒ…æ‹¬<code>popAndPushNamed</code>,<code>popUntil</code></p><h5 id="å‘½åè·¯ç”±"><a href="#å‘½åè·¯ç”±" class="headerlink" title="å‘½åè·¯ç”±"></a>å‘½åè·¯ç”±</h5><p>è¿™é‡Œéœ€è¦è¯´ä¸€ä¸‹å‘½åè·¯ç”±ï¼Œä¸Šé¢çš„æ‰“å¼€æ–°ç•Œé¢çš„æ—¶å€™ï¼Œpushæ–¹æ³•ä¸­å‚æ•°æ˜¯MaterialPageRouteï¼Œè¿˜æœ‰ä¸€ç§æ˜¯ç»™å®šè·¯ç”±å­—ç¬¦ä¸²ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ³¨å†Œè·¯ç”±è¡¨ï¼š</p><p>æ‰¾åˆ°flutterå·¥ç¨‹çš„å…¥å£mainæ–¹æ³•ï¼Œæ‰¾åˆ°<code>MaterialApp</code>,æ·»åŠ <code>routers</code>å±æ€§ï¼Œ</p><p><img src="/image/flutter/register_routers.png" alt="æ³¨å†Œè·¯ç”±è¡¨"></p><p>ä»£ç åœ¨è¿™é‡Œ <a href="https://github.com/huangyuanlove/test_flutter/blob/master/lib/main.dart">https://github.com/huangyuanlove/test_flutter/blob/master/lib/main.dart</a></p><p>å…·ä½“é¡µé¢ä»£ç åœ¨è¿™é‡Œ <a href="https://github.com/huangyuanlove/test_flutter/tree/master/lib/test_named_router">https://github.com/huangyuanlove/test_flutter/tree/master/lib/test_named_router</a></p><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart">Navigator.of(context).pushNamed(<span class="hljs-string">&#x27;a_router_widget&#x27;</span>);<br></code></pre></td></tr></table></figure><blockquote><p>è¿™ç§æ–¹æ³•åªæ˜¯ç®€å•çš„å°†æˆ‘ä»¬éœ€è¦è¿›å…¥çš„é¡µé¢pushåˆ°æ ˆé¡¶ï¼Œä»¥æ­¤æ¥æ˜¾ç¤ºå½“å‰é¡µé¢,å…¶å‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹ï¼Œä¼ å…¥çš„æ˜¯é¡µé¢å¯¹åº”çš„è·¯ç”±åç§°</p></blockquote><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart">Navigator.of(context).pushReplacementNamed(<span class="hljs-string">&#x27;d_router_widget&#x27;</span>);<br></code></pre></td></tr></table></figure><blockquote><p>è¿™ç§æ–¹æ³•æ˜¯å°†å½“å‰ç•Œé¢æ›¿æ¢æˆè¦è·³è½¬çš„ç•Œé¢ï¼Œæ¯”å¦‚Aæ‰“å¼€Bï¼ŒBä½¿ç”¨è¿™ç§æ–¹æ³•æ‰“å¼€Cï¼Œå½“ä»Cç•Œé¢è¿”å›çš„æ—¶å€™ï¼Œä¼šç›´æ¥è¿”å›Aã€‚</p></blockquote><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart">Navigator.of(context).popAndPushNamed(<span class="hljs-string">&#x27;d_router_widget&#x27;</span>);<br></code></pre></td></tr></table></figure><blockquote><p>æŒ‡å°†å½“å‰é¡µé¢popï¼Œç„¶åè·³è½¬åˆ°æŒ‡å®šé¡µé¢ï¼ˆå°†å½“å‰è·¯ç”±å¼¹å‡ºå¯¼èˆªå™¨ï¼Œå¹¶å°†å‘½åè·¯ç”±æ¨åˆ°å®ƒçš„ä½ç½®ã€‚ï¼‰</p></blockquote><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart">Navigator.of(context).pushNamedAndRemoveUntil(<span class="hljs-string">&#x27;d_router_widget&#x27;</span>, (Route&lt;<span class="hljs-built_in">dynamic</span>&gt; route) =&gt; <span class="hljs-keyword">false</span>);<br></code></pre></td></tr></table></figure><blockquote><p>æŒ‡å°†æŒ‡å®šçš„é¡µé¢åŠ å…¥åˆ°è·¯ç”±ä¸­ï¼Œç„¶åå°†å…¶ä»–æ‰€æœ‰çš„é¡µé¢å…¨éƒ¨pop, (Route<dynamic> route) &#x3D;&gt;  falseå°†ç¡®ä¿åˆ é™¤æ¨é€è·¯çº¿ä¹‹å‰çš„æ‰€æœ‰è·¯çº¿ã€‚<br>Push the route with the given name onto the navigator, and then remove all<br>the previous routes until the <code>predicate</code> returns true.</p></blockquote><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart">Navigator.of(context).pushNamedAndRemoveUntil(<span class="hljs-string">&#x27;d_router_widget&#x27;</span>, ModalRoute.withName(<span class="hljs-string">&#x27;a_router_widget&#x27;</span>));<br></code></pre></td></tr></table></figure><blockquote><p>Push the route with the given name onto the navigator, and then remove all<br>the previous routes until the <code>predicate</code> returns true.</p></blockquote><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart">Navigator.of(context).maybePop();<br></code></pre></td></tr></table></figure><blockquote><p>maybePop ä¼šè‡ªåŠ¨è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœå½“å‰é¡µé¢popåï¼Œä¼šæ˜¾ç¤ºå…¶ä»–é¡µé¢ï¼Œä¸ä¼šå‡ºç°é—®é¢˜ï¼Œåˆ™å°†æ‰§è¡Œå½“å‰é¡µé¢çš„popæ“ä½œï¼Œå¦åˆ™å°†ä¸æ‰§è¡Œã€‚</p></blockquote><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart">Navigator.of(context).canPop();<br></code></pre></td></tr></table></figure><blockquote><p>åˆ¤æ–­å½“å‰é¡µé¢èƒ½å¦è¿›è¡Œpopæ“ä½œï¼Œå¹¶è¿”å›boolå€¼</p></blockquote><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart">Navigator.of(context).pop();<br></code></pre></td></tr></table></figure><blockquote><p>ç›´æ¥é€€å‡ºå½“å‰é¡µé¢</p></blockquote><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart">Navigator.popUntil(context, ModalRoute.withName(<span class="hljs-string">&#x27;a_router_widget&#x27;</span>));<br></code></pre></td></tr></table></figure><blockquote><p>å¼¹å‡ºç•Œé¢ï¼Œç›´åˆ°é‡åˆ°ç¬¬ä¸€ä¸ªåå­—ä¸ºç»™nameçš„è·¯ç”±ç•Œé¢</p></blockquote><h4 id="å‘½åè·¯ç”±ä¼ å‚"><a href="#å‘½åè·¯ç”±ä¼ å‚" class="headerlink" title="å‘½åè·¯ç”±ä¼ å‚"></a>å‘½åè·¯ç”±ä¼ å‚</h4><p>ç°åœ¨å‘½åè·¯ç”±ä¹Ÿæ”¯æŒ å‚æ•°ä¼ é€’äº†</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dart">FlatButton(onPressed: () &#123;<br>              <span class="hljs-built_in">Map</span> arguments = &#123;<br>              <span class="hljs-string">&quot;shareContent&quot;</span>: <span class="hljs-string">&quot;è¿™æ˜¯åˆ†äº«çš„å†…å®¹&quot;</span>,<br>              <span class="hljs-string">&quot;shareImageUrl&quot;</span>: <span class="hljs-string">&quot;è¿™æ˜¯åˆ†äº«çš„å›¾ç‰‡é“¾æ¥&quot;</span>,<br>              <span class="hljs-string">&quot;shareTitle&quot;</span>: <span class="hljs-string">&quot;è¿™æ˜¯åˆ†äº«çš„æ ‡é¢˜&quot;</span><br>              &#125;;<br>              Navigator.of(context).pushNamed(<span class="hljs-string">&quot;c_router_widget&quot;</span>,arguments: arguments).then((value)&#123;<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¿™æ˜¯Bç•Œé¢æ‰“å¼€ c_router_widget æ¥æ”¶åˆ°çš„Value<span class="hljs-subst">$value</span>&quot;</span>);<br>              &#125;);<br>            &#125;, child: Text(<span class="hljs-string">&quot;å‘½åè·¯ç”±C&quot;</span>))<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨æ³¨å†Œè·¯ç”±çš„æ—¶å€™å¯ä»¥è¿™ä¹ˆå†™</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-string">&quot;c_router_widget&quot;</span>: (BuildContext context) &#123;<br>          <span class="hljs-built_in">Map</span> arguments = ModalRoute.of(context).settings.arguments;<br>          <span class="hljs-keyword">return</span> CRouterWidget(<br>              shareContent: arguments[<span class="hljs-string">&quot;shareContent&quot;</span>],<br>              shareImageUrl: arguments[<span class="hljs-string">&quot;shareContent&quot;</span>],<br>              shareTitle: arguments[<span class="hljs-string">&quot;shareTitle&quot;</span>]);<br>        &#125;,<br></code></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯ä½¿ç”¨<code>ModalRoute.of(context).settings.arguments</code>æ¥è·å–å‚æ•°ï¼Œæˆ–è€…åœ¨å…·ä½“ç•Œé¢ä¸­è·å–ä¹Ÿä¸€æ ·ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Androidæ¥å…¥flutterå¤šæ¸ é“å¼•èµ·çš„é—®é¢˜</title>
    <link href="/2019/06/19/Android%E6%8E%A5%E5%85%A5flutter%E5%A4%9A%E6%B8%A0%E9%81%93%E5%BC%95%E8%B5%B7%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <url>/2019/06/19/Android%E6%8E%A5%E5%85%A5flutter%E5%A4%9A%E6%B8%A0%E9%81%93%E5%BC%95%E8%B5%B7%E7%9A%84%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p>å…¬å¸å·²ç»å¼€å§‹åœ¨é¡¹ç›®ä¸­ä½¿ç”¨Flutterè¿›è¡Œè·¨å¹³å°å¼€å‘äº†ï¼Œå¹¶ä¸”å·²ç»åœ¨å…¶ä¸­ä¸€æ¬¾åº”ç”¨ä¸Šçº¿äº†ï¼Œè¿‡ç¨‹å¹¶æ²¡æœ‰å¤šæ›²æŠ˜ï¼ŒæŒ‰ç…§å®˜ç½‘æ•™ç¨‹ä¸€æ­¥æ­¥è¿›è¡Œï¼Œç»§æ‰¿ã€æ‰“åŒ…ã€æµ‹è¯•ã€å‘ç‰ˆã€‚</p><p>æœ€è¿‘å¦å¤–ä¸€ä¸ªé¡¹ç›®æœ‰æ–°çš„éœ€æ±‚ï¼Œä¹Ÿå¼€å§‹ä½¿ç”¨Flutterï¼Œåœ¨é›†æˆæ‰“åŒ…çš„æ—¶å€™å‡ºç°äº†é—®é¢˜ï¼š</p><p><code>A/flutter: [FATAL:flutter/shell/common/shell.cc(218)] Check failed: vm. Must be able to initialize the VM.</code></p><p>æ”¶é›†åˆ°çš„é”™è¯¯æ—¥å¿—å¦‚ä¸‹ï¼š</p><span id="more"></span><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs crash">E/CrashReport: #++++++++++Record By Bugly++++++++++#<br>E/CrashReport: # You can use Bugly(http:\\bugly.qq.com) to get more Crash Detail!<br>E/CrashReport: # PKG NAME: me.chunyu.ChunyuDoctor<br>E/CrashReport: # APP VER: 8.6.0<br>E/CrashReport: # LAUNCH TIME: 2019-06-19 18:00:12<br>E/CrashReport: # CRASH TYPE: NATIVE_CRASH<br>E/CrashReport: # CRASH TIME: 2019-06-19 18:00:22<br>E/CrashReport: # CRASH PROCESS: me.chunyu.ChunyuDoctor<br>E/CrashReport: # CRASH THREAD: main(2)<br>E/CrashReport: # REPORT ID: d88b5d1a-cbb0-4920-b41c-d8ea8eb804bd<br>E/CrashReport: # CRASH DEVICE: MI 5 UNROOT<br>E/CrashReport: # RUNTIME AVAIL RAM:1411100672 ROM:11107233792 SD:11107233792<br>E/CrashReport: # RUNTIME TOTAL RAM:2824822784 ROM:26300211200 SD:26300211200<br>E/CrashReport: # EXCEPTION FIRED BY UNKNOWN_USER me.chunyu.ChunyuDoctor(27335)<br>E/CrashReport: # CRASH STACK: <br>E/CrashReport: SIGABRT<br>    0x6ac7<br>    #00    pc 0004b10c    /system/lib/libc.so (tgkill+12) [armeabi-v7a::d7f479b7abcbff3bc09ca6d100c44333]<br>    #01    pc 0001a9a3    /system/lib/libc.so (abort+54) [armeabi-v7a::d7f479b7abcbff3bc09ca6d100c44333]<br>    #02    pc 00af85ab    /data/app/me.chunyu.ChunyuDoctor-n6cyA4a8iSyIl6wZ_2ghlw==/lib/arm/libflutter.so [armeabi-v7a::a12434e0b53806a35730000001000000]<br>    #03    pc 00b197cf    /data/app/me.chunyu.ChunyuDoctor-n6cyA4a8iSyIl6wZ_2ghlw==/lib/arm/libflutter.so [armeabi-v7a::a12434e0b53806a35730000001000000]<br>    #04    pc 00aeaf45    /data/app/me.chunyu.ChunyuDoctor-n6cyA4a8iSyIl6wZ_2ghlw==/lib/arm/libflutter.so [armeabi-v7a::a12434e0b53806a35730000001000000]<br>    #05    pc 00af0507    /data/app/me.chunyu.ChunyuDoctor-n6cyA4a8iSyIl6wZ_2ghlw==/lib/arm/libflutter.so [armeabi-v7a::a12434e0b53806a35730000001000000]<br>    #06    pc 00aef79b    /data/app/me.chunyu.ChunyuDoctor-n6cyA4a8iSyIl6wZ_2ghlw==/lib/arm/libflutter.so [armeabi-v7a::a12434e0b53806a35730000001000000]<br>    #07    pc 003d9d29    /system/lib/libart.so (ExecuteMterpImpl+37417) [armeabi-v7a::d2078ba50169919802b98e67fdc80c58]<br>    #08    pc 003d5fe1    /system/lib/libart.so (ExecuteMterpImpl+21729) [armeabi-v7a::d2078ba50169919802b98e67fdc80c58]<br>    #09    pc 003da555    /system/lib/libart.so (art_quick_invoke_stub+228) [armeabi-v7a::d2078ba50169919802b98e67fdc80c58]<br>    #10    pc 000a0e1d    /system/lib/libart.so (_ZN3art9ArtMethod6InvokeEPNS_6ThreadEPjjPNS_6JValueEPKc+140) [armeabi-v7a::d2078ba50169919802b98e67fdc80c58]<br>    #11    pc 001e6e53    /system/lib/libart.so (_ZN3art11interpreter34ArtInterpreterToCompiledCodeBridgeEPNS_6ThreadEPNS_9ArtMethodEPKNS_7DexFile8CodeItemEPNS_11ShadowFrameEPNS_6JValueE+238) [armeabi-v7a::d2078ba50169919802b98e67fdc80c58]<br>    #12    pc 001e2403    /system/lib/libart.so (_ZN3art11interpreter6DoCallILb0ELb0EEEbPNS_9ArtMethodEPNS_6ThreadERNS_11ShadowFrameEPKNS_11InstructionEtPNS_6JValueE+574) [armeabi-v7a::d2078ba50169919802b98e67fdc80c58]<br>    #13    pc 003c0d75    /system/lib/libart.so (MterpInvokeDirect+360) [armeabi-v7a::d2078ba50169919802b98e67fdc80c58]<br>    #14    pc 003c8394    /system/lib/libart.so (artInvokeSuperTrampolineWithAccessCheck+3599) [armeabi-v7a::d2078ba50169919802b98e67fdc80c58]<br>    #15    pc 001c9985    /system/lib/libart.so (_ZN3art22IndirectReferenceTable10VisitRootsEPNS_11RootVisitorERKNS_8RootInfoE+16) [armeabi-v7a::d2078ba50169919802b98e67fdc80c58]<br>    #16    pc 001ced07    /system/lib/libart.so (_ZN3art11interpreter33ArtInterpreterToInterpreterBridgeEPNS_6ThreadEPKNS_7DexFile8CodeItemEPNS_11ShadowFrameEPNS_6JValueE+142) [armeabi-v7a::d2078ba50169919802b98e67fdc80c58]<br>    #17    pc 001e23ed    /system/lib/libart.so (_ZN3art11interpreter6DoCallILb0ELb0EEEbPNS_9ArtMethodEPNS_6ThreadERNS_11ShadowFrameEPKNS_11InstructionEtPNS_6JValueE+552) [armeabi-v7a::d2078ba50169919802b98e67fdc80c58]<br>    #18    pc 003bfebf    /system/lib/libart.so (MterpInvokeVirtual+446) [armeabi-v7a::d2078ba50169919802b98e67fdc80c58]<br>    #19    pc 003c8294    /system/lib/libart.so (artInvokeSuperTrampolineWithAccessCheck+3343) [armeabi-v7a::d2078ba50169919802b98e67fdc80c58]<br>    #20    pc 001c9985    /system/lib/libart.so (_ZN3art22IndirectReferenceTable10VisitRootsEPNS_11RootVisitorERKNS_8RootInfoE+16) [armeabi-v7a::d2078ba50169919802b98e67fdc80c58]<br>    #21    pc 001ced07    /system/lib/libart.so (_ZN3art11interpreter33ArtInterpreterToInterpreterBridgeEPNS_6ThreadEPKNS_7DexFile8CodeItemEPNS_11ShadowFrameEPNS_6JValueE+142) [armeabi-v7a::d2078ba50169919802b98e67fdc80c58]<br>    #22    pc 001e23ed    /system/lib/libart.so (_ZN3art11interpreter6DoCallILb0ELb0EEEbPNS_9ArtMethodEPNS_6ThreadERNS_11ShadowFrameEPKNS_11InstructionEtPNS_6JValueE+552) [armeabi-v7a::d2078ba50169919802b98e67fdc80c58]<br>    #23    pc 003c0d75    /system/lib/libart.so (MterpInvokeDirect+360) [armeabi-v7a::d2078ba50169919802b98e67fdc80c58]<br>    #24    pc 003c8394    /system/lib/libart.so (artInvokeSuperTrampolineWithAccessCheck+3599) [armeabi-v7a::d2078ba50169919802b98e67fdc80c58]<br>    #25    pc 001c9985    /system/lib/libart.so (_ZN3art22IndirectReferenceTable10VisitRootsEPNS_11RootVisitorERKNS_8RootInfoE+16) [armeabi-v7a::<br>E/CrashReport: #++++++++++++++++++++++++++++++++++++++++++#<br></code></pre></td></tr></table></figure><p>åˆšå¼€å§‹ä»¥ä¸ºæ˜¯soåŒ…çš„é—®é¢˜ï¼Œä½†æ˜¯ç”¨åˆ°soçš„åœ°æ–¹å’Œå·²ç»å‘ç‰ˆçš„åº”ç”¨æ²¡å•¥åŒºåˆ«ã€‚æ’é™¤è¿™ä¸ªé—®é¢˜çš„å½±å“ã€‚<br>ç½‘ä¸Šç–¯ç‹‚æœç´¢ï¼Œçœ‹åˆ°äº†è¿™ä¸ª<br><a href="https://www.jianshu.com/p/273c462896c3">https://www.jianshu.com/p/273c462896c3</a><br>è¯´æ˜¯å› ä¸ºå®‰è£…åŒ…ç¼ºå°‘flutter_assetså¯¼è‡´çš„ã€‚è§£å¼€å®‰è£…åŒ…ï¼Œå‘ç°ç°è±¡ä¸€è‡´ã€‚å› ä¸ºå¤šæ¸ é“æ‰“åŒ…çš„é—®é¢˜ï¼Œå¯¼è‡´<code>flutter_assets</code>æ²¡æœ‰è¢«æ‰“åŒ…è¿›å»ï¼Œflutterçš„Issues#27027 <a href="https://github.com/flutter/flutter/issues/27028">https://github.com/flutter/flutter/issues/27028</a>  æœ‰æåˆ°è¿™ä¸ªï¼Œéœ€è¦åœ¨fluuter moduleçš„build.gradle(flutter module&#x2F;.android&#x2F;Flutter&#x2F;build.gradle)ä¸­é…ç½®åŒæ ·çš„æ¸ é“ä¿¡æ¯ã€‚</p><p><img src="/image/flutter/flutter_muilty_flavor.png" alt="é—®é¢˜åŸå› "></p><p>é…ç½®å®Œäº†æ‰“åŒ…å®‰è£…è¿è¡Œè¿˜æ˜¯åŒ…ä¸Šé¢çš„é”™è¯¯ã€‚æ ¹æ®ä¸Šé¢æ–‡ç« ï¼Œæ‰¾åˆ°flutterå®‰è£…ç›®å½•ä¸‹çš„æ‰“åŒ…ä½¿ç”¨çš„gradle,<code>flutter/packages/flutter_tools/gradle/flutter.gradle</code>æ–‡ä»¶ï¼Œå…¶ä¸­æœ‰è¿™ä¹ˆä¸ªæ–¹æ³•</p><p><code>private void addFlutterTask(Project project)</code></p><p><img src="/image/flutter/copy_flutter_assets_task.png" alt="copyFlutterAssetsTask"></p><p>å…¶ä¸­å®šä¹‰äº†åˆå¹¶èµ„æºçš„taskï¼š<code> Task mergeAssets = project.tasks.findByPath(&quot;:$&#123;mainModuleName&#125;:merge$&#123;variant.name.capitalize()&#125;Assets&quot;)</code></p><p>è¿™é‡Œé¢çš„å˜é‡<code>mainModuleName</code>é»˜è®¤æ˜¯<code>app</code>,ä½†æ˜¯æˆ‘ä»¬çš„å·¥ç¨‹çš„ä¸»moduleä¸æ˜¯è¿™ä¸ªåå­—ï¼Œè¿™ä¸ªtaskå°±ä¸ä¼šè¢«æ‰§è¡Œã€‚</p><p>åŠ ä¸Šæ‰“å°æ—¥å¿—ï¼Œæœç„¶<code>mergeAssets </code>æ˜¯nullï¼Œå¯¼è‡´èµ„æºæ–‡ä»¶ä¸ä¼šè¢«æ‰“åŒ…è¿›å»ã€‚</p><p>è¿™ä¸ªé—®é¢˜æœ‰äººå‘ç°äº†ï¼Œå¹¶ä¸”æäº¤äº† Pull request,åœ°å€ <a href="https://github.com/flutter/flutter/pull/27154">https://github.com/flutter/flutter/pull/27154</a></p><p>è§£å†³æ–¹æ¡ˆæ˜¯åœ¨æˆ‘ä»¬å·¥ç¨‹çš„<code>setting.gradle</code>æ–‡ä»¶ä¸­æŒ‡å®šä¸»moduleçš„åå­—</p><p><code>setBinding(new Binding([gradle: this, mainModuleName: &#39;example&#39;]))</code></p><p>å…³äºä¸Šé¢çš„å¤šæ¸ é“æ‰“åŒ…çš„é—®é¢˜ï¼Œæœ‰äººè¯´flutter moduleä¸­çš„.androidæ–‡ä»¶å¤¹æ˜¯flutterè‡ªå·±ç”Ÿæˆçš„ï¼Œæäº¤ä»£ç çš„æ—¶å€™å¹¶ä¸ä¼šæäº¤è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„ä»»ä½•å†…å®¹ã€‚æˆ‘ä»¬å¯ä»¥é­”æ”¹ä¸€ä¸‹ä¸Šé¢æåˆ°çš„<code>flutter.gradle</code>æ–‡ä»¶ï¼Œåœ¨æ‰“å¤šæ¸ é“åŒ…çš„æ—¶å€™å°†å½“å‰çš„æ¸ é“ä¿¡æ¯ä¼ è¿›å»ï¼Œåœ¨gradleæ–‡ä»¶ä¸­è¯»å–ä¸€ä¸‹æ¸ é“ä¿¡æ¯å°±å¥½ã€‚</p><p>è¿™é‡Œéœ€è¦æä¸€ä¸‹ASç”Ÿæˆçš„åˆå¹¶èµ„æºä»»åŠ¡åå­—ï¼šæ¯”å¦‚å½“å‰æ¸ é“æ˜¯<code>normal</code>,ä¸»å·¥ç¨‹çš„åå­—æ˜¯<code>example</code>,ç”Ÿæˆçš„ä»»åŠ¡åˆ™æ˜¯<code>exampleMergeNormalDebugAssets</code>å’Œ<code>exampleMergeNormalReleaseAssets</code>ã€‚å¯ä»¥åœ¨ASä¸­æ‰“å¼€gradleä»»åŠ¡é¢„è§ˆï¼Œåœ¨flutterè¿™ä¸ªmoduleä¸­<code>Task--&gt;other</code>åˆ†ç»„ä¸­æ‰¾åˆ°è¯¥ä»»åŠ¡ã€‚</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs groovy">String flavor = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">try</span>&#123;<br>    String tempFlavor = project.rootProject.ext.app.flavor<br>    <span class="hljs-keyword">if</span>(tempFlavor!=<span class="hljs-literal">null</span> &amp;&amp; !tempFlavor.empty)&#123;<br>        flavor = tempFlavor<br>    &#125;<br>    <br>&#125; <span class="hljs-keyword">catch</span> (Exception e)&#123;<br>    println e<br>&#125;<br><br>Task mergeAssets<br><br><span class="hljs-keyword">if</span>(flavor!=<span class="hljs-literal">null</span> &amp;&amp; !flavor.empty)&#123;<br>    mergeAssets = project.tasks.findByPath(<span class="hljs-string">&quot;:$&#123;mainModuleName&#125;:merge$&#123;flavor.capitalize()&#125;$&#123;variant.name.capitalize()&#125;Assets&quot;</span>)<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    mergeAssets = project.tasks.findByPath(<span class="hljs-string">&quot;:$&#123;mainModuleName&#125;:merge$&#123;variant.name.capitalize()&#125;Assets&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Androidçˆ¬å‘ä¹‹æ—…</tag>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ssã€ssrå’Œv2rayä»¥åŠbbr</title>
    <link href="/2019/05/29/ss%E3%80%81ssr%E5%92%8Cv2ray%E4%BB%A5%E5%8F%8Abbr/"/>
    <url>/2019/05/29/ss%E3%80%81ssr%E5%92%8Cv2ray%E4%BB%A5%E5%8F%8Abbr/</url>
    
    <content type="html"><![CDATA[<p>ç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œä¸ºäº†é˜²æ­¢æ–‡ç« è¢«å’Œè°ï¼Œæ–‡ä¸­ä¼šå‡ºç°æ˜æ˜¾(è„‘æ®‹)çš„è§£é‡Šè¯´æ˜ä¸Šçš„é”™è¯¯ï¼Œæ‡‚çš„è‡ªç„¶éƒ½æ‡‚</p><p>ä½¿ç”¨pipå®‰è£…ssserveä»¥åŠå¯¹åº”çš„é…ç½®</p><p>ä½¿ç”¨bbræ‹¥å¡æ§åˆ¶ç®—æ³•è¿›è¡ŒåŠ é€Ÿ</p><p>ä½¿ç”¨v2rayè„šæœ¬å®‰è£…v2ray</p><span id="more"></span><h4 id="å®‰è£…ssserveråŠé…ç½®"><a href="#å®‰è£…ssserveråŠé…ç½®" class="headerlink" title="å®‰è£…ssserveråŠé…ç½®"></a>å®‰è£…ssserveråŠé…ç½®</h4><h5 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h5><p>Debian&#x2F;Ubuntu:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">apt-get install python-pip<br>pip install shadowsocks <br></code></pre></td></tr></table></figure><p>CentOS:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs she">yum install python-setuptools &amp;&amp; easy_install pip<br>pip install shadowsocks <br></code></pre></td></tr></table></figure><p>æœ‰æ—¶ Ubuntu ä¼šé‡åˆ°ç¬¬ä¸€ä¸ªå‘½ä»¤å®‰è£… python-pip æ—¶æ‰¾ä¸åˆ°åŒ…çš„æƒ…å†µã€‚pip å®˜æ–¹ç»™å‡ºäº†ä¸€ä¸ªå®‰è£…è„šæœ¬ï¼Œå¯ä»¥è‡ªåŠ¨å®‰è£… pipã€‚å…ˆä¸‹è½½è„šæœ¬ï¼Œç„¶åæ‰§è¡Œå³å¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget https://bootstrap.pypa.io/get-pip.py python get-pip.py <br></code></pre></td></tr></table></figure><h5 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h5><p>åˆ›å»ºä¸€ä¸ªxx.jsonæ–‡ä»¶</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;server&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;your server ip&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;server_port&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">8388</span><span class="hljs-punctuation">,</span><span class="hljs-comment">//å®¢æˆ·ç«¯è¿æ¥ç”¨çš„ç«¯å£å·</span><br><span class="hljs-attr">&quot;local_port&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1080</span><span class="hljs-punctuation">,</span><span class="hljs-comment">//æœ¬æœºä½¿ç”¨çš„ç«¯å£å·</span><br><span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;your password&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;method&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;aes-256-cfb&quot;</span><br><span class="hljs-attr">&quot;timeout&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">300</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„methodæ˜¯åŠ å¯†æ–¹å¼ï¼Œé€‰æ‹©ä»€ä¹ˆæ ·çš„åŠ å¯†æ–¹å¼è‡ªå·±ç¡®å®šï¼Œæˆ–è€…è¯´çœ‹ä½ çš„å®¢æˆ·ç«¯æ”¯æŒä»€ä¹ˆæ ·çš„å‡é¢æ–¹å¼ï¼Œå¯é€‰å¦‚ä¸‹ï¼š</p><blockquote><p>aes-128-cfb<br>aes-256-cfb<br>chacha20<br>chacha20-ietf<br>aes-128-gcm<br>aes-256-gcm<br>chacha20-ietf-poly1305</p></blockquote><p>å¦‚æœæƒ³è¦å¼€å¯å¤šä¸ªç«¯å£ï¼ŒæŠŠä¸Šé¢çš„server_portå’Œpasswordæ”¹æˆè¿™æ ·</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;port_password&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-comment">//ç«¯å£:å¯†ç  </span><br>     <span class="hljs-attr">&quot;8381&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;password1&quot;</span><span class="hljs-punctuation">,</span><br>     <span class="hljs-attr">&quot;8382&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;password2&quot;</span><span class="hljs-punctuation">,</span><br>     <span class="hljs-attr">&quot;8383&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;password3&quot;</span><span class="hljs-punctuation">,</span><br>     <span class="hljs-attr">&quot;8384&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;password4&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæœåŠ¡å™¨æ”¯æŒipv6ï¼Œå¯ç”¨ipv6çš„è¯ï¼ŒæŠŠä¸Šé¢çš„serveræ”¹æˆ<code>::</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;server&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;::&quot;</span><span class="hljs-punctuation">,</span><br></code></pre></td></tr></table></figure><p>è¿™æ—¶ipv4å’Œipv6æ˜¯å¯ä»¥åŒæ—¶ä½¿ç”¨çš„ã€‚</p><p>å®¢æˆ·ç«¯è¿æ¥ssçš„æ—¶å€™ï¼ŒæœåŠ¡å™¨åœ°å€å¡«å†™ipv6çš„åœ°å€ï¼Œç±»ä¼¼äº<code>2402:d0c0:0:133::983d</code>å³å¯ã€‚</p><h5 id="å¯åŠ¨ssserve"><a href="#å¯åŠ¨ssserve" class="headerlink" title="å¯åŠ¨ssserve"></a>å¯åŠ¨ssserve</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssserver -c xx.json <br></code></pre></td></tr></table></figure><h4 id="ubuntuå†…æ ¸å‡çº§åŠä½¿ç”¨bbrè¿›è¡Œç½‘ç»œåŠ é€Ÿ"><a href="#ubuntuå†…æ ¸å‡çº§åŠä½¿ç”¨bbrè¿›è¡Œç½‘ç»œåŠ é€Ÿ" class="headerlink" title="ubuntuå†…æ ¸å‡çº§åŠä½¿ç”¨bbrè¿›è¡Œç½‘ç»œåŠ é€Ÿ"></a>ubuntuå†…æ ¸å‡çº§åŠä½¿ç”¨bbrè¿›è¡Œç½‘ç»œåŠ é€Ÿ</h4><p>è°·æ­Œæ–°çš„tcpæ‹¥å¡æ§åˆ¶ç®—æ³•BBR(<strong>Bottleneck Bandwidth and RTT</strong>)</p><p>å†…å®¹å‡ºè‡ª <a href="https://www.dz9.net/blog/4246.html">https://www.dz9.net/blog/4246.html</a></p><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒUbuntuå¼€å¯BBRçš„å‰ææ˜¯å†…æ ¸å¿…é¡»ç­‰äºé«˜äº4.9ã€‚<code>uname -a</code>æŸ¥çœ‹ubuntuå†…æ ¸ç³»ç»Ÿç‰ˆæœ¬ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œè·³è¿‡ä¸‹ä¸€æ­¥</p><h5 id="ubuntuå†…æ ¸å‡çº§"><a href="#ubuntuå†…æ ¸å‡çº§" class="headerlink" title="ubuntuå†…æ ¸å‡çº§"></a>ubuntuå†…æ ¸å‡çº§</h5><p><code>getconf LONG_BIT</code>æŸ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿæ˜¯å¤šå°‘ä½çš„,</p><p>ç¡®å®šç³»ç»Ÿä¹‹åï¼Œéœ€è¦ä¸‹è½½å¿…è¦çš„å‡çº§ç¨‹åºåŒ…</p><p><a href="http://kernel.ubuntu.com/~kernel-ppa/mainline/">http://kernel.ubuntu.com/~kernel-ppa/mainline/</a></p><p>è¿™ä¸ªç½‘ç«™å¯ä»¥æ‰¾åˆ°æœ€æ–°çš„ç¨‹åºåŒ…ï¼Œæ ¹æ®è‡ªå·±çš„éœ€è¦ä½¿ç”¨wgetå‘½ä»¤æ¥ä¸‹è½½åˆ°æœåŠ¡å™¨ï¼›</p><p>æ¯”å¦‚æˆ‘çš„æœåŠ¡å™¨æ˜¯64ä½ï¼Œå®‰è£…4.10.2çš„å†…æ ¸ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.10.2/linux-image-4.10.2-041002-generic_4.10.2-041002.201703120131_amd64.deb<br></code></pre></td></tr></table></figure><p>ç„¶ååˆ‡æ¢åˆ°ä½ çš„æ–‡ä»¶ä¸‹è½½ç›®å½•ï¼Œæ‰§è¡Œä¸‹åˆ—å‘½ä»¤æ¥å‡çº§ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo dpkg -i linux-image-4.10.2-041002-generic_4.10.2-041002.201703120131_amd64.deb<br></code></pre></td></tr></table></figure><p>æœ€åï¼Œæ‰§è¡Œå‘½ä»¤<code>sudo update-grub</code>ï¼Œæ›´æ–°grubå¼•å¯¼è£…å…¥ç¨‹åºã€‚</p><p>ä¸€æ—¦å„æ–¹é¢éƒ½å·²å®Œæˆï¼Œé‡å¯æœºå™¨ï¼Œä½ å°±å¯ä»¥å‡†å¤‡ä½¿ç”¨äº†ã€‚ç³»ç»Ÿé‡å¯åï¼Œæ‰“å¼€ç»ˆç«¯çª—å£ï¼Œæ‰§è¡Œå‘½ä»¤uname -aï¼Œç¡®ä¿ä½ å®é™…ä¸Šæ˜¯åœ¨è¿è¡Œä½ æ›´æ–°ä¹‹åçš„å†…æ ¸ã€‚</p><h6 id="å¼€å¯TCP-BBR"><a href="#å¼€å¯TCP-BBR" class="headerlink" title="å¼€å¯TCP BBR"></a>å¼€å¯TCP BBR</h6><p>ä¿®æ”¹ç³»ç»Ÿå˜é‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo &quot;net.core.default_qdisc=fq&quot; &gt;&gt; /etc/sysctl.conf<br>echo &quot;net.ipv4.tcp_congestion_control=bbr&quot; &gt;&gt; /etc/sysctl.conf<br></code></pre></td></tr></table></figure><p>ä¿å­˜ç”Ÿæ•ˆ</p><p><code>sysctl -p</code></p><p>æ‰§è¡Œ<br><code>sysctl net.ipv4.tcp_available_congestion_control</code></p><p>å¦‚æœè¿”å›ç»“æœ<br><code>net.ipv4.tcp_available_congestion_control = bbr cubic reno</code><br>é‚£ä¹ˆæ­å–œä½ BBRå¼€å¯æˆåŠŸäº†ï¼</p><p>ä¹Ÿå¯ä»¥æ‰§è¡Œ<br><code>lsmod | grep bbr</code><br>æ¥æ£€æµ‹ BBR æ˜¯å¦çœŸçš„å¼€å¯æˆåŠŸâ€¦â€¦</p><h4 id="v2ray"><a href="#v2ray" class="headerlink" title="v2ray"></a>v2ray</h4><p>ä¸€é”®å®‰è£…è„šæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">apt-get install curl -y bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/tracyone/v2ray.fun/master/install.sh)&quot;<br></code></pre></td></tr></table></figure><p>ç„¶åçœ‹æç¤ºå°±å¥½äº†ã€‚</p><p>æˆ–è€…çœ‹å®˜ç½‘ <a href="http://www.v2ray.com/">www.v2ray.com</a>   è¿™ä¸ªéœ€è¦ä¸€äº›æ–¹æ³•æ‰èƒ½è®¿é—®</p><p>å…³é”®å†…å®¹å¦‚ä¸‹ï¼š</p><h5 id="å¹³å°æ”¯æŒ"><a href="#å¹³å°æ”¯æŒ" class="headerlink" title="å¹³å°æ”¯æŒ"></a>å¹³å°æ”¯æŒ</h5><p>V2Ray åœ¨ä»¥ä¸‹å¹³å°ä¸­å¯ç”¨ï¼š</p><ul><li>Windows 7 åŠä¹‹åç‰ˆæœ¬ï¼ˆx86 &#x2F; amd64ï¼‰ï¼›</li><li>Mac OS X 10.10 Yosemite åŠä¹‹åç‰ˆæœ¬ï¼ˆamd64ï¼‰ï¼›</li><li>Linux 2.6.23 åŠä¹‹åç‰ˆæœ¬ï¼ˆx86 &#x2F; amd64 &#x2F; arm &#x2F; arm64 &#x2F; mips64 &#x2F; mipsï¼‰ï¼›<ul><li>åŒ…æ‹¬ä½†ä¸é™äº Debian 7 &#x2F; 8ã€Ubuntu 12.04 &#x2F; 14.04 åŠåç»­ç‰ˆæœ¬ã€CentOS 6 &#x2F; 7ã€Arch Linuxï¼›</li></ul></li><li>FreeBSD (x86 &#x2F; amd64)ï¼›</li><li>OpenBSD (x86 &#x2F; amd64)ï¼›</li><li>Dragonfly BSD (amd64)ï¼›</li></ul><h5 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h5><p>é¢„ç¼–è¯‘çš„å‹ç¼©åŒ…å¯ä»¥åœ¨å¦‚ä¸‹å‡ ä¸ªç«™ç‚¹æ‰¾åˆ°ï¼š</p><ol><li>Github Release: <a href="https://github.com/v2ray/v2ray-core/releases">github.com&#x2F;v2ray&#x2F;v2ray-core</a></li><li>Github åˆ†æµ: <a href="https://github.com/v2ray/dist/">github.com&#x2F;v2ray&#x2F;dist</a></li><li>Homebrew: <a href="https://github.com/v2ray/homebrew-v2ray">github.com&#x2F;v2ray&#x2F;homebrew-v2ray</a></li><li>Arch Linux: <a href="https://www.archlinux.org/packages/community/x86_64/v2ray/">packages&#x2F;community&#x2F;x86_64&#x2F;v2ray&#x2F;</a></li><li>Snapcraft: <a href="https://snapcraft.io/v2ray-core">snapcraft.io&#x2F;v2ray-core</a></li></ol><p>å‹ç¼©åŒ…å‡ä¸º zip æ ¼å¼ï¼Œæ‰¾åˆ°å¯¹åº”å¹³å°çš„å‹ç¼©åŒ…ï¼Œä¸‹è½½è§£å‹å³å¯ä½¿ç”¨ã€‚</p><h5 id="éªŒè¯å®‰è£…åŒ…"><a href="#éªŒè¯å®‰è£…åŒ…" class="headerlink" title="éªŒè¯å®‰è£…åŒ…"></a>éªŒè¯å®‰è£…åŒ…</h5><p>V2Ray æä¾›ä¸¤ç§éªŒè¯æ–¹å¼ï¼š</p><ol><li>å®‰è£…åŒ… zip æ–‡ä»¶çš„ SHA1 &#x2F; SHA256 æ‘˜è¦ï¼Œåœ¨æ¯ä¸ªå®‰è£…åŒ…å¯¹åº”çš„<code>.dgst</code>æ–‡ä»¶ä¸­å¯ä»¥æ‰¾åˆ°ã€‚</li><li>å¯è¿è¡Œç¨‹åºï¼ˆv2ray æˆ– v2ray.exeï¼‰çš„ gpg ç­¾åï¼Œæ–‡ä»¶ä½äºå®‰è£…åŒ…ä¸­çš„ v2ray.sig æˆ– v2ray.exe.sigã€‚ç­¾åå…¬é’¥å¯ä»¥<a href="https://raw.githubusercontent.com/v2ray/v2ray-core/master/release/verify/official_release.asc">åœ¨ä»£ç åº“ä¸­</a>æ‰¾åˆ°ã€‚</li></ol><h5 id="Windows-å’Œ-Mac-OS-å®‰è£…æ–¹å¼"><a href="#Windows-å’Œ-Mac-OS-å®‰è£…æ–¹å¼" class="headerlink" title="Windows å’Œ Mac OS å®‰è£…æ–¹å¼"></a>Windows å’Œ Mac OS å®‰è£…æ–¹å¼</h5><p>é€šè¿‡ä¸Šè¿°æ–¹å¼ä¸‹è½½çš„å‹ç¼©åŒ…ï¼Œè§£å‹ä¹‹åå¯çœ‹åˆ° v2ray æˆ– v2ray.exeã€‚ç›´æ¥è¿è¡Œå³å¯ã€‚</p><h5 id="Linux-å‘è¡Œç‰ˆä»“åº“"><a href="#Linux-å‘è¡Œç‰ˆä»“åº“" class="headerlink" title="Linux å‘è¡Œç‰ˆä»“åº“"></a>Linux å‘è¡Œç‰ˆä»“åº“</h5><p>éƒ¨åˆ†å‘è¡Œç‰ˆå¯èƒ½å·²æ”¶å½• V2Ray åˆ°å…¶å®˜æ–¹ç»´æŠ¤å’Œæ”¯æŒçš„è½¯ä»¶ä»“åº“&#x2F;è½¯ä»¶æºä¸­ã€‚å‡ºäºå…¼å®¹æ€§ã€é€‚é…æ€§è€ƒè™‘ï¼Œæ‚¨å¯ä»¥è€ƒè™‘é€‰ç”¨ç”±æ‚¨å‘è¡Œç‰ˆå¼€å‘å›¢é˜Ÿç»´æŠ¤çš„è½¯ä»¶åŒ…æˆ–ä¸‹æ–‡çš„å®‰è£…è„šæœ¬äº¦æˆ–åŸºäºå·²å‘å¸ƒçš„äºŒè¿›åˆ¶æ–‡ä»¶æˆ–æºä»£ç å®‰è£…ã€‚<br>Linux å®‰è£…è„šæœ¬<br>V2Ray æä¾›äº†ä¸€ä¸ªåœ¨ Linux ä¸­çš„è‡ªåŠ¨åŒ–å®‰è£…è„šæœ¬ã€‚è¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹æœ‰æ²¡æœ‰å®‰è£…è¿‡ V2Rayï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™è¿›è¡Œå®Œæ•´çš„å®‰è£…å’Œé…ç½®ï¼›å¦‚æœä¹‹å‰å®‰è£…è¿‡ V2Rayï¼Œåˆ™åªæ›´æ–° V2Ray äºŒè¿›åˆ¶ç¨‹åºè€Œä¸æ›´æ–°é…ç½®ã€‚</p><p>ä»¥ä¸‹æŒ‡ä»¤å‡è®¾å·²åœ¨ su ç¯å¢ƒä¸‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œè¯·å…ˆè¿è¡Œ sudo suã€‚</p><p>è¿è¡Œä¸‹é¢çš„æŒ‡ä»¤ä¸‹è½½å¹¶å®‰è£… V2Rayã€‚å½“ yum æˆ– apt-get å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œæ­¤è„šæœ¬ä¼šè‡ªåŠ¨å®‰è£… unzip å’Œ daemonã€‚è¿™ä¸¤ä¸ªç»„ä»¶æ˜¯å®‰è£… V2Ray çš„å¿…è¦ç»„ä»¶ã€‚å¦‚æœä½ ä½¿ç”¨çš„ç³»ç»Ÿä¸æ”¯æŒ yum æˆ– apt-getï¼Œè¯·è‡ªè¡Œå®‰è£… unzip å’Œ daemon</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash &lt;(curl -L -s https://install.direct/go.sh)<br></code></pre></td></tr></table></figure><p>æ­¤è„šæœ¬ä¼šè‡ªåŠ¨å®‰è£…ä»¥ä¸‹æ–‡ä»¶ï¼š</p><ul><li>&#x2F;usr&#x2F;bin&#x2F;v2ray&#x2F;v2rayï¼šV2Ray ç¨‹åºï¼›</li><li>&#x2F;usr&#x2F;bin&#x2F;v2ray&#x2F;v2ctlï¼šV2Ray å·¥å…·ï¼›</li><li>&#x2F;etc&#x2F;v2ray&#x2F;config.jsonï¼šé…ç½®æ–‡ä»¶ï¼›</li><li>&#x2F;usr&#x2F;bin&#x2F;v2ray&#x2F;geoip.datï¼šIP æ•°æ®æ–‡ä»¶</li><li>&#x2F;usr&#x2F;bin&#x2F;v2ray&#x2F;geosite.datï¼šåŸŸåæ•°æ®æ–‡ä»¶<br>æ­¤è„šæœ¬ä¼šé…ç½®è‡ªåŠ¨è¿è¡Œè„šæœ¬ã€‚è‡ªåŠ¨è¿è¡Œè„šæœ¬ä¼šåœ¨ç³»ç»Ÿé‡å¯ä¹‹åï¼Œè‡ªåŠ¨è¿è¡Œ V2Rayã€‚ç›®å‰è‡ªåŠ¨è¿è¡Œè„šæœ¬åªæ”¯æŒå¸¦æœ‰ Systemd çš„ç³»ç»Ÿï¼Œä»¥åŠ Debian &#x2F; Ubuntu å…¨ç³»åˆ—ã€‚</li></ul><p>è¿è¡Œè„šæœ¬ä½äºç³»ç»Ÿçš„ä»¥ä¸‹ä½ç½®ï¼š</p><ul><li><p>&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;v2ray.service: Systemd</p></li><li><p>&#x2F;etc&#x2F;init.d&#x2F;v2ray: SysV</p></li></ul><p>è„šæœ¬è¿è¡Œå®Œæˆåï¼Œä½ éœ€è¦ï¼š</p><ol><li>ç¼–è¾‘ &#x2F;etc&#x2F;v2ray&#x2F;config.json æ–‡ä»¶æ¥é…ç½®ä½ éœ€è¦çš„ä»£ç†æ–¹å¼ï¼›</li><li>è¿è¡Œ service v2ray start æ¥å¯åŠ¨ V2Ray è¿›ç¨‹ï¼›</li><li>ä¹‹åå¯ä»¥ä½¿ç”¨ service v2ray start|stop|status|reload|restart|force-reload æ§åˆ¶ V2Ray çš„è¿è¡Œã€‚</li></ol><h5 id="go-sh-å‚æ•°"><a href="#go-sh-å‚æ•°" class="headerlink" title="go.sh å‚æ•°"></a>go.sh å‚æ•°</h5><p>go.sh æ”¯æŒå¦‚ä¸‹å‚æ•°ï¼Œå¯åœ¨æ‰‹åŠ¨å®‰è£…æ—¶æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼š</p><ul><li><p>-p æˆ– â€“proxy: ä½¿ç”¨ä»£ç†æœåŠ¡å™¨æ¥ä¸‹è½½ V2Ray çš„æ–‡ä»¶ï¼Œæ ¼å¼ä¸ curl æ¥å—çš„å‚æ•°ä¸€è‡´ï¼Œæ¯”å¦‚â€socks5:&#x2F;&#x2F;127.0.0.1:1080â€ æˆ– â€œ<a href="http://127.0.0.1:3128&quot;ã€‚">http://127.0.0.1:3128&quot;ã€‚</a></p></li><li><p>-f æˆ– â€“force: å¼ºåˆ¶å®‰è£…ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœå½“å‰ç³»ç»Ÿä¸­å·²æœ‰æœ€æ–°ç‰ˆæœ¬çš„ V2Rayï¼Œgo.sh ä¼šåœ¨æ£€æµ‹ä¹‹åå°±é€€å‡ºã€‚å¦‚æœéœ€è¦å¼ºåˆ¶é‡è£…ä¸€éï¼Œåˆ™éœ€è¦æŒ‡å®šè¯¥å‚æ•°ã€‚</p></li><li><p>â€“version: æŒ‡å®šéœ€è¦å®‰è£…çš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚ â€œv1.13â€ã€‚é»˜è®¤å€¼ä¸ºæœ€æ–°ç‰ˆæœ¬ã€‚</p></li><li><p>â€“local: ä½¿ç”¨ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶è¿›è¡Œå®‰è£…ã€‚å¦‚æœä½ å·²ç»ä¸‹è½½äº†æŸä¸ªç‰ˆæœ¬çš„ V2Rayï¼Œåˆ™å¯é€šè¿‡è¿™ä¸ªå‚æ•°æŒ‡å®šä¸€ä¸ªæ–‡ä»¶è·¯å¾„æ¥è¿›è¡Œå®‰è£…ã€‚<br>ç¤ºä¾‹ï¼š</p></li><li><p>ä½¿ç”¨åœ°å€ä¸º 127.0.0.1:1080 çš„ SOCKS ä»£ç†ä¸‹è½½å¹¶å®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼š.&#x2F;go.sh -p socks5:&#x2F;&#x2F;127.0.0.1:1080</p></li><li><p>å®‰è£…æœ¬åœ°çš„ v1.13 ç‰ˆæœ¬ï¼š.&#x2F;go.sh â€“version v1.13 â€“local &#x2F;path&#x2F;to&#x2F;v2ray.zip</p><h5 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h5><p>V2Ray æä¾›äº†ä¸¤ä¸ªé¢„ç¼–è¯‘çš„ Docker imageï¼š</p></li><li><p>v2ray&#x2F;official <a href="https://hub.docker.com/r/v2ray/official/">https://hub.docker.com/r/v2ray/official/</a> : åŒ…å«æœ€æ–°å‘å¸ƒçš„ç‰ˆæœ¬ï¼Œæ¯å‘¨è·Ÿéšæ–°ç‰ˆæœ¬æ›´æ–°ï¼›</p></li><li><p>v2ray&#x2F;dev  <a href="https://hub.docker.com/r/v2ray/dev/">https://hub.docker.com/r/v2ray/dev/</a>:  åŒ…å«ç”±æœ€æ–°çš„ä»£ç ç¼–è¯‘è€Œæˆçš„ç¨‹åºæ–‡ä»¶ï¼Œéšä»£ç åº“æ›´æ–°ï¼›<br>ä¸¤ä¸ª image çš„æ–‡ä»¶ç»“æ„ç›¸åŒï¼š</p></li><li><p>&#x2F;etc&#x2F;v2ray&#x2F;config.json: é…ç½®æ–‡ä»¶</p></li><li><p>&#x2F;usr&#x2F;bin&#x2F;v2ray&#x2F;v2ray: V2Ray ä¸»ç¨‹åº</p></li><li><p>&#x2F;usr&#x2F;bin&#x2F;v2ray&#x2F;v2ctl: V2Ray è¾…åŠ©å·¥å…·</p></li><li><p>&#x2F;usr&#x2F;bin&#x2F;v2ray&#x2F;geoip.dat: IP æ•°æ®æ–‡ä»¶</p></li><li><p>&#x2F;usr&#x2F;bin&#x2F;v2ray&#x2F;geosite.dat: åŸŸåæ•°æ®æ–‡ä»¶</p></li></ul><h5 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;inbounds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1080</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// SOCKS ä»£ç†ç«¯å£ï¼Œåœ¨æµè§ˆå™¨ä¸­éœ€é…ç½®ä»£ç†å¹¶æŒ‡å‘è¿™ä¸ªç«¯å£</span><br>    <span class="hljs-attr">&quot;listen&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;socks&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;udp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;outbounds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;vmess&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;vnext&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;server&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// æœåŠ¡å™¨åœ°å€ï¼Œè¯·ä¿®æ”¹ä¸ºä½ è‡ªå·±çš„æœåŠ¡å™¨ ip æˆ–åŸŸå</span><br>        <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10086</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// æœåŠ¡å™¨ç«¯å£</span><br>        <span class="hljs-attr">&quot;users&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;b831381d-6324-4d53-ad4f-8cda48b30811&quot;</span> <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;freedom&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;tag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;direct&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;routing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;domainStrategy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;IPOnDemand&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;rules&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;field&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;ip&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;geoip:private&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;outboundTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;direct&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>ä¸Šè¿°é…ç½®å”¯ä¸€è¦æ”¹çš„åœ°æ–¹å°±æ˜¯ä½ çš„æœåŠ¡å™¨ IPï¼Œé…ç½®ä¸­å·²æ³¨æ˜ã€‚ä¸Šè¿°é…ç½®ä¼šæŠŠé™¤äº†å±€åŸŸç½‘ï¼ˆæ¯”å¦‚è®¿é—®è·¯ç”±å™¨ï¼‰ä¹‹å¤–çš„æ‰€æœ‰æµé‡è½¬å‘åˆ°ä½ çš„æœåŠ¡å™¨ã€‚</p><h5 id="æœåŠ¡å™¨é…ç½®"><a href="#æœåŠ¡å™¨é…ç½®" class="headerlink" title="æœåŠ¡å™¨é…ç½®"></a>æœåŠ¡å™¨é…ç½®</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;inbounds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10086</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// æœåŠ¡å™¨ç›‘å¬ç«¯å£ï¼Œå¿…é¡»å’Œä¸Šé¢çš„ä¸€æ ·</span><br>    <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;vmess&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;clients&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;b831381d-6324-4d53-ad4f-8cda48b30811&quot;</span> <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;outbounds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;freedom&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>æœåŠ¡å™¨çš„é…ç½®ä¸­éœ€è¦ç¡®ä¿ <code>id</code> å’Œç«¯å£ä¸å®¢æˆ·ç«¯ä¸€è‡´ï¼Œå°±å¯ä»¥æ­£å¸¸è¿æ¥äº†ã€‚</p><h5 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h5><ul><li>åœ¨ Windows å’Œ macOS ä¸­ï¼Œé…ç½®æ–‡ä»¶é€šå¸¸æ˜¯ V2Ray åŒç›®å½•ä¸‹çš„ <code>config.json</code> æ–‡ä»¶ã€‚ç›´æ¥è¿è¡Œ <code>v2ray</code> æˆ– <code>v2ray.exe</code> å³å¯ã€‚</li><li>åœ¨ Linux ä¸­ï¼Œé…ç½®æ–‡ä»¶é€šå¸¸ä½äº <code>/etc/v2ray/config.json</code> æ–‡ä»¶ã€‚è¿è¡Œ <code>v2ray --config=/etc/v2ray/config.json</code>ï¼Œæˆ–ä½¿ç”¨ systemd ç­‰å·¥å…·æŠŠ V2Ray ä½œä¸ºæœåŠ¡åœ¨åå°è¿è¡Œã€‚</li></ul><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>è¿ç»´</tag>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JetPackä¸­çš„LiveDataã€ViewModelã€LifeCycle</title>
    <link href="/2019/05/28/JetPack-LiveData-ViewModel-LifeCycle/"/>
    <url>/2019/05/28/JetPack-LiveData-ViewModel-LifeCycle/</url>
    
    <content type="html"><![CDATA[<p>2018å¹´è°·æ­ŒI&#x2F;O å‘å¸ƒäº†ä¸€ç³»åˆ—è¾…åŠ©androidå¼€å‘è€…çš„å®ç”¨å·¥å…·ï¼Œåˆç§°Jetpackï¼Œä»¥å¸®åŠ©å¼€å‘è€…æ„å»ºå‡ºè‰²çš„ Android åº”ç”¨ã€‚<br>è¿™æ¬¡å‘å¸ƒçš„ Android Jetpack ç»„ä»¶è¦†ç›–ä»¥ä¸‹ 4 ä¸ªæ–¹é¢ï¼šArchitectureã€Foundationã€Behavior ä»¥åŠ UIã€‚<br>è¯¥ç³»åˆ—åšå®¢ä»‹ç»ä¸€ä¸‹Jetpackä¸­å¸¸ç”¨ç»„ä»¶ï¼Œæœ¬ç¯‡ä»‹ç»LiveDataã€ViewModelã€LifeCycleã€‚æœ€åå€ŸåŠ©äº<a href="https://github.com/android/sunflower">https://github.com/android/sunflower</a> æ¥å†™ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨</p><span id="more"></span><h4 id="lifecycle"><a href="#lifecycle" class="headerlink" title="lifecycle"></a>lifecycle</h4><p>åŸæ–‡ï¼š<a href="https://developer.android.google.cn/topic/libraries/architecture/lifecycle">https://developer.android.google.cn/topic/libraries/architecture/lifecycle</a><br>è¯´ç™½äº†ï¼Œå°±æ˜¯ä¸€ä¸ªæ¥å£å›è°ƒï¼Œå¯ä»¥ä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ¥ç›¸åº”å£°æ˜å‘¨æœŸçš„å›è°ƒï¼Œå¹¶ä¸”å·²ç»å¸®æˆ‘ä»¬å¤„ç†å¥½äº†å„ç§å„æ ·çš„æ„å¤–çŠ¶å†µ(æ¯”å¦‚æˆ‘ä»¬åœ¨onStartä¸­åšäº†æ¯”è¾ƒå¤šçš„æ“ä½œï¼Œç”¨æˆ·ç‚¹äº†homeé”®ï¼Œå¯¼è‡´onStopåœ¨OnStartå®Œæˆä¹‹å‰è¢«è°ƒç”¨äº†)</p><p>Lifecycleæ˜¯ä¸€ä¸ªåŒ…å«æœ‰å…³ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçŠ¶æ€çš„ä¿¡æ¯(å¦‚Activityæˆ–Fragment)çš„ç±»ï¼Œå…è®¸å…¶ä»–å¯¹è±¡è§‚å¯Ÿæ­¤çŠ¶æ€<br>Lifecycleä½¿ç”¨ä¸¤ä¸ªæšä¸¾ç±»<code>Event</code>å’Œ<code>State</code>æ¥è¿½è¸ªç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ<br><img src="/image/Android/jetpack/lifecycle-states.png" alt="LifeCycler"><br>ä»£ç å¦‚ä¸‹<br>å®šä¹‰ä¸€ä¸ªObserverå®ç°LifecycleObserveræ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyLifecycleObserver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">LifecycleObserver</span> &#123;<br>    <span class="hljs-keyword">private</span> String tag;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyLifecycleObserver</span><span class="hljs-params">(String tag)</span>&#123;<br>        <span class="hljs-built_in">this</span>.tag = tag;<br>    &#125;<br>    <span class="hljs-meta">@OnLifecycleEvent(Lifecycle.Event.ON_CREATE)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">()</span>&#123;<br>        Log.e(tag,<span class="hljs-string">&quot;ON_CREATE&quot;</span>);<br>    &#125;<br>    <span class="hljs-meta">@OnLifecycleEvent(Lifecycle.Event.ON_START)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onStart</span><span class="hljs-params">()</span>&#123;<br>        Log.e(tag,<span class="hljs-string">&quot;ON_START&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@OnLifecycleEvent(Lifecycle.Event.ON_RESUME)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onResume</span><span class="hljs-params">()</span>&#123;<br>        Log.e(tag,<span class="hljs-string">&quot;ON_RESUME&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-meta">@OnLifecycleEvent(Lifecycle.Event.ON_PAUSE)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onPause</span><span class="hljs-params">()</span>&#123;<br>        Log.e(tag,<span class="hljs-string">&quot;ON_PAUSE&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-meta">@OnLifecycleEvent(Lifecycle.Event.ON_STOP)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onStop</span><span class="hljs-params">()</span>&#123;<br>        Log.e(tag,<span class="hljs-string">&quot;ON_STOP&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-meta">@OnLifecycleEvent(Lifecycle.Event.ON_DESTROY)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span>&#123;<br>        Log.e(tag,<span class="hljs-string">&quot;ON_DESTROY&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨Activityä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_lifecycle_observer);<br>        getLifecycle().addObserver(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyLifecycleObserver</span>(<span class="hljs-string">&quot;Activity&quot;</span>));<br>    &#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œè¦æ±‚Activityç»§æ‰¿è‡ªå®ç°äº†<code>LifecycleOwner</code>æ¥å£çš„ç±»ï¼Œæ¯”å¦‚<code>AppCompatActivity</code>ç­‰ã€‚<br>å¦‚æœå› ä¸ºæŸäº›åŸå› æ²¡æœ‰åŠæ³•ç»§æ‰¿è¿™ç§Activityï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±å®ç°<code>LifecycleOwner</code>æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WithoutLifeCycleActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">LifecycleOwner</span> &#123;<br><br>    <span class="hljs-keyword">private</span> LifecycleRegistry lifecycleRegistry;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_without_life_cycle);<br>        lifecycleRegistry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LifecycleRegistry</span>(<span class="hljs-built_in">this</span>);<br>        lifecycleRegistry.markState(Lifecycle.State.CREATED);<br>        getLifecycle().addObserver(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyLifecycleObserver</span>(<span class="hljs-string">&quot;lifecycleRegistry&quot;</span>));<br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onStart</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onStart();<br>        lifecycleRegistry.markState(Lifecycle.State.STARTED);<br>    &#125;<br>    <span class="hljs-meta">@NonNull</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Lifecycle <span class="hljs-title function_">getLifecycle</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> lifecycleRegistry;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="LiveData"><a href="#LiveData" class="headerlink" title="LiveData"></a>LiveData</h4><p>åŸæ–‡ï¼š<a href="https://developer.android.google.cn/topic/libraries/architecture/livedata">https://developer.android.google.cn/topic/libraries/architecture/livedata</a><br>LiveDataå’ŒRxJavaå¾ˆåƒï¼Œä½†æ˜¯LiveDataå¯ä»¥å’ŒLifeCycleç»‘å®šï¼Œæ¥é˜²æ­¢å†…å­˜æ³„æ¼ã€‚å› ä¸ºLiveDataä»…é€šçŸ¥å¤„äºæ´»åŠ¨çŠ¶æ€çš„è§‚å¯Ÿè€…æœ‰å…³æ›´æ–°çš„ä¿¡æ¯ï¼Œ<br>æ³¨å†Œè§‚æŸ¥LiveDataå¯¹è±¡çš„éæ´»åŠ¨è§‚å¯Ÿè€…ä¸ä¼šæ”¶åˆ°æœ‰å…³æ›´æ”¹çš„é€šçŸ¥(å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å£°æ˜ä»»ä½•çŠ¶æ€ä¸‹éƒ½èƒ½æ‰‹æ‰“é€šçŸ¥)ã€‚<br>å¦‚æœObserverç±»è¡¨ç¤ºçš„è§‚å¯Ÿè€…ç”Ÿå‘½å‘¨æœŸå¤„äºSTARTEDæˆ–RESUMEDçŠ¶æ€ï¼Œåˆ™LiveDataä¼šå°†å…¶è§†ä¸ºå¤„äºæ´»åŠ¨çŠ¶æ€ã€‚ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LiveDataActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br><br>    <span class="hljs-keyword">private</span> MutableLiveData&lt;String&gt; liveData;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_live_data);<br>        liveData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutableLiveData</span>&lt;&gt;();<br>        liveData.observe(<span class="hljs-built_in">this</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>&lt;String&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onChanged</span><span class="hljs-params">(String s)</span> &#123;<br>                Log.e(<span class="hljs-string">&quot;observe&quot;</span>,s);<br>            &#125;<br>        &#125;);<br>        liveData.observeForever(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>&lt;String&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onChanged</span><span class="hljs-params">(String s)</span> &#123;<br>                Log.e(<span class="hljs-string">&quot;observeForever&quot;</span>,s);<br>            &#125;<br>        &#125;);<br>        liveData.setValue(<span class="hljs-string">&quot;onCreate&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onStart</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onStart();<br>        liveData.setValue(<span class="hljs-string">&quot;onStart&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onResume</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onResume();<br>        liveData.setValue(<span class="hljs-string">&quot;onResume&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onStop</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onStop();<br>        liveData.setValue(<span class="hljs-string">&quot;onStop&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onDestroy();<br>        liveData.setValue(<span class="hljs-string">&quot;onDestroy&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æ‰“å¼€ç•Œé¢,æŒ‰ä¸‹homeé”®ï¼Œç„¶åè¿”å›åˆ°ç•Œé¢ï¼Œç„¶åæŒ‰è¿”å›é”®ï¼Œå¯ä»¥å‘ç°å¦‚ä¸‹logï¼š<br>æ‰“å¼€ç•Œé¢</p><blockquote><p>E&#x2F;observeForever: onCreate<br>  E&#x2F;observeForever: onStart<br>  E&#x2F;observe: onStart<br>  E&#x2F;observe: onResume<br>  E&#x2F;observeForever: onResume</p></blockquote><p>æŒ‰ä¸‹homeé”®</p><blockquote><p>E&#x2F;observeForever: onStop</p></blockquote><p>è¿”å›ç•Œé¢</p><blockquote><p>E&#x2F;observeForever: onStart<br>  E&#x2F;observe: onStart<br>  E&#x2F;observe: onResume<br>  E&#x2F;observeForever: onResume</p></blockquote><p>æŒ‰ä¸‹è¿”å›é”®</p><blockquote><p>E&#x2F;observeForever: onStop<br>  E&#x2F;observeForever: onDestroy</p></blockquote><p>å¦‚æœæˆ‘ä»¬å°†LiveDataå’ŒLifeCycleç»‘å®šåï¼Œåœ¨ç•Œé¢å¤„äºéæ´»åŠ¨çŠ¶æ€æ˜¯æ”¶ä¸åˆ°é€šçŸ¥çš„ã€‚<br>LiveDataç»å¸¸å’ŒRoomåŠViewModelä¸€å—ä½¿ç”¨</p><h4 id="ViewModel"><a href="#ViewModel" class="headerlink" title="ViewModel"></a>ViewModel</h4><p>åŸæ–‡ï¼š<a href="https://developer.android.google.cn/topic/libraries/architecture/viewmodel">https://developer.android.google.cn/topic/libraries/architecture/viewmodel</a><br>ViewModelæ˜¯ä»¥å…³è”ç”Ÿå‘½å‘¨æœŸçš„æ–¹å¼æ¥å­˜å‚¨å’Œç®¡ç†UIç›¸å…³çš„æ•°æ®çš„ç±»ï¼Œå³ä½¿configurationå‘ç”Ÿæ”¹å˜ï¼ˆæ¯”å¦‚æ—‹è½¬å±å¹•ï¼‰ï¼Œæ•°æ®ä»ç„¶å¯ä»¥å­˜åœ¨ä¸ä¼šé”€æ¯ã€‚å¹¶ä¸”æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ViewModelProvidersåœ¨ä¸åŒçš„Fragmentä¹‹é—´å…±äº«æ•°æ®ã€‚<br>å®ç°ViewModelï¼Œè¿™é‡Œçœç•¥æ‰äº†getterå’Œsetteræ–¹æ³•ã€‚å…¶å®æˆ‘ä»¬å¯ä»¥æŠŠæ¯ä¸ªå±æ€§éƒ½ç”¨<code>MutableLiveData</code>åŒ…è£…ä¸€ä¸‹ï¼Œè¿™æ ·å½“å±æ€§å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç«‹åˆ»çŸ¥é“ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserViewModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AndroidViewModel</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserViewModel</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Application application)</span> &#123;<br>        <span class="hljs-built_in">super</span>(application);<br>    &#125;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br>    <span class="hljs-keyword">private</span> String sex;<br>    <span class="hljs-keyword">private</span> MutableLiveData&lt;Integer&gt; valueChanged = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutableLiveData</span>&lt;&gt;();<br><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨Activityä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewModelActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br><br>    ActivityViewModelBinding binding;<br>    <span class="hljs-keyword">private</span> UserViewModel userViewModel;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        binding = DataBindingUtil.setContentView(<span class="hljs-built_in">this</span>,R.layout.activity_view_model);<br>        userViewModel = ViewModelProviders.of(<span class="hljs-built_in">this</span>).get(UserViewModel.class);<br>        userViewModel.getValueChanged().observeForever(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>&lt;Integer&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onChanged</span><span class="hljs-params">(Integer integer)</span> &#123;<br>                binding.setUser(userViewModel);<br>            &#125;<br>        &#125;);<br><br><br>        binding.save.setOnClickListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnClickListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> &#123;<br>                userViewModel.setSex(binding.sex.getText().toString());<br>                userViewModel.setName(binding.name.getText().toString());<br>                userViewModel.setAge(Integer.valueOf(binding.age.getText().toString()));<br>                userViewModel.getValueChanged().postValue(<span class="hljs-number">1</span>);<br>            &#125;<br>        &#125;);<br>    <br>        binding.reset.setOnClickListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnClickListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> &#123;<br>                userViewModel.setAge(<span class="hljs-number">11</span>);<br>                userViewModel.setName(<span class="hljs-string">&quot;aa&quot;</span>);<br>                userViewModel.setSex(<span class="hljs-string">&quot;M&quot;</span>);<br>                userViewModel.getValueChanged().postValue(<span class="hljs-number">1</span>);<br>                binding.setUser(userViewModel);<br>            &#125;<br>        &#125;);<br>        binding.setUser(userViewModel);<br>    <br>        ArrayList&lt;Fragment&gt; pages = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        pages.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ViewModelFragmentA</span>());<br>        pages.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ViewModelFragmentB</span>());<br>        PagerAdapter adapter=<span class="hljs-keyword">new</span> <span class="hljs-title class_">ViewAdapter</span>(getSupportFragmentManager(), pages);<br>       binding.viewPager.setAdapter(adapter);<br>    <br>    &#125;<br>    <br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FragmentPagerAdapter</span> &#123;<br>        <span class="hljs-keyword">private</span> ArrayList&lt;Fragment&gt; list;<br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">ViewAdapter</span><span class="hljs-params">(FragmentManager fm,ArrayList&lt;Fragment&gt; list)</span> &#123;<br>            <span class="hljs-built_in">super</span>(fm);<br>            <span class="hljs-built_in">this</span>.list=list;<br>        &#125;<br>    <br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> Fragment <span class="hljs-title function_">getItem</span><span class="hljs-params">(<span class="hljs-type">int</span> arg0)</span> &#123;<br>            <span class="hljs-keyword">return</span> list.get(arg0);<br>        &#125;<br>    <br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCount</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> list.size();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>FragmentAå’ŒFragmentBæ˜¯ä¸€æ ·çš„ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewModelFragmentA</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Fragment</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">View</span>.OnClickListener &#123;<br><br>    <span class="hljs-keyword">private</span> EditText name;<br>    <span class="hljs-keyword">private</span> EditText age;<br>    <span class="hljs-keyword">private</span> EditText sex;<br>    <br>    <span class="hljs-keyword">private</span> UserViewModel user;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ViewModelFragmentA</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// Required empty public constructor</span><br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>    <br>        user = ViewModelProviders.of(getActivity()).get(UserViewModel.class);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> View <span class="hljs-title function_">onCreateView</span><span class="hljs-params">(LayoutInflater inflater, ViewGroup container,</span><br><span class="hljs-params">                             Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-comment">// Inflate the layout for this fragment</span><br>        <span class="hljs-type">View</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> inflater.inflate(R.layout.fragment_view_model, container, <span class="hljs-literal">false</span>);<br>        name = view.findViewById(R.id.name);<br>        age = view.findViewById(R.id.age);<br>        sex = view.findViewById(R.id.sex);<br>    <br>        view.findViewById(R.id.save).setOnClickListener(<span class="hljs-built_in">this</span>);<br>        view.findViewById(R.id.reset).setOnClickListener(<span class="hljs-built_in">this</span>);<br>        view.findViewById(R.id.show).setOnClickListener(<span class="hljs-built_in">this</span>);<br>        user.getValueChanged().observeForever(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>&lt;Integer&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onChanged</span><span class="hljs-params">(Integer integer)</span> &#123;<br>                show();<br>            &#125;<br>        &#125;);<br>    <br>        show();<br>        <span class="hljs-keyword">return</span> view;<br>    &#125;<br><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">()</span> &#123;<br>        sex.setText(user.getSex());<br>        age.setText(String.valueOf(user.getAge()));<br>        name.setText(user.getName());<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> &#123;<br>        <span class="hljs-keyword">switch</span> (v.getId()) &#123;<br>            <span class="hljs-keyword">case</span> R.id.save:<br>                user.setSex(sex.getText().toString());<br>                user.setName(name.getText().toString());<br>                user.setAge(Integer.valueOf(age.getText().toString()));<br>                user.getValueChanged().postValue(<span class="hljs-number">1</span>);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> R.id.reset:<br>                user.setAge(<span class="hljs-number">11</span>);<br>                user.setName(<span class="hljs-string">&quot;aa&quot;</span>);<br>                user.setSex(<span class="hljs-string">&quot;M&quot;</span>);<br>                user.getValueChanged().postValue(<span class="hljs-number">1</span>);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> R.id.show:<br>                show();<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>    <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Activityä¸­æ˜¾ç¤ºåå­—ã€å¹´é¾„ã€æ€§åˆ«ã€‚ä¸¤ä¸ªæŒ‰é’®saveå’Œresetã€‚ åœ¨Fragmentä¸­å¤šä¸€ä¸ªshowæŒ‰é’®ã€‚<br>æˆ‘ä»¬è·å–ViewModeléƒ½æ˜¯é€šè¿‡<code>ViewModelProviders.of(getActivity()).get(UserViewModel.class)</code>æ¥è·å–ï¼Œå¾—åˆ°æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚<br>å½“æˆ‘ä»¬åœ¨ä»»æ„ä¸€ä¸ªåœ°æ–¹ä¿®æ”¹æ•°æ®å¹¶ä¿å­˜ä¹‹åï¼Œä¼šé€šè¿‡<code>valueChanged</code>å±æ€§æ¥é€šçŸ¥è§‚å¯Ÿè€…æ¥åˆ·æ–°ç•Œé¢ã€‚å‰é¢ä¹Ÿæåˆ°è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ¯ä¸ªå±æ€§éƒ½ç”¨<code>MutableLiveData</code><br>åŒ…è£…ä¸€ä¸‹ï¼Œè§‚å¯Ÿè€…å°±å¯ä»¥åœ¨æ¯ä¸ªå±æ€§æ”¹å˜çš„æ—¶å€™å¾—åˆ°é€šçŸ¥äº†ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vimtutor</title>
    <link href="/2019/05/16/vimtutor/"/>
    <url>/2019/05/16/vimtutor/</url>
    
    <content type="html"><![CDATA[<p>å®‰è£…vimåï¼Œæ‰§è¡Œvimtutorå°±å¥½äº†ã€‚ã€‚ã€‚</p><pre><code class="hljs"> Vim æ˜¯ä¸€ä¸ªå…·æœ‰å¾ˆå¤šå‘½ä»¤çš„åŠŸèƒ½éå¸¸å¼ºå¤§çš„ç¼–è¾‘å™¨ã€‚é™äºç¯‡å¹…ï¼Œåœ¨æœ¬æ•™ç¨‹å½“ä¸­ å°±ä¸è¯¦ç»†ä»‹ç»äº†ã€‚æœ¬æ•™ç¨‹çš„è®¾è®¡ç›®æ ‡æ˜¯è®²è¿°ä¸€äº›å¿…è¦çš„åŸºæœ¬å‘½ä»¤ï¼Œè€ŒæŒæ¡å¥½è¿™ äº›å‘½ä»¤ï¼Œæ‚¨å°±èƒ½å¤Ÿå¾ˆå®¹æ˜“åœ°å°† Vim å½“ä½œä¸€ä¸ªé€šç”¨ç¼–è¾‘å™¨æ¥ä½¿ç”¨äº†ã€‚ å®Œæˆæœ¬æ•™ç¨‹çš„å†…å®¹å¤§çº¦éœ€è¦25-30åˆ†é’Ÿï¼Œå–å†³äºæ‚¨è®­ç»ƒçš„æ—¶é—´ã€‚ æ³¨æ„ï¼š æ¯ä¸€èŠ‚çš„å‘½ä»¤æ“ä½œå°†ä¼šæ›´æ”¹æœ¬æ–‡ã€‚æ¨èæ‚¨å¤åˆ¶æœ¬æ–‡çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œç„¶ååœ¨å‰¯æœ¬ä¸Š è¿›è¡Œè®­ç»ƒ(å¦‚æœæ‚¨æ˜¯é€šè¿‡&quot;vimtutor&quot;æ¥å¯åŠ¨æ•™ç¨‹çš„ï¼Œé‚£ä¹ˆæœ¬æ–‡å°±å·²ç»æ˜¯å‰¯æœ¬äº†)ã€‚ åˆ‡è®°ä¸€ç‚¹ï¼šæœ¬æ•™ç¨‹çš„è®¾è®¡æ€è·¯æ˜¯åœ¨ä½¿ç”¨ä¸­è¿›è¡Œå­¦ä¹ çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‚¨éœ€è¦é€šè¿‡ æ‰§è¡Œå‘½ä»¤æ¥å­¦ä¹ å®ƒä»¬æœ¬èº«çš„æ­£ç¡®ç”¨æ³•ã€‚å¦‚æœæ‚¨åªæ˜¯é˜…è¯»è€Œä¸æ“ä½œï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½ ä¼šå¾ˆå¿«é—å¿˜è¿™äº›å‘½ä»¤çš„ï¼ å¥½äº†ï¼Œç°åœ¨è¯·ç¡®å®šæ‚¨çš„Shift-Lock(å¤§å°å†™é”å®šé”®)è¿˜æ²¡æœ‰æŒ‰ä¸‹ï¼Œç„¶åæŒ‰é”®ç›˜ä¸Š çš„å­—æ¯é”® j è¶³å¤Ÿå¤šæ¬¡æ¥ç§»åŠ¨å…‰æ ‡ï¼Œç›´åˆ°ç¬¬ä¸€èŠ‚çš„å†…å®¹èƒ½å¤Ÿå®Œå…¨å……æ»¡å±å¹•ã€‚</code></pre><span id="more"></span><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs code"><br>ç¬¬ä¸€è®²ç¬¬ä¸€èŠ‚ï¼šç§»åŠ¨å…‰æ ‡<br><br><br>     ** è¦ç§»åŠ¨å…‰æ ‡ï¼Œè¯·ä¾ç…§è¯´æ˜åˆ†åˆ«æŒ‰ä¸‹ hã€jã€kã€l é”®ã€‚ **<br><br>     ^<br>     k    æç¤ºï¼š h çš„é”®ä½äºå·¦è¾¹ï¼Œæ¯æ¬¡æŒ‰ä¸‹å°±ä¼šå‘å·¦ç§»åŠ¨ã€‚<br>       &lt; h l &gt;   l çš„é”®ä½äºå³è¾¹ï¼Œæ¯æ¬¡æŒ‰ä¸‹å°±ä¼šå‘å³ç§»åŠ¨ã€‚<br>     j   j é”®çœ‹èµ·æ¥å¾ˆè±¡ä¸€æ”¯å°–ç«¯æ–¹å‘æœä¸‹çš„ç®­å¤´ã€‚<br>     v<br><br>  1. è¯·éšæ„åœ¨å±å¹•å†…ç§»åŠ¨å…‰æ ‡ï¼Œç›´è‡³æ‚¨è§‰å¾—èˆ’æœä¸ºæ­¢ã€‚<br><br>  2. æŒ‰ä¸‹ä¸‹è¡Œé”®(j)ï¼Œç›´åˆ°å‡ºç°å…‰æ ‡é‡å¤ä¸‹è¡Œã€‚<br><br>---&gt; ç°åœ¨æ‚¨åº”è¯¥å·²ç»å­¦ä¼šå¦‚ä½•ç§»åŠ¨åˆ°ä¸‹ä¸€è®²å§ã€‚<br><br>  3. ç°åœ¨è¯·ä½¿ç”¨ä¸‹è¡Œé”®ï¼Œå°†å…‰æ ‡ç§»åŠ¨åˆ°ç¬¬ä¸€è®²ç¬¬äºŒèŠ‚ã€‚<br><br>æç¤ºï¼šå¦‚æœæ‚¨ä¸æ•¢ç¡®å®šæ‚¨æ‰€æŒ‰ä¸‹çš„å­—æ¯ï¼Œè¯·æŒ‰ä¸‹&lt;ESC&gt;é”®å›åˆ°æ­£å¸¸(Normal)æ¨¡å¼ã€‚<br>      ç„¶åå†æ¬¡ä»é”®ç›˜è¾“å…¥æ‚¨æƒ³è¦çš„å‘½ä»¤ã€‚<br><br>æç¤ºï¼šå…‰æ ‡é”®åº”å½“ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œçš„ã€‚ä½†æ˜¯ä½¿ç”¨hjklé”®ï¼Œåœ¨ä¹ æƒ¯ä¹‹åæ‚¨å°±èƒ½å¤Ÿæ›´å¿«<br>      åœ°åœ¨å±å¹•å†…å››å¤„ç§»åŠ¨å…‰æ ‡ã€‚çœŸçš„æ˜¯è¿™æ ·ï¼<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs code">ç¬¬ä¸€è®²ç¬¬äºŒèŠ‚ï¼šVIMçš„è¿›å…¥å’Œé€€å‡º<br><br><br>  !! ç‰¹åˆ«æç¤ºï¼šæ•¬è¯·é˜…è¯»æœ¬ä¸€èŠ‚çš„å®Œæ•´å†…å®¹ï¼Œç„¶åå†æ‰§è¡Œä»¥ä¸‹æ‰€è®²è§£çš„å‘½ä»¤ã€‚<br><br>  1. æŒ‰&lt;ESC&gt;é”®(è¿™æ˜¯ä¸ºäº†ç¡®ä¿æ‚¨å¤„åœ¨æ­£å¸¸æ¨¡å¼)ã€‚<br><br>  2. ç„¶åè¾“å…¥ï¼š:q! &lt;å›è½¦&gt;<br>     è¿™ç§æ–¹å¼çš„é€€å‡ºç¼–è¾‘å™¨ä¼šä¸¢å¼ƒæ‚¨è¿›å…¥ç¼–è¾‘å™¨ä»¥æ¥æ‰€åšçš„æ”¹åŠ¨ã€‚<br><br>  3. å¦‚æœæ‚¨çœ‹åˆ°äº†å‘½ä»¤è¡Œæç¤ºç¬¦ï¼Œè¯·è¾“å…¥èƒ½å¤Ÿå¸¦æ‚¨å›åˆ°æœ¬æ•™ç¨‹çš„å‘½ä»¤ï¼Œé‚£å°±æ˜¯ï¼š<br>     vimtutor &lt;å›è½¦&gt;<br><br>  4. å¦‚æœæ‚¨è‡ªä¿¡å·²ç»ç‰¢ç‰¢è®°ä½äº†è¿™äº›æ­¥éª¤çš„è¯ï¼Œè¯·ä»æ­¥éª¤1æ‰§è¡Œåˆ°æ­¥éª¤3é€€å‡ºï¼Œç„¶<br>     åå†æ¬¡è¿›å…¥ç¼–è¾‘å™¨ã€‚<br><br>æç¤ºï¼š :q! &lt;å›è½¦&gt; ä¼šä¸¢å¼ƒæ‚¨æ‰€åšçš„ä»»ä½•æ”¹åŠ¨ã€‚å‡ è®²ä¹‹åæ‚¨å°†å­¦ä¼šå¦‚ä½•ä¿å­˜æ”¹åŠ¨åˆ°æ–‡ä»¶ã€‚<br><br>  5. å°†å…‰æ ‡ä¸‹ç§»åˆ°ç¬¬ä¸€è®²ç¬¬ä¸‰èŠ‚ã€‚<br><br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs code">ç¬¬ä¸€è®²ç¬¬ä¸‰èŠ‚ï¼šæ–‡æœ¬ç¼–è¾‘ä¹‹åˆ é™¤<br><br><br>   ** åœ¨æ­£å¸¸(Normal)æ¨¡å¼ä¸‹ï¼Œå¯ä»¥æŒ‰ä¸‹ x é”®æ¥åˆ é™¤å…‰æ ‡æ‰€åœ¨ä½ç½®çš„å­—ç¬¦ã€‚**<br><br>  1. è¯·å°†å…‰æ ‡ç§»åŠ¨åˆ°æœ¬èŠ‚ä¸­ä¸‹é¢æ ‡è®°æœ‰ ---&gt; çš„é‚£ä¸€è¡Œã€‚<br><br>  2. ä¸ºäº†ä¿®æ­£è¾“å…¥é”™è¯¯ï¼Œè¯·å°†å…‰æ ‡ç§»è‡³å‡†å¤‡åˆ é™¤çš„å­—ç¬¦çš„ä½ç½®å¤„ã€‚<br><br>  3. ç„¶åæŒ‰ä¸‹ x é”®å°†é”™è¯¯å­—ç¬¦åˆ é™¤æ‰ã€‚<br><br>  4. é‡å¤æ­¥éª¤2åˆ°æ­¥éª¤4ï¼Œç›´åˆ°å¥å­ä¿®æ­£ä¸ºæ­¢ã€‚<br><br>---&gt; The ccow jumpedd ovverr thhe mooon.<br><br>  5. å¥½äº†ï¼Œè¯¥è¡Œå·²ç»ä¿®æ­£äº†ï¼Œä¸‹é¢æ˜¯ç¬¬ä¸€è®²ç¬¬å››èŠ‚ã€‚<br><br>ç‰¹åˆ«æç¤ºï¼šåœ¨æµè§ˆæœ¬æ•™ç¨‹æ—¶ï¼Œä¸è¦å¼ºè¡Œè®°å¿†ã€‚è®°ä½ä¸€ç‚¹ï¼šåœ¨ä½¿ç”¨ä¸­å­¦ä¹ ã€‚<br><br><br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs code">     ç¬¬ä¸€è®²ç¬¬å››èŠ‚ï¼šæ–‡æœ¬ç¼–è¾‘ä¹‹æ’å…¥<br><br><br> ** åœ¨æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œå¯ä»¥æŒ‰ä¸‹ i é”®æ¥æ’å…¥æ–‡æœ¬ã€‚**<br><br>  1. è¯·å°†å…‰æ ‡ç§»åŠ¨åˆ°æœ¬èŠ‚ä¸­ä¸‹é¢æ ‡è®°æœ‰ ---&gt; çš„ç¬¬ä¸€è¡Œã€‚<br><br>  2. ä¸ºäº†ä½¿å¾—ç¬¬ä¸€è¡Œå†…å®¹é›·åŒäºç¬¬äºŒè¡Œï¼Œè¯·å°†å…‰æ ‡ç§»è‡³æ–‡æœ¬ç¬¬ä¸€ä¸ªå‡†å¤‡æ’å…¥å­—ç¬¦<br>     çš„ä½ç½®ã€‚<br><br>  3. ç„¶åæŒ‰ä¸‹ i é”®ï¼Œæ¥ç€è¾“å…¥å¿…è¦çš„æ–‡æœ¬å­—ç¬¦ã€‚<br><br>  4. æ¯ä¸ªé”™è¯¯ä¿®æ­£å®Œæ¯•åï¼Œè¯·æŒ‰ä¸‹ &lt;ESC&gt; é”®è¿”å›æ­£å¸¸æ¨¡å¼ã€‚<br>     é‡å¤æ­¥éª¤2è‡³æ­¥éª¤4ä»¥ä¾¿ä¿®æ­£å¥å­ã€‚<br><br>---&gt; There is text misng this .<br>---&gt; There is some text missing from this line.<br><br>  5. å¦‚æœæ‚¨å¯¹æ–‡æœ¬æ’å…¥æ“ä½œå·²ç»å¾ˆæ»¡æ„ï¼Œè¯·æ¥ç€é˜…è¯»ä¸‹é¢çš„ç¬¬ä¸€è®²ç¬¬äº”èŠ‚ã€‚<br><br><br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs code">     ç¬¬ä¸€è®²ç¬¬äº”èŠ‚ï¼šæ–‡æœ¬ç¼–è¾‘ä¹‹æ·»åŠ <br><br><br>** æŒ‰ A é”®ä»¥æ·»åŠ æ–‡æœ¬ã€‚ **<br><br>  1. ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹é¢ç¬¬ä¸€ä¸ªæ ‡è®°æœ‰ ---&gt; çš„ä¸€è¡Œã€‚<br>     å…‰æ ‡æ”¾åœ¨é‚£ä¸€è¡Œçš„å“ªä¸ªå­—ç¬¦ä¸Šå¹¶ä¸é‡è¦ã€‚<br><br>  2. æŒ‰ A é”®è¾“å…¥å¿…è¦çš„æ·»åŠ å†…å®¹ã€‚<br><br>  3. æ–‡æœ¬æ·»åŠ å®Œæ¯•åï¼ŒæŒ‰ &lt;ESC&gt; é”®å›åˆ°æ­£å¸¸æ¨¡å¼ã€‚<br><br>  4. ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹é¢ç¬¬äºŒä¸ªæ ‡è®°æœ‰ ---&gt; çš„ä¸€è¡Œã€‚é‡å¤æ­¥éª¤2å’Œæ­¥éª¤3ä»¥æ”¹æ­£è¿™ä¸ªå¥å­ã€‚<br><br>---&gt; There is some text missing from th<br>     There is some text missing from this line.<br>---&gt; There is also some text miss<br>     There is also some text missing here.<br><br>  5. å½“æ‚¨å¯¹æ·»åŠ æ–‡æœ¬æ“ä½œæ„Ÿåˆ°æ»¡æ„æ—¶ï¼Œè¯·ç»§ç»­å­¦ä¹ ç¬¬ä¸€è®²ç¬¬å…­èŠ‚ã€‚<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs code">     ç¬¬ä¸€è®²ç¬¬å…­èŠ‚ï¼šç¼–è¾‘æ–‡ä»¶<br><br>    ** ä½¿ç”¨ :wq ä»¥ä¿å­˜æ–‡ä»¶å¹¶é€€å‡ºã€‚ **<br><br>ç‰¹åˆ«æç¤ºï¼šåœ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ä¹‹å‰ï¼Œè¯·å…ˆè¯»å®Œæ•´ä¸ªå°èŠ‚ï¼<br><br>1. å¦‚æ‚¨åœ¨ç¬¬ä¸€è®²ç¬¬äºŒèŠ‚ä¸­æ‰€åšçš„é‚£æ ·é€€å‡ºæœ¬æ•™ç¨‹ï¼š :q!<br>   æˆ–è€…ï¼Œå¦‚æœæ‚¨å¯ä»¥è®¿é—®å¦ä¸€ä¸ªç»ˆç«¯ï¼Œè¯·åœ¨é‚£é‡Œæ‰§è¡Œä»¥ä¸‹æ“ä½œã€‚<br><br>2. åœ¨ shell çš„æç¤ºç¬¦ä¸‹è¾“å…¥å‘½ä»¤ï¼š vim tutor &lt;å›è½¦&gt;<br>   &#x27;vim&#x27;æ˜¯å¯åŠ¨ Vim ç¼–è¾‘å™¨çš„å‘½ä»¤ï¼Œ&#x27;tutor&#x27;æ˜¯æ‚¨å¸Œæœ›ç¼–è¾‘çš„æ–‡ä»¶çš„åå­—ã€‚<br>   è¯·ä½¿ç”¨ä¸€ä¸ªå¯ä»¥æ”¹åŠ¨çš„æ–‡ä»¶ã€‚<br><br>3. ä½¿ç”¨æ‚¨åœ¨å‰é¢çš„æ•™ç¨‹ä¸­å­¦åˆ°çš„å‘½ä»¤æ’å…¥åˆ é™¤æ–‡æœ¬ã€‚<br><br>4. ä¿å­˜æ”¹åŠ¨è¿‡çš„æ–‡ä»¶å¹¶é€€å‡º Vimï¼ŒæŒ‰è¿™äº›é”®ï¼š :wq  &lt;å›è½¦&gt;<br><br>5. å¦‚æœæ‚¨åœ¨æ­¥éª¤1ä¸­å·²ç»é€€å‡º vimtutorï¼Œè¯·é‡å¯ vimtutor ç§»åŠ¨åˆ°ä¸‹é¢çš„å°ç»“ä¸€èŠ‚ã€‚<br><br>6. é˜…è¯»å®Œä»¥ä¸Šæ­¥éª¤ï¼Œå¼„æ‡‚å®ƒä»¬çš„æ„ä¹‰ï¼Œç„¶ååœ¨å®è·µä¸­è¿›è¡Œç»ƒä¹ ã€‚<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs code">       ç¬¬ä¸€è®²å°ç»“<br><br><br>  1. å…‰æ ‡åœ¨å±å¹•æ–‡æœ¬ä¸­çš„ç§»åŠ¨æ—¢å¯ä»¥ç”¨ç®­å¤´é”®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ hjkl å­—æ¯é”®ã€‚<br> h (å·¦ç§»)j (ä¸‹è¡Œ)       k (ä¸Šè¡Œ)    l (å³ç§»)<br><br>  2. æ¬²è¿›å…¥ Vim ç¼–è¾‘å™¨(ä»å‘½ä»¤è¡Œæç¤ºç¬¦)ï¼Œè¯·è¾“å…¥ï¼švim æ–‡ä»¶å &lt;å›è½¦&gt;<br><br>  3. æ¬²é€€å‡º Vim ç¼–è¾‘å™¨ï¼Œè¯·è¾“å…¥ &lt;ESC&gt;   :q!   &lt;å›è½¦&gt; æ”¾å¼ƒæ‰€æœ‰æ”¹åŠ¨ã€‚<br>                      æˆ–è€…è¾“å…¥ &lt;ESC&gt;   :wq   &lt;å›è½¦&gt; ä¿å­˜æ”¹åŠ¨ã€‚<br><br>  4. åœ¨æ­£å¸¸æ¨¡å¼ä¸‹åˆ é™¤å…‰æ ‡æ‰€åœ¨ä½ç½®çš„å­—ç¬¦ï¼Œè¯·æŒ‰ï¼š x<br><br>  5. æ¬²æ’å…¥æˆ–æ·»åŠ æ–‡æœ¬ï¼Œè¯·è¾“å…¥ï¼š<br><br> i   è¾“å…¥æ¬²æ’å…¥æ–‡æœ¬   &lt;ESC&gt;åœ¨å…‰æ ‡å‰æ’å…¥æ–‡æœ¬<br> A   è¾“å…¥æ¬²æ·»åŠ æ–‡æœ¬   &lt;ESC&gt;             åœ¨ä¸€è¡Œåæ·»åŠ æ–‡æœ¬<br><br>ç‰¹åˆ«æç¤ºï¼šæŒ‰ä¸‹ &lt;ESC&gt; é”®ä¼šå¸¦æ‚¨å›åˆ°æ­£å¸¸æ¨¡å¼æˆ–è€…æ’¤æ¶ˆä¸€ä¸ªä¸æƒ³è¾“å…¥æˆ–éƒ¨åˆ†å®Œæ•´<br>çš„å‘½ä»¤ã€‚<br><br>å¥½äº†ï¼Œç¬¬ä¸€è®²åˆ°æ­¤ç»“æŸã€‚ä¸‹é¢æ¥ä¸‹æ¥ç»§ç»­ç¬¬äºŒè®²çš„å†…å®¹ã€‚<br><br><br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs code">ç¬¬äºŒè®²ç¬¬ä¸€èŠ‚ï¼šåˆ é™¤ç±»å‘½ä»¤<br><br><br>    ** è¾“å…¥ dw å¯ä»¥ä»å…‰æ ‡å¤„åˆ é™¤è‡³ä¸€ä¸ªå•è¯çš„æœ«å°¾ã€‚**<br><br>  1. è¯·æŒ‰ä¸‹ &lt;ESC&gt; é”®ç¡®ä¿æ‚¨å¤„äºæ­£å¸¸æ¨¡å¼ã€‚<br><br>  2. è¯·å°†å…‰æ ‡ç§»åŠ¨åˆ°æœ¬èŠ‚ä¸­ä¸‹é¢æ ‡è®°æœ‰ ---&gt; çš„é‚£ä¸€è¡Œã€‚<br><br>  3. è¯·å°†å…‰æ ‡ç§»è‡³å‡†å¤‡è¦åˆ é™¤çš„å•è¯çš„èµ·å§‹å¤„ã€‚<br><br>  4. æ¥ç€è¾“å…¥ dw åˆ é™¤æ‰è¯¥å•è¯ã€‚<br><br>  ç‰¹åˆ«æç¤ºï¼šå½“æ‚¨è¾“å…¥æ—¶ï¼Œå­—æ¯ d ä¼šåŒæ—¶å‡ºç°åœ¨å±å¹•çš„æœ€åä¸€è¡Œã€‚Vim åœ¨ç­‰å¾…æ‚¨è¾“å…¥<br>  å­—æ¯ wã€‚å¦‚æœæ‚¨çœ‹åˆ°çš„æ˜¯é™¤ d å¤–çš„å…¶ä»–å­—ç¬¦ï¼Œé‚£è¡¨æ˜æ‚¨æŒ‰é”™äº†ï¼›è¯·æŒ‰ä¸‹ &lt;ESC&gt; é”®ï¼Œ<br>  ç„¶åé‡æ–°å†æ¥ã€‚<br><br>---&gt; There are a some words fun that don&#x27;t belong paper in this sentence.<br><br>  5. é‡å¤æ­¥éª¤3å’Œæ­¥éª¤4ï¼Œç›´è‡³å¥å­ä¿®æ­£å®Œæ¯•ã€‚æ¥ç€ç»§ç»­ç¬¬äºŒè®²ç¬¬äºŒèŠ‚å†…å®¹ã€‚<br><br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs code">      ç¬¬äºŒè®²ç¬¬äºŒèŠ‚ï¼šæ›´å¤šåˆ é™¤ç±»å‘½ä»¤<br><br><br>   ** è¾“å…¥ d$ ä»å½“å‰å…‰æ ‡åˆ é™¤åˆ°è¡Œæœ«ã€‚**<br><br>  1. è¯·æŒ‰ä¸‹ &lt;ESC&gt; é”®ç¡®ä¿æ‚¨å¤„äºæ­£å¸¸æ¨¡å¼ã€‚<br><br>  2. è¯·å°†å…‰æ ‡ç§»åŠ¨åˆ°æœ¬èŠ‚ä¸­ä¸‹é¢æ ‡è®°æœ‰ ---&gt; çš„é‚£ä¸€è¡Œã€‚<br><br>  3. è¯·å°†å…‰æ ‡ç§»åŠ¨åˆ°è¯¥è¡Œçš„å°¾éƒ¨(ä¹Ÿå°±æ˜¯åœ¨ç¬¬ä¸€ä¸ªç‚¹å·â€˜.â€™åé¢)ã€‚<br><br>  4. ç„¶åè¾“å…¥ d$ ä»å…‰æ ‡å¤„åˆ è‡³å½“å‰è¡Œå°¾éƒ¨ã€‚<br><br>---&gt; Somebody typed the end of this line twice. end of this line twice.<br><br><br>  5. è¯·ç»§ç»­å­¦ä¹ ç¬¬äºŒè®²ç¬¬ä¸‰èŠ‚å°±çŸ¥é“æ˜¯æ€ä¹ˆå›äº‹äº†ã€‚<br><br><br><br><br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs code">     ç¬¬äºŒè®²ç¬¬ä¸‰èŠ‚ï¼šå…³äºå‘½ä»¤å’Œå¯¹è±¡<br><br><br>  è®¸å¤šæ”¹å˜æ–‡æœ¬çš„å‘½ä»¤éƒ½ç”±ä¸€ä¸ªæ“ä½œç¬¦å’Œä¸€ä¸ªåŠ¨ä½œæ„æˆã€‚<br>  ä½¿ç”¨åˆ é™¤æ“ä½œç¬¦ d çš„åˆ é™¤å‘½ä»¤çš„æ ¼å¼å¦‚ä¸‹ï¼š<br><br>d   motion<br><br>  å…¶ä¸­ï¼š<br>    d      - åˆ é™¤æ“ä½œç¬¦ã€‚<br>    motion - æ“ä½œç¬¦çš„æ“ä½œå¯¹è±¡(åœ¨ä¸‹é¢åˆ—å‡º)ã€‚<br><br>  ä¸€ä¸ªç®€çŸ­çš„åŠ¨ä½œåˆ—è¡¨ï¼š<br>    w - ä»å½“å‰å…‰æ ‡å½“å‰ä½ç½®ç›´åˆ°ä¸‹ä¸€ä¸ªå•è¯èµ·å§‹å¤„ï¼Œä¸åŒ…æ‹¬å®ƒçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚<br>    e - ä»å½“å‰å…‰æ ‡å½“å‰ä½ç½®ç›´åˆ°å•è¯æœ«å°¾ï¼ŒåŒ…æ‹¬æœ€åä¸€ä¸ªå­—ç¬¦ã€‚<br>    $ - ä»å½“å‰å…‰æ ‡å½“å‰ä½ç½®ç›´åˆ°å½“å‰è¡Œæœ«ã€‚<br><br>  å› æ­¤è¾“å…¥ de ä¼šä»å½“å‰å…‰æ ‡ä½ç½®åˆ é™¤åˆ°å•è¯æœ«å°¾ã€‚<br><br>ç‰¹åˆ«æç¤ºï¼š<br>    å¯¹äºå‹‡äºæ¢ç´¢è€…ï¼Œè¯·åœ¨æ­£å¸¸æ¨¡å¼ä¸‹é¢ä»…æŒ‰ä»£è¡¨ç›¸åº”åŠ¨ä½œçš„é”®è€Œä¸ä½¿ç”¨æ“ä½œç¬¦ï¼Œæ‚¨<br>    å°†çœ‹åˆ°å…‰æ ‡çš„ç§»åŠ¨æ­£å¦‚ä¸Šé¢çš„å¯¹è±¡åˆ—è¡¨æ‰€ä»£è¡¨çš„ä¸€æ ·ã€‚<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs code">     ç¬¬äºŒè®²ç¬¬å››èŠ‚ï¼šä½¿ç”¨è®¡æ•°æŒ‡å®šåŠ¨ä½œ<br><br><br>             ** åœ¨åŠ¨ä½œå‰è¾“å…¥æ•°å­—ä¼šä½¿å®ƒé‡å¤é‚£ä¹ˆå¤šæ¬¡ã€‚ **<br><br>  1. ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹é¢æ ‡è®°æœ‰ ---&gt; çš„ä¸€è¡Œçš„å¼€å§‹ã€‚<br><br>  2. è¾“å…¥ 2w ä½¿å…‰æ ‡å‘å‰ç§»åŠ¨ä¸¤ä¸ªå•è¯ã€‚<br><br>  3. è¾“å…¥ 3e ä½¿å…‰æ ‡å‘å‰ç§»åŠ¨åˆ°ç¬¬ä¸‰ä¸ªå•è¯çš„æœ«å°¾ã€‚<br><br>  4. è¾“å…¥ 0 (æ•°å­—é›¶) ç§»åŠ¨å…‰æ ‡åˆ°è¡Œé¦–ã€‚<br><br>  5. é‡å¤æ­¥éª¤2å’Œæ­¥éª¤3ï¼Œå°è¯•ä¸åŒçš„æ•°å­—ã€‚<br><br>---&gt; This is just a line with words you can move around in.<br><br>  6. è¯·ç»§ç»­å­¦ä¹ ç¬¬äºŒè®²ç¬¬äº”èŠ‚ã€‚<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs code">       ç¬¬äºŒè®²ç¬¬äº”èŠ‚ï¼šä½¿ç”¨è®¡æ•°ä»¥åˆ é™¤æ›´å¤š<br><br><br>       ** ä½¿ç”¨æ“ä½œç¬¦æ—¶è¾“å…¥æ•°å­—å¯ä»¥ä½¿å®ƒé‡å¤é‚£ä¹ˆå¤šæ¬¡ã€‚ **<br><br>  ä¸Šé¢å·²ç»æåˆ°è¿‡åˆ é™¤æ“ä½œç¬¦å’ŒåŠ¨ä½œçš„ç»„åˆï¼Œæ‚¨å¯ä»¥åœ¨ç»„åˆä¸­åŠ¨ä½œä¹‹å‰æ’å…¥ä¸€ä¸ªæ•°å­—ä»¥<br>  åˆ é™¤æ›´å¤šï¼š<br> d   number(æ•°å­—)   motion<br><br>  1. ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹é¢æ ‡è®°æœ‰ ---&gt; çš„ä¸€è¡Œä¸­ç¬¬ä¸€ä¸ªå¤§å†™å­—æ¯å•è¯ä¸Šã€‚<br><br>  2. è¾“å…¥ d2w ä»¥åˆ é™¤ä¸¤ä¸ªå¤§å†™å­—æ¯å•è¯ã€‚<br><br>  3. é‡å¤æ­¥éª¤1å’Œæ­¥éª¤2ï¼Œä½¿ç”¨ä¸åŒçš„æ•°å­—ä½¿å¾—ç”¨ä¸€ä¸ªå‘½ä»¤å°±èƒ½åˆ é™¤å…¨éƒ¨ç›¸é‚»çš„å¤§å†™å­—æ¯<br>     å•è¯<br><br>---&gt;  this ABC DE line FGHI JK LMN OP of words is Q RS TUV cleaned up.<br><br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs code">    ç¬¬äºŒè®²ç¬¬å…­èŠ‚ï¼šæ“ä½œæ•´è¡Œ<br><br><br>     ** è¾“å…¥ dd å¯ä»¥åˆ é™¤æ•´ä¸€ä¸ªå½“å‰è¡Œã€‚ **<br><br>  é‰´äºæ•´è¡Œåˆ é™¤çš„é«˜é¢‘åº¦ï¼ŒVi çš„è®¾è®¡è€…å†³å®šè¦ç®€åŒ–æ•´è¡Œåˆ é™¤æ“ä½œï¼Œæ‚¨ä»…éœ€è¦åœ¨åŒä¸€è¡Œä¸Š<br>  å‡»æ‰“ä¸¤æ¬¡ d å°±å¯ä»¥åˆ é™¤æ‰å…‰æ ‡æ‰€åœ¨çš„æ•´è¡Œäº†ã€‚<br><br>  1. è¯·å°†å…‰æ ‡ç§»åŠ¨åˆ°æœ¬èŠ‚ä¸­ä¸‹é¢çš„çŸ­å¥æ®µè½ä¸­çš„ç¬¬äºŒè¡Œã€‚<br>  2. è¾“å…¥ dd åˆ é™¤è¯¥è¡Œã€‚<br>  3. ç„¶åç§»åŠ¨åˆ°ç¬¬å››è¡Œã€‚<br>  4. æ¥ç€è¾“å…¥ 2dd åˆ é™¤ä¸¤è¡Œã€‚<br><br>---&gt;  1)  Roses are red,<br>---&gt;  2)  Mud is fun,<br>---&gt;  3)  Violets are blue,<br>---&gt;  4)  I have a car,<br>---&gt;  5)  Clocks tell time,<br>---&gt;  6)  Sugar is sweet<br>---&gt;  7)  And so are you.<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs code">   ç¬¬äºŒè®²ç¬¬ä¸ƒèŠ‚ï¼šæ’¤æ¶ˆç±»å‘½ä»¤<br><br><br>** è¾“å…¥ u æ¥æ’¤æ¶ˆæœ€åæ‰§è¡Œçš„å‘½ä»¤ï¼Œè¾“å…¥ U æ¥æ’¤æ¶ˆå¯¹æ•´è¡Œçš„ä¿®æ”¹ã€‚ **<br><br>  1. è¯·å°†å…‰æ ‡ç§»åŠ¨åˆ°æœ¬èŠ‚ä¸­ä¸‹é¢æ ‡è®°æœ‰ ---&gt; çš„é‚£ä¸€è¡Œï¼Œå¹¶å°†å…¶ç½®äºç¬¬ä¸€ä¸ªé”™è¯¯<br>     å¤„ã€‚<br>  2. è¾“å…¥ x åˆ é™¤ç¬¬ä¸€ä¸ªä¸æƒ³ä¿ç•™çš„å­—æ¯ã€‚<br>  3. ç„¶åè¾“å…¥ u æ’¤æ¶ˆæœ€åæ‰§è¡Œçš„(ä¸€æ¬¡)å‘½ä»¤ã€‚<br>  4. è¿™æ¬¡è¦ä½¿ç”¨ x ä¿®æ­£æœ¬è¡Œçš„æ‰€æœ‰é”™è¯¯ã€‚<br>  5. ç°åœ¨è¾“å…¥ä¸€ä¸ªå¤§å†™çš„ U ï¼Œæ¢å¤åˆ°è¯¥è¡Œçš„åŸå§‹çŠ¶æ€ã€‚<br>  6. æ¥ç€å¤šæ¬¡è¾“å…¥ u ä»¥æ’¤æ¶ˆ U ä»¥åŠæ›´å‰çš„å‘½ä»¤ã€‚<br>  7. ç„¶åå¤šæ¬¡è¾“å…¥ CTRL-R (å…ˆæŒ‰ä¸‹ CTRL é”®ä¸æ”¾å¼€ï¼Œæ¥ç€æŒ‰ R é”®)ï¼Œè¿™æ ·å°±<br>     å¯ä»¥é‡åšè¢«æ’¤æ¶ˆçš„å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯æ’¤æ¶ˆæ‰æ’¤æ¶ˆå‘½ä»¤ã€‚<br><br>---&gt; Fiix the errors oon thhis line and reeplace them witth undo.<br><br>  8. è¿™äº›éƒ½æ˜¯éå¸¸æœ‰ç”¨çš„å‘½ä»¤ã€‚ä¸‹é¢æ˜¯ç¬¬äºŒè®²çš„å°ç»“äº†ã€‚<br><br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs code">       ç¬¬äºŒè®²å°ç»“<br><br><br>1. æ¬²ä»å½“å‰å…‰æ ‡åˆ é™¤è‡³ä¸‹ä¸€ä¸ªå•è¯ï¼Œè¯·è¾“å…¥ï¼šdw<br>2. æ¬²ä»å½“å‰å…‰æ ‡åˆ é™¤è‡³å½“å‰è¡Œæœ«å°¾ï¼Œè¯·è¾“å…¥ï¼šd$<br>3. æ¬²åˆ é™¤æ•´è¡Œï¼Œè¯·è¾“å…¥ï¼šdd<br><br>4. æ¬²é‡å¤ä¸€ä¸ªåŠ¨ä½œï¼Œè¯·åœ¨å®ƒå‰é¢åŠ ä¸Šä¸€ä¸ªæ•°å­—ï¼š2w<br>5. åœ¨æ­£å¸¸æ¨¡å¼ä¸‹ä¿®æ”¹å‘½ä»¤çš„æ ¼å¼æ˜¯ï¼š<br>             operator   [number]   motion<br>   å…¶ä¸­ï¼š<br>     operator - æ“ä½œç¬¦ï¼Œä»£è¡¨è¦åšçš„äº‹æƒ…ï¼Œæ¯”å¦‚ d ä»£è¡¨åˆ é™¤<br>     [number] - å¯ä»¥é™„åŠ çš„æ•°å­—ï¼Œä»£è¡¨åŠ¨ä½œé‡å¤çš„æ¬¡æ•°<br>     motion   - åŠ¨ä½œï¼Œä»£è¡¨åœ¨æ‰€æ“ä½œçš„æ–‡æœ¬ä¸Šçš„ç§»åŠ¨ï¼Œä¾‹å¦‚ w ä»£è¡¨å•è¯(word)ï¼Œ<br>  $ ä»£è¡¨è¡Œæœ«ç­‰ç­‰ã€‚<br><br>6. æ¬²ç§»åŠ¨å…‰æ ‡åˆ°è¡Œé¦–ï¼Œè¯·æŒ‰æ•°å­—0é”®ï¼š0<br><br>7. æ¬²æ’¤æ¶ˆä»¥å‰çš„æ“ä½œï¼Œè¯·è¾“å…¥ï¼šu (å°å†™çš„u)<br>   æ¬²æ’¤æ¶ˆåœ¨ä¸€è¡Œä¸­æ‰€åšçš„æ”¹åŠ¨ï¼Œè¯·è¾“å…¥ï¼šU (å¤§å†™çš„U)<br>   æ¬²æ’¤æ¶ˆä»¥å‰çš„æ’¤æ¶ˆå‘½ä»¤ï¼Œæ¢å¤ä»¥å‰çš„æ“ä½œç»“æœï¼Œè¯·è¾“å…¥ï¼šCTRL-R<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs code">   ç¬¬ä¸‰è®²ç¬¬ä¸€èŠ‚ï¼šç½®å…¥ç±»å‘½ä»¤<br><br><br>** è¾“å…¥ p å°†æœ€åä¸€æ¬¡åˆ é™¤çš„å†…å®¹ç½®å…¥å…‰æ ‡ä¹‹åã€‚ **<br><br>  1. è¯·å°†å…‰æ ‡ç§»åŠ¨åˆ°æœ¬èŠ‚ä¸­ä¸‹é¢ç¬¬ä¸€ä¸ªæ ‡è®°æœ‰ ---&gt; çš„ä¸€è¡Œã€‚<br><br>  2. è¾“å…¥ dd å°†è¯¥è¡Œåˆ é™¤ï¼Œè¿™æ ·ä¼šå°†è¯¥è¡Œä¿å­˜åˆ° Vim çš„ä¸€ä¸ªå¯„å­˜å™¨ä¸­ã€‚<br><br>  3. æ¥ç€å°†å…‰æ ‡ç§»åŠ¨åˆ° c) ä¸€è¡Œï¼Œå³å‡†å¤‡ç½®å…¥çš„ä½ç½®çš„ä¸Šæ–¹ã€‚è®°ä½ï¼šæ˜¯ä¸Šæ–¹å“¦ã€‚<br><br>  4. ç„¶ååœ¨æ­£å¸¸æ¨¡å¼ä¸‹(&lt;ESC&gt;é”®è¿›å…¥)è¾“å…¥ p å°†è¯¥è¡Œç²˜è´´ç½®å…¥ã€‚<br><br>  5. é‡å¤æ­¥éª¤2è‡³æ­¥éª¤4ï¼Œå°†æ‰€æœ‰çš„è¡Œä¾åºæ”¾ç½®åˆ°æ­£ç¡®çš„ä½ç½®ä¸Šã€‚<br><br>---&gt; d) Can you learn too?<br>---&gt; b) Violets are blue,<br>---&gt; c) Intelligence is learned,<br>---&gt; a) Roses are red,<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs code">   ç¬¬ä¸‰è®²ç¬¬äºŒèŠ‚ï¼šæ›¿æ¢ç±»å‘½ä»¤<br><br><br>  ** è¾“å…¥ r å’Œä¸€ä¸ªå­—ç¬¦æ›¿æ¢å…‰æ ‡æ‰€åœ¨ä½ç½®çš„å­—ç¬¦ã€‚**<br><br>  1. è¯·å°†å…‰æ ‡ç§»åŠ¨åˆ°æœ¬èŠ‚ä¸­ä¸‹é¢æ ‡è®°æœ‰ ---&gt; çš„ç¬¬ä¸€è¡Œã€‚<br><br>  2. è¯·ç§»åŠ¨å…‰æ ‡åˆ°ç¬¬ä¸€ä¸ªå‡ºé”™çš„ä½ç½®ã€‚<br><br>  3. æ¥ç€è¾“å…¥ r å’Œè¦æ›¿æ¢æˆçš„å­—ç¬¦ï¼Œè¿™æ ·å°±èƒ½å°†é”™è¯¯æ›¿æ¢æ‰äº†ã€‚<br><br>  4. é‡å¤æ­¥éª¤2å’Œæ­¥éª¤3ï¼Œç›´åˆ°ç¬¬ä¸€è¡Œå·²ç»ä¿®æ”¹å®Œæ¯•ã€‚<br><br>---&gt;  Whan this lime was tuoed in, someone presswd some wrojg keys!<br>---&gt;  When this line was typed in, someone pressed some wrong keys!<br><br>  5. ç„¶åæˆ‘ä»¬ç»§ç»­å­¦ä¹ ç¬¬ä¸‰è®²ç¬¬ä¸‰èŠ‚ã€‚<br><br>ç‰¹åˆ«æç¤ºï¼šåˆ‡è®°æ‚¨è¦åœ¨ä½¿ç”¨ä¸­å­¦ä¹ ï¼Œè€Œä¸æ˜¯åœ¨è®°å¿†ä¸­å­¦ä¹ ã€‚<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs code">ç¬¬ä¸‰è®²ç¬¬ä¸‰èŠ‚ï¼šæ›´æ”¹ç±»å‘½ä»¤<br><br><br> ** è¦æ”¹å˜æ–‡æœ¬ç›´åˆ°ä¸€ä¸ªå•è¯çš„æœ«å°¾ï¼Œè¯·è¾“å…¥ ce **<br><br>  1. è¯·å°†å…‰æ ‡ç§»åŠ¨åˆ°æœ¬èŠ‚ä¸­ä¸‹é¢æ ‡è®°æœ‰ ---&gt; çš„ç¬¬ä¸€è¡Œã€‚<br><br>  2. æ¥ç€æŠŠå…‰æ ‡æ”¾åœ¨å•è¯ lubw çš„å­—æ¯ u çš„ä½ç½®é‚£é‡Œã€‚<br><br>  3. ç„¶åè¾“å…¥ cw ä»¥åŠæ­£ç¡®çš„å•è¯(åœ¨æœ¬ä¾‹ä¸­æ˜¯è¾“å…¥ ine )ã€‚<br><br>  4. æœ€åæŒ‰ &lt;ESC&gt; é”®ï¼Œç„¶åå…‰æ ‡å®šä½åˆ°ä¸‹ä¸€ä¸ªé”™è¯¯ç¬¬ä¸€ä¸ªå‡†å¤‡æ›´æ”¹çš„å­—æ¯å¤„ã€‚<br><br>  5. é‡å¤æ­¥éª¤3å’Œæ­¥éª¤4ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªå¥å­å®Œå…¨é›·åŒç¬¬äºŒä¸ªå¥å­ã€‚<br><br>---&gt; This lubw has a few wptfd that mrrf changing usf the change operator.<br>---&gt; This line has a few words that need changing using the change operator.<br><br>æç¤ºï¼šè¯·æ³¨æ„ ce å‘½ä»¤ä¸ä»…ä»…æ˜¯åˆ é™¤äº†ä¸€ä¸ªå•è¯ï¼Œå®ƒä¹Ÿè®©æ‚¨è¿›å…¥æ’å…¥æ¨¡å¼äº†ã€‚<br><br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs code">       ç¬¬ä¸‰è®²ç¬¬å››èŠ‚ï¼šä½¿ç”¨cæ›´æ”¹æ›´å¤š<br><br><br>   ** æ›´æ”¹ç±»æ“ä½œç¬¦å¯ä»¥ä¸åˆ é™¤ä¸­ä½¿ç”¨çš„åŒæ ·çš„åŠ¨ä½œé…åˆä½¿ç”¨ã€‚ **<br><br>  1. æ›´æ”¹ç±»æ“ä½œç¬¦çš„å·¥ä½œæ–¹å¼è·Ÿåˆ é™¤ç±»æ˜¯ä¸€è‡´çš„ã€‚æ“ä½œæ ¼å¼æ˜¯ï¼š<br><br>         c    [number]   motion<br><br>  2. åŠ¨ä½œå‚æ•°(motion)ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæ¯”å¦‚ w ä»£è¡¨å•è¯ï¼Œ$ä»£è¡¨è¡Œæœ«ç­‰ç­‰ã€‚<br><br>  3. è¯·å°†å…‰æ ‡ç§»åŠ¨åˆ°æœ¬èŠ‚ä¸­ä¸‹é¢æ ‡è®°æœ‰ ---&gt; çš„ç¬¬ä¸€è¡Œã€‚<br><br>  4. æ¥ç€å°†å…‰æ ‡ç§»åŠ¨åˆ°ç¬¬ä¸€ä¸ªé”™è¯¯å¤„ã€‚<br><br>  5. ç„¶åè¾“å…¥ c$ ä½¿å¾—è¯¥è¡Œå‰©ä¸‹çš„éƒ¨åˆ†æ›´æ­£å¾—åŒç¬¬äºŒè¡Œä¸€æ ·ã€‚æœ€åæŒ‰ &lt;ESC&gt; é”®ã€‚<br><br>---&gt; The end of this line needs some help to make it like the second.<br>---&gt; The end of this line needs to be corrected using the  c$  command.<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs code">  ç¬¬ä¸‰è®²å°ç»“<br><br><br>  1. è¦é‡æ–°ç½®å…¥å·²ç»åˆ é™¤çš„æ–‡æœ¬å†…å®¹ï¼Œè¯·æŒ‰å°å†™å­—æ¯ p é”®ã€‚è¯¥æ“ä½œå¯ä»¥å°†å·²åˆ é™¤<br>     çš„æ–‡æœ¬å†…å®¹ç½®äºå…‰æ ‡ä¹‹åã€‚å¦‚æœæœ€åä¸€æ¬¡åˆ é™¤çš„æ˜¯ä¸€ä¸ªæ•´è¡Œï¼Œé‚£ä¹ˆè¯¥è¡Œå°†ç½®<br>     äºå½“å‰å…‰æ ‡æ‰€åœ¨è¡Œçš„ä¸‹ä¸€è¡Œã€‚<br><br>  2. è¦æ›¿æ¢å…‰æ ‡æ‰€åœ¨ä½ç½®çš„å­—ç¬¦ï¼Œè¯·è¾“å…¥å°å†™çš„ r å’Œè¦æ›¿æ¢æ‰åŸä½ç½®å­—ç¬¦çš„æ–°å­—<br>     ç¬¦å³å¯ã€‚<br><br>  3. æ›´æ”¹ç±»å‘½ä»¤å…è®¸æ‚¨æ”¹å˜ä»å½“å‰å…‰æ ‡æ‰€åœ¨ä½ç½®ç›´åˆ°åŠ¨ä½œæŒ‡ç¤ºçš„ä½ç½®ä¸­é—´çš„æ–‡æœ¬ã€‚<br>     æ¯”å¦‚è¾“å…¥ ce å¯ä»¥æ›¿æ¢å½“å‰å…‰æ ‡åˆ°å•è¯çš„æœ«å°¾çš„å†…å®¹ï¼›è¾“å…¥ c$ å¯ä»¥æ›¿æ¢å½“<br>     å‰å…‰æ ‡åˆ°è¡Œæœ«çš„å†…å®¹ã€‚<br><br>  4. æ›´æ”¹ç±»å‘½ä»¤çš„æ ¼å¼æ˜¯ï¼š<br><br> c   [number]   motion<br><br>ç°åœ¨æˆ‘ä»¬ç»§ç»­å­¦ä¹ ä¸‹ä¸€è®²ã€‚<br><br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs code">     ç¬¬å››è®²ç¬¬ä¸€èŠ‚ï¼šå®šä½åŠæ–‡ä»¶çŠ¶æ€<br><br>  ** è¾“å…¥ CTRL-G æ˜¾ç¤ºå½“å‰ç¼–è¾‘æ–‡ä»¶ä¸­å½“å‰å…‰æ ‡æ‰€åœ¨è¡Œä½ç½®ä»¥åŠæ–‡ä»¶çŠ¶æ€ä¿¡æ¯ã€‚<br>     è¾“å…¥å¤§å†™ G åˆ™ç›´æ¥è·³è½¬åˆ°æ–‡ä»¶ä¸­çš„æŸä¸€æŒ‡å®šè¡Œã€‚**<br><br>  æç¤ºï¼šåˆ‡è®°è¦å…ˆé€šè¯»æœ¬èŠ‚å†…å®¹ï¼Œä¹‹åæ‰å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ­¥éª¤!!!<br><br>  1. æŒ‰ä¸‹ CTRL é”®ä¸æ”¾å¼€ç„¶åæŒ‰ g é”®ã€‚æˆ‘ä»¬ç§°è¿™ä¸ªé”®ç»„åˆä¸º CTRL-Gã€‚<br>     æ‚¨ä¼šçœ‹åˆ°é¡µé¢æœ€åº•éƒ¨å‡ºç°ä¸€ä¸ªçŠ¶æ€ä¿¡æ¯è¡Œï¼Œæ˜¾ç¤ºçš„å†…å®¹æ˜¯å½“å‰ç¼–è¾‘çš„æ–‡ä»¶å<br>     å’Œæ–‡ä»¶ä¸­å…‰æ ‡ä½ç½®ã€‚è¯·è®°ä½è¡Œå·ï¼Œå®ƒä¼šåœ¨æ­¥éª¤3ä¸­ç”¨åˆ°ã€‚<br><br>æç¤ºï¼šæ‚¨ä¹Ÿè®¸ä¼šåœ¨å±å¹•çš„å³ä¸‹è§’çœ‹åˆ°å…‰æ ‡ä½ç½®ï¼Œè¿™ä¼šåœ¨ &#x27;ruler&#x27; é€‰é¡¹è®¾ç½®æ—¶å‘ç”Ÿ<br>      (å‚è§ :help &#x27;ruler&#x27;)<br><br>  2. è¾“å…¥å¤§å†™ G å¯ä»¥ä½¿å¾—å½“å‰å…‰æ ‡ç›´æ¥è·³è½¬åˆ°æ–‡ä»¶æœ€åä¸€è¡Œã€‚<br>     è¾“å…¥ gg å¯ä»¥ä½¿å¾—å½“å‰å…‰æ ‡ç›´æ¥è·³è½¬åˆ°æ–‡ä»¶ç¬¬ä¸€è¡Œã€‚<br><br>  3. è¾“å…¥æ‚¨æ›¾åœç•™çš„è¡Œå·ï¼Œç„¶åè¾“å…¥å¤§å†™ Gã€‚è¿™æ ·å°±å¯ä»¥è¿”å›åˆ°æ‚¨ç¬¬ä¸€æ¬¡æŒ‰ä¸‹<br>     CTRL-G æ—¶æ‰€åœ¨çš„è¡Œäº†ã€‚<br><br>  4. å¦‚æœæ‚¨è§‰å¾—æ²¡é—®é¢˜çš„è¯ï¼Œè¯·æ‰§è¡Œæ­¥éª¤1è‡³æ­¥éª¤3çš„æ“ä½œè¿›è¡Œç»ƒä¹ ã€‚<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs code">ç¬¬å››è®²ç¬¬äºŒèŠ‚ï¼šæœç´¢ç±»å‘½ä»¤<br><br><br>     ** è¾“å…¥ / åŠ ä¸Šä¸€ä¸ªå­—ç¬¦ä¸²å¯ä»¥ç”¨ä»¥åœ¨å½“å‰æ–‡ä»¶ä¸­æŸ¥æ‰¾è¯¥å­—ç¬¦ä¸²ã€‚**<br><br>  1. åœ¨æ­£å¸¸æ¨¡å¼ä¸‹è¾“å…¥ / å­—ç¬¦ã€‚æ‚¨æ­¤æ—¶ä¼šæ³¨æ„åˆ°è¯¥å­—ç¬¦å’Œå…‰æ ‡éƒ½ä¼šå‡ºç°åœ¨å±å¹•åº•<br>     éƒ¨ï¼Œè¿™è·Ÿ : å‘½ä»¤æ˜¯ä¸€æ ·çš„ã€‚<br><br>  2. æ¥ç€è¾“å…¥ errroor &lt;å›è½¦&gt;ã€‚é‚£ä¸ªerrroorå°±æ˜¯æ‚¨è¦æŸ¥æ‰¾çš„å­—ç¬¦ä¸²ã€‚<br><br>  3. è¦æŸ¥æ‰¾åŒä¸Šä¸€æ¬¡çš„å­—ç¬¦ä¸²ï¼Œåªéœ€è¦æŒ‰ n é”®ã€‚è¦å‘ç›¸åæ–¹å‘æŸ¥æ‰¾åŒä¸Šä¸€æ¬¡çš„å­—<br>     ç¬¦ä¸²ï¼Œè¯·è¾“å…¥å¤§å†™ N å³å¯ã€‚<br><br>  4. å¦‚æœæ‚¨æƒ³é€†å‘æŸ¥æ‰¾å­—ç¬¦ä¸²ï¼Œè¯·ä½¿ç”¨ ? ä»£æ›¿ / è¿›è¡Œã€‚<br><br>  5. è¦å›åˆ°æ‚¨ä¹‹å‰çš„ä½ç½®æŒ‰ CTRL-O (æŒ‰ä½ Ctrl é”®ä¸æ”¾åŒæ—¶æŒ‰ä¸‹å­—æ¯ o)ã€‚é‡å¤æŒ‰å¯ä»¥<br>     å›é€€æ›´å¤šæ­¥ã€‚CTRL-I ä¼šè·³è½¬åˆ°è¾ƒæ–°çš„ä½ç½®ã€‚<br><br>---&gt;  &quot;errroor&quot; is not the way to spell error;  errroor is an error.<br>æç¤ºï¼šå¦‚æœæŸ¥æ‰¾å·²ç»åˆ°è¾¾æ–‡ä»¶æœ«å°¾ï¼ŒæŸ¥æ‰¾ä¼šè‡ªåŠ¨ä»æ–‡ä»¶å¤´éƒ¨ç»§ç»­æŸ¥æ‰¾ï¼Œé™¤é<br>      &#x27;wrapscan&#x27; é€‰é¡¹è¢«å¤ä½ã€‚<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs code"><br>   ç¬¬å››è®²ç¬¬ä¸‰èŠ‚ï¼šé…å¯¹æ‹¬å·çš„æŸ¥æ‰¾<br><br><br>      ** è¾“å…¥ % å¯ä»¥æŸ¥æ‰¾é…å¯¹çš„æ‹¬å· )ã€]ã€&#125;ã€‚**<br><br>  1. æŠŠå…‰æ ‡æ”¾åœ¨æœ¬èŠ‚ä¸‹é¢æ ‡è®°æœ‰ --&gt; é‚£ä¸€è¡Œä¸­çš„ä»»ä½•ä¸€ä¸ª (ã€[ æˆ– &#123; å¤„ã€‚<br><br>  2. æ¥ç€æŒ‰ % å­—ç¬¦ã€‚<br><br>  3. æ­¤æ—¶å…‰æ ‡çš„ä½ç½®åº”å½“æ˜¯åœ¨é…å¯¹çš„æ‹¬å·å¤„ã€‚<br><br>  4. å†æ¬¡æŒ‰ % å°±å¯ä»¥è·³å›é…å¯¹çš„ç¬¬ä¸€ä¸ªæ‹¬å·å¤„ã€‚<br><br>  5. ç§»åŠ¨å…‰æ ‡åˆ°å¦ä¸€ä¸ª (ã€)ã€[ã€]ã€&#123; æˆ– &#125; å¤„ï¼ŒæŒ‰ % æŸ¥çœ‹å…¶æ‰€ä½œæ‰€ä¸ºã€‚<br><br>---&gt; This ( is a test line with (&#x27;s, [&#x27;s ] and &#123;&#x27;s &#125; in it. ))<br><br><br>æç¤ºï¼šåœ¨ç¨‹åºè°ƒè¯•æ—¶ï¼Œè¿™ä¸ªåŠŸèƒ½ç”¨æ¥æŸ¥æ‰¾ä¸é…å¯¹çš„æ‹¬å·æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs code">      ç¬¬å››è®²ç¬¬å››èŠ‚ï¼šæ›¿æ¢å‘½ä»¤<br><br><br>** è¾“å…¥ :s/old/new/g å¯ä»¥æ›¿æ¢ old ä¸º newã€‚**<br><br>  1. è¯·å°†å…‰æ ‡ç§»åŠ¨åˆ°æœ¬èŠ‚ä¸­ä¸‹é¢æ ‡è®°æœ‰ ---&gt; çš„é‚£ä¸€è¡Œã€‚<br><br>  2. è¾“å…¥ :s/thee/the &lt;å›è½¦&gt; ã€‚è¯·æ³¨æ„è¯¥å‘½ä»¤åªæ”¹å˜å…‰æ ‡æ‰€åœ¨è¡Œçš„ç¬¬ä¸€ä¸ªåŒ¹é…<br>     ä¸²ã€‚<br><br>  3. è¾“å…¥ :s/thee/the/gåˆ™æ˜¯æ›¿æ¢å…¨è¡Œçš„åŒ¹é…ä¸²ï¼Œè¯¥è¡Œä¸­æ‰€æœ‰çš„ &quot;thee&quot; éƒ½ä¼šè¢«<br>     æ”¹å˜ã€‚<br><br>---&gt; thee best time to see thee flowers is in thee spring.<br><br>  4. è¦æ›¿æ¢ä¸¤è¡Œä¹‹é—´å‡ºç°çš„æ¯ä¸ªåŒ¹é…ä¸²ï¼Œè¯·<br>     è¾“å…¥   :#,#s/old/new/g   å…¶ä¸­ #,# ä»£è¡¨çš„æ˜¯æ›¿æ¢æ“ä½œçš„è‹¥å¹²è¡Œä¸­<br>                              é¦–å°¾ä¸¤è¡Œçš„è¡Œå·ã€‚<br>     è¾“å…¥   :%s/old/new/g     åˆ™æ˜¯æ›¿æ¢æ•´ä¸ªæ–‡ä»¶ä¸­çš„æ¯ä¸ªåŒ¹é…ä¸²ã€‚<br>     è¾“å…¥   :%s/old/new/gc    ä¼šæ‰¾åˆ°æ•´ä¸ªæ–‡ä»¶ä¸­çš„æ¯ä¸ªåŒ¹é…ä¸²ï¼Œå¹¶ä¸”å¯¹æ¯ä¸ªåŒ¹é…ä¸²<br>                              æç¤ºæ˜¯å¦è¿›è¡Œæ›¿æ¢ã€‚<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs code">       ç¬¬å››è®²å°ç»“<br><br><br>1. CTRL-G ç”¨äºæ˜¾ç¤ºå½“å‰å…‰æ ‡æ‰€åœ¨ä½ç½®å’Œæ–‡ä»¶çŠ¶æ€ä¿¡æ¯ã€‚<br>   G ç”¨äºå°†å…‰æ ‡è·³è½¬è‡³æ–‡ä»¶æœ€åä¸€è¡Œã€‚<br>   å…ˆæ•²å…¥ä¸€ä¸ªè¡Œå·ç„¶åè¾“å…¥å¤§å†™ G åˆ™æ˜¯å°†å…‰æ ‡ç§»åŠ¨è‡³è¯¥è¡Œå·ä»£è¡¨çš„è¡Œã€‚<br>   gg ç”¨äºå°†å…‰æ ‡è·³è½¬è‡³æ–‡ä»¶ç¬¬ä¸€è¡Œã€‚<br><br>2. è¾“å…¥ / ç„¶åç´§éšä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯åœ¨å½“å‰æ‰€ç¼–è¾‘çš„æ–‡æ¡£ä¸­æ­£å‘æŸ¥æ‰¾è¯¥å­—ç¬¦ä¸²ã€‚<br>   è¾“å…¥ ? ç„¶åç´§éšä¸€ä¸ªå­—ç¬¦ä¸²åˆ™æ˜¯åœ¨å½“å‰æ‰€ç¼–è¾‘çš„æ–‡æ¡£ä¸­åå‘æŸ¥æ‰¾è¯¥å­—ç¬¦ä¸²ã€‚<br>   å®Œæˆä¸€æ¬¡æŸ¥æ‰¾ä¹‹åæŒ‰ n é”®æ˜¯é‡å¤ä¸Šä¸€æ¬¡çš„å‘½ä»¤ï¼Œå¯åœ¨åŒä¸€æ–¹å‘ä¸ŠæŸ¥<br>   æ‰¾ä¸‹ä¸€ä¸ªåŒ¹é…å­—ç¬¦ä¸²æ‰€åœ¨ï¼›æˆ–è€…æŒ‰å¤§å†™ N å‘ç›¸åæ–¹å‘æŸ¥æ‰¾ä¸‹ä¸€åŒ¹é…å­—ç¬¦ä¸²æ‰€åœ¨ã€‚<br>   CTRL-O å¸¦æ‚¨è·³è½¬å›è¾ƒæ—§çš„ä½ç½®ï¼ŒCTRL-I åˆ™å¸¦æ‚¨åˆ°è¾ƒæ–°çš„ä½ç½®ã€‚<br><br>3. å¦‚æœå…‰æ ‡å½“å‰ä½ç½®æ˜¯æ‹¬å·(ã€)ã€[ã€]ã€&#123;ã€&#125;ï¼ŒæŒ‰ % ä¼šå°†å…‰æ ‡ç§»åŠ¨åˆ°é…å¯¹çš„æ‹¬å·ä¸Šã€‚<br><br>4. åœ¨ä¸€è¡Œå†…æ›¿æ¢å¤´ä¸€ä¸ªå­—ç¬¦ä¸² old ä¸ºæ–°çš„å­—ç¬¦ä¸² newï¼Œè¯·è¾“å…¥  :s/old/new<br>   åœ¨ä¸€è¡Œå†…æ›¿æ¢æ‰€æœ‰çš„å­—ç¬¦ä¸² old ä¸ºæ–°çš„å­—ç¬¦ä¸² newï¼Œè¯·è¾“å…¥  :s/old/new/g<br>   åœ¨ä¸¤è¡Œå†…æ›¿æ¢æ‰€æœ‰çš„å­—ç¬¦ä¸² old ä¸ºæ–°çš„å­—ç¬¦ä¸² newï¼Œè¯·è¾“å…¥  :#,#s/old/new/g<br>   åœ¨æ–‡ä»¶å†…æ›¿æ¢æ‰€æœ‰çš„å­—ç¬¦ä¸² old ä¸ºæ–°çš„å­—ç¬¦ä¸² newï¼Œè¯·è¾“å…¥  :%s/old/new/g<br>   è¿›è¡Œå…¨æ–‡æ›¿æ¢æ—¶è¯¢é—®ç”¨æˆ·ç¡®è®¤æ¯ä¸ªæ›¿æ¢éœ€æ·»åŠ  c æ ‡å¿—        :%s/old/new/gc<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs code">ç¬¬äº”è®²ç¬¬ä¸€èŠ‚ï¼šåœ¨ VIM å†…æ‰§è¡Œå¤–éƒ¨å‘½ä»¤çš„æ–¹æ³•<br><br><br>   ** è¾“å…¥ :! ç„¶åç´§æ¥ç€è¾“å…¥ä¸€ä¸ªå¤–éƒ¨å‘½ä»¤å¯ä»¥æ‰§è¡Œè¯¥å¤–éƒ¨å‘½ä»¤ã€‚**<br><br>  1. æŒ‰ä¸‹æˆ‘ä»¬æ‰€ç†Ÿæ‚‰çš„ : å‘½ä»¤ä½¿å…‰æ ‡ç§»åŠ¨åˆ°å±å¹•åº•éƒ¨ã€‚è¿™æ ·æ‚¨å°±å¯ä»¥è¾“å…¥ä¸€è¡Œå‘½ä»¤äº†ã€‚<br><br>  2. æ¥ç€è¾“å…¥æ„Ÿå¹å· ! è¿™ä¸ªå­—ç¬¦ï¼Œè¿™æ ·å°±å…è®¸æ‚¨æ‰§è¡Œå¤–éƒ¨çš„ shell å‘½ä»¤äº†ã€‚<br><br>  3. æˆ‘ä»¬ä»¥ ls å‘½ä»¤ä¸ºä¾‹ã€‚è¾“å…¥ !ls &lt;å›è½¦&gt; ã€‚è¯¥å‘½ä»¤å°±ä¼šåˆ—ä¸¾å‡ºæ‚¨å½“å‰ç›®å½•çš„<br>     å†…å®¹ï¼Œå°±å¦‚åŒæ‚¨åœ¨å‘½ä»¤è¡Œæç¤ºç¬¦ä¸‹è¾“å…¥ ls å‘½ä»¤çš„ç»“æœä¸€æ ·ã€‚å¦‚æœ !ls æ²¡èµ·<br>     ä½œç”¨ï¼Œæ‚¨å¯ä»¥è¯•è¯• :!dir çœ‹çœ‹ã€‚<br><br>æç¤ºï¼šæ‰€æœ‰çš„å¤–éƒ¨å‘½ä»¤éƒ½å¯ä»¥ä»¥è¿™ç§æ–¹å¼æ‰§è¡Œï¼ŒåŒ…æ‹¬å¸¦å‘½ä»¤è¡Œå‚æ•°çš„é‚£äº›ã€‚<br><br>æç¤ºï¼šæ‰€æœ‰çš„ : å‘½ä»¤éƒ½å¿…é¡»ä»¥æ•² &lt;å›è½¦&gt; é”®ç»“æŸã€‚ä»ä»Šä»¥åæˆ‘ä»¬å°±ä¸ä¼šæ€»æ˜¯æåˆ°è¿™ä¸€ç‚¹<br>      äº†ã€‚<br><br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs code">      ç¬¬äº”è®²ç¬¬äºŒèŠ‚ï¼šå…³äºä¿å­˜æ–‡ä»¶çš„æ›´å¤šä¿¡æ¯<br><br><br>     ** è¦å°†å¯¹æ–‡ä»¶çš„æ”¹åŠ¨ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œè¯·è¾“å…¥ :w FILENAME ã€‚**<br><br>  1. è¾“å…¥ :!dir æˆ–è€… :!ls è·çŸ¥å½“å‰ç›®å½•çš„å†…å®¹ã€‚æ‚¨åº”å½“å·²çŸ¥é“æœ€åè¿˜å¾—æ•²<br>     &lt;å›è½¦&gt; å§ã€‚<br><br>  2. é€‰æ‹©ä¸€ä¸ªæœªè¢«ç”¨åˆ°çš„æ–‡ä»¶åï¼Œæ¯”å¦‚ TESTã€‚<br><br>  3. æ¥ç€è¾“å…¥ :w TEST  (æ­¤å¤„ TEST æ˜¯æ‚¨æ‰€é€‰æ‹©çš„æ–‡ä»¶åã€‚)<br><br>  4. è¯¥å‘½ä»¤ä¼šä»¥ TEST ä¸ºæ–‡ä»¶åä¿å­˜æ•´ä¸ªæ–‡ä»¶ (Vim æ•™ç¨‹)ã€‚ä¸ºäº†éªŒè¯è¿™ä¸€ç‚¹ï¼Œ<br>     è¯·å†æ¬¡è¾“å…¥ :!dir æˆ– :!ls æŸ¥çœ‹æ‚¨çš„ç›®å½•åˆ—è¡¨å†…å®¹ã€‚<br><br>è¯·æ³¨æ„ï¼šå¦‚æœæ‚¨é€€å‡º Vim ç„¶ååœ¨ä»¥å‘½ä»¤ vim TEST å†æ¬¡å¯åŠ¨ Vimï¼Œé‚£ä¹ˆè¯¥æ–‡ä»¶å†…<br>     å®¹åº”è¯¥åŒæ‚¨ä¿å­˜æ—¶çš„æ–‡ä»¶å†…å®¹æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚<br><br>  5. ç°åœ¨æ‚¨å¯ä»¥åˆ é™¤ TEST æ–‡ä»¶äº†ã€‚åœ¨ MS-DOS ä¸‹ï¼Œè¯·è¾“å…¥ï¼š   :!del TEST<br>                                 åœ¨ Unix ä¸‹ï¼Œè¯·è¾“å…¥ï¼š     :!rm TEST<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs code">    ç¬¬äº”è®²ç¬¬ä¸‰èŠ‚ï¼šä¸€ä¸ªå…·æœ‰é€‰æ‹©æ€§çš„ä¿å­˜å‘½ä»¤<br><br><br>    ** è¦ä¿å­˜æ–‡ä»¶çš„éƒ¨åˆ†å†…å®¹ï¼Œè¯·è¾“å…¥ v motion :w FILENAME **<br><br>  1. ç§»åŠ¨å…‰æ ‡åˆ°æœ¬è¡Œã€‚<br><br>  2. æ¥ç€æŒ‰ v é”®ï¼Œå°†å…‰æ ‡ç§»åŠ¨è‡³ä¸‹é¢ç¬¬äº”ä¸ªæ¡ç›®ä¸Šã€‚æ‚¨ä¼šæ³¨æ„åˆ°ä¹‹é—´çš„æ–‡æœ¬è¢«é«˜äº®äº†ã€‚<br><br>  3. ç„¶åæŒ‰ : å­—ç¬¦ã€‚æ‚¨å°†çœ‹åˆ°å±å¹•åº•éƒ¨ä¼šå‡ºç° :&#x27;&lt;,&#x27;&gt; ã€‚<br><br>  4. ç°åœ¨è¯·è¾“å…¥ w TESTï¼Œå…¶ä¸­ TEST æ˜¯ä¸€ä¸ªæœªè¢«ä½¿ç”¨çš„æ–‡ä»¶åã€‚ç¡®è®¤æ‚¨çœ‹åˆ°äº†<br>     :&#x27;&lt;,&#x27;&gt;w TEST ä¹‹åæŒ‰ &lt;å›è½¦&gt; é”®ã€‚<br><br>  5. è¿™æ—¶ Vim ä¼šæŠŠé€‰ä¸­çš„è¡Œå†™å…¥åˆ°ä»¥ TEST å‘½åçš„æ–‡ä»¶ä¸­å»ã€‚ä½¿ç”¨ :!dir æˆ– :!ls<br>     ç¡®è®¤æ–‡ä»¶è¢«æ­£ç¡®ä¿å­˜ã€‚è¿™æ¬¡å…ˆåˆ«åˆ é™¤å®ƒï¼æˆ‘ä»¬åœ¨ä¸‹ä¸€è®²ä¸­ä¼šç”¨åˆ°å®ƒã€‚<br><br>æç¤ºï¼šæŒ‰ v é”®ä½¿ Vim è¿›å…¥å¯è§†æ¨¡å¼è¿›è¡Œé€‰å–ã€‚æ‚¨å¯ä»¥å››å¤„ç§»åŠ¨å…‰æ ‡ä½¿é€‰å–åŒºåŸŸå˜å¤§æˆ–<br>      å˜å°ã€‚æ¥ç€æ‚¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ“ä½œç¬¦å¯¹é€‰ä¸­æ–‡æœ¬è¿›è¡Œæ“ä½œã€‚ä¾‹å¦‚ï¼ŒæŒ‰ d é”®ä¼šåˆ é™¤<br>      é€‰ä¸­çš„æ–‡æœ¬å†…å®¹ã€‚<br><br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs code">   ç¬¬äº”è®²ç¬¬å››èŠ‚ï¼šæå–å’Œåˆå¹¶æ–‡ä»¶<br><br><br>       ** è¦å‘å½“å‰æ–‡ä»¶ä¸­æ’å…¥å¦å¤–çš„æ–‡ä»¶çš„å†…å®¹ï¼Œè¯·è¾“å…¥ :r FILENAME **<br><br>  1. è¯·æŠŠå…‰æ ‡ç§»åŠ¨åˆ°æœ¬è¡Œä¸Šé¢ä¸€è¡Œã€‚<br><br>ç‰¹åˆ«æç¤ºï¼šæ‰§è¡Œæ­¥éª¤2ä¹‹åæ‚¨å°†çœ‹åˆ°ç¬¬äº”è®²ç¬¬ä¸‰èŠ‚çš„æ–‡å­—ï¼Œè¯·å±Šæ—¶å¾€ä¸‹ç§»åŠ¨<br>          ä»¥å†æ¬¡çœ‹åˆ°æœ¬è®²å†…å®¹ã€‚<br><br>  2. æ¥ç€é€šè¿‡å‘½ä»¤ :r TEST å°†å‰é¢åˆ›å»ºçš„åä¸º TEST çš„æ–‡ä»¶æå–è¿›æ¥ã€‚<br>     æ‚¨æ‰€æå–è¿›æ¥çš„æ–‡ä»¶å°†ä»å…‰æ ‡æ‰€åœ¨ä½ç½®å¤„å¼€å§‹ç½®å…¥ã€‚<br><br>  3. ä¸ºäº†ç¡®è®¤æ–‡ä»¶å·²ç»æå–æˆåŠŸï¼Œç§»åŠ¨å…‰æ ‡å›åˆ°åŸæ¥çš„ä½ç½®å°±å¯ä»¥æ³¨æ„æœ‰ä¸¤ä»½ç¬¬<br>     äº”è®²ç¬¬ä¸‰èŠ‚çš„å†…å®¹ï¼Œä¸€ä»½æ˜¯åŸå§‹å†…å®¹ï¼Œå¦å¤–ä¸€ä»½æ˜¯æ¥è‡ªæ–‡ä»¶çš„å‰¯æœ¬ã€‚<br><br>æç¤ºï¼šæ‚¨è¿˜å¯ä»¥è¯»å–å¤–éƒ¨å‘½ä»¤çš„è¾“å‡ºã€‚ä¾‹å¦‚ï¼Œ :r !ls å¯ä»¥è¯»å– ls å‘½ä»¤çš„è¾“å‡ºï¼Œå¹¶<br>      æŠŠå®ƒæ”¾ç½®åœ¨å…‰æ ‡ä¸‹é¢ã€‚<br><br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs code">       ç¬¬äº”è®²å°ç»“<br><br><br>1. :!command ç”¨äºæ‰§è¡Œä¸€ä¸ªå¤–éƒ¨å‘½ä»¤ commandã€‚<br><br>   è¯·çœ‹ä¸€äº›å®é™…ä¾‹å­ï¼š<br>(MS-DOS)  (Unix)<br> :!dir   :!ls   -  ç”¨äºæ˜¾ç¤ºå½“å‰ç›®å½•çš„å†…å®¹ã€‚<br> :!del FILENAME   :!rm FILENAME   -  ç”¨äºåˆ é™¤åä¸º FILENAME çš„æ–‡ä»¶ã€‚<br><br>2. :w FILENAME  å¯å°†å½“å‰ VIM ä¸­æ­£åœ¨ç¼–è¾‘çš„æ–‡ä»¶ä¿å­˜åˆ°åä¸º FILENAME çš„æ–‡<br>   ä»¶ä¸­ã€‚<br><br>3. v motion :w FILENAME å¯å°†å½“å‰ç¼–è¾‘æ–‡ä»¶ä¸­å¯è§†æ¨¡å¼ä¸‹é€‰ä¸­çš„å†…å®¹ä¿å­˜åˆ°æ–‡ä»¶<br>   FILENAME ä¸­ã€‚<br><br>4. :r FILENAME å¯æå–ç£ç›˜æ–‡ä»¶ FILENAME å¹¶å°†å…¶æ’å…¥åˆ°å½“å‰æ–‡ä»¶çš„å…‰æ ‡ä½ç½®<br>   åé¢ã€‚<br><br>5. :r !dir å¯ä»¥è¯»å– dir å‘½ä»¤çš„è¾“å‡ºå¹¶å°†å…¶æ”¾ç½®åˆ°å½“å‰æ–‡ä»¶çš„å…‰æ ‡ä½ç½®åé¢ã€‚<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs code"> ç¬¬å…­è®²ç¬¬ä¸€èŠ‚ï¼šæ‰“å¼€ç±»å‘½ä»¤<br><br><br> ** è¾“å…¥ o å°†åœ¨å…‰æ ‡çš„ä¸‹æ–¹æ‰“å¼€æ–°çš„ä¸€è¡Œå¹¶è¿›å…¥æ’å…¥æ¨¡å¼ã€‚**<br><br>  1. è¯·å°†å…‰æ ‡ç§»åŠ¨åˆ°æœ¬èŠ‚ä¸­ä¸‹é¢æ ‡è®°æœ‰ ---&gt; çš„é‚£ä¸€è¡Œã€‚<br><br>  2. æ¥ç€è¾“å…¥å°å†™çš„ o åœ¨å…‰æ ‡ *ä¸‹æ–¹* æ‰“å¼€æ–°çš„ä¸€è¡Œï¼Œè¿™ä¸ªå‘½ä»¤ä¼šä½¿æ‚¨<br>     è¿›å…¥æ’å…¥æ¨¡å¼ã€‚<br><br>  3. ç„¶åè¾“å…¥ä¸€äº›æ–‡å­—ï¼Œä¹‹åæŒ‰ &lt;ESC&gt; é”®é€€å‡ºæ’å…¥æ¨¡å¼è€Œè¿›å…¥æ­£å¸¸æ¨¡å¼ã€‚<br><br>---&gt; After typing  o  the cursor is placed on the open line in Insert mode.<br><br>  4. ä¸ºäº†åœ¨å…‰æ ‡ *ä¸Šæ–¹* æ‰“å¼€æ–°çš„ä¸€è¡Œï¼Œåªéœ€è¦è¾“å…¥å¤§å†™çš„ O è€Œä¸æ˜¯å°å†™çš„ o<br>     å°±å¯ä»¥äº†ã€‚è¯·åœ¨ä¸‹è¡Œæµ‹è¯•ä¸€ä¸‹å§ã€‚<br><br>---&gt; Open up a line above this by typing O while the cursor is on this line.<br><br><br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs code">ç¬¬å…­è®²ç¬¬äºŒèŠ‚ï¼šé™„åŠ ç±»å‘½ä»¤<br><br><br>     ** è¾“å…¥ a å°†å¯åœ¨å…‰æ ‡ä¹‹åæ’å…¥æ–‡æœ¬ã€‚ **<br><br>  1. è¯·åœ¨æ­£å¸¸æ¨¡å¼ä¸‹å°†å…‰æ ‡ç§»åŠ¨åˆ°æœ¬èŠ‚ä¸­ä¸‹é¢æ ‡è®°æœ‰ ---&gt; çš„ç¬¬ä¸€è¡Œçš„è¡Œé¦–ã€‚<br><br>  2. æ¥ç€è¾“å…¥ e ç›´åˆ°å…‰æ ‡ä½äº li çš„æœ«å°¾ã€‚<br><br>  3. è¾“å…¥å°å†™çš„ a åˆ™å¯åœ¨å…‰æ ‡ä¹‹åæ’å…¥æ–‡æœ¬äº†ã€‚<br><br>  4. å°†å•è¯è¡¥å……å®Œæ•´ï¼Œå°±åƒä¸‹ä¸€è¡Œä¸­çš„é‚£æ ·ã€‚ä¹‹åæŒ‰ &lt;ESC&gt; é”®é€€å‡ºæ’å…¥æ¨¡å¼å›åˆ°<br>     æ­£å¸¸æ¨¡å¼ã€‚<br><br>  5. ä½¿ç”¨ e ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€æ­¥ä¸å®Œæ•´çš„å•è¯ï¼Œé‡å¤æ­¥éª¤3å’Œæ­¥éª¤4ã€‚<br><br>---&gt; This li will allow you to pract appendi text to a line.<br>---&gt; This line will allow you to practice appending text to a line.<br><br>æç¤ºï¼šaã€i å’Œ A éƒ½ä¼šå¸¦æ‚¨è¿›å…¥æ’å…¥æ¨¡å¼ï¼ŒæƒŸä¸€çš„åŒºåˆ«åœ¨äºå­—ç¬¦æ’å…¥çš„ä½ç½®ã€‚<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs code">    ç¬¬å…­è®²ç¬¬ä¸‰èŠ‚ï¼šå¦å¤–ä¸€ä¸ªç½®æ¢ç±»å‘½ä»¤çš„ç‰ˆæœ¬<br><br><br>      ** è¾“å…¥å¤§å†™çš„ R å¯è¿ç»­æ›¿æ¢å¤šä¸ªå­—ç¬¦ã€‚**<br><br>  1. è¯·å°†å…‰æ ‡ç§»åŠ¨åˆ°æœ¬èŠ‚ä¸­ä¸‹é¢æ ‡è®°æœ‰ ---&gt; çš„ç¬¬ä¸€è¡Œã€‚ç§»åŠ¨å…‰æ ‡åˆ°ç¬¬ä¸€ä¸ª xxx çš„<br>     èµ·å§‹ä½ç½®ã€‚<br><br>  2. ç„¶åè¾“å…¥å¤§å†™çš„ R å¼€å§‹æŠŠç¬¬ä¸€è¡Œä¸­çš„ä¸åŒäºç¬¬äºŒè¡Œçš„å‰©ä½™å­—ç¬¦é€ä¸€è¾“å…¥ï¼Œå°±<br>     å¯ä»¥å…¨éƒ¨æ›¿æ¢æ‰åŸæœ‰çš„å­—ç¬¦è€Œä½¿å¾—ç¬¬ä¸€è¡Œå®Œå…¨é›·åŒç¬¬äºŒè¡Œäº†ã€‚<br><br>  3. æ¥ç€æŒ‰ &lt;ESC&gt; é”®é€€å‡ºæ›¿æ¢æ¨¡å¼å›åˆ°æ­£å¸¸æ¨¡å¼ã€‚æ‚¨å¯ä»¥æ³¨æ„åˆ°å°šæœªæ›¿æ¢çš„æ–‡æœ¬<br>     ä»ç„¶ä¿æŒåŸçŠ¶ã€‚<br><br>  4. é‡å¤ä»¥ä¸Šæ­¥éª¤ï¼Œå°†å‰©ä½™çš„ xxx ä¹Ÿæ›¿æ¢æ‰ã€‚<br><br>---&gt; Adding 123 to xxx gives you xxx.<br>---&gt; Adding 123 to 456 gives you 579.<br><br>æç¤ºï¼šæ›¿æ¢æ¨¡å¼ä¸æ’å…¥æ¨¡å¼ç›¸ä¼¼ï¼Œä¸è¿‡æ¯ä¸ªè¾“å…¥çš„å­—ç¬¦éƒ½ä¼šåˆ é™¤ä¸€ä¸ªå·²æœ‰çš„å­—ç¬¦ã€‚<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs code">  ç¬¬å…­è®²ç¬¬å››èŠ‚ï¼šå¤åˆ¶ç²˜è´´æ–‡æœ¬<br><br><br> ** ä½¿ç”¨æ“ä½œç¬¦ y å¤åˆ¶æ–‡æœ¬ï¼Œä½¿ç”¨ p ç²˜è´´æ–‡æœ¬ **<br><br>  1. å®šä½åˆ°ä¸‹é¢æ ‡è®°æœ‰ ---&gt; çš„ä¸€è¡Œï¼Œå°†å…‰æ ‡ç§»åŠ¨åˆ° &quot;a)&quot; ä¹‹åã€‚<br><br>  2. æ¥ç€ä½¿ç”¨ v è¿›å…¥å¯è§†æ¨¡å¼ï¼Œç§»åŠ¨å…‰æ ‡åˆ° &quot;first&quot; çš„å‰é¢ã€‚<br><br>  3. ç°åœ¨è¾“å…¥ y ä»¥æŠ½å‡º(å¤åˆ¶)é«˜äº®çš„æ–‡æœ¬ã€‚<br><br>  4. ç„¶åç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€è¡Œçš„æœ«å°¾ï¼šj$<br><br>  5. æ¥ç€è¾“å…¥ p ä»¥æ”¾ç½®(ç²˜è´´)å¤åˆ¶äº†çš„æ–‡æœ¬ã€‚ç„¶åè¾“å…¥ï¼ša second &lt;ESC&gt;ã€‚<br><br>  6. ä½¿ç”¨å¯è§†æ¨¡å¼é€‰ä¸­ &quot; item.&quot;ï¼Œç”¨ y å¤åˆ¶ï¼Œå†ç”¨ j$ å°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œæœ«å°¾ï¼Œ<br>     ç”¨ p å°†æ–‡æœ¬ç²˜è´´åˆ°é‚£é‡Œã€‚<br><br>---&gt;  a) this is the first item.<br>      b)<br><br>  æç¤ºï¼šæ‚¨è¿˜å¯ä»¥æŠŠ y å½“ä½œæ“ä½œç¬¦æ¥ä½¿ç”¨ï¼›ä¾‹å¦‚ yw å¯ä»¥ç”¨æ¥å¤åˆ¶ä¸€ä¸ªå•è¯ã€‚<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs code">    ç¬¬å…­è®²ç¬¬äº”èŠ‚ï¼šè®¾ç½®ç±»å‘½ä»¤çš„é€‰é¡¹<br><br><br>  ** è®¾ç½®å¯ä½¿æŸ¥æ‰¾æˆ–è€…æ›¿æ¢å¯å¿½ç•¥å¤§å°å†™çš„é€‰é¡¹ **<br><br>  1. è¦æŸ¥æ‰¾å•è¯ ignore å¯åœ¨æ­£å¸¸æ¨¡å¼ä¸‹è¾“å…¥ /ignore &lt;å›è½¦&gt;ã€‚<br>     è¦é‡å¤æŸ¥æ‰¾è¯¥è¯ï¼Œå¯ä»¥é‡å¤æŒ‰ n é”®ã€‚<br><br>  2. ç„¶åè®¾ç½® ic é€‰é¡¹(Ignore Caseï¼Œå¿½ç•¥å¤§å°å†™)ï¼Œè¯·è¾“å…¥ï¼š :set ic<br><br>  3. ç°åœ¨å¯ä»¥é€šè¿‡é”®å…¥ n é”®å†æ¬¡æŸ¥æ‰¾å•è¯ ignoreã€‚æ³¨æ„åˆ° Ignore å’Œ IGNORE ç°åœ¨<br>     ä¹Ÿè¢«æ‰¾åˆ°äº†ã€‚<br><br>  4. ç„¶åè®¾ç½® hlsearch å’Œ incsearch è¿™ä¸¤ä¸ªé€‰é¡¹ï¼Œè¯·è¾“å…¥ï¼š :set hls is<br><br>  5. ç°åœ¨å¯ä»¥å†æ¬¡è¾“å…¥æŸ¥æ‰¾å‘½ä»¤ï¼Œçœ‹çœ‹ä¼šæœ‰ä»€ä¹ˆæ•ˆæœï¼š /ignore &lt;å›è½¦&gt;<br><br>  6. è¦ç¦ç”¨å¿½ç•¥å¤§å°å†™ï¼Œè¯·è¾“å…¥ï¼š :set noic<br><br>æç¤ºï¼šè¦ç§»é™¤åŒ¹é…é¡¹çš„é«˜äº®æ˜¾ç¤ºï¼Œè¯·è¾“å…¥ï¼š  :nohlsearch<br>æç¤ºï¼šå¦‚æœæ‚¨æƒ³è¦ä»…åœ¨ä¸€æ¬¡æŸ¥æ‰¾æ—¶å¿½ç•¥å­—æ¯å¤§å°å†™ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ \cï¼š<br>      /ignore\c &lt;å›è½¦&gt;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs code">       ç¬¬å…­è®²å°ç»“<br><br> 1. è¾“å…¥å°å†™çš„ o å¯ä»¥åœ¨å…‰æ ‡ä¸‹æ–¹æ‰“å¼€æ–°çš„ä¸€è¡Œå¹¶è¿›å…¥æ’å…¥æ¨¡å¼ã€‚<br>    è¾“å…¥å¤§å†™çš„ O å¯ä»¥åœ¨å…‰æ ‡ä¸Šæ–¹æ‰“å¼€æ–°çš„ä¸€è¡Œã€‚<br><br> 2. è¾“å…¥å°å†™çš„ a å¯ä»¥åœ¨å…‰æ ‡æ‰€åœ¨ä½ç½®ä¹‹åæ’å…¥æ–‡æœ¬ã€‚<br>    è¾“å…¥å¤§å†™çš„ A å¯ä»¥åœ¨å…‰æ ‡æ‰€åœ¨è¡Œçš„è¡Œæœ«ä¹‹åæ’å…¥æ–‡æœ¬ã€‚<br><br> 3. e å‘½ä»¤å¯ä»¥ä½¿å…‰æ ‡ç§»åŠ¨åˆ°å•è¯æœ«å°¾ã€‚<br><br> 4. æ“ä½œç¬¦ y å¤åˆ¶æ–‡æœ¬ï¼Œp ç²˜è´´å…ˆå‰å¤åˆ¶çš„æ–‡æœ¬ã€‚<br><br> 5. è¾“å…¥å¤§å†™çš„ R å°†è¿›å…¥æ›¿æ¢æ¨¡å¼ï¼Œç›´è‡³æŒ‰ &lt;ESC&gt; é”®å›åˆ°æ­£å¸¸æ¨¡å¼ã€‚<br><br> 6. è¾“å…¥ :set xxx å¯ä»¥è®¾ç½® xxx é€‰é¡¹ã€‚ä¸€äº›æœ‰ç”¨çš„é€‰é¡¹å¦‚ä¸‹ï¼š<br>   &#x27;ic&#x27; &#x27;ignorecase&#x27;æŸ¥æ‰¾æ—¶å¿½ç•¥å­—æ¯å¤§å°å†™<br>&#x27;is&#x27; &#x27;incsearch&#x27;æŸ¥æ‰¾çŸ­è¯­æ—¶æ˜¾ç¤ºéƒ¨åˆ†åŒ¹é…<br>&#x27;hls&#x27; &#x27;hlsearch&#x27;é«˜äº®æ˜¾ç¤ºæ‰€æœ‰çš„åŒ¹é…çŸ­è¯­<br>    é€‰é¡¹åå¯ä»¥ç”¨å®Œæ•´ç‰ˆæœ¬ï¼Œä¹Ÿå¯ä»¥ç”¨ç¼©ç•¥ç‰ˆæœ¬ã€‚<br><br> 7. åœ¨é€‰é¡¹å‰åŠ ä¸Š no å¯ä»¥å…³é—­é€‰é¡¹ï¼š  :set noic<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs code">  ç¬¬ä¸ƒè®²ç¬¬ä¸€èŠ‚ï¼šè·å–å¸®åŠ©ä¿¡æ¯<br><br><br>      ** ä½¿ç”¨åœ¨çº¿å¸®åŠ©ç³»ç»Ÿ **<br><br> Vim æ‹¥æœ‰ä¸€ä¸ªç»†è‡´å…¨é¢çš„åœ¨çº¿å¸®åŠ©ç³»ç»Ÿã€‚è¦å¯åŠ¨è¯¥å¸®åŠ©ç³»ç»Ÿï¼Œè¯·é€‰æ‹©å¦‚ä¸‹ä¸‰ç§æ–¹<br> æ³•ä¹‹ä¸€ï¼š<br>- æŒ‰ä¸‹ &lt;HELP&gt; é”® (å¦‚æœé”®ç›˜ä¸Šæœ‰çš„è¯)<br>- æŒ‰ä¸‹ &lt;F1&gt; é”® (å¦‚æœé”®ç›˜ä¸Šæœ‰çš„è¯)<br>- è¾“å…¥:help &lt;å›è½¦&gt;<br><br> è¯·é˜…è¯»å¸®åŠ©çª—å£ä¸­çš„æ–‡å­—ä»¥äº†è§£å¸®åŠ©æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚<br> è¾“å…¥ CTRL-W CTRL-W   å¯ä»¥ä½¿æ‚¨åœ¨çª—å£ä¹‹é—´è·³è½¬ã€‚<br> è¾“å…¥ :q &lt;å›è½¦&gt; å¯ä»¥å…³é—­å¸®åŠ©çª—å£ã€‚<br><br> æä¾›ä¸€ä¸ªæ­£ç¡®çš„å‚æ•°ç»™&quot;:help&quot;å‘½ä»¤ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°å…³äºè¯¥ä¸»é¢˜çš„å¸®åŠ©ã€‚è¯·è¯•éªŒä»¥<br> ä¸‹å‚æ•°(å¯åˆ«å¿˜äº†æŒ‰å›è½¦é”®å“¦)ï¼š<br><br>:help w<br>:help c_CTRL-D<br>:help insert-index<br>:help user-manual<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs code">  ç¬¬ä¸ƒè®²ç¬¬äºŒèŠ‚ï¼šåˆ›å»ºå¯åŠ¨è„šæœ¬<br><br><br>  ** å¯ç”¨ Vim çš„ç‰¹æ€§ **<br><br>Vim çš„åŠŸèƒ½ç‰¹æ€§è¦æ¯” Vi å¤šå¾—å¤šï¼Œä½†å…¶ä¸­å¤§éƒ¨åˆ†éƒ½æ²¡æœ‰ç¼ºçœå¯ç”¨ã€‚ä¸ºäº†ä½¿ç”¨æ›´å¤šçš„<br>ç‰¹æ€§ï¼Œæ‚¨å¾—åˆ›å»ºä¸€ä¸ª vimrc æ–‡ä»¶ã€‚<br><br>1. å¼€å§‹ç¼–è¾‘ vimrc æ–‡ä»¶ï¼Œå…·ä½“å‘½ä»¤å–å†³äºæ‚¨æ‰€ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿï¼š<br>      :edit ~/.vimrcè¿™æ˜¯ Unix ç³»ç»Ÿæ‰€ä½¿ç”¨çš„å‘½ä»¤<br>      :edit $VIM/_vimrcè¿™æ˜¯ MS-Windows ç³»ç»Ÿæ‰€ä½¿ç”¨çš„å‘½ä»¤<br><br>2. æ¥ç€è¯»å– vimrc ç¤ºä¾‹æ–‡ä»¶çš„å†…å®¹ï¼š<br>      :r $VIMRUNTIME/vimrc_example.vim<br><br>3. ä¿å­˜æ–‡ä»¶ï¼Œå‘½ä»¤ä¸ºï¼š<br>      :write<br><br>ä¸‹æ¬¡æ‚¨å¯åŠ¨ Vim æ—¶ï¼Œç¼–è¾‘å™¨å°±ä¼šæœ‰äº†è¯­æ³•é«˜äº®çš„åŠŸèƒ½ã€‚<br>æ‚¨å¯ä»¥æŠŠæ‚¨å–œæ¬¢çš„å„ç§è®¾ç½®æ·»åŠ åˆ°è¿™ä¸ª vimrc æ–‡ä»¶ä¸­ã€‚<br>è¦äº†è§£æ›´å¤šä¿¡æ¯è¯·è¾“å…¥ :help vimrc-intro<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs code">    ç¬¬ä¸ƒè®²ç¬¬ä¸‰èŠ‚ï¼šè¡¥å…¨åŠŸèƒ½<br><br><br>      ** ä½¿ç”¨ CTRL-D å’Œ &lt;TAB&gt; å¯ä»¥è¿›è¡Œå‘½ä»¤è¡Œè¡¥å…¨ **<br><br>  1. è¯·ç¡®ä¿ Vim ä¸æ˜¯åœ¨ä»¥å…¼å®¹æ¨¡å¼è¿è¡Œï¼š :set nocp<br><br>  2. æŸ¥çœ‹ä¸€ä¸‹å½“å‰ç›®å½•ä¸‹å·²ç»å­˜åœ¨å“ªäº›æ–‡ä»¶ï¼Œè¾“å…¥ï¼š :!ls   æˆ–è€…  :!dir<br><br>  3. ç°åœ¨è¾“å…¥ä¸€ä¸ªç›®å½•çš„èµ·å§‹éƒ¨åˆ†ï¼Œä¾‹å¦‚è¾“å…¥ï¼š :e<br><br>  4. æ¥ç€æŒ‰ CTRL-D é”®ï¼ŒVim ä¼šæ˜¾ç¤ºä»¥ e å¼€å§‹çš„å‘½ä»¤çš„åˆ—è¡¨ã€‚<br><br>  5. ç„¶åæŒ‰ &lt;TAB&gt; é”®ï¼ŒVim ä¼šè¡¥å…¨å‘½ä»¤ä¸º :edit ã€‚<br><br>  6. ç°åœ¨æ·»åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œä»¥åŠä¸€ä¸ªå·²æœ‰æ–‡ä»¶çš„æ–‡ä»¶åçš„èµ·å§‹éƒ¨åˆ†ï¼Œä¾‹å¦‚ï¼š :edit FIL<br><br>  7. æ¥ç€æŒ‰ &lt;TAB&gt; é”®ï¼ŒVim ä¼šè¡¥å…¨æ–‡ä»¶å(å¦‚æœå®ƒæ˜¯æƒŸä¸€åŒ¹é…çš„)ã€‚<br><br>æç¤ºï¼šè¡¥å…¨å¯¹äºè®¸å¤šå‘½ä»¤éƒ½æœ‰æ•ˆã€‚æ‚¨åªéœ€å°è¯•æŒ‰ CTRL-D å’Œ &lt;TAB&gt;ã€‚<br>      å®ƒå¯¹äº :help å‘½ä»¤éå¸¸æœ‰ç”¨ã€‚<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs code">  ç¬¬ä¸ƒè®²å°ç»“<br><br><br>1. è¾“å…¥ :help æˆ–è€…æŒ‰ &lt;F1&gt; é”®æˆ– &lt;Help&gt; é”®å¯ä»¥æ‰“å¼€å¸®åŠ©çª—å£ã€‚<br><br>2. è¾“å…¥ :help cmd å¯ä»¥æ‰¾åˆ°å…³äº cmd å‘½ä»¤çš„å¸®åŠ©ã€‚<br><br>3. è¾“å…¥ CTRL-W CTRL-W  å¯ä»¥ä½¿æ‚¨åœ¨çª—å£ä¹‹é—´è·³è½¬ã€‚<br><br>4. è¾“å…¥ :q ä»¥å…³é—­å¸®åŠ©çª—å£<br><br>5. æ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ª vimrc å¯åŠ¨è„šæœ¬æ–‡ä»¶ç”¨æ¥ä¿å­˜æ‚¨åå¥½çš„è®¾ç½®ã€‚<br><br>6. å½“è¾“å…¥ : å‘½ä»¤æ—¶ï¼ŒæŒ‰ CTRL-D å¯ä»¥æŸ¥çœ‹å¯èƒ½çš„è¡¥å…¨ç»“æœã€‚<br>   æŒ‰ &lt;TAB&gt; å¯ä»¥ä½¿ç”¨ä¸€ä¸ªè¡¥å…¨ã€‚<br><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs code"><br> vim æ•™ç¨‹åˆ°æ­¤å°±ç»“æŸäº†ã€‚æœ¬æ•™ç¨‹åªæ˜¯ä¸ºäº†ç®€æ˜åœ°ä»‹ç»ä¸€ä¸‹ Vim ç¼–è¾‘å™¨ï¼Œä½†å·²è¶³ä»¥è®©æ‚¨<br> å¾ˆå®¹æ˜“ä½¿ç”¨è¿™ä¸ªç¼–è¾‘å™¨äº†ã€‚æ¯‹åº¸è´¨ç–‘ï¼Œvimè¿˜æœ‰å¾ˆå¤šå¾ˆå¤šçš„å‘½ä»¤ï¼Œæœ¬æ•™ç¨‹æ‰€ä»‹<br> ç»çš„è·ç¦»å®Œæ•´çš„å·®å¾—å¾ˆè¿œã€‚æ‰€ä»¥æ‚¨è¦ç²¾é€šçš„è¯ï¼Œè¿˜æœ›ç»§ç»­åŠªåŠ›å“¦ã€‚ä¸‹ä¸€æ­¥æ‚¨å¯ä»¥é˜…è¯»<br> Vim çš„ç”¨æˆ·æ‰‹å†Œï¼Œä½¿ç”¨çš„å‘½ä»¤æ˜¯ï¼š :help user-manual<br><br> ä¸‹é¢è¿™æœ¬ä¹¦å€¼å¾—æ¨èç”¨äºæ›´è¿›ä¸€æ­¥çš„é˜…è¯»å’Œå­¦ä¹ ï¼š<br>Vim - Vi Improved - ä½œè€…ï¼šSteve Oualline<br>å‡ºç‰ˆç¤¾ï¼šNew Riders<br> è¿™æ˜¯ç¬¬ä¸€æœ¬å®Œå…¨è®²è§£ Vim çš„ä¹¦ç±ã€‚å®ƒå¯¹äºåˆå­¦è€…ç‰¹åˆ«æœ‰ç”¨ã€‚å…¶ä¸­åŒ…å«æœ‰å¤§é‡å®ä¾‹<br> å’Œå›¾ç¤ºã€‚<br> æ¬²çŸ¥è¯¦æƒ…ï¼Œè¯·è®¿é—® http://iccf-holland.org/click5.html<br><br> ä»¥ä¸‹è¿™æœ¬ä¹¦æ¯”è¾ƒè€äº†è€Œä¸”å†…å®¹æ›´å¤šæ˜¯å…³äº Vi è€Œé Vimï¼Œä½†æ˜¯ä¹Ÿå€¼å¾—æ¨èï¼š<br>Learning the Vi Editor - ä½œè€…ï¼šLinda Lamb<br>å‡ºç‰ˆç¤¾ï¼šO&#x27;Reilly &amp; Associates Inc.<br> è¿™æ˜¯ä¸€æœ¬ä¸é”™çš„ä¹¦ï¼Œé€šè¿‡å®ƒæ‚¨å‡ ä¹èƒ½å¤Ÿäº†è§£åˆ°ä»»ä½•æ‚¨æƒ³è¦ä½¿ç”¨ Vi åšçš„äº‹æƒ…ã€‚<br> æ­¤ä¹¦çš„ç¬¬å…­ä¸ªç‰ˆæœ¬ä¹ŸåŒ…å«äº†ä¸€äº›å…³äº Vim çš„ä¿¡æ¯ã€‚<br><br> æœ¬æ•™ç¨‹æ˜¯ç”±æ¥è‡ª Calorado School of Mines çš„ Michael C. Pierce å’Œ<br> Robert K. Ware æ‰€ç¼–å†™çš„ï¼Œå…¶ä¸­å¾ˆå¤šåˆ›æ„ç”±æ¥è‡ª Colorado State University çš„<br> Charles Smith æä¾›ã€‚ç¼–è€…çš„ç”µå­é‚®ç®±æ˜¯ï¼šbware@mines.colorado.edu<br><br> æœ¬æ•™ç¨‹å·²ç”± Bram Moolenaar ä¸“ä¸º Vim è¿›è¡Œä¿®è®¢ã€‚<br><br> è¯‘åˆ¶è€…é™„è¨€ï¼š<br> ===========<br>     ç®€ä½“ä¸­æ–‡æ•™ç¨‹ç¿»è¯‘ç‰ˆä¹‹è¯‘åˆ¶è€…ä¸ºæ¢æ˜Œæ³° &lt;beos@turbolinux.com.cn&gt;ï¼Œè¿˜æœ‰<br>     å¦å¤–ä¸€ä¸ªè”ç³»åœ°å€ï¼šlinuxrat@gnuchina.orgã€‚<br><br>     ç¹ä½“ä¸­æ–‡æ•™ç¨‹æ˜¯ä»ç®€ä½“ä¸­æ–‡æ•™ç¨‹ç¿»è¯‘ç‰ˆä½¿ç”¨ Debian GNU/Linux ä¸­æ–‡é¡¹ç›®å°<br>     ç»„çš„äºå¹¿è¾‰å…ˆç”Ÿç¼–å†™çš„ä¸­æ–‡æ±‰å­—è½¬ç å™¨  autoconvert è½¬æ¢è€Œæˆçš„ï¼Œå¹¶å¯¹è½¬<br>     æ¢çš„ç»“æœåšäº†ä¸€äº›ç»†èŠ‚çš„æ”¹åŠ¨ã€‚<br><br> å˜æ›´è®°å½•ï¼š<br> =========<br>     2012å¹´10æœˆ01æ—¥ èµµæ¶› &lt;alick9188@gmail.com&gt;<br>     å°† vimtutor ä¸­è¯‘ç‰ˆä» 1.5 å‡çº§åˆ° 1.7ã€‚<br><br>     2002å¹´08æœˆ30æ—¥ æ¢æ˜Œæ³° &lt;beos@turbolinux.com.cn&gt;<br>     æ„Ÿè°¢ RMS@SMTH çš„æŒ‡æ­£ï¼Œå°†å¤šå¤„é”™è¯¯ä¿®æ­£ã€‚<br><br>     2002å¹´04æœˆ22æ—¥ æ¢æ˜Œæ³° &lt;linuxrat@gnuchina.org&gt;<br>     æ„Ÿè°¢ xuandong@sh163.net çš„æŒ‡æ­£ï¼Œå°†ä¸¤å¤„é”™åˆ«å­—ä¿®æ­£ã€‚<br><br>     2002å¹´03æœˆ18æ—¥ æ¢æ˜Œæ³° &lt;linuxrat@gnuchina.org&gt;<br>     æ ¹æ®Bram Moolenaarå…ˆç”Ÿåœ¨2002å¹´03æœˆ16æ—¥çš„æ¥ä¿¡è¦æ±‚ï¼Œå°†vimtutor1.4ä¸­è¯‘<br>     ç‰ˆå‡çº§åˆ°vimtutor1.5ã€‚<br><br>     2001å¹´11æœˆ15æ—¥ æ¢æ˜Œæ³° &lt;linuxrat@gnuchina.org&gt;<br>     å°†vimtutor1.4ä¸­è¯‘ç‰ˆæäº¤ç»™Bram Moolenaarå’ŒSven Guckesã€‚<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>vim</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flutter BLoC ç®€å•ä½¿ç”¨</title>
    <link href="/2019/05/08/Flutter-BLoC-%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
    <url>/2019/05/08/Flutter-BLoC-%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>Flutterçš„è®¾è®¡çµæ„Ÿéƒ¨åˆ†æ¥è‡ªäºReactï¼Œä¸»è¦æ˜¯æ•°æ®ä¸è§†å›¾åˆ†ç¦»ï¼Œç”±æ•°æ®æ¥é©±åŠ¨è§†å›¾çš„æ¸²æŸ“ã€‚è€Œå¯¹äºæˆ‘ä»¬åœ¨å®é™…å·¥ç¨‹ä¸­çš„åº”ç”¨ï¼Œå°±ç›®å‰çŠ¶æ€æ¥è®²ï¼Œåªæ˜¯ç”¨æ¥åšUIï¼Œå¹¶æ²¡æœ‰ç”¨Flutteræ¥åšå¤šå°‘ä¸šåŠ¡é€»è¾‘ï¼Œæ¶‰åŠåˆ°çš„é€»è¾‘ä¹Ÿä¸è¿‡æ˜¯ç•Œé¢ä¹‹é—´çš„æ•°æ®ã€çŠ¶æ€ä¼ é€’ç­‰ã€‚ä½†å¹¶ä¸æ’é™¤å°†æ¥ä¼šå°†é‡å¿ƒç¨å¾®å¾€Flutterä¾§åç§»ã€‚</p><p>ç›®å‰ä½¿ç”¨StatefulWidgetå®Œå…¨å¯ä»¥é€‚åº”ç›®å‰çš„éœ€æ±‚ã€‚ä½†æ˜¯éœ€è¦è€ƒè™‘åˆ°åç»­æ‰©å±•ï¼Œéœ€è¦æ‰¾ä¸€ç§èƒ½å¤Ÿè§£å†³çŠ¶æ€åŒæ­¥é—®é¢˜çš„æ–¹æ¡ˆã€‚åœ¨äº†è§£äº†å‡ ç§æ–¹æ¡ˆåç¡®å®šä½¿ç”¨BLoCã€‚</p><p><a href="https://juejin.im/post/5bac54c45188255c681589d3">https://juejin.im/post/5bac54c45188255c681589d3</a></p><p><a href="https://www.jianshu.com/p/e7e1bced6890">https://www.jianshu.com/p/e7e1bced6890</a></p><p><a href="https://www.jianshu.com/p/7573dee97dbb">https://www.jianshu.com/p/7573dee97dbb</a></p><span id="more"></span><h4 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h4><p>Streamçœ‹èµ·æ¥å’Œrxå®¶æ—ä¸œè¥¿ä¸œè¥¿å¾ˆåƒï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<strong>StreamController</strong>çš„<strong>sink</strong>ä¼ è¾“ä¸€äº›æ•°æ®ï¼Œç„¶åç›‘å¬<strong>StreamSubscription</strong>æµæ¥æ„ŸçŸ¥æ•°æ®ï¼Œç”šè‡³å¯ä»¥é€šè¿‡<strong>StreamTransformer</strong>å¯¹æ•°æ®æµè¿›è¡Œæ“ä½œã€‚å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡Flutteræä¾›çš„<strong>StreamBuilder</strong>æ¥æ„å»ºWidgetï¼Œ</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dart">Center(<br>        child: StreamBuilder&lt;<span class="hljs-built_in">int</span>&gt;(<br>            stream: bloc.stream,<br>            initialData: bloc.value,<br>            builder: (BuildContext context, AsyncSnapshot&lt;<span class="hljs-built_in">int</span>&gt; snapshot) &#123;<br>              <span class="hljs-keyword">return</span> Text(<br>                <span class="hljs-string">&#x27;You hit me: <span class="hljs-subst">$&#123;snapshot.data&#125;</span> times&#x27;</span>,<br>                style: Theme.of(context).textTheme.display1,<br>              );<br>            &#125;),<br>      )<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„snapshotåˆ™æ˜¯é€šè¿‡sinkä¼ è¾“è¿‡æ¥çš„æ•°æ®ï¼Œç„¶åæ˜¾ç¤ºåœ¨Textæ§ä»¶ä¸­ã€‚</p><p>ä¸€ä¸ªç®€å•çš„Streamæ¼”ç¤º</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;dart:async&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  StreamController streamController = StreamController();<br><br>  StreamSubscription subscription =<br>      streamController.stream.listen((event)&#123;<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$event</span>&quot;</span>);<br>      &#125;);<br>  <br>  subscription.onData((data) &#123;<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;--&gt;<span class="hljs-subst">$data</span>&quot;</span>);<br>  &#125;);<br>  subscription.onDone(() =&gt; &#123;<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;on done&quot;</span>)&#125;);<br><br>  streamController.sink.add(<span class="hljs-string">&quot;abc&quot;</span>);<br>  streamController.sink.add(<span class="hljs-string">&quot;123&quot;</span>);<br>  streamController.sink.add(<span class="hljs-string">&quot;def&quot;</span>);<br><br>  streamController.close();<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¼šå¾—åˆ°è¿™æ ·ä¸€ä¸ªè¾“å‡ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml">--&gt;abc<br>--&gt;123<br>--&gt;def<br>on done<br></code></pre></td></tr></table></figure><p>å½“ç„¶å¦‚æœæˆ‘ä»¬æ²¡æœ‰å†æ¬¡é‡å†™<code>subscription.onData</code>æ–¹æ³•ï¼Œåˆ™ä¼šæ‰§è¡Œ<code>print(&quot;$event&quot;);</code>æ–¹æ³•ã€‚</p><p><strong>Stream</strong>æœ‰ä¸¤ç§ç±»å‹ï¼š<strong>å•è®¢é˜…Streamå’Œå¹¿æ’­Stream</strong>ã€‚å•è®¢é˜…Streamåªå…è®¸åœ¨è¯¥Streamçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ä½¿ç”¨å•ä¸ªç›‘å¬å™¨ï¼Œå³ä½¿ç¬¬ä¸€ä¸ªsubscriptionè¢«å–æ¶ˆäº†ï¼Œä½ ä¹Ÿæ²¡æ³•åœ¨è¿™ä¸ªæµä¸Šç›‘å¬åˆ°ç¬¬äºŒæ¬¡äº‹ä»¶ï¼›è€Œå¹¿æ’­Streamå…è®¸ä»»æ„ä¸ªæ•°çš„subscriptionï¼Œä½ å¯ä»¥éšæ—¶éšåœ°ç»™å®ƒæ·»åŠ subscriptionï¼Œåªè¦æ–°çš„ç›‘å¬å¼€å§‹å·¥ä½œæµï¼Œå®ƒå°±èƒ½æ”¶åˆ°æ–°çš„äº‹ä»¶ã€‚</p><h4 id="ç®€åŒ–ç‰ˆçš„demo"><a href="#ç®€åŒ–ç‰ˆçš„demo" class="headerlink" title="ç®€åŒ–ç‰ˆçš„demo"></a>ç®€åŒ–ç‰ˆçš„demo</h4><p>å®˜æ–¹çš„è®¡æ•°å™¨demoçš„ç®€åŒ–ç‰ˆã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CountBLoC</span>  </span>&#123;<br>  <span class="hljs-built_in">int</span> _count = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">final</span> _controller = StreamController&lt;<span class="hljs-built_in">int</span>&gt;();<br>  Stream&lt;<span class="hljs-built_in">int</span>&gt; <span class="hljs-keyword">get</span> stream =&gt; _controller.stream;<br>  <span class="hljs-built_in">int</span> <span class="hljs-keyword">get</span> value =&gt; _count;<br>  increment() &#123;<br>    _controller.sink.add(++_count);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CounterWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">final</span> bloc = CountBLoC();<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&#x27;Top Page&#x27;</span>),<br>      ),<br>      body: Center(<br>        child: StreamBuilder&lt;<span class="hljs-built_in">int</span>&gt;(<br>            stream: bloc.stream,<br>            initialData: bloc.value,<br>            builder: (BuildContext context, AsyncSnapshot&lt;<span class="hljs-built_in">int</span>&gt; snapshot) &#123;<br>              <span class="hljs-keyword">return</span> Text(<br>                <span class="hljs-string">&#x27;You hit me: <span class="hljs-subst">$&#123;snapshot.data&#125;</span> times&#x27;</span>,<br>                style: Theme.of(context).textTheme.display1,<br>              );<br>            &#125;),<br>      ),<br>      floatingActionButton: FloatingActionButton(<br>        onPressed: () =&gt; bloc.increment(),<br>        child: Icon(Icons.add),<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol><li>é¦–å…ˆæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªBLoCç±»ï¼Œåœ¨é‡Œé¢å£°æ˜äº†ä¸€ä¸ª<strong>StreamController</strong>å’Œä¸€ä¸ª<code>increment()</code>æ–¹æ³•ï¼Œå½“æˆ‘ä»¬è°ƒç”¨increment()æ–¹æ³•çš„æ—¶å€™ï¼Œåˆ™ä¼šå°†è®¡æ•°åŠ 1ï¼Œç„¶åä¸¢åˆ°sinké‡Œé¢ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨ä»»ä½•ç›‘å¬<code>streamController.stream</code>çš„åœ°æ–¹éƒ½å°†ä¼šæ”¶åˆ°è¿™ä¸ªæ•°æ®ï¼Œç„¶åè¿›è¡Œä¹‹åçš„å·¥ä½œï¼Œåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œç›‘å¬è€…æ˜¯<code>StreamBuilder</code>,å½“æœ‰æ•°æ®æµå…¥çš„æ—¶å€™ï¼Œå®ƒä¼šè¿›è¡ŒUIé‡ç»˜ï¼Œå°†æ•°æ®æ˜¾ç¤ºåˆ°æ§ä»¶ä¸Šã€‚</li><li>æˆ‘ä»¬åœ¨ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™ï¼Œè°ƒç”¨äº†<code>bloc.increment()</code>æ–¹æ³•ï¼Œäº§ç”Ÿäº†æ•°æ®æµã€‚</li></ol><p>è¿™å¾ˆåƒmvpæ¨¡å¼ä¸­çš„På±‚çš„ä½œç”¨ï¼Œä¸šåŠ¡é€»è¾‘å¤„ç†éƒ½åœ¨è¿™é‡Œé¢è¿›è¡Œï¼Œç„¶åé€šçŸ¥UIé‡ç»˜ï¼Œå½“ç„¶è¿™åªæ˜¯ä¸€ä¸ªå¾ˆç²—ç³™çš„æ ·ä¾‹ã€‚</p><h4 id="å…³äºBlocçš„å¯è®¿é—®æ€§"><a href="#å…³äºBlocçš„å¯è®¿é—®æ€§" class="headerlink" title="å…³äºBlocçš„å¯è®¿é—®æ€§"></a>å…³äºBlocçš„å¯è®¿é—®æ€§</h4><p>ä»¥ä¸Šçš„åŠŸèƒ½éƒ½æ˜¯åŸºäºBLoCè¿›è¡Œçš„ï¼Œæ‰€ä»¥BLoCçš„å¯è®¿é—®æ€§éœ€è¦å¾—åˆ°ä¿è¯</p><ol><li><p><strong>å…¨å±€å•ä¾‹ï¼ˆglobal Singletonï¼‰</strong>ï¼šè¿™ç§æ–¹å¼å¾ˆç®€å•ï¼Œä½†æ˜¯ä¸æ¨èï¼Œå› ä¸ºDartä¸­å¯¹ç±»æ²¡æœ‰ææ„å‡½æ•°ï¼ˆdestructorï¼‰çš„æ¦‚å¿µï¼Œå› æ­¤èµ„æºæ°¸è¿œæ— æ³•é‡Šæ”¾ã€‚</p></li><li><p><strong>å±€éƒ¨å˜é‡ï¼ˆlocal instanceï¼‰</strong>ï¼šä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªBlocå±€éƒ¨å®ä¾‹ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥å®Œç¾è§£å†³é—®é¢˜ã€‚ä½†æ˜¯ç¾ä¸­ä¸è¶³çš„æ˜¯ï¼Œä½ éœ€è¦åœ¨StatefulWidgetä¸­åˆå§‹åŒ–ï¼Œå¹¶è®°å¾—åœ¨<code>dispose()</code>ä¸­é‡Šæ”¾å®ƒã€‚</p></li><li><p><strong>ç”±ç¥–å…ˆï¼ˆancestorï¼‰æ¥æä¾›</strong>ï¼šè¿™ä¹Ÿæ˜¯æœ€å¸¸è§çš„ä¸€ç§æ–¹æ³•ï¼Œé€šè¿‡ä¸€ä¸ªå®ç°äº†StatefulWidgetçš„çˆ¶æ§ä»¶æ¥è·å–è®¿é—®æƒã€‚</p></li></ol><p>åœ¨å¤§ä½¬å†™çš„é¡¹ç›®ä¸­æœ‰è¿™ç§å®ç°ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// æ‰€æœ‰ BLoCs çš„é€šç”¨æ¥å£</span><br><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BlocBase</span> </span>&#123;<br>  <span class="hljs-keyword">void</span> dispose();<br>&#125;<br><br><span class="hljs-comment">// é€šç”¨ BLoC provider</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BlocProvider</span>&lt;<span class="hljs-title">T</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BlocBase</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  BlocProvider(&#123;<br>    Key key,<br>    <span class="hljs-meta">@required</span> <span class="hljs-keyword">this</span>.child,<br>    <span class="hljs-meta">@required</span> <span class="hljs-keyword">this</span>.bloc,<br>  &#125;): <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-keyword">final</span> T bloc;<br>  <span class="hljs-keyword">final</span> Widget child;<br><br>  <span class="hljs-meta">@override</span><br>  _BlocProviderState&lt;T&gt; createState() =&gt; _BlocProviderState&lt;T&gt;();<br><br>  <span class="hljs-keyword">static</span> T of&lt;T <span class="hljs-keyword">extends</span> BlocBase&gt;(BuildContext context)&#123;<br>    <span class="hljs-keyword">final</span> type = _typeOf&lt;BlocProvider&lt;T&gt;&gt;();<br>    BlocProvider&lt;T&gt; provider = context.ancestorWidgetOfExactType(type);<br>    <span class="hljs-keyword">return</span> provider.bloc;<br>  &#125;<br><br>  <span class="hljs-keyword">static</span> <span class="hljs-built_in">Type</span> _typeOf&lt;T&gt;() =&gt; T;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_BlocProviderState</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">BlocProvider</span>&lt;<span class="hljs-title">BlocBase</span>&gt;&gt;</span>&#123;<br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> dispose()&#123;<br>    widget.bloc.dispose();<br>    <span class="hljs-keyword">super</span>.dispose();<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context)&#123;<br>    <span class="hljs-keyword">return</span> widget.child;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™ï¼Œ</p><ol><li><p>è‡ªå·±å®šä¹‰å¤„ç†é€»è¾‘çš„BLoCç»§æ‰¿BLoCBase(è¿™æ˜¯ä¸ºäº†èƒ½é‡Šæ”¾æ‰Streamèµ„æº)</p></li><li><p>ä¹‹å‰æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç•Œé¢å«Jokeï¼Œä½¿ç”¨çš„æ—¶å€™ç›´æ¥ç”¨<code>new Joke()</code>å°±å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦</p></li><li><p>&#96;&#96;&#96;dart<br>BLoCProvider<JokeBLoC>(<br>  bloc: JokeBLoC(),<br>  child: Joke(),<br>)</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><br>å½“ç„¶ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨BLoC,éœ€è¦å¯¹Jokeè¿›è¡Œæ”¹é€ ï¼Œæ”¹é€ ä¹‹åæ˜¯`JokeWithBLoC`,äºæ˜¯å°±æˆäº†è¿™æ ·<br><br>``` dart<br>BLoCProvider&lt;JokeBLoC&gt;(<br><span class="hljs-title">  bloc:</span> JokeBLoC(),<br><span class="hljs-title">  child:</span> JokeWithBLoC(),<br>)<br></code></pre></td></tr></table></figure></li></ol><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs dart"><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JokeBLoC</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BLoCBase</span></span>&#123;<br><br>  <span class="hljs-comment">//å¤„ç†æ•°æ®è¿”å›</span><br>  StreamController&lt;<span class="hljs-built_in">List</span>&lt;JokeBean&gt;&gt; _resultController = StreamController.broadcast();<br>  Stream&lt;<span class="hljs-built_in">List</span>&lt;JokeBean&gt;&gt; <span class="hljs-keyword">get</span> outResultList =&gt; _resultController.stream;<br> <br>  <span class="hljs-comment">//å¤„ç†åˆ·æ–°å’ŒåŠ è½½æ›´å¤š</span><br>  StreamController&lt;<span class="hljs-built_in">bool</span>&gt; _indexController = StreamController&lt;<span class="hljs-built_in">bool</span>&gt;.broadcast();<br>  Sink&lt;<span class="hljs-built_in">bool</span>&gt; <span class="hljs-keyword">get</span> inJokesIndex =&gt; _indexController.sink;<br><br>  <span class="hljs-comment">//ä¿å­˜æ•°æ®</span><br>  <span class="hljs-built_in">List</span>&lt;JokeBean&gt; datas = [];<br>  <span class="hljs-keyword">var</span> pageNumber = <span class="hljs-number">1</span>;<br><br>  <span class="hljs-comment">//æ„é€ å‡½æ•°ï¼Œå¼€å§‹ç›‘å¬åˆ†é¡µä¿¡æ¯ï¼Œå› ä¸ºåœ¨JokeWithBLoCåˆ›å»ºçš„æ—¶å€™å°±æ·»åŠ äº†æ•°æ®</span><br>  NewsBLoC() &#123;<br>    _indexController.stream.listen(_handleIndex);<br>    <span class="hljs-comment">//é”™è¯¯å¤„ç†</span><br>    _resultController.addError(<br>            (error) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;_jokeResultController error-&gt;<span class="hljs-subst">$&#123;error.toString()&#125;</span>&quot;</span>));<br>    _indexController.addError(<br>            (error) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;_jokeIndexController error-&gt;<span class="hljs-subst">$&#123;error.toString()&#125;</span>&quot;</span>));<br>  &#125;<br><br><span class="hljs-comment">//åŠ è½½æ•°æ®</span><br>  <span class="hljs-keyword">void</span> _handleIndex(<span class="hljs-built_in">bool</span> isLoadMore) <span class="hljs-keyword">async</span> &#123;<br>    <span class="hljs-keyword">if</span> (isLoadMore) &#123;<br>      pageNumber++;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      pageNumber = <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-built_in">String</span> dataUrl =<br>        <span class="hljs-string">&quot;https://i.jandan.net/?oxwlxojflwblxbsapi=jandan.get_duan_comments&amp;page=<span class="hljs-subst">$pageNumber</span>&quot;</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>      Response&lt;<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;&gt; response = <span class="hljs-keyword">await</span> Dio().<span class="hljs-keyword">get</span>(dataUrl);<br>      <span class="hljs-keyword">if</span> (response.statusCode == <span class="hljs-number">200</span>) &#123;<br>        <span class="hljs-keyword">var</span> jokeModel = JokeModel.fromJson(response.data);<br>          <span class="hljs-keyword">if</span>(isLoadMore)&#123;<br>            datas.addAll(jokeModel.comments);<br>          &#125;<span class="hljs-keyword">else</span>&#123;<br>            datas = jokeModel.comments;<br>          &#125;<br>        <span class="hljs-comment">//æ•°æ®è¿”å›åæ·»åŠ åˆ°æµä¸­ï¼Œè¿™æ ·JokeWithBLoCä¸­StreamBuildä¼šè¢«è°ƒç”¨</span><br>          _resultController.add(datas);<br><br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>       showError();<br>      &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>      <span class="hljs-built_in">print</span>(e.toString());<br>    &#125;<br>  &#125;<br>    <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> dispose() &#123;<br>    <span class="hljs-comment">//åœ¨è¿™é‡Œå…³é—­æµ</span><br>  &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs dart"><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JokeWithBLoC</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  JokeBLoC jokeBLoC;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-comment">//è·å–åˆ°BLoC</span><br>    jokeBLoC = BLoCProvider.of&lt;JokeBLoC&gt;(context);<br>    ScrollController _scrollController = <span class="hljs-keyword">new</span> ScrollController();<br>    _scrollController.addListener(() &#123;<br>      <span class="hljs-keyword">if</span> (_scrollController.position.pixels ==<br>          _scrollController.position.maxScrollExtent) &#123;<br>        <span class="hljs-comment">//æ»‘åŠ¨ç›‘å¬ï¼Œé€šçŸ¥BLoCåŠ è½½ä¸‹ä¸€é¡µ</span><br>        jokeBLoC.inJokesIndex.add(<span class="hljs-keyword">true</span>);<br>      &#125;<br>    &#125;);<br>    <span class="hljs-comment">//é¡µé¢åˆ›å»ºæ—¶ï¼Œå¼€å§‹åŠ è½½æ•°æ®</span><br>    jokeBLoC.inJokesIndex.add(<span class="hljs-keyword">false</span>);<br><br>    <span class="hljs-keyword">return</span> RefreshIndicator(<br>      onRefresh: () =&gt; refresh(),<br>      child: StreamBuilder&lt;<span class="hljs-built_in">List</span>&lt;JokeBean&gt;&gt;(<br>        <span class="hljs-comment">//ç›‘å¬JokeBLoCä¸­çš„åŠ è½½æ•°æ®çš„æµä¿¡æ¯</span><br>          stream: jokeBLoC.outResultList,<br>          builder:<br>              (BuildContext context, AsyncSnapshot&lt;<span class="hljs-built_in">List</span>&lt;JokeBean&gt;&gt; snapshot) &#123;<br>                <span class="hljs-comment">//å½“æ•°æ®æ˜¯ç©ºçš„æ—¶å€™ï¼Œæ˜¾ç¤ºåŠ è½½åŠ¨ç”»ï¼Œè¿™é‡Œæœ‰ç‚¹é—®é¢˜ï¼šå½“è¯·æ±‚å‡ºé”™æ—¶æ²¡æœ‰è¿›è¡Œå¤„ç†ï¼Œä¼šä¸€ç›´æ˜¾ç¤ºåŠ¨ç”»</span><br>            <span class="hljs-keyword">if</span> (snapshot.data == <span class="hljs-keyword">null</span> || snapshot.data.isEmpty) &#123;<br>              <span class="hljs-keyword">return</span> SpinKitWave(<br>                  color: Colors.redAccent, type: SpinKitWaveType.start);<br>            &#125;<br><span class="hljs-comment">//æ„å»ºåˆ—è¡¨</span><br>            <span class="hljs-keyword">return</span> ListView.builder(<br>                controller: _scrollController,<br>                itemCount: snapshot.data == <span class="hljs-keyword">null</span> ? <span class="hljs-number">1</span> : snapshot.data.length + <span class="hljs-number">1</span>,<br>                itemBuilder: (BuildContext context, <span class="hljs-built_in">int</span> position) &#123;<br>                  <span class="hljs-keyword">return</span> _getRow(context, snapshot.data, position);<br>                &#125;);<br>          &#125;),<br>    );<br>  &#125;<br><br>  Future&lt;<span class="hljs-keyword">void</span>&gt; refresh() <span class="hljs-keyword">async</span> &#123;<br>    jokeBLoC.inJokesIndex.add(<span class="hljs-keyword">false</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªå¤§ä½¬å†™çš„<a href="https://github.com/boeledi/Streams-Block-Reactive-Programming-in-Flutter">https://github.com/boeledi/Streams-Block-Reactive-Programming-in-Flutter</a></p><p>æƒ³è¦è·‘èµ·æ¥éœ€è¦è‡ªå·±å»ç”³è¯·ä¸€ä¸ªkeyï¼Œå…·ä½“çœ‹<code>tmdb_api.dart</code></p><p>è¿™æ˜¯æˆ‘å†™çš„ <a href="https://github.com/huangyuanlove/JanDan_flutter">https://github.com/huangyuanlove/JanDan_flutter</a></p><p><strong>ä¸è¦è¿‡åº¦è®¾è®¡ä½ çš„ä»£ç </strong></p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>flutteræ€§èƒ½ç“¶é¢ˆ</title>
    <link href="/2019/04/18/flutter%E6%80%A7%E8%83%BD%E7%93%B6%E9%A2%88/"/>
    <url>/2019/04/18/flutter%E6%80%A7%E8%83%BD%E7%93%B6%E9%A2%88/</url>
    
    <content type="html"><![CDATA[<p>è·Ÿç€è§†é¢‘è‡ªå·±åšäº†ä¸€ä¸‹ï¼Œ<a href="https://www.bilibili.com/video/av48772383">https://www.bilibili.com/video/av48772383</a></p><p>æˆ‘åœ¨Bç«™å­¦flutterè°ƒä¼˜ã€‚ã€‚ã€‚ã€‚</p><ol><li>å¦‚ä½•åˆ†æFlutter å¯¹Skiaçš„è°ƒç”¨ </li><li>å¦‚ä½•æ•æ‰SK Pictureæ¥åˆ†ææ¯ä¸€æ¡ç»˜å›¾æŒ‡ä»¤ </li><li>å¸¸è§Skiaå‡½æ•°è°ƒç”¨æ€§èƒ½ç“¶é¢ˆ</li></ol><span id="more"></span><h4 id="å¦‚ä½•åˆ†æFlutter-å¯¹Skiaçš„è°ƒç”¨"><a href="#å¦‚ä½•åˆ†æFlutter-å¯¹Skiaçš„è°ƒç”¨" class="headerlink" title="å¦‚ä½•åˆ†æFlutter å¯¹Skiaçš„è°ƒç”¨"></a>å¦‚ä½•åˆ†æFlutter å¯¹Skiaçš„è°ƒç”¨</h4><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">flutter <span class="hljs-built_in">run</span> <span class="hljs-comment">--profile --trace-skia</span><br></code></pre></td></tr></table></figure><p><img src="/image/flutter/trace_skia.png" alt="flutter run --profile --trace-skia"> </p><p><strong>å¯åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹</strong><br>æ‰“å¼€ä¸Šå›¾çš„ä¸­åœ°å€</p><p><img src="/image/flutter/trace_skia_view.png" alt="trace_skia_view"> </p><p><strong>å…¨é€‰ä¸€ä¸‹</strong> </p><p><img src="/image/flutter/trace_skia_timeline.png" alt="trace_skia_timeline.png"> </p><p><strong>æ“ä½œä¸€ä¸‹åº”ç”¨ï¼Œç„¶åç‚¹å‡»æµè§ˆå™¨åˆä¸Šè§’Refresh</strong> </p><p><img src="/image/flutter/skia_invoke.png" alt="skia_invoke"> </p><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°æœ€åº•å±‚çš„skiaå‡½æ•°è°ƒç”¨æƒ…å†µã€‚<br>å¾ˆå¤šåŒå­¦é—®æ€ä¹ˆæ”¾å¤§å‡½æ•°è°ƒç”¨çš„æ—¶é—´åŒºåŸŸ(æŠŠæ—¶é—´çº¿åŠ é•¿)<br><img src="/image/flutter/trace_skia_tools.png" alt="skia_invoke"><br>è¿™é‡Œæœ‰å››ä¸ªé€‰é¡¹ï¼Œ<br>ç¬¬ä¸€ä¸ªæ˜¯é€‰æ‹©åŒºåŸŸï¼Œå½“ä½ é€‰ä¸­è¿™ä¸ªé€‰é¡¹ï¼Œç„¶åæŒ‰ä½é¼ æ ‡å·¦é”®åœ¨æ—¶é—´çº¿ä¸Šé€‰æ‹©ï¼Œå°±å¯ä»¥é€‰ä¸­ä¸€æ®µæ—¶é—´ï¼Œå’ŒPSä¸­çš„åŒºåŸŸé€‰æ‹©å·¥å…·å¾ˆåƒã€‚<br>ç¬¬äºŒä¸ªæ˜¯ç§»åŠ¨åŒºåŸŸï¼Œå½“ä½ é€‰ä¸­è¿™ä¸ªé€‰é¡¹ï¼Œç„¶åæŒ‰ä½é¼ æ ‡å·¦é”®åœ¨ä¸‹é¢æœ‰é¢œè‰²çš„åœ°æ–¹æ‹–åŠ¨ï¼Œå°±å¯ä»¥æ‹–åŠ¨æ—¶é—´çº¿<br>ç¬¬ä¸‰ä¸ªæ˜¯æ”¾å¤§ç¼©å°ï¼Œå½“ä½ é€‰ä¸­è¿™ä¸ªé€‰é¡¹ï¼Œç„¶åæŒ‰ä½é¼ æ ‡å·¦é”®åœ¨ä¸‹é¢æœ‰é¢œè‰²çš„åœ°æ–¹å‘ä¸Šæ‹–åŠ¨æ˜¯æ”¾å¤§ï¼Œå‘ä¸‹æ‹–åŠ¨æ˜¯ç¼©å°ã€‚<br>ç¬¬å››ä¸ªæ˜¯åŒºåŸŸé€‰æ‹©ï¼Œå½“ä½ é€‰ä¸­è¿™ä¸ªé€‰é¡¹ï¼Œç„¶åæŒ‰ä½é¼ æ ‡å·¦é”®åœ¨ä¸‹é¢æœ‰é¢œè‰²çš„åœ°æ–¹æ‹–åŠ¨ï¼Œå¯ä»¥ç»Ÿè®¡é€‰æ‹©çš„åŒºåŸŸæ€»å…±æ˜¯å¤šé•¿æ—¶é—´ã€‚</p><h4 id="å¦‚ä½•æ•æ‰SK-Pictureæ¥åˆ†ææ¯ä¸€æ¡ç»˜å›¾æŒ‡ä»¤"><a href="#å¦‚ä½•æ•æ‰SK-Pictureæ¥åˆ†ææ¯ä¸€æ¡ç»˜å›¾æŒ‡ä»¤" class="headerlink" title="å¦‚ä½•æ•æ‰SK Pictureæ¥åˆ†ææ¯ä¸€æ¡ç»˜å›¾æŒ‡ä»¤"></a>å¦‚ä½•æ•æ‰SK Pictureæ¥åˆ†ææ¯ä¸€æ¡ç»˜å›¾æŒ‡ä»¤</h4><p><strong>æ¥ä¸Šä¸€æ­¥</strong> </p><p>è¿™é‡Œçš„portæ˜¯æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹çš„ç«¯å£ </p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">flutter screenshot <span class="hljs-attribute">--type</span>=skia <span class="hljs-attribute">--observatory-port</span>=&lt;port&gt;<br></code></pre></td></tr></table></figure><p><img src="/image/flutter/flutter_screenshot.png" alt="flutter screenshot"> </p><p>è¿™é‡Œä¼šç”Ÿæˆä¸€ä¸ªskpæ–‡ä»¶ï¼Œæ–‡ä»¶å¯ä»¥åœ¨<a href="https://debugger.skia.org/">https://debugger.skia.org/</a> è¿™é‡Œè¿›è¡Œåˆ†æã€‚å¦‚æœç½‘ç»œä¸å¥½çš„è¯å¯ä»¥åœ¨æœ¬åœ°èµ·ä¸€ä¸ªæœåŠ¡ï¼Œéœ€è¦è‡ªå·±ç¼–è¯‘ä¸€ä¸‹skiaã€‚ </p><p><strong>éœ€fq</strong> </p><ol><li>ä¸‹è½½depot_toolså¹¶è®¾ç½®ç¯å¢ƒå˜é‡</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone &#x27;https://chromium.googlesource.com/chromium/tools/depot_tools.git&#x27;<br>export PATH=&quot;$&#123;PWD&#125;/depot_tools:$&#123;PATH&#125;&quot; <br></code></pre></td></tr></table></figure><ol start="2"><li><p>ä¸‹è½½skiaå¹¶ä¸”æ›´æ–° </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://skia.googlesource.com/skia.git <br>cd skia <br>python tools/git-sync-deps <br></code></pre></td></tr></table></figure></li><li><p>ç¼–è¯‘</p></li></ol><p>ä½¿ç”¨GNç”Ÿæˆæ„å»ºæ–‡ä»¶ </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">bin/gn gen out/Static --args=&#x27;is_official_build=true&#x27; <br>bin/gn gen out/Shared --args=&#x27;is_official_build=true is_component_build=true&#x27; <br></code></pre></td></tr></table></figure><p>GNä¹Ÿæ”¯æŒæ›´ç»†ç²’åº¦çš„é…ç½® </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">bin/gn gen out/Debug <br>bin/gn gen out/Release --args=&#x27;is_debug=false&#x27; <br>bin/gn gen out/Clang --args=&#x27;cc=&quot;clang&quot; cxx=&quot;clang++&quot;&#x27; <br>bin/gn gen out/Cached --args=&#x27;cc_wrapper=&quot;ccache&quot;&#x27; <br>bin/gn gen out/RTTI --args=&#x27;extra_cflags_cc=[&quot;-frtti&quot;]&#x27; <br></code></pre></td></tr></table></figure><ol start="4"><li>ç¼–è¯‘å¹¶å¯åŠ¨æœ¬åœ°æœåŠ¡</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">Build.</span> <br>ninja -C out/Release skiaserve <br><span class="hljs-meta prompt_"># </span><span class="language-bash">Run the debugger locally</span> <br><span class="hljs-meta prompt_"># </span><span class="language-bash">By default the address will be</span> <br><span class="hljs-meta prompt_"># </span><span class="language-bash">http://127.0.0.1:8888</span> <br>out/Release/skiaserve <br></code></pre></td></tr></table></figure><p>skiaç¼–è¯‘æ•™ç¨‹<a href="https://skia.org/dev/tools/debugger">https://skia.org/dev/tools/debugger</a><br>é€‰æ‹©ä¸Šä¸€æ­¥å¯¼å‡ºçš„spkæ–‡ä»¶å¹¶ä¸Šä¼ ï¼Œ</p><p><img src="/image/flutter/skia_debugger.png" alt="skp"> </p><p>å¯ä»¥åˆ†ææ¯ä¸€æ­¥è¿›è¡Œäº†å“ªäº›æ“ä½œï¼Œæœ‰å“ªäº›é‡å¤ç»˜åˆ¶ </p><h4 id="å¸¸è§Skiaå‡½æ•°è°ƒç”¨æ€§èƒ½ç“¶é¢ˆ"><a href="#å¸¸è§Skiaå‡½æ•°è°ƒç”¨æ€§èƒ½ç“¶é¢ˆ" class="headerlink" title="å¸¸è§Skiaå‡½æ•°è°ƒç”¨æ€§èƒ½ç“¶é¢ˆ"></a>å¸¸è§Skiaå‡½æ•°è°ƒç”¨æ€§èƒ½ç“¶é¢ˆ</h4><p>saveLayerã€clipPath å‡½æ•°<br>åŸºæœ¬éƒ½æ˜¯flutterè‡ªå·±çš„æ§ä»¶è°ƒç”¨çš„ </p><h4 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h4><p>Skiaæœ‰ä¸¤å¥—å¾ˆä¸åŒçš„åç«¯ï¼ŒFlutter åœ¨iOSæ¨¡æ‹Ÿå™¨ä¸­ä½¿ç”¨çº¯cpuçš„åç«¯ï¼Œè€Œå®é™…è®¾å¤‡ä¸€èˆ¬ä½¿ç”¨GPUç¡¬ä»¶åŠ é€Ÿåç«¯ï¼Œæ‰€ä»¥æ€§èƒ½å¾ˆä¸ä¸€æ · </p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é€‚é…Androidé«˜ç‰ˆæœ¬ç³»ç»Ÿå¸¸è§é—®é¢˜</title>
    <link href="/2019/04/17/%E9%80%82%E9%85%8DAndroid%E9%AB%98%E7%89%88%E6%9C%AC%E7%B3%BB%E7%BB%9F%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/"/>
    <url>/2019/04/17/%E9%80%82%E9%85%8DAndroid%E9%AB%98%E7%89%88%E6%9C%AC%E7%B3%BB%E7%BB%9F%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p>Android P,Q ç‰ˆæœ¬é€‚é…å¸¸è§é—®é¢˜</p><p>é¡¹ç›®åœ°å€ <a href="https://github.com/huangyuanlove/AdaptationAndroidP">https://github.com/huangyuanlove/AdaptationAndroidP</a></p><ol><li>æ–‡ä»¶æ“ä½œ</li><li>æ‹ç…§é€‰æ‹©å›¾ç‰‡</li><li>å­˜å‚¨è®¿é—®æ¡†æ¶(SAF)</li><li>é€šçŸ¥</li><li>æƒé™ç”³è¯·</li><li>å¿«æ·æ–¹å¼</li></ol><span id="more"></span><p>Android P,Q ç‰ˆæœ¬é€‚é…å¸¸è§é—®é¢˜</p><p>é¡¹ç›®åœ°å€ <a href="https://github.com/huangyuanlove/AdaptationAndroidP">https://github.com/huangyuanlove/AdaptationAndroidP</a></p><h4 id="æ–‡ä»¶æ“ä½œ-FileOperationActivity"><a href="#æ–‡ä»¶æ“ä½œ-FileOperationActivity" class="headerlink" title="æ–‡ä»¶æ“ä½œ(FileOperationActivity)"></a>æ–‡ä»¶æ“ä½œ(FileOperationActivity)</h4><p>å…ˆçœ‹å‡ ä¸ªå¸¸ç”¨çš„æ–‡ä»¶è·¯å¾„ï¼Œè¿™é‡Œè¯´æ˜ä¸€ä¸‹ï¼Œåº”ç”¨çš„idæ˜¯<code>com.huangyuanlove.adaptationhighversion</code></p><ul><li><p><strong>getFilesDir()</strong></p><p>å¾—åˆ°çš„è·¯å¾„æ˜¯ <code>/data/user/0/com.huangyuanlove.adaptationhighversion/files</code>,è¯»å†™è¯¥æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶<strong>ä¸éœ€è¦</strong>ç”³è¯·æ–‡ä»¶è¯»å†™æƒé™ã€‚å¸è½½åº”ç”¨æ—¶<strong>ä¼šè¢«åˆ é™¤</strong>ã€‚å¯¹ç”¨æˆ·<strong>ä¸å¯è§</strong>ï¼Œæˆ‘ä»¬åœ¨AndroidStudioä¸­ä½¿ç”¨<code>Device File Explorer</code>æŸ¥çœ‹æ˜¯åœ¨<code>/data/data/com.huangyuanlove.adaptationhighversion/files</code></p></li><li><p><strong>getCacheDir()</strong><br>å¾—åˆ°çš„è·¯å¾„æ˜¯<code>/data/user/0/com.huangyuanlove.adaptationhighversion/cache</code>ï¼Œè¯»å†™è¯¥æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶<strong>ä¸éœ€è¦</strong>ç”³è¯·æ–‡ä»¶è¯»å†™æƒé™ã€‚å¸è½½åº”ç”¨æ—¶<strong>ä¼šè¢«åˆ é™¤</strong>ã€‚å¯¹ç”¨æˆ·<strong>ä¸å¯è§</strong>ï¼Œæˆ‘ä»¬åœ¨AndroidStudioä¸­ä½¿ç”¨<code>Device File Explorer</code>æŸ¥çœ‹æ˜¯åœ¨<code>/data/data/com.huangyuanlove.adaptationhighversion/cache</code></p></li><li><p>getExternalCacheDir()</p><p>å¾—åˆ°çš„è·¯å¾„æ˜¯<code>/storage/emulated/0/Android/data/com.huangyuanlove.adaptationhighversion/cache</code></p><p>è¯»å†™è¯¥æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶<strong>ä¸éœ€è¦</strong>ç”³è¯·æ–‡ä»¶è¯»å†™æƒé™ã€‚å¸è½½åº”ç”¨æ—¶<strong>ä¼šè¢«åˆ é™¤</strong>ã€‚å¯¹ç”¨æˆ·<strong>å¯è§</strong>ï¼Œæ— æ³•ä½¿ç”¨<code>Device File Explorer</code>æŸ¥çœ‹ï¼Œå› ä¸º<code>/storage/emulated</code>ä¸‹çš„æ–‡ä»¶æ²¡æœ‰æ“ä½œæƒé™ï¼Œå¯ä»¥ç”¨è¿‡<code>adb shell</code>åˆ‡æ¢è¿›å»æŸ¥çœ‹ï¼Œè·¯å¾„ä¸º<code>/storage/emulated/0/Android/data/com.huangyuanlove.adaptationhighversion/cache</code>ã€‚ç”¨æˆ·ä½¿ç”¨æ‰‹æœºçš„æ–‡ä»¶ç®¡ç†å™¨æŸ¥çœ‹æ—¶è·¯å¾„ä¸º<code>/Android/data/com.huangyuanlove.adaptationhighversion/cache</code></p></li><li><p>getExternalFilesDir(null)</p><p>å¾—åˆ°çš„è·¯å¾„æ˜¯<code>/storage/emulated/0/Android/data/com.huangyuanlove.adaptationhighversion/files</code>,</p><p>è¯»å†™è¯¥æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶<strong>ä¸éœ€è¦</strong>ç”³è¯·æ–‡ä»¶è¯»å†™æƒé™ã€‚å¸è½½åº”ç”¨æ—¶<strong>ä¼šè¢«åˆ é™¤</strong>ã€‚å¯¹ç”¨æˆ·<strong>å¯è§</strong>ï¼Œæ— æ³•ä½¿ç”¨<code>Device File Explorer</code>æŸ¥çœ‹ï¼Œå› ä¸º<code>/storage/emulated</code>ä¸‹çš„æ–‡ä»¶æ²¡æœ‰æ“ä½œæƒé™ï¼Œå¯ä»¥ç”¨è¿‡<code>adb shell</code>åˆ‡æ¢è¿›å»æŸ¥çœ‹ï¼Œè·¯å¾„ä¸º<code>/storage/emulated/0/Android/data/com.huangyuanlove.adaptationhighversion/file</code>ã€‚ç”¨æˆ·ä½¿ç”¨æ‰‹æœºçš„æ–‡ä»¶ç®¡ç†å™¨æŸ¥çœ‹æ—¶è·¯å¾„ä¸º<code>/Android/data/com.huangyuanlove.adaptationhighversion/file</code></p></li><li><p>Environment.getExternalStorageDirectory();</p><p>å¾—åˆ°çš„è·¯å¾„æ˜¯<code>/storage/emulated/0</code></p><p>è¯»å†™è¯¥æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶<strong>éœ€è¦</strong>ç”³è¯·æ–‡ä»¶è¯»å†™æƒé™ã€‚å¸è½½åº”ç”¨æ—¶ä¸ä¼šè¢«åˆ é™¤ã€‚å¯¹ç”¨æˆ·<strong>å¯è§</strong>ï¼Œä¹Ÿå°±æ˜¯å¤–éƒ¨å­˜å‚¨çš„æ ¹è·¯å¾„ã€‚</p></li><li><p>Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DOWNLOADS);</p><p>å¾—åˆ°çš„è·¯å¾„æ˜¯<code>/storage/emulated/0/Download</code></p><p>è¯¥æ–¹æ³•çš„å‚æ•°å¯ä»¥æŸ¥çœ‹<code>Environment</code>ç±»æ¥è¯¦ç»†äº†è§£ã€‚è¯»å†™è¯¥æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶<strong>ä¸éœ€è¦</strong>ç”³è¯·æ–‡ä»¶è¯»å†™æƒé™ã€‚å¸è½½åº”ç”¨æ—¶ä¸ä¼šè¢«åˆ é™¤ã€‚å¯¹ç”¨æˆ·å¯ä»¥ï¼Œä¸Šè¿°å°±æ˜¯å¤–éƒ¨å­˜å‚¨æ ¹è·¯å¾„ä¸‹çš„Downloadæ–‡ä»¶å¤¹ã€‚</p></li></ul><p>Pç‰ˆæœ¬åº”ç”¨åœ¨sdå¡æ ¹ç›®å½•ä¿å­˜çš„åº”ç”¨æ•°æ®å¸è½½æ—¶ä¸ä¼šè¢«æ¸…é™¤ï¼Œä½†æ˜¯Qç‰ˆæœ¬è¿™éƒ¨åˆ†æ•°æ®å®é™…ä¿å­˜çš„æ˜¯åº”ç”¨çš„æ²™ç®±ç›®å½• ä¸‹ï¼Œå¸è½½çš„æ—¶å€™å›å…¨éƒ¨è¢«æ¸…é™¤;<br>åº”ç”¨ä¸æƒ³å¸è½½åˆ é™¤çš„æ–‡ä»¶é€šè¿‡SAFæˆ–è€…æ˜¯MediaProviderçš„æ¥å£ä¿å­˜åœ¨å…¬å…±ç›®å½•ï¼Œä¸è¦æ”¾åœ¨åº”ç”¨çš„æ²™ç®±ç›®å½•ï¼Œå…¬å…±ç›®å½•æ–‡ä»¶å¸è½½åˆ é™¤é»˜è®¤ä¼šå¼¹æ¡†æç¤ºï¼Œå¯¹åº”å¼¹æ¡†çš„ç¬¬ä¸€ ä¸ªå‹¾é€‰ï¼Œé»˜è®¤ä¿ç•™ï¼Œå‹¾é€‰åˆ é™¤ï¼Œ<strong>è°·æ­Œåç»­çš„ç‰ˆæœ¬è®¡åˆ’æŠŠè¿™ ä¸ªå‹¾é€‰å»æ‰ï¼Œæ„å‘³ç€åº”ç”¨ä¿å­˜åˆ°å…¬å…±é›†åˆç›®å½•çš„æ–‡ä»¶å¸è½½ çš„æ—¶å€™ä¸ä¼šæç¤ºç”¨æˆ·åˆ é™¤</strong>;<br>å¯¹äºåº”ç”¨çš„æ²™ç®±æ–‡ä»¶ï¼Œåº”ç”¨å¦‚æœä¸æƒ³å¸è½½çš„æ—¶å€™è¢«åˆ é™¤ï¼Œéœ€è¦åº”ç”¨åœ¨manifestæ–‡ä»¶å¢åŠ :<application android:fragileUserData="true" />ï¼Œè¿™æ ·å¸è½½åº”ç”¨çš„æ—¶å€™ï¼Œç³»ç»Ÿå¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­æ‰ä¼šæœ‰ç¬¬äºŒä¸ªå‹¾é€‰æ¡†å‡ºç°(ä¸å¢åŠ è¯¥å±æ€§æ˜¯ä¸ä¼šæœ‰ç¬¬äºŒä¸ªå‹¾é€‰å‡ºç°)ï¼Œé»˜è®¤åˆ é™¤ï¼Œå‹¾é€‰ä¿ç•™ã€‚</p><p><img src="/image/Android/adaptation/uninstall_apk_dialog.png" alt="å¸è½½appæç¤º"></p><h4 id="æ‹ç…§ã€é€‰æ‹©å›¾ç‰‡-TakePhotoOrChoosePhotoActivity"><a href="#æ‹ç…§ã€é€‰æ‹©å›¾ç‰‡-TakePhotoOrChoosePhotoActivity" class="headerlink" title="æ‹ç…§ã€é€‰æ‹©å›¾ç‰‡(TakePhotoOrChoosePhotoActivity)"></a>æ‹ç…§ã€é€‰æ‹©å›¾ç‰‡(TakePhotoOrChoosePhotoActivity)</h4><p>åœ¨Android6.0åŠ¨æ€ç”³è¯·æƒé™ï¼ŒAndroid7.0ä¸¥æ ¼æ¨¡å¼ä¹‹åï¼Œæ‹ç…§å‡ºç°äº†é—®é¢˜ï¼Œè¦ä¹ˆæ˜¯æ²¡æœ‰æƒé™å­˜å‚¨å›¾ç‰‡ï¼Œè¦ä¹ˆæ˜¯è¿”å›çš„uriæ˜¯ç©ºçš„ï¼Œæˆ–è€…æŠ›å‡ºå¦‚ä¸‹å¼‚å¸¸ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">android.os.FileUriExposedException: file:<span class="hljs-comment">///storage/emulated/0/test.txt exposed beyond app through Intent.getData()</span><br>java.lang.SecurityException: Permission Denial: reading com.android.providers.media.MediaProvider uri<br></code></pre></td></tr></table></figure><p>å‡ºç°ä¸Šé¢çš„é—®é¢˜æ˜¯å› ä¸ºAndroid7.0æé«˜ç§æœ‰ç›®å½•çš„å®‰å…¨æ€§ï¼Œé˜²æ­¢åº”ç”¨ä¿¡æ¯çš„æ³„æ¼ï¼Œä» Android 7.0 å¼€å§‹ï¼Œåº”ç”¨ç§æœ‰ç›®å½•çš„è®¿é—®æƒé™è¢«åšé™åˆ¶ã€‚å…·ä½“è¡¨ç°ä¸ºï¼Œå¼€å‘äººå‘˜ä¸èƒ½å¤Ÿå†ç®€å•åœ°é€šè¿‡ file:&#x2F;&#x2F; URI è®¿é—®å…¶ä»–åº”ç”¨çš„ç§æœ‰ç›®å½•æ–‡ä»¶æˆ–è€…è®©å…¶ä»–åº”ç”¨è®¿é—®è‡ªå·±çš„ç§æœ‰ç›®å½•æ–‡ä»¶ã€‚å¯¹äºé¢å‘ Android 7.0 çš„åº”ç”¨ï¼ŒAndroid æ¡†æ¶æ‰§è¡Œçš„ StrictMode API æ”¿ç­–ç¦æ­¢åœ¨æ‚¨çš„åº”ç”¨å¤–éƒ¨å…¬å¼€ file:&#x2F;&#x2F; URIã€‚å¦‚æœä¸€é¡¹åŒ…å«æ–‡ä»¶ URI çš„ intent ç¦»å¼€æ‚¨çš„åº”ç”¨ï¼Œåˆ™åº”ç”¨å‡ºç°æ•…éšœï¼Œå¹¶å‡ºç° FileUriExposedException å¼‚å¸¸ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®FileProvideræ–¹å¼æ¥é¿å…è¿™ç§é—®é¢˜ã€‚</p><p>é…ç½®æ–¹å¼ç½‘ä¸Šä¸€å †ï¼Œè¿™é‡Œä¸å†æŠ„ä¸€éäº†ï¼š</p><p><a href="https://www.jianshu.com/p/ac5fe346a5b7">https://www.jianshu.com/p/ac5fe346a5b7</a></p><p><a href="https://www.jianshu.com/p/121bbb07cb07">https://www.jianshu.com/p/121bbb07cb07</a></p><p>åœ¨é¡¹ç›®ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-comment">//æŒ‡å®šUriï¼Œæ‹ç…§è¿”å›çš„dataä¸ºç©º</span><br><span class="hljs-type">String</span> <span class="hljs-variable">tempImagePath</span> <span class="hljs-operator">=</span> getFilesDir().getPath();<br>tempImageFile = File.createTempFile(<span class="hljs-string">&quot;image_&quot;</span>, <span class="hljs-string">&quot;.jpg&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(tempImagePath));<br><span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(MediaStore.ACTION_IMAGE_CAPTURE);<br><br><span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="hljs-number">24</span>) &#123;<br>  intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);<br>  intent.putExtra(MediaStore.EXTRA_OUTPUT,<br>  FileProvider.getUriForFile(TakePhotoOrChoosePhotoActivity.<span class="hljs-built_in">this</span>,<br>                                        <span class="hljs-string">&quot;com.huangyuanlove.adaptationhighversion.fileprovider&quot;</span>, tempImageFile));<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  intent.putExtra(MediaStore.EXTRA_OUTPUT, Uri.fromFile(tempImageFile));<br>&#125;<br>startActivityForResult(intent, TAKE_PHOTO_CODE);<br></code></pre></td></tr></table></figure><p>å½“æ‹ç…§è¿”å›ä¹‹å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">bitmap = BitmapFactory.decodeFile(tempImageFile.getPath());<br>showImage.setImageBitmap(bitmap);<br></code></pre></td></tr></table></figure><p>é€‰æ‹©å›¾ç‰‡çš„æ—¶å€™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Intent</span> <span class="hljs-variable">albumIntent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(Intent.ACTION_PICK);<br>albumIntent.setDataAndType(MediaStore.Images.Media.EXTERNAL_CONTENT_URI, <span class="hljs-string">&quot;image/*&quot;</span>);<br>startActivityForResult(albumIntent, CHOOSE_PHOTO_CODE);<br></code></pre></td></tr></table></figure><p>é€‰æ‹©å›¾ç‰‡è¿”å›çš„æ—¶å€™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (data != <span class="hljs-literal">null</span>) &#123;<br>  <span class="hljs-type">Uri</span> <span class="hljs-variable">selectedImage</span> <span class="hljs-operator">=</span> data.getData();<br>  String[] filePathColumn = &#123;MediaStore.Images.Media.DATA&#125;;<br><br>  <span class="hljs-type">Cursor</span> <span class="hljs-variable">cursor</span> <span class="hljs-operator">=</span> getContentResolver().query(selectedImage,<br>                                             filePathColumn, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>  cursor.moveToFirst();<br>  <span class="hljs-type">int</span> <span class="hljs-variable">columnIndex</span> <span class="hljs-operator">=</span> cursor.getColumnIndex(filePathColumn[<span class="hljs-number">0</span>]);<br>  <span class="hljs-type">String</span> <span class="hljs-variable">picturePath</span> <span class="hljs-operator">=</span> cursor.getString(columnIndex);<br>  cursor.close();<br><br>  bitmap = BitmapFactory.decodeFile(picturePath);<br>  showImage.setImageBitmap(bitmap);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="å­˜å‚¨è®¿é—®æ¡†æ¶-SAFActivity"><a href="#å­˜å‚¨è®¿é—®æ¡†æ¶-SAFActivity" class="headerlink" title="å­˜å‚¨è®¿é—®æ¡†æ¶(SAFActivity)"></a>å­˜å‚¨è®¿é—®æ¡†æ¶(SAFActivity)</h4><p>å®˜æ–¹æœ‰æœ€ä½³å®è·µï¼š<a href="https://developer.android.com/guide/topics/providers/document-provider?hl=zh-cn">https://developer.android.com/guide/topics/providers/document-provider?hl=zh-cn</a></p><h4 id="é€šçŸ¥ç®¡ç†-NotificationActivity"><a href="#é€šçŸ¥ç®¡ç†-NotificationActivity" class="headerlink" title="é€šçŸ¥ç®¡ç†(NotificationActivity)"></a>é€šçŸ¥ç®¡ç†(NotificationActivity)</h4><p>ä¸»è¦æ˜¯8.0ä¹‹åçš„NotificationChannelé—®é¢˜ï¼Œå¯ä»¥å‚è€ƒè¿™ä¸ª </p><p><a href="http://blog.huangyuanlove.com/2018/12/27/Android-O-%E9%80%82%E9%85%8DNotificationChannel/">http://blog.huangyuanlove.com/2018/12/27/Android-O-%E9%80%82%E9%85%8DNotificationChannel/</a></p><h4 id="æƒé™ç”³è¯·-MainActivity"><a href="#æƒé™ç”³è¯·-MainActivity" class="headerlink" title="æƒé™ç”³è¯·(MainActivity)"></a>æƒé™ç”³è¯·(MainActivity)</h4><p>6.0ä¹‹åçš„åŠ¨æ€æƒé™ç”³è¯·é—®é¢˜ã€‚å¤§éƒ¨åˆ†åº”ç”¨æ˜¯åœ¨åŸºç±»ä¸­ä¸€æ¬¡æ€§ç”³è¯·æ‰€æœ‰å¯èƒ½ç”¨åˆ°çš„æƒé™ï¼Œè€Œä¸å…³å¿ƒå½“å‰ç•Œé¢æ˜¯å¦éœ€è¦è¿™ä¸ªæƒé™ã€‚</p><p>æ¯”å¦‚åº”ç”¨ä¸­éœ€è¦ç”¨åˆ°ç›¸æœºã€è®¿é—®å­˜å‚¨ç©ºé—´ã€è¯»å†™é€šè®¯å½•ã€å½•éŸ³æƒé™ï¼Œåˆ™åœ¨BaseActivityä¸­å»ç”³è¯·è¿™å››ç§é«˜å±æƒé™ï¼Œè¿™ç§åšæ³•å¯¹å¼€å‘äººå‘˜æ¥è¯´æ¯”è¾ƒç®€å•ç²—æš´ï¼Œä¸éœ€è¦å…³å¿ƒæ¯æ¬¡ç‚¹å‡»äº‹ä»¶æ˜¯å¦æœ‰æƒé™ã€‚ä½†å¯¹äºç”¨æˆ·æ¥è®²ï¼Œåˆšæ‰“å¼€åº”ç”¨å°±ç”³è¯·è¿™ä¹ˆå¤šæƒé™ï¼Œä½“éªŒæ˜¯ä¸å¥½çš„ã€‚æ¨èåšæ³•è¿˜æ˜¯åœ¨éœ€è¦æ—¶å»ç”³è¯·æƒé™ã€‚</p><p>æ¯”å¦‚æ›´æ¢å¤´åƒæ—¶ï¼Œç‚¹å‡»æŒ‰é’®ä¹‹åæ‰ä¼šå»ç”³è¯·ç›¸æœºæƒé™ï¼Œè€Œä¸æ˜¯æ‰“å¼€èµ„æ–™è®¾ç½®ç•Œé¢çš„æ—¶å€™å»ç”³è¯·ã€‚å¹¶ä¸”å»ºè®®åªç”³è¯·ç”¨åˆ°çš„æƒé™ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å…¨éƒ¨ç”³è¯·ã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå›½äº§æ‰‹æœºä¸­å¯¹äºæƒé™çš„åˆ¤å®šå’Œåœ¨è®¾ç½®é‡Œé¢çœ‹åˆ°çš„æƒé™å¯èƒ½ä¸ä¸€è‡´ã€‚</p><ol><li><p>å½“æˆ‘ä»¬ç‚¹å‡»äº†æ‹ç…§æŒ‰é’®ä¹‹åï¼Œé¦–å…ˆæ£€æŸ¥æƒé™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">checkSelfPermission(Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED<br></code></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦åˆ¤æ–­ä¸€ä¸‹ç‰ˆæœ¬ï¼Œå¤§äº6.0(Build.VERSION.SDK_INT &gt;&#x3D; Build.VERSION_CODES.M)æ‰éœ€è¦å»åˆ¤æ–­ã€‚</p><p>æœ‰æƒé™ç›´æ¥åˆ°æ‹ç…§ç•Œé¢ï¼Œæ²¡æœ‰æƒé™åˆ™ç”³è¯·æƒé™ï¼š</p></li><li><p>ç”³è¯·æƒé™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">requestPermissions(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;Manifest.permission.CAMERA&#125;, REQUEST_PERMISSION_CAMERA);<br></code></pre></td></tr></table></figure></li><li><p>æƒé™ç”³è¯·è¿”å›ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java">   <br><span class="hljs-meta">@RequiresApi(api = Build.VERSION_CODES.M)</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onRequestPermissionsResult</span><span class="hljs-params">(<span class="hljs-type">int</span> requestCode, <span class="hljs-meta">@NonNull</span> String[] permissions, <span class="hljs-meta">@NonNull</span> <span class="hljs-type">int</span>[] grantResults)</span> &#123;<br>  <span class="hljs-built_in">super</span>.onRequestPermissionsResult(requestCode, permissions, grantResults);<br>  <span class="hljs-keyword">if</span> (permissions.length &lt;= <span class="hljs-number">0</span> || grantResults.length &lt;= <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-keyword">switch</span> (requestCode) &#123;<br>    <span class="hljs-keyword">case</span> REQUEST_PERMISSION_CAMERA:<br>      <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">permission</span> <span class="hljs-operator">=</span> permissions[<span class="hljs-number">0</span>];<br><br>      <span class="hljs-keyword">if</span> (grantResults.length &gt; <span class="hljs-number">0</span> &amp;&amp; grantResults[<span class="hljs-number">0</span>] ==<br>    PackageManager.PERMISSION_GRANTED) &#123;<br>        Toast.makeText(MainActivity.<span class="hljs-built_in">this</span>, <span class="hljs-string">&quot;æˆäºˆæ‹ç…§æƒé™æˆåŠŸ&quot;</span>, Toast.LENGTH_SHORT).show();<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">if</span> (shouldShowRequestPermissionRationale(permissions[<span class="hljs-number">0</span>])) &#123;<br>          <span class="hljs-comment">//ç”¨æˆ·åªç‚¹å‡»äº†ç¦æ­¢ï¼Œæ²¡æœ‰é€‰æ‹©ä¸å†æç¤º</span><br>          Toast.makeText(MainActivity.<span class="hljs-built_in">this</span>, <span class="hljs-string">&quot;ç”¨æˆ·ç¦æ­¢äº†&quot;</span> + permission + <span class="hljs-string">&quot;æƒé™&quot;</span>, Toast.LENGTH_SHORT).show();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-comment">//è§£é‡ŠåŸå› ï¼Œå¹¶ä¸”å¼•å¯¼ç”¨æˆ·è‡³è®¾ç½®é¡µæ‰‹åŠ¨æˆæƒ</span><br>          <span class="hljs-keyword">new</span> <span class="hljs-title class_">AlertDialog</span>.Builder(<span class="hljs-built_in">this</span>)<br>            .setMessage(<span class="hljs-string">&quot;ã€ç”¨æˆ·é€‰æ‹©äº†ä¸åœ¨æç¤ºæŒ‰é’®ï¼Œæˆ–è€…ç³»ç»Ÿé»˜è®¤ä¸åœ¨æç¤ºï¼ˆå¦‚MIUIï¼‰ã€‚&quot;</span> +<br>                        <span class="hljs-string">&quot;å¼•å¯¼ç”¨æˆ·åˆ°åº”ç”¨è®¾ç½®é¡µå»æ‰‹åŠ¨æˆæƒ,æ³¨æ„æç¤ºç”¨æˆ·å…·ä½“éœ€è¦å“ªäº›æƒé™ã€‘\r\n&quot;</span> +<br>                        <span class="hljs-string">&quot;è·å–ç›¸å…³æƒé™å¤±è´¥:xxxxxx,å°†å¯¼è‡´éƒ¨åˆ†åŠŸèƒ½æ— æ³•æ­£å¸¸ä½¿ç”¨ï¼Œéœ€è¦åˆ°è®¾ç½®é¡µé¢æ‰‹åŠ¨æˆæƒ&quot;</span>)<br>            .setPositiveButton(<span class="hljs-string">&quot;å»æˆæƒ&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">DialogInterface</span>.OnClickListener() &#123;<br>              <span class="hljs-meta">@Override</span><br>              <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(DialogInterface dialog, <span class="hljs-type">int</span> which)</span> &#123;<br>                <span class="hljs-comment">//å¼•å¯¼ç”¨æˆ·è‡³è®¾ç½®é¡µæ‰‹åŠ¨æˆæƒ</span><br>                <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(Settings.ACTION_APPLICATION_DETAILS_SETTINGS);<br>                <span class="hljs-type">Uri</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> Uri.fromParts(<span class="hljs-string">&quot;package&quot;</span>, getApplicationContext().getPackageName(), <span class="hljs-literal">null</span>);<br>                intent.setData(uri);<br>                startActivity(intent);<br>              &#125;<br>            &#125;)<br>            .setNegativeButton(<span class="hljs-string">&quot;å–æ¶ˆ&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">DialogInterface</span>.OnClickListener() &#123;<br>              <span class="hljs-meta">@Override</span><br>              <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(DialogInterface dialog, <span class="hljs-type">int</span> which)</span> &#123;<br>                <span class="hljs-comment">//å¼•å¯¼ç”¨æˆ·æ‰‹åŠ¨æˆæƒï¼Œæƒé™è¯·æ±‚å¤±è´¥</span><br>                Toast.makeText(MainActivity.<span class="hljs-built_in">this</span>, <span class="hljs-string">&quot;å¼•å¯¼æˆæƒå¤±è´¥:&quot;</span> + permission, Toast.LENGTH_LONG).show();<br>              &#125;<br>            &#125;).setOnCancelListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DialogInterface</span>.OnCancelListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCancel</span><span class="hljs-params">(DialogInterface dialog)</span> &#123;<br>              <span class="hljs-comment">//å¼•å¯¼ç”¨æˆ·æ‰‹åŠ¨æˆæƒï¼Œæƒé™è¯·æ±‚å¤±è´¥</span><br>              Toast.makeText(MainActivity.<span class="hljs-built_in">this</span>, <span class="hljs-string">&quot;å¼•å¯¼æˆæƒå¤±è´¥:&quot;</span> + permission, Toast.LENGTH_LONG).show();<br>            &#125;<br>          &#125;).show();<br>        &#125;<br>      &#125;<br><br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>      <span class="hljs-keyword">break</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®˜æ–¹æ–‡æ¡£è¯´ç¬¬ä¸€ç”³è¯·æƒé™çš„æ—¶å€™ä¸ä¼šæœ‰â€ç¦æ­¢åä¸å†è¯¢é—®â€çš„å¤é€‰æ¡†ï¼Œä½†æ˜¯åœ¨å¾ˆå¤šå›½å†…romä¸Šç¬¬ä¸€æ¬¡å°±ä¼šæœ‰è¿™ä¸ªæç¤ºã€‚å½“ç”¨æˆ·å‹¾é€‰äº†â€ç¦æ­¢åä¸å†è¯¢é—®â€ï¼Œè¿™æ—¶å€™æˆ‘ä»¬ç”³è¯·æƒé™ä¼šç«‹åˆ»è°ƒç”¨<code>onRequestPermissionsResult</code>æ–¹æ³•ï¼Œå¹¶ä¸”<code>shouldShowRequestPermissionRationale</code>è¿”å›falseã€‚è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦å¼•å¯¼ç”¨æˆ·åˆ°è®¾ç½®ç•Œé¢å¼€å¯æƒé™ã€‚</p></li></ol><h4 id="å¿«æ·æ–¹å¼-ShortCutActivity"><a href="#å¿«æ·æ–¹å¼-ShortCutActivity" class="headerlink" title="å¿«æ·æ–¹å¼(ShortCutActivity)"></a>å¿«æ·æ–¹å¼(ShortCutActivity)</h4><p>Android 7.1ä¹‹åæä¾›äº†å¿«æ·æ–¹å¼çš„APIï¼Œåœ¨é•¿æŒ‰åº”ç”¨å›¾æ ‡åä¼šå¼¹å‡ºå®šä¹‰çš„å¿«æ·æ–¹å¼(ä¸ªæ•°æœ‰é™)ã€‚ä½†åœ¨å›½äº§romä¸­æœ‰å¯èƒ½ä¼šæŠŠè¿™ä¸ªåŠŸèƒ½å¹²æ‰ã€‚</p><p>å¿«æ·æ–¹å¼æœ‰åˆ†ä¸ºåŠ¨æ€æ³¨å†Œå’Œé™æ€æ³¨å†Œ(é…ç½®æ–‡ä»¶)ï¼ŒåŠ¨æ€æ³¨å†Œçš„å¿«æ·æ–¹å¼å¯ä»¥åŠ¨æ€åˆ é™¤ï¼Œé™æ€æ³¨å†Œçš„å¿«æ·æ–¹å¼ä¸å¯åŠ¨æ€åˆ é™¤ã€‚</p><ol><li><p>é™æ€æ³¨å†Œ</p><p>åœ¨resæ–‡ä»¶å¤¹ä¸‹æ–°å»ºxmlæ–‡ä»¶å¤¹ï¼Œåœ¨å…¶ä¸­æ–°å»º<code>shortcuts.xml</code>,å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">shortcuts</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">shortcut</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:enabled</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:icon</span>=<span class="hljs-string">&quot;@mipmap/ic_launcher_round&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:shortcutDisabledMessage</span>=<span class="hljs-string">&quot;@string/permission_deny&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:shortcutId</span>=<span class="hljs-string">&quot;camera&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:shortcutLongLabel</span>=<span class="hljs-string">&quot;@string/take_photo_or_choose_image&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:shortcutShortLabel</span>=<span class="hljs-string">&quot;@string/camera&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">intent</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:action</span>=<span class="hljs-string">&quot;android.intent.action.VIEW&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:targetClass</span>=<span class="hljs-string">&quot;com.huangyuanlove.adaptationhighversion.TakePhotoOrChoosePhotoActivity&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:targetPackage</span>=<span class="hljs-string">&quot;com.huangyuanlove.adaptationhighversion&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">shortcut</span>&gt;</span><br><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">shortcut</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:enabled</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:icon</span>=<span class="hljs-string">&quot;@mipmap/ic_launcher_round&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:shortcutDisabledMessage</span>=<span class="hljs-string">&quot;@string/permission_deny&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:shortcutId</span>=<span class="hljs-string">&quot;about_file&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:shortcutLongLabel</span>=<span class="hljs-string">&quot;@string/file_example&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:shortcutShortLabel</span>=<span class="hljs-string">&quot;@string/file&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">intent</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:action</span>=<span class="hljs-string">&quot;android.intent.action.VIEW&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:targetClass</span>=<span class="hljs-string">&quot;com.huangyuanlove.adaptationhighversion.FileOperationActivity&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:targetPackage</span>=<span class="hljs-string">&quot;com.huangyuanlove.adaptationhighversion&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">shortcut</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">shortcut</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:enabled</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:icon</span>=<span class="hljs-string">&quot;@mipmap/ic_launcher_round&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:shortcutDisabledMessage</span>=<span class="hljs-string">&quot;@string/permission_deny&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:shortcutId</span>=<span class="hljs-string">&quot;notification_example&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:shortcutLongLabel</span>=<span class="hljs-string">&quot;@string/notification_example&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:shortcutShortLabel</span>=<span class="hljs-string">&quot;@string/notification&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">intent</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:action</span>=<span class="hljs-string">&quot;android.intent.action.VIEW&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:targetClass</span>=<span class="hljs-string">&quot;com.huangyuanlove.adaptationhighversion.NotificationActivity&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:targetPackage</span>=<span class="hljs-string">&quot;com.huangyuanlove.adaptationhighversion&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">shortcut</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">shortcut</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:enabled</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:icon</span>=<span class="hljs-string">&quot;@mipmap/ic_launcher_round&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:shortcutDisabledMessage</span>=<span class="hljs-string">&quot;@string/permission_deny&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:shortcutId</span>=<span class="hljs-string">&quot;saf_example&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:shortcutLongLabel</span>=<span class="hljs-string">&quot;@string/saf_example&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:shortcutShortLabel</span>=<span class="hljs-string">&quot;@string/saf&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">intent</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:action</span>=<span class="hljs-string">&quot;android.intent.action.VIEW&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:targetClass</span>=<span class="hljs-string">&quot;com.huangyuanlove.adaptationhighversion.SAFActivity&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:targetPackage</span>=<span class="hljs-string">&quot;com.huangyuanlove.adaptationhighversion&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">shortcut</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">shortcuts</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯<code>shortcutDisabledMessage</code>ã€<code>shortcutLongLabel</code>ã€<code>shortcutShortLabel</code>å±æ€§å€¼åªèƒ½ä½¿ç”¨å¼•ç”¨ï¼Œä¸èƒ½ç›´æ¥ç¡¬ç¼–ç ã€‚<code>shortcutLongLabel</code>æ˜¯åœ¨é•¿æŒ‰å›¾æ ‡æ—¶å¼¹å‡ºçš„å¿«æ·æ–¹å¼åç§°ï¼Œ<code>shortcutShortLabel</code>æ˜¯è®²è¯¥å¿«æ·æ–¹å¼æ‹–æ”¾åˆ°æ¡Œé¢åæ˜¾ç¤ºçš„åç§°ã€‚<code>shortcutId</code>æ˜¯è¯¥å¿«æ·æ–¹å¼çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</p><p>ç„¶ååœ¨<code>AndroidManifest.xml</code>æ–‡ä»¶ä¸­é…ç½®ä¸€ä¸‹ï¼Œæ‰¾åˆ°ä¸€ä¸ªActivityï¼Œå…¶<code>intent-filter</code>è¢«è®¾ç½®ä¸º<code>android.intent.action.MAIN</code>å’Œ<code>android.intent.category.LAUNCHER</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">activity</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;.MainActivity&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.intent.action.VIEW&quot;</span> /&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">category</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta-data</span></span><br><span class="hljs-tag">             <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.app.shortcuts&quot;</span></span><br><span class="hljs-tag">             <span class="hljs-attr">android:resource</span>=<span class="hljs-string">&quot;@xml/shortcuts&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">activity</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>åŠ¨æ€æ³¨å†Œ</p></li></ol><p>ç®—äº†ï¼Œçœ‹ä»£ç å§</p><p>æ·»åŠ æ–°çš„å¿«æ·æ–¹å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addShortcut</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N_MR1) &#123;<br>            <span class="hljs-type">ShortcutManager</span> <span class="hljs-variable">shortcutManager</span> <span class="hljs-operator">=</span> getSystemService(ShortcutManager.class);<br>            <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(ShortCutActivity.<span class="hljs-built_in">this</span>,ShortCutActivity.class);<br>            intent.setAction(Intent.ACTION_VIEW);<br>            <span class="hljs-type">ShortcutInfo</span> <span class="hljs-variable">shortcut</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShortcutInfo</span>.Builder(ShortCutActivity.<span class="hljs-built_in">this</span>, <span class="hljs-string">&quot;shortcut&quot;</span>)<br>                    .setIcon(Icon.createWithResource(<span class="hljs-built_in">this</span>, R.mipmap.ic_launcher))<br>                    .setShortLabel( getString( R.string.shortcut))<br>                    .setLongLabel(getString(R.string.shortcut_example))<br>                    .setIntent(intent)<br>                    .build();<br>            shortcutManager.addDynamicShortcuts(Arrays.asList( <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShortcutInfo</span>[]&#123; shortcut&#125;));<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>æ›´æ–°å¿«æ·æ–¹å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateShortcut</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N_MR1) &#123;<br>            <span class="hljs-type">ShortcutManager</span> <span class="hljs-variable">shortcutManager</span> <span class="hljs-operator">=</span> getSystemService(ShortcutManager.class);<br>            <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(ShortCutActivity.<span class="hljs-built_in">this</span>,ShortCutActivity.class);<br>            intent.setAction(Intent.ACTION_VIEW);<br>            <span class="hljs-type">ShortcutInfo</span> <span class="hljs-variable">shortcut</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShortcutInfo</span>.Builder(ShortCutActivity.<span class="hljs-built_in">this</span>, <span class="hljs-string">&quot;shortcut&quot;</span>)<br>                    .setIcon(Icon.createWithResource(<span class="hljs-built_in">this</span>, R.mipmap.ic_launcher))<br>                    .setShortLabel( getString( R.string.shortcut) +<span class="hljs-string">&quot;new&quot;</span>)<br>                    .setLongLabel(getString(R.string.shortcut_example) +<span class="hljs-string">&quot;new&quot;</span>)<br>                    .setIntent(intent)<br>                    .build();<br>            shortcutManager.updateShortcuts(Arrays.asList( <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShortcutInfo</span>[]&#123; shortcut&#125;));<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>åˆ é™¤å¿«æ·æ–¹å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeShortcut</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N_MR1) &#123;<br>            <span class="hljs-type">ShortcutManager</span> <span class="hljs-variable">shortcutManager</span> <span class="hljs-operator">=</span> getSystemService(ShortcutManager.class);<br><br>            <span class="hljs-comment">//åŠ¨æ€æ·»åŠ å¹¶ä¸”åœ¨æ¡Œé¢åˆ›å»ºäº†å¿«æ·æ–¹å¼ï¼Œåˆ é™¤ä¹‹å‰ï¼Œå…ˆdisableä¸€ä¸‹.  æˆ–è€…åˆ¤æ–­</span><br>            List&lt;ShortcutInfo&gt; shortcutInfos = shortcutManager.getPinnedShortcuts();<br>            <br>            <span class="hljs-keyword">for</span>(ShortcutInfo si : shortcutInfos)&#123;<br>                <span class="hljs-keyword">if</span>(si.getId().equals(<span class="hljs-string">&quot;shortcut&quot;</span>))&#123;<br>                    shortcutManager.disableShortcuts(Arrays.asList(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;shortcut&quot;</span>&#125;));<br>                &#125;<br>            &#125;<br>            shortcutManager.removeDynamicShortcuts(Arrays.asList(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;shortcut&quot;</span>&#125;));<br><br>            Toast.makeText(ShortCutActivity.<span class="hljs-built_in">this</span>,<span class="hljs-string">&quot;å…±&quot;</span> + shortcutInfos.size() +<span class="hljs-string">&quot;ä¸ªæ¡Œé¢å¿«æ·æ–¹å¼&quot;</span>,Toast.LENGTH_SHORT).show();<br><br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>è¢«æ·»åŠ åˆ°æ¡Œé¢çš„å¿«æ·æ–¹å¼æ— æ³•åˆ é™¤(å¯ä»¥ä»é•¿æŒ‰èœå•ä¸­åˆ é™¤ï¼Œä½†æ˜¯æ¡Œé¢ä¸Šå›¾æ ‡æ— æ³•åˆ é™¤ï¼Œä¾ç„¶æœ‰æ•ˆ)ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆæŸ¥è¯¢ä¸€ä¸ªæ¡Œé¢å¿«æ·æ–¹å¼æœ‰æ²¡æœ‰æˆ‘ä»¬è¦åˆ é™¤çš„ï¼Œå¦‚æœæœ‰ï¼Œå…ˆè®¾ç½®ä¸ºä¸å¯ä»¥ï¼Œç”±ç”¨æˆ·æ‰‹åŠ¨åˆ é™¤ã€‚è®¾ç½®ä¸ºä¸å¯ç”¨æ—¶å¯ä»¥æ·»åŠ ç‚¹å‡»æç¤ºè¯­(disableShortcutsçš„é‡è½½æ–¹æ³•)</p><p>æŒç»­æ›´æ–°</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>flutter-Androidæ··ç¼–åŠäº’ç›¸è°ƒç”¨</title>
    <link href="/2019/03/13/flutter-Android%E6%B7%B7%E7%BC%96%E5%8F%8A%E4%BA%92%E7%9B%B8%E8%B0%83%E7%94%A8/"/>
    <url>/2019/03/13/flutter-Android%E6%B7%B7%E7%BC%96%E5%8F%8A%E4%BA%92%E7%9B%B8%E8%B0%83%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>åŸºæœ¬å’Œå®˜ç½‘ä¸€æ¯›ä¸€æ ·ã€‚ã€‚ã€‚ã€‚çœ‹äº†å®˜ç½‘å°±ä¸ç”¨çœ‹è¿™ä¸ªäº†ï¼Œçœ‹äº†ä¹Ÿæ˜¯æµªè´¹æ—¶é—´ï¼Œæˆ‘ä¹Ÿå†™ä¸å‡ºèŠ±æ¥</p><span id="more"></span><h4 id="åˆ›å»ºflutter-module"><a href="#åˆ›å»ºflutter-module" class="headerlink" title="åˆ›å»ºflutter module"></a>åˆ›å»ºflutter module</h4><p>å‘½ä»¤è¡Œæ‰§è¡Œ <code>flutter create -t module flutter_module</code>æˆ–è€…ç›´æ¥ä½¿ç”¨ASåˆ›å»ºã€‚<br>è·¯å¾„å¯ä»¥å’Œä½ çš„å·¥ç¨‹å¹³çº§ï¼Œä¹Ÿå¯ä»¥æ˜¯å·¥ç¨‹çš„å­çº§ã€‚åªæ˜¯åœ¨é…ç½®<code>setting.gradle</code>æ—¶æ³¨æ„ä¸€ä¸‹æ–‡ä»¶å¤¹ä½ç½®å°±å¥½ã€‚</p><h4 id="ä¿®æ”¹å·¥ç¨‹çš„-setting-gradle"><a href="#ä¿®æ”¹å·¥ç¨‹çš„-setting-gradle" class="headerlink" title="ä¿®æ”¹å·¥ç¨‹çš„ setting.gradle"></a>ä¿®æ”¹å·¥ç¨‹çš„ setting.gradle</h4><p>æ·»åŠ å¦‚ä¸‹ä»£ç </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy">setBinding(<span class="hljs-keyword">new</span> Binding([<span class="hljs-attr">gradle:</span> <span class="hljs-variable language_">this</span>]))                       <br>evaluate(<span class="hljs-keyword">new</span> File( <br>        settingsDir.parentFile,<br>        <span class="hljs-string">&#x27;flutter_check/.android/include_flutter.groovy&#x27;</span><br>))<br></code></pre></td></tr></table></figure><p>å¦‚æœflutter moduleå’Œå·¥ç¨‹å¹³çº§ï¼Œåˆ™æ˜¯ä¸Šé¢çš„ä»£ç ã€‚<br>å¦‚æœflutter moduleæ˜¯å·¥ç¨‹çš„å­ç›®å½•ï¼Œåˆ™<code>settingsDir.parentFile,</code>æ”¹ä¸º<code>settingsDir,</code></p><h4 id="ä¸»å·¥ç¨‹ä¾èµ–"><a href="#ä¸»å·¥ç¨‹ä¾èµ–" class="headerlink" title="ä¸»å·¥ç¨‹ä¾èµ–"></a>ä¸»å·¥ç¨‹ä¾èµ–</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs groovy">dependencies &#123;<br>    ...<br>    implementation(project(<span class="hljs-string">&#x27;:flutter&#x27;</span>),&#123;<br>        exclude <span class="hljs-attr">group:</span> <span class="hljs-string">&#x27;com.android.support&#x27;</span><br>    &#125;)<br>    ...<br></code></pre></td></tr></table></figure><p>è®¾ç½®ä¸€ä¸‹ç¼–è¯‘ç”¨çš„Javaç‰ˆæœ¬</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs groovy">compileOptions &#123;<br>        sourceCompatibility <span class="hljs-number">1.8</span><br>        targetCompatibility <span class="hljs-number">1.8</span><br>    &#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæœ‰supportåŒ…å†²çªï¼Œåˆ™excludeæ’é™¤ä¸€ä¸‹</p><h4 id="Androidä¸­åŠ è½½flutterç•Œé¢"><a href="#Androidä¸­åŠ è½½flutterç•Œé¢" class="headerlink" title="Androidä¸­åŠ è½½flutterç•Œé¢"></a>Androidä¸­åŠ è½½flutterç•Œé¢</h4><p>æ‰¾ä¸ªActivityï¼Œåœ¨onCreateä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">FlutterView</span> <span class="hljs-variable">flutterView</span> <span class="hljs-operator">=</span> Flutter.createView(<span class="hljs-built_in">this</span>, getLifecycle(), <span class="hljs-string">&quot;main&quot;</span>);<br>setContentView(flutterView);<br></code></pre></td></tr></table></figure><p>åœ¨flutter moduleä¸­<code>main.dart</code>ä¸­æ·»åŠ </p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;dart:ui&#x27;</span>;<br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(_widgetForRoute(<span class="hljs-built_in">window</span>.defaultRouteName));<br>&#125;<br><br>Widget _widgetForRoute(<span class="hljs-built_in">String</span> route) &#123;<br>  <span class="hljs-keyword">switch</span> (route) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;main&#x27;</span>:<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;/&#x27;</span>:<br>      <span class="hljs-keyword">return</span> App();<br>    <span class="hljs-keyword">default</span>:<br>      <span class="hljs-keyword">return</span> Center(<br>        child: Text(<span class="hljs-string">&#x27;Unknown route: <span class="hljs-subst">$route</span>&#x27;</span>, textDirection: TextDirection.ltr),<br>      );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæ³¨æ„çš„æ˜¯ï¼Œcaseä¸­çš„<code>main</code>è¦å’ŒActivityä¸­åˆ›å»ºFlutterViewå‚æ•°ä¸€è‡´ã€‚</p><h4 id="äº’ç›¸è°ƒç”¨"><a href="#äº’ç›¸è°ƒç”¨" class="headerlink" title="äº’ç›¸è°ƒç”¨"></a>äº’ç›¸è°ƒç”¨</h4><p>é€šè¿‡ <code>MethodChannel</code>äº’ç›¸è°ƒç”¨<br>åœ¨Activityä¸­åˆå§‹åŒ–ä¸€ä¸ª<code>MethodChannel</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(FlutterView flutterView)</span> &#123;<br>        mChannel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MethodChannel</span>(flutterView, <span class="hljs-string">&quot;my_flutter/plugin&quot;</span>);<br><br>        mChannel.setMethodCallHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MethodChannel</span>.MethodCallHandler() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMethodCall</span><span class="hljs-params">(MethodCall methodCall, MethodChannel.Result result)</span> &#123;<br>                <span class="hljs-keyword">switch</span> (methodCall.method) &#123;<br>                    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;to_license&quot;</span>:<br>                        startActivity(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(MainActivity.<span class="hljs-built_in">this</span>,LicenseActivity.class));<br>                        result.success(<span class="hljs-literal">true</span>);<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;to_webview&quot;</span>:<br>                        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> methodCall.arguments.toString();<br><br>                        <span class="hljs-type">Uri</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> Uri.parse(url);<br>                        <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(Intent.ACTION_VIEW, uri);<br>                        <span class="hljs-keyword">if</span> (intent.resolveActivity(getPackageManager()) != <span class="hljs-literal">null</span>) &#123;<br>                            <span class="hljs-comment">// ç½‘å€æ­£ç¡® è·³è½¬æˆåŠŸ</span><br>                            startActivity(intent);<br>                            result.success(<span class="hljs-literal">true</span>);<br>                        &#125; <span class="hljs-keyword">else</span> &#123;<br>                            result.success(<span class="hljs-literal">false</span>);<br>                        &#125;<br>                        result.success(<span class="hljs-string">&quot;jump&quot;</span>);<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">default</span>:<br>                        <span class="hljs-keyword">break</span>;<br>                &#125;<br>            &#125;<br>        &#125;);<br></code></pre></td></tr></table></figure><p>æ³¨æ„channelçš„åå­—ï¼Œè¿™é‡Œè®¾ç½®ä¸€ä¸ª<code>MethodChannel.MethodCallHandler</code>,åœ¨å›è°ƒå‡½æ•°ä¸­å¯ä»¥é€šè¿‡<code>methodCall.method</code>æ‹¿åˆ°fluterè°ƒç”¨çš„æ–¹æ³•åå­—ã€‚resultåˆ™æ˜¯å›è°ƒflutterï¼Œè¿™ä¸ªæ–¹æ³•æ‰§è¡Œçš„ç»“æœã€‚<br>åœ¨flutterä¸­</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//åˆå§‹åŒ–ä¸€ä¸ªchannelï¼Œåå­—å’ŒAndroidä¸­ä¸€è‡´</span><br>MethodChannel channel = <span class="hljs-keyword">const</span> MethodChannel(<span class="hljs-string">&#x27;my_flutter/plugin&#x27;</span>);<br><span class="hljs-comment">//åœ¨æŸä¸ªæ§ä»¶çš„ç‚¹å‡»äº‹ä»¶ä¸Šè°ƒç”¨Android</span><br>onTap: () <span class="hljs-keyword">async</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">await</span> channel.invokeMethod(<span class="hljs-string">&#x27;to_webview&#x27;</span>,<span class="hljs-string">&quot;https://blog.huangyuanlove.com&quot;</span>);<br>        <span class="hljs-comment">// å°† dynamic ç±»å‹è½¬æ¢æˆéœ€è¦çš„ç±»å‹ï¼ˆä¸å¹³å°ç«¯è¿”å›å€¼ç»™å®šçš„ç±»å‹è¦ä¸€è‡´ï¼‰</span><br>    &#125; <span class="hljs-keyword">on</span> PlatformException <span class="hljs-keyword">catch</span> (e) &#123;<br>        <span class="hljs-built_in">print</span>(e.message);<br>    &#125;<br>&#125;,<br></code></pre></td></tr></table></figure><p>åä¹‹ï¼ŒAndroidè°ƒç”¨flutterä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚Androidä¸­è°ƒç”¨<br><code>mChannel.invokeMethod(&quot;methodName&quot;,&quot;params&quot;);</code><br>åœ¨flutterä¸­<br><code>channel.setMethodCallHandler(methodHandler);</code><br>æ··ç¼–çš„æƒ…å†µä¸‹flutterçš„çƒ­é‡è½½è¿˜æ˜¯æœ‰æ•ˆçš„ï¼Œåœ¨flutter moduleçš„ç›®å½•ä¸‹æ‰§è¡Œ<code>flutter attach</code>ï¼Œä¼šæœ‰æç¤ºã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>flutter-ç½‘ç»œè¯·æ±‚ä¸jsonè§£æ</title>
    <link href="/2019/03/13/flutter-%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E4%B8%8Ejson%E8%A7%A3%E6%9E%90/"/>
    <url>/2019/03/13/flutter-%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E4%B8%8Ejson%E8%A7%A3%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<p>ç½‘ç»œè¯·æ±‚é¡¹ç›®ä¸­ç”¨äº†ä¸¤ç§ï¼Œä¸€ä¸ªæ˜¯dartè‡ªå·±çš„<code>dart:io</code>,å¦å¤–ä¸€ä¸ªæ˜¯<code>dio</code>è¿™ä¸ªåº“ã€‚<br>jsonè§£æåˆ™ç”¨çš„æ˜¯<code>dart:convert</code>ã€‚</p><span id="more"></span><h4 id="å‘èµ·HTTPè¯·æ±‚"><a href="#å‘èµ·HTTPè¯·æ±‚" class="headerlink" title="å‘èµ·HTTPè¯·æ±‚"></a>å‘èµ·HTTPè¯·æ±‚</h4><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å…ˆå¯¼å…¥httpçš„æ”¯æŒåŒ…ï¼Œç„¶ååˆ›å»ºhttpClientã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;dart:io&#x27;</span>;<br><span class="hljs-keyword">var</span> httpClient = <span class="hljs-keyword">new</span> HttpClient();<br></code></pre></td></tr></table></figure><p>HttpClientæ”¯æŒå¸¸è§çš„getã€postã€putã€deleteè¯·æ±‚ã€‚</p><h4 id="å¤„ç†å¼‚æ­¥"><a href="#å¤„ç†å¼‚æ­¥" class="headerlink" title="å¤„ç†å¼‚æ­¥"></a>å¤„ç†å¼‚æ­¥</h4><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œç½‘ç»œè¯·æ±‚æ˜¯è€—æ—¶æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›è¡Œå¼‚æ­¥æ“ä½œï¼Œå»ºè®®ä½¿ç”¨async&#x2F;awaitè¯­æ³•æ¥è°ƒç”¨APIã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">var</span> httpClient = <span class="hljs-keyword">new</span> HttpClient(); <span class="hljs-comment">//åˆ›å»ºClient</span><br><span class="hljs-built_in">String</span> dataUrl =<span class="hljs-string">&quot;XXXXXXXX&quot;</span>; <span class="hljs-comment">//æ„å»ºuri</span><br><span class="hljs-keyword">var</span> uri = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uri</span>.http(<br>    <span class="hljs-string">&#x27;example.com&#x27;</span>, <span class="hljs-string">&#x27;/path1/path2&#x27;</span>, &#123;<span class="hljs-string">&#x27;param1&#x27;</span>: <span class="hljs-string">&#x27;42&#x27;</span>, <span class="hljs-string">&#x27;param2&#x27;</span>: <span class="hljs-string">&#x27;foo&#x27;</span>&#125;);<span class="hljs-comment">//æˆ–è€…è¿™ä¹ˆæ„å»ºä¹Ÿå¯ä»¥</span><br><span class="hljs-keyword">var</span> request = <span class="hljs-keyword">await</span> httpClient.getUrl(<span class="hljs-built_in">Uri</span>.parse(dataUrl));<span class="hljs-comment">//å‘èµ·è¯·æ±‚</span><br><span class="hljs-keyword">var</span> response = <span class="hljs-keyword">await</span> request.close();<span class="hljs-comment">//å…³é—­è¿æ¥</span><br><span class="hljs-keyword">if</span> (response.statusCode == HttpStatus.ok) &#123;<br>  <span class="hljs-keyword">var</span> jsonStr = <span class="hljs-keyword">await</span> response.transform(utf8.decoder).join();<br>  <span class="hljs-built_in">print</span>(jsonStr)<br>  <br>&#125; <span class="hljs-keyword">else</span> &#123;<br> <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¯·æ±‚å¤±è´¥&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="JSONè§£æ"><a href="#JSONè§£æ" class="headerlink" title="JSONè§£æ"></a>JSONè§£æ</h4><p>é‡‡ç”¨çš„æ˜¯å®˜ç½‘ä¸­æè¿°çš„æ–¹æ³•<br>ä½¿ç”¨â€™dart:convertâ€™;<br>é…åˆæ’ä»¶ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-attr">flutter:</span><br>    <span class="hljs-attr">sdk:</span> <span class="hljs-string">flutter</span><br>  <span class="hljs-attr">json_annotation:</span> <span class="hljs-string">^2.0.0</span><br><br><span class="hljs-attr">dev_dependencies:</span><br>  <span class="hljs-attr">flutter_test:</span><br>    <span class="hljs-attr">sdk:</span> <span class="hljs-string">flutter</span><br>  <span class="hljs-attr">build_runner:</span> <span class="hljs-string">^1.0.0</span><br>  <span class="hljs-attr">json_serializable:</span> <span class="hljs-string">^2.0.0</span><br></code></pre></td></tr></table></figure><p>ç”±äºè¿™ç§è§£ææ–¹å¼ä¸æ”¯æŒæ³›å‹ï¼Œåªèƒ½é‡‡ç”¨ç»„åˆ+ç»§æ‰¿çš„æ–¹å¼æ¥å®ç°äº†ï¼š</p><p>è¯·æ±‚åŸºç±»</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:json_annotation/json_annotation.dart&#x27;</span>;<br><span class="hljs-keyword">part</span> <span class="hljs-string">&#x27;base_result_bean.g.dart&#x27;</span>;<br><br><span class="hljs-meta">@JsonSerializable</span>()<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseResultBean</span></span>&#123;<br>  BaseResultBean();<br>  <span class="hljs-built_in">String</span> status;<br>  <span class="hljs-meta">@JsonKey</span>(name: <span class="hljs-string">&quot;current_page&quot;</span>)<br>  <span class="hljs-built_in">int</span> currentPage;<br><br>  <span class="hljs-meta">@JsonKey</span>(name: <span class="hljs-string">&quot;total_comments&quot;</span>)<br>  <span class="hljs-built_in">int</span> totalComments;<br>  <span class="hljs-meta">@JsonKey</span>(name: <span class="hljs-string">&quot;page_count&quot;</span>)<br>  <span class="hljs-built_in">int</span> pageCount;<br>  <span class="hljs-built_in">int</span> count;<br>  <span class="hljs-keyword">factory</span> BaseResultBean.fromJson(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; json) =&gt;_$BaseResultBeanFromJson(json);<br>  <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; toJson() =&gt; _$BaseResultBeanToJson(<span class="hljs-keyword">this</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å†™ä¸ªmodel</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:json_annotation/json_annotation.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;base_result_bean.dart&#x27;</span>;<br><span class="hljs-keyword">part</span> <span class="hljs-string">&#x27;joke_bean.g.dart&#x27;</span>;<br><br><span class="hljs-meta">@JsonSerializable</span>()<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JokeModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseResultBean</span></span>&#123;<br>  JokeModel();<br>  <span class="hljs-built_in">List</span>&lt;JokeBean&gt; comments;<br>  <span class="hljs-keyword">factory</span> JokeModel.fromJson(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; json) =&gt; _$JokeModelFromJson(json);<br>  <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; toJson() =&gt; _$JokeModelToJson(<span class="hljs-keyword">this</span>);<br>&#125;<br><br><span class="hljs-meta">@JsonSerializable</span>()<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JokeBean</span> </span>&#123;<br>  JokeBean();<br><br>  <span class="hljs-meta">@JsonKey</span>(name: <span class="hljs-string">&quot;vote_positive&quot;</span>)<br>  <span class="hljs-built_in">String</span> votePositive;<br><br>  <span class="hljs-meta">@JsonKey</span>(name: <span class="hljs-string">&quot;vote_negative&quot;</span>)<br>  <span class="hljs-built_in">String</span> voteNegative;<br><br>  <span class="hljs-meta">@JsonKey</span>(name: <span class="hljs-string">&quot;sub_comment_count&quot;</span>)<br>  <span class="hljs-built_in">String</span> subCommentCount;<br>  <span class="hljs-keyword">factory</span> JokeBean.fromJson(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; json) =&gt; _$JokeBeanFromJson(json);<br>  <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; toJson() =&gt; _$JokeBeanToJson(<span class="hljs-keyword">this</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å†™å®Œä¹‹åä¼šæŠ¥é”™ï¼Œåˆ«æ…Œï¼Œæ ¹ç›®å½•ä¸‹æ‰§è¡Œ<br><code>flutter packages pub run build_runner build</code><br>è¿™æ¡å‘½ä»¤æ¯æ¬¡æ”¹å˜å®ä½“ç±»çš„æ—¶å€™éƒ½éœ€è¦æ‰§è¡Œï¼Œå¯ä»¥æ¢æˆ<br><code>flutter packages pub run build_runner watch</code></p><p>ç°åœ¨ï¼Œæˆ‘ä»¬è§£æjsonå°±å¯ä»¥è¿™ä¹ˆå†™äº†</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">if</span> (response.statusCode == HttpStatus.ok) &#123;<br>      <span class="hljs-keyword">var</span> jsonStr = <span class="hljs-keyword">await</span> response.transform(utf8.decoder).join();<br>      <span class="hljs-keyword">var</span> boredImageModel = JokeModel.fromJson(json.decode(jsonStr));<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæ˜¯æ¯”è¾ƒç®€å•çš„jsonè§£æï¼Œå¯ä»¥ç›´æ¥é€šè¿‡<code>json.decode</code>è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;John Smith&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;email&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;john@example.com&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥è¿™ä¹ˆå–</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; user = json.decode(jsonStr);<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Howdy, <span class="hljs-subst">$&#123;user[<span class="hljs-string">&#x27;name&#x27;</span>]&#125;</span>!&#x27;</span>);<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;We sent the verification link to <span class="hljs-subst">$&#123;user[<span class="hljs-string">&#x27;email&#x27;</span>]&#125;</span>.&#x27;</span>);<br></code></pre></td></tr></table></figure><p>åœ¨flutterä¸­æ–‡ç½‘æ¨èäº†<code>dio</code>è¿™ä¸ªåº“ï¼Œ<a href="https://github.com/flutterchina/dio">dio github</a>ï¼Œè¿™é‡Œç®€å•çš„ä½¿ç”¨äº†ä¸€ä¸‹ï¼Œå¹¶æ²¡æœ‰ç”¨åˆ°é«˜çº§åŠŸèƒ½</p><p><code>pubspec.yaml</code>ä¸­æ·»åŠ ä¾èµ–<code>dio: ^2.1.0</code>,å¯¼åŒ…:<code>import &#39;package:dio/dio.dart&#39;;</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs dart">Future&lt;<span class="hljs-keyword">void</span>&gt; getHttp(<span class="hljs-built_in">bool</span> isLoadMore) <span class="hljs-keyword">async</span> &#123;<br>    <span class="hljs-keyword">if</span> (isLoading) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      setState(() &#123;<br>        isLoading = <span class="hljs-keyword">true</span>;<br>        <span class="hljs-keyword">if</span> (!isLoadMore) &#123;<br>          pageNumber = <span class="hljs-number">1</span>;<br>        &#125;<br>      &#125;);<br>    &#125;<br>    <span class="hljs-built_in">String</span> dataUrl =<br>        <span class="hljs-string">&quot;https://i.jandan.net/?oxwlxojflwblxbsapi=jandan.get_duan_comments&amp;page=<span class="hljs-subst">$pageNumber</span>&quot;</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>      Response&lt;<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;&gt; response = <span class="hljs-keyword">await</span> Dio().<span class="hljs-keyword">get</span>(dataUrl);<br>      <span class="hljs-keyword">if</span> (response.statusCode == <span class="hljs-number">200</span>) &#123;<br>        <span class="hljs-keyword">var</span> jokeModel = JokeModel.fromJson(response.data);<br><br>        setState(() &#123;<br>          isLoading = <span class="hljs-keyword">false</span>;<br>          pageNumber++;<br>          <span class="hljs-keyword">if</span> (isLoadMore) &#123;<br>            widgets.addAll(jokeModel.comments);<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>            widgets = jokeModel.comments;<br>          &#125;<br>        &#125;);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        isLoading = <span class="hljs-keyword">false</span>;<br>        _showError();<br>      &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>      <span class="hljs-built_in">print</span>(e.toString());<br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªç®€å•çš„è¯·æ±‚ï¼Œå¹¶æ²¡æœ‰ä½“ç°å‡º<code>dio</code>çš„å¼ºåŠ¿çš„åœ°æ–¹ï¼Œå…·ä½“ä½¿ç”¨å¯ä»¥çœ‹ä¸€ä¸‹<code>https://github.com/flutterchina/dio/blob/master/README-ZH.md</code>ä»‹ç»ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>flutterä»å…¥é—¨åˆ°æŒ£æ‰</title>
    <link href="/2019/03/13/flutter%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%8C%A3%E6%89%8E/"/>
    <url>/2019/03/13/flutter%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%8C%A3%E6%89%8E/</url>
    
    <content type="html"><![CDATA[<p>æˆ‘å¸å‡†å¤‡ä¸ŠFlutteräº†ï¼Œæˆ‘ä¸å–œä¸æ‚²ã€‚èŠ±äº†å¤§æ¦‚ä¸€å‘¨çš„æ—¶é—´äº†è§£äº†ä¸€ä¸‹ã€‚å†™äº†ç‚¹å°ç©æ„ç»ƒæ‰‹ã€‚æ„Ÿè§‰å¦‚ä¸‹ï¼š</p><ul><li>Flutterç”¨çš„å‰ç«¯çš„å¸ƒå±€æ€æƒ³ï¼Œå°±ç°åœ¨çœ‹æ¥ï¼Œåªèƒ½ç®—æ˜¯ä¸€ä¸ªUIæ¡†æ¶åŠ ä¸Šä¸€äº›ç®€å•é€»è¾‘ï¼Œä¸€æ—¦æ¶‰åŠåˆ°ç³»ç»Ÿçš„ä¸œè¥¿ï¼Œæ¯”å¦‚æ‰“å¼€ç³»ç»Ÿè‡ªå¸¦æµè§ˆå™¨ã€æµè§ˆç³»ç»Ÿå›¾åº“ç­‰å°±æ— èƒ½ä¸ºåŠ›äº†ï¼Œåªèƒ½é€šè¿‡<code>MethodChannel</code>å’ŒåŸç”Ÿäº¤äº’ã€‚</li><li>å­¦ä¼šFlutterå¹¶ä¸æ„å‘³ç€å°±ä¸ç”¨äº†è§£åŸç”Ÿå¼€å‘äº†ï¼Œå¦‚æœé‡åˆ°äº†ä¸Šé¢çš„æƒ…å†µï¼Œè¦ä¹ˆç”¨åˆ«äººå†™çš„åº“ï¼Œè¦ä¹ˆç­‰è°·æ­Œå‡ºå°è£…å¥½çš„åŒ…ã€‚ä½†å°±ç°åœ¨çœ‹æ¥ï¼Œflutterä¹Ÿæ˜¯åˆšåˆšå´­éœ²å¤´è§’ï¼Œäº¬ä¸œè²Œä¼¼æ˜¯å»å¹´ä¸‹åŠå¹´æ‰å¼€å§‹åœ¨ä¸»ä¸šåŠ¡ä¸Šä½¿ç”¨flutterã€‚ä¸€äº›ä¸‰æ–¹åº“çš„è´¨é‡å‚å·®ä¸é½ï¼Œèƒ½åœ¨Androidä¸Šè¿è¡Œçš„åˆ°iOSä¸Šå°±å‡‰å‡‰ï¼Œæ‰“debugåŒ…æ²¡é—®é¢˜æ‰“releaseåŒ…å°±GG</li></ul><p>ä¸‹é¢æ˜¯è‡ªå·±åœ¨å­¦ä¹ ã€ç»ƒæ‰‹çš„æ—¶å€™åšçš„ä¸€äº›ç¬”è®°ï¼ŒåŠé€€æµå¼€å§‹äº†ã€‚ã€‚ã€‚ã€‚</p><span id="more"></span><h4 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h4><p>è¿™ä¸ªçœ‹å®˜ç½‘æ•™ç¨‹å°±å¥½ï¼ŒåŸºæœ¬æ²¡å•¥å‘ï¼Œå¦‚æœæœ‰çš„è¯ä¹Ÿåœ¨iOSç¯å¢ƒä¸Šï¼Œæ¯”å¦‚podå¤±æ•ˆä¹‹ç±»çš„</p><p>é“¾æ¥åœ¨è¿™é‡Œ</p><p><a href="https://flutter.dev/docs/get-started/install">https://flutter.dev/docs/get-started/install</a></p><p>è‹±æ–‡çœ‹ä¸æ‡‚çš„å¯ä»¥çœ‹ä¸­æ–‡çš„</p><p><a href="https://flutterchina.club/get-started/install/">https://flutterchina.club/get-started/install/</a>    ä¸è¿‡è¿™ä¸ªæ›´æ–°é€Ÿåº¦æœ‰ç‚¹æ…¢ã€‚</p><p>å¦‚æœç¯å¢ƒæ­ä¸å¥½çš„è¯ï¼Œä¹Ÿä¸ç”¨çœ‹ä¸‹é¢çš„äº†ï¼Œå¯ä»¥æ”¾å¼ƒäº†ã€‚</p><h4 id="å¸¸ç”¨æ§ä»¶"><a href="#å¸¸ç”¨æ§ä»¶" class="headerlink" title="å¸¸ç”¨æ§ä»¶"></a>å¸¸ç”¨æ§ä»¶</h4><p>è¿™ä¸ªç”¨åˆ°å•¥æœå•¥å°±è¡Œï¼Œå¸¸ç”¨ä¹Ÿå°±è¿™å‡ ä¸ª</p><ul><li>TabBar</li><li>Card</li><li>Container</li><li>Text</li><li>Column</li><li>Offstage</li><li>FadeInImage</li><li>Row</li><li>Icon</li><li>RefreshIndicator</li><li>ListView</li></ul><p>å¯¹äº†ï¼Œé¡¹ç›®ä¸­è¿˜ç”¨äº†ä¸€ä¸ªä¸Šæ‹‰åŠ è½½æ›´å¤šï¼Œåªéœ€åŠ æ·»åŠ ä¸€ä¸ªæ»‘åŠ¨ç›‘å¬ï¼Œåœ¨ListView.builderè®¾ç½®ä¸€ä¸‹controllerå°±å¥½</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">if</span> (_scrollController.position.pixels == _scrollController.position.maxScrollExtent) &#123;<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æ»‘åŠ¨åˆ°äº†æœ€åº•éƒ¨&#x27;</span>);<br>&#125;<br><br><br><span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> RefreshIndicator(<br>      onRefresh: () =&gt; _loadData(<span class="hljs-keyword">false</span>),<br>      child: ListView.builder(<br>          controller: _scrollController,<br>          itemCount: widgets.length + <span class="hljs-number">1</span>,<br>          itemBuilder: (BuildContext context, <span class="hljs-built_in">int</span> position) &#123;<br>            <span class="hljs-keyword">return</span> _getRow(position);<br>          &#125;),<br>    );<br>  &#125;<br></code></pre></td></tr></table></figure><p>è‡³äºä¸ºå•¥<code>itemCount</code>éœ€è¦æ•°æ®æ€»æ•°+1ï¼Œæ˜¯ä¸ºäº†æ˜¾ç¤ºå‡ºæ¥ä¸‹é¢çš„åŠ è½½ä¸­åŠ¨ç”»ã€‚</p><p>åœ¨<code>Widget _getRow(int i)</code>æ–¹æ³•ä¸­ï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯è¦æ¸²æŸ“ä¸æ˜¯ï¼Œä¸æ˜¯æ¸²æŸ“æ•°æ®é‚£å°±æ˜¯æ¸²æŸ“åŠ è½½æ›´å¤šçš„è¿™ä¸ªæ§ä»¶</p><h4 id="ç½‘ç»œè¯·æ±‚åŠjsonè§£æ"><a href="#ç½‘ç»œè¯·æ±‚åŠjsonè§£æ" class="headerlink" title="ç½‘ç»œè¯·æ±‚åŠjsonè§£æ"></a>ç½‘ç»œè¯·æ±‚åŠjsonè§£æ</h4><p>çœ‹è¿™é‡Œ </p><p><a href="https://blog.huangyuanlove.com/2019/03/13/flutter-%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E4%B8%8Ejson%E8%A7%A3%E6%9E%90/">https://blog.huangyuanlove.com/2019/03/13/flutter-ç½‘ç»œè¯·æ±‚ä¸jsonè§£æ/</a></p><h4 id="Androidå’Œflutteræ··ç¼–åŠäº’ç›¸è°ƒç”¨"><a href="#Androidå’Œflutteræ··ç¼–åŠäº’ç›¸è°ƒç”¨" class="headerlink" title="Androidå’Œflutteræ··ç¼–åŠäº’ç›¸è°ƒç”¨"></a>Androidå’Œflutteræ··ç¼–åŠäº’ç›¸è°ƒç”¨</h4><p>çœ‹è¿™é‡Œ</p><p><a href="https://blog.huangyuanlove.com//2019/03/13/flutter-Android%E6%B7%B7%E7%BC%96%E5%8F%8A%E4%BA%92%E7%9B%B8%E8%B0%83%E7%94%A8/">https://blog.huangyuanlove.com//2019/03/13/flutter-Androidæ··ç¼–åŠäº’ç›¸è°ƒç”¨/</a></p><h4 id="é¡¹ç›®åœ°å€"><a href="#é¡¹ç›®åœ°å€" class="headerlink" title="é¡¹ç›®åœ°å€"></a>é¡¹ç›®åœ°å€</h4><p><a href="https://github.com/huangyuanlove/JanDan_flutter">https://github.com/huangyuanlove/JanDan_flutter</a></p><p>æ•ˆæœå›¾</p><p><img src="/image/flutter/jan_dan.gif" alt="ç…è›‹"> </p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gitç‰ˆæœ¬æ§åˆ¶</title>
    <link href="/2019/01/27/git%E6%9C%AC%E5%9C%B0%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/"/>
    <url>/2019/01/27/git%E6%9C%AC%E5%9C%B0%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<p>ç‰ˆæœ¬åº“ä¹Ÿä¹Ÿæ˜¯ä»“åº“ï¼Œè¡¨ç°ä¸ºä¸€ä¸ªç›®å½•æˆ–è€…æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹é‡Œé¢çš„æ‰€æœ‰æ–‡ä»¶éƒ½å¯ä»¥è¢«Gitç®¡ç†èµ·æ¥ï¼Œæ–‡ä»¶ä¿®æ”¹åˆ é™¤ä¹Ÿéƒ½èƒ½è¢«Gitè®°å½•ä¸‹æ¥ï¼Œæ–¹ä¾¿ç‰ˆæœ¬æ§åˆ¶ã€‚</p><p> gitç›¸å…³æ¦‚å¿µç®€ä»‹ï¼š</p><ul><li>å·¥ä½œåŒºï¼šå°±æ˜¯å­˜æ”¾æ–‡ä»¶çš„æ–‡ä»¶å¤¹ã€‚</li><li>ç‰ˆæœ¬åº“ï¼šå¯ä»¥ç²—ç•¥çš„ç†è§£ä¸º <code>.git</code> æ–‡ä»¶å¤¹</li><li>ç‰ˆæœ¬åº“ä¸­åŒ…å«ä¸€ä¸ª<code>æš‚å­˜åŒº</code> å’Œ å¤šä¸ª<code>åˆ†æ”¯</code>ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œå®Œ<code>git init</code> çš„æ—¶å€™ï¼Œç³»ç»Ÿè‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª<code>master</code> åˆ†æ”¯</li></ul><span id="more"></span><h4 id="1-æœ¬åœ°ç‰ˆæœ¬åº“"><a href="#1-æœ¬åœ°ç‰ˆæœ¬åº“" class="headerlink" title="1 æœ¬åœ°ç‰ˆæœ¬åº“"></a>1 æœ¬åœ°ç‰ˆæœ¬åº“</h4><h5 id="1-1-åˆ›å»ºæœ¬åœ°ç‰ˆæœ¬åº“"><a href="#1-1-åˆ›å»ºæœ¬åœ°ç‰ˆæœ¬åº“" class="headerlink" title="1.1 åˆ›å»ºæœ¬åœ°ç‰ˆæœ¬åº“"></a>1.1 åˆ›å»ºæœ¬åœ°ç‰ˆæœ¬åº“</h5><p>   åœ¨é€‚å½“çš„ä½ç½®åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåå­—éšä¾¿ä½†æœ€å¥½è¦æœ‰æ„ä¹‰ï¼ŒåŒæ—¶ä¸å»ºè®®æ–‡ä»¶å¤¹è·¯å¾„ä¸­æœ‰ä¸­æ–‡ã€‚æ‰“å¼€git shellï¼Œåˆ‡æ¢åˆ°åˆ›å»ºçš„æ–‡ä»¶å¤¹ä¸­ï¼Œè¾“å…¥<code>git init</code>ï¼Œå°†å½“å‰æ–‡ä»¶å¤¹åˆå§‹åŒ–ä¸ºgitä»“åº“ï¼Œä¼šå‘ç°å½“å‰æ–‡ä»¶å¤¹ä¸‹å¤šå‡ºäº†ä¸€ä¸ª <code>.get</code> æ–‡ä»¶å¤¹ã€‚</p><h5 id="1-2-å°†æ–‡ä»¶æ·»åŠ åˆ°ä»“åº“å’Œæ–‡ä»¶ä¿®æ”¹"><a href="#1-2-å°†æ–‡ä»¶æ·»åŠ åˆ°ä»“åº“å’Œæ–‡ä»¶ä¿®æ”¹" class="headerlink" title="1.2 å°†æ–‡ä»¶æ·»åŠ åˆ°ä»“åº“å’Œæ–‡ä»¶ä¿®æ”¹"></a>1.2 å°†æ–‡ä»¶æ·»åŠ åˆ°ä»“åº“å’Œæ–‡ä»¶ä¿®æ”¹</h5><p>åœ¨å½“å‰ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæ–‡æœ¬æ–‡æ¡£ï¼Œåå­—éšä¾¿ï¼Œå½“ç„¶è¦æœ‰æ„ä¹‰ï¼Œæˆ‘æ–°å»ºçš„æ˜¯<code>TestGit.txt</code>,æ–°å»ºå®Œä¹‹åï¼Œæˆ‘ä»¬åœ¨ <code>git shell</code>ä¸­è¾“å…¥<code>git status</code>æ¥æŸ¥çœ‹å·¥ä½œåŒºçš„çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git status</span><br>On branch master<br><br>No commits yet<br><br>Untracked files:<br>  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)<br><br>        Test.txt<br><br>nothing added to commit but untracked files present (use &quot;git add&quot; to track)<br><br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<strong>ä¸€å®šè¦çœ‹gitè¿”å›çš„æç¤ºæ˜¯å¦æˆåŠŸ</strong>ã€<strong>ä¸€å®šè¦çœ‹gitè¿”å›çš„æç¤ºæ˜¯å¦æˆåŠŸ</strong>ã€<strong>ä¸€å®šè¦çœ‹gitè¿”å›çš„æç¤ºæ˜¯å¦æˆåŠŸ</strong>ã€‚</p><p> ç¬¬ä¸€è¡Œæç¤ºæˆ‘ä»¬ç°åœ¨åœ¨ <code>master</code> è¿™ä¸ªåˆ†æ”¯ä¸Šï¼Œä¸‹é¢æç¤ºæˆ‘ä»¬æœ‰ä¸€ä¸ªæ–‡ä»¶æ²¡æœ‰è¢«è¿½è¸ªï¼Œå¯ä»¥ä½¿ç”¨<code>git add fileName</code> æ–¹å¼æ·»åŠ ï¼Œæˆ‘ä»¬è¾“å…¥ <code>git add Test.txt</code>,ç„¶åå†ç”¨<code>git status</code>æ¥æŸ¥çœ‹å·¥ä½œåŒºé—´</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git status</span><br>On branch master<br><br>No commits yet<br><br>Changes to be committed:<br>  (use &quot;git rm --cached &lt;file&gt;...&quot; to unstage)<br><br>        new file:   Test.txt<br><br><br>huangyuan@xuan MINGW64 ~/Desktop/test (master)<br><br></code></pre></td></tr></table></figure><p>ç³»ç»Ÿæç¤ºå·²ç»å°†è¯¥æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒºï¼Œå¯ä»¥ä½¿ç”¨ <code>git rm --cached FileName</code>å°†æ–‡ä»¶ä»æš‚å­˜åŒºåˆ é™¤ï¼ˆè¿™å¹¶ä¸ä¼šåˆ é™¤ä½ åˆ›å»ºçš„æ–‡ä»¶ï¼Œåªæ˜¯åˆ é™¤gitç‰ˆæœ¬åº“ä¸­çš„æš‚å­˜ï¼‰ï¼Œæ¥ä¸‹æ¥å¯ä»¥ä½¿ç”¨<code>git commit -m â€œæ³¨é‡Šâ€</code> å°†æš‚å­˜åŒºå†…å®¹æäº¤åˆ°åˆ°<code>master</code>åˆ†æ”¯ï¼Œç„¶åæˆ‘ä»¬å†æŸ¥çœ‹å·¥ä½œåŒºçŠ¶æ€ï¼Œå‘ç°å·¥ä½œåŒºæ˜¯å¹²å‡€çš„:</p><figure class="highlight plaintext"><figcaption><span>git status</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs $">On branch master<br>nothing to commit, working tree clean<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å·²ç»åˆ›å»ºå¹¶ä¸”æ·»åŠ äº†ä¸€ä¸ªæ–‡ä»¶åˆ°ç‰ˆæœ¬ä»“åº“ï¼Œç°åœ¨ä¿®æ”¹<code>Test.txt</code>æ–‡ä»¶ï¼Œéšä¾¿å†™ç‚¹ä¸œè¥¿ï¼Œç„¶åä¿å­˜ï¼Œå›åˆ°git shellï¼Œä½¿ç”¨<code>git status</code> æŸ¥çœ‹å·¥ä½œåŒºçŠ¶æ€ï¼Œæç¤ºæ–‡ä»¶å·²ç»è¢«ä¿®æ”¹ï¼Œå¯ä»¥ä½¿ç”¨<code>git add fileName</code> å°†ä¿®æ”¹åçš„æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒºï¼Œæˆ–è€…ä½¿ç”¨<code>git checkout -- fileName</code> å°†æ–‡ä»¶è¿”å›åˆ°ä¿®æ”¹å‰çš„çŠ¶æ€ï¼ˆè¿™ä¸ªä¿®æ”¹å‰çš„çŠ¶æ€æ˜¯æŒ‡çš„ä¸Šä¸€æ¬¡æäº¤ä¹‹åç‰ˆæœ¬åº“çš„æ–‡ä»¶çŠ¶æ€ï¼‰ï¼Œæˆ–è€…ä½¿ç”¨<code>git diff fileName</code>å‘½ä»¤æ¥æŸ¥çœ‹ä¿®æ”¹äº†å“ªäº›ä¸œè¥¿ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git status</span><br>On branch master<br>Changes not staged for commit:<br>  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)<br>  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)<br><br>        modified:   Test.txt<br><br>no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>git add</code>æ›´æ–°å°†è¦è¢«commitçš„æ–‡ä»¶</p><p>ä½¿ç”¨ <code>git checkout -- Test.txt</code> å‘½ä»¤è¿˜åŸæ–‡ä»¶çŠ¶æ€ï¼Œä¼šå‘ç°æ–‡ä»¶å˜å›ä¸Šæ¬¡æäº¤ä¹‹åçš„çŠ¶æ€äº†ã€‚</p><p>####1.3 ç‰ˆæœ¬å›é€€<br>å¦‚æœæˆ‘ä»¬æ–°å»ºäº†å¾ˆå¤šæ–‡ä»¶ï¼Œå¹¶ä¸”éƒ½æäº¤åˆ°äº†ç‰ˆæœ¬åº“ï¼Œç°åœ¨æƒ³è¦å›é€€åˆ°æŸä¸€ä¸ªç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨<code>git log</code>æˆ–è€…<code>git log --graph</code> ï¼ˆ<code>git reflog</code> ä¼šè®°å½•æ¯ä¸€æ¬¡ä½¿ç”¨çš„å‘½ä»¤ï¼‰æ¥æŸ¥çœ‹æ¯ä¸€æ¬¡æäº¤çš„<code>commitid</code>ã€<code>Author</code>ã€<code>Date</code>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>git reset --hard commitid</code> æˆ–è€… <code>git reset --hard HEAD</code>æ¥å°†ç‰ˆæœ¬å›é€€åˆ°æŸä¸€ä¸ªç‰¹å®šçš„ç‰ˆæœ¬ã€‚</p><p>å…¶ä¸­ <code>HEAD</code> è¡¨ç¤ºçš„æ˜¯å½“å‰ç‰ˆæœ¬åº“ä¸­çš„æœ€æ–°ç‰ˆæœ¬ï¼Œ<code>HEAD^</code>è¡¨ç¤ºçš„æ˜¯ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼Œ<code>HEAD^^</code>æˆ–è€…<code>HEAD~2</code> è¡¨ç¤ºçš„æ˜¯ä¸Šä¸Šä¸ªç‰ˆæœ¬ï¼Œä¾æ­¤ç±»æ¨ã€‚ï¼ˆpsï¼šå½“ä½¿ç”¨ <code>commitid</code> æ¥å›é€€ç‰ˆæœ¬çš„æ—¶å€™ï¼Œä¸éœ€è¦å°†idå…¨éƒ¨å†™å‡ºæ¥ï¼Œåªå†™å‡ºå‰è¾¹ä¸€éƒ¨åˆ†å³å¯ï¼‰ï¼š</p><p>è¿™æ ·çš„è¯ï¼Œå·¥ä½œåŒºçš„å†…å®¹ä¹Ÿå›é€€åˆ°äº†æŒ‡å®šç‰ˆæœ¬çš„çŠ¶æ€ã€‚</p><p>æ³¨æ„ï¼Œgit reset å‚æ•°å¯ä»¥æ˜¯ä¸€ä¸‹å‡ ç§</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell">git reset [--mixed | --soft | --hard | --merge | --keep] [-q] [&lt;commit&gt;]<br>   or: git reset [-q] [&lt;tree-ish&gt;] [--] &lt;paths&gt;...<br>   or: EXPERIMENTAL: git reset [-q] [--stdin [-z]] [&lt;tree-ish&gt;]<br>   or: git reset --patch [&lt;tree-ish&gt;] [--] [&lt;paths&gt;...]<br><br>    -q, --quiet           be quiet, only report errors<br>    --mixed               reset HEAD and index<br>    --soft                reset only HEAD<br>    --hard                reset HEAD, index and working tree<br>    --merge               reset HEAD, index and working tree<br>    --keep                reset HEAD but keep local changes<br>    --recurse-submodules[=&lt;reset&gt;]<br>                          control recursive updating of submodules<br>    -p, --patch           select hunks interactively<br>    -N, --intent-to-add   record only the fact that removed paths will be added later<br>    -z                    EXPERIMENTAL: paths are separated with NUL character<br>    --stdin               EXPERIMENTAL: read paths from &lt;stdin&gt;<br></code></pre></td></tr></table></figure><h4 id="2-è¿œç¨‹ä»“åº“"><a href="#2-è¿œç¨‹ä»“åº“" class="headerlink" title="2 è¿œç¨‹ä»“åº“"></a>2 è¿œç¨‹ä»“åº“</h4><h5 id="2-1-åˆ›å»ºæ–°ä»“åº“"><a href="#2-1-åˆ›å»ºæ–°ä»“åº“" class="headerlink" title="2.1 åˆ›å»ºæ–°ä»“åº“"></a>2.1 åˆ›å»ºæ–°ä»“åº“</h5><p>æˆ‘ä»¬å·²ç»åœ¨æœ¬åœ°åˆ›å»ºå¥½äº†ä»“åº“ï¼Œç°åœ¨æƒ³åœ¨è¿œç¨‹githubä¸Šåˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œæ˜¯æœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“å¯ä»¥è¿›è¡ŒåŒæ­¥ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥ååŒå·¥ä½œã€‚</p><p>æ‰“å¼€æˆ‘ä»¬è‡ªå·±çš„githubä¸»é¡µï¼Œç‚¹å‡»ç•Œé¢ä¸Šçš„ç»¿è‰²æŒ‰é’®<code>New repository</code></p><p><img src="/image/git/NewRepository.PNG" alt="New repository"></p><p>æ‰“å¼€åˆ›å»ºä»“åº“çš„ç•Œé¢,å¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="/image/git/CreatNewRepository.PNG" alt="Create new repository"></p><p> å¡«å…¥ä»“åº“åå­—ï¼ˆä¸èƒ½å’Œå·²æœ‰ä»“åº“åå­—ç›¸åŒï¼‰ã€æè¿°ã€æƒé™ï¼ˆç§æœ‰çš„è²Œä¼¼è¦æ”¶è´¹ï¼‰ã€é€‰æ‹©åˆå§‹åŒ–çš„æ—¶å€™æ˜¯å¦åˆ›å»º<code>README</code>æ–‡ä»¶ï¼ˆMarkdownæ ¼å¼ï¼‰ã€æ˜¯å¦æ·»åŠ <code>gitignore</code>æ–‡ä»¶ã€æ˜¯å¦æ·»åŠ ç‰ˆæƒï¼ˆä¸€èˆ¬æ˜¯é€‰ GNU General Public License  æˆ–è€… Apache Licenseï¼Œå…³äºè¿™ä¸¤ä¸ªåè®®ï¼Œå¤§å®¶å¯ä»¥å»ç½‘ä¸Šæœä¸€ä¸‹ï¼‰ï¼Œç„¶åç‚¹å‡»ä¸‹é¢çš„ <code>Create repository</code>å°±å®Œæˆäº†è¿œç¨‹ä»“åº“åˆ›å»ºï¼ˆå¦‚æœè¿™é‡Œé€‰æ‹©äº†æ·»åŠ åè®®ï¼Œå°±ä¸ç”±æœ‰ä¸‹é¢çš„2.2æ­¥éª¤ï¼‰</p><h5 id="2-2-æ¨é€æœ¬åœ°æ–‡ä»¶åˆ°è¿œç¨‹ä»“åº“"><a href="#2-2-æ¨é€æœ¬åœ°æ–‡ä»¶åˆ°è¿œç¨‹ä»“åº“" class="headerlink" title="2.2 æ¨é€æœ¬åœ°æ–‡ä»¶åˆ°è¿œç¨‹ä»“åº“"></a>2.2 æ¨é€æœ¬åœ°æ–‡ä»¶åˆ°è¿œç¨‹ä»“åº“</h5><p>å¦‚æœæˆ‘ä»¬åœ¨åˆ›å»ºè¿œç¨‹ä»“åº“çš„æ—¶å€™æ²¡æœ‰é€‰æ‹©æ·»åŠ ä»»ä½•æ–‡ä»¶ï¼Œé‚£ä¹ˆåˆ›å»ºæˆåŠŸçš„ä»“åº“å°†ä¼šæ˜¯ä¸€ä¸ªç©ºä»“åº“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/image/git/emptyRepository.PNG" alt="empty repository"></p><p>å¦‚æœé€‰æ‹©äº†æ·»åŠ æ–‡ä»¶ä¸ä¼šæœ‰ä¸Šå›¾æ‰€ç¤ºçš„æç¤ºï¼Œè€Œæ˜¯æ˜¾ç¤ºä»“åº“é‡Œé¢åŒ…å«çš„æ–‡ä»¶ï¼Œä¸‹é¢æˆ‘ä»¬å°†æœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“å…³è”èµ·æ¥ï¼ˆå…¶å®ç©ºä»“åº“éƒ½æœ‰è¯¦ç»†çš„æç¤ºï¼Œæˆ‘ä¹Ÿåªæ˜¯è´Ÿè´£ç¿»è¯‘ä¸€ä¸‹ï¼‰ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo # repository name&gt;&gt; README.md<br>git init<br>git add README.md<br>git commit -m &quot;first commit&quot;<br>git remote add origin git@github.com:your name/repository name.git<br>git push -u origin master<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¡å‘½ä»¤ï¼Œåˆ›å»º <code>README.md</code>æ–‡ä»¶ï¼Œå¹¶å°†<code># repository name</code> å†™å…¥åˆ°æ–‡ä»¶<br>2,3,4å‰é¢ä»‹ç»è¿‡äº†ï¼Œå…³é”®æ˜¯5,6,ï¼š<br>ç¬¬äº”æ¡å‘½ä»¤ï¼Œå°†æœ¬åœ°ä»“åº“å’Œä½ è‡ªå·±çš„è¿œç¨‹ä»“åº“å…³è”èµ·æ¥ï¼Œ<code>origin</code>æ˜¯æœ¬åœ°åˆ«åï¼Œåé¢çš„æ˜¯è¿œç¨‹ä»“åº“çš„åœ°å€<br>ç¬¬å…­æ¡å‘½ä»¤ï¼Œå°†æœ¬åœ°ä»“åº“çš„æ–‡ä»¶æ¨é€åˆ°è¿œç¨‹ä»“åº“<br>å¦‚æœåœ¨æœ¬åœ°æœ‰å»ºç«‹å¥½çš„ä»“åº“ï¼Œå¯ä»¥åˆ‡æ¢åˆ°ä»“åº“ç›®å½•ï¼Œæ‰§è¡Œç¬¬äº”ç¬¬å…­æ¡å‘½ä»¤ã€‚<br>å¦‚æœé€‰æ‹©äº†æ·»åŠ æ–‡ä»¶ï¼Œä½†æ˜¯æœ¬åœ°æ²¡æœ‰ä»“åº“ï¼Œå¯ä»¥ç‚¹å‡»ä»“åº“é¡µé¢å³ä¸‹è§’çš„ <code>Download ZIP</code>æŒ‰é’®ï¼Œä¸‹è½½è¿œç¨‹ä»“åº“åˆ°æœ¬åœ°ï¼Œç„¶ååˆ‡æ¢åˆ°ä»“åº“ç›®å½•ï¼Œè¿™æ—¶å°±ä¸éœ€è¦å…³è”ä»“åº“äº†ã€‚ä¸æƒ³ç‚¹å‡»æŒ‰é’®ä¸‹è½½çš„è¯å¯ä»¥ä½¿ç”¨ <code>git clone</code>å‘½ä»¤ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š<br><code>git clone git@github.com:your name/repository name.git</code></p><h4 id="3-githubåˆ†æ”¯"><a href="#3-githubåˆ†æ”¯" class="headerlink" title="3 githubåˆ†æ”¯"></a>3 githubåˆ†æ”¯</h4><p>åœ¨gitä¸­ï¼Œæ¯å½“æˆ‘ä»¬<code>commit</code>çš„æ—¶å€™ï¼Œgitå°†ä¼šæŠŠæäº¤çš„æ—¶é—´ä¸²æˆä¸€æ¡çº¿ï¼Œè¿™æ¡çº¿å°±æ˜¯ä¸€ä¸ªåˆ†æ”¯ï¼Œä¹Ÿå°±æ˜¯ä¸»åˆ†æ”¯ï¼Œä¹Ÿå«<code>master</code>åˆ†æ”¯ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰ã€‚ä¸¥æ ¼æ¥è¯´ï¼Œ<code>HEAD</code>å¹¶æ²¡æœ‰æŒ‡å‘æäº¤ï¼Œè€Œæ˜¯æŒ‡å‘äº†<code>master</code>ï¼Œ<code>master</code>æŒ‡å‘çš„æäº¤ã€‚æ¯æ¬¡æäº¤çš„æ—¶å€™ï¼Œ<code>master</code>å°±ä¼šå°†å½“å‰æäº¤æ—¶é—´ä¸²åœ¨æ—¶é—´çº¿ä¸Šï¼Œå¹¶ä¸”æŒ‡å‘å½“å‰æ—¶é—´ç‚¹ï¼Œéšç€ä¸æ–­çš„æäº¤ï¼Œ<code>master</code>åˆ†æ”¯ä¹Ÿè¶Šæ¥è¶Šé•¿ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨<code>git log</code>å‘½ä»¤çš„æ—¶å€™ï¼ŒæŸ¥çœ‹åˆ°çš„å°±æ˜¯è¿™æ¡æ—¶é—´çº¿ã€‚</p><h5 id="3-1-åˆ†æ”¯ç®¡ç†"><a href="#3-1-åˆ†æ”¯ç®¡ç†" class="headerlink" title="3.1 åˆ†æ”¯ç®¡ç†"></a>3.1 åˆ†æ”¯ç®¡ç†</h5><p>å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼Œæ¯”å¦‚å« <code>dev</code>ï¼Œç°åœ¨<code>dev</code>æŒ‡å‘çš„æäº¤å°±æ˜¯<code>master</code>æŒ‡å‘çš„æäº¤ï¼Œä½†æ˜¯<code>HEAD</code>ç°åœ¨æŒ‡å‘<code>dev</code>ï¼Œç°åœ¨æˆ‘ä»¬å†æäº¤çš„æ—¶å€™å°±æ˜¯æäº¤åœ¨<code>dev</code>åˆ†æ”¯äº†ï¼Œè€Œ<code>master</code>åˆ†æ”¯ä¸å˜ã€‚å½“æˆ‘ä»¬åœ¨<code>dev</code>åˆ†æ”¯ä¸Šå®Œæˆå¼€å‘å·¥ä½œï¼Œæ£€æŸ¥æ— è¯¯åï¼Œå°±å¯ä»¥å°†<code>dev</code>åˆ†æ”¯åˆå¹¶(merge)<code>master</code>åˆ†æ”¯ä¸Šäº†ã€‚<br>åº”ç”¨åœºæ™¯ï¼šå½“æˆ‘ä»¬çš„è½¯ä»¶å¼€å‘å®Œæˆ1.0ç‰ˆæœ¬åï¼Œç°åœ¨æœ‰äº†æ–°çš„éœ€æ±‚ï¼Œè¦å¼€å‘2.0ç‰ˆæœ¬ã€‚ä½†ä¸å¹¸çš„æ˜¯ï¼Œåœ¨å¼€å‘åˆ°ä¸€åŠçš„æ—¶å€™ï¼Œ1.0ç‰ˆæœ¬å‘ç°äº†å‡ ä¸ªbugï¼Œæ²¡åŠæ³•ï¼Œæ”¹å§ï¼Œä½†æ˜¯æˆ‘ä»¬æ˜¾ç„¶ä¸èƒ½å†ç°åœ¨çš„å·¥ç¨‹åŸºç¡€ä¸Šä¿®æ”¹ï¼Œå¦‚æœåœ¨ç°åœ¨å·¥ç¨‹ä¸Šä¿®æ”¹çš„è¯ï¼Œ1.0ç‰ˆæœ¬çš„è½¯ä»¶å°†ä¼šå¸¦æœ‰éƒ¨åˆ†2.0ç‰ˆæœ¬çš„ç‰¹æ€§æˆ–è€…åŠŸèƒ½ï¼Œæˆäº†1.5ç‰ˆæœ¬ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨å®Œæˆ1.0ç‰ˆæœ¬åï¼Œå°±å¯ä»¥æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œåœ¨æ–°çš„åˆ†æ”¯ä¸Šè¿›è¡Œæ–°çš„å¼€å‘ï¼Œåœ¨ç¡®è®¤å®Œæˆåï¼Œå†åˆå¹¶åˆ°ä¸»åˆ†æ”¯ã€‚<br>æ“ä½œå¦‚ä¸‹ï¼š</p><p><code>git checkout -b dev</code></p><p><code>-b</code>å‚æ•°è¡¨ç¤ºåˆ›å»ºå¹¶åˆ‡æ¢åˆ°æ–°çš„åˆ†æ”¯ï¼Œç›¸å½“äºä¸‹é¢ä¸¤æ¡å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs git">git branch dev<br>git checkout dev<br></code></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨<code>git branch</code>å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰çš„åˆ†æ”¯ï¼Œåœ¨å½“å‰æ‰€åœ¨çš„åˆ†æ”¯ä¸Šä¼šæœ‰<code>*</code>æç¤º.</p><p>ç°åœ¨æˆ‘ä»¬å¤„äº<code>dev</code>åˆ†æ”¯ä¸‹ï¼Œ<code>Test.txt</code>æ–‡ä»¶é‡Œé¢æ²¡æœ‰ä»»ä½•å†…å®¹ï¼Œå¯¹<code>Test.txt</code>è¿›è¡Œä¿®æ”¹å¹¶æäº¤ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs git">git add Test.txt<br>git commit -m &quot;branch test&quot;<br></code></pre></td></tr></table></figure><h5 id="3-2-åˆå¹¶åˆ†æ”¯"><a href="#3-2-åˆå¹¶åˆ†æ”¯" class="headerlink" title="3.2 åˆå¹¶åˆ†æ”¯"></a>3.2 åˆå¹¶åˆ†æ”¯</h5><p>ç„¶ååˆ‡æ¢åˆ°<code>master</code>åˆ†æ”¯ï¼Œå†å»æŸ¥çœ‹<code>Test.txt</code>æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œå¹¶ä¸æ˜¯å’Œ<code>dev</code>åˆ†å­ç›¸åŒã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æäº¤çš„å†…å®¹åœ¨<code>dev</code>åˆ†æ”¯ä¸Šï¼Œ<code>master</code>åˆ†æ”¯å¹¶æ²¡æœ‰åšä»€ä¹ˆæ”¹å˜ã€‚</p><p>ç„¶åå¯¹ä¸¤ä¸ªåˆ†æ”¯è¿›è¡Œåˆå¹¶,åˆå¹¶å®Œæˆååˆ é™¤<code>dev</code>åˆ†æ”¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs git">git merge dev<br>git branch -d dev<br></code></pre></td></tr></table></figure><p>åˆå¹¶å®Œæˆåå‘ç°<code>Test.txt</code>æ–‡ä»¶å†…å®¹ä¸<code>dev</code>åˆ†æ”¯ä¸‹çš„å®Œå…¨ç›¸åŒã€‚</p><h5 id="3-3-åˆå¹¶æ—¶çš„å†²çª"><a href="#3-3-åˆå¹¶æ—¶çš„å†²çª" class="headerlink" title="3.3 åˆå¹¶æ—¶çš„å†²çª"></a>3.3 åˆå¹¶æ—¶çš„å†²çª</h5><p>ä¸å¹¸çš„æ˜¯ï¼Œæ²¡æœ‰ä»€ä¹ˆæ˜¯ä¸€å¸†é£é¡ºçš„ï¼Œåˆå¹¶æ—¶é‡åˆ°äº†å†²çªæ€ä¹ˆåŠï¼Ÿç³»ç»Ÿç»™å‡ºäº†è¿™ä¹ˆä¸ªæç¤º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs git">D:\GitRepositorys [master]&gt; git merge dev<br>warning: Cannot merge binary files: Test.txt (HEAD vs<br>Auto-merging Test.txt<br>CONFLICT (content): Merge conflict in Test.txt<br>Automatic merge failed; fix conflicts and then commit<br>D:\GitRepositorys [master +0 ~0 -0 !1 | +0 ~0 -0 !1]&gt;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå†²çªè²Œä¼¼åªèƒ½æ‰‹åŠ¨ä¿®æ”¹(å€ŸåŠ©ä¸€äº›å·¥å…·æ¯”å¦‚beyond compile)ï¼Œæ‰“å¼€å†²çªçš„æ–‡ä»¶ï¼ŒæŸ¥çœ‹å†²çªæç¤ºï¼Œæ‰‹åŠ¨ä¿®æ”¹å®Œæˆåå†æäº¤ã€åˆå¹¶<br>ï¼ˆå…¶å®æˆ‘ä¹Ÿä¸å¤§æ‡‚ï¼Œåªæ˜¯å»ºè®®ä¸è¦åœ¨ä¸¤ä¸ªåˆ†æ”¯ä¸ŠåŒæ—¶ä¿®æ”¹åŒä¸€ä¸ªæ–‡ä»¶ï¼‰</p><h4 id="4-å¸¸ç”¨åˆ†æ”¯ç®¡ç†ç­–ç•¥"><a href="#4-å¸¸ç”¨åˆ†æ”¯ç®¡ç†ç­–ç•¥" class="headerlink" title="4 å¸¸ç”¨åˆ†æ”¯ç®¡ç†ç­–ç•¥"></a>4 å¸¸ç”¨åˆ†æ”¯ç®¡ç†ç­–ç•¥</h4><h5 id="4-1-åˆ†æ”¯åˆå¹¶æ¨¡å¼"><a href="#4-1-åˆ†æ”¯åˆå¹¶æ¨¡å¼" class="headerlink" title="4.1   åˆ†æ”¯åˆå¹¶æ¨¡å¼"></a>4.1   åˆ†æ”¯åˆå¹¶æ¨¡å¼</h5><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œgitåœ¨åˆå¹¶åˆ†æ”¯çš„æ—¶å€™ä¼šç”¨<code>Fast forward</code>æ¨¡å¼ï¼Œä½†æ˜¯åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œåˆ é™¤åˆ†æ”¯åï¼Œä¼šä¸¢æ‰åˆ†æ”¯ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯åˆ†æ”¯æäº¤çš„ä¿¡æ¯ï¼Œå¦‚æœå¼ºåˆ¶ç¦ç”¨<code>Fast forward</code>æ¨¡å¼ï¼Œgitåœ¨è‘›å†°åˆ†æ”¯çš„æ—¶å€™ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„<code>commit</code>ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼ˆå°†devåˆ†æ”¯åˆå¹¶åˆ°masteråˆ†æ”¯ä¸Šï¼‰ï¼š<br><code>git merge --no-ff -m &quot;ç¦ç”¨Fast forward æ¨¡å¼åˆå¹¶åˆ†æ”¯&quot; dev</code></p><h5 id="4-2-åˆ†æ”¯ç­–ç•¥"><a href="#4-2-åˆ†æ”¯ç­–ç•¥" class="headerlink" title="4.2 åˆ†æ”¯ç­–ç•¥"></a>4.2 åˆ†æ”¯ç­–ç•¥</h5><p>é¦–å…ˆï¼Œ<code>master</code>åˆ†æ”¯æ˜¯éå¸¸ç¨³å®šçš„ï¼Œä¹Ÿå°±æ˜¯ä»…ä»…ç”¨æ¥å‘å¸ƒæ–°çš„ç‰ˆæœ¬ã€‚<br>å…¶æ¬¡ï¼Œä»<code>master</code>åˆ†æ”¯ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼ˆdevï¼‰ï¼Œæ¯ä¸ªå¼€å‘äººå‘˜éƒ½æœ‰è‡ªå·±çš„åˆ†æ”¯ï¼ˆä»devåˆ†æ”¯ä¸Šåˆ›å»ºçš„ï¼‰ï¼Œæ¨é€ä»£ç æ—¶åªè¦å°†è‡ªå·±çš„åˆ†æ”¯å’Œdevåˆ†æ”¯åˆå¹¶å°±å¯ä»¥äº†ï¼Œ<br>æœ€åï¼Œå½“è¯å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶ï¼Œåªéœ€è¦å°†devåˆ†æ”¯åˆå¹¶åˆ°masteråˆ†æ”¯å°±å¯ä»¥äº†</p><h5 id="4-3-bugåˆ†æ”¯"><a href="#4-3-bugåˆ†æ”¯" class="headerlink" title="4.3 bugåˆ†æ”¯"></a>4.3 bugåˆ†æ”¯</h5><p>å½“ä½ æ­£åœ¨è¿›è¡Œå¼€å‘æ—¶ï¼Œçªç„¶é—´å‘ç°äº†ä»¥å‰çš„ä¸€ä¸ªbugï¼Œéœ€è¦ç«‹åˆ»ä¿®å¤ï¼Œä½†æ˜¯ä½ ç°åœ¨çš„å¼€å‘å·¥ä½œè¿˜æ²¡æœ‰å®Œæˆï¼Œæ²¡æœ‰åŠæ³•æäº¤ï¼Œgitæä¾›äº†ä¸€ä¸ª<code>stash</code>åŠŸèƒ½ï¼Œå¯ä»¥æŠŠå½“å‰åœºæ™¯ä¿å­˜èµ·æ¥ï¼Œç­‰ä»¥åå¯ä»¥æ¢å¤ç°åœºï¼š<code>git stash</code>ï¼Œç°åœ¨ç”¨<code>git status</code>æŸ¥çœ‹å·¥ä½œåŒºï¼Œæ˜¯å¹²å‡€çš„äº†ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼ˆé¦–å…ˆè¦ç¡®å®šä»å“ªä¸ªåˆ†æ”¯ä¸Šä¿®å¤bugï¼‰ï¼Œä¿®å¤å®Œæˆåï¼Œåˆå¹¶å¹¶åˆ é™¤bugåˆ†æ”¯ã€‚<br>ç°åœ¨æˆ‘ä»¬éœ€è¦æ¢å¤ç°åœºï¼Œä½¿ç”¨<code>git stash list</code>å‘½ä»¤æ¥æŸ¥çœ‹ä¿å­˜äº†å“ªäº›ç°åœºï¼Œæ¢å¤ç°åœºæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€æ˜¯ç”¨<code>git stash apply stash@&#123;NUM&#125;</code> æˆ–è€…æ˜¯ç”¨<code>git stash pop</code>ï¼ŒåŒºåˆ«æ˜¯å‰è€…ä¸ä¼šåˆ é™¤stashï¼Œæ¢å¤ç°åœºåéœ€è¦æ”¶åˆ°æ‰§è¡Œ <code>git stash drop</code>æ¥åˆ é™¤ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥å¤šæ¬¡stashç„¶åä½¿ç”¨<code>git stash apply stash@&#123;num&#125;</code>æ¥æ¢å¤æŒ‡å®šçš„ç°åœºã€‚</p><h4 id="5-å¤šäººåä½œ"><a href="#5-å¤šäººåä½œ" class="headerlink" title="5. å¤šäººåä½œ"></a>5. å¤šäººåä½œ</h4><h5 id="5-1-å…‹éš†ä»“åº“"><a href="#5-1-å…‹éš†ä»“åº“" class="headerlink" title="5.1 å…‹éš†ä»“åº“"></a>5.1 å…‹éš†ä»“åº“</h5><p>å½“ä½ ä»è¿œç¨‹ä»“åº“å…‹éš†æ—¶ï¼Œå®é™…ä¸ŠGitè‡ªåŠ¨æŠŠæœ¬åœ°çš„<code>master</code>åˆ†æ”¯å’Œè¿œç¨‹çš„<code>master</code>åˆ†æ”¯å¯¹åº”èµ·æ¥äº†ï¼Œå¹¶ä¸”ï¼Œè¿œç¨‹ä»“åº“çš„é»˜è®¤åç§°æ˜¯<code>origin</code>ã€‚</p><p>è¦æŸ¥çœ‹è¿œç¨‹åº“çš„ä¿¡æ¯ï¼Œç”¨g<code>it remoteï¼š</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs git">$ git remote<br>origin<br></code></pre></td></tr></table></figure><p>æˆ–è€…ï¼Œç”¨<code>git remote -v</code>æ˜¾ç¤ºæ›´è¯¦ç»†çš„ä¿¡æ¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs git">$ git remote -v<br>origin  git@github.com:michaelliao/learngit.git (fetch)<br>origin  git@github.com:michaelliao/learngit.git (push)<br></code></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¾ç¤ºäº†å¯ä»¥æŠ“å–å’Œæ¨é€çš„originçš„åœ°å€ã€‚å¦‚æœæ²¡æœ‰æ¨é€æƒé™ï¼Œå°±çœ‹ä¸åˆ°pushçš„åœ°å€ã€‚</p><h5 id="5-2-æ¨é€åˆ†æ”¯"><a href="#5-2-æ¨é€åˆ†æ”¯" class="headerlink" title="5.2 æ¨é€åˆ†æ”¯"></a>5.2 æ¨é€åˆ†æ”¯</h5><p>æ¨é€æ—¶ï¼Œè¦æŒ‡å®šæœ¬åœ°åˆ†æ”¯ï¼Œè¿™æ ·ï¼ŒGitå°±ä¼šæŠŠè¯¥åˆ†æ”¯æ¨é€åˆ°è¿œç¨‹åº“å¯¹åº”çš„è¿œç¨‹åˆ†æ”¯ä¸Šï¼š<br><code>$ git push origin master</code><br>å¦‚æœè¦æ¨é€å…¶ä»–åˆ†æ”¯ï¼Œæ¯”å¦‚devï¼Œå°±æ”¹æˆï¼š<br><code>$ git push origin dev</code></p><p>å…¶ä¸­<code>origin</code>å°±æ˜¯ä¸Šç¯‡æ–‡ç« ä¸­æåˆ°çš„<code>æœ¬åœ°åˆ«å</code></p><h5 id="5-3-æŠ“å–åˆ†æ”¯"><a href="#5-3-æŠ“å–åˆ†æ”¯" class="headerlink" title="5.3 æŠ“å–åˆ†æ”¯"></a>5.3 æŠ“å–åˆ†æ”¯</h5><p>å¤šäººåä½œæ—¶ï¼Œå¤§å®¶éƒ½ä¼šå¾€<code>master</code>å’Œ<code>dev</code>åˆ†æ”¯ä¸Šæ¨é€å„è‡ªçš„ä¿®æ”¹ã€‚å½“æˆ‘ä»¬ä»è¿œç¨‹ä»“åº“å…‹éš†çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªèƒ½çœ‹åˆ°æœ¬åœ°<code>master</code>åˆ†æ”¯ï¼Œå¦‚æœæˆ‘ä»¬è¦åœ¨å…¶ä»–åˆ†æ”¯ä¸Šå¼€å‘ï¼Œå°±å¿…é¡»åˆ›å»º<code>origin</code>çš„å…¶ä»–åˆ†æ”¯åˆ°æœ¬åœ°ï¼Œæˆ–è€…è¯´å»ºç«‹è¿œç¨‹åˆ†æ”¯å’Œæœ¬åœ°åˆ†æ”¯çš„å…³è”:<br><code>git checkout -b dev origin/dev</code>,ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨<code>dev</code>åˆ†æ”¯ä¸Šç»§ç»­ä¿®æ”¹ï¼Œç„¶åå°†ä¿®æ”¹åçš„é¡¹ç›®æ¨é€åˆ°è¿œç¨‹</p><h4 id="6-æ ‡ç­¾ç®¡ç†"><a href="#6-æ ‡ç­¾ç®¡ç†" class="headerlink" title="6. æ ‡ç­¾ç®¡ç†"></a>6. æ ‡ç­¾ç®¡ç†</h4><h5 id="6-1-åˆ›å»ºæ ‡ç­¾"><a href="#6-1-åˆ›å»ºæ ‡ç­¾" class="headerlink" title="6.1 åˆ›å»ºæ ‡ç­¾"></a>6.1 åˆ›å»ºæ ‡ç­¾</h5><p>é¦–å…ˆåˆ‡æ¢åˆ°éœ€è¦æ‰“æ ‡ç­¾çš„åˆ†æ”¯ä¸Šï¼Œ<code>git checkout branch-name</code>,<br>ç„¶åä½¿ç”¨å‘½ä»¤<code>git tag &lt;name&gt;</code>å°±å¯ä»¥äº†ï¼Œé»˜è®¤æ ‡ç­¾æ˜¯æ‰“åœ¨æœ€æ–°æäº¤ä¸Šçš„ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æ‰“åœ¨ä»¥å‰çš„æäº¤ä¸Šï¼Œå¯ä»¥ä½¿ç”¨<code>git log</code>æŸ¥çœ‹ä»¥å‰æäº¤çš„commit idï¼Œç„¶åä½¿ç”¨<code>git tag &lt;name&gt; &lt;commit id&gt;</code>å°±å¯ä»¥äº†ã€‚å¯ä»¥ä½¿ç”¨å‘½ä»¤<code>git tag</code>æŸ¥çœ‹æ ‡ç­¾ï¼Œä½†æ˜¯æ ‡ç­¾ä¸æ˜¯æŒ‰ç…§æ—¶é—´é¡ºåºæ’åºçš„ï¼Œè€Œæ˜¯æŒ‰ç…§å­—æ¯é¡ºåºæ’åºã€‚åœ¨æ‰“æ ‡ç­¾çš„æ—¶å€™å¯ä»¥å¸¦æœ‰è¯´æ˜ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š<br><code>git tag -a &lt;tag-name&gt; -m &quot;comment&quot; &lt;commit id&gt;</code><br>ä½¿ç”¨å‘½ä»¤<code>git show &lt;tag-name&gt;</code>å¯ä»¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ã€‚</p><h5 id="6-2-åˆ é™¤æ ‡ç­¾"><a href="#6-2-åˆ é™¤æ ‡ç­¾" class="headerlink" title="6.2 åˆ é™¤æ ‡ç­¾"></a>6.2 åˆ é™¤æ ‡ç­¾</h5><p>å¦‚æœæ ‡ç­¾æ‰“é”™äº†ï¼Œå¯ä»¥ä½¿ç”¨<code>git tag -d &lt;tag-name&gt;</code>æ¥åˆ é™¤æŒ‡å®šçš„æ ‡ç­¾ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ ‡ç­¾ä¸ä¼šè‡ªåŠ¨æ¨é€åˆ°è¿œç¨‹ã€‚å¦‚æœæƒ³æŠŠæŸä¸ªæ ‡ç­¾æ¨é€åˆ°è¿œç¨‹ï¼Œå¯ä»¥ä½¿ç”¨<code>git push origin &lt;tag-name&gt;</code>ï¼Œæˆ–è€…ä¸€æ¬¡æ€§æ¨é€æ‰€æœ‰æœ¬åœ°çš„æ ‡ç­¾:<code>git push origin --tags</code>,å¦‚æœæ ‡ç­¾å·²ç»æ¨é€çš„è¿œç¨‹ä»“åº“ï¼Œæƒ³è¦åˆ é™¤è¿œç¨‹ä»“åº“çš„æ ‡ç­¾éœ€è¦å¦‚ä¸‹ä¸¤æ­¥:<br>é¦–å…ˆåˆ é™¤æœ¬åœ°æ ‡ç­¾ <code>git tag -d  &lt;tag-name&gt;</code><br>ç„¶åä»è¿œç¨‹åˆ é™¤ <code>git push origin :refs/tags/&lt;tag-name&gt;</code></p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>è¿ç»´</tag>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®‰è£…gitä¸è¿æ¥github</title>
    <link href="/2019/01/27/%E5%AE%89%E8%A3%85git%E4%B8%8E%E8%BF%9E%E6%8E%A5github/"/>
    <url>/2019/01/27/%E5%AE%89%E8%A3%85git%E4%B8%8E%E8%BF%9E%E6%8E%A5github/</url>
    
    <content type="html"><![CDATA[<p>è¿™å¯èƒ½æ˜¯æœ‰å²ä»¥æ¥æˆ‘å†™è¿‡çš„æœ€å•°å—¦çš„åšå®¢äº†ã€‚</p><span id="more"></span><h4 id="1-å®‰è£…github"><a href="#1-å®‰è£…github" class="headerlink" title="1. å®‰è£…github"></a>1. å®‰è£…github</h4><h5 id="1-1-åœ¨linuxä¸Šå®‰è£…github"><a href="#1-1-åœ¨linuxä¸Šå®‰è£…github" class="headerlink" title="1.1  åœ¨linuxä¸Šå®‰è£…github"></a>1.1  åœ¨linuxä¸Šå®‰è£…github</h5><p>é¦–å…ˆå¯ä»¥è¯•ç€åœ¨shellä¸­è¾“å…¥<code>git</code>ï¼Œè‹¥æç¤ºæ²¡æœ‰è¯¥å‘½ä»¤ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>sudo apt-get install git</code> æ¥å®‰è£…ï¼Œ</p><h5 id="1-2-åœ¨windowsä¸Šå®‰è£…github"><a href="#1-2-åœ¨windowsä¸Šå®‰è£…github" class="headerlink" title="1.2  åœ¨windowsä¸Šå®‰è£…github"></a>1.2  åœ¨windowsä¸Šå®‰è£…github</h5><p>å¯ä»¥åœ¨[<a href="https://git-scm.com/downloads]https://git-scm.com/downloads">https://git-scm.com/downloads]https://git-scm.com/downloads</a>) ä¸‹è½½ï¼Œç„¶åé»˜è®¤å®‰è£…å°±å¯ä»¥äº†ï¼Œå®‰è£…ååœ¨ç©ºç™½å¤„å³é”®ï¼Œä¼šæœ‰<code>git GUI here</code>å’Œ<code>git bash here</code>ã€‚</p><h4 id="é…ç½®æœ¬åœ°å’Œè¿œç¨‹gitä»“åº“"><a href="#é…ç½®æœ¬åœ°å’Œè¿œç¨‹gitä»“åº“" class="headerlink" title="é…ç½®æœ¬åœ°å’Œè¿œç¨‹gitä»“åº“"></a>é…ç½®æœ¬åœ°å’Œè¿œç¨‹gitä»“åº“</h4><h5 id="2-1-é…ç½®æœ¬åœ°ç¯å¢ƒ"><a href="#2-1-é…ç½®æœ¬åœ°ç¯å¢ƒ" class="headerlink" title="2.1  é…ç½®æœ¬åœ°ç¯å¢ƒ"></a>2.1  é…ç½®æœ¬åœ°ç¯å¢ƒ</h5><p>æ‰“å¼€ git shell ,é…ç½®ç”¨æˆ·åå’Œé‚®ç®±(è¿™é‡Œçš„ç”¨æˆ·åé‚®ç®±ä¸ä¸‹æ–‡ä¸­çš„è¿æ¥githubæˆ–è€…å…¶ä»–ä¸‰æ–¹gitæœåŠ¡æ²¡æœ‰ä»»ä½•å…³ç³»)    </p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">git config <span class="hljs-attr">--global</span> user<span class="hljs-selector-class">.name</span> <span class="hljs-string">&quot;Your Name&quot;</span><br>git config <span class="hljs-attr">--global</span> user<span class="hljs-selector-class">.email</span> <span class="hljs-string">&quot;email@example.com&quot;</span><br></code></pre></td></tr></table></figure><p>#####2.2  é…ç½®è¿œç¨‹ä»“åº“<br>ä»¥githubä¸ºä¾‹ï¼Œå…¶ä»–gitæœåŠ¡ä¹Ÿç±»ä¼¼<br>ç”³è¯·å¥½è´¦å·ä¹‹åï¼Œç‚¹å‡»å³ä¸Šè§’è‡ªå·±çš„å¤´åƒåœ¨å¼¹å‡ºèœå•ä¸­é€‰æ‹©<code>settings</code>ï¼Œçœ‹èµ·æ¥åƒä¸‹é¢è¿™æ ·ï¼š<br><img src="/image/git/githubHomePage.png" alt="githubHomePage"><br>åœ¨æ–°ç•Œé¢ä¸­çš„å·¦ä¾§åˆ—è¡¨ä¸­é€‰æ‹©<code>SSH keys</code>ï¼Œç‚¹å‡»å³ä¸Šè§’çš„ <code>Add SSH key</code>ï¼Œçœ‹èµ·æ¥åƒä¸‹é¢è¿™æ ·<br><img src="/image/git/githubSSHKEY.png" alt="githubSSHkey"><br>ç„¶åæˆ‘ä»¬å›åˆ°shellä¸­ï¼Œç»§ç»­ç”Ÿæˆå¯†é’¥ç­‰å·¥ä½œ<br>githubå®˜ç½‘æœ‰è¯¦ç»†æ•™ç¨‹ï¼Œé“¾æ¥åœ°å€è¯·ç‚¹<a href="https://help.github.com/articles/generating-ssh-keys/#platform-windows">https://help.github.com/articles/generating-ssh-keys/#platform-windows</a> ï¼Œgithubç½‘ç«™è®¿é—®é€Ÿåº¦æ…¢çš„å¯ä»¥ç»§ç»­çœ‹ä¸‹å»ï¼Œå»githubå®˜ç½‘çœ‹çš„è¯·è·³è¿‡æœ¬ç« </p><h5 id="2-3-ç”Ÿæˆssh-keys"><a href="#2-3-ç”Ÿæˆssh-keys" class="headerlink" title="2.3  ç”Ÿæˆssh keys"></a>2.3  ç”Ÿæˆssh keys</h5><p>é¦–å…ˆæ£€æµ‹æœ‰æ²¡æœ‰å·²ç»ç”Ÿæˆå¥½çš„ssh keyï¼Œwindowsç”¨æˆ·å¯ä»¥æŸ¥çœ‹ <code>C:\Users\username\.ssh</code>æ–‡ä»¶å¤¹ä¸‹æœ‰æ²¡æœ‰<code>id_rsa.pub</code>æ–‡ä»¶ï¼Œlinuxç”¨æˆ·å¯ä»¥åœ¨shellä¸­è¾“å…¥<code>ls -al ~/.ssh</code>ï¼Œè‹¥æœ‰ï¼Œè¯·è·³è¿‡æœ¬æ­¥éª¤ã€‚<br>åœ¨git shell ä¸­è¾“å…¥ä¸‹é¢ç¬¬ä¸€æ¡å‘½ä»¤ï¼Œlinuxç”¨æˆ·æ³¨æ„ä¸ç”¨åŠ  <code>sudo</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh-keygen -t rsa -b 4096 -C &quot;your_email@example.com&quot;<br>Creates a new ssh key, using the provided email as a label<br>Generating public/private rsa key pair.<br></code></pre></td></tr></table></figure><p>å»ºè®®ä½¿ç”¨é»˜è®¤ä½ç½®ï¼Œç›´æ¥å›è½¦å°±å¥½ï¼Œæ¥ä¸‹æ¥ä¼šæç¤ºæ˜¯å¦éœ€è¦å¯†ç ï¼Œä¸éœ€è¦çš„è¯ç›´æ¥å›è½¦ç¡®è®¤ï¼Œéœ€è¦çš„è¯è¾“å…¥å¯†ç ï¼Œç„¶åç¡®è®¤å¯†ç ï¼Œç„¶åä¼šæç¤ºä½ å¯†é’¥å·²ç»ç”Ÿæˆã€‚</p><h5 id="2-5-å°†ssh-keyæ·»åŠ åˆ°ä½ çš„githubè´¦æˆ·ä¸­"><a href="#2-5-å°†ssh-keyæ·»åŠ åˆ°ä½ çš„githubè´¦æˆ·ä¸­" class="headerlink" title="2.5 å°†ssh keyæ·»åŠ åˆ°ä½ çš„githubè´¦æˆ·ä¸­"></a>2.5 å°†ssh keyæ·»åŠ åˆ°ä½ çš„githubè´¦æˆ·ä¸­</h5><p>å›åˆ°æˆ‘ä»¬æ‰“å¼€çš„æ·»åŠ SSHKEYç½‘é¡µï¼Œç‚¹å‡»<code>Add SSH Key</code>ï¼Œåœ¨<code>Title</code>ä¸­æ·»åŠ è¯´æ˜ï¼Œç”¨è®°äº‹æœ¬ä¹‹ç±»çš„ç¼–è¾‘å™¨æ‰“å¼€ç”Ÿæˆçš„<code>id_rsa.pub</code>ï¼ˆä½äº.sshæ–‡ä»¶ä¸­ï¼‰ï¼Œå¤åˆ¶å…¶ä¸­çš„å†…å®¹åˆ°<code>Key</code>ä¸­ï¼Œç„¶åç‚¹å‡»<code>Add Key</code></p><h5 id="2-6-æµ‹è¯•è¿æ¥"><a href="#2-6-æµ‹è¯•è¿æ¥" class="headerlink" title="2.6 æµ‹è¯•è¿æ¥"></a>2.6 æµ‹è¯•è¿æ¥</h5><p>æ‰“å¼€ git shell è¾“å…¥<code>ssh -T git@github.com</code>ï¼Œè‹¥æç¤º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">The authenticity of host &#x27;github.com (207.97.227.239)&#x27; can&#x27;t be established.<br><span class="hljs-meta prompt_"># </span><span class="language-bash">RSA key fingerprint is 16:27:ac:a5:76:28:2d:36:63:1b:56:4d:eb:<span class="hljs-built_in">df</span>:a6:48.</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Are you sure you want to <span class="hljs-built_in">continue</span> connecting (<span class="hljs-built_in">yes</span>/no)?</span><br>è¾“å…¥`yes`ï¼Œå¦‚æœä½ çœ‹åˆ°äº†å¦‚ä¸‹æç¤º<br>Hi username! You&#x27;ve successfully authenticated, but GitHub does not<br><span class="hljs-meta prompt_"># </span><span class="language-bash">provide shell access.</span><br></code></pre></td></tr></table></figure><p>è¯´æ˜è¿æ¥æˆåŠŸï¼Œè‹¥æœ‰é—®é¢˜ï¼Œè¯·ç‚¹å‡»<a href="https://help.github.com/categories/ssh/">è¿™é‡Œ</a>.</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>è¿ç»´</tag>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è‡ªå®šä¹‰View--è´å¡å°”æ›²çº¿ã€Shader</title>
    <link href="/2019/01/20/%E8%87%AA%E5%AE%9A%E4%B9%89View-%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF%E3%80%81Shader/"/>
    <url>/2019/01/20/%E8%87%AA%E5%AE%9A%E4%B9%89View-%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF%E3%80%81Shader/</url>
    
    <content type="html"><![CDATA[<p>è´å¡å°”æ›²çº¿å¯ä»¥å°†Pathä¸­çš„moveToã€LineToç­‰è¿æ¥çš„ç”Ÿç¡¬è·¯å¾„å˜å¾—å¹³æ»‘ï¼Œä¹Ÿèƒ½å®ç°å¾ˆå¤šå¥½çœ‹çš„æ•ˆæœã€‚</p><ol><li><p>ä¸€é˜¶è´å¡æ›²çº¿</p><p>$B(t)&#x3D;P_0(1-t)+tP_1,t\in[0,1]$</p><p><img src="/image/Android/customview/B%C3%A9zier_curve_1.gif" alt="ä¸€é˜¶è´å¡æ›²çº¿"></p></li><li><p>äºŒé˜¶è´å¡å°”æ›²çº¿</p><p>$B(t)&#x3D;P_0(1-t)^2+2t(1-t)P_1+  t^2P_2,t\in[0,1]$</p><p><img src="/image/Android/customview/B%C3%A9zier_curve_2.gif" alt="äºŒé˜¶è´å¡æ›²çº¿"></p></li><li><p>ä¸‰é˜¶è´å¡å°”æ›²çº¿</p><p>$B(t)&#x3D;P_0(1-t)^3+3P_1t(1-t)^2+  3P_2t^2(1-t)+P_3t^3,t\in[0,1]$</p><p><img src="/image/Android/customview/B%C3%A9zier_curve_3.gif" alt="ä¸‰é˜¶è´å¡æ›²çº¿"></p></li></ol><span id="more"></span><h4 id="è´å¡å°”æ›²çº¿çš„åº”ç”¨"><a href="#è´å¡å°”æ›²çº¿çš„åº”ç”¨" class="headerlink" title="è´å¡å°”æ›²çº¿çš„åº”ç”¨"></a>è´å¡å°”æ›²çº¿çš„åº”ç”¨</h4><h5 id="æ‰‹åŠ¿è¿½è¸ªï¼Œæ”¹å˜moveToã€LineToç”Ÿç¡¬è·¯å¾„ç°è±¡"><a href="#æ‰‹åŠ¿è¿½è¸ªï¼Œæ”¹å˜moveToã€LineToç”Ÿç¡¬è·¯å¾„ç°è±¡" class="headerlink" title="æ‰‹åŠ¿è¿½è¸ªï¼Œæ”¹å˜moveToã€LineToç”Ÿç¡¬è·¯å¾„ç°è±¡"></a>æ‰‹åŠ¿è¿½è¸ªï¼Œæ”¹å˜moveToã€LineToç”Ÿç¡¬è·¯å¾„ç°è±¡</h5><p>ä¼ ç»Ÿæ‰‹åŠ¿åˆ’çº¿ï¼Œé‡å†™onTouchEventæ–¹æ³•ï¼Œåœ¨ACTION_MOVEäº‹ä»¶ä¸­åˆ’çº¿å°±å¥½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onTouchEvent</span><span class="hljs-params">(MotionEvent event)</span> &#123;<br>    <span class="hljs-keyword">switch</span> (event.getAction()) &#123;<br>        <span class="hljs-keyword">case</span> MotionEvent.ACTION_DOWN:<br>            path.moveTo(event.getX(),event.getY());<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> MotionEvent.ACTION_MOVE:<br>            path.lineTo(event.getX(),event.getY());<br>            postInvalidate();<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> MotionEvent.ACTION_UP:<br>            <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯ï¼Œç”»å‡ºæ¥çš„çº¿æ¡åœ¨è½¬å¼¯å¤„æ¯”è¾ƒç”Ÿç¡¬ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è´å¡å°”æ›²çº¿æ¥ä¼˜åŒ–ä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onTouchEvent</span><span class="hljs-params">(MotionEvent event)</span> &#123;<br>    <span class="hljs-keyword">switch</span> (event.getAction()) &#123;<br>        <span class="hljs-keyword">case</span> MotionEvent.ACTION_DOWN:<br>            path.moveTo(event.getX(), event.getY());<br>            preX = event.getX();<br>            preY = event.getY();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        <span class="hljs-keyword">case</span> MotionEvent.ACTION_MOVE:<br>            <span class="hljs-type">float</span> <span class="hljs-variable">endX</span> <span class="hljs-operator">=</span> (preX + event.getX()) / <span class="hljs-number">2</span>;<br>            <span class="hljs-type">float</span> <span class="hljs-variable">endY</span> <span class="hljs-operator">=</span> (preY + event.getY()) / <span class="hljs-number">2</span>;<br>            path.quadTo(preX,preY,endX,endY);<br>            preX = event.getX();<br>            preY = event.getY();<br>            postInvalidate();<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.onTouchEvent(event);<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="æ³¢æµªæ•ˆæœ"><a href="#æ³¢æµªæ•ˆæœ" class="headerlink" title="æ³¢æµªæ•ˆæœ"></a>æ³¢æµªæ•ˆæœ</h5><p><img src="/image/Android/customview/wave_anim.gif" alt="æ³¢æµªæ•ˆæœ"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è´å¡å°”æ›²çº¿å®ç°æ³¢çº¹æ•ˆæœ</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WaveAnimationView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">View</span> &#123;<br>    <span class="hljs-keyword">private</span> Paint paint;<br>    <span class="hljs-keyword">private</span> Path path;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">itemWaveLength</span> <span class="hljs-operator">=</span> <span class="hljs-number">1080</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> dx;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">WaveAnimationView</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context);<br>        init();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">WaveAnimationView</span><span class="hljs-params">(Context context, <span class="hljs-meta">@Nullable</span> AttributeSet attrs)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context, attrs);<br>        init();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">WaveAnimationView</span><span class="hljs-params">(Context context, <span class="hljs-meta">@Nullable</span> AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);<br>        init();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span>&#123;<br>        path = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>();<br>        paint = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paint</span>();<br>        paint.setColor(Color.GREEN);<br>        paint.setStyle(Paint.Style.FILL);<br>        startAnim();<br>    &#125;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDraw</span><span class="hljs-params">(Canvas canvas)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onDraw(canvas);<br>        path.reset();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">originY</span> <span class="hljs-operator">=</span> <span class="hljs-number">300</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">halfWaveLen</span> <span class="hljs-operator">=</span> itemWaveLength/<span class="hljs-number">2</span>;<br>        path.moveTo(-itemWaveLength+dx,originY);<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> -itemWaveLength;i&lt;getWidth()+itemWaveLength;i+=itemWaveLength)&#123;<br>            path.rQuadTo(halfWaveLen/<span class="hljs-number">2</span>,-<span class="hljs-number">100</span>,halfWaveLen,<span class="hljs-number">0</span>);<br>            path.rQuadTo(halfWaveLen/<span class="hljs-number">2</span>,<span class="hljs-number">100</span>,halfWaveLen,<span class="hljs-number">0</span>);<br>        &#125;<br>        path.lineTo(getWidth(),getHeight());<br>        path.lineTo(<span class="hljs-number">0</span>,getHeight());<br>        path.close();<br>        canvas.drawPath(path,paint);<br><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startAnim</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">ValueAnimator</span> <span class="hljs-variable">animator</span> <span class="hljs-operator">=</span> ValueAnimator.ofInt(<span class="hljs-number">0</span>,itemWaveLength);<br>        animator.setDuration(<span class="hljs-number">2000</span>);<br>        animator.setRepeatCount(ValueAnimator.INFINITE);<br>        animator.setInterpolator(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LinearInterpolator</span>());<br>        animator.addUpdateListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ValueAnimator</span>.AnimatorUpdateListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAnimationUpdate</span><span class="hljs-params">(ValueAnimator animation)</span> &#123;<br>                dx = (<span class="hljs-type">int</span>) animation.getAnimatedValue();<br>                postInvalidate();<br>            &#125;<br>        &#125;);<br>        animator.start();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…ˆæ”¾ä»£ç ï¼Œå†ä¸€ç‚¹ç‚¹è§£é‡Šã€‚</p><p>é¦–å…ˆinité‡Œé¢åˆå§‹åŒ–éœ€è¦ç”¨åˆ°çš„å˜é‡ã€‚ç„¶ååœ¨onDrawæ–¹æ³•ä¸­ï¼Œæ•´ä¸ªæ¨ªå‘ä¸Šç”»æ»¡æ³¢æµª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">path.reset();<br><span class="hljs-type">int</span> <span class="hljs-variable">originY</span> <span class="hljs-operator">=</span> <span class="hljs-number">300</span>;<br><span class="hljs-type">int</span> <span class="hljs-variable">halfWaveLen</span> <span class="hljs-operator">=</span> itemWaveLength/<span class="hljs-number">2</span>;<br>path.moveTo(-itemWaveLength+dx,originY);<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> -itemWaveLength;i&lt;getWidth()+itemWaveLength;i+=itemWaveLength)&#123;<br>    path.rQuadTo(halfWaveLen/<span class="hljs-number">2</span>,-<span class="hljs-number">100</span>,halfWaveLen,<span class="hljs-number">0</span>);<br>    path.rQuadTo(halfWaveLen/<span class="hljs-number">2</span>,<span class="hljs-number">100</span>,halfWaveLen,<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åå°†æ³¢æµªåº•éƒ¨å¡«æ»¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">path.lineTo(getWidth(),getHeight());<br>path.lineTo(<span class="hljs-number">0</span>,getHeight());<br>path.close();<br>canvas.drawPath(path,paint);<br></code></pre></td></tr></table></figure><p>ä¹‹åå°†ç”»é¢ç§»åŠ¨èµ·æ¥å°±å¥½äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startAnim</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">ValueAnimator</span> <span class="hljs-variable">animator</span> <span class="hljs-operator">=</span> ValueAnimator.ofInt(<span class="hljs-number">0</span>,itemWaveLength);<br>    animator.setDuration(<span class="hljs-number">2000</span>);<br>    animator.setRepeatCount(ValueAnimator.INFINITE);<br>    animator.setInterpolator(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LinearInterpolator</span>());<br>    animator.addUpdateListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ValueAnimator</span>.AnimatorUpdateListener() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAnimationUpdate</span><span class="hljs-params">(ValueAnimator animation)</span> &#123;<br>            dx = (<span class="hljs-type">int</span>) animation.getAnimatedValue();<br>            postInvalidate();<br>        &#125;<br>    &#125;);<br>    animator.start();<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æœ›è¿œé•œæ•ˆæœ-ç‚¹å‡»å“ªé‡Œåˆ™å“ªé‡Œå‡ºç°å›¾åƒ"><a href="#æœ›è¿œé•œæ•ˆæœ-ç‚¹å‡»å“ªé‡Œåˆ™å“ªé‡Œå‡ºç°å›¾åƒ" class="headerlink" title="æœ›è¿œé•œæ•ˆæœ(ç‚¹å‡»å“ªé‡Œåˆ™å“ªé‡Œå‡ºç°å›¾åƒ)"></a>æœ›è¿œé•œæ•ˆæœ(ç‚¹å‡»å“ªé‡Œåˆ™å“ªé‡Œå‡ºç°å›¾åƒ)</h4><p><img src="/image/Android/customview/shader.gif" alt="æœ›è¿œé•œæ•ˆæœ"></p><p>å…ˆä¸Šä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShadowLayerView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">View</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Paint paint;<br>    <span class="hljs-keyword">private</span> Bitmap bitmap;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> preX;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> preY;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ShadowLayerView</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context);<br>        init();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ShadowLayerView</span><span class="hljs-params">(Context context, <span class="hljs-meta">@Nullable</span> AttributeSet attrs)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context, attrs);<br>        init();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ShadowLayerView</span><span class="hljs-params">(Context context, <span class="hljs-meta">@Nullable</span> AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);<br>        init();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> &#123;<br>        paint = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paint</span>();<br>        bitmap = BitmapFactory.decodeResource(getResources(), R.drawable.test);<br>        setLayerType(LAYER_TYPE_SOFTWARE, <span class="hljs-literal">null</span>);<br>        paint.setColor(Color.BLACK);<br>        paint.setTextSize(<span class="hljs-number">125</span>);<br>        paint.setShader(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BitmapShader</span>(bitmap, Shader.TileMode.REPEAT, Shader.TileMode.MIRROR));<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDraw</span><span class="hljs-params">(Canvas canvas)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onDraw(canvas);<br>        paint.clearShadowLayer();<br>        <span class="hljs-keyword">if</span> (preY != -<span class="hljs-number">1</span> &amp;&amp; preX != -<span class="hljs-number">1</span>) &#123;<br>            canvas.drawCircle(preX, preY, <span class="hljs-number">150</span>, paint);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onTouchEvent</span><span class="hljs-params">(MotionEvent event)</span> &#123;<br>        <span class="hljs-keyword">switch</span> (event.getAction()) &#123;<br>            <span class="hljs-keyword">case</span> MotionEvent.ACTION_DOWN:<br>                preX = (<span class="hljs-type">int</span>) event.getX();<br>                preY = (<span class="hljs-type">int</span>) event.getY();<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> MotionEvent.ACTION_MOVE:<br>                preX = (<span class="hljs-type">int</span>) event.getX();<br>                preY = (<span class="hljs-type">int</span>) event.getY();<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> MotionEvent.ACTION_UP:<br>                preX = -<span class="hljs-number">1</span>;<br>                preY=-<span class="hljs-number">1</span>;<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>        postInvalidate();<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>initä¸­åˆå§‹åŒ–éœ€è¦çš„å˜é‡åŠå›¾ç‰‡èµ„æºï¼Œpaint.setShaderæ˜¯ä¸ºäº†è®©å›¾ç‰‡é“ºæ»¡æ•´ä¸ªå±å¹•(å¯ä»¥çœç•¥)ã€‚</p><p>åœ¨onTouchEventä¸­ä¿å­˜äº†å½“å‰ç‚¹å‡»ä»¥åŠç§»åŠ¨æ—¶çš„åæ ‡ï¼Œåœ¨ç»“æŸç‚¹å‡»çš„æ—¶å€™å°†åæ ‡ç‚¹é‡ç½®ä¸º-1ã€‚</p><p>åœ¨onDrawæ–¹æ³•ä¸­ï¼Œå½“åæ ‡ä¸æ˜¯(-1,-1)æ—¶ï¼Œåˆ™ä»¥ç‚¹å‡»çš„åæ ‡ä¸ºåœ†å¿ƒï¼Œç”»ä¸€ä¸ªåœ†åœˆï¼ŒæŠŠåœ†åœˆéƒ¨åˆ†æ˜¾ç¤ºå‡ºæ¥ã€‚</p><p>å½“ç„¶ï¼Œåˆ®å¥–æ•ˆæœä¹Ÿå¯ä»¥ç”¨è¿™ç§æ–¹å¼å®ç°ï¼Œåªéœ€è¦ä¿å­˜ä¸€ä¸‹ç§»åŠ¨çš„åæ ‡(ç»“åˆä¸Šé¢çš„æ‰‹åŠ¿è¿½è¸ª)ï¼ŒæŠŠè·¯å¾„ç”»å‡ºæ¥å°±å¥½äº†ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ©ç”¨PathMeasureå®ç°è·¯å¾„åŠ¨ç”»</title>
    <link href="/2019/01/04/%E5%88%A9%E7%94%A8PathMeasure%E5%AE%9E%E7%8E%B0%E8%B7%AF%E5%BE%84%E5%8A%A8%E7%94%BB/"/>
    <url>/2019/01/04/%E5%88%A9%E7%94%A8PathMeasure%E5%AE%9E%E7%8E%B0%E8%B7%AF%E5%BE%84%E5%8A%A8%E7%94%BB/</url>
    
    <content type="html"><![CDATA[<p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è·¯å¾„åŠ¨ç”»å®ç°å¾ˆå¤šå¥½ç©çš„ä¸œè¥¿ï¼Œæ¯”å¦‚ä¸Šé¢å›¾ä¸­çš„ç±»ä¼¼æ”¯ä»˜å®æ”¯ä»˜å®Œæˆçš„åŠ¨ç”»ã€‚<br>ä¸»è¦ç”¨åˆ°äº†<code>PathMeasure</code>,<code>ValueAnumator</code>è¿™ä¸¤ä¸ªç±»</p><span id="more"></span><h4 id="PathMeasure"><a href="#PathMeasure" class="headerlink" title="PathMeasure"></a>PathMeasure</h4><p>ç±»ä¼¼äºä¸€ä¸ªè®¡ç®—å™¨ï¼Œå¯ä»¥è®¡ç®—ä¸€äº›å’Œè·¯å¾„ç›¸å…³çš„ä¸œè¥¿ã€‚<br>ä¸¤ç§åˆå§‹åŒ–æ–¹å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">PathMeasure</span> <span class="hljs-variable">pathMeasure</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PathMeasure</span>();<br>pathMeasure.setPath(path,<span class="hljs-literal">false</span>);<br></code></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">PathMeasure</span> <span class="hljs-variable">pathMeasure</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PathMeasure</span>(path,<span class="hljs-literal">false</span>);<br></code></pre></td></tr></table></figure><h5 id="getLength"><a href="#getLength" class="headerlink" title="getLength()"></a>getLength()</h5><p>ç”¨æ¥è·å–è·¯å¾„é•¿åº¦ï¼Œå¹¶ä¸”è·å–åˆ°çš„æ˜¯å½“å‰æ›²çº¿çš„é•¿åº¦ï¼Œè€Œä¸æ˜¯æ•´ä¸ªPathçš„é•¿åº¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDraw</span><span class="hljs-params">(Canvas canvas)</span> &#123;<br>    <span class="hljs-built_in">super</span>.onDraw(canvas);<br>    canvas.translate(<span class="hljs-number">150</span>, <span class="hljs-number">150</span>);<br>    path.addRect(-<span class="hljs-number">50</span>,-<span class="hljs-number">50</span>,<span class="hljs-number">50</span>,<span class="hljs-number">50</span>,Path.Direction.CW);<br>    path.addRect(-<span class="hljs-number">100</span>,-<span class="hljs-number">100</span>,<span class="hljs-number">100</span>,<span class="hljs-number">100</span>,Path.Direction.CW);<br>    path.addRect(-<span class="hljs-number">120</span>,-<span class="hljs-number">120</span>,<span class="hljs-number">120</span>,<span class="hljs-number">120</span>,Path.Direction.CW);<br><br>    canvas.drawPath(path, paint);<br>    pathMeasure.setPath(path,<span class="hljs-literal">false</span>);<br>    <span class="hljs-keyword">do</span>&#123;<br>    Log.e(<span class="hljs-string">&quot;huangyuan&quot;</span>,pathMeasure.getLength()+<span class="hljs-string">&quot;&quot;</span>);<br>    &#125;<span class="hljs-keyword">while</span> (pathMeasure.nextContour());<br><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>2019-01-04 21:58:28.408 5231-5231&#x2F;huangyuanlove.com.customwidget E&#x2F;huangyuan: 400.0<br>2019-01-04 21:58:28.408 5231-5231&#x2F;huangyuanlove.com.customwidget E&#x2F;huangyuan: 800.0<br>2019-01-04 21:58:28.408 5231-5231&#x2F;huangyuanlove.com.customwidget E&#x2F;huangyuan: 960.0</p></blockquote><p>pathMeasure.nextContour()å¾—åˆ°çš„æ›²çº¿çš„é¡ºåºä¸æ·»åŠ åˆ°Pathä¸­çš„é¡ºåºç›¸åŒ</p><h5 id="getSegment"><a href="#getSegment" class="headerlink" title="getSegment()"></a>getSegment()</h5><p>å‡½æ•°å®šä¹‰</p><blockquote><p>public boolean getSegment(float startD, float stopD, Path dst, boolean startWithMoveTo)</p></blockquote><p>æ‡’å¾—ç¿»è¯‘ï¼Œè‡ªå·±çœ‹å§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Given a start and stop distance, return in dst the intervening</span><br><span class="hljs-comment">    * segment(s). If the segment is zero-length, return false, else return</span><br><span class="hljs-comment">    * true. startD and stopD are pinned to legal values (0..getLength()).</span><br><span class="hljs-comment">    * If startD &gt;= stopD then return false (and leave dst untouched).</span><br><span class="hljs-comment">    * Begin the segment with a moveTo if startWithMoveTo is true.</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDraw</span><span class="hljs-params">(Canvas canvas)</span> &#123;<br>    <span class="hljs-built_in">super</span>.onDraw(canvas);<br>    canvas.translate(<span class="hljs-number">150</span>, <span class="hljs-number">150</span>);<br>    path.addRect(-<span class="hljs-number">50</span>,-<span class="hljs-number">50</span>,<span class="hljs-number">50</span>,<span class="hljs-number">50</span>,Path.Direction.CW);<br>    <span class="hljs-type">Path</span> <span class="hljs-variable">dst</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>();<br>    pathMeasure.setPath(path,<span class="hljs-literal">false</span>);<br>    pathMeasure.getSegment(<span class="hljs-number">0</span>,<span class="hljs-number">150</span>,dst,<span class="hljs-literal">true</span>);<br>    canvas.drawPath(dst,paint);<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å¾—åˆ°ï¼š<br><img src="/image/Android/PathMeasure/dst.png" alt="getSegment" title="getSegment"><br>å¦‚æœdstè·¯å¾„ä¸ä¸ºç©º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Path</span> <span class="hljs-variable">dst</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>();<br>dst.lineTo(<span class="hljs-number">10</span>,<span class="hljs-number">100</span>);<br></code></pre></td></tr></table></figure><p>å¾—åˆ°<br><img src="/image/Android/PathMeasure/dst_not_null.png" alt="dstè·¯å¾„ä¸ç©º" title="dstè·¯å¾„ä¸ç©º"><br>å¦‚æœdstè·¯å¾„ä¸ç©ºï¼Œ<code>startWithMoveTo</code>ä¸ºfalseï¼Œå¾—åˆ°<br><img src="/image/Android/PathMeasure/starWithMoveToFalse.png" alt="starWithMoveToFalseï¼Œ" title="starWithMoveToFalse"></p><h5 id="è·¯å¾„åŠ è½½åŠ¨ç”»"><a href="#è·¯å¾„åŠ è½½åŠ¨ç”»" class="headerlink" title="è·¯å¾„åŠ è½½åŠ¨ç”»"></a>è·¯å¾„åŠ è½½åŠ¨ç”»</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">TestPathMeasure</span><span class="hljs-params">(Context context, <span class="hljs-meta">@Nullable</span> AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr)</span> &#123;<br>       <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);<br>       init();<br>   &#125;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-comment">//ç¦ç”¨ç¡¬ä»¶åŠ é€Ÿ</span><br>       setLayerType(LAYER_TYPE_SOFTWARE,<span class="hljs-literal">null</span>);<br>       paint = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paint</span>(Paint.ANTI_ALIAS_FLAG);<br>       paint.setColor(Color.BLACK);<br>       paint.setStrokeWidth(<span class="hljs-number">4</span>);<br>       paint.setStyle(Paint.Style.STROKE);<br>       dstPath = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>();<br>       circlePath = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>();<br>       circlePath.addCircle(<span class="hljs-number">100</span>,<span class="hljs-number">100</span>,<span class="hljs-number">50</span>,Path.Direction.CW);<br>       pathMeasure = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PathMeasure</span>(circlePath,<span class="hljs-literal">true</span>);<br><br><br>       <span class="hljs-type">ValueAnimator</span> <span class="hljs-variable">valueAnimator</span> <span class="hljs-operator">=</span> ValueAnimator.ofFloat(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>);<br>       valueAnimator.setRepeatCount(ValueAnimator.INFINITE);<br><br><br>       valueAnimator.addUpdateListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ValueAnimator</span>.AnimatorUpdateListener() &#123;<br>           <span class="hljs-meta">@Override</span><br>           <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAnimationUpdate</span><span class="hljs-params">(ValueAnimator animation)</span> &#123;<br>               currentAnimValue = (<span class="hljs-type">float</span>) animation.getAnimatedValue();<br>               invalidate();<br>           &#125;<br>       &#125;);<br>       valueAnimator.setDuration(<span class="hljs-number">2000</span>);<br>       valueAnimator.start();<br><br>   &#125;<br><br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDraw</span><span class="hljs-params">(Canvas canvas)</span> &#123;<br>       <span class="hljs-built_in">super</span>.onDraw(canvas);<br><br><br>       <span class="hljs-type">float</span> <span class="hljs-variable">length</span> <span class="hljs-operator">=</span> pathMeasure.getLength();<br><br>       <span class="hljs-type">float</span> <span class="hljs-variable">stop</span> <span class="hljs-operator">=</span> pathMeasure.getLength() * currentAnimValue;<br><br>       <span class="hljs-type">float</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> (<span class="hljs-type">float</span>) (stop- ((<span class="hljs-number">0.5</span>- Math.abs(currentAnimValue-<span class="hljs-number">0.5</span>))*length));<br><br>       dstPath.reset();<br>       pathMeasure.getSegment(start,stop,dstPath,<span class="hljs-literal">true</span>);<br>       canvas.drawPath(dstPath,paint);<br>   &#125;<br><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥åœ¨è·¯å¾„åŠ¨ç”»ä¸ŠåŠ ä¸ªç®­å¤´ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestPathMeasure</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">View</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Paint paint;<br>    <span class="hljs-keyword">private</span> Path path;<br>    <span class="hljs-keyword">private</span> Path dstPath;<br>    <span class="hljs-keyword">private</span> Path circlePath;<br>    <span class="hljs-keyword">private</span> PathMeasure pathMeasure;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> currentAnimValue;<br><br>    <span class="hljs-keyword">private</span> Bitmap icChevronRight;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span>[] pos = <span class="hljs-keyword">new</span> <span class="hljs-title class_">float</span>[<span class="hljs-number">2</span>];<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span>[] tan = <span class="hljs-keyword">new</span> <span class="hljs-title class_">float</span>[<span class="hljs-number">2</span>];<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TestPathMeasure</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context);<br>        init(context);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TestPathMeasure</span><span class="hljs-params">(Context context, <span class="hljs-meta">@Nullable</span> AttributeSet attrs)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context, attrs);<br>        init(context);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TestPathMeasure</span><span class="hljs-params">(Context context, <span class="hljs-meta">@Nullable</span> AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);<br>        init(context);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-comment">//ç¦ç”¨ç¡¬ä»¶åŠ é€Ÿ</span><br>        setLayerType(LAYER_TYPE_SOFTWARE, <span class="hljs-literal">null</span>);<br>        paint = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paint</span>(Paint.ANTI_ALIAS_FLAG);<br>        paint.setColor(Color.BLACK);<br>        paint.setStrokeWidth(<span class="hljs-number">4</span>);<br>        paint.setStyle(Paint.Style.STROKE);<br>        dstPath = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>();<br>        circlePath = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>();<br>        circlePath.addCircle(<span class="hljs-number">300</span>, <span class="hljs-number">300</span>, <span class="hljs-number">150</span>, Path.Direction.CW);<br>        pathMeasure = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PathMeasure</span>(circlePath, <span class="hljs-literal">true</span>);<br>        BitmapFactory.<span class="hljs-type">Options</span> <span class="hljs-variable">options</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BitmapFactory</span>.Options();<br><br>        icChevronRight = BitmapFactory.decodeResource(context.getResources(), R.drawable.right);<br><br><br>        <span class="hljs-type">ValueAnimator</span> <span class="hljs-variable">valueAnimator</span> <span class="hljs-operator">=</span> ValueAnimator.ofFloat(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>);<br>        valueAnimator.setRepeatCount(ValueAnimator.INFINITE);<br><br><br>        valueAnimator.addUpdateListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ValueAnimator</span>.AnimatorUpdateListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAnimationUpdate</span><span class="hljs-params">(ValueAnimator animation)</span> &#123;<br>                currentAnimValue = (<span class="hljs-type">float</span>) animation.getAnimatedValue();<br>                invalidate();<br>            &#125;<br>        &#125;);<br>        valueAnimator.setDuration(<span class="hljs-number">2000</span>);<br>        valueAnimator.start();<br><br>    &#125;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDraw</span><span class="hljs-params">(Canvas canvas)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onDraw(canvas);<br><br><br>        <span class="hljs-type">float</span> <span class="hljs-variable">length</span> <span class="hljs-operator">=</span> pathMeasure.getLength();<br><br>        <span class="hljs-type">float</span> <span class="hljs-variable">stop</span> <span class="hljs-operator">=</span> pathMeasure.getLength() * currentAnimValue;<br><br>        <span class="hljs-type">float</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> (<span class="hljs-type">float</span>) (stop - ((<span class="hljs-number">0.5</span> - Math.abs(currentAnimValue - <span class="hljs-number">0.5</span>)) * length));<br><br>        dstPath.reset();<br>        pathMeasure.getSegment(start, stop, dstPath, <span class="hljs-literal">true</span>);<br>        canvas.drawPath(dstPath, paint);<br><br><br>        pathMeasure.getPosTan(stop, pos, tan);<br>        <span class="hljs-type">float</span> <span class="hljs-variable">degrees</span> <span class="hljs-operator">=</span> (<span class="hljs-type">float</span>) (Math.atan2(tan[<span class="hljs-number">1</span>], tan[<span class="hljs-number">0</span>]) * <span class="hljs-number">180</span> / Math.PI);<br><br>        <span class="hljs-type">Matrix</span> <span class="hljs-variable">matrix</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Matrix</span>();<br><span class="hljs-comment">//        matrix.postRotate(degrees,icChevronRight.getWidth()/2,icChevronRight.getHeight()/2);</span><br><span class="hljs-comment">//        matrix.postTranslate(pos[0] -icChevronRight.getWidth()/2,pos[1]-icChevronRight.getHeight()/2);</span><br><br>        pathMeasure.getMatrix(stop, matrix, PathMeasure.POSITION_MATRIX_FLAG | PathMeasure.TANGENT_MATRIX_FLAG);<br>        matrix.preTranslate(-icChevronRight.getWidth() / <span class="hljs-number">2</span>, -icChevronRight.getHeight() / <span class="hljs-number">2</span>);<br>        canvas.drawBitmap(icChevronRight, matrix, paint);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¸»è¦ç”¨åˆ°äº†Matrixå’ŒgetPosTan(),ç”¨æ¥å¾—åˆ°è·¯å¾„ä¸ŠæŸä¸€é•¿åº¦çš„ä½ç½®ä»¥åŠè¯¥ä½ç½®çš„æ­£åˆ‡å€¼ã€‚å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Pins distance to 0 &lt;= distance &lt;= getLength(), and then computes the</span><br><span class="hljs-comment"> * corresponding position and tangent. Returns false if there is no path,</span><br><span class="hljs-comment"> * or a zero-length path was specified, in which case position and tangent</span><br><span class="hljs-comment"> * are unchanged.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> distance The distance along the current contour to sample</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> pos If not null, returns the sampled position (x==[0], y==[1])</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> tan If not null, returns the sampled tangent (x==[0], y==[1])</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> false if there was no path associated with this measure object</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">getPosTan</span><span class="hljs-params">(<span class="hljs-type">float</span> distance, <span class="hljs-type">float</span> pos[], <span class="hljs-type">float</span> tan[])</span> <br></code></pre></td></tr></table></figure><p>å‚æ•°è§£é‡Šï¼š</p><ul><li>float distance: è·ç¦»Pathèµ·ç‚¹çš„é•¿åº¦ï¼Œå–å€¼èŒƒå›´0&lt;&#x3D;distance&lt;&#x3D;getLength</li><li>float[] pos:è¯¥ç‚¹çš„åæ ‡å€¼ï¼Œpos[0]è¡¨ç¤ºxåæ ‡ï¼Œpos[y]è¡¨ç¤ºyåæ ‡</li><li>float[] tan:è¯¥ç‚¹çš„æ­£åˆ‡å€¼ã€‚</li></ul><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­éœ€è¦æ³¨æ„çš„æ˜¯</p><ul><li>posã€tanæ•°ç»„åœ¨ä½¿ç”¨æ—¶å¿…é¡»å…ˆä½¿ç”¨newå…³é”®è¯åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œè€ŒPathMeasure.getPosTanå‡½æ•°åªä¼šå‘æ•°ç»„ä¸­çš„å…ƒç´ èµ‹å€¼ã€‚</li><li>é€šè¿‡Math.atan2(tan[1],tan[0])å¾—åˆ°çš„æ˜¯å¼§åº¦å€¼ï¼Œè€Œä¸æ˜¯è§’åº¦</li><li>å…ˆåˆ©ç”¨matrix.postRotateå°†å›¾ç‰‡æ—‹è½¬æŒ‡å®šè§’åº¦ï¼Œç„¶åç”¨matix.postTranslateå°†å›¾ç‰‡ç§»åŠ¨åˆ°å½“å‰è·¯å¾„æœ€å‰ç«¯(æ³¨é‡Šæ‰çš„é‚£ä¸¤å¥)</li></ul><p>pathMeasureæœ‰ä¸ªgetMatrixå‡½æ•°ï¼Œæ˜¯å¯¹æˆ‘ä»¬è‡ªå·±å®ç°çš„é‚£ç§æ–¹å¼çš„å°è£…ï¼Œæˆ‘ä»¬åªéœ€è¦å°†å›¾ç‰‡ç§»åŠ¨ä¸€ä¸‹å°±å¥½äº†</p><h4 id="å±±å¯¨æ”¯ä»˜å®æ”¯ä»˜æˆåŠŸåŠ¨ç”»"><a href="#å±±å¯¨æ”¯ä»˜å®æ”¯ä»˜æˆåŠŸåŠ¨ç”»" class="headerlink" title="å±±å¯¨æ”¯ä»˜å®æ”¯ä»˜æˆåŠŸåŠ¨ç”»"></a>å±±å¯¨æ”¯ä»˜å®æ”¯ä»˜æˆåŠŸåŠ¨ç”»</h4><p>å°±æ˜¯å…ˆç”»ä¸€ä¸ªåœ†ï¼Œç„¶ååœ†å½¢é‡Œé¢ç”»ä¸ªå¯¹å‹¾ã€‚ã€‚ã€‚ã€‚ã€‚å¾ˆç®€é™‹çš„ä¸€ç§å®ç°æ–¹å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AliPaySuccess</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">View</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Paint paint;<br>    <span class="hljs-keyword">private</span> Path dstPath;<br>    <span class="hljs-keyword">private</span> Path circlePath;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">centerX</span> <span class="hljs-operator">=</span> <span class="hljs-number">500</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">centerY</span> <span class="hljs-operator">=</span> <span class="hljs-number">500</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">radius</span> <span class="hljs-operator">=</span> <span class="hljs-number">250</span>;<br>    <span class="hljs-keyword">private</span> PathMeasure pathMeasure;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> currentAnimValue;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> switchLine;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AliPaySuccess</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context);<br>        init();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AliPaySuccess</span><span class="hljs-params">(Context context, <span class="hljs-meta">@Nullable</span> AttributeSet attrs)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context, attrs);<br>        init();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AliPaySuccess</span><span class="hljs-params">(Context context, <span class="hljs-meta">@Nullable</span> AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);<br>        init();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span>&#123;<br>        setLayerType(LAYER_TYPE_SOFTWARE, <span class="hljs-literal">null</span>);<br>        paint = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paint</span>(Paint.ANTI_ALIAS_FLAG);<br>        paint.setColor(Color.BLACK);<br>        paint.setStrokeWidth(<span class="hljs-number">4</span>);<br>        paint.setStyle(Paint.Style.STROKE);<br>        dstPath = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>();<br>        circlePath = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>();<br>        circlePath.addCircle(centerX,centerY,radius,Path.Direction.CW);<br>        circlePath.moveTo(centerX-radius/<span class="hljs-number">2</span>,centerY);<br>        circlePath.lineTo(centerX,centerY+radius/<span class="hljs-number">2</span>);<br>        circlePath.lineTo(centerX+radius/<span class="hljs-number">2</span>,centerY-radius/<span class="hljs-number">3</span>);<br>        pathMeasure = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PathMeasure</span>(circlePath,<span class="hljs-literal">false</span>);<br>        <span class="hljs-type">ValueAnimator</span> <span class="hljs-variable">animator</span> <span class="hljs-operator">=</span> ValueAnimator.ofFloat(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>);<br>        animator.addUpdateListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ValueAnimator</span>.AnimatorUpdateListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAnimationUpdate</span><span class="hljs-params">(ValueAnimator animation)</span> &#123;<br>                currentAnimValue = (<span class="hljs-type">float</span>) animation.getAnimatedValue();<br>                invalidate();<br>            &#125;<br>        &#125;);<br>        animator.setDuration(<span class="hljs-number">2000</span>);<br>        animator.setInterpolator(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AccelerateInterpolator</span>());<br>        animator.start();<br>    &#125;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDraw</span><span class="hljs-params">(Canvas canvas)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onDraw(canvas);<br>        <span class="hljs-keyword">if</span>(currentAnimValue&lt;<span class="hljs-number">1</span>)&#123;<br>            <span class="hljs-type">float</span> <span class="hljs-variable">stop</span> <span class="hljs-operator">=</span> pathMeasure.getLength()*currentAnimValue;<br>            pathMeasure.getSegment(<span class="hljs-number">0</span>,stop,dstPath,<span class="hljs-literal">true</span>);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (currentAnimValue &gt;<span class="hljs-number">1</span> &amp;&amp; !switchLine)&#123;<br>            pathMeasure.getSegment(<span class="hljs-number">0</span>,pathMeasure.getLength(),dstPath,<span class="hljs-literal">true</span>);<br>            switchLine = <span class="hljs-literal">true</span>;<br>            pathMeasure.nextContour();<br>        &#125;<span class="hljs-keyword">else</span>   &#123;<br>            <span class="hljs-type">float</span> <span class="hljs-variable">stop</span> <span class="hljs-operator">=</span> pathMeasure.getLength()*(currentAnimValue-<span class="hljs-number">1</span>);<br>            pathMeasure.getSegment(<span class="hljs-number">0</span>,stop,dstPath,<span class="hljs-literal">true</span>);<br>        &#125;<br>        canvas.drawPath(dstPath,paint);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><ol><li><p>é¦–å…ˆåˆå§‹åŒ–å„ç§å‚æ•°ï¼šç”»ç¬”ã€è·¯å¾„å’ŒåŠ¨ç”»</p><p> åˆå§‹åŒ–è·¯å¾„æ—¶ï¼Œå…ˆæ·»åŠ äº†å¤–é¢çš„åœ†å½¢ï¼Œç„¶åæ˜¯é‡Œé¢çš„å¯¹å‹¾ã€‚è®¾ç½®åŠ¨ç”»ä»0ï½2ï¼Œ0-1æ—¶ç”»åœ†ï¼Œ1-2æ—¶ç”»å¯¹å‹¾ã€‚</p></li><li><p>é‡å†™onDrawï¼Œåˆ¤æ–­å½“å‰çš„åŠ¨ç”»å€¼ï¼Œåœ¨0-1æ—¶ç”»åœ†ï¼Œå½“åŠ¨ç”»å€¼ç¬¬ä¸€æ¬¡å¤§äº1æ—¶ï¼Œåˆ‡æ¢åˆ°å¯¹å·é‚£æ¡çº¿ä¸Šã€‚</p><p>è¿™é‡Œçš„<code>currentAnimValue</code>ä¸ä¸€å®šä¼šæœ‰ç­‰äº1çš„æ—¶å€™ï¼Œè‡³å°‘æˆ‘æ‰§è¡Œäº†åå‡ éä¹Ÿæ²¡å‡ºç°ä¸€æ¬¡ã€‚æ‰€ä»¥å–çš„æ˜¯ç¬¬ä¸€æ¬¡å¤§äºæ—¶åˆ‡æ¢ã€‚</p></li><li><p>è¿™é‡Œé¢çš„æ•°å€¼å’Œé¢œè‰²ä¹‹ç±»çš„å±æ€§éƒ½æ˜¯ç›´æ¥å†™æ­»çš„ï¼Œåº”è¯¥é€šè¿‡xmlæ–‡ä»¶è¯»å–ã€‚</p></li></ol><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2018æ€»ç»“</title>
    <link href="/2019/01/03/%E5%86%99%E5%9C%A82019%E5%B9%B4%E5%88%9D-2018%E6%80%BB%E7%BB%93/"/>
    <url>/2019/01/03/%E5%86%99%E5%9C%A82019%E5%B9%B4%E5%88%9D-2018%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<p>ä¸€å¥è¯æ€»ç»“ä¸€ä¸‹ï¼š2019å¹´äº‰å–æŠŠ2018å¹´æ²¡å®Œæˆçš„2017å¹´çš„è®¡åˆ’ä¸è¦æ¨åˆ°2020å¹´ã€‚</p><span id="more"></span><h4 id="å›å¤´æƒ³æƒ³2018å¹´éƒ½å­¦ä¼šäº†å•¥ï¼š"><a href="#å›å¤´æƒ³æƒ³2018å¹´éƒ½å­¦ä¼šäº†å•¥ï¼š" class="headerlink" title="å›å¤´æƒ³æƒ³2018å¹´éƒ½å­¦ä¼šäº†å•¥ï¼š"></a>å›å¤´æƒ³æƒ³2018å¹´éƒ½å­¦ä¼šäº†å•¥ï¼š</h4><ol><li>$LaTeX$åˆçº§</li><li>ã€ŠAndroidå¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹åˆ·äº†ä¸€éï¼Œè·Ÿç€ç¿»äº†ä¸€éæºç ï¼Œæ„Ÿè§‰æœ‰ç‚¹è¿›æ­¥ï¼Œæœ€èµ·ç ä¼šè‡ªå·±æ’¸æºç äº†ã€‚</li><li>ã€ŠAndroid Gradleæƒå¨æŒ‡å—ã€‹åˆ·äº†ä¸€éï¼Œç†Ÿæ‚‰äº†ä¸€ä¸‹Gradleç›¸å…³çš„ä¸œè¥¿</li><li>Android hookã€ConstraintLayoutã€Alarmä¼˜åŒ–ã€Android Oé€‚é…NotificationChannel</li><li>ã€ŠKotlinç¨‹åºå¼€å‘å…¥é—¨ç²¾è¦ã€‹åˆ·äº†ä¸€é</li><li>ã€Šå‰‘æŒ‡offerã€‹é¢˜ç›®åœ¨ç‰›å®¢ç½‘ä¸Šåˆ·äº†ä¸€éï¼Œæ„Ÿè§‰æ²¡å•¥ç”¨ï¼Œåªæ˜¯è§çš„é¢˜ç›®å¤šäº†</li><li>ã€Šå¥½å¥½è¯´è¯(é©¬ä¸œ)ã€‹ã€ã€Šå¥½å¥½å­¦ä¹ (æˆç”²)ã€‹ã€ã€Šæç®€ä¸»ä¹‰ã€‹ã€ã€Šç•ªèŒ„å·¥ä½œæ³•ã€‹ã€ã€Šå•æ ¸å·¥ä½œæ³•å›¾è§£ã€‹</li></ol><h4 id="è¿˜æ¬ ç€å•¥"><a href="#è¿˜æ¬ ç€å•¥" class="headerlink" title="è¿˜æ¬ ç€å•¥"></a>è¿˜æ¬ ç€å•¥</h4><p>è¿˜æ¬ ç€7æœ¬æŠ€æœ¯ç›¸å…³çš„ä¹¦æ²¡çœ‹ï¼š</p><ol><li>ã€ŠVue.js å®æˆ˜ã€‹</li><li>ã€ŠReactè¿›é˜¶ä¹‹è·¯ã€‹</li><li>ã€ŠES6æ ‡å‡†å…¥é—¨ã€‹</li><li>ã€ŠRxJava 2.x å®æˆ˜ã€‹</li><li>ã€ŠAndroidéŸ³è§†é¢‘å¼€å‘ã€‹</li><li>ã€ŠAndroidæºç è®¾è®¡æ¨¡å¼ã€‹</li><li>ã€ŠAndroidè‡ªå®šä¹‰æ§ä»¶å¼€å‘å…¥é—¨ä¸å®æˆ˜ã€‹</li></ol><h4 id="è¿˜æƒ³å­¦å•¥"><a href="#è¿˜æƒ³å­¦å•¥" class="headerlink" title="è¿˜æƒ³å­¦å•¥"></a>è¿˜æƒ³å­¦å•¥</h4><p>å½“ç„¶æ˜¯flutterå’ŒMLå’ŒDLäº†ã€‚</p><p>MLå’ŒDLç­‰ç€å¦¹å­æŒ‡å¯¼ï¼Œflutterä¹Ÿç­‰ç€å¤ä¹ ä¸€ä¸‹å‰ç«¯çš„çŸ¥è¯†å†ä¸Šæ‰‹ã€‚</p><p>19å¹´å…ˆæŠŠ7ã€6ã€4æ’¸å®Œï¼Œç©¿æ’ç€çœ‹å®Œ3ã€1ï¼Œä¼°è®¡å°±åˆ°å›½åº†äº†ã€‚</p><p>å†ç„¶åå°±æ˜¯ç©flutteräº†ï¼Œä¸¤ä¸ªæœˆçš„æ—¶é—´ï¼Œåœ¨æœ‰å‰ç«¯åŸºç¡€çš„å‰æä¸‹ï¼Œå·®ä¸å¤šèƒ½å…¥é—¨å§ã€‚è¿™ä¸ªæ—¶å€™è¯¥è¸©çš„å‘åˆ«äººéƒ½å·²ç»è¸©å®Œäº†ã€‚</p><p>éƒ½è¯´å¤§å‰ç«¯æ—¶ä»£è¦åˆ°æ¥ï¼Œä¹Ÿä¸çŸ¥é“19å¹´çš„è¡Œæƒ…æ€ä¹ˆæ ·ã€‚</p><p>å…¶ä»–çš„ä¹Ÿæ²¡å•¥æ‰“ç®—ï¼Œèƒ½åšå®Œä¸Šé¢è¿™äº›å°±ä¸é”™äº†ï¼Œä¸€å¹´çš„è®¡åˆ’å¤ªé•¿äº†ï¼Œèµ¶ä¸ä¸Šå˜åŒ–ï¼Œè°çŸ¥é“ä¸­é—´ä¼šä¸ä¼šåˆå‡ºä»€ä¹ˆå¹ºè›¾å­ã€‚ã€‚ã€‚ã€‚</p><hr>]]></content>
    
    
    
    <tags>
      
      <tag>ä¹±ä¸ƒå…«ç³Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android O---é€‚é…NotificationChannel</title>
    <link href="/2018/12/27/Android-O-%E9%80%82%E9%85%8DNotificationChannel/"/>
    <url>/2018/12/27/Android-O-%E9%80%82%E9%85%8DNotificationChannel/</url>
    
    <content type="html"><![CDATA[<p>ç»§ä¹‹å‰è·ªåœ¨Android Nçš„<code>StrictMode</code>ä¸Šäº†ã€‚ç°åœ¨åˆè·ªåœ¨çš„Android O çš„NotificationChannelä¸Šäº†</p><p>åœºæ™¯å¦‚ä¸‹ï¼š</p><p>æŸäº›åœºæ™¯ä¸­éœ€è¦ä¸Šä¼ å›¾ç‰‡ï¼Œé€‰æ‹©å›¾ç‰‡æˆ–è€…æ‹ç…§æ—¶ä½¿ç”¨ç³»ç»Ÿçš„å›¾åº“ä¼šå°†è‡ªå·±çš„appç½®äºåå°ï¼Œè‹¥é€‰æ‹©å›¾ç‰‡çš„æ—¶é—´è¿‡é•¿ï¼Œåˆ™å¯èƒ½ä¼šå¯¼è‡´è‡ªå·±çš„appä¼šæ€æ­»ã€‚çœ‹äº†ä¸€ä¸‹ä¼ æ‰¿ä¸‹æ¥çš„ä»£ç ï¼Œæ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹å‘é€ä¸€ä¸ªå‰å°é€šçŸ¥<code>startForeground</code>,ä½¿æ­¤æœåŠ¡åœ¨å‰å°è¿è¡Œã€‚ä½†æ˜¯ä¼šåœ¨é€šçŸ¥æ ä¸Šæ˜¾ç¤ºä¸€ä¸ªåº”ç”¨æ­£åœ¨è¿è¡Œçš„é€šçŸ¥</p><p><img src="/image/Android/NotificationChanel/startForeground.png" alt="é€šçŸ¥" title="startForegroundé€šçŸ¥"></p><span id="more"></span><h4 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h4><p>æŸ¥çœ‹Android 28çš„æºç ï¼Œå‘ç°è°ƒç”¨é“¾å¦‚ä¸‹ï¼š</p><p>é¦–å…ˆ <code>Service.java</code>ä¸­è°ƒç”¨ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startForeground</span><span class="hljs-params">(<span class="hljs-type">int</span> id, Notification notification)</span> &#123;<br>       <span class="hljs-keyword">try</span> &#123;<br>           mActivityManager.setServiceForeground(<br>                   <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComponentName</span>(<span class="hljs-built_in">this</span>, mClassName), mToken, id,<br>                   notification, <span class="hljs-number">0</span>);<br>       &#125; <span class="hljs-keyword">catch</span> (RemoteException ex) &#123;<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>mActivityManager</code>çš„å£°æ˜æ˜¯<code>private IActivityManager mActivityManager = null;</code>åœ¨è¿™é‡Œï¼Œ<code>IActivityManager</code>çš„å®ç°ç±»æ˜¯<code>ActivityManagerService</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setServiceForeground</span><span class="hljs-params">(ComponentName className, IBinder token,</span><br><span class="hljs-params">            <span class="hljs-type">int</span> id, Notification notification, <span class="hljs-type">int</span> flags)</span> &#123;<br>        <span class="hljs-keyword">synchronized</span>(<span class="hljs-built_in">this</span>) &#123;<br>            mServices.setServiceForegroundLocked(className, token, id, notification, flags);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setServiceForegroundLocked</span><span class="hljs-params">(ComponentName className, IBinder token,</span><br><span class="hljs-params">           <span class="hljs-type">int</span> id, Notification notification, <span class="hljs-type">int</span> flags)</span> &#123;<br>       <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHandle.getCallingUserId();<br>       <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">origId</span> <span class="hljs-operator">=</span> Binder.clearCallingIdentity();<br>       <span class="hljs-keyword">try</span> &#123;<br>           <span class="hljs-type">ServiceRecord</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> findServiceLocked(className, token, userId);<br>           <span class="hljs-keyword">if</span> (r != <span class="hljs-literal">null</span>) &#123;<br>               setServiceForegroundInnerLocked(r, id, notification, flags);<br>           &#125;<br>       &#125; <span class="hljs-keyword">finally</span> &#123;<br>           Binder.restoreCallingIdentity(origId);<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure><p>finallyä¸­è°ƒç”¨çš„Binderæ–¹æ³•æ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼Œä¸»è¦çœ‹ä¸€ä¸‹<code>setServiceForegroundInnerLocked</code>:</p><p>æ–¹æ³•å¤ªé•¿ï¼Œå…³æ³¨ä¸€ä¸‹æˆ‘ä»¬éœ€è¦çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Apps under strict background restrictions simply don&#x27;t get to have foreground</span><br><span class="hljs-comment">// services, so now that we&#x27;ve enforced the startForegroundService() contract</span><br><span class="hljs-comment">// we only do the machinery of making the service foreground when the app</span><br><span class="hljs-comment">// is not restricted.</span><br><span class="hljs-keyword">if</span> (!ignoreForeground) &#123;<br>    <span class="hljs-keyword">if</span> (r.foregroundId != id) &#123;<br>        cancelForegroundNotificationLocked(r);<br>        r.foregroundId = id;<br>    &#125;<br>    notification.flags |= Notification.FLAG_FOREGROUND_SERVICE;<br>    r.foregroundNoti = notification;<br>    <span class="hljs-keyword">if</span> (!r.isForeground) &#123;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">ServiceMap</span> <span class="hljs-variable">smap</span> <span class="hljs-operator">=</span> getServiceMapLocked(r.userId);<br>        <span class="hljs-keyword">if</span> (smap != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-type">ActiveForegroundApp</span> <span class="hljs-variable">active</span> <span class="hljs-operator">=</span> smap.mActiveForegroundApps.get(r.packageName);<br>            <span class="hljs-keyword">if</span> (active == <span class="hljs-literal">null</span>) &#123;<br>                active = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActiveForegroundApp</span>();<br>                active.mPackageName = r.packageName;<br>                active.mUid = r.appInfo.uid;<br>                active.mShownWhileScreenOn = mScreenOn;<br>                <span class="hljs-keyword">if</span> (r.app != <span class="hljs-literal">null</span>) &#123;<br>                    active.mAppOnTop = active.mShownWhileTop =<br>                            r.app.uidRecord.curProcState<br>                                    &lt;= ActivityManager.PROCESS_STATE_TOP;<br>                &#125;<br>                active.mStartTime = active.mStartVisibleTime<br>                        = SystemClock.elapsedRealtime();<br>                smap.mActiveForegroundApps.put(r.packageName, active);<br>                requestUpdateActiveForegroundAppsLocked(smap, <span class="hljs-number">0</span>);<br>            &#125;<br>            active.mNumActive++;<br>        &#125;<br>        r.isForeground = <span class="hljs-literal">true</span>;<br>        mAm.mAppOpsService.startOperation(<br>                AppOpsManager.getToken(mAm.mAppOpsService),<br>                AppOpsManager.OP_START_FOREGROUND, r.appInfo.uid, r.packageName,<br>                <span class="hljs-literal">true</span>);<br>        StatsLog.write(StatsLog.FOREGROUND_SERVICE_STATE_CHANGED,<br>                r.appInfo.uid, r.shortName,<br>                StatsLog.FOREGROUND_SERVICE_STATE_CHANGED__STATE__ENTER);<br>    &#125;<br>    r.postNotification();<br>    <span class="hljs-keyword">if</span> (r.app != <span class="hljs-literal">null</span>) &#123;<br>        updateServiceForegroundLocked(r.app, <span class="hljs-literal">true</span>);<br>    &#125;<br>    getServiceMapLocked(r.userId).ensureNotStartingBackgroundLocked(r);<br>    mAm.notifyPackageUse(r.serviceInfo.packageName,<br>            PackageManager.NOTIFY_PACKAGE_USE_FOREGROUND_SERVICE);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œé¢çš„<code> r.postNotification();</code>è¿™é‡Œçš„<code>r</code>æ˜¯<code>ServiceRecord</code>çš„ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­è°ƒç”¨äº†<code>ams.mHandler.post(new Runnable())</code>æ–¹æ³•ï¼Œamsæ˜¯<code>ActivityManagerService</code>çš„ä¸€ä¸ªå®ä¾‹ï¼Œåœ¨è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><code class="hljs java">ams.mHandler.post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                    <span class="hljs-type">NotificationManagerInternal</span> <span class="hljs-variable">nm</span> <span class="hljs-operator">=</span> LocalServices.getService(<br>                            NotificationManagerInternal.class);<br>                    <span class="hljs-keyword">if</span> (nm == <span class="hljs-literal">null</span>) &#123;<br>                        <span class="hljs-keyword">return</span>;<br>                    &#125;<br>                    <span class="hljs-type">Notification</span> <span class="hljs-variable">localForegroundNoti</span> <span class="hljs-operator">=</span> _foregroundNoti;<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        <span class="hljs-keyword">if</span> (localForegroundNoti.getSmallIcon() == <span class="hljs-literal">null</span>) &#123;<br>                            <span class="hljs-comment">// It is not correct for the caller to not supply a notification</span><br>                            <span class="hljs-comment">// icon, but this used to be able to slip through, so for</span><br>                            <span class="hljs-comment">// those dirty apps we will create a notification clearly</span><br>                            <span class="hljs-comment">// blaming the app.</span><br>                            Slog.v(TAG, <span class="hljs-string">&quot;Attempted to start a foreground service (&quot;</span><br>                                    + name<br>                                    + <span class="hljs-string">&quot;) with a broken notification (no icon: &quot;</span><br>                                    + localForegroundNoti<br>                                    + <span class="hljs-string">&quot;)&quot;</span>);<br><br>                            <span class="hljs-type">CharSequence</span> <span class="hljs-variable">appName</span> <span class="hljs-operator">=</span> appInfo.loadLabel(<br>                                    ams.mContext.getPackageManager());<br>                            <span class="hljs-keyword">if</span> (appName == <span class="hljs-literal">null</span>) &#123;<br>                                appName = appInfo.packageName;<br>                            &#125;<br>                            <span class="hljs-type">Context</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>                            <span class="hljs-keyword">try</span> &#123;<br>                                ctx = ams.mContext.createPackageContextAsUser(<br>                                        appInfo.packageName, <span class="hljs-number">0</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserHandle</span>(userId));<br><br>                                Notification.<span class="hljs-type">Builder</span> <span class="hljs-variable">notiBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Notification</span>.Builder(ctx,<br>                                        localForegroundNoti.getChannelId());<br><br>                                <span class="hljs-comment">// it&#x27;s ugly, but it clearly identifies the app</span><br>                                notiBuilder.setSmallIcon(appInfo.icon);<br><br>                                <span class="hljs-comment">// mark as foreground</span><br>                                notiBuilder.setFlag(Notification.FLAG_FOREGROUND_SERVICE, <span class="hljs-literal">true</span>);<br><br>                                <span class="hljs-type">Intent</span> <span class="hljs-variable">runningIntent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(<br>                                        Settings.ACTION_APPLICATION_DETAILS_SETTINGS);<br>                                runningIntent.setData(Uri.fromParts(<span class="hljs-string">&quot;package&quot;</span>,<br>                                        appInfo.packageName, <span class="hljs-literal">null</span>));<br>                                <span class="hljs-type">PendingIntent</span> <span class="hljs-variable">pi</span> <span class="hljs-operator">=</span> PendingIntent.getActivityAsUser(ams.mContext, <span class="hljs-number">0</span>,<br>                                        runningIntent, PendingIntent.FLAG_UPDATE_CURRENT, <span class="hljs-literal">null</span>,<br>                                        UserHandle.of(userId));<br>                                notiBuilder.setColor(ams.mContext.getColor(<br>                                        com.android.internal<br>                                                .R.color.system_notification_accent_color));<br>                                notiBuilder.setContentTitle(<br>                                        ams.mContext.getString(<br>                                                com.android.internal.R.string<br>                                                        .app_running_notification_title,<br>                                                appName));<br>                                notiBuilder.setContentText(<br>                                        ams.mContext.getString(<br>                                                com.android.internal.R.string<br>                                                        .app_running_notification_text,<br>                                                appName));<br>                                notiBuilder.setContentIntent(pi);<br><br>                                localForegroundNoti = notiBuilder.build();<br>                            &#125; <span class="hljs-keyword">catch</span> (PackageManager.NameNotFoundException e) &#123;<br>                            &#125;<br>                        &#125;<br>                        <span class="hljs-keyword">if</span> (nm.getNotificationChannel(localPackageName, appUid,<br>                                localForegroundNoti.getChannelId()) == <span class="hljs-literal">null</span>) &#123;<br>                            <span class="hljs-type">int</span> <span class="hljs-variable">targetSdkVersion</span> <span class="hljs-operator">=</span> Build.VERSION_CODES.O_MR1;<br>                            <span class="hljs-keyword">try</span> &#123;<br>                                <span class="hljs-keyword">final</span> <span class="hljs-type">ApplicationInfo</span> <span class="hljs-variable">applicationInfo</span> <span class="hljs-operator">=</span><br>                                        ams.mContext.getPackageManager().getApplicationInfoAsUser(<br>                                                appInfo.packageName, <span class="hljs-number">0</span>, userId);<br>                                targetSdkVersion = applicationInfo.targetSdkVersion;<br>                            &#125; <span class="hljs-keyword">catch</span> (PackageManager.NameNotFoundException e) &#123;<br>                            &#125;<br>                            <span class="hljs-keyword">if</span> (targetSdkVersion &gt;= Build.VERSION_CODES.O_MR1) &#123;<br>                                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<br>                                        <span class="hljs-string">&quot;invalid channel for service notification: &quot;</span><br>                                                + foregroundNoti);<br>                            &#125;<br>                        &#125;<br>                        <span class="hljs-keyword">if</span> (localForegroundNoti.getSmallIcon() == <span class="hljs-literal">null</span>) &#123;<br>                            <span class="hljs-comment">// Notifications whose icon is 0 are defined to not show</span><br>                            <span class="hljs-comment">// a notification, silently ignoring it.  We don&#x27;t want to</span><br>                            <span class="hljs-comment">// just ignore it, we want to prevent the service from</span><br>                            <span class="hljs-comment">// being foreground.</span><br>                            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;invalid service notification: &quot;</span><br>                                    + foregroundNoti);<br>                        &#125;<br>                        nm.enqueueNotification(localPackageName, localPackageName,<br>                                appUid, appPid, <span class="hljs-literal">null</span>, localForegroundId, localForegroundNoti,userId);<br><br>                        foregroundNoti = localForegroundNoti; <span class="hljs-comment">// save it for amending next time</span><br>                    &#125; <span class="hljs-keyword">catch</span> (RuntimeException e) &#123;<br>                        Slog.w(TAG, <span class="hljs-string">&quot;Error showing notification for service&quot;</span>, e);<br>                        <span class="hljs-comment">// If it gave us a garbage notification, it doesn&#x27;t</span><br>                        <span class="hljs-comment">// get to be foreground.</span><br>                        ams.setServiceForeground(name, ServiceRecord.<span class="hljs-built_in">this</span>,<br>                                <span class="hljs-number">0</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>);<br>                        ams.crashApplication(appUid, appPid, localPackageName, -<span class="hljs-number">1</span>,<br>                                <span class="hljs-string">&quot;Bad notification for startForeground: &quot;</span> + e);<br>                    &#125;<br>                &#125;<br>            &#125;);<br></code></pre></td></tr></table></figure><p>é¦–å…ˆæ£€æŸ¥ä¸€ä¸‹<code>getSmallIcon</code>æ˜¯ä¸æ˜¯ç©ºï¼Œå¦‚æœæ˜¯ç©ºçš„ï¼Œæ‰“å°æ—¥å¿—ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„Notificationã€‚ç„¶åèµ°ä¸ä¸ºç©ºçš„åˆ¤æ–­ï¼šæ£€æŸ¥æœ‰æ²¡æœ‰<code>NotificationChannel</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">nm.getNotificationChannel(localPackageName, appUid,localForegroundNoti.getChannelId()) == <span class="hljs-literal">null</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œé¢å¦‚æœ<code>targetSdkVersion &gt;= Build.VERSION_CODES.O_MR1</code>,åˆ™ä¼šæŠ›å‡º<code>invalid channel for service notification</code>å¼‚å¸¸ã€‚</p><p>å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œå…¥é˜Ÿåˆ—å‘é€šçŸ¥ã€‚</p><hr><p>è‡³æ­¤ï¼Œåº”ç”¨ä¸­å‘ç”Ÿå´©æºƒçš„åŸå› æ‰¾åˆ°äº†ï¼ŒtargetSdkæ˜¯28ï¼Œåˆæ²¡æœ‰NotificationChannelã€‚</p><p>é‚£ä¹ˆï¼ŒNotificationChannelåˆæ˜¯ä¸ªåµï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</p><h4 id="NotificationChannel"><a href="#NotificationChannel" class="headerlink" title="NotificationChannel"></a>NotificationChannel</h4><p>ä»Android 8.0ç³»ç»Ÿå¼€å§‹ï¼ŒGoogleå¼•å…¥äº†é€šçŸ¥æ¸ é“è¿™ä¸ªæ¦‚å¿µã€‚</p><p>ä»€ä¹ˆæ˜¯é€šçŸ¥æ¸ é“å‘¢ï¼Ÿé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æ¯æ¡é€šçŸ¥éƒ½è¦å±äºä¸€ä¸ªå¯¹åº”çš„æ¸ é“ã€‚æ¯ä¸ªAppéƒ½å¯ä»¥è‡ªç”±åœ°åˆ›å»ºå½“å‰Appæ‹¥æœ‰å“ªäº›é€šçŸ¥æ¸ é“ï¼Œä½†æ˜¯è¿™äº›é€šçŸ¥æ¸ é“çš„æ§åˆ¶æƒéƒ½æ˜¯æŒæ¡åœ¨ç”¨æˆ·æ‰‹ä¸Šçš„ã€‚ç”¨æˆ·å¯ä»¥è‡ªç”±åœ°é€‰æ‹©è¿™äº›é€šçŸ¥æ¸ é“çš„é‡è¦ç¨‹åº¦ï¼Œæ˜¯å¦å“é“ƒã€æ˜¯å¦æŒ¯åŠ¨ã€æˆ–è€…æ˜¯å¦è¦å…³é—­è¿™ä¸ªæ¸ é“çš„é€šçŸ¥ã€‚</p><p>Googleè¿™æ¬¡å¯¹äº8.0ç³»ç»Ÿé€šçŸ¥æ¸ é“çš„æ¨å¹¿æ€åº¦è¿˜æ˜¯æ¯”è¾ƒå¼ºç¡¬çš„ã€‚</p><p>é¦–å…ˆï¼Œå¦‚æœä½ å‡çº§äº†appcompatåº“ï¼Œé‚£ä¹ˆæ‰€æœ‰ä½¿ç”¨appcompatåº“æ¥æ„å»ºé€šçŸ¥çš„åœ°æ–¹å…¨éƒ¨éƒ½ä¼šè¿›è¡ŒåºŸå¼ƒæ–¹æ³•æç¤ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="/image/Android/NotificationChanel/Notification_build.png" alt="é€šçŸ¥" title="startForegroundé€šçŸ¥"></p><h5 id="åˆ›å»ºNotificationChannel"><a href="#åˆ›å»ºNotificationChannel" class="headerlink" title="åˆ›å»ºNotificationChannel"></a>åˆ›å»ºNotificationChannel</h5><p>åˆ›å»ºNotificationChannelå¯¹è±¡(ä¸å¿…æ¯æ¬¡åˆ›å»º)ï¼Œå¹¶ä¸”åˆ›å»ºé€šçŸ¥æ¸ é“çš„ä»£ç åªåœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™æ‰ä¼šåˆ›å»ºï¼Œä»¥åæ¯æ¬¡æ‰§è¡Œåˆ›å»ºä»£ç ç³»ç»Ÿä¼šæ£€æµ‹åˆ°è¯¥é€šçŸ¥æ¸ é“å·²ç»å­˜åœ¨äº†ï¼Œå› æ­¤ä¸ä¼šé‡å¤åˆ›å»ºï¼Œä¹Ÿå¹¶ä¸ä¼šå½±å“ä»»ä½•æ•ˆç‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;<br>           <span class="hljs-type">String</span> <span class="hljs-variable">channelId</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;take_photo&quot;</span>;<br>           <span class="hljs-type">String</span> <span class="hljs-variable">channelName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;æ‹ç…§é€‰æ‹©å›¾ç‰‡&quot;</span>;<br>           <span class="hljs-type">int</span> <span class="hljs-variable">importance</span> <span class="hljs-operator">=</span> NotificationManager.IMPORTANCE_HIGH;<br>           <span class="hljs-type">NotificationManager</span><br>                   <span class="hljs-variable">notificationManager</span> <span class="hljs-operator">=</span> (NotificationManager) getSystemService(NOTIFICATION_SERVICE);<br>           <span class="hljs-type">NotificationChannel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> notificationManager.getNotificationChannel(channelId);<br>           <span class="hljs-keyword">if</span> (channel == <span class="hljs-literal">null</span>) &#123;<br>               channel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NotificationChannel</span>(channelId, channelName, importance);<br>           &#125;<br>           notificationManager.createNotificationChannel(channel);<br>           <span class="hljs-keyword">if</span> (channel.getImportance() == NotificationManager.IMPORTANCE_NONE) &#123;<br>               <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(Settings.ACTION_CHANNEL_NOTIFICATION_SETTINGS);<br>               intent.putExtra(Settings.EXTRA_APP_PACKAGE, getPackageName());<br>               intent.putExtra(Settings.EXTRA_CHANNEL_ID, channel.getId());<br>               startActivity(intent);<br>               Toast.makeText(<span class="hljs-built_in">this</span>, <span class="hljs-string">&quot;è¯·æ‰‹åŠ¨å°†é€šçŸ¥æ‰“å¼€&quot;</span>, Toast.LENGTH_SHORT).show();<br>           &#125; <span class="hljs-keyword">else</span> &#123;<br>               <span class="hljs-type">Notification</span> <span class="hljs-variable">nf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Notification</span>.Builder(<span class="hljs-built_in">this</span>, channelId)<br>                       .setContentText(<span class="hljs-string">&quot;setContentText&quot;</span>)<br>                       .setSettingsText(<span class="hljs-string">&quot;setSettingsText&quot;</span>)<br>                       .setContentTitle(<span class="hljs-string">&quot;setContentTitle&quot;</span>)<br>                       .setSmallIcon(R.drawable.ic_launcher_background)<br>                       .build();<br>               notificationManager.notify(<span class="hljs-number">1</span>, nf);<br>           &#125;<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure><p>é¦–å…ˆè¦ç¡®ä¿çš„æ˜¯å½“å‰æ‰‹æœºçš„ç³»ç»Ÿç‰ˆæœ¬å¿…é¡»æ˜¯Android 8.0ç³»ç»Ÿæˆ–è€…æ›´é«˜ï¼Œå› ä¸ºä½ç‰ˆæœ¬çš„æ‰‹æœºç³»ç»Ÿå¹¶æ²¡æœ‰é€šçŸ¥æ¸ é“è¿™ä¸ªåŠŸèƒ½ï¼Œä¸åšç³»ç»Ÿç‰ˆæœ¬æ£€æŸ¥çš„è¯ä¼šåœ¨ä½ç‰ˆæœ¬æ‰‹æœºä¸Šé€ æˆå´©æºƒã€‚åˆ›å»ºä¸€ä¸ªé€šçŸ¥æ¸ é“è‡³å°‘éœ€è¦æ¸ é“IDã€æ¸ é“åç§°ä»¥åŠé‡è¦ç­‰çº§è¿™ä¸‰ä¸ªå‚æ•°ï¼Œå…¶ä¸­æ¸ é“IDå¯ä»¥éšä¾¿å®šä¹‰ï¼Œåªè¦ä¿è¯å…¨å±€å”¯ä¸€æ€§å°±å¯ä»¥ã€‚æ¸ é“åç§°æ˜¯ç»™ç”¨æˆ·çœ‹çš„ï¼Œéœ€è¦èƒ½å¤Ÿè¡¨è¾¾æ¸…æ¥šè¿™ä¸ªæ¸ é“çš„ç”¨é€”ã€‚é‡è¦ç­‰çº§çš„ä¸åŒåˆ™ä¼šå†³å®šé€šçŸ¥çš„ä¸åŒè¡Œä¸ºï¼Œå½“ç„¶è¿™é‡Œåªæ˜¯åˆå§‹çŠ¶æ€ä¸‹çš„é‡è¦ç­‰çº§ï¼Œç”¨æˆ·å¯ä»¥éšæ—¶æ‰‹åŠ¨æ›´æ”¹æŸä¸ªæ¸ é“çš„é‡è¦ç­‰çº§ï¼ŒAppæ˜¯æ— æ³•å¹²é¢„çš„ã€‚</p><p>åˆ›å»ºé€šçŸ¥çš„ä»£ç å°±ä¸å†å¤šåšè§£é‡Šäº†ï¼Œå’Œä¼ ç»Ÿåˆ›å»ºé€šçŸ¥çš„æ–¹æ³•æ²¡ä»€ä¹ˆä¸¤æ ·ï¼Œåªæ˜¯åœ¨NotificationCompat.Builderä¸­éœ€è¦å¤šä¼ å…¥ä¸€ä¸ªé€šçŸ¥æ¸ é“IDï¼Œé‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬ä¼ å…¥åˆšåˆšåˆ›å»ºçš„æ¸ é“IDã€‚</p><h5 id="ç®¡ç†é€šçŸ¥æ¸ é“"><a href="#ç®¡ç†é€šçŸ¥æ¸ é“" class="headerlink" title="ç®¡ç†é€šçŸ¥æ¸ é“"></a>ç®¡ç†é€šçŸ¥æ¸ é“</h5><p>é€šçŸ¥æ¸ é“ä¸€æ—¦åˆ›å»ºä¹‹åå°±ä¸èƒ½å†é€šè¿‡ä»£ç ä¿®æ”¹äº†ï¼Œå¦‚æœç”¨æˆ·ä¸å°å¿ƒå…³é—­äº†è¯¥æ¸ é“ï¼Œæˆ‘ä»¬å¯ä»¥é€šçŸ¥ç”¨æˆ·æ‰‹åŠ¨å»ä¿®æ”¹ï¼Œå°±åƒåŠ¨æ€æƒé™ç”³è¯·ä¸€æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;<br><span class="hljs-type">NotificationChannel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> manager.getNotificationChannel(<span class="hljs-string">&quot;chat&quot;</span>);<br>    <span class="hljs-keyword">if</span> (channel.getImportance() == NotificationManager.IMPORTANCE_NONE) &#123;<br>    <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(Settings.ACTION_CHANNEL_NOTIFICATION_SETTINGS);<br>        intent.putExtra(Settings.EXTRA_APP_PACKAGE, getPackageName());<br>        intent.putExtra(Settings.EXTRA_CHANNEL_ID, channel.getId());<br>        startActivity(intent);<br>        Toast.makeText(<span class="hljs-built_in">this</span>, <span class="hljs-string">&quot;è¯·æ‰‹åŠ¨å°†é€šçŸ¥æ‰“å¼€&quot;</span>, Toast.LENGTH_SHORT).show();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡getNotificationChannel()æ–¹æ³•è·å–åˆ°äº†NotificationChannelå¯¹è±¡ï¼Œç„¶åå°±å¯ä»¥è¯»å–è¯¥é€šçŸ¥æ¸ é“ä¸‹çš„æ‰€æœ‰é…ç½®äº†ã€‚è¿™é‡Œæˆ‘ä»¬åˆ¤æ–­å¦‚æœé€šçŸ¥æ¸ é“çš„importanceç­‰äºIMPORTANCE_NONEï¼Œå°±è¯´æ˜ç”¨æˆ·å°†è¯¥æ¸ é“çš„é€šçŸ¥ç»™å…³é—­äº†ï¼Œè¿™æ—¶ä¼šè·³è½¬åˆ°é€šçŸ¥çš„è®¾ç½®ç•Œé¢æé†’ç”¨æˆ·æ‰‹åŠ¨æ‰“å¼€ã€‚</p><p>Android 8.0è¿˜èµ‹äºˆäº†æˆ‘ä»¬åˆ é™¤é€šçŸ¥æ¸ é“çš„åŠŸèƒ½ï¼Œåªéœ€ä½¿ç”¨å¦‚ä¸‹ä»£ç å³å¯åˆ é™¤ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">NotificationManager</span> <span class="hljs-variable">manager</span> <span class="hljs-operator">=</span> (NotificationManager)getSystemService(NOTIFICATION_SERVICE);<br>manager.deleteNotificationChannel(channelId);<br></code></pre></td></tr></table></figure><p>NotificationChannelç« èŠ‚å‚è€ƒ <a href="https://mp.weixin.qq.com/s/PG8XxHEHpijL4AMZ4AGP8g">https://mp.weixin.qq.com/s/PG8XxHEHpijL4AMZ4AGP8g</a></p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ubuntuè¾“å…¥å¯†ç ç™»é™†åå›åˆ°ç™»å½•ç•Œé¢</title>
    <link href="/2018/12/26/Ubuntu%E8%BE%93%E5%85%A5%E5%AF%86%E7%A0%81%E7%99%BB%E9%99%86%E5%90%8E%E5%9B%9E%E5%88%B0%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2/"/>
    <url>/2018/12/26/Ubuntu%E8%BE%93%E5%85%A5%E5%AF%86%E7%A0%81%E7%99%BB%E9%99%86%E5%90%8E%E5%9B%9E%E5%88%B0%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2/</url>
    
    <content type="html"><![CDATA[<p>æ—¢ç„¶æ¨èæ›´æ–°äº†ï¼Œé‚£å°±æ›´å‘—ï¼Œç„¶åæ›´æ–°åˆ°äº†18.04ï¼Œè¢«å°ä¼™ä¼´åæ§½ä¸ç”¨å‘½ä»¤è¡Œæ›´æ–°çš„ç³»ç»Ÿæ˜¯æ²¡æœ‰çµé­‚çš„ã€‚æ›´æ–°ä¹‹åç©äº†æ²¡å‡ å¤©ï¼Œæ˜¨æ™šçªç„¶é—´æ— æ³•ç™»å½•æ¡Œé¢äº†ã€‚è¾“å…¥å¯†ç ç™»å½•åæ˜¾ç¤ºä¸€ä¸‹æ¡Œé¢èƒŒæ™¯ç„¶åå°±å›åˆ°äº†çš„ç™»å½•ç•Œé¢ï¼Œä½¿ç”¨ttyç™»å½•æ²¡é—®é¢˜ã€‚è¿™å°±å¥½åŠäº†ï¼Œç›²çŒœæ¡Œé¢æœåŠ¡æŒ‚äº†ã€‚ç„¶åçŒœåŸå› ï¼š</p><ol><li><code>.Xauthority</code>æƒé™ä¸å¯¹</li><li><code>/tmp</code>æƒé™ä¸å¯¹</li><li><code>ubuntu-desktop</code>æŒ‚äº†</li></ol><p>ç›²çŒœå®Œäº†ï¼ŒéªŒè¯ä¸€ä¸‹</p><span id="more"></span><h4 id="Xauthority-æƒé™ä¸å¯¹"><a href="#Xauthority-æƒé™ä¸å¯¹" class="headerlink" title=".Xauthority æƒé™ä¸å¯¹"></a>.Xauthority æƒé™ä¸å¯¹</h4><p><code>Xauthority</code>æ˜¯<code>startx</code>è„šæœ¬è®°å½•æ–‡ä»¶ã€‚<code>Xserver</code>å¯åŠ¨æ—¶ï¼Œè¯»æ–‡ä»¶<code>~/.Xauthority</code>ï¼Œè¯»å…¥ç›¸åº”å…¶<code>display</code>çš„è®°å½•ã€‚</p><p>å½“ä¸€ä¸ªé¡»è¦æ˜¾ç¤ºçš„å®¢æˆ·ç¨‹åºå¯åŠ¨è°ƒç”¨<code>XOpenDisplay()</code>ä¹Ÿè¯»è¿™ä¸ªæ–‡ ä»¶ã€‚å¹¶æŠŠæ‰¾åˆ°çš„<code>magic code</code> å‘é€ç»™<code>Xserver</code>ã€‚</p><p>å½“<code>Xserver</code>éªŒè¯è¿™ä¸ª<code>magic code</code>æ­£ç¡®ä»¥åï¼Œå°±å…è®¸è¿æ¥å•¦ã€‚</p><p>è§‚å¯Ÿ<code>startx</code>è„šæœ¬ä¹Ÿèƒ½å¤Ÿçœ‹åˆ°ï¼Œæ¯æ¬¡<code>startx</code>æ‰§è¡Œï¼Œéƒ½åœ¨è°ƒç”¨<code>xinit</code>æ›¾ç»ä½¿ç”¨äº†<code>xauth</code>çš„<code>add</code>å‘½ä»¤åŠ å…¥äº†ä¸€ä¸ªæ–°çš„è®°å½•åˆ°<code>~/.Xauthority</code>ï¼Œç”¨æ¥è¿™æ¬¡æ‰§è¡ŒXä½¿ç”¨è®¤è¯ ã€‚</p><p>æŸ¥çœ‹æ–‡ä»¶æƒé™ï¼Œæ²¡é—®é¢˜ï¼ŒæŸ¥çœ‹<code>/tmp</code>æƒé™æ²¡é—®é¢˜ã€‚</p><p>emmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm</p><p>å®¶ç›®å½•ä¸‹æœ‰ä¸ª<code>.xsession-errors</code>æ–‡ä»¶ï¼Œä¹Ÿæ²¡æœ‰é”™è¯¯æ—¥å¿—ã€‚ã€‚ã€‚</p><h4 id="ubuntu-desktop-æŒ‚äº†"><a href="#ubuntu-desktop-æŒ‚äº†" class="headerlink" title="ubuntu-desktop æŒ‚äº†"></a>ubuntu-desktop æŒ‚äº†</h4><p>ttyç™»å½•ï¼Œåˆ é™¤<code>ubuntu-desktop</code></p><blockquote><p>sudo apt-get autoremove ubuntu-desktop</p></blockquote><p>ç„¶å <code>ctrl+alt+f1</code>è¿›å…¥GUIï¼Œè¾“å…¥å¯†ç ç™»å½•ã€‚æˆåŠŸã€‚</p><p>emmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm</p><p>åªæ˜¯æ¡Œé¢ä¸Šçš„æ–‡ä»¶ä¸æ˜¾ç¤ºäº†ï¼Œä¸æ€¥ï¼Œå‘½ä»¤è¡ŒæŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶è¿˜åœ¨ï¼Œæ”¾å¿ƒäº†ã€‚</p><p>dock(launch)ä¸è§äº†ï¼Œå°±æ˜¯åœ¨æ¡Œé¢å·¦è¾¹æ”¾è½¯ä»¶å›¾æ ‡çš„å¿«æ·å¯åŠ¨ï¼Œç›¸å½“äºwindowsçš„ä»»åŠ¡æ çš„é‚£ç©æ„</p><p>æŒ‰ä¸‹winé”®ï¼Œæœç´¢è¿˜èƒ½ç”¨ï¼Œé—®é¢˜ä¸å¤§ã€‚</p><p>åŸæ¥å®‰è£…çš„è½¯ä»¶è¿˜èƒ½ç”¨ï¼Œé‚£å°±æ›´æ²¡é—®é¢˜äº†ã€‚</p><blockquote><p>sudo apt-get install desktop-base<br>sudo apt-get install desktop-profiles<br>sudo apt-get install desklaunch<br>sudo apt-get install gnome-shell-extension-ubuntu-dock</p></blockquote><p>okï¼Œè§£å†³</p><p>æ²¡å¿…è¦è¿½æ±‚æ‰€æœ‰è½¯ä»¶å’Œä¾èµ–éƒ½ä½¿ç”¨æœ€æ–°ç‰ˆçš„ï¼Œæœ‰æ—¶é—´æŠ˜è…¾è¿˜å¥½ï¼Œæ²¡æ—¶é—´æŠ˜è…¾ã€‚ã€‚ã€‚ã€‚æ²¡æ—¶é—´æŠ˜è…¾çš„å°±è¦ä¹ˆè€è€å®å®ç”¨windowsï¼Œè¦ä¹ˆä¸Šmacã€‚</p><hr><p>æ“ä½œç³»ç»Ÿï¼šæˆ‘ä»¬è¦ä¸è¦ä¿¡ä»»ç”¨æˆ·çš„æ“ä½œï¼Ÿ</p><p>windowsï¼šä¸ä¿¡ä»»ï¼Œç”¨æˆ·éƒ½æ˜¯å‚»<del>æ¶ˆéŸ³</del>ï¼Œä¸ä¿¡ä»»ï¼Œåªå¼€æ”¾éƒ¨åˆ†æƒé™ç»™ç”¨æˆ·ï¼Œç³»ç»Ÿé…ç½®æ›´æ–°æˆ‘ä»¬è‡ªå·±æã€‚</p><p>ubuntuï¼šç”¨æˆ·å®‰è£…äº†æ“ä½œç³»ç»Ÿï¼Œé‚£å°±æ‰€æœ‰ä¸œè¥¿éƒ½æ”¾æƒç»™ç”¨æˆ·ï¼Œæˆ‘ä»¬åªåœ¨å…³é”®åœ°æ–¹ç»™å‡ºæç¤ºã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gradle-androidæ’ä»¶</title>
    <link href="/2018/12/22/gradle-android%E6%8F%92%E4%BB%B6/"/>
    <url>/2018/12/22/gradle-android%E6%8F%92%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<p>Android Gradleæ’ä»¶å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼Œåˆ†åˆ«å¯¹åº”Androidä¸­çš„ä¸‰ç±»å·¥ç¨‹ï¼š</p><ul><li>Appåº”ç”¨å·¥ç¨‹ï¼Œå®ƒå¯ä»¥ç”Ÿæˆä¸€ä¸ªå¯è¿è¡Œçš„apkåº”ç”¨ï¼Œå¯¹åº”æ’ä»¶idï¼šcom.android.application</li><li>Libraryåº“å·¥ç¨‹ï¼Œå¯ä»¥ç”ŸæˆAARåŒ…ç»™å…¶ä»–å·¥ç¨‹ä½¿ç”¨ï¼Œå¯¹ç”¨æ’ä»¶id:com.android.library</li><li>testæµ‹è¯•å·¥ç¨‹ï¼Œå¯¹Appå·¥ç¨‹æˆ–è€…Libraryåº“å·¥ç¨‹è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œå¯¹åº”æ’ä»¶idï¼šcom.android.test</li></ul><p>é€šè¿‡é…ç½®ä¸åŒçš„æ’ä»¶ï¼Œé…åˆASï¼Œå°±å¯ä»¥è¿›è¡Œç¼–è¯‘æµ‹è¯•å‘å¸ƒç­‰æ“ä½œ</p><span id="more"></span><h4 id="åº”ç”¨Androidæ’ä»¶"><a href="#åº”ç”¨Androidæ’ä»¶" class="headerlink" title="åº”ç”¨Androidæ’ä»¶"></a>åº”ç”¨Androidæ’ä»¶</h4><p>Android Gradleæ’ä»¶å±äºç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œæ‰˜ç®¡åœ¨Jcenterä¸Šï¼Œæ‰€ä»¥åœ¨åº”ç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆé…ç½®classpathï¼Œ</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs groovy">buildscript &#123;<br>    repositories &#123;<br>        jcenter()<br>    &#125;<br>    dependencies &#123;<br>        classpath <span class="hljs-string">&#x27;com.android.tools.build:gradle:3.1.3&#x27;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬é…ç½®ä»“åº“ä¸ºjcenterï¼Œè¿™æ ·å½“æˆ‘ä»¬é…ç½®ä¾èµ–çš„æ—¶å€™ï¼ŒGradleå°±ä¼šå»è¿™ä¸ªä»“åº“é‡Œå¯»æ‰¾æˆ‘ä»¬çš„ä¾èµ–ï¼Œç„¶åæˆ‘ä»¬åœ¨dependencies{}ä¸­ä¾èµ–Androidæ’ä»¶ã€‚</p><p>buildscript{}è¿™éƒ¨åˆ†é…ç½®äº†å¯ä»¥å†™åˆ°æ ¹å·¥ç¨‹çš„build.gradleè„šæœ¬æ–‡ä»¶ä¸­ï¼Œè¿™æ ·æ‰€æœ‰çš„è‡ªå·¥ç¨‹å°±ä¸ç”¨é‡å¤é…ç½®äº†ï¼Œä¹‹åå°±å¯ä»¥åº”ç”¨Android Gradleæ’ä»¶äº†</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs groovy">apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;com.android.application&#x27;</span><br><br>android &#123;<br>    compileSdkVersion <span class="hljs-number">28</span><br>    defaultConfig &#123;<br>        minSdkVersion <span class="hljs-number">19</span><br>        targetSdkVersion <span class="hljs-number">28</span><br>        versionCode <span class="hljs-number">1</span><br>        versionName <span class="hljs-string">&quot;1.0&quot;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>android{}æ˜¯Androidæ’ä»¶æä¾›çš„ä¸€ä¸ªæ‰©å±•ç±»å‹ï¼Œå¯ä»¥è®©æˆ‘ä»¬è‡ªå®šä¹‰Android Gradleå·¥ç¨‹ã€‚compileSdkVersionæ˜¯ç¼–è¯‘æ‰€ä¾èµ–çš„Android SDKçš„ç‰ˆæœ¬</p><h4 id="Android-Gradle-å·¥ç¨‹ç¤ºä¾‹"><a href="#Android-Gradle-å·¥ç¨‹ç¤ºä¾‹" class="headerlink" title="Android Gradle å·¥ç¨‹ç¤ºä¾‹"></a>Android Gradle å·¥ç¨‹ç¤ºä¾‹</h4><p>Android Gradleæ’ä»¶ç»§æ‰¿äºJavaæ’ä»¶ï¼Œå…·æœ‰æ‰€æœ‰çš„Javaæ’ä»¶çš„ç‰¹æ€§ã€‚å¯¹äºä¸€ä¸ªAndroidåº”ç”¨ ï¼Œå¸¸è§çš„build.gradleæ–‡ä»¶å†…å®¹å¦‚ä¸‹</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs groovy">apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;com.android.application&#x27;</span><br><br>android &#123;<br>    compileSdkVersion <span class="hljs-number">28</span><br>    buildToolsVersion <span class="hljs-string">&quot;28.0.3&quot;</span><br>    defaultConfig &#123;<br>        applicationId <span class="hljs-string">&quot;com.huangyuanlove.testandroid&quot;</span><br>        minSdkVersion <span class="hljs-number">19</span><br>        targetSdkVersion <span class="hljs-number">28</span><br>        versionCode <span class="hljs-number">1</span><br>        versionName <span class="hljs-string">&quot;1.0&quot;</span><br>        testInstrumentationRunner <span class="hljs-string">&quot;android.support.test.runner.AndroidJUnitRunner&quot;</span><br>    &#125;<br>    buildTypes &#123;<br>        release &#123;<br>            minifyEnabled <span class="hljs-literal">false</span><br>            proguardFiles getDefaultProguardFile(<span class="hljs-string">&#x27;proguard-android.txt&#x27;</span>), <span class="hljs-string">&#x27;proguard-rules.pro&#x27;</span><br>        &#125;<br>    &#125;<br>&#125;<br><br>dependencies &#123;<br>    implementation fileTree(<span class="hljs-attr">dir:</span> <span class="hljs-string">&#x27;libs&#x27;</span>, <span class="hljs-attr">include:</span> [<span class="hljs-string">&#x27;*.jar&#x27;</span>])<br>    implementation <span class="hljs-string">&#x27;com.android.support:appcompat-v7:28.0.0-rc01&#x27;</span><br>    implementation <span class="hljs-string">&#x27;com.android.support.constraint:constraint-layout:1.1.2&#x27;</span><br>    implementation <span class="hljs-string">&#x27;com.android.support:design:28.0.0-rc01&#x27;</span><br>    testImplementation <span class="hljs-string">&#x27;junit:junit:4.12&#x27;</span><br>    androidTestImplementation <span class="hljs-string">&#x27;com.android.support.test:runner:1.0.2&#x27;</span><br>    androidTestImplementation <span class="hljs-string">&#x27;com.android.support.test.espresso:espresso-core:3.0.2&#x27;</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>Android Gradleå·¥ç¨‹çš„é…ç½®ï¼Œéƒ½æ˜¯åœ¨android{}ä¸­ï¼Œè¿™æ˜¯å”¯ä¸€çš„ä¸€ä¸ªå…¥å£ã€‚é€šè¿‡å®ƒï¼Œå¯ä»¥å¯¹Android Gradleå·¥ç¨‹è¿›è¡Œè‡ªå®šä¹‰çš„é…ç½®ï¼Œå…¶å…·ä½“å®ç°æ˜¯<code>com.android.build.gradle.AppExtension</code>ï¼Œæ‰€ä»¥å¾ˆå¤šAndroidé…ç½®å¯ä»¥ä»è¿™ä¸ªç±»é‡Œå»æ‰¾ï¼Œ</p><h5 id="compileSdkVersion"><a href="#compileSdkVersion" class="headerlink" title="compileSdkVersion"></a>compileSdkVersion</h5><p>compileSdkVersion 28æ˜¯é…ç½®æˆ‘ä»¬ç¼–è¯‘Androidå·¥ç¨‹çš„SDKï¼Œè¿™é‡Œçš„23æ˜¯Android SDKçš„API Levelï¼Œè¯¥é…ç½®çš„åŸå½¢æ˜¯ä¸€ä¸ªcompileSdkVersionæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/** <span class="hljs-doctag">@see</span> #getCompileSdkVersion() */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">compileSdkVersion</span><span class="hljs-params">(String version)</span> &#123;<br>        checkWritability();<br>        <span class="hljs-built_in">this</span>.target = version;<br>    &#125;<br><br>    <span class="hljs-comment">/** <span class="hljs-doctag">@see</span> #getCompileSdkVersion() */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">compileSdkVersion</span><span class="hljs-params">(<span class="hljs-type">int</span> apiLevel)</span> &#123;<br>        compileSdkVersion(<span class="hljs-string">&quot;android-&quot;</span> + apiLevel);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCompileSdkVersion</span><span class="hljs-params">(<span class="hljs-type">int</span> apiLevel)</span> &#123;<br>        compileSdkVersion(apiLevel);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCompileSdkVersion</span><span class="hljs-params">(String target)</span> &#123;<br>        compileSdkVersion(target);<br>    &#125;<br></code></pre></td></tr></table></figure><p>åœ¨gradleä¸­ï¼Œæ–¹æ³•çš„æ‹¬å·å¯ä»¥çœç•¥ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿæ³¨æ„åˆ°äº†Stringç±»å‹çš„é‡è½½æ–¹æ³•å’Œä¸¤ä¸ª<code>setCompileSdkVersion</code>æ–¹æ³•ï¼Œå®Œå…¨å¯ä»¥æŒ‰ç…§è¿™å››ç§æ–¹å¼æ¥è¿›è¡Œé…ç½®ã€‚</p><h5 id="buildToolsVersion"><a href="#buildToolsVersion" class="headerlink" title="buildToolsVersion"></a>buildToolsVersion</h5><p><code>buildToolsVersion &quot;28.0.3&quot;</code>è¡¨ç¤ºæˆ‘ä»¬ä½¿ç”¨çš„Androidæ„å»ºå·¥å…·çš„ç‰ˆæœ¬ã€‚å®ƒçš„åŸå½¢ä¹Ÿæ˜¯ä¸€ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buildToolsVersion</span><span class="hljs-params">(String version)</span> &#123;<br>        checkWritability();<br>        <span class="hljs-comment">//The underlying Revision class has the maven artifact semantic,</span><br>        <span class="hljs-comment">// so 20 is not the same as 20.0. For the build tools revision this</span><br>        <span class="hljs-comment">// is not the desired behavior, so normalize e.g. to 20.0.0.</span><br>        buildToolsRevision = Revision.parseRevision(version, Revision.Precision.MICRO);<br>    &#125;<br><br>    <span class="hljs-comment">/** &#123;<span class="hljs-doctag">@inheritDoc</span>&#125; */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getBuildToolsVersion</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> buildToolsRevision.toString();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBuildToolsVersion</span><span class="hljs-params">(String version)</span> &#123;<br>        buildToolsVersion(version);<br>    &#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡buildToolsVersionæ–¹æ³•èµ‹å€¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡android.buildToolsVersionè¿™ä¸ªå±æ€§è¯»å†™å®ƒçš„å€¼ã€‚</p><h5 id="defaultConfig"><a href="#defaultConfig" class="headerlink" title="defaultConfig"></a>defaultConfig</h5><p>defaultConfigæ˜¯é»˜è®¤çš„é…ç½®ï¼Œå®ƒæ˜¯ä¸€ä¸ªProductFlavorã€‚ProductFlavorå…è®¸æˆ‘ä»¬æ ¹æ®ä¸åŒçš„æƒ…å†µåŒæ—¶ç”Ÿæˆå¤šä¸ªä¸åŒçš„APKåŒ…ã€‚å¦‚æœä¸é’ˆå¯¹æˆ‘ä»¬è‡ªå®šä¹‰çš„ProductFlavorå•ç‹¬é…ç½®çš„è¯ï¼Œä¼šä¸ºè¿™ä¸ªProductFlavorä½¿ç”¨é»˜è®¤çš„defaultConfigçš„é…ç½®ã€‚é‡Œé¢çš„å±æ€§å°±ä¸å†ä¸€ä¸€è§£é‡Šã€‚</p><h5 id="buildTypes"><a href="#buildTypes" class="headerlink" title="buildTypes"></a>buildTypes</h5><p>buildTypesæ˜¯ä¸€ä¸ªNamedDomainObjectContainerç±»å‹ï¼Œæ˜¯ä¸€ä¸ªåŸŸå¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥åœ¨buildTypes{}é‡Œé¢æ–°å¢ä»»æ„å¤šä¸ªæˆ‘ä»¬éœ€è¦æ„å»ºçš„ç±»å‹ï¼ŒGradleä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„BuildTypeï¼Œåå­—å°±æ˜¯æˆ‘ä»¬å®šä¹‰çš„åå­—ã€‚</p><ul><li><p>ä¸Šé¢çš„ releaseå°±æ˜¯ä¸€ä¸ªBuildTypeã€‚</p></li><li><p>minifyEnabledæ˜¯å¦ä¸ºè¯¥æ„å»ºç±»å‹å¯ç”¨æ··æ·†ï¼Œfalseè¡¨ç¤ºä¸å¯ç”¨ï¼Œtrueè¡¨ç¤ºå¯ç”¨</p></li><li><p>proguardFilesï¼Œå½“æˆ‘ä»¬å¯ç”¨æ··æ·†æ—¶ï¼Œæ‰€ä½¿ç”¨proguardçš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒé…ç½®æ··æ·†è§„åˆ™ã€‚å®ƒå¯¹åº”BuildTypeçš„proguardFilesæ–¹æ³•ï¼Œæ¥å—ä¸€ä¸ªå¯å˜å‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬åŒæ—¶å¯ä»¥é…ç½®å¤šä¸ªé…ç½®æ–‡ä»¶ã€‚<br><code>getDefaultProguardFile</code>æ˜¯Androidæ‰©å±•çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒå¯ä»¥è¯»å–ä½ çš„AndroidSDKç›®å½•ä¸‹é»˜è®¤çš„proguardé…ç½®æ–‡ä»¶ã€‚</p><h4 id="Android-Gradleä»»åŠ¡"><a href="#Android-Gradleä»»åŠ¡" class="headerlink" title="Android Gradleä»»åŠ¡"></a>Android Gradleä»»åŠ¡</h4></li><li><p>connectedCheck åœ¨æ‰€æœ‰è¿æ¥çš„è®¾å¤‡æˆ–è€…æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œcheckæ£€æŸ¥ã€‚</p></li><li><p>devicesCheck é€šè¿‡APIè¿æ¥è¿œç¨‹è®¾å¤‡è¿è¡Œchecksã€‚</p></li><li><p>lintåœ¨æ‰€æœ‰çš„ProductFlavorä¸Šè¿è¡Œlintæ£€æŸ¥ã€‚</p></li><li><p>installå’Œuninstallç±»çš„ä»»åŠ¡å¯ä»¥ç›´æ¥åœ¨æˆ‘ä»¬å·²è¿æ¥çš„è®¾å¤‡ä¸Šå®‰è£…æˆ–è€…å¸è½½ä½ çš„appã€‚</p></li><li><p>signingReportå¯ä»¥æ‰“å°Appçš„ç­¾å</p></li><li><p>AndroidDependencieså¯ä»¥æ‰“å°Androidçš„ä¾èµ–<br>è¿˜æœ‰ä¸€äº›å…¶ä»–ç±»ä¼¼çš„ä»»åŠ¡ï¼Œå¯ä»¥é€šè¿‡.&#x2F;gradlew tasks æ¥æŸ¥çœ‹</p></li></ul><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Gradle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gradle-javaæ’ä»¶</title>
    <link href="/2018/12/19/gradle-java%E6%8F%92%E4%BB%B6/"/>
    <url>/2018/12/19/gradle-java%E6%8F%92%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<p>å½“æˆ‘ä»¬ä½¿ç”¨javaæ’ä»¶æ—¶ï¼Œåªéœ€è¦åœ¨gradleæ–‡ä»¶ä¸­åº”ç”¨<code>apply plugin :&#39;java&#39;</code>ä¸€ä¸‹ å°±å¥½äº†ï¼Œæ’ä»¶ä¸­æœ‰å¾ˆå¤šé»˜è®¤çš„é…ç½®ï¼Œæ¯”å¦‚æºä»£ç ä½ç½®åœ¨<code>src/main/java</code>ï¼Œ<code>src/test/java</code>æ˜¯å•å…ƒæµ‹è¯•ç”¨ä¾‹çš„å­˜æ”¾ç›®å½•ï¼Œ<code>src/main/resources</code>æ˜¯è¦æ‰“åŒ…çš„æ–‡ä»¶å­˜æ”¾ç›®å½•ï¼Œæ¯”å¦‚é…ç½®æ–‡ä»¶å’Œå›¾ç‰‡ç­‰ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ”¹å˜javaæ’ä»¶çš„é»˜è®¤é…ç½®ï¼Œåªéœ€è¦åœ¨<code>build.gradle</code>ä¸­é…ç½®å¯¹åº”ç›®å½•å³å¯ã€‚</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs groovy">sourceSets&#123;<br>    main&#123;<br>        java&#123;<br>            srcDir <span class="hljs-string">&#x27;src/java&#x27;</span><br>        &#125;<br>        resources&#123;<br>            srcDir <span class="hljs-string">&#x27;src/resources&#x27;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸€èˆ¬æˆ‘ä»¬åœ¨IDEAä¸­å¯¼å…¥eclipseé¡¹ç›®çš„æ—¶å€™å¯ä»¥æš‚æ—¶è¿™æ ·é…ç½®ã€‚</p><span id="more"></span><h4 id="é…ç½®ç¬¬ä¸‰æ–¹ä¾èµ–"><a href="#é…ç½®ç¬¬ä¸‰æ–¹ä¾èµ–" class="headerlink" title="é…ç½®ç¬¬ä¸‰æ–¹ä¾èµ–"></a>é…ç½®ç¬¬ä¸‰æ–¹ä¾èµ–</h4><p>è¦æƒ³ä½¿ç”¨ä¸‰æ–¹ä¾èµ–ï¼Œé¦–å…ˆè¦å‘Šè¯‰Gradleä»å“ªé‡Œæ‰¾åˆ°è¿™äº›ä¾èµ–ï¼Œä¸€èˆ¬æˆ‘ä»¬ä»æŸä¸ªä»“åº“ä¸­æŸ¥æ‰¾æˆ‘ä»¬éœ€è¦çš„jaråŒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥é…ç½®ä½¿ç”¨ä»€ä¹ˆç±»å‹çš„ä»“åº“ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs groovy">repositories&#123;<br>    mavenCentral()<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢é…ç½®äº†ä¸€ä¸ªMavenä¸­å¤®ä»“åº“ï¼Œå‘Šè¯‰Gradleå¯ä»¥åœ¨Mavenä¸­å¤®ä»“åº“ä¸­æŸ¥æ‰¾æˆ‘ä»¬ä¾èµ–çš„jarï¼Œæ­¤å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä»jcenterã€ivyã€æœ¬åœ°Mavenåº“ã€è‡ªå·±æ­å»ºçš„Mavenä»“åº“æŸ¥æ‰¾ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs groovy">repositories&#123;<br>    mavenCentral()<br>    maven&#123;<br>        url <span class="hljs-string">&quot;http://mymaven.com&quot;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ‰äº†ä»“åº“ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„ä¾èµ–äº†</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs groovy">dependencies&#123;<br>    compile <span class="hljs-attr">group:</span> <span class="hljs-string">&#x27;com.squareup.okhttp3&#x27;</span>,<span class="hljs-attr">name:</span><span class="hljs-string">&#x27;okhttp&#x27;</span>,<span class="hljs-attr">version:</span><span class="hljs-string">&#x27;3.0.1&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs groovy">dependencies&#123;<br>    compile <span class="hljs-string">&#x27;com.squareup.okhttp3:okhttp:3.0.1&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ­¤å¤–ï¼Œjavaæ’ä»¶å¯ä»¥ä¸ºä¸åŒçš„æºé›†åœ¨ç¼–è¯‘æ—¶æŒ‡å®šä¸åŒçš„ä¾èµ–ï¼Œæ¯”å¦‚mainæºé›†æŒ‡å®šä¸€ä¸ªç¼–è¯‘æ—¶ä¾èµ–ï¼Œvipæºé›†å¯ä»¥æŒ‡å®šå¦å¤–ä¸€ä¸ªä¸åŒçš„ä¾èµ–ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs groovy">dependencies&#123;<br>    mainCompile <span class="hljs-string">&#x27;com.squareup.okhttp3:okhttp:3.0.1&#x27;</span><br>    vipCompile <span class="hljs-string">&#x27;com.squareup.okhttp3:okhttp:2.5.0&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¾èµ–è¿˜å¯ä»¥æ˜¯ä¸€ä¸ªå­é¡¹ç›®(module):</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs groovy">dependencies&#123;<br>    compile project (<span class="hljs-string">&#x27;:module&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¾èµ–è¿˜å¯ä»¥æ˜¯ä¸€ä¸ªæ–‡ä»¶</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs groovy">dependencies&#123;<br>    compile file (<span class="hljs-string">&#x27;libs/xxx.jar&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬ä¾èµ–çš„jaråŒ…è¾ƒå¤šæ—¶ï¼Œå¯ä»¥è¿™ä¹ˆå†™</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs groovy">dependencies&#123;<br>    compile fileTree(<span class="hljs-attr">dir:</span> <span class="hljs-string">&#x27;libs&#x27;</span>, <span class="hljs-attr">include:</span> [<span class="hljs-string">&#x27;*.jar&#x27;</span>])<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æºç é›†åˆ-SourceSet"><a href="#æºç é›†åˆ-SourceSet" class="headerlink" title="æºç é›†åˆ(SourceSet)"></a>æºç é›†åˆ(SourceSet)</h4><p>SourceSetâ€“æºä»£ç é›†åˆâ€“æºé›†ï¼Œæ˜¯Javaæ’ä»¶æ¥æè¿°å’Œç®¡ç†æºä»£ç åŠå…¶èµ„æºçš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œæ˜¯ä¸€ä¸ªJavaæºä»£ç æ–‡ä»¶å’Œèµ„æºæ–‡ä»¶çš„åˆé›†ã€‚</p><p>æœ‰äº†æºé›†ï¼Œæˆ‘ä»¬å°±èƒ½é’ˆå¯¹ä¸åŒçš„ä¸šåŠ¡å’Œåº”ç”¨å¯¹æˆ‘ä»¬çš„æºç è¿›è¡Œåˆ†ç»„ã€‚Javaæ’ä»¶åœ¨Projectä¸‹ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªsourceSetå±æ€§ä»¥åŠä¸€ä¸ªsourceSet{}é—­åŒ…æ¥è®¿é—®å’Œé…ç½®æºé›†</p><table><thead><tr><th align="left">å±æ€§å</th><th align="left">ç±»å‹</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">name</td><td align="left">String</td><td align="left">åªè¯»ï¼Œæ¯”å¦‚main</td></tr><tr><td align="left">output.classesDir</td><td align="left">File</td><td align="left">è¯¥æºé›†ç¼–è¯‘åçš„classæ–‡ä»¶ç›®å½•</td></tr><tr><td align="left">output.resourcesDir</td><td align="left">File</td><td align="left">ç¼–è¯‘åç”Ÿæˆçš„èµ„æºç›®å½•</td></tr><tr><td align="left">compileClasspath</td><td align="left">FileCollection</td><td align="left">ç¼–è¯‘è¯¥æºé›†æ—¶æ‰€éœ€è¦çš„classpath</td></tr><tr><td align="left">java</td><td align="left">SourceDirectorySet</td><td align="left">è¯¥æºé›†çš„javaæºæ–‡ä»¶</td></tr><tr><td align="left">java.srcDir</td><td align="left">Set</td><td align="left">è¯¥æºé›†çš„Javaæºæ–‡ä»¶æ‰€åœ¨ç›®å½•</td></tr><tr><td align="left">resources</td><td align="left">SourceDirectorySet</td><td align="left">è¯¥æºé›†çš„èµ„æºæ–‡ä»¶</td></tr><tr><td align="left">resources.srcDir</td><td align="left">Set</td><td align="left">è¯¥æºé›†çš„èµ„æºæ–‡ä»¶æ‰€åœ¨ç›®å½•</td></tr></tbody></table><h4 id="å‘å¸ƒæ„ä»¶"><a href="#å‘å¸ƒæ„ä»¶" class="headerlink" title="å‘å¸ƒæ„ä»¶"></a>å‘å¸ƒæ„ä»¶</h4><p>Gradleæ„å»ºçš„äº§ç‰©ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ„ä»¶ï¼Œä¸€ä¸ªæ„ä»¶å¯ä»¥æ˜¯ä¸€ä¸ªjaråŒ…ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªzipæˆ–è€…waråŒ…ã€‚æƒ³è¦å‘å¸ƒæ„ä»¶ï¼Œéœ€è¦å…ˆå®šä¹‰å‘å¸ƒä»€ä¹ˆæ ·çš„æ„ä»¶ã€‚ä¸‹é¢ä»¥å‘å¸ƒä¸€ä¸ªJaræ„ä»¶ä¸ºä¾‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs groovy">apply <span class="hljs-attr">plugin:</span><span class="hljs-string">&#x27;java&#x27;</span><br>task publishJar(<span class="hljs-attr">type:</span>Jar)<br>version <span class="hljs-string">&#x27;1.0.0&#x27;</span><br>artifacts &#123;<br>    archives publishJar<br>&#125;<br></code></pre></td></tr></table></figure><p>å‘å¸ƒçš„æ„ä»¶æ˜¯é€šè¿‡<code>artifacts&#123;&#125;</code>é—­åŒ…é…ç½®çš„ï¼Œä¾‹å­ä¸­æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªTaskæ¥ä¸ºæˆ‘ä»¬å‘å¸ƒæä¾›æ„ä»¶ï¼Œé™¤äº†ä½¿ç”¨Taskä¹‹å¤–ï¼Œè¿˜å¯ä»¥ ç›´æ¥å‘å¸ƒä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> publishFile = file(<span class="hljs-string">&#x27;build/buildile&#x27;</span>)<br>artifacts &#123;<br>    archives publishFile<br>&#125;<br></code></pre></td></tr></table></figure><p>é…ç½®å¥½éœ€è¦å‘å¸ƒçš„æ„ä»¶åå°±å¯ä»¥å‘å¸ƒï¼Œå°±æ˜¯æŠŠä½ çš„æ„ä»¶ä¸Šä¼ åˆ°ä¸€ä¸ªæŒ‡å®šçš„ç›®å½•ã€ä»“åº“ç­‰</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs groovy">apply <span class="hljs-attr">plugin:</span><span class="hljs-string">&#x27;java&#x27;</span><br><br>task publishJar(<span class="hljs-attr">type:</span>Jar)<br><br>version <span class="hljs-string">&#x27;1.0.0&#x27;</span><br><br>artifacts &#123;<br>    archives publishJar<br>&#125;<br><br>uploadArchives&#123;<br>    repositories &#123;<br>        flatDir&#123;<br>            name <span class="hljs-string">&#x27;libs&#x27;</span><br>            dirs <span class="hljs-string">&quot;$projectDir/libs&quot;</span><br>        &#125;<br>        mavenLocal()<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>uploadArchives</code>æ˜¯ä¸€ä¸ªUploadTaskï¼Œç”¨äºä¸Šä¼ å‘å¸ƒæˆ‘ä»¬çš„æ„ä»¶ï¼Œä¸Šé¢çš„é…ç½®æ˜¯å‘å¸ƒåˆ°æˆ‘ä»¬å½“å‰é¡¹ç›®çš„libsç›®å½•å’Œæœ¬åœ°çš„Mavenåº“(mavenLocal())ï¼Œå½“ä½ æ‰§è¡Œ<code>uploadArchives</code>ä»»åŠ¡åï¼Œå¯ä»¥åœ¨ç”¨æˆ·ç›®å½•ä¸‹çš„<code>.m2/repository</code>æ–‡ä»¶å¤¹ä¸‹æ‰¾åˆ°å®ƒã€‚</p><p>å‡å¦‚æˆ‘ä»¬è¦ä¸Šä¼ åˆ°è‡ªå·±å…¬å¸æ­å»ºçš„Nexusç§æœä¸ºä¾‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs groovy">apply <span class="hljs-attr">plugin:</span><span class="hljs-string">&#x27;java&#x27;</span><br>apply <span class="hljs-attr">plugin:</span><span class="hljs-string">&#x27;maven&#x27;</span><br><br>task publishJar(<span class="hljs-attr">type:</span>Jar)<br><br>group <span class="hljs-string">&#x27;com.company.projectName&#x27;</span><br>version <span class="hljs-string">&#x27;3.1415&#x27;</span><br><br>artifacts &#123;<br>    archives publishJar<br>&#125;<br><br><span class="hljs-keyword">def</span> publishFile = file(<span class="hljs-string">&#x27;build/buildile&#x27;</span>)<br>artifacts &#123;<br>    archives publishFile<br>&#125;<br><br><br>uploadArchives&#123;<br>    repositories &#123;<br>        flatDir&#123;<br>            name <span class="hljs-string">&#x27;libs&#x27;</span><br>            dirs <span class="hljs-string">&quot;$projectDir/libs&quot;</span><br>        &#125;<br>        mavenLocal()<br>        mavenDeployer&#123;<br>            repository(<span class="hljs-attr">url:</span> <span class="hljs-string">&quot;http://repo.mycompany.com/nexus/content/repositories/release&quot;</span>)&#123;<br>                authentication(<span class="hljs-attr">userName:</span><span class="hljs-string">&#x27;userName&#x27;</span>,<span class="hljs-attr">password:</span><span class="hljs-string">&#x27;pwd&#x27;</span>)<br>            &#125;<br>            snapshotRepository(<span class="hljs-attr">url:</span> <span class="hljs-string">&quot;http://repo.mycompany.com/nexus/content/repositories/snapshot&quot;</span>)&#123;<br>                authentication(<span class="hljs-attr">userName:</span><span class="hljs-string">&#x27;userName&#x27;</span>,<span class="hljs-attr">password:</span><span class="hljs-string">&#x27;pwd&#x27;</span>)<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå¼•ç”¨äº†ä¸€ä¸ªmavenæ’ä»¶ï¼Œå®ƒå¯¹Mavençš„å‘å¸ƒæ„ä»¶æ”¯æŒçš„éå¸¸å¥½ï¼Œå¯ä»¥ç›´æ¥é…ç½®releaseå’Œsnapshotåº“ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Gradle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gradleæ’ä»¶</title>
    <link href="/2018/12/09/gradle%E6%8F%92%E4%BB%B6/"/>
    <url>/2018/12/09/gradle%E6%8F%92%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<p>æŠŠæ’ä»¶åº”ç”¨åˆ°ä½ çš„é¡¹ç›®ï¼Œæ’ä»¶ä¼šæ‰©å±•é¡¹ç›®çš„åŠŸèƒ½ï¼Œå¸®åŠ©ä½ åœ¨é¡¹ç›®çš„æ„å»ºè¿‡ç¨‹ä¸­åšå¾ˆå¤šäº‹æƒ…ã€‚</p><ol><li>å¯ä»¥æ·»åŠ ä»»åŠ¡åˆ°ä½ çš„é¡¹ç›®ä¸­ï¼Œå¸®ä½ å®Œæˆä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚æµ‹è¯•ã€ç¼–è¯‘ã€æ‰“åŒ…ã€‚</li><li>å¯ä»¥æ·»åŠ ä¾èµ–é…ç½®åˆ°ä½ çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»–ä»¬é…ç½®æˆ‘ä»¬é¡¹ç›®åœ¨æ„å»ºè¿‡ç¨‹ä¸­éœ€è¦çš„ä¾èµ–ï¼Œæ¯”å¦‚å˜å¼‚çš„æ—¶å€™ä¾èµ–ç¬¬ä¸‰æ–¹åº“ç­‰</li><li>å¯ä»¥å‘é¡¹ç›®ä¸­ç°æœ‰çš„å¯¹è±¡ç±»å‹æ·»åŠ æ–°çš„æ‰©å±•å±æ€§ã€æ–¹æ³•ç­‰ï¼Œè®©ä½ å¯ä»¥ä½¿ç”¨ä»–ä»¬å¸®åŠ©æˆ‘ä»¬é…ç½®ã€ä¼˜åŒ–æ„å»ºï¼Œæ¯”å¦‚<code>android&#123;&#125;</code>è¿™ä¸ªé…ç½®å—å°±æ˜¯Android Gradleæ’ä»¶ä¸ºProjectå¯¹è±¡æ·»åŠ çš„ä¸€ä¸ªæ‰©å±•ã€‚</li><li>å¯ä»¥å¯¹é¡¹ç›®è¿›è¡Œä¸€äº›çº¦å®šï¼Œæ¯”å¦‚åº”ç”¨Javaæ’ä»¶ä¹‹åï¼Œçº¦å®š<code>src/main/java</code>ç›®å½•ä¸‹ä½¿æˆ‘ä»¬æºä»£ç å­˜æ”¾ä½ç½®ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™ä¹Ÿæ˜¯ç¼–è¯‘è¿™ä¸ªç›®å½•ä¸‹çš„javaæºä»£ç æ–‡ä»¶</li></ol><span id="more"></span><h4 id="å¦‚ä½•åº”ç”¨ä¸€ä¸ªæ’ä»¶"><a href="#å¦‚ä½•åº”ç”¨ä¸€ä¸ªæ’ä»¶" class="headerlink" title="å¦‚ä½•åº”ç”¨ä¸€ä¸ªæ’ä»¶"></a>å¦‚ä½•åº”ç”¨ä¸€ä¸ªæ’ä»¶</h4><p>æ’ä»¶çš„åº”ç”¨éƒ½æ˜¯é€šè¿‡<code>Project.apply()</code>æ–¹æ³•å®Œæˆçš„ï¼Œapplyæœ‰å¥½å‡ ç§ç”¨æ³•ï¼Œå¹¶ä¸”æ’ä»¶ä¹Ÿæ°›å›´äºŒè¿›åˆ¶æ’ä»¶å’Œè„šæœ¬æ’ä»¶</p><h5 id="åº”ç”¨äºŒè¿›åˆ¶æ’ä»¶"><a href="#åº”ç”¨äºŒè¿›åˆ¶æ’ä»¶" class="headerlink" title="åº”ç”¨äºŒè¿›åˆ¶æ’ä»¶"></a>åº”ç”¨äºŒè¿›åˆ¶æ’ä»¶</h5><p>äºŒè¿›åˆ¶æ’ä»¶å°±æ˜¯å®ç°äº†<code>org.gradle.api.Plugin</code>æ¥å£çš„æ’ä»¶ï¼Œä»–ä»¬å¯ä»¥æœ‰<code>plugin id</code>ï¼Œä¸‹é¢ä»‹ç»å¦‚ä½•åº”ç”¨ä¸€ä¸ªJavaæ’ä»¶</p><blockquote><p>apply plugin:â€™javaâ€™</p></blockquote><p>ä¸Šé¢çš„è¯­å¥æŠŠJavaæ’ä»¶åº”ç”¨åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­äº†ï¼Œå…¶ä¸­<code>java</code>æ˜¯Javaæ’ä»¶çš„plugin idï¼Œå®ƒæ˜¯å”¯ä¸€çš„ã€‚å¯¹äºGradleè‡ªå¸¦çš„æ ¸å¿ƒæ’ä»¶éƒ½æœ‰ä¸€ä¸ªå®¹æ˜“è®°ä½çš„çŸ­åï¼Œç§°å…¶ä¸ºplugin id,æ¯”å¦‚è¿™é‡Œçš„javaï¼Œå…¶å®å®ƒå¯¹åº”çš„ç±»å‹æ˜¯<code>org.gradle.api.plugins.JavaPlugin</code>ï¼Œæ‰€ä»¥é€šè¿‡è¯¥ç±»å‹æˆ‘ä»¬ä¹Ÿå¯ä»¥åº”ç”¨è¿™ä¸ªæ’ä»¶</p><blockquote><p>apply plugin: org.gradle.api.plugins.JavaPlugin</p></blockquote><p>åˆå› ä¸ºåŒ…<code>org.gradle.api.plugins</code>æ˜¯é»˜è®¤å¯¼å…¥çš„ï¼Œæ‰€ä»¥å¯ä»¥å»æ‰åŒ…åç›´æ¥å†™ä¸ºï¼š</p><blockquote><p>apply plugin:JavaPlugin</p></blockquote><p>ä»¥ä¸Šä¸‰ç§å†™æ³•æ˜¯ç­‰ä»·çš„ï¼Œç¬¬äºŒç§å†™æ³•ä¸€èˆ¬é€‚ç”¨äºæˆ‘ä»¬åœ¨buildæ–‡ä»¶ä¸­è‡ªå®šä¹‰çš„æ’ä»¶ï¼Œä¹Ÿå°±æ˜¯è„šæœ¬æ’ä»¶ã€‚</p><h5 id="åº”ç”¨è„šæœ¬æ’ä»¶"><a href="#åº”ç”¨è„šæœ¬æ’ä»¶" class="headerlink" title="åº”ç”¨è„šæœ¬æ’ä»¶"></a>åº”ç”¨è„šæœ¬æ’ä»¶</h5><p>build.gradle</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs groovy">apply <span class="hljs-attr">from :</span><span class="hljs-string">&#x27;version.gradle&#x27;</span><br>task test&lt;&lt;&#123;<br>    println <span class="hljs-string">&quot;appç‰ˆæœ¬æ˜¯$&#123;versionName&#125;,ç‰ˆæœ¬å·æ˜¯$&#123;versionCode&#125;&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>version.gradle</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs :jack_o_lantern:">ext&#123;<br>    versionName=&quot;1.0.0&quot;<br>    versionCode=1<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶å®è¿™ä¸èƒ½ç®—æ˜¯ä¸€ä¸ªæ’ä»¶å®ƒåªæ˜¯ä¸€ä¸ªè„šæœ¬ï¼Œåº”ç”¨è„šæœ¬æ’ä»¶ï¼Œå…¶å®å°±æ˜¯æŠŠè¿™ä¸ªè„šæœ¬åŠ è½½è¿›æ¥ï¼Œå’ŒäºŒè¿›åˆ¶æ’ä»¶ä¸åŒçš„æ˜¯å®ƒä½¿ç”¨<code>from</code>å…³é”®å­—,åé¢ç´§è·Ÿçš„æ˜¯ä¸€ä¸ªè„šæœ¬æ–‡ä»¶ï¼Œå¯ä»¥ä½¿æœ¬åœ°çš„ï¼Œä¹Ÿå¯ä»¥ä½¿ç½‘ç»œå­˜åœ¨çš„ï¼Œå¦‚æœæ˜¯ç½‘ç»œä¸Šçš„è¯è¦ä½¿ç”¨http url</p><h5 id="applyæ–¹æ³•çš„å…¶ä»–ç”¨æ³•"><a href="#applyæ–¹æ³•çš„å…¶ä»–ç”¨æ³•" class="headerlink" title="applyæ–¹æ³•çš„å…¶ä»–ç”¨æ³•"></a>applyæ–¹æ³•çš„å…¶ä»–ç”¨æ³•</h5><p>Project.apply()æ–¹æ³•æœ‰3ä¸­ä½¿ç”¨æ–¹å¼ï¼Œå®ƒä»¬åªæ˜¯æ¥å—çš„å‚æ•°ä¸åŒï¼Œä¸Šé¢ä½¿ç”¨çš„æ˜¯æ¥å—ä¸€ä¸ªMapç±»å‹å‚æ•°çš„å½¢å¼ï¼Œä¸‹é¢æ˜¯å…¶ä»–ä¸¤ç§æ–¹å¼</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-type">void</span> apply(Map&lt;String,?&gt; options);<br>void apply(Closure closure);<br>void apply(Action&lt;? super ObjectConfigurationAction&gt; action)<br></code></pre></td></tr></table></figure><p>é—­åŒ…çš„æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs groovy">apply&#123;<br>    plugin <span class="hljs-string">&#x27;java&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¯¥é—­åŒ…è¢«ç”¨æ¥é…ç½®ä¸€ä¸ª<code>ObjectConfigurationAction</code>å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥åœ¨æ¯”æš´åŠ›ä½¿ç”¨ObjectConfigurationActionå¯¹è±¡çš„æ–¹æ³•ã€å±æ€§ç­‰è¿›è¡Œé…ç½®ã€‚</p><p>Actionçš„æ–¹å¼</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs groovy">apply(<span class="hljs-keyword">new</span> Action&lt;ObjectConfigurationAction&gt;()&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-type">void</span> execute(ObjectConfigurationAction objectConfigurationAction)&#123;<br>        objectConfigurationAction.plugin(<span class="hljs-string">&#x27;java&#x27;</span>)<br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><p>Actionçš„æ–¹å¼éœ€è¦newä¸€ä¸ªActionï¼Œç„¶ååœ¨executeæ–¹æ³•é‡Œè¿›è¡Œé…ç½®</p><h5 id="åº”ç”¨ç¬¬ä¸‰æ–¹å‘å¸ƒçš„æ’ä»¶"><a href="#åº”ç”¨ç¬¬ä¸‰æ–¹å‘å¸ƒçš„æ’ä»¶" class="headerlink" title="åº”ç”¨ç¬¬ä¸‰æ–¹å‘å¸ƒçš„æ’ä»¶"></a>åº”ç”¨ç¬¬ä¸‰æ–¹å‘å¸ƒçš„æ’ä»¶</h5><p>åœ¨ä½¿ç”¨ç¬¬ä¸‰æ–¹å‘å¸ƒçš„æ’ä»¶çš„æ—¶å€™ï¼Œå¿…é¡»è¦åœ¨buildscript{}é‡Œé…ç½®å…¶classpathæ‰èƒ½ä½¿ç”¨ï¼Œæ¯”å¦‚åœ¨ä½¿ç”¨Android Gradleæ’ä»¶ï¼Œå°±å±äºAndroidå‘å¸ƒçš„ç¬¬ä¸‰æ–¹æ’ä»¶ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs groovy">buildscript&#123;<br>    repositories&#123;<br>        jcenter()<br>    &#125;<br>    dependencies&#123;<br>        classpath <span class="hljs-string">&#x27;com.android.application&#x27;</span><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>buildscript{}å—æ˜¯ä¸€ä¸ªåœ¨æ„å»ºé¡¹ç›®ä¹‹å‰ï¼Œä¸ºé¡¹ç›®è¿›è¡Œå‰æœŸå‡†å¤‡å’Œåˆå§‹åŒ–ç›¸å…³é…ç½®ä¾èµ–çš„åœ°æ–¹ï¼Œé…ç½®å¥½æ‰€éœ€çš„ä¾èµ–ï¼Œå°±å¯ä»¥åº”ç”¨æ’ä»¶äº†ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">apply <span class="hljs-attr">plugin :</span><span class="hljs-string">&#x27;com.android.application&#x27;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰æå‰åœ¨buildscripté‡Œé…ç½®ä¾èµ–çš„classpathï¼Œä¼šæç¤ºæ‰¾ä¸åˆ°è¿™ä¸ªæ’ä»¶</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Gradle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gradleä»»åŠ¡</title>
    <link href="/2018/11/19/gradle%E4%BB%BB%E5%8A%A1/"/>
    <url>/2018/11/19/gradle%E4%BB%BB%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<p>å‚è€ƒã€ŠAndroid Gradle æƒå¨æŒ‡å—ã€‹ç¬¬å››ç« Gradleä»»åŠ¡ï¼Œä¸»è¦ä»‹ç»ä»»åŠ¡çš„åˆ›å»ºæ–¹å¼ã€è®¿é—®ä»»åŠ¡ã€ä»»åŠ¡åˆ†ç»„å’Œæè¿°ã€&lt;&lt;æ“ä½œç¬¦ã€ä»»åŠ¡çš„æ‰§è¡Œåˆ†æã€ä»»åŠ¡æ’åºã€å¯ç”¨å’Œç¦ç”¨ã€æ–­è¨€ã€è§„åˆ™ç­‰ã€‚</p><span id="more"></span><h4 id="ä»»åŠ¡çš„åˆ›å»ºæ–¹å¼"><a href="#ä»»åŠ¡çš„åˆ›å»ºæ–¹å¼" class="headerlink" title="ä»»åŠ¡çš„åˆ›å»ºæ–¹å¼"></a>ä»»åŠ¡çš„åˆ›å»ºæ–¹å¼</h4><h5 id="ç›´æ¥ä»¥ä»»åŠ¡åçš„æ–¹å¼åˆ›å»º"><a href="#ç›´æ¥ä»¥ä»»åŠ¡åçš„æ–¹å¼åˆ›å»º" class="headerlink" title="ç›´æ¥ä»¥ä»»åŠ¡åçš„æ–¹å¼åˆ›å»º"></a>ç›´æ¥ä»¥ä»»åŠ¡åçš„æ–¹å¼åˆ›å»º</h5><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> Task temp = task(createTaskByName)<br>temp.doLast &#123;<br>    println <span class="hljs-string">&quot;åŸå‹ä¸º Task task(String name) throws InvalidUserDataException&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­çš„<code>createTaskByName</code>å°±æ˜¯æˆ‘ä»¬åˆ›å»ºçš„ä»»åŠ¡ï¼Œå¯ä»¥é€šè¿‡<code>gradle -q createTaskByName</code>æ¥æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ã€‚è¿™ç§åˆ›å»ºæ–¹å¼æœ¬è´¨å°±ä¸Šå°±æ˜¯è°ƒç”¨<code>Project</code>çš„<code>task(String name)</code>æ–¹æ³•æ¥åˆ›å»ºä»»åŠ¡ï¼Œç„¶åå°†<code>Task</code>ç±»å‹çš„è¿”å›å€¼èµ‹å€¼ç»™æˆ‘ä»¬å®šä¹‰çš„tempå˜é‡ï¼Œæœ€åé€šè¿‡<code>doLast</code>æ–¹å¼æ¥é…ç½®ä»»åŠ¡ã€‚</p><h5 id="ä»»åŠ¡åå­—-ä»»åŠ¡é…ç½®çš„Mapå¯¹è±¡"><a href="#ä»»åŠ¡åå­—-ä»»åŠ¡é…ç½®çš„Mapå¯¹è±¡" class="headerlink" title="ä»»åŠ¡åå­—+ä»»åŠ¡é…ç½®çš„Mapå¯¹è±¡"></a>ä»»åŠ¡åå­—+ä»»åŠ¡é…ç½®çš„Mapå¯¹è±¡</h5><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> Task temp = task(createTaskByName,<span class="hljs-attr">group:</span> <span class="hljs-string">&#x27;custom&#x27;</span>)<br>temp.doLast &#123;<br>    println <span class="hljs-string">&quot;åŸå‹ä¸º Task task(String name) throws InvalidUserDataException&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å’Œç¬¬ä¸€ç§æ–¹å¼å¤§åŒå°å¼‚ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ªMapå‚æ•°ç”¨ä»¥å¯¹taskè¿›è¡Œé…ç½®ï¼Œæ¯”å¦‚ä¸Šé¢çš„ä»£ç æŒ‡å®šäº†è¯¥taskæ‰€å±çš„groupï¼Œå½“æˆ‘ä»¬åœ¨æ‰§è¡Œ <code>gradle -q tasks --all</code>å°±å¯ä»¥åœ¨å¯¹åº”çš„groupä¸­æ‰¾åˆ°è¯¥ä»»åŠ¡ã€‚ä¸‹é¢åˆ—å‡ºçš„æ˜¯å¯ç”¨é…ç½®ï¼š</p><table><thead><tr><th align="center">é…ç½®é¡¹</th><th align="center">æè¿°</th><th align="center">é»˜è®¤å€¼</th></tr></thead><tbody><tr><td align="center">type</td><td align="center">åŸºäºä¸€ä¸ªå­˜åœ¨çš„Taskæ¥åˆ›å»ºï¼Œç±»ä¼¼ç»§æ‰¿</td><td align="center">DefaultTask</td></tr><tr><td align="center">overwirte</td><td align="center">æ˜¯å¦æ›¿æ¢å­˜åœ¨çš„Taskï¼Œå¯ä»¥å’Œtypeé…åˆä½¿ç”¨</td><td align="center">false</td></tr><tr><td align="center">dependsOn</td><td align="center">ç”¨äºé…ç½®ä»»åŠ¡ä¾èµ–</td><td align="center">[]</td></tr><tr><td align="center">action</td><td align="center">æ·»åŠ åˆ°ä»»åŠ¡ä¸­çš„ä¸€ä¸ªactionæˆ–è€…ä¸€ä¸ªé—­åŒ…</td><td align="center">null</td></tr><tr><td align="center">description</td><td align="center">ä»»åŠ¡æè¿°</td><td align="center">null</td></tr><tr><td align="center">group</td><td align="center">ä»»åŠ¡åˆ†ç»„</td><td align="center">null</td></tr></tbody></table><h5 id="ä»»åŠ¡åå­—-é—­åŒ…å½¢å¼"><a href="#ä»»åŠ¡åå­—-é—­åŒ…å½¢å¼" class="headerlink" title="ä»»åŠ¡åå­—+é—­åŒ…å½¢å¼"></a>ä»»åŠ¡åå­—+é—­åŒ…å½¢å¼</h5><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs groovy">task temp &#123;<br>    description <span class="hljs-string">&quot;è¿™æ˜¯ä»»åŠ¡åå­—+é—­åŒ…å½¢å¼åˆ›å»ºä»»åŠ¡&quot;</span><br>    doLast &#123;<br>    println <span class="hljs-string">&quot;é€šè¿‡ä»»åŠ¡åå­—+é—­åŒ…å½¢å¼åˆ›å»ºä»»åŠ¡&quot;</span><br>    println <span class="hljs-string">&quot;$&#123;description&#125;&quot;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å› ä¸ºMapçš„æ–¹å¼æ‰€èƒ½é…ç½®çš„ä¿¡æ¯æœ‰é™ï¼Œæ‰€ä»¥å¸¸è§çš„åˆ›å»ºä»»åŠ¡æ˜¯å·²è¿™ç§æ–¹å¼è¿›è¡Œï¼Œæˆ–è€…è°ƒç”¨tasks.createæ–¹æ³•ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs groovy">tasks.create(<span class="hljs-string">&#x27;temp&#x27;</span>)&#123;<br>description <span class="hljs-string">&quot;è¿™æ˜¯ä»»åŠ¡åå­—+é—­åŒ…å½¢å¼åˆ›å»ºä»»åŠ¡&quot;</span><br>    doLast &#123;<br>    println <span class="hljs-string">&quot;é€šè¿‡ä»»åŠ¡åå­—+é—­åŒ…å½¢å¼åˆ›å»ºä»»åŠ¡&quot;</span><br>    println <span class="hljs-string">&quot;$&#123;description&#125;&quot;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="è®¿é—®ä»»åŠ¡"><a href="#è®¿é—®ä»»åŠ¡" class="headerlink" title="è®¿é—®ä»»åŠ¡"></a>è®¿é—®ä»»åŠ¡</h4><ol><li>é€šè¿‡ä»»åŠ¡åå­—è®¿é—®</li></ol><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy">task temp&#123;&#125;<br><span class="hljs-comment">//ç¬¬ä¸€ç§æ–¹å¼</span><br>temp.doLast&#123;&#125;<br><span class="hljs-comment">//ç¬¬äºŒç§æ–¹å¼</span><br>tasks[<span class="hljs-string">&#x27;temp&#x27;</span>].doLast&#123;&#125;<br></code></pre></td></tr></table></figure><p>è®¿é—®çš„æ—¶å€™ï¼Œä»»åŠ¡åå°±æ˜¯key,è¿™é‡Œè¯´æ³•æœ‰ç‚¹ä¸æ°å½“ï¼Œå› ä¸ºtaskså¹¶ä¸æ˜¯ä¸€ä¸ªmapï¼Œ<code>[]</code>åœ¨groovyä¸­æ˜¯ä¸€ä¸ªæ“ä½œç¬¦ï¼Œåœ¨groovyä¸­çš„æ“ä½œç¬¦éƒ½æœ‰å¯¹åº”çš„æ–¹æ³•è®©æˆ‘ä»¬é‡è½½ï¼Œ<code>a[b]</code>å¯¹åº”çš„æ˜¯<code>a.getAt(b)</code>è¿™ä¸ªæ–¹æ³•ï¼Œå¯¹åº”ä¸Šé¢çš„ä»£ç <code>tasks[&#39;temp&#39;]</code>å…¶å®æ˜¯è°ƒç”¨çš„<code>tasks.getAt(&#39;temp&#39;)</code>è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨<code>gradle</code>æºç ä¸­ï¼Œå‘ç°è°ƒç”¨çš„æ˜¯<code>findByName(String name)</code>å®ç°çš„ã€‚</p><p>ç„¶åå°±æ˜¯é€šè¿‡è·¯å¾„è®¿é—®ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯<code>get</code>ï¼Œä¸€ç§æ˜¯<code>find</code>ï¼ŒåŒºåˆ«åœ¨äºä½¿ç”¨<code>get</code>çš„æ—¶å€™å¦‚æœæ‰¾ä¸åˆ°è¯¥ä»»åŠ¡å°±æ˜¯æŠ›å‡º<code>UnknownTaskException</code>ï¼Œè€Œfindåˆ™ä¼šè¿”å›<code>null</code>.</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy">task temp<br>tasks[<span class="hljs-string">&#x27;temp&#x27;</span>].doLast&#123;<br>    println tasks.findByPath(<span class="hljs-string">&#x27;temp&#x27;</span>)<br>    println tasks.getByPath(<span class="hljs-string">&#x27;temp&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€åå°±æ˜¯é€šè¿‡åç§°è®¿é—®ï¼Œæ–¹å¼ã€åŒºåˆ«å’Œä¸Šé¢é€šè¿‡è·¯å¾„è®¿é—®æ˜¯ä¸€æ ·çš„ã€‚</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy">task temp<br>tasks[<span class="hljs-string">&#x27;temp&#x27;</span>].doLast&#123;<br>    println tasks.findByName(<span class="hljs-string">&#x27;temp&#x27;</span>)<br>    println tasks.getByName(<span class="hljs-string">&#x27;temp&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé€šè¿‡è·¯å¾„è®¿é—®çš„æ—¶å€™ï¼Œå‚æ•°å€¼å¯ä»¥æ˜¯è·¯å¾„å€¼ä¹Ÿå¯ä»¥æ˜¯ä»»åŠ¡åå­—,ä½†æ˜¯é€šè¿‡åå­—è®¿é—®çš„æ—¶å€™ï¼Œå‚æ•°å€¼åªèƒ½æ˜¯ä»»åŠ¡çš„åå­—ï¼Œä¸èƒ½ä¸ºè·¯å¾„ã€‚</p><h4 id="lt-lt-æ“ä½œç¬¦"><a href="#lt-lt-æ“ä½œç¬¦" class="headerlink" title="&lt;&lt;æ“ä½œç¬¦"></a>&lt;&lt;æ“ä½œç¬¦</h4><p><code>&lt;&lt;</code>æ“ä½œç¬¦åœ¨Gradleçš„Taskä¸Šæ˜¯doLastæ–¹æ³•çš„çŸ­æ ‡è®°å½¢å¼ã€‚</p><p><code>&lt;&lt;</code>æ˜¯æ“ä½œç¬¦ï¼Œåœ¨Groovyä¸­æ˜¯å¯ä»¥é‡è½½çš„ï¼Œ<code>a&lt;&lt;b</code>å¯¹åº”çš„æ˜¯<code>a.leftShift(b)</code>æ–¹æ³•ï¼Œæ‰€ä»¥Taskæ¥å£ä¸­è‚¯å®šæœ‰åŒä¸€ä¸ªleftShiftæ–¹æ³•é‡è½½çš„<code>&lt;&lt;</code>ï¼Œåœ¨Gradleæºç ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">Task.java<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * &lt;p&gt;Adds the given closure to the end of this task&#x27;s action list.  The closure is passed this task as a parameter</span><br><span class="hljs-comment">     * when executed. You can call this method from your build script using the &amp;lt;&amp;lt; left shift operator.&lt;/p&gt;</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> action The action closure to execute.</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> This task.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@deprecated</span> Use &#123;<span class="hljs-doctag">@link</span> #doLast(Closure action)&#125;</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Deprecated</span><br>    Task <span class="hljs-title function_">leftShift</span><span class="hljs-params">(Closure action)</span>;<br></code></pre></td></tr></table></figure><p>leftShiftæ–¹æ³•å’ŒdoLastæ–¹æ³•å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> Task <span class="hljs-title function_">leftShift</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Closure action)</span> &#123;<br>       DeprecationLogger.nagUserOfDiscontinuedMethod(<span class="hljs-string">&quot;Task.leftShift(Closure)&quot;</span>, <span class="hljs-string">&quot;Please use Task.doLast(Action) instead.&quot;</span>);<br><br>       hasCustomActions = <span class="hljs-literal">true</span>;<br>       <span class="hljs-keyword">if</span> (action == <span class="hljs-literal">null</span>) &#123;<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvalidUserDataException</span>(<span class="hljs-string">&quot;Action must not be null!&quot;</span>);<br>       &#125;<br>       taskMutator.mutate(<span class="hljs-string">&quot;Task.leftShift(Closure)&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>           <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>               getTaskActions().add(taskMutator.leftShift(convertClosureToAction(action, <span class="hljs-string">&quot;doLast &#123;&#125; action&quot;</span>)));<br>           &#125;<br>       &#125;);<br>       <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>   &#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Task <span class="hljs-title function_">doLast</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Closure action)</span> &#123;<br>        hasCustomActions = <span class="hljs-literal">true</span>;<br>        <span class="hljs-keyword">if</span> (action == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvalidUserDataException</span>(<span class="hljs-string">&quot;Action must not be null!&quot;</span>);<br>        &#125;<br>        taskMutator.mutate(<span class="hljs-string">&quot;Task.doLast(Closure)&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                getTaskActions().add(convertClosureToAction(action, <span class="hljs-string">&quot;doLast &#123;&#125; action&quot;</span>));<br>            &#125;<br>        &#125;);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><h4 id="ä»»åŠ¡æ‰§è¡Œåˆ†æ"><a href="#ä»»åŠ¡æ‰§è¡Œåˆ†æ" class="headerlink" title="ä»»åŠ¡æ‰§è¡Œåˆ†æ"></a>ä»»åŠ¡æ‰§è¡Œåˆ†æ</h4><p>å½“æˆ‘ä»¬åœ¨æ‰§è¡Œä¸€ä¸ªTaskçš„æ—¶å€™ï¼Œå…¶å®å°±æ˜¯æ‰§è¡Œå…¶æ‹¥æœ‰çš„actionsåˆ—è¡¨ï¼Œè¿™ä¸ªåˆ—è¡¨ä¿å­˜åœ¨Taskå¯¹è±¡å®ä¾‹ä¸­çš„actionsæˆå‘˜å˜é‡ä¸­ï¼Œåœ¨<code>AbstractTask</code>ç±»ä¸­æœ‰è¿™ä¹ˆä¸€ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> List&lt;ContextAwareTaskAction&gt; <span class="hljs-title function_">getTaskActions</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-keyword">if</span> (actions == <span class="hljs-literal">null</span>) &#123;<br>           actions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;ContextAwareTaskAction&gt;(<span class="hljs-number">3</span>);<br>       &#125;<br>       <span class="hljs-keyword">return</span> actions;<br>   &#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å†™ä¸ªdemoæ¥çœ‹ä¸€ä¸‹actionsæ€ä¹ˆå·¥ä½œçš„</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs groovy">Task myTask = task test(<span class="hljs-attr">type :</span> CustomTask)<br><br>myTask.doFirst &#123;<br>    println <span class="hljs-string">&quot;doFirst&quot;</span><br>&#125;<br><br>myTask.doLast &#123;<br>    println <span class="hljs-string">&quot;doLast&quot;</span><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DefaultTask</span>&#123;<br><br>    <span class="hljs-meta">@TaskAction</span><br>    <span class="hljs-keyword">def</span> doSelf()&#123;<br>        println <span class="hljs-string">&quot;æ‰§è¡ŒdoSelf&quot;</span><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç å®šä¹‰äº†ä¸€ä¸ªTaskç±»å‹çš„CustomTaskï¼Œå¹¶ä¸”å£°æ˜äº†ä¸€ä¸ªè¢«<code>TaskAction</code>æ³¨è§£æ ‡å‡†çš„<code>doSelf</code>æ–¹æ³•ã€‚æ„æ€æ˜¯è¯¥æ–¹æ³•å°±æ˜¯Taskæœ¬èº«æ‰§è¡Œçš„æ–¹æ³•ï¼Œæ‰§è¡Œ<code>test</code>ä»»åŠ¡ï¼Œå¾—åˆ°è¾“å‡º</p><blockquote><p>doFirst<br>æ‰§è¡ŒdoSelf<br>doLast</p></blockquote><p>æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹å…·ä½“æºç æ€ä¹ˆå†™çš„</p><p>å½“æˆ‘ä»¬ä½¿ç”¨Taskæ–¹æ³•åˆ›å»ºä¸€ä¸ªtaskçš„æ—¶å€™ï¼ŒGradleä¼šè§£æå…¶å¸¦æœ‰TaskActionæ ‡æ³¨çš„æ–¹æ³•ä½œä¸ºå…¶Taskæ‰§è¡Œçš„Actionï¼Œç„¶åé€šè¿‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prependParallelSafeAction</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Action&lt;? <span class="hljs-built_in">super</span> Task&gt; action)</span> &#123;<br>       <span class="hljs-keyword">if</span> (action == <span class="hljs-literal">null</span>) &#123;<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvalidUserDataException</span>(<span class="hljs-string">&quot;Action must not be null!&quot;</span>);<br>       &#125;<br>       getTaskActions().add(<span class="hljs-number">0</span>, wrap(action));<br>   &#125;<br></code></pre></td></tr></table></figure><p>æ·»åŠ åˆ°actions listé‡Œé¢ã€‚è¿™æ—¶å€™Taskåˆšè¢«åˆ›å»ºï¼Œæ‰€ä»¥ä¸ä¼šæœ‰å…¶ä»–çš„actionã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Task <span class="hljs-title function_">doFirst</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Action&lt;? <span class="hljs-built_in">super</span> Task&gt; action)</span> &#123;<br>        <span class="hljs-keyword">return</span> doFirst(<span class="hljs-string">&quot;doFirst &#123;&#125; action&quot;</span>, action);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Task <span class="hljs-title function_">doFirst</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String actionName, <span class="hljs-keyword">final</span> Action&lt;? <span class="hljs-built_in">super</span> Task&gt; action)</span> &#123;<br>        hasCustomActions = <span class="hljs-literal">true</span>;<br>        <span class="hljs-keyword">if</span> (action == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvalidUserDataException</span>(<span class="hljs-string">&quot;Action must not be null!&quot;</span>);<br>        &#125;<br>        taskMutator.mutate(<span class="hljs-string">&quot;Task.doFirst(Action)&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                getTaskActions().add(<span class="hljs-number">0</span>, wrap(action, actionName));<br>            &#125;<br>        &#125;);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Task <span class="hljs-title function_">doLast</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Action&lt;? <span class="hljs-built_in">super</span> Task&gt; action)</span> &#123;<br>        <span class="hljs-keyword">return</span> doLast(<span class="hljs-string">&quot;doLast &#123;&#125; action&quot;</span>, action);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Task <span class="hljs-title function_">doLast</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String actionName, <span class="hljs-keyword">final</span> Action&lt;? <span class="hljs-built_in">super</span> Task&gt; action)</span> &#123;<br>        hasCustomActions = <span class="hljs-literal">true</span>;<br>        <span class="hljs-keyword">if</span> (action == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvalidUserDataException</span>(<span class="hljs-string">&quot;Action must not be null!&quot;</span>);<br>        &#125;<br>        taskMutator.mutate(<span class="hljs-string">&quot;Task.doLast(Action)&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                getTaskActions().add(wrap(action, actionName));<br>            &#125;<br>        &#125;);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼ŒdoFirstæ¯æ¬¡éƒ½æ·»åŠ åˆ°listçš„æœ€å‰é¢ï¼ŒdoLastæ¯æ¬¡éƒ½æ·»åŠ åˆ°æœ€åé¢ã€‚æœ€åè¿™ä¸ªactions listå°±æŒ‰ç…§é¡ºåºå½¢æˆäº†doFirstã€doSelfã€doLastä¸‰éƒ¨åˆ†çš„Actionsã€‚</p><h4 id="ä»»åŠ¡æ’åº"><a href="#ä»»åŠ¡æ’åº" class="headerlink" title="ä»»åŠ¡æ’åº"></a>ä»»åŠ¡æ’åº</h4><p>è¿™ä¸ªå¹¶æ²¡æœ‰çœŸæ­£å®ç°æ’åºåŠŸèƒ½ï¼Œè€Œæ˜¯é€šè¿‡<code>shouldRunAfter</code>å’Œ<code>mustRunAfter</code>è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œä»–ä»¬å¯ä»¥æ§åˆ¶ä¸€ä¸ªä»»åŠ¡åº”è¯¥æˆ–è€…ä¸€å®šåœ¨æŸä¸ªä»»åŠ¡ä¹‹åæ‰§è¡Œã€‚</p><p><code>taskB.mustRunAfter(taskA)</code>è¡¨ç¤º<code>taskB</code>å¿…é¡»åœ¨<code>taskA</code>æ‰§è¡Œä¹‹åæ‰§è¡Œï¼Œè¿™ä¸ªè§„åˆ™æ¯”è¾ƒä¸¥æ ¼</p><h4 id="ä»»åŠ¡çš„å¯ç”¨å’Œç¦ç”¨"><a href="#ä»»åŠ¡çš„å¯ç”¨å’Œç¦ç”¨" class="headerlink" title="ä»»åŠ¡çš„å¯ç”¨å’Œç¦ç”¨"></a>ä»»åŠ¡çš„å¯ç”¨å’Œç¦ç”¨</h4><p>Taskä¸­æœ‰ä¸ª<code>enable</code>å±æ€§ï¼Œç”¨äºå¯ç”¨å’Œç¦ç”¨ä»»åŠ¡ï¼Œé»˜è®¤æ˜¯<code>true</code>ï¼Œè¡¨ç¤ºå¯ç”¨ï¼Œè®¾ç½®ä¸º<code>false</code>ï¼Œåˆ™ç¦æ­¢è¯¥ä»»åŠ¡æ‰§è¡Œï¼Œè¾“å‡ºä¼šæç¤ºè¯¥ä»»åŠ¡è¢«è·³è¿‡ã€‚</p><h4 id="ä»»åŠ¡çš„onlyIfæ–­è¨€"><a href="#ä»»åŠ¡çš„onlyIfæ–­è¨€" class="headerlink" title="ä»»åŠ¡çš„onlyIfæ–­è¨€"></a>ä»»åŠ¡çš„onlyIfæ–­è¨€</h4><p>æ–­è¨€å°±æ˜¯ä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼ï¼ŒTaskæœ‰ä¸€ä¸ª<code>onlyIf</code>æ–¹æ³•ï¼Œå®ƒæ¥å—ä¸€ä¸ªé—­åŒ…ä½œä¸ºå‚æ•°ï¼Œå¦‚æœè¯¥é—­åŒ…è¿”å›trueåˆ™æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œå¦åˆ™è·³è¿‡ã€‚</p><p>å‡å¦‚æˆ‘ä»¬é¦–å‘æ¸ é“æ˜¯åº”ç”¨å®ï¼Œç›´æ¥buildä¼šç¼–è¯‘å‡ºæ¥æ‰€æœ‰åŒ…ï¼Œç°åœ¨æˆ‘ä»¬å°±é‡‡ç”¨onlyIfçš„æ–¹å¼é€šè¿‡å±æ€§æ¥æ§åˆ¶ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">final</span> String BUILD_APP_ALL = <span class="hljs-string">&quot;all&quot;</span>;<br><span class="hljs-keyword">final</span> String BUILD_APP_SHOUFA = <span class="hljs-string">&quot;shoufa&quot;</span>;<br><span class="hljs-keyword">final</span> String BUILD_APP_EXCLUDE_SHOUFA=<span class="hljs-string">&quot;exclude_shoufa&quot;</span>;<br><br>task qqRelease &lt;&lt;&#123;<br>    println <span class="hljs-string">&quot;åº”ç”¨å®&quot;</span><br>&#125;<br><br>task baiduRelease &lt;&lt;&#123;<br>    println <span class="hljs-string">&quot;ç™¾åº¦&quot;</span><br>&#125;<br><br>task huaweiRelease &lt;&lt;&#123;<br>    println <span class="hljs-string">&quot;åä¸º&quot;</span><br>&#125;<br><br>task miuiRelease &lt;&lt;&#123;<br>    println <span class="hljs-string">&quot;å°ç±³&quot;</span><br>&#125;<br><br>task test &lt;&lt;&#123;<br>    group BasePlugin.BUILD_GROUP<br>    description <span class="hljs-string">&quot;æ‰“æ¸ é“åŒ…&quot;</span><br>&#125;<br><br>test.dependsOn qqRelease,baiduRelease,huaweiRelease,miuiRelease<br><br>qqRelease.onlyIf &#123;<br>    <span class="hljs-keyword">def</span> execute = <span class="hljs-literal">false</span>;<br><br>    <span class="hljs-keyword">if</span>(project.hasProperty(<span class="hljs-string">&quot;build_apps&quot;</span>))&#123;<br>        Object buildApp = project.property(<span class="hljs-string">&quot;build_apps&quot;</span>)<br>        <span class="hljs-keyword">if</span>(BUILD_APP_SHOUFA.equals(buildApp) || BUILD_APP_ALL.equals(buildApp))&#123;<br>            execute = <span class="hljs-literal">true</span><br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            execute = <span class="hljs-literal">false</span><br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        execute = <span class="hljs-literal">true</span><br>    &#125;<br>    execute<br>&#125;<br><br>baiduRelease.onlyIf &#123;<br>    <span class="hljs-keyword">def</span> execute = <span class="hljs-literal">false</span>;<br>    <br>    <span class="hljs-keyword">if</span>(project.hasProperty(<span class="hljs-string">&quot;build_apps&quot;</span>))&#123;<br><br>        String buildApp = project.property(<span class="hljs-string">&quot;build_apps&quot;</span>)<br>        <span class="hljs-keyword">if</span>(BUILD_APP_SHOUFA.equals(buildApp) || BUILD_APP_ALL.equals(buildApp))&#123;<br>            execute = <span class="hljs-literal">true</span><br>            <br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            execute = <span class="hljs-literal">false</span><br>            <br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        execute = <span class="hljs-literal">true</span><br>        <br>    &#125;<br>    execute<br><br>&#125;<br><br>huaweiRelease.onlyIf &#123;<br>    <span class="hljs-keyword">def</span> execute = <span class="hljs-literal">false</span>;<br><br>    <span class="hljs-keyword">if</span>(project.hasProperty(<span class="hljs-string">&quot;build_apps&quot;</span>))&#123;<br>        Object buildApp = project.property(<span class="hljs-string">&quot;build_apps&quot;</span>)<br>        <span class="hljs-keyword">if</span>(BUILD_APP_EXCLUDE_SHOUFA.equals(buildApp) || BUILD_APP_ALL.equals(buildApp))&#123;<br>            execute = <span class="hljs-literal">true</span><br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            execute = <span class="hljs-literal">false</span><br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        execute = <span class="hljs-literal">true</span><br>    &#125;<br>    execute<br>&#125;<br><br>miuiRelease.onlyIf &#123;<br>    <span class="hljs-keyword">def</span> execute = <span class="hljs-literal">false</span>;<br><br>    <span class="hljs-keyword">if</span>(project.hasProperty(<span class="hljs-string">&quot;build_apps&quot;</span>))&#123;<br>        Object buildApp = project.property(<span class="hljs-string">&quot;build_apps&quot;</span>)<br>        <span class="hljs-keyword">if</span>(BUILD_APP_EXCLUDE_SHOUFA.equals(buildApp) || BUILD_APP_ALL.equals(buildApp))&#123;<br>            execute = <span class="hljs-literal">true</span><br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            execute = <span class="hljs-literal">false</span><br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        execute = <span class="hljs-literal">true</span><br>    &#125;<br>    execute<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢å®šä¹‰äº†4ä¸ªæ¸ é“ï¼Œå…¶ä¸­ç™¾åº¦å’Œåº”ç”¨å®æ˜¯é¦–å‘ï¼Œé€šè¿‡build_appså±æ€§æ¥æ§åˆ¶è¦æ‰“å“ªäº›æ¸ é“åŒ…</p><blockquote><p>&#x2F;&#x2F;æ‰“æ‰€æœ‰æ¸ é“åŒ…</p><p>gradle test</p><p>gradle -P build_apps&#x3D;all test</p><p>&#x2F;&#x2F;æ‰“é¦–å‘åŒ…</p><p>gradle -P build_apps&#x3D;shoufa test</p><p>&#x2F;&#x2F;æ‰“éé¦–å‘åŒ…</p><p>gradle -P build_apps&#x3D;exclude_shoufa test</p></blockquote><p>å‘½ä»¤è¡Œä¸­çš„-Pæ„æ€æ˜¯ä¸ºProjectæ‰§è¡ŒK-Væ ¼å¼å±æ€§çš„é”®å€¼å¯¹</p><h4 id="ä»»åŠ¡è§„åˆ™"><a href="#ä»»åŠ¡è§„åˆ™" class="headerlink" title="ä»»åŠ¡è§„åˆ™"></a>ä»»åŠ¡è§„åˆ™</h4><p>æˆ‘ä»¬çŸ¥é“åˆ›å»ºçš„äººç‰©éƒ½çˆ±TaskContaineré‡Œï¼Œæ˜¯ç”±å…¶è¿›è¡Œç®¡ç†çš„ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è®¿é—®ä»»åŠ¡çš„æ—¶å€™éƒ½æ˜¯é€šè¿‡TaskContainerè¿›è¡Œè®¿é—®ï¼Œè€ŒTaskContaineråˆæ˜¯ä¸€ä¸ªNamedDomainObjectCollectionï¼Œæ‰€ä»¥æˆ‘ä»¬è¯´çš„ä»»åŠ¡è§„åˆ™å…¶å®å°±æ˜¯NamedDomainObjectCollectionçš„è§„åˆ™ã€‚</p><p>NamedDomainObjectCollectionæ˜¯ä¸€ä¸ªå…·æœ‰å”¯ä¸€ä¸å˜åå­—çš„åŸŸå¯¹è±¡çš„é›†åˆï¼Œå®ƒé‡Œé¢æ‰€æœ‰çš„å…ƒç´ éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€ä¸å˜çš„åå­—ï¼Œè¯¥åå­—æ˜¯Stringç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡åå­—è·å–è¯¥å…ƒç´ ã€‚ä½†æ˜¯è¿™ä¸ªå”¯ä¸€çš„åå­—å¯èƒ½ä¸å­˜åœ¨ï¼Œå…·ä½“åˆ°ä»»åŠ¡ä¸­å°±æ˜¯è¯´ä½ æƒ³è·å–çš„è¿™ä¸ªä»»åŠ¡ä¸å­˜åœ¨ï¼Œè¿™æ—¶å€™å°±ä¼šè°ƒç”¨æˆ‘ä»¬æ·»åŠ çš„è§„åˆ™æ¥å¤„ç†è¿™ç§å¼‚å¸¸æƒ…å†µã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> T <span class="hljs-title function_">findName</span><span class="hljs-params">(String name)</span>&#123;<br>    <span class="hljs-type">T</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> findByNameWithoutRules(name);<br>    <span class="hljs-keyword">if</span>(value != <span class="hljs-literal">null</span>)&#123;<br>        <span class="hljs-keyword">return</span> value;<br>    &#125;<br>    applyRules(name);<br>    <span class="hljs-keyword">return</span> findByNameWithoutRules(name);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»¥åå­—æŸ¥æ‰¾çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆ™è°ƒç”¨applyRules(name)åº”ç”¨æˆ‘ä»¬æ·»åŠ çš„è§„åˆ™ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨addRuleæ¥æ·»åŠ æˆ‘ä»¬è‡ªå®šä¹‰çš„è§„åˆ™ï¼Œå®ƒæœ‰ä¸¤ä¸ªç”¨æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Adds a rule to this collection. The given rule is invoked when an unknown object is requested by name.</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> rule The rule to add.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span> The added rule.</span><br><span class="hljs-comment">    */</span><br>   Rule <span class="hljs-title function_">addRule</span><span class="hljs-params">(Rule rule)</span>;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Adds a rule to this collection. The given closure is executed when an unknown object is requested by name. The</span><br><span class="hljs-comment">    * requested name is passed to the closure as a parameter.</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> description The description of the rule.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> ruleAction The closure to execute to apply the rule.</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span> The added rule.</span><br><span class="hljs-comment">    */</span><br>   Rule <span class="hljs-title function_">addRule</span><span class="hljs-params">(String description, Closure ruleAction)</span>;<br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªæ˜¯ç›´æ¥æ·»åŠ ä¸€ä¸ªRuleï¼Œå¦ä¸€ä¸ªæ˜¯é€šè¿‡é—­åŒ…é…ç½®æˆä¸€ä¸ªRuleå†æ·»åŠ ï¼Œä¸¤ç§æ–¹å¼å¤§åŒå°å¼‚ã€‚</p><p>å½“æˆ‘ä»¬æ‰§è¡Œã€ä¾èµ–ä¸€ä¸ªä¸å­˜åœ¨çš„ä»»åŠ¡æ—¶ï¼ŒGradleä¼šæ‰§è¡Œå¤±è´¥ï¼Œå¤±è´¥ä¿¡æ¯æ˜¯ä»»åŠ¡ä¸å­˜åœ¨ã€‚æˆ‘ä»¬ä½¿ç”¨è§„åˆ™å¯¹å…¶è¿›è¡Œæ”¹é€ ï¼Œä¸ä¼šæ‰§è¡Œå¤±è´¥ï¼Œè€Œæ˜¯æ‰“å°æç¤ºä¿¡æ¯ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs groovy">tasks.addRule(<span class="hljs-string">&quot;å¯¹è¯¥è§„åˆ™çš„ä¸€ä¸ªæè¿°&quot;</span>)&#123;<br>    String taskName -&gt;<br>        task(taskName) &lt;&lt;&#123;<br>            println(<span class="hljs-string">&quot;è¯¥$&#123;taskName&#125;ä»»åŠ¡ä¸å­˜åœ¨ï¼Œè¯·æŸ¥è¯åå†æ‰§è¡Œ&quot;</span>)<br>        &#125;<br>&#125;<br><br>task testA &#123;<br>    dependsOn missTask<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Gradle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é€‚é…å…¨é¢å±æ‰‹æœº</title>
    <link href="/2018/11/12/%E9%80%82%E9%85%8D%E5%85%A8%E9%9D%A2%E5%B1%8F%E6%89%8B%E6%9C%BA/"/>
    <url>/2018/11/12/%E9%80%82%E9%85%8D%E5%85%A8%E9%9D%A2%E5%B1%8F%E6%89%8B%E6%9C%BA/</url>
    
    <content type="html"><![CDATA[<p>æ”¾ä¸ªå›¾æ„Ÿå—ä¸€ä¸‹ï¼Œä¸Šé¢çš„å›¾æ˜¯æŠ˜å å±ï¼Œå¹¶éæ˜¯å…¨é¢å±ï¼Œå…¨é¢å±æ˜¯æ‰‹æœºä¸šç•Œå¯¹äºè¶…é«˜å±å æ¯”æ‰‹æœºè®¾è®¡çš„ä¸€ä¸ªå®½æ³›çš„å®šä¹‰ã€‚å…¨é¢å±æ‰‹æœºå±å¹•çš„å®½é«˜æ¯”ä¾‹æ¯”è¾ƒç‰¹æ®Šï¼Œä¸å†æ˜¯ä»¥å‰çš„16:9äº†ã€‚æ¯”å¦‚ä¸‰æ˜Ÿçš„Galaxy S8å±å¹•åˆ†è¾¨ç‡æ˜¯ï¼š2960Ã—1440ï¼Œå¯¹åº”çš„å±å¹•æ¯”ä¾‹ä¸º:18.5:9ã€‚VIVO X20æ‰‹æœºå±å¹•åˆ†è¾¨ç‡æ˜¯2160x1080ï¼Œå¯¹åº”çš„å±å¹•æ¯”ä¾‹:18:9ã€‚ç”±äºå…¨é¢å±æ‰‹æœºçš„é«˜å®½æ¯”æ¯”ä¹‹å‰å¤§ï¼Œå¦‚æœä¸é€‚é…çš„è¯ï¼ŒAndroidé»˜è®¤ä¸ºæœ€å¤§çš„å®½é«˜æ¯”æ˜¯1.86ï¼Œå°äºå…¨é¢å±æ‰‹æœºçš„å®½é«˜æ¯”ï¼Œå› æ­¤ï¼Œåœ¨å…¨é¢å±æ‰‹æœºä¸Šæ‰“å¼€éƒ¨åˆ†Appæ—¶ï¼Œä¸Šä¸‹å°±ä¼šç•™æœ‰ç©ºé—´ï¼Œæ˜¾ç¤ºä¸ºé»‘æ¡ã€‚</p><p>æœ¬æ–‡å…³äºé€‚é…é—®é¢˜å‚è€ƒ <a href="https://blog.csdn.net/weelyy/article/details/79284332">https://blog.csdn.net/weelyy/article/details/79284332</a></p><span id="more"></span><h4 id="æ˜¾ç¤ºé—®é¢˜"><a href="#æ˜¾ç¤ºé—®é¢˜" class="headerlink" title="æ˜¾ç¤ºé—®é¢˜"></a>æ˜¾ç¤ºé—®é¢˜</h4><img src="/image/Android/maxAspect/max_aspect.png" height="500" width="240" /><img src="/image/Android/maxAspect/max_aspect1.jpg" height="500" width="240" /><p>ç¬¬ä¸€å¼ å›¾æ˜¯åœ¨å°ç±³mix3ä¸Šæ˜¾ç¤ºçš„é—®é¢˜ï¼Œä¸å¾—ä¸è¯´ç”¨æˆ·ä¹Ÿæ˜¯ç´§è·Ÿæ½®æµï¼Œåˆšå‡ºæ–°æ‰‹æœºå°±ç›´æ¥å…¥æ‰‹ã€‚<br>ä¸‹é¢ä¸€å¼ å›¾æ˜¯åœ¨åä¸ºè£è€€10ä¸Šæ˜¾ç¤ºçš„é—®é¢˜ï¼Œå¯ä»¥æ˜æ˜¾çš„çœ‹å‡ºï¼Œåœ¨å±å¹•åº•éƒ¨éƒ½æœ‰ä¸€å—é»‘è‰²åŒºåŸŸï¼Œä¸åŒçš„æ˜¯åä¸ºè£è€€10ä¸Šæœ‰å…¨å±æ˜¾ç¤ºçš„æç¤ºï¼Œç‚¹å‡»ä¹‹åå¯ä»¥å¼ºåˆ¶å…¨å±æ˜¾ç¤ºï¼Œä¸ä¼šç•™ä¸‹é»‘æ¡†ã€‚</p><h4 id="åœ¨AndroidManifest-xmlå£°æ˜max-aspectå€¼"><a href="#åœ¨AndroidManifest-xmlå£°æ˜max-aspectå€¼" class="headerlink" title="åœ¨AndroidManifest.xmlå£°æ˜max_aspectå€¼"></a>åœ¨AndroidManifest.xmlå£°æ˜max_aspectå€¼</h4><p>é’ˆå¯¹æ­¤é—®é¢˜ï¼ŒAndroidå®˜æ–¹æä¾›äº†é€‚é…æ–¹æ¡ˆï¼Œå³æé«˜Appæ‰€æ”¯æŒçš„æœ€å¤§å±å¹•çºµæ¨ªæ¯”ï¼Œå®ç°èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåœ¨AndroidManifest.xmlä¸­åšå¦‚ä¸‹é…ç½®å³å¯ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">meta-data</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.max_aspect&quot;</span>  <span class="hljs-attr">android:value</span>=<span class="hljs-string">&quot;ratio_float&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­ratio_floatä¸ºæµ®ç‚¹æ•°ï¼Œå®˜æ–¹å»ºè®®ä¸º2.1æˆ–æ›´å¤§ï¼Œå› ä¸º18.5ï¼š9&#x3D;2.055555555â€¦â€¦ï¼Œå¦‚æœæ—¥åå‡ºç°çºµæ¨ªæ¯”æ›´å¤§çš„æ‰‹æœºï¼Œæ­¤å€¼å°†éœ€è¦è®¾ä¸ºæ›´å¤§ã€‚åœ¨æˆ‘å¸é¡¹ç›®ä¸­è®¾ç½®çš„å€¼ä¸º4.1ï¼Œå½“è®¾ç½®è¯¥å€¼ä¸º2.1æ—¶ï¼Œåœ¨åä¸ºè£è€€10ä¸Šæœªç”Ÿæ•ˆã€‚Â  å› æ­¤ï¼Œå»ºè®®å¼€å‘è€…åœ¨è‡ªå·±App AndroidManifestçš„Applicationæ ‡ç­¾ä¸‹é¢å¢åŠ ä¸‹é¢ä¸€æ®µä»£ç ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">meta-data</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.max_aspect&quot;</span> <span class="hljs-attr">android:value</span>=<span class="hljs-string">&quot;2.1&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><p>å¦å¤–ï¼Œåœ¨AndroidManifestä¸­é’ˆå¯¹Activityæ ‡ç­¾æ·»åŠ <code>android:resizeableActivity = â€trueâ€</code>ï¼Œä¹Ÿå¯ä»¥å®ç°å…¨å±æ˜¾ç¤ºï¼Œä½†æ­¤è®¾ç½®åªé’ˆå¯¹Activityç”Ÿæ•ˆï¼Œä¸”å¢åŠ äº†æ­¤å±æ€§è¯¥activityä¹Ÿä¼šæ”¯æŒåˆ†å±æ˜¾ç¤ºã€‚</p><p>å½“ç„¶max_aspectå€¼ä¹Ÿå¯ä»¥åœ¨ä»£ç ä¸­åŠ¨æ€è®¾ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMaxAspect</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">ApplicationInfo</span> <span class="hljs-variable">applicationInfo</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            applicationInfo = getPackageManager().getApplicationInfo(getPackageName(), PackageManager.GET_META_DATA);<br>        &#125; <span class="hljs-keyword">catch</span> (PackageManager.NameNotFoundException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">if</span>(applicationInfo == <span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot; get application info = null, has no meta data! &quot;</span>);<br>        &#125;<br>        applicationInfo.metaData.putString(<span class="hljs-string">&quot;android.max_aspect&quot;</span>, <span class="hljs-string">&quot;2.1&quot;</span>);<br>    &#125;<br></code></pre></td></tr></table></figure><p>å…·ä½“æƒ…å†µå¯ä»¥å‚è€ƒè°·æ­Œå®˜æ–¹æ–‡æ¡£</p><p><a href="https://android-developers.googleblog.com/2017/03/update-your-app-to-take-advantage-of.html">https://android-developers.googleblog.com/2017/03/update-your-app-to-take-advantage-of.html</a></p><h4 id="æ›´æ¢èµ„æºæ–‡ä»¶"><a href="#æ›´æ¢èµ„æºæ–‡ä»¶" class="headerlink" title="æ›´æ¢èµ„æºæ–‡ä»¶"></a>æ›´æ¢èµ„æºæ–‡ä»¶</h4><p>åœ¨è¾ƒå¤§é«˜å®½æ¯”çš„æ‰‹æœºä¸Šï¼Œç”±äºå±å¹•æ¯”ä¾‹çš„æ”¹å˜(ä»16:9å˜æˆäº†18:9)ï¼Œå¯¹äºä¸€äº›é“ºæ»¡å…¨å±çš„å›¾ç‰‡(å¦‚å¼€å±å¹¿å‘Šé¡µæˆ–è€…å¼•å¯¼é¡µ)ä¼šå‡ºç°å›¾ç‰‡æ‹‰ä¼¸çš„æƒ…å†µï¼Œå¦‚æœå¯ä»¥æ¥å—ï¼Œå°±ä¸ç”¨ç®¡äº†ã€‚æ¥å—ä¸äº†å°±éœ€è¦é€‚é…ï¼Œé’ˆå¯¹è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬ä»¥åˆ†è¾¨ç‡ä¸º2160X1080ï¼Œåƒç´ å¯†åº¦ä¸º480dpiçš„VIVO X20Plusæ‰‹æœºä¸ºä¾‹ï¼Œå¯ä»¥åœ¨èµ„æºç›®å½•ä¸‹é¢å¢åŠ ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œdrawable-h642dp-port-xxhdpiï¼Œå¹¶å°†GUIåˆ‡å¥½çš„åˆ†è¾¨ç‡ä¸º2160X1080èµ„æºå›¾ç‰‡æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œç³»ç»Ÿå°±èƒ½è‡ªåŠ¨ä½¿ç”¨è¿™ç§å›¾ç‰‡ï¼Œä¾¿ä¸ä¼šå‡ºç°æ‹‰ä¼¸çš„é—®é¢˜ã€‚å…³äº<code>h&lt;N&gt;dp</code>çš„è¯¦ç»†ç”¨æ³•ï¼Œgoogleå¼€å‘è€…æ–‡æ¡£ä¹Ÿæœ‰è¯¦ç»†ä»‹ç»ï¼š</p><p><a href="https://developer.android.com/guide/practices/screens_support">https://developer.android.com/guide/practices/screens_support</a></p><h4 id="å…³äºæŠ˜å å±"><a href="#å…³äºæŠ˜å å±" class="headerlink" title="å…³äºæŠ˜å å±"></a>å…³äºæŠ˜å å±</h4><p>åŒ—äº¬æ—¶é—´ 11 æœˆ 8 æ—¥ï¼Œä¸‰æ˜Ÿåœ¨æ—§é‡‘å±±å‘å¼€å‘è€…å‘å¸ƒäº†ä¸€æ¬¾å¯æŠ˜å å±å¹•æ‰‹æœºã€‚å¹¶è¡¨ç¤ºï¼Œæ–°æŠ€æœ¯éœ€è¦å¼€å‘è€…è°ƒæ•´å…¶ Appï¼Œä»¥ç¡®ä¿åœ¨æ‰‹æœºè¢«æ‘Šå¼€æˆå¹³æ¿ç”µè„‘æ—¶ï¼Œèƒ½å¤Ÿè¿è¡Œæµç•…ã€‚ä¸‰æ˜Ÿçš„è¿™æ¬¾æ‰‹æœºï¼Œè¿˜å¤„äºåŸå‹æœºçš„çŠ¶æ€ï¼Œæ­£å¼å‘å¸ƒæ—¥æœŸå°šæœªç¡®å®šã€‚è¿™ç§æŠ˜å çš„æŠ€æœ¯ï¼Œä¸‰æ˜Ÿå°†å…¶ç§°ä¹‹ä¸º Infinity Flex Displayã€‚ä¸è¿‡ Google ä¹Ÿæœ‰å…¶åº”å¯¹çš„ç­–ç•¥ï¼Œåœ¨ä»Šå¹´çš„ Android Dev Summit ä¸Šï¼ŒGoogle å°±å·²ç»å®£å¸ƒå°†è¦å¯¹æŠ˜å å±æä¾›â€œScreen Continuityï¼ˆå±å¹•è¿ç»­æ€§ï¼‰â€çš„åŸç”Ÿç³»ç»Ÿæ”¯æŒï¼Œå¹¶å°†è¿™é¡¹æŠ€æœ¯ç§°ä¹‹ä¸ºï¼š<strong>Foldables</strong>ã€‚åˆ©ç”¨è¿™ç§æŸ”æ€§æ˜¾ç¤ºæŠ€æœ¯ï¼ŒApp å¯ä»¥åšåˆ°æŠ˜å å±è®¾å¤‡ä¸Šçš„é€‚é…å·¥ä½œã€‚</p><p>å…·ä½“æƒ…å†µå¯ä»¥å‚è€ƒ<a href="https://mp.weixin.qq.com/s/yz5dxQyG3jvhUuDRrdNzbg">https://mp.weixin.qq.com/s/yz5dxQyG3jvhUuDRrdNzbg</a></p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Androidçˆ¬å‘ä¹‹æ—…</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gradleåŸºç¡€</title>
    <link href="/2018/11/11/gradle%E5%9F%BA%E7%A1%80/"/>
    <url>/2018/11/11/gradle%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<p>å‚è€ƒè‡ªã€ŠAndroid Gradleæƒå¨æŒ‡å—ã€‹</p><p>å…ˆæ¥å›é¡¾ä¸€ä¸‹groovyçš„ä¸€äº›åŸºç¡€è¯­æ³•</p><ol><li><p>è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œåœ†æ‹¬å·æ˜¯å¯ä»¥çœç•¥çš„ï¼Œæ¯”å¦‚</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> method1(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)&#123;<br>    println a+b<br>&#125;<br><br>task invokeMethod &lt;&lt;&#123;<br>method1(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)<br>    method1 <span class="hljs-number">1</span>,<span class="hljs-number">2</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å®šä¹‰æ–¹æ³•æ—¶ï¼Œreturnæ˜¯å¯ä»¥ä¸å†™çš„ï¼Œæ¯”å¦‚</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> getMaxNumber(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)&#123;<br>    <span class="hljs-keyword">if</span>(a&gt;b)&#123;<br>        a<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        b<br>    &#125;<br>&#125;<br>task printMethodReturn &lt;&lt;&#123;<br>    <span class="hljs-keyword">def</span> max1 = getMaxNumber <span class="hljs-number">1</span>,<span class="hljs-number">2</span><br>    <span class="hljs-keyword">def</span> max2 = getMaxNumber <span class="hljs-number">3</span>,<span class="hljs-number">5</span><br>    println <span class="hljs-string">&quot;max1 :$&#123;max1&#125;,max2:$&#123;max2&#125;&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œ<code>gradle printMethodReturn</code>å¯ä»¥çœ‹åˆ°è¾“å‡º  <code>max1 :2,max2:5</code></p></li><li><p>ä»£ç å—æ˜¯å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’çš„ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//æœ€ç›´æ¥çš„å†™æ³•</span><br>numList.each(&#123;println it&#125;)<br><span class="hljs-comment">//groovyè§„å®šï¼Œå¦‚æœæ–¹æ³•çš„æœ€åä¸€ä¸ªå‚æ•°æ˜¯é—­åŒ…ï¼Œå¯ä»¥æ”¾å¤§æ–¹æ³•å¤–é¢</span><br>numList.each()&#123;<br>    println it<br>&#125;<br><span class="hljs-comment">// è¿˜è§„å®šäº†ï¼Œå¦‚æœå‡ºç°ä¸Šé¢çš„æƒ…å†µï¼Œåœ†æ‹¬å·ä¹Ÿæ˜¯å¯ä»¥çœç•¥çš„</span><br>numList.each&#123;<br>    println it<br>&#125;<br></code></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯å’Œpythonå¾ˆåƒã€‚</p><span id="more"></span><h4 id="JavaBean"><a href="#JavaBean" class="headerlink" title="JavaBean"></a>JavaBean</h4><p>åœ¨Javaä¸­ä¸ºäº†è·å–ã€ä¿®æ”¹å±æ€§çš„å€¼ï¼Œé€šå¸¸éœ€è¦é€šè¿‡ç”Ÿæˆ<code>getter/setter</code>æ–¹æ³•ï¼Œä½†æ˜¯åœ¨<code>groovy</code>ä¸­æˆ‘ä»¬å¯ä»¥è¿™æ ·</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>&#123;<br>    <span class="hljs-keyword">private</span> String name<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> getAge()&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">12</span><br>    &#125;<br>&#125;<br><br>task PersonField &lt;&lt;&#123;<br>    Person p  = <span class="hljs-keyword">new</span> Person()<br>    println <span class="hljs-string">&quot;name is $&#123;p.name&#125;&quot;</span><br>    p.name = <span class="hljs-string">&quot;å¼ ä¸‰&quot;</span><br>    println <span class="hljs-string">&quot;name is $&#123;p.name&#125;&quot;</span><br>    println <span class="hljs-string">&quot;age is $&#123;p.age&#125;&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œå¾—åˆ°è¾“å‡º</p><blockquote><p>name is null<br>name is å¼ ä¸‰<br>age is 12</p></blockquote><p>åœ¨æ²¡æœ‰ç»™nameå±æ€§èµ‹å€¼æ—¶ï¼Œè¾“å‡ºä¸ºnullï¼Œèµ‹å€¼ä¹‹åï¼Œè¾“å‡ºç»™å®šçš„å€¼ã€‚å¹¶ä¸”å¹¶ä¸éœ€è¦é€šè¿‡getter&#x2F;setteræ–¹æ³•æ¥è¿›è¡Œæ“ä½œï¼Œçœ‹èµ·æ¥æœ‰ç‚¹åƒkotlinã€‚</p><p>å¯¹äºageæ¥è®²ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰åœ¨å¯¹è±¡ä¸­å£°æ˜è¯¥å±æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´å¹¶ä¸ä¸€å®šéœ€è¦å®šä¹‰æˆå‘˜å˜é‡æ‰èƒ½ä½œä¸ºç±»çš„å±æ€§è®¿é—®ã€‚</p><h4 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h4><p>é—­åŒ…å…¶å®å°±æ˜¯ä¸€æ®µä»£ç å—ï¼Œæˆ‘ä»¬ä»¥é›†åˆçš„eachæ–¹æ³•ä¸ºä¾‹</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> customClosure(closure)&#123;<br>    <span class="hljs-keyword">for</span>(i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.10</span>)&#123;<br>        closure(i)<br>    &#125;<br>&#125;<br><br>task testClosure &lt;&lt;&#123;<br>    customClosure&#123;<br>        print it<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œå¯ä»¥å¾—åˆ°1åˆ°10çš„æ‰“å°è¾“å‡ºï¼Œå¯ä»¥å°†ä¸Šè¿°ä»£ç ç®€å•ç²—æš´çš„ç†è§£ä¸º</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> customClosure()&#123;<br>    <span class="hljs-keyword">for</span>(i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.10</span>)&#123;<br>        print i<br>    &#125;<br>&#125;<br><br>task testClosure &lt;&lt;&#123;<br>    customClosure()<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="é—­åŒ…çš„å‚æ•°"><a href="#é—­åŒ…çš„å‚æ•°" class="headerlink" title="é—­åŒ…çš„å‚æ•°"></a>é—­åŒ…çš„å‚æ•°</h5><p>ä¸Šé¢çš„ä¾‹å­ä¸­åªç”¨åˆ°äº†ä¸€ä¸ªå‚æ•°ï¼Œç”¨äºæ¥æ”¶ä¸€ä¸ªé—­åŒ…ï¼Œé»˜è®¤å°±æ˜¯itï¼Œå½“æœ‰å¤šä¸ªå‚æ•°æ—¶ï¼Œéœ€è¦æŠŠå‚æ•°ä¸€ä¸€åˆ—å‡º</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs groovy">task helloClosure &lt;&lt;&#123;<br>    eachMap&#123;k,v -&gt; <br>        println <span class="hljs-string">&quot;$&#123;k&#125; is $&#123;v&#125;&quot;</span><br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">def</span> eachMap(closure)&#123;<br>    <span class="hljs-keyword">def</span> map1=[<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">18</span>]<br>    map1.each&#123;<br>        closure(it.key,it.value)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡ŒhelloClosureä»»åŠ¡ï¼Œå¾—åˆ°</p><blockquote><p>$ gradle -q helloClosure<br>name is å¼ ä¸‰<br>age is 18</p></blockquote><h5 id="é—­åŒ…å§”æ‰˜"><a href="#é—­åŒ…å§”æ‰˜" class="headerlink" title="é—­åŒ…å§”æ‰˜"></a>é—­åŒ…å§”æ‰˜</h5><p>groovyçš„é—­åŒ…å§”æ‰˜æœ‰thisObjectã€ownerå’Œdelegateä¸‰ä¸ªå±æ€§ï¼Œå½“åœ¨é—­åŒ…å†…è°ƒç”¨æ–¹æ³•æ—¶ï¼Œç”±ä»–ä»¬æ¥ç¡®å®šä½¿ç”¨å“ªä¸ªå¯¹è±¡æ¥å¤„ç†ï¼Œé»˜è®¤æƒ…å†µownerå’Œdelegateæ˜¯ç›¸ç­‰çš„ï¼Œä½†æ˜¯delegateå±æ€§å¯ä»¥è¢«ä¿®æ”¹</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//é—­åŒ…å§”æ‰˜</span><br><span class="hljs-keyword">def</span> method1()&#123;<br>    println <span class="hljs-string">&quot;Context this :$&#123;this.getClass()&#125; in root&quot;</span><br>    println <span class="hljs-string">&quot;method1 in root&quot;</span><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Delegate</span>&#123;<br>    <span class="hljs-keyword">def</span> method1()&#123;<br>        println <span class="hljs-string">&quot;Delegate this : $&#123;this.getClass()&#125; in Delegate&quot;</span><br>        println <span class="hljs-string">&quot;method1 in Delegate&quot;</span><br>    &#125;<br><br>    <span class="hljs-keyword">def</span> test(Closure&lt;Delegate&gt; closure)&#123;<br>            closure(<span class="hljs-variable language_">this</span>)<br>    &#125;<br>&#125;<br><br>task helloDelegate &lt;&lt;&#123;<br>    <span class="hljs-keyword">new</span> Delegate().test&#123;<br>        println <span class="hljs-string">&quot;thisObject :$&#123;thisObject.getClass()&#125;&quot;</span><br>        println <span class="hljs-string">&quot;owner:$&#123;owner.getClass()&#125;&quot;</span><br>        println <span class="hljs-string">&quot;delegate:$&#123;delegate.getClass()&#125;&quot;</span><br>        method1()<br>        it.method1()<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä»»åŠ¡å¯ä»¥å¾—åˆ°</p><blockquote><p>$ gradle -q helloDelegate<br>thisObject :class build_apnm7l2hrtoaa0bd51bpb5xcf<br>owner:class build_apnm7l2hrtoaa0bd51bpb5xcf$_run_closure4<br>delegate:class build_apnm7l2hrtoaa0bd51bpb5xcf$_run_closure4<br>Context this :class build_apnm7l2hrtoaa0bd51bpb5xcf in root<br>method1 in root<br>Delegate this : class Delegate in Delegate<br>method1 in Delegate</p></blockquote><p>ä»ä¸Šé¢ä¾‹å­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä¸è¿›è¡Œä»»ä½•ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼ŒthisObjectçš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼˜å…ˆä½¿ç”¨thisObjectæ¥å¤„ç†é—­åŒ…ä¸­çš„æ–¹æ³•ï¼Œå¦‚æœæœ‰åˆ™æ‰§è¡Œã€‚ä»è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°è¿™ä¸ªthisObjectå°±æ˜¯æ„å»ºè„šæœ¬çš„ä¸Šä¸‹æ–‡ï¼Œå®ƒå’Œè„šæœ¬ä¸­çš„thisæ˜¯ä¸€æ ·çš„ã€‚</p><p>åœ¨DSLä¸­ï¼Œæ¯”å¦‚gradleï¼Œä¸€èˆ¬ä¼šæŒ‡å®šdelegateä¸ºå½“å‰çš„itï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨é—­åŒ…ä¸­å¯¹è¯¥itè¿›è¡Œé…ç½®ï¼Œæˆ–è€…è°ƒç”¨å…¶æ–¹æ³•ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    String personName<br>    <span class="hljs-type">int</span> personAge<br><br>    <span class="hljs-keyword">def</span> dumpPerson()&#123;<br>        println <span class="hljs-string">&quot;name is $&#123;personName&#125;, age is $&#123;personAge&#125;&quot;</span><br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">def</span> person(Closure&lt;Person&gt; closure)&#123;<br>    Person p = <span class="hljs-keyword">new</span> Person()<br>    closure.delegate = p<br>    <span class="hljs-comment">//å§”æ‰˜æ¨¡å¼ä¼˜å…ˆ</span><br>    closure.setResolveStrategy(Closure.DELEGATE_FIRST)<br>    closure(p)<br>&#125;<br><br>task configClosure &lt;&lt; &#123;<br>    person&#123;<br>        personName=<span class="hljs-string">&quot;å¼ ä¸‰&quot;</span><br>        personAge = <span class="hljs-number">20</span><br>        dumpPerson()<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢å®ä¾‹ä¸­è®¾ç½®äº†å§”æ‰˜å¯¹è±¡ä¸ºå½“å‰åˆ›å»ºçš„Personå®ä¾‹ï¼Œå¹¶ä¸”è®¾ç½®äº†å§”æ‰˜æ¨¡å¼ä¼˜å…ˆï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨personæ–¹æ³•åˆ›å»ºå®ä¾‹çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨é—­åŒ…é‡Œé¢ç›´æ¥å¯¹è¯¥å®ä¾‹è¿›è¡Œé…ç½®ã€‚</p><hr><p>ä»¥ä¸Šï¼Œ</p></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Gradle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>groovyè¯­æ³•å…¥é—¨</title>
    <link href="/2018/11/09/groovy%E8%AF%AD%E6%B3%95%E5%85%A5%E9%97%A8/"/>
    <url>/2018/11/09/groovy%E8%AF%AD%E6%B3%95%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<p>çœ‹äº†ä¸€äº›gradleæ„å»ºè„šæœ¬çš„æ•™ç¨‹ï¼Œæ€»æ„Ÿè§‰ç¼ºå°‘äº†ç‚¹ä»€ä¹ˆï¼Œå¯¹äºæŸäº›å‘½ä»¤çš„å†™æ³•ä¸ç†Ÿæ‚‰ç”šè‡³çœ‹ä¸æ‡‚ï¼Œè¡¥ä¸€ä¸‹groovyçš„åŸºç¡€çŸ¥è¯†ã€‚æ–‡ç« å†…å®¹å‚è€ƒ <a href="http://groovy-lang.org/syntax.html">http://groovy-lang.org/syntax.html</a> (å®˜ç½‘) å’Œ <a href="http://ifeve.com/groovy-syntax">http://ifeve.com/groovy-syntax</a> (ç¿»è¯‘)</p><span id="more"></span><h4 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h4><h5 id="å•è¡Œæ³¨é‡Šã€å¤šè¡Œæ³¨é‡Šã€æ–‡æ¡£æ³¨é‡Š-å’Œjavaä¸€è‡´"><a href="#å•è¡Œæ³¨é‡Šã€å¤šè¡Œæ³¨é‡Šã€æ–‡æ¡£æ³¨é‡Š-å’Œjavaä¸€è‡´" class="headerlink" title="å•è¡Œæ³¨é‡Šã€å¤šè¡Œæ³¨é‡Šã€æ–‡æ¡£æ³¨é‡Š å’Œjavaä¸€è‡´"></a>å•è¡Œæ³¨é‡Šã€å¤šè¡Œæ³¨é‡Šã€æ–‡æ¡£æ³¨é‡Š å’Œjavaä¸€è‡´</h5><h5 id="Shebang-line"><a href="#Shebang-line" class="headerlink" title="Shebang line"></a>Shebang line</h5><p>è¿™ä¸ªä¸œè¥¿åœ¨Unixä¸‹è¢«ç§°ä¸ºäº‹åŠ¡è¡Œï¼Œä¸”å…è®¸è„šæœ¬ç›´æ¥ä»å‘½ä»¤è¡Œè¿è¡Œï¼Œå‰ææ˜¯ä½ åº”å°†å®‰è£…äº†Groovyå‘å¸ƒç‰ˆï¼Œä¸”åœ¨PATHä¸­Groovyçš„å‘½ä»¤è¡Œæ˜¯å¯ç”¨çš„ã€‚</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-meta">#!/usr/bin/env groovy</span><br>println <span class="hljs-string">&quot;Hello from the shebang line&quot;</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­<code>#</code>å­—ç¬¦å¿…é¡»æ˜¯ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œä»»ä½•ç¼©è¿›(ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦)éƒ½ä¼šæŠ¥é”™</p><h4 id="Keywords"><a href="#Keywords" class="headerlink" title="Keywords"></a>Keywords</h4><table><thead><tr><th align="center"></th><th align="center"></th><th align="center"></th><th align="center"></th></tr></thead><tbody><tr><td align="center">as</td><td align="center">assert</td><td align="center">break</td><td align="center">case</td></tr><tr><td align="center">catch</td><td align="center">class</td><td align="center">const</td><td align="center">continue</td></tr><tr><td align="center">def</td><td align="center">default</td><td align="center">do</td><td align="center">else</td></tr><tr><td align="center">enum</td><td align="center">extends</td><td align="center">false</td><td align="center">finally</td></tr><tr><td align="center">for</td><td align="center">goto</td><td align="center">if</td><td align="center">implements</td></tr><tr><td align="center">import</td><td align="center">in</td><td align="center">instanceof</td><td align="center">interface</td></tr><tr><td align="center">new</td><td align="center">null</td><td align="center">package</td><td align="center">return</td></tr><tr><td align="center">super</td><td align="center">switch</td><td align="center">this</td><td align="center">throw</td></tr><tr><td align="center">throws</td><td align="center">trait</td><td align="center">true</td><td align="center">try</td></tr><tr><td align="center">while</td><td align="center"></td><td align="center"></td><td align="center"></td></tr></tbody></table><h4 id="Identifiers-æ ‡è¯†ç¬¦"><a href="#Identifiers-æ ‡è¯†ç¬¦" class="headerlink" title="Identifiers æ ‡è¯†ç¬¦"></a>Identifiers æ ‡è¯†ç¬¦</h4><h5 id="æ­£å¸¸æ ‡è¯†ç¬¦"><a href="#æ­£å¸¸æ ‡è¯†ç¬¦" class="headerlink" title="æ­£å¸¸æ ‡è¯†ç¬¦"></a>æ­£å¸¸æ ‡è¯†ç¬¦</h5><p>åŒjava</p><h4 id="å¼•ç”¨å­—ç¬¦ä¸²"><a href="#å¼•ç”¨å­—ç¬¦ä¸²" class="headerlink" title="å¼•ç”¨å­—ç¬¦ä¸²"></a>å¼•ç”¨å­—ç¬¦ä¸²</h4><p>å¼•ç”¨æ ‡è¯†ç¬¦å‡ºç°åœ¨ä¸€ä¸ªç‚¹å¼è¡¨è¾¾å¼çš„ç‚¹åé¢ã€‚ä¾‹å¦‚ï¼Œperson.nameè¡¨è¾¾å¼ä¸­çš„nameï¼Œèƒ½é€šè¿‡person.â€nameâ€,person.â€™nameâ€™è¢«å¼•ç”¨.</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> map = [:]<br><br>map.<span class="hljs-string">&quot;an identifier with a space and double quotes&quot;</span> = <span class="hljs-string">&quot;ALLOWED&quot;</span><br>map.<span class="hljs-string">&#x27;with-dash-signs-and-single-quotes&#x27;</span> = <span class="hljs-string">&quot;ALLOWED&quot;</span><br><br><span class="hljs-keyword">assert</span> map.<span class="hljs-string">&quot;an identifier with a space and double quotes&quot;</span> == <span class="hljs-string">&quot;ALLOWED&quot;</span><br><span class="hljs-keyword">assert</span> map.<span class="hljs-string">&#x27;with-dash-signs-and-single-quotes&#x27;</span> == <span class="hljs-string">&quot;ALLOWED&quot;</span><br></code></pre></td></tr></table></figure><p>Groovyæä¾›äº†ä¸åŒçš„å­—ç¬¦ä¸²å­—é¢é‡ã€‚æ‰€æœ‰ä¸åŒç±»å‹çš„å­—ç¬¦ä¸²éƒ½è¢«å…è®¸å‡ºç°åœ¨ç‚¹åé¢ã€‚</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs groovy">map.<span class="hljs-string">&#x27;single quote&#x27;</span><br>map.<span class="hljs-string">&quot;double quote&quot;</span><br>map.<span class="hljs-string">&#x27;&#x27;&#x27;triple single quote&#x27;&#x27;&#x27;</span><br>map.<span class="hljs-string">&quot;&quot;&quot;triple double quote&quot;&quot;&quot;</span><br>map.<span class="hljs-regexp">/slashy string/</span><br>map.<span class="hljs-string">$/dollar slashy string/$</span><br></code></pre></td></tr></table></figure><p>æ™®é€šå­—ç¬¦ä¸²å’ŒGroovyçš„GStringsæœ‰ä¸€äº›ä¸åŒï¼ˆæœ‰æ’å€¼çš„å­—ç¬¦ä¸²ï¼‰ï¼Œæ­£å¦‚åœ¨åè€…çš„æƒ…å†µä¸‹ï¼Œæ’å…¥çš„å€¼è¢«æ’å…¥åˆ°æœ€åçš„å­—ç¬¦ä¸²ä¸­ï¼Œä»¥è®¡ç®—æ•´ä¸ªæ ‡è¯†ç¬¦ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> firstname = <span class="hljs-string">&quot;Homer&quot;</span><br>map.<span class="hljs-string">&quot;Simson-$&#123;firstname&#125;&quot;</span> = <span class="hljs-string">&quot;Homer Simson&quot;</span><br><br><span class="hljs-keyword">assert</span> map.<span class="hljs-string">&#x27;Simson-Homer&#x27;</span> == <span class="hljs-string">&quot;Homer Simson&quot;</span><br></code></pre></td></tr></table></figure><h4 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h4><p>æ–‡æœ¬æ–‡å­—ä»¥å­—ç¬¦é“¾çš„å½¢å¼è¡¨ç¤ºè¢«ç§°ä½œå­—ç¬¦ä¸²ã€‚Groovyå¯ä»¥è®©ä½ å®ä¾‹åŒ–java.lang.Stringå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥å®ä¾‹åŒ–GString(groovy.lang.GString)ï¼Œåœ¨å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­è¢«ç§°ä¸ºæ’å€¼å­—ç¬¦ä¸²ã€‚</p><h5 id="å•å¼•å·å­—ç¬¦ä¸²"><a href="#å•å¼•å·å­—ç¬¦ä¸²" class="headerlink" title="å•å¼•å·å­—ç¬¦ä¸²"></a>å•å¼•å·å­—ç¬¦ä¸²</h5><p>å•å¼•å·å­—ç¬¦ä¸²æ˜¯ä¸€ç³»åˆ—è¢«å•å¼•å·åŒ…å›´çš„å­—ç¬¦ã€‚</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-string">&#x27;a single quoted string&#x27;</span><br></code></pre></td></tr></table></figure><p>å•å¼•å·å­—ç¬¦ä¸²æ˜¯æ™®é€šçš„java.lang.Stringï¼Œä¸æ”¯æŒæ’å€¼ã€‚</p><h5 id="å­—ç¬¦ä¸²è¿æ¥"><a href="#å­—ç¬¦ä¸²è¿æ¥" class="headerlink" title="å­—ç¬¦ä¸²è¿æ¥"></a>å­—ç¬¦ä¸²è¿æ¥</h5><p>æ‰€æœ‰Groovyå­—ç¬¦ä¸²èƒ½ä½¿ç”¨+æ“ä½œç¬¦è¿æ¥ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">assert</span> <span class="hljs-string">&#x27;ab&#x27;</span> == <span class="hljs-string">&#x27;a&#x27;</span> + <span class="hljs-string">&#x27;b&#x27;</span><br></code></pre></td></tr></table></figure><h5 id="ä¸‰å•å¼•å·å­—ç¬¦ä¸²"><a href="#ä¸‰å•å¼•å·å­—ç¬¦ä¸²" class="headerlink" title="ä¸‰å•å¼•å·å­—ç¬¦ä¸²"></a>ä¸‰å•å¼•å·å­—ç¬¦ä¸²</h5><p>ä¸‰å•å¼•å·å­—ç¬¦ä¸²æ˜¯ä¸€åˆ—è¢«ä¸‰ä¸ªå•å¼•å·åŒ…å›´çš„å­—ç¬¦ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-string">&#x27;&#x27;&#x27;a triple single quoted string&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><p>ä¸‰å•å¼•å·å­—ç¬¦ä¸²æ˜¯æ™®é€šçš„java.lang.Stringï¼Œä¸æ”¯æŒæ’å€¼ã€‚ ä¸‰å•å¼•å·å­—ç¬¦ä¸²æ˜¯å¤šè¡Œçš„ã€‚ä½ å¯ä»¥ä½¿å­—ç¬¦ä¸²å†…å®¹è·¨è¶Šè¡Œè¾¹ç•Œï¼Œä¸éœ€è¦å°†å­—ç¬¦ä¸²åˆ†å‰²ä¸ºä¸€äº›ç‰‡æ®µï¼Œä¸éœ€è¦è¿æ¥ï¼Œæˆ–æ¢è¡Œè½¬ä¹‰ç¬¦ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> aMultilineString = <span class="hljs-string">&#x27;&#x27;&#x27;line one</span><br><span class="hljs-string">line two</span><br><span class="hljs-string">line three&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœä½ çš„ä»£ç æ˜¯ç¼©è¿›çš„ï¼Œå¦‚ç±»ä¸­çš„æ–¹æ³•ä½“ï¼Œå­—ç¬¦ä¸²å°†åŒ…æ‹¬ç¼©è¿›çš„ç©ºæ ¼ã€‚Groovyå¼€å‘å·¥å…·åŒ…å«ä¸€äº›å‰¥ç¦»ç¼©è¿›çš„æ–¹æ³•ï¼Œä½¿ç”¨String#stripIndent()æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨String#stripMargin()æ–¹æ³•ï¼Œéœ€è¦ä¸€ä¸ªåˆ†éš”ç¬¦æ¥è¯†åˆ«æ–‡æœ¬ä»ä¸€ä¸ªå­—ç¬¦ä¸²çš„å¼€å§‹åˆ é™¤ã€‚ å½“åˆ›å»ºä¸€ä¸ªå¦‚ä¸‹å­—ç¬¦ä¸²ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> startingAndEndingWithANewline = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">line one</span><br><span class="hljs-string">line two</span><br><span class="hljs-string">line three</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><p>ä½ å°†è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²çš„ç»“æœåŒ…å«ä¸€ä¸ªæ¢è¡Œè½¬ä¹‰ç¬¦ä½œä¸ºç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚å®ƒå¯ä»¥é€šè¿‡ä½¿ç”¨åæ–œæ æ¢è¡Œç¬¦å‰¥ç¦»è¯¥å­—ç¬¦ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> strippedFirstNewline = <span class="hljs-string">&#x27;&#x27;&#x27;\</span><br><span class="hljs-string">line one</span><br><span class="hljs-string">line two</span><br><span class="hljs-string">line three</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">assert</span> !strippedFirstNewline.startsWith(<span class="hljs-string">&#x27;\n&#x27;</span>)<br></code></pre></td></tr></table></figure><h6 id="è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦"><a href="#è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦" class="headerlink" title="è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦"></a>è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦</h6><p>ä½ å¯ä»¥ä½¿ç”¨åæ–œæ å­—ç¬¦è½¬ä¹‰å•å¼•å·ï¼Œé¿å…ç»ˆæ­¢å­—ç¬¦ä¸²ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-string">&#x27;an escaped single quote: \&#x27; needs a backslash&#x27;</span><br></code></pre></td></tr></table></figure><p>ä½ èƒ½ä½¿ç”¨åŒåæ–œæ æ¥è½¬ä¹‰è½¬ä¹‰å­—ç¬¦è‡ªèº«ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-string">&#x27;an escaped escape character: \\ needs a double backslash&#x27;</span><br></code></pre></td></tr></table></figure><p>ä¸€äº›ç‰¹æ®Šå­—ç¬¦ä½¿ç”¨åæ–œæ ä½œä¸ºè½¬ä¹‰å­—ç¬¦ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xxx">è½¬ä¹‰åºåˆ—    å­—ç¬¦<br>&#x27;\t&#x27;        tabulation<br>&#x27;\b&#x27;        backspace<br>&#x27;\n&#x27;        newline<br>&#x27;\r&#x27;        carriage return<br>&#x27;\f&#x27;        formfeed<br>&#x27;\\&#x27;        backslash<br>&#x27;\&#x27;&#x27;        single quote (for single quoted and triple single quoted strings)<br>&#x27;\&quot;&#x27;        double quote (for double quoted and triple double quoted strings)<br></code></pre></td></tr></table></figure><h5 id="åŒå¼•å·å­—ç¬¦ä¸²"><a href="#åŒå¼•å·å­—ç¬¦ä¸²" class="headerlink" title="åŒå¼•å·å­—ç¬¦ä¸²"></a>åŒå¼•å·å­—ç¬¦ä¸²</h5><p>åŒå¼•å·å­—ç¬¦ä¸²æ˜¯ä¸€äº›åˆ—è¢«åŒå¼•å·åŒ…å›´çš„å­—ç¬¦ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-string">&quot;a double quoted string&quot;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰æ’å€¼è¡¨è¾¾å¼ï¼ŒåŒå¼•å·å­—ç¬¦ä¸²æ˜¯æ™®é€šçš„java.lang.Stringï¼Œå¦‚æœæ’å€¼å­˜åœ¨åˆ™æ˜¯groocy.lang.GStringå®ä¾‹ã€‚ ä¸ºäº†è½¬ä¹‰ä¸€ä¸ªåŒå¼•å·ï¼Œä½ èƒ½ä½¿ç”¨åæ–œæ å­—ç¬¦ï¼šâ€A double quote: \â€â€ã€‚</p><h6 id="å­—ç¬¦ä¸²æ’å€¼"><a href="#å­—ç¬¦ä¸²æ’å€¼" class="headerlink" title="å­—ç¬¦ä¸²æ’å€¼"></a>å­—ç¬¦ä¸²æ’å€¼</h6><p>ä»»ä½•Groovyè¡¨è¾¾å¼å¯ä»¥åœ¨æ‰€æœ‰å­—ç¬¦æ–‡æœ¬è¿›è¡Œæ’å€¼ï¼Œé™¤äº†å•å¼•å·å’Œä¸‰å•å¼•å·å­—ç¬¦ä¸²ã€‚æ’å€¼æ˜¯ä½¿ç”¨å ä½ç¬¦ä¸Šçš„å­—ç¬¦ä¸²è®¡ç®—å€¼æ›¿æ¢å ä½ç¬¦çš„æ“ä½œã€‚å ä½ç¬¦è¡¨è¾¾å¼æ˜¯è¢«<code>$&#123;&#125;</code>åŒ…å›´ï¼Œæˆ–å‰ç¼€ä¸º$çš„è¡¨è¾¾å¼ã€‚å½“GStringè¢«ä¼ é€’ç»™ä¸€ä¸ªå¸¦æœ‰ä¸€ä¸ªStringå‚æ•°çš„æ–¹æ³•æ—¶ï¼Œå ä½ç¬¦çš„è¡¨è¾¾å¼è¢«è®¡ç®—å€¼ï¼Œå¹¶é€šè¿‡è°ƒç”¨è¡¨è¾¾å¼çš„<code>toString()</code>æ–¹æ³•ä»¥å­—ç¬¦ä¸²å½¢å¼è¡¨ç¤ºã€‚ è¿™é‡Œæ˜¯ä¸€ä¸ªå ä½ç¬¦å¼•ç”¨å±€éƒ¨å˜é‡çš„å­—ç¬¦ä¸²ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> name = <span class="hljs-string">&#x27;Guillaume&#x27;</span> <span class="hljs-comment">// a plain string</span><br><span class="hljs-keyword">def</span> greeting = <span class="hljs-string">&quot;Hello $&#123;name&#125;&quot;</span><br><br><span class="hljs-keyword">assert</span> greeting.toString() == <span class="hljs-string">&#x27;Hello Guillaume&#x27;</span><br></code></pre></td></tr></table></figure><p>è€Œä¸”ä»»ä½•Groovyè¡¨è¾¾å¼æ˜¯åˆæ³•çš„ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨ç¤ºä¾‹ä¸­ä½¿ç”¨ç®—æ•°è¡¨è¾¾å¼æ‰€è§ä¸€æ ·:</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> sum = <span class="hljs-string">&quot;The sum of 2 and 3 equals $&#123;2 + 3&#125;&quot;</span><br><span class="hljs-keyword">assert</span> sum.toString() == <span class="hljs-string">&#x27;The sum of 2 and 3 equals 5&#x27;</span><br></code></pre></td></tr></table></figure><p>ä¸ä»…ä»»ä½•è¡¨è¾¾å¼ï¼Œå®é™…ä¸Šä¹Ÿå…è®¸${}å ä½ç¬¦ã€‚è¯­å¥ä¹Ÿæ˜¯è¢«å…è®¸çš„ï¼Œä½†ä¸€ä¸ªè¯­å¥ç­‰æ•ˆäºnullã€‚å¦‚æœæœ‰å¤šä¸ªè¯­å¥æ’å…¥å ä½ç¬¦ï¼Œé‚£ä¹ˆæœ€åä¸€ä¸ªè¯­å¥åº”è¯¥è¿”å›ä¸€ä¸ªæœ‰æ„ä¹‰çš„å€¼è¢«æ’å…¥å ä½ç¬¦ã€‚ä¾‹å¦‚ï¼Œâ€The sum of 1 and 2 is equal to ${def a &#x3D; 1; def b &#x3D; 2; a + b}â€å­—ç¬¦ä¸²æ˜¯è¢«æ”¯æŒçš„ï¼Œä¹Ÿèƒ½å¦‚é¢„æœŸä¸€æ ·å·¥ä½œï¼Œä½†ä¸€ä¸ªå¥½çš„å®è·µæ˜¯åœ¨GStringå ä½ç¬¦æ’å…¥ä¸€ä¸ªç®€å•çš„è¡¨è¾¾å¼ã€‚</p><p> é™¤äº†<code>$&#123;&#125;</code>å ä½ç¬¦ä»¥å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨$ä½œä¸ºè¡¨è¾¾å¼å‰ç¼€ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> person = [<span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;Guillaume&#x27;</span>, <span class="hljs-attr">age:</span> <span class="hljs-number">36</span>]<br><span class="hljs-keyword">assert</span> <span class="hljs-string">&quot;$person.name is $person.age years old&quot;</span> == <span class="hljs-string">&#x27;Guillaume is 36 years old&#x27;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœåœ¨GStringä¸­ä½ éœ€è¦è½¬ä¹‰$æˆ–${}å ä½ç¬¦ï¼Œä½¿å®ƒä»¬ä¸å‡ºç°æ’å€¼ï¼Œé‚£ä¹ˆä½ åªéœ€è¦ä½¿ç”¨åæ–œæ å­—ç¬¦è½¬ä¹‰ç¾å…ƒç¬¦å·ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">assert</span> <span class="hljs-string">&#x27;$&#123;name&#125;&#x27;</span> == <span class="hljs-string">&quot;\$&#123;name&#125;&quot;</span><br></code></pre></td></tr></table></figure><h6 id="æ’å…¥é—­åŒ…è¡¨è¾¾å¼çš„ç‰¹æ®Šæƒ…å†µ"><a href="#æ’å…¥é—­åŒ…è¡¨è¾¾å¼çš„ç‰¹æ®Šæƒ…å†µ" class="headerlink" title="æ’å…¥é—­åŒ…è¡¨è¾¾å¼çš„ç‰¹æ®Šæƒ…å†µ"></a>æ’å…¥é—­åŒ…è¡¨è¾¾å¼çš„ç‰¹æ®Šæƒ…å†µ</h6><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä»…ä»…çœ‹åˆ°åœ¨<code>$&#123;&#125;</code>å ä½ç¬¦ä¸­æ’å…¥ä»»æ„è¡¨è¾¾å¼ï¼Œä½†ä¸€ä¸ªé—­åŒ…è¡¨è¾¾å¼æ ‡è®°çš„ç‰¹æ®Šæƒ…å†µã€‚å½“å ä½ç¬¦åŒ…æ‹¬ä¸€ä¸ªç®­å¤´<code>$&#123;-&gt;&#125;</code>,è¿™è¡¨è¾¾å¼å®é™…æ˜¯ä¸€ä¸ªé—­åŒ…è¡¨è¾¾å¼ï¼Œä½ å¯ä»¥æŠŠå®ƒçœ‹åšä¸€ä¸ªå‰é¢ç´§é ç¾å…ƒç¬¦å·çš„é—­åŒ…ï¼š </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> sParameterLessClosure = <span class="hljs-string">&quot;1 + 2 == $&#123;-&gt; 3&#125;&quot;</span> ï¼ˆ<span class="hljs-number">1</span>ï¼‰<br><span class="hljs-keyword">assert</span> sParameterLessClosure == <span class="hljs-string">&#x27;1 + 2 == 3&#x27;</span><br><br><span class="hljs-keyword">def</span> sOneParamClosure = <span class="hljs-string">&quot;1 + 2 == $&#123; w -&gt; w &lt;&lt; 3&#125;&quot;</span> ï¼ˆ<span class="hljs-number">2</span>ï¼‰<br><span class="hljs-keyword">assert</span> sOneParamClosure == <span class="hljs-string">&#x27;1 + 2 == 3&#x27;</span><br></code></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰è¿™æ˜¯ä¸€ä¸ªä¸æºå¸¦å‚æ•°çš„æ— å‚é—­åŒ…<br>ï¼ˆ2ï¼‰è¿™é‡Œçš„é—­åŒ…æºå¸¦ä¸€ä¸ªjava.io.StringWriteå‚æ•°ï¼Œä½ èƒ½ä½¿ç”¨&lt;&lt;è¿½åŠ å†…å®¹ã€‚åœ¨è¿™ä¸¤å¤„ï¼Œå ä½ç¬¦è¢«åµŒå…¥é—­åŒ…ã€‚</p><p>åœ¨å¤–è§‚ä¸Šï¼Œå®šä¹‰ä¸€ä¸ªè¡¨è¾¾å¼è¢«æ’å…¥çœ‹ç€æœ‰ä¸€äº›å†—é•¿ï¼Œä½†é—­åŒ…ç›¸æ¯”è¡¨è¾¾å¼æœ‰ä¸€ä¸ªæœ‰è¶£çš„ä¼˜åŠ¿ï¼šå»¶è¿Ÿè®¡ç®—ã€‚<br>è®©æˆ‘ä»¬æ€è€ƒå¦‚ä¸‹ç¤ºä¾‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> number = <span class="hljs-number">1</span> ï¼ˆ<span class="hljs-number">1</span>ï¼‰<br><span class="hljs-keyword">def</span> eagerGString = <span class="hljs-string">&quot;value == $&#123;number&#125;&quot;</span><br><span class="hljs-keyword">def</span> lazyGString = <span class="hljs-string">&quot;value == $&#123; -&gt; number &#125;&quot;</span><br><br><span class="hljs-keyword">assert</span> eagerGString == <span class="hljs-string">&quot;value == 1&quot;</span> ï¼ˆ<span class="hljs-number">2</span>ï¼‰<br><span class="hljs-keyword">assert</span> lazyGString == <span class="hljs-string">&quot;value == 1&quot;</span> ï¼ˆ<span class="hljs-number">3</span>ï¼‰<br><br>number = <span class="hljs-number">2</span> ï¼ˆ<span class="hljs-number">4</span>ï¼‰<br><span class="hljs-keyword">assert</span> eagerGString == <span class="hljs-string">&quot;value == 1&quot;</span> ï¼ˆ<span class="hljs-number">5</span>ï¼‰<br><span class="hljs-keyword">assert</span> lazyGString == <span class="hljs-string">&quot;value == 2&quot;</span> ï¼ˆ<span class="hljs-number">6</span>ï¼‰<br></code></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåŒ…å«1çš„numberå˜é‡ï¼Œç„¶åæ’å…¥ä¸¤ä¸ªGStringä¹‹ä¸­ï¼Œåœ¨eagerGStringä¸­ä½œä¸ºè¡¨è¾¾å¼ï¼Œåœ¨lazyGStringä¸­ä½œä¸ºé—­åŒ…ã€‚<br>ï¼ˆ2ï¼‰æˆ‘ä»¬æœŸæœ›å¯¹äºeagerGStringå¾—åˆ°çš„ç»“æœå­—ç¬¦ä¸²æ˜¯åŒ…å«1çš„ç›¸åŒå­—ç¬¦ä¸²<br>ï¼ˆ3ï¼‰lazyGStringç›¸ä¼¼<br>ï¼ˆ4ï¼‰ç„¶åç»™å˜é‡èµ‹ä¸€ä¸ªæ–°å€¼<br>ï¼ˆ5ï¼‰ä½¿ç”¨çº¯æ’å€¼è¡¨è¾¾å¼ï¼Œè¿™å€¼åœ¨GStringåˆ›å»ºæ—¶ç»“åˆ<br>ï¼ˆ6ï¼‰ä½†ä½¿ç”¨é—­åŒ…è¡¨è¾¾å¼ï¼ŒGStringè¢«å¼ºè½¬ä¸ºSringæ—¶ï¼Œé—­åŒ…è¢«è°ƒç”¨ï¼Œå¹¶äº§ç”ŸåŒ…å«æ–°æ•°å€¼çš„æ›´æ–°å­—ç¬¦ä¸²ã€‚<br>ä¸€ä¸ªåµŒå…¥çš„é—­åŒ…è¡¨è¾¾å¼ï¼Œæºå¸¦è¶…è¿‡ä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆåœ¨è¿è¡Œæ—¶å°†ä¼šäº§ç”Ÿä¸€ä¸ªå¼‚å¸¸ã€‚é—­åŒ…ä»…ä»…å…è®¸æºå¸¦0ä¸ªæˆ–1ä¸ªå‚æ•°ã€‚</p><h6 id="ä¸Javaçš„äº’æ“ä½œæ€§"><a href="#ä¸Javaçš„äº’æ“ä½œæ€§" class="headerlink" title="ä¸Javaçš„äº’æ“ä½œæ€§"></a>ä¸Javaçš„äº’æ“ä½œæ€§</h6><p>å½“ä¸€ä¸ªæ–¹æ³•ï¼ˆæ— è®ºæ˜¯åœ¨Javaæˆ–æ˜¯Groovyä¸­å®ç°ï¼‰é¢„æœŸéœ€è¦ä¸€ä¸ªjava.lang.Stringï¼Œè€Œæˆ‘ä»¬ä¼ é€’äº†ä¸€ä¸ªgroovy.lang.GStringå®ä¾‹ï¼ŒGStringçš„toString()æ–¹æ³•å°†ä¼šè¢«è‡ªåŠ¨é€æ˜çš„è°ƒç”¨ã€‚ </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs groovy">String takeString(String message) &#123; ï¼ˆ<span class="hljs-number">4</span>ï¼‰<br>  <span class="hljs-keyword">assert</span> message <span class="hljs-keyword">instanceof</span> String ï¼ˆ<span class="hljs-number">5</span>ï¼‰<br>  <span class="hljs-keyword">return</span> message<br>&#125;<br><br><span class="hljs-keyword">def</span> message = <span class="hljs-string">&quot;The message is $&#123;&#x27;hello&#x27;&#125;&quot;</span> ï¼ˆ<span class="hljs-number">1</span>ï¼‰<br><span class="hljs-keyword">assert</span> message <span class="hljs-keyword">instanceof</span> GString ï¼ˆ<span class="hljs-number">2</span>ï¼‰<br><br><span class="hljs-keyword">def</span> result = takeString(message) ï¼ˆ<span class="hljs-number">3</span>ï¼‰<br><span class="hljs-keyword">assert</span> result <span class="hljs-keyword">instanceof</span> String<br><span class="hljs-keyword">assert</span> result == <span class="hljs-string">&#x27;The message is hello&#x27;</span><br></code></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªGSringå˜é‡ </p><p>ï¼ˆ2ï¼‰æˆ‘ä»¬ä»”ç»†æ£€æŸ¥GStringå®ä¾‹ </p><p>ï¼ˆ3ï¼‰æˆ‘ä»¬å°†GStringä¼ é€’ä¸ªä¸€ä¸ªæºå¸¦Stringå‚æ•°çš„æ–¹æ³• </p><p>ï¼ˆ4ï¼‰takeString()æ˜ç¡®è¯´æ˜å®ƒçš„å”¯ä¸€å‚æ•°æ˜¯ä¸€ä¸ªString </p><p>ï¼ˆ5ï¼‰æˆ‘ä»¬ä¹ŸéªŒè¯ä¸€ä¸ªå‚æ•°æ˜¯Stringè€Œä¸æ˜¯GString </p><h6 id="GStringå’ŒStringçš„hashCode"><a href="#GStringå’ŒStringçš„hashCode" class="headerlink" title="GStringå’ŒStringçš„hashCode"></a>GStringå’ŒStringçš„hashCode</h6><p>è™½ç„¶æ’å€¼å­—ç¬¦ä¸²å¯ä»¥ä»£æ›¿æ™®é€šJavaå­—ç¬¦ä¸²ï¼Œå®ƒä»¬ç”¨ä¸€ç§ä¸åŒçš„æ–¹å¼æ˜¯å­—ç¬¦ä¸²ä¸åŒï¼šå®ƒä»¬çš„hashCodeæ˜¯ä¸åŒçš„ã€‚æ™®é€šJavaå­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œè€Œä¸€ä¸ªGStringä¾èµ–äºæ’å…¥çš„å€¼ï¼Œå®ƒçš„Stringæ˜¯å¯å˜çš„ã€‚å³ä½¿æœ‰ç›¸åŒçš„å­—ç¬¦ä¸²ç»“æœï¼ŒGStringå’ŒStringä¹Ÿæ²¡æœ‰ç›¸åŒçš„hashCodeã€‚ </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">assert</span> <span class="hljs-string">&quot;one: $&#123;1&#125;&quot;</span>.hashCode() != <span class="hljs-string">&quot;one: 1&quot;</span>.hashCode()<br></code></pre></td></tr></table></figure><p>GStringå’ŒStringæœ‰ä¸åŒçš„hashCodeå€¼ï¼Œåº”è¯¥é¿å…ä½¿ç”¨GSringä½œä¸ºMapçš„é”®å€¼ï¼Œæˆ‘ä»¬ä½¿ç”¨Stringä»£æ›¿GStringå–å‡ºä¸€ä¸ªå…³è”å€¼ã€‚ </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> key = <span class="hljs-string">&quot;a&quot;</span><br><span class="hljs-keyword">def</span> m = [<span class="hljs-string">&quot;$&#123;key&#125;&quot;</span>: <span class="hljs-string">&quot;letter $&#123;key&#125;&quot;</span>] ï¼ˆ<span class="hljs-number">1</span>ï¼‰<br><br><span class="hljs-keyword">assert</span> m[<span class="hljs-string">&quot;a&quot;</span>] == <span class="hljs-literal">null</span> ï¼ˆ<span class="hljs-number">2</span>ï¼‰<br></code></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰mapè¢«ä¸€ä¸ªåˆå§‹åŒ–é”®å€¼å¯¹åˆ›å»ºï¼Œå…¶é”®å€¼æ˜¯GString </p><p>ï¼ˆ2ï¼‰å½“æˆ‘ä»¬å°è¯•ä½¿ç”¨Stringé”®å€¼è·å–å€¼æ—¶ï¼Œæˆ‘ä»¬å¹¶æ²¡è·å–å¯¹åº”å€¼ï¼Œå› ä¸ºStringå’ŒGStringæœ‰ä¸åŒçš„hashCode </p><h5 id="ä¸‰åŒå¼•å·å­—ç¬¦ä¸²"><a href="#ä¸‰åŒå¼•å·å­—ç¬¦ä¸²" class="headerlink" title="ä¸‰åŒå¼•å·å­—ç¬¦ä¸²"></a>ä¸‰åŒå¼•å·å­—ç¬¦ä¸²</h5><p>ä¸‰åŒå¼•å·å­—ç¬¦ä¸²ä¸åŒå¼•å·å­—ç¬¦ä¸²ç›¸åŒï¼Œå¢åŠ å¤šè¡Œï¼Œåƒä¸‰å•å¼•å·å­—ç¬¦ä¸²ä¸€æ ·ã€‚ </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> name = <span class="hljs-string">&#x27;Groovy&#x27;</span><br><span class="hljs-keyword">def</span> template = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">  Dear Mr $&#123;name&#125;,</span><br><span class="hljs-string"></span><br><span class="hljs-string">  You&#x27;re the winner of the lottery!</span><br><span class="hljs-string"></span><br><span class="hljs-string">  Yours sincerly,</span><br><span class="hljs-string"></span><br><span class="hljs-string">  Dave</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-keyword">assert</span> template.toString().contains(<span class="hljs-string">&#x27;Groovy&#x27;</span>)<br></code></pre></td></tr></table></figure><p>æ— è®ºæ˜¯åŒå¼•å·è¿˜æ˜¯å•å¼•å·ï¼Œåœ¨ä¸‰åŒå¼•å·å­—ç¬¦ä¸²ä¸­éœ€è¦è¢«è½¬ä¹‰ã€‚ </p><h5 id="æ–œæ å­—ç¬¦ä¸²"><a href="#æ–œæ å­—ç¬¦ä¸²" class="headerlink" title="æ–œæ å­—ç¬¦ä¸²"></a>æ–œæ å­—ç¬¦ä¸²</h5><p>é™¤äº†é€šå¸¸çš„å¸¦å¼•å·å­—ç¬¦ä¸²ï¼Œgroovyæä¾›æ–œæ å­—ç¬¦ä¸²ï¼Œä½¿ç”¨&#x2F;ä½œä¸ºåˆ†éš”ç¬¦ã€‚æ–œæ å­—ç¬¦ä¸²å¯¹äºå®šä¹‰æ­£åˆ™è¡¨è¾¾å¼å’Œæ¨¡å¼æ˜¯ç‰¹åˆ«æœ‰ç”¨çš„ï¼Œå› ä¸ºä¸éœ€è¦è½¬ä¹‰åæ–œæ ã€‚ ä¸€ä¸ªæ–œæ å­—ç¬¦ä¸²ï¼š </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> fooPattern = <span class="hljs-regexp">/.*foo.*/</span><br><span class="hljs-keyword">assert</span> fooPattern == <span class="hljs-string">&#x27;.*foo.*&#x27;</span><br></code></pre></td></tr></table></figure><p>åªæœ‰æ­£æ–œæ éœ€è¦åæ–œæ è½¬ä¹‰ï¼š </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> escapeSlash = <span class="hljs-regexp">/The character \/</span> is a forward slash/<br><span class="hljs-keyword">assert</span> escapeSlash == <span class="hljs-string">&#x27;The character / is a forward slash&#x27;</span><br></code></pre></td></tr></table></figure><p>æ–œæ å­—ç¬¦ä¸²æ˜¯å¤šè¡Œçš„ï¼š </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> multilineSlashy = /one<br>two<br>three/<br><span class="hljs-keyword">assert</span> multilineSlashy.contains(<span class="hljs-string">&#x27;\n&#x27;</span>)<br></code></pre></td></tr></table></figure><p>æ–œæ å­—ç¬¦ä¸²ä¹Ÿèƒ½è¢«æ’å€¼ï¼ˆå¦‚ï¼ŒGStringï¼‰: </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> color = <span class="hljs-string">&#x27;blue&#x27;</span><br><span class="hljs-keyword">def</span> interpolatedSlashy = <span class="hljs-regexp">/a $&#123;color&#125; car/</span><br><br><span class="hljs-keyword">assert</span> interpolatedSlashy == <span class="hljs-string">&#x27;a blue car&#x27;</span><br></code></pre></td></tr></table></figure><p>æœ‰å‡ ä¸ªé™·é˜±éœ€è¦æ³¨æ„ï¼š ä¸€ä¸ªç©ºçš„æ–œæ å­—ç¬¦ä¸²ä¸èƒ½ä½¿ç”¨åŒæ­£æ–œæ è¡¨ç¤ºï¼Œå› ä¸ºå®ƒè¢«Groovyè§£æå™¨ä½œä¸ºä¸€ä¸ªå•è¡Œæ³¨é‡Šç†è§£ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä»¥ä¸‹æ–­è¨€å®é™…ä¸Šæ— æ³•ç¼–è¯‘ï¼Œå› ä¸ºå®ƒçœ‹èµ·æ¥åƒä¸€ä¸ªæ— ç»ˆæ­¢çš„è¯­å¥ï¼š </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">assert</span> <span class="hljs-string">&#x27;&#x27;</span> == <span class="hljs-comment">//</span><br></code></pre></td></tr></table></figure><h5 id="ç¾å…ƒç¬¦ä¿®é¥°çš„æ–œæ å­—ç¬¦ä¸²"><a href="#ç¾å…ƒç¬¦ä¿®é¥°çš„æ–œæ å­—ç¬¦ä¸²" class="headerlink" title="ç¾å…ƒç¬¦ä¿®é¥°çš„æ–œæ å­—ç¬¦ä¸²"></a>ç¾å…ƒç¬¦ä¿®é¥°çš„æ–œæ å­—ç¬¦ä¸²</h5><p>ç¾å…ƒç¬¦æ–œæ å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªæœ‰å¼€å£$&#x2F;å’Œé—­å£$&#x2F;ç•Œå®šçš„å¤šè¡ŒGStringã€‚è¿™è½¬ä¹‰å­—ç¬¦æ˜¯ç¾å…ƒç¬¦ï¼Œå®ƒèƒ½è½¬ä¹‰å¦ä¸€ä¸ªç¾å…ƒç¬¦ï¼Œæˆ–ä¸€ä¸ªæ­£æ–œæ ã€‚ä½†æ˜¯åŒç¾å…ƒç¬¦å’ŒåŒæ­£æ–œæ ä¸ç”¨è¢«è½¬ä¹‰ï¼Œé™¤äº†è½¬ä¹‰åƒGStringå ä½ç¬¦åºåˆ—å¼€å§‹çš„å­—ç¬¦ä¸²å­åºåˆ—çš„ç¾å…ƒç¬¦ï¼Œæˆ–è€…ä½ éœ€è¦è½¬ä¹‰ä¸€ä¸ªåºåˆ—ï¼Œå¼€å¤´çœ‹ç€åƒé—­åŒ…ç¾å…ƒç¬¦æ–œæ å­—ç¬¦ä¸²åˆ†éš”ç¬¦ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> name = <span class="hljs-string">&quot;Guillaume&quot;</span><br><span class="hljs-keyword">def</span> date = <span class="hljs-string">&quot;April, 1st&quot;</span><br><br><span class="hljs-keyword">def</span> dollarSlashy = <span class="hljs-string">$/</span><br><span class="hljs-string">  Hello $name,</span><br><span class="hljs-string">  today we&#x27;re $&#123;date&#125;.</span><br><span class="hljs-string"></span><br><span class="hljs-string">  $ dollar sign</span><br><span class="hljs-string">  $$ escaped dollar sign</span><br><span class="hljs-string">  \ backslash</span><br><span class="hljs-string">  / forward slash</span><br><span class="hljs-string">  $/ escaped forward slash</span><br><span class="hljs-string">  $/$</span> escaped dollar slashy string delimiter<br>/$<br><br><span class="hljs-keyword">assert</span> [<br>  <span class="hljs-string">&#x27;Guillaume&#x27;</span>,<br>  <span class="hljs-string">&#x27;April, 1st&#x27;</span>,<br>  <span class="hljs-string">&#x27;$ dollar sign&#x27;</span>,<br>  <span class="hljs-string">&#x27;$ escaped dollar sign&#x27;</span>,<br>  <span class="hljs-string">&#x27;\\ backslash&#x27;</span>,<br>  <span class="hljs-string">&#x27;/ forward slash&#x27;</span>,<br>  <span class="hljs-string">&#x27;$/ escaped forward slash&#x27;</span>,<br>  <span class="hljs-string">&#x27;/$ escaped dollar slashy string delimiter&#x27;</span><br><br>].each &#123; dollarSlashy.contains(it) &#125;<br></code></pre></td></tr></table></figure><h5 id="å­—ç¬¦ä¸²æ€»ç»“è¡¨"><a href="#å­—ç¬¦ä¸²æ€»ç»“è¡¨" class="headerlink" title="å­—ç¬¦ä¸²æ€»ç»“è¡¨"></a>å­—ç¬¦ä¸²æ€»ç»“è¡¨</h5><table><thead><tr><th align="center">String name</th><th align="center">String syntax</th><th align="center">Interpolated</th><th align="center">Multiline</th><th align="center">Escape character</th></tr></thead><tbody><tr><td align="center">Single quoted</td><td align="center">â€˜â€¦â€™</td><td align="center"></td><td align="center"></td><td align="center">|</td></tr><tr><td align="center">Triple single quoted</td><td align="center">â€˜â€™â€™â€¦â€™â€™â€™</td><td align="center"></td><td align="center">æ˜¯</td><td align="center">|</td></tr><tr><td align="center">Double quoted</td><td align="center">â€œâ€¦â€</td><td align="center">æ˜¯</td><td align="center"></td><td align="center">|</td></tr><tr><td align="center">Triple double quoted</td><td align="center">â€œâ€â€â€¦â€â€â€</td><td align="center">æ˜¯</td><td align="center">æ˜¯</td><td align="center">|</td></tr><tr><td align="center">slashy</td><td align="center">&#x2F;â€¦&#x2F;</td><td align="center">æ˜¯</td><td align="center">æ˜¯</td><td align="center">|</td></tr><tr><td align="center">Dollar</td><td align="center">$&#x2F;â€¦&#x2F;$</td><td align="center">æ˜¯</td><td align="center">æ˜¯</td><td align="center">|</td></tr></tbody></table><h5 id="å­—ç¬¦"><a href="#å­—ç¬¦" class="headerlink" title="å­—ç¬¦"></a>å­—ç¬¦</h5><p>ä¸Javaä¸åŒï¼ŒGroovyæ²¡æœ‰æ˜¾å¼çš„å­—ç¬¦æ–‡æœ¬ï¼Œç„¶è€Œä½ å¯ä»¥é€šè¿‡ä¸‰ç§ä¸åŒæ–¹å¼ï¼Œå¯ä»¥å°†Groovyå­—ç¬¦ä¸²å®é™…ä½œä¸ºä¸€ä¸ªå­—ç¬¦ä½¿ç”¨ã€‚ </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-type">char</span> c1 = <span class="hljs-string">&#x27;A&#x27;</span> ï¼ˆ<span class="hljs-number">1</span>ï¼‰<br><span class="hljs-keyword">assert</span> c1 <span class="hljs-keyword">instanceof</span> Character<br><br><span class="hljs-keyword">def</span> c2 = <span class="hljs-string">&#x27;B&#x27;</span> <span class="hljs-keyword">as</span> <span class="hljs-type">char</span> ï¼ˆ<span class="hljs-number">2</span>ï¼‰<br><span class="hljs-keyword">assert</span> c2 <span class="hljs-keyword">instanceof</span> Character<br><br><span class="hljs-keyword">def</span> c3 = (<span class="hljs-type">char</span>)<span class="hljs-string">&#x27;C&#x27;</span> ï¼ˆ<span class="hljs-number">3</span>ï¼‰<br><span class="hljs-keyword">assert</span> c3 <span class="hljs-keyword">instanceof</span> Character<br></code></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰å½“å®šä¹‰å˜é‡æ—¶ï¼Œé€šè¿‡æŒ‡å®šcharç±»å‹ï¼Œä½¿å˜é‡åŒ…å«å­—ç¬¦ </p><p>ï¼ˆ2ï¼‰é€šè¿‡asæ“ä½œç¬¦ä½¿ç”¨ç±»å‹å¼ºåˆ¶è½¬æ¢ </p><p>ï¼ˆ3ï¼‰é€šè¿‡charæ“ä½œç¬¦åšç±»å‹è½¬æ¢ </p><p>ç¬¬ä¸€ä¸ªé€‰é¡¹æ˜¯ï¼ˆ1ï¼‰æœ‰è¶£çš„å½“ä¸€ä¸ªå­—ç¬¦åœ¨ä¸€ä¸ªå˜é‡ä¸­ï¼Œè€Œå¦å¤–ä¸¤ä¸ªï¼ˆ2å’Œ3ï¼‰æ˜¯æ›´ä»¤äººå…³æ³¨æ—¶charå€¼å¿…é¡»ä½œä¸ºä¸€ä¸ªæ–¹æ³•è°ƒç”¨çš„å‚æ•°ã€‚ </p><h4 id="æ•°å­—"><a href="#æ•°å­—" class="headerlink" title="æ•°å­—"></a>æ•°å­—</h4><p>Groovyæ”¯æŒä¸åŒç±»å‹çš„æ•´æ•°å’Œå°æ•°ï¼Œé€šå¸¸ä»¥Javaçš„Numberç±»å‹è¿”å›ã€‚ </p><h5 id="æ•´æ•°"><a href="#æ•´æ•°" class="headerlink" title="æ•´æ•°"></a>æ•´æ•°</h5><p>æ•´æ•°ç±»å‹ä¸Javaç›¸åŒï¼š</p><ul><li>byte</li><li>char</li><li>short</li><li>int</li><li>long</li><li>java.lang.BigInteger<br>ä½ èƒ½ä»¥å¦‚ä¸‹å®šä¹‰åˆ›å»ºè¿™äº›ç±»å‹çš„æ•´æ•°ï¼š<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">// primitive types</span><br><span class="hljs-type">byte</span> b = <span class="hljs-number">1</span><br><span class="hljs-type">char</span> c = <span class="hljs-number">2</span><br><span class="hljs-type">short</span> s = <span class="hljs-number">3</span><br><span class="hljs-type">int</span> i = <span class="hljs-number">4</span><br><span class="hljs-type">long</span> l = <span class="hljs-number">5</span><br><br><span class="hljs-comment">// infinite precision</span><br>BigInteger bi = <span class="hljs-number">6</span><br></code></pre></td></tr></table></figure>å¦‚æœä½ é€šè¿‡ä½¿ç”¨defå…³é”®å­—ä½¿ç”¨å¯é€‰ç±»å‹ï¼Œé‚£ä¹ˆæ•´æ•°çš„ç±»å‹å°†æ˜¯å¯å˜çš„ï¼šå®ƒå–å†³äºè¿™ä¸ªç±»å‹å®é™…åŒ…å«çš„å€¼ã€‚</li></ul><p>å¯¹äºæ­£æ•°ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> a = <span class="hljs-number">1</span><br><span class="hljs-keyword">assert</span> a <span class="hljs-keyword">instanceof</span> Integer<br><br><span class="hljs-comment">// Integer.MAX_VALUE</span><br><span class="hljs-keyword">def</span> b = <span class="hljs-number">2147483647</span><br><span class="hljs-keyword">assert</span> b <span class="hljs-keyword">instanceof</span> Integer<br><br><span class="hljs-comment">// Integer.MAX_VALUE + 1</span><br><span class="hljs-keyword">def</span> c = <span class="hljs-number">2147483648</span><br><span class="hljs-keyword">assert</span> c <span class="hljs-keyword">instanceof</span> Long<br><br><span class="hljs-comment">// Long.MAX_VALUE</span><br><span class="hljs-keyword">def</span> d = <span class="hljs-number">9223372036854775807</span><br><span class="hljs-keyword">assert</span> d <span class="hljs-keyword">instanceof</span> Long<br><br><span class="hljs-comment">// Long.MAX_VALUE + 1</span><br><span class="hljs-keyword">def</span> e = <span class="hljs-number">9223372036854775808</span><br><span class="hljs-keyword">assert</span> e <span class="hljs-keyword">instanceof</span> BigInteger<br></code></pre></td></tr></table></figure><p>å¯¹äºè´Ÿæ•°ä¹Ÿä¸€æ ·ï¼š </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> na = <span class="hljs-number">-1</span><br><span class="hljs-keyword">assert</span> na <span class="hljs-keyword">instanceof</span> Integer<br><br><span class="hljs-comment">// Integer.MIN_VALUE</span><br><span class="hljs-keyword">def</span> nb = <span class="hljs-number">-2147483648</span><br><span class="hljs-keyword">assert</span> nb <span class="hljs-keyword">instanceof</span> Integer<br><br><span class="hljs-comment">// Integer.MIN_VALUE - 1</span><br><span class="hljs-keyword">def</span> nc = <span class="hljs-number">-2147483649</span><br><span class="hljs-keyword">assert</span> nc <span class="hljs-keyword">instanceof</span> Long<br><br><span class="hljs-comment">// Long.MIN_VALUE</span><br><span class="hljs-keyword">def</span> nd = <span class="hljs-number">-9223372036854775808</span><br><span class="hljs-keyword">assert</span> nd <span class="hljs-keyword">instanceof</span> Long<br><br><span class="hljs-comment">// Long.MIN_VALUE - 1</span><br><span class="hljs-keyword">def</span> ne = <span class="hljs-number">-9223372036854775809</span><br><span class="hljs-keyword">assert</span> ne <span class="hljs-keyword">instanceof</span> BigInteger<br></code></pre></td></tr></table></figure><h6 id="å¯é€‰æ‹©çš„éåè¿›åˆ¶è¡¨ç¤º"><a href="#å¯é€‰æ‹©çš„éåè¿›åˆ¶è¡¨ç¤º" class="headerlink" title="å¯é€‰æ‹©çš„éåè¿›åˆ¶è¡¨ç¤º"></a>å¯é€‰æ‹©çš„éåè¿›åˆ¶è¡¨ç¤º</h6><p>äºŒè¿›åˆ¶æ•° </p><p>åœ¨Java6åŠä»¥å‰å’ŒGroovyä¸€æ ·ï¼Œæ•°å­—åªèƒ½ä½¿ç”¨åè¿›åˆ¶ï¼Œå…«è¿›åˆ¶å’Œåå…­è¿›åˆ¶è¡¨ç¤ºï¼Œä½¿ç”¨Java7å’ŒGroovy2ä½ èƒ½ä½¿ç”¨0bå‰ç¼€ä½œä¸ºä¸€ä¸ªäºŒè¿›åˆ¶ç¬¦å·ï¼š </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-type">int</span> xInt = <span class="hljs-number">0b10101111</span><br><span class="hljs-keyword">assert</span> xInt == <span class="hljs-number">175</span><br><br><span class="hljs-type">short</span> xShort = <span class="hljs-number">0b11001001</span><br><span class="hljs-keyword">assert</span> xShort == <span class="hljs-number">201</span> <span class="hljs-keyword">as</span> <span class="hljs-type">short</span><br><br><span class="hljs-type">byte</span> xByte = <span class="hljs-number">0b11</span><br><span class="hljs-keyword">assert</span> xByte == <span class="hljs-number">3</span> <span class="hljs-keyword">as</span> <span class="hljs-type">byte</span><br><br><span class="hljs-type">long</span> xLong = <span class="hljs-number">0b101101101101</span><br><span class="hljs-keyword">assert</span> xLong == <span class="hljs-number">2925</span>l<br><br>BigInteger xBigInteger = <span class="hljs-number">0b111100100001</span><br><span class="hljs-keyword">assert</span> xBigInteger == <span class="hljs-number">3873</span>g<br><br><span class="hljs-type">int</span> xNegativeInt = <span class="hljs-number">-0</span>b10101111<br><span class="hljs-keyword">assert</span> xNegativeInt == <span class="hljs-number">-175</span><br></code></pre></td></tr></table></figure><p>å…«è¿›åˆ¶æ•°</p><p>å…«è¿›åˆ¶æ•°ä½¿ç”¨0åé¢è·Ÿå…«è¿›åˆ¶æ•°çš„å…¸å‹æ ¼å¼è¡¨ç¤ºã€‚ </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-type">int</span> xInt = <span class="hljs-number">077</span><br><span class="hljs-keyword">assert</span> xInt == <span class="hljs-number">63</span><br><br><span class="hljs-type">short</span> xShort = <span class="hljs-number">011</span><br><span class="hljs-keyword">assert</span> xShort == <span class="hljs-number">9</span> <span class="hljs-keyword">as</span> <span class="hljs-type">short</span><br><br><span class="hljs-type">byte</span> xByte = <span class="hljs-number">032</span><br><span class="hljs-keyword">assert</span> xByte == <span class="hljs-number">26</span> <span class="hljs-keyword">as</span> <span class="hljs-type">byte</span><br><br><span class="hljs-type">long</span> xLong = <span class="hljs-number">0246</span><br><span class="hljs-keyword">assert</span> xLong == <span class="hljs-number">166</span>l<br><br>BigInteger xBigInteger = <span class="hljs-number">01111</span><br><span class="hljs-keyword">assert</span> xBigInteger == <span class="hljs-number">585</span>g<br><br><span class="hljs-type">int</span> xNegativeInt = <span class="hljs-number">-077</span><br><span class="hljs-keyword">assert</span> xNegativeInt == <span class="hljs-number">-63</span><br></code></pre></td></tr></table></figure><p>åå…­è¿›åˆ¶æ•° </p><p>åå…­è¿›åˆ¶æ•°ä½¿ç”¨0xåé¢è·Ÿåå…­è¿›åˆ¶æ•°çš„å…¸å‹æ ¼å¼è¡¨ç¤ºã€‚ </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-type">int</span> xInt = <span class="hljs-number">0x77</span><br><span class="hljs-keyword">assert</span> xInt == <span class="hljs-number">119</span><br><br><span class="hljs-type">short</span> xShort = <span class="hljs-number">0xaa</span><br><span class="hljs-keyword">assert</span> xShort == <span class="hljs-number">170</span> <span class="hljs-keyword">as</span> <span class="hljs-type">short</span><br><br><span class="hljs-type">byte</span> xByte = <span class="hljs-number">0x3a</span><br><span class="hljs-keyword">assert</span> xByte == <span class="hljs-number">58</span> <span class="hljs-keyword">as</span> <span class="hljs-type">byte</span><br><br><span class="hljs-type">long</span> xLong = <span class="hljs-number">0xffff</span><br><span class="hljs-keyword">assert</span> xLong == <span class="hljs-number">65535</span>l<br><br>BigInteger xBigInteger = <span class="hljs-number">0xaaaa</span><br><span class="hljs-keyword">assert</span> xBigInteger == <span class="hljs-number">43690</span>g<br><br>Double xDouble = <span class="hljs-keyword">new</span> Double(<span class="hljs-string">&#x27;0x1.0p0&#x27;</span>)<br><span class="hljs-keyword">assert</span> xDouble == <span class="hljs-number">1.0</span>d<br><br><span class="hljs-type">int</span> xNegativeInt = <span class="hljs-number">-0x77</span><br><span class="hljs-keyword">assert</span> xNegativeInt == <span class="hljs-number">-119</span><br></code></pre></td></tr></table></figure><h5 id="å°æ•°"><a href="#å°æ•°" class="headerlink" title="å°æ•°"></a>å°æ•°</h5><p>å°æ•°ç±»å‹ä¸Javaä¸€æ ·ï¼š</p><ul><li>float</li><li>double</li><li>java.lang.BigDecimal</li></ul><p>ä½ èƒ½é‡‡ç”¨å¦‚ä¸‹å®šä¹‰æ–¹å¼åˆ›å»ºè¿™äº›ç±»å‹çš„æ•°å­—ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">// primitive types</span><br><span class="hljs-type">float</span> f = <span class="hljs-number">1.234</span><br><span class="hljs-type">double</span> d = <span class="hljs-number">2.345</span><br><br><span class="hljs-comment">// infinite precision</span><br>BigDecimal bd = <span class="hljs-number">3.456</span><br></code></pre></td></tr></table></figure><p>å°æ•°èƒ½ä½¿ç”¨æŒ‡æ•°ï¼Œä½¿ç”¨eæˆ–EæŒ‡æ•°å­—æ¯ï¼Œç´§è·Ÿç€ä¸€ä¸ªå¯é€‰ç¬¦å·ï¼Œä¸”æœ‰ä¸€ä¸ªæ•´æ•°è¡¨ç¤º<br>æŒ‡æ•°ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">assert</span> <span class="hljs-number">1e3</span> == <span class="hljs-number">1</span>_000<span class="hljs-number">.0</span><br><span class="hljs-keyword">assert</span> <span class="hljs-number">2E4</span> == <span class="hljs-number">20</span>_000<span class="hljs-number">.0</span><br><span class="hljs-keyword">assert</span> <span class="hljs-number">3e+1</span> == <span class="hljs-number">30.0</span><br><span class="hljs-keyword">assert</span> <span class="hljs-number">4E-2</span> == <span class="hljs-number">0.04</span><br><span class="hljs-keyword">assert</span> <span class="hljs-number">5e-1</span> == <span class="hljs-number">0.5</span><br></code></pre></td></tr></table></figure><p>ä¸ºäº†ç²¾ç¡®çš„è¿›è¡Œå°æ•°è®¡ç®—ï¼ŒGroovyé€‰æ‹©java.lang.BigDecimalä½œä¸ºå°æ•°ç±»å‹ã€‚æ­¤å¤–ï¼Œfloatå’Œdoubleä¹Ÿè¢«æ”¯æŒï¼Œä½†è¦æ±‚æœ‰ä¸€ä¸ªæ˜¾å¼ç±»å‹å®šä¹‰ï¼Œç±»å‹è½¬æ¢æˆ–åç¼€ã€‚å³ä½¿BigDecimalæ˜¯é»˜è®¤çš„å°æ•°ï¼Œæºå¸¦floatæˆ–doubleä½œä¸ºç±»å‹å‚æ•°çš„æ–¹æ³•æˆ–é—­åŒ…ä¹Ÿå¯ä»¥æ¥å—è¿™äº›æ•°å€¼ã€‚<br>å°æ•°ä¸èƒ½ä½¿ç”¨äºŒè¿›åˆ¶ï¼Œå…«è¿›åˆ¶å’Œåå…­è¿›åˆ¶è¡¨ç¤ºã€‚</p><h5 id="æœ‰ä¸‹åˆ’çº¿çš„æ–‡æœ¬"><a href="#æœ‰ä¸‹åˆ’çº¿çš„æ–‡æœ¬" class="headerlink" title="æœ‰ä¸‹åˆ’çº¿çš„æ–‡æœ¬"></a>æœ‰ä¸‹åˆ’çº¿çš„æ–‡æœ¬</h5><p>å½“å†™ä¸€ä¸ªå¾ˆé•¿çš„æ•°å­—ï¼Œä½¿ç”¨çœ¼ç›å¾ˆéš¾å¼„æ¸…æ¥šæœ‰å¤šå°‘æ•°å­—ç»„åˆåœ¨ä¸€èµ·ï¼Œä¾‹å¦‚ä½¿ç”¨åƒï¼Œå•è¯ç­‰ç»„åˆã€‚é€šè¿‡å…è®¸ä½ åœ¨æ•°å­—ä¸­æ·»åŠ ä¸€äº›ä¸‹åˆ’çº¿ï¼Œæ›´å®¹æ˜“å‘ç°è¿™äº›ç»„åˆï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-type">long</span> creditCardNumber = <span class="hljs-number">1234</span>_5678_9012_3456L<br><span class="hljs-type">long</span> socialSecurityNumbers = <span class="hljs-number">999</span>_99_9999L<br><span class="hljs-type">double</span> monetaryAmount = <span class="hljs-number">12</span>_345_132<span class="hljs-number">.12</span><br><span class="hljs-type">long</span> hexBytes = <span class="hljs-number">0xFF</span>_EC_DE_5E<br><span class="hljs-type">long</span> hexWords = <span class="hljs-number">0xFFEC</span>_DE5E<br><span class="hljs-type">long</span> maxLong = <span class="hljs-number">0x7fff</span>_ffff_ffff_ffffL<br><span class="hljs-type">long</span> alsoMaxLong = <span class="hljs-number">9</span>_223_372_036_854_775_807L<br><span class="hljs-type">long</span> bytes = <span class="hljs-number">0b11010010</span>_01101001_10010100_10010010<br></code></pre></td></tr></table></figure><h5 id="æ•°å­—ç±»å‹åç¼€"><a href="#æ•°å­—ç±»å‹åç¼€" class="headerlink" title="æ•°å­—ç±»å‹åç¼€"></a>æ•°å­—ç±»å‹åç¼€</h5><p>é€šè¿‡ä½¿ç”¨å¤§å†™æˆ–å°å†™ç±»å‹åç¼€ï¼ˆè§ä¸‹è¡¨ï¼‰ï¼Œæˆ‘ä»¬èƒ½å¼ºåˆ¶å°†ä¸€ä¸ªæ•°å­—ï¼ˆåŒ…æ‹¬äºŒè¿›åˆ¶ï¼Œå…«è¿›åˆ¶ï¼Œåå…­è¿›åˆ¶ï¼‰ç»™ä¸€ä¸ªæŒ‡å®šç±»å‹ã€‚</p><table><thead><tr><th align="center">Type</th><th align="center">Suffix</th></tr></thead><tbody><tr><td align="center">BigInteger</td><td align="center">G æˆ– g</td></tr><tr><td align="center">Long</td><td align="center">L æˆ– l</td></tr><tr><td align="center">Integer</td><td align="center">I æˆ– i</td></tr><tr><td align="center">BigDecimal</td><td align="center">G æˆ– g</td></tr><tr><td align="center">Double</td><td align="center">D æˆ– d</td></tr><tr><td align="center">Float</td><td align="center">F æˆ– f</td></tr></tbody></table><p>å¦‚ï¼š </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">assert</span> <span class="hljs-number">42</span>I == <span class="hljs-keyword">new</span> Integer(<span class="hljs-string">&#x27;42&#x27;</span>)<br><span class="hljs-keyword">assert</span> <span class="hljs-number">42</span>i == <span class="hljs-keyword">new</span> Integer(<span class="hljs-string">&#x27;42&#x27;</span>) <span class="hljs-comment">// lowercase i more readable</span><br><span class="hljs-keyword">assert</span> <span class="hljs-number">123</span>L == <span class="hljs-keyword">new</span> Long(<span class="hljs-string">&quot;123&quot;</span>) <span class="hljs-comment">// uppercase L more readable</span><br><span class="hljs-keyword">assert</span> <span class="hljs-number">2147483648</span> == <span class="hljs-keyword">new</span> Long(<span class="hljs-string">&#x27;2147483648&#x27;</span>) <span class="hljs-comment">// Long type used, value too large for an Integer</span><br><span class="hljs-keyword">assert</span> <span class="hljs-number">456</span>G == <span class="hljs-keyword">new</span> BigInteger(<span class="hljs-string">&#x27;456&#x27;</span>)<br><span class="hljs-keyword">assert</span> <span class="hljs-number">456</span>g == <span class="hljs-keyword">new</span> BigInteger(<span class="hljs-string">&#x27;456&#x27;</span>)<br><span class="hljs-keyword">assert</span> <span class="hljs-number">123.45</span> == <span class="hljs-keyword">new</span> BigDecimal(<span class="hljs-string">&#x27;123.45&#x27;</span>) <span class="hljs-comment">// default BigDecimal type used</span><br><span class="hljs-keyword">assert</span> <span class="hljs-number">1.200065</span>D == <span class="hljs-keyword">new</span> Double(<span class="hljs-string">&#x27;1.200065&#x27;</span>)<br><span class="hljs-keyword">assert</span> <span class="hljs-number">1.234</span>F == <span class="hljs-keyword">new</span> Float(<span class="hljs-string">&#x27;1.234&#x27;</span>)<br><span class="hljs-keyword">assert</span> <span class="hljs-number">1.23E23</span>D == <span class="hljs-keyword">new</span> Double(<span class="hljs-string">&#x27;1.23E23&#x27;</span>)<br><span class="hljs-keyword">assert</span> <span class="hljs-number">0b1111</span>L.<span class="hljs-keyword">class</span> == Long <span class="hljs-comment">// binary</span><br><span class="hljs-keyword">assert</span> <span class="hljs-number">0xFF</span>i.<span class="hljs-keyword">class</span> == Integer <span class="hljs-comment">// hexadecimal</span><br><span class="hljs-keyword">assert</span> <span class="hljs-number">034</span>G.<span class="hljs-keyword">class</span> == BigInteger <span class="hljs-comment">// octal</span><br></code></pre></td></tr></table></figure><h5 id="æ•°å­¦è¿ç®—"><a href="#æ•°å­¦è¿ç®—" class="headerlink" title="æ•°å­¦è¿ç®—"></a>æ•°å­¦è¿ç®—</h5><p>å°½ç®¡è¿ç®—åœ¨ä»¥åä¼šè¢«è¦†ç›–ï¼Œè®¨è®ºæ•°å­¦è¿ç®—å’Œç»“æœç±»å‹ä»ç„¶æ˜¯é‡è¦çš„ã€‚<br>é™¤æ³•ä¸å¹‚æ–¹äºŒå…ƒæ“ä½œç¬¦æ”¾åœ¨ä¸€è¾¹ï¼ˆä¸‹æ–‡è®¨è®ºï¼‰ã€‚</p><ul><li>byte char shortå’Œintè¿›è¡ŒäºŒå…ƒæ“ä½œçš„ç»“æœæ˜¯int</li><li>ä½¿ç”¨longä¸byte char short intè¿›è¡ŒäºŒå…ƒæ“ä½œçš„ç»“æœæ˜¯long</li><li>ä½¿ç”¨BigIntegerä¸ä»»æ„å…¶ä»–æ•´æ•°ç±»å‹è¿›è¡ŒäºŒå…ƒæ“ä½œç»“æœæ˜¯BigInteger</li><li>float doubleä¸BigDecimalè¿›è¡ŒäºŒå…ƒè¿ç®—çš„ç»“æœæ˜¯double</li><li>ä¸¤ä¸ªBigDecimalè¿›è¡ŒäºŒå…ƒè¿ç®—çš„ç»“æœæ˜¯BigDecimal</li></ul><p>ä¸‹è¡¨æ€»ç»“äº†è¿™äº›åŸåˆ™ï¼š</p><table><thead><tr><th align="center"></th><th align="center">byte</th><th align="center">char</th><th align="center">short</th><th align="center">int</th><th align="center">long</th><th align="center">BigInteger</th><th align="center">float</th><th align="center">double</th><th align="center">BigDecimal</th></tr></thead><tbody><tr><td align="center">byte</td><td align="center">int</td><td align="center">int</td><td align="center">int</td><td align="center">int</td><td align="center">long</td><td align="center">BigInteger</td><td align="center">double</td><td align="center">double</td><td align="center">double</td></tr><tr><td align="center">char</td><td align="center"></td><td align="center">int</td><td align="center">int</td><td align="center">int</td><td align="center">long</td><td align="center">BigInteger</td><td align="center">double</td><td align="center">double</td><td align="center">double</td></tr><tr><td align="center">short</td><td align="center"></td><td align="center"></td><td align="center">int</td><td align="center">int</td><td align="center">long</td><td align="center">BigInteger</td><td align="center">double</td><td align="center">double</td><td align="center">double</td></tr><tr><td align="center">int</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">int</td><td align="center">long</td><td align="center">BigInteger</td><td align="center">double</td><td align="center">double</td><td align="center">double</td></tr><tr><td align="center">long</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">long</td><td align="center">BigInteger</td><td align="center">double</td><td align="center">double</td><td align="center">double</td></tr><tr><td align="center">BigInteger</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">BigInteger</td><td align="center">double</td><td align="center">double</td><td align="center">double</td></tr><tr><td align="center">float</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">double</td><td align="center">double</td><td align="center">double</td></tr><tr><td align="center">double</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">double</td><td align="center">double</td></tr><tr><td align="center">BigDecimal</td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">BigDecimal</td></tr></tbody></table><p>ç”±äºGroovyæ“ä½œç¬¦é‡è½½ï¼ŒBigIntegerä¸BigDecimalé€šå¸¸ä¹Ÿèƒ½è¿›è¡Œè¿ç®—æ“ä½œï¼Œä¸Javaä¸åŒï¼Œåœ¨Javaä¸­ä½ ä¸å¾—ä¸æ˜¾å¼ä½¿ç”¨æ–¹æ³•æ“ä½œè¿™äº›æ•°å­—ã€‚ </p><h6 id="é™¤æ³•è¿ç®—ç¬¦çš„æƒ…å†µ"><a href="#é™¤æ³•è¿ç®—ç¬¦çš„æƒ…å†µ" class="headerlink" title="é™¤æ³•è¿ç®—ç¬¦çš„æƒ…å†µ"></a>é™¤æ³•è¿ç®—ç¬¦çš„æƒ…å†µ</h6><p>å¦‚æœä»»ä½•ä¸€ä¸ªæ“ä½œæ•°æ˜¯floatæˆ–double,é‚£ä¹ˆé™¤æ³•è¿ç®—ç¬¦&#x2F;(å’Œ&#x2F;&#x3D; ç”¨äºé™¤æ³•å’Œèµ‹å€¼)äº§ç”Ÿdoubleç»“æœï¼Œå¦åˆ™ï¼ˆå½“ä¸¤ä¸ªæ“ä½œæ•°æ˜¯ä¸€ä¸ªä¸æ•´å‹ç±»å‹short, char, byte, int, long, BigInteger or BigDecimalçš„ä»»æ„ç»„åˆï¼‰æ˜¯ä¸€ä¸ªBigDecimalç»“æœã€‚</p><p>å¦‚æœé™¤æ³•æ˜¯ç²¾ç¡®çš„ï¼ˆå¦‚ï¼Œç»“æœå¯ä»¥åœ¨ç›¸åŒçš„ç²¾åº¦å’Œæ ‡åº¦èŒƒå›´å†…ç²¾ç¡®è¡¨ç¤ºï¼‰ï¼Œé‚£ä¹ˆBigDecimalçš„é™¤æ³•å®é™…æ‰§è¡Œçš„æ˜¯divide()æ–¹æ³•ï¼Œæˆ–ä½¿ç”¨ä¸¤ä¸ªæ“ä½œæ•°çš„æœ€å¤§ç²¾åº¦åŠ 10,å’Œä¸€ä¸ªæœ€å¤§å€¼ä¸º10çš„æ ‡åº¦çš„MathContextã€‚</p><p>å¯¹äºæ•´æ•°é™¤æ³•å’ŒJavaç›¸åŒï¼Œä½ åº”è¯¥ä½¿ç”¨intdiv()æ–¹æ³•ï¼Œå› ä¸ºGroovyæ²¡æœ‰ä¸“é—¨æä¾›ä¸€ä¸ªæ•´æ•°æ“ä½œç¬¦ã€‚</p><h6 id="å¹‚è¿ç®—æƒ…å†µ"><a href="#å¹‚è¿ç®—æƒ…å†µ" class="headerlink" title="å¹‚è¿ç®—æƒ…å†µ"></a>å¹‚è¿ç®—æƒ…å†µ</h6><p>å¹‚è¿ç®—æ“ä½œç¬¦ä½¿ç”¨**æ“ä½œç¬¦ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼šåŸºæ•°å’ŒæŒ‡æ•°ã€‚å¹‚è¿ç®—çš„ç»“æœå–å†³äºå®ƒçš„æ“ä½œæ•°ä»¥åŠæ“ä½œçš„ç»“æœï¼ˆç‰¹åˆ«æ˜¯ç»“æœå¯ä»¥è¢«è¡¨ç¤ºä¸ºä¸€ä¸ªæ•´æ•°å€¼ï¼‰ã€‚</p><p>ä»¥ä¸‹è¿™äº›åŸåˆ™è¢«ç”¨äºå†³å®šGroovyå¹‚è¿ç®—æ“ä½œç»“æœçš„ç±»å‹ï¼š</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs vbnet">ï¼ˆ<span class="hljs-number">1</span>ï¼‰å¦‚æœæŒ‡æ•°æ˜¯ä¸€ä¸ªå°æ•°<br><span class="hljs-number">1</span>.å¦‚æœç»“æœèƒ½ä½œä¸ºä¸€ä¸ª<span class="hljs-type">Integer</span>è¡¨ç¤ºï¼Œé‚£ä¹ˆè¿”å›ä¸€ä¸ª<span class="hljs-type">Integer</span><br><span class="hljs-number">2</span>..å¦‚æœç»“æœèƒ½ä½œä¸ºä¸€ä¸ª<span class="hljs-type">Long</span>è¡¨ç¤ºï¼Œé‚£ä¹ˆè¿”å›ä¸€ä¸ª<span class="hljs-type">Long</span><br><span class="hljs-number">3</span>.å¦åˆ™è¿”å›ä¸€ä¸ª<span class="hljs-type">Double</span><br><br>ï¼ˆ<span class="hljs-number">2</span>ï¼‰å¦‚æœæŒ‡æ•°æ˜¯ä¸€ä¸ªæ•´æ•°<br> <span class="hljs-number">1</span>.å¦‚æœæ˜¯ä¸€ä¸ªä¸¥æ ¼çš„è´Ÿæ•°ï¼Œé‚£ä¹ˆè¿”å›ä¸€ä¸ª<span class="hljs-type">Integer</span>ï¼Œ<span class="hljs-type">Long</span>æˆ–<span class="hljs-type">Double</span>ï¼Œç»“æœå€¼ä½¿ç”¨é‚£ç§ç±»å‹å¡«å……ã€‚<br>        <span class="hljs-number">2</span>.å¦‚æœæŒ‡æ•°æ˜¯æ­£æ•°æˆ–<span class="hljs-number">0</span><br>   <span class="hljs-number">1</span>)å¦‚æœåŸºæ•°æ˜¯BigDecimalï¼Œé‚£ä¹ˆè¿”å›ä¸€ä¸ªBigDecimalç»“æœå€¼<br>  <span class="hljs-number">2</span>)å¦‚æœåŸºæ•°æ˜¯BigIntegerï¼Œé‚£ä¹ˆè¿”å›ä¸€ä¸ªBigIntegerç»“æœå€¼<br>  <span class="hljs-number">3</span>)å¦‚æœåŸºæ•°æ˜¯<span class="hljs-type">Integer</span>ï¼Œé‚£ä¹ˆè¿”å›ä¸€ä¸ª<span class="hljs-type">Integer</span>å€¼ï¼Œå¦åˆ™è¿”å›BigInteger<br>  <span class="hljs-number">4</span>)å¦‚æœåŸºæ•°æ˜¯<span class="hljs-type">Long</span>ï¼Œé‚£ä¹ˆè¿”å›ä¸€ä¸ª<span class="hljs-type">Long</span>å€¼ï¼Œå¦åˆ™è¿”å›BigInteger<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä½¿ç”¨ä¸€äº›å®ä¾‹è¯´æ˜è¿™äº›åŸåˆ™ï¼š </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">// base and exponent are ints and the result can be represented by an Integer</span><br><span class="hljs-keyword">assert</span> <span class="hljs-number">2</span> ** <span class="hljs-number">3</span> <span class="hljs-keyword">instanceof</span> Integer <span class="hljs-comment">// 8</span><br><span class="hljs-keyword">assert</span> <span class="hljs-number">10</span> ** <span class="hljs-number">9</span> <span class="hljs-keyword">instanceof</span> Integer <span class="hljs-comment">// 1_000_000_000</span><br><br><span class="hljs-comment">// the base is a long, so fit the result in a Long</span><br><span class="hljs-comment">// (although it could have fit in an Integer)</span><br><span class="hljs-keyword">assert</span> <span class="hljs-number">5</span>L ** <span class="hljs-number">2</span> <span class="hljs-keyword">instanceof</span> Long <span class="hljs-comment">// 25</span><br><br><span class="hljs-comment">// the result can&#x27;t be represented as an Integer or Long, so return a BigInteger</span><br><span class="hljs-keyword">assert</span> <span class="hljs-number">100</span> ** <span class="hljs-number">10</span> <span class="hljs-keyword">instanceof</span> BigInteger <span class="hljs-comment">// 10e20</span><br><span class="hljs-keyword">assert</span> <span class="hljs-number">1234</span> ** <span class="hljs-number">123</span> <span class="hljs-keyword">instanceof</span> BigInteger <span class="hljs-comment">// 170515806212727042875...</span><br><br><span class="hljs-comment">// the base is a BigDecimal and the exponent a negative int</span><br><span class="hljs-comment">// but the result can be represented as an Integer</span><br><span class="hljs-keyword">assert</span> <span class="hljs-number">0.5</span> ** <span class="hljs-number">-2</span> <span class="hljs-keyword">instanceof</span> Integer <span class="hljs-comment">// 4</span><br><br><span class="hljs-comment">// the base is an int, and the exponent a negative float</span><br><span class="hljs-comment">// but again, the result can be represented as an Integer</span><br><span class="hljs-keyword">assert</span> <span class="hljs-number">1</span> ** <span class="hljs-number">-0.3</span>f <span class="hljs-keyword">instanceof</span> Integer <span class="hljs-comment">// 1</span><br><br><span class="hljs-comment">// the base is an int, and the exponent a negative int</span><br><span class="hljs-comment">// but the result will be calculated as a Double</span><br><span class="hljs-comment">// (both base and exponent are actually converted to doubles)</span><br><span class="hljs-keyword">assert</span> <span class="hljs-number">10</span> ** <span class="hljs-number">-1</span> <span class="hljs-keyword">instanceof</span> Double <span class="hljs-comment">// 0.1</span><br><br><span class="hljs-comment">// the base is a BigDecimal, and the exponent is an int, so return a BigDecimal</span><br><span class="hljs-keyword">assert</span> <span class="hljs-number">1.2</span> ** <span class="hljs-number">10</span> <span class="hljs-keyword">instanceof</span> BigDecimal <span class="hljs-comment">// 6.1917364224</span><br><br><span class="hljs-comment">// the base is a float or double, and the exponent is an int</span><br><span class="hljs-comment">// but the result can only be represented as a Double value</span><br><span class="hljs-keyword">assert</span> <span class="hljs-number">3.4</span>f ** <span class="hljs-number">5</span> <span class="hljs-keyword">instanceof</span> Double <span class="hljs-comment">// 454.35430372146965</span><br><span class="hljs-keyword">assert</span> <span class="hljs-number">5.6</span>d ** <span class="hljs-number">2</span> <span class="hljs-keyword">instanceof</span> Double <span class="hljs-comment">// 31.359999999999996</span><br><br><span class="hljs-comment">// the exponent is a decimal value</span><br><span class="hljs-comment">// and the result can only be represented as a Double value</span><br><span class="hljs-keyword">assert</span> <span class="hljs-number">7.8</span> ** <span class="hljs-number">1.9</span> <span class="hljs-keyword">instanceof</span> Double <span class="hljs-comment">// 49.542708423868476</span><br><span class="hljs-keyword">assert</span> <span class="hljs-number">2</span> ** <span class="hljs-number">0.1</span>f <span class="hljs-keyword">instanceof</span> Double <span class="hljs-comment">// 1.0717734636432956</span><br></code></pre></td></tr></table></figure><h4 id="å¸ƒå°”"><a href="#å¸ƒå°”" class="headerlink" title="å¸ƒå°”"></a>å¸ƒå°”</h4><p>Booleanæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ•°æ®ç±»å‹ï¼Œç”¨äºè¡¨ç¤ºçœŸå€¼ï¼štrueå’Œfalseã€‚ä½¿ç”¨è¿™ç§æ•°æ®ç±»å‹ä½œä¸ºè·Ÿè¸ªçœŸå‡æ¡ä»¶çš„ç®€å•æ ‡å¿—ã€‚ Booleanèƒ½è¢«å­˜å‚¨åœ¨å˜é‡ä¸­ï¼Œæˆå‘˜å˜é‡ä¸­ï¼Œå°±åƒå…¶ä»–æ•°æ®ç±»å‹ä¸€æ ·ï¼š </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> myBooleanVariable = <span class="hljs-literal">true</span><br><span class="hljs-type">boolean</span> untypedBooleanVar = <span class="hljs-literal">false</span><br>booleanField = <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>trueå’Œfalseæ˜¯ä»…æœ‰çš„ä¸¤ä¸ªåŸå§‹å¸ƒå°”å€¼ã€‚ä½†æ›´å¤æ‚çš„å¸ƒå°”è¡¨è¾¾å¼èƒ½ä½¿ç”¨é€»è¾‘æ“ä½œç¬¦è¡¨ç¤ºã€‚</p><p> é™¤æ­¤ä¹‹å¤–ï¼ŒGroovyæœ‰ä¸€äº›ç‰¹æ®Šçš„è§„åˆ™ï¼ˆç»å¸¸å› ä¸ºGroovyçœŸå€¼æ¶‰åŠï¼‰ç”¨äºå°†éå¸ƒå°”å€¼å¯¹è±¡è½¬åŒ–ä¸ºä¸€ä¸ªå¸ƒå°”å€¼ã€‚ </p><h4 id="åˆ—è¡¨"><a href="#åˆ—è¡¨" class="headerlink" title="åˆ—è¡¨"></a>åˆ—è¡¨</h4><p>Groovyä½¿ç”¨é€—å·åˆ†éš”åˆ—è¡¨ä¸­çš„å€¼ï¼Œå¹¶ä½¿ç”¨æ–¹æ‹¬å·åŒ…å›´ï¼Œç”¨æ¥æŒ‡å®šä¸€ä¸ªåˆ—è¡¨ã€‚</p><p>Groovyçš„åˆ—è¡¨æ˜¯java.util.Listï¼Œå› ä¸ºGroovyæ²¡æœ‰å®šä¹‰ä»»ä½•é›†åˆç±»ã€‚å½“å®šä¹‰ä¸€ä¸ªåˆ—è¡¨å¸¸é‡æ—¶ï¼Œé»˜è®¤çš„åˆ—è¡¨å…·ä½“å®ç°æ˜¯java.util.ArrayListï¼Œé™¤éä½ æŒ‡å®šï¼Œæˆ‘ä»¬å°†åœ¨åé¢çœ‹åˆ°ã€‚ </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>] ï¼ˆ<span class="hljs-number">1</span>ï¼‰<br><br><span class="hljs-keyword">assert</span> numbers <span class="hljs-keyword">instanceof</span> List ï¼ˆ<span class="hljs-number">2</span>ï¼‰<br><span class="hljs-keyword">assert</span> numbers.size() == <span class="hljs-number">3</span> ï¼ˆ<span class="hljs-number">3</span>ï¼‰<br></code></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰æˆ‘ä»¬å®šä¹‰ç”¨é€—å·åˆ†éš”ï¼Œå¹¶ç”¨æ–¹æ‹¬å·åŒ…å›´åˆ—è¡¨æ•°å­—ï¼Œå¹¶å°†åˆ—è¡¨èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡<br>ï¼ˆ2ï¼‰listæ˜¯java java.util.Listæ¥å£çš„å®ä¾‹<br>ï¼ˆ3ï¼‰åˆ—è¡¨çš„å¤§å°å¯ä»¥ä½¿ç”¨size()æ–¹æ³•æŸ¥è¯¢ï¼Œè¡¨æ˜åˆ—è¡¨æœ‰ä¸‰ä¸ªå…ƒç´ </p><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå…ƒç´ ç±»å‹ç›¸åŒçš„åˆ—è¡¨ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½åˆ›å»ºåŒ…å«ä¸åŒç±»å‹å…ƒç´ çš„åˆ—è¡¨ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> heterogeneous = [<span class="hljs-number">1</span>, <span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-literal">true</span>] ï¼ˆ<span class="hljs-number">1</span>ï¼‰<br></code></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰æˆ‘ä»¬çš„åˆ—è¡¨åŒ…å«ä¸€ä¸ªæ•°å­—ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸€ä¸ªå¸ƒå°”å€¼ </p><p>æˆ‘ä»¬æåŠåˆ°ï¼Œé»˜è®¤çš„åˆ—è¡¨å­—é¢é‡å®é™…æ˜¯java.util.ArrayListçš„å®ä¾‹ï¼Œä½†åˆ—è¡¨ä½¿ç”¨ä¸åŒè¿”å›ç±»å‹ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½¿ç”¨asæ“ä½œç¬¦è¿›è¡Œç±»å‹è½¬æ¢ï¼Œæˆ–ä½¿ç”¨å˜é‡çš„å®šä¹‰ç±»å‹ï¼š </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> arrayList = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<br><span class="hljs-keyword">assert</span> arrayList <span class="hljs-keyword">instanceof</span> java.util.ArrayList<br><br><span class="hljs-keyword">def</span> linkedList = [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>] <span class="hljs-keyword">as</span> LinkedList ï¼ˆ<span class="hljs-number">1</span>ï¼‰<br><span class="hljs-keyword">assert</span> linkedList <span class="hljs-keyword">instanceof</span> java.util.LinkedList<br><br>LinkedList otherLinked = [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>] ï¼ˆ<span class="hljs-number">2</span>ï¼‰<br><span class="hljs-keyword">assert</span> otherLinked <span class="hljs-keyword">instanceof</span> java.util.LinkedList<br></code></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰æˆ‘ä»¬ä½¿ç”¨asæ“ä½œç¬¦è¿›è¡Œç±»å‹è½¬æ¢ï¼Œæ˜¾å¼è¯·æ±‚ä¸€ä¸ªjava.util.LinkedListå®ç°<br>ï¼ˆ2ï¼‰æˆ‘ä»¬ä½¿ç”¨ç±»å‹ä¸ºjava.util.LinkedListçš„å˜é‡ä¿å­˜åˆ—è¡¨å­—é¢é‡</p><p>ä½ èƒ½é€šè¿‡ä¸‹æ ‡æ“ä½œç¬¦<code>[]</code>(è¯»å’Œå†™å…ƒç´ å€¼)å¹¶ä½¿ç”¨æ­£ç´¢å¼•å€¼è®¿é—®åˆ—è¡¨å…ƒç´ æˆ–è´Ÿç´¢å¼•å€¼ä»åˆ—è¡¨å°¾éƒ¨è®¿é—®å…ƒç´ ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨èŒƒå›´ï¼Œæˆ–ä½¿ç”¨å·¦ç§»<code>&lt;&lt;</code>è¿½åŠ åˆ—è¡¨å…ƒç´ ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> letters = [<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>]<br><br><span class="hljs-keyword">assert</span> letters[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;a&#x27;</span> ï¼ˆ<span class="hljs-number">1</span>ï¼‰<br><span class="hljs-keyword">assert</span> letters[<span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;b&#x27;</span><br><br><span class="hljs-keyword">assert</span> letters[<span class="hljs-number">-1</span>] == <span class="hljs-string">&#x27;d&#x27;</span> ï¼ˆ<span class="hljs-number">2</span>ï¼‰<br><span class="hljs-keyword">assert</span> letters[<span class="hljs-number">-2</span>] == <span class="hljs-string">&#x27;c&#x27;</span><br><br>letters[<span class="hljs-number">2</span>] = <span class="hljs-string">&#x27;C&#x27;</span> ï¼ˆ<span class="hljs-number">3</span>ï¼‰<br><span class="hljs-keyword">assert</span> letters[<span class="hljs-number">2</span>] == <span class="hljs-string">&#x27;C&#x27;</span><br><br>letters &lt;&lt; <span class="hljs-string">&#x27;e&#x27;</span> ï¼ˆ<span class="hljs-number">4</span>ï¼‰<br><span class="hljs-keyword">assert</span> letters[ <span class="hljs-number">4</span>] == <span class="hljs-string">&#x27;e&#x27;</span><br><span class="hljs-keyword">assert</span> letters[<span class="hljs-number">-1</span>] == <span class="hljs-string">&#x27;e&#x27;</span><br><br><span class="hljs-keyword">assert</span> letters[<span class="hljs-number">1</span>, <span class="hljs-number">3</span>] == [<span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>] ï¼ˆ<span class="hljs-number">5</span>ï¼‰<br><span class="hljs-keyword">assert</span> letters[<span class="hljs-number">2.</span><span class="hljs-number">.4</span>] == [<span class="hljs-string">&#x27;C&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>] ï¼ˆ<span class="hljs-number">6</span>ï¼‰<br></code></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰è®¿é—®åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆç´¢å¼•ä»é›¶å¼€å§‹è®¡ç®—ï¼‰ </p><p>ï¼ˆ2ï¼‰ä½¿ç”¨è´Ÿç´¢å¼•è®¿é—®åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼š-1æ˜¯åˆ—è¡¨ä»å°¾éƒ¨å¼€å§‹çš„ç¬¬ä¸€ä¸ªå…ƒç´  </p><p>ï¼ˆ3ï¼‰ä½¿ç”¨èµ‹å€¼æ“ä½œä¸ºåˆ—è¡¨çš„ç¬¬ä¸‰ä¸ªå…ƒç´ è®¾ç½®ä¸€ä¸ªæ–°å€¼ </p><p>ï¼ˆ4ï¼‰ä½¿ç”¨&lt;&lt;å·¦ç§»æ“ä½œç¬¦åœ¨åˆ—è¡¨å°¾éƒ¨è¿½åŠ ä¸€ä¸ªå…ƒç´  </p><p>ï¼ˆ5ï¼‰ä¸€æ¬¡è®¿é—®ä¸¤ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«è¿™ä¸¤ä¸ªå…ƒç´ çš„æ–°åˆ—è¡¨ </p><p>ï¼ˆ6ï¼‰ä½¿ç”¨èŒƒå›´è®¿é—®åˆ—è¡¨ä¸­è¿™ä¸ªèŒƒå›´å†…çš„å…ƒç´ ï¼Œä»startåˆ°endå…ƒç´ ä½ç½® </p><p>å› ä¸ºåˆ—è¡¨å¯ä»¥å¾ˆè‡ªç„¶çš„åšåˆ°å…ƒç´ ç±»å‹ä¸åŒï¼Œå› æ­¤åˆ—è¡¨ä¹Ÿå¯ä»¥åŒ…å«åˆ—è¡¨ç”¨äºåˆ›å»ºå¤šç»´åˆ—è¡¨ï¼š </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> multi = [[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>]] ï¼ˆ<span class="hljs-number">1</span>ï¼‰<br><span class="hljs-keyword">assert</span> multi[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] == <span class="hljs-number">2</span> ï¼ˆ<span class="hljs-number">2</span>ï¼‰<br></code></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰å®šä¹‰ä¸€ä¸ªæ•°å­—åˆ—è¡¨çš„åˆ—è¡¨ </p><p>ï¼ˆ2ï¼‰è®¿é—®é¡¶çº§åˆ—è¡¨çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼Œå†…éƒ¨åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´  </p><h4 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h4><p>Groovyä½¿ç”¨åˆ—è¡¨æ ‡è®°æ¥æ ‡è®°æ•°ç»„ï¼Œä½†ä¸ºäº†åˆ›å»ºå­—é¢é‡æ•°ç»„ï¼Œä½ éœ€è¦é€šè¿‡ç±»å‹è½¬æ¢æˆ–ç±»å‹å®šä¹‰æ¥å®šä¹‰æ•°ç»„ç±»å‹ã€‚ </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs groovy">String[] arrStr = [<span class="hljs-string">&#x27;Ananas&#x27;</span>, <span class="hljs-string">&#x27;Banana&#x27;</span>, <span class="hljs-string">&#x27;Kiwi&#x27;</span>] ï¼ˆ<span class="hljs-number">1</span>ï¼‰<br><br><span class="hljs-keyword">assert</span> arrStr <span class="hljs-keyword">instanceof</span> String[] ï¼ˆ<span class="hljs-number">2</span>ï¼‰<br><span class="hljs-keyword">assert</span> !(arrStr <span class="hljs-keyword">instanceof</span> List)<br><br><span class="hljs-keyword">def</span> numArr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>] <span class="hljs-keyword">as</span> <span class="hljs-type">int</span>[] ï¼ˆ<span class="hljs-number">3</span>ï¼‰<br><br><span class="hljs-keyword">assert</span> numArr <span class="hljs-keyword">instanceof</span> <span class="hljs-type">int</span>[] ï¼ˆ<span class="hljs-number">4</span>ï¼‰<br><span class="hljs-keyword">assert</span> numArr.size() == <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰ä½¿ç”¨æ˜¾å¼å˜é‡ç±»å‹å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„<br>ï¼ˆ2ï¼‰æ–­è¨€è¯´æ˜æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„<br>ï¼ˆ3ï¼‰ä½¿ç”¨asæ“ä½œç¬¦åˆ›å»ºä»¥intæ•°ç»„<br>ï¼ˆ4ï¼‰æ–­è¨€è¡¨æ˜æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåŸå§‹ç±»å‹çš„intæ•°ç»„</p><p>ä½ ä¹Ÿèƒ½åˆ›å»ºå¤šç»´æ•°ç»„ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> matrix3 = <span class="hljs-keyword">new</span> Integer[<span class="hljs-number">3</span>][<span class="hljs-number">3</span>] ï¼ˆ<span class="hljs-number">1</span>ï¼‰<br><span class="hljs-keyword">assert</span> matrix3.size() == <span class="hljs-number">3</span><br><br>Integer[][] matrix2 ï¼ˆ<span class="hljs-number">2</span>ï¼‰<br>matrix2 = [[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]]<br><span class="hljs-keyword">assert</span> matrix2 <span class="hljs-keyword">instanceof</span> Integer[][]<br></code></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰ä½ èƒ½å®šä¹‰ä¸€ä¸ªæ–°æ•°ç»„çš„è¾¹ç•Œ<br>ï¼ˆ2ï¼‰æˆ–ä¸æŒ‡å®šå®ƒçš„è¾¹ç•Œå®šä¹‰ä¸€ä¸ªæ–°æ•°ç»„</p><p>é€šè¿‡ä¸åˆ—è¡¨ç›¸åŒçš„æ ‡è®°è®¿é—®æ•°ç»„çš„å…ƒç´ ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy">String[] names = [<span class="hljs-string">&#x27;CÃ©dric&#x27;</span>, <span class="hljs-string">&#x27;Guillaume&#x27;</span>, <span class="hljs-string">&#x27;Jochen&#x27;</span>, <span class="hljs-string">&#x27;Paul&#x27;</span>]<br><span class="hljs-keyword">assert</span> names[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;CÃ©dric&#x27;</span> ï¼ˆ<span class="hljs-number">1</span>ï¼‰<br><br>names[<span class="hljs-number">2</span>] = <span class="hljs-string">&#x27;Blackdrag&#x27;</span> ï¼ˆ<span class="hljs-number">2</span>ï¼‰<br><span class="hljs-keyword">assert</span> names[<span class="hljs-number">2</span>] == <span class="hljs-string">&#x27;Blackdrag&#x27;</span><br></code></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰å–å¾—æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ <br>ï¼ˆ2ï¼‰ä¸ºæ•°ç»„çš„ç¬¬ä¸‰ä¸ªå…ƒç´ è®¾ç½®ä¸€ä¸ªæ–°å€¼</p><p>Javaæ•°ç»„åˆå§‹åŒ–æ ‡è®°Groovyä¸æ”¯æŒï¼Œå› ä¸ºå¤§æ‹¬å·ä¼šè¢«è¯¯è§£ä¸ºGroovyçš„é—­åŒ…æ ‡è®°ã€‚</p><h4 id="æ˜ å°„"><a href="#æ˜ å°„" class="headerlink" title="æ˜ å°„"></a>æ˜ å°„</h4><p>åœ¨å…¶å®ƒè¯­è¨€ä¸­ï¼Œæœ‰æ—¶å€™ç§°ä¸ºå­—å…¸æˆ–å…³è”æ•°ç»„ï¼ŒGroovyç§°ä¸ºæ˜ å°„ã€‚æ˜ å°„ä½¿é”®åˆ°å€¼å…³è”ï¼Œä½¿ç”¨å†’å·å°†é”®å€¼åˆ†éš”å¼€ï¼Œæ¯ä¸ªé”®å€¼å¯¹ä½¿ç”¨é€—å·ï¼Œæ•´ä¸ªé”®å’Œå€¼ä½¿ç”¨æ–¹æ‹¬å·åŒ…å›´ã€‚</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> colors = [<span class="hljs-attr">red:</span> <span class="hljs-string">&#x27;#FF0000&#x27;</span>, <span class="hljs-attr">green:</span> <span class="hljs-string">&#x27;#00FF00&#x27;</span>, <span class="hljs-attr">blue:</span> <span class="hljs-string">&#x27;#0000FF&#x27;</span>] ï¼ˆ<span class="hljs-number">1</span>ï¼‰<br><br><span class="hljs-keyword">assert</span> colors[<span class="hljs-string">&#x27;red&#x27;</span>] == <span class="hljs-string">&#x27;#FF0000&#x27;</span> ï¼ˆ<span class="hljs-number">2</span>ï¼‰<br><span class="hljs-keyword">assert</span> colors.green == <span class="hljs-string">&#x27;#00FF00&#x27;</span> ï¼ˆ<span class="hljs-number">3</span>ï¼‰<br><br>colors[<span class="hljs-string">&#x27;pink&#x27;</span>] = <span class="hljs-string">&#x27;#FF00FF&#x27;</span> ï¼ˆ<span class="hljs-number">4</span>ï¼‰<br>colors.yellow = <span class="hljs-string">&#x27;#FFFF00&#x27;</span> ï¼ˆ<span class="hljs-number">5</span>ï¼‰<br><br><span class="hljs-keyword">assert</span> colors.pink == <span class="hljs-string">&#x27;#FF00FF&#x27;</span><br><span class="hljs-keyword">assert</span> colors[<span class="hljs-string">&#x27;yellow&#x27;</span>] == <span class="hljs-string">&#x27;#FFFF00&#x27;</span><br><br><span class="hljs-keyword">assert</span> colors <span class="hljs-keyword">instanceof</span> java.util.LinkedHashMap<br></code></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå­—ç¬¦ä¸²é¢œè‰²åå…³è”åå…­è¿›åˆ¶çš„htmlé¢œè‰²çš„æ˜ å°„<br>ï¼ˆ2ï¼‰æˆ‘ä»¬ä½¿ç”¨ä¸‹æ ‡æ ‡è®°æ£€æŸ¥redé”®å€¼å…³è”çš„å†…å®¹<br>ï¼ˆ3ï¼‰æˆ‘ä»¬ä¹Ÿèƒ½ä½¿ç”¨å±æ€§æ ‡è®°è®¿é—®ç»¿é¢œè‰²åå…­è¿›åˆ¶è¡¨è¾¾å¼<br>ï¼ˆ4ï¼‰ç›¸ä¼¼çš„ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½ä½¿ç”¨ä¸‹æ ‡æ ‡è®°æ·»åŠ ä¸€ä¸ªæ–°çš„é”®å€¼å¯¹<br>ï¼ˆ5ï¼‰æˆ–è€…ä½¿ç”¨å±æ€§æ ‡è®°æ·»åŠ yellowé¢œè‰²</p><p>å½“ä½¿ç”¨è¿™äº›é”®çš„åå­—æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šåœ¨æ˜ å°„ä¸­å®šä¹‰äº†ä¸€ä¸ªé”®å€¼ã€‚<br>Groovyåˆ›å»ºçš„æ˜ å°„å®é™…æ˜¯java.util.LinkedHashMapçš„å®ä¾‹ã€‚</p><p>å¦‚æœä½ å°è¯•åœ¨æ˜ å°„ä¸­è®¿é—®ä¸å­˜åœ¨çš„é”®ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">assert</span> colors.unknown == <span class="hljs-literal">null</span><br></code></pre></td></tr></table></figure><p>ä½ å°†å–å›nullã€‚</p><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­æˆ‘ä»¬ä½¿ç”¨å­—ç¬¦ä¸²é”®å€¼ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–ç±»å‹ä½œä¸ºé”®å€¼ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> numbers = [<span class="hljs-number">1</span>: <span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-number">2</span>: <span class="hljs-string">&#x27;two&#x27;</span>]<br><br><span class="hljs-keyword">assert</span> numbers[<span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;one&#x27;</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æ•°å­—ä½œä¸ºé”®å€¼ï¼Œä½œä¸ºæ•°å­—èƒ½æ¸…æ¥šçš„è¯†åˆ«æ•°å­—ï¼Œå› æ­¤Groovyä¸ä¼šåƒä¹‹å‰çš„ç¤ºä¾‹ä¸€æ ·åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²çš„é”®ã€‚ä½†æ˜¯è€ƒè™‘ä½ æƒ³ä¼ é€’ä¸€ä¸ªå˜é‡ä»£æ›¿é”®çš„æƒ…å†µä¸‹ï¼Œæœ‰ä¸€ä¸ªå˜é‡å€¼å°†ä¼šä½œä¸ºé”®ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> key = <span class="hljs-string">&#x27;name&#x27;</span><br><span class="hljs-keyword">def</span> person = [<span class="hljs-attr">key:</span> <span class="hljs-string">&#x27;Guillaume&#x27;</span>] ï¼ˆ<span class="hljs-number">1</span>ï¼‰<br><br><span class="hljs-keyword">assert</span> !person.containsKey(<span class="hljs-string">&#x27;name&#x27;</span>) ï¼ˆ<span class="hljs-number">2</span>ï¼‰<br><span class="hljs-keyword">assert</span> person.containsKey(<span class="hljs-string">&#x27;key&#x27;</span>) ï¼ˆ<span class="hljs-number">3</span>ï¼‰<br></code></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰keyåŒâ€™Guillaumeâ€™å…³è”ï¼Œåå­—å°†ä¼šå˜ä¸ºâ€keyâ€å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯å…¶å€¼<br>ï¼ˆ2ï¼‰è¿™ä¸ªæ˜ å°„ä¸åŒ…æ‹¬â€nameâ€é”®<br>ï¼ˆ3ï¼‰ä»£æ›¿çš„æ˜¯ï¼Œæ˜ å°„åŒ…æ‹¬ä¸€ä¸ªâ€keyâ€é”®</p><p>ä½ ä¹Ÿèƒ½é€šè¿‡å¼•ç”¨çš„å­—ç¬¦ä¸²ä»¥åŠé”®: [â€œnameâ€: â€œGuillaumeâ€]ã€‚å¦‚æœä½ çš„è§å­—ç¬¦ä¸²ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„æ ‡è¯†ç¬¦ï¼Œè¿™æ˜¯å¼ºåˆ¶çš„ï¼Œä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²é”®åƒå“ˆå¸Œï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">[<span class="hljs-string">&quot;street-name&quot;</span>: <span class="hljs-string">&quot;Main street&quot;</span>]ã€‚<br></code></pre></td></tr></table></figure><p>åœ¨æ˜ å°„å®šä¹‰ä¸­éœ€è¦ä¼ é€’å˜é‡å€¼ï¼Œä½ å¿…é¡»ä½¿ç”¨åœ†æ‹¬å·åŒ…å›´è¿™ä¸ªå˜é‡æˆ–è¡¨è¾¾å¼ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs groovy">person = [(key): <span class="hljs-string">&#x27;Guillaume&#x27;</span>] ï¼ˆ<span class="hljs-number">1</span>ï¼‰<br><br><span class="hljs-keyword">assert</span> person.containsKey(<span class="hljs-string">&#x27;name&#x27;</span>) ï¼ˆ<span class="hljs-number">2</span>ï¼‰<br><span class="hljs-keyword">assert</span> !person.containsKey(<span class="hljs-string">&#x27;key&#x27;</span>) ï¼ˆ<span class="hljs-number">3</span>ï¼‰<br></code></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰è¿™æ¬¡ï¼Œæˆ‘ä»¬ä½¿ç”¨åœ†æ‹¬å·åŒ…å›´keyå˜é‡ï¼ŒæŒ‡ç¤ºè§£æå™¨æˆ‘ä»¬ä¼ é€’ä¸€ä¸ªå˜é‡ï¼Œè€Œä¸æ˜¯å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²é”®<br>ï¼ˆ2ï¼‰æ˜ å°„åŒ…å«nameé”®<br>ï¼ˆ3ï¼‰ä½†æ˜ å°„ä¸åƒä¹‹å‰åŒ…å«keyé”®</p><p>è½¬è½½è‡ª <a href="http://ifeve.com/groovy-syntax/">http://ifeve.com/groovy-syntax/</a></p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Gradle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¯¹åº”ç”¨ä¸­Alarmä¼˜åŒ–</title>
    <link href="/2018/10/31/%E5%AF%B9%E5%BA%94%E7%94%A8%E4%B8%ADAlarm%E4%BC%98%E5%8C%96/"/>
    <url>/2018/10/31/%E5%AF%B9%E5%BA%94%E7%94%A8%E4%B8%ADAlarm%E4%BC%98%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<p>èµ·å› ï¼šåä¸ºåº”ç”¨å¸‚åœºåé¦ˆAlarmå”¤é†’æ¬¡æ•°è¿‡å¤šï¼Œéœ€è¦ä¼˜åŒ–ã€‚<br>æœªä¼˜åŒ–ä¹‹å‰é€šè¿‡åä¸ºçš„DevEcoè¿›è¡ŒåŠŸè€—æµ‹è¯•ï¼Œåœ¨Mate 9ä¸Šæ¯å°æ—¶å”¤é†’71æ¬¡ï¼Œåœ¨p10ä¸Šæ¯å°æ—¶å”¤é†’62ï¼Œå¦¥å¦¥çš„æ‰‹æœºæ²¡åŠæ³•è¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œè€Œä»–ä»¬çš„æ ‡å‡†æ˜¯æ¯ä¸ªåº”ç”¨æ¯å°æ—¶å”¤é†’ä¸è¶…è¿‡20æ¬¡ã€‚<br><img src="/image/Android/alarm/%E6%9C%AA%E4%BC%98%E5%8C%96.png" alt="æµ‹è¯•ç»“æœ"></p><span id="more"></span><h4 id="æŸ¥æ‰¾ä½¿ç”¨Alarmçš„ä»£ç "><a href="#æŸ¥æ‰¾ä½¿ç”¨Alarmçš„ä»£ç " class="headerlink" title="æŸ¥æ‰¾ä½¿ç”¨Alarmçš„ä»£ç "></a>æŸ¥æ‰¾ä½¿ç”¨Alarmçš„ä»£ç </h4><ol><li>Alarmçš„ä½¿ç”¨éœ€è¦AlarmManagerï¼Œè€ŒAlarmManagerçš„è·å–æ˜¯é€šè¿‡getSystemService(ALARM_SERVICE)è·å–åˆ°çš„ï¼Œæ‰¾åˆ°äº†æŸä¸ªç±»ä¸­ä¸­çš„doMyJobæ–¹æ³•ï¼Œå…¶ä¸­æ¯éš”5åˆ†é’Ÿå”¤é†’ä¸€æ¬¡è®¾å¤‡ã€‚å…¶ä»–çš„AlarmæœåŠ¡é—´éš”æ—¶é—´æ¯”è¾ƒé•¿ï¼Œæœ‰çš„æ˜¯ä¸€å¤©å”¤é†’ä¸€æ¬¡ï¼Œæœ‰çš„æ˜¯å®šæ—¶ä¸Šåˆä¹ç‚¹å”¤é†’ï¼Œè¿™äº›é—¹é’Ÿå…¨éƒ¨åŠ èµ·æ¥ä¸€å°æ—¶ä¹Ÿä¸ä¼šè¶…è¿‡15æ¬¡ã€‚</li><li>ä½¿ç”¨ adb shell dumpsys alarm | grep â€œåŒ…åâ€ æŸ¥çœ‹ç³»ç»Ÿä¸­çš„å­˜åœ¨å“ªäº›Alarmå¹¶é€šè¿‡é¡¹ç›®åŒ…åè¿‡æ»¤æ‰ä¸æ˜¯è‡ªå·±å·¥ç¨‹çš„Alarmï¼Œå‘ç°äº† <code> *walarm*:åŒ…å.service_alive_alarm_filter</code>,æŸ¥çœ‹ç›¸å…³ä»£ç å‘ç°æ¯éš”ååˆ†é’Ÿå”¤é†’ä¸€æ¬¡è®¾å¤‡ï¼Œä¸€æ–¹é¢æ˜¯ä¸ºäº†ä¿æ´»ï¼Œä¸€æ–¹é¢æ˜¯ä¸ºäº†æ£€æŸ¥è®¡æ­¥ä¼ æ„Ÿå™¨æ˜¯å¦å¼€å¯ï¼Œå› ä¸ºæœ‰äº›è®¾å¤‡åœ¨æ¯å±ä¹‹åä¼šå…³é—­è®¡æ­¥ä¼ æ„Ÿå™¨ï¼Œè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦åˆ‡æ¢åˆ°è‡ªå·±çš„è®¡æ­¥ç®—æ³•ï¼Œé€šè¿‡åŠ é€Ÿåº¦ä¼ æ„Ÿå™¨æ¥è®¡ç®—è¿åŠ¨æ­¥æ•°ã€‚</li><li>è°ƒæ•´è¿™ä¸¤ä¸ªAlarmçš„å”¤é†’é¢‘ç‡ï¼Œ æäº¤åˆ°DevEcoè¿›è¡Œæµ‹è¯•ï¼Œç»“æœå¦‚ä¸‹ï¼š<br><img src="/image/Android/alarm/%E7%AC%AC%E4%B8%80%E6%AC%A1%E4%BC%98%E5%8C%96.png" alt="æµ‹è¯•ç»“æœ"></li></ol><h4 id="æŸ¥æ‰¾ä¸‰æ–¹ä½¿ç”¨çš„Alarm"><a href="#æŸ¥æ‰¾ä¸‰æ–¹ä½¿ç”¨çš„Alarm" class="headerlink" title="æŸ¥æ‰¾ä¸‰æ–¹ä½¿ç”¨çš„Alarm"></a>æŸ¥æ‰¾ä¸‰æ–¹ä½¿ç”¨çš„Alarm</h4><ol><li>ä»”ç»†æŸ¥çœ‹ä½¿ç”¨adb shellæ‰¾åˆ°çš„alarmï¼Œå‘ç°äº†è¿™è´§ <code>*walarm*:AlarmNioTaskSchedule.åŒ…å</code>ï¼Œå¦‚æœæ˜¯æˆ‘ä»¬è‡ªå·±åœ¨å·¥ç¨‹é‡Œé¢è®¾ç½®çš„Alarmï¼Œä¸€èˆ¬æ˜¯ä»¥è‡ªå·±çš„é¡¹ç›®åŒ…åå‘½åçš„ï¼Œæ¥ç€æŸ¥dumpå‡ºæ¥çš„ä¿¡æ¯ï¼Œæ‰¾åˆ°äº†ä¸¤ä¸ªå”¤é†’é—´éš”æ—¶é—´éå¸¸çŸ­çš„Alarmï¼Œç²—ç•¥ä¼°è®¡æ¯ä¸ªçš„å”¤é†’é—´éš”åœ¨4åˆ†é’ŸåŠã€‚ä¸‹é¢æ—¥å¿—ä¸­whenå°±æ˜¯alarmå”¤é†’çš„æ—¶é—´ç‚¹<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs log">ELAPSED_WAKEUP #0: Alarm&#123;a359f35 type 2 when 1911290944 åŒ…å&#125;<br>      operation=PendingIntent&#123;7551fca: PendingIntentRecord&#123;eb70106 åŒ…å startService&#125;&#125;<br>ELAPSED_WAKEUP #1: Alarm&#123;80150f type 2 when 1911660925 åŒ…å&#125;<br>      operation=PendingIntent&#123;58db99c: PendingIntentRecord&#123;35972a0 åŒ…å broadcastIntent&#125;&#125;<br></code></pre></td></tr></table></figure></li></ol><p>é€šè¿‡PendingIntentå’ŒPendingIntentRecordçš„ç¼–å·ï¼Œç»“åˆ  adb shell dumpsys activity intents | grep â€œåŒ…åâ€<br>æ‰¾åˆ°è®¾ç½®è¯¥Alarmçš„åŒ…åï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs log">#4: PendingIntentRecord&#123;eb70106 åŒ…å startService&#125;<br>      uid=10415 packageName=åŒ…å type=startService flags=0x0<br>      requestIntent=act=com.qiyukf.desk.ACTION.KEEP_ALIVE cmp=åŒ…å/com.qiyukf.nimlib.service.NimService (has extras)<br> <br>#8: PendingIntentRecord&#123;35972a0 åŒ…å broadcastIntent&#125;<br>      uid=10415 packageName=åŒ…å type=broadcastIntent flags=0x0<br>      requestIntent=act=com.qiyukf.nim.ACTION.ALARM.REPEATING cmp=åŒ…å/com.qiyukf.nimlib.service.NimReceiver<br></code></pre></td></tr></table></figure><p>ç”±äºæ˜¯ä¸‰æ–¹çš„åŒ…ï¼Œæ²¡åŠæ³•ä¿®æ”¹ä»£ç æ¥å®Œæˆï¼Œåªèƒ½ç”¨å…¶ä»–æ–¹æ³•ã€‚<br>ç¿»çœ‹è®¾ç½®Alarmçš„æºç å‘ç°ï¼šç”±äºè®¾ç½®Alarmçš„æ—¶å€™éœ€è¦è°ƒç”¨setæˆ–è€…setRepeatingæ–¹æ³•ï¼Œæœ€ç»ˆéƒ½ä¼šè°ƒç”¨setImplæ–¹æ³•ï¼Œæœ€åé€šè¿‡è¿›ç¨‹é—´é€šä¿¡ï¼Œè°ƒIAlarmManagerçš„setæ–¹æ³•ã€‚<br>IAlarmManagerçš„å®ç°ç±»æ˜¯AlarmManagerService,åªéœ€è¦æ›¿æ¢æ‰è¿™ä¸ªç±»çš„å®ä¾‹ï¼Œåœ¨è°ƒç”¨å®ƒçš„setæ–¹æ³•æ—¶ï¼Œæ›¿æ¢æ‰alarmçš„æ—¶é—´é—´éš”<br>å°±å¯ä»¥å‡å°‘ä¸€éƒ¨åˆ†alarmçš„å”¤é†’ã€‚<br>ç”±äºhookçš„æ—¶é—´è¶Šæ—©è¶Šå¥½ï¼Œäºæ˜¯é€‰åœ¨Applicationåˆå§‹åŒ–çš„æ—¶å€™è¿›è¡Œhookï¼Œåœ¨Applicationçš„onCreateæ–¹æ³•ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æ›¿æ¢IAlarmService</span><br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">AlarmManager</span> <span class="hljs-variable">alarm</span> <span class="hljs-operator">=</span> (AlarmManager) getSystemService(ALARM_SERVICE);<br>    Class&lt;?&gt; alarmManagerClass = alarm.getClass();<br>    <span class="hljs-type">Field</span> <span class="hljs-variable">mService</span> <span class="hljs-operator">=</span> alarmManagerClass.getDeclaredField(<span class="hljs-string">&quot;mService&quot;</span>);<br>    mService.setAccessible(<span class="hljs-literal">true</span>);<br>    <span class="hljs-type">Object</span> <span class="hljs-variable">mSerViceInstant</span> <span class="hljs-operator">=</span> mService.get(alarm);<br><br>    <span class="hljs-type">AlarmManagerInvocationHandler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AlarmManagerInvocationHandler</span>(mSerViceInstant);<br>    Class&lt;?&gt; IActivityManagerIntercept = Class.forName(<span class="hljs-string">&quot;android.app.IAlarmManager&quot;</span>);<br>    <span class="hljs-type">Object</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>&lt;?&gt;[]&#123;IActivityManagerIntercept&#125;, handler);<br>    mService.set(alarm, proxy);<br><br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>    Log.e(<span class="hljs-string">&quot;alarm_manager&quot;</span>, <span class="hljs-string">&quot;æ›¿æ¢å‡ºé”™&quot;</span>);<br>    e.printStackTrace();<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AlarmManagerInvocationHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Object iAlarmManagerObject;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">AlarmManagerInvocationHandler</span><span class="hljs-params">(Object iAlarmManagerObject)</span> &#123;<br>        <span class="hljs-built_in">this</span>.iAlarmManagerObject = iAlarmManagerObject;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br><br><br>        Log.i(<span class="hljs-string">&quot;alarm_manager&quot;</span>, method.getName());<br>        <span class="hljs-comment">//å°äºäº”å°æ—¶é—´éš”çš„è®¾ç½®ä¸ºäº”å°æ—¶</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;set&quot;</span>.equals(method.getName())) &#123;<br>            Log.e(<span class="hljs-string">&quot;alarm_manager&quot;</span>, <span class="hljs-string">&quot;è°ƒç”¨äº†mService.set()&quot;</span>);<br>            <span class="hljs-type">int</span> <span class="hljs-variable">minAlarmInterval</span> <span class="hljs-operator">=</span> <span class="hljs-number">300</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">long</span> <span class="hljs-variable">interval</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>                <span class="hljs-type">int</span> <span class="hljs-variable">alarmManagerTimeType</span> <span class="hljs-operator">=</span> Integer.valueOf(args[<span class="hljs-number">1</span>].toString());<br>                <span class="hljs-type">long</span> <span class="hljs-variable">alarmManagerAtTime</span> <span class="hljs-operator">=</span> Long.valueOf(args[<span class="hljs-number">2</span>].toString());<br>                Log.e(<span class="hljs-string">&quot;alarm_manager_interval&quot;</span>, <span class="hljs-string">&quot;alarmManagerTimeType:&quot;</span> +alarmManagerTimeType);<br>                Log.e(<span class="hljs-string">&quot;alarm_manager_interval&quot;</span>, <span class="hljs-string">&quot;alarmManagerAtTime:&quot;</span> +alarmManagerAtTime);<br>                <span class="hljs-keyword">switch</span> (alarmManagerTimeType) &#123;<br>                    <span class="hljs-keyword">case</span> AlarmManager.RTC_WAKEUP:<br>                    <span class="hljs-keyword">case</span> AlarmManager.RTC:<br>                        Log.e(<span class="hljs-string">&quot;alarm_manager_interval&quot;</span>, <span class="hljs-string">&quot;currentTimeMillis--RTC:&quot;</span> +System.currentTimeMillis());<br>                         interval = alarmManagerAtTime - System.currentTimeMillis();<br>                            <span class="hljs-keyword">if</span>(interval &lt; minAlarmInterval)&#123;<br>                                interval = minAlarmInterval;<br>                                args[<span class="hljs-number">2</span>] = System.currentTimeMillis() + interval;<br>                            &#125;<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> AlarmManager.ELAPSED_REALTIME:<br>                    <span class="hljs-keyword">case</span> AlarmManager.ELAPSED_REALTIME_WAKEUP:<br>                        Log.e(<span class="hljs-string">&quot;alarm_manager_interval&quot;</span>, <span class="hljs-string">&quot;currentTimeMillis--ELAPSED_REALTIME:&quot;</span> +SystemClock.elapsedRealtime());<br>                        interval = alarmManagerAtTime - SystemClock.elapsedRealtime();<br>                        <span class="hljs-keyword">if</span>(interval &lt; minAlarmInterval)&#123;<br>                            interval = minAlarmInterval;<br>                            args[<span class="hljs-number">2</span>] = SystemClock.elapsedRealtime() + interval;<br>                        &#125;<br>                        <span class="hljs-keyword">break</span>;<br>                &#125;<br>                Log.e(<span class="hljs-string">&quot;alarm_manager_interval&quot;</span>,interval+<span class="hljs-string">&quot;--&gt;&quot;</span> + interval/<span class="hljs-number">1000</span>/<span class="hljs-number">60</span> );<br><br><br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>            &#125;<br><br>        &#125;<br>        <span class="hljs-keyword">return</span> method.invoke(iAlarmManagerObject, args);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ‰“åŒ…æäº¤DevEcoè¿›è¡Œæµ‹è¯•ï¼Œç»“æœå¦‚ä¸‹ï¼š<br><img src="/image/Android/alarm/%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BC%98%E5%8C%96.png" alt="æµ‹è¯•ç»“æœ"></p><h4 id="å½“å‰ç»“æœ"><a href="#å½“å‰ç»“æœ" class="headerlink" title="å½“å‰ç»“æœ"></a>å½“å‰ç»“æœ</h4><p>ä»æœ€åˆçš„60-70æ¬¡ä¼˜åŒ–åˆ°ç°åœ¨çš„19-23æ¬¡ï¼Œä½†è¿˜æ˜¯ä¸ç¬¦åˆåä¸ºçš„æ ‡å‡†æ¯å°æ—¶å°äº20æ¬¡ï¼ŒåŸå› åœ¨äºæœ‰ä¸€ä¸ªAlarmæ²¡æœ‰æ‰¾åˆ°æ‰€å±çš„ç¨‹åºåŒ…ï¼Œä¸çŸ¥é“æ˜¯åœ¨å“ªé‡Œè®¾ç½®çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs log">RTC_WAKEUP #0: Alarm&#123;c5091d9 type 0 when 1534851817125 åŒ…å&#125;<br>      tag=*walarm*:AlarmTaskSchedule.åŒ…å<br>      operation=PendingIntent&#123;194679e: PendingIntentRecord&#123;e513b24 åŒ…å broadcastIntent&#125;&#125;<br>*walarm*:AlarmTaskSchedule.åŒ…å<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªAlarmç²—ç•¥ä¼°è®¡æ¯å°æ—¶å”¤é†’æ¬¡æ•°åœ¨15-20æ¬¡ä¹‹é—´ï¼Œæ—¢ç„¶é€šè¿‡hookåº•å±‚ä»£ç çš„æ–¹æ³•æ²¡æœ‰æ‹¦æˆªä¸‹å®ƒï¼Œä¼°è®¡æ˜¯é€šè¿‡jniåœ¨æ›´åŠ åº•å±‚è¿›è¡Œçš„æ“ä½œï¼Œç›®å‰è¿˜åœ¨æ’æŸ¥</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨expressæ¨¡æ‹Ÿåå°è¿”å›æ•°æ®</title>
    <link href="/2018/09/27/%E4%BD%BF%E7%94%A8express%E6%A8%A1%E6%8B%9F%E5%90%8E%E5%8F%B0%E8%BF%94%E5%9B%9E%E6%95%B0%E6%8D%AE/"/>
    <url>/2018/09/27/%E4%BD%BF%E7%94%A8express%E6%A8%A1%E6%8B%9F%E5%90%8E%E5%8F%B0%E8%BF%94%E5%9B%9E%E6%95%B0%E6%8D%AE/</url>
    
    <content type="html"><![CDATA[<p>åœ¨ç ”å‘è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶å€™ä¼šé‡åˆ°å‰ç«¯å†™å®Œäº†ï¼Œä½†æ˜¯åç«¯æ¥å£è¿˜æ²¡æœ‰å®Œæˆçš„æƒ…å†µã€‚ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä¼šå†™ä¸€äº›å‡æ•°æ®æ¥å¡«å……UIï¼Œè¿™ç§æ–¹å¼æ²¡æœ‰åŠæ³•æ£€æµ‹ç½‘ç»œè¯·æ±‚æœ‰æ²¡æœ‰é—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥è‡ªå·±æ­ä¸€ä¸ªæœåŠ¡ï¼Œè¯·æ±‚è‡ªå·±çš„æœåŠ¡æ¥è¿”å›ä¸€äº›æ¨¡æ‹Ÿæ•°æ®ã€‚æ¯”å¦‚å¯ä»¥ä½¿ç”¨nodeå’Œexpressæ¨¡å—æ¥åšã€‚</p><span id="more"></span><h4 id="å®‰è£…node"><a href="#å®‰è£…node" class="headerlink" title="å®‰è£…node"></a>å®‰è£…node</h4><p>å®˜ç½‘è‡ªå·±æŸ¥<br>å®‰è£…nodeä¼šè‡ªåŠ¨å®‰è£…npmåŒ…ç®¡ç†å·¥å…·ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å®‰è£…nodeå’ŒnpmåŒ…ç®¡ç†å·¥å…·ï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œ<code>node -v</code> å’Œ <code>npm -v</code>æ¥æŸ¥çœ‹ï¼Œå¦‚æœå·²ç»å®‰è£…åˆ™ä¼šè¾“å‡ºå¯¹åº”çš„ç‰ˆæœ¬å·<br><img src="/image/Android/express/node_and_npm.png" alt="nodeå’Œnpm"></p><h4 id="å®‰è£…express"><a href="#å®‰è£…express" class="headerlink" title="å®‰è£…express"></a>å®‰è£…express</h4><p>å®˜ç½‘åœ¨è¿™é‡Œ <a href="http://expressjs.com/zh-cn/">http://expressjs.com/zh-cn/</a></p><ol><li>å…¨å±€å®‰è£… <code>express-generator</code><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install -g express-generator<br></code></pre></td></tr></table></figure></li><li>åˆ›å»ºä¸€ä¸ªæµ‹è¯•å·¥ç¨‹<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">express --view=pug testExpress<br></code></pre></td></tr></table></figure>æˆåŠŸåä¼šè‡ªåŠ¨åœ¨ç›®æ ‡ä½ç½®åˆ›å»ºä¸€ä¸ªåä¸ºmyappçš„é¡¹ç›®å¹¶ç”Ÿæˆå¾ˆå¤šæ–‡ä»¶<br><img src="/image/Android/express/create_myapp.png" alt="åˆ›å»ºmyapp"><br>ç„¶åæ ¹æ®æç¤ºæ‰§è¡Œ</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd testExpress &amp;&amp; npm install<br></code></pre></td></tr></table></figure><p>ä¹‹åæ‰§è¡Œ <code>npm start</code><br>æç¤º </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">myapp@0.0.0 start /Users/huangyuan/myapp</span><br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">node ./bin/www</span><br></code></pre></td></tr></table></figure><p>è¡¨ç¤ºå¯åŠ¨æœåŠ¡æˆåŠŸï¼Œç„¶ååœ¨æµè§ˆå™¨è¾“å…¥<code>http://127.0.0.1:3000</code>,ç•Œé¢æ˜¾ç¤º<code>Welcome to Express</code>è¯´æ˜æœåŠ¡å·²ç»å¯åŠ¨æˆåŠŸ</p><h4 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h4><p>å®‰è£…å®Œæˆåæ•´ä¸ªå·¥ç¨‹ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š<br><img src="/image/Android/express/myapp_constructor.png" alt="å·¥ç¨‹ç»“æ„"><br>æ—¢ç„¶æ˜¯æ¨¡æ‹Ÿåå°çš„è¿”å›æ•°æ®ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨<code>app.js</code>æ–‡ä»¶å’Œ<code>routers</code>æ–‡ä»¶å¤¹å°±å¯ä»¥äº†ã€‚<br>åœ¨<code>routers</code>æ–‡ä»¶å¤¹ä¸­æœ‰<code>index.js</code>å’Œ<code>user.js</code>æ–‡ä»¶ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶åœ¨<code>app.js</code>æ–‡ä»¶ä¸­æ³¨å†Œå¹¶ä½¿ç”¨ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> indexRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./routes/index&#x27;</span>);<br><span class="hljs-keyword">var</span> usersRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./routes/users&#x27;</span>);<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;/&#x27;</span>, indexRouter);<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;/users&#x27;</span>, usersRouter);<br></code></pre></td></tr></table></figure><p>æ„æ€å·®ä¸å¤šå°±æ˜¯è®¿é—®æ ¹ç›®å½•ï¼Œåˆ™è¿”å›<code>index.js</code>æ–‡ä»¶ä¸­<code>router.get</code>æ³¨å†Œä¸º<code>/</code>çš„æ–¹æ³•ä¸­<code>res.render</code>çš„å€¼ã€‚<br>åŒæ ·çš„ï¼Œæˆ‘ä»¬è®¿é—®<code>/users</code>åˆ™ä¼šè¿”å›è¯¥æ–‡ä»¶ä¸­<code>data</code>å­—æ®µçš„å€¼ã€‚</p><h4 id="ä»¿å†™"><a href="#ä»¿å†™" class="headerlink" title="ä»¿å†™"></a>ä»¿å†™</h4><p>ä»¿é€ ä¸Šé¢ä¸¤ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥å†™ç‚¹å…¶ä»–çš„ä¸œè¥¿ã€‚<br>åœ¨<code>routes</code>æ–‡ä»¶å¤¹ä¸‹æ–°å»º<code>version.js</code>,å†…å¦‚å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javaScript"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">var</span> router = express.<span class="hljs-title class_">Router</span>();<br><span class="hljs-keyword">var</span> data = &#123;<br>  <span class="hljs-string">&#x27;code&#x27;</span>:<span class="hljs-number">0</span>,<br>  <span class="hljs-string">&#x27;message&#x27;</span>:<span class="hljs-string">&#x27;success&#x27;</span>,<br>  <span class="hljs-string">&#x27;version&#x27;</span>:&#123;<br>      <span class="hljs-string">&quot;versionCode&quot;</span>:<span class="hljs-string">&quot;1.0.1&quot;</span>,<br>      <span class="hljs-string">&quot;versionName&quot;</span>:<span class="hljs-string">&quot;æœºé‡&quot;</span><br>  &#125;<br>&#125;<br>router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) &#123;<br>  res.<span class="hljs-title function_">send</span>(data);<br>&#125;);<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = router;<br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬éœ€è¦æ ¹æ®è¯·æ±‚å‚æ•°ä¸åŒè¿”å›ä¸åŒçš„æ•°æ®ï¼Œåªè¦å–åˆ°è¯·æ±‚å‚æ•°ï¼Œç„¶åè‡ªå·±æ„å»ºè¿”å›å€¼å°±å¥½äº†ï¼šåœ¨<code>version.js</code>ä¸­</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">router.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/param&#x27;</span>,<span class="hljs-keyword">function</span> (<span class="hljs-params">req,res,next</span>) &#123;<br>   res.<span class="hljs-title function_">send</span>(req.<span class="hljs-property">query</span>.<span class="hljs-property">name</span>)<br>&#125;);<br></code></pre></td></tr></table></figure><p>åœ¨<code>app.js</code>ä¸­æ³¨å†Œï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javaScript"><span class="hljs-keyword">var</span> versionRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./routes/version&#x27;</span>)<br>...<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;/version&#x27;</span>,versionRouter)<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯åœ¨<code>app.use</code>æ–¹æ³•ä¸­ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯æˆ‘ä»¬è¦è®¿é—®çš„è·¯å¾„<br>å¦‚æœæˆ‘ä»¬è¯·æ±‚çš„è·¯å¾„ä¸º <code>/version/param?name=xuan</code>,é‚£ä¹ˆè¿”å›å€¼ä¸º<code>xuan</code>,å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£Requestä¸­çš„req.query<br>å¦‚æœæˆ‘ä»¬è¯·æ±‚çš„è·¯å¾„ä¸º <code>/version</code>,é‚£ä¹ˆè¿”å›å€¼ä¸ºdataçš„å€¼</p><p>é‡å¯æœåŠ¡ï¼Œç„¶åè®¿é—®ä¸€ä¸‹ï¼Œå¦‚æœè¿”å›äº†æ­£ç¡®çš„jsonæ•°æ®ï¼Œè¯´æ˜é…ç½®æˆåŠŸã€‚åœ¨ä¿®æ”¹é…ç½®æˆ–è€…æ·»åŠ å†…å®¹çš„æ—¶å€™ï¼Œå¦‚æœå†æ¬¡è®¿é—®æ²¡æœ‰æˆåŠŸæˆ–è€…è¿˜æ˜¯åŸæ¥çš„å†…å®¹ï¼Œæ³¨æ„çœ‹ä¸€ä¸‹æ§åˆ¶å°æ˜¯ä¸æ˜¯è¢«304ç¼“å­˜äº†ã€‚</p><p>è¿™æ ·æˆ‘ä»¬åªéœ€è¦åœ¨ç ”å‘é˜¶æ®µæŠŠåœ°å€æŒ‡å‘æˆ‘ä»¬è‡ªå·±çš„æœåŠ¡ï¼Œè”è°ƒæ—¶æŒ‡å‘æµ‹è¯•æœåŠ¡å™¨å°±å¯ä»¥äº†ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Coordinatorlayout</title>
    <link href="/2018/08/20/Coordinatorlayout/"/>
    <url>/2018/08/20/Coordinatorlayout/</url>
    
    <content type="html"><![CDATA[<p>ä¸Šå›¾çš„åŠ¨ç”»å…¶å®æŒºç®€å•çš„ï¼Œå¦‚æœä½ çŸ¥é“çš„è¯ï¼Œå°±ä¸è¦ç»§ç»­å¾€ä¸‹çœ‹äº†ï¼Œé‚£æ˜¯åœ¨æµªè´¹æ—¶é—´ã€‚</p><span id="more"></span><p>ä¸»è¦ç”¨çš„å‰å‡ å¹´æ¨å‡ºçš„å‡ ä¸ªsupportåŒ…ï¼Œå¯æƒœå›½å†…æ²¡æœ‰æµè¡Œèµ·æ¥ã€‚</p><p>ç®€å•ç›´æ¥æ”¾ä»£ç ï¼š<br>gradleä¾èµ–ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gradle">implementation <span class="hljs-string">&#x27;com.android.support:appcompat-v7:28.0.0-rc01&#x27;</span><br>implementation <span class="hljs-string">&#x27;com.android.support.constraint:constraint-layout:1.1.2&#x27;</span><br>implementation <span class="hljs-string">&#x27;com.android.support:design:28.0.0-rc01&#x27;</span><br></code></pre></td></tr></table></figure><p>å¸ƒå±€æ–‡ä»¶ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">android.support.design.widget.CoordinatorLayout</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:app</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:fitsSystemWindows</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">android.support.design.widget.AppBarLayout</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;160dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:fitsSystemWindows</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:theme</span>=<span class="hljs-string">&quot;@style/ThemeOverlay.AppCompat.ActionBar&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">android.support.design.widget.CollapsingToolbarLayout</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/collapsingToolbarLayout&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:fitsSystemWindows</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">app:collapsedTitleTextAppearance</span>=<span class="hljs-string">&quot;@style/TextAppearance.AppCompat.Title&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">app:contentScrim</span>=<span class="hljs-string">&quot;?attr/colorPrimaryDark&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">app:expandedTitleMarginStart</span>=<span class="hljs-string">&quot;48dp&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">app:expandedTitleTextAppearance</span>=<span class="hljs-string">&quot;@style/TextAppearance.AppCompat.Title&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">app:layout_scrollFlags</span>=<span class="hljs-string">&quot;scroll|exitUntilCollapsed&quot;</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">ImageView</span></span><br><span class="hljs-tag">                <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">                <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">                <span class="hljs-attr">android:fitsSystemWindows</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">                <span class="hljs-attr">android:scaleType</span>=<span class="hljs-string">&quot;fitXY&quot;</span></span><br><span class="hljs-tag">                <span class="hljs-attr">android:src</span>=<span class="hljs-string">&quot;@drawable/title_bg&quot;</span></span><br><span class="hljs-tag">                <span class="hljs-attr">app:layout_collapseMode</span>=<span class="hljs-string">&quot;parallax&quot;</span></span><br><span class="hljs-tag">                <span class="hljs-attr">app:layout_collapseParallaxMultiplier</span>=<span class="hljs-string">&quot;0.5&quot;</span> /&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">android.support.v7.widget.Toolbar</span></span><br><span class="hljs-tag">                <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/toolbar&quot;</span></span><br><span class="hljs-tag">                <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">                <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;?attr/actionBarSize&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">android.support.design.widget.CollapsingToolbarLayout</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">android.support.design.widget.AppBarLayout</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">android.support.v7.widget.RecyclerView</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/recyclerview&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_behavior</span>=<span class="hljs-string">&quot;@string/appbar_scrolling_view_behavior&quot;</span> /&gt;</span><br><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">android.support.design.widget.CoordinatorLayout</span>&gt;</span><br></code></pre></td></tr></table></figure><p>activityä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br><br>    <span class="hljs-keyword">private</span> List&lt;String&gt; data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_main);<br>        <span class="hljs-type">Toolbar</span> <span class="hljs-variable">toolbar</span> <span class="hljs-operator">=</span> findViewById(R.id.toolbar);<br>        setSupportActionBar(toolbar);<br><br>        <span class="hljs-type">CollapsingToolbarLayout</span> <span class="hljs-variable">collapsingToolbarLayout</span> <span class="hljs-operator">=</span> findViewById(R.id.collapsingToolbarLayout);<br>        collapsingToolbarLayout.setTitle(<span class="hljs-string">&quot;Test CoordinatorLayout&quot;</span>);<br>        collapsingToolbarLayout.setContentScrimColor(Color.GRAY);<br>        collapsingToolbarLayout.setCollapsedTitleTextColor(ContextCompat.getColor(<span class="hljs-built_in">this</span>,R.color.colorAccent));<br>        collapsingToolbarLayout.setExpandedTitleColor(Color.WHITE);<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span> ; i &lt; <span class="hljs-number">100</span> ;i ++)&#123;<br>            data.add(<span class="hljs-string">&quot;item -- &gt;&quot;</span> + i);<br>        &#125;<br>        <span class="hljs-type">RecyclerView</span> <span class="hljs-variable">recyclerView</span> <span class="hljs-operator">=</span> findViewById(R.id.recyclerview);<br><br>        <span class="hljs-type">LinearLayoutManager</span> <span class="hljs-variable">linearLayoutManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinearLayoutManager</span>(MainActivity.<span class="hljs-built_in">this</span>);<br>        linearLayoutManager.setOrientation(LinearLayoutManager.VERTICAL);<br>        recyclerView.setLayoutManager(linearLayoutManager);<br>        <span class="hljs-type">RecyclerViewAdapter</span> <span class="hljs-variable">adapter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RecyclerViewAdapter</span>();<br>        recyclerView.setAdapter(adapter);<br>    &#125;<br><br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">RecyclerViewAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecyclerView</span>.Adapter&lt;RecyclerViewAdapter.ViewHolder&gt;&#123;<br><br><br>        <span class="hljs-meta">@NonNull</span><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> ViewHolder <span class="hljs-title function_">onCreateViewHolder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> ViewGroup viewGroup, <span class="hljs-type">int</span> i)</span> &#123;<br>            <span class="hljs-type">View</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> LayoutInflater.from(MainActivity.<span class="hljs-built_in">this</span>).inflate(android.R.layout.simple_list_item_1,viewGroup,<span class="hljs-literal">false</span>);<br><br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ViewHolder</span>(view);<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> ViewHolder viewHolder, <span class="hljs-type">int</span> i)</span> &#123;<br><br>            viewHolder.textView.setText(data.get(i));<br>            viewHolder.textView.setTextColor(ContextCompat.getColor(MainActivity.<span class="hljs-built_in">this</span>,R.color.colorAccent));<br><br><br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getItemCount</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> data.size();<br>        &#125;<br><br>        <span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewHolder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecyclerView</span>.ViewHolder&#123;<br><br>            TextView textView;<br><br>            <span class="hljs-keyword">public</span> <span class="hljs-title function_">ViewHolder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> View itemView)</span> &#123;<br>                <span class="hljs-built_in">super</span>(itemView);<br>                textView = itemView.findViewById(android.R.id.text1);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸æƒ³å¤šå†™ä»€ä¹ˆäº†ï¼Œå¯ä»¥è‡ªå·±å»æœè¿™äº›ä¸œè¥¿çš„ç”¨æ³•ã€‚å‚²å¨‡è„¸<del>_</del></p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ConstraintLayout</title>
    <link href="/2018/08/09/ConstraintLayout/"/>
    <url>/2018/08/09/ConstraintLayout/</url>
    
    <content type="html"><![CDATA[<p><a href="https://developer.android.google.cn/reference/android/support/constraint/ConstraintLayout">https://developer.android.google.cn/reference/android/support/constraint/ConstraintLayout</a><br>A ConstraintLayout is a ViewGroup which allows you to position and size widgets in a flexible way.</p><span id="more"></span><h3 id="ç‰ˆæœ¬æ”¯æŒ"><a href="#ç‰ˆæœ¬æ”¯æŒ" class="headerlink" title="ç‰ˆæœ¬æ”¯æŒ"></a>ç‰ˆæœ¬æ”¯æŒ</h3><p>ConstraintLayoutæ˜¯ä¸€ä¸ªæ”¯æŒåº“ï¼Œå‘å‰å…¼å®¹åˆ°Android9ï¼Œä»¥åè¿˜ä¼šæ·»åŠ æ›´å¤šçš„æ–°ç‰¹æ€§ã€‚ç°åœ¨å…¬å¸çš„äº§å“çš„æœ€ä½ç‰ˆæœ¬æ”¯æŒéƒ½åœ¨2.3ä¹‹ä¸Šï¼Œéƒ¨åˆ†äº§å“æœ€ä½ç‰ˆæœ¬æ”¯æŒä¿æŒåœ¨4.4ä¹‹ä¸Šã€‚è¿™å°±æ„å‘³ç€æˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒæœ€ä½ç‰ˆæœ¬æ”¯æŒçš„äº‹æƒ…ã€‚</p><h3 id="æ–°ç‰¹æ€§"><a href="#æ–°ç‰¹æ€§" class="headerlink" title="æ–°ç‰¹æ€§"></a>æ–°ç‰¹æ€§</h3><p>åœ¨ä½¿ç”¨æ–°ç‰¹æ€§çš„æ—¶å€™æ˜¯ä¸èƒ½æœ‰å¾ªç¯ä¾èµ–çš„ï¼Œæ¯”å¦‚ç›¸å¯¹å®šä½ï¼Œä¸èƒ½Aä¾èµ–äºBçš„ä½ç½®ï¼ŒBä¾èµ–Cçš„ä½ç½®ï¼Œè€ŒCåˆä¾èµ–Açš„ä½ç½®</p><h4 id="Relative-positioning"><a href="#Relative-positioning" class="headerlink" title="Relative positioning"></a>Relative positioning</h4><p>ç›¸å¯¹å®šä½æ˜¯ConstraintLayoutä¸­æœ€åŸºæœ¬çš„æ„å»ºæ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç©ºé—´ç›¸å¯¹äºå¦å¤–ä¸€ä¸ªç©ºé—´è¿›è¡Œä½ç½®ç¡®å®šï¼Œå¯ä»¥åœ¨æ¨ªå‘å’Œç«–å‘ä¸Šè¿›è¡Œçº¦æŸï¼š</p><blockquote><p>Horizontal Axis: left, right, start and end sides<br>  Vertical Axis: top, bottom sides and text baseline</p></blockquote><p>å¦‚æœæˆ‘ä»¬éœ€è¦è®©ButtonBåœ¨ButtonAçš„å³ä¾§ï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="/image/Android/ConstraintLayout/relative_positioning_example.png" alt="Relative Positioning Example"></p><p>åœ¨å¸ƒå±€æ–‡ä»¶ä¸­åªéœ€è¦ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/buttonA&quot;</span> <span class="hljs-attr">...</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/buttonB&quot;</span> <span class="hljs-attr">...</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintLeft_toRightOf</span>=<span class="hljs-string">&quot;@+id/buttonA&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™å°±å‘Šè¯‰ç³»ç»Ÿ è®©buttonBçš„å·¦è¾¹çº¦æŸäºbuttonAçš„å³è¾¹<br>ä¸‹é¢åˆ—å‡ºäº†æ‰€æœ‰å¯ç”¨çš„çº¦æŸæ–¹å¼ï¼š</p><ul><li>layout_constraintLeft_toLeftOf</li><li>layout_constraintLeft_toRightOf</li><li>layout_constraintRight_toLeftOf</li><li>layout_constraintRight_toRightOf</li><li>layout_constraintTop_toTopOf</li><li>layout_constraintTop_toBottomOf</li><li>layout_constraintBottom_toTopOf</li><li>layout_constraintBottom_toBottomOf</li><li>layout_constraintBaseline_toBaselineOf</li><li>layout_constraintStart_toEndOf</li><li>layout_constraintStart_toStartOf</li><li>layout_constraintEnd_toStartOf</li><li>layout_constraintEnd_toEndOf</li></ul><p>å„çº¦æŸä½ç½®å¦‚ä¸‹ï¼š<br><img src="/image/Android/ConstraintLayout/relative_position_constraint.png" alt="relative_position_constraint"><br>ä¸Šé¢è¿™äº›çº¦æŸå…³ç³»å…¨éƒ¨éƒ½æ˜¯æœ¬èº«ç›¸å¯¹äºå¦å¤–ä¸€ä¸ªæ§ä»¶(ä½¿ç”¨@idæ–¹å¼å¼•ç”¨å¦å¤–æ§ä»¶)æˆ–è€…çˆ¶å¸ƒå±€(ä½¿ç”¨parentæ–¹å¼å¼•ç”¨çˆ¶æ§ä»¶)è¿›è¡Œçº¦æŸ</p><h4 id="Margins"><a href="#Margins" class="headerlink" title="Margins"></a>Margins</h4><p><img src="/image/Android/ConstraintLayout/relative_positioning_margins.png" alt="Relative Positioning Margins"><br>è¿™é‡Œçš„å¤–è¾¹è·å’Œå…¶ä»–å¸ƒå±€æ–¹å¼çš„å¤–è¾¹è·ä¸€æ ·ï¼Œä¸èƒ½æ˜¯è´Ÿæ•°ï¼Œå±æ€§å¦‚ä¸‹ï¼š</p><ul><li>android:layout_marginStart</li><li>android:layout_marginEnd</li><li>android:layout_marginLeft</li><li>android:layout_marginTop</li><li>android:layout_marginRight</li><li>android:layout_marginBottom</li></ul><p>æ·»åŠ çš„ä¸€ä¸ªæ–°å±æ€§æ˜¯ <code>maiginGone</code>,å½“ä¸€ä¸ªçº¦æŸç›®æ ‡çš„å¯è§æ€§ä¸ºGONEçš„æ—¶å€™(View.GONE)ï¼Œå¯ä»¥æ”¹å˜å½“å‰æ§ä»¶çš„å¤–è¾¹è·ï¼Œæ¯”å¦‚Bæ˜¯ç›¸å¯¹äºAè¿›è¡Œçº¦æŸï¼Œå½“Aä¸å¯è§çš„æ—¶å€™ï¼Œå¯ä»¥æ”¹å˜Bçš„å¤–è¾¹è·ï¼Œä¹Ÿå°±æ˜¯Bçš„å¤–è¾¹è·å¯ä»¥æ ¹æ®Adeå¯è§æ€§è®¾ç½®ä¸åŒçš„å€¼ï¼Œå±æ€§å¦‚ä¸‹</p><ul><li>layout_goneMarginStart</li><li>layout_goneMarginEnd</li><li>layout_goneMarginLeft</li><li>layout_goneMarginTop</li><li>layout_goneMarginRight</li><li>layout_goneMarginBottom</li></ul><h4 id="Centering-positioning-and-bias"><a href="#Centering-positioning-and-bias" class="headerlink" title="Centering positioning and bias"></a>Centering positioning and bias</h4><p>** Centering Positioning **<br>å¦‚æœå¯¹ä¸€ä¸ªæ§ä»¶çš„å·¦å³(ä¸Šä¸‹)éƒ½æ·»åŠ çš„çº¦æŸï¼Œé‚£ä¹ˆConstraintLayoutçš„è¡¨ç°å°±åƒæœ‰ä¸¤ä¸ªå¤§å°ç›¸ç­‰æ–¹å‘ç›¸åçš„åŠ›åœ¨æ‹‰è¿™ä¸ªæ§ä»¶ä¸€ä¸ªæ ·ï¼Œæ¯”å¦‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">android.support.constraint.ConstraintLayout</span> <span class="hljs-attr">...</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/button&quot;</span> <span class="hljs-attr">...</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintLeft_toLeftOf</span>=<span class="hljs-string">&quot;parent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintRight_toRightOf</span>=<span class="hljs-string">&quot;parent/&gt;</span></span><br><span class="hljs-string"><span class="hljs-tag">&lt;/&gt;</span></span><br></code></pre></td></tr></table></figure><p>è¡¨ç°å¦‚ä¸‹ï¼š<br><img src="/image/Android/ConstraintLayout/centering_positioning.png" alt="Centering Positioning"><br>è¿™æ ·å°±ä¼šäº§ç”Ÿå±…ä¸­æ•ˆæœï¼Œå¦‚æœå­æ§ä»¶å’Œçˆ¶æ§ä»¶çš„å°ºå¯¸ç›¸åŒï¼Œè¿™å†™å±æ€§å°±æ²¡æœ‰æ„ä¹‰äº†</p><p>** bias **<br>å½“é‡åˆ°ä¸Šé¢è¿™ç§çº¦æŸçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>bias</code>å±æ€§è®©æ§ä»¶åå‘äºå“ªä¸€ä¸ªæ–¹å‘,å±æ€§å¦‚ä¸‹ï¼š</p><ul><li>layout_constraintHorizontal_bias</li><li>layout_constraintVertical_bias<br>ä¾‹å¦‚ï¼Œå¦‚ä¸‹ä»£ç ï¼š<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">android.support.constraint.ConstraintLayout</span> <span class="hljs-attr">...</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/button&quot;</span> <span class="hljs-attr">...</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintHorizontal_bias</span>=<span class="hljs-string">&quot;0.3&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintLeft_toLeftOf</span>=<span class="hljs-string">&quot;parent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintRight_toRightOf</span>=<span class="hljs-string">&quot;parent/&gt;</span></span><br><span class="hljs-string"><span class="hljs-tag">&lt;/&gt;</span></span><br></code></pre></td></tr></table></figure>è¡¨ç°å¦‚ä¸‹ï¼š<br><img src="/image/Android/ConstraintLayout/centering_positioning_with_bias.png" alt="Centering Positioning with Bias"></li></ul><h4 id="Circular-positioning-Added-in-1-1"><a href="#Circular-positioning-Added-in-1-1" class="headerlink" title="Circular positioning (Added in 1.1)"></a>Circular positioning (Added in 1.1)</h4><p>è¿™ä¸ªå±æ€§æ˜¯1.1ç‰ˆæœ¬æ·»åŠ è¿›å»çš„ï¼Œå¯ä»¥ä½¿ç”¨<code>angle</code>å’Œ<code>distance</code>æ¥çº¦æŸä¸€ä¸ªæ§ä»¶çš„ä¸­å¿ƒç‚¹å’Œå¦å¤–ä¸€ä¸ªç©ºé—´çš„ä¸­å¿ƒç‚¹çš„ä½ç½®å…³ç³»ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠç©ºé—´å®šä½åœ¨ä¸€ä¸ªåœ†ä¸Šï¼Œå¯ç”¨å±æ€§å¦‚ä¸‹ï¼š</p><ul><li>**layout_constraintCircle ** : references another widget id</li><li>**layout_constraintCircleRadius ** : the distance to the other widget center</li><li>**layout_constraintCircleAngle ** : which angle the widget should be at (in degrees, from 0 to 360)</li></ul><p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/buttonA&quot;</span> <span class="hljs-attr">...</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/buttonB&quot;</span> <span class="hljs-attr">...</span></span><br><span class="hljs-tag">      <span class="hljs-attr">app:layout_constraintCircle</span>=<span class="hljs-string">&quot;@+id/buttonA&quot;</span></span><br><span class="hljs-tag">      <span class="hljs-attr">app:layout_constraintCircleRadius</span>=<span class="hljs-string">&quot;100dp&quot;</span></span><br><span class="hljs-tag">      <span class="hljs-attr">app:layout_constraintCircleAngle</span>=<span class="hljs-string">&quot;45&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><p>è¡¨ç°å¦‚ä¸‹ï¼š<br><img src="/image/Android/ConstraintLayout/circular_positioning.png" alt="Circular Positioning"></p><h4 id="Visibility-behavior"><a href="#Visibility-behavior" class="headerlink" title="Visibility behavior"></a>Visibility behavior</h4><p>ConstraintLayoutå¯¹äºè¢«æ ‡è®°ä¸ºGONEçš„æ§ä»¶æœ‰ç‰¹æ®Šçš„å¤„ç†ã€‚ä¸€èˆ¬å¸ƒå±€ä¸­ï¼ŒGONEæ§ä»¶æ˜¯ä¸ä¼šå±•ç¤ºåœ¨ç•Œé¢ä¸Šå¹¶ä¸”ä¸å†å±äºå¸ƒå±€çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯åœ¨å¸ƒå±€è®¡ç®—ä¸Šï¼ŒConstraintLayoutå’Œä¼ ç»Ÿå¸ƒå±€æœ‰å¾ˆå¤§çš„åŒºåˆ«</p><ol><li>ä¼ ç»Ÿå¸ƒå±€ä¸‹ï¼ŒGONEæ§ä»¶ä¼šè¢«è®¤ä¸ºå¤§å°æ˜¯0ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç‚¹</li><li>åœ¨ConstraintLayoutä¸­å…¶å¤§å°ä»ç„¶æŒ‰ç…§å¯è§å¤§å°è®¡ç®—ï¼Œä½†æ˜¯å…¶å¤–è¾¹è·ä¸º0</li></ol><p><img src="/image/Android/ConstraintLayout/visibility_behavior.png" alt="Visibility Behavior"></p><h4 id="Dimension-constraints"><a href="#Dimension-constraints" class="headerlink" title="Dimension constraints"></a>Dimension constraints</h4><h5 id="Minimum-dimensions-on-ConstraintLayout"><a href="#Minimum-dimensions-on-ConstraintLayout" class="headerlink" title="Minimum dimensions on ConstraintLayout"></a>Minimum dimensions on ConstraintLayout</h5><p>å¯ä»¥åƒæ™®é€šæ§ä»¶ä¸€æ ·è®¾ç½®æœ€å°æœ€å¤§å°ºå¯¸,å±æ€§å¦‚ä¸‹ï¼š</p><ul><li>** android:minWidth ** set the minimum width for the layout</li><li>** android:minHeight ** set the minimum height for the layout</li><li>** android:maxWidth ** set the maximum width for the layout</li><li>** android:maxHeight ** set the maximum height for the layout</li></ul><p>è¿™äº›å±æ€§å½“ConstraintLayoutçš„å®½é«˜ä¸º<code>WRAP_CONTENT</code>æ—¶æœ‰æ•ˆã€‚</p><h5 id="Widgets-dimension-constraints"><a href="#Widgets-dimension-constraints" class="headerlink" title="Widgets dimension constraints"></a>Widgets dimension constraints</h5><p>å¯ä»¥é€šè¿‡<code>android:layout_width</code>å’Œ<code>android:layout_height</code>è®¾ç½®æ§ä»¶çš„å°ºå¯¸ï¼Œæœ‰ä¸‰ç§æ–¹å¼ï¼š</p><ul><li>å›ºå®šå€¼</li><li>WRAP_CONTENT</li><li>0dp, ç›¸å½“äº<code>MATCH_CONSTRAINT</code></li></ul><p>å‰ä¸¤ç§æ–¹å¼å’Œæ™®é€šå¸ƒå±€è¡¨ç°å‡ºæ¥çš„è¡Œä¸ºä¸€æ ·ã€‚æœ€åä¸€ç§ä¼šé€šè¿‡çº¦æŸæ¥é‡æ–°è®¾ç½®æ§ä»¶å°ºå¯¸ï¼Œå¦‚æœè®¾ç½®äº†marginï¼Œåœ¨å¸ƒå±€è®¡ç®—çš„æ—¶å€™ä¹Ÿä¼šè¢«è€ƒè™‘è¿›å»ã€‚<br> <img src="/image/Android/ConstraintLayout/dimension_constraints.png" alt="Dimension Constraints"><br>ä¸Šå›¾ä¸­çš„aæ˜¯wrap_content,bæ˜¯0dpï¼Œcæ˜¯è®¾ç½®äº†marginçš„0dpã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ConstraintLayoutä¸­ï¼ŒMATCH_PARENTæ˜¯ä¸æ¨èä½¿ç”¨çš„ã€‚</p><h5 id="WRAP-CONTENT-enforcing-constraints-Added-in-1-1"><a href="#WRAP-CONTENT-enforcing-constraints-Added-in-1-1" class="headerlink" title="WRAP_CONTENT:enforcing constraints (Added in 1.1)"></a>WRAP_CONTENT:enforcing constraints (Added in 1.1)</h5><p>å¦‚æœæ§ä»¶å®é™…å°ºå¯¸è¶…è¿‡äº†çº¦æŸçš„å°ºå¯¸ï¼Œé‚£ä¹ˆçº¦æŸå°±ä¼šå¤±æ•ˆï¼Œè¿™æ—¶å€™å¯ä»¥æ·»åŠ å¦‚ä¸‹å±æ€§æ¥é™åˆ¶ï¼š</p><ul><li>app:layout_constrainedWidth&#x3D;â€true|falseâ€</li><li>app:layout_constrainedHeight&#x3D;â€true|falseâ€</li></ul><p>å°†Bæ§ä»¶çº¦æŸäºAæ§ä»¶å’Œçˆ¶æ§ä»¶çš„ä¸­é—´ï¼Œå°ºå¯¸éƒ½ä¸º<code>wrap_content</code><br><img src="/image/Android/ConstraintLayout/wrap_content_enforcing_constraints1.png" alt="enforcing constraints"><br>è¿™æ—¶å€™å¦‚æœå°†Bæ§ä»¶å¡«å……å¾ˆé•¿çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆBæ§ä»¶çš„å·¦ä¾§åˆ™ä¼šçªç ´çº¦æŸï¼Œå’ŒAæ§ä»¶çš„ä¸­å¿ƒå¯¹é½ï¼Œå¦‚æœæˆ‘ä»¬ä¸æƒ³è¦è¿™ç§æ–¹å¼ï¼Œè¿˜æ˜¯è¦æ±‚Bçš„å·¦ä¾§å’ŒAdeå³ä¾§å¯¹é½ï¼Œåˆ™å¯ä»¥å¤©å‰‘<br><code>layout_constrainedWidth=&quot;true&quot;</code>å±æ€§è¿›è¡Œçº¦æŸï¼Œå®ä¾‹å¦‚ä¸‹ï¼š<br><img src="/image/Android/ConstraintLayout/wrap_content_enforcing_constraints2.png" alt="çº¦æŸå¤±æ•ˆ"><br><img src="/image/Android/ConstraintLayout/wrap_content_enforcing_constraints3.png" alt="æ·»åŠ å¼ºåˆ¶çº¦æŸå±æ€§"></p><h5 id="MATCH-CONSTRAINT-dimensions-Added-in-1-1"><a href="#MATCH-CONSTRAINT-dimensions-Added-in-1-1" class="headerlink" title="MATCH_CONSTRAINT dimensions (Added in 1.1)"></a>MATCH_CONSTRAINT dimensions (Added in 1.1)</h5><p>å½“æ§ä»¶çš„å°ºå¯¸è¢«è®¾ç½®ä¸º<code>MATCH_CONSTRAINT</code>æ—¶ï¼Œé»˜è®¤çš„è¡Œä¸ºæ˜¯å æ®æ‰€æœ‰çš„å‰©ä½™ç©ºé—´ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å±æ€§æ¥æ›´æ”¹æ­¤è¡Œä¸ºï¼š</p><ul><li>** layout_constraintWidth_min ** å’Œ ** layout_constraintHeight_min ** : will set the minimum size for this dimension</li><li>** layout_constraintWidth_max ** å’Œ ** layout_constraintHeight_max ** : will set the maximum size for this dimension</li><li>** layout_constraintWidth_percent ** å’Œ ** layout_constraintHeight_percent ** : will set the size of this dimension as a percentage of the parent</li></ul><h5 id="Percent-dimension"><a href="#Percent-dimension" class="headerlink" title="Percent dimension"></a>Percent dimension</h5><p>To use percent, you need to set the following:<br>æƒ³è¦ä½¿ç”¨ç™¾åˆ†æ¯”å¸ƒå±€ï¼Œéœ€è¦è®¾ç½®å¦‚ä¸‹å±æ€§ï¼š</p><ol><li>æ§ä»¶å®½é«˜è®¾ç½®ä¸º <code>MATCH_CONSTRAINT</code> (0dp)</li><li><code>app:layout_constraintWidth_default</code>å±æ€§å€¼è®¾ç½®ä¸º<code>percent</code> </li><li>è®¾ç½® <code>layout_constraintWidth_percent</code>æˆ–è€…<code>layout_constraintHeight_percent</code>å±æ€§å€¼(0-1ä¹‹é—´)</li></ol><p>ä¸‹é¢çš„TextViewæ§ä»¶å°†å æ®å‰©ä½™å®½åº¦çš„50%å’Œå‰©ä½™é«˜åº¦çš„50%,ç¤ºä¾‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/textView6&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;0dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;0dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:background</span>=<span class="hljs-string">&quot;@color/colorAccent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintHeight_default</span>=<span class="hljs-string">&quot;percent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintHeight_percent</span>=<span class="hljs-string">&quot;0.5&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintWidth_default</span>=<span class="hljs-string">&quot;percent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintWidth_percent</span>=<span class="hljs-string">&quot;0.5&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><h5 id="Ratio"><a href="#Ratio" class="headerlink" title="Ratio"></a>Ratio</h5><p>å¯ä»¥è®¾ç½®æ§ä»¶çš„å®½é«˜æ¯”ä¾‹ï¼Œä¸ºäº†å®ç°è¿™ç§æ–¹å¼ï¼Œéœ€è¦è®©æ§ä»¶çš„å®½æˆ–è€…é«˜è®¾ç½®ä¸º0dp(MATCH_CONSTRAINT)ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;0dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintDimensionRatio</span>=<span class="hljs-string">&quot;1:1&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯ï¼Œé«˜åº¦ä¼šéšç€å®½åº¦çš„æ”¹å˜è€Œæ”¹å˜ï¼Œå¹¶ä¸”å¤§å°å’Œå®½åº¦ä¸€è‡´ã€‚è®¾ç½®å®½é«˜æ¯”çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š</p><ol><li>ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œ<code>å—çº¦æŸçš„ä¸€æ–¹çš„å°ºå¯¸/å¦ä¸€æ–¹å°ºå¯¸</code>å¾—åˆ°çš„æ•°å­—</li><li>å®½åº¦:é«˜åº¦</li></ol><p>å¦‚æœå®½é«˜ä¸¤ä¸ªæ–¹å‘åŒæ—¶è®¾ç½®äº†0dp(MATCH_CONSTRAINT)ï¼Œç³»ç»Ÿä¼šè®¾ç½®æ»¡è¶³æ¯”ä¾‹çš„æœ€å¤§å°ºå¯¸ï¼Œè¿™ç§æƒ…å†µä¸‹è¿˜è¦ä¿æŒå®½é«˜æ¯”ä¾‹ï¼Œéœ€è¦åœ¨æ¯”ä¾‹å‰é¢æ·»åŠ Wæˆ–è€…Hä»¥ç¡®å®šå—çº¦æŸçš„æ˜¯é«˜è¿˜æ˜¯å®½ã€‚</p><blockquote><p>You can also use ratio if both dimensions are set to MATCH_CONSTRAINT (0dp). In this case the system sets the largest dimensions the satisfies all constraints and maintains the    aspect ratio specified. To constrain one specific side based on the dimensions of another, you can pre append W,â€ or H, to constrain the width or height respectively. For          example, If one dimension is constrained by two targets (e.g. width is 0dp and centered on parent) you can indicate which side should be constrained, by adding the letter W (for   constraining the width) or H (for constraining the height) in front of the ratio, separated by a comma:<br>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;0dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;0dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintDimensionRatio</span>=<span class="hljs-string">&quot;H,16:9&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintBottom_toBottomOf</span>=<span class="hljs-string">&quot;parent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintTop_toTopOf</span>=<span class="hljs-string">&quot;parent&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><br>will set the height of the button following a 16:9 ratio, while the width of the button will match the constraints to parent.</p></blockquote><h4 id="Chains"><a href="#Chains" class="headerlink" title="Chains"></a>Chains</h4><p>Chains åœ¨å•è½´ï¼ˆæ°´å¹³æˆ–å‚ç›´ï¼‰ä¸Šæä¾›ç±»ä¼¼ç»„çš„è¡Œä¸ºã€‚å¦ä¸€ä¸ªè½´å¯ä»¥ç‹¬ç«‹åœ°çº¦æŸã€‚</p><h5 id="Creating-a-chain"><a href="#Creating-a-chain" class="headerlink" title="Creating a chain"></a>Creating a chain</h5><p>å¦‚æœä¸€ç»„å°éƒ¨ä»¶é€šè¿‡åŒå‘è¿æ¥é“¾æ¥åœ¨ä¸€èµ·ï¼Œåˆ™å®ƒä»¬è¢«è§†ä¸ºé“¾ï¼ˆå‚è§ä¸‹å›¾ï¼Œæ˜¾ç¤ºæœ€å°é“¾ï¼Œå…·æœ‰ä¸¤ä¸ªå°éƒ¨ä»¶ï¼‰ã€‚<br><img src="/image/Android/ConstraintLayout/chain.png" alt="chain"></p><h5 id="Chain-heads"><a href="#Chain-heads" class="headerlink" title="Chain heads"></a>Chain heads</h5><p>æ¨ªå‘ä¸Šï¼ŒChainå¤´éƒ¨æ˜¯Chainæœ€å·¦è¾¹çš„æ§ä»¶ï¼›çºµå‘ä¸Šï¼ŒChainå¤´éƒ¨æ˜¯Chainæœ€é¡¶éƒ¨çš„æ§ä»¶ã€‚<br><img src="/image/Android/ConstraintLayout/chain_head.png" alt="chain head"></p><h5 id="Margins-in-chains"><a href="#Margins-in-chains" class="headerlink" title="Margins in chains"></a>Margins in chains</h5><p>å¦‚æœè¿æ¥æ—¶å®šä¹‰äº†å¤–è¾¹è·ï¼ŒChainå°±ä¼šå‘ç”Ÿå˜åŒ–ã€‚åœ¨SPREAD CHAINä¸­ï¼Œå¤–è¾¹è·ä¼šä»å·²ç»åˆ†é…å¥½çš„ç©ºé—´ä¸­å»æ‰ã€‚åŸæ–‡å¦‚ä¸‹ï¼š</p><blockquote><p>If margins are specified on connections, they will be taken in account. In the case of spread chains, margins will be deducted from the allocated space.</p></blockquote><h5 id="Chain-Style"><a href="#Chain-Style" class="headerlink" title="Chain Style"></a>Chain Style</h5><p>å½“å¯¹Chainçš„ç¬¬ä¸€ä¸ªå…ƒç´ è®¾ç½®layout_constraintHorizontal_chainStyleæˆ–layout_constraintVertical_chainStyleå±æ€§ï¼ŒChainå°±ä¼šæ ¹æ®ç‰¹å®šçš„æ ·å¼ï¼ˆé»˜è®¤æ ·å¼ä¸ºCHAIN_SPREADï¼‰è¿›è¡Œç›¸åº”å˜åŒ–ï¼Œæ ·å¼ç±»å‹å¦‚ä¸‹ï¼š</p><ul><li>CHAIN_SPREAD â€“ å…ƒç´ å‘—åˆ†æ•£å¼€ (é»˜è®¤æ ·å¼) </li><li>Weighted chain â€“ åœ¨ CHAIN_SPREAD moæ ·å¼ä¸­,å¦‚æœæŸäº›æ§ä»¶è®¾ç½®äº†<code>MATCH_CONSTRAINT</code>å±æ€§, ä»–ä»¬å°†å¹³åˆ†å‰©ä½™ç©ºé—´ </li><li>CHAIN_SPREAD_INSIDE â€“ Chainçš„å¤´å°¾å…ƒç´ ç´§è´´çˆ¶å®¹å™¨</li><li>CHAIN_PACKED â€“ Chainä¸­çš„æ‰€æœ‰æ§ä»¶åˆå¹¶åœ¨ä¸€èµ·ååœ¨å‰©ä½™çš„ç©ºé—´ä¸­å±…ä¸­</li></ul><p>å›¾ç¤ºå¦‚ä¸‹ï¼š<br><img src="/image/Android/ConstraintLayout/chain_styles.png" alt="chain styles"></p><h5 id="Weighted-chains"><a href="#Weighted-chains" class="headerlink" title="Weighted chains"></a>Weighted chains</h5><p>é»˜è®¤çš„Chainä¼šåœ¨ç©ºé—´é‡Œå¹³å‡æ•£å¼€ã€‚å¦‚æœå…¶ä¸­æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ä½¿ç”¨äº†MATCH_CONSTRAINTå±æ€§ï¼Œé‚£ä¹ˆä»–ä»¬ä¼šå°†å‰©ä½™çš„ç©ºé—´å¹³å‡å¡«æ»¡ã€‚å±æ€§layout_constraintHorizontal_heightå’Œlayout_constraintVertical_weightæ§åˆ¶ä½¿ç”¨MATCH_CONSTRAINTçš„å…ƒç´ å¦‚ä½•å‡åˆ†ç©ºé—´ã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªChainä¸­åŒ…å«ä¸¤ä¸ªä½¿ç”¨MATCH_CONSTRAINTçš„å…ƒç´ ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ ä½¿ç”¨çš„æƒé‡ä¸º2ï¼Œç¬¬äºŒä¸ªå…ƒç´ ä½¿ç”¨çš„æƒé‡ä¸º1ï¼Œé‚£ä¹ˆè¢«ç¬¬ä¸€ä¸ªå…ƒç´ å ç”¨çš„ç©ºé—´æ˜¯ç¬¬äºŒä¸ªå…ƒç´ çš„2å€ã€‚</p><h5 id="Margins-and-chains-in-1-1"><a href="#Margins-and-chains-in-1-1" class="headerlink" title="Margins and chains (in 1.1)"></a>Margins and chains (in 1.1)</h5><p>åœ¨chainä¸­æ˜¯å¯ä»¥ä½¿ç”¨marginå±æ€§çš„ï¼Œä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªæ°´å¹³çš„chainä¸­ï¼Œä¸€ä¸ªå…ƒç´ å®šä¹‰äº†right_magin&#x3D;10dp,ä¸‹ä¸€ä¸ªå…ƒç´ å®šä¹‰äº†margin_left&#x3D;5dpï¼Œé‚£ä¹ˆä¸¤è€…ä¹‹é—´çš„é—´è·å°±æ˜¯15dp.</p><h4 id="Virtual-Helpers-objects"><a href="#Virtual-Helpers-objects" class="headerlink" title="Virtual Helpers objects"></a>Virtual Helpers objects</h4><h5 id="Guideline"><a href="#Guideline" class="headerlink" title="Guideline"></a>Guideline</h5><p><code>Guideline</code>æ˜¯åªèƒ½ç”¨åœ¨<code>ConstraintLayout</code>å¸ƒå±€é‡Œé¢çš„ä¸€ä¸ªå·¥å…·ç±»ï¼Œç”¨äºè¾…åŠ©å¸ƒå±€ï¼Œç±»ä¼¼ä¸ºè¾…åŠ©çº¿ï¼Œå¯ä»¥è®¾ç½®<code>android:orientation</code>å±æ€§æ¥ç¡®å®šæ˜¯æ¨ªå‘çš„è¿˜æ˜¯çºµå‘çš„ã€‚ </p><ul><li>å½“è®¾ç½®ä¸ºverticalçš„æ—¶å€™ï¼ŒGuidelineçš„å®½åº¦ä¸º0ï¼Œé«˜åº¦æ˜¯parentä¹Ÿå°±æ˜¯ConstraintLayoutçš„é«˜åº¦ </li><li>åŒæ ·è®¾ç½®ä¸ºhorizontalçš„æ—¶å€™ï¼Œé«˜åº¦ä¸º0ï¼Œå®½åº¦æ˜¯parentçš„å®½åº¦</li></ul><p>å®šä½Guidelineæœ‰ä¸‰ç§æ–¹å¼ï¼Œè¿™ä¸‰ç§æ–¹å¼åªèƒ½é€‰æ‹©ä¸€ä¸ª</p><ul><li>æŒ‡å®šè·ç¦»å·¦ä¾§æˆ–é¡¶éƒ¨çš„å›ºå®šè·ç¦»ï¼ˆlayout_constraintGuide_beginï¼‰ </li><li>æŒ‡å®šè·ç¦»å³ä¾§æˆ–åº•éƒ¨çš„å›ºå®šè·ç¦»ï¼ˆlayout_constraintGuide_endï¼‰ </li><li>æŒ‡å®šåœ¨çˆ¶æ§ä»¶ä¸­çš„å®½åº¦æˆ–é«˜åº¦çš„ç™¾åˆ†æ¯”ï¼ˆlayout_constraintGuide_percentï¼‰</li></ul><p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">android.support.constraint.Guideline</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/vertical_guideline&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">&quot;vertical&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintGuide_percent</span>=<span class="hljs-string">&quot;0.5&quot;</span> /&gt;</span><br><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">android.support.constraint.Guideline</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/horizontal_guideline&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">&quot;horizontal&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintGuide_percent</span>=<span class="hljs-string">&quot;0.5&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><p>å£°æ˜äº†ä¸€ä¸ªå‚ç›´å±…ä¸­ï¼Œä¸€ä¸ªæ°´å¹³å±…ä¸­çš„GuideLineï¼Œæ•ˆæœå¦‚ä¸‹ï¼Œè¿™ä¸¤ä¸ªæ§ä»¶åœ¨Viewä¸Šæ˜¯ä¸å¯è§çš„ã€‚<br><img src="/image/Android/ConstraintLayout/guideLine_declaration.png" alt="guideline declaration"></p><p>æ¥ç€å°±å¯ä»¥æ ¹æ®è¿™ä¸¤æ¡è¾…åŠ©çº¿æ¥å®šä½å…¶ä»–æ§ä»¶äº†</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:text</span>=<span class="hljs-string">&quot;top_left&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/top_left_button&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:layout_constraintBottom_toBottomOf</span>=<span class="hljs-string">&quot;@id/horizontal_guideline&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:layout_constraintLeft_toLeftOf</span>=<span class="hljs-string">&quot;parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:layout_constraintRight_toLeftOf</span>=<span class="hljs-string">&quot;@id/vertical_guideline&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:layout_constraintTop_toTopOf</span>=<span class="hljs-string">&quot;parent&quot;</span> /&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">Button</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:text</span>=<span class="hljs-string">&quot;top_right&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/top_right_button&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:layout_constraintBottom_toBottomOf</span>=<span class="hljs-string">&quot;@id/horizontal_guideline&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:layout_constraintLeft_toLeftOf</span>=<span class="hljs-string">&quot;@id/vertical_guideline&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:layout_constraintRight_toRightOf</span>=<span class="hljs-string">&quot;parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:layout_constraintTop_toTopOf</span>=<span class="hljs-string">&quot;parent&quot;</span> /&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">Button</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:text</span>=<span class="hljs-string">&quot;bottom_right&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/bottom_right_button&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:layout_constraintBottom_toBottomOf</span>=<span class="hljs-string">&quot;parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:layout_constraintLeft_toLeftOf</span>=<span class="hljs-string">&quot;@id/vertical_guideline&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:layout_constraintRight_toRightOf</span>=<span class="hljs-string">&quot;parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:layout_constraintTop_toTopOf</span>=<span class="hljs-string">&quot;@id/horizontal_guideline&quot;</span> /&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">Button</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:text</span>=<span class="hljs-string">&quot;bottom_left&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/bottom_left_button&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:layout_constraintBottom_toBottomOf</span>=<span class="hljs-string">&quot;parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:layout_constraintLeft_toLeftOf</span>=<span class="hljs-string">&quot;parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:layout_constraintRight_toRightOf</span>=<span class="hljs-string">&quot;@id/vertical_guideline&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:layout_constraintTop_toTopOf</span>=<span class="hljs-string">&quot;@id/horizontal_guideline&quot;</span> /&gt;</span><br><br></code></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹ï¼š<br><img src="/image/Android/ConstraintLayout/guideline_relative.png" alt="guideline_relative"></p><h5 id="Barrier"><a href="#Barrier" class="headerlink" title="Barrier"></a>Barrier</h5><p>Barrierå¯ä»¥å¼•ç”¨å¤šä¸ªæ§ä»¶ï¼Œæ ¹æ®ä»–ä»¬ä¹‹ä¸­æœ€å¤§çš„å®½é«˜æ¥åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçš„guidelineï¼Œ<br>å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªæŒ‰é’®ï¼Œ<code>@id/button1</code>å’Œ<code>@id/button2</code>,è®©Barrierçš„constraint_referenced_idså±æ€§å¼•ç”¨è¿™ä¸¤ä¸ªidï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">android.support.constraint.Barrier</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/barrier&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:barrierDirection</span>=<span class="hljs-string">&quot;end&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:constraint_referenced_ids</span>=<span class="hljs-string">&quot;button1,button2&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹å¦‚ä¸‹ï¼š<br><img src="/image/Android/ConstraintLayout/barrier1.png" alt="barrier"><br>å›¾ä¸­è“è‰²çš„çº¿å°±æ˜¯<code>Barrier</code>ï¼Œ<code>Barrier</code>æ‰€åœ¨é—®çš„æ–¹ä½ç”±<code>barrierDirection</code>ç¡®å®šï¼Œå¯ä»¥è®¾ç½®ä¸º<code>start</code>,<code>end</code>,<code>top</code>,<code>bottom</code>,<code>right</code>,<code>left</code><br>è¿™æ—¶å€™æˆ‘ä»¬æ”¹å˜ä¸€ä¸ªä¸¤ä¸ªæŒ‰é’®çš„å®½åº¦ï¼Œè®©button2çš„å®½åº¦å°äºbutton1ï¼Œåˆ™æ•ˆæœå¦‚ä¸‹ï¼š<br><img src="/image/Android/ConstraintLayout/barrier2.png" alt="barrier"><br>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æŠŠå…¶ä»–æ§ä»¶çº¦æŸäºbarrierçš„å³ä¾§ï¼Œä½¿å¾—button1å’Œbutton2ä¸ä¼šè¦†ç›–(è¢«è¦†ç›–)å…¶ä»–æ§ä»¶</p><h5 id="Group"><a href="#Group" class="headerlink" title="Group"></a>Group</h5><p>Groupå¯ä»¥åŒ…å«å¤šä¸ªå¯¹å…¶ä»–æ§ä»¶çš„å¼•ç”¨ï¼Œè¿™æ ·æˆ‘ä»¬æ“ä½œè¿™ä¸ªgroupå°±ç›¸å½“äºæ“ä½œå¼•ç”¨çš„æ§ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">android.support.constraint.Group</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:visibility</span>=<span class="hljs-string">&quot;gone&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/button_group&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:constraint_referenced_ids</span>=<span class="hljs-string">&quot;login,register,modify_password&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><p>åƒä¸Šé¢è¿™æ ·ï¼Œåªè¦æ“ä½œGroupçš„<code>visibility</code>å±æ€§ï¼Œå°±ç›¸å½“äºåŒæ—¶æ“ä½œ<code>@id/login</code>,<code>@id/register</code>,<code>@id/modify_password</code>è¿™ä¸‰ä¸ªæ§ä»¶çš„<code>visibility</code>å±æ€§ã€‚</p><h5 id="Placeholders"><a href="#Placeholders" class="headerlink" title="Placeholders"></a>Placeholders</h5><p>é¡¾åæ€ä¹‰å°±æ˜¯ä¸€ä¸ªç”¨æ¥å ä½çš„ä¸œè¥¿ï¼Œå¯¹äºæ ·å¼ç›¸åŒï¼ŒåŠŸèƒ½ä¸åŒçš„ç•Œé¢ï¼Œå¯ä»¥æŠŠæ ·å¼åšæˆstyleæˆ–è€…ä½¿ç”¨PlaceHoldersæ¥åšï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">merge</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:app</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">&quot;http://schemas.android.com/tools&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:layout_editor_absoluteX</span>=<span class="hljs-string">&quot;0dp&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:layout_editor_absoluteY</span>=<span class="hljs-string">&quot;81dp&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:parentTag</span>=<span class="hljs-string">&quot;android.support.constraint.ConstraintLayout&quot;</span>&gt;</span><br> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">android.support.constraint.Placeholder</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/template_main_image&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;0dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;0dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_marginTop</span>=<span class="hljs-string">&quot;16dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:content</span>=<span class="hljs-string">&quot;@+id/top_image&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintDimensionRatio</span>=<span class="hljs-string">&quot;16:9&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintLeft_toLeftOf</span>=<span class="hljs-string">&quot;parent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintRight_toRightOf</span>=<span class="hljs-string">&quot;parent&quot;</span> /&gt;</span><br> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">android.support.constraint.Placeholder</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/template_save&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;48dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;48dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:content</span>=<span class="hljs-string">&quot;@+id/save&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintEnd_toStartOf</span>=<span class="hljs-string">&quot;@+id/template_delete&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintHorizontal_bias</span>=<span class="hljs-string">&quot;0.5&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintStart_toStartOf</span>=<span class="hljs-string">&quot;parent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">tools:layout_editor_absoluteY</span>=<span class="hljs-string">&quot;460dp&quot;</span> /&gt;</span><br> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">android.support.constraint.Placeholder</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/template_delete&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;48dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;48dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:content</span>=<span class="hljs-string">&quot;@+id/delete&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintEnd_toStartOf</span>=<span class="hljs-string">&quot;@+id/template_cancel&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintHorizontal_bias</span>=<span class="hljs-string">&quot;0.5&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintStart_toEndOf</span>=<span class="hljs-string">&quot;@+id/template_save&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">tools:layout_editor_absoluteY</span>=<span class="hljs-string">&quot;460dp&quot;</span> /&gt;</span><br> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">android.support.constraint.Placeholder</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/template_cancel&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;48dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;48dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:content</span>=<span class="hljs-string">&quot;@+id/cancel&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintEnd_toStartOf</span>=<span class="hljs-string">&quot;@+id/template_edit&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintHorizontal_bias</span>=<span class="hljs-string">&quot;0.5&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintStart_toEndOf</span>=<span class="hljs-string">&quot;@+id/template_delete&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">tools:layout_editor_absoluteY</span>=<span class="hljs-string">&quot;460dp&quot;</span> /&gt;</span><br> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">android.support.constraint.Placeholder</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/template_edit&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;48dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;48dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:content</span>=<span class="hljs-string">&quot;@+id/edit&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintEnd_toEndOf</span>=<span class="hljs-string">&quot;parent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintHorizontal_bias</span>=<span class="hljs-string">&quot;0.5&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintStart_toEndOf</span>=<span class="hljs-string">&quot;@+id/template_cancel&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">tools:layout_editor_absoluteY</span>=<span class="hljs-string">&quot;460dp&quot;</span> /&gt;</span><br> <br><span class="hljs-tag">&lt;/<span class="hljs-name">merge</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæƒ³è¦åœ¨é¢„è§ˆç•Œé¢çœ‹èµ·æ¥åƒæ˜¯åœ¨ConstraintLayouté‡Œé¢çš„è¯å°±åŠ ä¸Š<code>tools:parentTag=&quot;android.support.constraint.ConstraintLayout&quot;</code><br>é¢„è§ˆå¦‚ä¸‹ï¼š<br><img src="/image/Android/ConstraintLayout/constraint_layout_placeholder_preview.png" alt="constraintLayout placeholder preview"><br>åœ¨ä¸Šé¢çš„å¸ƒå±€æ–‡ä»¶ä¸­ï¼Œæ¯ä¸€ä¸ªPlaceholderéƒ½æ·»åŠ äº†<code>app:content</code>å±æ€§ï¼Œè¡¨ç¤ºè¦ç”¨è¿™ä¸ªå±æ€§æŒ‡å®šçš„idå¯¹åº”çš„æ§ä»¶æ¥æ›¿æ¢<code>Placeholder</code>ï¼Œ<br>åœ¨å…¶ä»–å¸ƒå±€æ–‡ä»¶ä¸­ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">android.support.constraint.ConstraintLayout</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/root&quot;</span> <span class="hljs-attr">layout</span>=<span class="hljs-string">&quot;@layout/constraint_layout_placeholder&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ImageButton</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/main_title_image&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:src</span>=<span class="hljs-string">&quot;@drawable/main_title_image&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span> /&gt;</span><br><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ImageButton</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/save&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_marginBottom</span>=<span class="hljs-string">&quot;16dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:layout_constraintBottom_toBottomOf</span>=<span class="hljs-string">&quot;parent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:srcCompat</span>=<span class="hljs-string">&quot;@drawable/ic_save_black_24dp&quot;</span> /&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ImageButton</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/edit&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">app:srcCompat</span>=<span class="hljs-string">&quot;@drawable/ic_edit_black_24dp&quot;</span> /&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ImageButton</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/cancel&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_marginBottom</span>=<span class="hljs-string">&quot;16dp&quot;</span></span><br><span class="hljs-tag"></span><br><span class="hljs-tag">        <span class="hljs-attr">app:srcCompat</span>=<span class="hljs-string">&quot;@drawable/ic_cancel_black_24dp&quot;</span> /&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ImageButton</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/delete&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_marginBottom</span>=<span class="hljs-string">&quot;16dp&quot;</span></span><br><span class="hljs-tag"></span><br><span class="hljs-tag">        <span class="hljs-attr">app:srcCompat</span>=<span class="hljs-string">&quot;@drawable/ic_delete_black_24dp&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">android.support.constraint.ConstraintLayout</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é¦–å…ˆä½¿ç”¨<code>include</code>æ ‡ç­¾å°†æ¨¡æ¿åŒ…å«è¿›æ¥ï¼Œç„¶ååˆ›å»ºå…¶ä»–éœ€è¦æ›¿æ¢çš„æ§ä»¶ï¼š<br><img src="/image/Android/ConstraintLayout/merge_constraint_layout_placeholder_preview.png" alt="merge constraintLayout placeholder preview"><br>å½“ç„¶ä¹Ÿå¯ä»¥åœ¨ä»£ç ä¸­è°ƒç”¨<code>Placeholder.setContent(id)</code>åŠ¨æ€æ›¿æ¢ï¼Œé…åˆ<code>CoordinatorLayout</code>å¯ä»¥åšå‡ºæ¯”è¾ƒå¥½ç©çš„åŠ¨ç”»æ•ˆæœï¼š<br><img src="/image/Android/ConstraintLayout/constraintLayout_placeholderand_CoordinatorLayout.gif" alt="constraintLayout placeholder + CoordinatorLayout"><br>ä»£ç åœ¨è¿™é‡Œ<br><a href="https://github.com/Thumar/Placeholder">https://github.com/Thumar/Placeholder</a></p><p><code>ConstraintLayout</code> 1.1ç‰ˆæœ¬ä¹‹åçš„ä¸œè¥¿å¸¸ç”¨çš„å·®ä¸å¤šå°±è¿™äº›äº†</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android hook--ç¤ºä¾‹</title>
    <link href="/2018/08/06/Android-hook-%E7%A4%BA%E4%BE%8B/"/>
    <url>/2018/08/06/Android-hook-%E7%A4%BA%E4%BE%8B/</url>
    
    <content type="html"><![CDATA[<p>Hookè¿‡ç¨‹ï¼š</p><ol><li>å¯»æ‰¾ Hook ç‚¹ï¼ŒåŸåˆ™æ˜¯é™æ€å˜é‡æˆ–è€…å•ä¾‹å¯¹è±¡ï¼Œå°½é‡ Hook public çš„å¯¹è±¡å’Œæ–¹æ³•ã€‚<br>Hookçš„é€‰æ‹©ç‚¹ï¼šé™æ€å˜é‡å’Œå•ä¾‹ï¼Œå› ä¸ºä¸€æ—¦åˆ›å»ºå¯¹è±¡ï¼Œå®ƒä»¬ä¸å®¹æ˜“å˜åŒ–ï¼Œéå¸¸å®¹æ˜“å®šä½ã€‚</li><li>é€‰æ‹©åˆé€‚çš„ä»£ç†æ–¹å¼ï¼Œå¦‚æœæ˜¯æ¥å£å¯ä»¥ç”¨åŠ¨æ€ä»£ç†ã€‚</li><li>å·æ¢æ¢æŸ±â€”â€”ç”¨ä»£ç†å¯¹è±¡æ›¿æ¢åŸå§‹å¯¹è±¡ã€‚<br>æ³¨æ„Android çš„ API ç‰ˆæœ¬æ¯”è¾ƒå¤šï¼Œæ–¹æ³•å’Œç±»å¯èƒ½ä¸ä¸€æ ·ï¼Œæ‰€ä»¥è¦åšå¥½ API çš„å…¼å®¹å·¥ä½œã€‚è¿˜æœ‰ä¸è¦hookå¤ªåº•å±‚çš„ä¸œè¥¿ï¼Œå„ä¸ªå‚å•†çš„romä»£ç ä¸ä¸€æ ·<span id="more"></span></li></ol><h4 id="hookViewçš„ç‚¹å‡»äº‹ä»¶"><a href="#hookViewçš„ç‚¹å‡»äº‹ä»¶" class="headerlink" title="hookViewçš„ç‚¹å‡»äº‹ä»¶"></a>hookViewçš„ç‚¹å‡»äº‹ä»¶</h4><p>å…ˆæ¥ä¸ªç®€å•ç‚¹çš„ï¼ŒViewçš„ç‚¹å‡»äº‹ä»¶ã€‚</p><h5 id="hookOnLongClick"><a href="#hookOnLongClick" class="headerlink" title="hookOnLongClick"></a>hookOnLongClick</h5><p>é¡ºç€Viewçš„<code>setOnClickListener</code>æ–¹æ³•æ‰¾åˆ°äº†<code>getListenerInfo</code>æ–¹æ³•ï¼Œè¿›è€Œæ‰¾åˆ°äº†<code>ListenerInfo</code>ç±»ï¼Œè€Œviewçš„clickï¼ŒlongClickï¼ŒScrollChangeçš„ç›‘å¬äº‹ä»¶éƒ½å­˜æ”¾åœ¨è¿™é‡Œé¢ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hookOnLongCLickListener</span><span class="hljs-params">(View view)</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">//æ‹¿åˆ°mListenerInfo ï¼Œå¯ä»¥é€šè¿‡getListenerInfoæ–¹æ³•</span><br>        Class&lt;?&gt; clazzView = Class.forName(<span class="hljs-string">&quot;android.view.View&quot;</span>);<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">getListenerInfoMethod</span> <span class="hljs-operator">=</span> clazzView.getDeclaredMethod(<span class="hljs-string">&quot;getListenerInfo&quot;</span>);<br>        getListenerInfoMethod.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">listenerInfo</span> <span class="hljs-operator">=</span> getListenerInfoMethod.invoke(view);<br><br>        <span class="hljs-comment">//æ‹¿åˆ° mOnLongClickListenerå­—æ®µï¼Œè¿™é‡Œçš„ListenerInfoæ˜¯Viewçš„å†…éƒ¨ç±»ï¼Œéœ€è¦ç”¨$ç¬¦å·é“¾æ¥ã€‚</span><br>        Class&lt;?&gt; clazz = Class.forName(<span class="hljs-string">&quot;android.view.View$ListenerInfo&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> clazz.getDeclaredField(<span class="hljs-string">&quot;mOnLongClickListener&quot;</span>);<br>        field.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-comment">//æ‹¿åˆ°åŸæ¥çš„mOnLongClickListenerå­—æ®µçš„å€¼</span><br>        View.<span class="hljs-type">OnLongClickListener</span> <span class="hljs-variable">raw</span> <span class="hljs-operator">=</span>(View.OnLongClickListener) field.get(listenerInfo);<br>        <span class="hljs-comment">//æ›¿æ¢æˆæˆ‘ä»¬è‡ªå·±çš„</span><br>        field.set(listenerInfo, <span class="hljs-keyword">new</span> <span class="hljs-title class_">HookOnLongClickListener</span>(raw));<br><br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HookOnLongClickListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">View</span>.OnLongClickListener&#123;<br>    <span class="hljs-keyword">private</span> View.OnLongClickListener raw;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">HookOnLongClickListener</span><span class="hljs-params">(View.OnLongClickListener raw)</span>&#123;<br>        <span class="hljs-built_in">this</span>.raw = raw;<br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onLongClick</span><span class="hljs-params">(View v)</span> &#123;<br>        Log.e(<span class="hljs-string">&quot;HookUtil&quot;</span>,<span class="hljs-string">&quot;HookOnLongClickListener&quot;</span>);<br>        Toast.makeText(MainActivity.<span class="hljs-built_in">this</span>,<span class="hljs-string">&quot;æ›¿æ¢ä¹‹å&quot;</span>,Toast.LENGTH_SHORT).show();<br>        <span class="hljs-keyword">if</span>(raw!=<span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-comment">//è°ƒç”¨åŸæ¥çš„onLongClickï¼Œä¿æŒåŸæœ‰é€»è¾‘ä¸å˜</span><br>            raw.onLongClick(v);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·è°ƒç”¨<code>hookOnLongCLickListerner(view)</code>æ–¹æ³•å³å¯åœ¨åŸæœ‰é€»è¾‘ä¸å˜çš„æƒ…å†µä¸‹æ·»åŠ æˆ‘ä»¬è‡ªå·±çš„é€»è¾‘ã€‚</p><h5 id="hookOnLongClick-1"><a href="#hookOnLongClick-1" class="headerlink" title="hookOnLongClick"></a>hookOnLongClick</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hookOnClickListener</span><span class="hljs-params">(View view)</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">//æ‹¿åˆ°mListenerInfo ï¼Œå¯ä»¥é€šè¿‡getListenerInfoæ–¹æ³•</span><br>        <span class="hljs-type">Method</span> <span class="hljs-variable">getListenerInfoMethod</span> <span class="hljs-operator">=</span> view.getClass().getDeclaredMethod(<span class="hljs-string">&quot;getListenerInfo&quot;</span>);<br>        getListenerInfoMethod.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">listenerInfo</span> <span class="hljs-operator">=</span> getListenerInfoMethod.invoke(view);<br><br>        <span class="hljs-comment">// å¾—åˆ° åŸå§‹çš„ OnClickListener å¯¹è±¡</span><br>        Class&lt;?&gt; listenerInfoClz = Class.forName(<span class="hljs-string">&quot;android.view.View$ListenerInfo&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">mOnClickListener</span> <span class="hljs-operator">=</span> listenerInfoClz.getDeclaredField(<span class="hljs-string">&quot;mOnClickListener&quot;</span>);<br>        mOnClickListener.setAccessible(<span class="hljs-literal">true</span>);<br>        View.<span class="hljs-type">OnClickListener</span> <span class="hljs-variable">originOnClickListener</span> <span class="hljs-operator">=</span> (View.OnClickListener) mOnClickListener.get(listenerInfo);<br><br>        <span class="hljs-comment">// ç”¨è‡ªå®šä¹‰çš„ OnClickListener æ›¿æ¢åŸå§‹çš„ OnClickListener</span><br>        View.<span class="hljs-type">OnClickListener</span> <span class="hljs-variable">hookedOnClickListener</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HookedOnClickListener</span>(originOnClickListener);<br>        mOnClickListener.set(listenerInfo, hookedOnClickListener);<br><br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HookedOnClickListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">View</span>.OnClickListener &#123;<br>    <span class="hljs-keyword">private</span> View.OnClickListener origin;<br><br>    HookedOnClickListener(View.OnClickListener origin) &#123;<br>        <span class="hljs-built_in">this</span>.origin = origin;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> &#123;<br>        Toast.makeText(MainActivity.<span class="hljs-built_in">this</span>, <span class="hljs-string">&quot;hook click&quot;</span>, Toast.LENGTH_SHORT).show();<br>        Log.i(<span class="hljs-string">&quot;hook&quot;</span>, <span class="hljs-string">&quot;Before click, do what you want to to.&quot;</span>);<br>        <span class="hljs-keyword">if</span> (origin != <span class="hljs-literal">null</span>) &#123;<br>            origin.onClick(v);<br>        &#125;<br>        Log.i(<span class="hljs-string">&quot;hook&quot;</span>, <span class="hljs-string">&quot;After click, do what you want to to.&quot;</span>);<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><p>è¿™æ ·è°ƒç”¨<code>hookOnLongClickListerner(view)</code>æ–¹æ³•å³å¯åœ¨åŸæœ‰é€»è¾‘ä¸å˜çš„æƒ…å†µä¸‹æ·»åŠ æˆ‘ä»¬è‡ªå·±çš„é€»è¾‘ã€‚</p><h4 id="hookAlarmManager"><a href="#hookAlarmManager" class="headerlink" title="hookAlarmManager"></a>hookAlarmManager</h4><p>åœ¨è®¾ç½®Alarmçš„è¿‡ç¨‹ä¸­ï¼Œä¼šè°ƒç”¨AlarmManager.setæ–¹æ³•ï¼Œè€ŒAlarmManagerå¯¹è±¡åˆå¾ˆæ–¹ä¾¿å¾—åˆ°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">AlarmManager</span> <span class="hljs-variable">alarm</span> <span class="hljs-operator">=</span> (AlarmManager) getSystemService(ALARM_SERVICE);<br>Class&lt;?&gt; alarmManagerClass = alarm.getClass();<br><span class="hljs-type">Field</span> <span class="hljs-variable">mService</span> <span class="hljs-operator">=</span> alarmManagerClass.getDeclaredField(<span class="hljs-string">&quot;mService&quot;</span>);<br>mService.setAccessible(<span class="hljs-literal">true</span>);<br><span class="hljs-type">Object</span> <span class="hljs-variable">mSerViceInstant</span> <span class="hljs-operator">=</span> mService.get(alarm);<br><br><span class="hljs-type">AlarmManagerInvocationHandler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AlarmManagerInvocationHandler</span>(mSerViceInstant);<br>Class&lt;?&gt; IActivityManagerIntercept = Class.forName(<span class="hljs-string">&quot;android.app.IAlarmManager&quot;</span>);<br><span class="hljs-type">Object</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(),<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>&lt;?&gt;[]&#123;IActivityManagerIntercept&#125;, handler);<br>mService.set(alarm, proxy);<br><br><span class="hljs-comment">//åŠ¨æ€ä»£ç†</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AlarmManagerInvocationHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Object iAlarmManagerObject;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">AlarmManagerInvocationHandler</span><span class="hljs-params">(Object iAlarmManagerObject)</span> &#123;<br>        <span class="hljs-built_in">this</span>.iAlarmManagerObject = iAlarmManagerObject;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br><br><br>        Log.i(<span class="hljs-string">&quot;alarm_manager&quot;</span>, method.getName());<br>        <br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;set&quot;</span>.equals(method.getName())) &#123;<br>            Log.e(<span class="hljs-string">&quot;alarm_manager&quot;</span>, <span class="hljs-string">&quot;è°ƒç”¨äº†mService.set()&quot;</span>);<br><br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">long</span> <span class="hljs-variable">interval</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>                <span class="hljs-type">int</span> <span class="hljs-variable">alarmManagerTimeType</span> <span class="hljs-operator">=</span> Integer.valueOf(args[<span class="hljs-number">1</span>].toString());<br>                <span class="hljs-type">long</span> <span class="hljs-variable">alarmManagerAtTime</span> <span class="hljs-operator">=</span> Long.valueOf(args[<span class="hljs-number">2</span>].toString());<br>                Log.e(<span class="hljs-string">&quot;alarm_manager_interval&quot;</span>, <span class="hljs-string">&quot;alarmManagerTimeType:&quot;</span> +alarmManagerTimeType);<br>                Log.e(<span class="hljs-string">&quot;alarm_manager_interval&quot;</span>, <span class="hljs-string">&quot;alarmManagerAtTime:&quot;</span> +alarmManagerAtTime);<br>                <span class="hljs-keyword">switch</span> (alarmManagerTimeType) &#123;<br>                    <span class="hljs-keyword">case</span> AlarmManager.RTC_WAKEUP:<br>                    <span class="hljs-keyword">case</span> AlarmManager.RTC:<br>                        Log.e(<span class="hljs-string">&quot;alarm_manager_interval&quot;</span>, <span class="hljs-string">&quot;currentTimeMillis--RTC:&quot;</span> +System.currentTimeMillis());<br>                         interval = alarmManagerAtTime - System.currentTimeMillis();<br><br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> AlarmManager.ELAPSED_REALTIME:<br>                    <span class="hljs-keyword">case</span> AlarmManager.ELAPSED_REALTIME_WAKEUP:<br>                        Log.e(<span class="hljs-string">&quot;alarm_manager_interval&quot;</span>, <span class="hljs-string">&quot;currentTimeMillis--ELAPSED_REALTIME:&quot;</span> +SystemClock.elapsedRealtime());<br>                        interval = alarmManagerAtTime - SystemClock.elapsedRealtime();<br>                        <span class="hljs-keyword">break</span>;<br>                &#125;<br>                Log.e(<span class="hljs-string">&quot;alarm_manager_interval&quot;</span>,interval+<span class="hljs-string">&quot;--&gt;&quot;</span> + interval/<span class="hljs-number">1000</span>/<span class="hljs-number">60</span> );<br><br><br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>            &#125;<br><br><br>        &#125;<br>        <span class="hljs-keyword">return</span> method.invoke(iAlarmManagerObject, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="hookAMS"><a href="#hookAMS" class="headerlink" title="hookAMS"></a>hookAMS</h4><p>å¯¹äºActivityçš„å¯åŠ¨è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥hookå®ƒçš„startActivityæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hookASM</span><span class="hljs-params">()</span>&#123;<br>     <span class="hljs-keyword">try</span> &#123;<br>         Class&lt;?&gt; activityManagerNativeClass = Class.forName(<span class="hljs-string">&quot;android.app.ActivityManagerNative&quot;</span>);<br>         <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> activityManagerNativeClass.getDeclaredField(<span class="hljs-string">&quot;gDefault&quot;</span>);<br>         field.setAccessible(<span class="hljs-literal">true</span>);<br>         Object gDefault= field.get(<span class="hljs-literal">null</span>);<br><br>         Class&lt;?&gt; singletonClass = Class.forName(<span class="hljs-string">&quot;android.util.Singleton&quot;</span>);<br>         <span class="hljs-type">Field</span> <span class="hljs-variable">mInstance</span> <span class="hljs-operator">=</span> singletonClass.getDeclaredField(<span class="hljs-string">&quot;mInstance&quot;</span>);<br>         mInstance.setAccessible(<span class="hljs-literal">true</span>);<br>         <span class="hljs-type">Object</span> <span class="hljs-variable">iActivityManagerObject</span> <span class="hljs-operator">=</span> mInstance.get(gDefault);<br><br><br>         <span class="hljs-comment">//å¼€å§‹åŠ¨æ€ä»£ç†ï¼Œç”¨ä»£ç†å¯¹è±¡æ›¿æ¢æ‰çœŸå®çš„ActivityManagerï¼Œ</span><br>         <span class="hljs-type">AmsInvocationHandler</span> <span class="hljs-variable">amsInvocationHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AmsInvocationHandler</span>(iActivityManagerObject);<br>         <span class="hljs-type">Object</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(), iActivityManagerObject.getClass().getInterfaces(), amsInvocationHandler);<br><br>         <span class="hljs-comment">//ç°åœ¨æ›¿æ¢æ‰è¿™ä¸ªå¯¹è±¡</span><br>         mInstance.set(gDefault, proxy);<br><br>     &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>         e.printStackTrace();<br>     &#125;<br>&#125;<br><br> <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AmsInvocationHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> &#123;<br><br>     <span class="hljs-keyword">private</span> Object iActivityManagerObject;<br>     <span class="hljs-keyword">private</span> <span class="hljs-title function_">AmsInvocationHandler</span><span class="hljs-params">(Object iActivityManagerObject)</span> &#123;<br>         <span class="hljs-built_in">this</span>.iActivityManagerObject = iActivityManagerObject;<br>     &#125;<br><br>     <span class="hljs-meta">@Override</span><br>     <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br><br>         Log.i(<span class="hljs-string">&quot;hookASM&quot;</span>, method.getName());<br>         <span class="hljs-comment">//æˆ‘è¦åœ¨è¿™é‡Œæç‚¹äº‹æƒ…</span><br>         <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;startActivity&quot;</span>.contains(method.getName())) &#123;<br>             Log.e(<span class="hljs-string">&quot;hookASM&quot;</span>,<span class="hljs-string">&quot;Activityå·²ç»å¼€å§‹å¯åŠ¨&quot;</span>);<br>         &#125;<br>         <span class="hljs-keyword">return</span> method.invoke(iActivityManagerObject, args);<br>     &#125;<br> &#125;<br><br></code></pre></td></tr></table></figure><h2 id="æ—¢ç„¶æˆ‘ä»¬èƒ½å¤Ÿæ¥ç®¡startActivityæ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¼ªé€ ä¸€ä¸ªIntentå»å¯åŠ¨ä¸€ä¸ªæ²¡æœ‰åœ¨æ¸…å•æ–‡ä»¶ä¸­æ³¨å†Œçš„Activityã€‚"><a href="#æ—¢ç„¶æˆ‘ä»¬èƒ½å¤Ÿæ¥ç®¡startActivityæ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¼ªé€ ä¸€ä¸ªIntentå»å¯åŠ¨ä¸€ä¸ªæ²¡æœ‰åœ¨æ¸…å•æ–‡ä»¶ä¸­æ³¨å†Œçš„Activityã€‚" class="headerlink" title="æ—¢ç„¶æˆ‘ä»¬èƒ½å¤Ÿæ¥ç®¡startActivityæ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¼ªé€ ä¸€ä¸ªIntentå»å¯åŠ¨ä¸€ä¸ªæ²¡æœ‰åœ¨æ¸…å•æ–‡ä»¶ä¸­æ³¨å†Œçš„Activityã€‚"></a>æ—¢ç„¶æˆ‘ä»¬èƒ½å¤Ÿæ¥ç®¡startActivityæ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¼ªé€ ä¸€ä¸ªIntentå»å¯åŠ¨ä¸€ä¸ªæ²¡æœ‰åœ¨æ¸…å•æ–‡ä»¶ä¸­æ³¨å†Œçš„Activityã€‚</h2><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android hook--åå°„åŸºç¡€</title>
    <link href="/2018/08/06/Android-hook--%E5%8F%8D%E5%B0%84%E5%9F%BA%E7%A1%80/"/>
    <url>/2018/08/06/Android-hook--%E5%8F%8D%E5%B0%84%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<p>å‡å¦‚ä½ å·²ç»éå¸¸ç†Ÿæ‚‰javaä¸­åå°„(reflect)å’Œä»£ç†(Proxy)ï¼Œé‚£ä½ è¿˜åœ¨è¿™é‡Œçœ‹æˆ‘è¿™ç¯‡æ–‡ç« çº¯ç²¹å°±æ˜¯æµªè´¹æ—¶é—´äº†ã€‚</p><span id="more"></span><h4 id="åå°„æ˜¯ä»€ä¹ˆ"><a href="#åå°„æ˜¯ä»€ä¹ˆ" class="headerlink" title="åå°„æ˜¯ä»€ä¹ˆ"></a>åå°„æ˜¯ä»€ä¹ˆ</h4><p>å®˜æ–¹ä»‹ç»</p><blockquote><p>Reflection is commonly used by programs which require the ability to examine or modify the runtime behavior of applications running in the Java virtual machine. This is a relatively advanced feature and should be used only by developers who have a strong grasp of the fundamentals of the language. With that caveat in mind, reflection is a powerful technique and can enable applications to perform operations which would otherwise be impossible.</p></blockquote><p>æ¦‚æ‹¬æ¥è®²å°±æ˜¯ï¼š** åå°„è¿™ä¸ªåŠŸèƒ½å¾ˆXX **<br>å¤§å®¶å¸¸è§çš„å¯¹åå°„æœºåˆ¶çš„æ¦‚å¿µ:<br>åœ¨Javaä¸­çš„åå°„æœºåˆ¶æ˜¯æŒ‡åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»éƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»æ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼›å¹¶ä¸”å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•ï¼›è¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½æˆä¸ºJavaè¯­è¨€çš„åå°„æœºåˆ¶ã€‚</p><h4 id="æ¶‰åŠåˆ°çš„ç±»"><a href="#æ¶‰åŠåˆ°çš„ç±»" class="headerlink" title="æ¶‰åŠåˆ°çš„ç±»"></a>æ¶‰åŠåˆ°çš„ç±»</h4><ul><li><code>Class</code>ï¼šåå°„çš„æ ¸å¿ƒç±»ï¼Œå¯ä»¥è·å–ç±»çš„å±æ€§ï¼Œæ–¹æ³•ç­‰ä¿¡æ¯ã€‚ </li><li><code>Field</code>ï¼šJava.lang.reflecåŒ…ä¸­çš„ç±»ï¼Œè¡¨ç¤ºç±»çš„æˆå‘˜å˜é‡ï¼Œå¯ä»¥ç”¨æ¥è·å–å’Œè®¾ç½®ç±»ä¹‹ä¸­çš„å±æ€§å€¼ã€‚ </li><li><code>Method</code>ï¼š Java.lang.reflecåŒ…ä¸­çš„ç±»ï¼Œè¡¨ç¤ºç±»çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥ç”¨æ¥è·å–ç±»ä¸­çš„æ–¹æ³•ä¿¡æ¯æˆ–è€…æ‰§è¡Œæ–¹æ³•ã€‚ </li><li><code>Constructor</code>ï¼š Java.lang.reflecåŒ…ä¸­çš„ç±»ï¼Œè¡¨ç¤ºç±»çš„æ„é€ æ–¹æ³•ã€‚</li></ul><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>å…ˆå†™ä¸€ä¸ªç®€å•çš„Personç±»å½“åšç›®æ ‡ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br><span class="hljs-keyword">public</span> String name;<br><span class="hljs-keyword">private</span> String nickName;<br><span class="hljs-type">int</span> age;<br><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span>&#123;&#125;<br><span class="hljs-keyword">protected</span>  <span class="hljs-title function_">Person</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> &#123;<br><span class="hljs-built_in">this</span>. age = age;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name)</span> &#123;<br><span class="hljs-built_in">this</span>.name = name;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name,String nickName)</span> &#123;<br><span class="hljs-built_in">this</span>.name = name;<br><span class="hljs-built_in">this</span>.nickName = nickName;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, String nickName, <span class="hljs-type">int</span> age)</span> &#123;<br><span class="hljs-built_in">super</span>();<br><span class="hljs-built_in">this</span>.name = name;<br><span class="hljs-built_in">this</span>.nickName = nickName;<br><span class="hljs-built_in">this</span>.age = age;<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Person [name=&quot;</span> + name + <span class="hljs-string">&quot;, nickName=&quot;</span> + nickName + <span class="hljs-string">&quot;, age=&quot;</span> + age + <span class="hljs-string">&quot;]&quot;</span>;<br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="è·å–æƒ³è¦æ“ä½œçš„ç±»çš„Classå¯¹è±¡"><a href="#è·å–æƒ³è¦æ“ä½œçš„ç±»çš„Classå¯¹è±¡" class="headerlink" title="è·å–æƒ³è¦æ“ä½œçš„ç±»çš„Classå¯¹è±¡"></a>è·å–æƒ³è¦æ“ä½œçš„ç±»çš„Classå¯¹è±¡</h5><ol><li>Object.getClass();  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">  <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br><span class="hljs-type">Class</span> <span class="hljs-variable">personClass</span> <span class="hljs-operator">=</span> person.getClass();<br></code></pre></td></tr></table></figure></li><li>ä»»ä½•æ•°æ®ç±»å‹ï¼ˆåŒ…æ‹¬åŸºæœ¬æ•°æ®ç±»å‹ï¼‰éƒ½æœ‰ä¸€ä¸ªâ€œé™æ€â€çš„classå±æ€§  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Class</span> <span class="hljs-variable">personClass2</span> <span class="hljs-operator">=</span> Person.class;<br></code></pre></td></tr></table></figure></li><li>é€šè¿‡Classç±»çš„é™æ€æ–¹æ³•ï¼šforNameï¼ˆString  classNameï¼‰(å¸¸ç”¨)     <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Class</span> <span class="hljs-variable">personClass3</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.huangyuanlove.Person&quot;</span>);<br></code></pre></td></tr></table></figure>  éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿è¡ŒæœŸé—´ï¼Œä¸€ä¸ªåªæœ‰ä¸€ä¸ªClasså¯¹è±¡ï¼š  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">System.out.println(personClass);<br>System.out.println(personClass == personClass2);<br>System.out.println(personClass == personClass3);<br></code></pre></td></tr></table></figure>  è¾“å‡ºï¼š<blockquote><p>class com.huangyuanlove.Person<br> true<br> true</p></blockquote></li></ol><h5 id="è°ƒç”¨Classç±»ä¸­çš„æ–¹æ³•"><a href="#è°ƒç”¨Classç±»ä¸­çš„æ–¹æ³•" class="headerlink" title="è°ƒç”¨Classç±»ä¸­çš„æ–¹æ³•"></a>è°ƒç”¨Classç±»ä¸­çš„æ–¹æ³•</h5><h6 id="è·å–æ„é€ æ–¹æ³•å¹¶åˆ›é€ å¯¹è±¡ï¼š"><a href="#è·å–æ„é€ æ–¹æ³•å¹¶åˆ›é€ å¯¹è±¡ï¼š" class="headerlink" title="è·å–æ„é€ æ–¹æ³•å¹¶åˆ›é€ å¯¹è±¡ï¼š"></a>è·å–æ„é€ æ–¹æ³•å¹¶åˆ›é€ å¯¹è±¡ï¼š</h6>   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br><span class="hljs-type">Class</span> <span class="hljs-variable">personClass</span> <span class="hljs-operator">=</span> person.getClass();<br><br><span class="hljs-comment">// è·å–æ‰€æœ‰çš„å…¬æœ‰æ„é€ æ–¹æ³•</span><br>Constructor[] publicConstructors = personClass.getConstructors();<br>System.out.println(<span class="hljs-string">&quot;è·å–æ‰€æœ‰çš„å…¬æœ‰æ„é€ æ–¹æ³•&quot;</span>);<br><span class="hljs-keyword">for</span> (Constructor c : publicConstructors) &#123;<br>System.out.println(c);<br>&#125;<br><br><span class="hljs-comment">// è·å–æ‰€æœ‰çš„æ„é€ æ–¹æ³•</span><br>Constructor[] allConstructors = personClass.getDeclaredConstructors();<br>System.out.println(<span class="hljs-string">&quot;è·å–æ‰€æœ‰çš„æ„é€ æ–¹æ³•&quot;</span>);<br><span class="hljs-keyword">for</span> (Constructor c : allConstructors) &#123;<br>System.out.println(c);<br>&#125;<br><br><span class="hljs-comment">// è·å–å…¬æœ‰ï¼Œæ— å‚æ„é€ æ–¹æ³•</span><br><span class="hljs-type">Constructor</span> <span class="hljs-variable">publicConstructorWithoutArgs</span> <span class="hljs-operator">=</span> personClass.getConstructor();<br>System.out.println(<span class="hljs-string">&quot;è·å–å…¬æœ‰ï¼Œæ— å‚æ„é€ æ–¹æ³•&quot;</span>);<br>System.out.println(publicConstructorWithoutArgs);<br>System.out.println(publicConstructorWithoutArgs.newInstance());<br><br><span class="hljs-comment">// è·å–ç§æœ‰ï¼Œæœ‰ä¸€ä¸ªStringç±»å‹å‚æ•°çš„æ„é€ æ–¹æ³•</span><br><span class="hljs-type">Constructor</span> <span class="hljs-variable">publicConstructorWithOneStringArgs</span> <span class="hljs-operator">=</span> personClass.getDeclaredConstructor(String.class);<br>System.out.println(<span class="hljs-string">&quot;è·å–ç§æœ‰ï¼Œæœ‰ä¸€ä¸ªStringç±»å‹å‚æ•°çš„æ„é€ æ–¹æ³•&quot;</span>);<br>System.out.println(publicConstructorWithOneStringArgs);<br>personClass.getDeclaredField(<span class="hljs-string">&quot;nickName&quot;</span>).setAccessible(<span class="hljs-literal">true</span>);<br>System.out.println(publicConstructorWithOneStringArgs.newInstance(<span class="hljs-string">&quot;xuan&quot;</span>));<br><br><span class="hljs-comment">// è·å–å…¬æœ‰ï¼Œæœ‰ä¸¤ä¸ªä¸ªStringç±»å‹å‚æ•°çš„æ„é€ æ–¹æ³•</span><br><span class="hljs-type">Constructor</span> <span class="hljs-variable">publicConstructorWithTwoStringArgs</span> <span class="hljs-operator">=</span> personClass.getConstructor(String.class, String.class);<br>System.out.println(<span class="hljs-string">&quot;è·å–å…¬æœ‰ï¼Œæœ‰ä¸¤ä¸ªä¸ªStringç±»å‹å‚æ•°çš„æ„é€ æ–¹æ³•&quot;</span>);<br>System.out.println(publicConstructorWithTwoStringArgs);<br>publicConstructorWithTwoStringArgs.setAccessible(<span class="hljs-literal">true</span>);<br>System.out.println(publicConstructorWithTwoStringArgs.newInstance(<span class="hljs-string">&quot;xuan&quot;</span>, <span class="hljs-string">&quot;huangyuan&quot;</span>));<br></code></pre></td></tr></table></figure><p>  è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è·å–ç§æœ‰ï¼Œæœ‰ä¸€ä¸ªStringç±»å‹å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œå¹¶è°ƒç”¨<code>newInstance</code>æ–¹æ³•çš„æ—¶å€™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè¿™æ˜¯å› ä¸ºè¯¥æ„é€ æ–¹æ³•ä¸­çš„<code>nickName</code>å­—æ®µæ˜¯ç§æœ‰çš„,å°†å…¶æ³¨é‡Šæ‰å¯è·å¾—å¦‚ä¸‹è¾“å‡º<br>  è¾“å‡ºï¼š</p><blockquote><p>è·å–æ‰€æœ‰çš„å…¬æœ‰æ„é€ æ–¹æ³•<br>    public com.huangyuanlove.Person(java.lang.String,java.lang.String,int)<br>    public com.huangyuanlove.Person(java.lang.String,java.lang.String)<br>    public com.huangyuanlove.Person()<br>    è·å–æ‰€æœ‰çš„æ„é€ æ–¹æ³•<br>    public com.huangyuanlove.Person(java.lang.String,java.lang.String,int)<br>    public com.huangyuanlove.Person(java.lang.String,java.lang.String)<br>    private com.huangyuanlove.Person(java.lang.String)<br>    protected com.huangyuanlove.Person(int)<br>    public com.huangyuanlove.Person()<br>    è·å–å…¬æœ‰ï¼Œæ— å‚æ„é€ æ–¹æ³•<br>    public com.huangyuanlove.Person()<br>    Person [name&#x3D;null, nickName&#x3D;null, age&#x3D;0]<br>    è·å–ç§æœ‰ï¼Œæœ‰ä¸€ä¸ªStringç±»å‹å‚æ•°çš„æ„é€ æ–¹æ³•<br>    private com.huangyuanlove.Person(java.lang.String)<br>    è·å–å…¬æœ‰ï¼Œæœ‰ä¸¤ä¸ªä¸ªStringç±»å‹å‚æ•°çš„æ„é€ æ–¹æ³•<br>    public com.huangyuanlove.Person(java.lang.String,java.lang.String)<br>    Person [name&#x3D;xuan, nickName&#x3D;huangyuan, age&#x3D;0]</p></blockquote><h6 id="è·å–æˆå‘˜å˜é‡å¹¶è¿›è¡Œæ“ä½œ"><a href="#è·å–æˆå‘˜å˜é‡å¹¶è¿›è¡Œæ“ä½œ" class="headerlink" title="è·å–æˆå‘˜å˜é‡å¹¶è¿›è¡Œæ“ä½œ"></a>è·å–æˆå‘˜å˜é‡å¹¶è¿›è¡Œæ“ä½œ</h6>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java">  <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br><span class="hljs-type">Class</span> <span class="hljs-variable">personClass</span> <span class="hljs-operator">=</span> person.getClass();<br><br><span class="hljs-comment">// è·å–æ‰€æœ‰çš„å…¬å…±æˆå‘˜å˜é‡</span><br>Field publicFields[] = personClass.getFields();<br>System.out.println(<span class="hljs-string">&quot;è·å–æ‰€æœ‰çš„å…¬å…±æˆå‘˜å˜é‡&quot;</span>);<br><span class="hljs-keyword">for</span> (Field f : publicFields) &#123;<br>System.out.println(f);<br>&#125;<br><span class="hljs-comment">// è·å–æ‰€æœ‰çš„æˆå‘˜å˜é‡</span><br>Field allFields[] = personClass.getDeclaredFields();<br>System.out.println(<span class="hljs-string">&quot;è·å–æ‰€æœ‰çš„æˆå‘˜å˜é‡&quot;</span>);<br><span class="hljs-keyword">for</span> (Field f : allFields) &#123;<br>System.out.println(f);<br>&#125;<br><br><span class="hljs-comment">// è·å–æŸä¸ªå…¬æœ‰æˆå‘˜å˜é‡å¹¶èµ‹å€¼</span><br><span class="hljs-type">Field</span> <span class="hljs-variable">nameField</span> <span class="hljs-operator">=</span> personClass.getField(<span class="hljs-string">&quot;name&quot;</span>);<br>nameField.set(person, <span class="hljs-string">&quot;huangyuan&quot;</span>);<br>System.out.println(person);<br><br><span class="hljs-comment">// è·å–æŸä¸ªç§æœ‰æˆå‘˜å˜é‡å¹¶èµ‹å€¼</span><br><span class="hljs-type">Field</span> <span class="hljs-variable">nickNameField</span> <span class="hljs-operator">=</span> personClass.getDeclaredField(<span class="hljs-string">&quot;nickName&quot;</span>);<br>  <span class="hljs-comment">//å› ä¸ºnickNameæ˜¯ç§æœ‰çš„ï¼Œæ‰€æœ‰éœ€è¦å…ˆè®¾ç½®å¯è®¿é—®</span><br>nickNameField.setAccessible(<span class="hljs-literal">true</span>);<br>nickNameField.set(person, <span class="hljs-string">&quot;xuan&quot;</span>);<br>System.out.println(person);<br></code></pre></td></tr></table></figure><p>  å¯ä»¥å¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p><blockquote><p>è·å–æ‰€æœ‰çš„å…¬å…±æˆå‘˜å˜é‡<br>    public java.lang.String com.huangyuanlove.Person.name<br>    è·å–æ‰€æœ‰çš„æˆå‘˜å˜é‡<br>    public java.lang.String com.huangyuanlove.Person.name<br>    private java.lang.String com.huangyuanlove.Person.nickName<br>    int com.huangyuanlove.Person.age<br>    Person [name&#x3D;huangyuan, nickName&#x3D;null, age&#x3D;0]<br>    Person [name&#x3D;huangyuan, nickName&#x3D;xuan, age&#x3D;0]</p></blockquote><p>  é‡è¦çš„äº‹æƒ…æ¥äº†ï¼Œä¸€å®šè¦è®°ä½ï¼Œè°è¦æ˜¯æƒ³ä¸Šé¢é‚£æ ·åå°„è·å–ç±»çš„å…¬æœ‰æˆå‘˜å˜é‡ç„¶åè¿›è¡Œèµ‹å€¼æ“ä½œï¼Œè‚¯å®šè¢«éª‚çš„ç¥¸å›½æ®ƒæ°‘ã€æ°‘ä¸èŠç”Ÿã€ç”Ÿçµæ¶‚ç‚­ï¼Œéƒ½publicäº†ä½ è¿˜åå°„ã€‚<br>  è·å–ç§æœ‰å˜é‡çš„æ—¶å€™éœ€è¦ä½¿ç”¨<code>getDeclaredField</code>æ–¹æ³•ï¼Œå¦åˆ™ä¼šæŠ›å‡º<code>noSuchFieldException</code></p><h6 id="è·å–æ–¹æ³•å¹¶è¿›è¡Œè°ƒç”¨"><a href="#è·å–æ–¹æ³•å¹¶è¿›è¡Œè°ƒç”¨" class="headerlink" title="è·å–æ–¹æ³•å¹¶è¿›è¡Œè°ƒç”¨"></a>è·å–æ–¹æ³•å¹¶è¿›è¡Œè°ƒç”¨</h6><p>   åœ¨ç±»ä¸­æ·»åŠ ä¸¤ä¸ªæ–¹æ³•<br>   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sayHi</span><span class="hljs-params">()</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;hi&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saySomeThing</span><span class="hljs-params">(String someThing)</span> &#123;<br>    System.out.println(someThing);<br>&#125;<br></code></pre></td></tr></table></figure><br>  åå°„è·å–ç±»æ–¹æ³•å¹¶è¿›è¡Œè°ƒç”¨<br>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java">  <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br><span class="hljs-type">Class</span> <span class="hljs-variable">personClass</span> <span class="hljs-operator">=</span> person.getClass();<br><br><span class="hljs-comment">// è·å–æ‰€æœ‰å…¬å…±æ–¹æ³•</span><br>System.out.println(<span class="hljs-string">&quot;è·å–æ‰€æœ‰å…¬å…±æ–¹æ³•&quot;</span>);<br>Method publicMethods[] = personClass.getMethods();<br><span class="hljs-keyword">for</span> (Method m : publicMethods) &#123;<br>System.out.println(m.getName());<br>&#125;<br><br><span class="hljs-comment">// è·å–æ‰€æœ‰æ–¹æ³•</span><br>System.out.println(<span class="hljs-string">&quot;è·å–æ‰€æœ‰æ–¹æ³•&quot;</span>);<br>Method allMethods[] = personClass.getDeclaredMethods();<br><span class="hljs-keyword">for</span> (Method m : allMethods) &#123;<br>System.out.println(m.getName());<br>&#125;<br><br><span class="hljs-comment">// è·å–æŒ‡å®šçš„å…¬æœ‰æ–¹æ³•</span><br>System.out.println(<span class="hljs-string">&quot;è·å–æŒ‡å®šçš„å…¬æœ‰æ–¹æ³•&quot;</span>);<br><span class="hljs-type">Method</span> <span class="hljs-variable">publicMethodWithoutArgs</span> <span class="hljs-operator">=</span> personClass.getMethod(<span class="hljs-string">&quot;sayHi&quot;</span>);<br>publicMethodWithoutArgs.invoke(person);<br><br><span class="hljs-comment">// è·å–æŒ‡å®šçš„ç§æœ‰æ–¹æ³•</span><br>System.out.println(<span class="hljs-string">&quot;è·å–æŒ‡å®šçš„ç§æœ‰æ–¹æ³•&quot;</span>);<br><span class="hljs-type">Method</span> <span class="hljs-variable">privateMethodWithStringArgs</span> <span class="hljs-operator">=</span> personClass.getDeclaredMethod(<span class="hljs-string">&quot;saySomeThing&quot;</span>, String.class);<br>privateMethodWithStringArgs.setAccessible(<span class="hljs-literal">true</span>);<br>privateMethodWithStringArgs.invoke(person, <span class="hljs-string">&quot;someThing&quot;</span>);<br></code></pre></td></tr></table></figure><br>  å¾—åˆ°è¾“å‡ºï¼š</p><blockquote><p>è·å–æ‰€æœ‰å…¬å…±æ–¹æ³•<br>    toString<br>    sayHi<br>    wait<br>    wait<br>    wait<br>    equals<br>    hashCode<br>    getClass<br>    notify<br>    notifyAll<br>    è·å–æ‰€æœ‰æ–¹æ³•<br>    toString<br>    sayHi<br>    saySomeThing<br>    è·å–æŒ‡å®šçš„å…¬æœ‰æ–¹æ³•<br>    hi<br>    è·å–æŒ‡å®šçš„ç§æœ‰æ–¹æ³•<br>    someThing</p></blockquote><p>  è·å–åˆ°çš„æ–¹æ³•ä¸­å¹¶ä¸åŒ…å«æ„é€ æ–¹æ³•ï¼Œä½†æ˜¯åŒ…å«ä»çˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„å…¬å…±æ–¹æ³•ã€‚å’Œä¸Šé¢çš„è·å–æˆå‘˜å˜é‡èµ‹å€¼ä¸€æ ·ï¼Œè°è¦æ˜¯åå°„å»è·å–å…¬å…±æ–¹æ³•å†å»è°ƒç”¨ï¼ŒåŸºæœ¬ä¸Šå°±å‡‰äº†ã€‚</p><h4 id="é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†"><a href="#é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†" class="headerlink" title="é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†"></a>é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†</h4><h5 id="é™æ€ä»£ç†"><a href="#é™æ€ä»£ç†" class="headerlink" title="é™æ€ä»£ç†"></a>é™æ€ä»£ç†</h5><p>ç®€å•æ¥è¯´ï¼Œä»£ç†å°±æ˜¯ç”¨ä¸€ä¸ªä»£ç†ç±»æ¥å°è£…ä¸€ä¸ªå§”æ‰˜ç±»ï¼Œè¿™æ ·åšæœ‰ä¸¤ä¸ªå¥½å¤„ï¼šå¯ä»¥éšè—å§”æ‰˜ç±»çš„å…·ä½“å®ç°ï¼›å¯ä»¥åœ¨ä¸æ”¹å˜å§”æ‰˜ç±»çš„æƒ…å†µä¸‹å¢åŠ é¢å¤–çš„æ“ä½œã€‚è€Œé™æ€ä»£ç†ï¼Œå°±æ˜¯åœ¨ç¨‹åºè¿è¡Œä¹‹å‰ï¼Œä»£ç†ç±»å°±å·²ç»å­˜åœ¨äº†ã€‚é™æ€ä»£ç†ä¸€èˆ¬çš„å®ç°æ–¹å¼ä¸ºï¼šå§”æ‰˜ç±»å’Œä»£ç†ç±»éƒ½å®ç°åŒä¸€ä¸ªæ¥å£æˆ–è€…æ˜¯ç»§æ‰¿è‡ªåŒä¸€ä¸ªçˆ¶ç±»ï¼Œç„¶ååœ¨ä»£ç†ç±»ä¸­ä¿å­˜ä¸€ä¸ªå§”æ‰˜ç±»çš„å¯¹è±¡å¼•ç”¨ï¼ˆçˆ¶ç±»æˆ–è€…çˆ¶ç±»æ¥å£çš„å¯¹è±¡å¼•ç”¨ï¼‰ï¼Œé€šè¿‡ç»™æ„é€ å™¨ä¼ å…¥å§”æ‰˜ç±»çš„å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–ï¼Œåœ¨åŒåæ–¹æ³•ä¸­é€šè¿‡è°ƒç”¨å§”æ‰˜ç±»çš„æ–¹æ³•å®ç°é™æ€ä»£ç†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨ä»£ç†ç±»åŒåæ–¹æ³•ä¸­è¿˜å¯ä»¥å®ç°ä¸€äº›é¢å¤–çš„åŠŸèƒ½ã€‚ä»£ç å¦‚ä¸‹ï¼š<br>RealObjectç±»ä¸ºå§”æ‰˜ç±»ï¼ŒSimpleProxyç±»ä¸ºä»£ç†ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Interface</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSomething</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">somethingElse</span><span class="hljs-params">(String arg)</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RealObject</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interface</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSomething</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// TODO Auto-generated method stub</span><br>        System.out.println(<span class="hljs-string">&quot;doSomething&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">somethingElse</span><span class="hljs-params">(String arg)</span> &#123;<br>        <span class="hljs-comment">// TODO Auto-generated method stub</span><br>        System.out.println(<span class="hljs-string">&quot;somethingElse &quot;</span> + arg);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interface</span> &#123;<br>    <span class="hljs-comment">// ä¿å­˜å§”æ‰˜ç±»ï¼ˆçˆ¶æ¥å£çš„å¼•ç”¨ï¼‰</span><br>    <span class="hljs-keyword">private</span> Interface proxied;<br><br>    <span class="hljs-comment">// ä¼ å…¥å§”æ‰˜ç±»çš„å¯¹è±¡ç”¨äºåˆå§‹åŒ–</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SimpleProxy</span><span class="hljs-params">(Interface proxied)</span> &#123;<br>        <span class="hljs-built_in">this</span>.proxied = proxied;<br>    &#125;<br><br>    <span class="hljs-comment">// ä¸¤ä¸ªåŒåæ–¹æ³•ä¸­è¿˜å®ç°äº†å…¶ä»–çš„åŠŸèƒ½</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSomething</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// TODO Auto-generated method stub</span><br>        System.out.println(<span class="hljs-string">&quot;SimpleProxy doSomething&quot;</span>);<br>        proxied.doSomething();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">somethingElse</span><span class="hljs-params">(String arg)</span> &#123;<br>        <span class="hljs-comment">// TODO Auto-generated method stub</span><br>        System.out.println(<span class="hljs-string">&quot;SimpleProxy somethingElse &quot;</span> + arg);<br>        proxied.somethingElse(arg);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleProxyDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        consumer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RealObject</span>());<br>        consumer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleProxy</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RealObject</span>()));<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consumer</span><span class="hljs-params">(Interface iface)</span> &#123;<br>        iface.doSomething();<br>        iface.somethingElse(<span class="hljs-string">&quot;bonobo&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h5><p>é™æ€ä»£ç†çš„å±€é™æ€§åœ¨äºï¼Œä»£ç†ç±»éœ€è¦åœ¨ç¨‹åºè¿è¡Œä¹‹å‰å°±ç¼–å†™å¥½ï¼Œè€ŒåŠ¨æ€ä»£ç†åˆ™å¯ä»¥åœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­åŠ¨æ€åˆ›å»ºå¹¶å¤„ç†å¯¹æ‰€ä»£ç†æ–¹æ³•çš„è°ƒç”¨ã€‚åœ¨åŠ¨æ€ä»£ç†ä¸­ï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªä¸­ä»‹ç±»ï¼Œè¿™ä¸ªç±»å®ç°InvocationHandleæ¥å£ï¼ˆä¸»è¦æ˜¯é‡Œé¢çš„invokeæ–¹æ³•ï¼‰ã€‚è¿™ä¸ªä¸­ä»‹ç±»ä½äºå§”æ‰˜ç±»å’Œä»£ç†ç±»ä¹‹é—´ï¼Œä½œä¸ºä¸€ä¸ªè°ƒç”¨å¤„ç†å™¨è€Œå­˜åœ¨ã€‚å®ƒä¿å­˜ä¸€ä¸ªå§”æ‰˜ç±»çš„å¼•ç”¨ï¼Œé€šè¿‡ä¼ å…¥å§”æ‰˜ç±»å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–ï¼›ç„¶ååœ¨invokeæ–¹æ³•ä¸­ï¼Œå®ç°å¯¹å§”æ‰˜ç±»æ–¹æ³•çš„è°ƒç”¨ï¼Œå¹¶å¢åŠ éœ€è¦çš„é¢å¤–æ“ä½œã€‚åœ¨éœ€è¦ä½¿ç”¨åŠ¨æ€ä»£ç†æ—¶ï¼Œé¦–å…ˆé€šè¿‡Proxyç±»ä¸­çš„newProxyInstanceæ–¹æ³•å¾—åˆ°ä»£ç†ç±»å¯¹è±¡ï¼ˆæ–¹æ³•çš„ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ï¼šï¼ˆé€šå¸¸æ˜¯å§”æ‰˜ç±»å®ç°æ¥å£çš„ï¼‰ç±»åŠ è½½å™¨ï¼Œå¸Œæœ›ä»£ç†ç±»å®ç°çš„æ¥å£åˆ—è¡¨ï¼ˆé€šå¸¸ä¹Ÿæ˜¯å§”æ‰˜ç±»å®ç°çš„æ¥å£ï¼‰ï¼Œä»¥åŠä¸€ä¸ªè°ƒç”¨å¤„ç†å™¨çš„å¯¹è±¡ï¼‰ï¼Œç„¶åé€šè¿‡è¿™ä¸ªä»£ç†ç±»å¯¹è±¡ç›´æ¥è°ƒç”¨ä»£ç†ç±»çš„æ–¹æ³•ã€‚è¿™ç§è°ƒç”¨å®é™…ä¸Šä¼šé€šè¿‡è°ƒç”¨å¤„ç†å™¨è°ƒç”¨invokeæ–¹æ³•ï¼Œè¿›è€Œå®ç°å¯¹å§”æ‰˜ç±»ç›¸åº”æ–¹æ³•çš„è°ƒç”¨ã€‚</p><p>æ³¨æ„åœ¨åŠ¨æ€ä»£ç†ä¸­ï¼Œåªå®ç°äº†ä¸€ä¸ªè°ƒç”¨å¤„ç†å™¨ï¼Œè€Œæ²¡æœ‰çœŸæ­£å®ç°ä»£ç†ç±»ã€‚ä»£ç†ç±»å¯¹è±¡æ˜¯é€šè¿‡Proxyç±»ä¸­çš„newProxyInstanceæ–¹æ³•å¾—åˆ°çš„ã€‚è¿™æ ·ï¼Œä¸ç®¡ä½ åœ¨è°ƒç”¨å§”æ‰˜ç±»ä»»ä½•æ–¹æ³•æ—¶éœ€è¦åŠ å…¥çš„é¢å¤–æ“ä½œéƒ½å¯ä»¥ä»…ä»…åœ¨è°ƒç”¨å¤„ç†å™¨ä¸­çš„invokeæ–¹æ³•ä¸­å®ç°å°±å¯ä»¥äº†ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleDynamiProxyDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consumer</span><span class="hljs-params">(Interface iface)</span> &#123;<br>        iface.doSomething();<br>        iface.somethingElse(<span class="hljs-string">&quot;bonobo&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">RealObject</span> <span class="hljs-variable">real</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RealObject</span>();<br>        consumer(real);<br>        <span class="hljs-comment">// é€šè¿‡Proxy.newProxyInstanceæ–¹æ³•å¾—åˆ°ä»£ç†ç±»å¯¹è±¡</span><br>        <span class="hljs-type">Interface</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (Interface) Proxy.newProxyInstance(Interface.class.getClassLoader(),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123; Interface.class &#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">DynamicProxyHandler</span>(real));<br>        <span class="hljs-comment">// é€šè¿‡ä»£ç†ç±»å¯¹è±¡ç›´æ¥è°ƒç”¨æ–¹æ³•ï¼Œä¼šè¢«é‡å®šå‘åˆ°è°ƒç”¨å¤„ç†å™¨ä¸Šçš„invokeæ–¹æ³•</span><br>        consumer(proxy);<br><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// ä¸­ä»‹ç±»ï¼ˆè°ƒç”¨å¤„ç†å™¨ï¼‰</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DynamicProxyHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> &#123;<br>    <span class="hljs-comment">// ä¿å­˜ä¸€ä¸ªå§”æ‰˜ç±»çš„å¯¹è±¡</span><br>    <span class="hljs-keyword">private</span> Object proxied;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DynamicProxyHandler</span><span class="hljs-params">(Object proxied)</span> &#123;<br>        <span class="hljs-built_in">this</span>.proxied = proxied;<br>    &#125;<br><br>    <span class="hljs-comment">// ä¸‰ä¸ªå‚æ•°ï¼šä»£ç†ç±»çš„å¼•ç”¨ï¼Œæ–¹æ³•åå’Œæ–¹æ³•çš„å‚æ•°åˆ—è¡¨</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        <span class="hljs-comment">// TODO Auto-generated method stub</span><br>        System.out.println(<span class="hljs-string">&quot;**** proxy: &quot;</span> + proxy.getClass() + <span class="hljs-string">&quot;, method: &quot;</span> + method + <span class="hljs-string">&quot;, args: &quot;</span> + args);<br>        <span class="hljs-keyword">if</span> (args != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">for</span> (Object arg : args) &#123;<br>                System.out.println(<span class="hljs-string">&quot; &quot;</span> + arg);<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">// å®ç°å¯¹å§”æ‰˜ç±»æ–¹æ³•çš„è°ƒç”¨ï¼Œå‚æ•°è¡¨ç¤ºå§”æ‰˜ç±»å¯¹è±¡å’Œå‚æ•°</span><br>        <span class="hljs-keyword">return</span> method.invoke(proxied, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p>ä»¥ä¸Š<br>ä»¥ä¸Šé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ç›¸å…³çš„æ–‡å­—ä»£ç å‡ºè‡ªäº <a href="https://www.cnblogs.com/hrcnblogs/p/8711418.html">https://www.cnblogs.com/hrcnblogs/p/8711418.html</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Toastæ˜¾ç¤ºè¿‡ç¨‹</title>
    <link href="/2018/08/03/Toast%E6%98%BE%E7%A4%BA%E8%BF%87%E7%A8%8B/"/>
    <url>/2018/08/03/Toast%E6%98%BE%E7%A4%BA%E8%BF%87%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<p>æŠ„ä¹¦æŠ„çš„æœ‰ç‚¹çƒ¦ï¼Œè‡ªå·±ä¹Ÿå­¦ç€åˆ†æä¸€ä¸‹æºç ï¼ŒæŒ‘äº†ä¸ªåœ¨æˆ‘çœ‹æ¥æ¯”è¾ƒç®€å•çš„Toastæ˜¾ç¤ºè¿‡ç¨‹æ¥ç©ä¸€ç©ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Toast.makeText(context, text, duration).show();<br></code></pre></td></tr></table></figure><p>å…ˆäº†è§£ä¸€ä¸‹makeTextè¿‡ç¨‹ï¼Œè¯¥è¿‡ç¨‹æœ€ç»ˆéƒ½ä¼šè°ƒç”¨ä¸‹é¢çš„æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Make a standard toast to display using the specified looper.</span><br><span class="hljs-comment">     * If looper is null, Looper.myLooper() is used.</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@hide</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Toast <span class="hljs-title function_">makeText</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Context context, <span class="hljs-meta">@Nullable</span> Looper looper,</span><br><span class="hljs-params">            <span class="hljs-meta">@NonNull</span> CharSequence text, <span class="hljs-meta">@Duration</span> <span class="hljs-type">int</span> duration)</span> &#123;<br>        <span class="hljs-type">Toast</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Toast</span>(context, looper);<br><br>        <span class="hljs-type">LayoutInflater</span> <span class="hljs-variable">inflate</span> <span class="hljs-operator">=</span> (LayoutInflater)<br>                context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);<br>        <span class="hljs-type">View</span> <span class="hljs-variable">v</span> <span class="hljs-operator">=</span> inflate.inflate(com.android.internal.R.layout.transient_notification, <span class="hljs-literal">null</span>);<br>        <span class="hljs-type">TextView</span> <span class="hljs-variable">tv</span> <span class="hljs-operator">=</span> (TextView)v.findViewById(com.android.internal.R.id.message);<br>        tv.setText(text);<br><br>        result.mNextView = v;<br>        result.mDuration = duration;<br><br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªæ–°çš„Toastå¯¹è±¡ï¼Œåœ¨Toastçš„æ„é€ æ–¹æ³•ä¸­æœ‰ä¸€ä¸ªTNç±»å‹çš„mTNå¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">mTN = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TN</span>(context.getPackageName(), looper);<br></code></pre></td></tr></table></figure><p><code>TN</code>æ˜¯<code>ITransientNotification.Stub</code>çš„å­ç±»ï¼Œæ³¨æ„ä¸€ä¸‹è¿™ä¸ªå¯¹è±¡ï¼Œè¿™å¯¹åé¢çš„è¿‡ç¨‹å¾ˆé‡è¦ã€‚</p><span id="more"></span><p>å¾—åˆ°Toastå¯¹è±¡åæ¥ç€è°ƒç”¨<code>show</code>æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Show the view for the specified duration.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (mNextView == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;setView must have been called&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-type">INotificationManager</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> getService();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">pkg</span> <span class="hljs-operator">=</span> mContext.getOpPackageName();<br>        <span class="hljs-type">TN</span> <span class="hljs-variable">tn</span> <span class="hljs-operator">=</span> mTN;<br>        tn.mNextView = mNextView;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            service.enqueueToast(pkg, tn, mDuration);<br>        &#125; <span class="hljs-keyword">catch</span> (RemoteException e) &#123;<br>            <span class="hljs-comment">// Empty</span><br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>é‡ç‚¹åœ¨<code>service</code>ä¸Šï¼Œå®ƒæ˜¯<code>INotificationManager</code>çš„å®ä¾‹å¯¹è±¡ï¼Œæ˜¯ä¸ªç”¨äºBinderæœºåˆ¶IPCé€šä¿¡çš„æ¥å£ï¼Œå®é™…ä¸ŠgetServiceè¿”å›äº†ä¸€ä¸ªä»¥â€notificationâ€ä¸ºæ ‡è®°çš„è¿œç¨‹æœåŠ¡å¯¹è±¡çš„ä»£ç†ã€‚è¿™ä¸ªè¿œç¨‹æœåŠ¡å¯¹è±¡å°±æ˜¯NotificationManagerServiceï¼Œä»¥ä¸‹ç®€ç§°NMSã€‚NMSä¸­çš„enqueueToastæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">enqueueToast</span><span class="hljs-params">(String pkg, ITransientNotification callback, <span class="hljs-type">int</span> duration)</span><br>&#123;<br>    ......<br>    <span class="hljs-keyword">synchronized</span> (mToastQueue) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">callingPid</span> <span class="hljs-operator">=</span> Binder.getCallingPid();<br>        <span class="hljs-type">long</span> <span class="hljs-variable">callingId</span> <span class="hljs-operator">=</span> Binder.clearCallingIdentity();<br>        <span class="hljs-keyword">try</span> &#123;<br>            ToastRecord record;<br>            <span class="hljs-type">int</span> index;<br>            <span class="hljs-comment">// All packages aside from the android package can enqueue one toast at a time</span><br>            <span class="hljs-keyword">if</span> (!isSystemToast) &#123;<br>                index = indexOfToastPackageLocked(pkg);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                index = indexOfToastLocked(pkg, callback);<br>            &#125;<br><br>            <span class="hljs-comment">// If the package already has a toast, we update its toast</span><br>            <span class="hljs-comment">// in the queue, we don&#x27;t move it to the end of the queue.</span><br>            <span class="hljs-keyword">if</span> (index &gt;= <span class="hljs-number">0</span>) &#123;<br>                record = mToastQueue.get(index);<br>                record.update(duration);<br>                record.update(callback);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-type">Binder</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Binder</span>();<br>                mWindowManagerInternal.addWindowToken(token, TYPE_TOAST, DEFAULT_DISPLAY);<br>                record = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ToastRecord</span>(callingPid, pkg, callback, duration, token);<br>                mToastQueue.add(record);<br>                index = mToastQueue.size() - <span class="hljs-number">1</span>;<br>            &#125;<br>            keepProcessAliveIfNeededLocked(callingPid);<br>            <span class="hljs-comment">// If it&#x27;s at index 0, it&#x27;s the current toast.  It doesn&#x27;t matter if it&#x27;s</span><br>            <span class="hljs-comment">// new or just been updated.  Call back and tell it to show itself.</span><br>            <span class="hljs-comment">// If the callback fails, this will remove it from the list, so don&#x27;t</span><br>            <span class="hljs-comment">// assume that it&#x27;s valid after this.</span><br>            <span class="hljs-keyword">if</span> (index == <span class="hljs-number">0</span>) &#123;<br>                showNextToastLocked();<br>            &#125;<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            Binder.restoreCallingIdentity(callingId);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ–¹æ³•ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°callBackå°±æ˜¯ä¸Šé¢çš„TNå¯¹è±¡ï¼Œå…³é”®åœ¨äºä¸‹é¢çš„indexçš„åˆ¤æ–­ï¼š<br>mToastQueueæ˜¯ä¸ªlistï¼Œå¦‚æœæ˜¯éç³»ç»Ÿtostï¼Œå¹¶ä¸”è¯¥taostå­˜åœ¨äºlistä¸­(æ ¹æ®pkgåˆ¤æ–­)ï¼Œå°±å–å‡ºè¯¥ToastRecordå¹¶ä¸”æ›´æ–°ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æ–°å»ºä¸€ä¸ªToastRecordå­˜å…¥listä¸­ã€‚<br>å¦‚æœToastRecordæ˜¯åœ¨listçš„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œæ¥ç€è°ƒç”¨<code>showNextToastLocaked</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GuardedBy(&quot;mToastQueue&quot;)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">showNextToastLocked</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">ToastRecord</span> <span class="hljs-variable">record</span> <span class="hljs-operator">=</span> mToastQueue.get(<span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">while</span> (record != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">if</span> (DBG) Slog.d(TAG, <span class="hljs-string">&quot;Show pkg=&quot;</span> + record.pkg + <span class="hljs-string">&quot; callback=&quot;</span> + record.callback);<br>        <span class="hljs-keyword">try</span> &#123;<br>            record.callback.show(record.token);<br>            scheduleTimeoutLocked(record);<br>            <span class="hljs-keyword">return</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (RemoteException e) &#123;<br>            Slog.w(TAG, <span class="hljs-string">&quot;Object died trying to show notification &quot;</span> + record.callback<br>                    + <span class="hljs-string">&quot; in package &quot;</span> + record.pkg);<br>            <span class="hljs-comment">// remove it from the list and let the process die</span><br>            <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> mToastQueue.indexOf(record);<br>            <span class="hljs-keyword">if</span> (index &gt;= <span class="hljs-number">0</span>) &#123;<br>                mToastQueue.remove(index);<br>            &#125;<br>            keepProcessAliveIfNeededLocked(record.pid);<br>            <span class="hljs-keyword">if</span> (mToastQueue.size() &gt; <span class="hljs-number">0</span>) &#123;<br>                record = mToastQueue.get(<span class="hljs-number">0</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                record = <span class="hljs-literal">null</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…³é”®çš„ä¸¤è¡Œä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">record.callback.show(record.token);<br>scheduleTimeoutLocked(record);<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€è¡Œè´Ÿè´£æ˜¾ç¤ºï¼Œç¬¬äºŒè¡Œè´Ÿè´£è¶…æ—¶å…³é—­å¹¶æ˜¾ç¤ºé˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªToastã€‚<br>åœ¨ç¬¬ä¸€è¡Œä¸­ï¼ŒcallBackå°±æ˜¯æˆ‘ä»¬ä¸Šé¢æåˆ°çš„TNå¯¹è±¡çš„å®ä¾‹mTNï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* schedule handleShow into the right thread</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">(IBinder windowToken)</span> &#123;<br>    <span class="hljs-keyword">if</span> (localLOGV) Log.v(TAG, <span class="hljs-string">&quot;SHOW: &quot;</span> + <span class="hljs-built_in">this</span>);<br>    mHandler.obtainMessage(SHOW, windowToken).sendToTarget();<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨<code>mHandler</code>ä¸­è°ƒç”¨äº†<code>handleShow</code>æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleShow</span><span class="hljs-params">(IBinder windowToken)</span> &#123;<br>            <span class="hljs-keyword">if</span> (localLOGV) Log.v(TAG, <span class="hljs-string">&quot;HANDLE SHOW: &quot;</span> + <span class="hljs-built_in">this</span> + <span class="hljs-string">&quot; mView=&quot;</span> + mView<br>                    + <span class="hljs-string">&quot; mNextView=&quot;</span> + mNextView);<br>            <span class="hljs-comment">// If a cancel/hide is pending - no need to show - at this point</span><br>            <span class="hljs-comment">// the window token is already invalid and no need to do any work.</span><br>            <span class="hljs-keyword">if</span> (mHandler.hasMessages(CANCEL) || mHandler.hasMessages(HIDE)) &#123;<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (mView != mNextView) &#123;<br>                <span class="hljs-comment">// remove the old view if necessary</span><br>                handleHide();<br>                mView = mNextView;<br>                <span class="hljs-type">Context</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> mView.getContext().getApplicationContext();<br>                <span class="hljs-type">String</span> <span class="hljs-variable">packageName</span> <span class="hljs-operator">=</span> mView.getContext().getOpPackageName();<br>                <span class="hljs-keyword">if</span> (context == <span class="hljs-literal">null</span>) &#123;<br>                    context = mView.getContext();<br>                &#125;<br>                mWM = (WindowManager)context.getSystemService(Context.WINDOW_SERVICE);<br>                <span class="hljs-comment">// We can resolve the Gravity here by using the Locale for getting</span><br>                <span class="hljs-comment">// the layout direction</span><br>                <span class="hljs-keyword">final</span> <span class="hljs-type">Configuration</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> mView.getContext().getResources().getConfiguration();<br>                <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">gravity</span> <span class="hljs-operator">=</span> Gravity.getAbsoluteGravity(mGravity, config.getLayoutDirection());<br>                mParams.gravity = gravity;<br>                <span class="hljs-keyword">if</span> ((gravity &amp; Gravity.HORIZONTAL_GRAVITY_MASK) == Gravity.FILL_HORIZONTAL) &#123;<br>                    mParams.horizontalWeight = <span class="hljs-number">1.0f</span>;<br>                &#125;<br>                <span class="hljs-keyword">if</span> ((gravity &amp; Gravity.VERTICAL_GRAVITY_MASK) == Gravity.FILL_VERTICAL) &#123;<br>                    mParams.verticalWeight = <span class="hljs-number">1.0f</span>;<br>                &#125;<br>                mParams.x = mX;<br>                mParams.y = mY;<br>                mParams.verticalMargin = mVerticalMargin;<br>                mParams.horizontalMargin = mHorizontalMargin;<br>                mParams.packageName = packageName;<br>                mParams.hideTimeoutMilliseconds = mDuration ==<br>                    Toast.LENGTH_LONG ? LONG_DURATION_TIMEOUT : SHORT_DURATION_TIMEOUT;<br>                mParams.token = windowToken;<br>                <span class="hljs-keyword">if</span> (mView.getParent() != <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-keyword">if</span> (localLOGV) Log.v(TAG, <span class="hljs-string">&quot;REMOVE! &quot;</span> + mView + <span class="hljs-string">&quot; in &quot;</span> + <span class="hljs-built_in">this</span>);<br>                    mWM.removeView(mView);<br>                &#125;<br>                <span class="hljs-keyword">if</span> (localLOGV) Log.v(TAG, <span class="hljs-string">&quot;ADD! &quot;</span> + mView + <span class="hljs-string">&quot; in &quot;</span> + <span class="hljs-built_in">this</span>);<br>                <span class="hljs-comment">// Since the notification manager service cancels the token right</span><br>                <span class="hljs-comment">// after it notifies us to cancel the toast there is an inherent</span><br>                <span class="hljs-comment">// race and we may attempt to add a window after the token has been</span><br>                <span class="hljs-comment">// invalidated. Let us hedge against that.</span><br>                <span class="hljs-keyword">try</span> &#123;<br>                    mWM.addView(mView, mParams);<br>                    trySendAccessibilityEvent();<br>                &#125; <span class="hljs-keyword">catch</span> (WindowManager.BadTokenException e) &#123;<br>                    <span class="hljs-comment">/* ignore */</span><br>                &#125;<br>            &#125;<br>        &#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¸€å¨æ˜¯è·å–åˆ°<code>WindowManager</code>ç„¶åé€šè¿‡<code>mWM.addView</code>å°†Toastæ˜¾ç¤ºåˆ°çª—å£ä¸Šã€‚<br>è‡³äº<code>WindowManager</code>å¦‚ä½•æ·»åŠ viewçš„ï¼Œå¯ä»¥çœ‹è¿™ä¸ªï¼š<a href="http://blog.huangyuanlove.com/2017/03/21/Window%E5%92%8CCWindowManager/">http://blog.huangyuanlove.com/2017/03/21/Windowå’ŒCWindowManager/</a><br>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹æ€ä¹ˆå–æ¶ˆToastå¼¹çª—ï¼Œä¸Šé¢æåˆ°äº†è°ƒç”¨äº†<code>scheduleTimeoutLocked</code>æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GuardedBy(&quot;mToastQueue&quot;)</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scheduleTimeoutLocked</span><span class="hljs-params">(ToastRecord r)</span>&#123;<br>    mHandler.removeCallbacksAndMessages(r);<br>    <span class="hljs-type">Message</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> Message.obtain(mHandler, MESSAGE_TIMEOUT, r);<br>    <span class="hljs-type">long</span> <span class="hljs-variable">delay</span> <span class="hljs-operator">=</span> r.duration == Toast.LENGTH_LONG ? LONG_DELAY : SHORT_DELAY;<br>    mHandler.sendMessageDelayed(m, delay);<br>&#125;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨mHandlerå‘é€äº†ä¸€ä¸ªå»¶æ—¶æ¶ˆæ¯å»è°ƒç”¨<code>handleTimeout</code>æ–¹æ³•ï¼Œå»¶è¿Ÿæ—¶é—´å°±æ˜¯æ ¹æ®durationæ¥åˆ¤æ–­çš„ã€‚è¿™é‡Œçš„<code>mHandler</code>æ˜¯<code>WorkerHandler</code>ç»§æ‰¿è‡ª<code>Handler</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleTimeout</span><span class="hljs-params">(ToastRecord record)</span><br>    &#123;<br>        <span class="hljs-keyword">if</span> (DBG) Slog.d(TAG, <span class="hljs-string">&quot;Timeout pkg=&quot;</span> + record.pkg + <span class="hljs-string">&quot; callback=&quot;</span> + record.callback);<br>        <span class="hljs-keyword">synchronized</span> (mToastQueue) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> indexOfToastLocked(record.pkg, record.callback);<br>            <span class="hljs-keyword">if</span> (index &gt;= <span class="hljs-number">0</span>) &#123;<br>                cancelToastLocked(index);<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€è°ƒç”¨äº†<code>cancelToastLocked</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GuardedBy(&quot;mToastQueue&quot;)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancelToastLocked</span><span class="hljs-params">(<span class="hljs-type">int</span> index)</span> &#123;<br>        <span class="hljs-type">ToastRecord</span> <span class="hljs-variable">record</span> <span class="hljs-operator">=</span> mToastQueue.get(index);<br>        <span class="hljs-keyword">try</span> &#123;<br>            record.callback.hide();<br>        &#125; <span class="hljs-keyword">catch</span> (RemoteException e) &#123;<br>            Slog.w(TAG, <span class="hljs-string">&quot;Object died trying to hide notification &quot;</span> + record.callback<br>                    + <span class="hljs-string">&quot; in package &quot;</span> + record.pkg);<br>            <span class="hljs-comment">// don&#x27;t worry about this, we&#x27;re about to remove it from</span><br>            <span class="hljs-comment">// the list anyway</span><br>        &#125;<br><br>        <span class="hljs-type">ToastRecord</span> <span class="hljs-variable">lastToast</span> <span class="hljs-operator">=</span> mToastQueue.remove(index);<br>        mWindowManagerInternal.removeWindowToken(lastToast.token, <span class="hljs-literal">true</span>, DEFAULT_DISPLAY);<br><br>        keepProcessAliveIfNeededLocked(record.pid);<br>        <span class="hljs-keyword">if</span> (mToastQueue.size() &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// Show the next one. If the callback fails, this will remove</span><br>            <span class="hljs-comment">// it from the list, so don&#x27;t assume that the list hasn&#x27;t changed</span><br>            <span class="hljs-comment">// after this point.</span><br>            showNextToastLocked();<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¯¥æ–¹æ³•ä¸­è°ƒç”¨äº†<code>callback.hide()</code>æ–¹æ³•ç§»é™¤toastçš„æ˜¾ç¤ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleHide</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">if</span> (localLOGV) Log.v(TAG, <span class="hljs-string">&quot;HANDLE HIDE: &quot;</span> + <span class="hljs-built_in">this</span> + <span class="hljs-string">&quot; mView=&quot;</span> + mView);<br>    <span class="hljs-keyword">if</span> (mView != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">// note: checking parent() just to make sure the view has</span><br>        <span class="hljs-comment">// been added...  i have seen cases where we get here when</span><br>        <span class="hljs-comment">// the view isn&#x27;t yet added, so let&#x27;s try not to crash.</span><br>        <span class="hljs-keyword">if</span> (mView.getParent() != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">if</span> (localLOGV) Log.v(TAG, <span class="hljs-string">&quot;REMOVE! &quot;</span> + mView + <span class="hljs-string">&quot; in &quot;</span> + <span class="hljs-built_in">this</span>);<br>            mWM.removeViewImmediate(mView);<br>        &#125;<br><br>        mView = <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœè¿™æ—¶å€™mToastQueueä¸­è¿˜æœ‰ToastRecordï¼Œåˆ™è°ƒç”¨<code>showNextToastLocked</code>æ–¹æ³•æ˜¾ç¤ºä¸‹ä¸€ä¸ªã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android ContentProvider</title>
    <link href="/2018/08/02/Android-ContentProvider/"/>
    <url>/2018/08/02/Android-ContentProvider/</url>
    
    <content type="html"><![CDATA[<p>ã€ŠAndroidå¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹9.5ç« </p><p>ç³»ç»Ÿé¢„ç½®äº†è®¸å¤š<code>ContentProvider</code>ï¼Œæ¯”å¦‚é€šè®¯å½•ä¿¡æ¯ã€æ—¥ç¨‹è¡¨ä¿¡æ¯ç­‰ï¼Œè¦è·¨è¿›ç¨‹è®¿é—®è¿™äº›ä¿¡æ¯ï¼Œåªéœ€è¦é€šè¿‡<code>ContentResolver</code>çš„queryã€updateã€insertå’Œdeleteæ–¹æ³•å³å¯ã€‚è™½ç„¶<code>ContentProvider</code>çš„åº•å±‚<br>å®ç°æ˜¯<code>Binder</code>ï¼Œä½†æ˜¯å®ƒçš„ä½¿ç”¨è¿‡ç¨‹è¦æ¯”<code>AIDL</code>ç®€å•è®¸å¤šï¼Œè¿™æ˜¯å› ä¸ºç³»ç»Ÿå·²ç»ä¸ºæˆ‘ä»¬åšäº†å°è£…ï¼Œä½¿å¾—æˆ‘ä»¬æ— é¡»å…³å¿ƒåº•å±‚ç»†èŠ‚å³å¯è½»æ¾å®ç°IPCã€‚ç³»ç»Ÿé¢„ç½®äº†è®¸å¤š<code>ContentProvider</code>ï¼Œæ¯”å¦‚é€šè®¯å½•ä¿¡æ¯ã€æ—¥ç¨‹è¡¨ä¿¡æ¯ç­‰ï¼Œè¦è·¨è¿›ç¨‹è®¿é—®è¿™äº›ä¿¡æ¯ï¼Œåªéœ€è¦é€šè¿‡<code>ContentResolver</code>çš„queryã€updateã€insertå’Œdeleteæ–¹æ³•å³å¯ã€‚</p><span id="more"></span><h4 id="ä½¿ç”¨ContentResolverè¯»å–è”ç³»äºº"><a href="#ä½¿ç”¨ContentResolverè¯»å–è”ç³»äºº" class="headerlink" title="ä½¿ç”¨ContentResolverè¯»å–è”ç³»äºº"></a>ä½¿ç”¨ContentResolverè¯»å–è”ç³»äºº</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> ArrayList&lt;HashMap&lt;String, String&gt;&gt; <span class="hljs-title function_">readContact</span><span class="hljs-params">()</span> &#123;<br><br>    <span class="hljs-type">String</span> <span class="hljs-variable">NUM</span> <span class="hljs-operator">=</span> ContactsContract.CommonDataKinds.Phone.NUMBER;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">NAME</span> <span class="hljs-operator">=</span> ContactsContract.CommonDataKinds.Phone.DISPLAY_NAME;<br>    <span class="hljs-type">Uri</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> ContactsContract.CommonDataKinds.Phone.CONTENT_URI;<br><br>    ArrayList&lt;HashMap&lt;String, String&gt;&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;HashMap&lt;String, String&gt;&gt;();<br>    <span class="hljs-type">ContentResolver</span> <span class="hljs-variable">cr</span> <span class="hljs-operator">=</span> getContentResolver();<br>    <span class="hljs-type">Cursor</span> <span class="hljs-variable">cursor</span> <span class="hljs-operator">=</span> cr.query(uri,<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;NUM,NAME&#125;,<span class="hljs-literal">null</span>,<span class="hljs-literal">null</span>,<span class="hljs-literal">null</span>);<br>    <span class="hljs-keyword">while</span> (cursor.moveToNext())&#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> cursor.getString(cursor.getColumnIndex(NAME));<br>        <span class="hljs-type">String</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> cursor.getString(cursor.getColumnIndex(NUM));<br>        HashMap&lt;String,String&gt; contact = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        contact.put(<span class="hljs-string">&quot;name&quot;</span>,name);<br>        contact.put(<span class="hljs-string">&quot;phone&quot;</span>,phone);<br>        list.add(contact);<br>    &#125;<br>    <span class="hljs-keyword">return</span> list;<br></code></pre></td></tr></table></figure><h4 id="å·¥ä½œè¿‡ç¨‹"><a href="#å·¥ä½œè¿‡ç¨‹" class="headerlink" title="å·¥ä½œè¿‡ç¨‹"></a>å·¥ä½œè¿‡ç¨‹</h4><p><code>ContentProvider</code>æ˜¯ä¸€ç§å†…å®¹å…±äº«å‹ç»„ä»¶ï¼Œå®ƒé€šè¿‡<code>Binder</code>å‘å…¶ä»–ç»„ä»¶ä¹ƒè‡³å…¶ä»–åº”ç”¨æä¾›æ•°æ®ã€‚å½“<code>ContentProvider</code>æ‰€åœ¨çš„è¿›ç¨‹å¯åŠ¨æ—¶ï¼Œ<code>ContentProvider</code>ä¼šåŒæ—¶å¯åŠ¨å¹¶è¢«å‘å¸ƒåˆ°AMSä¸­ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªæ—¶å€™<code>ContentProvider</code>çš„<code>onCreate</code>è¦å…ˆäº<code>Application</code>çš„<code>onCreate</code>è€Œæ‰§è¡Œã€‚<br>å½“ä¸€ä¸ªåº”ç”¨å¯åŠ¨æ—¶ï¼Œå…¥å£æ–¹æ³•ä¸º<code>ActivityThread</code>çš„<code>main</code>æ–¹æ³•ï¼Œ<code>main</code>æ–¹æ³•æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œåœ¨<code>main</code>æ–¹æ³•ä¸­ä¼šåˆ›å»º<code>ActivityThread</code>çš„å®ä¾‹å¹¶åˆ›å»ºä¸»çº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç„¶ååœ¨<code>ActivityThread</code>çš„<code>attach</code>æ–¹æ³•ä¸­ä¼šè¿œç¨‹è°ƒç”¨<code>AMS</code>çš„<code>attachApplication</code>æ–¹æ³•å¹¶å°†<code>ApplicationThread</code>å¯¹è±¡æä¾›ç»™<code>AMS</code>ã€‚<code>ApplicationThread</code>æ˜¯ä¸€ä¸ª<code>Binder</code>å¯¹è±¡ï¼Œå®ƒçš„<code>Binder</code>æ¥å£æ˜¯<code>IApplicationThread</code>ï¼Œå®ƒä¸»è¦ç”¨äº<code>ActivityThread</code>å’Œ<code>AMS</code>ä¹‹é—´çš„é€šä¿¡ï¼Œè¿™ä¸€ç‚¹åœ¨å‰é¢å¤šæ¬¡æåˆ°ã€‚åœ¨<code>AMS</code>çš„<code>attachApplication</code>æ–¹æ³•ä¸­ï¼Œä¼šè°ƒç”¨<code>ApplicationThread</code>çš„<code>bindApplication</code>æ–¹æ³•ï¼Œæ³¨æ„è¿™ä¸ªè¿‡ç¨‹åŒæ ·æ˜¯è·¨è¿›ç¨‹å®Œæˆçš„ï¼Œ<code>bindApplication</code>çš„é€»è¾‘ä¼šç»è¿‡<code>ActivityThread</code>ä¸­çš„<code>mH  Handler</code>åˆ‡æ¢åˆ°<code>ActivityThread</code>ä¸­å»æ‰§è¡Œï¼Œå…·ä½“çš„æ–¹æ³•æ˜¯<code>handleBindApplication</code>ã€‚åœ¨<code>handleBindApplication</code>æ–¹æ³•ä¸­ï¼Œ<code>ActivityThread</code>ä¼šåˆ›å»º<code>Application</code>å¯¹è±¡å¹¶åŠ è½½<code>ContentProvider</code>ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>ActivityThread</code>ä¼šå…ˆåŠ è½½<code>ContentProvider</code>ï¼Œç„¶åå†è°ƒç”¨<code>Application</code>çš„<code>onCreate</code>æ–¹æ³•ã€‚<br>è¿™å°±æ˜¯<code>ContentProvider</code>çš„å¯åŠ¨è¿‡ç¨‹ï¼Œ<code>ContentProvider</code>å¯åŠ¨åï¼Œå¤–ç•Œå°±å¯ä»¥é€šè¿‡å®ƒæ‰€æä¾›çš„å¢åˆ æ”¹æŸ¥è¿™å››ä¸ªæ¥å£æ¥æ“ä½œ<code>ContentProvider</code>ä¸­çš„æ•°æ®æºï¼Œå³insertã€deleteã€updateå’Œqueryå››ä¸ªæ–¹æ³•ã€‚è¿™å››ä¸ªæ–¹æ³•éƒ½æ˜¯é€šè¿‡<code>Binder</code>æ¥è°ƒç”¨çš„ï¼Œå¤–ç•Œæ— æ³•ç›´æ¥è®¿é—®<code>ContentProvider</code>ï¼Œå®ƒåªèƒ½é€šè¿‡AMSæ ¹æ®Uriæ¥è·å–å¯¹åº”çš„<code>ContentProvider</code>çš„<code>Binder</code>æ¥å£<code>IConentProvider</code>ï¼Œç„¶åå†é€šè¿‡<code>IConentProvider</code>æ¥è®¿é—®<code>ContentProvider</code>ä¸­çš„æ•°æ®æºã€‚<br>ä¸€èˆ¬æ¥è¯´ï¼Œ<code>ContentProvide</code>réƒ½åº”è¯¥æ˜¯å•å®ä¾‹çš„ã€‚<code>ContentProvider</code>åˆ°åº•æ˜¯ä¸æ˜¯å•å®ä¾‹ï¼Œè¿™æ˜¯ç”±å®ƒçš„<code>android:multiprocess</code>å±æ€§æ¥å†³å®šçš„ï¼Œå½“<code>android:multiprocess</code>ä¸º<code>false</code>æ—¶ï¼Œ<code>ContentProvider</code>æ˜¯å•å®ä¾‹ï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤å€¼ï¼›å½“<code>android:multiprocess</code>ä¸º<code>true</code>æ—¶ï¼Œ<code>ContentProvider</code>ä¸ºå¤šå®ä¾‹ï¼Œè¿™ä¸ªæ—¶å€™åœ¨æ¯ä¸ªè°ƒç”¨è€…çš„è¿›ç¨‹ä¸­éƒ½å­˜åœ¨ä¸€ä¸ª<code>ContentProvider</code>å¯¹è±¡ã€‚<br>è®¿é—®<code>ContentProvide</code>réœ€è¦é€šè¿‡<code>ContentResolver</code>ï¼Œ<code>ContentResolver</code>æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œé€šè¿‡<code>Context</code>çš„<code>getContentResolver</code>æ–¹æ³•è·å–çš„å®é™…ä¸Šæ˜¯<code>ApplicationContentResolver</code>å¯¹è±¡ï¼Œ<code>ApplicationContentResolver</code>ç±»ç»§æ‰¿äº†<code>ContentResolver</code>å¹¶å®ç°äº†<code>ContentResolver</code>ä¸­çš„æŠ½è±¡æ–¹æ³•ã€‚å½“<code>ContentProvider</code>æ‰€åœ¨çš„è¿›ç¨‹æœªå¯åŠ¨æ—¶ï¼Œç¬¬ä¸€æ¬¡è®¿é—®å®ƒæ—¶å°±ä¼šè§¦å‘<code>ContentProvider</code>çš„åˆ›å»ºï¼Œå½“ç„¶è¿™ä¹Ÿä¼´éšç€<code>ContentProvider</code>æ‰€åœ¨è¿›ç¨‹çš„å¯åŠ¨ã€‚é€šè¿‡<code>ContentProvider</code>çš„å››ä¸ªæ–¹æ³•çš„ä»»ä½•ä¸€ä¸ªéƒ½å¯ä»¥è§¦å‘<code>ContentProvider</code>çš„å¯åŠ¨è¿‡ç¨‹ï¼Œè¿™é‡Œé€‰æ‹©<code>query</code>æ–¹æ³•ã€‚<code>ContentProvider</code>çš„<code>query</code>æ–¹æ³•ä¸­ï¼Œé¦–å…ˆä¼šè·å–<code>IContentProvider</code>å¯¹è±¡ï¼Œä¸ç®¡æ˜¯é€šè¿‡<code>acquireUnstableProvider</code>æ–¹æ³•è¿˜æ˜¯ç›´æ¥é€šè¿‡<code>acquireProvider</code>æ–¹æ³•ï¼Œå®ƒä»¬çš„æœ¬è´¨éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæœ€ç»ˆéƒ½æ˜¯é€šè¿‡<code>acquireProvider</code>æ–¹æ³•æ¥è·å–<code>ContentProvider</code>ã€‚ä¸‹é¢æ˜¯<code>ApplicationContentResolver</code>çš„<code>acquireProvider</code>æ–¹æ³•çš„å…·ä½“å®ç°:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">protected</span> IContentProvider <span class="hljs-title function_">acquireProvider</span><span class="hljs-params">(Context context, String auth)</span> &#123;<br>       <span class="hljs-keyword">return</span> mMainThread.acquireProvider(context,<br>               ContentProvider.getAuthorityWithoutUserId(auth),<br>               resolveUserIdFromAuthority(auth), <span class="hljs-literal">true</span>);<br>   &#125;<br></code></pre></td></tr></table></figure><p><code>ApplicationContentResolver</code>çš„<code>acquireProvider</code>æ–¹æ³•å¹¶æ²¡æœ‰å¤„ç†ä»»ä½•é€»è¾‘ï¼Œå®ƒç›´æ¥è°ƒç”¨äº†<code>ActivityThread</code>çš„<code>acquireProvider</code>æ–¹æ³•ï¼Œ<code>ActivityThread</code>çš„<code>acquireProvider</code>æ–¹æ³•çš„æºç å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> IContentProvider <span class="hljs-title function_">acquireProvider</span><span class="hljs-params">(</span><br><span class="hljs-params">            Context c, String auth, <span class="hljs-type">int</span> userId, <span class="hljs-type">boolean</span> stable)</span> &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">IContentProvider</span> <span class="hljs-variable">provider</span> <span class="hljs-operator">=</span> acquireExistingProvider(c, auth, userId, stable);<br>    <span class="hljs-keyword">if</span> (provider != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> provider;<br>    &#125;<br><br>    <span class="hljs-comment">// There is a possible race here.  Another thread may try to acquire</span><br>    <span class="hljs-comment">// the same provider at the same time.  When this happens, we want to ensure</span><br>    <span class="hljs-comment">// that the first one wins.</span><br>    <span class="hljs-comment">// Note that we cannot hold the lock while acquiring and installing the</span><br>    <span class="hljs-comment">// provider since it might take a long time to run and it could also potentially</span><br>    <span class="hljs-comment">// be re-entrant in the case where the provider is in the same process.</span><br>    <span class="hljs-type">ContentProviderHolder</span> <span class="hljs-variable">holder</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        holder = ActivityManager.getService().getContentProvider(<br>                getApplicationThread(), auth, userId, stable);<br>    &#125; <span class="hljs-keyword">catch</span> (RemoteException ex) &#123;<br>        <span class="hljs-keyword">throw</span> ex.rethrowFromSystemServer();<br>    &#125;<br>    <span class="hljs-keyword">if</span> (holder == <span class="hljs-literal">null</span>) &#123;<br>        Slog.e(TAG, <span class="hljs-string">&quot;Failed to find provider info for &quot;</span> + auth);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// Install provider will increment the reference count for us, and break</span><br>    <span class="hljs-comment">// any ties in the race.</span><br>    holder = installProvider(c, holder, holder.info,<br>            <span class="hljs-literal">true</span> <span class="hljs-comment">/*noisy*/</span>, holder.noReleaseNeeded, stable);<br>    <span class="hljs-keyword">return</span> holder.provider;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç é¦–å…ˆä¼šä»<code>ActivityThread</code>ä¸­æŸ¥æ‰¾æ˜¯å¦å·²ç»å­˜åœ¨ç›®æ ‡<code>ContentProvider</code>äº†ï¼Œå¦‚æœå­˜åœ¨å°±ç›´æ¥è¿”å›ã€‚<code>ActivityThread</code>ä¸­é€šè¿‡<code>mProviderMap</code>æ¥å­˜å‚¨å·²ç»å¯åŠ¨çš„<code>ContentProvider</code>å¯¹è±¡ï¼Œ<code>mProviderMap</code>çš„å£°æ˜å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">inal ArrayMap&lt;providerKey,ProviderClientRecord&gt; mProviderMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayMap</span>&lt;providerKey,ProviderClientRecord&gt;();<br></code></pre></td></tr></table></figure><p>å¦‚æœç›®å‰<code>ContentProvider</code>æ²¡æœ‰å¯åŠ¨ï¼Œé‚£ä¹ˆå°±å‘é€ä¸€ä¸ªè¿›ç¨‹é—´è¯·æ±‚ç»™AMSè®©å…¶å¯åŠ¨ç›®æ ‡<code>ContentProvider</code>ï¼Œæœ€åå†é€šè¿‡<code>installProvider</code>æ–¹æ³•æ¥ä¿®æ”¹å¼•ç”¨è®¡æ•°ã€‚<code>ContentProvider</code>è¢«å¯åŠ¨æ—¶ä¼šä¼´éšç€è¿›ç¨‹çš„å¯åŠ¨ï¼Œåœ¨AMSä¸­ï¼Œé¦–å…ˆä¼šå¯åŠ¨<code>ContentProvider</code>æ‰€åœ¨çš„è¿›ç¨‹ï¼Œç„¶åå†å¯åŠ¨<code>ContentProvider</code>ã€‚å¯åŠ¨è¿›ç¨‹æ˜¯ç”±AMSçš„<code>startProcessLocked</code>æ–¹æ³•æ¥å®Œæˆçš„ï¼Œå…¶å†…éƒ¨ä¸»è¦æ˜¯é€šè¿‡<code>Process</code>çš„<code>start</code>æ–¹æ³•æ¥å®Œæˆä¸€ä¸ªæ–°è¿›ç¨‹çš„å¯åŠ¨ï¼Œæ–°è¿›ç¨‹å¯åŠ¨åå…¶å…¥å£æ–¹æ³•ä¸º<code>ActivityThread</code>çš„mainæ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="hljs-string">&quot;ActivityThreadMain&quot;</span>);<br><br>    <span class="hljs-comment">// CloseGuard defaults to true and can be quite spammy.  We</span><br>    <span class="hljs-comment">// disable it here, but selectively enable it later (via</span><br>    <span class="hljs-comment">// StrictMode) on debug builds, but using DropBox, not logs.</span><br>    CloseGuard.setEnabled(<span class="hljs-literal">false</span>);<br><br>    Environment.initForCurrentUser();<br><br>    <span class="hljs-comment">// Set the reporter for event logging in libcore</span><br>    EventLogger.setReporter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">EventLoggingReporter</span>());<br><br>    <span class="hljs-comment">// Make sure TrustedCertificateStore looks in the right place for CA certificates</span><br>    <span class="hljs-keyword">final</span> <span class="hljs-type">File</span> <span class="hljs-variable">configDir</span> <span class="hljs-operator">=</span> Environment.getUserConfigDirectory(UserHandle.myUserId());<br>    TrustedCertificateStore.setDefaultUserDirectory(configDir);<br><br>    Process.setArgV0(<span class="hljs-string">&quot;&lt;pre-initialized&gt;&quot;</span>);<br><br>    Looper.prepareMainLooper();<br><br>    <span class="hljs-type">ActivityThread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActivityThread</span>();<br>    thread.attach(<span class="hljs-literal">false</span>);<br><br>    <span class="hljs-keyword">if</span> (sMainThreadHandler == <span class="hljs-literal">null</span>) &#123;<br>        sMainThreadHandler = thread.getHandler();<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-literal">false</span>) &#123;<br>        Looper.myLooper().setMessageLogging(<span class="hljs-keyword">new</span><br>                <span class="hljs-title class_">LogPrinter</span>(Log.DEBUG, <span class="hljs-string">&quot;ActivityThread&quot;</span>));<br>    &#125;<br><br>    <span class="hljs-comment">// End of event ActivityThreadMain.</span><br>    Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);<br>    Looper.loop();<br><br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Main thread loop unexpectedly exited&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>ActivityThread</code>çš„<code>main</code>æ–¹æ³•æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œåœ¨å®ƒå†…éƒ¨é¦–å…ˆä¼šåˆ›å»º<code>ActivityThread</code>çš„å®ä¾‹å¹¶è°ƒç”¨<code>attach</code>æ–¹æ³•æ¥è¿›è¡Œä¸€ç³»åˆ—åˆå§‹åŒ–ï¼Œæ¥ç€å°±å¼€å§‹è¿›è¡Œæ¶ˆæ¯å¾ªç¯äº†ã€‚<code>ActivityThread</code>çš„<code>attach</code>æ–¹æ³•ä¼šå°†<code>ApplicationThread</code>å¯¹è±¡é€šè¿‡<code>AMS</code>çš„<code>attachApplication</code>æ–¹æ³•è·¨è¿›ç¨‹ä¼ é€’ç»™AMSï¼Œæœ€ç»ˆAMSä¼šå®Œæˆ<code>ContentProvider</code>çš„åˆ›å»ºè¿‡ç¨‹ï¼ŒAMSçš„<code>attachApplication</code>æ–¹æ³•è°ƒç”¨äº†<code>attachApplicationLocked</code>æ–¹æ³•ï¼Œ<code>attachApplicationLocked</code>ä¸­åˆè°ƒç”¨äº†<code>ApplicationThread</code>çš„<code>bindApplication</code>ï¼Œæ³¨æ„è¿™ä¸ªè¿‡ç¨‹ä¹Ÿæ˜¯è¿›ç¨‹é—´è°ƒç”¨ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">try</span> &#123;<br>    mgr.attachApplication(mAppThread);<br>&#125; <span class="hljs-keyword">catch</span> (RemoteException ex) &#123;<br>    <span class="hljs-keyword">throw</span> ex.rethrowFromSystemServer();<br>&#125;<br><br><span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">attachApplication</span><span class="hljs-params">(IApplicationThread thread)</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">callingPid</span> <span class="hljs-operator">=</span> Binder.getCallingPid();<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">origId</span> <span class="hljs-operator">=</span> Binder.clearCallingIdentity();<br>            attachApplicationLocked(thread, callingPid);<br>            Binder.restoreCallingIdentity(origId);<br>        &#125;<br>    &#125;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">attachApplicationLocked</span><span class="hljs-params">(IApplicationThread thread,<span class="hljs-type">int</span> pid)</span> &#123;<br>    ......<br><span class="hljs-keyword">if</span> (app.instr != <span class="hljs-literal">null</span>) &#123;<br>                thread.bindApplication(processName, appInfo, providers,<br>                        app.instr.mClass,<br>                        profilerInfo, app.instr.mArguments,<br>                        app.instr.mWatcher,<br>                        app.instr.mUiAutomationConnection, testMode,<br>                        mBinderTransactionTrackingEnabled, enableTrackAllocation,<br>                        isRestrictedBackupMode || !normalMode, app.persistent,<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>(getGlobalConfiguration()), app.compat,<br>                        getCommonServicesLocked(app.isolated),<br>                        mCoreSettingsObserver.getCoreSettingsLocked(),<br>                        buildSerial);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                thread.bindApplication(processName, appInfo, providers, <span class="hljs-literal">null</span>, profilerInfo,<br>                        <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, testMode,<br>                        mBinderTransactionTrackingEnabled, enableTrackAllocation,<br>                        isRestrictedBackupMode || !normalMode, app.persistent,<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>(getGlobalConfiguration()), app.compat,<br>                        getCommonServicesLocked(app.isolated),<br>                        mCoreSettingsObserver.getCoreSettingsLocked(),<br>                        buildSerial);<br>            &#125;<br>            ......<br>&#125;<br></code></pre></td></tr></table></figure><p><code>ActivityThread</code>çš„<code>bindApplication</code>ä¼šå‘é€ä¸€ä¸ª<code>BIND_APPLICATION</code>ç±»å‹çš„æ¶ˆæ¯ç»™<code>mH</code>ï¼Œ<code>mH</code>æ˜¯ä¸€ä¸ª<code>Handler</code>ï¼Œå®ƒæ”¶åˆ°æ¶ˆæ¯åä¼šè°ƒç”¨<code>ActivityThread</code>çš„<code>handleBindApplication</code>æ–¹æ³•ï¼Œ<code>bindApplication</code>å‘é€æ¶ˆæ¯çš„è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">AppBindData</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppBindData</span>();<br>            data.processName = processName;<br>            data.appInfo = appInfo;<br>            data.providers = providers;<br>            data.instrumentationName = instrumentationName;<br>            data.instrumentationArgs = instrumentationArgs;<br>            data.instrumentationWatcher = instrumentationWatcher;<br>            data.instrumentationUiAutomationConnection = instrumentationUiConnection;<br>            data.debugMode = debugMode;<br>            data.enableBinderTracking = enableBinderTracking;<br>            data.trackAllocation = trackAllocation;<br>            data.restrictedBackupMode = isRestrictedBackupMode;<br>            data.persistent = persistent;<br>            data.config = config;<br>            data.compatInfo = compatInfo;<br>            data.initProfilerInfo = profilerInfo;<br>            data.buildSerial = buildSerial;<br>            sendMessage(H.BIND_APPLICATION, data);<br></code></pre></td></tr></table></figure><p><code>ActivityThread</code>çš„<code>handleBindApplication</code>åˆ™å®Œæˆäº†<code>Application</code>çš„åˆ›å»ºä»¥åŠ<code>ContentProvider</code>çš„åˆ›å»ºï¼Œå¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å››ä¸ªæ­¥éª¤:</p><p>** åˆ›å»ºContextImplå’ŒInstrumentation **</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">ContextImpl</span> <span class="hljs-variable">appContext</span> <span class="hljs-operator">=</span> ContextImpl.createAppContext(<span class="hljs-built_in">this</span>, data.info);<br>updateLocaleListFromAppContext(appContext, mResourcesManager.getConfiguration().getLocales());<br> <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">cl</span> <span class="hljs-operator">=</span> instrContext.getClassLoader();<br>    mInstrumentation = (Instrumentation)<br>        cl.loadClass(data.instrumentationName.getClassName()).newInstance();<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<br>        <span class="hljs-string">&quot;Unable to instantiate instrumentation &quot;</span><br>        + data.instrumentationName + <span class="hljs-string">&quot;: &quot;</span> + e.toString(), e);<br>&#125;<br><span class="hljs-keyword">final</span> <span class="hljs-type">ComponentName</span> <span class="hljs-variable">component</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComponentName</span>(ii.packageName, ii.name);<br>mInstrumentation.init(<span class="hljs-built_in">this</span>, instrContext, appContext, component, data.instrumentationWatcher, data.instrumentationUiAutomationConnection);<br></code></pre></td></tr></table></figure><p>** åˆ›å»ºApplicationå¯¹è±¡ **</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// If the app is being launched for full backup or restore, bring it up in</span><br><span class="hljs-comment">// a restricted environment with the base application class.</span><br>app = data.info.makeApplication(data.restrictedBackupMode, <span class="hljs-literal">null</span>);<br>mInitialApplication = app;<br></code></pre></td></tr></table></figure><p>** å¯åŠ¨å½“å‰è¿›ç¨‹çš„ContentProviderå¹¶è°ƒç”¨å…¶onCreateæ–¹æ³• **</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// don&#x27;t bring up providers in restricted mode; they may depend on the</span><br><span class="hljs-comment">// app&#x27;s custom Application class</span><br><span class="hljs-keyword">if</span> (!data.restrictedBackupMode) &#123;<br>    <span class="hljs-keyword">if</span> (!ArrayUtils.isEmpty(data.providers)) &#123;<br>        installContentProviders(app, data.providers);<br>        <span class="hljs-comment">// For process that contains content providers, we want to</span><br>        <span class="hljs-comment">// ensure that the JIT is enabled &quot;at some point&quot;.</span><br>        mH.sendEmptyMessageDelayed(H.ENABLE_JIT, <span class="hljs-number">10</span>*<span class="hljs-number">1000</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>installContentProviders</code>å®Œæˆäº†<code>ContentProvider</code>çš„å¯åŠ¨å·¥ä½œï¼Œå®ƒçš„å®ç°å¦‚ä¸‹æ‰€ç¤ºã€‚é¦–å…ˆä¼šéå†å½“å‰è¿›ç¨‹çš„<code>ProviderInfo</code>çš„åˆ—è¡¨å¹¶ä¸€ä¸€è°ƒç”¨è°ƒç”¨<code>installProvider</code>æ–¹æ³•æ¥å¯åŠ¨å®ƒä»¬ï¼Œæ¥ç€å°†å·²ç»å¯åŠ¨çš„<code>ContentProvider</code>å‘å¸ƒåˆ°AMSä¸­ï¼ŒAMSä¼šæŠŠå®ƒä»¬å­˜å‚¨åœ¨<code>ProviderMap</code>ä¸­ï¼Œè¿™æ ·ä¸€æ¥å¤–éƒ¨è°ƒç”¨è€…å°±å¯ä»¥ç›´æ¥ä»AMSä¸­è·å–<code>ContentProvider</code>äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">installContentProviders</span><span class="hljs-params">(</span><br><span class="hljs-params">           Context context, List&lt;ProviderInfo&gt; providers)</span> &#123;<br>       <span class="hljs-keyword">final</span> ArrayList&lt;ContentProviderHolder&gt; results = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>       <span class="hljs-keyword">for</span> (ProviderInfo cpi : providers) &#123;<br>           <span class="hljs-keyword">if</span> (DEBUG_PROVIDER) &#123;<br>               <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">buf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(<span class="hljs-number">128</span>);<br>               buf.append(<span class="hljs-string">&quot;Pub &quot;</span>);<br>               buf.append(cpi.authority);<br>               buf.append(<span class="hljs-string">&quot;: &quot;</span>);<br>               buf.append(cpi.name);<br>               Log.i(TAG, buf.toString());<br>           &#125;<br>           <span class="hljs-type">ContentProviderHolder</span> <span class="hljs-variable">cph</span> <span class="hljs-operator">=</span> installProvider(context, <span class="hljs-literal">null</span>, cpi,<br>                   <span class="hljs-literal">false</span> <span class="hljs-comment">/*noisy*/</span>, <span class="hljs-literal">true</span> <span class="hljs-comment">/*noReleaseNeeded*/</span>, <span class="hljs-literal">true</span> <span class="hljs-comment">/*stable*/</span>);<br>           <span class="hljs-keyword">if</span> (cph != <span class="hljs-literal">null</span>) &#123;<br>               cph.noReleaseNeeded = <span class="hljs-literal">true</span>;<br>               results.add(cph);<br>           &#125;<br>       &#125;<br><br>       <span class="hljs-keyword">try</span> &#123;<br>           ActivityManager.getService().publishContentProviders(<br>               getApplicationThread(), results);<br>       &#125; <span class="hljs-keyword">catch</span> (RemoteException ex) &#123;<br>           <span class="hljs-keyword">throw</span> ex.rethrowFromSystemServer();<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢çœ‹ä¸€ä¸‹<code>ContentProvider</code>å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼Œåœ¨<code>installProvider</code>æ–¹æ³•ä¸­æœ‰ä¸‹é¢ä¸€æ®µä»£ç ï¼Œå…¶é€šè¿‡ç±»åŠ è½½å™¨å®Œæˆäº†<code>ContentProvider</code>å¯¹è±¡çš„åˆ›å»º:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> java.lang.<span class="hljs-type">ClassLoader</span> <span class="hljs-variable">cl</span> <span class="hljs-operator">=</span> c.getClassLoader();<br>localProvider = (ContentProvider)cl.loadClass(info.name).newInstance();<br>provider = localProvider.getIContentProvider();<br><span class="hljs-comment">// XXX Need to create the correct context for this provider.</span><br>localProvider.attachInfo(c, info);<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œé™¤äº†å®Œæˆ<code>ContentProvider</code>å¯¹è±¡çš„åˆ›å»ºï¼Œè¿˜ä¼šé€šè¿‡<code>ContentProvider</code>çš„<code>attachInfo</code>æ–¹æ³•æ¥è°ƒç”¨å®ƒçš„<code>onCreate</code>æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">attachInfo</span><span class="hljs-params">(Context context, ProviderInfo info, <span class="hljs-type">boolean</span> testing)</span> &#123;<br>    mNoPerms = testing;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">        * Only allow it to be set once, so after the content service gives</span><br><span class="hljs-comment">        * this to us clients can&#x27;t change it.</span><br><span class="hljs-comment">        */</span><br>    <span class="hljs-keyword">if</span> (mContext == <span class="hljs-literal">null</span>) &#123;<br>        mContext = context;<br>        <span class="hljs-keyword">if</span> (context != <span class="hljs-literal">null</span>) &#123;<br>            mTransport.mAppOpsManager = (AppOpsManager) context.getSystemService(<br>                    Context.APP_OPS_SERVICE);<br>        &#125;<br>        mMyUid = Process.myUid();<br>        <span class="hljs-keyword">if</span> (info != <span class="hljs-literal">null</span>) &#123;<br>            setReadPermission(info.readPermission);<br>            setWritePermission(info.writePermission);<br>            setPathPermissions(info.pathPermissions);<br>            mExported = info.exported;<br>            mSingleUser = (info.flags &amp; ProviderInfo.FLAG_SINGLE_USER) != <span class="hljs-number">0</span>;<br>            setAuthorities(info.authority);<br>        &#125;<br>        ContentProvider.<span class="hljs-built_in">this</span>.onCreate();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œ<code>ContentProvider</code>å·²ç»è¢«åˆ›å»ºå¹¶ä¸”å…¶<code>onCreate</code>æ–¹æ³•ä¹Ÿå·²ç»è¢«è°ƒç”¨ï¼Œè¿™æ„å‘³ç€<code>ContentProvider</code>å·²ç»å¯åŠ¨å®Œæˆäº†ã€‚</p><p>** è°ƒç”¨Applicationçš„onCreateæ–¹æ³• **</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Do this after providers, since instrumentation tests generally start their</span><br><span class="hljs-comment">// test thread at this point, and we don&#x27;t want that racing.</span><br><span class="hljs-keyword">try</span> &#123;<br>    mInstrumentation.onCreate(data.instrumentationArgs);<br>&#125;<br><span class="hljs-keyword">catch</span> (Exception e) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<br>        <span class="hljs-string">&quot;Exception thrown in onCreate() of &quot;</span><br>        + data.instrumentationName + <span class="hljs-string">&quot;: &quot;</span> + e.toString(), e);<br>&#125;<br><span class="hljs-keyword">try</span> &#123;<br>    mInstrumentation.callApplicationOnCreate(app);<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>    <span class="hljs-keyword">if</span> (!mInstrumentation.onException(app, e)) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<br>            <span class="hljs-string">&quot;Unable to create application &quot;</span> + app.getClass().getName()<br>            + <span class="hljs-string">&quot;: &quot;</span> + e.toString(), e);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»è¿‡ä¸Šé¢çš„å››ä¸ªæ­¥éª¤ï¼Œ<code>ContentProvider</code>å·²ç»æˆåŠŸå¯åŠ¨ï¼Œå¹¶ä¸”å…¶æ‰€åœ¨è¿›ç¨‹çš„<code>Application</code>ä¹Ÿå·²ç»å¯åŠ¨ï¼Œè¿™æ„å‘³ç€<code>ContentProvider</code>æ‰€åœ¨çš„è¿›ç¨‹å·²ç»å®Œæˆäº†æ•´ä¸ªçš„å¯åŠ¨è¿‡ç¨‹ï¼Œç„¶åå…¶ä»–åº”ç”¨å°±å¯ä»¥é€šè¿‡AMSæ¥è®¿é—®è¿™ä¸ª<code>ContentProvider</code>äº†ã€‚æ‹¿åˆ°äº†<code>ContentProvider</code>ä»¥åï¼Œå°±å¯ä»¥é€šè¿‡å®ƒæ‰€æä¾›çš„æ¥å£æ–¹æ³•æ¥è®¿é—®å®ƒäº†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„<code>ContentProvider</code>å¹¶ä¸æ˜¯åŸå§‹çš„<code>ContentProvider</code>ï¼Œè€Œæ˜¯<code>ContentProvider</code>çš„<code>Binder</code>ç±»å‹çš„å¯¹è±¡<code>IContentProvider</code>ï¼Œ<code>IContentProvider</code>çš„å…·ä½“å®ç°æ˜¯<code>ContentProviderNative</code>å’Œ<code>ContentProvider.Transport</code>ï¼Œå…¶ä¸­<code>ContentProvider.Transport</code>ç»§æ‰¿äº†<code>ContentProviderNative</code>ã€‚è¿™é‡Œä»ç„¶é€‰æ‹©<code>query</code>æ–¹æ³•ï¼Œé¦–å…ˆå…¶ä»–åº”ç”¨ä¼šé€šè¿‡AMSè·å–åˆ°<code>ContentProvider</code>çš„<code>Binder</code>å¯¹è±¡å³<code>IContentProvider</code>ï¼Œè€Œ<code>IContentProvider</code>çš„å®ç°è€…å®é™…ä¸Šæ˜¯<code>ContentProvider.Transport</code>ã€‚å› æ­¤å…¶ä»–åº”ç”¨è°ƒç”¨<code>IContentProvider</code>çš„queryæ–¹æ³•æ—¶æœ€ç»ˆä¼šä»¥è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼è°ƒç”¨åˆ°<code>ContentProvider.Transport</code>çš„queryæ–¹æ³•ï¼Œå®ƒçš„å®ç°å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Cursor <span class="hljs-title function_">query</span><span class="hljs-params">(String callingPkg, Uri uri, <span class="hljs-meta">@Nullable</span> String[] projection,</span><br><span class="hljs-params">        <span class="hljs-meta">@Nullable</span> Bundle queryArgs, <span class="hljs-meta">@Nullable</span> ICancellationSignal cancellationSignal)</span> &#123;<br>    validateIncomingUri(uri);<br>    uri = maybeGetUriWithoutUserId(uri);<br>    <span class="hljs-keyword">if</span> (enforceReadPermission(callingPkg, uri, <span class="hljs-literal">null</span>) != AppOpsManager.MODE_ALLOWED) &#123;<br>        <span class="hljs-comment">// The caller has no access to the data, so return an empty cursor with</span><br>        <span class="hljs-comment">// the columns in the requested order. The caller may ask for an invalid</span><br>        <span class="hljs-comment">// column and we would not catch that but this is not a problem in practice.</span><br>        <span class="hljs-comment">// We do not call ContentProvider#query with a modified where clause since</span><br>        <span class="hljs-comment">// the implementation is not guaranteed to be backed by a SQL database, hence</span><br>        <span class="hljs-comment">// it may not handle properly the tautology where clause we would have created.</span><br>        <span class="hljs-keyword">if</span> (projection != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MatrixCursor</span>(projection, <span class="hljs-number">0</span>);<br>        &#125;<br><br>        <span class="hljs-comment">// Null projection means all columns but we have no idea which they are.</span><br>        <span class="hljs-comment">// However, the caller may be expecting to access them my index. Hence,</span><br>        <span class="hljs-comment">// we have to execute the query as if allowed to get a cursor with the</span><br>        <span class="hljs-comment">// columns. We then use the column names to return an empty cursor.</span><br>        <span class="hljs-type">Cursor</span> <span class="hljs-variable">cursor</span> <span class="hljs-operator">=</span> ContentProvider.<span class="hljs-built_in">this</span>.query(<br>                uri, projection, queryArgs,<br>                CancellationSignal.fromTransport(cancellationSignal));<br>        <span class="hljs-keyword">if</span> (cursor == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// Return an empty cursor for all columns.</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MatrixCursor</span>(cursor.getColumnNames(), <span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">original</span> <span class="hljs-operator">=</span> setCallingPackage(callingPkg);<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">return</span> ContentProvider.<span class="hljs-built_in">this</span>.query(<br>                uri, projection, queryArgs,<br>                CancellationSignal.fromTransport(cancellationSignal));<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        setCallingPackage(original);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¾ˆæ˜¾ç„¶ï¼Œ<code>ContentProvider.Transport</code>çš„<code>query</code>æ–¹æ³•è°ƒç”¨äº†<code>ContentProvider</code>çš„<code>query</code>æ–¹æ³•ï¼Œ<code>query</code>æ–¹æ³•çš„æ‰§è¡Œç»“æœå†é€šè¿‡<code>Binder</code>è¿”å›ç»™è°ƒç”¨è€…ï¼Œè¿™æ ·ä¸€æ¥æ•´ä¸ªè°ƒç”¨è¿‡ç¨‹å°±å®Œæˆäº†ã€‚é™¤äº†queryæ–¹æ³•ï¼Œinsertã€deleteå’Œupdateæ–¹æ³•ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AndroidService</title>
    <link href="/2018/08/01/AndroidService/"/>
    <url>/2018/08/01/AndroidService/</url>
    
    <content type="html"><![CDATA[<p>ã€ŠAndroidå¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹9.3ç« <br><code>Service</code>åˆ†ä¸ºä¸¤ç§å·¥ä½œçŠ¶æ€,ä¸€ç§æ˜¯å¯åŠ¨çŠ¶æ€ï¼Œä¸»è¦ç”¨äºæ‰§è¡Œåå°è®¡ç®—;å¦ä¸€ç§æ˜¯ç»‘å®šæ€,ä¸»è¦ç”¨äºå…¶ä»–ç»„ä»¶å’Œ<code>Service</code>çš„äº¤äº’ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>Service</code>çš„è¿™ä¸¤ç§çŠ¶æ€æ˜¯å¯ä»¥å…±å­˜çš„ï¼Œå³<code>Service</code>æ—¢å¯ä»¥å¤„äºå¯åŠ¨çŠ¶æ€ä¹Ÿå¯ä»¥åŒæ—¶å¤„äºç»‘å®šçŠ¶æ€ã€‚<br>é€šè¿‡<code>Context</code>çš„<code>startService</code>æ–¹æ³•å³å¯å¯åŠ¨ä¸€ä¸ª<code>Service</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(content,Service.class);<br>startService(intent);<br></code></pre></td></tr></table></figure><p>é€šè¿‡<code>Context</code>çš„<code>bindService</code>æ–¹æ³•å¯ä»¥ç»‘å®šä¸€ä¸ª<code>Service</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(content,Service.class);<br>bindService(intent,connection,BIND_AUTO_CREATE);<br></code></pre></td></tr></table></figure><span id="more"></span><h4 id="Serviceå¯åŠ¨è¿‡ç¨‹"><a href="#Serviceå¯åŠ¨è¿‡ç¨‹" class="headerlink" title="Serviceå¯åŠ¨è¿‡ç¨‹"></a>Serviceå¯åŠ¨è¿‡ç¨‹</h4><p><code>Service</code>çš„å¯åŠ¨æ—¶ä»<code>ContextWrapper</code>çš„<code>startService</code>å¼€å§‹çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> ComponentName <span class="hljs-title function_">startService</span><span class="hljs-params">(Intent service)</span> &#123;<br>        <span class="hljs-keyword">return</span> mBase.startService(service);<br>    &#125;<br></code></pre></td></tr></table></figure><p><code>mBase</code>æ˜¯<code>Context</code>çš„å®ç°ç±»<code>ContextImpl</code>ï¼Œ<code>åœ¨Activity</code>å¯åŠ¨çš„æ—¶å€™ä¼šé€šè¿‡<code>attach</code>æ–¹æ³•å…³è”ä¸€ä¸ª<code>ContextImpl</code>ï¼Œè¿™ä¸ª<code>ContextImpl</code>å°±æ˜¯ä¸Šé¢çš„<code>mBase</code>ï¼Œä»<code>ContextWrapper</code>çš„å®ç°æ¥çœ‹ï¼Œå¤§éƒ¨åˆ†çš„å®ç°éƒ½æ˜¯é€šè¿‡<code>mBase</code>æ¥å®ç°çš„ï¼Œè¿™æ˜¯ä¸€ç§å…¸å‹çš„æ¡¥æ¥æ¨¡å¼ã€‚åœ¨<code>ContextImpl</code>çš„<code>startService</code>æ–¹æ³•ä¸­åˆè°ƒç”¨äº†<code>startServiceCommon</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> ComponentName <span class="hljs-title function_">startService</span><span class="hljs-params">(Intent service)</span> &#123;<br>        warnIfCallingFromSystemProcess();<br>        <span class="hljs-keyword">return</span> startServiceCommon(service, <span class="hljs-literal">false</span>, mUser);<br>    &#125;<br><span class="hljs-keyword">private</span> ComponentName <span class="hljs-title function_">startServiceCommon</span><span class="hljs-params">(Intent service, <span class="hljs-type">boolean</span> requireForeground,UserHandle user)</span> &#123;<br><br>    validateServiceIntent(service);<br>    service.prepareToLeaveProcess(<span class="hljs-built_in">this</span>);<br>    <span class="hljs-comment">//api 27</span><br>    <span class="hljs-type">ComponentName</span> <span class="hljs-variable">cn</span> <span class="hljs-operator">=</span> ActivityManager.getService().startService(<br>        mMainThread.getApplicationThread(), service, service.resolveTypeIfNeeded(<br>                    getContentResolver()), requireForeground,<br>                    getOpPackageName(), user.getIdentifier());<br>    <span class="hljs-comment">//api 25</span><br>    <span class="hljs-comment">//ComponentName cn = ActivityManagerNative.getDefault().startService(</span><br>     <span class="hljs-comment">//   mMainThread.getApplicationThread(), service, service.resolveTypeIfNeeded(</span><br>      <span class="hljs-comment">//  getContentResolver()), getOpPackageName(), user.getIdentifier());</span><br><br>    <span class="hljs-keyword">return</span> cn;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨<code>startServiceCommon</code>ä¸­é€šè¿‡<code>getService</code>è¿™ä¸ªå¯¹è±¡æ¥å¯åŠ¨ä¸€ä¸ªæœåŠ¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯AMSï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä¸Šè¿°ä»£ç ä¸­é€šè¿‡AMSæ¥å¯åŠ¨æœåŠ¡çš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªè·¨è¿›ç¨‹è°ƒç”¨ã€‚AMSçš„<code>startService</code>å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> ComponentName <span class="hljs-title function_">startService</span><span class="hljs-params">(IApplicationThread caller, Intent service,</span><br><span class="hljs-params">            String resolvedType, String callingPackage, <span class="hljs-type">int</span> userId)</span><br>            <span class="hljs-keyword">throws</span> TransactionTooLargeException &#123;<br>        <span class="hljs-keyword">synchronized</span>(<span class="hljs-built_in">this</span>) &#123;<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">callingPid</span> <span class="hljs-operator">=</span> Binder.getCallingPid();<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">callingUid</span> <span class="hljs-operator">=</span> Binder.getCallingUid();<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">origId</span> <span class="hljs-operator">=</span> Binder.clearCallingIdentity();<br>            <span class="hljs-type">ComponentName</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> mServices.startServiceLocked(caller, service,<br>                    resolvedType, callingPid, callingUid, callingPackage, userId);<br>            Binder.restoreCallingIdentity(origId);<br>            <span class="hljs-keyword">return</span> res;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>AMSä¼šé€šè¿‡<code>mServices</code>æ¥å®Œæˆ<code>service</code>çš„å¯åŠ¨è¿‡ç¨‹ï¼Œ<code>mServices</code>çš„å¯¹è±¡ç±»å‹æ˜¯<code>ActiveServices</code>ï¼Œ<code>ActiveServices</code>æ˜¯ä¸€ä¸ªè¾…åŠ©AMSè¿›è¡Œ<code>Service</code>ç®¡ç†çš„ç±»ï¼ŒåŒ…æ‹¬<code>Service</code>çš„å¯åŠ¨ã€ç»‘å®šå’Œåœæ­¢ã€‚åœ¨<code>startService</code>æ–¹æ³•çš„å°¾éƒ¨ä¼šè°ƒç”¨<code>startServiceInnerLocked</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">ComponentName <span class="hljs-title function_">startServiceInnerLocked</span><span class="hljs-params">(ServiceMap smap, Intent service, ServiceRecord r,</span><br><span class="hljs-params">            <span class="hljs-type">boolean</span> callerFg, <span class="hljs-type">boolean</span> addToStarting)</span> <span class="hljs-keyword">throws</span> TransactionTooLargeException &#123;<br>        <span class="hljs-type">ServiceState</span> <span class="hljs-variable">stracker</span> <span class="hljs-operator">=</span> r.getTracker();<br>        <span class="hljs-keyword">if</span> (stracker != <span class="hljs-literal">null</span>) &#123;<br>            stracker.setStarted(<span class="hljs-literal">true</span>, mAm.mProcessStats.getMemFactorLocked(), r.lastActivity);<br>        &#125;<br>        r.callStart = <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">synchronized</span> (r.stats.getBatteryStats()) &#123;<br>            r.stats.startRunningLocked();<br>        &#125;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">error</span> <span class="hljs-operator">=</span> bringUpServiceLocked(r, service.getFlags(), callerFg, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);<br>        <span class="hljs-keyword">return</span> r.name;<br>    &#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸­<code>ServiceRecord</code>æ˜¯æè¿°ä¸€ä¸ªServiceè®°å½•ï¼Œ<code>ServiceRecord</code>ä¸€ç›´è´¯ç©¿æ•´ä¸ªServiceæµç¨‹ï¼Œ<code>startServiceInnerLocked</code>å¹¶æ²¡æœ‰å®Œæˆå¯åŠ¨Serviceçš„å®Œæ•´æµç¨‹ï¼Œè€Œæ˜¯å°†åç»­çš„è¿‡ç¨‹äº¤ç»™äº†<code>bringUpServiceLocked</code>ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­åˆè°ƒç”¨äº†<code>realStartServiceLocked</code>æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">realStartServiceLocked</span><span class="hljs-params">(ServiceRecord r,</span><br><span class="hljs-params">            ProcessRecord app, <span class="hljs-type">boolean</span> execInFg)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>       <br>        r.app = app;<br>        r.restartTime = r.lastActivity = SystemClock.uptimeMillis();<br><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">newService</span> <span class="hljs-operator">=</span> app.services.add(r);<br>        bumpServiceExecutingLocked(r, execInFg, <span class="hljs-string">&quot;create&quot;</span>);<br>        mAm.updateLruProcessLocked(app, <span class="hljs-literal">false</span>, <span class="hljs-literal">null</span>);<br>        mAm.updateOomAdjLocked();<br><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">created</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <br>            <span class="hljs-keyword">synchronized</span> (r.stats.getBatteryStats()) &#123;<br>                r.stats.startLaunchedLocked();<br>            &#125;<br>            mAm.notifyPackageUse(r.serviceInfo.packageName,<br>                                 PackageManager.NOTIFY_PACKAGE_USE_SERVICE);<br>            app.forceProcessStateUpTo(ActivityManager.PROCESS_STATE_SERVICE);<br>            app.thread.scheduleCreateService(r, r.serviceInfo,<br>                    mAm.compatibilityInfoForPackageLocked(r.serviceInfo.applicationInfo),<br>                    app.repProcState);<br>            r.postNotification();<br>            created = <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (DeadObjectException e) &#123;<br>            Slog.w(TAG, <span class="hljs-string">&quot;Application dead when creating service &quot;</span> + r);<br>            mAm.appDiedLocked(app);<br>            <span class="hljs-keyword">throw</span> e;<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">if</span> (!created) &#123;<br>                <span class="hljs-comment">// Keep the executeNesting count accurate.</span><br>                <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">inDestroying</span> <span class="hljs-operator">=</span> mDestroyingServices.contains(r);<br>                serviceDoneExecutingLocked(r, inDestroying, inDestroying);<br><br>                <span class="hljs-comment">// Cleanup.</span><br>                <span class="hljs-keyword">if</span> (newService) &#123;<br>                    app.services.remove(r);<br>                    r.app = <span class="hljs-literal">null</span>;<br>                &#125;<br><br>                <span class="hljs-comment">// Retry.</span><br>                <span class="hljs-keyword">if</span> (!inDestroying) &#123;<br>                    scheduleServiceRestartLocked(r, <span class="hljs-literal">false</span>);<br>                &#125;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (r.whitelistManager) &#123;<br>            app.whitelistManager = <span class="hljs-literal">true</span>;<br>        &#125;<br><br>        requestServiceBindingsLocked(r, execInFg);<br><br>        updateServiceClientActivitiesLocked(app, <span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>);<br><br>        <span class="hljs-comment">// If the service is in the started state, and there are no</span><br>        <span class="hljs-comment">// pending arguments, then fake up one so its onStartCommand() will</span><br>        <span class="hljs-comment">// be called.</span><br>        <span class="hljs-keyword">if</span> (r.startRequested &amp;&amp; r.callStart &amp;&amp; r.pendingStarts.size() == <span class="hljs-number">0</span>) &#123;<br>            r.pendingStarts.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceRecord</span>.StartItem(r, <span class="hljs-literal">false</span>, r.makeNextStartId(),<br>                    <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>));<br>        &#125;<br><br>        sendServiceArgsLocked(r, execInFg, <span class="hljs-literal">true</span>);<br><br>        <span class="hljs-keyword">if</span> (r.delayed) &#123;<br>            <span class="hljs-keyword">if</span> (DEBUG_DELAYED_STARTS) Slog.v(TAG_SERVICE, <span class="hljs-string">&quot;REM FR DELAY LIST (new proc): &quot;</span> + r);<br>            getServiceMap(r.userId).mDelayedStartList.remove(r);<br>            r.delayed = <span class="hljs-literal">false</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (r.delayedStop) &#123;<br>            <span class="hljs-comment">// Oh and hey we&#x27;ve already been asked to stop!</span><br>            r.delayedStop = <span class="hljs-literal">false</span>;<br>            <span class="hljs-keyword">if</span> (r.startRequested) &#123;<br>                <span class="hljs-keyword">if</span> (DEBUG_DELAYED_STARTS) Slog.v(TAG_SERVICE,<br>                        <span class="hljs-string">&quot;Applying delayed stop (from start): &quot;</span> + r);<br>                stopServiceLocked(r);<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>åœ¨<code>realStartServiceLocked</code>æ–¹æ³•ä¸­ï¼Œé¦–å…ˆé€šè¿‡<code>app.thread</code>çš„<code>scheduleCreateService</code>æ–¹æ³•æ¥åˆ›å»º<code>Service</code>å¯¹è±¡å¹¶è°ƒç”¨å…¶<code>onCreate</code>,æ¥ç€å†é€šè¿‡<code>sendServiceArgsLocked</code>æ–¹æ³•æ¥è°ƒç”¨<code>Service</code>çš„å…¶ä»–æ–¹æ³•ï¼Œæ¯”å¦‚<code>onStartCommand</code>,è¿™ä¸¤ä¸ªè¿‡ç¨‹å‡æ˜¯è¿›ç¨‹é—´é€šä¿¡ã€‚<code>app.thread</code>å¯¹è±¡æ˜¯<code>IApplicationThread</code>ç±»å‹ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ª<code>Binder</code>,å®ƒçš„å…·ä½“å®ç°æ˜¯<code>ApplicationThread</code>å’Œ<code>ApplicationThreadNative</code>ã€‚ç”±äº<code>ApplicationThread</code>ç»§æ‰¿äº†<code>ApplicationThreadNative</code>,å› æ­¤åªéœ€è¦çœ‹<code>ApplicationThread</code>å¯¹<code>Service</code>å¯åŠ¨è¿‡ç¨‹çš„å¤„ç†å³å¯ï¼Œè¿™å¯¹åº”ç€å®ƒçš„<code>scheduleCreateService</code>æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scheduleCreateService</span><span class="hljs-params">(IBinder token,</span><br><span class="hljs-params">               ServiceInfo info, CompatibilityInfo compatInfo, <span class="hljs-type">int</span> processState)</span> &#123;<br>           updateProcessState(processState, <span class="hljs-literal">false</span>);<br>           <span class="hljs-type">CreateServiceData</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CreateServiceData</span>();<br>           s.token = token;<br>           s.info = info;<br>           s.compatInfo = compatInfo;<br><br>           sendMessage(H.CREATE_SERVICE, s);<br>       &#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡å‘é€æ¶ˆæ¯ç»™<code>Handler H</code>æ¥å®Œæˆçš„ã€‚Hä¼šæ¥æ”¶è¿™ä¸ª<code>CREATE_ SERVICE</code>æ¶ˆæ¯å¹¶é€šè¿‡<code>ActivityThread</code>çš„<code>handleCreateService</code>æ–¹æ³•æ¥å®ŒæˆServiceçš„æœ€ç»ˆå¯åŠ¨ï¼Œ<code>handleCreateService</code>çš„æºç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleCreateService</span><span class="hljs-params">(CreateServiceData data)</span> &#123;<br>        <span class="hljs-comment">// If we are getting ready to gc after going to the background, well</span><br>        <span class="hljs-comment">// we are back active so skip it.</span><br>        unscheduleGcIdler();<br>        <span class="hljs-type">LoadedApk</span> <span class="hljs-variable">packageInfo</span> <span class="hljs-operator">=</span> getPackageInfoNoCheck(<br>                data.info.applicationInfo, data.compatInfo);<br>        <span class="hljs-type">Service</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>            java.lang.<span class="hljs-type">ClassLoader</span> <span class="hljs-variable">cl</span> <span class="hljs-operator">=</span> packageInfo.getClassLoader();<br>            service = (Service) cl.loadClass(data.info.name).newInstance();<br><br>            <span class="hljs-type">ContextImpl</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> ContextImpl.createAppContext(<span class="hljs-built_in">this</span>, packageInfo);<br>            context.setOuterContext(service);<br><br>            <span class="hljs-type">Application</span> <span class="hljs-variable">app</span> <span class="hljs-operator">=</span> packageInfo.makeApplication(<span class="hljs-literal">false</span>, mInstrumentation);<br>            service.attach(context, <span class="hljs-built_in">this</span>, data.info.name, data.token, app,<br>                    ActivityManagerNative.getDefault());<br>            service.onCreate();<br>            mServices.put(data.token, service);<br>            ActivityManagerNative.getDefault().serviceDoneExecuting(<br>                        data.token, SERVICE_DONE_EXECUTING_ANON, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>    &#125;<br><br></code></pre></td></tr></table></figure><p><code>handleCreateService</code>ä¸»è¦å®Œæˆäº†ä»¥ä¸‹å‡ ä»¶äº‹ï¼š<br>é¦–å…ˆé€šè¿‡ç±»åŠ è½½å™¨åˆ›å»ºäº†Serviceå®ä¾‹ï¼Œæ¥ç€åˆ›å»º<code>ContextImpl</code>å¯¹è±¡å’Œ<code>Application</code>å¯¹è±¡  å¹¶é€šè¿‡service.attachæ–¹æ³•å»ºç«‹è”ç³»ï¼Œæœ€åè°ƒç”¨<code>service.onCreate</code>æ–¹æ³•ï¼Œå¹¶å°†<code>service</code>å­˜å‚¨åœ¨<code>ActivityThread</code>ä¸­çš„ä¸€ä¸ªåˆ—è¡¨<code>mServices</code>ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> ArrayMap&lt;IBinder, Service&gt; mServices = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayMap</span>&lt;&gt;();<br></code></pre></td></tr></table></figure><p>ç”±äº<code>service</code>çš„<code>onCreate</code>æ–¹æ³•æ‰§è¡Œäº†ï¼Œä¹Ÿå°±æ„å‘³ç€<code>Service</code>å·²ç»å¯åŠ¨äº†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œ<code>ActivityThead</code>ä¸­è¿˜ä¼šé€šè¿‡<code>handleServiceArgs</code>æ–¹æ³•è°ƒç”¨<code>Service</code>çš„<code>onStartCommand</code>æ–¹æ³•ã€‚</p><h4 id="Serviceç»‘å®šè¿‡ç¨‹"><a href="#Serviceç»‘å®šè¿‡ç¨‹" class="headerlink" title="Serviceç»‘å®šè¿‡ç¨‹"></a>Serviceç»‘å®šè¿‡ç¨‹</h4><p>å’Œå¯åŠ¨è¿‡ç¨‹ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä»<code>ContextWrapper</code>å¼€å§‹çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">bindService</span><span class="hljs-params">(Intent service, ServiceConnection conn,</span><br><span class="hljs-params">        <span class="hljs-type">int</span> flags)</span> &#123;<br>    <span class="hljs-keyword">return</span> mBase.bindService(service, conn, flags);<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åæ˜¯<code>ContextImpl</code>çš„<code>bindService</code>æ–¹æ³•è°ƒç”¨<code>bindServiceCommon</code>æ–¹æ³•ï¼Œç„¶åè¿œç¨‹è°ƒç”¨AMSçš„<code>bindService</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">bindServiceCommon</span><span class="hljs-params">(Intent service, ServiceConnection conn, <span class="hljs-type">int</span> flags, Handler handler, UserHandle user)</span> &#123;<br>    <span class="hljs-comment">// Keep this in sync with DevicePolicyManager.bindDeviceAdminServiceAsUser.</span><br>    IServiceConnection sd;<br>    <span class="hljs-keyword">if</span> (conn == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;connection is null&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (mPackageInfo != <span class="hljs-literal">null</span>) &#123;<br>        sd = mPackageInfo.getServiceDispatcher(conn, getOuterContext(), handler, flags);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Not supported in system context&quot;</span>);<br>    &#125;<br>    validateServiceIntent(service);<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">IBinder</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> getActivityToken();<br>        <span class="hljs-keyword">if</span> (token == <span class="hljs-literal">null</span> &amp;&amp; (flags&amp;BIND_AUTO_CREATE) == <span class="hljs-number">0</span> &amp;&amp; mPackageInfo != <span class="hljs-literal">null</span><br>                &amp;&amp; mPackageInfo.getApplicationInfo().targetSdkVersion<br>                &lt; android.os.Build.VERSION_CODES.ICE_CREAM_SANDWICH) &#123;<br>            flags |= BIND_WAIVE_PRIORITY;<br>        &#125;<br>        service.prepareToLeaveProcess(<span class="hljs-built_in">this</span>);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> ActivityManager.getService().bindService(<br>            mMainThread.getApplicationThread(), getActivityToken(), service,<br>            service.resolveTypeIfNeeded(getContentResolver()),<br>            sd, flags, getOpPackageName(), user.getIdentifier());<br>        <span class="hljs-keyword">if</span> (res &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityException</span>(<br>                    <span class="hljs-string">&quot;Not allowed to bind to service &quot;</span> + service);<br>        &#125;<br>        <span class="hljs-keyword">return</span> res != <span class="hljs-number">0</span>;<br>    &#125; <span class="hljs-keyword">catch</span> (RemoteException e) &#123;<br>        <span class="hljs-keyword">throw</span> e.rethrowFromSystemServer();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œé¦–å…ˆå°†å®¢æˆ·ç«¯çš„<code>ServiceConnection</code>è½¬åŒ–ä¸º<code>ServiceDispatcher.InnerConnection</code>å¯¹è±¡ï¼Œå› ä¸ºæœåŠ¡ç»‘å®šæ˜¯è·¨è¿›ç¨‹çš„ï¼Œæ‰€ä»¥<code>ServiceConnection</code>å¯¹è±¡å¿…é¡»å€ŸåŠ©<code>Binder</code>å¯¹è±¡æ‰èƒ½è®©è¿œç¨‹æœåŠ¡ç«¯è°ƒç”¨è‡ªå·±çš„æ–¹æ³•ã€‚<code>ServiceDispatcher</code>èµ·ç€è¿æ¥<code>ServiceConnection</code>å’Œ<code>InnerConnection</code>çš„ä½œç”¨ã€‚è¿™ä¸ªè¿‡ç¨‹ç”±<code>LoadedApk.getServiceDispatcher</code>æ–¹æ³•å®Œæˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> IServiceConnection <span class="hljs-title function_">getServiceDispatcher</span><span class="hljs-params">(ServiceConnection c,</span><br><span class="hljs-params">            Context context, Handler handler, <span class="hljs-type">int</span> flags)</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (mServices) &#123;<br>            LoadedApk.<span class="hljs-type">ServiceDispatcher</span> <span class="hljs-variable">sd</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>            ArrayMap&lt;ServiceConnection, LoadedApk.ServiceDispatcher&gt; map = mServices.get(context);<br>            <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">if</span> (DEBUG) Slog.d(TAG, <span class="hljs-string">&quot;Returning existing dispatcher &quot;</span> + sd + <span class="hljs-string">&quot; for conn &quot;</span> + c);<br>                sd = map.get(c);<br>            &#125;<br>            <span class="hljs-keyword">if</span> (sd == <span class="hljs-literal">null</span>) &#123;<br>                sd = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceDispatcher</span>(c, context, handler, flags);<br>                <span class="hljs-keyword">if</span> (DEBUG) Slog.d(TAG, <span class="hljs-string">&quot;Creating new dispatcher &quot;</span> + sd + <span class="hljs-string">&quot; for conn &quot;</span> + c);<br>                <span class="hljs-keyword">if</span> (map == <span class="hljs-literal">null</span>) &#123;<br>                    map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayMap</span>&lt;&gt;();<br>                    mServices.put(context, map);<br>                &#125;<br>                map.put(c, sd);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                sd.validate(context, handler);<br>            &#125;<br>            <span class="hljs-keyword">return</span> sd.getIServiceConnection();<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ<code>mServices</code>æ˜¯ä¸€ä¸ª<code>ArrayMap</code>ï¼Œå®ƒå­˜å‚¨äº†ä¸€ä¸ªåº”ç”¨å½“å‰æ´»åŠ¨çš„<code>ServiceConnection</code>å’Œ<code>ServiceDispatcher</code>çš„æ˜ å°„å…³ç³»ï¼Œå…¶å£°æ˜å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArrayMap&lt;Context, ArrayMap&lt;ServiceConnection, LoadedApk.ServiceDispatcher&gt;&gt; mServices<br>        = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayMap</span>&lt;&gt;();<br></code></pre></td></tr></table></figure><p>ç³»ç»Ÿé¦–å…ˆä¼šæŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ç›¸åŒçš„<code>ServiceConnection</code>,å¦‚æœä¸å­˜åœ¨å°±é‡æ–°åˆ›å»ºä¸€ä¸ª<code>ServiceDispatcher</code>å¯¹è±¡ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨<code>mServices</code>ä¸­ï¼Œå…¶ä¸­æ˜ å°„å…³ç³»çš„keyæ˜¯<code>ServiceConnection</code>,valueæ˜¯<code>ServiceDispatcher</code>,åœ¨<code>ServiceDispatcher</code>çš„å†…éƒ¨åˆä¿å­˜äº†<code>ServiceConnection</code>å’Œ<code>InnerConnection</code>å¯¹è±¡ã€‚å½“<code>Service</code>å’Œå®¢æˆ·ç«¯å»ºç«‹è¿æ¥åï¼Œç³»ç»Ÿä¼šé€šè¿‡<code>InnerConnection</code>æ¥è°ƒç”¨<code>ServiceConnection</code>ä¸­çš„<code>onServiceConnected</code>æ–¹æ³•ï¼Œè¿™ä¸ªè¿‡ç¨‹æœ‰å¯èƒ½æ˜¯è·¨è¿›ç¨‹çš„ã€‚å½“<code>ServiceDispatcher</code>åˆ›å»ºå¥½äº†ä»¥åï¼Œ<code>getServiceDispatcher</code>ä¼š è¿”å›å…¶ä¿å­˜çš„<code>InnerConnection</code>å¯¹è±¡ã€‚<br>æ¥ç€è°ƒç”¨AMSçš„<code>bindService</code>  æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åˆè°ƒç”¨äº†<code>bindServiceLocked</code>â€“&gt;<code>bringUpServiceLocked</code>â€“&gt;<code>realStartServiceLocked</code>ï¼Œè¿™ä¸ªè¿‡ç¨‹å’Œä¸Šé¢çš„<code>StartService</code>è¿‡ç¨‹é€»è¾‘ç±»ä¼¼ï¼Œæœ€ç»ˆéƒ½æ˜¯é€šè¿‡<code>ApplicationThread</code>æ¥å®Œæˆ<code>Service</code>çš„å®ä¾‹åˆ›å»ºå¹¶è°ƒç”¨<code>onCreate</code>æ–¹æ³•ã€‚å’Œå¯åŠ¨<code>Service</code>è¿‡ç¨‹ä¸åŒçš„æ˜¯ï¼Œç»‘å®šè¿‡ç¨‹ä¼šè°ƒç”¨<code>app.thread</code>çš„<code>scheduleBindService</code>æ–¹æ³•ï¼Œè¿™ä¸ªè¿‡ç¨‹çš„å®ç°åœ¨<code>ActivityService</code>çš„<code>requestServiceBindingsLocked</code>æ–¹æ³•ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">requestServiceBindingsLocked</span><span class="hljs-params">(ServiceRecord r, <span class="hljs-type">boolean</span> execInFg)</span><br>           <span class="hljs-keyword">throws</span> TransactionTooLargeException &#123;<br>       <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=r.bindings.size()-<span class="hljs-number">1</span>; i&gt;=<span class="hljs-number">0</span>; i--) &#123;<br>           <span class="hljs-type">IntentBindRecord</span> <span class="hljs-variable">ibr</span> <span class="hljs-operator">=</span> r.bindings.valueAt(i);<br>           <span class="hljs-keyword">if</span> (!requestServiceBindingLocked(r, ibr, execInFg, <span class="hljs-literal">false</span>)) &#123;<br>               <span class="hljs-keyword">break</span>;<br>           &#125;<br>       &#125;<br>   &#125;<br><br></code></pre></td></tr></table></figure><p>è¯¥æ–¹æ³•ç”¨åˆ°äº†<code>r.bindings</code>ã€‚å®ƒæ˜¯ä¸€ä¸ª<code>ArrayMap</code>ï¼Œä¿å­˜äº†å®¢æˆ·ç«¯çš„<code>bind</code>æ¶ˆæ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> ArrayMap&lt;Intent.FilterComparison, IntentBindRecord&gt; bindings = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayMap</span>&lt;Intent.FilterComparison, IntentBindRecord&gt;();<br></code></pre></td></tr></table></figure><p>å…·ä½“ä¿å­˜æ–¹æ³•åœ¨AMSä¸€å¼€å§‹çš„æ–¹æ³•<code>bindServiceLocked</code>ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">AppBindRecord</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> s.retrieveAppBindingLocked(service, callerApp);<br></code></pre></td></tr></table></figure><p>åœ¨<code>requestServiceBindingsLocked</code>æ–¹æ³•ä¸­è°ƒç”¨äº†äº†<code>requestServiceBindingLocked</code>æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">requestServiceBindingLocked</span><span class="hljs-params">(ServiceRecord r, IntentBindRecord i,</span><br><span class="hljs-params">            <span class="hljs-type">boolean</span> execInFg, <span class="hljs-type">boolean</span> rebind)</span> <span class="hljs-keyword">throws</span> TransactionTooLargeException &#123;<br>        <span class="hljs-keyword">if</span> (r.app == <span class="hljs-literal">null</span> || r.app.thread == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// If service is not currently running, can&#x27;t yet bind.</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (DEBUG_SERVICE) Slog.d(TAG_SERVICE, <span class="hljs-string">&quot;requestBind &quot;</span> + i + <span class="hljs-string">&quot;: requested=&quot;</span> + i.requested<br>                + <span class="hljs-string">&quot; rebind=&quot;</span> + rebind);<br>        <span class="hljs-keyword">if</span> ((!i.requested || rebind) &amp;&amp; i.apps.size() &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                bumpServiceExecutingLocked(r, execInFg, <span class="hljs-string">&quot;bind&quot;</span>);<br>                r.app.forceProcessStateUpTo(ActivityManager.PROCESS_STATE_SERVICE);<br>                r.app.thread.scheduleBindService(r, i.intent.getIntent(), rebind,<br>                        r.app.repProcState);<br>                <span class="hljs-keyword">if</span> (!rebind) &#123;<br>                    i.requested = <span class="hljs-literal">true</span>;<br>                &#125;<br>                i.hasBound = <span class="hljs-literal">true</span>;<br>                i.doRebind = <span class="hljs-literal">false</span>;<br>            &#125; <span class="hljs-keyword">catch</span> (TransactionTooLargeException e) &#123;<br>                <span class="hljs-comment">// Keep the executeNesting count accurate.</span><br>                <span class="hljs-keyword">if</span> (DEBUG_SERVICE) Slog.v(TAG_SERVICE, <span class="hljs-string">&quot;Crashed while binding &quot;</span> + r, e);<br>                <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">inDestroying</span> <span class="hljs-operator">=</span> mDestroyingServices.contains(r);<br>                serviceDoneExecutingLocked(r, inDestroying, inDestroying);<br>                <span class="hljs-keyword">throw</span> e;<br>            &#125; <span class="hljs-keyword">catch</span> (RemoteException e) &#123;<br>                <span class="hljs-keyword">if</span> (DEBUG_SERVICE) Slog.v(TAG_SERVICE, <span class="hljs-string">&quot;Crashed while binding &quot;</span> + r);<br>                <span class="hljs-comment">// Keep the executeNesting count accurate.</span><br>                <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">inDestroying</span> <span class="hljs-operator">=</span> mDestroyingServices.contains(r);<br>                serviceDoneExecutingLocked(r, inDestroying, inDestroying);<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>app.thread</code>è¿™ä¸ªå¯¹è±¡å¤šæ¬¡å‡ºç°è¿‡ï¼Œå®ƒå®é™…ä¸Šå°±æ˜¯<code>ApplicationThread</code>ã€‚<code>ApplicationThread</code>çš„ä¸€ç³»åˆ—ä»¥<code>schedule</code>å¼€å¤´çš„æ–¹æ³•ï¼Œå…¶å†…éƒ¨éƒ½æ˜¯é€šè¿‡<code>Handler H</code>æ¥ä¸­è½¬çš„ï¼Œå¯¹äº<code>scheduleBindService</code>æ–¹æ³•æ¥è¯´ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå®ƒçš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scheduleBindService</span><span class="hljs-params">(IBinder token, Intent intent,</span><br><span class="hljs-params">                <span class="hljs-type">boolean</span> rebind, <span class="hljs-type">int</span> processState)</span> &#123;<br>            updateProcessState(processState, <span class="hljs-literal">false</span>);<br>            <span class="hljs-type">BindServiceData</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BindServiceData</span>();<br>            s.token = token;<br>            s.intent = intent;<br>            s.rebind = rebind;<br>            sendMessage(H.BIND_SERVICE, s);<br>        &#125;<br></code></pre></td></tr></table></figure><p>åœ¨Hå†…éƒ¨ï¼Œæ¥æ”¶åˆ°<code>BIND_SERVICE</code>è¿™ç±»æ¶ˆæ¯æ—¶ï¼Œä¼šäº¤ç»™<code>ActivityThread</code>çš„<code>handleBindService</code>æ–¹æ³•æ¥å¤„ç†ã€‚åœ¨<code>handleBindService</code>ä¸­ï¼Œé¦–å…ˆæ ¹æ®<code>Service</code>çš„<code>token</code>å–å‡º<code>Service</code>å¯¹è±¡ï¼Œç„¶åè°ƒç”¨<code>Service</code>çš„<code>onBind</code>æ–¹æ³•ï¼Œ<code>Service</code>çš„<code>onBind</code>æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª<code>Binder</code>å¯¹è±¡ç»™å®¢æˆ·ç«¯ä½¿ç”¨ï¼ŒåŸåˆ™ä¸Šæ¥è¯´ï¼Œ<code>Service</code>çš„<code>onBind</code>æ–¹æ³•è¢«è°ƒç”¨ä»¥åï¼Œ<code>Service</code>å°±å¤„äºç»‘å®šçŠ¶æ€äº†ï¼Œä½†æ˜¯<code>onBind</code>æ–¹æ³•æ˜¯<code>Service</code>çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™å®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“å·²ç»æˆåŠŸè¿æ¥<code>Service</code>äº†ï¼Œæ‰€ä»¥è¿˜å¿…é¡»è°ƒç”¨å®¢æˆ·ç«¯çš„<code>ServiceConnection</code>ä¸­çš„<code>onServiceConnected</code>,è¿™ä¸ªè¿‡ç¨‹æ˜¯ç”±<code>ActivityManager.getService()</code>çš„<code>publishService</code>æ–¹æ³•æ¥å®Œæˆçš„ï¼Œè€Œå‰é¢å¤šæ¬¡æåˆ°ï¼Œ<code>ActivityManager.getService()</code>å°±æ˜¯AMSã€‚<code>handleBindService</code>çš„å®ç°è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleBindService</span><span class="hljs-params">(BindServiceData data)</span> &#123;<br>        <span class="hljs-type">Service</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> mServices.get(data.token);<br>        <span class="hljs-keyword">if</span> (s != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                data.intent.setExtrasClassLoader(s.getClassLoader());<br>                data.intent.prepareToEnterProcess();<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-keyword">if</span> (!data.rebind) &#123;<br>                        <span class="hljs-type">IBinder</span> <span class="hljs-variable">binder</span> <span class="hljs-operator">=</span> s.onBind(data.intent);<br>                        ActivityManager.getService().publishService(<br>                                data.token, data.intent, binder);<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        s.onRebind(data.intent);<br>                        ActivityManager.getService().serviceDoneExecuting(<br>                                data.token, SERVICE_DONE_EXECUTING_ANON, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>                    &#125;<br>                    ensureJitEnabled();<br>                &#125; <span class="hljs-keyword">catch</span> (RemoteException ex) &#123;<br>                    <span class="hljs-keyword">throw</span> ex.rethrowFromSystemServer();<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                <span class="hljs-keyword">if</span> (!mInstrumentation.onException(s, e)) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<br>                            <span class="hljs-string">&quot;Unable to bind to service &quot;</span> + s<br>                            + <span class="hljs-string">&quot; with &quot;</span> + data.intent + <span class="hljs-string">&quot;: &quot;</span> + e.toString(), e);<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>Serviceæœ‰ä¸€ä¸ªç‰¹æ€§ï¼Œå½“å¤šæ¬¡ç»‘å®šåŒä¸€ä¸ªServiceæ—¶ï¼ŒServiceçš„<code>onBind</code>æ–¹æ³•<strong>åªä¼šæ‰§è¡Œä¸€æ¬¡</strong>ï¼Œé™¤éServiceè¢«ç»ˆæ­¢äº†ã€‚å½“Serviceçš„onBindæ‰§è¡Œä»¥åï¼Œç³»ç»Ÿè¿˜éœ€è¦å‘ŠçŸ¥å®¢æˆ·ç«¯å·²ç»æˆåŠŸè¿æ¥Serviceäº†ã€‚æ ¹æ®ä¸Šé¢çš„åˆ†æï¼Œè¿™ä¸ªè¿‡ç¨‹ç”±AMSçš„<code>publishService</code>æ–¹æ³•æ¥å®ç°:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">publishService</span><span class="hljs-params">(IBinder token, Intent intent, IBinder service)</span> &#123;<br>        <span class="hljs-comment">// Refuse possible leaked file descriptors</span><br>        <span class="hljs-keyword">if</span> (intent != <span class="hljs-literal">null</span> &amp;&amp; intent.hasFileDescriptors() == <span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;File descriptors passed in Intent&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">synchronized</span>(<span class="hljs-built_in">this</span>) &#123;<br>            <span class="hljs-keyword">if</span> (!(token <span class="hljs-keyword">instanceof</span> ServiceRecord)) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Invalid service token&quot;</span>);<br>            &#125;<br>            mServices.publishServiceLocked((ServiceRecord)token, intent, service);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>ä»_ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºï¼ŒAMSçš„<code>publishService</code>æ–¹æ³•å°†å…·ä½“çš„å·¥ä½œäº¤ç»™äº†<code>ActiveServices</code>ç±»å‹çš„<code>mServices</code>å¯¹è±¡æ¥å¤„ç†ã€‚<code>ActiveServices</code>çš„<code>publishServiceLocked</code>æ–¹æ³•çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†å…¶å®æ ¸å¿ƒä»£ç å°±åªæœ‰ä¸€- å¥è¯: <code>c.conn.connected(r.name,service)</code>ï¼Œ å…¶ä¸­cçš„ç±»å‹æ˜¯<code>ConnectionRecord</code>ï¼Œ<code>c.comn</code>çš„ç±»å‹æ˜¯<code>ServiceDispatcher.InnerConnection</code>, serviceå°±æ˜¯Serviceçš„onBindæ–¹æ³•è¿”å›çš„Binderå¯¹è±¡ã€‚ä¸ºäº†åˆ†æå…·ä½“çš„é€»è¾‘ï¼Œä¸‹é¢çœ‹ä¸€ä¸‹<code>ServiceDispatcher.InnerConnection</code>çš„å®šä¹‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InnerConnection</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IServiceConnection</span>.Stub &#123;<br>            <span class="hljs-keyword">final</span> WeakReference&lt;LoadedApk.ServiceDispatcher&gt; mDispatcher;<br><br>            InnerConnection(LoadedApk.ServiceDispatcher sd) &#123;<br>                mDispatcher = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;LoadedApk.ServiceDispatcher&gt;(sd);<br>            &#125;<br><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">connected</span><span class="hljs-params">(ComponentName name, IBinder service, <span class="hljs-type">boolean</span> dead)</span><br>                    <span class="hljs-keyword">throws</span> RemoteException &#123;<br>                LoadedApk.<span class="hljs-type">ServiceDispatcher</span> <span class="hljs-variable">sd</span> <span class="hljs-operator">=</span> mDispatcher.get();<br>                <span class="hljs-keyword">if</span> (sd != <span class="hljs-literal">null</span>) &#123;<br>                    sd.connected(name, service, dead);<br>                &#125;<br>            &#125;<br>        &#125;<br></code></pre></td></tr></table></figure><p>ä»<code>InnerConnection</code>çš„å®šä¹‰å¯ä»¥çœ‹å‡ºæ¥ï¼Œå®ƒçš„<code>connected</code>æ–¹æ³•åˆè°ƒç”¨äº†<code>ServiceDispatcher</code>çš„<code>connected</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">connected</span><span class="hljs-params">(ComponentName name, IBinder service, <span class="hljs-type">boolean</span> dead)</span> &#123;<br>            <span class="hljs-keyword">if</span> (mActivityThread != <span class="hljs-literal">null</span>) &#123;<br>                mActivityThread.post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RunConnection</span>(name, service, <span class="hljs-number">0</span>, dead));<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                doConnected(name, service, dead);<br>            &#125;<br>        &#125;<br></code></pre></td></tr></table></figure><p>å¯¹äºServiceçš„ç»‘å®šè¿‡ç¨‹æ¥è®²ï¼Œ<code>ServiceDispatcher</code>ä¸­çš„<code>mActivityThread</code>å°±æ˜¯ä¸€ä¸ª<code>handler</code>ï¼Œå®ƒå°±æ˜¯<code>ActivityThread</code>ä¸­çš„<code>H</code>ï¼Œä»<code>Service</code>çš„åˆ›å»ºè¿‡ç¨‹æ¥è®²ï¼Œ<code>mActivityTHread</code>ä¸ä¼šä¸º<code>null</code>ï¼Œè¿™æ ·ä¸€æ¥ï¼Œ<code>RunConnection</code>å°±å¯ä»¥ç»ç”±<code>H</code>çš„<code>post</code>æ–¹æ³•ä»è€Œè¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œå› æ­¤ï¼Œå®¢æˆ·ç«¯çš„<code>ServiceConnection</code>ä¸­çš„æ–¹æ³•å›è°ƒæ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œçš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RunConnection</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> &#123;<br>            RunConnection(ComponentName name, IBinder service, <span class="hljs-type">int</span> command, <span class="hljs-type">boolean</span> dead) &#123;<br>                mName = name;<br>                mService = service;<br>                mCommand = command;<br>                mDead = dead;<br>            &#125;<br><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                <span class="hljs-keyword">if</span> (mCommand == <span class="hljs-number">0</span>) &#123;<br>                    doConnected(mName, mService, mDead);<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (mCommand == <span class="hljs-number">1</span>) &#123;<br>                    doDeath(mName, mService);<br>                &#125;<br>            &#125;<br><br>            <span class="hljs-keyword">final</span> ComponentName mName;<br>            <span class="hljs-keyword">final</span> IBinder mService;<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> mCommand;<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> mDead;<br>        &#125;<br><br></code></pre></td></tr></table></figure><p>å¾ˆæ˜¾ç„¶ï¼Œ<code>RunConnection</code>çš„<code>run</code>æ–¹æ³•ä¹Ÿæ˜¯ç®€å•è°ƒç”¨äº†<code>ServiceDispatcher</code>çš„<code>doConnected</code>æ–¹æ³•ï¼Œç”±äº<code>ServiceDispatcher</code>å†…éƒ¨ä¿å­˜äº†å®¢æˆ·ç«¯çš„<code>ServiceConnection</code>å¯¹è±¡ï¼Œå› æ­¤å®ƒå¯ä»¥å¾ˆæ–¹ä¾¿åœ°è°ƒç”¨<code>ServiceConnection</code>å¯¹è±¡çš„<code>onServiceConnected</code>æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚<br>è‡³æ­¤ï¼ŒbindServiceçš„è¿‡ç¨‹å®Œæˆã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Androidå¹¿æ’­</title>
    <link href="/2018/07/31/Android%E5%B9%BF%E6%92%AD/"/>
    <url>/2018/07/31/Android%E5%B9%BF%E6%92%AD/</url>
    
    <content type="html"><![CDATA[<p>é¢è¯•APUSçš„æ—¶å€™è¢«é—®åˆ°å¹¿æ’­ï¼š<br>é¢è¯•å®˜ï¼šèŠä¸€ä¸‹å¹¿æ’­å§ã€‚<br>æˆ‘ï¼šå¹¿æ’­å•Šï¼Œå››å¤§ç»„ä»¶ä¹‹ä¸€ï¼Œè‡ªå·±åˆ›å»ºä¸ªç±»ç»§æ‰¿è‡ª<code>BroadcastReceiver</code>ï¼Œé‡å†™<code>onReceive()</code>æ–¹æ³•ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ä¸è¦åœ¨è¿™ä¸ªæ–¹æ³•ä¸­åšè€—æ—¶æ“ä½œã€‚æ³¨å†Œçš„è¯å¯ä»¥åœ¨<code>AndroidManifest</code>æ–‡ä»¶ä¸­é™æ€æ³¨å†Œï¼Œä¹Ÿå¯ä»¥åœ¨ä»£ç ä¸­åŠ¨æ€æ³¨å†Œã€‚éƒ½åšå®Œäº†ä¹‹åå°±å¯ä»¥è°ƒç”¨sendBroadCast()æ–¹æ³•å‘é€å¹¿æ’­äº†ã€‚<br>é¢è¯•å®˜ï¼šäº†è§£å¹¿æ’­æ³¨å†Œè¿‡ç¨‹ä¹ˆï¼Ÿ<br>æˆ‘ï¼šå“ˆ~ï¼è¿™ä¸ªæ²¡æ€ä¹ˆçœ‹è¿‡ã€‚<br>é¢è¯•å®˜ï¼šäº†è§£æ€ä¹ˆæ¥æ”¶åˆ°çš„å¹¿æ’­ä¹ˆï¼Ÿ<br>æˆ‘ï¼šæ²¡æœ‰ã€‚ã€‚ã€‚ã€‚</p><span id="more"></span><h4 id="å¹¿æ’­çš„æ³¨å†Œè¿‡ç¨‹"><a href="#å¹¿æ’­çš„æ³¨å†Œè¿‡ç¨‹" class="headerlink" title="å¹¿æ’­çš„æ³¨å†Œè¿‡ç¨‹"></a>å¹¿æ’­çš„æ³¨å†Œè¿‡ç¨‹</h4><p>ã€ŠAndroidå¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹9.4ç« <br>å¹¿æ’­çš„æ³¨å†Œåˆ†ä¸ºé™æ€æ³¨å†Œå’ŒåŠ¨æ€æ³¨å†Œï¼Œå…¶ä¸­é™æ€æ³¨å†Œçš„å¹¿æ’­åœ¨åº”ç”¨å®‰è£…æ—¶ç”±ç³»ç»Ÿè‡ªåŠ¨å®Œæˆæ³¨å†Œï¼Œå…·ä½“æ¥è¯´æ˜¯ç”±PMS ( PackageManagerService)æ¥å®Œæˆæ•´ä¸ªæ³¨å†Œè¿‡ç¨‹çš„ï¼Œé™¤äº†å¹¿æ’­ä»¥å¤–ï¼Œå…¶ä»–ä¸‰å¤§ç»„ä»¶ä¹Ÿéƒ½æ˜¯åœ¨åº”ç”¨å®‰è£…æ—¶ç”±PMSè§£æå¹¶æ³¨å†Œçš„ã€‚è¿™é‡Œåªåˆ†æå¹¿æ’­çš„åŠ¨æ€æ³¨å†Œçš„è¿‡ç¨‹ï¼ŒåŠ¨æ€æ³¨å†Œçš„è¿‡ç¨‹æ˜¯ä»ContextWrapperçš„registerReceiveræ–¹æ³•å¼€å§‹çš„ï¼Œå’ŒActivityä»¥åŠServiceä¸€æ · ã€‚ContextWrapperå¹¶ æ²¡æœ‰åšå®é™…çš„å·¥ä½œï¼Œè€Œæ˜¯å°†æ³¨å†Œè¿‡ç¨‹ç›´æ¥äº¤ç»™äº†ContextImplæ¥å®Œæˆï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Intent <span class="hljs-title function_">registerReceiver</span><span class="hljs-params">(BroadcastReceiver receiver, IntentFilter filter)</span> &#123;<br>    <span class="hljs-keyword">return</span> mBase.registerReceiver(receiver, filter);<br>&#125;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Intent <span class="hljs-title function_">registerReceiver</span><span class="hljs-params">(BroadcastReceiver receiver, IntentFilter filter,String broadcastPermission, Handler scheduler)</span> &#123;<br>    <span class="hljs-keyword">return</span> registerReceiverInternal(receiver, getUserId(),<br>            filter, broadcastPermission, scheduler, getOuterContext(), <span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>registerReceiver</code>æ–¹æ³•æ˜¯é‡è½½æ–¹æ³•ï¼Œæœ€ç»ˆè°ƒç”¨äº†<code>registerReceiverInternal</code>æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> Intent <span class="hljs-title function_">registerReceiverInternal</span><span class="hljs-params">(BroadcastReceiver receiver, <span class="hljs-type">int</span> userId,</span><br><span class="hljs-params">            IntentFilter filter, String broadcastPermission,</span><br><span class="hljs-params">            Handler scheduler, Context context, <span class="hljs-type">int</span> flags)</span> &#123;<br>        <span class="hljs-type">IIntentReceiver</span> <span class="hljs-variable">rd</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">if</span> (receiver != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">if</span> (mPackageInfo != <span class="hljs-literal">null</span> &amp;&amp; context != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">if</span> (scheduler == <span class="hljs-literal">null</span>) &#123;<br>                    scheduler = mMainThread.getHandler();<br>                &#125;<br>                rd = mPackageInfo.getReceiverDispatcher(<br>                    receiver, context, scheduler,<br>                    mMainThread.getInstrumentation(), <span class="hljs-literal">true</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">if</span> (scheduler == <span class="hljs-literal">null</span>) &#123;<br>                    scheduler = mMainThread.getHandler();<br>                &#125;<br>                rd = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoadedApk</span>.ReceiverDispatcher(<br>                        receiver, context, scheduler, <span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>).getIIntentReceiver();<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> ActivityManager.getService().registerReceiver(<br>                    mMainThread.getApplicationThread(), mBasePackageName, rd, filter,<br>                    broadcastPermission, userId, flags);<br>            <span class="hljs-keyword">if</span> (intent != <span class="hljs-literal">null</span>) &#123;<br>                intent.setExtrasClassLoader(getClassLoader());<br>                intent.prepareToEnterProcess();<br>            &#125;<br>            <span class="hljs-keyword">return</span> intent;<br>        &#125; <span class="hljs-keyword">catch</span> (RemoteException e) &#123;<br>            <span class="hljs-keyword">throw</span> e.rethrowFromSystemServer();<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œç³»ç»Ÿé¦–å…ˆä»<code>mPackageInfo</code>è·å–<code>IIntentReceiver</code>å¯¹è±¡ï¼Œç„¶åå†é‡‡ç”¨è·¨è¿›ç¨‹çš„æ–¹å¼å‘AMSå‘é€å¹¿æ’­æ³¨å†Œçš„è¯·æ±‚ã€‚ä¹‹æ‰€ä»¥é‡‡ç”¨<code>IIntentReceiver</code>è€Œä¸æ˜¯ç›´æ¥é‡‡ç”¨<code>BroadcastReceiver</code> ,è¿™æ˜¯å› ä¸ºä¸Šè¿°æ³¨å†Œè¿‡ç¨‹æ˜¯ä¸€ä¸ªè¿›ç¨‹é—´é€šä¿¡çš„è¿‡ç¨‹ï¼Œè€Œ<code>BroadcastReceiver</code>ä½œä¸ºAndroidçš„ä¸€ä¸ªç»„ä»¶æ˜¯ä¸èƒ½ç›´æ¥è·¨è¿›ç¨‹ä¼ é€’çš„ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡<code>IIntentReceiver</code>æ¥ä¸­è½¬ä¸€ä¸‹ã€‚æ¯«æ— ç–‘é—®ï¼Œ<code>IIntentReceiver</code>å¿…é¡»æ˜¯ä¸€ä¸ªBinderæ¥å£ï¼Œå®ƒçš„å…·ä½“å®ç°æ˜¯<code>LoadedApk.ReceiverDispatcher.InnerReceiver</code>, <code>ReceiverDispatcher</code>çš„å†…éƒ¨åŒæ—¶ä¿å­˜äº†<code>BroadcastReceiver</code>å’Œ<code>InnerReceiver</code>,è¿™æ ·å½“æ¥æ”¶åˆ°å¹¿æ’­æ—¶ï¼Œ<code>ReceiverDispatcher</code>å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è°ƒç”¨<code>BroadcastReceiver</code>çš„<code>onReceive</code>æ–¹æ³•ã€‚<br>çœ‹ä¸€ä¸‹<code>LoadedApk.getReceiverDispatcher</code>æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> IIntentReceiver <span class="hljs-title function_">getReceiverDispatcher</span><span class="hljs-params">(BroadcastReceiver r,</span><br><span class="hljs-params">            Context context, Handler handler,</span><br><span class="hljs-params">            Instrumentation instrumentation, <span class="hljs-type">boolean</span> registered)</span> &#123;<br>        <span class="hljs-keyword">synchronized</span> (mReceivers) &#123;<br>            LoadedApk.<span class="hljs-type">ReceiverDispatcher</span> <span class="hljs-variable">rd</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>            ArrayMap&lt;BroadcastReceiver, LoadedApk.ReceiverDispatcher&gt; map = <span class="hljs-literal">null</span>;<br>            <span class="hljs-keyword">if</span> (registered) &#123;<br>                map = mReceivers.get(context);<br>                <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) &#123;<br>                    rd = map.get(r);<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (rd == <span class="hljs-literal">null</span>) &#123;<br>                rd = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReceiverDispatcher</span>(r, context, handler,<br>                        instrumentation, registered);<br>                <span class="hljs-keyword">if</span> (registered) &#123;<br>                    <span class="hljs-keyword">if</span> (map == <span class="hljs-literal">null</span>) &#123;<br>                        map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayMap</span>&lt;BroadcastReceiver, LoadedApk.ReceiverDispatcher&gt;();<br>                        mReceivers.put(context, map);<br>                    &#125;<br>                    map.put(r, rd);<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                rd.validate(context, handler);<br>            &#125;<br>            rd.mForgotten = <span class="hljs-literal">false</span>;<br>            <span class="hljs-keyword">return</span> rd.getIIntentReceiver();<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>å¾ˆæ˜¾ç„¶ï¼Œ<code>getReceiverDispatcher</code>æ–¹æ³•é‡æ–°åˆ›å»ºäº†ä¸€ä¸ª<code>ReceiverDispatcher</code>å¯¹è±¡å¹¶å°†å…¶ä¿å­˜çš„<code>InnerReceiver</code>å¯¹è±¡ä½œä¸ºè¿”å›å€¼è¿”å›ï¼Œå…¶ä¸­<code>InnerReceiver</code>å¯¹è±¡å’Œ<code>BroadcastReceiver</code>éƒ½æ˜¯åœ¨<code>ReceiverDispatcher</code>çš„æ„é€ æ–¹æ³•ä¸­è¢«ä¿å­˜èµ·æ¥çš„ã€‚<br>ç”±äºæ³¨å†Œå¹¿æ’­çš„çœŸæ­£å®ç°è¿‡ç¨‹æ˜¯åœ¨AMSä¸­ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦çœ‹ä¸€ä¸‹AMSçš„å…·ä½“å®ç°ã€‚AMSçš„<code>registerReceiver</code>æ–¹æ³•çœ‹èµ·æ¥å¾ˆé•¿ï¼Œå…¶å®å…³é”®ç‚¹å°±åªæœ‰ä¸‹é¢ä¸€éƒ¨åˆ†ï¼Œæœ€ç»ˆä¼šæŠŠè¿œç¨‹çš„<code>InnerReceiver</code>å¯¹è±¡ä»¥åŠ<code>IntentFilter</code>å¯¹è±¡å­˜å‚¨èµ·æ¥ï¼Œè¿™æ ·æ•´ä¸ªå¹¿æ’­çš„æ³¨å†Œè¿‡ç¨‹å°±å®Œæˆäº†ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Intent <span class="hljs-title function_">registerReceiver</span><span class="hljs-params">(IApplicationThread caller, String callerPackage,IIntentReceiver receiver, IntentFilter filter, String permission, <span class="hljs-type">int</span> userId)</span> &#123;<br>    <span class="hljs-comment">// The first sticky in the list is returned directly back to the client.</span><br>    <span class="hljs-type">Intent</span> <span class="hljs-variable">sticky</span> <span class="hljs-operator">=</span> allSticky != <span class="hljs-literal">null</span> ? allSticky.get(<span class="hljs-number">0</span>) : <span class="hljs-literal">null</span>;<br>    <span class="hljs-type">ReceiverList</span> <span class="hljs-variable">rl</span> <span class="hljs-operator">=</span> mRegisteredReceivers.get(receiver.asBinder());<br>    <span class="hljs-type">BroadcastFilter</span> <span class="hljs-variable">bf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastFilter</span>(filter, rl, callerPackage,permission, callingUid, userId);<br>    rl.add(bf);<br>    mReceiverResolver.addFilter(bf);<br>    <span class="hljs-keyword">return</span> sticky;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="å¹¿æ’­çš„å‘é€è¿‡ç¨‹"><a href="#å¹¿æ’­çš„å‘é€è¿‡ç¨‹" class="headerlink" title="å¹¿æ’­çš„å‘é€è¿‡ç¨‹"></a>å¹¿æ’­çš„å‘é€è¿‡ç¨‹</h4><p>å½“é€šè¿‡sendæ–¹æ³•æ¥å‘é€å¹¿æ’­æ—¶ï¼ŒAMSä¼šæŸ¥æ‰¾å‡ºåŒ¹é…çš„å¹¿æ’­æ¥æ”¶è€…å¹¶å°†å¹¿æ’­å‘é€ç»™å®ƒä»¬å¤„ç†ã€‚å¹¿æ’­çš„å‘é€æœ‰å‡ ç§ç±»å‹:æ™®é€šå¹¿æ’­ã€æœ‰åºå¹¿æ’­å’Œç²˜æ€§å¹¿æ’­ï¼Œæœ‰åºå¹¿æ’­å’Œç²˜æ€§å¹¿æ’­ä¸æ™®é€šå¹¿æ’­ç›¸æ¯”å…·æœ‰ä¸åŒçš„ç‰¹æ€§ï¼Œä½†æ˜¯å®ƒä»¬çš„å‘é€&#x2F;æ¥æ”¶è¿‡ç¨‹çš„æµç¨‹æ˜¯ç±»ä¼¼çš„ï¼Œå› æ­¤è¿™é‡Œåªåˆ†ææ™®é€šå‚æ’­çš„å®ç°ã€‚å¹¿æ’­çš„å‘é€å’Œæ¥æ”¶ï¼Œå…¶æœ¬è´¨æ˜¯ä¸€ä¸ªè¿‡ç¨‹çš„ä¸¤ä¸ªé˜¶æ®µã€‚è¿™é‡Œä»å¹¿æ’­çš„å‘é€å¯ä»¥è¯´èµ·ï¼Œå¹¿æ’­çš„å‘é€ä»ç„¶å¼€å§‹äº<code>ContextWrapper</code>çš„<code>sendBroadcast</code>æ–¹æ³•ï¼Œä¹‹æ‰€ä»¥ä¸æ˜¯<code>Context</code>,é‚£æ˜¯å› ä¸º<code>Context</code>çš„<code>sendBroadcast</code>æ˜¯-ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ã€‚å’Œå¹¿æ’­çš„æ³¨å†Œè¿‡ç¨‹ä¸€æ ·ï¼Œ<code>ContextWrapper</code>çš„<code>sendBroadcast</code>æ–¹æ³•ä»ç„¶ä»€ä¹ˆéƒ½ä¸åšï¼Œåªæ˜¯æŠŠäº‹æƒ…äº¤ç»™<code>ContextImpl</code>å»å¤„ç†ï¼Œ<code>ContextImplçš„sendBroadcast</code>æ–¹æ³•çš„æºç å¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendBroadcast</span><span class="hljs-params">(Intent intent)</span> &#123;<br>        warnIfCallingFromSystemProcess();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">resolvedType</span> <span class="hljs-operator">=</span> intent.resolveTypeIfNeeded(getContentResolver());<br>        <span class="hljs-keyword">try</span> &#123;<br>            intent.prepareToLeaveProcess(<span class="hljs-built_in">this</span>);<br>            ActivityManager.getService().broadcastIntent(<br>                    mMainThread.getApplicationThread(), intent, resolvedType, <span class="hljs-literal">null</span>,<br>                    Activity.RESULT_OK, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, AppOpsManager.OP_NONE, <span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>,<br>                    getUserId());<br>        &#125; <span class="hljs-keyword">catch</span> (RemoteException e) &#123;<br>            <span class="hljs-keyword">throw</span> e.rethrowFromSystemServer();<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>ä»_ä¸Šé¢çš„ä»£ç æ¥çœ‹ï¼Œ<code>ContextImpl</code>ä¹Ÿæ˜¯å‡ ä¹ä»€ä¹ˆäº‹éƒ½æ²¡å¹²ï¼Œå®ƒç›´æ¥å‘AMSå‘èµ·äº†ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚ç”¨äºå‘é€å¹¿æ’­ã€‚å› æ­¤ï¼Œä¸‹é¢ç›´æ¥çœ‹AMSå¯¹å¹¿æ’­å‘é€è¿‡ç¨‹çš„å¤„ç†ï¼ŒAMSçš„<code>broadcastIntent</code>æ–¹æ³•åˆè°ƒç”¨äº†<code>broadcastIntentLocked</code>,åœ¨è¿™ä¸ªæ–¹æ³•çš„å¼€å§‹æœ‰è¿™ä¹ˆä¸€è¡Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// By default broadcasts do not go to stopped apps.</span><br>intent.addFlags(Intent.FLAG_EXCLUDE_STOPPED_PACKAGES);<br></code></pre></td></tr></table></figure><p>ä»Android3.1å¼€å§‹å¹¿æ’­é»˜è®¤æƒ…å†µä¸‹å¹¿æ’­ä¸ä¼šå‘é€ç»™å·²ç»åœæ­¢çš„åº”ç”¨ã€‚è¿™æ˜¯å› ä¸ºç³»ç»Ÿåœ¨Android3.1ä¸­ä¸ºIntentæ·»åŠ äº†ä¸¤ä¸ªæ ‡è®°ä½ï¼Œåˆ†åˆ«æ˜¯<code>FLAG_INCLUDE_STOPPED_PACKAGES</code>å’Œ<code>FLAG_EXCLUDE_STOPPED_PACKAGES</code>ï¼Œç”¨æ¥æ§åˆ¶å¹¿æ’­æ˜¯å¦è¦å¯¹å¤„äºåœæ­¢çŠ¶æ€çš„åº”ç”¨èµ·ä½œç”¨ï¼Œå®ƒä»¬çš„å«ä¹‰å¦‚ä¸‹æ‰€ç¤ºã€‚<br>** FLAG_INCLUDE_STOPPED_PACKAGES **<br>è¡¨ç¤ºåŒ…å«å·²ç»åœæ­¢çš„åº”ç”¨ï¼Œè¿™ä¸ªæ—¶å€™å¹¿æ’­ä¼šå‘é€ç»™å·²ç»åœæ­¢çš„åº”ç”¨ã€‚<br>** FLAG_EXCLUDE_STOPPED_PACKAGES **<br>è¡¨ç¤ºä¸åŒ…å«å·²ç»åœæ­¢çš„åº”ç”¨ï¼Œè¿™ä¸ªæ—¶å€™å¹¿æ’­ä¸ä¼šå‘é€ç»™å·²ç»åœæ­¢çš„åº”ç”¨ã€‚</p><p>ä»Android3.1å¼€å§‹ï¼Œç³»ç»Ÿä¸ºæ‰€æœ‰å¹¿æ’­é»˜è®¤æ·»åŠ äº†<code>FLAG_EXCLUDE_STOPPED_PACKAGES</code>æ ‡å¿—ï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†é˜²æ­¢å¹¿æ’­æ— æ„é—´æˆ–è€…åœ¨ä¸å¿…è¦çš„æ—¶å€™è°ƒèµ·å·²ç»åœæ­¢è¿è¡Œçš„åº”ç”¨ã€‚å¦‚æœçš„ç¡®éœ€è¦è°ƒèµ·æœªå¯åŠ¨çš„åº”ç”¨ï¼Œé‚£ä¹ˆåªéœ€è¦ä¸ºå¹¿æ’­çš„Intentæ·»åŠ <code>FLAG_INCLUDE_STOPPED_PACKAGES</code>æ ‡è®°å³å¯ã€‚å½“<code>FLAG_EXCLUDE_STOPPED_PACKAGES</code>å’Œ<code>FLAG_INCLUDE_STOPPED_PACKAGES</code>ä¸¤ç§æ ‡è®°ä½å…±å­˜æ—¶,ä»¥<code>FLAG_INCLUDE_STOPPED_PACKAGES</code>ä¸ºå‡†ã€‚è¿™é‡Œéœ€è¦è¡¥å……ä¸€ä¸‹ï¼Œä¸€ä¸ªåº”ç”¨å¤„äºåœæ­¢çŠ¶æ€åˆ†ä¸ºä¸¤ç§æƒ…å½¢:<br>ç¬¬ä¸€ç§æ˜¯åº”ç”¨å®‰è£…åæœªè¿è¡Œï¼Œ<br>ç¬¬äºŒç§æ˜¯åº”ç”¨è¢«æ‰‹åŠ¨æˆ–è€…å…¶ä»–åº”ç”¨å¼ºåœäº†ã€‚<br>Android3.1ä¸­å¹¿æ’­çš„è¿™ä¸ªç‰¹æ€§åŒæ ·ä¼šå½±å“å¼€æœºå¹¿æ’­ï¼Œä»Android3.1å¼€å§‹ï¼Œå¤„äºåœæ­¢çŠ¶æ€çš„åº”ç”¨åŒæ ·æ— æ³•æ¥æ”¶åˆ°å¼€æœºå¹¿æ’­ï¼Œè€Œåœ¨Android 3.1ä¹‹å‰ï¼Œå¤„äºåœæ­¢çŠ¶æ€çš„åº”ç”¨æ˜¯å¯ä»¥æ”¶åˆ°å¼€æœºå¹¿æ’­çš„ã€‚<br>åœ¨<code>broadcastIntentLocked</code>çš„å†…éƒ¨ï¼Œä¼šæ ¹æ®<code>intent-filter</code>æŸ¥æ‰¾å‡ºåŒ¹é…çš„å¹¿æ’­æ¥æ”¶è€…å¹¶ç»è¿‡ä¸€ç³»åˆ—çš„æ¡ä»¶è¿‡æ»¤ï¼Œæœ€ç»ˆä¼šå°†æ»¡è¶³æ¡ä»¶çš„å¹¿æ’­æ¥æ”¶è€…æ·»åŠ åˆ°<code>BroadcastQueue</code>ä¸­ï¼Œæ¥ç€<code>BroadcastQueue</code>å°±ä¼šå°†å¹¿æ’­å‘é€ç»™ç›¸åº”çš„å¹¿æ’­æ¥æ”¶è€…ï¼Œè¿™ä¸ªè¿‡ç¨‹çš„æºç å¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> ((receivers != <span class="hljs-literal">null</span> &amp;&amp; receivers.size() &gt; <span class="hljs-number">0</span>)<br>                || resultTo != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-type">BroadcastQueue</span> <span class="hljs-variable">queue</span> <span class="hljs-operator">=</span> broadcastQueueForIntent(intent);<br>            <span class="hljs-type">BroadcastRecord</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastRecord</span>(queue, intent, callerApp,<br>                    callerPackage, callingPid, callingUid, resolvedType,<br>                    requiredPermissions, appOp, brOptions, receivers, resultTo, resultCode,<br>                    resultData, resultExtras, ordered, sticky, <span class="hljs-literal">false</span>, userId);<br><br>            <span class="hljs-keyword">if</span> (DEBUG_BROADCAST) Slog.v(TAG_BROADCAST, <span class="hljs-string">&quot;Enqueueing ordered broadcast &quot;</span> + r<br>                    + <span class="hljs-string">&quot;: prev had &quot;</span> + queue.mOrderedBroadcasts.size());<br>            <span class="hljs-keyword">if</span> (DEBUG_BROADCAST) Slog.i(TAG_BROADCAST,<br>                    <span class="hljs-string">&quot;Enqueueing broadcast &quot;</span> + r.intent.getAction());<br><br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">replaced</span> <span class="hljs-operator">=</span> replacePending &amp;&amp; queue.replaceOrderedBroadcastLocked(r);<br>            <span class="hljs-keyword">if</span> (!replaced) &#123;<br>                queue.enqueueOrderedBroadcastLocked(r);<br>                queue.scheduleBroadcastsLocked();<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// There was nobody interested in the broadcast, but we still want to record</span><br>            <span class="hljs-comment">// that it happened.</span><br>            <span class="hljs-keyword">if</span> (intent.getComponent() == <span class="hljs-literal">null</span> &amp;&amp; intent.getPackage() == <span class="hljs-literal">null</span><br>                    &amp;&amp; (intent.getFlags()&amp;Intent.FLAG_RECEIVER_REGISTERED_ONLY) == <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-comment">// This was an implicit broadcast... let&#x27;s record it for posterity.</span><br>                addBroadcastStatLocked(intent.getAction(), callerPackage, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>            &#125;<br>        &#125;<br></code></pre></td></tr></table></figure><p>å°†å¹¿æ’­æ·»åŠ åˆ°<code>BroadCastQueue</code>ä¹‹åï¼Œæ¥ç€è°ƒç”¨äº†<code>scheduleBroadcastsLocked</code>æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scheduleBroadcastsLocked</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-keyword">if</span> (DEBUG_BROADCAST) Slog.v(TAG_BROADCAST, <span class="hljs-string">&quot;Schedule broadcasts [&quot;</span><br>               + mQueueName + <span class="hljs-string">&quot;]: current=&quot;</span><br>               + mBroadcastsScheduled);<br><br>       <span class="hljs-keyword">if</span> (mBroadcastsScheduled) &#123;<br>           <span class="hljs-keyword">return</span>;<br>       &#125;<br>       mHandler.sendMessage(mHandler.obtainMessage(BROADCAST_INTENT_MSG, <span class="hljs-built_in">this</span>));<br>       mBroadcastsScheduled = <span class="hljs-literal">true</span>;<br>   &#125;<br></code></pre></td></tr></table></figure><p>æ–¹æ³•å†…å‘é€äº†ä¸€ä¸ª<code>BROADCAST_INTENT_MSG</code>æ¶ˆæ¯ï¼Œhandleræ¥åˆ°æ¶ˆæ¯åï¼Œè°ƒç”¨äº†<code>processNextBroadcast</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BroadcastHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Handler</span> &#123;<br>       <span class="hljs-keyword">public</span> <span class="hljs-title function_">BroadcastHandler</span><span class="hljs-params">(Looper looper)</span> &#123;<br>           <span class="hljs-built_in">super</span>(looper, <span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>);<br>       &#125;<br><br>       <span class="hljs-meta">@Override</span><br>       <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(Message msg)</span> &#123;<br>           <span class="hljs-keyword">switch</span> (msg.what) &#123;<br>               <span class="hljs-keyword">case</span> BROADCAST_INTENT_MSG: &#123;<br>                   <span class="hljs-keyword">if</span> (DEBUG_BROADCAST) Slog.v(TAG_BROADCAST, <span class="hljs-string">&quot;Received BROADCAST_INTENT_MSG&quot;</span>);<br>                   processNextBroadcast(<span class="hljs-literal">true</span>);<br>               &#125; <span class="hljs-keyword">break</span>;<br>               <span class="hljs-keyword">case</span> BROADCAST_TIMEOUT_MSG: &#123;<br>                   <span class="hljs-keyword">synchronized</span> (mService) &#123;<br>                       broadcastTimeoutLocked(<span class="hljs-literal">true</span>);<br>                   &#125;<br>               &#125; <span class="hljs-keyword">break</span>;<br>               <span class="hljs-keyword">case</span> SCHEDULE_TEMP_WHITELIST_MSG: &#123;<br>                   DeviceIdleController.<span class="hljs-type">LocalService</span> <span class="hljs-variable">dic</span> <span class="hljs-operator">=</span> mService.mLocalDeviceIdleController;<br>                   <span class="hljs-keyword">if</span> (dic != <span class="hljs-literal">null</span>) &#123;<br>                       dic.addPowerSaveTempWhitelistAppDirect(UserHandle.getAppId(msg.arg1),msg.arg2, <span class="hljs-literal">true</span>, (String)msg.obj);<br>                   &#125;<br>               &#125; <span class="hljs-keyword">break</span>;<br>           &#125;<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure><p>æ”¶åˆ°æ¶ˆæ¯åä¼šè°ƒç”¨<code>processNextBroadcast</code>æ–¹æ³•ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// First, deliver any non-serialized broadcasts right away.</span><br>    <span class="hljs-keyword">while</span> (mParallelBroadcasts.size() &gt; <span class="hljs-number">0</span>) &#123;<br>        r = mParallelBroadcasts.remove(<span class="hljs-number">0</span>);<br>        r.dispatchTime = SystemClock.uptimeMillis();<br>        r.dispatchClockTime = System.currentTimeMillis();<br><br>        <span class="hljs-keyword">if</span> (Trace.isTagEnabled(Trace.TRACE_TAG_ACTIVITY_MANAGER)) &#123;<br>            Trace.asyncTraceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER,<br>                createBroadcastTraceTitle(r, BroadcastRecord.DELIVERY_PENDING),<br>                System.identityHashCode(r));<br>            Trace.asyncTraceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER,<br>                createBroadcastTraceTitle(r, BroadcastRecord.DELIVERY_DELIVERED),<br>                System.identityHashCode(r));<br>        &#125;<br><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">N</span> <span class="hljs-operator">=</span> r.receivers.size();<br>        <br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;N; i++) &#123;<br>            <span class="hljs-type">Object</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> r.receivers.get(i);<br>            <span class="hljs-keyword">if</span> (DEBUG_BROADCAST)  Slog.v(TAG_BROADCAST,<br>                    <span class="hljs-string">&quot;Delivering non-ordered on [&quot;</span> + mQueueName + <span class="hljs-string">&quot;] to registered &quot;</span><br>                    + target + <span class="hljs-string">&quot;: &quot;</span> + r);<br>            deliverToRegisteredReceiverLocked(r, (BroadcastFilter)target, <span class="hljs-literal">false</span>, i);<br>        &#125;<br>        addBroadcastToHistoryLocked(r);<br>       <br>    &#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæ— åºå¹¿æ’­å­˜å‚¨åœ¨<code>mParallelBroadcasts</code>ä¸­ï¼Œç³»ç»Ÿä¼šéå†<code>mParallelBroadcasts</code>å¹¶å°†å…¶ä¸­çš„å¹¿æ’­å‘é€ç»™å®ƒä»¬æ‰€æœ‰çš„æ¥æ”¶è€…ï¼Œå…·ä½“çš„å‘é€è¿‡ç¨‹æ˜¯é€šè¿‡<code>deliverToRegisteredReceiverLocked</code>æ–¹æ³•æ¥å®ç°çš„ã€‚<code>deliverToRegisteredReceiverLocked</code>æ–¹æ³•è´Ÿè´£å°†ä¸€ä¸ªå¹¿æ’­å‘é€ç»™ä¸€ä¸ªç‰¹å®šçš„æ¥æ”¶è€…ï¼Œå®ƒå†…éƒ¨è°ƒç”¨äº†<code>performReceiveLocked</code>æ–¹æ³•æ¥å®Œæˆå…·ä½“çš„å‘é€è¿‡ç¨‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">performReceiveLocked(r.callerApp, r.resultTo,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(r.intent), r.resultCode,r.resultData, r.resultExtras, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, r.userId);<br></code></pre></td></tr></table></figure><p><code>performReceiveLocked</code>æ–¹æ³•çš„å®ç°å¦‚ä¸‹æ‰€ç¤ºã€‚ç”±äºæ¥æ”¶å¹¿æ’­ä¼šè°ƒèµ·åº”ç”¨ç¨‹åºï¼Œå› æ­¤app.threadä¸ä¸ºnullï¼Œæ ¹æ®å‰é¢çš„åˆ†ææˆ‘ä»¬çŸ¥é“è¿™é‡Œçš„<code>app.thread</code>ä»ç„¶æŒ‡<code>ApplicationThread</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">performReceiveLocked</span><span class="hljs-params">(ProcessRecord app, IIntentReceiver receiver,Intent intent, <span class="hljs-type">int</span> resultCode, String data, Bundle extras,<span class="hljs-type">boolean</span> ordered, <span class="hljs-type">boolean</span> sticky, <span class="hljs-type">int</span> sendingUser)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>            <br>            <span class="hljs-comment">// Send the intent to the receiver asynchronously using one-way binder calls.</span><br>    <span class="hljs-keyword">if</span> (app != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">if</span> (app.thread != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// If we have an app thread, do the call through that so it is</span><br>            <span class="hljs-comment">// correctly ordered with other one-way calls.</span><br>            <span class="hljs-keyword">try</span> &#123;<br>                app.thread.scheduleRegisteredReceiver(receiver, intent, resultCode,<br>                        data, extras, ordered, sticky, sendingUser, app.repProcState);<br>            <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Uncomment this when (b/28322359) is fixed and we aren&#x27;t getting</span><br>            <span class="hljs-comment">// DeadObjectException when the process isn&#x27;t actually dead.</span><br>            <span class="hljs-comment">//&#125; catch (DeadObjectException ex) &#123;</span><br>            <span class="hljs-comment">// Failed to call into the process.  It&#x27;s dying so just let it die and move on.</span><br>            <span class="hljs-comment">//    throw ex;</span><br>            &#125; <span class="hljs-keyword">catch</span> (RemoteException ex) &#123;<br>                <span class="hljs-comment">// Failed to call into the process. It&#x27;s either dying or wedged. Kill it gently.</span><br>                <span class="hljs-keyword">synchronized</span> (mService) &#123;<br>                    Slog.w(TAG, <span class="hljs-string">&quot;Can&#x27;t deliver broadcast to &quot;</span> + app.processName<br>                            + <span class="hljs-string">&quot; (pid &quot;</span> + app.pid + <span class="hljs-string">&quot;). Crashing it.&quot;</span>);<br>                    app.scheduleCrash(<span class="hljs-string">&quot;can&#x27;t deliver broadcast&quot;</span>);<br>                &#125;<br>                <span class="hljs-keyword">throw</span> ex;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// Application has died. Receiver doesn&#x27;t exist.</span><br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RemoteException</span>(<span class="hljs-string">&quot;app.thread must not be null&quot;</span>);<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        receiver.performReceive(intent, resultCode, data, extras, ordered,<br>                sticky, sendingUser);<br>    &#125;<br>            <br>&#125;<br></code></pre></td></tr></table></figure><p><code>ApplicationThread</code>çš„<code>scheduleRegisteredReceiver</code>çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œå®ƒé€šè¿‡<code>InnerReceiver</code>æ¥å®ç°å¹¿æ’­çš„æ¥æ”¶:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// This function exists to make sure all receiver dispatching is</span><br><span class="hljs-comment">// correctly ordered, since these are one-way calls and the binder driver</span><br><span class="hljs-comment">// applies transaction ordering per object for such calls.</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scheduleRegisteredReceiver</span><span class="hljs-params">(IIntentReceiver receiver, Intent intent,</span><br><span class="hljs-params">        <span class="hljs-type">int</span> resultCode, String dataStr, Bundle extras, <span class="hljs-type">boolean</span> ordered,</span><br><span class="hljs-params">        <span class="hljs-type">boolean</span> sticky, <span class="hljs-type">int</span> sendingUser, <span class="hljs-type">int</span> processState)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>    updateProcessState(processState, <span class="hljs-literal">false</span>);<br>    receiver.performReceive(intent, resultCode, dataStr, extras, ordered,<br>            sticky, sendingUser);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>InnerReceiver</code>çš„<code>performReceive</code>æ–¹æ³•ä¼šè°ƒç”¨<code>LoadedApk.ReceiverDispatcher</code>çš„<code>performReceive</code>æ–¹æ³•ï¼Œ<code>LoadedApk.ReceiverDispatcher</code>çš„<code>performReceive</code>æ–¹æ³•çš„å®ç°å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">performReceive</span><span class="hljs-params">(Intent intent, <span class="hljs-type">int</span> resultCode, String data,Bundle extras, <span class="hljs-type">boolean</span> ordered, <span class="hljs-type">boolean</span> sticky, <span class="hljs-type">int</span> sendingUser)</span> &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">Args</span> <span class="hljs-variable">args</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Args</span>(intent, resultCode, data, extras, ordered,<br>            sticky, sendingUser);<br>    <span class="hljs-keyword">if</span> (intent == <span class="hljs-literal">null</span>) &#123;<br>        Log.wtf(TAG, <span class="hljs-string">&quot;Null intent received&quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">if</span> (ActivityThread.DEBUG_BROADCAST) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">seq</span> <span class="hljs-operator">=</span> intent.getIntExtra(<span class="hljs-string">&quot;seq&quot;</span>, -<span class="hljs-number">1</span>);<br>            Slog.i(ActivityThread.TAG, <span class="hljs-string">&quot;Enqueueing broadcast &quot;</span> + intent.getAction()<br>                    + <span class="hljs-string">&quot; seq=&quot;</span> + seq + <span class="hljs-string">&quot; to &quot;</span> + mReceiver);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (intent == <span class="hljs-literal">null</span> || !mActivityThread.post(args.getRunnable())) &#123;<br>        <span class="hljs-keyword">if</span> (mRegistered &amp;&amp; ordered) &#123;<br>            <span class="hljs-type">IActivityManager</span> <span class="hljs-variable">mgr</span> <span class="hljs-operator">=</span> ActivityManager.getService();<br>            <span class="hljs-keyword">if</span> (ActivityThread.DEBUG_BROADCAST) Slog.i(ActivityThread.TAG,<br>                    <span class="hljs-string">&quot;Finishing sync broadcast to &quot;</span> + mReceiver);<br>            args.sendFinished(mgr);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä¼šåˆ›å»ºä¸€ä¸ªArgså¯¹è±¡å¹¶é€šè¿‡mActivityThreadçš„postæ–¹æ³•æ¥æ‰§è¡ŒArgsä¸­çš„é€»è¾‘ï¼Œè€ŒArgså®ç°äº†Runnableæ¥å£ã€‚mActivityThreadæ˜¯ä¸€ä¸ªHandlerï¼Œå®ƒå…¶å®å°±æ˜¯ActivityThreadä¸­çš„mHï¼ŒmHçš„ç±»å‹æ˜¯ActivityThreadçš„å†…éƒ¨ç±»Hã€‚åœ¨Argsçš„runæ–¹æ³•ä¸­æœ‰å¦‚ä¸‹å‡ è¡Œä»£ç :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">BroadcastReceiver</span> <span class="hljs-variable">receiver</span> <span class="hljs-operator">=</span> mReceiver;<br><span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">ordered</span> <span class="hljs-operator">=</span> mOrdered;<br>receiver.setPendingResult(<span class="hljs-built_in">this</span>);<br>receiver.onReceive(mContext, intent);<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™BroadcastReceiverçš„onReceiveæ–¹æ³•è¢«æ‰§è¡Œäº†ï¼Œä¹Ÿå°±æ˜¯è¯´åº”ç”¨å·²ç»æ¥æ”¶åˆ°å¹¿æ’­äº†ï¼ŒåŒæ—¶onReceiveæ–¹æ³•æ˜¯åœ¨å¹¿æ’­æ¥æ”¶è€…çš„ä¸»çº¿ç¨‹ä¸­è¢«è°ƒç”¨çš„ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Viewç»˜åˆ¶è¿‡ç¨‹</title>
    <link href="/2018/07/29/View%E7%BB%98%E5%88%B6%E8%BF%87%E7%A8%8B/"/>
    <url>/2018/07/29/View%E7%BB%98%E5%88%B6%E8%BF%87%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<p>æŠ„çš„ã€ŠAndroidå¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹ç¬¬å››ç« <br><code>ViewRoot</code>å¯¹åº”äº<code>ViewRootImpl</code>ç±»ï¼Œå®ƒæ˜¯è¿æ¥<code>WindowManager</code>å’Œ<code>DecorView</code>çš„çº½å¸¦ï¼Œ<code>View</code>çš„ä¸‰å¤§æµç¨‹å‡æ˜¯é€šè¿‡<code>ViewRoot</code>æ¥å®Œæˆçš„ã€‚åœ¨<code>ActivityThread</code>ä¸­ï¼Œå½“<code>Activity</code>å¯¹è±¡è¢«åˆ›å»ºå®Œæ¯•åï¼Œä¼šå°†<code>DecorView</code>æ·»åŠ åˆ°<code>Window</code>ä¸­ï¼ŒåŒæ—¶ä¼šåˆ›å»º<code>ViewRootImpl</code>å¯¹è±¡ï¼Œå¹¶å°†<code>ViewRootImpl</code>å¯¹è±¡å’Œ<code>DecorView</code>å»ºç«‹å…³è”ï¼Œ<code>View</code>çš„ç»˜åˆ¶æµç¨‹æ˜¯ä»<code>ViewRoot</code>çš„<code>performTraversals</code>æ–¹æ³•å¼€å§‹çš„ï¼Œå®ƒç»è¿‡<code>measure</code>ã€<code>layout</code>å’Œ<code>draw</code>ä¸‰ä¸ªè¿‡ç¨‹æ‰èƒ½æœ€ç»ˆå°†ä¸€ä¸ª<code>View</code>ç»˜åˆ¶å‡ºæ¥ï¼Œå…¶ä¸­<code>measure</code>ç”¨æ¥æµ‹é‡Viewçš„å®½å’Œé«˜ï¼Œ<code>layout</code>ç”¨æ¥ç¡®å®šViewåœ¨çˆ¶å®¹å™¨ä¸­çš„æ”¾ç½®ä½ç½®ï¼Œè€Œ<code>draw</code>åˆ™è´Ÿè´£å°†Viewç»˜åˆ¶åœ¨å±å¹•ä¸Šã€‚</p><span id="more"></span><p><code>performTraversals</code>ä¼šä¾æ¬¡è°ƒç”¨<code>performMeasure</code>ã€p<code>erformLayout</code>å’Œ<code>performDraw</code>ä¸‰ä¸ªæ–¹æ³•ï¼Œè¿™ä¸‰ä¸ªæ–¹æ³•åˆ†åˆ«å®Œæˆé¡¶çº§<code>View</code>çš„<code>measure</code>ã€<code>layout</code>å’Œ<code>draw</code>è¿™ä¸‰å¤§æµç¨‹ï¼Œå…¶ä¸­åœ¨<code>performMeasure</code>ä¸­ä¼šè°ƒç”¨<code>measure</code>æ–¹æ³•ï¼Œåœ¨<code>measure</code>æ–¹æ³•ä¸­åˆä¼šè°ƒç”¨<code>onMeasure</code>æ–¹æ³•ï¼Œåœ¨<code>onMeasure</code>æ–¹æ³•ä¸­åˆ™ä¼šå¯¹æ‰€æœ‰çš„å­å…ƒç´ è¿›è¡Œ<code>measure</code>è¿‡ç¨‹ï¼Œè¿™ä¸ªæ—¶å€™<code>measure</code>æµç¨‹å°±ä»çˆ¶å®¹å™¨ä¼ é€’åˆ°å­å…ƒç´ ä¸­äº†ï¼Œè¿™æ ·å°±å®Œæˆäº†ä¸€æ¬¡<code>measure</code>è¿‡ç¨‹ã€‚æ¥ç€å­å…ƒç´ ä¼šé‡å¤çˆ¶å®¹å™¨çš„<code>measure</code>è¿‡ç¨‹ï¼Œå¦‚æ­¤åå¤å°±å®Œæˆäº†æ•´ä¸ª<code>View</code>æ ‘çš„éå†ã€‚åŒç†ï¼Œ<code>performLayout</code>å’Œ<code>performDraw</code>çš„ä¼ é€’æµç¨‹å’Œ<code>performMeasure</code>æ˜¯ç±»ä¼¼çš„ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œ<code>performDraw</code>çš„ä¼ é€’è¿‡ç¨‹æ˜¯åœ¨<code>draw</code>æ–¹æ³•ä¸­é€šè¿‡<code>dispatchDraw</code>æ¥å®ç°çš„ï¼Œä¸è¿‡è¿™å¹¶æ²¡æœ‰æœ¬è´¨åŒºåˆ«ã€‚</p><p><code>measure</code>è¿‡ç¨‹å†³å®šäº†<code>View</code>çš„å®½&#x2F;é«˜ï¼Œ<code>Measure</code>å®Œæˆä»¥åï¼Œå¯ä»¥é€šè¿‡<code>getMeasuredWidth</code>å’Œ<code>getMeasuredHeight</code>æ–¹æ³•æ¥è·å–åˆ°<code>View</code>æµ‹é‡åçš„å®½&#x2F;é«˜ï¼Œåœ¨å‡ ä¹æ‰€æœ‰çš„æƒ…å†µä¸‹å®ƒéƒ½ç­‰åŒäº<code>View</code>æœ€ç»ˆçš„å®½&#x2F;é«˜ï¼Œä½†æ˜¯ç‰¹æ®Šæƒ…å†µé™¤å¤–ï¼Œè¿™ç‚¹åœ¨æœ¬ç« åé¢ä¼šè¿›è¡Œè¯´æ˜ã€‚<code>Layout</code>è¿‡ç¨‹å†³å®šäº†<code>View</code>çš„å››ä¸ªé¡¶ç‚¹çš„åæ ‡å’Œå®é™…çš„Viewçš„å®½&#x2F;é«˜ï¼Œå®Œæˆä»¥åï¼Œå¯ä»¥é€šè¿‡<code>getTop</code>ã€<code>getBottom</code>ã€<code>getLeft</code>å’Œ<code>getRight</code>æ¥æ‹¿åˆ°<code>View</code>çš„å››ä¸ªé¡¶ç‚¹çš„ä½ç½®ï¼Œå¹¶å¯ä»¥é€šè¿‡<code>getWidth</code>å’Œ<code>getHeight</code>æ–¹æ³•æ¥æ‹¿åˆ°<code>View</code>çš„æœ€ç»ˆå®½&#x2F;é«˜ã€‚<code>Draw</code>è¿‡ç¨‹åˆ™å†³å®šäº†<code>View</code>çš„æ˜¾ç¤ºï¼Œåªæœ‰<code>draw</code>æ–¹æ³•å®Œæˆä»¥å<code>View</code>çš„å†…å®¹æ‰èƒ½å‘ˆç°åœ¨å±å¹•ä¸Šã€‚</p><p><code>DecorView</code>ä½œä¸ºé¡¶çº§<code>View</code>ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å®ƒå†…éƒ¨ä¼šåŒ…å«ä¸€ä¸ªç«–ç›´æ–¹å‘çš„<code>LinearLayout</code>ï¼Œåœ¨è¿™ä¸ª<code>LinearLayout</code>é‡Œé¢æœ‰ä¸Šä¸‹ä¸¤ä¸ªéƒ¨åˆ†ï¼ˆå…·ä½“æƒ…å†µå’ŒAndroidç‰ˆæœ¬åŠä¸»é¢˜æœ‰å…³ï¼‰ï¼Œä¸Šé¢æ˜¯æ ‡é¢˜æ ï¼Œä¸‹é¢æ˜¯å†…å®¹æ ã€‚åœ¨<code>Activity</code>ä¸­æˆ‘ä»¬é€šè¿‡<code>setContentView</code>æ‰€è®¾ç½®çš„å¸ƒå±€æ–‡ä»¶å…¶å®å°±æ˜¯è¢«åŠ åˆ°å†…å®¹æ ä¹‹ä¸­çš„ï¼Œè€Œå†…å®¹æ çš„idæ˜¯<code>content</code>ï¼Œå› æ­¤å¯ä»¥ç†è§£ä¸ºActivityæŒ‡å®šå¸ƒå±€çš„æ–¹æ³•ä¸å«setviewè€Œå«<code>setContentView</code>ï¼Œå› ä¸ºæˆ‘ä»¬çš„å¸ƒå±€çš„ç¡®åŠ åˆ°äº†<code>id</code>ä¸º<code>content</code>çš„<code>FrameLayout</code>ä¸­ã€‚å¦‚ä½•å¾—åˆ°<code>content</code>å‘¢ï¼Ÿå¯ä»¥è¿™æ ·ï¼š<code>ViewGroup  content=  findViewById(R.android.id.content)</code>ã€‚å¦‚ä½•å¾—åˆ°æˆ‘ä»¬è®¾ç½®çš„<code>View</code>å‘¢ï¼Ÿå¯ä»¥è¿™æ ·ï¼š<code>content.getChildAt(0)</code>ã€‚åŒæ—¶ï¼Œé€šè¿‡æºç æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œ<code>DecorView</code>å…¶å®æ˜¯ä¸€ä¸ª<code>FrameLayout</code>ï¼Œ<code>View</code>å±‚çš„äº‹ä»¶éƒ½å…ˆç»è¿‡<code>DecorView</code>ï¼Œç„¶åæ‰ä¼ é€’ç»™æˆ‘ä»¬çš„Viewã€‚</p><h4 id="MeasureSpec"><a href="#MeasureSpec" class="headerlink" title="MeasureSpec"></a>MeasureSpec</h4><p><code>MeasureSpec</code>åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå†³å®šäº†ä¸€ä¸ªViewçš„å°ºå¯¸è§„æ ¼ï¼Œä¹‹æ‰€ä»¥è¯´æ˜¯å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯å› ä¸ºè¿™ä¸ªè¿‡ç¨‹è¿˜å—çˆ¶å®¹å™¨çš„å½±å“ï¼Œå› ä¸ºçˆ¶å®¹å™¨å½±å“Viewçš„<code>MeasureSpec</code>çš„åˆ›å»ºè¿‡ç¨‹ã€‚åœ¨æµ‹é‡è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿä¼šå°†Viewçš„<code>LayoutParams</code>æ ¹æ®çˆ¶å®¹å™¨æ‰€æ–½åŠ çš„è§„åˆ™è½¬æ¢æˆå¯¹åº”çš„<code>MeasureSpec</code>ï¼Œç„¶åå†æ ¹æ®è¿™ä¸ª<code>measureSpec</code>æ¥æµ‹é‡å‡º<code>View</code>çš„å®½&#x2F;é«˜ã€‚è¿™é‡Œçš„å®½&#x2F;é«˜æ˜¯æµ‹é‡å®½&#x2F;é«˜ï¼Œä¸ä¸€å®šç­‰äº<code>View</code>çš„æœ€ç»ˆå®½&#x2F;é«˜ã€‚<br><code>MeasureSpec</code>ä»£è¡¨ä¸€ä¸ª32ä½intå€¼ï¼Œé«˜2ä½ä»£è¡¨<code>SpecMode</code>ï¼Œä½30ä½ä»£è¡¨<code>SpecSize</code>ï¼Œ<code>SpecMode</code>æ˜¯æŒ‡æµ‹é‡æ¨¡å¼ï¼Œè€Œ<code>SpecSize</code>æ˜¯æŒ‡åœ¨æŸç§æµ‹é‡æ¨¡å¼ä¸‹çš„è§„æ ¼å¤§å°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MODE_SHIFT</span> <span class="hljs-operator">=</span> <span class="hljs-number">30</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MODE_MASK</span> <span class="hljs-operator">=</span> <span class="hljs-number">0x3</span> &lt;&lt; MODE_SHIFT;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">UNSPECIFIED</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span> &lt;&lt; MODE_SHIFT;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">EXACTLY</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span> &lt;&lt; MODE_SHIFT;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">AT_MOST</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span> &lt;&lt; MODE_SHIFT;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">makeMeasureSpec</span><span class="hljs-params">(<span class="hljs-type">int</span> size,<span class="hljs-type">int</span> mode)</span> &#123;<br>    <span class="hljs-keyword">if</span> (sUseBrokenMakeMeasureSpec) &#123;<br>        <span class="hljs-keyword">return</span> size + mode;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> (size &amp; ~MODE_MASK) | (mode &amp; MODE_MASK);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getMode</span><span class="hljs-params">(<span class="hljs-type">int</span> measureSpec)</span> &#123;<br>    <span class="hljs-keyword">return</span> (measureSpec &amp; MODE_MASK);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getSize</span><span class="hljs-params">(<span class="hljs-type">int</span> measureSpec)</span> &#123;<br>    <span class="hljs-keyword">return</span> (measureSpec &amp; ~MODE_MASK);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>MeasureSpec</code>é€šè¿‡å°†<code>SpecMode</code>å’Œ<code>SpecSize</code>æ‰“åŒ…æˆä¸€ä¸ªintå€¼æ¥é¿å…è¿‡å¤šçš„å¯¹è±¡å†…å­˜åˆ†é…ï¼Œä¸ºäº†æ–¹ä¾¿æ“ä½œï¼Œå…¶æä¾›äº†æ‰“åŒ…å’Œè§£åŒ…æ–¹æ³•ã€‚<code>SpecMode</code>å’Œ<code>SpecSize</code>ä¹Ÿæ˜¯ä¸€ä¸ªintå€¼ï¼Œä¸€ç»„<code>SpecMode</code>å’Œ<code>SpecSize</code>å¯ä»¥æ‰“åŒ…ä¸ºä¸€ä¸ª<code>MeasureSpec</code>ï¼Œè€Œä¸€ä¸ª<code>MeasureSpec</code>å¯ä»¥é€šè¿‡è§£åŒ…çš„å½¢å¼æ¥å¾—å‡ºå…¶åŸå§‹çš„<code>SpecMode</code>å’Œ<code>SpecSize</code>ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œæåˆ°çš„<code>MeasureSpec</code>æ˜¯æŒ‡<code>MeasureSpec</code>æ‰€ä»£è¡¨çš„intå€¼ï¼Œè€Œå¹¶é<code>MeasureSpec</code>æœ¬èº«ã€‚<br>SpecModeæœ‰ä¸‰ç±»ï¼Œæ¯ä¸€ç±»éƒ½è¡¨ç¤ºç‰¹æ®Šçš„å«ä¹‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚<br>** UNSPECIFIED **<br>çˆ¶å®¹å™¨ä¸å¯¹Viewæœ‰ä»»ä½•é™åˆ¶ï¼Œè¦å¤šå¤§ç»™å¤šå¤§ï¼Œè¿™ç§æƒ…å†µä¸€èˆ¬ç”¨äºç³»ç»Ÿå†…éƒ¨ï¼Œè¡¨ç¤ºä¸€ç§æµ‹é‡çš„çŠ¶æ€ã€‚<br>** EXACTLY **<br>çˆ¶å®¹å™¨å·²ç»æ£€æµ‹å‡ºViewæ‰€éœ€è¦çš„ç²¾ç¡®å¤§å°ï¼Œè¿™ä¸ªæ—¶å€™Viewçš„æœ€ç»ˆå¤§å°å°±æ˜¯SpecSizeæ‰€æŒ‡å®šçš„å€¼ã€‚å®ƒå¯¹åº”äºLayoutParamsä¸­çš„match_parentå’Œå…·ä½“çš„æ•°å€¼è¿™ä¸¤ç§æ¨¡å¼ã€‚<br>** AT_MOST **<br>çˆ¶å®¹å™¨æŒ‡å®šäº†ä¸€ä¸ªå¯ç”¨å¤§å°å³SpecSizeï¼ŒViewçš„å¤§å°ä¸èƒ½å¤§äºè¿™ä¸ªå€¼ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆå€¼è¦çœ‹ä¸åŒViewçš„å…·ä½“å®ç°ã€‚å®ƒå¯¹åº”äºLayoutParamsä¸­çš„wrap_contentã€‚</p><h6 id="MeasureSpecå’ŒLayoutParams"><a href="#MeasureSpecå’ŒLayoutParams" class="headerlink" title="MeasureSpecå’ŒLayoutParams"></a>MeasureSpecå’ŒLayoutParams</h6><p>åœ¨Viewæµ‹é‡çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šå°†<code>LayoutParams</code>åœ¨çˆ¶å®¹å™¨çš„çº¦æŸä¸‹è½¬æ¢æˆå¯¹åº”çš„<code>MeasureSpec</code>ï¼Œç„¶åå†æ ¹æ®è¿™ä¸ª<code>MeasureSpec</code>æ¥ç¡®å®šViewæµ‹é‡åçš„å®½&#x2F;é«˜ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>MeasureSpec</code>ä¸æ˜¯å”¯ä¸€ç”±<code>LayoutParams</code>å†³å®šçš„ï¼Œ<code>LayoutParams</code>éœ€è¦å’Œçˆ¶å®¹å™¨ä¸€èµ·æ‰èƒ½å†³å®š<code>View</code>çš„<code>MeasureSpec</code>ï¼Œä»è€Œè¿›ä¸€æ­¥å†³å®šViewçš„å®½&#x2F;é«˜ã€‚å¦å¤–ï¼Œå¯¹äº<code>é¡¶çº§View</code>ï¼ˆå³DecorViewï¼‰å’Œ<code>æ™®é€šView</code>æ¥è¯´ï¼Œ<code>MeasureSpec</code>çš„è½¬æ¢è¿‡ç¨‹ç•¥æœ‰ä¸åŒã€‚å¯¹äº<code>DecorView</code>ï¼Œå…¶<code>MeasureSpec</code>ç”±çª—å£çš„å°ºå¯¸å’Œå…¶è‡ªèº«çš„<code>LayoutParams</code>æ¥å…±åŒç¡®å®šï¼›å¯¹äºæ™®é€šViewï¼Œå…¶<code>MeasureSpec</code>ç”±çˆ¶å®¹å™¨çš„<code>MeasureSpec</code>å’Œè‡ªèº«çš„<code>LayoutParams</code>æ¥å…±åŒå†³å®šï¼Œ<code>MeasureSpec</code>ä¸€æ—¦ç¡®å®šåï¼Œ<code>onMeasure</code>ä¸­å°±å¯ä»¥ç¡®å®š<code>View</code>çš„æµ‹é‡å®½&#x2F;é«˜ã€‚<br>å¯¹äº<code>DecorView</code>æ¥è¯´ï¼Œåœ¨<code>ViewRootImpl</code>ä¸­çš„<code>measureHierarchy</code>æ–¹æ³•ä¸­æœ‰å¦‚ä¸‹ä¸€æ®µä»£ç ï¼Œå®ƒå±•ç¤ºäº†<code>DecorView</code>çš„<code>MeasureSpec</code>çš„åˆ›å»ºè¿‡ç¨‹ï¼Œå…¶ä¸­<code>desiredWindowWidth</code>å’Œ<code>desiredWindowHeight</code>æ˜¯å±å¹•çš„å°ºå¯¸:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java">childWidthMeasureSpec = getRootMeasureSpec(desiredWindowWidth,lp.width);<br>childHeightMeasureSpec = getRootMeasureSpec(desiredWindowHeight,lp.height);<br>performMeasure(childWidthMeasureSpec,childHeightMeasureSpec);<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getRootMeasureSpec</span><span class="hljs-params">(<span class="hljs-type">int</span> windowSize,<span class="hljs-type">int</span> rootDimension)</span> &#123;<br>    <span class="hljs-type">int</span> measureSpec;<br>    <span class="hljs-keyword">switch</span> (rootDimension) &#123;<br>        <span class="hljs-keyword">case</span> ViewGroup.LayoutParams.MATCH_PARENT:<br>            <span class="hljs-comment">// Window can&#x27;t resize. Force root view to be windowSize.</span><br>            measureSpec = MeasureSpec.makeMeasureSpec(windowSize,MeasureSpec.EXACTLY);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> ViewGroup.LayoutParams.WRAP_CONTENT:<br>            <span class="hljs-comment">// Window can resize. Set max size for root view.</span><br>            measureSpec = MeasureSpec.makeMeasureSpec(windowSize,MeasureSpec.AT_MOST);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-comment">// Window wants to be an exact size. Force root view to be that size.</span><br>            measureSpec = MeasureSpec.makeMeasureSpec(rootDimension,Measure-Spec.EXACTLY);<br>            <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> measureSpec;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šè¿°ä»£ç ï¼Œ<code>DecorView</code>çš„<code>MeasureSpec</code>çš„äº§ç”Ÿè¿‡ç¨‹å°±å¾ˆæ˜ç¡®äº†ï¼Œå…·ä½“æ¥è¯´å…¶éµå®ˆå¦‚ä¸‹è§„åˆ™ï¼Œæ ¹æ®å®ƒçš„<code>LayoutParams</code>ä¸­çš„å®½&#x2F;é«˜çš„å‚æ•°æ¥åˆ’åˆ†ã€‚</p><ul><li>LayoutParams.MATCH_PARENTï¼šç²¾ç¡®æ¨¡å¼ï¼Œå¤§å°å°±æ˜¯çª—å£çš„å¤§å°ï¼›</li><li>LayoutParams.WRAP_CONTENTï¼šæœ€å¤§æ¨¡å¼ï¼Œå¤§å°ä¸å®šï¼Œä½†æ˜¯ä¸èƒ½è¶…è¿‡çª—å£çš„å¤§å°ï¼›</li><li>å›ºå®šå¤§å°ï¼ˆæ¯”å¦‚100dpï¼‰ï¼šç²¾ç¡®æ¨¡å¼ï¼Œå¤§å°ä¸ºLayoutParamsä¸­æŒ‡å®šçš„å¤§å°ã€‚<br>å¯¹äºæ™®é€š<code>View</code>æ¥è¯´ï¼Œè¿™é‡Œæ˜¯æŒ‡æˆ‘ä»¬å¸ƒå±€ä¸­çš„<code>View</code>ï¼Œ<code>View</code>çš„<code>measure</code>è¿‡ç¨‹ç”±<code>ViewGroup</code>ä¼ é€’è€Œæ¥ï¼Œå…ˆçœ‹ä¸€ä¸‹<code>ViewGroup</code>çš„<code>measureChildWithMargins</code>æ–¹æ³•ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">measureChildWithMargins</span><span class="hljs-params">(View child,<span class="hljs-type">int</span> parentWidthMeasureSpec,<span class="hljs-type">int</span> widthUsed,<span class="hljs-type">int</span> parentHeightMeasureSpec,<span class="hljs-type">int</span> heightUsed)</span> &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">MarginLayoutParams</span> <span class="hljs-variable">lp</span> <span class="hljs-operator">=</span> (MarginLayoutParams) child.getLayout-Params();<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">childWidthMeasureSpec</span> <span class="hljs-operator">=</span> getChildMeasureSpec(parentWidthMeasureSpec,mPaddingLeft + mPaddingRight + lp.leftMargin + lp.rightMargin+ widthUsed,lp.width);<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">childHeightMeasureSpec</span> <span class="hljs-operator">=</span> getChildMeasureSpec(parentHeight-MeasureSpec,mPaddingTop + mPaddingBottom + lp.topMargin + lp.bottomMargin+ heightUsed,lp.height);<br>    child.measure(childWidthMeasureSpec,childHeightMeasureSpec);<br>&#125;<br></code></pre></td></tr></table></figure>ä¸Šè¿°æ–¹æ³•ä¼šå¯¹å­å…ƒç´ è¿›è¡Œ<code>measure</code>ï¼Œåœ¨è°ƒç”¨å­å…ƒç´ çš„<code>measure</code>æ–¹æ³•ä¹‹å‰ä¼šå…ˆé€šè¿‡<code>getChildMeasureSpec</code>æ–¹æ³•æ¥å¾—åˆ°å­å…ƒç´ çš„<code>MeasureSpec</code>ã€‚ä»ä»£ç æ¥çœ‹ï¼Œå¾ˆæ˜¾ç„¶ï¼Œå­å…ƒç´ çš„<code>MeasureSpec</code>çš„åˆ›å»ºä¸çˆ¶å®¹å™¨çš„<code>MeasureSpec</code>å’Œå­å…ƒç´ æœ¬èº«çš„<code>LayoutParam</code>sæœ‰å…³ï¼Œæ­¤å¤–è¿˜å’Œ<code>View</code>çš„<code>margin</code>åŠ<code>padding</code>æœ‰å…³ï¼Œå…·ä½“æƒ…å†µå¯ä»¥çœ‹ä¸€ä¸‹<code>ViewGroup</code>çš„<code>getChildMeasureSpec</code>æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤º:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getChildMeasureSpec</span><span class="hljs-params">(<span class="hljs-type">int</span> spec,<span class="hljs-type">int</span> padding,<span class="hljs-type">int</span> child-Dimension)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">specMode</span> <span class="hljs-operator">=</span> MeasureSpec.getMode(spec);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">specSize</span> <span class="hljs-operator">=</span> MeasureSpec.getSize(spec);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> Math.max(<span class="hljs-number">0</span>,specSize -padding);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">resultSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">resultMode</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">switch</span> (specMode) &#123;<br>        <span class="hljs-comment">// Parent has imposed an exact size on us</span><br>        <span class="hljs-keyword">case</span> MeasureSpec.EXACTLY:<br>            <span class="hljs-keyword">if</span> (childDimension =&gt; <span class="hljs-number">0</span>) &#123;<br>                resultSize = childDimension;<br>                resultMode = MeasureSpec.EXACTLY;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (childDimension == LayoutParams.MATCH_PARENT) &#123;<br>                <span class="hljs-comment">// Child wants to be our size. So be it.</span><br>                resultSize = size;<br>                resultMode = MeasureSpec.EXACTLY;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (childDimension == LayoutParams.WRAP_CONTENT) &#123;<br>                <span class="hljs-comment">// Child wants to determine its own size. It can&#x27;t be</span><br>                <span class="hljs-comment">// bigger than us.</span><br>                resultSize = size;<br>                resultMode = MeasureSpec.AT_MOST;<br>            &#125;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-comment">// Parent has imposed a maximum size on us</span><br>        <span class="hljs-keyword">case</span> MeasureSpec.AT_MOST:<br>            <span class="hljs-keyword">if</span> (childDimension =&gt; <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-comment">// Child wants a specific size... so be it</span><br>                resultSize = childDimension;<br>                resultMode = MeasureSpec.EXACTLY;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (childDimension == LayoutParams.MATCH_PARENT) &#123;<br>                <span class="hljs-comment">// Child wants to be our size,but our size is not fixed.</span><br>                <span class="hljs-comment">// Constrain child to not be bigger than us.</span><br>                resultSize = size;<br>                resultMode = MeasureSpec.AT_MOST;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (childDimension == LayoutParams.WRAP_CONTENT) &#123;<br>                <span class="hljs-comment">// Child wants to determine its own size. It can&#x27;t be</span><br>                <span class="hljs-comment">// bigger than us.</span><br>                resultSize = size;<br>                resultMode = MeasureSpec.AT_MOST;<br>            &#125;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-comment">// Parent asked to see how big we want to be</span><br>        <span class="hljs-keyword">case</span> MeasureSpec.UNSPECIFIED:<br>            <span class="hljs-keyword">if</span> (childDimension =&gt; <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-comment">// Child wants a specific size... let him have it</span><br>                resultSize = childDimension;<br>                resultMode = MeasureSpec.EXACTLY;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (childDimension == LayoutParams.MATCH_PARENT) &#123;<br>                <span class="hljs-comment">// Child wants to be our size... find out how big it should</span><br>                <span class="hljs-comment">// be</span><br>                resultSize = <span class="hljs-number">0</span>;<br>                resultMode = MeasureSpec.UNSPECIFIED;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (childDimension == LayoutParams.WRAP_CONTENT) &#123;<br>                <span class="hljs-comment">// Child wants to determine its own size.... find out how</span><br>                <span class="hljs-comment">// big it should be</span><br>                resultSize = <span class="hljs-number">0</span>;<br>                resultMode = MeasureSpec.UNSPECIFIED;<br>            &#125;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    <span class="hljs-keyword">return</span> MeasureSpec.makeMeasureSpec(resultSize,resultMode);<br>&#125;<br></code></pre></td></tr></table></figure>å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯æ ¹æ®çˆ¶å®¹å™¨çš„<code>MeasureSpec</code>åŒæ—¶ç»“åˆViewæœ¬èº«çš„<code>LayoutParams</code>æ¥ç¡®å®šå­å…ƒç´ çš„<code>MeasureSpec</code>ï¼Œå‚æ•°ä¸­çš„<code>padding</code>æ˜¯æŒ‡çˆ¶å®¹å™¨ä¸­å·²å ç”¨çš„ç©ºé—´å¤§å°ï¼Œå› æ­¤å­å…ƒç´ å¯ç”¨çš„å¤§å°ä¸ºçˆ¶å®¹å™¨çš„å°ºå¯¸å‡å»<code>padding</code>ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹æ‰€ç¤º:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">specSize</span> <span class="hljs-operator">=</span> MeasureSpec.getSize(spec);<br><span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> Math.max(<span class="hljs-number">0</span>,specSize -padding);<br></code></pre></td></tr></table></figure>è¿™é‡Œç®€å•è¯´ä¸€ä¸‹ï¼Œå½“Viewé‡‡ç”¨å›ºå®šå®½&#x2F;é«˜çš„æ—¶å€™ï¼Œä¸ç®¡çˆ¶å®¹å™¨çš„<code>MeasureSpec</code>æ˜¯ä»€ä¹ˆï¼Œ<code>View</code>çš„<code>MeasureSpec</code>éƒ½æ˜¯ç²¾ç¡®æ¨¡å¼å¹¶ä¸”å…¶å¤§å°éµå¾ª<code>Layoutparams</code>ä¸­çš„å¤§å°ã€‚å½“<code>View</code>çš„å®½&#x2F;é«˜æ˜¯<code>match_parent</code>æ—¶ï¼Œå¦‚æœçˆ¶å®¹å™¨çš„æ¨¡å¼æ˜¯ç²¾å‡†æ¨¡å¼ï¼Œé‚£ä¹ˆ<code>View</code>ä¹Ÿæ˜¯ç²¾å‡†æ¨¡å¼å¹¶ä¸”å…¶å¤§å°æ˜¯çˆ¶å®¹å™¨çš„å‰©ä½™ç©ºé—´ï¼›å¦‚æœçˆ¶å®¹å™¨æ˜¯æœ€å¤§æ¨¡å¼ï¼Œé‚£ä¹ˆ<code>View</code>ä¹Ÿæ˜¯æœ€å¤§æ¨¡å¼å¹¶ä¸”å…¶å¤§å°ä¸ä¼šè¶…è¿‡çˆ¶å®¹å™¨çš„å‰©ä½™ç©ºé—´ã€‚å½“<code>View</code>çš„å®½&#x2F;é«˜æ˜¯<code>wrap_content</code>æ—¶ï¼Œä¸ç®¡çˆ¶å®¹å™¨çš„æ¨¡å¼æ˜¯ç²¾å‡†è¿˜æ˜¯æœ€å¤§åŒ–ï¼Œ<code>View</code>çš„æ¨¡å¼æ€»æ˜¯æœ€å¤§åŒ–å¹¶ä¸”å¤§å°ä¸èƒ½è¶…è¿‡çˆ¶å®¹å™¨çš„å‰©ä½™ç©ºé—´ã€‚åœ¨æˆ‘ä»¬çš„åˆ†æä¸­æ¼æ‰äº†<code>UNSPECIFIED</code>æ¨¡å¼ï¼Œé‚£æ˜¯å› ä¸ºè¿™ä¸ªæ¨¡å¼ä¸»è¦ç”¨äºç³»ç»Ÿå†…éƒ¨å¤šæ¬¡Measureçš„æƒ…å½¢ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³æ³¨æ­¤æ¨¡å¼ã€‚</li></ul><h4 id="Viewçš„å·¥ä½œæµç¨‹"><a href="#Viewçš„å·¥ä½œæµç¨‹" class="headerlink" title="Viewçš„å·¥ä½œæµç¨‹"></a>Viewçš„å·¥ä½œæµç¨‹</h4><h5 id="measureè¿‡ç¨‹"><a href="#measureè¿‡ç¨‹" class="headerlink" title="measureè¿‡ç¨‹"></a>measureè¿‡ç¨‹</h5><p>measureè¿‡ç¨‹è¦åˆ†æƒ…å†µæ¥çœ‹ï¼Œå¦‚æœåªæ˜¯ä¸€ä¸ªåŸå§‹çš„<code>View</code>ï¼Œé‚£ä¹ˆé€šè¿‡<code>measure</code>æ–¹æ³•å°±å®Œæˆäº†å…¶æµ‹é‡è¿‡ç¨‹ï¼Œå¦‚æœæ˜¯ä¸€ä¸ª<code>ViewGroup</code>ï¼Œé™¤äº†å®Œæˆè‡ªå·±çš„æµ‹é‡è¿‡ç¨‹å¤–ï¼Œè¿˜ä¼šéå†å»è°ƒç”¨æ‰€æœ‰å­å…ƒç´ çš„<code>measure</code>æ–¹æ³•ï¼Œå„ä¸ªå­å…ƒç´ å†é€’å½’å»æ‰§è¡Œè¿™ä¸ªæµç¨‹ã€‚<br>** Viewçš„measureè¿‡ç¨‹ **<br><code>View</code>çš„<code>measure</code>è¿‡ç¨‹ç”±å…¶<code>measure</code>æ–¹æ³•æ¥å®Œæˆï¼Œ<code>measure</code>æ–¹æ³•æ˜¯ä¸€ä¸ª<code>final</code>ç±»å‹çš„æ–¹æ³•ï¼Œè¿™æ„å‘³ç€å­ç±»ä¸èƒ½é‡å†™æ­¤æ–¹æ³•ï¼Œåœ¨<code>View</code>çš„<code>measure</code>æ–¹æ³•ä¸­ä¼šå»è°ƒç”¨<code>View</code>çš„<code>onMeasure</code>æ–¹æ³•ï¼Œå› æ­¤åªéœ€è¦çœ‹<code>onMeasure</code>çš„å®ç°å³å¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMeasure</span><span class="hljs-params">(<span class="hljs-type">int</span> widthMeasureSpec,<span class="hljs-type">int</span> heightMeasureSpec)</span> &#123;<br>    setMeasuredDimension(getDefaultSize(getSuggestedMinimumWidth(),widthMeasureSpec),getDefaultSize(getSuggestedMinimumHeight(),heightMeasureSpec));<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getDefaultSize</span><span class="hljs-params">(<span class="hljs-type">int</span> size,<span class="hljs-type">int</span> measureSpec)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> size;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">specMode</span> <span class="hljs-operator">=</span> MeasureSpec.getMode(measureSpec);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">specSize</span> <span class="hljs-operator">=</span> MeasureSpec.getSize(measureSpec);<br>    <span class="hljs-keyword">switch</span> (specMode) &#123;<br>        <span class="hljs-keyword">case</span> MeasureSpec.UNSPECIFIED:<br>            result = size;<br>        <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> MeasureSpec.AT_MOST:<br>        <span class="hljs-keyword">case</span> MeasureSpec.EXACTLY:<br>            result = specSize;<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œ<code>getDefaultSize</code>è¿™ä¸ªæ–¹æ³•çš„é€»è¾‘å¾ˆç®€å•ï¼Œå¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œæˆ‘ä»¬åªéœ€è¦çœ‹<code>AT_MOST</code>å’Œ<code>EXACTLY</code>è¿™ä¸¤ç§æƒ…å†µã€‚ç®€å•åœ°ç†è§£ï¼Œå…¶å®<code>getDefaultSize</code>è¿”å›çš„å¤§å°å°±æ˜¯<code>measureSpec</code>ä¸­çš„<code>specSize</code>ï¼Œè€Œè¿™ä¸ª<code>specSize</code>å°±æ˜¯<code>View</code>æµ‹é‡åçš„å¤§å°ï¼Œè¿™é‡Œå¤šæ¬¡æåˆ°æµ‹é‡åçš„å¤§å°ï¼Œæ˜¯å› ä¸º<code>View</code>æœ€ç»ˆçš„å¤§å°æ˜¯åœ¨<code>layout</code>é˜¶æ®µç¡®å®šçš„ï¼Œæ‰€ä»¥è¿™é‡Œå¿…é¡»è¦åŠ ä»¥åŒºåˆ†ï¼Œä½†æ˜¯å‡ ä¹æ‰€æœ‰æƒ…å†µä¸‹<code>View</code>çš„æµ‹é‡å¤§å°å’Œæœ€ç»ˆå¤§å°æ˜¯ç›¸ç­‰çš„ã€‚<br>è‡³äº<code>UNSPECIFIED</code>è¿™ç§æƒ…å†µï¼Œä¸€èˆ¬ç”¨äºç³»ç»Ÿå†…éƒ¨çš„æµ‹é‡è¿‡ç¨‹ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>View</code>çš„å¤§å°ä¸º<code>getDefaultSize</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°<code>size</code>ï¼Œå³å®½&#x2F;é«˜åˆ†åˆ«ä¸º<code>getSuggestedMinimumWidth</code>å’Œ<code>getSuggestedMinimumHeight</code>è¿™ä¸¤ä¸ªæ–¹æ³•çš„è¿”å›å€¼ï¼Œçœ‹ä¸€ä¸‹å®ƒä»¬çš„æºç :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getSuggestedMinimumWidth</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> (mBackground == <span class="hljs-literal">null</span>) ? mMinWidth : max(mMinWidth,mBackground.getMinimumWidth());<br>&#125;<br><span class="hljs-keyword">protected</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getSuggestedMinimumHeight</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> (mBackground == <span class="hljs-literal">null</span>) ? mMinHeight : max(mMinHeight,mBackground.getMinimumHeight());<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œåªåˆ†æ<code>getSuggestedMinimumWidth</code>æ–¹æ³•çš„å®ç°ï¼Œ<code>getSuggestedMinimumHeight</code>å’Œå®ƒçš„å®ç°åŸç†æ˜¯ä¸€æ ·çš„ã€‚ä»<code>getSuggestedMinimumWidth</code>çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœ<code>View</code>æ²¡æœ‰è®¾ç½®èƒŒæ™¯ï¼Œé‚£ä¹ˆ<code>View</code>çš„å®½åº¦ä¸º<code>mMinWidth</code>ï¼Œè€Œ<code>mMinWidth</code>å¯¹åº”äº<code>android:minWidth</code>è¿™ä¸ªå±æ€§æ‰€æŒ‡å®šçš„å€¼ï¼Œå› æ­¤<code>View</code>çš„å®½åº¦å³ä¸º<code>android:minWidth</code>å±æ€§æ‰€æŒ‡å®šçš„å€¼ã€‚è¿™ä¸ªå±æ€§å¦‚æœä¸æŒ‡å®šï¼Œé‚£ä¹ˆ<code>mMinWidth</code>åˆ™é»˜è®¤ä¸º0ï¼›å¦‚æœ<code>View</code>æŒ‡å®šäº†èƒŒæ™¯ï¼Œåˆ™<code>View</code>çš„å®½åº¦ä¸º<code>max(mMinWidth,mBackground.getMinimumWidth())</code>ã€‚<code>mMinWidth</code>çš„å«ä¹‰æˆ‘ä»¬å·²ç»çŸ¥é“äº†ï¼Œé‚£ä¹ˆ<code>mBackground.getMinimumWidth()</code>æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬çœ‹ä¸€ä¸‹<code>Drawable</code>çš„<code>getMinimumWidth</code>æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getMinimumWidth</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">intrinsicWidth</span> <span class="hljs-operator">=</span> getIntrinsicWidth();<br>    <span class="hljs-keyword">return</span> intrinsicWidth &gt; <span class="hljs-number">0</span> ? intrinsicWidth : <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œ<code>getMinimumWidth</code>è¿”å›çš„å°±æ˜¯<code>Drawable</code>çš„åŸå§‹å®½åº¦ï¼Œå‰ææ˜¯è¿™ä¸ª<code>Drawable</code>æœ‰åŸå§‹å®½åº¦ï¼Œå¦åˆ™å°±è¿”å›0ã€‚<br>è¿™é‡Œå†æ€»ç»“ä¸€ä¸‹<code>getSuggestedMinimumWidth</code>çš„é€»è¾‘ï¼šå¦‚æœ<code>View</code>æ²¡æœ‰è®¾ç½®èƒŒæ™¯ï¼Œé‚£ä¹ˆè¿”å›<code>android:minWidth</code>è¿™ä¸ªå±æ€§æ‰€æŒ‡å®šçš„å€¼ï¼Œè¿™ä¸ªå€¼å¯ä»¥ä¸º0ï¼›å¦‚æœ<code>View</code>è®¾ç½®äº†èƒŒæ™¯ï¼Œåˆ™è¿”å›<code>android:minWidth</code>å’ŒèƒŒæ™¯çš„æœ€å°å®½åº¦è¿™ä¸¤è€…ä¸­çš„æœ€å¤§å€¼ï¼Œ<code>getSuggestedMinimumWidth</code>å’Œ<code>getSuggestedMinimumHeight</code>çš„è¿”å›å€¼å°±æ˜¯<code>View</code>åœ¨<code>UNSPECIFIED</code>æƒ…å†µä¸‹çš„æµ‹é‡å®½&#x2F;é«˜ã€‚<br>ä»<code>getDefaultSize</code>æ–¹æ³•çš„å®ç°æ¥çœ‹ï¼Œ<code>View</code>çš„å®½&#x2F;é«˜ç”±<code>specSize</code>å†³å®šï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—å‡ºå¦‚ä¸‹ç»“è®ºï¼šç›´æ¥ç»§æ‰¿<code>View</code>çš„è‡ªå®šä¹‰æ§ä»¶éœ€è¦é‡å†™<code>onMeasure</code>æ–¹æ³•å¹¶è®¾ç½®<code>wrap_content</code>æ—¶çš„è‡ªèº«å¤§å°ï¼Œå¦åˆ™åœ¨å¸ƒå±€ä¸­ä½¿ç”¨<code>wrap_content</code>å°±ç›¸å½“äºä½¿ç”¨<code>match_parent</code>ã€‚<br>ä»ä¸Šè¿°ä»£ç ä¸­æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœ<code>View</code>åœ¨å¸ƒå±€ä¸­ä½¿ç”¨<code>wrap_content</code>ï¼Œé‚£ä¹ˆå®ƒçš„<code>specMode</code>æ˜¯<code>AT_MOST</code>æ¨¡å¼ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå®ƒçš„å®½&#x2F;é«˜ç­‰äº<code>specSize</code>ï¼›è¿™ç§æƒ…å†µä¸‹<code>View</code>çš„<code>specSize</code>æ˜¯p<code>arentSize</code>ï¼Œè€Œ<code>parentSize</code>æ˜¯çˆ¶å®¹å™¨ä¸­ç›®å‰å¯ä»¥ä½¿ç”¨çš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯çˆ¶å®¹å™¨å½“å‰å‰©ä½™çš„ç©ºé—´å¤§å°ã€‚å¾ˆæ˜¾ç„¶ï¼Œ<code>View</code>çš„å®½&#x2F;é«˜å°±ç­‰äºçˆ¶å®¹å™¨å½“å‰å‰©ä½™çš„ç©ºé—´å¤§å°ï¼Œè¿™ç§æ•ˆæœå’Œåœ¨å¸ƒå±€ä¸­ä½¿ç”¨<code>match_parent</code>å®Œå…¨ä¸€è‡´ã€‚å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿä¹Ÿå¾ˆç®€å•ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMeasure</span><span class="hljs-params">(<span class="hljs-type">int</span> widthMeasureSpec,<span class="hljs-type">int</span> heightMeasureSpec)</span> &#123;<br>    <span class="hljs-built_in">super</span>.onMeasure(widthMeasureSpec,heightMeasureSpec);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">widthSpecMode</span> <span class="hljs-operator">=</span> MeasureSpec.getMode(widthMeasureSpec);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">widthSpecSize</span> <span class="hljs-operator">=</span> MeasureSpec.getSize(widthMeasureSpec);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">heightSpecMode</span> <span class="hljs-operator">=</span> MeasureSpec.getMode(heightMeasureSpec);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">heightSpecSize</span> <span class="hljs-operator">=</span> MeasureSpec.getSize(heightMeasureSpec);<br>    <span class="hljs-keyword">if</span> (widthSpecMode == MeasureSpec.AT_MOST &amp;&amp; heightSpecMode == MeasureSpec.AT_MOST) &#123;<br>        setMeasuredDimension(mWidth,mHeight);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (widthSpecMode == MeasureSpec.AT_MOST) &#123;<br>        setMeasuredDimension(mWidth,heightSpecSize);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (heightSpecMode == MeasureSpec.AT_MOST) &#123;<br>        setMeasuredDimension(widthSpecSize,mHeight);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦ç»™<code>View</code>æŒ‡å®šä¸€ä¸ªé»˜è®¤çš„å†…éƒ¨å®½&#x2F;é«˜ï¼ˆ<code>mWidth</code>å’Œ<code>mHeight</code>ï¼‰ï¼Œå¹¶åœ¨<code>wrap_content</code>æ—¶è®¾ç½®æ­¤å®½&#x2F;é«˜å³å¯ã€‚å¯¹äºé<code>wrap_content</code>æƒ…å½¢ï¼Œæˆ‘ä»¬æ²¿ç”¨ç³»ç»Ÿçš„æµ‹é‡å€¼å³å¯ï¼Œè‡³äºè¿™ä¸ªé»˜è®¤çš„å†…éƒ¨å®½&#x2F;é«˜çš„å¤§å°å¦‚ä½•æŒ‡å®šï¼Œè¿™ä¸ªæ²¡æœ‰å›ºå®šçš„ä¾æ®ï¼Œæ ¹æ®éœ€è¦çµæ´»æŒ‡å®šå³å¯ã€‚å¦‚æœæŸ¥çœ‹<code>TextView</code>ã€<code>ImageView</code>ç­‰çš„æºç å°±å¯ä»¥çŸ¥é“ï¼Œé’ˆå¯¹<code>wrap_content</code>æƒ…å½¢ï¼Œå®ƒä»¬çš„<code>onMeasure</code>æ–¹æ³•å‡åšäº†ç‰¹æ®Šå¤„ç†ã€‚</p><p>** ViewGroupçš„measureè¿‡ç¨‹ **<br>å¯¹äº<code>ViewGroup</code>æ¥è¯´ï¼Œé™¤äº†å®Œæˆè‡ªå·±çš„<code>measure</code>è¿‡ç¨‹ä»¥å¤–ï¼Œè¿˜ä¼šéå†å»è°ƒç”¨æ‰€æœ‰å­å…ƒç´ çš„<code>measure</code>æ–¹æ³•ï¼Œå„ä¸ªå­å…ƒç´ å†é€’å½’å»æ‰§è¡Œè¿™ä¸ªè¿‡ç¨‹ã€‚å’Œ<code>View</code>ä¸åŒçš„æ˜¯ï¼Œ<code>ViewGroup</code>æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå› æ­¤å®ƒæ²¡æœ‰é‡å†™<code>View</code>çš„<code>onMeasure</code>æ–¹æ³•ï¼Œä½†æ˜¯å®ƒæä¾›äº†ä¸€ä¸ªå«<code>measureChildren</code>çš„æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">measureChildren</span><span class="hljs-params">(<span class="hljs-type">int</span> widthMeasureSpec,<span class="hljs-type">int</span> heightMeasureSpec)</span> &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> mChildrenCount;<br>    <span class="hljs-keyword">final</span> View[] children = mChildren;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; size; ++i) &#123;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">View</span> <span class="hljs-variable">child</span> <span class="hljs-operator">=</span> children[i];<br>        <span class="hljs-keyword">if</span> ((child.mViewFlags &amp; VISIBILITY_MASK) != GONE) &#123;<br>            measureChild(child,widthMeasureSpec,heightMeasureSpec);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»ä¸Šè¿°ä»£ç æ¥çœ‹ï¼Œ<code>ViewGroup</code>åœ¨<code>measure</code>æ—¶ï¼Œä¼šå¯¹æ¯ä¸€ä¸ªå­å…ƒç´ è¿›è¡Œ<code>measure</code>ï¼Œ<code>measureChild</code>è¿™ä¸ªæ–¹æ³•çš„å®ç°ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">measureChild</span><span class="hljs-params">(View child,<span class="hljs-type">int</span> parentWidthMeasureSpec,<span class="hljs-type">int</span> parentHeightMeasureSpec)</span> &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">LayoutParams</span> <span class="hljs-variable">lp</span> <span class="hljs-operator">=</span> child.getLayoutParams();<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">childWidthMeasureSpec</span> <span class="hljs-operator">=</span> getChildMeasureSpec(parentWidth-MeasureSpec,mPaddingLeft + mPaddingRight,lp.width);<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">childHeightMeasureSpec</span> <span class="hljs-operator">=</span> getChildMeasureSpec(parentHeight-MeasureSpec,mPaddingTop + mPaddingBottom,lp.height);<br>    child.measure(childWidthMeasureSpec,childHeightMeasureSpec);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¾ˆæ˜¾ç„¶ï¼Œ<code>measureChild</code>çš„æ€æƒ³å°±æ˜¯å–å‡ºå­å…ƒç´ çš„<code>LayoutParams</code>ï¼Œç„¶åå†é€šè¿‡<code>getChildMeasureSpec</code>æ¥åˆ›å»ºå­å…ƒç´ çš„<code>MeasureSpec</code>ï¼Œæ¥ç€å°†<code>MeasureSpec</code>ç›´æ¥ä¼ é€’ç»™<code>View</code>çš„<code>measure</code>æ–¹æ³•æ¥è¿›è¡Œæµ‹é‡ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œ<code>ViewGroup</code>å¹¶æ²¡æœ‰å®šä¹‰å…¶æµ‹é‡çš„å…·ä½“è¿‡ç¨‹ï¼Œè¿™æ˜¯å› ä¸º<code>ViewGroup</code>æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå…¶æµ‹é‡è¿‡ç¨‹çš„<code>onMeasure</code>æ–¹æ³•éœ€è¦å„ä¸ªå­ç±»å»å…·ä½“å®ç°ï¼Œæ¯”å¦‚<code>LinearLayout</code>ã€<code>RelativeLayout</code>ç­‰ã€‚</p><h5 id="layoutè¿‡ç¨‹"><a href="#layoutè¿‡ç¨‹" class="headerlink" title="layoutè¿‡ç¨‹"></a>layoutè¿‡ç¨‹</h5><p><code>Layout</code>çš„ä½œç”¨æ˜¯<code>ViewGroup</code>ç”¨æ¥ç¡®å®šå­å…ƒç´ çš„ä½ç½®ï¼Œå½“<code>ViewGroup</code>çš„ä½ç½®è¢«ç¡®å®šåï¼Œå®ƒåœ¨<code>onLayout</code>ä¸­ä¼šéå†æ‰€æœ‰çš„å­å…ƒç´ å¹¶è°ƒç”¨å…¶<code>layout</code>æ–¹æ³•ï¼Œåœ¨<code>layout</code>æ–¹æ³•ä¸­<code>onLayout</code>æ–¹æ³•åˆä¼šè¢«è°ƒç”¨ã€‚<code>Layout</code>è¿‡ç¨‹å’Œ<code>measure</code>è¿‡ç¨‹ç›¸æ¯”å°±ç®€å•å¤šäº†ï¼Œ<code>layout</code>æ–¹æ³•ç¡®å®š<code>View</code>æœ¬èº«çš„ä½ç½®ï¼Œè€Œ<code>onLayout</code>æ–¹æ³•åˆ™ä¼šç¡®å®šæ‰€æœ‰å­å…ƒç´ çš„ä½ç½®ï¼Œå…ˆçœ‹<code>View</code>çš„<code>layout</code>æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">layout</span><span class="hljs-params">(<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> t,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> b)</span> &#123;<br>    <span class="hljs-keyword">if</span> ((mPrivateFlags3 &amp; PFLAG3_MEASURE_NEEDED_BEFORE_LAYOUT) != <span class="hljs-number">0</span>) &#123;<br>        onMeasure(mOldWidthMeasureSpec,mOldHeightMeasureSpec);<br>        mPrivateFlags3 &amp;= ~PFLAG3_MEASURE_NEEDED_BEFORE_LAYOUT;<br>    &#125;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">oldL</span> <span class="hljs-operator">=</span> mLeft;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">oldT</span> <span class="hljs-operator">=</span> mTop;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">oldB</span> <span class="hljs-operator">=</span> mBottom;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">oldR</span> <span class="hljs-operator">=</span> mRight;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">changed</span> <span class="hljs-operator">=</span> isLayoutModeOptical(mParent) ?setOpticalFrame(l,t,r,b) : setFrame(l,t,r,b);<br>    <span class="hljs-keyword">if</span> (changed || (mPrivateFlags &amp; PFLAG_LAYOUT_REQUIRED) == PFLAG_LAYOUT_REQUIRED) &#123;<br>        onLayout(changed,l,t,r,b);<br>        mPrivateFlags &amp;= ~PFLAG_LAYOUT_REQUIRED;<br>        <span class="hljs-type">ListenerInfo</span> <span class="hljs-variable">li</span> <span class="hljs-operator">=</span> mListenerInfo;<br>        <span class="hljs-keyword">if</span> (li != <span class="hljs-literal">null</span> &amp;&amp; li.mOnLayoutChangeListeners != <span class="hljs-literal">null</span>) &#123;<br>            ArrayList&lt;OnLayoutChangeListener&gt; listenersCopy =(ArrayList&lt;OnLayoutChangeListener&gt;)li.mOnLayout-ChangeListeners.clone();<br>            <span class="hljs-type">int</span> <span class="hljs-variable">numListeners</span> <span class="hljs-operator">=</span> listenersCopy.size();<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; numListeners; ++i) &#123;<br>                listenersCopy.get(i).onLayoutChange(<span class="hljs-built_in">this</span>,l,t,r,b,oldL,oldT,oldR,oldB);<br>            &#125;<br>        &#125;<br>    &#125;<br>    mPrivateFlags &amp;= ~PFLAG_FORCE_LAYOUT;<br>    mPrivateFlags3 |= PFLAG3_IS_LAID_OUT;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>layout</code>æ–¹æ³•çš„å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼šé¦–å…ˆä¼šé€šè¿‡<code>setFrame</code>æ–¹æ³•æ¥è®¾å®š<code>View</code>çš„å››ä¸ªé¡¶ç‚¹çš„ä½ç½®ï¼Œå³åˆå§‹åŒ–<code>mLeft</code>ã€<code>mRight</code>ã€<code>mTop</code>å’Œ<code>mBottom</code>è¿™å››ä¸ªå€¼ï¼Œ<code>View</code>çš„å››ä¸ªé¡¶ç‚¹ä¸€æ—¦ç¡®å®šï¼Œé‚£ä¹ˆ<code>View</code>åœ¨çˆ¶å®¹å™¨ä¸­çš„ä½ç½®ä¹Ÿå°±ç¡®å®šäº†ï¼›æ¥ç€ä¼šè°ƒç”¨<code>onLayout</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„ç”¨é€”æ˜¯çˆ¶å®¹å™¨ç¡®å®šå­å…ƒç´ çš„ä½ç½®ï¼Œå’Œ<code>onMeasure</code>æ–¹æ³•ç±»ä¼¼ï¼Œ<code>onLayout</code>çš„å…·ä½“å®ç°åŒæ ·å’Œå…·ä½“çš„å¸ƒå±€æœ‰å…³ï¼Œæ‰€ä»¥<code>View</code>å’Œ<code>ViewGroup</code>å‡æ²¡æœ‰çœŸæ­£å®ç°<code>onLayout</code>æ–¹æ³•ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹<code>LinearLayout</code>çš„<code>onLayout</code>æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onLayout</span><span class="hljs-params">(<span class="hljs-type">boolean</span> changed,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> t,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> b)</span> &#123;<br>    <span class="hljs-keyword">if</span> (mOrientation == VERTICAL) &#123;<br>        layoutVertical(l,t,r,b);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        layoutHorizontal(l,t,r,b);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>LinearLayout</code>ä¸­<code>onLayout</code>çš„å®ç°é€»è¾‘å’Œ<code>onMeasure</code>çš„å®ç°é€»è¾‘ç±»ä¼¼ï¼Œè¿™é‡Œé€‰æ‹©<code>layoutVertical</code>ç»§ç»­è®²è§£ï¼Œä¸ºäº†æ›´å¥½åœ°ç†è§£å…¶é€»è¾‘ï¼Œè¿™é‡Œåªç»™å‡ºäº†ä¸»è¦çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">layoutVertical</span><span class="hljs-params">(<span class="hljs-type">int</span> left,<span class="hljs-type">int</span> top,<span class="hljs-type">int</span> right,<span class="hljs-type">int</span> bottom)</span> &#123;<br>    ......<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> getVirtualChildCount();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; count; i++) &#123;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">View</span> <span class="hljs-variable">child</span> <span class="hljs-operator">=</span> getVirtualChildAt(i);<br>        <span class="hljs-keyword">if</span> (child == <span class="hljs-literal">null</span>) &#123;<br>            childTop += measureNullChild(i);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (child.getVisibility() != GONE) &#123;<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">childWidth</span> <span class="hljs-operator">=</span> child.getMeasuredWidth();<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">childHeight</span> <span class="hljs-operator">=</span> child.getMeasuredHeight();<br>            <span class="hljs-keyword">final</span> LinearLayout.<span class="hljs-type">LayoutParams</span> <span class="hljs-variable">lp</span> <span class="hljs-operator">=</span>(LinearLayout.LayoutParams) child.getLayoutParams();<br>            ......<br>            <span class="hljs-keyword">if</span> (hasDividerBeforeChildAt(i)) &#123;<br>                childTop += mDividerHeight;<br>            &#125;<br>            childTop += lp.topMargin;<br>            setChildFrame(child,childLeft,childTop + getLocationOffset(child),childWidth,childHeight);<br>            childTop += childHeight + lp.bottomMargin + getNextLocation-Offset(child);<br>            i += getChildrenSkipCount(child,i);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œåˆ†æä¸€ä¸‹<code>layoutVertical</code>çš„ä»£ç é€»è¾‘ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ–¹æ³•ä¼šéå†æ‰€æœ‰å­å…ƒç´ å¹¶è°ƒç”¨<code>setChildFrame</code>æ–¹æ³•æ¥ä¸ºå­å…ƒç´ æŒ‡å®šå¯¹åº”çš„ä½ç½®ï¼Œå…¶ä¸­<code>childTop</code>ä¼šé€æ¸å¢å¤§ï¼Œè¿™å°±æ„å‘³ç€åé¢çš„å­å…ƒç´ ä¼šè¢«æ”¾ç½®åœ¨é ä¸‹çš„ä½ç½®ï¼Œè¿™åˆšå¥½ç¬¦åˆç«–ç›´æ–¹å‘çš„<code>LinearLayout</code>çš„ç‰¹æ€§ã€‚è‡³äº<code>setChildFrame</code>ï¼Œå®ƒä»…ä»…æ˜¯è°ƒç”¨å­å…ƒç´ çš„<code>layout</code>æ–¹æ³•è€Œå·²ï¼Œè¿™æ ·çˆ¶å…ƒç´ åœ¨<code>layout</code>æ–¹æ³•ä¸­å®Œæˆè‡ªå·±çš„å®šä½ä»¥åï¼Œå°±é€šè¿‡<code>onLayout</code>æ–¹æ³•å»è°ƒç”¨å­å…ƒç´ çš„<code>layout</code>æ–¹æ³•ï¼Œå­å…ƒç´ åˆä¼šé€šè¿‡è‡ªå·±çš„<code>layout</code>æ–¹æ³•æ¥ç¡®å®šè‡ªå·±çš„ä½ç½®ï¼Œè¿™æ ·ä¸€å±‚ä¸€å±‚åœ°ä¼ é€’ä¸‹å»å°±å®Œæˆäº†æ•´ä¸ª<code>View</code>æ ‘çš„<code>layout</code>è¿‡ç¨‹ã€‚<code>setChildFrame</code>æ–¹æ³•çš„å®ç°å¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setChildFrame</span><span class="hljs-params">(View child,<span class="hljs-type">int</span> left,<span class="hljs-type">int</span> top,<span class="hljs-type">int</span> width,<span class="hljs-type">int</span> height)</span> &#123;<br>    child.layout(left,top,left + width,top + height);<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æ³¨æ„åˆ°ï¼ŒsetChildFrameä¸­çš„widthå’Œheightå®é™…ä¸Šå°±æ˜¯å­å…ƒç´ çš„æµ‹é‡å®½&#x2F;é«˜ï¼Œä»ä¸‹é¢çš„ä»£ç å¯ä»¥çœ‹å‡ºè¿™ä¸€ç‚¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">childWidth</span> <span class="hljs-operator">=</span> child.getMeasuredWidth();<br><span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">childHeight</span> <span class="hljs-operator">=</span> child.getMeasuredHeight();<br>setChildFrame(child,childLeft,childTop + getLocationOffset(child),childWidth,childHeight);<br></code></pre></td></tr></table></figure><p>è€Œåœ¨<code>layout</code>æ–¹æ³•ä¸­ä¼šé€šè¿‡<code>setFrame</code>å»è®¾ç½®å­å…ƒç´ çš„å››ä¸ªé¡¶ç‚¹çš„ä½ç½®ï¼Œåœ¨<code>setFrame</code>ä¸­æœ‰å¦‚ä¸‹å‡ å¥èµ‹å€¼è¯­å¥ï¼Œè¿™æ ·ä¸€æ¥å­å…ƒç´ çš„ä½ç½®å°±ç¡®å®šäº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">mLeft = left;<br>mTop = top;<br>mRight = right;<br>mBottom = bottom;<br></code></pre></td></tr></table></figure><p><code>View</code>çš„æµ‹é‡å®½&#x2F;é«˜å’Œæœ€ç»ˆ&#x2F;å®½é«˜æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿè¿™ä¸ªé—®é¢˜å¯ä»¥å…·ä½“ä¸ºï¼š<code>View</code>çš„<code>getMeasuredWidth</code>å’Œ<code>getWidth</code>è¿™ä¸¤ä¸ªæ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œè‡³äº<code>getMeasuredHeight</code>å’Œ<code>getHeight</code>çš„åŒºåˆ«å’Œå‰ä¸¤è€…å®Œå…¨ä¸€æ ·ã€‚ä¸ºäº†å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹getwidthå’ŒgetHeightè¿™ä¸¤ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getWidth</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> mRight -mLeft;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getHeight</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> mBottom -mTop;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»<code>getWidth</code>å’Œ<code>getHeight</code>çš„æºç å†ç»“åˆ<code>mLeft</code>ã€<code>mRight</code>ã€<code>mTop</code>å’Œ<code>mBottom</code>è¿™å››ä¸ªå˜é‡çš„èµ‹å€¼è¿‡ç¨‹æ¥çœ‹ï¼Œ<code>getWidth</code>æ–¹æ³•çš„è¿”å›å€¼åˆšå¥½å°±æ˜¯<code>View</code>çš„æµ‹é‡å®½åº¦ï¼Œè€Œ<code>getHeight</code>æ–¹æ³•çš„è¿”å›å€¼ä¹Ÿåˆšå¥½å°±æ˜¯<code>View</code>çš„æµ‹é‡é«˜åº¦ã€‚ç»è¿‡ä¸Šè¿°åˆ†æï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å›ç­”è¿™ä¸ªé—®é¢˜äº†ï¼šåœ¨<code>View</code>çš„é»˜è®¤å®ç°ä¸­ï¼Œ<code>View</code>çš„æµ‹é‡å®½&#x2F;é«˜å’Œæœ€ç»ˆå®½&#x2F;é«˜æ˜¯ç›¸ç­‰çš„ï¼Œåªä¸è¿‡æµ‹é‡å®½&#x2F;é«˜å½¢æˆäº<code>View</code>çš„<code>measure</code>è¿‡ç¨‹ï¼Œè€Œæœ€ç»ˆå®½&#x2F;é«˜å½¢æˆäº<code>View</code>çš„<code>layout</code>è¿‡ç¨‹ï¼Œå³ä¸¤è€…çš„èµ‹å€¼æ—¶æœºä¸åŒï¼Œæµ‹é‡å®½&#x2F;é«˜çš„èµ‹å€¼æ—¶æœºç¨å¾®æ—©ä¸€äº›ã€‚å› æ­¤ï¼Œåœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸º<code>View</code>çš„<code>æµ‹é‡å®½/é«˜</code>å°±<code>ç­‰äº``æœ€ç»ˆå®½/é«˜</code>ï¼Œä½†æ˜¯çš„ç¡®å­˜åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¼šå¯¼è‡´ä¸¤è€…ä¸ä¸€è‡´.</p><h5 id="drawè¿‡ç¨‹"><a href="#drawè¿‡ç¨‹" class="headerlink" title="drawè¿‡ç¨‹"></a>drawè¿‡ç¨‹</h5><p>Drawè¿‡ç¨‹å°±æ¯”è¾ƒç®€å•äº†ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†Viewç»˜åˆ¶åˆ°å±å¹•ä¸Šé¢ã€‚Viewçš„ç»˜åˆ¶è¿‡ç¨‹éµå¾ª<br>å¦‚ä¸‹å‡ æ­¥ï¼š</p><ul><li>ç»˜åˆ¶èƒŒæ™¯background.draw(canvas)ã€‚</li><li>ç»˜åˆ¶è‡ªå·±ï¼ˆonDrawï¼‰ã€‚</li><li>ç»˜åˆ¶childrenï¼ˆdispatchDrawï¼‰ã€‚</li><li>ç»˜åˆ¶è£…é¥°ï¼ˆonDrawScrollBarsï¼‰ã€‚<br>è¿™ä¸€ç‚¹é€šè¿‡drawæ–¹æ³•çš„æºç å¯ä»¥æ˜æ˜¾çœ‹å‡ºæ¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">(Canvas canvas)</span> &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">privateFlags</span> <span class="hljs-operator">=</span> mPrivateFlags;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">dirtyOpaque</span> <span class="hljs-operator">=</span> (privateFlags &amp; PFLAG_DIRTY_MASK) == PFLAG_DIRTY_OPAQUE &amp;&amp;(mAttachInfo == <span class="hljs-literal">null</span> || !mAttachInfo.mIgnoreDirtyState);<br>    mPrivateFlags = (privateFlags &amp; ~PFLAG_DIRTY_MASK) | PFLAG_DRAWN;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    * Draw traversal performs several drawing steps which must be executed</span><br><span class="hljs-comment">    * in the appropriate order:</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * 1. Draw the background</span><br><span class="hljs-comment">    * 2. If necessary,save the canvas&#x27; layers to prepare for fading</span><br><span class="hljs-comment">    * 3. Draw view&#x27;s content</span><br><span class="hljs-comment">    * 4. Draw children</span><br><span class="hljs-comment">    * 5. If necessary,draw the fading edges and restore layers</span><br><span class="hljs-comment">    * 6. Draw decorations (scrollbars for instance)</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-comment">// Step 1,draw the background,if needed</span><br>    <span class="hljs-type">int</span> saveCount;<br>    <span class="hljs-keyword">if</span> (!dirtyOpaque) &#123;<br>        drawBackground(canvas);<br>    &#125;<br>    <span class="hljs-comment">// skip step 2 &amp; 5 if possible (common case)</span><br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">viewFlags</span> <span class="hljs-operator">=</span> mViewFlags;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">horizontalEdges</span> <span class="hljs-operator">=</span> (viewFlags &amp; FADING_EDGE_HORIZONTAL) != <span class="hljs-number">0</span>;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">verticalEdges</span> <span class="hljs-operator">=</span> (viewFlags &amp; FADING_EDGE_VERTICAL) != <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> (!verticalEdges &amp;&amp; !horizontalEdges) &#123;<br>        <span class="hljs-comment">// Step 3,draw the content</span><br>        <span class="hljs-keyword">if</span> (!dirtyOpaque) onDraw(canvas);<br>            <span class="hljs-comment">// Step 4,draw the children</span><br>        dispatchDraw(canvas);<br>        <span class="hljs-comment">// Step 6,draw decorations (scrollbars)</span><br>        onDrawScrollBars(canvas);<br>        <span class="hljs-keyword">if</span> (mOverlay != <span class="hljs-literal">null</span> &amp;&amp; !mOverlay.isEmpty()) &#123;<br>            mOverlay.getOverlayView().dispatchDraw(canvas);<br>        &#125;<br>        <span class="hljs-comment">// we&#x27;re done...</span><br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><p>Viewç»˜åˆ¶è¿‡ç¨‹çš„ä¼ é€’æ˜¯é€šè¿‡dispatchDrawæ¥å®ç°çš„ï¼ŒdispatchDrawä¼šéå†è°ƒç”¨æ‰€æœ‰å­å…ƒç´ çš„drawæ–¹æ³•ï¼Œå¦‚æ­¤drawäº‹ä»¶å°±ä¸€å±‚å±‚åœ°ä¼ é€’äº†ä¸‹å»ã€‚Viewæœ‰ä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ³•setWillNotDrawï¼Œå…ˆçœ‹ä¸€ä¸‹å®ƒçš„æºç ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* If this view doesn&#x27;t do any drawing on its own,set this flag to</span><br><span class="hljs-comment">* allow further optimizations. By default,this flag is not set on</span><br><span class="hljs-comment">* View,but could be set on some View subclasses such as ViewGroup.</span><br><span class="hljs-comment">*</span><br><span class="hljs-comment">* Typically,if you override &#123;<span class="hljs-doctag">@link</span> #onDraw(android.graphics.Canvas)&#125;</span><br><span class="hljs-comment">* you should clear this flag.</span><br><span class="hljs-comment">*</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> willNotDraw whether or not this View draw on its own</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setWillNotDraw</span><span class="hljs-params">(<span class="hljs-type">boolean</span> willNotDraw)</span> &#123;<br>    setFlags(willNotDraw ? WILL_NOT_DRAW : <span class="hljs-number">0</span>,DRAW_MASK);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»<code>setWillNotDraw</code>è¿™ä¸ªæ–¹æ³•çš„æ³¨é‡Šä¸­å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœä¸€ä¸ª<code>View</code>ä¸éœ€è¦ç»˜åˆ¶ä»»ä½•å†…å®¹ï¼Œé‚£ä¹ˆè®¾ç½®è¿™ä¸ªæ ‡è®°ä½ä¸º<code>true</code>ä»¥åï¼Œç³»ç»Ÿä¼šè¿›è¡Œç›¸åº”çš„ä¼˜åŒ–ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>View</code>æ²¡æœ‰å¯ç”¨è¿™ä¸ªä¼˜åŒ–æ ‡è®°ä½ï¼Œä½†æ˜¯<code>ViewGroup</code>ä¼šé»˜è®¤å¯ç”¨è¿™ä¸ªä¼˜åŒ–æ ‡è®°ä½ã€‚è¿™ä¸ªæ ‡è®°ä½å¯¹å®é™…å¼€å‘çš„æ„ä¹‰æ˜¯ï¼šå½“æˆ‘ä»¬çš„è‡ªå®šä¹‰æ§ä»¶ç»§æ‰¿äº<code>ViewGroup</code>å¹¶ä¸”æœ¬èº«ä¸å…·å¤‡ç»˜åˆ¶åŠŸèƒ½æ—¶ï¼Œå°±å¯ä»¥å¼€å¯è¿™ä¸ªæ ‡è®°ä½ä»è€Œä¾¿äºç³»ç»Ÿè¿›è¡Œåç»­çš„ä¼˜åŒ–ã€‚å½“ç„¶ï¼Œå½“æ˜ç¡®çŸ¥é“ä¸€ä¸ª<code>ViewGroup</code>éœ€è¦é€šè¿‡<code>onDraw</code>æ¥ç»˜åˆ¶å†…å®¹æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ˜¾å¼åœ°å…³é—­<code>WILL_NOT_DRAW</code>è¿™ä¸ªæ ‡è®°ä½ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Viewäº‹ä»¶åˆ†å‘</title>
    <link href="/2018/07/29/View%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91/"/>
    <url>/2018/07/29/View%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91/</url>
    
    <content type="html"><![CDATA[<p>æŠ„çš„ã€ŠAndroidå¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹3.4.1 å’Œ 3.4.2</p><h6 id="MotionEvent"><a href="#MotionEvent" class="headerlink" title="MotionEvent"></a>MotionEvent</h6><p>åœ¨æ‰‹æŒ‡æ¥è§¦å±å¹•åæ‰€äº§ç”Ÿçš„ä¸€ç³»åˆ—äº‹ä»¶ä¸­ï¼Œå…¸å‹çš„äº‹ä»¶ç±»å‹æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><ul><li>ACTION_DOWNâ€”â€”æ‰‹æŒ‡åˆšæ¥è§¦å±å¹•ï¼›</li><li>ACTION_MOVEâ€”â€”æ‰‹æŒ‡åœ¨å±å¹•ä¸Šç§»åŠ¨ï¼›</li><li>ACTION_UPâ€”â€”æ‰‹æœºä»å±å¹•ä¸Šæ¾å¼€çš„ä¸€ç¬é—´<br>è¿˜æœ‰å…¶ä»–çš„äº‹ä»¶å¯ä»¥å‚è€ƒ<code>MotionEvent.java</code>ç±»</li></ul><h6 id="TouchSlop"><a href="#TouchSlop" class="headerlink" title="TouchSlop"></a>TouchSlop</h6><p>TouchSlopæ˜¯ç³»ç»Ÿæ‰€èƒ½è¯†åˆ«å‡ºçš„è¢«è®¤ä¸ºæ˜¯æ»‘åŠ¨çš„æœ€å°è·ç¦»ï¼Œæ¢å¥è¯è¯´ï¼Œå½“æ‰‹æŒ‡åœ¨å±å¹•ä¸Šæ»‘åŠ¨æ—¶ï¼Œå¦‚æœä¸¤æ¬¡æ»‘åŠ¨ä¹‹é—´çš„è·ç¦»å°äºè¿™ä¸ªå¸¸é‡ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±ä¸è®¤ä¸ºä½ æ˜¯åœ¨è¿›è¡Œæ»‘åŠ¨æ“ä½œï¼Œè¿™æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œå’Œè®¾å¤‡æœ‰å…³ï¼Œåœ¨ä¸åŒè®¾å¤‡ä¸Šè¿™ä¸ªå€¼å¯èƒ½æ˜¯ä¸åŒçš„ï¼Œé€šè¿‡å¦‚ä¸‹æ–¹å¼å³å¯è·å–è¿™ä¸ªå¸¸é‡ï¼š<code>ViewConfiguration. get(getContext()).getScaledTouchSlop()</code>ã€‚å½“æˆ‘ä»¬åœ¨å¤„ç†æ»‘åŠ¨æ—¶ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªå¸¸é‡æ¥åšä¸€äº›è¿‡æ»¤ï¼Œæ¯”å¦‚å½“ä¸¤æ¬¡æ»‘åŠ¨äº‹ä»¶çš„æ»‘åŠ¨è·ç¦»å°äºè¿™ä¸ªå€¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¤ä¸ºæœªè¾¾åˆ°æ»‘åŠ¨è·ç¦»çš„ä¸´ç•Œå€¼ï¼Œå› æ­¤å°±å¯ä»¥è®¤ä¸ºå®ƒä»¬ä¸æ˜¯æ»‘åŠ¨ï¼Œè¿™æ ·åšå¯ä»¥æœ‰æ›´å¥½çš„ç”¨æˆ·ä½“éªŒå¯ä»¥åœ¨æºç ä¸­æ‰¾åˆ°è¿™ä¸ªå¸¸é‡çš„å®šä¹‰ï¼Œåœ¨<code>frameworks/base/core/res/res/values/config.xml</code>æ–‡ä»¶ä¸­ã€‚</p><span id="more"></span><p>æ‰€è°“ç‚¹å‡»äº‹ä»¶çš„äº‹ä»¶åˆ†å‘ï¼Œå…¶å®å°±æ˜¯å¯¹MotionEventäº‹ä»¶çš„åˆ†å‘è¿‡ç¨‹ï¼Œå³å½“ä¸€ä¸ªMotionEventäº§ç”Ÿäº†ä»¥åï¼Œç³»ç»Ÿéœ€è¦æŠŠè¿™ä¸ªäº‹ä»¶ä¼ é€’ç»™ä¸€ä¸ªå…·ä½“çš„Viewï¼Œè€Œè¿™ä¸ªä¼ é€’çš„è¿‡ç¨‹å°±æ˜¯åˆ†å‘è¿‡ç¨‹ã€‚ç‚¹å‡»äº‹ä»¶çš„åˆ†å‘è¿‡ç¨‹ç”±ä¸‰ä¸ªå¾ˆé‡è¦çš„æ–¹æ³•æ¥å…±åŒå®Œæˆï¼šdispatchTouchEventã€onInterceptTouchEventå’ŒonTouchEventï¼Œä¸‹é¢æˆ‘ä»¬å…ˆä»‹ç»ä¸€ä¸‹è¿™å‡ ä¸ªæ–¹æ³•</p><h6 id="public-boolean-dispatchTouchEvent-MotionEvent-ev"><a href="#public-boolean-dispatchTouchEvent-MotionEvent-ev" class="headerlink" title="public boolean dispatchTouchEvent(MotionEvent ev)"></a>public boolean dispatchTouchEvent(MotionEvent ev)</h6><p>ç”¨æ¥è¿›è¡Œäº‹ä»¶çš„åˆ†å‘ã€‚å¦‚æœäº‹ä»¶èƒ½å¤Ÿä¼ é€’ç»™å½“å‰Viewï¼Œé‚£ä¹ˆæ­¤æ–¹æ³•ä¸€å®šä¼šè¢«è°ƒç”¨ï¼Œè¿”å›ç»“æœå—å½“å‰Viewçš„onTouchEventå’Œä¸‹çº§Viewçš„dispatchTouchEventæ–¹æ³•çš„å½±å“ï¼Œè¡¨ç¤ºæ˜¯å¦æ¶ˆè€—å½“å‰äº‹ä»¶ã€‚</p><h6 id="public-boolean-onInterceptTouchEvent-MotionEvent-event"><a href="#public-boolean-onInterceptTouchEvent-MotionEvent-event" class="headerlink" title="public boolean onInterceptTouchEvent(MotionEvent event)"></a>public boolean onInterceptTouchEvent(MotionEvent event)</h6><p>åœ¨ä¸Šè¿°æ–¹æ³•å†…éƒ¨è°ƒç”¨ï¼Œç”¨æ¥åˆ¤æ–­æ˜¯å¦æ‹¦æˆªæŸä¸ªäº‹ä»¶ï¼Œå¦‚æœå½“å‰Viewæ‹¦æˆªäº†æŸä¸ªäº‹ä»¶ï¼Œé‚£ä¹ˆåœ¨åŒä¸€ä¸ªäº‹ä»¶åºåˆ—å½“ä¸­ï¼Œæ­¤æ–¹æ³•ä¸ä¼šè¢«å†æ¬¡è°ƒç”¨ï¼Œè¿”å›ç»“æœè¡¨ç¤ºæ˜¯å¦æ‹¦æˆªå½“å‰äº‹ä»¶ã€‚</p><h6 id="public-boolean-onTouchEvent-MotionEvent-event"><a href="#public-boolean-onTouchEvent-MotionEvent-event" class="headerlink" title="public boolean onTouchEvent(MotionEvent event)"></a>public boolean onTouchEvent(MotionEvent event)</h6><p>åœ¨dispatchTouchEventæ–¹æ³•ä¸­è°ƒç”¨ï¼Œç”¨æ¥å¤„ç†ç‚¹å‡»äº‹ä»¶ï¼Œè¿”å›ç»“æœè¡¨ç¤ºæ˜¯å¦æ¶ˆè€—å½“å‰äº‹ä»¶ï¼Œå¦‚æœä¸æ¶ˆè€—ï¼Œåˆ™åœ¨åŒä¸€ä¸ªäº‹ä»¶åºåˆ—ä¸­ï¼Œå½“å‰Viewæ— æ³•å†æ¬¡æ¥æ”¶åˆ°äº‹ä»¶.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">dispatchTouchEvent</span><span class="hljs-params">(MotionEvent ev)</span> &#123;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">consume</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">if</span> (onInterceptTouchEvent(ev)) &#123;<br>        consume = onTouchEvent(ev);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        consume = child.dispatchTouchEvent(ev);<br>    &#125;<br>    <span class="hljs-keyword">return</span> consume;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹äºä¸€ä¸ªæ ¹<code>ViewGroup</code>æ¥è¯´ï¼Œç‚¹å‡»äº‹ä»¶äº§ç”Ÿåï¼Œé¦–å…ˆä¼šä¼ é€’ç»™å®ƒï¼Œè¿™æ—¶å®ƒçš„<code>dispatchTouchEvent</code>å°±ä¼šè¢«è°ƒç”¨ï¼Œå¦‚æœè¿™ä¸ª<code>ViewGroup</code>çš„<code>onInterceptTouchEvent</code>æ–¹æ³•è¿”å›<code>true</code>å°±è¡¨ç¤ºå®ƒè¦æ‹¦æˆªå½“å‰äº‹ä»¶ï¼Œæ¥ç€äº‹ä»¶å°±ä¼šäº¤ç»™è¿™ä¸ª<code>ViewGroup</code>å¤„ç†ï¼Œå³å®ƒçš„<code>onTouchEvent</code>æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ï¼›å¦‚æœè¿™ä¸ª<code>ViewGroup</code>çš„<code>onInterceptTouchEvent</code>æ–¹æ³•è¿”å›<code>false</code>å°±è¡¨ç¤ºå®ƒä¸æ‹¦æˆªå½“å‰äº‹ä»¶ï¼Œè¿™æ—¶å½“å‰äº‹ä»¶å°±ä¼šç»§ç»­ä¼ é€’ç»™å®ƒçš„å­å…ƒç´ ï¼Œæ¥ç€å­å…ƒç´ çš„<code>dispatchTouchEvent</code>æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ï¼Œå¦‚æ­¤åå¤ç›´åˆ°äº‹ä»¶è¢«æœ€ç»ˆå¤„ç†ã€‚<br>å½“ä¸€ä¸ª<code>View</code>éœ€è¦å¤„ç†äº‹ä»¶æ—¶ï¼Œå¦‚æœå®ƒè®¾ç½®äº†<code>OnTouchListener</code>ï¼Œé‚£ä¹ˆ<code>OnTouchListener</code>ä¸­çš„<code>onTouch</code>æ–¹æ³•ä¼šè¢«å›è°ƒã€‚è¿™æ—¶äº‹ä»¶å¦‚ä½•å¤„ç†è¿˜è¦çœ‹<code>onTouch</code>çš„è¿”å›å€¼ï¼Œå¦‚æœè¿”å›<code>false</code>ï¼Œåˆ™å½“å‰<code>View</code>çš„<code>onTouchEvent</code>æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼›å¦‚æœè¿”å›<code>true</code>ï¼Œé‚£ä¹ˆ<code>onTouchEvent</code>æ–¹æ³•å°†ä¸ä¼šè¢«è°ƒç”¨ã€‚ç”±æ­¤å¯è§ï¼Œç»™<code>View</code>è®¾ç½®çš„<code>OnTouchListener</code>ï¼Œå…¶ä¼˜å…ˆçº§æ¯”<code>onTouchEvent</code>è¦é«˜ã€‚åœ¨<code>onTouchEvent</code>æ–¹æ³•ä¸­ï¼Œå¦‚æœå½“å‰è®¾ç½®çš„æœ‰<code>OnClickListener</code>ï¼Œé‚£ä¹ˆå®ƒçš„<code>onClick</code>æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚å¯ä»¥çœ‹å‡ºï¼Œå¹³æ—¶æˆ‘ä»¬å¸¸ç”¨çš„<code>OnClickListener</code>ï¼Œå…¶ä¼˜å…ˆçº§æœ€ä½ï¼Œå³å¤„äºäº‹ä»¶ä¼ é€’çš„å°¾ç«¯ã€‚<br>å½“ä¸€ä¸ªç‚¹å‡»äº‹ä»¶äº§ç”Ÿåï¼Œå®ƒçš„ä¼ é€’è¿‡ç¨‹éµå¾ªå¦‚ä¸‹é¡ºåºï¼š<code>Activity -&gt; Window -&gt; View</code>ï¼Œå³äº‹ä»¶æ€»æ˜¯å…ˆä¼ é€’ç»™<code>Activity</code>ï¼Œ<code>Activity</code>å†ä¼ é€’ç»™<code>Window</code>ï¼Œæœ€å<code>Window</code>å†ä¼ é€’ç»™é¡¶çº§<code>View</code>ã€‚é¡¶çº§<code>View</code>æ¥æ”¶åˆ°äº‹ä»¶åï¼Œå°±ä¼šæŒ‰ç…§äº‹ä»¶åˆ†å‘æœºåˆ¶å»åˆ†å‘äº‹ä»¶ã€‚è€ƒè™‘ä¸€ç§æƒ…å†µï¼Œå¦‚æœä¸€ä¸ª<code>View</code>çš„<code>onTouchEvent</code>è¿”å›<code>false</code>ï¼Œé‚£ä¹ˆå®ƒçš„çˆ¶å®¹å™¨çš„<code>onTouchEvent</code>å°†ä¼šè¢«è°ƒç”¨ï¼Œä¾æ­¤ç±»æ¨ã€‚å¦‚æœæ‰€æœ‰çš„å…ƒç´ éƒ½ä¸å¤„ç†è¿™ä¸ªäº‹ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªäº‹ä»¶å°†ä¼šæœ€ç»ˆä¼ é€’ç»™<code>Activity</code>å¤„ç†ï¼Œå³<code>Activity</code>çš„<code>onTouchEvent</code>æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚</p><h6 id="äº‹ä»¶ä¼ é€’æœºåˆ¶"><a href="#äº‹ä»¶ä¼ é€’æœºåˆ¶" class="headerlink" title="äº‹ä»¶ä¼ é€’æœºåˆ¶"></a>äº‹ä»¶ä¼ é€’æœºåˆ¶</h6><ul><li>åŒä¸€ä¸ªäº‹ä»¶åºåˆ—æ˜¯æŒ‡ä»æ‰‹æŒ‡æ¥è§¦å±å¹•çš„é‚£ä¸€åˆ»èµ·ï¼Œåˆ°æ‰‹æŒ‡ç¦»å¼€å±å¹•çš„é‚£ä¸€åˆ»ç»“æŸï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ‰€äº§ç”Ÿçš„ä¸€ç³»åˆ—äº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶åºåˆ—ä»¥downäº‹ä»¶å¼€å§‹ï¼Œä¸­é—´å«æœ‰æ•°é‡ä¸å®šçš„moveäº‹ä»¶ï¼Œæœ€ç»ˆä»¥upäº‹ä»¶ç»“æŸã€‚</li><li>æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªäº‹ä»¶åºåˆ—åªèƒ½è¢«ä¸€ä¸ªViewæ‹¦æˆªä¸”æ¶ˆè€—ã€‚å› ä¸ºä¸€æ—¦ä¸€ä¸ªå…ƒç´ æ‹¦æˆªäº†æŸæ­¤äº‹ä»¶ï¼Œé‚£ä¹ˆåŒä¸€ä¸ªäº‹ä»¶åºåˆ—å†…çš„æ‰€æœ‰äº‹ä»¶éƒ½ä¼šç›´æ¥äº¤ç»™å®ƒå¤„ç†ï¼Œå› æ­¤åŒä¸€ä¸ªäº‹ä»¶åºåˆ—ä¸­çš„äº‹ä»¶ä¸èƒ½åˆ†åˆ«ç”±ä¸¤ä¸ªViewåŒæ—¶å¤„ç†ï¼Œä½†æ˜¯é€šè¿‡ç‰¹æ®Šæ‰‹æ®µå¯ä»¥åšåˆ°ï¼Œæ¯”å¦‚ä¸€ä¸ªViewå°†æœ¬è¯¥è‡ªå·±å¤„ç†çš„äº‹ä»¶é€šè¿‡onTouchEventå¼ºè¡Œä¼ é€’ç»™å…¶ä»–Viewå¤„ç†ã€‚</li><li>æŸä¸ªViewä¸€æ—¦å†³å®šæ‹¦æˆªï¼Œé‚£ä¹ˆè¿™ä¸€ä¸ªäº‹ä»¶åºåˆ—éƒ½åªèƒ½ç”±å®ƒæ¥å¤„ç†ï¼ˆå¦‚æœäº‹ä»¶åºåˆ—èƒ½å¤Ÿä¼ é€’ç»™å®ƒçš„è¯ï¼‰ï¼Œå¹¶ä¸”å®ƒçš„onInterceptTouchEventä¸ä¼šå†è¢«è°ƒç”¨ã€‚è¿™æ¡ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯è¯´å½“ä¸€ä¸ªViewå†³å®šæ‹¦æˆªä¸€ä¸ªäº‹ä»¶åï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šæŠŠåŒä¸€ä¸ªäº‹ä»¶åºåˆ—å†…çš„å…¶ä»–æ–¹æ³•éƒ½ç›´æ¥äº¤ç»™å®ƒæ¥å¤„ç†ï¼Œå› æ­¤å°±ä¸ç”¨å†è°ƒç”¨è¿™ä¸ªViewçš„onInterceptTouchEventå»è¯¢é—®å®ƒæ˜¯å¦è¦æ‹¦æˆªäº†ã€‚</li><li>æŸä¸ªViewä¸€æ—¦å¼€å§‹å¤„ç†äº‹ä»¶ï¼Œå¦‚æœå®ƒä¸æ¶ˆè€—ACTION_DOWNäº‹ä»¶ï¼ˆonTouchEventè¿”å›äº†falseï¼‰ï¼Œé‚£ä¹ˆåŒä¸€äº‹ä»¶åºåˆ—ä¸­çš„å…¶ä»–äº‹ä»¶éƒ½ä¸ä¼šå†äº¤ç»™å®ƒæ¥å¤„ç†ï¼Œå¹¶ä¸”äº‹ä»¶å°†é‡æ–°äº¤ç”±å®ƒçš„çˆ¶å…ƒç´ å»å¤„ç†ï¼Œå³çˆ¶å…ƒç´ çš„onTouchEventä¼šè¢«è°ƒç”¨ã€‚æ„æ€å°±æ˜¯äº‹ä»¶ä¸€æ—¦äº¤ç»™ä¸€ä¸ªViewå¤„ç†ï¼Œé‚£ä¹ˆå®ƒå°±å¿…é¡»æ¶ˆè€—æ‰ï¼Œå¦åˆ™åŒä¸€äº‹ä»¶åºåˆ—ä¸­å‰©ä¸‹çš„äº‹ä»¶å°±ä¸å†äº¤ç»™å®ƒæ¥å¤„ç†äº†ã€‚</li><li>å¦‚æœViewä¸æ¶ˆè€—é™¤ACTION_DOWNä»¥å¤–çš„å…¶ä»–äº‹ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªç‚¹å‡»äº‹ä»¶ä¼šæ¶ˆå¤±ï¼Œæ­¤æ—¶çˆ¶å…ƒç´ çš„onTouchEventå¹¶ä¸ä¼šè¢«è°ƒç”¨ï¼Œå¹¶ä¸”å½“å‰Viewå¯ä»¥æŒç»­æ”¶åˆ°åç»­çš„äº‹ä»¶ï¼Œæœ€ç»ˆè¿™äº›æ¶ˆå¤±çš„ç‚¹å‡»äº‹ä»¶ä¼šä¼ é€’ç»™Activityå¤„ç†ã€‚</li><li>ViewGroupé»˜è®¤ä¸æ‹¦æˆªä»»ä½•äº‹ä»¶ã€‚Androidæºç ä¸­ViewGroupçš„onInterceptTouch-Eventæ–¹æ³•é»˜è®¤è¿”å›falseã€‚</li><li>Viewæ²¡æœ‰onInterceptTouchEventæ–¹æ³•ï¼Œä¸€æ—¦æœ‰ç‚¹å‡»äº‹ä»¶ä¼ é€’ç»™å®ƒï¼Œé‚£ä¹ˆå®ƒçš„onTouchEventæ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ã€‚</li><li>Viewçš„onTouchEventé»˜è®¤éƒ½ä¼šæ¶ˆè€—äº‹ä»¶ï¼ˆè¿”å›trueï¼‰ï¼Œé™¤éå®ƒæ˜¯ä¸å¯ç‚¹å‡»çš„ï¼ˆclickable  å’ŒlongClickableåŒæ—¶ä¸ºfalseï¼‰ã€‚Viewçš„longClickableå±æ€§é»˜è®¤éƒ½ä¸ºfalseï¼Œclickableå±æ€§è¦åˆ†æƒ…å†µï¼Œæ¯”å¦‚Buttonçš„clickableå±æ€§é»˜è®¤ä¸ºtrueï¼Œè€ŒTextViewçš„clickableå±æ€§é»˜è®¤ä¸ºfalseã€‚</li><li>Viewçš„enableå±æ€§ä¸å½±å“onTouchEventçš„é»˜è®¤è¿”å›å€¼ã€‚å“ªæ€•ä¸€ä¸ªViewæ˜¯disableçŠ¶æ€çš„ï¼Œåªè¦å®ƒçš„clickableæˆ–è€…longClickableæœ‰ä¸€ä¸ªä¸ºtrueï¼Œé‚£ä¹ˆå®ƒçš„onTouchEventå°±è¿”å›trueã€‚</li><li>onClickä¼šå‘ç”Ÿçš„å‰ææ˜¯å½“å‰Viewæ˜¯å¯ç‚¹å‡»çš„ï¼Œå¹¶ä¸”å®ƒæ”¶åˆ°äº†downå’Œupçš„äº‹ä»¶ã€‚</li><li>äº‹ä»¶ä¼ é€’è¿‡ç¨‹æ˜¯ç”±å¤–å‘å†…çš„ï¼Œå³äº‹ä»¶æ€»æ˜¯å…ˆä¼ é€’ç»™çˆ¶å…ƒç´ ï¼Œç„¶åå†ç”±çˆ¶å…ƒç´ åˆ†å‘ç»™å­Viewï¼Œé€šè¿‡requestDisallowInterceptTouchEventæ–¹æ³•å¯ä»¥åœ¨å­å…ƒç´ ä¸­å¹²é¢„çˆ¶å…ƒç´ çš„äº‹ä»¶åˆ†å‘è¿‡ç¨‹ï¼Œä½†æ˜¯ACTION_DOWNäº‹ä»¶é™¤å¤–ã€‚</li></ul><h6 id="äº‹ä»¶åˆ†å‘æºç "><a href="#äº‹ä»¶åˆ†å‘æºç " class="headerlink" title="äº‹ä»¶åˆ†å‘æºç "></a>äº‹ä»¶åˆ†å‘æºç </h6><p>** Activityå¯¹ç‚¹å‡»äº‹ä»¶çš„åˆ†å‘è¿‡ç¨‹ **<br>ç‚¹å‡»äº‹ä»¶ç”¨<code>MotionEvent</code>æ¥è¡¨ç¤ºï¼Œå½“ä¸€ä¸ªç‚¹å‡»æ“ä½œå‘ç”Ÿæ—¶ï¼Œäº‹ä»¶æœ€å…ˆä¼ é€’ç»™å½“å‰<code>Activity</code>ï¼Œç”±<code>Activity</code>çš„<code>dispatchTouchEvent</code>æ¥è¿›è¡Œäº‹ä»¶æ´¾å‘ï¼Œå…·ä½“çš„å·¥ä½œæ˜¯ç”±<code>Activity</code>å†…éƒ¨çš„<code>Window</code>æ¥å®Œæˆçš„ã€‚<code>Window</code>ä¼šå°†äº‹ä»¶ä¼ é€’ç»™<code>decor view</code>ï¼Œ<code>decor view</code>ä¸€èˆ¬å°±æ˜¯å½“å‰ç•Œé¢çš„åº•å±‚å®¹å™¨ï¼ˆå³<code>setContentView</code>æ‰€è®¾ç½®çš„<code>View</code>çš„çˆ¶å®¹å™¨ï¼‰ï¼Œé€šè¿‡<code>Activity.getWindow.getDecorView()</code>å¯ä»¥è·å¾—ã€‚æˆ‘ä»¬å…ˆä»<code>Activity</code>çš„<code>dispatchTouchEvent</code>å¼€å§‹åˆ†æã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Called to process touch screen events.  You can override this to</span><br><span class="hljs-comment">    * intercept all touch screen events before they are dispatched to the</span><br><span class="hljs-comment">    * window.  Be sure to call this implementation for touch screen events</span><br><span class="hljs-comment">    * that should be handled normally.</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> ev The touch screen event.</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span> boolean Return true if this event was consumed.</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">dispatchTouchEvent</span><span class="hljs-params">(MotionEvent ev)</span> &#123;<br>       <span class="hljs-keyword">if</span> (ev.getAction() == MotionEvent.ACTION_DOWN) &#123;<br>           onUserInteraction();<br>       &#125;<br>       <span class="hljs-keyword">if</span> (getWindow().superDispatchTouchEvent(ev)) &#123;<br>           <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>       &#125;<br>       <span class="hljs-keyword">return</span> onTouchEvent(ev);<br>   &#125;<br></code></pre></td></tr></table></figure><p>åœ¨windowç±»çš„æ³¨é‡Šä¸­</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs smali">/**<br> * Abstract base class for a top-level window look<span class="hljs-built_in"> and </span>behavior policy.  An<br> *<span class="hljs-built_in"> instance </span>of this class should be used as the top-level view added to the<br> * window manager. It provides standard UI policies such as a background, title<br> * area, default key processing, etc.<br> *<br> * &lt;p&gt;The only existing implementation of this<span class="hljs-keyword"> abstract</span> class is<br> * android.view.PhoneWindow, which you should instantiate when needing a<br> * Window.<br> */<br></code></pre></td></tr></table></figure><p>é¦–å…ˆäº‹ä»¶å¼€å§‹äº¤ç»™<code>Activity</code>æ‰€é™„å±çš„<code>Window</code>è¿›è¡Œåˆ†å‘ï¼Œå¦‚æœè¿”å›<code>true</code>ï¼Œæ•´ä¸ªäº‹ä»¶å¾ªç¯å°±ç»“æŸäº†ï¼Œè¿”å›<code>false</code>æ„å‘³ç€äº‹ä»¶æ²¡äººå¤„ç†ï¼Œæ‰€æœ‰<code>View</code>çš„<code>onTouchEvent</code>éƒ½è¿”å›äº†<code>false</code>ï¼Œé‚£ä¹ˆ<code>Activity</code>çš„<code>onTouchEvent</code>å°±ä¼šè¢«è°ƒç”¨ã€‚<br>å…¶ä¸­<code>Window</code>æ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œè€Œå…¶ä¸­çš„<code>superDispatchTouchEvent</code>æ–¹æ³•ä¹Ÿæ˜¯ä¸ªæŠ½è±¡æ–¹æ³•ã€‚åœ¨<code>PhoneWindows</code>ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">superDispatchTouchEvent</span><span class="hljs-params">(MotionEvent event)</span> &#123;<br>       <span class="hljs-keyword">return</span> mDecor.superDispatchTouchEvent(event);<br>   &#125;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨äº†DecorViewçš„superDispatchTouchEventæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹DecorViewï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DecorView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FrameLayout</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RootViewSurfaceTaker</span>, WindowCallbacks &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">superDispatchTouchEvent</span><span class="hljs-params">(MotionEvent event)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.dispatchTouchEvent(event);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç›®å‰äº‹ä»¶ä¼ é€’åˆ°äº†<code>DecorView</code>è¿™é‡Œï¼Œç”±äº<code>DecorView</code>ç»§æ‰¿è‡ª<code>FrameLayout</code>ä¸”æ˜¯çˆ¶<code>View</code>ï¼Œæ‰€ä»¥æœ€ç»ˆäº‹ä»¶ä¼šä¼ é€’ç»™<code>View</code>ã€‚ä»è¿™é‡Œå¼€å§‹ï¼Œäº‹ä»¶å·²ç»ä¼ é€’åˆ°é¡¶çº§<code>View</code>äº†ï¼Œå³åœ¨<code>Activity</code>ä¸­é€šè¿‡<code>setContentView</code>æ‰€è®¾ç½®çš„<code>View</code>ï¼Œå¦å¤–é¡¶çº§<code>View</code>ä¹Ÿå«æ ¹<code>View</code>ï¼Œé¡¶çº§Viewä¸€èˆ¬æ¥è¯´éƒ½æ˜¯<code>ViewGroup</code>ã€‚</p><p>** é¡¶çº§Viewå¯¹ç‚¹å‡»äº‹ä»¶çš„åˆ†å‘è¿‡ç¨‹ **<br>ç‚¹å‡»äº‹ä»¶è¾¾åˆ°é¡¶çº§<code>View</code>ï¼ˆä¸€èˆ¬æ˜¯ä¸€ä¸ªViewGroupï¼‰ä»¥åï¼Œä¼šè°ƒç”¨<code>ViewGroupçš„dispatchTouchEvent</code>æ–¹æ³•ï¼Œç„¶åçš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼šå¦‚æœé¡¶çº§<code>ViewGroup</code>æ‹¦æˆªäº‹ä»¶å³<code>onInterceptTouchEvent</code>è¿”å›<code>true</code>ï¼Œåˆ™äº‹ä»¶ç”±<code>ViewGroup</code>å¤„ç†ï¼Œè¿™æ—¶å¦‚æœ<code>ViewGroup</code>çš„<code>mOnTouchListener</code>è¢«è®¾ç½®ï¼Œåˆ™<code>onTouch</code>ä¼šè¢«è°ƒç”¨ï¼Œå¦åˆ™<code>onTouchEvent</code>ä¼šè¢«è°ƒç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœéƒ½æä¾›çš„è¯ï¼Œ<code>onTouch</code>ä¼šå±è”½æ‰<code>onTouchEven</code>tã€‚åœ¨<code>onTouchEvent</code>ä¸­ï¼Œå¦‚æœè®¾ç½®äº†<code>mOnClickListener</code>ï¼Œåˆ™<code>onClick</code>ä¼šè¢«è°ƒç”¨ã€‚å¦‚æœé¡¶çº§<code>ViewGroup</code>ä¸æ‹¦æˆªäº‹ä»¶ï¼Œåˆ™äº‹ä»¶ä¼šä¼ é€’ç»™å®ƒæ‰€åœ¨çš„ç‚¹å‡»äº‹ä»¶é“¾ä¸Šçš„å­<code>View</code>ï¼Œè¿™æ—¶å­<code>View</code>çš„<code>dispatchTouchEvent</code>ä¼šè¢«è°ƒç”¨ã€‚åˆ°æ­¤ä¸ºæ­¢ï¼Œäº‹ä»¶å·²ç»ä»é¡¶çº§Viewä¼ é€’ç»™äº†ä¸‹ä¸€å±‚<code>View</code>ï¼Œæ¥ä¸‹æ¥çš„ä¼ é€’è¿‡ç¨‹å’Œé¡¶çº§<code>View</code>æ˜¯ä¸€è‡´çš„ï¼Œå¦‚æ­¤å¾ªç¯ï¼Œå®Œæˆæ•´ä¸ªäº‹ä»¶çš„åˆ†å‘ã€‚å…·ä½“ä»£ç å¯ä»¥çœ‹ä¸€ä¸‹<code>ViewGroup.dispatchTouchEvent()</code>æ–¹æ³•ã€‚</p><p>** Viewå¯¹ç‚¹å‡»äº‹ä»¶çš„å¤„ç† **<br>Viewå¯¹ç‚¹å‡»äº‹ä»¶çš„å¤„ç†è¿‡ç¨‹ç¨å¾®ç®€å•ä¸€äº›ï¼Œè¿™é‡Œçš„Viewä¸åŒ…å«ViewGroupã€‚<br>Viewå¯¹ç‚¹å‡»äº‹ä»¶çš„å¤„ç†è¿‡ç¨‹å°±æ¯”è¾ƒç®€å•äº†ï¼Œå› ä¸ºViewï¼ˆè¿™é‡Œä¸åŒ…å«ViewGroupï¼‰æ˜¯ä¸€ä¸ªå•ç‹¬çš„å…ƒç´ ï¼Œå®ƒæ²¡æœ‰å­å…ƒç´ å› æ­¤æ— æ³•å‘ä¸‹ä¼ é€’äº‹ä»¶ï¼Œæ‰€ä»¥å®ƒåªèƒ½è‡ªå·±å¤„ç†äº‹ä»¶ã€‚ä»ä¸Šé¢çš„æºç å¯ä»¥çœ‹å‡ºViewå¯¹ç‚¹å‡»äº‹ä»¶çš„å¤„ç†è¿‡ç¨‹ï¼Œé¦–å…ˆä¼šåˆ¤æ–­æœ‰æ²¡æœ‰è®¾ç½®OnTouchListenerï¼Œå¦‚æœOnTouchListenerä¸­çš„onTouchæ–¹æ³•è¿”å›trueï¼Œé‚£ä¹ˆonTouchEventå°±ä¸ä¼šè¢«è°ƒç”¨ï¼Œå¯è§OnTouchListenerçš„ä¼˜å…ˆçº§é«˜äºonTouchEventï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯æ–¹ä¾¿åœ¨å¤–ç•Œå¤„ç†ç‚¹å‡»äº‹ä»¶ã€‚æ¥ç€å†åˆ†æonTouchEventçš„å®ç°ã€‚å…ˆçœ‹å½“Viewå¤„äºä¸å¯ç”¨çŠ¶æ€ä¸‹ç‚¹å‡»äº‹ä»¶çš„å¤„ç†è¿‡ç¨‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚å¾ˆæ˜¾ç„¶ï¼Œä¸å¯ç”¨çŠ¶æ€ä¸‹çš„Viewç…§æ ·ä¼šæ¶ˆè€—ç‚¹å‡»äº‹ä»¶ï¼Œå°½ç®¡å®ƒçœ‹èµ·æ¥ä¸å¯ç”¨ã€‚<br>æ¥ç€å†åˆ†æonTouchEventçš„å®ç°ã€‚å…ˆçœ‹å½“Viewå¤„äºä¸å¯ç”¨çŠ¶æ€ä¸‹ç‚¹å‡»äº‹ä»¶çš„å¤„ç†è¿‡ç¨‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚å¾ˆæ˜¾ç„¶ï¼Œä¸å¯ç”¨çŠ¶æ€ä¸‹çš„Viewç…§æ ·ä¼šæ¶ˆè€—ç‚¹å‡»äº‹ä»¶ï¼Œå°½ç®¡å®ƒçœ‹èµ·æ¥ä¸å¯ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> ((viewFlags &amp; ENABLED_MASK) == DISABLED) &#123;<br>           <span class="hljs-keyword">if</span> (action == MotionEvent.ACTION_UP &amp;&amp; (mPrivateFlags &amp; PFLAG_PRESSED) != <span class="hljs-number">0</span>) &#123;<br>               setPressed(<span class="hljs-literal">false</span>);<br>           &#125;<br>           mPrivateFlags3 &amp;= ~PFLAG3_FINGER_DOWN;<br>           <span class="hljs-comment">// A disabled view that is clickable still consumes the touch</span><br>           <span class="hljs-comment">// events, it just doesn&#x27;t respond to them.</span><br>           <span class="hljs-keyword">return</span> clickable;<br>       &#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å¦‚æœViewè®¾ç½®æœ‰ä»£ç†ï¼Œè¿˜ä¼šæ‰§è¡Œä»£ç†çš„onTouchEventæ–¹æ³•ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (mTouchDelegate != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">if</span> (mTouchDelegate.onTouchEvent(event)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯å¯¹äº‹ä»¶åºåˆ—çš„å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (clickable || (viewFlags &amp; TOOLTIP) == TOOLTIP) &#123;<br>            <span class="hljs-keyword">switch</span> (action) &#123;<br>                <span class="hljs-keyword">case</span> MotionEvent.ACTION_UP:<span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">case</span> MotionEvent.ACTION_DOWN:<span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">case</span> MotionEvent.ACTION_CANCEL:<span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">case</span> MotionEvent.ACTION_MOVE:<span class="hljs-keyword">break</span>;<br>            &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„ä»£ç æ¥çœ‹ï¼Œåªè¦Viewçš„<code>CLICKABLE</code>å’Œ<code>LONG_CLICKABLE</code>æœ‰ä¸€ä¸ªä¸ºtrueï¼Œé‚£ä¹ˆå®ƒå°±ä¼šæ¶ˆè€—è¿™ä¸ªäº‹ä»¶ï¼Œå³<code>onTouchEvent</code>æ–¹æ³•è¿”å›trueï¼Œä¸ç®¡å®ƒæ˜¯ä¸æ˜¯<code>DISABLE</code>çŠ¶æ€ï¼Œç„¶åå°±æ˜¯å½“<code>ACTION_UP</code>äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä¼šè§¦å‘<code>performClick</code>æ–¹æ³•ï¼Œå¦‚æœViewè®¾ç½®äº†<code>OnClickListener</code>ï¼Œé‚£ä¹ˆ<code>performClick</code>æ–¹æ³•å†…éƒ¨ä¼šè°ƒç”¨å®ƒçš„<code>onClick</code>æ–¹æ³•ã€‚<code>View</code>çš„<code>LONG_CLICKABLE</code>å±æ€§é»˜è®¤ä¸º<code>false</code>ï¼Œè€Œ<code>CLICKABLE</code>å±æ€§æ˜¯å¦ä¸º<code>false</code>å’Œå…·ä½“çš„Viewæœ‰å…³ï¼Œç¡®åˆ‡æ¥è¯´æ˜¯å¯ç‚¹å‡»çš„Viewå…¶<code>CLICKABLEä¸ºtrue</code>ï¼Œä¸å¯ç‚¹å‡»çš„Viewå…¶<code>CLICKABLE</code>ä¸º<code>false</code>ï¼Œæ¯”å¦‚<code>Button</code>æ˜¯å¯ç‚¹å‡»çš„ï¼Œ<code>TextView</code>æ˜¯ä¸å¯ç‚¹å‡»çš„ã€‚é€šè¿‡<code>setClickable</code>å’Œ<code>setLongClickable</code>å¯ä»¥åˆ†åˆ«æ”¹å˜<code>View</code>çš„<code>CLICKABLE</code>å’Œ<code>LONG_CLICKABLE</code>å±æ€§ã€‚å¦å¤–ï¼Œ<code>setOnClickListener</code>ä¼šè‡ªåŠ¨å°†<code>View</code>çš„<code>CLICKABLE</code>è®¾ä¸º<code>true</code>ï¼Œs<code>etOnLongClickListener</code>åˆ™ä¼šè‡ªåŠ¨å°†<code>View</code>çš„<code>LONG_CLICKABLE</code>è®¾ä¸º<code>true</code>ã€‚</p><h6 id="å¤„ç†æ»‘åŠ¨å†²çª"><a href="#å¤„ç†æ»‘åŠ¨å†²çª" class="headerlink" title="å¤„ç†æ»‘åŠ¨å†²çª"></a>å¤„ç†æ»‘åŠ¨å†²çª</h6><p>äº†è§£äº†ç‚¹å‡»äº‹ä»¶çš„å¤„ç†è¿‡ç¨‹ï¼Œå°±å¯ä»¥æ¯”è¾ƒå¥½çš„å¤„ç†æ»‘åŠ¨å†²çªäº†</p><p>** çˆ¶å®¹å™¨æ‹¦æˆªå¤„ç† **<br>å‡»äº‹æƒ…éƒ½å…ˆç»è¿‡çˆ¶å®¹å™¨çš„æ‹¦æˆªå¤„ç†ï¼Œå¦‚æœçˆ¶å®¹å™¨éœ€è¦æ­¤äº‹ä»¶å°±æ‹¦æˆªï¼Œå¦‚æœä¸éœ€è¦æ­¤äº‹ä»¶å°±ä¸æ‹¦æˆªã€‚å¤–éƒ¨æ‹¦æˆªæ³•éœ€è¦é‡å†™çˆ¶å®¹å™¨çš„onInterceptTouchEventæ–¹æ³•ï¼Œåœ¨å†…éƒ¨åšç›¸åº”çš„æ‹¦æˆªå³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onInterceptTouchEvent</span><span class="hljs-params">(MotionEvent event)</span> &#123;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">intercepted</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) event.getX();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) event.getY();<br>    <span class="hljs-keyword">switch</span> (event.getAction()) &#123;<br>        <span class="hljs-keyword">case</span> MotionEvent.ACTION_DOWN: &#123;<br>            intercepted = <span class="hljs-literal">false</span>;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">case</span> MotionEvent.ACTION_MOVE: &#123;<br>            <span class="hljs-keyword">if</span> (çˆ¶å®¹å™¨éœ€è¦å½“å‰ç‚¹å‡»äº‹ä»¶) &#123;<br>                intercepted = <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                intercepted = <span class="hljs-literal">false</span>;<br>            &#125;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">case</span> MotionEvent.ACTION_UP: &#123;<br>            intercepted = <span class="hljs-literal">false</span>;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">break</span>;<br>    &#125;<br>    mLastXIntercept = x;<br>    mLastYIntercept = y;<br>    <span class="hljs-keyword">return</span> intercepted;<br>&#125;<br></code></pre></td></tr></table></figure><p>é’ˆå¯¹ä¸åŒçš„æ»‘åŠ¨å†²çªï¼Œåªéœ€è¦ä¿®æ”¹çˆ¶å®¹å™¨éœ€è¦å½“å‰ç‚¹å‡»äº‹ä»¶è¿™ä¸ªæ¡ä»¶å³å¯ï¼Œå…¶ä»–å‡ä¸éœ€åšä¿®æ”¹å¹¶ä¸”ä¹Ÿä¸èƒ½ä¿®æ”¹ã€‚è¿™é‡Œå¯¹ä¸Šè¿°ä»£ç å†æè¿°ä¸€ä¸‹ï¼Œåœ¨<code>onInterceptTouchEvent</code>æ–¹æ³•ä¸­ï¼Œé¦–å…ˆæ˜¯<code>ACTION_DOWN</code>è¿™ä¸ªäº‹ä»¶ï¼Œçˆ¶å®¹å™¨å¿…é¡»è¿”å›<code>false</code>ï¼Œå³ä¸æ‹¦æˆª<code>ACTION_DOWN</code>äº‹ä»¶ï¼Œè¿™æ˜¯å› ä¸ºä¸€æ—¦çˆ¶å®¹å™¨æ‹¦æˆªäº†<code>ACTION_DOWN</code>ï¼Œé‚£ä¹ˆåç»­çš„<code>ACTION_MOVE</code>å’Œ<code>ACTION_UP</code>äº‹ä»¶éƒ½ä¼šç›´æ¥äº¤ç”±çˆ¶å®¹å™¨å¤„ç†ï¼Œè¿™ä¸ªæ—¶å€™äº‹ä»¶æ²¡æ³•å†ä¼ é€’ç»™å­å…ƒç´ äº†ï¼›å…¶æ¬¡æ˜¯<code>ACTION_MOVE</code>äº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶å¯ä»¥æ ¹æ®éœ€è¦æ¥å†³å®šæ˜¯å¦æ‹¦æˆªï¼Œå¦‚æœçˆ¶å®¹å™¨éœ€è¦æ‹¦æˆªå°±è¿”å›<code>true</code>ï¼Œå¦åˆ™è¿”å›<code>false</code>ï¼›æœ€åæ˜¯<code>ACTION_UP</code>äº‹ä»¶ï¼Œè¿™é‡Œå¿…é¡»è¦è¿”å›falseï¼Œå› ä¸º<code>ACTION_UP</code>äº‹ä»¶æœ¬èº«æ²¡æœ‰å¤ªå¤šæ„ä¹‰ã€‚å‡è®¾äº‹ä»¶äº¤ç”±å­å…ƒç´ å¤„ç†ï¼Œå¦‚æœçˆ¶å®¹å™¨åœ¨<code>ACTION_UP</code>æ—¶è¿”å›äº†<code>true</code>ï¼Œå°±ä¼šå¯¼è‡´å­å…ƒç´ æ— æ³•æ¥æ”¶åˆ°<code>ACTION_UP</code>äº‹ä»¶ï¼Œè¿™ä¸ªæ—¶å€™å­å…ƒç´ ä¸­çš„<code>onClick</code>äº‹ä»¶å°±æ— æ³•è§¦å‘ï¼Œä½†æ˜¯çˆ¶å®¹å™¨æ¯”è¾ƒç‰¹æ®Šï¼Œä¸€æ—¦å®ƒå¼€å§‹æ‹¦æˆªä»»ä½•ä¸€ä¸ªäº‹ä»¶ï¼Œé‚£ä¹ˆåç»­çš„äº‹ä»¶éƒ½ä¼šäº¤ç»™å®ƒæ¥å¤„ç†ï¼Œè€Œ<code>ACTION_UP</code>ä½œä¸ºæœ€åä¸€ä¸ªäº‹ä»¶ä¹Ÿå¿…å®šå¯ä»¥ä¼ é€’ç»™çˆ¶å®¹å™¨ï¼Œå³ä¾¿çˆ¶å®¹å™¨çš„<code>onInterceptTouchEvent</code>æ–¹æ³•åœ¨<code>ACTION_UP</code>æ—¶è¿”å›äº†<code>false</code>ã€‚</p><p>** å­å…ƒç´ æ‹¦æˆªäº‹ä»¶ **<br>çˆ¶å®¹å™¨ä¸æ‹¦æˆªä»»ä½•äº‹ä»¶ï¼Œæ‰€æœ‰çš„äº‹ä»¶éƒ½ä¼ é€’ç»™å­å…ƒç´ ï¼Œå¦‚æœå­å…ƒç´ éœ€è¦æ­¤äº‹ä»¶å°±ç›´æ¥æ¶ˆè€—æ‰ï¼Œå¦åˆ™å°±äº¤ç”±çˆ¶å®¹å™¨è¿›è¡Œå¤„ç†ï¼Œè¿™ç§æ–¹æ³•å’ŒAndroidä¸­çš„äº‹ä»¶åˆ†å‘æœºåˆ¶ä¸ä¸€è‡´ï¼Œéœ€è¦é…åˆ<code>requestDisallowInterceptTouchEvent()</code>æ–¹æ³•æ‰èƒ½æ­£å¸¸å·¥ä½œï¼Œä½¿ç”¨èµ·æ¥è¾ƒå¤–éƒ¨æ‹¦æˆªæ³•ç¨æ˜¾å¤æ‚ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">dispatchTouchEvent</span><span class="hljs-params">(MotionEvent event)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) event.getX();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) event.getY();<br>    <span class="hljs-keyword">switch</span> (event.getAction()) &#123;<br>        <span class="hljs-keyword">case</span> MotionEvent.ACTION_DOWN: &#123;<br>            parent.requestDisallowInterceptTouchEvent(<span class="hljs-literal">true</span>);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">case</span> MotionEvent.ACTION_MOVE: &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">deltaX</span> <span class="hljs-operator">=</span> x -mLastX;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">deltaY</span> <span class="hljs-operator">=</span> y -mLastY;<br>            <span class="hljs-keyword">if</span> (çˆ¶å®¹å™¨éœ€è¦æ­¤ç±»ç‚¹å‡»äº‹ä»¶)) &#123;<br>                parent.requestDisallowInterceptTouchEvent(<span class="hljs-literal">false</span>);<br>            &#125;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">case</span> MotionEvent.ACTION_UP: &#123;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    mLastX = x;<br>    mLastY = y;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.dispatchTouchEvent(event);<br>&#125;<br></code></pre></td></tr></table></figure><p>é™¤äº†å­å…ƒç´ éœ€è¦åšå¤„ç†ä»¥å¤–ï¼Œçˆ¶å…ƒç´ ä¹Ÿè¦é»˜è®¤æ‹¦æˆªé™¤äº†<code>ACTION_DOWN</code>ä»¥å¤–çš„å…¶ä»–äº‹ä»¶ï¼Œè¿™æ ·å½“å­å…ƒç´ è°ƒç”¨<code>parent.requestDisallowInterceptTouchEvent(false)</code>æ–¹æ³•æ—¶ï¼Œçˆ¶å…ƒç´ æ‰èƒ½ç»§ç»­æ‹¦æˆªæ‰€éœ€çš„äº‹ä»¶ã€‚å› ä¸º<code>ACTION_DOWN</code>äº‹ä»¶å¹¶ä¸å—<code>FLAG_DISALLOW_INTERCEPT</code>è¿™ä¸ªæ ‡è®°ä½çš„æ§åˆ¶ï¼Œæ‰€ä»¥ä¸€æ—¦çˆ¶å®¹å™¨æ‹¦æˆª<code>ACTION_DOWN</code>äº‹ä»¶ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„äº‹ä»¶éƒ½æ— æ³•ä¼ é€’åˆ°å­å…ƒç´ ä¸­å»ï¼Œè¿™æ ·å†…éƒ¨æ‹¦æˆªå°±æ— æ³•èµ·ä½œç”¨äº†ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Activityå¯åŠ¨æ¨¡å¼ï¼Œå¯åŠ¨è¿‡ç¨‹</title>
    <link href="/2018/07/26/Activity%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%EF%BC%8C%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B/"/>
    <url>/2018/07/26/Activity%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%EF%BC%8C%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<p>é¢è¯•æ€»ç»“ï¼Œå…³äºActivityå¯åŠ¨æ¨¡å¼ã€å¯åŠ¨è¿‡ç¨‹ï¼ŒIntentåŒ¹é…è§„åˆ™ã€Appå¯åŠ¨æµç¨‹ç­‰</p><span id="more"></span><h5 id="å¯åŠ¨æ¨¡å¼ï¼š"><a href="#å¯åŠ¨æ¨¡å¼ï¼š" class="headerlink" title="å¯åŠ¨æ¨¡å¼ï¼š"></a>å¯åŠ¨æ¨¡å¼ï¼š</h5><ul><li>standardï¼šæ ‡å‡†æ¨¡å¼ï¼Œè¿™ä¹Ÿæ˜¯ç³»ç»Ÿçš„é»˜è®¤æ¨¡å¼ã€‚æ¯æ¬¡å¯åŠ¨ä¸€ä¸ªActivityéƒ½ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œä¸ç®¡è¿™ä¸ªå®ä¾‹æ˜¯å¦å·²ç»å­˜åœ¨ã€‚</li><li>singleTopï¼šæ ˆé¡¶å¤ç”¨æ¨¡å¼ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå¦‚æœæ–°Activityå·²ç»ä½äºä»»åŠ¡æ ˆçš„æ ˆé¡¶ï¼Œé‚£ä¹ˆæ­¤Activityä¸ä¼šè¢«é‡æ–°åˆ›å»ºï¼ŒåŒæ—¶å®ƒçš„onNewIntentæ–¹æ³•ä¼šè¢«å›è°ƒï¼Œé€šè¿‡æ­¤æ–¹æ³•çš„å‚æ•°æˆ‘ä»¬å¯ä»¥å–å‡ºå½“å‰è¯·æ±‚çš„ä¿¡æ¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªActivityçš„onCreateã€onStartä¸ä¼šè¢«ç³»ç»Ÿè°ƒç”¨ï¼Œå› ä¸ºå®ƒå¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚å¦‚æœæ–°Activityçš„å®ä¾‹å·²å­˜åœ¨ä½†ä¸æ˜¯ä½äºæ ˆé¡¶ï¼Œé‚£ä¹ˆæ–°Activityä»ç„¶ä¼šé‡æ–°é‡å»ºã€‚</li><li>singleTaskï¼šæ ˆå†…å¤ç”¨æ¨¡å¼ã€‚è¿™æ˜¯ä¸€ç§å•å®ä¾‹æ¨¡å¼ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œåªè¦Activityåœ¨ä¸€ä¸ªæ ˆä¸­å­˜åœ¨ï¼Œé‚£ä¹ˆå¤šæ¬¡å¯åŠ¨æ­¤Activityéƒ½ä¸ä¼šé‡æ–°åˆ›å»ºå®ä¾‹ï¼Œå’ŒsingleTopä¸€æ ·ï¼Œç³»ç»Ÿä¹Ÿä¼šå›è°ƒå…¶onNewIntentã€‚</li><li>singleInstanceï¼šå•å®ä¾‹æ¨¡å¼ã€‚è¿™æ˜¯ä¸€ç§åŠ å¼ºçš„singleTaskæ¨¡å¼ï¼Œå®ƒé™¤äº†å…·æœ‰singleTaskæ¨¡å¼çš„æ‰€æœ‰ç‰¹æ€§å¤–ï¼Œè¿˜åŠ å¼ºäº†ä¸€ç‚¹ï¼Œé‚£å°±æ˜¯å…·æœ‰æ­¤ç§æ¨¡å¼çš„Activityåªèƒ½å•ç‹¬åœ°ä½äºä¸€ä¸ªä»»åŠ¡æ ˆä¸­ï¼Œ</li></ul><p>è¿˜æœ‰ä¸€ä¸ªå‚æ•° <code>TaskAffinity</code>,è¿™ä¸ªå‚æ•°æ ‡è¯†äº†ä¸€ä¸ªActivityæ‰€éœ€è¦çš„ä»»åŠ¡æ ˆçš„åå­—ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰Activityæ‰€éœ€çš„ä»»åŠ¡æ ˆçš„åå­—ä¸ºåº”ç”¨çš„åŒ…åã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªActivityéƒ½å•ç‹¬æŒ‡å®šTaskAffinityå±æ€§ï¼Œè¿™ä¸ªå±æ€§å€¼å¿…é¡»ä¸èƒ½å’ŒåŒ…åç›¸åŒï¼Œå¦åˆ™å°±ç›¸å½“äºæ²¡æœ‰æŒ‡å®šã€‚TaskAffinityå±æ€§ä¸»è¦å’ŒsingleTaskå¯åŠ¨æ¨¡å¼æˆ–è€…allowTaskReparentingå±æ€§é…å¯¹ä½¿ç”¨ï¼Œåœ¨å…¶ä»–æƒ…å†µä¸‹æ²¡æœ‰æ„ä¹‰ã€‚<br>è¿˜æœ‰Activityä¸­èƒ½å¤Ÿå½±å“å¯åŠ¨æ¨¡å¼ã€è¿è¡ŒçŠ¶æ€çš„æ ‡è®°ä½ï¼š</p><p>** FLAG_ACTIVITY_NEW_TASK **<br>è¿™ä¸ªæ ‡è®°ä½çš„ä½œç”¨æ˜¯ä¸ºActivityæŒ‡å®šâ€œsingleTaskâ€å¯åŠ¨æ¨¡å¼ï¼Œå…¶æ•ˆæœå’Œåœ¨XMLä¸­æŒ‡å®šè¯¥å¯åŠ¨æ¨¡å¼ç›¸åŒã€‚<br>** FLAG_ACTIVITY_SINGLE_TOP **<br>è¿™ä¸ªæ ‡è®°ä½çš„ä½œç”¨æ˜¯ä¸ºActivityæŒ‡å®šâ€œsingleTopâ€å¯åŠ¨æ¨¡å¼ï¼Œå…¶æ•ˆæœå’Œåœ¨XMLä¸­æŒ‡å®šè¯¥å¯åŠ¨æ¨¡å¼ç›¸åŒã€‚<br>** FLAG_ACTIVITY_CLEAR_TOP **<br>å…·æœ‰æ­¤æ ‡è®°ä½çš„Activityï¼Œå½“å®ƒå¯åŠ¨æ—¶ï¼Œåœ¨åŒä¸€ä¸ªä»»åŠ¡æ ˆä¸­æ‰€æœ‰ä½äºå®ƒä¸Šé¢çš„Activityéƒ½è¦å‡ºæ ˆã€‚è¿™ä¸ªæ¨¡å¼ä¸€èˆ¬éœ€è¦å’ŒFLAG_ACTIVITY_NEW_TASKé…åˆä½¿ç”¨ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¢«å¯åŠ¨Activityçš„å®ä¾‹å¦‚æœå·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šè°ƒç”¨å®ƒçš„onNewIntentã€‚å¦‚æœè¢«å¯åŠ¨çš„Activityé‡‡ç”¨standardæ¨¡å¼å¯åŠ¨ï¼Œé‚£ä¹ˆå®ƒè¿åŒå®ƒä¹‹ä¸Šçš„Activityéƒ½è¦å‡ºæ ˆï¼Œç³»ç»Ÿä¼šåˆ›å»ºæ–°çš„Activityå®ä¾‹å¹¶æ”¾å…¥æ ˆé¡¶ã€‚é€šè¿‡1.2.1èŠ‚ä¸­çš„åˆ†æå¯ä»¥çŸ¥é“ï¼ŒsingleTaskå¯åŠ¨æ¨¡å¼é»˜è®¤å°±å…·æœ‰æ­¤æ ‡è®°ä½çš„æ•ˆæœã€‚<br>** FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS **<br>å…·æœ‰è¿™ä¸ªæ ‡è®°çš„Activityä¸ä¼šå‡ºç°åœ¨å†å²Activityçš„åˆ—è¡¨ä¸­ï¼Œå½“æŸäº›æƒ…å†µä¸‹æˆ‘ä»¬ä¸å¸Œæœ›ç”¨æˆ·é€šè¿‡å†å²åˆ—è¡¨å›åˆ°æˆ‘ä»¬çš„Activityçš„æ—¶å€™è¿™ä¸ªæ ‡è®°æ¯”è¾ƒæœ‰ç”¨ã€‚å®ƒç­‰åŒäºåœ¨XMLä¸­æŒ‡å®šActivityçš„å±æ€§android:excludeFromRecents&#x3D;â€trueâ€ã€‚</p><h5 id="IntentåŒ¹é…è§„åˆ™"><a href="#IntentåŒ¹é…è§„åˆ™" class="headerlink" title="IntentåŒ¹é…è§„åˆ™"></a>IntentåŒ¹é…è§„åˆ™</h5><p>å¯åŠ¨Activityåˆ†ä¸ºä¸¤ç§ï¼Œæ˜¾å¼è°ƒç”¨å’Œéšå¼è°ƒç”¨ã€‚æ˜¾å¼è°ƒç”¨éœ€è¦æ˜ç¡®åœ°æŒ‡å®šè¢«å¯åŠ¨å¯¹è±¡çš„ç»„ä»¶ä¿¡æ¯ï¼ŒåŒ…æ‹¬åŒ…åå’Œç±»åï¼Œè€Œéšå¼è°ƒç”¨åˆ™ä¸éœ€è¦æ˜ç¡®æŒ‡å®šç»„ä»¶ä¿¡æ¯ã€‚åŸåˆ™ä¸Šä¸€ä¸ªIntentä¸åº”è¯¥æ—¢æ˜¯æ˜¾å¼è°ƒç”¨åˆæ˜¯éšå¼è°ƒç”¨ï¼Œå¦‚æœäºŒè€…<br>å…±å­˜çš„è¯ä»¥æ˜¾å¼è°ƒç”¨ä¸ºä¸»ã€‚æ˜¾å¼è°ƒç”¨å¾ˆç®€å•ï¼Œè¿™é‡Œä¸»è¦ä»‹ç»ä¸€ä¸‹éšå¼è°ƒç”¨ã€‚éšå¼è°ƒç”¨éœ€è¦Intentèƒ½å¤ŸåŒ¹é…ç›®æ ‡ç»„ä»¶çš„IntentFilterä¸­æ‰€è®¾ç½®çš„è¿‡æ»¤ä¿¡æ¯ï¼Œå¦‚æœä¸åŒ¹é…å°†æ— æ³•å¯åŠ¨ç›®æ ‡Activityã€‚<br>ä¸ºäº†åŒ¹é…è¿‡æ»¤åˆ—è¡¨ï¼Œéœ€è¦åŒæ—¶åŒ¹é…è¿‡æ»¤åˆ—è¡¨ä¸­çš„actionã€categoryã€dataä¿¡æ¯ï¼Œå¦åˆ™åŒ¹é…å¤±è´¥ã€‚ä¸€ä¸ªè¿‡æ»¤åˆ—è¡¨ä¸­çš„actionã€categoryå’Œdataå¯ä»¥æœ‰å¤šä¸ªï¼Œæ‰€æœ‰çš„actionã€categoryã€dataåˆ†åˆ«æ„æˆä¸åŒç±»åˆ«ï¼ŒåŒä¸€ç±»åˆ«çš„ä¿¡æ¯å…±åŒçº¦æŸå½“å‰ç±»åˆ«çš„åŒ¹é…è¿‡ç¨‹ã€‚åªæœ‰ä¸€ä¸ªIntentåŒæ—¶åŒ¹é…actionç±»åˆ«ã€categoryç±»åˆ«ã€dataç±»åˆ«æ‰ç®—å®Œå…¨åŒ¹é…ï¼Œåªæœ‰å®Œå…¨åŒ¹é…æ‰èƒ½æˆåŠŸå¯åŠ¨ç›®æ ‡Activityã€‚å¦å¤–ä¸€ç‚¹ï¼Œä¸€ä¸ªActivityä¸­å¯ä»¥æœ‰å¤šä¸ªintent-filterï¼Œä¸€ä¸ªIntentåªè¦èƒ½åŒ¹é…ä»»ä½•ä¸€ç»„intent-filterå³å¯æˆåŠŸå¯åŠ¨å¯¹åº”çš„Activityã€‚</p><ul><li>actionçš„åŒ¹é…è§„åˆ™<br>actionæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç³»ç»Ÿé¢„å®šä¹‰äº†ä¸€äº›actionï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨åº”ç”¨ä¸­å®šä¹‰è‡ªå·±çš„actionã€‚actionçš„åŒ¹é…è§„åˆ™æ˜¯Intentä¸­çš„actionå¿…é¡»èƒ½å¤Ÿå’Œè¿‡æ»¤è§„åˆ™ä¸­çš„actionåŒ¹é…ï¼Œè¿™é‡Œè¯´çš„åŒ¹é…æ˜¯æŒ‡actionçš„å­—ç¬¦ä¸²å€¼å®Œå…¨ä¸€æ ·ã€‚ä¸€ä¸ªè¿‡æ»¤è§„åˆ™ä¸­å¯ä»¥æœ‰å¤šä¸ªactionï¼Œé‚£ä¹ˆåªè¦Intentä¸­çš„actionèƒ½å¤Ÿå’Œè¿‡æ»¤è§„åˆ™ä¸­çš„ä»»ä½•ä¸€ä¸ªactionç›¸åŒå³å¯åŒ¹é…æˆåŠŸã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒIntentä¸­å¦‚æœæ²¡æœ‰æŒ‡å®šactionï¼Œé‚£ä¹ˆåŒ¹é…å¤±è´¥ã€‚å¦å¤–ï¼ŒactionåŒºåˆ†å¤§å°å†™ï¼Œå¤§å°å†™ä¸åŒå­—ç¬¦ä¸²ç›¸åŒçš„actionä¼šåŒ¹é…å¤±è´¥ã€‚</li><li>categoryçš„åŒ¹é…è§„åˆ™<br>categoryæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç³»ç»Ÿé¢„å®šä¹‰äº†ä¸€äº›categoryï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨åº”ç”¨ä¸­å®šä¹‰è‡ªå·±çš„categoryã€‚categoryçš„åŒ¹é…è§„åˆ™å’Œactionä¸åŒï¼Œå®ƒè¦æ±‚Intentä¸­å¦‚æœå«æœ‰categoryï¼Œé‚£ä¹ˆæ‰€æœ‰çš„categoryéƒ½å¿…é¡»å’Œè¿‡æ»¤è§„åˆ™ä¸­çš„å…¶ä¸­ä¸€ä¸ªcategoryç›¸åŒã€‚æ¢å¥è¯è¯´ï¼ŒIntentä¸­å¦‚æœå‡ºç°äº†categoryï¼Œä¸ç®¡æœ‰å‡ ä¸ªcategoryï¼Œå¯¹äºæ¯ä¸ªcategoryæ¥è¯´ï¼Œå®ƒå¿…é¡»æ˜¯è¿‡æ»¤è§„åˆ™ä¸­å·²ç»å®šä¹‰äº†çš„categoryã€‚å½“ç„¶ï¼ŒIntentä¸­å¯ä»¥æ²¡æœ‰categoryï¼Œå¦‚æœæ²¡æœ‰categoryçš„è¯ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æè¿°ï¼Œè¿™ä¸ªIntentä»ç„¶å¯ä»¥åŒ¹é…æˆåŠŸã€‚è¿™é‡Œè¦æ³¨æ„ä¸‹å®ƒå’ŒactionåŒ¹é…è¿‡ç¨‹çš„ä¸åŒï¼Œactionæ˜¯è¦æ±‚Intentä¸­å¿…é¡»æœ‰ä¸€ä¸ªactionä¸”å¿…é¡»èƒ½å¤Ÿå’Œè¿‡æ»¤è§„åˆ™ä¸­çš„æŸä¸ªactionç›¸åŒï¼Œè€Œcategoryè¦æ±‚<br>Intentå¯ä»¥æ²¡æœ‰categoryï¼Œä½†æ˜¯å¦‚æœä½ ä¸€æ—¦æœ‰categoryï¼Œä¸ç®¡æœ‰å‡ ä¸ªï¼Œæ¯ä¸ªéƒ½è¦èƒ½å¤Ÿå’Œè¿‡æ»¤è§„åˆ™ä¸­çš„ä»»ä½•ä¸€ä¸ªcategoryç›¸åŒã€‚</li><li>dataçš„åŒ¹é…è§„åˆ™<br>dataçš„åŒ¹é…è§„åˆ™å’Œactionç±»ä¼¼ï¼Œå¦‚æœè¿‡æ»¤è§„åˆ™ä¸­å®šä¹‰äº†dataï¼Œé‚£ä¹ˆIntentä¸­å¿…é¡»ä¹Ÿè¦å®šä¹‰å¯åŒ¹é…çš„dataã€‚åœ¨ä»‹ç»dataçš„åŒ¹é…è§„åˆ™ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€ä¸‹dataçš„ç»“æ„ï¼Œå› ä¸ºdataç¨å¾®æœ‰äº›å¤æ‚<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">data</span>   <span class="hljs-attr">android:scheme</span>=<span class="hljs-string">&quot;string&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:host</span>=<span class="hljs-string">&quot;string&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:port</span>=<span class="hljs-string">&quot;string&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:path</span>=<span class="hljs-string">&quot;string&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:pathPattern</span>=<span class="hljs-string">&quot;string&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:pathPrefix</span>=<span class="hljs-string">&quot;string&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:mimeType</span>=<span class="hljs-string">&quot;string&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>dataç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼ŒmimeTypeå’ŒURIã€‚mimeTypeæŒ‡åª’ä½“ç±»å‹ï¼Œæ¯”å¦‚image&#x2F;jpegã€audio&#x2F;mpeg4-genericå’Œvideo&#x2F;*ç­‰ï¼Œå¯ä»¥è¡¨ç¤ºå›¾ç‰‡ã€æ–‡æœ¬ã€è§†é¢‘ç­‰ä¸åŒçš„åª’ä½“æ ¼å¼ï¼Œè€ŒURIä¸­åŒ…å«çš„æ•°æ®å°±æ¯”è¾ƒå¤šäº†ï¼Œä¸‹é¢æ˜¯URIçš„ç»“æ„ï¼š<br><code>&lt;scheme&gt;://&lt;host&gt;:&lt;port&gt;/[&lt;path&gt;|&lt;pathPrefix&gt;|&lt;pathPattern&gt;]</code><br>æœ‰å¦‚ä¸‹è¿‡æ»¤è§„åˆ™</li></ul><p><code>&lt;data android:mimeType=&quot;image/*&quot; /&gt;</code><br>è¿™ç§è§„åˆ™æŒ‡å®šäº†åª’ä½“ç±»å‹ä¸ºæ‰€æœ‰ç±»å‹çš„å›¾ç‰‡ï¼Œé‚£ä¹ˆIntentä¸­çš„mimeTypeå±æ€§å¿…é¡»ä¸ºâ€œimage&#x2F;*â€æ‰èƒ½åŒ¹é…ï¼Œè¿™ç§æƒ…å†µä¸‹è™½ç„¶è¿‡æ»¤è§„åˆ™æ²¡æœ‰æŒ‡å®šURIï¼Œä½†æ˜¯å´æœ‰é»˜è®¤å€¼ï¼ŒURIçš„é»˜è®¤å€¼ä¸ºcontentå’Œfileã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶æ²¡æœ‰æŒ‡å®šURIï¼Œä½†æ˜¯Intentä¸­çš„URIéƒ¨åˆ†çš„schemaå¿…é¡»ä¸ºcontentæˆ–è€…fileæ‰èƒ½åŒ¹é…ï¼Œè¿™ç‚¹æ˜¯éœ€è¦å°¤å…¶æ³¨æ„çš„ã€‚ä¸ºäº†åŒ¹é…ä¸Šé¢ä¸­è§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡ºå¦‚ä¸‹ç¤ºä¾‹<br><code>intent.setDataAndType(Uri.parse(&quot;file://abc&quot;),&quot;image/png&quot;)ã€‚</code><br>å¦å¤–ï¼Œå¦‚æœè¦ä¸ºIntentæŒ‡å®šå®Œæ•´çš„dataï¼Œå¿…é¡»è¦è°ƒç”¨setDataAndTypeæ–¹æ³•ï¼Œä¸èƒ½å…ˆè°ƒç”¨setDataå†è°ƒç”¨setTypeï¼Œå› ä¸ºè¿™ä¸¤ä¸ªæ–¹æ³•å½¼æ­¤ä¼šæ¸…é™¤å¯¹æ–¹çš„å€¼ã€‚<br>æœ€åï¼Œå½“æˆ‘ä»¬é€šè¿‡éšå¼æ–¹å¼å¯åŠ¨ä¸€ä¸ªActivityçš„æ—¶å€™ï¼Œå¯ä»¥åšä¸€ä¸‹åˆ¤æ–­ï¼Œçœ‹æ˜¯å¦æœ‰Activityèƒ½å¤ŸåŒ¹é…æˆ‘ä»¬çš„éšå¼Intentï¼Œå¦‚æœä¸åšåˆ¤æ–­å°±æœ‰å¯èƒ½å‡ºç°ä¸Šè¿°çš„é”™è¯¯äº†ã€‚åˆ¤æ–­æ–¹æ³•æœ‰ä¸¤ç§ï¼šé‡‡ç”¨PackageManagerçš„resolveActivityæ–¹æ³•æˆ–è€…Intentçš„resolveActivityæ–¹æ³•ï¼Œå¦‚æœå®ƒä»¬æ‰¾ä¸åˆ°åŒ¹é…çš„Activityå°±ä¼šè¿”å›nullï¼Œæˆ‘ä»¬é€šè¿‡åˆ¤æ–­è¿”å›å€¼å°±å¯ä»¥è§„é¿ä¸Šè¿°é”™è¯¯äº†ã€‚å¦å¤–ï¼ŒPackageManagerè¿˜æä¾›äº†queryIntentActivitiesæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å’ŒresolveActivityæ–¹æ³•ä¸åŒçš„æ˜¯ï¼šå®ƒä¸æ˜¯è¿”å›æœ€ä½³åŒ¹é…çš„Activityä¿¡æ¯è€Œæ˜¯è¿”å›æ‰€æœ‰æˆåŠŸåŒ¹é…çš„Activityä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> List&lt;ResolveInfo&gt; <span class="hljs-title function_">queryIntentActivities</span><span class="hljs-params">(Intent intent,<span class="hljs-type">int</span> flags)</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> ResolveInfo <span class="hljs-title function_">resolveActivity</span><span class="hljs-params">(Intent intent,<span class="hljs-type">int</span> flags)</span>;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä¸¤ä¸ªæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ¯”è¾ƒå¥½ç†è§£ï¼Œç¬¬äºŒä¸ªå‚æ•°éœ€è¦æ³¨æ„ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨MATCH_DEFAULT_ONLYè¿™ä¸ªæ ‡è®°ä½ï¼Œè¿™ä¸ªæ ‡è®°ä½çš„å«ä¹‰æ˜¯ä»…ä»…åŒ¹é…é‚£äº›åœ¨intent-filterä¸­å£°æ˜äº†<br><code>&lt;category  android:name=&quot;android.intent.category.DEFAULT&quot;/&gt;</code>è¿™ä¸ªcategoryçš„Activityã€‚ä½¿ç”¨è¿™ä¸ªæ ‡è®°ä½çš„æ„ä¹‰åœ¨äºï¼Œåªè¦ä¸Šè¿°ä¸¤ä¸ªæ–¹æ³•ä¸è¿”å›nullï¼Œé‚£ä¹ˆstartActivityä¸€å®šå¯ä»¥æˆåŠŸã€‚å¦‚æœä¸ç”¨è¿™ä¸ªæ ‡è®°ä½ï¼Œå°±å¯ä»¥æŠŠintent-filterä¸­categoryä¸å«DEFAULTçš„é‚£äº›Activityç»™åŒ¹é…å‡ºæ¥ï¼Œä»è€Œå¯¼è‡´startActivityå¯èƒ½å¤±è´¥ã€‚å› ä¸ºä¸å«æœ‰DEFAULTè¿™ä¸ªcategoryçš„Activityæ˜¯æ— æ³•æ¥æ”¶éšå¼Intentçš„ã€‚</p><h5 id="Appå¯åŠ¨è¿‡ç¨‹"><a href="#Appå¯åŠ¨è¿‡ç¨‹" class="headerlink" title="Appå¯åŠ¨è¿‡ç¨‹"></a>Appå¯åŠ¨è¿‡ç¨‹</h5><ol><li>ç‚¹å‡»æ¡Œé¢Appå›¾æ ‡ï¼ŒLaunchè¿›ç¨‹é‡‡ç”¨Binder IPCå‘system_serverè¿›ç¨‹å‘èµ·startActivityè¯·æ±‚</li><li>system_serveræ”¶åˆ°è¯·æ±‚åï¼Œå‘zygoteè¿›ç¨‹å‘é€åˆ›å»ºè¿›ç¨‹è¯·æ±‚ã€‚</li><li>Zygoteè¿›ç¨‹forkå‡ºæ–°çš„å­è¿›ç¨‹ï¼Œå³Appè¿›ç¨‹ã€‚</li><li>Appè¿›ç¨‹é€šè¿‡Binder IPCå‘system_serverè¿›ç¨‹å‘èµ·attachApplicationè¯·æ±‚</li><li>system_serverè¿›ç¨‹åœ¨æ”¶åˆ°è¯·æ±‚åï¼Œè¿›è¡Œä¸€ç³»åˆ—çš„å‡†å¤‡å·¥ä½œï¼Œå†é€šè¿‡Binder IPCå‘Appè¿›ç¨‹å‘é€scheduleLaunchActivityè¯·æ±‚ã€‚</li><li>Appè¿›ç¨‹çš„binderçº¿ç¨‹(ApplicationThread)åœ¨æ”¶åˆ°è¯·æ±‚åï¼Œé€šè¿‡handlerå‘ä¸»çº¿ç¨‹å‘é€LAUNCH_ACTIVITYæ¶ˆæ¯ï¼›</li><li>ä¸»çº¿ç¨‹åœ¨æ”¶åˆ°Messageåï¼Œé€šè¿‡å‘å°„æœºåˆ¶åˆ›å»ºç›®æ ‡Activityï¼Œå¹¶å›è°ƒActivity.onCreate()ç­‰æ–¹æ³•ï¼›</li><li>åˆ°æ­¤ï¼ŒAppä¾¿æ­£å¼å¯åŠ¨ï¼Œå¼€å§‹è¿›å…¥Activityç”Ÿå‘½å‘¨æœŸã€‚</li></ol><p>** æ¶‰åŠåˆ°çš„ç±» **</p><ul><li><code>Activity</code> startActivityæ–¹æ³•çš„çœŸæ­£å®ç°åœ¨Activityä¸­ã€‚</li><li><code>Instrumentation</code> æ¯ä¸€ä¸ªåº”ç”¨ç¨‹åºåªæœ‰ä¸€ä¸ªInstrumentationå¯¹è±¡ï¼Œæ¯ä¸ªActivityå†…éƒ½æœ‰ä¸€ä¸ªå¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨ã€‚Instrumentationå¯ä»¥ç†è§£ä¸ºåº”ç”¨è¿›ç¨‹çš„ç®¡å®¶ï¼ŒActivityThreadè¦åˆ›å»ºæˆ–æš‚åœæŸä¸ªActivityæ—¶ï¼Œéƒ½éœ€è¦é€šè¿‡Instrumentationæ¥è¿›è¡Œå…·ä½“çš„æ“ä½œ,ç”¨æ¥è¾…åŠ©Activityå®Œæˆå¯åŠ¨Activityçš„è¿‡ç¨‹ã€‚</li><li><code>ActivityThread</code>ï¼ˆåŒ…å«ApplicationThread + ApplicationThreadNative + IApplicationThreadï¼‰ï¼šçœŸæ­£å¯åŠ¨Activityçš„å®ç°éƒ½åœ¨è¿™é‡Œ,åº”ç”¨çš„å…¥å£ç±»ï¼Œç³»ç»Ÿé€šè¿‡è°ƒç”¨mainå‡½æ•°ï¼Œå¼€å¯æ¶ˆæ¯å¾ªç¯é˜Ÿåˆ—ã€‚ActivityThreadæ‰€åœ¨çº¿ç¨‹è¢«ç§°ä¸ºåº”ç”¨çš„ä¸»çº¿ç¨‹ï¼ˆUIçº¿ç¨‹ï¼‰ã€‚ä¸ActivityManagerServicesé…åˆï¼Œä¸€èµ·å®ŒæˆActivityçš„ç®¡ç†å·¥ä½œã€‚</li><li><code>ActivityManagerService</code> ç®€ç§°AMSï¼ŒæœåŠ¡ç«¯å¯¹è±¡ã€‚AMSæ˜¯Androidä¸­æœ€æ ¸å¿ƒçš„æœåŠ¡ä¹‹ä¸€ï¼Œä¸»è¦è´Ÿè´£ç³»ç»Ÿä¸­å››å¤§ç»„ä»¶çš„å¯åŠ¨ã€åˆ‡æ¢ã€è°ƒåº¦åŠåº”ç”¨è¿›ç¨‹çš„ç®¡ç†å’Œè°ƒåº¦ç­‰å·¥ä½œï¼Œå…¶èŒè´£ä¸æ“ä½œç³»ç»Ÿä¸­çš„è¿›ç¨‹ç®¡ç†å’Œè°ƒåº¦æ¨¡å—ç›¸ç±»ä¼¼ï¼Œå› æ­¤å®ƒåœ¨Androidä¸­éå¸¸é‡è¦ï¼Œå®ƒæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªBinderçš„å®ç°ç±»ã€‚</li><li><code>ActivityManagerProxy</code> AMSæœåŠ¡åœ¨å½“å‰è¿›ç¨‹çš„ä»£ç†ç±»ï¼Œè´Ÿè´£ä¸AMSé€šä¿¡ã€‚</li><li><code>ApplicationThread</code> ç”¨æ¥å®ç°ActivityManagerServiceä¸ActivityThreadä¹‹é—´çš„äº¤äº’ã€‚åœ¨ActivityManagerServiceéœ€è¦ç®¡ç†ç›¸å…³Applicationä¸­çš„Activityçš„ç”Ÿå‘½å‘¨æœŸæ—¶ï¼Œé€šè¿‡ApplicationThreadçš„ä»£ç†å¯¹è±¡ä¸ActivityThreadé€šè®¯ã€‚</li><li><code>ApplicationThreadProxy</code> æ˜¯ApplicationThreadåœ¨æœåŠ¡å™¨ç«¯çš„ä»£ç†ï¼Œè´Ÿè´£å’Œå®¢æˆ·ç«¯çš„ApplicationThreadé€šè®¯ã€‚AMSå°±æ˜¯é€šè¿‡è¯¥ä»£ç†ä¸ActivityThreadè¿›è¡Œé€šä¿¡çš„ã€‚</li><li><code>ActivityStack</code> Activityåœ¨AMSçš„æ ˆç®¡ç†ï¼Œç”¨æ¥è®°å½•å·²ç»å¯åŠ¨çš„Activityçš„å…ˆåå…³ç³»ï¼ŒçŠ¶æ€ä¿¡æ¯ç­‰ã€‚é€šè¿‡ActivityStackå†³å®šæ˜¯å¦éœ€è¦å¯åŠ¨æ–°çš„è¿›ç¨‹ã€‚</li><li><code>ActivityRecord</code> ActivityStackçš„ç®¡ç†å¯¹è±¡ï¼Œæ¯ä¸ªActivityåœ¨AMSå¯¹åº”ä¸€ä¸ªActivityRecordï¼Œæ¥è®°å½•Activityçš„çŠ¶æ€ä»¥åŠå…¶ä»–çš„ç®¡ç†ä¿¡æ¯ã€‚å…¶å®å°±æ˜¯æœåŠ¡å™¨ç«¯çš„Activityå¯¹è±¡çš„æ˜ åƒã€‚</li><li><code>TaskRecord</code> AMSæŠ½è±¡å‡ºæ¥çš„ä¸€ä¸ªâ€œä»»åŠ¡â€çš„æ¦‚å¿µï¼Œæ˜¯è®°å½•ActivityRecordçš„æ ˆï¼Œä¸€ä¸ªâ€œTaskâ€åŒ…å«è‹¥å¹²ä¸ªActivityRecordã€‚AMSç”¨TaskRecordç¡®ä¿Activityå¯åŠ¨å’Œé€€å‡ºçš„é¡ºåºã€‚å¦‚æœä½ æ¸…æ¥šActivityçš„4ç§launchModeï¼Œé‚£ä¹ˆå¯¹è¿™ä¸ªæ¦‚å¿µåº”è¯¥ä¸é™Œç”Ÿã€‚</li></ul><p>** åŸºæœ¬æ¦‚å¿µ **</p><h6 id="zygote"><a href="#zygote" class="headerlink" title="zygote"></a>zygote</h6><p>Androidæ˜¯åŸºäºLinuxç³»ç»Ÿçš„ï¼Œè€Œåœ¨Linuxä¸­ï¼Œæ‰€æœ‰çš„è¿›ç¨‹éƒ½æ˜¯ç”±initè¿›ç¨‹ç›´æ¥æˆ–è€…æ˜¯é—´æ¥forkå‡ºæ¥çš„ï¼Œzygoteè¿›ç¨‹ä¹Ÿä¸ä¾‹å¤–ã€‚è‡³äºinitè¿›ç¨‹æ€ä¹ˆæ¥çš„ï¼Œå¯ä»¥æœä¸€ä¸‹Androidç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹ã€‚<br>åœ¨Androidç³»ç»Ÿé‡Œé¢ï¼Œzygoteæ˜¯ä¸€ä¸ªè¿›ç¨‹çš„åå­—ã€‚Androidæ˜¯åŸºäºLinux Systemçš„ï¼Œå½“ä½ çš„æ‰‹æœºå¼€æœºçš„æ—¶å€™ï¼ŒLinuxçš„å†…æ ¸åŠ è½½å®Œæˆä¹‹åå°±ä¼šå¯åŠ¨ä¸€ä¸ªå«â€œinitâ€œçš„è¿›ç¨‹ã€‚åœ¨Linux Systemé‡Œé¢ï¼Œæ‰€æœ‰çš„è¿›ç¨‹éƒ½æ˜¯ç”±initè¿›ç¨‹forkå‡ºæ¥çš„ï¼Œæˆ‘ä»¬çš„zygoteè¿›ç¨‹ä¹Ÿä¸ä¾‹å¤–ã€‚<br>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ¯ä¸€ä¸ªAppå…¶å®éƒ½æ˜¯</p><ul><li>ä¸€ä¸ªå•ç‹¬çš„è™šæ‹Ÿæœº</li><li>ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹<br>æ‰€ä»¥å½“ç³»ç»Ÿé‡Œé¢çš„ç¬¬ä¸€ä¸ªzygoteè¿›ç¨‹è¿è¡Œä¹‹åï¼Œåœ¨è¿™ä¹‹åå†å¼€å¯Appï¼Œå°±ç›¸å½“äºå¼€å¯ä¸€ä¸ªæ–°çš„è¿›ç¨‹ã€‚è€Œä¸ºäº†å®ç°èµ„æºå…±ç”¨å’Œæ›´å¿«çš„å¯åŠ¨é€Ÿåº¦ï¼ŒAndroidç³»ç»Ÿå¼€å¯æ–°è¿›ç¨‹çš„æ–¹å¼ï¼Œæ˜¯é€šè¿‡forkç¬¬ä¸€ä¸ªzygoteè¿›ç¨‹å®ç°çš„ã€‚æ‰€ä»¥è¯´ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªzygoteè¿›ç¨‹ï¼Œå…¶ä»–åº”ç”¨æ‰€åœ¨çš„è¿›ç¨‹éƒ½æ˜¯zygoteçš„å­è¿›ç¨‹ï¼Œ</li></ul><h6 id="SystemServer"><a href="#SystemServer" class="headerlink" title="SystemServer"></a>SystemServer</h6><p>å®ƒä¹Ÿæ˜¯ä¸ªè¿›ç¨‹ï¼Œè€Œä¸”æ˜¯ç”±zygoteè¿›ç¨‹forkå‡ºæ¥çš„ã€‚ç³»ç»Ÿé‡Œé¢é‡è¦çš„æœåŠ¡éƒ½æ˜¯åœ¨è¿™ä¸ªè¿›ç¨‹é‡Œé¢å¼€å¯çš„ï¼Œæ¯”å¦‚<code>ActivityManagerService</code>ã€<code>PackageManagerService</code>ã€<code>WindowManagerService</code> ç­‰ç­‰ã€‚åœ¨zygoteå¼€å¯çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨ZygoteInit.main()è¿›è¡Œåˆå§‹åŒ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Startup class for the zygote process.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Pre-initializes some classes, and then waits for commands on a UNIX domain</span><br><span class="hljs-comment"> * socket. Based on these commands, forks off child processes that inherit</span><br><span class="hljs-comment"> * the initial state of the VM.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Please see &#123;<span class="hljs-doctag">@link</span> ZygoteConnection.Arguments&#125; for documentation on the</span><br><span class="hljs-comment"> * client protocol.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br></code></pre></td></tr></table></figure><p>ä»æ³¨é‡Šä¸Šä¹Ÿå¯ä»¥çœ‹å‡ºè¿™ä¸ªç±»ä¸»è¦æ˜¯ä¸ºäº†åˆå§‹åŒ–æŸäº›å‚æ•°ã€‚æ¯”å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">preload</span><span class="hljs-params">(TimingsTraceLog bootTimingsTraceLog)</span> &#123;<br>        Log.d(TAG, <span class="hljs-string">&quot;begin preload&quot;</span>);<br>        bootTimingsTraceLog.traceBegin(<span class="hljs-string">&quot;BeginIcuCachePinning&quot;</span>);<br>        beginIcuCachePinning();<br>        bootTimingsTraceLog.traceEnd(); <span class="hljs-comment">// BeginIcuCachePinning</span><br>        bootTimingsTraceLog.traceBegin(<span class="hljs-string">&quot;PreloadClasses&quot;</span>);<br>        preloadClasses();<br>        bootTimingsTraceLog.traceEnd(); <span class="hljs-comment">// PreloadClasses</span><br>        bootTimingsTraceLog.traceBegin(<span class="hljs-string">&quot;PreloadResources&quot;</span>);<br>        preloadResources();<br>        bootTimingsTraceLog.traceEnd(); <span class="hljs-comment">// PreloadResources</span><br>        Trace.traceBegin(Trace.TRACE_TAG_DALVIK, <span class="hljs-string">&quot;PreloadAppProcessHALs&quot;</span>);<br>        nativePreloadAppProcessHALs();<br>        Trace.traceEnd(Trace.TRACE_TAG_DALVIK);<br>        Trace.traceBegin(Trace.TRACE_TAG_DALVIK, <span class="hljs-string">&quot;PreloadOpenGL&quot;</span>);<br>        preloadOpenGL();<br>        Trace.traceEnd(Trace.TRACE_TAG_DALVIK);<br>        preloadSharedLibraries();<br>        preloadTextResources();<br>        <span class="hljs-comment">// Ask the WebViewFactory to do any initialization that must run in the zygote process,</span><br>        <span class="hljs-comment">// for memory sharing purposes.</span><br>        WebViewFactory.prepareWebViewInZygote();<br>        endIcuCachePinning();<br>        warmUpJcaProviders();<br>        Log.d(TAG, <span class="hljs-string">&quot;end preload&quot;</span>);<br><br>        sPreloadComplete = <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lazyPreload</span><span class="hljs-params">()</span> &#123;<br>        Preconditions.checkState(!sPreloadComplete);<br>        Log.i(TAG, <span class="hljs-string">&quot;Lazily preloading resources.&quot;</span>);<br><br>        preload(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TimingsTraceLog</span>(<span class="hljs-string">&quot;ZygoteInitTiming_lazy&quot;</span>, Trace.TRACE_TAG_DALVIK));<br>    &#125;<br></code></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€äº›å…³é”®çš„æ–¹æ³•<code>preloadSharedLibraries()</code>ã€<code>preloadOpenGL()</code>ã€<code>preloadTextResources()</code>ã€<code>preloadClasses()</code>ã€<code>preloadResources()</code>ã€<code>preloadDrawables()</code>ã€<code>preloadColorStateLists()</code> ç­‰.è¿˜æœ‰ä¸€ä¸ª<code>startSystemServer()</code>æ–¹æ³•ã€‚</p><h6 id="ActivityManagerService"><a href="#ActivityManagerService" class="headerlink" title="ActivityManagerService"></a>ActivityManagerService</h6><p>ç®€ç§°AMS,æœåŠ¡ç«¯å¯¹è±¡ï¼Œè´Ÿè´£ç³»ç»Ÿä¸­æ‰€æœ‰Activityç”Ÿå‘½å‘¨æœŸã€‚å®ƒçš„åˆå§‹åŒ–æ—¶æœºå¾ˆæ˜ç¡®ï¼Œå°±æ˜¯åœ¨SystemServerè¿›ç¨‹å¼€å¯çš„æ—¶å€™ï¼Œå°±ä¼šåˆå§‹åŒ–ActivityManagerServiceã€‚å…·ä½“æƒ…å†µå¯ä»¥çœ‹ä¸€ä¸‹<code>SystemServer.java</code>ç±»ã€‚<br>ç»è¿‡ä¸Šé¢è¿™äº›æ­¥éª¤ï¼Œæˆ‘ä»¬çš„ActivityManagerServiceå¯¹è±¡å·²ç»åˆ›å»ºå¥½äº†ï¼Œå¹¶ä¸”å®Œæˆäº†æˆå‘˜å˜é‡åˆå§‹åŒ–ã€‚è€Œä¸”åœ¨è¿™ä¹‹å‰ï¼Œè°ƒç”¨createSystemContext()åˆ›å»ºç³»ç»Ÿä¸Šä¸‹æ–‡çš„æ—¶å€™ï¼Œä¹Ÿå·²ç»å®Œæˆäº†mSystemContextå’ŒActivityThreadçš„åˆ›å»ºã€‚æ³¨æ„ï¼Œè¿™æ˜¯ç³»ç»Ÿè¿›ç¨‹å¼€å¯æ—¶çš„æµç¨‹ï¼Œåœ¨è¿™ä¹‹åï¼Œä¼šå¼€å¯ç³»ç»Ÿçš„Launcherç¨‹åºï¼Œå®Œæˆç³»ç»Ÿç•Œé¢çš„åŠ è½½ä¸æ˜¾ç¤ºã€‚</p><h6 id="ä¸ºä»€ä¹ˆè¯´AMSæ˜¯æœåŠ¡ç«¯å¯¹è±¡"><a href="#ä¸ºä»€ä¹ˆè¯´AMSæ˜¯æœåŠ¡ç«¯å¯¹è±¡" class="headerlink" title="ä¸ºä»€ä¹ˆè¯´AMSæ˜¯æœåŠ¡ç«¯å¯¹è±¡"></a>ä¸ºä»€ä¹ˆè¯´AMSæ˜¯æœåŠ¡ç«¯å¯¹è±¡</h6><p>å…¶å®æœåŠ¡å™¨å®¢æˆ·ç«¯çš„æ¦‚å¿µä¸ä»…ä»…å­˜åœ¨äºWebå¼€å‘ä¸­ï¼Œåœ¨Androidçš„æ¡†æ¶è®¾è®¡ä¸­ï¼Œä½¿ç”¨çš„ä¹Ÿæ˜¯è¿™ä¸€ç§æ¨¡å¼ã€‚æœåŠ¡å™¨ç«¯æŒ‡çš„å°±æ˜¯æ‰€æœ‰Appå…±ç”¨çš„ç³»ç»ŸæœåŠ¡ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œæåˆ°çš„ActivityManagerServiceï¼Œå’Œå‰é¢æåˆ°çš„PackageManagerServiceã€WindowManagerServiceç­‰ç­‰ï¼Œè¿™äº›åŸºç¡€çš„ç³»ç»ŸæœåŠ¡æ˜¯è¢«æ‰€æœ‰çš„Appå…¬ç”¨çš„ï¼Œå½“æŸä¸ªAppæƒ³å®ç°æŸä¸ªæ“ä½œçš„æ—¶å€™ï¼Œè¦å‘Šè¯‰è¿™äº›ç³»ç»ŸæœåŠ¡ï¼Œæ¯”å¦‚ä½ æƒ³æ‰“å¼€ä¸€ä¸ªAppï¼Œé‚£ä¹ˆæˆ‘ä»¬çŸ¥é“äº†åŒ…åå’ŒMainActivityç±»åä¹‹åå°±å¯ä»¥æ‰“å¼€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(Intent.ACTION_MAIN);  <br>intent.addCategory(Intent.CATEGORY_LAUNCHER);<br><span class="hljs-type">ComponentName</span> <span class="hljs-variable">cn</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComponentName</span>(packageName, className);<br>intent.setComponent(cn);  <br>startActivity(intent);<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œæˆ‘ä»¬çš„Appé€šè¿‡è°ƒç”¨startActivity()å¹¶ä¸èƒ½ç›´æ¥æ‰“å¼€å¦å¤–ä¸€ä¸ªAppï¼Œè¿™ä¸ªæ–¹æ³•ä¼šé€šè¿‡ä¸€ç³»åˆ—çš„è°ƒç”¨ï¼Œæœ€åè¿˜æ˜¯å‘Šè¯‰AMSè¯´ï¼šâ€œæˆ‘è¦æ‰“å¼€è¿™ä¸ªAppï¼Œæˆ‘çŸ¥é“ä»–çš„ä½å€å’Œåå­—ï¼Œä½ å¸®æˆ‘æ‰“å¼€å§ï¼â€æ‰€ä»¥æ˜¯AMSæ¥é€šçŸ¥zygoteè¿›ç¨‹æ¥forkä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œæ¥å¼€å¯æˆ‘ä»¬çš„ç›®æ ‡Appçš„ã€‚è¿™å°±åƒæ˜¯æµè§ˆå™¨æƒ³è¦æ‰“å¼€ä¸€ä¸ªè¶…é“¾æ¥ä¸€æ ·ï¼Œæµè§ˆå™¨æŠŠç½‘é¡µåœ°å€å‘é€ç»™æœåŠ¡å™¨ï¼Œç„¶åè¿˜æ˜¯æœåŠ¡å™¨æŠŠéœ€è¦çš„èµ„æºæ–‡ä»¶å‘é€ç»™å®¢æˆ·ç«¯çš„ã€‚</p><p>çŸ¥é“äº†Android Frameworkçš„å®¢æˆ·ç«¯æœåŠ¡å™¨æ¶æ„ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦äº†è§£ä¸€ä»¶äº‹æƒ…ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬çš„Appå’ŒAMS(SystemServerè¿›ç¨‹)è¿˜æœ‰zygoteè¿›ç¨‹åˆ†å±äºä¸‰ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä»–ä»¬ä¹‹é—´å¦‚ä½•é€šä¿¡å‘¢ï¼Ÿ<br>Appä¸AMSé€šè¿‡Binderè¿›è¡ŒIPCé€šä¿¡ï¼ŒAMS(SystemServerè¿›ç¨‹)ä¸zygoteé€šè¿‡Socketè¿›è¡ŒIPCé€šä¿¡ã€‚<br>é‚£ä¹ˆAMSæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿåœ¨å‰é¢æˆ‘ä»¬çŸ¥é“äº†ï¼Œå¦‚æœæƒ³æ‰“å¼€ä¸€ä¸ªAppçš„è¯ï¼Œéœ€è¦AMSå»é€šçŸ¥zygoteè¿›ç¨‹ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå…¶å®æ‰€æœ‰çš„Activityçš„å¼€å¯ã€æš‚åœã€å…³é—­éƒ½éœ€è¦AMSæ¥æ§åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬è¯´ï¼ŒAMSè´Ÿè´£ç³»ç»Ÿä¸­æ‰€æœ‰Activityçš„ç”Ÿå‘½å‘¨æœŸã€‚<br>åœ¨Androidç³»ç»Ÿä¸­ï¼Œä»»ä½•ä¸€ä¸ªActivityçš„å¯åŠ¨éƒ½æ˜¯ç”±AMSå’Œåº”ç”¨ç¨‹åºè¿›ç¨‹ï¼ˆä¸»è¦æ˜¯ActivityThreadï¼‰ç›¸äº’é…åˆæ¥å®Œæˆçš„ã€‚AMSæœåŠ¡ç»Ÿä¸€è°ƒåº¦ç³»ç»Ÿä¸­æ‰€æœ‰è¿›ç¨‹çš„Activityå¯åŠ¨ï¼Œè€Œæ¯ä¸ªActivityçš„å¯åŠ¨è¿‡ç¨‹åˆ™ç”±å…¶æ‰€å±çš„è¿›ç¨‹å…·ä½“æ¥å®Œæˆã€‚</p><h6 id="Launcher"><a href="#Launcher" class="headerlink" title="Launcher"></a>Launcher</h6><p>å½“æˆ‘ä»¬ç‚¹å‡»æ‰‹æœºæ¡Œé¢ä¸Šçš„å›¾æ ‡çš„æ—¶å€™ï¼ŒAppå°±ç”±Launcherå¼€å§‹å¯åŠ¨äº†ã€‚Launcheræœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå’Œæˆ‘ä»¬çš„Appä¸€æ ·ï¼Œä¹Ÿæ˜¯ç»§æ‰¿è‡ªActivityï¼Œç³»ç»Ÿæºç å¯ä»¥åœ¨è¿™é‡Œçœ‹ <a href="http://androidxref.com/8.0.0_r4/xref/packages/apps/Launcher3/src/com/android/launcher3/Launcher.java">http://androidxref.com/8.0.0_r4/xref/packages/apps/Launcher3/src/com/android/launcher3/Launcher.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">View <span class="hljs-title function_">createShortcut</span><span class="hljs-params">(<span class="hljs-type">int</span> layoutResId, ViewGroup parent, ShortcutInfo info)</span> &#123;<br>        <span class="hljs-type">BubbleTextView</span> <span class="hljs-variable">favorite</span> <span class="hljs-operator">=</span> (BubbleTextView) mInflater.inflate(layoutResId, parent, <span class="hljs-literal">false</span>);<br>        favorite.applyFromShortcutInfo(info, mIconCache);<br>        favorite.setOnClickListener(<span class="hljs-built_in">this</span>);<br>        <span class="hljs-keyword">return</span> favorite;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ›å»ºå›¾æ ‡å¹¶è®¾ç½®ç‚¹å‡»ç›‘å¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * Launches the intent referred by the clicked shortcut.</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> v The view representing the clicked shortcut.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> &#123;<br>        <span class="hljs-comment">// Make sure that rogue clicks don&#x27;t get through while allapps is launching, or after the</span><br>        <span class="hljs-comment">// view has detached (it&#x27;s possible for this to happen if the view is removed mid touch).</span><br>        <span class="hljs-keyword">if</span> (v.getWindowToken() == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (!mWorkspace.isFinishedSwitchingState()) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">tag</span> <span class="hljs-operator">=</span> v.getTag();<br>        <span class="hljs-keyword">if</span> (tag <span class="hljs-keyword">instanceof</span> ShortcutInfo) &#123;<br>            <span class="hljs-comment">// Open shortcut</span><br>            <span class="hljs-keyword">final</span> <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> ((ShortcutInfo) tag).intent;<br>            <span class="hljs-type">int</span>[] pos = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">2</span>];<br>            v.getLocationOnScreen(pos);<br>            intent.setSourceBounds(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Rect</span>(pos[<span class="hljs-number">0</span>], pos[<span class="hljs-number">1</span>],<br>                    pos[<span class="hljs-number">0</span>] + v.getWidth(), pos[<span class="hljs-number">1</span>] + v.getHeight()));<br><br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> startActivitySafely(v, intent, tag);<br><br>            <span class="hljs-keyword">if</span> (success &amp;&amp; v <span class="hljs-keyword">instanceof</span> BubbleTextView) &#123;<br>                mWaitingForResume = (BubbleTextView) v;<br>                mWaitingForResume.setStayPressed(<span class="hljs-literal">true</span>);<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tag <span class="hljs-keyword">instanceof</span> FolderInfo) &#123;<br>            <span class="hljs-keyword">if</span> (v <span class="hljs-keyword">instanceof</span> FolderIcon) &#123;<br>                <span class="hljs-type">FolderIcon</span> <span class="hljs-variable">fi</span> <span class="hljs-operator">=</span> (FolderIcon) v;<br>                handleFolderClick(fi);<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (v == mAllAppsButton) &#123;<br>            <span class="hljs-keyword">if</span> (isAllAppsVisible()) &#123;<br>                showWorkspace(<span class="hljs-literal">true</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                onClickAllAppsButton(v);<br>            &#125;<br>        &#125;<br>    &#125;<br><br></code></pre></td></tr></table></figure><p>ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ¡Œé¢ä¸Šç‚¹å‡»å¿«æ·å›¾æ ‡çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">startActivitySafely(v, intent, tag);<br></code></pre></td></tr></table></figure><p>å…·ä½“ä»£ç å°±ä¸æŠ„äº†ï¼Œçœ‹ä¸€ä¸‹ä¸Šé¢çš„é“¾æ¥ä¸­çš„æºç å°±å¥½ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­è°ƒç”¨äº†<code>startActivity(v, intent, tag)</code>ï¼Œè¿™é‡Œä¼šè°ƒç”¨Activity.startActivity(intent, opts.toBundle())ï¼Œè¿™ä¸ªæ–¹æ³•ç†Ÿæ‚‰å—ï¼Ÿè¿™å°±æ˜¯æˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„Activity.startActivity(Intent)çš„é‡è½½å‡½æ•°ã€‚è€Œä¸”ç”±äºè®¾ç½®äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥è¿™ä¸ªActivityä¼šæ·»åŠ åˆ°ä¸€ä¸ªæ–°çš„Taskæ ˆä¸­ï¼Œè€Œä¸”ï¼ŒstartActivity()è°ƒç”¨çš„å…¶å®æ˜¯startActivityForResult()è¿™ä¸ªæ–¹æ³•ã€‚<br>æ‰€ä»¥ç°åœ¨æ˜ç¡®äº†ï¼ŒLauncherä¸­å¼€å¯ä¸€ä¸ªAppï¼Œå…¶å®å’Œæˆ‘ä»¬åœ¨Activityä¸­ç›´æ¥startActivity()åŸºæœ¬ä¸€æ ·ï¼Œéƒ½æ˜¯è°ƒç”¨äº†Activity.startActivityForResult()ã€‚</p><h6 id="Instrumentation"><a href="#Instrumentation" class="headerlink" title="Instrumentation"></a>Instrumentation</h6><p>æ¯ä¸ªActivityéƒ½æŒæœ‰Instrumentationå¯¹è±¡çš„ä¸€ä¸ªå¼•ç”¨ï¼Œä½†æ˜¯æ•´ä¸ªè¿›ç¨‹åªä¼šå­˜åœ¨ä¸€ä¸ªInstrumentationå¯¹è±¡ã€‚å½“startActivityForResult()è°ƒç”¨ä¹‹åï¼Œå®é™…ä¸Šè¿˜æ˜¯è°ƒç”¨äº†mInstrumentation.execStartActivity().<br>ä¸‹é¢æ˜¯mInstrumetation.execStartActivity()çš„å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> ActivityResult <span class="hljs-title function_">execStartActivity</span><span class="hljs-params">(</span><br><span class="hljs-params">            Context who, IBinder contextThread, IBinder token, Activity target,</span><br><span class="hljs-params">            Intent intent, <span class="hljs-type">int</span> requestCode, Bundle options)</span> &#123;<br>        <span class="hljs-type">IApplicationThread</span> <span class="hljs-variable">whoThread</span> <span class="hljs-operator">=</span> (IApplicationThread) contextThread;<br>        <span class="hljs-type">Uri</span> <span class="hljs-variable">referrer</span> <span class="hljs-operator">=</span> target != <span class="hljs-literal">null</span> ? target.onProvideReferrer() : <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">if</span> (referrer != <span class="hljs-literal">null</span>) &#123;<br>            intent.putExtra(Intent.EXTRA_REFERRER, referrer);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (mActivityMonitors != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">synchronized</span> (mSync) &#123;<br>                <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">N</span> <span class="hljs-operator">=</span> mActivityMonitors.size();<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;N; i++) &#123;<br>                    <span class="hljs-keyword">final</span> <span class="hljs-type">ActivityMonitor</span> <span class="hljs-variable">am</span> <span class="hljs-operator">=</span> mActivityMonitors.get(i);<br>                    <span class="hljs-keyword">if</span> (am.match(who, <span class="hljs-literal">null</span>, intent)) &#123;<br>                        am.mHits++;<br>                        <span class="hljs-keyword">if</span> (am.isBlocking()) &#123;<br>                            <span class="hljs-keyword">return</span> requestCode &gt;= <span class="hljs-number">0</span> ? am.getResult() : <span class="hljs-literal">null</span>;<br>                        &#125;<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            intent.migrateExtraStreamToClipData();<br>            intent.prepareToLeaveProcess();<br>            <span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> ActivityManagerNative.getDefault()<br>                .startActivity(whoThread, who.getBasePackageName(), intent,<br>                        intent.resolveTypeIfNeeded(who.getContentResolver()),<br>                        token, target != <span class="hljs-literal">null</span> ? target.mEmbeddedID : <span class="hljs-literal">null</span>,<br>                        requestCode, <span class="hljs-number">0</span>, <span class="hljs-literal">null</span>, options);<br>            checkStartActivityResult(result, intent);<br>        &#125; <span class="hljs-keyword">catch</span> (RemoteException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Failure from system&quot;</span>, e);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„ ActivityManagerNative.getDefault è¿”å›ActivityManagerServiceçš„è¿œç¨‹æ¥å£ï¼Œå³ ActivityManagerProxy æ¥å£ï¼Œæœ‰äººå¯èƒ½ä¼šé—®äº†ä¸ºä»€ä¹ˆä¼šæ˜¯ActivityManagerProxyï¼Œè¿™å°±æ¶‰åŠåˆ°Binderé€šä¿¡äº†ï¼Œè¿™é‡Œä¸å†å±•å¼€ã€‚é€šè¿‡Binderé©±åŠ¨ç¨‹åºï¼Œ ActivityManagerProxy ä¸AMSæœåŠ¡é€šä¿¡ï¼Œåˆ™å®ç°äº†è·¨è¿›ç¨‹åˆ°Systemè¿›ç¨‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Retrieve the system&#x27;s default/global activity manager.</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">static</span> <span class="hljs-keyword">public</span> IActivityManager <span class="hljs-title function_">getDefault</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-keyword">return</span> gDefault.get();<br>   &#125;<br><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Singleton&lt;IActivityManager&gt; gDefault = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>&lt;IActivityManager&gt;() &#123;<br>       <span class="hljs-keyword">protected</span> IActivityManager <span class="hljs-title function_">create</span><span class="hljs-params">()</span> &#123;<br>           <span class="hljs-type">IBinder</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> ServiceManager.getService(<span class="hljs-string">&quot;activity&quot;</span>);<br>           <span class="hljs-keyword">if</span> (<span class="hljs-literal">false</span>) &#123;<br>               Log.v(<span class="hljs-string">&quot;ActivityManager&quot;</span>, <span class="hljs-string">&quot;default service binder = &quot;</span> + b);<br>           &#125;<br>           <span class="hljs-type">IActivityManager</span> <span class="hljs-variable">am</span> <span class="hljs-operator">=</span> asInterface(b);<br>           <span class="hljs-keyword">if</span> (<span class="hljs-literal">false</span>) &#123;<br>               Log.v(<span class="hljs-string">&quot;ActivityManager&quot;</span>, <span class="hljs-string">&quot;default service = &quot;</span> + am);<br>           &#125;<br>           <span class="hljs-keyword">return</span> am;<br>       &#125;<br>   &#125;;<br><br>   <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Cast a Binder object into an activity manager interface, generating</span><br><span class="hljs-comment">    * a proxy if needed.</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">static</span> <span class="hljs-keyword">public</span> IActivityManager <span class="hljs-title function_">asInterface</span><span class="hljs-params">(IBinder obj)</span> &#123;<br>       <span class="hljs-keyword">if</span> (obj == <span class="hljs-literal">null</span>) &#123;<br>           <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>       &#125;<br>       <span class="hljs-type">IActivityManager</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span><br>           (IActivityManager)obj.queryLocalInterface(descriptor);<br>       <span class="hljs-keyword">if</span> (in != <span class="hljs-literal">null</span>) &#123;<br>           <span class="hljs-keyword">return</span> in;<br>       &#125;<br><br>       <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActivityManagerProxy</span>(obj);<br>   &#125;<br></code></pre></td></tr></table></figure><h6 id="AMSå“åº”Launcherè¿›ç¨‹è¯·æ±‚"><a href="#AMSå“åº”Launcherè¿›ç¨‹è¯·æ±‚" class="headerlink" title="AMSå“åº”Launcherè¿›ç¨‹è¯·æ±‚"></a>AMSå“åº”Launcherè¿›ç¨‹è¯·æ±‚</h6><p>è‡³æ­¤ï¼Œç‚¹å‡»æ¡Œé¢å›¾æ ‡è°ƒç”¨startActivity()ï¼Œç»ˆäºæŠŠæ•°æ®å’Œè¦å¼€å¯Activityçš„è¯·æ±‚å‘é€åˆ°äº†AMSäº†,AMSæ”¶åˆ°startActivityçš„è¯·æ±‚ä¹‹åï¼Œä¼šæŒ‰ç…§å¦‚ä¸‹çš„æ–¹æ³•é“¾è¿›è¡Œè°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">startActivity</span><span class="hljs-params">(IApplicationThread caller, String callingPackage,</span><br><span class="hljs-params">            Intent intent, String resolvedType, IBinder resultTo, String resultWho, <span class="hljs-type">int</span> requestCode,</span><br><span class="hljs-params">            <span class="hljs-type">int</span> startFlags, ProfilerInfo profilerInfo, Bundle options)</span> &#123;<br>        <span class="hljs-keyword">return</span> startActivityAsUser(caller, callingPackage, intent, resolvedType, resultTo,<br>            resultWho, requestCode, startFlags, profilerInfo, options,<br>            UserHandle.getCallingUserId());<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">startActivityAsUser</span><span class="hljs-params">(IApplicationThread caller, String callingPackage,</span><br><span class="hljs-params">            Intent intent, String resolvedType, IBinder resultTo, String resultWho, <span class="hljs-type">int</span> requestCode,</span><br><span class="hljs-params">            <span class="hljs-type">int</span> startFlags, ProfilerInfo profilerInfo, Bundle options, <span class="hljs-type">int</span> userId)</span> &#123;<br>        enforceNotIsolatedCaller(<span class="hljs-string">&quot;startActivity&quot;</span>);<br>        userId = handleIncomingUser(Binder.getCallingPid(), Binder.getCallingUid(), userId,<br>                <span class="hljs-literal">false</span>, ALLOW_FULL_ONLY, <span class="hljs-string">&quot;startActivity&quot;</span>, <span class="hljs-literal">null</span>);<br>        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Switch to user app stacks here.</span><br>        <span class="hljs-keyword">return</span> mStackSupervisor.startActivityMayWait(caller, -<span class="hljs-number">1</span>, callingPackage, intent,<br>                resolvedType, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, resultTo, resultWho, requestCode, startFlags,<br>                profilerInfo, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, options, <span class="hljs-literal">false</span>, userId, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>    &#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œåˆå‡ºç°äº†ä¸€ä¸ª<code>mStackSupervisor</code>ï¼Œå®šä¹‰æ˜¯è¿™ä¹ˆè¯´çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/** Run all ActivityStacks through this */</span><br>    ActivityStackSupervisor mStackSupervisor;<br><br></code></pre></td></tr></table></figure><p>åœ¨<code>mStackSupervisor.startActivityMayWait()</code>æ–¹æ³•ä¸­åˆè°ƒç”¨äº†<code>startActivityLocked()</code>æ–¹æ³•ï¼Œæ¥ç€è°ƒç”¨äº†<code>startActivityUncheckedLocked()</code>æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä¸€å¤§å †çœ¼èŠ±ç¼­ä¹±çš„åˆ¤æ–­ï¼Œæœ€ç»ˆè°ƒç”¨äº†<code>targetStack.startActivityLocked(r, newTask, doResume, keepCurTransition, options)</code>æ–¹æ³•ï¼Œç„¶åè°ƒç”¨äº†<code>mStackSupervisor.resumeTopActivitiesLocked(this, r, options)</code>æ–¹æ³•ï¼Œç„¶åè°ƒç”¨<code>result = targetStack.resumeTopActivityLocked(target, targetOptions)</code>æ–¹æ³•ï¼Œè°ƒç”¨<code>result = resumeTopActivityInnerLocked(prev, options)</code>æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œï¼Œprev.appä¸ºè®°å½•å¯åŠ¨Lancherè¿›ç¨‹çš„ProcessRecordï¼Œprev.app.threadä¸ºLancherè¿›ç¨‹çš„è¿œç¨‹è°ƒç”¨æ¥å£IApplicationTheadï¼Œæ‰€ä»¥å¯ä»¥è°ƒç”¨prev.app.thread.schedulePauseActivityï¼Œåˆ°Lancherè¿›ç¨‹æš‚åœæŒ‡å®šActivityã€‚è‡³æ­¤ï¼ŒAMSå¯¹Launcherçš„è¯·æ±‚å·²ç»å“åº”ï¼Œè¿™æ˜¯æˆ‘ä»¬å‘ç°åˆé€šè¿‡Binderé€šä¿¡å›è°ƒè‡³Launcherè¿›ç¨‹</p><h6 id="Launcherè¿›ç¨‹æŒ‚èµ·Launcherï¼Œå†æ¬¡é€šçŸ¥AMS"><a href="#Launcherè¿›ç¨‹æŒ‚èµ·Launcherï¼Œå†æ¬¡é€šçŸ¥AMS" class="headerlink" title="Launcherè¿›ç¨‹æŒ‚èµ·Launcherï¼Œå†æ¬¡é€šçŸ¥AMS"></a>Launcherè¿›ç¨‹æŒ‚èµ·Launcherï¼Œå†æ¬¡é€šçŸ¥AMS</h6><p>çœ‹ä¸€ä¸‹æ€ä¹ˆæŒ‚èµ·Launcherçš„,åœ¨ActivityThreadä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handlePauseActivity</span><span class="hljs-params">(IBinder token, <span class="hljs-type">boolean</span> finished,</span><br><span class="hljs-params">            <span class="hljs-type">boolean</span> userLeaving, <span class="hljs-type">int</span> configChanges, <span class="hljs-type">boolean</span> dontReport)</span> &#123;<br>        <span class="hljs-type">ActivityClientRecord</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> mActivities.get(token);<br>        <span class="hljs-keyword">if</span> (r != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">//Slog.v(TAG, &quot;userLeaving=&quot; + userLeaving + &quot; handling pause of &quot; + r);</span><br>            <span class="hljs-keyword">if</span> (userLeaving) &#123;<br>                performUserLeavingActivity(r);<br>            &#125;<br><br>            r.activity.mConfigChangeFlags |= configChanges;<br>            performPauseActivity(token, finished, r.isPreHoneycomb());<br><br>            <span class="hljs-comment">// Make sure any pending writes are now committed.</span><br>            <span class="hljs-keyword">if</span> (r.isPreHoneycomb()) &#123;<br>                QueuedWork.waitToFinish();<br>            &#125;<br><br>            <span class="hljs-comment">// Tell the activity manager we have paused.</span><br>            <span class="hljs-keyword">if</span> (!dontReport) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    ActivityManagerNative.getDefault().activityPaused(token);<br>                &#125; <span class="hljs-keyword">catch</span> (RemoteException ex) &#123;<br>                &#125;<br>            &#125;<br>            mSomeActivitiesChanged = <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>è¿™éƒ¨åˆ†Launcherçš„ActivityThreadå¤„ç†é¡µé¢Pausedå¹¶ä¸”å†æ¬¡é€šè¿‡ActivityManagerProxyé€šçŸ¥AMSã€‚</p><h6 id="AMSåˆ›å»ºæ–°çš„è¿›ç¨‹"><a href="#AMSåˆ›å»ºæ–°çš„è¿›ç¨‹" class="headerlink" title="AMSåˆ›å»ºæ–°çš„è¿›ç¨‹"></a>AMSåˆ›å»ºæ–°çš„è¿›ç¨‹</h6><p>åˆ›å»ºæ–°è¿›ç¨‹çš„æ—¶å€™ï¼ŒAMSä¼šä¿å­˜ä¸€ä¸ªProcessRecordä¿¡æ¯ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸­çš„AndroidManifest.xmlé…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šApplicationæ ‡ç­¾çš„processå±æ€§ï¼Œç³»ç»Ÿå°±ä¼šé»˜è®¤ä½¿ç”¨packageçš„åç§°ã€‚æ¯ä¸€ä¸ªåº”ç”¨ç¨‹åºéƒ½æœ‰è‡ªå·±çš„uidï¼Œå› æ­¤ï¼Œè¿™é‡Œuid + processçš„ç»„åˆå°±å¯ä»¥ä¸ºæ¯ä¸€ä¸ªåº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ªProcessRecordã€‚<br>åœ¨<code>ActivityManagerService</code>ä¸­ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startProcessLocked</span><span class="hljs-params">(ProcessRecord app, String hostingType,</span><br><span class="hljs-params">            String hostingNameStr, String abiOverride, String entryPoint, String[] entryPointArgs)</span> &#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> SystemClock.elapsedRealtime();<br>        ......<br>        <span class="hljs-comment">// Start the process.  It will either succeed and return a result containing</span><br>            <span class="hljs-comment">// the PID of the new process, or else throw a RuntimeException.</span><br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">isActivityProcess</span> <span class="hljs-operator">=</span> (entryPoint == <span class="hljs-literal">null</span>);<br>            <span class="hljs-keyword">if</span> (entryPoint == <span class="hljs-literal">null</span>) entryPoint = <span class="hljs-string">&quot;android.app.ActivityThread&quot;</span>;<br>            Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="hljs-string">&quot;Start proc: &quot;</span> +<br>                    app.processName);<br>            checkTime(startTime, <span class="hljs-string">&quot;startProcess: asking zygote to start proc&quot;</span>);<br>            Process.<span class="hljs-type">ProcessStartResult</span> <span class="hljs-variable">startResult</span> <span class="hljs-operator">=</span> Process.start(entryPoint,<br>                    app.processName, uid, uid, gids, debugFlags, mountExternal,<br>                    app.info.targetSdkVersion, app.info.seinfo, requiredAbi, instructionSet,<br>                    app.info.dataDir, entryPointArgs);<br>            checkTime(startTime, <span class="hljs-string">&quot;startProcess: returned from zygote!&quot;</span>);<br>            Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);<br><br>            <span class="hljs-keyword">if</span> (app.isolated) &#123;<br>                mBatteryStatsService.addIsolatedUid(app.uid, app.info.uid);<br>            &#125;<br>            mBatteryStatsService.noteProcessStart(app.processName, app.info.uid);<br>            checkTime(startTime, <span class="hljs-string">&quot;startProcess: done updating battery stats&quot;</span>);<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¸»è¦æ˜¯è°ƒç”¨Process.startæ¥å£æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œæ–°çš„è¿›ç¨‹ä¼šå¯¼å…¥android.app.ActivityThreadç±»ï¼Œå¹¶ä¸”æ‰§è¡Œå®ƒçš„mainå‡½æ•°ï¼Œè¿™å°±æ˜¯æ¯ä¸€ä¸ªåº”ç”¨ç¨‹åºéƒ½æœ‰ä¸€ä¸ªActivityThreadå®ä¾‹æ¥å¯¹åº”çš„åŸå› ã€‚</p><h6 id="åº”ç”¨è¿›ç¨‹åˆå§‹åŒ–"><a href="#åº”ç”¨è¿›ç¨‹åˆå§‹åŒ–" class="headerlink" title="åº”ç”¨è¿›ç¨‹åˆå§‹åŒ–"></a>åº”ç”¨è¿›ç¨‹åˆå§‹åŒ–</h6><p>æ¥çœ‹Activityçš„mainå‡½æ•°ï¼Œè¿™é‡Œç»‘å®šäº†ä¸»çº¿ç¨‹çš„Looperï¼Œå¹¶è¿›å…¥æ¶ˆæ¯å¾ªç¯ï¼Œå¤§å®¶åº”è¯¥çŸ¥é“ï¼Œæ•´ä¸ªAndroidç³»ç»Ÿæ˜¯æ¶ˆæ¯é©±åŠ¨çš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¸»çº¿ç¨‹é»˜è®¤ç»‘å®šLooperçš„åŸå› ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="hljs-string">&quot;ActivityThreadMain&quot;</span>);<br>        SamplingProfilerIntegration.start();<br><br>        <span class="hljs-comment">// CloseGuard defaults to true and can be quite spammy.  We</span><br>        <span class="hljs-comment">// disable it here, but selectively enable it later (via</span><br>        <span class="hljs-comment">// StrictMode) on debug builds, but using DropBox, not logs.</span><br>        CloseGuard.setEnabled(<span class="hljs-literal">false</span>);<br><br>        Environment.initForCurrentUser();<br><br>        <span class="hljs-comment">// Set the reporter for event logging in libcore</span><br>        EventLogger.setReporter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">EventLoggingReporter</span>());<br><br>        AndroidKeyStoreProvider.install();<br><br>        <span class="hljs-comment">// Make sure TrustedCertificateStore looks in the right place for CA certificates</span><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">File</span> <span class="hljs-variable">configDir</span> <span class="hljs-operator">=</span> Environment.getUserConfigDirectory(UserHandle.myUserId());<br>        TrustedCertificateStore.setDefaultUserDirectory(configDir);<br><br>        Process.setArgV0(<span class="hljs-string">&quot;&lt;pre-initialized&gt;&quot;</span>);<br><br>        Looper.prepareMainLooper();<br><br>        <span class="hljs-type">ActivityThread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActivityThread</span>();<br>        thread.attach(<span class="hljs-literal">false</span>);<br><br>        <span class="hljs-keyword">if</span> (sMainThreadHandler == <span class="hljs-literal">null</span>) &#123;<br>            sMainThreadHandler = thread.getHandler();<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">false</span>) &#123;<br>            Looper.myLooper().setMessageLogging(<span class="hljs-keyword">new</span><br>                    <span class="hljs-title class_">LogPrinter</span>(Log.DEBUG, <span class="hljs-string">&quot;ActivityThread&quot;</span>));<br>        &#125;<br><br>        <span class="hljs-comment">// End of event ActivityThreadMain.</span><br>        Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);<br>        Looper.loop();<br><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Main thread loop unexpectedly exited&quot;</span>);<br>    &#125;<br></code></pre></td></tr></table></figure><p>attachå‡½æ•°æœ€ç»ˆè°ƒç”¨äº†ActivityManagerServiceçš„è¿œç¨‹æ¥å£ActivityManagerProxyçš„attachApplicationå‡½æ•°ï¼Œä¼ å…¥çš„å‚æ•°æ˜¯mAppThreadï¼Œè¿™æ˜¯ä¸€ä¸ªApplicationThreadç±»å‹çš„Binderå¯¹è±¡ï¼Œå®ƒçš„ä½œç”¨æ˜¯AMSä¸åº”ç”¨è¿›ç¨‹è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡çš„ã€‚<br>å°†è¿›ç¨‹å’ŒæŒ‡å®šçš„Applicationç»‘å®šèµ·æ¥ã€‚è¿™ä¸ªæ˜¯é€šè¿‡ä¸ŠèŠ‚çš„ActivityThreadå¯¹è±¡ä¸­è°ƒç”¨bindApplication()æ–¹æ³•å®Œæˆçš„ã€‚è¯¥æ–¹æ³•å‘é€ä¸€ä¸ªBIND_APPLICATIONçš„æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­, æœ€ç»ˆé€šè¿‡handleBindApplication()æ–¹æ³•å¤„ç†è¯¥æ¶ˆæ¯. ç„¶åè°ƒç”¨makeApplication()æ–¹æ³•æ¥åŠ è½½Appçš„classesåˆ°å†…å­˜ä¸­ã€‚</p><h6 id="åœ¨AMSä¸­æ³¨å†Œåº”ç”¨è¿›ç¨‹ï¼Œå¯åŠ¨æ ˆé¡¶é¡µé¢"><a href="#åœ¨AMSä¸­æ³¨å†Œåº”ç”¨è¿›ç¨‹ï¼Œå¯åŠ¨æ ˆé¡¶é¡µé¢" class="headerlink" title="åœ¨AMSä¸­æ³¨å†Œåº”ç”¨è¿›ç¨‹ï¼Œå¯åŠ¨æ ˆé¡¶é¡µé¢"></a>åœ¨AMSä¸­æ³¨å†Œåº”ç”¨è¿›ç¨‹ï¼Œå¯åŠ¨æ ˆé¡¶é¡µé¢</h6><p>mMainStack.topRunningActivityLocked(null)ä»å †æ ˆé¡¶ç«¯å–å‡ºè¦å¯åŠ¨çš„Activityï¼Œå¹¶åœ¨realStartActivityLockedhanå‡½æ•°ä¸­é€šè¿‡ApplicationThreadProxyè°ƒå›Appè¿›ç¨‹å¯åŠ¨é¡µé¢ã€‚<br>åœ¨<code>ActivityStackSupervisor</code>ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">realStartActivityLocked</span><span class="hljs-params">(ActivityRecord r,</span><br><span class="hljs-params">            ProcessRecord app, <span class="hljs-type">boolean</span> andResume, <span class="hljs-type">boolean</span> checkConfig)</span><br>            <span class="hljs-keyword">throws</span> RemoteException &#123;<br>                    app.thread.scheduleLaunchActivity(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(r.intent), r.appToken,<br>                    System.identityHashCode(r), r.info, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>(mService.mConfiguration),<br>                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>(stack.mOverrideConfig), r.compat, r.launchedFromPackage,<br>                    task.voiceInteractor, app.repProcState, r.icicle, r.persistentState, results,<br>                    newIntents, !andResume, mService.isNextTransitionForward(), profilerInfo);<br>            &#125;<br></code></pre></td></tr></table></figure><p>å®ƒä¼šè°ƒç”¨applicationçº¿ç¨‹å¯¹è±¡ä¸­çš„scheduleLaunchActivity()å‘é€ä¸€ä¸ªLAUNCH_ACTIVITYæ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­, é€šè¿‡ handleLaunchActivity()æ¥å¤„ç†è¯¥æ¶ˆæ¯ã€‚åœ¨ handleLaunchActivity()é€šè¿‡performLaunchActiivty()æ–¹æ³•å›è°ƒActivityçš„onCreate()æ–¹æ³•å’ŒonStart()æ–¹æ³•ï¼Œç„¶åé€šè¿‡handleResumeActivity()æ–¹æ³•ï¼Œå›è°ƒActivityçš„onResume()æ–¹æ³•ï¼Œè€Œåä¼šé€šçŸ¥AMSè¯¥MainActivityå·²ç»å¤„äºresumeçŠ¶æ€æœ€ç»ˆæ˜¾ç¤ºActivityç•Œé¢ã€‚<br>è‡³æ­¤ï¼Œæ•´ä¸ªå¯åŠ¨æµç¨‹å‘Šä¸€æ®µè½ã€‚</p><p>æœ€åï¼š</p><h6 id="ä¸€ä¸ªAppçš„ç¨‹åºå…¥å£åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä¸€ä¸ªAppçš„ç¨‹åºå…¥å£åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸€ä¸ªAppçš„ç¨‹åºå…¥å£åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä¸€ä¸ªAppçš„ç¨‹åºå…¥å£åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</h6><p>æ˜¯ActivityThread.main()ã€‚</p><h6 id="æ•´ä¸ªAppçš„ä¸»çº¿ç¨‹çš„æ¶ˆæ¯å¾ªç¯æ˜¯åœ¨å“ªé‡Œåˆ›å»ºçš„ï¼Ÿ"><a href="#æ•´ä¸ªAppçš„ä¸»çº¿ç¨‹çš„æ¶ˆæ¯å¾ªç¯æ˜¯åœ¨å“ªé‡Œåˆ›å»ºçš„ï¼Ÿ" class="headerlink" title="æ•´ä¸ªAppçš„ä¸»çº¿ç¨‹çš„æ¶ˆæ¯å¾ªç¯æ˜¯åœ¨å“ªé‡Œåˆ›å»ºçš„ï¼Ÿ"></a>æ•´ä¸ªAppçš„ä¸»çº¿ç¨‹çš„æ¶ˆæ¯å¾ªç¯æ˜¯åœ¨å“ªé‡Œåˆ›å»ºçš„ï¼Ÿ</h6><p>æ˜¯åœ¨ActivityThreadåˆå§‹åŒ–çš„æ—¶å€™ï¼Œå°±å·²ç»åˆ›å»ºæ¶ˆæ¯å¾ªç¯äº†ï¼Œæ‰€ä»¥åœ¨ä¸»çº¿ç¨‹é‡Œé¢åˆ›å»ºHandlerä¸éœ€è¦æŒ‡å®šLooperï¼Œè€Œå¦‚æœåœ¨å…¶ä»–çº¿ç¨‹ä½¿ç”¨Handlerï¼Œåˆ™éœ€è¦å•ç‹¬ä½¿ç”¨Looper.prepare()å’ŒLooper.loop()åˆ›å»ºæ¶ˆæ¯å¾ªç¯ã€‚å¯ä»¥çœ‹ActivityThreadçš„mainæ–¹æ³•</p><h6 id="Applicationæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™åˆ›å»ºçš„ï¼ŸonCreate-ä»€ä¹ˆæ—¶å€™è°ƒç”¨çš„ï¼Ÿ"><a href="#Applicationæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™åˆ›å»ºçš„ï¼ŸonCreate-ä»€ä¹ˆæ—¶å€™è°ƒç”¨çš„ï¼Ÿ" class="headerlink" title="Applicationæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™åˆ›å»ºçš„ï¼ŸonCreate()ä»€ä¹ˆæ—¶å€™è°ƒç”¨çš„ï¼Ÿ"></a>Applicationæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™åˆ›å»ºçš„ï¼ŸonCreate()ä»€ä¹ˆæ—¶å€™è°ƒç”¨çš„ï¼Ÿ</h6><p>ä¹Ÿæ˜¯åœ¨ActivityThread.main()çš„æ—¶å€™ï¼Œå°±æ˜¯åœ¨thread.attach(false)çš„æ—¶å€™ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (!system) &#123;<br>            ViewRootImpl.addFirstDrawHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                    ensureJitEnabled();<br>                &#125;<br>            &#125;);<br>            android.ddm.DdmHandleAppName.setAppName(<span class="hljs-string">&quot;&lt;pre-initialized&gt;&quot;</span>,<br>                                                    UserHandle.myUserId());<br>            RuntimeInit.setApplicationObject(mAppThread.asBinder());<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">IActivityManager</span> <span class="hljs-variable">mgr</span> <span class="hljs-operator">=</span> ActivityManagerNative.getDefault();<br>            <span class="hljs-keyword">try</span> &#123;<br>                mgr.attachApplication(mAppThread);<br>            &#125; <span class="hljs-keyword">catch</span> (RemoteException ex) &#123;<br>                <span class="hljs-comment">// Ignore</span><br>            &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦å…³æ³¨çš„å°±æ˜¯mgr.attachApplication(mAppThread)ï¼Œè¿™ä¸ªå°±ä¼šé€šè¿‡Binderè°ƒç”¨åˆ°AMSé‡Œé¢å¯¹åº”çš„æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">attachApplication</span><span class="hljs-params">(IApplicationThread thread)</span> &#123;<br>    <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">callingPid</span> <span class="hljs-operator">=</span> Binder.getCallingPid();<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">origId</span> <span class="hljs-operator">=</span> Binder.clearCallingIdentity();<br>        attachApplicationLocked(thread, callingPid);<br>        Binder.restoreCallingIdentity(origId);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åè°ƒç”¨çš„å°±æ˜¯<code>private final boolean attachApplicationLocked(IApplicationThread thread,int pid)</code>æ–¹æ³•ï¼Œthreadæ˜¯IApplicationThreadï¼Œå®é™…ä¸Šå°±æ˜¯ApplicationThreadåœ¨æœåŠ¡ç«¯çš„ä»£ç†ç±»ApplicationThreadProxyï¼Œç„¶ååˆé€šè¿‡IPCå°±ä¼šè°ƒç”¨åˆ°ApplicationThreadçš„å¯¹åº”æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•é‡Œé¢åˆè°ƒç”¨äº†<code>sendMessage()</code>ï¼Œé‡Œé¢æœ‰å‡½æ•°çš„ç¼–å·H.BIND_APPLICATIONï¼Œç„¶åè¿™ä¸ªMessgeä¼šè¢«Hè¿™ä¸ªHandlerå¤„ç†:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">H</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Handler</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">BIND_APPLICATION</span>        <span class="hljs-operator">=</span> <span class="hljs-number">110</span>;<br>    <span class="hljs-keyword">case</span> BIND_APPLICATION:<br>                    Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="hljs-string">&quot;bindApplication&quot;</span>);<br>                    <span class="hljs-type">AppBindData</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> (AppBindData)msg.obj;<br>                    handleBindApplication(data);<br>                    Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);<br>                    <span class="hljs-keyword">break</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨<code>handleBindApplication(data)</code>æ–¹æ³•ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-keyword">try</span> &#123;<br>      java.lang.<span class="hljs-type">ClassLoader</span> <span class="hljs-variable">cl</span> <span class="hljs-operator">=</span> instrContext.getClassLoader();<br>      mInstrumentation = (Instrumentation)cl.loadClass(data.instrumentationName.getClassName()).newInstance();<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Unable to instantiate instrumentation &quot;</span>+ data.instrumentationName + <span class="hljs-string">&quot;: &quot;</span> + e.toString(), e);<br><br>        ......<br>         <span class="hljs-comment">// Do this after providers, since instrumentation tests generally start their</span><br>            <span class="hljs-comment">// test thread at this point, and we don&#x27;t want that racing.</span><br>            <span class="hljs-keyword">try</span> &#123;<br>                mInstrumentation.onCreate(data.instrumentationArgs);<br>            &#125;<br>            <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<br>                    <span class="hljs-string">&quot;Exception thrown in onCreate() of &quot;</span><br>                    + data.instrumentationName + <span class="hljs-string">&quot;: &quot;</span> + e.toString(), e);<br>            &#125;<br><br>            <span class="hljs-keyword">try</span> &#123;<br>                mInstrumentation.callApplicationOnCreate(app);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                <span class="hljs-keyword">if</span> (!mInstrumentation.onException(app, e)) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<br>                        <span class="hljs-string">&quot;Unable to create application &quot;</span> + app.getClass().getName()<br>                        + <span class="hljs-string">&quot;: &quot;</span> + e.toString(), e);<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            StrictMode.setThreadPolicy(savedPolicy);<br>        &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸åŒçš„ç‰ˆæœ¬ä»£ç ä¸å°½ç›¸åŒï¼Œä½†æ˜¯åŸºæœ¬é€»è¾‘ä¸ä¼šå˜ã€‚<br>å‚è€ƒã€æŠ„è¢­çš„é“¾æ¥å¦‚ä¸‹ï¼š<br><a href="https://blog.csdn.net/bfboys/article/details/52564531">https://blog.csdn.net/bfboys/article/details/52564531</a><br><a href="https://www.jianshu.com/p/a72c5ccbd150">https://www.jianshu.com/p/a72c5ccbd150</a><br><a href="https://www.jianshu.com/p/6037f6fda285">https://www.jianshu.com/p/6037f6fda285</a><br><a href="https://www.jianshu.com/p/a72c5ccbd150">https://www.jianshu.com/p/a72c5ccbd150</a></p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>é¢è¯•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Androidå¤šè¿›ç¨‹ä¸‰</title>
    <link href="/2018/07/23/Android%E5%A4%9A%E8%BF%9B%E7%A8%8B%E4%B8%89/"/>
    <url>/2018/07/23/Android%E5%A4%9A%E8%BF%9B%E7%A8%8B%E4%B8%89/</url>
    
    <content type="html"><![CDATA[<p>Androidä¸­ä¸­IPCæ–¹å¼æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ä½¿ç”¨Bundleï¼Œä½¿ç”¨æ–‡ä»¶å…±äº«ï¼Œä½¿ç”¨Messengerï¼Œä½¿ç”¨AIDLï¼Œä½¿ç”¨ContentProviderï¼Œä½¿ç”¨Socketç­‰ã€‚å‰ä¸¤ç§æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œè‡ªå·±ç©ã€‚<br>ä¸‹é¢ä¸»è¦æ˜¯æŠ„çš„ã€ŠAndroidå¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹2.4.4ç« èŠ‚ï¼Œçœ‹è¿‡ä¹¦çš„å°±ä¸ç”¨çœ‹äº†ã€‚</p><span id="more"></span><p>ä¸Šä¸€ç¯‡ä¸»è¦æŠ„äº†Messengeræ¥è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡çš„æ–¹æ³•ï¼Œå¯ä»¥å‘ç°Messengeræ˜¯ä»¥ä¸²è¡Œçš„æ–¹å¼å¤„ç†å®¢æˆ·ç«¯å‘æ¥çš„æ¶ˆæ¯ï¼Œå¦‚æœå¤§é‡çš„æ¶ˆæ¯åŒæ—¶å‘é€åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä»ç„¶åªèƒ½ä¸€ä¸ªä¸ªå¤„ç†ï¼Œå¦‚æœæœ‰å¤§é‡çš„å¹¶å‘è¯·æ±‚ï¼Œé‚£ä¹ˆç”¨Messengerå°±ä¸å¤ªåˆé€‚äº†ã€‚åŒæ—¶ï¼ŒMessengerçš„ä½œç”¨ä¸»è¦æ˜¯ä¸ºäº†ä¼ é€’æ¶ˆæ¯ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¯èƒ½éœ€è¦è·¨è¿›ç¨‹è°ƒç”¨æœåŠ¡ç«¯çš„æ–¹æ³•ï¼Œè¿™ç§æƒ…å½¢ç”¨Messengerå°±æ— æ³•åšåˆ°äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨AIDLæ¥å®ç°è·¨è¿›ç¨‹çš„æ–¹æ³•è°ƒç”¨ã€‚AIDLä¹Ÿæ˜¯Messengerçš„åº•å±‚å®ç°ï¼Œå› æ­¤Messengeræœ¬è´¨ä¸Šä¹Ÿæ˜¯AIDLï¼Œåªä¸è¿‡ç³»ç»Ÿä¸ºæˆ‘ä»¬åšäº†å°è£…ä»è€Œæ–¹ä¾¿ä¸Šå±‚çš„è°ƒç”¨è€Œå·²ã€‚åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†Binderçš„æ¦‚å¿µï¼Œå¤§å®¶å¯¹Binderä¹Ÿæœ‰äº†ä¸€å®šçš„äº†è§£ï¼Œåœ¨Binderçš„åŸºç¡€ä¸Šæˆ‘ä»¬å¯ä»¥æ›´åŠ å®¹æ˜“åœ°ç†è§£AIDLã€‚è¿™é‡Œå…ˆä»‹ç»ä½¿ç”¨AIDLæ¥è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡çš„æµç¨‹ï¼Œåˆ†ä¸ºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸¤ä¸ªæ–¹é¢ã€‚</p><h5 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h5><p>æœåŠ¡ç«¯é¦–å…ˆè¦åˆ›å»ºä¸€ä¸ªServiceç”¨æ¥ç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªAIDLæ–‡ä»¶ï¼Œå°†æš´éœ²ç»™å®¢æˆ·ç«¯çš„æ¥å£åœ¨è¿™ä¸ªAIDLæ–‡ä»¶ä¸­å£°æ˜ï¼Œæœ€ååœ¨Serviceä¸­å®ç°è¿™ä¸ªAIDLæ¥å£å³å¯ã€‚</p><h5 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h5><p>å®¢æˆ·ç«¯æ‰€è¦åšäº‹æƒ…å°±ç¨å¾®ç®€å•ä¸€äº›ï¼Œé¦–å…ˆéœ€è¦ç»‘å®šæœåŠ¡ç«¯çš„Serviceï¼Œç»‘å®šæˆåŠŸåï¼Œå°†æœåŠ¡ç«¯è¿”å›çš„Binderå¯¹è±¡è½¬æˆAIDLæ¥å£æ‰€å±çš„ç±»å‹ï¼Œæ¥ç€å°±å¯ä»¥è°ƒç”¨AIDLä¸­çš„æ–¹æ³•äº†ã€‚</p><h5 id="å…·ä½“å®ç°æ–¹å¼"><a href="#å…·ä½“å®ç°æ–¹å¼" class="headerlink" title="å…·ä½“å®ç°æ–¹å¼"></a>å…·ä½“å®ç°æ–¹å¼</h5><h6 id="AIDLæ¥å£çš„åˆ›å»º"><a href="#AIDLæ¥å£çš„åˆ›å»º" class="headerlink" title="AIDLæ¥å£çš„åˆ›å»º"></a>AIDLæ¥å£çš„åˆ›å»º</h6><p>æ”¶çœ‹çœ‹AIDLæ¥å£çš„åˆ›å»ºï¼Œå¦‚ä¸‹æ‰€ç¤ºåˆ›å»ºäº†ä¸€ä¸ªåç¼€ä¸ºAIDLçš„æ–‡ä»¶ï¼Œåœ¨é‡Œé¢å£°æ˜äº†ä¸€ä¸ªæ¥å£å’Œä¸¤ä¸ªæ–¹æ³•ã€‚åˆ›å»ºAIDLæ–‡ä»¶çš„æ–¹å¼å¯ä»¥çœ‹è¿™ä¸ª<a href="http://blog.huangyuanlove.com/2018/06/21/Android%E5%A4%9A%E8%BF%9B%E7%A8%8B-%E4%B8%80/#more">Androidå¤šè¿›ç¨‹(ä¸€)</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// IBookManager.aidl</span><br><span class="hljs-keyword">package</span> com.huangyuanlove.testandroid;<br><br><span class="hljs-comment">// Declare any non-default types here with import statements</span><br><span class="hljs-keyword">import</span> com.huangyuanlove.testandroid.Book;<br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">IBookManager</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Demonstrates some basic types that you can use as parameters</span><br><span class="hljs-comment">     * and return values in AIDL.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">basicTypes</span><span class="hljs-params">(<span class="hljs-type">int</span> anInt, <span class="hljs-type">long</span> aLong, <span class="hljs-type">boolean</span> aBoolean, <span class="hljs-type">float</span> aFloat,</span><br><span class="hljs-params">            <span class="hljs-type">double</span> aDouble, String aString)</span>;<br>            List&lt;Book&gt; <span class="hljs-title function_">getBookList</span><span class="hljs-params">()</span>;<br>            <span class="hljs-keyword">void</span> <span class="hljs-title function_">addBook</span><span class="hljs-params">(in Book book)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨AIDLæ–‡ä»¶ä¸­ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æ•°æ®ç±»å‹éƒ½æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œåªæ”¯æŒå¦‚ä¸‹å‡ ç§ç±»å‹ï¼š</p><ul><li>åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆintã€longã€charã€booleanã€doubleç­‰ï¼‰ï¼›</li><li>Stringå’ŒCharSequenceï¼›</li><li>Listï¼šåªæ”¯æŒArrayListï¼Œé‡Œé¢æ¯ä¸ªå…ƒç´ éƒ½å¿…é¡»èƒ½å¤Ÿè¢«AIDLæ”¯æŒï¼›</li><li>Mapï¼šåªæ”¯æŒHashMapï¼Œé‡Œé¢çš„æ¯ä¸ªå…ƒç´ éƒ½å¿…é¡»è¢«AIDLæ”¯æŒï¼ŒåŒ…æ‹¬keyå’Œvalueï¼›</li><li>Parcelableï¼šæ‰€æœ‰å®ç°äº†Parcelableæ¥å£çš„å¯¹è±¡ï¼›</li><li>AIDLï¼šæ‰€æœ‰çš„AIDLæ¥å£æœ¬èº«ä¹Ÿå¯ä»¥åœ¨AIDLæ–‡ä»¶ä¸­ä½¿ç”¨ã€‚</li></ul><p>ä»¥ä¸Š6ç§æ•°æ®ç±»å‹å°±æ˜¯AIDLæ‰€æ”¯æŒçš„æ‰€æœ‰ç±»å‹ï¼Œå…¶ä¸­è‡ªå®šä¹‰çš„Parcelableå¯¹è±¡å’ŒAIDLå¯¹è±¡å¿…é¡»è¦æ˜¾å¼importè¿›æ¥ï¼Œä¸ç®¡å®ƒä»¬æ˜¯å¦å’Œå½“å‰çš„AIDLæ–‡ä»¶ä½äºåŒä¸€ä¸ªåŒ…å†…ã€‚æ¯”å¦‚IBookManager.aidlè¿™ä¸ªæ–‡ä»¶ï¼Œé‡Œé¢ç”¨åˆ°äº†Bookè¿™ä¸ªç±»ï¼Œè¿™ä¸ªç±»å®ç°äº†Parcelableæ¥å£å¹¶ä¸”å’ŒIBookManager.aidlä½äºåŒä¸€ä¸ªåŒ…ä¸­ï¼Œä½†æ˜¯éµå®ˆAIDLçš„è§„èŒƒï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦æ˜¾å¼åœ°importè¿›æ¥ï¼šcom.huangyuanlove.testandroid.Bookã€‚<br>å¦å¤–ä¸€ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹æ˜¯ï¼Œå¦‚æœAIDLæ–‡ä»¶ä¸­ç”¨åˆ°äº†è‡ªå®šä¹‰çš„Parcelableå¯¹è±¡ï¼Œé‚£ä¹ˆå¿…é¡»æ–°å»ºä¸€ä¸ªå’Œå®ƒåŒåçš„AIDLæ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­å£°æ˜å®ƒä¸ºParcelableç±»å‹ã€‚åœ¨ä¸Šé¢çš„IBookManager.aidlä¸­ï¼Œæˆ‘ä»¬ç”¨åˆ°äº†Bookè¿™ä¸ªç±»ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¿…é¡»è¦åˆ›å»ºBook.aidlï¼Œç„¶ååœ¨é‡Œé¢æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.huangyuanlove.testandroid;<br>parcelable Book;<br></code></pre></td></tr></table></figure><h6 id="è¿œç¨‹æœåŠ¡ç«¯Serviceçš„å®ç°"><a href="#è¿œç¨‹æœåŠ¡ç«¯Serviceçš„å®ç°" class="headerlink" title="è¿œç¨‹æœåŠ¡ç«¯Serviceçš„å®ç°"></a>è¿œç¨‹æœåŠ¡ç«¯Serviceçš„å®ç°</h6><p>ä¸Šé¢è®²è¿°äº†å¦‚ä½•å®šä¹‰AIDLæ¥å£ï¼Œæ¥ä¸‹æ¥å®ç°è¿™ä¸ªæ¥å£ã€‚å…ˆåˆ›å»ºä¸€ä¸ªserviceï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.huangyuanlove.testandroid;<br><br><span class="hljs-keyword">import</span> android.app.Service;<br><span class="hljs-keyword">import</span> android.content.Intent;<br><span class="hljs-keyword">import</span> android.os.Binder;<br><span class="hljs-keyword">import</span> android.os.IBinder;<br><span class="hljs-keyword">import</span> android.os.RemoteException;<br><span class="hljs-keyword">import</span> android.support.annotation.Nullable;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.concurrent.CopyOnWriteArrayList;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookManagerService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Service</span> &#123;<br><br>    <span class="hljs-keyword">private</span> CopyOnWriteArrayList&lt;Book&gt; mBookList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CopyOnWriteArrayList</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Binder</span> <span class="hljs-variable">mBinder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IBookManager</span>.Stub() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">basicTypes</span><span class="hljs-params">(<span class="hljs-type">int</span> anInt, <span class="hljs-type">long</span> aLong, <span class="hljs-type">boolean</span> aBoolean, <span class="hljs-type">float</span> aFloat, <span class="hljs-type">double</span> aDouble, String aString)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> List&lt;Book&gt; <span class="hljs-title function_">getBookList</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>            <span class="hljs-keyword">return</span> mBookList;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addBook</span><span class="hljs-params">(Book book)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>            mBookList.add(book);<br>        &#125;<br>    &#125;;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate();<br>        mBookList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-number">1</span>,<span class="hljs-string">&quot;Android&quot;</span>));<br>        mBookList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-number">2</span>,<span class="hljs-string">&quot;IOS&quot;</span>));<br>    &#125;<br><br>    <span class="hljs-meta">@Nullable</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> IBinder <span class="hljs-title function_">onBind</span><span class="hljs-params">(Intent intent)</span> &#123;<br>        <span class="hljs-keyword">return</span> mBinder;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯ä¸€ä¸ªæœåŠ¡ç«¯Serviceçš„å…¸å‹å®ç°ï¼Œé¦–å…ˆåœ¨onCreateä¸­åˆå§‹åŒ–æ·»åŠ äº†ä¸¤æœ¬å›¾ä¹¦çš„ä¿¡æ¯ï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ªBinderå¯¹è±¡å¹¶åœ¨onBindä¸­è¿”å›å®ƒï¼Œè¿™ä¸ªå¯¹è±¡ç»§æ‰¿<code>IBookManager.Stub</code>å¹¶å®ç°äº†å®ƒå†…éƒ¨çš„AIDLæ–¹æ³•ï¼Œæ³¨æ„è¿™é‡Œé‡‡ç”¨äº†CopyOnWriteArrayListï¼Œè¿™ä¸ªCopyOnWriteArrayListæ”¯æŒå¹¶å‘è¯»&#x2F;å†™ã€‚åœ¨å‰é¢<br>æˆ‘ä»¬æåˆ°ï¼ŒAIDLæ–¹æ³•æ˜¯åœ¨æœåŠ¡ç«¯çš„Binderçº¿ç¨‹æ± ä¸­æ‰§è¡Œçš„ï¼Œå› æ­¤å½“å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è¿æ¥çš„æ—¶å€™ï¼Œä¼šå­˜åœ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®çš„æƒ…å½¢ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åœ¨AIDLæ–¹æ³•ä¸­å¤„ç†çº¿ç¨‹åŒæ­¥ï¼Œè€Œæˆ‘ä»¬è¿™é‡Œç›´æ¥ä½¿ç”¨CopyOnWriteArrayListæ¥è¿›è¡Œè‡ªåŠ¨çš„çº¿ç¨‹åŒæ­¥ã€‚AIDLä¸­æ‰€æ”¯æŒçš„æ˜¯æŠ½è±¡çš„Listï¼Œè€ŒListåªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå› æ­¤è™½ç„¶æœåŠ¡ç«¯è¿”å›çš„æ˜¯CopyOnWriteArrayListï¼Œä½†æ˜¯åœ¨Binderä¸­ä¼šæŒ‰ç…§Listçš„è§„èŒƒå»è®¿é—®æ•°æ®å¹¶æœ€ç»ˆå½¢æˆä¸€ä¸ªæ–°çš„ArrayListä¼ é€’ç»™å®¢æˆ·ç«¯ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨æœåŠ¡ç«¯é‡‡ç”¨CopyOnWriteArrayListæ˜¯å®Œå…¨å¯ä»¥çš„ã€‚å’Œæ­¤ç±»ä¼¼çš„è¿˜æœ‰ConcurrentHashMapï¼Œç„¶åæˆ‘ä»¬éœ€è¦åœ¨XMLä¸­æ³¨å†Œè¿™ä¸ªService:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;.BookManagerService&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:process</span>=<span class="hljs-string">&quot;:remote&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><h6 id="å®¢æˆ·ç«¯çš„å®ç°"><a href="#å®¢æˆ·ç«¯çš„å®ç°" class="headerlink" title="å®¢æˆ·ç«¯çš„å®ç°"></a>å®¢æˆ·ç«¯çš„å®ç°</h6><p>å®¢æˆ·ç«¯çš„å®ç°å°±æ¯”è¾ƒç®€å•äº†ï¼Œé¦–å…ˆè¦ç»‘å®šè¿œç¨‹æœåŠ¡ï¼Œç»‘å®šæˆåŠŸåå°†æœåŠ¡ç«¯è¿”å›çš„Binderå¯¹è±¡è½¬æ¢æˆAIDLæ¥å£ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥å£å»è°ƒç”¨æœåŠ¡ç«¯çš„è¿œç¨‹æ–¹æ³•äº†ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">ServiceConnection</span> <span class="hljs-variable">mConnection</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceConnection</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onServiceConnected</span><span class="hljs-params">(ComponentName name, IBinder service)</span> &#123;<br>            IBookManager bookManager= IBookManager.Stub.asInterface(service);<br>            <span class="hljs-keyword">try</span> &#123;<br>                List&lt;Book&gt; list = bookManager.getBookList();<br>                Log.d(<span class="hljs-string">&quot;xuan&quot;</span>,<span class="hljs-string">&quot;bookManager.getBookList()--&gt;&quot;</span> + list.size());<br>                bookManager.addBook(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-number">3</span>,<span class="hljs-string">&quot;java&quot;</span>));<br>                List&lt;Book&gt; newList = bookManager.getBookList();<br>                Log.d(<span class="hljs-string">&quot;xuan&quot;</span>,<span class="hljs-string">&quot;bookManager.getBookList()--&gt;&quot;</span> + newList.size());<br>            &#125;<span class="hljs-keyword">catch</span> (RemoteException e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onServiceDisconnected</span><span class="hljs-params">(ComponentName name)</span> &#123;<br><br>        &#125;<br>    &#125;;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_main);<br>        <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(<span class="hljs-built_in">this</span>,BookManagerService.class);<br>        bindService(intent,mConnection, Context.BIND_AUTO_CREATE);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> &#123;<br>        unbindService(mConnection);<br>        <span class="hljs-built_in">super</span>.onDestroy();<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»‘å®šæˆåŠŸä»¥åï¼Œä¼šé€šè¿‡bookManagerå»è°ƒç”¨getBookListæ–¹æ³•ï¼Œç„¶åæ‰“å°å‡ºæ‰€è·å–çš„å›¾ä¹¦ä¿¡æ¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæœåŠ¡ç«¯çš„æ–¹æ³•æœ‰å¯èƒ½éœ€è¦å¾ˆä¹…æ‰èƒ½æ‰§è¡Œå®Œæ¯•ï¼Œè¿™ä¸ªæ—¶å€™ä¸‹é¢çš„ä»£ç å°±ä¼šå¯¼è‡´ANRï¼Œè¿™ä¸€ç‚¹æ˜¯éœ€è¦æ³¨æ„çš„ï¼Œåé¢ä¼šå†ä»‹ç»è¿™ç§æƒ…å†µï¼Œæ¥ç€å†è°ƒç”¨ä¸€ä¸‹å¦å¤–ä¸€ä¸ªæ¥å£addBookï¼Œæˆ‘ä»¬åœ¨å®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯æ·»åŠ ä¸€æœ¬ä¹¦ï¼Œç„¶åå†è·å–ä¸€æ¬¡ã€‚<br>ç°åœ¨æˆ‘ä»¬è€ƒè™‘ä¸€ç§æƒ…å†µï¼Œå‡è®¾æœ‰ä¸€ç§éœ€æ±‚ï¼šç”¨æˆ·ä¸æƒ³æ—¶ä¸æ—¶åœ°å»æŸ¥è¯¢å›¾ä¹¦åˆ—è¡¨äº†ï¼Œå¤ªç´¯äº†ï¼Œäºæ˜¯ï¼Œä»–å»é—®å›¾ä¹¦é¦†ï¼Œâ€œå½“æœ‰æ–°ä¹¦æ—¶èƒ½ä¸èƒ½æŠŠä¹¦çš„ä¿¡æ¯å‘Šè¯‰æˆ‘å‘¢ï¼Ÿâ€ã€‚è¿™å°±æ˜¯ä¸€ç§å…¸å‹çš„è§‚å¯Ÿè€…æ¨¡å¼ã€‚<br>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æä¾›ä¸€ä¸ªAIDLæ¥å£ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½éœ€è¦å®ç°è¿™ä¸ªæ¥å£å¹¶ä¸”å‘å›¾ä¹¦é¦†ç”³è¯·æ–°ä¹¦çš„æé†’åŠŸèƒ½ï¼Œå½“ç„¶ç”¨æˆ·ä¹Ÿå¯ä»¥éšæ—¶å–æ¶ˆè¿™ç§æé†’ã€‚ä¹‹æ‰€ä»¥é€‰æ‹©AIDL<br>æ¥å£è€Œä¸æ˜¯æ™®é€šæ¥å£ï¼Œæ˜¯å› ä¸ºAIDLä¸­æ— æ³•ä½¿ç”¨æ™®é€šæ¥å£ã€‚è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªIOnNewBookArrivedListener.aidlæ–‡ä»¶ï¼Œæˆ‘ä»¬æ‰€æœŸæœ›çš„æƒ…å†µæ˜¯ï¼šå½“æœåŠ¡ç«¯æœ‰æ–°ä¹¦åˆ°æ¥æ—¶ï¼Œå°±ä¼šé€šçŸ¥æ¯ä¸€ä¸ªå·²ç»ç”³è¯·æé†’åŠŸèƒ½çš„ç”¨æˆ·ã€‚ä»ç¨‹åºä¸Šæ¥è¯´å°±æ˜¯è°ƒç”¨æ‰€æœ‰IOnNewBookArrivedListenerå¯¹è±¡ä¸­çš„onNewBookArrivedæ–¹æ³•ï¼Œå¹¶æŠŠæ–°ä¹¦çš„å¯¹è±¡é€šè¿‡å‚æ•°ä¼ é€’ç»™å®¢æˆ·ç«¯ï¼Œå†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// IOnNewBookArrivedListener.aidl</span><br><span class="hljs-keyword">package</span> com.huangyuanlove.testandroid;<br><br><span class="hljs-comment">// Declare any non-default types here with import statements</span><br><span class="hljs-keyword">import</span> com.huangyuanlove.testandroid.Book;<br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">IOnNewBookArrivedListener</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Demonstrates some basic types that you can use as parameters</span><br><span class="hljs-comment">     * and return values in AIDL.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">basicTypes</span><span class="hljs-params">(<span class="hljs-type">int</span> anInt, <span class="hljs-type">long</span> aLong, <span class="hljs-type">boolean</span> aBoolean, <span class="hljs-type">float</span> aFloat,</span><br><span class="hljs-params">            <span class="hljs-type">double</span> aDouble, String aString)</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onNewBookArrived</span><span class="hljs-params">(in Book newBook)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>AIDLä¸­é™¤äº†åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå…¶ä»–ç±»å‹çš„å‚æ•°å¿…é¡»æ ‡ä¸Šæ–¹å‘ï¼šinã€outæˆ–è€…inoutï¼Œinè¡¨ç¤ºè¾“å…¥å‹å‚æ•°ï¼Œoutè¡¨ç¤ºè¾“å‡ºå‹å‚æ•°ï¼Œinoutè¡¨ç¤ºè¾“å…¥è¾“å‡ºå‹å‚æ•°ï¼Œè‡³äºå®ƒä»¬å…·ä½“çš„åŒºåˆ«ï¼Œå®˜ç½‘æ˜¯è¿™ä¹ˆè¯´çš„ï¼š</p><blockquote><p>All non-primitive parameters require a directional tag indicating which way the data goes . Either in , out , or inout . Primitives are in by default , and connot be otherwise .</p></blockquote><blockquote><p>æ‰€æœ‰çš„éåŸºæœ¬å‚æ•°éƒ½éœ€è¦ä¸€ä¸ªå®šå‘tagæ¥æŒ‡å‡ºæ•°æ®çš„æµå‘ï¼Œä¸ç®¡æ˜¯ in , out , è¿˜æ˜¯ inout ã€‚åŸºæœ¬å‚æ•°çš„å®šå‘tagé»˜è®¤æ˜¯å¹¶ä¸”åªèƒ½æ˜¯ in ã€‚</p></blockquote><p>æˆ‘ä»¬è¦æ ¹æ®å®é™…éœ€è¦å»æŒ‡å®šå‚æ•°ç±»å‹ï¼Œä¸èƒ½ä¸€æ¦‚ä½¿ç”¨outæˆ–è€…inoutï¼Œå› ä¸ºè¿™åœ¨åº•å±‚å®ç°æ˜¯æœ‰å¼€é”€çš„ã€‚æœ€åï¼ŒAIDLæ¥å£ä¸­åªæ”¯æŒæ–¹æ³•ï¼Œä¸æ”¯æŒå£°æ˜é™æ€å¸¸é‡ï¼Œè¿™ä¸€ç‚¹åŒºåˆ«äºä¼ ç»Ÿçš„æ¥å£ã€‚<br>é™¤äº†è¦æ–°å¢åŠ ä¸€ä¸ªAIDLæ¥å£ï¼Œè¿˜éœ€è¦åœ¨åŸæœ‰çš„æ¥å£ä¸­æ·»åŠ ä¸¤ä¸ªæ–°æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.huangyuanlove.testandroid;<br><br><span class="hljs-keyword">import</span> com.huangyuanlove.testandroid.Book;<br><span class="hljs-keyword">import</span> com.huangyuanlove.testandroid.IOnNewBookArrivedListener;<br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">IBookManager</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">basicTypes</span><span class="hljs-params">(<span class="hljs-type">int</span> anInt, <span class="hljs-type">long</span> aLong, <span class="hljs-type">boolean</span> aBoolean, <span class="hljs-type">float</span> aFloat,</span><br><span class="hljs-params">            <span class="hljs-type">double</span> aDouble, String aString)</span>;<br>    List&lt;Book&gt; <span class="hljs-title function_">getBookList</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">addBook</span><span class="hljs-params">(in Book book)</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerListener</span><span class="hljs-params">(IOnNewBookArrivedListener listener)</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">unRegisterListener</span><span class="hljs-params">(IOnNewBookArrivedListener listener)</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ¥ç€ï¼ŒæœåŠ¡ç«¯ä¸­çš„Serviceçš„å®ç°ä¹Ÿéœ€è¦ä¿®æ”¹ä¸€ä¸‹ï¼Œä¸»è¦æ˜¯Serviceä¸­çš„IBookManager.Stubçš„å®ç°ï¼Œéœ€è¦å®ç°æ–°å¢åŠ çš„ä¸¤ä¸ªæ–¹æ³•(IDEæ²¡æœ‰æç¤ºçš„è¯å¯ä»¥makeä¸€ä¸‹)ã€‚åŒæ—¶ï¼Œåœ¨BookManagerServiceä¸­è¿˜å¼€å¯äº†ä¸€ä¸ªçº¿ç¨‹ï¼Œæ¯éš”5så°±å‘ä¹¦åº“ä¸­å¢åŠ ä¸€æœ¬æ–°ä¹¦å¹¶é€šçŸ¥æ‰€æœ‰æ„Ÿå…´è¶£çš„ç”¨æˆ·ï¼Œæ•´ä¸ªä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookManagerService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Service</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">AtomicBoolean</span> <span class="hljs-variable">mIsServiceDestroyed</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicBoolean</span>(<span class="hljs-literal">false</span>);<br>    <span class="hljs-keyword">private</span> CopyOnWriteArrayList&lt;Book&gt; mBookList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CopyOnWriteArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">private</span> CopyOnWriteArrayList&lt;IOnNewBookArrivedListener&gt; mListenerList<br>            = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CopyOnWriteArrayList</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Binder</span> <span class="hljs-variable">mBinder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IBookManager</span>.Stub() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">basicTypes</span><span class="hljs-params">(<span class="hljs-type">int</span> anInt, <span class="hljs-type">long</span> aLong, <span class="hljs-type">boolean</span> aBoolean, <span class="hljs-type">float</span> aFloat, <span class="hljs-type">double</span> aDouble, String aString)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br><br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> List&lt;Book&gt; <span class="hljs-title function_">getBookList</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>            <span class="hljs-keyword">return</span> mBookList;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addBook</span><span class="hljs-params">(Book book)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>            mBookList.add(book);<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerListener</span><span class="hljs-params">(IOnNewBookArrivedListener listener)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>            <span class="hljs-keyword">if</span> (!mListenerList.contains(listener)) &#123;<br>                mListenerList.add(listener);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                Log.d(<span class="hljs-string">&quot;xuan&quot;</span>, <span class="hljs-string">&quot;already exists.&quot;</span>);<br>            &#125;<br>            Log.d(<span class="hljs-string">&quot;xuan&quot;</span>, <span class="hljs-string">&quot;registerListener,size:&quot;</span> + mListenerList.size());<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unRegisterListener</span><span class="hljs-params">(IOnNewBookArrivedListener listener)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>            <span class="hljs-keyword">if</span> (mListenerList.contains(listener)) &#123;<br>                mListenerList.remove(listener);<br>                Log.d(<span class="hljs-string">&quot;xuan&quot;</span>, <span class="hljs-string">&quot;unregister listener succeed.&quot;</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                Log.d(<span class="hljs-string">&quot;xuan&quot;</span>, <span class="hljs-string">&quot;not found,can not unregister.&quot;</span>);<br>            &#125;<br>            Log.d(<span class="hljs-string">&quot;xuan&quot;</span>, <span class="hljs-string">&quot;unregisterListener,current size:&quot;</span> + mListenerList.size());<br>        &#125;<br>    &#125;;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate();<br><br>        mBookList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;Android&quot;</span>));<br>        mBookList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;IOS&quot;</span>));<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceWorker</span>()).start();<br>    &#125;<br><br>    <span class="hljs-meta">@Nullable</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> IBinder <span class="hljs-title function_">onBind</span><span class="hljs-params">(Intent intent)</span> &#123;<br>        <span class="hljs-keyword">return</span> mBinder;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> &#123;<br>        mIsServiceDestroyed.set(<span class="hljs-literal">true</span>);<br>        <span class="hljs-built_in">super</span>.onDestroy();<br>    &#125;<br><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onNewBookArrived</span><span class="hljs-params">(Book book)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>        mBookList.add(book);<br>        Log.d(<span class="hljs-string">&quot;xuan&quot;</span>, <span class="hljs-string">&quot;onNewBookArrived,notify listeners:&quot;</span> + mListenerList.<br>                size());<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; mListenerList.size(); i++) &#123;<br>            <span class="hljs-type">IOnNewBookArrivedListener</span> <span class="hljs-variable">listener</span> <span class="hljs-operator">=</span> mListenerList.get(i);<br>            Log.d(<span class="hljs-string">&quot;xuan&quot;</span>, <span class="hljs-string">&quot;onNewBookArrived,notify listener:&quot;</span> + listener);<br>            listener.onNewBookArrived(book);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceWorker</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">while</span> (!mIsServiceDestroyed.get()) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    Thread.sleep(<span class="hljs-number">5000</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>                <span class="hljs-type">int</span> <span class="hljs-variable">bookId</span> <span class="hljs-operator">=</span> mBookList.size() + <span class="hljs-number">1</span>;<br>                <span class="hljs-type">Book</span> <span class="hljs-variable">newBook</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(bookId, <span class="hljs-string">&quot;new book#&quot;</span> + bookId);<br>                <span class="hljs-keyword">try</span> &#123;<br>                    onNewBookArrived(newBook);<br>                &#125; <span class="hljs-keyword">catch</span> (RemoteException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æœ€åè¿˜éœ€è¦ä¿®æ”¹ä¸€ä¸‹å®¢æˆ·ç«¯çš„ä»£ç ï¼Œä¸»è¦æœ‰ä¸¤æ–¹é¢ï¼šé¦–å…ˆå®¢æˆ·ç«¯è¦æ³¨å†ŒIOnNewBookArrivedListeneråˆ°è¿œç¨‹æœåŠ¡ç«¯ï¼Œè¿™æ ·å½“æœ‰æ–°ä¹¦æ—¶æœåŠ¡ç«¯æ‰èƒ½é€šçŸ¥å½“å‰å®¢æˆ·ç«¯ï¼ŒåŒæ—¶æˆ‘ä»¬è¦åœ¨Activityé€€å‡ºæ—¶è§£é™¤è¿™ä¸ªæ³¨å†Œï¼›å¦ä¸€æ–¹é¢ï¼Œå½“æœ‰æ–°ä¹¦æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šå›è°ƒå®¢æˆ·ç«¯çš„IOnNewBookArrivedListenerå¯¹è±¡ä¸­çš„onNewBookArrivedæ–¹æ³•ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨å®¢æˆ·ç«¯çš„Binderçº¿ç¨‹æ± ä¸­æ‰§è¡Œçš„ï¼Œå› æ­¤ï¼Œä¸ºäº†ä¾¿äºè¿›è¡ŒUIæ“ä½œï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªHandlerå¯ä»¥å°†å…¶åˆ‡æ¢åˆ°å®¢æˆ·ç«¯çš„ä¸»çº¿ç¨‹ä¸­å»æ‰§è¡Œï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MESSAGE_NEW_BOOK_ARRIVED</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">private</span> IBookManager mRemoteBookManager;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Handler</span> <span class="hljs-variable">mHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(Message msg)</span> &#123;<br>            <span class="hljs-keyword">switch</span> (msg.what) &#123;<br>                <span class="hljs-keyword">case</span> MESSAGE_NEW_BOOK_ARRIVED:<br>                    Log.d(<span class="hljs-string">&quot;MainActivity&quot;</span>,<span class="hljs-string">&quot;receive new book :&quot;</span> + msg.obj);<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">default</span>:<br>                    <span class="hljs-built_in">super</span>.handleMessage(msg);<br>            &#125;<br>        &#125;<br>    &#125;;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">ServiceConnection</span> <span class="hljs-variable">mConnection</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceConnection</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onServiceConnected</span><span class="hljs-params">(ComponentName name, IBinder service)</span> &#123;<br>            IBookManager bookManager= IBookManager.Stub.asInterface(service);<br>            <span class="hljs-keyword">try</span> &#123;<br>                mRemoteBookManager = bookManager;<br>                List&lt;Book&gt; list = bookManager.getBookList();<br>                Log.d(<span class="hljs-string">&quot;MainActivity&quot;</span>,<span class="hljs-string">&quot;bookManager.getBookList()--&gt;&quot;</span> + list.size() +<span class="hljs-string">&quot;&gt;&gt; &quot;</span> + list.toString());<br>                bookManager.addBook(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-number">3</span>,<span class="hljs-string">&quot;java&quot;</span>));<br>                List&lt;Book&gt; newList = bookManager.getBookList();<br>                Log.d(<span class="hljs-string">&quot;MainActivity&quot;</span>,<span class="hljs-string">&quot;bookManager.getBookList()--&gt;&quot;</span> + newList.size()+<span class="hljs-string">&quot;&gt;&gt; &quot;</span> + newList.toString());<br>                bookManager.registerListener(mOnNewBookArrivedListener);<br>            &#125;<span class="hljs-keyword">catch</span> (RemoteException e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onServiceDisconnected</span><span class="hljs-params">(ComponentName name)</span> &#123;<br>            mRemoteBookManager = <span class="hljs-literal">null</span>;<br>            Log.e(<span class="hljs-string">&quot;MainActivity&quot;</span>,<span class="hljs-string">&quot;binder died.&quot;</span>);<br>        &#125;<br>    &#125;;<br><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">IOnNewBookArrivedListener</span> <span class="hljs-variable">mOnNewBookArrivedListener</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IOnNewBookArrivedListener</span>.Stub() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">basicTypes</span><span class="hljs-params">(<span class="hljs-type">int</span> anInt, <span class="hljs-type">long</span> aLong, <span class="hljs-type">boolean</span> aBoolean, <span class="hljs-type">float</span> aFloat, <span class="hljs-type">double</span> aDouble, String aString)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br><br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onNewBookArrived</span><span class="hljs-params">(Book newBook)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>            mHandler.obtainMessage(MESSAGE_NEW_BOOK_ARRIVED,newBook)<br>                    .sendToTarget();<br>        &#125;<br>    &#125;;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_main);<br>        <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(<span class="hljs-built_in">this</span>,BookManagerService.class);<br>        bindService(intent,mConnection, Context.BIND_AUTO_CREATE);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (mRemoteBookManager != <span class="hljs-literal">null</span><br>                &amp;&amp; mRemoteBookManager.asBinder().isBinderAlive()) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                Log.d(<span class="hljs-string">&quot;MainActivity&quot;</span>,<span class="hljs-string">&quot;unregister listener:&quot;</span> + mOnNewBookArrivedListener);<br>                mRemoteBookManager.unRegisterListener(mOnNewBookArrivedListener);<br>            &#125; <span class="hljs-keyword">catch</span> (RemoteException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>        unbindService(mConnection);<br>        <span class="hljs-built_in">super</span>.onDestroy();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå½“BookManagerActivityå…³é—­æ—¶ï¼Œæˆ‘ä»¬ä¼šåœ¨onDestroyä¸­å»è§£é™¤å·²ç»æ³¨å†Œåˆ°æœåŠ¡ç«¯çš„listenerï¼Œè¿™å°±ç›¸å½“äºæˆ‘ä»¬ä¸æƒ³å†æ¥æ”¶å›¾ä¹¦é¦†çš„æ–°ä¹¦æé†’äº†ï¼Œæ‰€ä»¥æˆ‘<br>ä»¬å¯ä»¥éšæ—¶å–æ¶ˆè¿™ä¸ªæé†’æœåŠ¡ã€‚æŒ‰backé”®é€€å‡ºBookManagerActivity,ä¸‹é¢æ˜¯æ‰“å°å‡ºçš„log</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs log">07-23 14:56:55.493 16905-16918/com.huangyuanlove.testandroid:remote D/BookManagerService: not found,can not unregister.<br>07-23 14:56:57.185 16905-16918/com.huangyuanlove.testandroid:remote D/BookManagerService: unregisterListener,current size:1<br></code></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„logå¯ä»¥çœ‹å‡ºï¼Œç¨‹åºæ²¡æœ‰åƒæˆ‘ä»¬æ‰€é¢„æœŸçš„é‚£æ ·æ‰§è¡Œã€‚åœ¨è§£æ³¨å†Œçš„è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡ç«¯ç«Ÿç„¶æ— æ³•æ‰¾åˆ°æˆ‘ä»¬ä¹‹å‰æ³¨å†Œçš„é‚£ä¸ªlistenerï¼Œå…¶å®ï¼Œè¿™æ˜¯å¿…ç„¶çš„ï¼Œè¿™ç§è§£æ³¨å†Œçš„å¤„ç†æ–¹å¼åœ¨æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­æ—¶å¸¸ä½¿ç”¨åˆ°ï¼Œä½†æ˜¯æ”¾åˆ°å¤šè¿›ç¨‹ä¸­å´æ— æ³•å¥æ•ˆï¼Œå› ä¸ºBinderä¼šæŠŠå®¢æˆ·ç«¯ä¼ é€’è¿‡æ¥çš„å¯¹è±¡é‡æ–°è½¬åŒ–å¹¶ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚è™½ç„¶æˆ‘ä»¬åœ¨æ³¨å†Œå’Œè§£æ³¨å†Œè¿‡ç¨‹ä¸­ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯å¯¹è±¡ï¼Œä½†æ˜¯é€šè¿‡Binderä¼ é€’åˆ°æœåŠ¡ç«¯åï¼Œå´ä¼šäº§ç”Ÿä¸¤ä¸ªå…¨æ–°çš„å¯¹è±¡ã€‚åˆ«å¿˜äº†å¯¹è±¡æ˜¯ä¸èƒ½è·¨è¿›ç¨‹ç›´æ¥ä¼ è¾“çš„ï¼Œå¯¹è±¡çš„è·¨è¿›ç¨‹ä¼ è¾“æœ¬è´¨ä¸Šéƒ½æ˜¯ååºåˆ—åŒ–çš„è¿‡ç¨‹ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆAIDLä¸­çš„è‡ªå®šä¹‰å¯¹è±¡éƒ½å¿…é¡»è¦å®ç°Parcelableæ¥å£çš„åŸå› ã€‚å¯ä»¥ä½¿ç”¨<code>RemoteCallbackList</code>ã€‚<br>RemoteCallbackListæ˜¯ç³»ç»Ÿä¸“é—¨æä¾›çš„ç”¨äºåˆ é™¤è·¨è¿›ç¨‹listenerçš„æ¥å£ã€‚ RemoteCallbackListæ˜¯ä¸€ä¸ªæ³›å‹ï¼Œ æ”¯æŒç®¡ç†ä»»æ„çš„AIDLæ¥å£ï¼Œ è¿™ç‚¹ä»å®ƒçš„å£°æ˜å°±å¯ä»¥çœ‹å‡ºï¼Œå› ä¸ºæ‰€æœ‰çš„AIDLæ¥å£éƒ½ç»§æ‰¿è‡ªIInterfaceæ¥å£</p><blockquote><p>public class RemoteCallbackList<E extends IInterface></p></blockquote><p>å®ƒçš„å·¥ä½œåŸç†å¾ˆç®€å•ï¼Œ åœ¨å®ƒçš„å†…éƒ¨æœ‰ä¸€ä¸ªMapç»“æ„ä¸“é—¨ç”¨æ¥ä¿å­˜æ‰€æœ‰çš„AIDLå›è°ƒï¼Œè¿™ä¸ªMapçš„keyæ˜¯IBinderç±»å‹ï¼Œ valueæ˜¯Callbackç±»å‹ï¼Œ å¦‚ä¸‹æ‰€ç¤º:</p><blockquote><p>ArrayMap&lt;IBinder,Callback&gt; mCallbacks &#x3D; new ArrayMap&lt;IBinder,Callback&gt;();</p></blockquote><p>å…¶ä¸­Callbackä¸­å°è£…äº†çœŸæ­£çš„è¿œç¨‹listenerã€‚ å½“å®¢æˆ·ç«¯æ³¨å†Œlistenerçš„æ—¶å€™ï¼Œå®ƒä¼šæŠŠè¿™ä¸ªlistenerçš„ä¿¡æ¯å­˜å…¥mCallbacksä¸­ï¼Œ å…¶ä¸­keyå’Œvalueåˆ†åˆ«é€šè¿‡ä¸‹é¢çš„æ–¹å¼è·å¾—ï¼š</p><blockquote><p>IBinder key&#x3D; listener.asBinder()<br>Callback value &#x3D; new Callback(listener,cookie)</p></blockquote><p>è™½ç„¶è¯´å¤šæ¬¡è·¨è¿›ç¨‹ä¼ è¾“å®¢æˆ·ç«¯çš„åŒä¸€ä¸ªå¯¹è±¡ä¼šåœ¨æœåŠ¡ç«¯ç”Ÿæˆä¸åŒçš„å¯¹è±¡ï¼Œä½†æ˜¯è¿™äº›æ–°ç”Ÿæˆçš„å¯¹è±¡æœ‰ä¸€ä¸ªå…±åŒç‚¹ï¼Œé‚£å°±æ˜¯å®ƒä»¬åº•å±‚çš„Binderå¯¹è±¡æ˜¯åŒä¸€ä¸ªï¼Œ åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œå°±å¯ä»¥å®ç°ä¸Šé¢æˆ‘ä»¬æ— æ³•å®ç°çš„åŠŸèƒ½ã€‚å½“å®¢æˆ·ç«¯è§£æ³¨å†Œçš„æ—¶å€™ï¼Œæˆ‘ä»¬åªè¦éå†æœåŠ¡ç«¯æ‰€æœ‰çš„listenerï¼Œ æ‰¾å‡ºé‚£ä¸ªå’Œè§£æ³¨å†Œlistenerå…·æœ‰ç›¸åŒBinderå¯¹è±¡çš„æœåŠ¡ç«¯listenerå¹¶æŠŠå®ƒåˆ æ‰å³å¯ï¼Œè¿™å°±æ˜¯RemoteCallbackListä¸ºæˆ‘ä»¬åšçš„äº‹æƒ…ã€‚åŒæ—¶RemoteCallbackListè¿˜æœ‰ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„åŠŸèƒ½ï¼Œ é‚£å°±æ˜¯å½“å®¢æˆ·ç«¯è¿›ç¨‹ç»ˆæ­¢åï¼Œå®ƒèƒ½å¤Ÿè‡ªåŠ¨ç§»é™¤å®¢æˆ·ç«¯æ‰€æ³¨å†Œçš„listenerã€‚å¦å¤–ï¼ŒRemoteCallbackListå†…éƒ¨è‡ªåŠ¨å®ç°äº†çº¿ç¨‹åŒæ­¥çš„åŠŸèƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨å®ƒæ¥æ³¨å†Œå’Œè§£æ³¨å†Œæ—¶ï¼Œä¸éœ€è¦åšé¢å¤–çš„çº¿ç¨‹åŒæ­¥å·¥ä½œã€‚<br>RemoteCallbackListä½¿ç”¨èµ·æ¥å¾ˆç®€å•ï¼Œæˆ‘ä»¬è¦å¯¹BookManagerServiceåšä¸€äº›ä¿®æ”¹ï¼Œé¦–å…ˆè¦åˆ›å»ºä¸€ä¸ªRemoteCallbackListå¯¹è±¡æ¥æ›¿ä»£ä¹‹å‰çš„CopyOnWriteArrayListï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> RemoteCallbackList&lt;IOnNewBookArrivedListener&gt; mListenerList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RemoteCallbackList</span>&lt;IOnNewBookArrivedListener&gt;();<br></code></pre></td></tr></table></figure><p>ç„¶åä¿®æ”¹registerListenerå’ŒunregisterListenerè¿™ä¸¤ä¸ªæ¥å£çš„å®ç°ï¼Œ å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerListener</span><span class="hljs-params">(IOnNewBookArrivedIistener listener)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>    mListenerList.register(listener);<br>&#125;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unRegisterListener</span><span class="hljs-params">(IOnNewBookArrivedIistener listener)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>    mListenerList.unregister(listener);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€è¦ä¿®æ”¹onNewBookArrivedæ–¹æ³•ï¼Œå½“æœ‰æ–°ä¹¦æ—¶ï¼Œæˆ‘ä»¬å°±è¦é€šçŸ¥æ‰€æœ‰å·²æ³¨å†Œçš„listenerï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onNewBookArrived</span><span class="hljs-params">(Book book)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>        books.add(book);<br>       <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">N</span>  <span class="hljs-operator">=</span>mListenerList.beginBroadcast();<br>       <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span> ; i &lt; N;i++)&#123;<br>           <span class="hljs-type">IOnNewBookArrivedIistener</span> <span class="hljs-variable">iOnNewBookArrivedIistener</span> <span class="hljs-operator">=</span> mListenerList.getBroadcastItem(i);<br>           <span class="hljs-keyword">if</span>(iOnNewBookArrivedIistener!=<span class="hljs-literal">null</span>)&#123;<br>               iOnNewBookArrivedIistener.onNewBookArrived(book);<br>           &#125;<br>       &#125;<br>       mListenerList.finishBroadcast();<br>    &#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨RemoteCallbackListï¼Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œæˆ‘ä»¬æ— æ³•åƒæ“ä½œListä¸€æ ·å»æ“ä½œå®ƒï¼Œå°½ç®¡å®ƒçš„åå­—ä¸­ä¹Ÿå¸¦ä¸ªListï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªListã€‚éå†RemoteCallbackListï¼Œå¿…é¡»è¦æŒ‰ç…§ä¸‹é¢çš„æ–¹å¼è¿›è¡Œï¼Œå…¶ä¸­beginBroadcastå’ŒbeginBroadcastå¿…é¡»è¦é…å¯¹ä½¿ç”¨ï¼Œå“ªæ€•æˆ‘ä»¬ä»…ä»…æ˜¯æƒ³è¦è·å–RemoteCallbackListä¸­çš„å…ƒç´ ä¸ªæ•°ï¼Œè¿™æ˜¯å¿…é¡»è¦æ³¨æ„çš„åœ°æ–¹ã€‚<br>å¦å¤–è¿˜æœ‰å‡ ç‚¹éœ€è¦è¯´æ˜ä¸€ä¸‹ï¼š</p><ul><li>å®¢æˆ·ç«¯è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æ–¹æ³•ï¼Œè¢«è°ƒç”¨çš„æ–¹æ³•è¿è¡Œåœ¨æœåŠ¡ç«¯çš„Binderçº¿ç¨‹æ± ä¸­ï¼ŒåŒæ—¶å®¢æˆ·ç«¯çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœæœåŠ¡ç«¯æ–¹æ³•æ‰§è¡Œæ¯”è¾ƒè€—æ—¶ï¼Œå°±ä¼šå¯¼è‡´å®¢æˆ·ç«¯çº¿ç¨‹é•¿æ—¶é—´åœ°é˜»å¡åœ¨è¿™é‡Œï¼Œè€Œå¦‚æœè¿™ä¸ªå®¢æˆ·ç«¯çº¿ç¨‹æ˜¯UIçº¿ç¨‹çš„è¯ï¼Œå°±ä¼šå¯¼è‡´å®¢æˆ·ç«¯ANRã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬æ˜ç¡®çŸ¥é“æŸä¸ªè¿œç¨‹æ–¹æ³•æ˜¯è€—æ—¶çš„ï¼Œé‚£ä¹ˆå°±è¦é¿å…åœ¨å®¢æˆ·ç«¯çš„UIçº¿ç¨‹ä¸­å»è®¿é—®è¿œç¨‹æ–¹æ³•ã€‚ç”±äºå®¢æˆ·ç«¯çš„<code>onServiceConnected</code>å’Œ<code>onServiceDisconnected</code>æ–¹æ³•éƒ½è¿è¡Œåœ¨UIçº¿ç¨‹ä¸­ï¼Œæ‰€ä»¥ä¹Ÿä¸å¯ä»¥åœ¨å®ƒä»¬é‡Œé¢ç›´æ¥è°ƒç”¨æœåŠ¡ç«¯çš„è€—æ—¶æ–¹æ³•ï¼Œè¿™ç‚¹è¦å°¤å…¶æ³¨æ„ã€‚</li><li>ç”±äºæœåŠ¡ç«¯çš„æ–¹æ³•æœ¬èº«å°±è¿è¡Œåœ¨æœåŠ¡ç«¯çš„Binderçº¿ç¨‹æ± ä¸­ï¼Œæ‰€ä»¥æœåŠ¡ç«¯æ–¹æ³•æœ¬èº«å°±å¯ä»¥æ‰§è¡Œå¤§é‡è€—æ—¶æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™åˆ‡è®°ä¸è¦åœ¨æœåŠ¡ç«¯æ–¹æ³•ä¸­å¼€çº¿ç¨‹å»è¿›è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œé™¤éä½ æ˜ç¡®çŸ¥é“è‡ªå·±åœ¨å¹²ä»€ä¹ˆï¼Œå¦åˆ™ä¸å»ºè®®è¿™ä¹ˆåšã€‚</li><li>åŒç†ï¼Œå½“è¿œç¨‹æœåŠ¡ç«¯éœ€è¦è°ƒç”¨å®¢æˆ·ç«¯çš„listenerä¸­çš„æ–¹æ³•æ—¶ï¼Œè¢«è°ƒç”¨çš„æ–¹æ³•ä¹Ÿè¿è¡Œåœ¨Binderçº¿ç¨‹æ± ä¸­ï¼Œåªä¸è¿‡æ˜¯å®¢æˆ·ç«¯çš„çº¿ç¨‹æ± ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åŒæ ·ä¸å¯ä»¥åœ¨æœåŠ¡ç«¯ä¸­è°ƒç”¨å®¢æˆ·ç«¯çš„è€—æ—¶æ–¹æ³•ã€‚æ¯”å¦‚é’ˆå¯¹BookManagerServiceçš„onNewBookArrivedæ–¹æ³•ã€‚åœ¨å®ƒå†…éƒ¨è°ƒç”¨äº†å®¢æˆ·ç«¯çš„IOnNewBookArrivedListenerä¸­çš„onNewBookArrivedæ–¹æ³•ï¼Œå¦‚æœå®¢æˆ·ç«¯çš„è¿™ä¸ªonNewBookArrivedæ–¹æ³•æ¯”è¾ƒè€—æ—¶çš„è¯ï¼Œé‚£ä¹ˆè¯·ç¡®ä¿BookManagerServiceä¸­çš„onNewBookArrivedè¿è¡Œåœ¨éUIçº¿ç¨‹ä¸­ï¼Œå¦åˆ™å°†å¯¼è‡´æœåŠ¡ç«¯æ— æ³•å“åº”ã€‚</li><li>æƒé™éªŒè¯ï¼Œç¬¬ä¸€ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨onBindä¸­è¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯ä¸é€šè¿‡å°±ç›´æ¥è¿”å›nullï¼Œè¿™æ ·éªŒè¯å¤±è´¥çš„å®¢æˆ·ç«¯ç›´æ¥æ— æ³•ç»‘å®šæœåŠ¡ï¼Œè‡³äºéªŒè¯æ–¹å¼å¯ä»¥æœ‰å¤šç§ï¼Œ æ¯”å¦‚ä½¿ç”¨permissionéªŒè¯ã€‚ç¬¬äºŒç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡ç«¯çš„onTransactæ–¹æ³•ä¸­è¿›è¡Œæƒé™éªŒè¯ï¼Œå¦‚æœéªŒè¯å¤±è´¥å°±ç›´æ¥è¿”å›falseï¼Œè¿™æ ·æœåŠ¡ç«¯å°±ä¸ä¼šç»ˆæ­¢æ‰§è¡ŒAIDLä¸­çš„æ–¹æ³•ä»è€Œè¾¾åˆ°ä¿æŠ¤æœåŠ¡ç«¯çš„æ•ˆæœã€‚</li></ul><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Androidå¤šè¿›ç¨‹-äºŒ</title>
    <link href="/2018/06/22/Android%E5%A4%9A%E8%BF%9B%E7%A8%8B-%E4%BA%8C/"/>
    <url>/2018/06/22/Android%E5%A4%9A%E8%BF%9B%E7%A8%8B-%E4%BA%8C/</url>
    
    <content type="html"><![CDATA[<p>Androidä¸­ä¸­IPCæ–¹å¼æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ä½¿ç”¨Bundleï¼Œä½¿ç”¨æ–‡ä»¶å…±äº«ï¼Œä½¿ç”¨Messengerï¼Œä½¿ç”¨AIDLï¼Œä½¿ç”¨ContentProviderï¼Œä½¿ç”¨Socketç­‰ã€‚å‰ä¸¤ç§æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œè‡ªå·±ç©ã€‚<br>ä¸‹é¢ä¸»è¦æ˜¯æŠ„çš„ã€ŠAndroidå¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹2.4.3ç« èŠ‚ï¼Œçœ‹è¿‡ä¹¦çš„å°±ä¸ç”¨çœ‹äº†ã€‚</p><span id="more"></span><p>Messengerå¯ä»¥ç¿»è¯‘ä¸ºä¿¡ä½¿ï¼Œé¡¾åæ€ä¹‰ï¼Œé€šè¿‡å®ƒå¯ä»¥åœ¨ä¸åŒè¿›ç¨‹ä¸­ä¼ é€’Messageå¯¹è±¡,åœ¨Messageä¸­æ”¾å…¥æˆ‘ä»¬éœ€è¦ä¼ é€’çš„æ•°æ®ï¼Œå°±å¯ä»¥è½»æ¾åœ°å®ç°æ•°æ®çš„è¿›ç¨‹é—´ä¼ é€’äº†ã€‚Messengeræ˜¯ä¸€ç§è½»é‡çº§çš„IPCæ–¹æ¡ˆï¼Œå®ƒçš„åº•å±‚å®ç°æ˜¯AIDLï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Œæˆ‘ä»¬å¤§è‡´çœ‹ä¸€ä¸‹Messengerè¿™ä¸ªç±»çš„æ„é€ æ–¹æ³•å°±æ˜ç™½äº†ã€‚ä¸‹é¢æ˜¯Messengerçš„ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼Œä»æ„é€ æ–¹æ³•çš„å®ç°ä¸Šæˆ‘ä»¬å¯ä»¥æ˜æ˜¾çœ‹å‡ºAIDLçš„ç—•è¿¹ï¼Œä¸ç®¡æ˜¯IMessengerè¿˜æ˜¯Stub.asInterface,è¿™ç§ä½¿ç”¨æ–¹æ³•éƒ½è¡¨æ˜å®ƒçš„åº•å±‚æ˜¯AIDLã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">Messenger</span> <span class="hljs-params">(Handler target)</span> &#123;<br>    mTarget = target.getIMessenger();<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-title function_">Messenger</span> <span class="hljs-params">( IBinder target)</span> &#123;<br>    mTarget = IMessenger.Stub.asInterface(target);<br>&#125;<br></code></pre></td></tr></table></figure><p>Messengerçš„ä½¿ç”¨æ–¹æ³•å¾ˆç®€å•ï¼Œå®ƒå¯¹AIDLåšäº†å°è£…ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥æ›´ç®€ä¾¿åœ°è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ã€‚åŒæ—¶ï¼Œç”±äºå®ƒä¸€æ¬¡å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œå› æ­¤åœ¨æœåŠ¡ç«¯æˆ‘ä»¬ä¸ç”¨è€ƒè™‘çº¿ç¨‹åŒæ­¥çš„é—®é¢˜ï¼Œè¿™æ˜¯å› ä¸ºæœåŠ¡ç«¯ä¸­ä¸å­˜åœ¨å¹¶å‘æ‰§è¡Œçš„æƒ…å½¢ã€‚å®ç°ä¸€ä¸ªMessengeræœ‰å¦‚ä¸‹å‡ ä¸ªæ­¥éª¤ï¼Œåˆ†ä¸ºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ã€‚</p><ol><li>æœåŠ¡ç«¯è¿›ç¨‹<br>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡ç«¯åˆ›å»ºâ€“ä¸ªServiceæ¥å¤„ç†å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªHandlerå¹¶é€šè¿‡å®ƒæ¥åˆ›å»ºä¸€ä¸ªMessengerå¯¹ è±¡ï¼Œç„¶ååœ¨Serviceçš„onBindä¸­è¿”å›è¿™ä¸ªMessengerå¯¹è±¡åº•å±‚çš„Binderå³å¯ã€‚</li><li>å®¢æˆ·ç«¯è¿›ç¨‹<br>å®¢æˆ·ç«¯è¿›ç¨‹ä¸­ï¼Œé¦–å…ˆè¦ç»‘å®šæœåŠ¡ç«¯çš„Service,ç»‘å®šæˆåŠŸåç”¨æœåŠ¡ç«¯è¿”å›çš„IBinderå¯¹è±¡åˆ›å»ºä¸€ä¸ªMessenger,é€šè¿‡è¿™ä¸ªMessengerå°±å¯ä»¥å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯äº†ï¼Œå‘æ¶ˆæ¯ç±»å‹ä¸ºMessageå¯¹è±¡ã€‚å¦‚æœéœ€è¦æœåŠ¡ç«¯èƒ½å¤Ÿå›åº”å®¢æˆ·ç«¯ï¼Œå°±å’ŒæœåŠ¡ç«¯ä¸€-æ ·ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªHandlerå¹¶åˆ›å»ºä¸€ä¸ª æ–°çš„Messenger,å¹¶æŠŠè¿™ä¸ªMessengerå¯¹è±¡é€šè¿‡Messageçš„replyToå‚æ•°ä¼ é€’ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯é€šè¿‡è¿™ä¸ªreplyToå‚æ•°å°±å¯ä»¥å›åº”å®¢æˆ·ç«¯ã€‚</li></ol><p>é¦–å…ˆçœ‹æœåŠ¡ç«¯çš„ä»£ç ï¼Œè¿™æ˜¯æœåŠ¡ç«¯çš„å…¸å‹ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°MessengerHandlerç”¨æ¥å¤„ç†å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ï¼Œå¹¶ä»æ¶ˆæ¯ä¸­å–å‡ºå®¢æˆ·ç«¯å‘æ¥çš„æ–‡æœ¬ä¿¡æ¯ã€‚è€ŒmMessengeræ˜¯ä¸€ä¸ªMessengerå¯¹è±¡ï¼Œå®ƒå’ŒMessengerHandlerç›¸å…³è”ï¼Œå¹¶åœ¨onBindæ–¹æ³•ä¸­è¿”å›å®ƒé‡Œé¢çš„Binderå¯¹è±¡ï¼Œå¯ä»¥çœ‹å‡ºï¼Œè¿™é‡ŒMessengerçš„ä½œç”¨æ˜¯å°†å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ä¼ é€’ç»™MessengerHandlerå¤„ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessengerService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Service</span> &#123;<br><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessengerHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Handler</span>&#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(Message msg)</span> &#123;<br>            <span class="hljs-keyword">switch</span> (msg.what)&#123;<br>                <span class="hljs-keyword">case</span> <span class="hljs-number">10001</span>:<br>                    Log.e(<span class="hljs-string">&quot;xuan&quot;</span>,<span class="hljs-string">&quot;æ”¶åˆ°å®¢æˆ·ç«¯&quot;</span>+msg.getData().getString(<span class="hljs-string">&quot;msg&quot;</span>));<br>                    <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">default</span>:<br>                        <span class="hljs-built_in">super</span>.handleMessage(msg);<br>            &#125;<br><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Messenger</span> <span class="hljs-variable">messenger</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Messenger</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MessengerHandler</span>());<br>    <span class="hljs-meta">@Nullable</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> IBinder <span class="hljs-title function_">onBind</span><span class="hljs-params">(Intent intent)</span> &#123;<br>        <span class="hljs-keyword">return</span> messenger.getBinder();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ç„¶åæ³¨å†Œ<code>service</code>,è®©å…¶åœ¨å•ç‹¬çš„è¿›ç¨‹ä¸­è¿è¡Œ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">service</span></span><br><span class="hljs-tag"><span class="hljs-attr">android:</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;.messenger.MessengerService&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">android:</span> <span class="hljs-attr">process</span>=<span class="hljs-string">&quot;:remote&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åœ¨å®¢æˆ·ç«¯,é¦–å…ˆéœ€è¦ç»‘å®šè¿œç¨‹è¿›ç¨‹çš„MessengerService,ç»‘å®šæˆåŠŸåï¼Œæ ¹æ®æœåŠ¡ç«¯è¿”å›çš„binderå¯¹è±¡åˆ›å»ºMessengerå¯¹è±¡å¹¶ä½¿ç”¨æ­¤å¯¹è±¡å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ã€‚ä¸‹é¢çš„ä»£ç åœ¨Bundleä¸­å‘æœåŠ¡ç«¯å‘é€äº†ä¸€å¥è¯ï¼Œåœ¨ï¼Œä¸Šé¢çš„æœåŠ¡ç«¯ä»£ç ä¸­ä¼šæ‰“å°å‡ºè¿™å¥è¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessengerActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br><br><br>    <span class="hljs-keyword">private</span> Messenger mService;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">ServiceConnection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceConnection</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onServiceConnected</span><span class="hljs-params">(ComponentName name, IBinder service)</span> &#123;<br>            mService = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Messenger</span>(service);<br>            <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> Message.obtain(<span class="hljs-literal">null</span>,<span class="hljs-number">10001</span>);<br>            <span class="hljs-type">Bundle</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bundle</span>();<br>            data.putString(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;hi æ¥è‡ªå®¢æˆ·ç«¯çš„é—®å€™&quot;</span>);<br>            msg.setData(data);<br>            <span class="hljs-keyword">try</span> &#123;<br>                mService.send(msg);<br>            &#125; <span class="hljs-keyword">catch</span> (RemoteException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onServiceDisconnected</span><span class="hljs-params">(ComponentName name)</span> &#123;<br><br>        &#125;<br>    &#125;;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_messenger2);<br><br>        <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(<span class="hljs-built_in">this</span>, MessengerService.class);<br>        bindService(intent,connection, Context.BIND_AUTO_CREATE);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onDestroy();<br>        unbindService(connection);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œåœ¨Messengerä¸­è¿›è¡Œæ•°æ®ä¼ é€’å¿…é¡»å°†æ•°æ®æ”¾å…¥Messageä¸­ï¼Œè€ŒMessengerå’ŒMessageéƒ½å®ç°äº†Parcelableæ¥å£ï¼Œå› æ­¤å¯ä»¥è·¨è¿›ç¨‹ä¼ è¾“ã€‚ç®€å•æ¥è¯´,Messageä¸­æ‰€æ”¯æŒçš„æ•°æ®ç±»å‹å°±æ˜¯Messengeræ‰€æ”¯æŒçš„ä¼ è¾“ç±»å‹ã€‚å®é™…ä¸Šï¼Œé€šè¿‡Messengeræ¥ä¼ è¾“Message, Messageä¸­ èƒ½ä½¿ç”¨çš„è½½ä½“åªæœ‰whatã€arg1ã€ arg2ã€ Bundle ä»¥åŠreplyToã€‚Messageä¸­çš„å¦ä¸€ä¸ªå­—æ®µobjectåœ¨åŒä¸€-ä¸ªè¿›ç¨‹ä¸­æ˜¯å¾ˆå®ç”¨çš„ï¼Œä½†æ˜¯åœ¨è¿›ç¨‹é—´é€šä¿¡çš„æ—¶å€™ï¼Œåœ¨Android2.2ä»¥å‰objectå­—æ®µä¸æ”¯æŒè·¨è¿›ç¨‹ä¼ è¾“ï¼Œå³ä¾¿æ˜¯2.2ä»¥åï¼Œä¹Ÿä»…ä»…æ˜¯ç³»ç»Ÿæä¾›çš„å®ç°äº†Parcelableæ¥å£çš„å¯¹è±¡æ‰èƒ½é€šè¿‡å®ƒæ¥ä¼ è¾“ã€‚è¿™å°±æ„å‘³ç€æˆ‘ä»¬è‡ªå®šä¹‰çš„Parcelableå¯¹è±¡æ˜¯æ— æ³•é€šè¿‡objectå­—æ®µæ¥ä¼ è¾“çš„ï¼Œè¯»è€…å¯ä»¥è¯•ä¸€ä¸‹ã€‚éç³»ç»Ÿçš„Parcelableå¯¹è±¡çš„ç¡®æ— æ³•é€šè¿‡objectå­—æ®µæ¥ä¼ è¾“ï¼Œè¿™ä¹Ÿå¯¼è‡´äº†objectå­—æ®µçš„å®ç”¨æ€§å¤§å¤§é™ä½ï¼Œæ‰€å¹¸æˆ‘ä»¬è¿˜æœ‰Bundle,Bundleä¸­å¯ä»¥æ”¯æŒå¤§é‡çš„æ•°æ®ç±»å‹ã€‚<br>ä¸Šé¢çš„ä¾‹å­æ¼”ç¤ºäº†å¦‚ä½•åœ¨æœåŠ¡ç«¯æ¥æ”¶å®¢æˆ·ç«¯ä¸­å‘é€çš„æ¶ˆæ¯ï¼Œä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬è¿˜éœ€è¦èƒ½å›åº”å®¢æˆ·ç«¯ï¼Œä¸‹é¢å°±ä»‹ç»å¦‚ä½•å®ç°è¿™ç§æ•ˆæœã€‚è¿˜æ˜¯é‡‡ç”¨ä¸Šé¢çš„ä¾‹å­ï¼Œä½†æ˜¯ç¨å¾®åšä¸€ä¸‹ä¿®æ”¹ï¼Œæ¯å½“å®¢æˆ·ç«¯å‘æ¥ä¸€æ¡æ¶ˆæ¯ï¼ŒæœåŠ¡ç«¯å°±ä¼šè‡ªåŠ¨å›å¤ä¸€æ¡â€œå—¯ï¼Œä½ çš„æ¶ˆæ¯æˆ‘å·²ç»æ”¶åˆ°ï¼Œç¨åä¼šå›å¤ä½ ã€‚â€ï¼Œè¿™å¾ˆç±»ä¼¼é‚®ç®±çš„è‡ªåŠ¨å›å¤åŠŸèƒ½ã€‚</p><p>é¦–å…ˆçœ‹æœåŠ¡ç«¯çš„ä¿®æ”¹ï¼ŒæœåŠ¡ç«¯åªéœ€è¦ä¿®æ”¹MessengerHandler,å½“æ”¶åˆ°æ¶ˆæ¯åï¼Œä¼šç«‹å³å›å¤ä¸€æ¡æ¶ˆæ¯ç»™å®¢æˆ·ç«¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessengerService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Service</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessengerHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Handler</span>&#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(Message msg)</span> &#123;<br>            <span class="hljs-keyword">switch</span> (msg.what)&#123;<br>                <span class="hljs-keyword">case</span> <span class="hljs-number">10001</span>:<br>                    Log.e(<span class="hljs-string">&quot;huangyuan&quot;</span>,<span class="hljs-string">&quot;æ”¶åˆ°å®¢æˆ·ç«¯&quot;</span>+msg.getData().getString(<span class="hljs-string">&quot;msg&quot;</span>));<br>                    <span class="hljs-type">Messenger</span> <span class="hljs-variable">clientMessenger</span> <span class="hljs-operator">=</span> msg.replyTo;<br>                    <span class="hljs-type">Message</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> Message.obtain(<span class="hljs-literal">null</span>,<span class="hljs-number">10001</span>);<br>                    <span class="hljs-type">Bundle</span> <span class="hljs-variable">bundle</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bundle</span>();<br>                    bundle.putString(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;æœåŠ¡ç«¯å›åº”&quot;</span>);<br>                    message.setData(bundle);<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        clientMessenger.send(message);<br>                    &#125; <span class="hljs-keyword">catch</span> (RemoteException e) &#123;<br><br>                        e.printStackTrace();<br>                    &#125;<br>                    <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">default</span>:<br>                        <span class="hljs-built_in">super</span>.handleMessage(msg);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Messenger</span> <span class="hljs-variable">messenger</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Messenger</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MessengerHandler</span>());<br>    <span class="hljs-meta">@Nullable</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> IBinder <span class="hljs-title function_">onBind</span><span class="hljs-params">(Intent intent)</span> &#123;<br>        <span class="hljs-keyword">return</span> messenger.getBinder();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä¸ºäº†æ¥æ”¶æœåŠ¡ç«¯çš„æ¶ˆæ¯ï¼Œå®¢æˆ·ç«¯ä¹Ÿéœ€è¦å‡†å¤‡ä¸€ä¸ªæ¥æ”¶æ¶ˆæ¯çš„Messengerå’ŒHandler:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessengerActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Messenger mService;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Messenger</span> <span class="hljs-variable">getReplyMessenger</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Messenger</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MessengerHandler</span>());<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">ServiceConnection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceConnection</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onServiceConnected</span><span class="hljs-params">(ComponentName name, IBinder service)</span> &#123;<br>            mService = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Messenger</span>(service);<br>            <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> Message.obtain(<span class="hljs-literal">null</span>,<span class="hljs-number">10001</span>);<br>            <span class="hljs-type">Bundle</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bundle</span>();<br>            data.putString(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;hi æ¥è‡ªå®¢æˆ·ç«¯çš„é—®å€™&quot;</span>);<br>            msg.setData(data);<br>            msg.replyTo = getReplyMessenger;<br>            <span class="hljs-keyword">try</span> &#123;<br>                mService.send(msg);<br>            &#125; <span class="hljs-keyword">catch</span> (RemoteException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onServiceDisconnected</span><span class="hljs-params">(ComponentName name)</span> &#123;<br>        &#125;<br>    &#125;;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessengerHandler</span>  <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Handler</span>&#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(Message msg)</span> &#123;<br>            <span class="hljs-keyword">switch</span> (msg.what)&#123;<br>                <span class="hljs-keyword">case</span> <span class="hljs-number">10001</span>:<br>                    Log.e(<span class="hljs-string">&quot;huangyuan&quot;</span>,<span class="hljs-string">&quot;æ”¶åˆ°æœåŠ¡ç«¯çš„å›å¤--&gt;&quot;</span>+ msg.getData().get(<span class="hljs-string">&quot;msg&quot;</span>));<br>                    <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">default</span>:<br>                        <span class="hljs-built_in">super</span>.handleMessage(msg);<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_messenger2);<br>        <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(<span class="hljs-built_in">this</span>, MessengerService.class);<br>        bindService(intent,connection, Context.BIND_AUTO_CREATE);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onDestroy();<br>        unbindService(connection);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å…³é”®çš„ä¸€ç‚¹åœ¨äºå½“å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œéœ€è¦æŠŠæ¥æ”¶æœåŠ¡ç«¯å›å¤çš„Messengeré€šè¿‡Messageçš„replyToå‚æ•°ä¼ é€’ç»™æœåŠ¡ç«¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">msg.replyTo = getReplyMessenger;<br></code></pre></td></tr></table></figure><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Androidå¤šè¿›ç¨‹(ä¸€)</title>
    <link href="/2018/06/21/Android%E5%A4%9A%E8%BF%9B%E7%A8%8B-%E4%B8%80/"/>
    <url>/2018/06/21/Android%E5%A4%9A%E8%BF%9B%E7%A8%8B-%E4%B8%80/</url>
    
    <content type="html"><![CDATA[<p>Referenceï¼šã€ŠAndroidå¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹ï¼Œä½œè€…ï¼šä»»ç‰åˆš<br>å¤šè¿›ç¨‹åŸºç¡€ä»¥åŠä¸€äº›åè¯</p><span id="more"></span><h6 id="IPC"><a href="#IPC" class="headerlink" title="IPC"></a>IPC</h6><p>è¿›ç¨‹é—´é€šä¿¡æˆ–è€…è·¨è¿›ç¨‹é€šä¿¡ï¼Œå…¨ç§°ï¼šInter-Process Communicationã€‚<br>åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œçº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„æœ€å°å•å…ƒï¼ŒåŒæ—¶çº¿ç¨‹æ˜¯ä¸€ç§æœ‰é™çš„ç³»ç»Ÿèµ„æºã€‚è€Œè¿›ç¨‹ä¸€èˆ¬æŒ‡ä¸€ä¸ªæ‰§è¡Œå•å…ƒã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«åšä¸ªçº¿ç¨‹ã€‚æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå³ä¸»çº¿ç¨‹ï¼Œåœ¨Androidä¸­ï¼Œä¸»çº¿ç¨‹ä¹Ÿå«UIçº¿ç¨‹ã€‚<br>IPCä¸æ˜¯Androidä¸­æ‰€ç‹¬æœ‰çš„ï¼Œä»»ä½•ä¸€ä¸ªæ“ä½œç³»ç»Ÿéƒ½éœ€è¦æœ‰ç›¸åº”çš„IPCæœºåˆ¶ï¼Œæ¯”å¦‚windowsä¸Šå¯ä»¥é€šè¿‡å‰ªè´´æ¿ã€ç®¡é“å’Œé‚®æ§½ç­‰æ¥è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ï¼›linuxä¸Šå¯ä»¥é€šè¿‡å‘½åç®¡é“ã€å…±äº«å†…å®¹ã€ä¿¡å·é‡ç­‰æ¥è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ã€‚Androidæ˜¯åŸºäºLinuxå†…æ ¸çš„ç§»åŠ¨æ“ä½œç³»ç»Ÿï¼Œå®ƒçš„è¿›ç¨‹é—´é€šä¿¡æ–¹å¼æ²¡æœ‰å®Œå…¨ç»§æ‰¿è‡ªlinuxï¼Œåœ¨Androidä¸­å¯ä»¥é€šè¿‡Binderè½»æ¾å®ç°è¿›ç¨‹é—´é€šä¿¡ã€‚é™¤äº†Binderï¼ŒAndroidè¿˜æ”¯æŒSocketã€‚</p><h6 id="å¼€å¯å¤šè¿›ç¨‹"><a href="#å¼€å¯å¤šè¿›ç¨‹" class="headerlink" title="å¼€å¯å¤šè¿›ç¨‹"></a>å¼€å¯å¤šè¿›ç¨‹</h6><p>** æŒ‡å®šprocesså±æ€§ **</p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œåœ¨Androidä¸­å¤šè¿›ç¨‹æ˜¯æŒ‡ä¸€ä¸ªåº”ç”¨ä¸­å­˜åœ¨å¤šä¸ªè¿›ç¨‹çš„æƒ…å†µï¼Œå› æ­¤å…ˆå¿½ç•¥å¤šä¸ªåº”ç”¨å¤šè¿›ç¨‹çš„æƒ…å†µã€‚é¦–å…ˆåœ¨Androidä¸­ä½¿ç”¨å¤šè¿›ç¨‹åªæœ‰ä¸€ç§æ–¹å¼ï¼šåœ¨AndroidMenifestæ–‡ä»¶ä¸­æŒ‡å®š<code>android:process</code>å±æ€§ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€ç§éå¸¸è§„çš„æ–¹å¼ï¼Œé€šè¿‡JNIåœ¨nativeå±‚forkä¸€ä¸ªæ–°çš„è¿›ç¨‹ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ— æ³•ç»™ä¸€ä¸ªçº¿ç¨‹æˆ–è€…ä¸€ä¸ªå®ä½“ç±»æŒ‡å®šå…¶è¿è¡Œæ—¶æ‰€åœ¨çš„è¿›ç¨‹ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">activity</span></span><br><span class="hljs-tag"><span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;.ui.ActivityOne&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">android:process</span>=<span class="hljs-string">&quot;:remote&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">activity</span></span><br><span class="hljs-tag"><span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;.ui.ActivityTwo&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">android:process</span>=<span class="hljs-string">&quot;com.huangyuanlove.xuan&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">activity</span></span><br><span class="hljs-tag"><span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;.ui.ActivityThree&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><p>å‡å¦‚å½“å‰åº”ç”¨åŒ…åä¸º<code>com.huangyuanlove.ipc</code>ï¼Œå½“<code>ActivityOne</code>å¯åŠ¨æ—¶ï¼Œç³»ç»Ÿä¼šä¸ºå®ƒåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ï¼Œè¿›ç¨‹åä¸º<code>com.huangyuanlove.ipc:remote</code>ï¼Œå½“<code>ActivityTwo</code>å¯åŠ¨æ—¶ï¼Œç³»ç»Ÿä¹Ÿä¼šä¸ºå®ƒåˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œè¿›ç¨‹åä¸ºï¼š<code>com.huangyuanlove.xuan</code>ï¼Œå½“ç„¶<code>ActivityThree</code>æ˜¯è¿è¡Œåœ¨é»˜è®¤è¿›ç¨‹ä¸­ï¼Œé»˜è®¤è¿›ç¨‹æ˜¯åŒ…åã€‚</p><p>** :name å’Œ å…¨é™å®šåçš„åŒºåˆ« **</p><ul><li>â€œ:â€çš„å«ä¹‰æ˜¯åœ¨å½“å‰è¿›ç¨‹åçš„å‰é¢é™„åŠ ä¸ŠåŒ…å(ActivityOne)ï¼Œå…¨é™å®šåå¹¶ä¸ä¼šé™„åŠ åŒ…åã€‚</li><li>ä»¥â€:â€å¼€å¤´çš„è¿›ç¨‹å±äºå½“å‰åº”ç”¨çš„ç§æœ‰è¿›ç¨‹ï¼Œå…¶ä»–åº”ç”¨çš„ç»„ä»¶ä¸å¯ä»¥å’Œå®ƒè·‘åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œå…¶ä»–ä¸ä»¥â€:â€å¼€å¤´çš„è¿›ç¨‹å±äºå…¨å±€è¿›ç¨‹ï¼Œå…¶ä»–åº”ç”¨é€šè¿‡ShareUIDæ–¹å¼å¯ä»¥å’Œå®ƒè·‘åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ã€‚</li></ul><p>â€‹     Androidä¼šä¸ºæ¯ä¸€ä¸ªåº”ç”¨åˆ†é…ä¸€ä¸ªUIDï¼Œå…·æœ‰ç›¸åŒUIDçš„åº”ç”¨æ‰èƒ½å…±äº«æ•°æ®ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸¤ä¸ªåº”ç”¨é€šè¿‡ShareUIDè·‘åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­æ˜¯æœ‰è¦æ±‚çš„ï¼Œéœ€è¦è¿™ä¸¤ä¸ªåº”ç”¨æœ‰ç›¸åŒçš„ShareUIDå¹¶ä¸”ç­¾åç›¸åŒæ‰å¯ä»¥ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä»–ä»¬å¯ä»¥äº’ç›¸è®¿é—®å¯¹æ–¹çš„ç§æœ‰æ•°æ®ï¼Œè¿˜å¯ä»¥å…±äº«å†…å­˜æ•°æ®ï¼Œæˆ–è€…è¯´å®ƒä»¬çœ‹èµ·æ¥å°±åƒæ˜¯ä¸€ä¸ªåº”ç”¨çš„ä¸¤ä¸ªéƒ¨åˆ†ã€‚</p><h6 id="å¸¦æ¥çš„é—®é¢˜"><a href="#å¸¦æ¥çš„é—®é¢˜" class="headerlink" title="å¸¦æ¥çš„é—®é¢˜"></a>å¸¦æ¥çš„é—®é¢˜</h6><ul><li>é™æ€æˆå‘˜å’Œå•ä¾‹æ¨¡å¼å‡‰å‡‰</li><li>çº¿ç¨‹åŒæ­¥é”æœºåˆ¶å‡‰å‡‰</li><li>SharedPreferenceså¯é æ€§å‡‰å‡‰</li><li>Applicationä¼šåˆ›å»ºå¤šæ¬¡</li></ul><p>å› ä¸ºå¼€å¯å¤šè¿›ç¨‹ä¹‹åï¼Œå°±ä¸å†æ˜¯åŒä¸€ä¸ªå†…å­˜åŒºåŸŸï¼Œæ‰€ä»¥å¸¦æ¥ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œç¬¬äºŒä¸ªé—®é¢˜ä¹Ÿæ˜¯åŒæ ·ï¼Œä¸åœ¨åŒä¸€ä¸ªå†…å­˜åŒºåŸŸï¼Œæ— è®ºæ˜¯å¯¹è±¡é”è¿˜æ˜¯å…¨å±€é”å¯é æ€§åŸºæœ¬å°±å‡‰äº†ã€‚ç¬¬ä¸‰ä¸ªé—®é¢˜å’Œå¤šè¿›ç¨‹å†™spä¸€æ ·ï¼Œç¬¬å››ä¸ªé—®é¢˜ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œç³»ç»Ÿåœ¨åˆ›å»ºæ–°è¿›ç¨‹çš„æ—¶å€™ä¼šåŒæ—¶åˆ†é…ç‹¬ç«‹çš„è™šæ‹Ÿæœºï¼Œæ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯å¯åŠ¨ä¸€ä¸ªåº”ç”¨çš„è¿‡ç¨‹ã€‚</p><h6 id="Parcelable-å’Œ-Serializable"><a href="#Parcelable-å’Œ-Serializable" class="headerlink" title="Parcelable å’Œ Serializable"></a>Parcelable å’Œ Serializable</h6><p>è¿™ä¸ªè‡ªå·±ç©</p><h6 id="Binder"><a href="#Binder" class="headerlink" title="Binder"></a>Binder</h6><p>ç›´è§‚çš„è®²ï¼ŒBinderæ˜¯Androidä¸­çš„ä¸€ä¸ªç±»ï¼Œå®ƒç»§æ‰¿äº†IBinderæ¥å£ã€‚ä»IPCè§’åº¦æ¥è¯´ï¼ŒBinderæ˜¯Androidä¸­çš„ä¸€ç§è·¨è¿›ç¨‹é€šä¿¡æ–¹å¼ï¼Œä»Android Frameworkè§’åº¦æ¥è¯´ï¼ŒBinderæ˜¯ServiceManagerè¿æ¥å„ç§Manager(ActivityManagerã€WindowManagerï¼Œç­‰ç­‰)å’Œç›¸åº”ManagerServiceçš„æ¡¥æ¢ï¼›ä»Androidåº”ç”¨å±‚æ¥è¯´ï¼ŒBinderæ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¿›è¡Œé€šä¿¡çš„åª’ä»‹ã€‚</p><p>** åˆ›å»ºAIDLç¤ºä¾‹ **<br>åˆ›å»ºä¸€ä¸ªBookç±»ï¼Œå®ç°Parcelableæ¥å£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Book</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Parcelable</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> bookId;<br>    <span class="hljs-keyword">private</span> String bookName;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Book</span><span class="hljs-params">(<span class="hljs-type">int</span> bookId, String bookName)</span> &#123;<br>        <span class="hljs-built_in">this</span>.bookId = bookId;<br>        <span class="hljs-built_in">this</span>.bookName = bookName;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">describeContents</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeToParcel</span><span class="hljs-params">(Parcel dest, <span class="hljs-type">int</span> flags)</span> &#123;<br>        dest.writeInt(<span class="hljs-built_in">this</span>.bookId);<br>        dest.writeString(<span class="hljs-built_in">this</span>.bookName);<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-title function_">Book</span><span class="hljs-params">(Parcel in)</span> &#123;<br>        <span class="hljs-built_in">this</span>.bookId = in.readInt();<br>        <span class="hljs-built_in">this</span>.bookName = in.readString();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Creator&lt;Book&gt; CREATOR = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Creator</span>&lt;Book&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> Book <span class="hljs-title function_">createFromParcel</span><span class="hljs-params">(Parcel source)</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(source);<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> Book[] newArray(<span class="hljs-type">int</span> size) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>[size];<br>        &#125;<br>    &#125;;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>åˆ›å»º<code>IBookManager.aidl</code>æ–‡ä»¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨AndroidStudioä¸­ï¼Œå³é”®åˆ›å»ºaidlæ–‡ä»¶æ—¶å€™ï¼ŒIDEä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå’Œjavaå¹³çº§çš„aidlæ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬åˆ›å»ºçš„aidlæ–‡ä»¶å°±åœ¨è¿™é‡Œé¢ã€‚<br><img src="/image/Android/IPC/create_aidl.png" alt="create_aidl_file"><br>** Book.aidl **</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.huangyuan.testandroid;<br>parcelable Book;<br></code></pre></td></tr></table></figure><p><code>Book.aidl</code>æ˜¯<code>Book.java</code>ç±»åœ¨AIDLä¸­çš„å£°æ˜ã€‚</p><p>** IBookManager.aidl **</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// IBookManager.aidl</span><br><span class="hljs-keyword">package</span> com.example.huangyuan.testandroid;<br><span class="hljs-keyword">import</span> com.example.huangyuan.testandroid.Book;<br><span class="hljs-comment">// Declare any non-default types here with import statements</span><br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">IBookManager</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Demonstrates some basic types that you can use as parameters</span><br><span class="hljs-comment">     * and return values in AIDL.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">basicTypes</span><span class="hljs-params">(<span class="hljs-type">int</span> anInt, <span class="hljs-type">long</span> aLong, <span class="hljs-type">boolean</span> aBoolean, <span class="hljs-type">float</span> aFloat,</span><br><span class="hljs-params">            <span class="hljs-type">double</span> aDouble, String aString)</span>;<br><br>     List&lt;Book&gt; <span class="hljs-title function_">getBookList</span><span class="hljs-params">()</span>;<br>     <span class="hljs-keyword">void</span> <span class="hljs-title function_">addBook</span><span class="hljs-params">(in Book book)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ <code>basicTypes</code>æ˜¯IDEè‡ªåŠ¨ç”Ÿæˆçš„ï¼Œæˆ‘ä»¬è‡ªå·±æ·»åŠ  <code>getBookList()</code> å’Œ <code>addBook</code> ä¸¤ä¸ªæ–¹æ³•<br>å°½ç®¡Bookç±»å’ŒIBookManagerçš„åŒ…åç›¸åŒï¼Œä½†æ˜¯åœ¨IBookManagerä¸­ä»è¦å¯¼å…¥Bookç±»ã€‚ä¸‹é¢çœ‹ä¸€ä¸‹IDEç”Ÿæˆçš„<code>IBookManager.java</code>ç±»ï¼Œè¯¥ç±»åœ¨<code>app/build/generated/source/aidl/debug/packageName</code>åŒ…ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * This file is auto-generated.  DO NOT MODIFY.</span><br><span class="hljs-comment"> * Original file: /Users/huangyuan/AndroidStudioProjects/TestAndroid/app/src/main/aidl/com/example/huangyuan/testandroid/IBookManager.aidl</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">package</span> com.example.huangyuan.testandroid;<br><span class="hljs-comment">// Declare any non-default types here with import statements</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IBookManager</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">android</span>.os.IInterface &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Local-side IPC implementation stub class.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Stub</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">android</span>.os.Binder <span class="hljs-keyword">implements</span> <span class="hljs-title class_">com</span>.example.huangyuan.testandroid.IBookManager &#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> java.lang.<span class="hljs-type">String</span> <span class="hljs-variable">DESCRIPTOR</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;com.example.huangyuan.testandroid.IBookManager&quot;</span>;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * Construct the stub at attach it to the interface.</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">Stub</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-built_in">this</span>.attachInterface(<span class="hljs-built_in">this</span>, DESCRIPTOR);<br>        &#125;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * Cast an IBinder object into an com.example.huangyuan.testandroid.IBookManager interface,</span><br><span class="hljs-comment">         * generating a proxy if needed.</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> com.example.huangyuan.testandroid.IBookManager <span class="hljs-title function_">asInterface</span><span class="hljs-params">(android.os.IBinder obj)</span> &#123;<br>            <span class="hljs-keyword">if</span> ((obj == <span class="hljs-literal">null</span>)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>            &#125;<br>            android.os.<span class="hljs-type">IInterface</span> <span class="hljs-variable">iin</span> <span class="hljs-operator">=</span> obj.queryLocalInterface(DESCRIPTOR);<br>            <span class="hljs-keyword">if</span> (((iin != <span class="hljs-literal">null</span>) &amp;&amp; (iin <span class="hljs-keyword">instanceof</span> com.example.huangyuan.testandroid.IBookManager))) &#123;<br>                <span class="hljs-keyword">return</span> ((com.example.huangyuan.testandroid.IBookManager) iin);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">com</span>.example.huangyuan.testandroid.IBookManager.Stub.Proxy(obj);<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> android.os.IBinder <span class="hljs-title function_">asBinder</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onTransact</span><span class="hljs-params">(<span class="hljs-type">int</span> code, android.os.Parcel data, android.os.Parcel reply, <span class="hljs-type">int</span> flags)</span> <span class="hljs-keyword">throws</span> android.os.RemoteException &#123;<br>            <span class="hljs-keyword">switch</span> (code) &#123;<br>                <span class="hljs-keyword">case</span> INTERFACE_TRANSACTION: &#123;<br>                    reply.writeString(DESCRIPTOR);<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>                &#125;<br>                <span class="hljs-keyword">case</span> TRANSACTION_basicTypes: &#123;<br>                    data.enforceInterface(DESCRIPTOR);<br>                    <span class="hljs-type">int</span> _arg0;<br>                    _arg0 = data.readInt();<br>                    <span class="hljs-type">long</span> _arg1;<br>                    _arg1 = data.readLong();<br>                    <span class="hljs-type">boolean</span> _arg2;<br>                    _arg2 = (<span class="hljs-number">0</span> != data.readInt());<br>                    <span class="hljs-type">float</span> _arg3;<br>                    _arg3 = data.readFloat();<br>                    <span class="hljs-type">double</span> _arg4;<br>                    _arg4 = data.readDouble();<br>                    java.lang.String _arg5;<br>                    _arg5 = data.readString();<br>                    <span class="hljs-built_in">this</span>.basicTypes(_arg0, _arg1, _arg2, _arg3, _arg4, _arg5);<br>                    reply.writeNoException();<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>                &#125;<br>                <span class="hljs-keyword">case</span> TRANSACTION_getBookList: &#123;<br>                    data.enforceInterface(DESCRIPTOR);<br>                    java.util.List&lt;com.example.huangyuan.testandroid.Book&gt; _result = <span class="hljs-built_in">this</span>.getBookList();<br>                    reply.writeNoException();<br>                    reply.writeTypedList(_result);<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>                &#125;<br>                <span class="hljs-keyword">case</span> TRANSACTION_addBook: &#123;<br>                    data.enforceInterface(DESCRIPTOR);<br>                    com.example.huangyuan.testandroid.Book _arg0;<br>                    <span class="hljs-keyword">if</span> ((<span class="hljs-number">0</span> != data.readInt())) &#123;<br>                        _arg0 = com.example.huangyuan.testandroid.Book.CREATOR.createFromParcel(data);<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        _arg0 = <span class="hljs-literal">null</span>;<br>                    &#125;<br>                    <span class="hljs-built_in">this</span>.addBook(_arg0);<br>                    reply.writeNoException();<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.onTransact(code, data, reply, flags);<br>        &#125;<br><br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Proxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">com</span>.example.huangyuan.testandroid.IBookManager &#123;<br>            <span class="hljs-keyword">private</span> android.os.IBinder mRemote;<br><br>            Proxy(android.os.IBinder remote) &#123;<br>                mRemote = remote;<br>            &#125;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> android.os.IBinder <span class="hljs-title function_">asBinder</span><span class="hljs-params">()</span> &#123;<br>                <span class="hljs-keyword">return</span> mRemote;<br>            &#125;<br><br>            <span class="hljs-keyword">public</span> java.lang.String <span class="hljs-title function_">getInterfaceDescriptor</span><span class="hljs-params">()</span> &#123;<br>                <span class="hljs-keyword">return</span> DESCRIPTOR;<br>            &#125;<br><br>            <span class="hljs-comment">/**</span><br><span class="hljs-comment">             * Demonstrates some basic types that you can use as parameters</span><br><span class="hljs-comment">             * and return values in AIDL.</span><br><span class="hljs-comment">             */</span><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">basicTypes</span><span class="hljs-params">(<span class="hljs-type">int</span> anInt, <span class="hljs-type">long</span> aLong, <span class="hljs-type">boolean</span> aBoolean, <span class="hljs-type">float</span> aFloat, <span class="hljs-type">double</span> aDouble, java.lang.String aString)</span> <span class="hljs-keyword">throws</span> android.os.RemoteException &#123;<br>                android.os.<span class="hljs-type">Parcel</span> <span class="hljs-variable">_data</span> <span class="hljs-operator">=</span> android.os.Parcel.obtain();<br>                android.os.<span class="hljs-type">Parcel</span> <span class="hljs-variable">_reply</span> <span class="hljs-operator">=</span> android.os.Parcel.obtain();<br>                <span class="hljs-keyword">try</span> &#123;<br>                    _data.writeInterfaceToken(DESCRIPTOR);<br>                    _data.writeInt(anInt);<br>                    _data.writeLong(aLong);<br>                    _data.writeInt(((aBoolean) ? (<span class="hljs-number">1</span>) : (<span class="hljs-number">0</span>)));<br>                    _data.writeFloat(aFloat);<br>                    _data.writeDouble(aDouble);<br>                    _data.writeString(aString);<br>                    mRemote.transact(Stub.TRANSACTION_basicTypes, _data, _reply, <span class="hljs-number">0</span>);<br>                    _reply.readException();<br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                    _reply.recycle();<br>                    _data.recycle();<br>                &#125;<br>            &#125;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> java.util.List&lt;com.example.huangyuan.testandroid.Book&gt; getBookList() <span class="hljs-keyword">throws</span> android.os.RemoteException &#123;<br>                android.os.<span class="hljs-type">Parcel</span> <span class="hljs-variable">_data</span> <span class="hljs-operator">=</span> android.os.Parcel.obtain();<br>                android.os.<span class="hljs-type">Parcel</span> <span class="hljs-variable">_reply</span> <span class="hljs-operator">=</span> android.os.Parcel.obtain();<br>                java.util.List&lt;com.example.huangyuan.testandroid.Book&gt; _result;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    _data.writeInterfaceToken(DESCRIPTOR);<br>                    mRemote.transact(Stub.TRANSACTION_getBookList, _data, _reply, <span class="hljs-number">0</span>);<br>                    _reply.readException();<br>                    _result = _reply.createTypedArrayList(com.example.huangyuan.testandroid.Book.CREATOR);<br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                    _reply.recycle();<br>                    _data.recycle();<br>                &#125;<br>                <span class="hljs-keyword">return</span> _result;<br>            &#125;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addBook</span><span class="hljs-params">(com.example.huangyuan.testandroid.Book book)</span> <span class="hljs-keyword">throws</span> android.os.RemoteException &#123;<br>                android.os.<span class="hljs-type">Parcel</span> <span class="hljs-variable">_data</span> <span class="hljs-operator">=</span> android.os.Parcel.obtain();<br>                android.os.<span class="hljs-type">Parcel</span> <span class="hljs-variable">_reply</span> <span class="hljs-operator">=</span> android.os.Parcel.obtain();<br>                <span class="hljs-keyword">try</span> &#123;<br>                    _data.writeInterfaceToken(DESCRIPTOR);<br>                    <span class="hljs-keyword">if</span> ((book != <span class="hljs-literal">null</span>)) &#123;<br>                        _data.writeInt(<span class="hljs-number">1</span>);<br>                        book.writeToParcel(_data, <span class="hljs-number">0</span>);<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        _data.writeInt(<span class="hljs-number">0</span>);<br>                    &#125;<br>                    mRemote.transact(Stub.TRANSACTION_addBook, _data, _reply, <span class="hljs-number">0</span>);<br>                    _reply.readException();<br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                    _reply.recycle();<br>                    _data.recycle();<br>                &#125;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TRANSACTION_basicTypes</span> <span class="hljs-operator">=</span> (android.os.IBinder.FIRST_CALL_TRANSACTION + <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TRANSACTION_getBookList</span> <span class="hljs-operator">=</span> (android.os.IBinder.FIRST_CALL_TRANSACTION + <span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TRANSACTION_addBook</span> <span class="hljs-operator">=</span> (android.os.IBinder.FIRST_CALL_TRANSACTION + <span class="hljs-number">2</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Demonstrates some basic types that you can use as parameters</span><br><span class="hljs-comment">     * and return values in AIDL.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">basicTypes</span><span class="hljs-params">(<span class="hljs-type">int</span> anInt, <span class="hljs-type">long</span> aLong, <span class="hljs-type">boolean</span> aBoolean, <span class="hljs-type">float</span> aFloat, <span class="hljs-type">double</span> aDouble, java.lang.String aString)</span> <span class="hljs-keyword">throws</span> android.os.RemoteException;<br><br>    <span class="hljs-keyword">public</span> java.util.List&lt;com.example.huangyuan.testandroid.Book&gt; getBookList() <span class="hljs-keyword">throws</span> android.os.RemoteException;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addBook</span><span class="hljs-params">(com.example.huangyuan.testandroid.Book book)</span> <span class="hljs-keyword">throws</span> android.os.RemoteException;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ç»“æ„æ¯”è¾ƒç®€å•ï¼Œæœ€å¤–é¢æ˜¯IBookManageræ¥å£ï¼Œ<br>å…¶ä¸­å£°æ˜äº†ä¸€ä¸ªæŠ½è±¡å†…éƒ¨ç±»Stubï¼Œåœ¨è¯¥ç±»ä¸­ï¼Œå£°æ˜äº†ä¸€ä¸ªProxyä»£ç†ç±»ã€‚è¿˜å£°æ˜äº†ä¸‰ä¸ªé™æ€å˜é‡æ¥æ ‡å¿—aidlæ–‡ä»¶ä¸­çš„ä¸‰ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªStubå°±æ˜¯ä¸€ä¸ªBinderç±»ï¼Œå½“å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½ä½äºåŒä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œæ–¹æ³•è°ƒç”¨ä¸ä¼šèµ°è·¨è¿›ç¨‹çš„transactè¿‡ç¨‹ï¼Œè€Œå½“ä¸¤è€…ä½äºä¸åŒè¿›ç¨‹æ—¶ï¼Œæ–¹æ³•è°ƒç”¨éœ€è¦èµ°transactè¿‡ç¨‹ï¼Œè¿™ä¸ªé€»è¾‘ç”±å†…éƒ¨Proxyç±»æ¥å®Œæˆã€‚<br>æœ€åï¼Œå£°æ˜äº†aidlæ–‡ä»¶ä¸­çš„ä¸‰ä¸ªæ–¹æ³•ã€‚<br>ä¸‹é¢è¯¦ç»†ä»‹ç»ï¼š<br>** DESCRIPTOR **<br>Binderçš„å”¯ä¸€æ ‡ç¤ºï¼Œä¸€èˆ¬ç”¨å½“å‰Binderçš„ç±»åæ ‡ç¤º</p><p>** asInterface(android.os.IBinder obj) **<br>ç”¨äºå°†æœåŠ¡ç«¯çš„BInderå¯¹è±¡è½¬æ¢æˆå®¢æˆ·ç«¯æ‰€éœ€çš„AIDLå€Ÿå£ç±»å‹çš„å¯¹è±¡ï¼Œè¿™ç§è½¬æ¢è¿‡ç¨‹æ˜¯åŒºåˆ†è¿›ç¨‹çš„ï¼Œå¦‚æœå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä½äºåŒä¸€è¿›ç¨‹ï¼Œé‚£ä¹ˆæ­¤æ–¹æ³•è¿”å›çš„å°±æ˜¯æœåŠ¡ç«¯çš„Stubå¯¹è±¡æœ¬èº«ï¼Œå¦åˆ™è¿”å›çš„æ˜¯ç³»ç»Ÿå°è£…åçš„Stub.proxyå¯¹è±¡ã€‚</p><p>** asBinder **<br>ç”¨äºè¿”å›å½“å‰Binderå¯¹è±¡</p><p>** onTransact **<br>è¿™ä¸ªæ–¹æ³•è¿è¡Œåœ¨æœåŠ¡ç«¯ä¸­çš„Binderçº¿ç¨‹æ± ä¸­ï¼Œå½“å®¢æˆ·ç«¯å‘èµ·è·¨è¿›ç¨‹è¯·æ±‚æ—¶ï¼Œè¿œç¨‹è¯·æ±‚ä¼šé€šè¿‡ç³»ç»Ÿåº•å±‚å°è£…åäº¤ç”±æ­¤æ–¹æ³•æ¥å¤„ç†ã€‚è¯¥æ–¹æ³•çš„åŸå‹ä¸ºpublic Boolean onTransact(int code,android.os. Parcel data,android.os.Parcel reply,int flags)ã€‚æœåŠ¡ç«¯é€šè¿‡codeå¯ä»¥ç¡®å®šå®¢æˆ·ç«¯æ‰€è¯·æ±‚çš„ç›®æ ‡æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Œæ¥ç€ä»dataä¸­å–å‡ºç›®æ ‡æ–¹æ³•æ‰€éœ€çš„å‚æ•°(å¦‚æœç›®æ ‡æ–¹æ³•æœ‰å‚æ•°çš„è¯)ï¼Œç„¶åæ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚å½“ç›®æ ‡æ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œå°±å‘replyä¸­å†™å…¥è¿”å›å€¼(å¦‚æœç›®æ ‡æ–¹æ³•æœ‰è¿”å›å€¼çš„è¯)ï¼ŒonTransactæ–¹ æ³•çš„æ‰§è¡Œè¿‡ç¨‹å°±æ˜¯è¿™æ ·çš„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ­¤æ–¹æ³•è¿”å›false,é‚£ä¹ˆå®¢æˆ·ç«¯çš„è¯·æ±‚ä¼šå¤±è´¥ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ¥åšæƒé™éªŒè¯ï¼Œæ¯•ç«Ÿæˆ‘ä»¬ä¹Ÿä¸å¸Œæœ›éšä¾¿-ä¸€ä¸ªè¿›ç¨‹éƒ½èƒ½è¿œç¨‹è°ƒç”¨æˆ‘ä»¬çš„æœåŠ¡ã€‚</p><p>** Proxy#getBookList **<br>è¿™ä¸ªæ–¹æ³•è¿è¡Œåœ¨å®¢æˆ·ç«¯ï¼Œå½“å®¢æˆ·ç«¯è¿œç¨‹è°ƒç”¨æ­¤æ–¹æ³•æ—¶ï¼Œå®ƒçš„å†…éƒ¨å®ç°æ˜¯è¿™æ ·çš„:é¦–å…ˆåˆ›å»ºè¯¥æ–¹æ³•æ‰€éœ€è¦çš„è¾“å…¥å‹Parcelå¯¹è±¡_dataã€ è¾“å‡ºå‹Parcelå¯¹è±¡_ replyå’Œè¿”å›å€¼å¯¹è±¡List;ç„¶åæŠŠè¯¥æ–¹æ³•çš„å‚æ•°ä¿¡æ¯å†™å…¥_dataä¸­(å¦‚æœæœ‰å‚æ•°çš„è¯);æ¥ç€è°ƒç”¨transactæ–¹æ³•æ¥å‘èµ·RPC (è¿œç¨‹è¿‡ç¨‹è°ƒç”¨)è¯·æ±‚ï¼ŒåŒæ—¶å½“å‰çº¿ç¨‹æŒ‚èµ·;ç„¶åæœåŠ¡ç«¯çš„onTransactæ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œç›´åˆ°RPCè¿‡ç¨‹è¿”å›åï¼Œå½“å‰çº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œå¹¶ä»_replyä¸­ å–å‡ºRPCè¿‡ç¨‹çš„è¿”å›ç»“æœ;æœ€åè¿”å›_replyä¸­çš„æ•°æ®ã€‚</p><p>** Proxy#addBook **<br>è¿™ä¸ªæ–¹æ³•è¿è¡Œåœ¨å®¢æˆ·ç«¯ï¼Œå®ƒçš„æ‰§è¡Œè¿‡ç¨‹å’ŒgetBookListæ˜¯ä¸€æ ·çš„ï¼ŒaddBookæ²¡æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥å®ƒä¸éœ€è¦ä»_replayä¸­å–å‡ºè¿”å›å€¼ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»‹ç»Binderçš„ä¸¤ä¸ªå¾ˆé‡è¦çš„æ–¹æ³•linkToDeathå’ŒunlinkToDeathã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒBinderè¿è¡Œåœ¨æœåŠ¡ç«¯è¿›ç¨‹ï¼Œå¦‚æœæœåŠ¡ç«¯è¿›ç¨‹ç”±äºæŸç§åŸå› å¼‚å¸¸ç»ˆæ­¢ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬åˆ°æœåŠ¡ç«¯çš„Binderè¿æ¥æ–­è£‚(ç§°ä¹‹ä¸ºBinderæ­»äº¡)ï¼Œä¼šå¯¼è‡´æˆ‘ä»¬çš„è¿œç¨‹è°ƒç”¨å¤±è´¥ã€‚æ›´ä¸ºå…³é”®çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä¸çŸ¥é“Binderè¿æ¥å·²ç»æ–­è£‚ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯çš„åŠŸèƒ½å°±ä¼šå—åˆ°å½±å“ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒBinderä¸­æä¾› äº†ä¸¤ä¸ªé…å¯¹çš„æ–¹æ³•linkToDeathå’ŒunlinkToDeath,é€šè¿‡linkToDeathæˆ‘ä»¬å¯ä»¥ç»™Binderè®¾ç½®- - ä¸ªæ­»äº¡ä»£ç†ï¼Œå½“Binderæ­»äº¡æ—¶ï¼Œ æˆ‘ä»¬å°±ä¼šæ”¶åˆ°é€šçŸ¥ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥é‡æ–°å‘èµ·è¿æ¥è¯·æ±‚ä»è€Œæ¢å¤è¿æ¥ã€‚é‚£ä¹ˆåˆ°åº•å¦‚ä½•ç»™Binderè®¾ç½®æ­»äº¡ä»£ç†å‘¢?ä¹Ÿå¾ˆç®€å•ã€‚<br>é¦–å…ˆï¼Œå£°æ˜ä¸€ä¸ªDeathRecipientå¯¹è±¡ã€‚DeathRecipientæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…¶å†…éƒ¨åªæœ‰ä¸€ä¸ªæ–¹æ³•binderDied,æˆ‘ä»¬éœ€è¦å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œå½“Binderæ­»äº¡çš„æ—¶ å€™ï¼Œç³»ç»Ÿå°±ä¼šå›è°ƒbinderDiedæ–¹æ³•ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥ç§»å‡ºä¹‹å‰ç»‘å®šçš„binderä»£ç†å¹¶é‡æ–°ç»‘å®šè¿œç¨‹æœåŠ¡:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> IBinder .<span class="hljs-type">DeathRecipient</span> <span class="hljs-variable">mDeathRecipient</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IBinder</span>.DeathRecipient() &#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">binderDied</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">if</span> ( mBookManager ==<span class="hljs-literal">null</span>)<br><span class="hljs-keyword">return</span>;<br><br>mBookManager.asBinder().unlinkToDeath(mDeathRecipient <span class="hljs-number">0</span>);<br>mBookManager = <span class="hljs-literal">null</span>;<br>&#125;<br>);<br></code></pre></td></tr></table></figure><p>å…¶æ¬¡ï¼Œåœ¨å®¢æˆ·ç«¯ç»‘å®šè¿œç¨‹æœåŠ¡æˆåŠŸåï¼Œç»™binderè®¾ç½®æ­»äº¡ä»£ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">mService = IMessageBoxManager.Stub.asInterface(binder);<br>binder.linkToDeath(mDeathRecipient,<span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><p>å…¶ä¸­linkToDeathçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸ªæ ‡è®°ä½ï¼Œæˆ‘ä»¬ç›´æ¥è®¾ä¸º0å³å¯ã€‚ç»è¿‡ä¸Šé¢ä¸¤ä¸ªæ­¥éª¤ï¼Œå°±ç»™æˆ‘ä»¬çš„Binderè®¾ç½®äº†æ­»äº¡ä»£ç†ï¼Œå½“Binderæ­» äº¡çš„æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥æ”¶åˆ°é€šçŸ¥äº†ã€‚å¦å¤–ï¼Œé€šè¿‡Binderçš„ æ–¹æ³•isBinderAliveä¹Ÿå¯ä»¥åˆ¤æ–­Binderæ˜¯å¦æ­»äº¡ã€‚</p><h2 id="è¿™ä¸€ç¯‡å…¨éƒ¨éƒ½æ˜¯æŠ„çš„ã€ŠAndroidå¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹ç¬¬2-3-3Binder-ç« èŠ‚ä¸Šçš„å†…å®¹ï¼Œæ¯•ç«Ÿä¸€ç›´å¸¦ç€ä¹¦ä¹Ÿä¸ç°å®"><a href="#è¿™ä¸€ç¯‡å…¨éƒ¨éƒ½æ˜¯æŠ„çš„ã€ŠAndroidå¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹ç¬¬2-3-3Binder-ç« èŠ‚ä¸Šçš„å†…å®¹ï¼Œæ¯•ç«Ÿä¸€ç›´å¸¦ç€ä¹¦ä¹Ÿä¸ç°å®" class="headerlink" title="** è¿™ä¸€ç¯‡å…¨éƒ¨éƒ½æ˜¯æŠ„çš„ã€ŠAndroidå¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹ç¬¬2.3.3Binder ç« èŠ‚ä¸Šçš„å†…å®¹ï¼Œæ¯•ç«Ÿä¸€ç›´å¸¦ç€ä¹¦ä¹Ÿä¸ç°å® **"></a>** è¿™ä¸€ç¯‡å…¨éƒ¨éƒ½æ˜¯æŠ„çš„ã€ŠAndroidå¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹ç¬¬2.3.3Binder ç« èŠ‚ä¸Šçš„å†…å®¹ï¼Œæ¯•ç«Ÿä¸€ç›´å¸¦ç€ä¹¦ä¹Ÿä¸ç°å® **</h2><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android7.0 MultiWindow</title>
    <link href="/2018/06/11/Android7-0%E5%88%86%E5%B1%8F%E5%AE%9E%E7%8E%B0/"/>
    <url>/2018/06/11/Android7-0%E5%88%86%E5%B1%8F%E5%AE%9E%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<p>Android7.0æ¨å‡ºäº†å¤šçª—å£(åˆ†å±)æ¨¡å¼ï¼Œå…è®¸ä¸€ä¸ªå±å¹•ä¸‹æ˜¾ç¤ºä¸¤ä¸ªåº”ç”¨ï¼Œå¯ä»¥ä¸€è¾¹è¿½å‰§ä¸€è¾¹çœ‹ç”µå­ä¹¦ï¼Œä¸è¿‡åœ¨å°ä¸€ç‚¹çš„æ‰‹æœºå±å¹•ä¸Šçœ‹èµ·æ¥å¯èƒ½æœ‰ç‚¹é¸¡è‚‹ã€‚ä½†æ˜¯åœ¨TVç«¯(è¿™ä¸ªå±å¹•å°±æ¯”è¾ƒå¤§äº†ï¼Œä¸€èˆ¬éƒ½æ˜¯40å¯¸èµ·æ­¥)ä¸­ï¼Œç”»ä¸­ç”»æ¨¡å¼å¯ä»¥è®©æˆ‘ä»¬åŒæ—¶è¿›è¡Œå¤šä¸ªä»»åŠ¡äº†ã€‚</p><span id="more"></span><h4 id="å¼€å¯åˆ†å±"><a href="#å¼€å¯åˆ†å±" class="headerlink" title="å¼€å¯åˆ†å±"></a>å¼€å¯åˆ†å±</h4><p>åªè¦ä½ ç¼–è¯‘ä½¿ç”¨sdkç‰ˆæœ¬å¤§äºç­‰äº7.0å°±å¯ä»¥æ”¯æŒåˆ†å±äº†ï¼š<code>compileSdkVersion 25</code>ï¼Œå¦‚æœæƒ³è¦ç¦ç”¨åˆ†å±ï¼Œåªéœ€è¦åœ¨<code>AndroidManifest.xml</code>æ·»åŠ å±æ€§ï¼šandroid:resizeableActivity&#x3D;â€falseâ€ï¼Œè¿™ä¸ªå±æ€§ä½¿ç”¨äºapplicationå’ŒActivityæ ‡ç­¾ã€‚<br>7.0ä¸­é»˜è®¤æ˜¯trueã€‚<br>é™¤äº†åˆ†å±æ¨¡å¼ä¹‹å¤–ï¼Œè¿˜æœ‰è‡ªç”±æ¨¡å¼(Freeform,å¸¸è§äºæ¡Œé¢è®¾å¤‡ï¼Œç±»ä¼¼äºwindowsçš„åº”ç”¨çª—å£ï¼Œå¯ä»¥æ‹–æ‹½è¾¹ç¼˜æ”¹å˜å¤§å°)ã€‚</p><h4 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h4><p>å¼€å¯å¤šçª—å£æ¨¡å¼ä¸ä¼šæ›´æ”¹Activityçš„ç”Ÿå‘½å‘¨æœŸï¼Œ<br>åœ¨å¤šçª—å£æ¨¡å¼ä¸­ï¼Œåœ¨æŒ‡å®šæ—¶é—´åªæœ‰æœ€è¿‘ä¸ç”¨æˆ·äº¤äº’è¿‡çš„ Activity ä¸ºæ´»åŠ¨çŠ¶æ€ã€‚ è¯¥ Activity å°†è¢«è§†ä¸ºé¡¶çº§ Activityã€‚ æ‰€æœ‰å…¶ä»– Activity è™½ç„¶å¯è§ï¼Œä½†å‡å¤„äºæš‚åœçŠ¶æ€ã€‚ ä½†æ˜¯ï¼Œè¿™äº›å·²æš‚åœä½†å¯è§çš„ Activity åœ¨ç³»ç»Ÿä¸­äº«æœ‰æ¯”ä¸å¯è§ Activity æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚ å¦‚æœç”¨æˆ·ä¸å…¶ä¸­ä¸€ä¸ªæš‚åœçš„ Activity äº¤äº’ï¼Œè¯¥ Activity å°†æ¢å¤ï¼Œè€Œä¹‹å‰çš„é¡¶çº§ Activity å°†æš‚åœã€‚</p><p>ä¾‹å¦‚ï¼š<br><img src="/image/Android/MultiWindow/1.png" alt="MultiWindow"><br>åœ¨ä¸Šå›¾ä¸­ï¼Œæˆ‘å…ˆæ‰“å¼€äº†ä¸Šé¢çš„Activityï¼Œç„¶ååˆæ‰“å¼€äº†ä¸‹é¢Gmailçš„Activityï¼Œè¿™æ—¶ä¸‹é¢çš„Activityå¤„äºå¯äº¤äº’(é¡¶çº§Activity)çŠ¶æ€ï¼Œä¸Šé¢çš„Activityè™½ç„¶è¯¾ä»¶ï¼Œä½†æ˜¯å¤„äºæš‚åœçŠ¶æ€ï¼Œè¿™æ—¶æŒ‰ä¸‹backé”®æ˜¯å¯¹ä¸‹é¢Activityè¿›è¡Œæ“ä½œã€‚å½“ç‚¹å‡»ä¸Šé¢çš„Activityæ—¶ï¼Œä¸Šé¢çš„Activityå¤„äºå¯äº¤äº’çŠ¶æ€ï¼Œä¸‹é¢çš„Activityå¤„äºæš‚åœçŠ¶æ€ã€‚<br>PSï¼šåœ¨å¤šçª—å£æ¨¡å¼ä¸­ï¼Œç”¨æˆ·ä»å¯ä»¥çœ‹åˆ°å¤„äºæš‚åœçŠ¶æ€çš„åº”ç”¨ã€‚ åº”ç”¨åœ¨æš‚åœçŠ¶æ€ä¸‹å¯èƒ½ä»éœ€è¦ç»§ç»­å…¶æ“ä½œã€‚ ä¾‹å¦‚ï¼Œå¤„äºæš‚åœæ¨¡å¼ä½†å¯è§çš„è§†é¢‘æ’­æ”¾åº”ç”¨åº”ç»§ç»­æ˜¾ç¤ºè§†é¢‘ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å»ºè®®æ’­æ”¾è§†é¢‘çš„ Activity ä¸è¦æš‚åœå…¶ onPause() å¤„ç†ç¨‹åºä¸­çš„è§†é¢‘ã€‚ åº”æš‚åœ onStop() ä¸­çš„è§†é¢‘ï¼Œå¹¶æ¢å¤ onStart() ä¸­çš„è§†é¢‘æ’­æ”¾ã€‚</p><p>ç”¨æˆ·ä½¿ç”¨å¤šçª—å£æ¨¡å¼æ˜¾ç¤ºåº”ç”¨æ—¶ï¼Œç³»ç»Ÿå°†é€šçŸ¥ Activity å‘ç”Ÿé…ç½®å˜æ›´ã€‚ è¯¥å˜æ›´ä¸ç³»ç»Ÿé€šçŸ¥åº”ç”¨è®¾å¤‡ä»çºµå‘æ¨¡å¼åˆ‡æ¢åˆ°æ¨ªå‘æ¨¡å¼æ—¶çš„ Activity ç”Ÿå‘½å‘¨æœŸå½±å“åŸºæœ¬ç›¸åŒï¼Œä½†è®¾å¤‡ä¸ä»…ä»…æ˜¯äº¤æ¢å°ºå¯¸ï¼Œè€Œæ˜¯ä¼šå˜æ›´å°ºå¯¸ã€‚æ‚¨çš„ Activity å¯ä»¥è‡ªè¡Œå¤„ç†é…ç½®å˜æ›´ï¼Œæˆ–å…è®¸ç³»ç»Ÿé”€æ¯ Activityï¼Œå¹¶ä»¥æ–°çš„å°ºå¯¸é‡æ–°åˆ›å»ºè¯¥ Activityã€‚<br>ç»™ActivityåŠ ä¸Šå¦‚ä¸‹é…ç½®å¯ä»¥ä¿è¯åˆ‡æ¢æˆå¤šå±æ¨¡å¼æˆ–è€…ç”»ä¸­ç”»æ¨¡å¼æ—¶Activityä¸ä¼šé”€æ¯é‡å»ºã€‚<br>android:configChanges&#x3D;â€screenSize|smallestScreenSize|screenLayout|orientationâ€</p><h4 id="é’ˆå¯¹å¤šçª—å£æ¨¡å¼é…ç½®åº”ç”¨"><a href="#é’ˆå¯¹å¤šçª—å£æ¨¡å¼é…ç½®åº”ç”¨" class="headerlink" title="é’ˆå¯¹å¤šçª—å£æ¨¡å¼é…ç½®åº”ç”¨"></a>é’ˆå¯¹å¤šçª—å£æ¨¡å¼é…ç½®åº”ç”¨</h4><p>å¦‚æœåº”ç”¨æ”¯æŒ Android Nï¼Œæ‚¨å¯ä»¥å¯¹åº”ç”¨çš„ Activity æ˜¯å¦æ”¯æŒå¤šçª—å£æ˜¾ç¤ºä»¥åŠæ˜¾ç¤ºæ–¹å¼è¿›è¡Œé…ç½®ã€‚ æ‚¨å¯ä»¥åœ¨æ¸…å•æ–‡ä»¶ä¸­è®¾ç½®å±æ€§ï¼Œä»¥æ§åˆ¶å¤§å°å’Œå¸ƒå±€ã€‚ æ ¹ Activity çš„å±æ€§è®¾ç½®é€‚ç”¨äºå…¶ä»»åŠ¡æ ˆä¸­çš„æ‰€æœ‰ Activityã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæ ¹ Activity ä¸­ <code>android:resizeableActivity</code> è®¾å®šä¸º trueï¼Œåˆ™ä»»åŠ¡æ ˆä¸­çš„æ‰€æœ‰ Activity éƒ½å°†å¯ä»¥è°ƒæ•´å¤§å°ã€‚<br>å¦‚æœä½¿ç”¨ä½äº Android N ç‰ˆæœ¬çš„ SDK æ„å»ºå¤šå‘åº”ç”¨ï¼Œåˆ™ç”¨æˆ·åœ¨å¤šçª—å£æ¨¡å¼ä¸­ä½¿ç”¨åº”ç”¨æ—¶ï¼Œç³»ç»Ÿå°†å¼ºåˆ¶è°ƒæ•´åº”ç”¨å¤§å°ã€‚ ç³»ç»Ÿå°†æ˜¾ç¤ºå¯¹è¯æ¡†ï¼Œæé†’ç”¨æˆ·åº”ç”¨å¯èƒ½ä¼šå‘ç”Ÿå¼‚å¸¸ã€‚ ç³»ç»Ÿä¸ä¼šè°ƒæ•´å®šå‘åº”ç”¨çš„å¤§å°ï¼›å¦‚æœç”¨æˆ·å°è¯•åœ¨å¤šçª—å£æ¨¡å¼ä¸‹æ‰“å¼€å®šå‘åº”ç”¨ï¼Œåº”ç”¨å°†å…¨å±æ˜¾ç¤ºã€‚</p><p>** android:resizeableActivity **<br>åœ¨æ¸…å•çš„ <code>&lt;activity&gt;</code> æˆ– <code>&lt;application&gt;</code> èŠ‚ç‚¹ä¸­è®¾ç½®è¯¥å±æ€§ï¼Œå¯ç”¨æˆ–ç¦ç”¨å¤šçª—å£æ˜¾ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">android:resizeableActivity=[&quot;true&quot; | &quot;false&quot;] <br></code></pre></td></tr></table></figure><p>å¦‚æœè¯¥å±æ€§è®¾ç½®ä¸º trueï¼ŒActivity å°†èƒ½ä»¥åˆ†å±å’Œè‡ªç”±å½¢çŠ¶æ¨¡å¼å¯åŠ¨ã€‚ å¦‚æœæ­¤å±æ€§è®¾ç½®ä¸º falseï¼ŒActivity å°†ä¸æ”¯æŒå¤šçª—å£æ¨¡å¼ã€‚ å¦‚æœè¯¥å€¼ä¸º falseï¼Œä¸”ç”¨æˆ·å°è¯•åœ¨å¤šçª—å£æ¨¡å¼ä¸‹å¯åŠ¨ Activityï¼Œè¯¥ Activity å°†å…¨å±æ˜¾ç¤ºã€‚<br>å¦‚æœåº”ç”¨é¢å‘ Android Nï¼Œä½†æœªå¯¹è¯¥å±æ€§æŒ‡å®šå€¼ï¼Œåˆ™è¯¥å±æ€§çš„å€¼é»˜è®¤è®¾ä¸º trueã€‚</p><p>** android:supportsPictureInPicture **<br>åœ¨æ¸…å•æ–‡ä»¶çš„ <code>&lt;activity&gt;</code> èŠ‚ç‚¹ä¸­è®¾ç½®è¯¥å±æ€§ï¼ŒæŒ‡æ˜ Activity æ˜¯å¦æ”¯æŒç”»ä¸­ç”»æ˜¾ç¤ºã€‚ å¦‚æœ <code>android:resizeableActivity</code> ä¸º falseï¼Œå°†å¿½ç•¥è¯¥å±æ€§ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">android:supportsPictureInPicture=[&quot;true&quot; | &quot;false&quot;]<br></code></pre></td></tr></table></figure><h4 id="å¸ƒå±€å±æ€§"><a href="#å¸ƒå±€å±æ€§" class="headerlink" title="å¸ƒå±€å±æ€§"></a>å¸ƒå±€å±æ€§</h4><p>å¯¹äº Android Nï¼Œ<code>&lt;layout&gt;</code> æ¸…å•å…ƒç´ æ”¯æŒä»¥ä¸‹å‡ ç§å±æ€§ï¼Œè¿™äº›å±æ€§å½±å“ Activity åœ¨å¤šçª—å£æ¨¡å¼ä¸­çš„è¡Œä¸ºï¼š</p><p><code>android:defaultWidth</code><br>ä»¥è‡ªç”±å½¢çŠ¶æ¨¡å¼å¯åŠ¨æ—¶ Activity çš„é»˜è®¤å®½åº¦ã€‚<br><code>android:defaultHeight</code><br>ä»¥è‡ªç”±å½¢çŠ¶æ¨¡å¼å¯åŠ¨æ—¶ Activity çš„é»˜è®¤é«˜åº¦ã€‚<br><code>android:gravity</code><br>ä»¥è‡ªç”±å½¢çŠ¶æ¨¡å¼å¯åŠ¨æ—¶ Activity çš„åˆå§‹ä½ç½®ã€‚è¯·å‚é˜… Gravity å‚è€ƒèµ„æ–™ï¼Œäº†è§£åˆé€‚çš„å€¼è®¾ç½®ã€‚<br><code>android:minimalHeightã€android:minimalWidth</code><br>åˆ†å±å’Œè‡ªç”±å½¢çŠ¶æ¨¡å¼ä¸­ Activity çš„æœ€å°é«˜åº¦å’Œæœ€å°å®½åº¦ã€‚ å¦‚æœç”¨æˆ·åœ¨åˆ†å±æ¨¡å¼ä¸­ç§»åŠ¨åˆ†ç•Œçº¿ï¼Œä½¿ Activity å°ºå¯¸ä½äºæŒ‡å®šçš„æœ€å°å€¼ï¼Œç³»ç»Ÿä¼šå°† Activity è£å‰ªä¸ºç”¨æˆ·è¯·æ±‚çš„å°ºå¯¸ã€‚<br>ä¾‹å¦‚ï¼Œä»¥ä¸‹èŠ‚ç‚¹æ˜¾ç¤ºäº†å¦‚ä½•æŒ‡å®š Activity åœ¨è‡ªç”±å½¢çŠ¶æ¨¡å¼ä¸­æ˜¾ç¤ºæ—¶ Activity çš„é»˜è®¤å¤§å°ã€ä½ç½®å’Œæœ€å°å°ºå¯¸ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">activity</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;.MyActivity&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">layout</span> <span class="hljs-attr">android:defaultHeight</span>=<span class="hljs-string">&quot;500dp&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">android:defaultWidth</span>=<span class="hljs-string">&quot;600dp&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">&quot;top|end&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">android:minimalHeight</span>=<span class="hljs-string">&quot;450dp&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">android:minimalWidth</span>=<span class="hljs-string">&quot;300dp&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">activity</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="åœ¨å¤šçª—å£æ¨¡å¼ä¸­è¿è¡Œåº”ç”¨"><a href="#åœ¨å¤šçª—å£æ¨¡å¼ä¸­è¿è¡Œåº”ç”¨" class="headerlink" title="åœ¨å¤šçª—å£æ¨¡å¼ä¸­è¿è¡Œåº”ç”¨"></a>åœ¨å¤šçª—å£æ¨¡å¼ä¸­è¿è¡Œåº”ç”¨</h4><p>** å¤šçª—å£æ¨¡å¼ä¸­è¢«ç¦ç”¨çš„åŠŸèƒ½ **<br>åœ¨è®¾å¤‡å¤„äºå¤šçª—å£æ¨¡å¼ä¸­æ—¶ï¼ŒæŸäº›åŠŸèƒ½ä¼šè¢«ç¦ç”¨æˆ–å¿½ç•¥ï¼Œå› ä¸ºè¿™äº›åŠŸèƒ½å¯¹ä¸å…¶ä»– Activity æˆ–åº”ç”¨å…±äº«è®¾å¤‡å±å¹•çš„ Activity è€Œè¨€æ²¡æœ‰æ„ä¹‰ã€‚ æ­¤ç±»åŠŸèƒ½åŒ…æ‹¬ï¼š</p><ol><li>æŸäº›ç³»ç»Ÿ UI è‡ªå®šä¹‰é€‰é¡¹å°†è¢«ç¦ç”¨ï¼›ä¾‹å¦‚ï¼Œåœ¨éå…¨å±æ¨¡å¼ä¸­ï¼Œåº”ç”¨æ— æ³•éšè—çŠ¶æ€æ ã€‚</li><li>ç³»ç»Ÿå°†å¿½ç•¥å¯¹ android:screenOrientation å±æ€§æ‰€ä½œçš„æ›´æ”¹ã€‚</li></ol><p>** å¤šçª—å£å˜æ›´é€šçŸ¥å’ŒæŸ¥è¯¢ **</p><ol><li>Activity.isInMultiWindowMode()<br>è°ƒç”¨è¯¥æ–¹æ³•ä»¥ç¡®è®¤ Activity æ˜¯å¦å¤„äºå¤šçª—å£æ¨¡å¼ã€‚</li><li>Activity.isInPictureInPictureMode()<br>è°ƒç”¨è¯¥æ–¹æ³•ä»¥ç¡®è®¤ Activity æ˜¯å¦å¤„äºç”»ä¸­ç”»æ¨¡å¼ã€‚<blockquote><p>ç”»ä¸­ç”»æ¨¡å¼æ˜¯å¤šçª—å£æ¨¡å¼çš„ç‰¹ä¾‹ã€‚ å¦‚æœ myActivity.isInPictureInPictureMode() è¿”å› trueï¼Œ<br>myActivity.isInMultiWindowMode() ä¹Ÿè¿”å› trueã€‚</p></blockquote></li><li>Activity.onMultiWindowModeChanged()<br>Activity è¿›å…¥æˆ–é€€å‡ºå¤šçª—å£æ¨¡å¼æ—¶ç³»ç»Ÿå°†è°ƒç”¨æ­¤æ–¹æ³•ã€‚ åœ¨ Activity è¿›å…¥å¤šçª—å£æ¨¡å¼æ—¶ï¼Œç³»ç»Ÿå‘è¯¥æ–¹æ³•ä¼ é€’ true å€¼ï¼Œåœ¨é€€å‡ºå¤šçª—å£æ¨¡å¼æ—¶ï¼Œåˆ™ä¼ é€’ false å€¼ã€‚</li><li>Activity.onPictureInPictureModeChanged()<br>Activity è¿›å…¥æˆ–é€€å‡ºç”»ä¸­ç”»æ¨¡å¼æ—¶ç³»ç»Ÿå°†è°ƒç”¨æ­¤æ–¹æ³•ã€‚ åœ¨ Activity è¿›å…¥ç”»ä¸­ç”»æ¨¡å¼æ—¶ï¼Œç³»ç»Ÿå‘è¯¥æ–¹æ³•ä¼ é€’ true å€¼ï¼Œåœ¨é€€å‡ºç”»ä¸­ç”»æ¨¡å¼æ—¶ï¼Œåˆ™ä¼ é€’ false å€¼ã€‚</li></ol><p>æ¯ä¸ªæ–¹æ³•è¿˜æœ‰ Fragment ç‰ˆæœ¬ï¼Œä¾‹å¦‚ Fragment.isInMultiWindowMode()ã€‚</p><h4 id="è¿›å…¥ç”»ä¸­ç”»æ¨¡å¼"><a href="#è¿›å…¥ç”»ä¸­ç”»æ¨¡å¼" class="headerlink" title="è¿›å…¥ç”»ä¸­ç”»æ¨¡å¼"></a>è¿›å…¥ç”»ä¸­ç”»æ¨¡å¼</h4><p>å¦‚éœ€åœ¨ç”»ä¸­ç”»æ¨¡å¼ä¸­å¯åŠ¨ Activityï¼Œè¯·è°ƒç”¨æ–°æ–¹æ³• Activity.enterPictureInPictureMode()ã€‚ å¦‚æœè®¾å¤‡ä¸æ”¯æŒç”»ä¸­ç”»æ¨¡å¼ï¼Œåˆ™æ­¤æ–¹æ³•æ— æ•ˆã€‚ å¦‚éœ€äº†è§£è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://developer.android.com/guide/topics/ui/picture-in-picture">ç”»ä¸­ç”»</a>æ–‡æ¡£ã€‚<br><a href="https://developer.android.com/guide/topics/ui/picture-in-picture">https://developer.android.com/guide/topics/ui/picture-in-picture</a></p><h4 id="åœ¨å¤šçª—å£æ¨¡å¼ä¸­å¯åŠ¨æ–°-Activity"><a href="#åœ¨å¤šçª—å£æ¨¡å¼ä¸­å¯åŠ¨æ–°-Activity" class="headerlink" title="åœ¨å¤šçª—å£æ¨¡å¼ä¸­å¯åŠ¨æ–° Activity"></a>åœ¨å¤šçª—å£æ¨¡å¼ä¸­å¯åŠ¨æ–° Activity</h4><p>å¦‚æœåªæ˜¯ç®€å•çš„å¼€å¯Activityï¼Œå’Œåœ¨éå¤šçª—å£æ¨¡å¼ä¸‹æ˜¯ä¸€è‡´çš„ã€‚å¦‚æœæƒ³è¦åœ¨å½“å‰Activityçš„æ—è¾¹å¯åŠ¨Activityï¼Œå¯ä»¥æ·»åŠ <code>FLAG_ACTIVITY_LAUNCH_ADJACENT</code>æ ‡å¿—ä½(å®˜æ–¹æ–‡æ¡£è¯´æ˜¯<code>Intent.FLAG_ACTIVITY_LAUNCH_TO_ADJACENT</code>,ä½†åœ¨å®é™…æ“ä½œä¸­è¿™ä¸ªæ ‡å¿—ä½ä¸å­˜åœ¨)ï¼Œä¼ é€’æ­¤æ ‡å¿—å°†è¯·æ±‚ä»¥ä¸‹è¡Œä¸ºï¼š</p><ol><li>å¦‚æœè®¾å¤‡å¤„äºåˆ†å±æ¨¡å¼ï¼Œç³»ç»Ÿä¼šå°è¯•åœ¨å¯åŠ¨ç³»ç»Ÿçš„ Activity æ—åˆ›å»ºæ–° Activityï¼Œè¿™æ ·ä¸¤ä¸ª Activity å°†å…±äº«å±å¹•ã€‚ ç³»ç»Ÿå¹¶ä¸ä¸€å®šèƒ½å®ç°æ­¤æ“ä½œï¼Œä½†å¦‚æœå¯ä»¥ï¼Œç³»ç»Ÿå°†ä½¿ä¸¤ä¸ª Activity å¤„äºç›¸é‚»çš„ä½ç½®ã€‚</li><li>å¦‚æœè®¾å¤‡ä¸å¤„äºåˆ†å±æ¨¡å¼ï¼Œåˆ™è¯¥æ ‡å¿—æ— æ•ˆã€‚<br>å¦‚æœè®¾å¤‡å¤„äºè‡ªç”±å½¢çŠ¶æ¨¡å¼ï¼Œåˆ™åœ¨å¯åŠ¨æ–° Activity æ—¶ï¼Œç”¨æˆ·å¯é€šè¿‡è°ƒç”¨ ActivityOptions.setLaunchBounds() æŒ‡å®šæ–° Activity çš„å°ºå¯¸å’Œå±å¹•ä½ç½®ã€‚ å¦‚æœè®¾å¤‡ä¸å¤„äºå¤šçª—å£æ¨¡å¼ï¼Œåˆ™è¯¥æ–¹æ³•æ— æ•ˆã€‚<br>PS:å¦‚æœåœ¨ä»»åŠ¡æ ˆä¸­å¯åŠ¨ Activityï¼Œè¯¥ Activity å°†æ›¿æ¢å±å¹•ä¸Šçš„ Activityï¼Œå¹¶ç»§æ‰¿å…¶æ‰€æœ‰çš„å¤šçª—å£å±æ€§ã€‚ å¦‚æœè¦åœ¨å¤šçª—å£æ¨¡å¼ä¸­ä»¥å•ç‹¬çš„çª—å£å¯åŠ¨æ–° Activityï¼Œåˆ™å¿…é¡»åœ¨æ–°çš„ä»»åŠ¡æ ˆä¸­å¯åŠ¨æ­¤ Activityã€‚</li></ol><h4 id="æ”¯æŒæ‹–æ”¾"><a href="#æ”¯æŒæ‹–æ”¾" class="headerlink" title="æ”¯æŒæ‹–æ”¾"></a>æ”¯æŒæ‹–æ”¾</h4><p>ç”¨æˆ·å¯ä»¥åœ¨ä¸¤ä¸ª Activity å…±äº«å±å¹•çš„åŒæ—¶åœ¨è¿™ä¸¤ä¸ª Activity ä¹‹é—´æ‹–æ”¾æ•°æ® ï¼ˆåœ¨æ­¤ä¹‹å‰ï¼Œç”¨æˆ·åªèƒ½åœ¨ä¸€ä¸ª Activity å†…éƒ¨æ‹–æ”¾æ•°æ®ï¼‰ã€‚ </p><ol><li>android.view.DropPermissions<br>ä»¤ç‰Œå¯¹è±¡ï¼Œè´Ÿè´£æŒ‡å®šå¯¹æ¥æ”¶æ‹–æ”¾æ•°æ®çš„åº”ç”¨æˆäºˆçš„æƒé™ã€‚</li><li>View.startDragAndDrop()<br>View.startDrag() çš„æ–°åˆ«åã€‚è¦å¯ç”¨è·¨ Activity æ‹–æ”¾ï¼Œè¯·ä¼ é€’æ–°æ ‡å¿— View.DRAG_FLAG_GLOBALã€‚ å¦‚éœ€å¯¹æ¥æ”¶æ‹–æ”¾æ•°æ®çš„ Activity æˆäºˆ URI æƒé™ï¼Œå¯æ ¹æ®æƒ…å†µä¼ é€’æ–°æ ‡å¿— View.DRAG_FLAG_GLOBAL_URI_READ æˆ– View.DRAG_FLAG_GLOBAL_URI_WRITEã€‚</li><li>View.cancelDragAndDrop()<br>å–æ¶ˆå½“å‰æ­£åœ¨è¿›è¡Œçš„æ‹–åŠ¨æ“ä½œã€‚åªèƒ½ç”±å‘èµ·æ‹–åŠ¨æ“ä½œçš„åº”ç”¨è°ƒç”¨ã€‚</li><li>View.updateDragShadow()<br>æ›¿æ¢å½“å‰æ­£åœ¨è¿›è¡Œçš„æ‹–åŠ¨æ“ä½œçš„æ‹–åŠ¨é˜´å½±ã€‚åªèƒ½ç”±å‘èµ·æ‹–åŠ¨æ“ä½œçš„åº”ç”¨è°ƒç”¨ã€‚</li><li>Activity.requestDropPermissions()<br>è¯·æ±‚ä½¿ç”¨ DragEvent ä¸­åŒ…å«çš„ ClipData ä¼ é€’çš„å†…å®¹ URI çš„æƒé™ã€‚</li></ol><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><p>** åœ¨å½“å‰Activityæ—è¾¹å¼€å¯æ–°ç•Œé¢ **<br>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸Šé¢çš„ç•Œé¢æ˜¯MainActivityï¼Œä¸‹é¢çš„Activityæ˜¯åœ¨MainActivityä¸­ç‚¹å‡»<code>è·å–å®æ—¶å¤©æ°”</code>å¼€å¯çš„ç•Œé¢<br><img src="/image/Android/MultiWindow/2.png" alt="MultiWindow"><br>åœ¨MainActivityä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">findViewById(R.id.get_weather).setOnClickListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnClickListener() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> &#123;<br>        <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(MainActivity.<span class="hljs-built_in">this</span>,Main2Activity.class);<br>        intent.addFlags(Intent.FLAG_ACTIVITY_LAUNCH_ADJACENT | Intent.FLAG_ACTIVITY_NEW_TASK);<br>        startActivity(intent);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆéœ€è¦ <code>FLAG_ACTIVITY_NEW_TASK</code>:<br>å®˜æ–¹è§£é‡Š</p><blockquote><p>åœ¨åŒä¸€ä¸ªActivityè¿”å›æ ˆä¸­ï¼Œæ‰“å¼€ä¸€ä¸ªæ–°çš„Activityæ—¶ï¼Œè¿™ä¸ªActivityå°†ä¼šç»§æ‰¿ä¸Šä¸€ä¸ªActivityæ‰€æœ‰å’Œåˆ†å±æ¨¡å¼æœ‰å…³çš„å±æ€§ã€‚å¦‚æœä½ æƒ³è¦åœ¨ä¸€ä¸ªç‹¬ç«‹çš„çª—å£ä»¥åˆ†å±æ¨¡å¼æ‰“å¼€ä¸€ä¸ªæ–°çš„Activityï¼Œé‚£ä¹ˆå¿…é¡»æ–°å»ºä¸€ä¸ªActivityè¿”å›æ ˆã€‚</p></blockquote><p>** æ‹–æ‹½ **<br>é¦–å…ˆåœ¨å¤šçª—å£æ¨¡å¼ä¸‹æ‰“å¼€æ–°ç•Œé¢ï¼Œå¦‚ä¸Šé¢çš„ä»£ç æ‰€ç¤ºã€‚<br>åœ¨MainActivityä¸­å‘èµ·æ‹–æ‹½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">Button</span> <span class="hljs-variable">dragedButton</span> <span class="hljs-operator">=</span> findViewById(R.id.drag_to_another);<span class="hljs-comment">//æ‹–æ‹½æŒ‰é’®</span><br>        dragedButton.setTag(<span class="hljs-string">&quot;this is a test&quot;</span>);<br><br>        dragedButton.setOnTouchListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnTouchListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onTouch</span><span class="hljs-params">(View v, MotionEvent event)</span> &#123;<br><br>                <span class="hljs-keyword">if</span>(event.getAction() == MotionEvent.ACTION_DOWN)&#123;<br><br>                    ClipData.<span class="hljs-type">Item</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClipData</span>.Item((CharSequence) dragedButton.getTag());<br>                    String[] mimeTypes = &#123;ClipDescription.MIMETYPE_TEXT_PLAIN&#125;;<br>                    <span class="hljs-type">ClipData</span> <span class="hljs-variable">dragData</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClipData</span>(v.getTag().toString(), mimeTypes, item);<br>                    View.<span class="hljs-type">DragShadowBuilder</span> <span class="hljs-variable">shadow</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.DragShadowBuilder(dragedButton);<br>                    <span class="hljs-comment">/** startDragAndDropæ˜¯Android N SDKä¸­çš„æ–°æ–¹æ³•ï¼Œæ›¿ä»£äº†ä»¥å‰çš„startDragï¼Œflagéœ€è¦è®¾ç½®ä¸ºDRAG_FLAG_GLOBAL */</span><br>                    v.startDragAndDrop(dragData, shadow, <span class="hljs-literal">null</span>, View.DRAG_FLAG_GLOBAL);<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>                &#125;<br>                <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>                &#125;<br>            &#125;<br>        &#125;);<br></code></pre></td></tr></table></figure><p>åœ¨ç¬¬äºŒä¸ªç•Œé¢ä¸­æ¥æ”¶æ‹–æ‹½ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">TextView</span> <span class="hljs-variable">textView</span> <span class="hljs-operator">=</span> findViewById(R.id.show_drag_view_tag);<br>        textView.setText(<span class="hljs-string">&quot;æ‹–æ‹½åˆ°è¿™é‡Œ&quot;</span>);<br>        textView.setOnDragListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnDragListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onDrag</span><span class="hljs-params">(View view, DragEvent dragEvent)</span> &#123;<br>                <span class="hljs-keyword">switch</span> (dragEvent.getAction()) &#123;<br>                    <span class="hljs-keyword">case</span> DragEvent.ACTION_DRAG_STARTED:<br>                        Log.d(TAG, <span class="hljs-string">&quot;Action is DragEvent.ACTION_DRAG_STARTED&quot;</span>);<br>                        <span class="hljs-keyword">break</span>;<br><br>                    <span class="hljs-keyword">case</span> DragEvent.ACTION_DRAG_ENTERED:<br>                        Log.d(TAG, <span class="hljs-string">&quot;Action is DragEvent.ACTION_DRAG_ENTERED&quot;</span>);<br>                        <span class="hljs-keyword">break</span>;<br><br>                    <span class="hljs-keyword">case</span> DragEvent.ACTION_DRAG_EXITED:<br>                        Log.d(TAG, <span class="hljs-string">&quot;Action is DragEvent.ACTION_DRAG_EXITED&quot;</span>);<br>                        <span class="hljs-keyword">break</span>;<br><br>                    <span class="hljs-keyword">case</span> DragEvent.ACTION_DRAG_LOCATION:<br>                        <span class="hljs-keyword">break</span>;<br><br>                    <span class="hljs-keyword">case</span> DragEvent.ACTION_DRAG_ENDED:<br>                        Log.d(TAG, <span class="hljs-string">&quot;Action is DragEvent.ACTION_DRAG_ENDED&quot;</span>);<br>                        <span class="hljs-keyword">break</span>;<br><br>                    <span class="hljs-keyword">case</span> DragEvent.ACTION_DROP:<br>                        Log.d(TAG, <span class="hljs-string">&quot;ACTION_DROP event&quot;</span>);<br>                        <span class="hljs-comment">/** 3.åœ¨è¿™é‡Œæ˜¾ç¤ºæ¥æ”¶åˆ°çš„ç»“æœ */</span><br>                        textView.setText(dragEvent.getClipData().getItemAt(<span class="hljs-number">0</span>).getText());<br>                        <span class="hljs-keyword">break</span>;<br><br>                    <span class="hljs-keyword">default</span>:<br>                        <span class="hljs-keyword">break</span>;<br>                &#125;<br><br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;);<br>    &#125;<br></code></pre></td></tr></table></figure><p>å°†MainActivityä¸­çš„æ‹–æ‹½æŒ‰é’®æ‹–æ”¾çš„ç¬¬äºŒä¸ªç•Œé¢ä¸­<code>æ‹–æ‹½åˆ°è¿™é‡Œ</code>viewä¸Šä¹‹å<br><img src="/image/Android/MultiWindow/3.png" alt="MultiWindow"><br>å…³äºstartDragAndDropï¼Œå®˜æ–¹å‚è€ƒæ–‡æ¡£åœ¨è¿™é‡Œ<br><a href="https://developer.android.com/reference/android/view/View?hl=zh-cn#startDrag">startDragAndDrop</a><br><a href="https://developer.android.com/reference/android/view/View?hl=zh-cn#startDrag">https://developer.android.com/reference/android/view/View?hl=zh-cn#startDrag</a></p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¢è¯•æ€»ç»“</title>
    <link href="/2018/06/03/%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/"/>
    <url>/2018/06/03/%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘çš„é¢è¯•è¿‡ç¨‹ä¸­é‡åˆ°çš„é¢è¯•é¢˜ï¼Œæ¶‰åŠçš„æ–¹é¢æ¯”è¾ƒå¹¿æ³›ï¼Œå¤§è‡´åˆ†æˆäº†ä¸€ä¸‹å‡ ä¸ªæ–¹é¢ï¼š<br>æ“ä½œç³»ç»Ÿã€Javaã€Androidã€è®¡ç®—æœºç½‘ç»œã€å…¶ä»–(kotlinã€reactã€å®‰å…¨ä¹‹ç±»çš„)ã€‚</p><span id="more"></span><h3 id="æ“ä½œç³»ç»Ÿç›¸å…³ï¼š"><a href="#æ“ä½œç³»ç»Ÿç›¸å…³ï¼š" class="headerlink" title="æ“ä½œç³»ç»Ÿç›¸å…³ï¼š"></a>æ“ä½œç³»ç»Ÿç›¸å…³ï¼š</h3><h4 id="è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«"></a>è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</h4><blockquote><ul><li>è¿›ç¨‹æ˜¯èµ„æºçš„åˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•å…ƒï¼Œè€Œçº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„åŸºæœ¬å•å…ƒ </li><li>åŒä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥åŒ…æ‹¬å¤šä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸”çº¿ç¨‹å…±äº«æ•´ä¸ªè¿›ç¨‹çš„èµ„æºï¼ˆå¯„å­˜å™¨ã€å †æ ˆã€ä¸Šä¸‹æ–‡ï¼‰ï¼Œä¸€ä¸ªè¿›è¡Œè‡³å°‘åŒ…æ‹¬ä¸€ä¸ªçº¿ç¨‹ã€‚</li><li>è¿›ç¨‹çš„åˆ›å»ºè°ƒç”¨forkæˆ–è€…vforkï¼Œè€Œçº¿ç¨‹çš„åˆ›å»ºè°ƒç”¨pthread_createï¼Œè¿›ç¨‹ç»“æŸåå®ƒæ‹¥æœ‰çš„æ‰€æœ‰çº¿ç¨‹éƒ½å°†é”€æ¯ï¼Œè€Œçº¿ç¨‹çš„ç»“æŸä¸ä¼šå½±å“åŒä¸ªè¿›ç¨‹ä¸­çš„å…¶ä»–çº¿ç¨‹çš„ç»“æŸ</li><li>çº¿ç¨‹æ˜¯è½»é‡çº§çš„è¿›ç¨‹ï¼Œå®ƒçš„åˆ›å»ºå’Œé”€æ¯æ‰€éœ€è¦çš„æ—¶é—´æ¯”è¿›ç¨‹å°å¾ˆå¤šï¼Œæ‰€æœ‰æ“ä½œç³»ç»Ÿä¸­çš„æ‰§è¡ŒåŠŸèƒ½éƒ½æ˜¯åˆ›å»ºçº¿ç¨‹å»å®Œæˆçš„</li><li>çº¿ç¨‹ä¸­æ‰§è¡Œæ—¶ä¸€èˆ¬éƒ½è¦è¿›è¡ŒåŒæ­¥å’Œäº’æ–¥ï¼Œå› ä¸ºä»–ä»¬å…±äº«åŒä¸€è¿›ç¨‹çš„æ‰€æœ‰èµ„æº</li><li>çº¿ç¨‹æœ‰è‡ªå·±çš„ç§æœ‰å±æ€§TCBï¼Œçº¿ç¨‹idï¼Œå¯„å­˜å™¨ã€ç¡¬ä»¶ä¸Šä¸‹æ–‡ï¼Œè€Œè¿›ç¨‹ä¹Ÿæœ‰è‡ªå·±çš„ç§æœ‰å±æ€§è¿›ç¨‹æ§åˆ¶å—PCBï¼Œè¿™äº›ç§æœ‰å±æ€§æ˜¯ä¸è¢«å…±äº«çš„ï¼Œç”¨æ¥æ ‡ç¤ºä¸€ä¸ªè¿›ç¨‹æˆ–ä¸€ä¸ªçº¿ç¨‹çš„æ ‡å¿—</li></ul></blockquote><h4 id="çº¿ç¨‹è°ƒåº¦ç®—æ³•"><a href="#çº¿ç¨‹è°ƒåº¦ç®—æ³•" class="headerlink" title="çº¿ç¨‹è°ƒåº¦ç®—æ³•"></a>çº¿ç¨‹è°ƒåº¦ç®—æ³•</h4><blockquote><ul><li>SCHED_OTHERï¼šæ™®é€šä»»åŠ¡è°ƒåº¦ç­–ç•¥ã€‚</li><li>SCHED_FIFOï¼šå®æ—¶ä»»åŠ¡è°ƒåº¦ç­–ç•¥ï¼Œå…ˆåˆ°å…ˆæœåŠ¡ã€‚ä¸€æ—¦å ç”¨cpuåˆ™ä¸€ç›´è¿è¡Œï¼Œç›´åˆ°æœ‰æ›´é«˜ä¼˜å…ˆçº§ä»»åŠ¡åˆ°è¾¾æˆ–è‡ªå·±æ”¾å¼ƒã€‚</li><li>SCHED_RRï¼šå®æ—¶ä»»åŠ¡è°ƒåº¦ç­–ç•¥ï¼Œæ—¶é—´ç‰‡è½®è½¬ã€‚å½“ä»»åŠ¡çš„æ—¶é—´ç‰‡ç”¨å®Œï¼Œç³»ç»Ÿå°†é‡æ–°åˆ†é…æ—¶é—´ç‰‡ï¼Œå¹¶ç½®äºå°±ç»ªé˜Ÿåˆ—å°¾ã€‚æ”¾åœ¨é˜Ÿåˆ—å°¾<br>å…·ä½“æ¶‰åŠåˆ°Nå¤šå†…å®¹ï¼Œè‡ªè¡Œæœç´¢</li></ul></blockquote><h4 id="å†…å­˜é¡µé¢ç½®æ¢ç®—æ³•"><a href="#å†…å­˜é¡µé¢ç½®æ¢ç®—æ³•" class="headerlink" title="å†…å­˜é¡µé¢ç½®æ¢ç®—æ³•"></a>å†…å­˜é¡µé¢ç½®æ¢ç®—æ³•</h4><p>ä¸ºæé«˜å†…å­˜åˆ©ç”¨ç‡ï¼Œè§£å†³å†…å­˜ä¾›ä¸åº”æ±‚çš„é—®é¢˜ï¼Œæ›´åŠ åˆç†çš„ä½¿ç”¨å†…å­˜ï¼Œäººä»¬åˆ›é€ äº†åˆ†é¡µå¼å†…å­˜æŠ½è±¡ã€‚åŒæ—¶æœ‰ä¸€ä¸ªè™šæ‹Ÿå†…å­˜çš„æ¦‚å¿µï¼Œæ˜¯æŒ‡å°†å†…å­˜ä¸­æš‚æ—¶ä¸éœ€è¦çš„éƒ¨åˆ†å†™å…¥ç¡¬ç›˜ï¼Œçœ‹ä¸Šå»ç¡¬ç›˜æ‰©å±•äº†å†…å­˜çš„å®¹é‡ï¼Œæ‰€ä»¥å«åšâ€œè™šæ‹Ÿâ€å†…å­˜ã€‚ä½¿ç”¨è™šæ‹Ÿå†…å­˜ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨æ¯”å®é™…ç‰©ç†å†…å­˜æ›´å¤§çš„å†…å­˜ç©ºé—´ã€‚å¯ä»¥è®¤ä¸ºè¿™ä¸ªæ›´å¤§çš„å†…å­˜ç©ºé—´å°±åœ¨ç¡¬ç›˜ä¸Šï¼Œåªæœ‰å°†æŸä¸€éƒ¨åˆ†éœ€è¦è¢«ç”¨åˆ°æ—¶ï¼Œæ‰è¢«å†™å…¥çœŸå®å†…å­˜ï¼›å½“å®ƒæš‚æ—¶ä¸å†è¢«ç”¨åˆ°æ—¶ï¼Œåˆè¢«å†™å›ç¡¬ç›˜ã€‚åˆ†é¡µå¼å†…å­˜ç®¡ç†å°†ç‰©ç†å†…å­˜åˆ†ä¸ºç­‰å¤§çš„å°å—ï¼Œæ¯å—å¤§å°é€šå¸¸ä¸º1Kã€2Kã€4Kç­‰ï¼Œç§°ä¸ºé¡µå¸§ï¼›é€»è¾‘å†…å­˜ï¼ˆä½¿ç”¨è™šæ‹Ÿå†…å­˜æŠ€æœ¯æ‰©å¤§çš„å†…å­˜ï¼Œå¯è®¤ä¸ºå…¶ä½äºç¡¬ç›˜ä¸Šï¼‰ä¹Ÿè¢«åˆ†ä¸ºç­‰å¤§çš„å°å—ï¼Œç§°ä¸ºé¡µï¼›ä¸”é¡µå’Œé¡µå¸§çš„å¤§å°ä¸€å®šæ˜¯ä¸€æ ·çš„ï¼Œå®ƒæ˜¯å†™å…¥çœŸå®å†…å­˜å’Œå†™å›ç¡¬ç›˜æœ€å°å•ä½ã€‚</p><blockquote><p>** Optimalç®—æ³•ï¼ˆæœ€ä¼˜ç®—æ³•ï¼‰ **<br>ã€€ã€€ä»å†…å­˜ä¸­ç§»é™¤æ°¸è¿œéƒ½ä¸å†éœ€è¦çš„é¡µé¢æˆ–è€…è¯´æ˜¯æœªæ¥æœ€é•¿æ—¶é—´å†…ä¸å†è¢«è®¿é—®çš„é¡µé¢ï¼Œå¦‚æœè¿™æ ·çš„é¡µé¢å­˜åœ¨ï¼Œåˆ™é€‰æ‹©æœ€é•¿æ—¶é—´ä¸éœ€è¦è®¿é—®çš„é¡µé¢ã€‚é‡‡ç”¨æœ€ä½³ç½®æ¢ç®—æ³•ï¼Œå¯ä»¥ä¿è¯è¾ƒä½çš„é¡µé¢æ›´æ–°é¢‘ç‡ã€‚ä»ç†è®ºä¸Šè®²ï¼Œç”±äºæ— æ³•é¢„çŸ¥å“ªä¸€ä¸ªé¡µé¢æ˜¯æœªæ¥æœ€é•¿æ—¶é—´å†…ä¸å†è¢«è®¿é—®çš„ï¼Œå› è€Œè¯¥ç®—æ³•æ— æ³•å®ç°ï¼Œä½†æ˜¯å¯ç”¨æ¥è¡¡é‡å…¶ä»–ç®—æ³•ã€‚</p></blockquote><blockquote><p>** FIFOï¼ˆFirst-In First-Outï¼Œå…ˆè¿›å…ˆå‡ºï¼‰ç®—æ³• **<br>    è¯¥ç®—æ³•æ€»æ˜¯æ·˜æ±°æœ€æ—©è¿›å…¥å†…å­˜çš„é¡µé¢ï¼Œå³é€‰æ‹©åœ¨å†…å­˜ä¸­åœç•™æ—¶é—´æœ€ä¹…çš„é¡µé¢äºˆä»¥æ·˜æ±°ã€‚<br>ã€€ã€€è¿™ä¸ªç®—æ³•çš„å®ç°ç®€å•ï¼Œåªéœ€è¦å°†è¿›ç¨‹å·²è°ƒå…¥å†…å­˜ä¸­çš„é¡µé¢ï¼ŒæŒ‰ç…§å…ˆåé¡ºåºè¿æ¥æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œè®¾ç½®ä¸€ä¸ªæ›¿æ¢æŒ‡é’ˆï¼Œæ€»æ˜¯æŒ‡å‘æœ€è€çš„é¡µé¢ã€‚<br>ã€€ã€€ä½†æ˜¯è¯¥ç®—æ³•ä¸è¿›ç¨‹å®é™…çš„è§„å¾‹å¹¶ä¸ç›¸é€‚åº”ï¼Œå› ä¸ºåœ¨è¿›ç¨‹ä¸­ï¼Œæœ‰äº›é¡µé¢ç»å¸¸è¢«è®¿é—®ï¼Œæ¯”å¦‚ï¼šå«æœ‰å…¨å±€å˜é‡ã€å¸¸ç”¨å‡½æ•°ã€ä¾‹ç¨‹ç­‰çš„é¡µé¢ï¼ŒFIFOä¸èƒ½ä¿è¯è¿™äº›é¡µé¢ä¸ä¼šè¢«æ·˜æ±°ã€‚<br>ã€€ã€€æ­£æ˜¯ç”±äºæ²¡æœ‰è€ƒè™‘é¡µé¢çš„é‡è¦æ€§çš„é—®é¢˜ï¼ŒFIFOç®—æ³•å¾ˆå®¹æ˜“å°†é‡è¦çš„é¡µæ¢å‡ºå†…å­˜ã€‚</p></blockquote><blockquote><p>** Second Chanceï¼ˆç¬¬äºŒæ¬¡æœºä¼šï¼‰ç®—æ³• **<br>ã€€ã€€ä¸ºäº†é¿å…FIFOç®—æ³•å°†é‡è¦çš„é¡µæ¢å‡ºå†…å­˜ï¼ŒSecond Chanceç®—æ³•æä¾›äº†ä¸€äº›æ”¹è¿›ã€‚Second Chanceç®—æ³•åœ¨å°†é¡µé¢æ¢å‡ºå†…å­˜å‰æ£€æŸ¥å…¶ä½¿ç”¨ä½ï¼Œå¦‚æœå…¶ä½¿ç”¨ä½ä¸º1ï¼Œè¯æ˜æ­¤é¡µæœ€è¿‘æœ‰è¢«ä½¿ç”¨ï¼ŒçŒœæµ‹å®ƒè¿˜å¯èƒ½è¢«ä½¿ç”¨ï¼Œäºæ˜¯ä¸æŠŠå®ƒç½®æ¢å‡ºå†…å­˜ï¼Œä½†æ˜¯æŠŠå…¶ä½¿ç”¨ä½ç½®ä¸º0ï¼Œéšåæ£€æŸ¥ä¸‹ä¸€ä¸ªé¡µé¢ï¼Œç›´åˆ°å‘ç°æŸé¡µçš„ä½¿ç”¨ä½ä¸º0ï¼Œå°†æ­¤é¡µç½®æ¢å‡ºå†…å­˜ã€‚</p></blockquote><blockquote><p>** LRUï¼ˆLeast Recent Used, æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ç®—æ³• **<br>ã€€ã€€åœ¨ä¹‹å‰çš„FIFOç®—æ³•ä¸­ï¼Œä¾æ®çš„æ˜¯å„ä¸ªé¡µé¢è°ƒå…¥å†…å­˜çš„æ—¶é—´ï¼Œè¿™å¹¶ä¸èƒ½åæ˜ é¡µé¢çš„çœŸå®ä½¿ç”¨æƒ…å†µã€‚è€ŒLRUï¼ˆLatest Recently Usedï¼‰æ˜¯æ ¹æ®é¡µé¢è°ƒå…¥å†…å­˜ä¹‹åçš„ä½¿ç”¨æƒ…å†µã€‚ç”±äºæ— æ³•é¢„æµ‹é¡µé¢æœªæ¥çš„æƒ…å†µï¼Œæ‰€ä»¥åªèƒ½åˆ©ç”¨â€œæœ€è¿‘çš„è¿‡å»â€æ¥ä½œä¸ºé¢„æµ‹æœªæ¥çš„æ–¹æ³•ï¼ŒLRUé€‰æ‹©çš„æ˜¯æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„é¡µé¢äºˆä»¥æ·˜æ±°ã€‚<br>ã€€ã€€è¯¥ç®—æ³•èµ‹äºˆæ¯ä¸ªé¡µé¢ä¸€ä¸ªè®¿é—®å­—æ®µï¼Œç”¨æ¥è®°å½•ä¸€ä¸ªé¡µé¢ä»ä¸Šæ¬¡è¢«è®¿é—®ä»¥æ¥æ‰€ç»å†çš„æ—¶é—´tï¼Œå½“éœ€è¦æ·˜æ±°ä¸€ä¸ªé¡µé¢çš„æ—¶å€™ï¼Œé€‰æ‹©ç°æœ‰é¡µé¢ä¸­tçš„å€¼æœ€å¤§çš„é¡µé¢è¿›è¡Œæ·˜æ±°ã€‚<br>ã€€ã€€LRUæ˜¯ä¸€ç§ä¼˜ç§€çš„é¡µé¢ç½®æ¢ç®—æ³•ï¼Œä½†æ˜¯éœ€è¦ç¡¬ä»¶çš„æ”¯æŒï¼Œä¸ºäº†äº†è§£ä¸€ä¸ªè¿›ç¨‹åœ¨å†…å­˜ä¸­å„ä¸ªé¡µé¢å„æœ‰å¤šå°‘æ—¶é—´æœªè¢«è¿›ç¨‹è®¿é—®ï¼Œä»¥åŠå¦‚ä½•å¿«é€Ÿåœ°çŸ¥é“å“ªä¸€ä¸ªé¡µé¢æ˜¯æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„é¡µé¢ï¼Œéœ€è¦ å¯„å­˜å™¨+æ ˆ æ¥æ”¯æŒã€‚</p></blockquote><h3 id="javaç›¸å…³ï¼š"><a href="#javaç›¸å…³ï¼š" class="headerlink" title="javaç›¸å…³ï¼š"></a>javaç›¸å…³ï¼š</h3><h4 id="synchronized-å’ŒLockçš„åŒºåˆ«-ä»¥åŠå®ç°åŸç†"><a href="#synchronized-å’ŒLockçš„åŒºåˆ«-ä»¥åŠå®ç°åŸç†" class="headerlink" title="synchronized å’ŒLockçš„åŒºåˆ« ä»¥åŠå®ç°åŸç†"></a>synchronized å’ŒLockçš„åŒºåˆ« ä»¥åŠå®ç°åŸç†</h4><blockquote><p>  æ•™ç§‘ä¹¦å¼çš„åº”è¯•å›ç­”ï¼š<br>    ä¸»è¦ç›¸åŒç‚¹ï¼šLockèƒ½å®Œæˆsynchronizedæ‰€å®ç°çš„æ‰€æœ‰åŠŸèƒ½<br>    ä¸»è¦ä¸åŒç‚¹ï¼šLockæœ‰æ¯”synchronizedæ›´ç²¾ç¡®çš„çº¿ç¨‹è¯­ä¹‰å’Œæ›´å¥½çš„æ€§èƒ½ã€‚synchronizedä¼šè‡ªåŠ¨é‡Šæ”¾é”ï¼Œè€ŒLockä¸€å®šè¦æ±‚ç¨‹åºå‘˜æ‰‹å·¥é‡Šæ”¾ï¼Œå¹¶ä¸”å¿…é¡»åœ¨finallyä»å¥ä¸­é‡Šæ”¾ã€‚</p></blockquote><p>| ç±»åˆ« | synchronized | lock |<br>|: - :| :-: | : -: |<br>| å­˜åœ¨å±‚æ¬¡ | Javaçš„å…³é”®å­—ï¼Œåœ¨jvmå±‚é¢ä¸Š | æ˜¯ä¸€ä¸ªç±»|<br>| é”çš„é‡Šæ”¾ | 1ã€ä»¥è·å–é”çš„çº¿ç¨‹æ‰§è¡Œå®ŒåŒæ­¥ä»£ç ï¼Œé‡Šæ”¾é” 2ã€çº¿ç¨‹æ‰§è¡Œå‘ç”Ÿå¼‚å¸¸ï¼Œjvmä¼šè®©çº¿ç¨‹é‡Šæ”¾é”| åœ¨finallyä¸­å¿…é¡»é‡Šæ”¾é”ï¼Œä¸ç„¶å®¹æ˜“é€ æˆçº¿ç¨‹æ­»é” |<br>| é”çš„è·å– | å‡è®¾Açº¿ç¨‹è·å¾—é”ï¼ŒBçº¿ç¨‹ç­‰å¾…ã€‚å¦‚æœAçº¿ç¨‹é˜»å¡ï¼ŒBçº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…| åˆ†æƒ…å†µè€Œå®šï¼ŒLockæœ‰å¤šä¸ªé”è·å–çš„æ–¹å¼ï¼Œå…·ä½“ä¸‹é¢ä¼šè¯´é“ï¼Œå¤§è‡´å°±æ˜¯å¯ä»¥å°è¯•è·å¾—é”ï¼Œçº¿ç¨‹å¯ä»¥ä¸ç”¨ä¸€ç›´ç­‰å¾…|<br>| é”çŠ¶æ€ | æ— æ³•åˆ¤æ–­| å¯ä»¥åˆ¤æ–­|<br>| é”ç±»å‹ | å¯é‡å…¥ ä¸å¯ä¸­æ–­ éå…¬å¹³ | å¯é‡å…¥ å¯åˆ¤æ–­ å¯å…¬å¹³ï¼ˆä¸¤è€…çš†å¯ï¼‰|<br>|æ€§èƒ½ | å°‘é‡åŒæ­¥ | å¤§é‡åŒæ­¥|</p><p>å…³äºåŒæ­¥ç±»(java.util.concurrentåŒ…ä¸‹)çš„ä»‹ç»å¯ä»¥çœ‹è¿™ä¸ª <a href="http://blog.huangyuanlove.com/2018/03/20/Java%E5%B9%B6%E5%8F%91%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5/#more">http://blog.huangyuanlove.com/2018/03/20/Java%E5%B9%B6%E5%8F%91%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5/#more</a><br>å…³äºLockçš„åº•å±‚å®ç°å¯ä»¥çœ‹è¿™ç¯‡ï¼š<a href="https://blog.csdn.net/Luxia_24/article/details/52403033">https://blog.csdn.net/Luxia_24/article/details/52403033</a><br>å…³äºsynchronizedå¯ä»¥çœ‹è¿™ç¯‡ <a href="https://blog.csdn.net/u012403290/article/details/64910926?locationNum=11&amp;fps=1">https://blog.csdn.net/u012403290/article/details/64910926?locationNum=11&amp;fps=1</a></p><h4 id="Mapã€Setã€ListåŒºåˆ«"><a href="#Mapã€Setã€ListåŒºåˆ«" class="headerlink" title="Mapã€Setã€ListåŒºåˆ«"></a>Mapã€Setã€ListåŒºåˆ«</h4><p>è¿™ä¸ªè‡ªå·±ç¿»ä¸€ä¸‹æºç çœ‹ä¸€ä¸‹å°±å¥½<br>Map-&gt; HashMap(å­˜å…¥æ•°æ®çš„è¿‡ç¨‹ï¼Œhashå†²çªäº†æ€ä¹ˆåŠ),TreeMap,LinkedHashMap<br>Set-&gt; ä½¿ç”¨Mapå®ç°çš„ï¼Œsetä¸­å­˜æ”¾çš„æ•°æ®å¯¹åº”mapä¸­çš„keyï¼Œvalueæ˜¯å†…éƒ¨çš„ä¸€ä¸ªobjectå­—æ®µ<br>list-&gt; ArrayList(æ•°ç»„),LinkedList(é“¾è¡¨)åŒºåˆ«ï¼Œä¼˜ç¼ºç‚¹</p><h4 id="Javaè™šæ‹Ÿæœº"><a href="#Javaè™šæ‹Ÿæœº" class="headerlink" title="Javaè™šæ‹Ÿæœº"></a>Javaè™šæ‹Ÿæœº</h4><p>è¿™ä¸ªä¸»è¦æ˜¯é—®å†…å­˜åŒºåŸŸï¼Œåƒåœ¾å›æ”¶ç®—æ³•ï¼Œå¯ä»¥å‚è€ƒè¿™é‡Œï¼š<br>JVM-å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥ <a href="http://blog.huangyuanlove.com/2017/04/07/JVM-%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E4%B8%8E%E5%9B%9E%E6%94%B6%E7%AD%96%E7%95%A5/">http://blog.huangyuanlove.com/2017/04/07/JVM-%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E4%B8%8E%E5%9B%9E%E6%94%B6%E7%AD%96%E7%95%A5/</a><br>JVM-åƒåœ¾æ”¶é›†ç®—æ³•ä¸å®ç°  <a href="http://blog.huangyuanlove.com/2017/03/30/JVM-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95/">http://blog.huangyuanlove.com/2017/03/30/JVM-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95/</a><br>JVMåƒåœ¾å›æ”¶-å¯¹è±¡å·²æ­»ï¼Ÿ <a href="http://blog.huangyuanlove.com/2017/03/29/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6-%E5%AF%B9%E8%B1%A1%E5%B7%B2%E6%AD%BB%EF%BC%9F/">http://blog.huangyuanlove.com/2017/03/29/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6-%E5%AF%B9%E8%B1%A1%E5%B7%B2%E6%AD%BB%EF%BC%9F/</a><br>JVMå†…å­˜åŒºåŸŸ <a href="http://blog.huangyuanlove.com/2017/03/27/JVM%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F/">http://blog.huangyuanlove.com/2017/03/27/JVM%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F/</a></p><h4 id="æ•è·å­çº¿ç¨‹å¼‚å¸¸"><a href="#æ•è·å­çº¿ç¨‹å¼‚å¸¸" class="headerlink" title="æ•è·å­çº¿ç¨‹å¼‚å¸¸"></a>æ•è·å­çº¿ç¨‹å¼‚å¸¸</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>().setUncaughtExceptionHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>.UncaughtExceptionHandler() &#123;<br>           <span class="hljs-meta">@Override</span><br>           <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">uncaughtException</span><span class="hljs-params">(Thread t, Throwable e)</span> &#123;<br>               <br>           &#125;<br>       &#125;);<br>Thread.setDefaultUncaughtExceptionHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>.UncaughtExceptionHandler() &#123;<br>           <span class="hljs-meta">@Override</span><br>           <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">uncaughtException</span><span class="hljs-params">(Thread t, Throwable e)</span> &#123;<br><br>           &#125;<br>       &#125;);<br></code></pre></td></tr></table></figure><p>å¦‚æœä¸€ä¸ªçº¿ç¨‹æ²¡æœ‰æ˜¾å¼çš„è®¾ç½®å®ƒçš„UncaughtExceptionHandlerï¼ŒJVMå°±ä¼šæ£€æŸ¥è¯¥çº¿ç¨‹æ‰€åœ¨çš„çº¿ç¨‹ç»„æ˜¯å¦è®¾ç½®äº†UncaughtExceptionHandlerï¼Œå¦‚æœå·²ç»è®¾ç½®ï¼Œå°±æ˜¯ç”¨è¯¥UncaughtExceptionHandlerï¼›å¦åˆ™æŸ¥çœ‹æ˜¯å¦åœ¨Threadå±‚é¢é€šè¿‡é™æ€æ–¹æ³•setDefaultUncaughtExceptionHandler()è®¾ç½®äº†UncaughtExceptionHandlerï¼Œå¦‚æœå·²ç»è®¾ç½®å°±æ˜¯ç”¨è¯¥UncaughtExceptionHandlerï¼›å¦‚æœä¸Šè¿°éƒ½æ²¡æœ‰æ‰¾åˆ°ï¼ŒJVMä¼šåœ¨å¯¹åº”çš„consoleä¸­æ‰“å°å¼‚å¸¸çš„å †æ ˆä¿¡æ¯ã€‚<br>å…·ä½“æƒ…å†µå¯ä»¥çœ‹ä¸€ä¸‹Javaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯</p><h4 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h4><p>è¿™æ˜¯ä¸ªå¤§å‘ï¼Œçœ‹æºç å§ThreadPoolExecutor.javaï¼Œè¿˜æœ‰å°±æ˜¯å¸¸è§çº¿ç¨‹æ± çš„æ¯”è¾ƒã€‚</p><h4 id="å•ä¾‹æ¨¡å¼-çº¿ç¨‹å®‰å…¨"><a href="#å•ä¾‹æ¨¡å¼-çº¿ç¨‹å®‰å…¨" class="headerlink" title="å•ä¾‹æ¨¡å¼ çº¿ç¨‹å®‰å…¨"></a>å•ä¾‹æ¨¡å¼ çº¿ç¨‹å®‰å…¨</h4><p>å•ä¾‹çš„æ¨¡å¼çš„Nç§å†™æ³•ï¼Œåƒä»€ä¹ˆdouble checkã€æ‡’æ±‰æ¨¡å¼ã€é™æ€å†…éƒ¨ç±»ï¼Œè¿˜æœ‰å°±æ˜¯æšä¸¾æ–¹å¼ã€‚è¿™é‡Œä¼šå¼•å‡ºæ¥<code>volatile</code>å…³é”®å­—ï¼Œç„¶åå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚</p><h3 id="Androidç›¸å…³ï¼š"><a href="#Androidç›¸å…³ï¼š" class="headerlink" title="Androidç›¸å…³ï¼š"></a>Androidç›¸å…³ï¼š</h3><h4 id="å¤šè¿›ç¨‹å†™spçš„é—®é¢˜"><a href="#å¤šè¿›ç¨‹å†™spçš„é—®é¢˜" class="headerlink" title="å¤šè¿›ç¨‹å†™spçš„é—®é¢˜"></a>å¤šè¿›ç¨‹å†™spçš„é—®é¢˜</h4><p>è¿˜æ˜¯çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œå› ä¸ºSPä¸æ”¯æŒä¸¤ä¸ªè¿›ç¨‹åŒäº‹å»æ‰§è¡Œå†™æ“ä½œï¼Œå¦åˆ™ä¼šå¯¼è‡´ä¸€å®šå‡ ç‡çš„æ•°æ®ä¸¢å¤±ï¼Œè¿™æ˜¯å› ä¸ºSPåº•å±‚é€šè¿‡è¯»å†™xmlæ–‡ä»¶æ¥å®ç°çš„ï¼Œå¹¶å‘å†™æ˜¾ç„¶æ˜¯æœ‰é—®é¢˜çš„</p><h4 id="spåº•å±‚å®ç°"><a href="#spåº•å±‚å®ç°" class="headerlink" title="spåº•å±‚å®ç°"></a>spåº•å±‚å®ç°</h4><p>è¯»å†™xmlæ–‡ä»¶</p><h4 id="Activityå’ŒFragmentç”Ÿå‘½å‘¨æœŸ-ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ˜¯è°è°ƒç”¨çš„"><a href="#Activityå’ŒFragmentç”Ÿå‘½å‘¨æœŸ-ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ˜¯è°è°ƒç”¨çš„" class="headerlink" title="Activityå’ŒFragmentç”Ÿå‘½å‘¨æœŸ,ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ˜¯è°è°ƒç”¨çš„"></a>Activityå’ŒFragmentç”Ÿå‘½å‘¨æœŸ,ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ˜¯è°è°ƒç”¨çš„</h4><p>å£°æ˜å‘¨æœŸå‡½æ•°æ˜¯ç”±ActivityThreadè°ƒåº¦çš„ï¼Œå…·ä½“é€»è¾‘å°è£…åœ¨Instrumentationç±»é‡Œé¢ã€‚å…·ä½“è¯»ä¸€ä¸‹è¿™ä¸¤ä¸ªç±»å°±å¥½ã€‚</p><h4 id="Activityå¯åŠ¨æ¨¡å¼ï¼Œå¯åŠ¨è¿‡ç¨‹"><a href="#Activityå¯åŠ¨æ¨¡å¼ï¼Œå¯åŠ¨è¿‡ç¨‹" class="headerlink" title="Activityå¯åŠ¨æ¨¡å¼ï¼Œå¯åŠ¨è¿‡ç¨‹"></a>Activityå¯åŠ¨æ¨¡å¼ï¼Œå¯åŠ¨è¿‡ç¨‹</h4><p>å•ç‹¬å¼€äº†ä¸€ç¯‡åšå®¢<a href="http://blog.huangyuanlove.com/2018/07/26/Activity%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%EF%BC%8C%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B/#more">http://blog.huangyuanlove.com/2018/07/26/Activity%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%EF%BC%8C%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B/#more</a></p><h4 id="Viewç‚¹å‡»äº‹ä»¶åˆ†å‘æµç¨‹"><a href="#Viewç‚¹å‡»äº‹ä»¶åˆ†å‘æµç¨‹" class="headerlink" title="Viewç‚¹å‡»äº‹ä»¶åˆ†å‘æµç¨‹"></a>Viewç‚¹å‡»äº‹ä»¶åˆ†å‘æµç¨‹</h4><p>Viewäº‹ä»¶åˆ†å‘ï¼š<a href="http://blog.huangyuanlove.com/2018/07/29/View%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91/#more">http://blog.huangyuanlove.com/2018/07/29/Viewäº‹ä»¶åˆ†å‘/#more</a></p><h4 id="Viewç»˜åˆ¶è¿‡ç¨‹"><a href="#Viewç»˜åˆ¶è¿‡ç¨‹" class="headerlink" title="Viewç»˜åˆ¶è¿‡ç¨‹"></a>Viewç»˜åˆ¶è¿‡ç¨‹</h4><p>Viewç»˜åˆ¶è¿‡ç¨‹ï¼š<a href="http://blog.huangyuanlove.com//2018/07/29/View%E7%BB%98%E5%88%B6%E8%BF%87%E7%A8%8B/#more">http://blog.huangyuanlove.com//2018/07/29/Viewç»˜åˆ¶è¿‡ç¨‹/#more</a></p><h4 id="Handler"><a href="#Handler" class="headerlink" title="Handler"></a>Handler</h4><p>Androidçš„æ¶ˆæ¯æœºåˆ¶:  <a href="http://blog.huangyuanlove.com/2017/03/23/Android%E7%9A%84%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6/#more">http://blog.huangyuanlove.com/2017/03/23/Android%E7%9A%84%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6/#more</a></p><h4 id="çœç”µä¼˜åŒ–"><a href="#çœç”µä¼˜åŒ–" class="headerlink" title="çœç”µä¼˜åŒ–"></a>çœç”µä¼˜åŒ–</h4><p>ä¸æ‰“æ‰°ç³»ç»Ÿä¼‘çœ ï¼ˆä¸ç›‘å¬ç”µé‡å˜åŒ–ç­‰ï¼Œä¸‰æ–¹çš„å¯ä»¥hook  oop  hookä½oncreatï¼‰<br>ä¸åšä¸å¿…è¦çš„åŠ¨ä½œï¼ˆç•Œé¢åå°è¦åœæ­¢åŠ¨ç”»ï¼‰</p><h4 id="å¹¿æ’­çš„åº•å±‚å®ç°ï¼ˆbinderï¼‰"><a href="#å¹¿æ’­çš„åº•å±‚å®ç°ï¼ˆbinderï¼‰" class="headerlink" title="å¹¿æ’­çš„åº•å±‚å®ç°ï¼ˆbinderï¼‰"></a>å¹¿æ’­çš„åº•å±‚å®ç°ï¼ˆbinderï¼‰</h4><p>Android å¹¿æ’­ ï¼š<a href="http://blog.huangyuanlove.com/2018/07/31/Android%E5%B9%BF%E6%92%AD/">http://blog.huangyuanlove.com/2018/07/31/Android%E5%B9%BF%E6%92%AD/</a></p><h3 id="è®¡ç®—æœºç½‘ç»œç›¸å…³ï¼š"><a href="#è®¡ç®—æœºç½‘ç»œç›¸å…³ï¼š" class="headerlink" title="è®¡ç®—æœºç½‘ç»œç›¸å…³ï¼š"></a>è®¡ç®—æœºç½‘ç»œç›¸å…³ï¼š</h3><h4 id="websocketä¸ºä»€ä¹ˆèƒ½ä¿æŒé•¿è¿æ¥"><a href="#websocketä¸ºä»€ä¹ˆèƒ½ä¿æŒé•¿è¿æ¥" class="headerlink" title="websocketä¸ºä»€ä¹ˆèƒ½ä¿æŒé•¿è¿æ¥"></a>websocketä¸ºä»€ä¹ˆèƒ½ä¿æŒé•¿è¿æ¥</h4><h4 id="httpã€tcp-x2F-udpã€tcpæ€ä¹ˆè§£å†³æ‹¥å¡ã€æ»‘åŠ¨çª—å£ã€udp"><a href="#httpã€tcp-x2F-udpã€tcpæ€ä¹ˆè§£å†³æ‹¥å¡ã€æ»‘åŠ¨çª—å£ã€udp" class="headerlink" title="httpã€tcp&#x2F;udpã€tcpæ€ä¹ˆè§£å†³æ‹¥å¡ã€æ»‘åŠ¨çª—å£ã€udp"></a>httpã€tcp&#x2F;udpã€tcpæ€ä¹ˆè§£å†³æ‹¥å¡ã€æ»‘åŠ¨çª—å£ã€udp</h4><p>è¿™ä¸ªå¯ä»¥çœ‹è°¢å¸Œä»çš„ã€Šè®¡ç®—æœºç½‘ç»œã€‹ç¬¬å…­ç‰ˆï¼Œtcp:<a href="http://blog.huangyuanlove.com/2017/07/03/TCP%E5%8D%8F%E8%AE%AE%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3/#more">http://blog.huangyuanlove.com/2017/07/03/TCP%E5%8D%8F%E8%AE%AE%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3/#more</a> è¿™é‡Œç®€å•çš„è®°å½•äº†ä¸€ä¸‹æ¯”è¾ƒé‡è¦çš„ä¸œè¥¿ã€‚</p><h3 id="å…¶ä»–ï¼š"><a href="#å…¶ä»–ï¼š" class="headerlink" title="å…¶ä»–ï¼š"></a>å…¶ä»–ï¼š</h3><p>åŠ å›ºåŸç† åŠ çš„ä»€ä¹ˆå£³<br>kt var  valåŒºåˆ«  whenä¸­çš„ is  in</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>é¢è¯•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¡¹ç›®é‡æ„è®°å½•</title>
    <link href="/2018/05/24/%E9%A1%B9%E7%9B%AE%E9%87%8D%E6%9E%84%E8%AE%B0%E5%BD%95/"/>
    <url>/2018/05/24/%E9%A1%B9%E7%9B%AE%E9%87%8D%E6%9E%84%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<p>æ€»ç»“ä¸€ä¸‹åœ¨æ–°å…¬å¸ä¸€ä¸ªæœˆæ¥å­¦åˆ°çš„ä¸œè¥¿å§ã€‚å…¬å¸çš„é¡¹ç›®é‡‡ç”¨Native+RNè¿›è¡Œå¼€å‘ï¼Œå‰ä¸¤å‘¨ç®€å•çš„äº†è§£äº†ä¸€ä¸‹é¡¹ç›®ç»“æ„ï¼Œå†™äº†ä¸€äº›è‡ªåŠ¨æ‰“åŒ…çš„è„šæœ¬ã€‚åä¸¤å‘¨å¤§è‡´å­¦ä¹ äº†ä¸€ä¸‹RNï¼Œç„¶åå°±æ˜¯è°ƒæ•´é¡¹ç›®ç»“æ„ï¼Œåšé‡æ„ã€‚</p><span id="more"></span><p>ä¸€äº›ç®€å•çš„è®°å½•ï¼Œ</p><h5 id="éœ€è¦æ³¨æ„çš„åœ°æ–¹"><a href="#éœ€è¦æ³¨æ„çš„åœ°æ–¹" class="headerlink" title="éœ€è¦æ³¨æ„çš„åœ°æ–¹"></a>éœ€è¦æ³¨æ„çš„åœ°æ–¹</h5><ol><li>ä¸»å·¥ç¨‹moduleä¸‹çš„æ’ä»¶æ˜¯ <blockquote><p>apply plugin: â€˜com.android.applicationâ€™</p></blockquote></li></ol><p>libraryä¸­çš„æ’ä»¶æ˜¯</p><blockquote><p>apply plugin: â€˜com.android.libraryâ€™</p></blockquote><ol start="2"><li><p>åœ¨library moduleä¸­ï¼Œç”Ÿæˆçš„Ræ–‡ä»¶ä¸­çš„å˜é‡æ²¡æœ‰è¢«finalä¿®é¥°ï¼Œæ‰€ä»¥åœ¨<code>switch case</code>ä¸­éœ€è¦æ”¹ä¸€ä¸‹å†™æ³•ï¼Œæ¯”å¦‚æ”¹æˆ<code>if else</code>ã€‚</p></li><li><p>ButterKnifeä¸­æ³¨è§£@bindä¸­è¦æ±‚å‚æ•°æ˜¯finalç±»å‹ï¼Œæ‰€ä»¥åœ¨libraryä¸­è¿™ä¸ªæ³¨è§£ä¹Ÿä¸å¥½ç”¨ï¼Œä½œè€…ç»™å‡ºäº†è§£å†³æ–¹æ¡ˆã€‚</p></li><li><p>library moduleä¸­ä¸èƒ½æœ‰applicationIdã€‚</p></li></ol><h5 id="æ”¹åŠ¨è®°å½•"><a href="#æ”¹åŠ¨è®°å½•" class="headerlink" title="æ”¹åŠ¨è®°å½•"></a>æ”¹åŠ¨è®°å½•</h5><p>æ¶‰åŠåˆ°æºä»£ç çš„éƒ¨åˆ†æ²¡æœ‰å…¬å¼€ã€‚</p><ol><li>å°†åŸé¡¹ç›®ä¸­æ‰€æœ‰libraryä¾èµ–ç§»åŠ¨åˆ°<code>BaseApp</code>æ–‡ä»¶å¤¹ä¸‹,ç»Ÿä¸€ç”±ä¸€ä¸ªgitå­æ¨¡å—å¼•ç”¨ã€‚ï¼Œæ‰€ä»¥éœ€è¦åœ¨å·¥ç¨‹æ ¹ç›®å½•ä¸‹çš„<code>setting.gradle</code>ä¸­ä¿®æ”¹<code>include</code>è·¯å¾„<blockquote><p>include  â€˜:baseâ€™</p></blockquote></li></ol><p>æ”¹ä¸º</p><blockquote><p>include  â€˜:BaseApp:baseâ€™</p></blockquote><p>libraryä¸­ä¾èµ–çš„å…¶ä»–libraryä¹Ÿéœ€è¦åšä¿®æ”¹(è·¯å¾„å‰æ·»åŠ <code>:BaseApp</code> )ï¼Œå¦‚<code>RiskControlSdk</code>ä¸­<code>dependencies</code>ä¸­</p><blockquote><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs groovy">releaseCompile project(<span class="hljs-attr">path:</span> <span class="hljs-string">&#x27;BaseComponents&#x27;</span>, <span class="hljs-attr">configuration:</span> <span class="hljs-string">&#x27;release&#x27;</span>)<br>debugCompile project(<span class="hljs-attr">path:</span> <span class="hljs-string">&#x27;:BaseComponents&#x27;</span>, <span class="hljs-attr">configuration:</span> <span class="hljs-string">&#x27;debug&#x27;</span>)<br></code></pre></td></tr></table></figure></blockquote><p>æ”¹ä¸º</p><blockquote><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs groovy">releaseCompile project(<span class="hljs-attr">path:</span> <span class="hljs-string">&#x27;:BaseApp:BaseComponents&#x27;</span>, <span class="hljs-attr">configuration:</span> <span class="hljs-string">&#x27;release&#x27;</span>)<br>debugCompile project(<span class="hljs-attr">path:</span> <span class="hljs-string">&#x27;:BaseApp:BaseComponents&#x27;</span>, <span class="hljs-attr">configuration:</span> <span class="hljs-string">&#x27;debug&#x27;</span>)<br></code></pre></td></tr></table></figure></blockquote><ol start="2"><li><p>åŸapp module(ç°base)ä¸­ç”¨åˆ°<code>butterknife</code>ï¼Œåœ¨@bindæ³¨è§£è¦æ±‚å‚æ•°æ˜¯finalç±»å‹ï¼Œä½†æ˜¯åœ¨libraryé¡¹ç›®ä¸­ï¼Œç”Ÿæˆçš„Ræ–‡ä»¶ä¸­çš„idä¸æ˜¯finalã€‚<br><code>butterknife</code>ä½œè€…ç»™å‡ºç±»è§£å†³åŠæ³•:å‡çº§<code>butterknife</code>åˆ°8.8.1ï¼Œåœ¨libraryä¸­çš„<code>build.gradle</code>æ·»åŠ <code>apply plugin: &#39;com.jakewharton.butterknife&#39;</code>æ’ä»¶ï¼Œç”¨äºç”Ÿæˆ<code>R2</code>æ–‡ä»¶ï¼Œå°†åŸæ¥çš„<code>R.id.xxx</code>æ”¹ä¸º<code>R2.id.xxx</code>ã€‚åŒç†ï¼Œåœ¨<code>switch case</code>ä¸­ç”¨R.idçš„åœ°æ–¹ä¹Ÿè¦åšç›¸åº”ä¿®æ”¹ã€‚å‚è€ƒ <a href="https://github.com/JakeWharton/butterknife">https://github.com/JakeWharton/butterknife</a></p></li><li><p>å°†gradleä¾èµ–ã€æŸäº›appkeyåœ¨æ ¹ç›®å½•ä¸‹çš„<code>config.gradle</code>ä¸­é…ç½®<br>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»º<code>config.gradle</code>æ–‡ä»¶ï¼Œç”¨æ¥å­˜æ”¾å…¬å…±é…ç½®ï¼Œå¦‚</p></li></ol><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs groovy">ext &#123;<br>url = <span class="hljs-string">&quot;https://test.test.com&quot;</span><br>UMENG_APPKEY = <span class="hljs-string">&quot;*****&quot;</span><br>UMENG_MESSAGE_SECRET = <span class="hljs-string">&quot;*******&quot;</span><br>WEIXIN_APP_ID = <span class="hljs-string">&quot;******&quot;</span><br>WEIXIN_APP_SECRET = <span class="hljs-string">&quot;********&quot;</span><br>android = [<br><span class="hljs-symbol">compileSdkVersion:</span> <span class="hljs-number">25</span>,<br><span class="hljs-symbol">buildToolsVersion:</span> <span class="hljs-string">&quot;25.0.2&quot;</span>,<br><span class="hljs-attr">applicationId    :</span> <span class="hljs-string">&quot;xxxxx&quot;</span>,<br><span class="hljs-attr">minSdkVersion    :</span> <span class="hljs-number">16</span>,<br><span class="hljs-attr">targetSdkVersion :</span> <span class="hljs-number">22</span>,<br><span class="hljs-attr">versionCode      :</span> <span class="hljs-number">120</span>,<br><span class="hljs-attr">versionName      :</span> <span class="hljs-string">&quot;1.2.0&quot;</span>,<br>]<br>dependencies = [<br><span class="hljs-string">&quot;appcompat-v7&quot;</span>                : <span class="hljs-string">&quot;com.android.support:appcompat-v7:25.0.0&quot;</span>,<br><span class="hljs-string">&quot;support-v4&quot;</span>                  : <span class="hljs-string">&#x27;com.android.support:support-v4:25.0.0&#x27;</span>,<br><span class="hljs-string">&quot;support-v13&quot;</span>                 : <span class="hljs-string">&#x27;com.android.support:support-v13:23.4.0&#x27;</span>,<br><span class="hljs-string">&quot;support-annotations&quot;</span>         : <span class="hljs-string">&#x27;com.android.support:support-annotations:23.4.0&#x27;</span>,<br><span class="hljs-string">&quot;butterknife&quot;</span>                 : <span class="hljs-string">&quot;com.jakewharton:butterknife:8.8.1&quot;</span>,<br><span class="hljs-string">&quot;xutils&quot;</span>                      : <span class="hljs-string">&#x27;org.xutils:xutils:3.5.0&#x27;</span>,<br><span class="hljs-string">&quot;junit&quot;</span>                       : <span class="hljs-string">&#x27;junit:junit:4.12&#x27;</span>,<br><span class="hljs-string">&quot;react-native&quot;</span>                : <span class="hljs-string">&quot;com.facebook.react:react-native:0.49.5&quot;</span>,<br><span class="hljs-string">&quot;subsampling-scale-image-view&quot;</span>: <span class="hljs-string">&#x27;com.davemorrissey.labs:subsampling-scale-image-view:3.5.0&#x27;</span>,<br><span class="hljs-string">&quot;eventbus&quot;</span>                    : <span class="hljs-string">&#x27;de.greenrobot:eventbus:2.4.0&#x27;</span>,<br><span class="hljs-string">&quot;okio&quot;</span>                        : <span class="hljs-string">&#x27;com.squareup.okio:okio:1.8.0&#x27;</span>,<br><span class="hljs-string">&quot;universal-image-loader&quot;</span>      : <span class="hljs-string">&#x27;com.nostra13.universalimageloader:universal-image-loader:1.9.5&#x27;</span>,<br><span class="hljs-string">&quot;multidex&quot;</span>                    : <span class="hljs-string">&#x27;com.android.support:multidex:1.0.1&#x27;</span>,<br><span class="hljs-string">&quot;nohttp&quot;</span>:<span class="hljs-string">&#x27;com.yanzhenjie.nohttp:nohttp:1.1.4&#x27;</span>,<br>]<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ—¶æ³¨æ„äº‹é¡¹ï¼š</p><ol><li>ç°åœ¨libraryä¸­çš„æ‰€æœ‰appkey(ä¸‰æ–¹)ç›¸å…³çš„ï¼Œéƒ½ç”±å·¥ç¨‹æ ¹ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶<code>config.gradle</code>æä¾›ï¼Œç„¶åæ·»åŠ åˆ°è¯¥moduleçš„<code>BuildConfig.java</code>æ–‡ä»¶ä¸­ï¼Œä»£ç ä¸­ä»<code>BuildConfig.java</code>æ–‡ä»¶ä¸­å¼•ç”¨</li></ol><p>åœ¨<code>config.gradle</code>æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªä¸‰æ–¹keyå€¼ </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs groovy">ext&#123;<br>UMENG_APPKEY = <span class="hljs-string">&quot;************&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨moduleä¸­çš„<code>build.grale</code>å¼•ç”¨</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> UMENG_APPKEY = rootProject.ext.UMENG_APPKEY<br></code></pre></td></tr></table></figure><p>åŠ å…¥åˆ°è¯¥moduleçš„<code>BuildConfig.java</code>æ–‡ä»¶</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs groovy">defaultConfig&#123;<br>buildConfigField <span class="hljs-string">&quot;String&quot;</span>, <span class="hljs-string">&quot;umeng_analytics_key&quot;</span>, <span class="hljs-string">&quot;\&quot;&quot;</span> + UMENG_APPKEY + <span class="hljs-string">&quot;\&quot;&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä»£ç ä¸­å¼•ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">BuildConfig.umeng_analytics_key<br></code></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œimportè¯¥æ–‡ä»¶çš„æ—¶å€™ï¼Œæ˜¯ä»è¯¥moduleçš„<code>manifest.xml</code>ä¸­çš„è·Ÿæ ‡ç­¾çš„<code>package</code>å±æ€§æ‰€æŒ‡å‘çš„åŒ…åå¯¼å…¥çš„ï¼Œå¦‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">manifest</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">package</span>=<span class="hljs-string">&quot;com.huangyuanlove.test&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åˆ™<code>BuildConfig.java</code>æ–‡ä»¶çš„å¯¼å…¥è·¯å¾„ä¸º <code>import com.huangyuanlove.test;</code><br>2. æ‰€æœ‰ä½¿ç”¨gradleä¾èµ–çš„ä¸‰æ–¹å…¨éƒ¨æ”¾åœ¨æ ¹ç›®å½•çš„<code>config.gradle</code>æ–‡ä»¶å¤¹ä¸‹ï¼Œå…¶ä»–moduleå¼•ç”¨æ—¶å¯å‚è€ƒä¸‹é¢çš„é…ç½®ã€‚å¦‚</p><p>éœ€è¦æ·»åŠ ä¸€ä¸ªæ–°çš„ä¾èµ–ï¼Œåœ¨æ ¹ç›®å½•ä¸‹çš„ <code>config.gradle</code>æ–‡ä»¶ä¸­</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy">ext&#123;<br>dependencies=[<br><span class="hljs-string">&quot;newDependency&quot;</span>:<span class="hljs-string">&quot;dependency&quot;</span>,<br>]<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨å…¶ä»–moduleä¸­å¼•ç”¨</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> dependency = rootProject.ext.dependencies<br>dependencies &#123;<br>compile dependency[<span class="hljs-string">&quot;newDependency&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç½‘ç«™å…è´¹å‡çº§https</title>
    <link href="/2018/04/01/%E7%BD%91%E7%AB%99%E5%85%8D%E8%B4%B9%E5%8D%87%E7%BA%A7https/"/>
    <url>/2018/04/01/%E7%BD%91%E7%AB%99%E5%85%8D%E8%B4%B9%E5%8D%87%E7%BA%A7https/</url>
    
    <content type="html"><![CDATA[<p>æ˜¨å¤©è·Ÿç€é…·å£³ç½‘å·¦è€³æœµè€—å­çš„æ–‡ç« æŠŠè‡ªå·±åœ¨äºšé©¬é€Šä¸»æœºä¸Šçš„ç½‘ç«™å˜æˆhttpsçš„å®‰å…¨è®¿é—®äº†ï¼Œè¯ä¹¦ä¸æ˜¯è‡ªç­¾åçš„ï¼Œä¹Ÿä¸æ˜¯èŠ±é’±è´­ä¹°çš„ã€‚æ®è¯´httpsçš„ç½‘ç«™åœ¨æœç´¢å¼•æ“ä¸­çš„rankå€¼ä¼šæ¯”httpçš„æ›´é«˜ä¸€äº›ã€‚å‡çº§å®Œæˆåçš„æµè§ˆå™¨æˆªå›¾å¦‚ä¸‹ï¼š<br><img src="/image/https/https1.png" alt="æµè§ˆå™¨"><br>ä¸‹é¢æ˜¯è¿™æ¬¡å‡çº§çš„è®°å½•ã€‚</p><span id="more"></span><p>ä¸ºç½‘ç«™å¼€å¯httpså®‰è£…è¯ä¹¦éå¸¸ç®€å•ï¼Œæˆ‘ç”¨çš„æ˜¯ <a href="https://letsencrypt.org/">Letâ€™s Encrypt </a>è¿™ä¸ªå…è´¹çš„è§£å†³æ–¹æ¡ˆã€‚</p><ol><li>æ‰“å¼€<a href="https://certbot.eff.org/">https://certbot.eff.org/</a>è¿™ä¸ªç½‘é¡µ</li><li>åœ¨Software å’Œ Systemé€‰é¡¹é‡Œé¢é€‰æ‹©ä½ æ‰€ä½¿ç”¨çš„è½¯ä»¶ã€ç³»ç»Ÿï¼Œæˆ‘ç”¨çš„nginx+ubuntu16.04<br> <img src="/image/https/https4.png" alt="ç½‘ç«™æˆªå›¾"></li><li>ç„¶åä¼šè·³è½¬åˆ°ä¸€ä¸ªæ–°çš„ç½‘é¡µï¼Œç…§ç€åšå°±æ˜¯äº†ã€‚<br>å°±ä»¥nginx+ubuntu16.04ä¸ºä¾‹ï¼š<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt-get update</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt-get install software-properties-common</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo add-apt-repository ppa:certbot/certbot</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt-get update</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt-get install python-certbot-nginx</span> <br></code></pre></td></tr></table></figure>å®‰è£…æˆåŠŸåæ‰§è¡Œ <code>$ sudo certbot --nginx</code><br>è®©ä½ è¾“å…¥ä½ çš„é‚®ç®±ï¼Œç„¶åæ˜¯åŒæ„ç”¨æˆ·åè®®ï¼Œç„¶åæ˜¯æ˜¯å¦å…¬å¼€ä½ çš„é‚®ç®±ã€‚<br> <img src="/image/https/https2.png" alt="é‚®ç®±ã€ç”¨æˆ·åè®®"><br>æ¥ç€ä¼šåˆ—å‡ºæ¥nginxä¸‹æ‰€æœ‰é…ç½®çš„æœåŠ¡åç§°ï¼Œè¾“å…¥ä½ æƒ³è¦å¼€å¯httpsçš„æœåŠ¡åç§°æ‰€å¯¹åº”çš„ç¼–å·ï¼Œå¦‚æœæƒ³ä¸ºå¤šä¸ªæœåŠ¡å¼€å¯httpsï¼Œä¸­é—´ä»¥ç©ºæ ¼åˆ†éš”ã€‚ç„¶ånginxé‡æ–°åŠ è½½ä¸€ä¸ªé…ç½®æˆ–è€…é‡å¯ä¸€ä¸‹ã€‚<br><img src="/image/https/https3.png" alt="å¼€å¯httpsçš„æœåŠ¡åç§°"><br>æˆ‘ä¸ªäººæœåŠ¡å™¨ä¸Šçš„nginxé…ç½®çš„<code>server_name</code>æ˜¯<code>tomcat.huangyuanlove.com</code>,åŸŸåæ˜¯åœ¨ä¸‡ç½‘ä¹°çš„ï¼Œç„¶ååœ¨ä¸‡ç½‘æ§åˆ¶å°æ·»åŠ ä¸€ä¸ªAè§£æï¼ŒæŠŠ<code>tomcat.huangyuanlove.com</code>æŒ‡å‘æœåŠ¡å™¨çš„ipå³å¯ã€‚<br>ä½†æ˜¯ <strong>Letâ€™s Encrypt çš„è¯ä¹¦90å¤©å°±è¿‡æœŸäº†</strong>ã€‚æ‰€ä»¥è¿˜éœ€è¦åŠ ä¸Šè‡ªåŠ¨æ›´æ–°ï¼Œä½¿ç”¨<code>crontab -e</code>å‘½ä»¤å‡å¦‚å¦‚ä¸‹çš„å®šæ—¶ä½œä¸š(æ¯ä¸ªæœˆå¼ºåˆ¶æ›´æ–°ä¸€ä¸‹)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sehll">0 0 1 * * /usr/bin/certbot renew --force-renewal<br>5 0 1 * * /usr/sbin/service nginx restart<br></code></pre></td></tr></table></figure>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœç½‘ç«™ä¸­æœ‰ä½¿ç”¨httpçš„åœ°æ–¹éƒ½è¦æ”¹æˆhttps,è¦ä¸ç„¶ä¸€äº›èµ„æºæ–‡ä»¶å¦‚å›¾ç‰‡ã€jsã€cssç­‰éhttpsçš„è¯·æ±‚è¿æ¥éƒ½ä¼šè¢«banæ‰ã€‚</li></ol><hr><p>å…³äºubuntuå®‰è£…å’Œé…ç½®nginxï¼Œæˆ‘ä¹Ÿæ˜¯åœ¨å®˜ç½‘æ‰¾çš„æ•™ç¨‹ï¼Œç½‘å€åœ¨è¿™é‡Œ<a href="https://www.nginx.com/resources/wiki/start/index.html">https://www.nginx.com/resources/wiki/start/index.html</a>,å°±çŸ¥é“ä½ ä»¬ä¸æƒ³çœ‹ï¼Œå®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get update<br>sudo apt-get install nginx<br></code></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆåï¼Œnginxé…ç½®æ–‡ä»¶åœ¨<code>/etc/nginx/nginx.conf</code>,åœ¨httpæ ‡ç­¾ä¸­æ·»åŠ serverï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs configuration">server&#123;<br>        listen    80;<br>        server_name    localhost;<br>        location / &#123;<br>            root    html;<br>            index index.html index.htm;<br>        &#125;<br>        error_page 500 502 503 504 /50x.html;<br>        location = /50x.html&#123;<br>            root    html;<br>        &#125;<br>&#125;<br>server&#123;<br>        server_name    tomcat.huangyuanlove.com;<br>        location / &#123;<br>            proxy_pass http://xxx.xxx.xxx/;<br>        &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»™è‡ªå·±çš„æ·»åŠ httpsè¯ä¹¦åï¼Œ<code>Certbot</code>ä¼šä¿®æ”¹ä½ çš„nginxä¸­çš„serveré…ç½®ï¼Œä¿®æ”¹çš„å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">listen <span class="hljs-number">443</span> ssl https2; <span class="hljs-comment"># managed by Certbot</span><br>   ssl_certificate <span class="hljs-regexp">/etc/</span>letsencrypt<span class="hljs-regexp">/live/</span>tomcat.huangyuanlove.com/fullchain.pem; <span class="hljs-comment"># managed by Certbot</span><br>   ssl_certificate_key <span class="hljs-regexp">/etc/</span>letsencrypt<span class="hljs-regexp">/live/</span>tomcat.huangyuanlove.com/privkey.pem; <span class="hljs-comment"># managed by Certbot</span><br>   include <span class="hljs-regexp">/etc/</span>letsencrypt/options-ssl-nginx.conf; <span class="hljs-comment"># managed by Certbot</span><br>   ssl_dhparam <span class="hljs-regexp">/etc/</span>letsencrypt/ssl-dhparams.pem; <span class="hljs-comment"># managed by Certbot</span><br></code></pre></td></tr></table></figure><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs perl">server&#123;<br>    <span class="hljs-keyword">if</span> ($host = tomcat.huangyuanlove.com) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">301</span> https:<span class="hljs-regexp">//</span>$host$request_uri;<br>    &#125; <span class="hljs-comment"># managed by Certbot</span><br>    <span class="hljs-keyword">listen</span>    <span class="hljs-number">80</span>;<br>    server_name    tomcat.huangyuanlove.com;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">404</span>; <span class="hljs-comment"># managed by Certbot</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åŸºæœ¬ä¸Šå°±æ˜¯è¿™æ ·äº†ï¼Œæ²¡æœ‰åˆ«çš„äº†ã€‚</p><hr><p>ä»¥ä¸Šï¼Œå—¯ï¼Œå¯¹äº†ï¼Œ12306ä½ ä»€ä¹ˆæ—¶å€™æŒ‰ç…§è¿™ä¸ªæ•™ç¨‹åšä¸€ä¸‹ä½ çš„è¯ä¹¦ï¼Ÿ</p>]]></content>
    
    
    
    <tags>
      
      <tag>ä¹±ä¸ƒå…«ç³Ÿ</tag>
      
      <tag>ç½‘ç«™https</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaå¹¶å‘å¤šçº¿ç¨‹åŒæ­¥</title>
    <link href="/2018/03/20/Java%E5%B9%B6%E5%8F%91%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5/"/>
    <url>/2018/03/20/Java%E5%B9%B6%E5%8F%91%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘é‡åˆ°äº†å¤šçº¿ç¨‹å¹¶å‘åŒæ­¥é—®é¢˜ï¼Œæ‰¾åˆ°äº†<code>java.util.concurrent</code>åŒ…ä¸‹çš„<code>CountDownLatch</code>ã€<code>CyclicBarrier</code>ã€<code>Semaphore</code>è¿™ä¸‰ä¸ªç±»ã€‚<br><code>CountDownLatch</code>å¯ä»¥å®ç°ç±»ä¼¼è®¡æ•°å™¨çš„åŠŸèƒ½ï¼Œä¾‹å¦‚çº¿ç¨‹Aéœ€è¦ç­‰å¾…Bã€Cã€Dä¸‰ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆä¹‹åæ‰å¯ä»¥æ‰§è¡Œã€‚<br><code>CyclicBarrier</code>å¯ä»¥å®ç°è®©ä¸€ç»„(å¤šä¸ª)çº¿ç¨‹ç­‰å¾…è‡³æŸä¸ªçŠ¶æ€ä¹‹åå†å…¨éƒ¨åŒæ—¶æ‰§è¡Œï¼Œå½“æ‰€æœ‰çº¿ç¨‹éƒ½è¢«é‡Šæ”¾ä»¥åï¼ŒCyclicBarrierå¯ä»¥è¢«é‡ç”¨ã€‚<br><code>Semaphore</code>å¯ä»¥æ§åˆ¶åŒæ—¶è®¿é—®çš„çº¿ç¨‹ä¸ªæ•°ï¼Œé€šè¿‡<code>acquire()</code>è·å–ä¸€ä¸ªè®¸å¯ï¼Œå¦‚æœæ²¡æœ‰å°±ç­‰å¾…ï¼Œè€Œ<code>release()</code>é‡Šæ”¾ä¸€ä¸ªè®¸å¯ã€‚</p><span id="more"></span><h4 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a>CountDownLatch</h4><p>CountDownLatchç±»åªæœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">CountDownLatch</span><span class="hljs-params">(<span class="hljs-type">int</span> count)</span> &#123;<br>        <span class="hljs-keyword">if</span> (count &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;count &lt; 0&quot;</span>);<br>        <span class="hljs-built_in">this</span>.sync = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sync</span>(count);<br>    &#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„countæ˜¯ä¸€ä¸ªè®¡æ•°å€¼ï¼Œè¡¨ç¤ºè¦ç­‰å¾…å¤šå°‘ä»»åŠ¡ï¼Œæ¯æ¬¡è°ƒç”¨è¯¥å¯¹è±¡ç¤ºä¾‹çš„<code>countDown()</code>æ–¹æ³•ï¼Œè¯¥å€¼éƒ½ä¼šå‡1ï¼Œå½“countä¸º0æ—¶è¡¨ç¤ºæ²¡æœ‰éœ€è¦ç­‰å¾…çš„ä»»åŠ¡ã€‚å¸¸ç”¨çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">await</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123; &#125;;   <span class="hljs-comment">//è°ƒç”¨await()æ–¹æ³•çš„çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œå®ƒä¼šç­‰å¾…ç›´åˆ°countå€¼ä¸º0æ‰ç»§ç»­æ‰§è¡Œ</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">await</span><span class="hljs-params">(<span class="hljs-type">long</span> timeout, TimeUnit unit)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123; &#125;;  <span class="hljs-comment">//å’Œawait()ç±»ä¼¼ï¼Œåªä¸è¿‡ç­‰å¾…ä¸€å®šçš„æ—¶é—´åcountå€¼è¿˜æ²¡å˜ä¸º0çš„è¯å°±ä¼šç»§ç»­æ‰§è¡Œ</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">countDown</span><span class="hljs-params">()</span> &#123; &#125;;  <span class="hljs-comment">//å°†countå€¼å‡1</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCountDownLatch</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">final</span> <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">latch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">2</span>);<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-string">&quot;one&quot;</span>) &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">try</span> &#123;<br>System.out.println(<span class="hljs-string">&quot;å­çº¿ç¨‹&quot;</span> + Thread.currentThread().getName() + <span class="hljs-string">&quot;æ­£åœ¨æ‰§è¡Œ&quot;</span>);<br>Thread.sleep(<span class="hljs-number">3000</span>);<br>System.out.println(<span class="hljs-string">&quot;å­çº¿ç¨‹&quot;</span> + Thread.currentThread().getName() + <span class="hljs-string">&quot;æ‰§è¡Œå®Œæ¯•&quot;</span>);<br>latch.countDown();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>&#125;;<br>&#125;.start();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-string">&quot;two&quot;</span>) &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">try</span> &#123;<br>System.out.println(<span class="hljs-string">&quot;å­çº¿ç¨‹&quot;</span> + Thread.currentThread().getName() + <span class="hljs-string">&quot;æ­£åœ¨æ‰§è¡Œ&quot;</span>);<br>Thread.sleep(<span class="hljs-number">3000</span>);<br>System.out.println(<span class="hljs-string">&quot;å­çº¿ç¨‹&quot;</span> + Thread.currentThread().getName() + <span class="hljs-string">&quot;æ‰§è¡Œå®Œæ¯•&quot;</span>);<br>latch.countDown();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>&#125;;<br>&#125;.start();<br><br><span class="hljs-keyword">try</span> &#123;<br>System.out.println(<span class="hljs-string">&quot;ç­‰å¾…2ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆ&quot;</span>);<br>latch.await();<br>System.out.println(<span class="hljs-string">&quot;å­çº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯•&quot;</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="CyclicBarrier"><a href="#CyclicBarrier" class="headerlink" title="CyclicBarrier"></a>CyclicBarrier</h4><p>è¯¥ç±»æœ‰ä¸¤ä¸ªæ„é€ æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">CyclicBarrier</span><span class="hljs-params">(<span class="hljs-type">int</span> parties, Runnable barrierAction)</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">CyclicBarrier</span><span class="hljs-params">(<span class="hljs-type">int</span> parties)</span><br></code></pre></td></tr></table></figure><p>å‚æ•°partiesæ˜¯æŒ‡è®©å¤šå°‘ä¸ªçº¿ç¨‹æˆ–è€…ä»»åŠ¡ç­‰å¾…è‡³barrierçŠ¶æ€ï¼Œå‚æ•°barrierActionæ˜¯å½“è¿™äº›çº¿ç¨‹éƒ½åˆ°è¾¾barrierçŠ¶æ€åä¼šæ‰§è¡Œçš„å†…å®¹ã€‚<br>è¯¥ç±»é‡Œé¢æœ‰ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">await</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException, BrokenBarrierException &#123; &#125;;<br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">await</span><span class="hljs-params">(<span class="hljs-type">long</span> timeout, TimeUnit unit)</span><span class="hljs-keyword">throws</span> InterruptedException,BrokenBarrierException,TimeoutException &#123; &#125;;<br></code></pre></td></tr></table></figure><p>æ— å‚çš„æ–¹æ³•æ¯”è¾ƒå¸¸ç”¨ï¼Œç”¨æ¥æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°æ‰€æœ‰çº¿ç¨‹éƒ½è¾¾åˆ°barrierçŠ¶æ€å†åŒæ—¶æ‰§è¡Œåç»­ä»»åŠ¡ã€‚<br>æœ‰å‚çš„æ–¹æ³•æ˜¯è®©çº¿ç¨‹ç­‰å¾…ä¸€å®šæ—¶é—´ï¼Œå¦‚æœçº¿ç¨‹è¿˜æ²¡æœ‰è¾¾åˆ°barrierçŠ¶æ€ï¼Œå°±è®©åˆ°è¾¾barrierçŠ¶æ€çš„çº¿ç¨‹æ‰§è¡Œåç»­ä»»åŠ¡ã€‚<br>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCyclicBarrier</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-comment">//CyclicBarrier barrier = new CyclicBarrier(5);</span><br><span class="hljs-type">CyclicBarrier</span> <span class="hljs-variable">barrier</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CyclicBarrier</span>(<span class="hljs-number">5</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>System.out.println(<span class="hljs-string">&quot;æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼ŒéšæœºæŒ‘é€‰ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ‰“å°&quot;</span>);<br>System.out.println(<span class="hljs-string">&quot;æŒ‘é€‰çš„çº¿ç¨‹ä¸º&quot;</span> + Thread.currentThread().getName());<br><br>&#125;<br>&#125;);<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Writer</span>(barrier, <span class="hljs-string">&quot;thread:&quot;</span> + i).start();<br>&#125;<br><br>&#125;<br><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Writer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> &#123;<br><span class="hljs-keyword">private</span> CyclicBarrier cyclicBarrier;<br><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">Writer</span><span class="hljs-params">(CyclicBarrier cyclicBarrier, String threadName)</span> &#123;<br><span class="hljs-built_in">this</span>.cyclicBarrier = cyclicBarrier;<br><span class="hljs-keyword">if</span> (threadName != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-built_in">this</span>.setName(threadName);<br>&#125;<br><br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br><br><span class="hljs-keyword">try</span> &#123;<br>System.out.println(<span class="hljs-string">&quot;çº¿ç¨‹&quot;</span> + Thread.currentThread().getName() + <span class="hljs-string">&quot;æ­£åœ¨ä½œä¸šä¸­&quot;</span>);<br>Thread.sleep(<span class="hljs-number">5000</span>);<br>System.out.println(<span class="hljs-string">&quot;çº¿ç¨‹&quot;</span> + Thread.currentThread().getName() + <span class="hljs-string">&quot;ä½œä¸šå®Œæˆ&quot;</span>);<br>cyclicBarrier.await();<br>System.out.println(<span class="hljs-string">&quot;æ‰€æœ‰çº¿ç¨‹ä½œä¸šå®Œæ¯•ï¼Œçº¿ç¨‹&quot;</span> + Thread.currentThread().getName() + <span class="hljs-string">&quot;ç»§ç»­ç†å…¶ä»–ä»»åŠ¡&quot;</span>);<br><br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125; <span class="hljs-keyword">catch</span> (BrokenBarrierException e) &#123;<br><br>e.printStackTrace();<br>&#125;<br><br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒCyclicBarrieræ˜¯å¯ä»¥<strong>é‡ç”¨</strong>çš„ã€‚</p><h4 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a>Semaphore</h4><p>è¯¥ç±»æä¾›äº†ä¸¤ä¸ªæ„é€ å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">Semaphore</span><span class="hljs-params">(<span class="hljs-type">int</span> permits)</span> &#123;          <span class="hljs-comment">//å‚æ•°permitsè¡¨ç¤ºè®¸å¯æ•°ç›®ï¼Œå³åŒæ—¶å¯ä»¥å…è®¸å¤šå°‘çº¿ç¨‹è¿›è¡Œè®¿é—®</span><br>    sync = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NonfairSync</span>(permits);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-title function_">Semaphore</span><span class="hljs-params">(<span class="hljs-type">int</span> permits, <span class="hljs-type">boolean</span> fair)</span> &#123;    <span class="hljs-comment">//è¿™ä¸ªå¤šäº†ä¸€ä¸ªå‚æ•°fairè¡¨ç¤ºæ˜¯å¦æ˜¯å…¬å¹³çš„ï¼Œå³ç­‰å¾…æ—¶é—´è¶Šä¹…çš„è¶Šå…ˆè·å–è®¸å¯</span><br>    sync = (fair)? <span class="hljs-keyword">new</span> <span class="hljs-title class_">FairSync</span>(permits) : <span class="hljs-keyword">new</span> <span class="hljs-title class_">NonfairSync</span>(permits);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯è¯¥ç±»ä¸­æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªæ–¹æ³•ï¼Œé¦–å…ˆæ˜¯acquire()ã€release()ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acquire</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;  &#125;     <span class="hljs-comment">//è·å–ä¸€ä¸ªè®¸å¯</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acquire</span><span class="hljs-params">(<span class="hljs-type">int</span> permits)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123; &#125;    <span class="hljs-comment">//è·å–permitsä¸ªè®¸å¯</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">release</span><span class="hljs-params">()</span> &#123; &#125;          <span class="hljs-comment">//é‡Šæ”¾ä¸€ä¸ªè®¸å¯</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">release</span><span class="hljs-params">(<span class="hljs-type">int</span> permits)</span> &#123; &#125;    <span class="hljs-comment">//é‡Šæ”¾permitsä¸ªè®¸å¯</span><br></code></pre></td></tr></table></figure><p>acquire()ç”¨æ¥è·å–ä¸€ä¸ªè®¸å¯ï¼Œè‹¥æ— è®¸å¯èƒ½å¤Ÿè·å¾—ï¼Œåˆ™ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°è·å¾—è®¸å¯ã€‚<br>release()ç”¨æ¥é‡Šæ”¾è®¸å¯ã€‚æ³¨æ„ï¼Œåœ¨é‡Šæ”¾è®¸å¯ä¹‹å‰ï¼Œå¿…é¡»å…ˆè·è·å¾—è®¸å¯ã€‚<br>è¿™4ä¸ªæ–¹æ³•éƒ½ä¼šè¢«é˜»å¡ï¼Œå¦‚æœæƒ³ç«‹å³å¾—åˆ°æ‰§è¡Œç»“æœï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢å‡ ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">()</span> &#123; &#125;;    <span class="hljs-comment">//å°è¯•è·å–ä¸€ä¸ªè®¸å¯ï¼Œè‹¥è·å–æˆåŠŸï¼Œåˆ™ç«‹å³è¿”å›trueï¼Œè‹¥è·å–å¤±è´¥ï¼Œåˆ™ç«‹å³è¿”å›false</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">long</span> timeout, TimeUnit unit)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123; &#125;;  <span class="hljs-comment">//å°è¯•è·å–ä¸€ä¸ªè®¸å¯ï¼Œè‹¥åœ¨æŒ‡å®šçš„æ—¶é—´å†…è·å–æˆåŠŸï¼Œåˆ™ç«‹å³è¿”å›trueï¼Œå¦åˆ™åˆ™ç«‹å³è¿”å›false</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> permits)</span> &#123; &#125;; <span class="hljs-comment">//å°è¯•è·å–permitsä¸ªè®¸å¯ï¼Œè‹¥è·å–æˆåŠŸï¼Œåˆ™ç«‹å³è¿”å›trueï¼Œè‹¥è·å–å¤±è´¥ï¼Œåˆ™ç«‹å³è¿”å›false</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> permits, <span class="hljs-type">long</span> timeout, TimeUnit unit)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123; &#125;; <span class="hljs-comment">//å°è¯•è·å–permitsä¸ªè®¸å¯ï¼Œè‹¥åœ¨æŒ‡å®šçš„æ—¶é—´å†…è·å–æˆåŠŸï¼Œåˆ™ç«‹å³è¿”å›trueï¼Œå¦åˆ™åˆ™ç«‹å³è¿”å›false</span><br></code></pre></td></tr></table></figure><p>å¦å¤–è¿˜å¯ä»¥é€šè¿‡availablePermits()æ–¹æ³•å¾—åˆ°å¯ç”¨çš„è®¸å¯æ•°ç›®ã€‚<br>å‡å¦‚5ä¸ªçº¿ç¨‹è¦ä½¿ç”¨3ä¸ªèµ„æºï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSemaphore</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-type">int</span> <span class="hljs-variable">N</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;            <span class="hljs-comment">//çº¿ç¨‹æ•°</span><br>        <span class="hljs-type">Semaphore</span> <span class="hljs-variable">semaphore</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Semaphore</span>(<span class="hljs-number">3</span>); <span class="hljs-comment">//èµ„æºæ•°ç›®</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;N;i++)<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(<span class="hljs-string">&quot;çº¿ç¨‹&quot;</span> +i,semaphore).start();<br>&#125;<br><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Worker</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> &#123;<br><br><span class="hljs-keyword">private</span> Semaphore semaphore;<br><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">Worker</span><span class="hljs-params">(String name, Semaphore semaphore)</span> &#123;<br><span class="hljs-built_in">super</span>();<br><span class="hljs-built_in">this</span>.setName(name);<br><span class="hljs-built_in">this</span>.semaphore = semaphore;<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">try</span> &#123;<br>semaphore.acquire();<br>System.out.println(<span class="hljs-string">&quot;çº¿ç¨‹ï¼š&quot;</span> + Thread.currentThread().getName() + <span class="hljs-string">&quot;å ç”¨ä¸€ä¸ªèµ„æº&quot;</span>);<br>Thread.sleep(<span class="hljs-number">3000</span>);<br>System.out.println(<span class="hljs-string">&quot;çº¿ç¨‹ï¼š&quot;</span> + Thread.currentThread().getName() + <span class="hljs-string">&quot;é‡Šæ”¾ä¸€ä¸ªèµ„æº&quot;</span>);<br>semaphore.release();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>CountDownLatchå’ŒCyclicBarrieréƒ½èƒ½å¤Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„ç­‰å¾…ï¼Œåªä¸è¿‡å®ƒä»¬ä¾§é‡ç‚¹ä¸åŒï¼š<br>CountDownLatchä¸€èˆ¬ç”¨äºæŸä¸ªçº¿ç¨‹ç­‰å¾…è‹¥å¹²ä¸ªå…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡ä¹‹åï¼Œå®ƒæ‰æ‰§è¡Œï¼›è€ŒCyclicBarrierä¸€èˆ¬ç”¨äºä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…è‡³æŸä¸ªçŠ¶æ€ï¼Œç„¶åè¿™ä¸€ç»„çº¿ç¨‹å†åŒæ—¶æ‰§è¡Œï¼›å¦å¤–ï¼ŒCountDownLatchæ˜¯ä¸èƒ½å¤Ÿé‡ç”¨çš„ï¼Œè€ŒCyclicBarrieræ˜¯å¯ä»¥é‡ç”¨çš„ã€‚Semaphoreå…¶å®å’Œé”æœ‰ç‚¹ç±»ä¼¼ï¼Œå®ƒä¸€èˆ¬ç”¨äºæ§åˆ¶å¯¹æŸç»„èµ„æºçš„è®¿é—®æƒé™ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Tinkeråˆæ¢</title>
    <link href="/2018/03/10/Tinker%E5%88%9D%E6%8E%A2/"/>
    <url>/2018/03/10/Tinker%E5%88%9D%E6%8E%A2/</url>
    
    <content type="html"><![CDATA[<p>å‰ä¸¤å¤©æƒ³è¯•ä¸€ä¸‹çƒ­ä¿®å¤çš„åŠŸèƒ½ï¼Œå¯¹æ¯”å„å¤§å¹³å°çš„çƒ­ä¿®å¤åŠŸèƒ½ï¼Œçœ‹åˆ°tinkerçš„<a href="http://www.tinkerpatch.com/Docs/intro">æ–‡æ¡£ä»‹ç»</a>ï¼Œæœ€ç»ˆå†³å®šå…ˆæ‹¿Tinkerè¯•ä¸€ä¸‹ã€‚</p><blockquote></blockquote><table><thead><tr><th align="center"></th><th align="center"></th><th align="center"></th><th align="center"></th><th align="center"></th></tr></thead><tbody><tr><td align="center"></td><td align="center">Tinker</td><td align="center">QZone</td><td align="center">AndFix</td><td align="center">Robust</td></tr><tr><td align="center">ç±»æ›¿æ¢</td><td align="center">yes</td><td align="center">yes</td><td align="center">no</td><td align="center">no</td></tr><tr><td align="center">Soæ›¿æ¢</td><td align="center">yes</td><td align="center">no</td><td align="center">no</td><td align="center">no</td></tr><tr><td align="center">èµ„æºæ›¿æ¢</td><td align="center">yes</td><td align="center">yes</td><td align="center">no</td><td align="center">no</td></tr><tr><td align="center">å…¨å¹³å°æ”¯æŒ</td><td align="center">yes</td><td align="center">yes</td><td align="center">no</td><td align="center">yes</td></tr><tr><td align="center">å³æ—¶ç”Ÿæ•ˆ</td><td align="center">no</td><td align="center">no</td><td align="center">yes</td><td align="center">yes</td></tr><tr><td align="center">æ€§èƒ½æŸè€—</td><td align="center">è¾ƒå°</td><td align="center">è¾ƒå¤§</td><td align="center">è¾ƒå°</td><td align="center">è¾ƒå°</td></tr><tr><td align="center">è¡¥ä¸åŒ…å¤§å°</td><td align="center">è¾ƒå°</td><td align="center">è¾ƒå¤§</td><td align="center">ä¸€èˆ¬</td><td align="center">ä¸€èˆ¬</td></tr><tr><td align="center">å¼€å‘é€æ˜</td><td align="center">yes</td><td align="center">yes</td><td align="center">no</td><td align="center">no</td></tr><tr><td align="center">å¤æ‚åº¦</td><td align="center">è¾ƒä½</td><td align="center">è¾ƒä½</td><td align="center">å¤æ‚</td><td align="center">å¤æ‚</td></tr><tr><td align="center">Romä½“ç§¯</td><td align="center">Dalvikè¾ƒå¤§</td><td align="center">è¾ƒå°</td><td align="center">è¾ƒå°</td><td align="center">è¾ƒå°</td></tr><tr><td align="center">æˆåŠŸç‡</td><td align="center">è¾ƒé«˜</td><td align="center">è¾ƒé«˜</td><td align="center">ä¸€èˆ¬</td><td align="center">æœ€é«˜</td></tr></tbody></table><blockquote><p>Tinkerçƒ­è¡¥ä¸æ–¹æ¡ˆä¸ä»…æ”¯æŒç±»ã€So ä»¥åŠèµ„æºçš„æ›¿æ¢ï¼Œå®ƒè¿˜æ˜¯2.Xï¼7.Xçš„å…¨å¹³å°æ”¯æŒã€‚åˆ©ç”¨Tinkeræˆ‘ä»¬ä¸ä»…å¯ä»¥ç”¨åš bugfix,ç”šè‡³å¯ä»¥æ›¿ä»£åŠŸèƒ½çš„å‘å¸ƒã€‚Tinker å·²è¿è¡Œåœ¨å¾®ä¿¡çš„æ•°äº¿ Android è®¾å¤‡ä¸Šï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä½ ä¸ä½¿ç”¨ Tinker å‘¢ï¼Ÿ</p></blockquote><p>ä¸å¾—ä¸è¯´ï¼Œæˆ‘çœŸçš„ä½ä¼°äº†è·Ÿç€è…¾è®¯æ–‡æ¡£èµ°çš„éš¾åº¦ã€‚</p><span id="more"></span><h3 id="æ³¨å†Œ-TinkerPatch-å¹³å°"><a href="#æ³¨å†Œ-TinkerPatch-å¹³å°" class="headerlink" title="æ³¨å†Œ TinkerPatch å¹³å°"></a>æ³¨å†Œ TinkerPatch å¹³å°</h3><p>å› ä¸ºéœ€è¦ä¸‹å‘è¡¥ä¸ï¼Œç›´æ¥ä½¿ç”¨TinkerPatchå¹³å°å°±å¥½ï¼Œåœ¨è¿™é‡Œæ³¨å†Œ<a href="http://www.tinkerpatch.com/Index/reg">http://www.tinkerpatch.com/Index/reg</a>,æ³¨å†Œå®Œæˆååˆ›å»ºä¸€ä¸ªåº”ç”¨ï¼Œæ‹¿åˆ°<code>appKey</code><br>ç„¶åæ·»åŠ ä¸€ä¸ªAPPç‰ˆæœ¬</p><h3 id="SDKæ¥å…¥"><a href="#SDKæ¥å…¥" class="headerlink" title="SDKæ¥å…¥"></a>SDKæ¥å…¥</h3><p>æµ‹è¯•æˆåŠŸçš„å·¥ç¨‹å…¨éƒ¨æ–‡ä»¶åœ¨è¿™é‡Œ<a href="https://github.com/huangyuanlove/TestTinker">https://github.com/huangyuanlove/TestTinker</a>,åŒ…å«æ„å»ºæˆåŠŸä¹‹åçš„apkæ–‡ä»¶ä»¥åŠä¸€äº›è¾…åŠ©æ–‡ä»¶ã€‚</p><h5 id="æ·»åŠ Gradleæ’ä»¶ä¾èµ–"><a href="#æ·»åŠ Gradleæ’ä»¶ä¾èµ–" class="headerlink" title="æ·»åŠ Gradleæ’ä»¶ä¾èµ–"></a>æ·»åŠ Gradleæ’ä»¶ä¾èµ–</h5><p>AndroidStudioåˆ›å»ºä¸€ä¸ªå·¥ç¨‹ï¼Œå®šä¹‰ä½¿ç”¨çš„SDKç‰ˆæœ¬ï¼Œæˆ‘æ˜¯æ”¾åœ¨äº†<code>gradle.properties</code> è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œ</p><blockquote><p>TINKER_VERSION&#x3D;1.9.2<br>TINKERPATCH_VERSION&#x3D;1.2.2</p></blockquote><p>ç„¶ååœ¨å·¥ç¨‹çš„<code>build.gradle</code>æ–‡ä»¶ä¸­æ·»åŠ æ’ä»¶ä¾èµ–</p><blockquote><p>classpath â€œcom.tinkerpatch.sdk:tinkerpatch-gradle-plugin:${TINKERPATCH_VERSION}â€</p></blockquote><p>ç„¶åæ·»åŠ ä¸€äº›å…¶ä»–é…ç½®ï¼Œæ•´ä¸ªæ–‡ä»¶å†…å®¹å¦‚ä¸‹</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs groovy">buildscript &#123;<br>    repositories &#123;<br>        google()<br>        jcenter()<br>    &#125;<br>    dependencies &#123;<br>        classpath <span class="hljs-string">&#x27;com.android.tools.build:gradle:3.0.1&#x27;</span><br>        classpath <span class="hljs-string">&quot;com.tinkerpatch.sdk:tinkerpatch-gradle-plugin:$&#123;TINKERPATCH_VERSION&#125;&quot;</span><br>    &#125;<br>&#125;<br><span class="hljs-keyword">if</span> (JavaVersion.current().isJava8Compatible()) &#123;<br>    allprojects &#123;<br>        tasks.withType(Javadoc) &#123;<br>            options.addStringOption(<span class="hljs-string">&#x27;Xdoclint:none&#x27;</span>, <span class="hljs-string">&#x27;-quiet&#x27;</span>)<br>        &#125;<br>    &#125;<br>&#125;<br>subprojects &#123;<br>    tasks.withType(JavaCompile) &#123;<br>        sourceCompatibility = JavaVersion.VERSION_1_7<br>        targetCompatibility = JavaVersion.VERSION_1_7<br>    &#125;<br>&#125;<br>allprojects &#123;<br>    repositories &#123;<br>        google()<br>        jcenter()<br>    &#125;<br>&#125;<br>task clean(<span class="hljs-attr">type:</span> Delete) &#123;<br>    delete rootProject.buildDir<br>&#125;<br><br></code></pre></td></tr></table></figure><h5 id="é›†æˆ-TinkerPatch-SDK"><a href="#é›†æˆ-TinkerPatch-SDK" class="headerlink" title="é›†æˆ TinkerPatch SDK"></a>é›†æˆ TinkerPatch SDK</h5><p>åœ¨<code>app/build.gradle</code>é‡Œé¢æ·»åŠ ä¾èµ–</p><blockquote></blockquote><pre><code class="hljs">annotationProcessor(&quot;com.tinkerpatch.tinker:tinker-android-anno:$&#123;TINKER_VERSION&#125;&quot;) &#123; changing = true &#125;compileOnly(&quot;com.tinkerpatch.tinker:tinker-android-anno:$&#123;TINKER_VERSION&#125;&quot;) &#123; changing = true &#125;implementation(&quot;com.tinkerpatch.sdk:tinkerpatch-android-sdk:$&#123;TINKERPATCH_VERSION&#125;&quot;) &#123; changing = true &#125;</code></pre><p>ä¸ºäº†é…ç½®æ–¹ä¾¿ï¼Œæˆ‘ä»¬æŠŠTinkerPatchSupportç›¸å…³çš„é…ç½®æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„gradleæ–‡ä»¶ä¸­ï¼Œåœ¨appä¸‹åˆ›å»ºä¸€ä¸ª<code>tinkerpatch.gradle</code>ï¼Œæˆ‘ä»¬éœ€è¦åœ¨<code>app/build.grale</code>æ–‡ä»¶ä¸­å¼•ç”¨</p><blockquote><p>apply from: â€˜tinkerpatch.gradleâ€™</p></blockquote><h5 id="é…ç½®-tinkerpatchSupport-å‚æ•°"><a href="#é…ç½®-tinkerpatchSupport-å‚æ•°" class="headerlink" title="é…ç½® tinkerpatchSupport å‚æ•°"></a>é…ç½® tinkerpatchSupport å‚æ•°</h5><p>ç¼–è¾‘ <code>app/tinkerpatch.gralde</code>æ–‡ä»¶</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><br>apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;tinkerpatch-support&#x27;</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">TODO:</span> è¯·æŒ‰è‡ªå·±çš„éœ€æ±‚ä¿®æ”¹ä¸ºé€‚åº”è‡ªå·±å·¥ç¨‹çš„å‚æ•°</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">def</span> bakPath = file(<span class="hljs-string">&quot;$&#123;buildDir&#125;/bakApk/&quot;</span>)<br><span class="hljs-keyword">def</span> baseInfo = <span class="hljs-string">&quot;app-1.0.0-0309-21-30-56&quot;</span> <span class="hljs-comment">//æ„å»ºå·®å¼‚æ–‡ä»¶æ—¶ä½¿ç”¨</span><br><span class="hljs-keyword">def</span> variantName = <span class="hljs-string">&quot;debug&quot;</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¯¹äºæ’ä»¶å„å‚æ•°çš„è¯¦ç»†è§£æè¯·å‚è€ƒ</span><br><span class="hljs-comment"> * http://tinkerpatch.com/Docs/SDK</span><br><span class="hljs-comment"> */</span><br>tinkerpatchSupport &#123;<br>    <span class="hljs-comment">/** å¯ä»¥åœ¨debugçš„æ—¶å€™å…³é—­ tinkerPatch **/</span><br>    <span class="hljs-comment">/** å½“disable tinkerçš„æ—¶å€™éœ€è¦æ·»åŠ multiDexKeepProguardå’ŒproguardFiles,</span><br><span class="hljs-comment">        è¿™äº›é…ç½®æ–‡ä»¶æœ¬èº«ç”±tinkerPatchçš„æ’ä»¶è‡ªåŠ¨æ·»åŠ ï¼Œå½“ä½ disableåéœ€è¦æ‰‹åŠ¨æ·»åŠ </span><br><span class="hljs-comment">        ä½ å¯ä»¥copyæœ¬ç¤ºä¾‹ä¸­çš„proguardRules.proå’ŒtinkerMultidexKeep.pro,</span><br><span class="hljs-comment">        éœ€è¦ä½ æ‰‹åŠ¨ä¿®æ”¹&#x27;tinker.sample.android.app&#x27;æœ¬ç¤ºä¾‹çš„åŒ…åä¸ºä½ è‡ªå·±çš„åŒ…å, com.xxxå‰ç¼€çš„åŒ…åä¸ç”¨ä¿®æ”¹</span><br><span class="hljs-comment">     **/</span><br>    tinkerEnable = <span class="hljs-literal">true</span><br>    reflectApplication = <span class="hljs-literal">false</span><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ˜¯å¦å¼€å¯åŠ å›ºæ¨¡å¼ï¼Œåªèƒ½åœ¨APKå°†è¦è¿›è¡ŒåŠ å›ºæ—¶ä½¿ç”¨ï¼Œå¦åˆ™ä¼špatchå¤±è´¥ã€‚</span><br><span class="hljs-comment">     * å¦‚æœåªåœ¨æŸä¸ªæ¸ é“ä½¿ç”¨äº†åŠ å›ºï¼Œå¯ä½¿ç”¨å¤šflavorsé…ç½®</span><br><span class="hljs-comment">     **/</span><br>    protectedApp = <span class="hljs-literal">false</span><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å®éªŒåŠŸèƒ½</span><br><span class="hljs-comment">     * è¡¥ä¸æ˜¯å¦æ”¯æŒæ–°å¢ Activity (æ–°å¢Activityçš„exportedå±æ€§å¿…é¡»ä¸ºfalse)</span><br><span class="hljs-comment">     **/</span><br>    supportComponent = <span class="hljs-literal">true</span><br><br>    autoBackupApkPath = <span class="hljs-string">&quot;$&#123;bakPath&#125;&quot;</span><br><br>    appKey = <span class="hljs-string">&quot;2b662623551153ee&quot;</span><br><br>    <span class="hljs-comment">/** æ³¨æ„: è‹¥å‘å¸ƒæ–°çš„å…¨é‡åŒ…, appVersionä¸€å®šè¦æ›´æ–° **/</span><br>    appVersion = <span class="hljs-string">&quot;1.0.0&quot;</span><br><br>    <span class="hljs-keyword">def</span> pathPrefix = <span class="hljs-string">&quot;$&#123;bakPath&#125;/$&#123;baseInfo&#125;/$&#123;variantName&#125;/&quot;</span><br>    <span class="hljs-keyword">def</span> name = <span class="hljs-string">&quot;$&#123;project.name&#125;-$&#123;variantName&#125;&quot;</span><br><br>    baseApkFile = <span class="hljs-string">&quot;$&#123;pathPrefix&#125;/$&#123;name&#125;.apk&quot;</span><br>    baseProguardMappingFile = <span class="hljs-string">&quot;$&#123;pathPrefix&#125;/$&#123;name&#125;-mapping.txt&quot;</span><br>    baseResourceRFile = <span class="hljs-string">&quot;$&#123;pathPrefix&#125;/$&#123;name&#125;-R.txt&quot;</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *  è‹¥æœ‰ç¼–è¯‘å¤šflavorséœ€æ±‚, å¯ä»¥å‚ç…§ï¼š https://github.com/TinkerPatch/tinkerpatch-flavors-sample</span><br><span class="hljs-comment">     *  æ³¨æ„: é™¤éä½ ä¸åŒçš„flavorä»£ç æ˜¯ä¸ä¸€æ ·çš„,ä¸ç„¶å»ºè®®é‡‡ç”¨zip commentæˆ–è€…æ–‡ä»¶æ–¹å¼ç”Ÿæˆæ¸ é“ä¿¡æ¯ï¼ˆç›¸å…³å·¥å…·ï¼šwalle æˆ–è€… packer-ngï¼‰</span><br><span class="hljs-comment">     **/</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç”¨äºç”¨æˆ·åœ¨ä»£ç ä¸­åˆ¤æ–­tinkerPatchæ˜¯å¦è¢«ä½¿èƒ½</span><br><span class="hljs-comment"> */</span><br>android &#123;<br>    defaultConfig &#123;<br>        buildConfigField <span class="hljs-string">&quot;boolean&quot;</span>, <span class="hljs-string">&quot;TINKER_ENABLE&quot;</span>, <span class="hljs-string">&quot;$&#123;tinkerpatchSupport.tinkerEnable&#125;&quot;</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ä¸€èˆ¬æ¥è¯´,æˆ‘ä»¬æ— éœ€å¯¹ä¸‹é¢çš„å‚æ•°åšä»»ä½•çš„ä¿®æ”¹</span><br><span class="hljs-comment"> * å¯¹äºå„å‚æ•°çš„è¯¦ç»†ä»‹ç»è¯·å‚è€ƒ:</span><br><span class="hljs-comment"> * https://github.com/Tencent/tinker/wiki/Tinker-%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97</span><br><span class="hljs-comment"> */</span><br>tinkerPatch &#123;<br>    ignoreWarning = <span class="hljs-literal">false</span><br>    useSign = <span class="hljs-literal">true</span><br>    dex &#123;<br>        dexMode = <span class="hljs-string">&quot;jar&quot;</span><br>        pattern = [<span class="hljs-string">&quot;classes*.dex&quot;</span>]<br>        loader = []<br>    &#125;<br>    lib &#123;<br>        pattern = [<span class="hljs-string">&quot;lib/*/*.so&quot;</span>]<br>    &#125;<br><br>    res &#123;<br>        pattern = [<span class="hljs-string">&quot;res/*&quot;</span>, <span class="hljs-string">&quot;r/*&quot;</span>, <span class="hljs-string">&quot;assets/*&quot;</span>, <span class="hljs-string">&quot;resources.arsc&quot;</span>, <span class="hljs-string">&quot;AndroidManifest.xml&quot;</span>]<br>        ignoreChange = []<br>        largeModSize = <span class="hljs-number">100</span><br>    &#125;<br><br>    packageConfig &#123;<br>    &#125;<br>    sevenZip &#123;<br>        zipArtifact = <span class="hljs-string">&quot;com.tencent.mm:SevenZip:1.1.10&quot;</span><br>    &#125;<br>    buildConfig &#123;<br>        keepDexApply = <span class="hljs-literal">false</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¯ä¸ªå‚æ•°çš„å«ä¹‰å¦‚ä¸‹</p><table><thead><tr><th align="center">å‚æ•°</th><th align="center">é»˜è®¤å€¼</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">tinkerEnable</td><td align="center">true</td><td align="center">æ˜¯å¦å¼€å¯ tinkerpatchSupport æ’ä»¶åŠŸèƒ½</td></tr><tr><td align="center">appKey</td><td align="center">â€œâ€</td><td align="center">åœ¨ TinkerPatch å¹³å° ç”³è¯·çš„ appkey</td></tr><tr><td align="center">appVersion</td><td align="center">â€œâ€</td><td align="center">åœ¨ TinkerPatch å¹³å° è¾“å…¥çš„ç‰ˆæœ¬å·,æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨ appVersion ä½œä¸º TinkerId, æˆ‘ä»¬éœ€è¦ä¿è¯æ¯ä¸ªå‘å¸ƒå‡ºå»çš„åŸºç¡€å®‰è£…åŒ…çš„ appVersion éƒ½ä¸ä¸€æ ·ã€‚</td></tr><tr><td align="center">reflectApplication</td><td align="center">false</td><td align="center">æ˜¯å¦åå°„ Application å®ç°ä¸€é”®æ¥å…¥ï¼›ä¸€èˆ¬æ¥è¯´ï¼Œæ¥å…¥ Tinker æˆ‘ä»¬éœ€è¦æ”¹é€ æˆ‘ä»¬</td></tr><tr><td align="center">autoBackupApkPath</td><td align="center">â€œâ€</td><td align="center">å°†æ¯æ¬¡ç¼–è¯‘äº§ç”Ÿçš„ apk&#x2F;mapping.txt&#x2F;R.txt å½’æ¡£å­˜å‚¨çš„ä½ç½®</td></tr><tr><td align="center">baseApkFile</td><td align="center">â€œâ€</td><td align="center">åŸºå‡†åŒ…çš„æ–‡ä»¶è·¯å¾„, å¯¹åº” tinker æ’ä»¶ä¸­çš„ oldApk å‚æ•°;ç¼–è¯‘è¡¥ä¸åŒ…æ—¶ï¼Œå¿…éœ€æŒ‡å®šåŸºå‡†ç‰ˆæœ¬çš„ apkï¼Œé»˜è®¤å€¼ä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºä¸æ˜¯è¿›è¡Œè¡¥ä¸åŒ…çš„ç¼–è¯‘ã€‚</td></tr><tr><td align="center">baseProguardMappingFile</td><td align="center">â€œâ€</td><td align="center">åŸºå‡†åŒ…çš„ Proguard mapping.txt æ–‡ä»¶è·¯å¾„, å¯¹åº” tinker æ’ä»¶ applyMapping å‚æ•°ï¼›åœ¨ç¼–è¯‘æ–°çš„ apk æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›é€šè¿‡ä¿æŒåŸºå‡† apk çš„ proguard æ··æ·†æ–¹å¼ï¼Œä»è€Œå‡å°‘è¡¥ä¸åŒ…çš„å¤§å°ã€‚è¿™æ˜¯å¼ºçƒˆæ¨èçš„ï¼Œç¼–è¯‘è¡¥ä¸åŒ…æ—¶ï¼Œæˆ‘ä»¬æ¨èè¾“å…¥åŸºå‡† apk ç”Ÿæˆçš„ mapping.txt æ–‡ä»¶ã€‚</td></tr><tr><td align="center">baseResourceRFile</td><td align="center">â€œâ€</td><td align="center">åŸºå‡†åŒ…çš„èµ„æº R.txt æ–‡ä»¶è·¯å¾„, å¯¹åº” tinker æ’ä»¶ applyResourceMapping å‚æ•°ï¼›åœ¨ç¼–è¯‘æ–°çš„apkæ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›é€šåŸºå‡† apk çš„ R.txt æ–‡ä»¶æ¥ä¿æŒ Resource Id çš„åˆ†é…ï¼Œè¿™æ ·ä¸ä»…å¯ä»¥å‡å°‘è¡¥ä¸åŒ…çš„å¤§å°ï¼ŒåŒæ—¶ä¹Ÿé¿å…ç”±äº Resource Id æ”¹å˜å¯¼è‡´ remote view å¼‚å¸¸ã€‚</td></tr><tr><td align="center">protectedApp</td><td align="center">false</td><td align="center">æ˜¯å¦å¼€å¯æ”¯æŒåŠ å›ºï¼Œæ³¨æ„ï¼šåªæœ‰åœ¨ä½¿ç”¨åŠ å›ºæ—¶æ‰èƒ½å¼€å¯æ­¤å¼€å…³</td></tr><tr><td align="center">supportComponent</td><td align="center">false</td><td align="center">æ˜¯å¦å¼€å¯æ”¯æŒåœ¨è¡¥ä¸åŒ…ä¸­åŠ¨æ€å¢åŠ Activity æ³¨æ„ï¼šæ–°å¢Activityçš„Exportedå±æ€§å¿…é¡»ä¸ºfalse</td></tr><tr><td align="center">backupFileNameFormat</td><td align="center">â€˜${appName}-${variantName}â€™</td><td align="center">æ ¼å¼åŒ–å‘½åå¤‡ä»½æ–‡ä»¶ è¿™é‡Œè¯·ä½¿ç”¨å•å¼•å·</td></tr></tbody></table><h5 id="åˆå§‹åŒ–-TinkerPatch-SDK"><a href="#åˆå§‹åŒ–-TinkerPatch-SDK" class="headerlink" title="åˆå§‹åŒ– TinkerPatch SDK"></a>åˆå§‹åŒ– TinkerPatch SDK</h5><p>è¿™é‡Œæ¨èä½¿ç”¨æ”¹é€ ä¹‹åçš„ApplicationLikeï¼Œå¯¹åº”<code>tinkerpatch.gradle</code>æ–‡ä»¶ä¸­çš„<code>reflectApplication = false</code>,è¿™é‡Œç»™å‡ºäº†å®Œæ•´çš„ApplicationLikeç±»ï¼Œå¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹<a href="https://github.com/huangyuanlove/TestTinker/blob/master/app/src/main/java/com/huangyuan/testtinker/SampleApplicationLike.java">https://github.com/huangyuanlove/TestTinker/blob/master/app/src/main/java/com/huangyuan/testtinker/SampleApplicationLike.java</a><br>å…¶ä¸­å¯¹äºç±»çš„æ³¨è§£ä¸­çš„ <code>application</code> çš„å€¼ï¼Œå°±æ˜¯æˆ‘ä»¬åº”ç”¨çš„Applicationç±»ï¼Œéœ€è¦åœ¨<code>AndroidManifest.xml</code>ä¸­çš„<code>application</code>æ ‡ç­¾ä¸­é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DefaultLifeCycle(application = &quot;com.huangyuanlove.testtinker.SampleApplication&quot;,</span><br><span class="hljs-meta">                  flags = ShareConstants.TINKER_ENABLE_ALL,</span><br><span class="hljs-meta">                  loadVerifyFlag = false)</span>`<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼šåˆå§‹åŒ–çš„ä»£ç å»ºè®®ç´§è·Ÿ super.onCreate(),å¹¶ä¸”æ‰€æœ‰è¿›ç¨‹éƒ½éœ€è¦åˆå§‹åŒ–ï¼Œå·²è¾¾åˆ°æ‰€æœ‰è¿›ç¨‹éƒ½å¯ä»¥è¢« patch çš„ç›®çš„<br>å¦‚æœä½ ç¡®å®šåªæƒ³åœ¨ä¸»è¿›ç¨‹ä¸­åˆå§‹åŒ– tinkerPatchï¼Œé‚£ä¹Ÿè¯·è‡³å°‘åœ¨ :patch è¿›ç¨‹ä¸­åˆå§‹åŒ–ï¼Œå¦åˆ™ä¼šæœ‰é€ æˆ :patch è¿›ç¨‹crashï¼Œæ— æ³•ä½¿è¡¥ä¸ç”Ÿæ•ˆ</strong><br>æˆ‘ä»¬åœ¨å®é™…åº”ç”¨è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥åœ¨ç™»é™†ç­‰å…³é”®åœ°æ–¹å»è°ƒç”¨<code>TinkerPatch.with().fetchPatchUpdate(true)</code>æ¥æ£€æµ‹æœ‰æ²¡æœ‰æ–°çš„è¡¥ä¸åŒ…ï¼Œè‹¥æœ‰ï¼Œåˆ™å»ä¸‹è½½ã€‚ä¸‹è½½å®Œæˆè¡¥ä¸åŒ…åï¼Œsdkä¼šè‡ªåŠ¨å»åˆæˆæ–°çš„å®‰è£…åŒ…ï¼Œå¹¶ä¸”åœ¨æ¯å±çš„æ—¶å€™è‡ªåŠ¨é‡å¯ä¸»çº¿ç¨‹å»åŠ è½½æ–°çš„æ–‡ä»¶ï¼Œæˆ–è€…è°ƒç”¨<code> ShareTinkerInternals.killAllOtherProcess(getApplicationContext());                 android.os.Process.killProcess(android.os.Process.myPid());</code>æ¥å®Œæˆæ€æ­»ä¸»çº¿ç¨‹çš„ç›®çš„ã€‚</p><h5 id="ä½¿ç”¨æ­¥éª¤"><a href="#ä½¿ç”¨æ­¥éª¤" class="headerlink" title="ä½¿ç”¨æ­¥éª¤"></a>ä½¿ç”¨æ­¥éª¤</h5><p>é¦–å…ˆæ„å»ºåŸºç¡€åŒ…ï¼Œæ¨¡æ‹Ÿç”¨æˆ·å½“å‰ä½¿ç”¨çš„ç‰ˆæœ¬ã€‚<br>åœ¨gradleä¸­æ‰¾åˆ°ä¸‹å›¾æ‰€ç¤ºçš„ <code>assembleRelease</code>æˆ–è€…<code>assembleDebug</code>taskï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ„å»ºåŸºç¡€åŒ…ä½¿ç”¨çš„æ˜¯<code>debug</code>,é‚£ä¹ˆåœ¨æ„å»ºpatchåŒ…çš„æ—¶å€™ä¹Ÿè¦é€‰æ‹©<code>debug</code>ï¼Œè¿˜æœ‰å°±æ˜¯å°½é‡æŠŠ<code>app/tinkerpatch.gradle</code>ä¸­å®šä¹‰çš„<code>variantName</code>æ”¹æˆä¸€è‡´çš„ã€‚<br>åŸºç¡€åŒ…æ„å»ºæˆåŠŸåï¼Œä¼šåœ¨<code>app/build/bakApk</code>æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆå¯¹åº”çš„æ–‡ä»¶ï¼Œæ‰¾åˆ°å’Œä½ æ„å»ºæ—¶é—´ä¸€è‡´çš„åŒ…ã€‚<br>ç°åœ¨ä¿®æ”¹ä»£ç æˆ–è€…å¸ƒå±€æ–‡ä»¶(æ¨¡æ‹Ÿä¿®å¤bug),ä¿®æ”¹æ¸…å•æ–‡ä»¶<code>AndroidManifest.xml</code>ä¸­çš„versionNameå’ŒversionCodeã€‚<br>ä¿®æ”¹<code>app/tinkerpatch.gradle</code>æ–‡ä»¶ï¼Œå°†å…¶ä¸­å®šä¹‰çš„<code>baseInfo</code>ä¿®æ”¹ä¸ºä¸Šé¢æåˆ°çš„è·¯å¾„ã€‚è¿™æ—¶å€™<strong>ä¸éœ€è¦ä¿®æ”¹</strong>è¯¥æ–‡ä»¶ä¸­çš„<code>appVersion</code>ã€‚<br>åœ¨gradleä¸­æ‰¾åˆ°tinkerä»»åŠ¡åŒ…ï¼Œæ‰¾åˆ°<code>tinkerPatchDebug</code>æˆ–è€…<code>tinkerPatchRelease</code>ï¼Œæ„å»ºå·®å¼‚åŒ…(è¡¥ä¸æ–‡ä»¶)ã€‚æ„å»ºæˆåŠŸåä¼šåœ¨<code>app/build/outputs/apk/tinkerPatch</code>æ–‡ä»¶å¤¹ä¸­<br><img src="/image/hotfix/tinker_task.png" alt="tinkerTaskResult"> <img src="/image/hotfix/tinker_task_result.png" alt="tinkerTaskResult"><br>ç°åœ¨æˆ‘ä»¬å·²ç»æˆåŠŸæ„å»ºçš„å·®å¼‚åŒ…<code>patch-signed-7zip.apk</code>,ç°åœ¨åªéœ€è¦å°†å·®å¼‚åŒ…ä¸Šä¼ åˆ°<code>tinker-patch</code>å¹³å°å°±å¯ä»¥äº†ã€‚</p><h5 id="åœ¨tinker-patchå¹³å°å‘å¸ƒå·®å¼‚åŒ…"><a href="#åœ¨tinker-patchå¹³å°å‘å¸ƒå·®å¼‚åŒ…" class="headerlink" title="åœ¨tinker-patchå¹³å°å‘å¸ƒå·®å¼‚åŒ…"></a>åœ¨tinker-patchå¹³å°å‘å¸ƒå·®å¼‚åŒ…</h5><p>æˆ‘ä»¬ç™»é™†tinker-patchå¹³å°ï¼Œæ‰¾åˆ°åœ¨åˆšå¼€å§‹åˆ›å»ºçš„é¡¹ç›®ï¼Œåœ¨è¯¥é¡¹ç›®é‡Œé¢æ·»åŠ ä¸€ä¸ªAppç‰ˆæœ¬ï¼Œæ³¨æ„è¿™é‡Œçš„Appç‰ˆæœ¬å·è¦å’Œ<code>tinkerpatch.gradle</code>é‡Œé¢å®šä¹‰çš„<code>appVersion</code>ä¸€è‡´ï¼Œåœ¨å®˜æ–¹æ–‡æ¡£ä¸­ä¹Ÿæåˆ°è¿‡è¿™ä¸€ç‚¹ï¼š</p><blockquote><p>æ¯ä¸€ä¸ª APP ç‰ˆæœ¬å¯¹åº”ä¸€ä¸ªå·²ç»å‘å¸ƒçš„ base apk, è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ APP ç‰ˆæœ¬ä½œä¸º TinkerIDã€‚æˆ‘ä»¬éœ€è¦ä¿è¯æ¯ä¸ªå‘å¸ƒçš„ APK éƒ½é‡‡ç”¨ä¸ç”¨çš„ APP ç‰ˆæœ¬ã€‚</p></blockquote><p>åˆ›å»ºå¥½appç‰ˆæœ¬ä¹‹åï¼Œç‚¹å‡»<code>å‘å¸ƒæ–°è¡¥ä¸</code>ï¼Œé€‰æ‹©è¡¥ä¸æ–‡ä»¶<code>patch-signed-7zip.apk</code>,å¡«å†™ä¸€ä¸‹å¤‡æ³¨å°±å¥½äº†ï¼Œè¿™é‡Œæœ‰å››ç§è¡¥ä¸çš„ä¸‹å‘æ–¹å¼<a href="http://www.tinkerpatch.com/Docs/dev">å¼€å‘é¢„è§ˆ</a> ã€<code>å…¨é‡ä¸‹å‘</code> ã€<a href="http://www.tinkerpatch.com/Docs/rule">æ¡ä»¶ä¸‹å‘</a> ã€<a href="http://www.tinkerpatch.com/Docs/rule">ç°åº¦ä¸‹å‘</a>ã€å…·ä½“å·®å¼‚å¯ä»¥ç‚¹å‡»å»æŸ¥çœ‹ã€‚<br>åŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å¹³å°å¯¹åº”çš„è½¯ä»¶ç‰ˆæœ¬ä¸­çš„å®æ—¶ç›‘æ§é‡Œé¢çœ‹åˆ°è¡¥ä¸çš„ä¸‹è½½ä»¥åŠåˆæˆåº”ç”¨æ¬¡æ•°ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>çƒ­ä¿®å¤</tag>
      
      <tag>tinker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LaTeXç¬”è®°-å…­(æ•°å­¦å…¬å¼)</title>
    <link href="/2018/02/27/LaTeX%E7%AC%94%E8%AE%B0-%E5%85%AD/"/>
    <url>/2018/02/27/LaTeX%E7%AC%94%E8%AE%B0-%E5%85%AD/</url>
    
    <content type="html"><![CDATA[<p>TeXæœ‰ä¸¤ç§æ•°å­¦å…¬å¼ï¼Œä¸€ç§æ˜¯å¤¹æ‚åœ¨è¡Œæ–‡æ®µè½ä¸­çš„å…¬å¼ï¼Œå¦‚$\int f(x) \text{d}x&#x3D;1$,ä¸€èˆ¬ç§°ä¸º<strong>è¡Œå†…(inline)<strong>æ•°å­¦å…¬å¼ï¼Œæˆ–</strong>æ­£æ–‡(in-text)<strong>æ•°å­¦å…¬å¼;å¦ä¸€ç§å°±æ˜¯åƒä¸‹é¢è¿™æ ·å•ç‹¬å æ®éƒ‘èˆªå±…ä¸­å±•ç¤ºå‡ºæ¥ï¼Œç§°ä¸º</strong>æ˜¾ç¤º</strong>æ•°å­¦å…¬å¼<br>$$\sum_{i&#x3D;0}^N \int_a^bg(t,i)\text{d}$$</p><p>åœ¨TeXä¸­ï¼Œè¡Œå†…å…¬å¼ä¸€èˆ¬åœ¨å‰åå•ä¸ªç¾å…ƒç¬¦å·\$â€¦\$è¡¨ç¤ºï¼Œæ˜¾ç¤ºå…¬å¼ç”¨è¿ç»­çš„ä¸¤ä¸ªç¾å…ƒç¬¦å·\$\$â€¦\$\$è¡¨ç¤º</p><span id="more"></span><h4 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h4><p>åœ¨æ•°å­¦æ¨¡å¼ä¸‹ï¼Œç¬¦å·ä¼šä½¿ç”¨å•ç‹¬çš„å­—ä½“ï¼Œå­—æ¯é€šå¸¸æ˜¯å€¾æ–œçš„æ„å¤§åˆ©ä½“ï¼Œæ•°å­—å’Œç¬¦å·åˆ™æ˜¯è‡ªç«‹ä½“ï¼Œä»”ç»†çœ‹çš„è¯ï¼Œæ•°å­¦ç¬¦å·ä¹‹é—´çš„è·ç¦»ä¹Ÿä¸ä¸€èˆ¬çš„æ°´å¹³æ¨¡å¼ä¸åŒï¼š<br>$a + b &#x3D; b + a$,å¦‚$ 1 + 2 &#x3D; 2 + 1$<br>æ­£å¸¸æ¨¡å¼<br>a + b &#x3D; b + aï¼Œå¦‚ 1 + 2 &#x3D; 2 + 1<br>å› æ­¤ï¼Œåœ¨æ’ç‰ˆæ•°å­¦å…¬å¼æ—¶ï¼Œå³ä½¿æ˜¯æ²¡æœ‰ä»»ä½•ç‰¹æ®Šç¬¦å·çš„ç®—å¼$1+1$ä¹Ÿè¦è¿›å…¥æ•°å­¦æ¨¡å¼ï¼Œä½¿ç”¨$1+1$è€Œä¸æ˜¯æ™®é€šæ–‡å­—çš„1+1<br>cé™¤äº†ä½¿ç”¨å•ä¸ªç¾å…ƒç¬¦å·ï¼Œåœ¨LaTeXä¸­è¿˜é¢å¤–å®šä¹‰äº†å‘½ä»¤æ ¼å¼ä¸ç¯å¢ƒæ ¼å¼çš„æ–¹å¼è¾“å…¥è¡Œå†…å…¬å¼ï¼Œå³ä½¿ç”¨å‘½ä»¤<code>\(</code>å’Œ<code>\)</code>ç¯å¢ƒæ‹¬èµ·æ¥ä¸€ä¸ªè¡Œå†…æ•°å­¦å…¬å¼ï¼Œå¦‚<code>$a+b$</code>ä¹Ÿå¯ä»¥å†™æˆ<code>\(a+b\)</code>æˆ–æ˜¯<code>\begin&#123;math&#125;a+b\end&#123;math&#125;</code>ã€‚è¿™ä¸¤ç§å½¢å¼æä¾›äº†æ›´å¥½çš„é”™è¯¯æ£€æŸ¥ï¼Œå¹¶ä¸”å¯ä»¥æ›´æ˜ç¡®åœ°çœ‹å‡ºå…¬å¼çš„å¼€å§‹äºç»“æŸï¼Œä¹Ÿä¸å®¹æ˜“æ··æ·†ã€‚<br>åŒæ ·çš„ï¼ŒLaTeXä¸­ä¹Ÿå®šä¹‰äº†å‘½ä»¤å½¢å¼å’Œç¯å¢ƒå½¢å¼çš„è¾“å…¥æ–¹æ³•ï¼Œå³ä½¿ç”¨<code>\[</code>å’Œ<code>\]</code>å‘½ä»¤æˆ–æ˜¯<code>displaymath</code>ç¯å¢ƒæ‹¬èµ·ä¸€ä¸ªæ˜¾ç¤ºæ•°å­¦å…¬å¼ï¼Œä¾‹å¦‚ï¼š<code>\[a+b=b+a\]</code>,è™½ç„¶å¹¶éå¿…é¡»ï¼Œä½†æœ€å¥½åœ¨æºä»£ç ä¸­å°±æŠŠå•ç‹¬å æ®ä¸€è¡Œçš„æ˜¾ç¤ºå…¬å¼æ”¾åœ¨å•ç‹¬çš„è¡Œå†…ï¼Œä½¿ä»£ç æ›´æ¸…æ™°ï¼Œæ¨èä½¿ç”¨çš„æ–¹å¼æ˜¯<code>\[...\]</code>ï¼Œ<code>$$...$$</code>ä¼šäº§ç”Ÿä¸è‰¯çš„é—´è·ï¼Œç¼ºå°‘é”™è¯¯æ£€æŸ¥ï¼Œå¹¶ä¸”ä¸èƒ½æ­£ç¡®å¤„ç†fleqnç­‰æ–‡æ¡£é€‰é¡¹ï¼Œåº”è¯¥é¿å…ä½¿ç”¨ï¼Œè€Œ<code>displaymath</code>ç¯å¢ƒå¯èƒ½æ˜¾å¾—å†—é•¿ã€‚<br>LaTeXè¿˜æä¾›äº†å¸¦è‡ªåŠ¨ç¼–å·çš„æ•°å­¦å…¬å¼ï¼Œå¯ä»¥ç”¨<code>equation</code>ç¯å¢ƒè¡¨ç¤ºï¼Œå…¬å¼åè¿˜å¯ä»¥å¸¦å¼•ç”¨çš„æ ‡ç­¾ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\begin</span>&#123;equation&#125;<br>  a+b=b+a <span class="hljs-keyword">\label</span>&#123;eq:commutative&#125;<br><span class="hljs-keyword">\end</span>&#123;equation&#125;<br></code></pre></td></tr></table></figure><h4 id="ä¸Šæ ‡ä¸ä¸‹æ ‡"><a href="#ä¸Šæ ‡ä¸ä¸‹æ ‡" class="headerlink" title="ä¸Šæ ‡ä¸ä¸‹æ ‡"></a>ä¸Šæ ‡ä¸ä¸‹æ ‡</h4><p>ä¸Šæ ‡å’Œä¸‹æ ‡æ˜¯ä¸¤ç§æœ€å¸¸è§çš„æ•°å­¦ç»“æ„ï¼Œå®ƒä»¬çš„å½¢å¼ä¹Ÿå¾ˆæœ´ç´ ï¼šä¸Šæ ‡ä¸€èˆ¬åœ¨åŸç¬¦å·çš„å³ä¸Šæ–¹ï¼Œä¸‹æ ‡ä¸€èˆ¬åœ¨åŸç¬¦å·çš„å³ä¸‹æ–¹ï¼Œæœ‰æ—¶ä¹Ÿåœ¨æ­£ä¸Šæ–¹å’Œæ­£ä¸‹æ–¹ï¼Œä¾‹å¦‚ï¼š</p><p>$$\sum_{i&#x3D;1}^{n}\max_a10^na_i\int_Da^2_i$$</p><p>åœ¨TeXä¸­ï¼Œä¸Šæ ‡ç”¨ç‰¹æ®Šå­—ç¬¦<code>^</code>è¡¨ç¤ºï¼Œä¸‹æ ‡ç”¨ç‰¹æ®Šå­—ç¬¦<code>_</code>è¡¨ç¤ºã€‚åœ¨æ•°å­¦æ¨¡å¼ä¸­ï¼Œç¬¦å·<code>^</code>å’Œ<code>_</code>çš„ç”¨æ³•å·®ä¸å¤šç›¸å½“äºå¸¦ä¸€ä¸ªå‚æ•°çš„å‘½ä»¤ï¼Œå¦‚<strong>$10^n$<strong>å¯ä»¥å¾—åˆ° $10^n$ ,è€Œ</strong>$a_i$<strong>å¯ä»¥å¾—åˆ° <strong>$a_i$</strong> å½“ä¸Šæ ‡å’Œä¸‹æ ‡å¤šä½™ä¸€ä¸ªå­—ç¬¦æ—¶ï¼Œéœ€è¦ä½¿ç”¨åˆ†ç»„ç¡®å®šä¸Šä¸‹æ ‡èŒƒå›´ï¼Œå¦‚</strong>$A_{ij}&#x3D;2^{i+j}$<strong>å¾—åˆ°</strong>$A_{ij}&#x3D;2^{i+j}$</strong><br>ä¸Šæ ‡å’Œä¸‹æ ‡å¯ä»¥åŒæ—¶ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åµŒå¥—ä½¿ç”¨ã€‚åŒæ—¶ä½¿ç”¨ä¸Šæ ‡å’Œä¸‹æ ‡ï¼Œä¸Šä¸‹æ ‡çš„å…ˆåæ¬¡åºå¹¶ä¸é‡è¦ï¼ŒäºŒè€…äº’ä¸å½±å“ï¼ŒåµŒå¥—ä½¿ç”¨ä¸Šä¸‹æ ‡æ—¶ï¼Œåˆ™å¤–å±‚ä¸€å®šè¦ä½¿ç”¨åˆ†ç»„ã€‚æ•°å­¦å…¬å¼ä¸­ç©ºæ ¼æ˜¯ä¸èµ·å®é™…ä½œç”¨çš„ï¼Œé€‚å½“çš„ç©ºæ ¼å¯ä»¥å°†ä»£ç åˆ†éš”å¾—å¥½çœ‹ä¸€äº›ã€‚<br>æ•°å­¦å…¬å¼ä¸­å•å¼•å·æ˜¯ä¸€ç§ç‰¹æ®Šçš„ä¸Šæ ‡ï¼Œè¡¨ç¤ºç”¨ç¬¦å·<code>\prime</code>(å³â€™)åšä¸Šæ ‡ï¼Œå¯ä»¥ä¸ä¸‹æ ‡æ··ç”¨ï¼Œä¹Ÿå¯ä»¥è¿ç»­ä½¿ç”¨ï¼Œä½†ä¸èƒ½ä¸ä¸Šæ ‡ç›´æ¥æ··ç”¨ï¼Œå¦‚ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-built_in">$</span>a=a&#x27;<span class="hljs-built_in">$</span>,<span class="hljs-built_in">$</span>b<span class="hljs-built_in">_</span>0&#x27;=b<span class="hljs-built_in">_</span>0&#x27;&#x27;<span class="hljs-built_in">$</span>,<br><span class="hljs-built_in">$</span>&#123;c&#x27;&#125;<span class="hljs-built_in">^</span>2=(c&#x27;)<span class="hljs-built_in">^</span>2<span class="hljs-built_in">$</span><br></code></pre></td></tr></table></figure><p>å¾—åˆ°<br>$a&#x3D;aâ€™$,$b_0â€™&#x3D;b_0â€™â€™$,${câ€™}^2&#x3D;(câ€™)^2$</p><h4 id="ä¸Šä¸‹ç”»çº¿ä¸èŠ±æ‹¬å·"><a href="#ä¸Šä¸‹ç”»çº¿ä¸èŠ±æ‹¬å·" class="headerlink" title="ä¸Šä¸‹ç”»çº¿ä¸èŠ±æ‹¬å·"></a>ä¸Šä¸‹ç”»çº¿ä¸èŠ±æ‹¬å·</h4><p><code>\overline</code> å’Œ <code>\underline</code>å‘½ä»¤å¯ç”¨æ¥åœ¨å…¬å¼çš„ä¸Šæ–¹å’Œä¸‹æ–¹åˆ’æ¨ªçº¿ï¼Œ<code>overbrace</code> å’Œ <code>underbrace</code>å‘½ä»¤å¯ä»¥åœ¨å…¬å¼ä¸Šæ–¹å’Œä¸‹æ–¹å¸¦ä¸ŠèŠ±æ‹¬å·å¦‚ï¼š</p><table><thead><tr><th align="center">ä»£ç </th><th align="center">ç»“æœ</th></tr></thead><tbody><tr><td align="center"><code>$\overleftarrow&#123;a+b&#125;$</code></td><td align="center">$\overleftarrow{a+b}$</td></tr><tr><td align="center"><code>$\overrightarrow&#123;a+b&#125;$</code></td><td align="center">$\overrightarrow{a+b}$</td></tr><tr><td align="center"><code>$\overleftrightarrow&#123;a+b&#125;$</code></td><td align="center">$\overleftrightarrow{a+b}$</td></tr><tr><td align="center"><code>$\underleftarrow&#123;a-b&#125;$</code></td><td align="center">$\underleftarrow{a-b}$</td></tr><tr><td align="center"><code>$\underrightarrow&#123;a-b&#125;$</code></td><td align="center">$\underrightarrow{a-b}$</td></tr><tr><td align="center"><code>$\underleftrightarrow&#123;a-b&#125;$</code></td><td align="center">$\underleftrightarrow{a-b}$</td></tr><tr><td align="center"><code>$\vec x = \overrightarrow&#123;AB&#125;$</code></td><td align="center">$\vec x &#x3D; \overrightarrow{AB}$</td></tr><tr><td align="center"><code>$\overbrace&#123;a+b+c&#125; = \underbrace&#123;1+2+3&#125;$</code></td><td align="center">$\overbrace{a+b+c} &#x3D; \underbrace{1+2+3}$</td></tr></tbody></table><p>è¿˜å¯ä»¥ä½¿ç”¨ä¸Šä¸‹æ ‡åœ¨èŠ±æ‹¬å·ä¸Šåšæ ‡æ³¨</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-built_in">$</span><span class="hljs-built_in">$</span> (<span class="hljs-keyword">\overbrace</span>&#123;a<span class="hljs-built_in">_</span>0,a<span class="hljs-built_in">_</span>1,...,a<span class="hljs-built_in">_</span>n&#125;<span class="hljs-built_in">^</span>&#123;<span class="hljs-keyword">\text</span>&#123;å…± <span class="hljs-built_in">$</span>n+1<span class="hljs-built_in">$</span> é¡¹&#125;&#125;) = (<span class="hljs-keyword">\underbrace</span>&#123;0,0,...,0&#125;<span class="hljs-built_in">_</span>n,1) <span class="hljs-built_in">$</span><span class="hljs-built_in">$</span><br></code></pre></td></tr></table></figure><p>$$ (\overbrace{a_0,a_1,â€¦,a_n}^{\text{å…± $n+1$ é¡¹}}) &#x3D; (\underbrace{0,0,â€¦,0}_n,1) $$</p><h4 id="åˆ†å¼"><a href="#åˆ†å¼" class="headerlink" title="åˆ†å¼"></a>åˆ†å¼</h4><p>åœ¨LaTeXä¸­åˆ†å¼ç”¨<code>\frace&lt;åˆ†å­&gt;&lt;åˆ†æ¯&gt;</code>å¾—åˆ°ï¼Œå¦‚ï¼š<br><code>$$ \frac 12 + \frac 1a = \frac&#123;2+a&#125;&#123;2a&#125; $$</code>  $ \frac 12 + \frac 1a &#x3D; \frac{2+a}{2a} $<br>åœ¨è¡Œå†…å…¬å¼å’Œæ˜¾ç¤ºå…¬å¼ä¸­ï¼Œåˆ†å¼çš„å¤§å°æ˜¯ä¸åŒçš„ã€‚è¡Œå†…åˆ†å¼ä¸­åˆ†å­åˆ†æ¯éƒ½ç”¨è¾ƒå°çš„å­—å·æ’ç‰ˆï¼Œä»¥å…è¶…å‡ºæ–‡æœ¬è¡Œçš„é«˜åº¦ã€‚<br>è¿åˆ†å¼æ˜¯ä¸€ç§ç‰¹æ®Šçš„åˆ†å¼ï¼Œamsmathæä¾›çš„<code>\cfrac</code>ä¸“ç”¨äºè¾“å…¥è¿åˆ†å¼ã€‚è¿™ä¸ªå‘½ä»¤å¯ä»¥å¸¦ä¸€ä¸ªå¯é€‰çš„å‚æ•°lã€cã€rï¼Œè¡¨ç¤ºå·¦ã€ä¸­ã€å³ï¼Œé»˜è®¤æ˜¯å±…ä¸­ï¼Œå¦‚ï¼š<br><code>$$ \cfrac&#123;1&#125;&#123;1+\cfrac&#123;2&#125;&#123;1+\cfrac&#123;3&#125;&#123;1+x&#125;&#125;&#125; = \cfrac[r]&#123;1&#125;&#123;1+\cfrac&#123;2&#125;&#123;1+\cfrac[l]&#123;3&#125;&#123;1+x&#125;&#125;&#125; $$</code></p><p>å¾—åˆ°  $$ \cfrac{1}{1+\cfrac{2}{1+\cfrac{3}{1+x}}} &#x3D; \cfrac[r]{1}{1+\cfrac{2}{1+\cfrac[l]{3}{1+x}}} $$<br> <img src="/image/latex/latex_note_six_1.png" alt="ç»“æœ">,<code>markdown</code>å¯¹è¿™ä¸ªæ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼Œç»“æœç”¨å›¾ç‰‡ä»£æ›¿äº†ã€‚<br>è¿˜æœ‰ä¸€äº›ç±»ä¼¼åˆ†æ•°åˆ†æˆä¸Šä¸‹ä¸¤åŠ,å¦‚äºŒé¡¹å¼ç³»æ•°$\binom nk$ï¼Œ<code>amsmath</code>æä¾›äº†<code>\binom</code>æ¥è¾“å…¥äºŒé¡¹å¼ç³»æ•°ï¼Œå…¶ç”¨æ³•ä¸<code>\frac</code>ç±»ä¼¼:</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">`<span class="hljs-built_in">$</span><span class="hljs-built_in">$</span> (a+b)<span class="hljs-built_in">^</span>2 = <span class="hljs-keyword">\binom</span> &#123;20&#125;&#123;02&#125; a<span class="hljs-built_in">^</span>2 + <span class="hljs-keyword">\binom</span> 21 ab + <span class="hljs-keyword">\binom</span> 22 b<span class="hljs-built_in">^</span>2 <span class="hljs-built_in">$</span><span class="hljs-built_in">$</span>`<br></code></pre></td></tr></table></figure><p>$$ (a+b)^2 &#x3D; \binom {20}{02} a^2 + \binom 21 ab + \binom 22 b^2 $$</p><h4 id="æ ¹å¼"><a href="#æ ¹å¼" class="headerlink" title="æ ¹å¼"></a>æ ¹å¼</h4><p>æ ¹å¼åœ¨LaTeXç”¨å•å‚æ•°çš„å‘½ä»¤<code>\sqrt</code>å¾—åˆ°ï¼ŒåŒæ—¶å¯ä»¥å¸¦ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºå¼€æ–¹å¾—æ¬¡æ•°ï¼Œå¦‚ï¼š<br><code>$\sqrt 4 = \sqrt[3]&#123;8&#125; = 2$</code> å¾—åˆ° $\sqrt 4 &#x3D; \sqrt[3]{8} &#x3D; 2$<br>åµŒå¥—ä½¿ç”¨æ ¹å¼æˆ–ä¸å…¶ä»–æ•°å­¦ç»“æ„ç»“åˆä¹Ÿå¾ˆå¸¸è§ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-built_in">$</span><span class="hljs-built_in">$</span> <span class="hljs-keyword">\sqrt</span>[n]&#123;<span class="hljs-keyword">\frac</span>&#123;x<span class="hljs-built_in">^</span>2 + <span class="hljs-keyword">\sqrt</span> 2&#125;&#123;x+y&#125;&#125;<span class="hljs-built_in">$</span><span class="hljs-built_in">$</span><br></code></pre></td></tr></table></figure><p>$$ \sqrt[n]{\frac{x^2 + \sqrt 2}{x+y}}$$<br>å¦‚æœå¼€æ–¹å¾—æ¬¡æ•°ä¸æ˜¯ç®€å•çš„æ•´æ•°ï¼Œæˆ–è€…è¢«å¼€æ–¹å¾—å†…å®¹è¿‡é•¿ï¼Œé€šå¸¸æ”¹ç”¨ç­‰ä»·çš„æŒ‡æ•°å½¢å¼ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-built_in">$</span><span class="hljs-built_in">$</span> (x<span class="hljs-built_in">^</span>p+y<span class="hljs-built_in">^</span>q)<span class="hljs-built_in">^</span>&#123;<span class="hljs-keyword">\frac</span>&#123;1&#125;&#123;1/p+1/q&#125;&#125;<span class="hljs-built_in">$</span><span class="hljs-built_in">$</span><br></code></pre></td></tr></table></figure><p>$$ (x^p+y^q)^{\frac{1}{1&#x2F;p+1&#x2F;q}}$$<br>æœ‰æ—¶å¯èƒ½å¯¹å¼€æ–¹æ¬¡æ•°çš„æ’ç‰ˆä½ç½®ä¸æ»¡æ„ï¼Œå¯ä»¥ç”¨<code>amsmath</code>æä¾›çš„<code>\uproot</code>å’Œ<code>\leftroot</code>å‘½ä»¤è°ƒæ•´ï¼Œå‘½ä»¤å‚æ•°æ˜¯æ•´æ•°ï¼Œç§»åŠ¨çš„å•ä½æ˜¯å¾ˆå°çš„ä¸€æ®µè·ç¦»ï¼Œå¦‚ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-built_in">$</span><span class="hljs-built_in">$</span> <span class="hljs-keyword">\sqrt</span>[<span class="hljs-keyword">\uproot</span>&#123;16&#125;<span class="hljs-keyword">\leftroot</span>&#123;-2&#125;n] &#123;<span class="hljs-keyword">\frac</span>&#123;x<span class="hljs-built_in">^</span>2 + <span class="hljs-keyword">\sqrt</span> 2&#125;&#123;x+y&#125;&#125; <span class="hljs-built_in">$</span><span class="hljs-built_in">$</span><br></code></pre></td></tr></table></figure><h4 id="çŸ©é˜µ"><a href="#çŸ©é˜µ" class="headerlink" title="çŸ©é˜µ"></a>çŸ©é˜µ</h4><p>åœ¨åŸºæœ¬çš„LaTeXä¸­ï¼ŒçŸ©é˜µæ˜¯ç”¨PlainTeXä¸€æ ·çš„å‘½ä»¤<code>\matrix</code>å’Œ<code>\pmatrix</code>,å„ç±»çŸ©é˜µç¯å¢ƒçš„åŒºåˆ«åœ¨äºå¤–é¢çš„æ‹¬å·ä¸åŒï¼š</p><table><thead><tr><th align="center">ç¯å¢ƒ</th><th align="center">ä»£ç </th><th align="center">ç»“æœ</th></tr></thead><tbody><tr><td align="center">matrix</td><td align="center"><code>$$\begin&#123;matrix&#125; 1&amp;0&amp;0\\ 0&amp;1&amp;0\\ 0&amp;0&amp;1\\ \end&#123;matrix&#125;$$</code></td><td align="center">$$\begin{matrix} 1&amp;0&amp;0\\ 0&amp;1&amp;0\\ 0&amp;0&amp;1\\ \end{matrix}$$</td></tr><tr><td align="center">bmatrix</td><td align="center"><code>$$\begin&#123;bmatrix&#125; 1&amp;0&amp;0\\ 0&amp;1&amp;0\\ 0&amp;0&amp;1\\ \end&#123;bmatrix&#125;$$</code></td><td align="center">$$\begin{bmatrix} 1&amp;0&amp;0\\ 0&amp;1&amp;0\\ 0&amp;0&amp;1\\ \end{bmatrix}$$</td></tr><tr><td align="center">vmatrix</td><td align="center"><code>$$\begin&#123;vmatrix&#125; 1&amp;0&amp;0\\ 0&amp;1&amp;0\\ 0&amp;0&amp;1\\ \end&#123;vmatrix&#125;$$</code></td><td align="center">$$\begin{vmatrix} 1&amp;0&amp;0\\ 0&amp;1&amp;0\\ 0&amp;0&amp;1\\ \end{vmatrix}$$</td></tr><tr><td align="center">pmatrix</td><td align="center"><code>$$\begin&#123;pmatrix&#125; 1&amp;0&amp;0\\ 0&amp;1&amp;0\\ 0&amp;0&amp;1\\ \end&#123;pmatrix&#125;$$</code></td><td align="center">$$\begin{pmatrix} 1&amp;0&amp;0\\ 0&amp;1&amp;0\\ 0&amp;0&amp;1\\ \end{pmatrix}$$</td></tr><tr><td align="center">Bmatrix</td><td align="center"><code>$$\begin&#123;Bmatrix&#125; 1&amp;0&amp;0\\ 0&amp;1&amp;0\\ 0&amp;0&amp;1\\ \end&#123;Bmatrix&#125;$$</code></td><td align="center">$$\begin{Bmatrix} 1&amp;0&amp;0\\ 0&amp;1&amp;0\\ 0&amp;0&amp;1\\ \end{Bmatrix}$$</td></tr><tr><td align="center">Vmatrix</td><td align="center"><code>$$\begin&#123;Vmatrix&#125; 1&amp;0&amp;0\\ 0&amp;1&amp;0\\ 0&amp;0&amp;1\\ \end&#123;Vmatrix&#125;$$</code></td><td align="center">$$\begin{Vmatrix} 1&amp;0&amp;0\\ 0&amp;1&amp;0\\ 0&amp;0&amp;1\\ \end{Vmatrix}$$</td></tr></tbody></table><p>åœ¨çŸ©é˜µç¯å¢ƒä¸­ï¼Œä¸åŒçš„åˆ—ç”¨ç¬¦å·<code>&amp;</code>åˆ†éš”ï¼Œè¡Œç”¨<code>\\</code>åˆ†éš”ï¼ŒçŸ©é˜µä¸­æ¯åˆ—å…ƒç´ å±…ä¸­å¯¹é½ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-built_in">$</span><span class="hljs-built_in">$</span><span class="hljs-keyword">\begin</span>&#123;Vmatrix&#125; <br> A<span class="hljs-built_in">_</span>1 <span class="hljs-built_in">&amp;</span> A<span class="hljs-built_in">_</span>2 <span class="hljs-built_in">&amp;</span> A<span class="hljs-built_in">_</span>3 <span class="hljs-keyword">\\</span> <br> B<span class="hljs-built_in">_</span>1 <span class="hljs-built_in">&amp;</span> B<span class="hljs-built_in">_</span>2 <span class="hljs-built_in">&amp;</span> B<span class="hljs-built_in">_</span>3 <span class="hljs-keyword">\\</span> <br> C<span class="hljs-built_in">_</span>1 <span class="hljs-built_in">&amp;</span> C<span class="hljs-built_in">_</span>2 <span class="hljs-built_in">&amp;</span> C<span class="hljs-built_in">_</span>3 <span class="hljs-keyword">\\</span> <br> <span class="hljs-keyword">\end</span>&#123;Vmatrix&#125;<span class="hljs-built_in">$</span><span class="hljs-built_in">$</span><br></code></pre></td></tr></table></figure><p>$$\begin{Vmatrix}  A_1&amp;A_2&amp;A_3\\  B_1&amp;B_2&amp;B_3\\  C_1&amp;C_2&amp;C_3\\  \end{Vmatrix}$$</p><p>åœ¨çŸ©é˜µä¸­ç»å¸¸ä½¿ç”¨å„ç§çœç•¥å·å³<code>\dots</code>ã€<code>\vdots</code>ã€<code>\ddots</code>ã€<code>\iddots</code>,amsmathè¿˜æä¾›äº†å¯ä»¥è·¨å¤šåˆ—çš„çœç•¥å·<code>\hdotsfor&#123;&lt;åˆ—æ•°&gt;&#125;</code>ï¼Œåœ¨è¡Œå…¬å¼ä¸­ï¼Œæœ‰æ—¶éœ€è¦ä½¿ç”¨å¾ˆå°çš„çŸ©é˜µï¼Œè¿™å¯ä»¥ç”±amsmathæä¾›çš„<code>smallmatrix</code>ç¯å¢ƒå¾—åˆ°.</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>LaTeX</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LaTeXç¬”è®°-äº”(è‡ªåŠ¨åŒ–å·¥å…·)</title>
    <link href="/2018/02/27/LaTeX%E7%AC%94%E8%AE%B0-%E4%BA%94/"/>
    <url>/2018/02/27/LaTeX%E7%AC%94%E8%AE%B0-%E4%BA%94/</url>
    
    <content type="html"><![CDATA[<p>è®°å½•ä¸€ä¸‹æŸäº›è‡ªåŠ¨åŒ–çš„å·¥å…·ï¼Œæ¯”å¦‚æ·»åŠ è¶…é“¾æ¥(hyperref)ã€ç´¢å¼•(makeindex)ç­‰</p><span id="more"></span><h4 id="ç”µå­æ–‡æ¡£ä¸è¶…é“¾æ¥"><a href="#ç”µå­æ–‡æ¡£ä¸è¶…é“¾æ¥" class="headerlink" title="ç”µå­æ–‡æ¡£ä¸è¶…é“¾æ¥"></a>ç”µå­æ–‡æ¡£ä¸è¶…é“¾æ¥</h4><p><code>hyperref</code>å®åŒ…å¯ç®—æ˜¯LaTeXæœ€ä¸ºå¤æ‚çš„å®åŒ…ä¹‹ä¸€ï¼Œå®ƒæä¾›äº†å¤§é‡çš„é€‰é¡¹å’Œå‘½ä»¤ï¼Œå®Œæˆå„ç§è®¾ç½®å’ŒåŠŸèƒ½ï¼Œè¿™é‡Œä¸»è¦è®°å½•ä»¥PDFæ ¼å¼è¾“å‡ºæ—¶ï¼Œ<code>hyperref</code>æœ‰å…³æ ‡ç­¾å’Œè¶…é“¾æ¥çš„ä¸€äº›æœ€åŸºæœ¬çš„åŠŸèƒ½å’Œè®¾ç½®ã€‚<br><code>hyperref</code>æœ€åŸºæœ¬çš„ç”¨æ³•éå¸¸ç®€å•ï¼Œå°±æ˜¯ç›´æ¥è°ƒç”¨æ­¤å®åŒ…ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\usepackage</span>&#123;hyperef&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨ctexå®åŒ…æˆ–æ–‡æ¡£ç±»ï¼Œåˆ™å¯ä»¥åŠ <code>hyperef</code>é€‰é¡¹ï¼Œè¿™æ ·å•Šctexå®åŒ…ä¼šè‡ªåŠ¨æ ¹æ®ç¼–ç å’Œç¼–è¯‘æ–¹å¼é€‰æ‹©åˆé€‚çš„é€‰é¡¹ï¼Œé¿å…å‡ºç°ä¹±ç ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\documentclass</span>[hyperref,UTF8]&#123;ctexart&#125;<br></code></pre></td></tr></table></figure><p>å¼•å…¥hyperrefåå†ç¼–è¯‘æ–‡æ¡£æ—¶ï¼Œä¼šæ ¹æ®ç« èŠ‚ç»“æ„ï¼Œè‡ªåŠ¨ç”Ÿæˆç›®å½•ç»“æ„çš„PDFæ–‡æ¡£æ ‡ç­¾ã€‚åŒæ—¶ï¼Œæ­£æ–‡ä¸­çš„ç›®å½•å’Œæ‰€æœ‰äº¤å‰å¼•ç”¨ï¼Œéƒ½ä¼šè‡ªåŠ¨æˆä¸ºè¶…é“¾æ¥ï¼Œå¯ä»¥ç”¨é¼ æ ‡ç‚¹å‡»è·³è½¬åˆ°å¼•ç”¨ä½ç½®ã€‚è¦å¾—åˆ°æ­£ç¡®çš„PDFæ ‡ç­¾ï¼Œä¹Ÿåº”è‡³å°‘è¡¨ä¸€ä¸¤éæ–‡æ¡£ã€‚<br>é™¤äº†ç›´æ¥åŠ åœ¨<code>\usepackage</code>ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>\hypersetup</code>å‘½ä»¤å•ç‹¬è®¾ç½®ã€‚hyperrefçš„é€‰é¡¹å¤§å¤šä½¿ç”¨&lt;é€‰é¡¹&gt;&#x3D;&lt;å€¼&gt;çš„æ–¹å¼è®¾ç½®ï¼Œå¦‚æœæ˜¯å¸ƒå°”ç±»å‹çš„çœŸå‡å€¼é€‰é¡¹(trueæˆ–false),é€šå¸¸å¯ä»¥çœç•¥ä¸ºçœŸçš„å€¼ï¼Œå¸¸è§é€‰é¡¹å¦‚ä¸‹ï¼š</p><table><thead><tr><th align="left">é€‰é¡¹</th><th align="center">ç±»å‹</th><th align="center">é»˜è®¤å€¼</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="left">colorlinks</td><td align="center">å¸ƒå°”</td><td align="center">false</td><td align="center">è¶…é“¾æ¥ç”¨å½©è‰²æ˜¾ç¤º</td></tr><tr><td align="left">bookmarks</td><td align="center">å¸ƒå°”</td><td align="center">true</td><td align="center">ç”ŸæˆPDFç›®å½•ä¹¦ç­¾</td></tr><tr><td align="left">bookmarksopen</td><td align="center">å¸ƒå°”</td><td align="center">false</td><td align="center">åœ¨PDFé˜…è¯»å™¨ä¸­è‡ªåŠ¨æ‰“å¼€ä¹¦ç­¾</td></tr><tr><td align="left">bookmarksnumbered</td><td align="center">å¸ƒå°”</td><td align="center">false</td><td align="center">ç›®å½•ä¹¦ç­¾å¸¦ç¼–å·</td></tr><tr><td align="left">pdfborder</td><td align="center">æ•° æ•° æ•°</td><td align="center">0 0 1</td><td align="center">å½“colorlinkä¸ºå‡æ—¶ï¼Œè¶…é“¾æ¥ç”±å½©è‰²è¾¹æ¡†åŒ…å›´(ä¸ä¼šè¢«æ‰“å°)ã€‚é»˜è®¤å€¼è¡¨ç¤º1ptå®½çš„è¾¹æ¡†ï¼Œå¯ä»¥è®¾ç½®ä¸º0 0 0 è¡¨ç¤ºæ²¡æœ‰è¾¹æ¡†ã€‚</td></tr><tr><td align="left">pdfpagemode</td><td align="center">æ–‡æœ¬</td><td align="center"></td><td align="center">åœ¨PDFé˜…è¯»å™¨ä¸­çš„é¡µé¢æ˜¾ç¤ºæ–¹å¼ï¼Œå¸¸ç”¨å€¼æ˜¯FullScreenï¼Œè¡¨ç¤ºå…¨å±æ˜¾ç¤º</td></tr><tr><td align="left">pdfstartview</td><td align="center">æ–‡æœ¬</td><td align="center">Fit</td><td align="center">åœ¨PDFé˜…è¯»å™¨ä¸­çš„é¡µé¢ç¼©æ”¾å¤§å°ï¼Œé»˜è®¤å€¼Fitè¡¨ç¤ºâ€œé€‚åˆé¡µé¢â€ï¼›å¸¸ç”¨å–å€¼æœ‰é€‚åˆå®½åº¦FitHï¼Œé€‚åˆé«˜åº¦FitV</td></tr><tr><td align="left">pdftitle</td><td align="center">æ–‡æœ¬</td><td align="center"></td><td align="center">æ–‡æ¡£æ ‡é¢˜ï¼Œä¼šåœ¨PDFæ–‡æ¡£å±æ€§ä¸­æ˜¾ç¤º</td></tr><tr><td align="left">pdfauthor</td><td align="center">æ–‡æœ¬</td><td align="center"></td><td align="center">æ–‡æ¡£ä½œè€…ï¼Œä¼šåœ¨PDFæ–‡æ¡£å±æ€§ä¸­æ˜¾ç¤º</td></tr><tr><td align="left">pdfsubject</td><td align="center">æ–‡æœ¬</td><td align="center"></td><td align="center">æ–‡æ¡£ä¸»é¢˜ï¼Œä¼šåœ¨PDFæ–‡æ¡£å±æ€§ä¸­æ˜¾ç¤º</td></tr><tr><td align="left">pdfkeywords</td><td align="center">æ–‡æœ¬</td><td align="center"></td><td align="center">æ–‡æ¡£å…³é”®å­—ï¼Œä¼šåœ¨PDFæ–‡æ¡£å±æ€§ä¸­æ˜¾ç¤º</td></tr><tr><td align="left">é™¤æ­¤ä¹‹å¤–ï¼Œå¯ä»¥ç”¨<code>\url</code>å‘½ä»¤è¾“å‡ºURLåœ°å€ï¼ŒåŒæ—¶ä¹Ÿå…·æœ‰è¶…é“¾æ¥çš„åŠŸèƒ½ã€‚ä¸æ’ç‰ˆçº¯æ–‡æœ¬ä¸åŒï¼Œæ‰¾<code>\url</code>å‘½ä»¤çš„å‚æ•°ä¸­ï¼Œç½‘å€å…è®¸ä½¿ç”¨åˆæ³•ç¬¦å·ç›´æ¥è¾“å…¥ï¼Œå¹¶ä¸”é»˜è®¤ä»¥æ‰“å­—æœºå­—ä½“è¾“å‡ºï¼Œå¦‚æœURLåœ°å€ä¸éœ€è¦è¶…é“¾æ¥çš„æ•ˆæœï¼Œå¯ä»¥æ”¹ç”¨<code>\nolinkurl</code>å‘½ä»¤ã€‚</td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left"><code>\href&#123;&lt;URL&gt;&#125;&#123;æ–‡å­—&#125;</code>å‘½ä»¤å¯ä»¥ç”¨æ¥ä½¿æ–‡å­—äº§ç”ŸæŒ‡å‘URLåœ°å€çš„è¶…é“¾æ¥æ•ˆæœã€‚</td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left"><code>\hyperref[&lt;æ ‡ç­¾&gt;]&#123;&lt;æ–‡å­—&gt;&#125;</code>å‘½ä»¤å¯ä»¥ç”¨æ¥äº§ç”Ÿä½¿æ–‡å­—æ‰§è¡Œæ ‡ç­¾çš„è¶…é“¾æ¥æ•ˆæœï¼Œè¿™é‡Œæ–¹æ‹¬å·ä¸­çš„æ ‡ç­¾ä¸<code>\ref</code>ä½¿ç”¨çš„æ ‡ç­¾ç›¸åŒï¼Œä¸èƒ½çœç•¥ã€‚</td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="left"><code>\hypertarget&#123;&lt;åç§°&gt;&#125;&#123;&lt;æ–‡å­—&gt;&#125;</code>ç”¨æ¥ç»™æ–‡å­—å®šä¹‰å¸¦æœ‰åç§°çš„é“¾æ¥ç‚¹ï¼Œåœ¨æ–‡æ¡£çš„å…¶ä»–åœ°æ–¹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å‘½ä»¤<code>\hyperlink&#123;&lt;åç§°&gt;&#125;&#123;&lt;æ–‡å­—&gt;&#125;</code>è®©å¦ä¸€æ®µæ–‡å­—é“¾æ¥åˆ°æŒ‡å®šåç§°çš„è¿æ¥ç‚¹ã€‚</td><td align="center"></td><td align="center"></td><td align="center"></td></tr></tbody></table><h4 id="åˆ¶ä½œç´¢å¼•"><a href="#åˆ¶ä½œç´¢å¼•" class="headerlink" title="åˆ¶ä½œç´¢å¼•"></a>åˆ¶ä½œç´¢å¼•</h4><p>åœ¨LaTeXä¸­åˆ¶ä½œç´¢å¼•ï¼Œéœ€è¦.texæºæ–‡ä»¶å’Œå¤–éƒ¨ç´¢å¼•ç¨‹åºçš„å…±åŒåä½œã€‚åœ¨.texæºæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€ä¸‹å‡ ä»¶äº‹ï¼š</p><ol><li>åœ¨å¯¼è¨€åŒºä½¿ç”¨<code>\makeindex</code>å‘½ä»¤ï¼Œå¼€å¯ç´¢å¼•æ–‡ä»¶è¾“å‡º</li><li>åœ¨å¯¼è¨€åŒºè°ƒç”¨<code>makeidx</code>å®åŒ…ï¼Œå¼€å¯ç´¢å¼•åˆ—è¡¨æ’ç‰ˆåŠŸèƒ½</li><li>åœ¨æ­£æ–‡ä¸­éœ€è¦ç´¢å¼•çš„å…³é”®å­—å¤„ä½¿ç”¨<code>\index</code>å‘½ä»¤ï¼Œç”Ÿæˆç´¢å¼•é¡¹</li><li>åœ¨éœ€è¦ç”Ÿæˆç´¢å¼•çš„åœ°æ–¹(é€šå¸¸æ˜¯æ–‡æ¡£çš„æœ«å°¾)ï¼Œä½¿ç”¨<code>\printindex</code>å‘½ä»¤ï¼Œå®é™…è¾“å‡ºå¤„ç†å¥½çš„ç´¢å¼•åˆ—è¡¨</li></ol><p>ä¾‹å­å¦‚ä¸‹ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\documentclass</span>[hyperref,UTF8]&#123;ctexart&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;makeidx&#125;<br><span class="hljs-keyword">\makeindex</span><br><span class="hljs-comment">% ...</span><br>è¥¿æ–¹ç§°å‹¾è‚¡å®šç†ä¸ºæ¯•è¾¾å“¥æ‹‰æ–¯å®šç†ï¼Œ<br><span class="hljs-keyword">\index</span>&#123;æ¯•è¾¾å“¥æ‹‰æ–¯å®šç†&#125;<br>å°†å‹¾è‚¡å®šç†çš„å‘ç°å½’åŠŸäºå…¬å…ƒå‰ 6 <br><span class="hljs-comment">%...</span><br>å‹¾è‚¡å®šç†å¯ä»¥ç”¨ç°ä»£è¯­è¨€è¡¨è¿°å¦‚ä¸‹<span class="hljs-keyword">\index</span>&#123;å‹¾è‚¡å®šç†&#125;ï¼š<br><span class="hljs-comment">%...</span><br><span class="hljs-keyword">\printindex</span><br><span class="hljs-keyword">\end</span>&#123;document&#125;<br></code></pre></td></tr></table></figure><p>ä¸å‚è€ƒæ–‡çŒ®ç±»ä¼¼ï¼Œè¦ç”Ÿæˆç´¢å¼•éœ€è¦å¤šæ¬¡ç¼–è¯‘å’Œå¤–éƒ¨å·¥å…·<code>Makeindex</code>çš„é…åˆï¼Œç¼–è¯‘å¸¦ç´¢å¼•çš„æ–‡æ¡£éœ€è¦ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tex">pdflatex ***<br>makeindex ***<br>pdflatex ***<br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šå‘½ä»¤å¯ä»¥åœ¨IDEçš„ç¼–è¯‘é€‰é¡¹ä¸­æ‰¾åˆ°<br>åœ¨<code>\index</code>çš„å‚æ•°ä¸­å¯ä»¥ä½¿ç”¨ç¬¦å·<code>!</code>æ¥åˆ†éš”ä¸åŒå±‚æ¬¡çš„ç´¢å¼•é¡¹ï¼Œè¿™æ ·å°†å¾—åˆ°åˆ†çº§çš„ç´¢å¼•é¡¹ã€‚é»˜è®¤æ”¯æŒä¸‰çº§åˆ—è¡¨ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\index</span>&#123;language&#125;<br><span class="hljs-keyword">\index</span>&#123;language!Chinese&#125;<br><span class="hljs-keyword">\index</span>&#123;language!Chinese!dialect&#125;<br><span class="hljs-keyword">\index</span>&#123;language!English&#125;<br></code></pre></td></tr></table></figure><p>åœ¨<code>\index</code>çš„å‚æ•°åé¢ä½¿ç”¨ç¬¦å·<code>|</code>åˆ™å¯ä»¥ä½¿ç”¨å‡ ä¸ªç‰¹æ®Šçš„åŠŸèƒ½ï¼ŒåŸºæœ¬çš„ç”¨æ³•æ˜¯ä½¿ç”¨<code>|see&#123;&lt;æ¡ç›®&gt;&#125;</code>ä¸<code>|seealse&#123;æ¡ç›®&#125;</code>è¡¨ç¤ºå‚è€ƒæ¡ç›®ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\index</span>&#123;beta&#125;<br><span class="hljs-keyword">\index</span>&#123;Beta|see&#123;beta&#125;&#125;<br><span class="hljs-keyword">\index</span>&#123;gamma|seealso&#123;beta&#125;&#125;<br></code></pre></td></tr></table></figure><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>LaTeX</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LaTeXç¬”è®°(å››)--æ–‡æ¡£ç»“æ„å±‚æ¬¡</title>
    <link href="/2018/02/11/LaTeX%E7%AC%94%E8%AE%B0-%E5%9B%9B/"/>
    <url>/2018/02/11/LaTeX%E7%AC%94%E8%AE%B0-%E5%9B%9B/</url>
    
    <content type="html"><![CDATA[<p>ä¸‹é¢æ˜¯ä»‹ç»æ–‡æ¡£çš„å±‚æ¬¡ç»“æ„</p><span id="more"></span><h4 id="æ ‡é¢˜å’Œæ ‡é¢˜é¡µ"><a href="#æ ‡é¢˜å’Œæ ‡é¢˜é¡µ" class="headerlink" title="æ ‡é¢˜å’Œæ ‡é¢˜é¡µ"></a>æ ‡é¢˜å’Œæ ‡é¢˜é¡µ</h4><p>åœ¨LaTeXä¸­ï¼Œä½¿ç”¨æ ‡é¢˜é€šå¸¸åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šå£°æ˜æ ‡é¢˜å†…å®¹å’Œå®é™…è¾“å‡ºæ ‡é¢˜ã€‚æ¯ä¸ªæ ‡é¢˜åˆ™ç”±æ ‡é¢˜ã€ä½œè€…ã€æ—¥æœŸç­‰éƒ¨åˆ†ç»„æˆã€‚<br>å£°æ˜æ ‡é¢˜ã€ä½œè€…å’Œæ—¥æœŸåˆ†åˆ«ä½¿ç”¨<code>\title</code>ï¼Œ<code>\author</code>ï¼Œ<code>\date</code>å‘½ä»¤ã€‚å®ƒä»¬éƒ½å¸¦æœ‰ä¸€ä¸ªå‚æ•°ï¼Œé‡Œé¢å¯ä»¥ä½¿ç”¨<code>\\</code>è¿›è¡Œæ¢è¡Œã€‚æ ‡é¢˜çš„å£°æ˜é€šå¸¸æ”¾åœ¨å¯¼è¨€åŒºï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨æ ‡é¢˜è¾“å‡ºä¹‹å‰çš„ä»»ä½•ä½ç½®ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\documentclass</span>[UTF8,titlepage]&#123;ctexart&#125;<br><span class="hljs-keyword">\title</span> &#123;è¯­è¨€<span class="hljs-keyword">\thanks</span>&#123;æœ¬æ–‡ç”±XXåŸºé‡‘ä¼šèµåŠ©&#125;&#125;<br><span class="hljs-keyword">\author</span>&#123;huangyuan<span class="hljs-keyword">\thanks</span>&#123;sdut&#125;<span class="hljs-keyword">\\</span>sdut <span class="hljs-keyword">\and</span> xuan<span class="hljs-keyword">\thanks</span>&#123;sdut&#125;<span class="hljs-keyword">\\</span>sdut&#125;<br><span class="hljs-keyword">\date</span>&#123;æˆŠæˆŒåˆæ˜¥&#125;<br></code></pre></td></tr></table></figure><p><code>\author</code>å®šä¹‰çš„å‚æ•°å¯ä»¥åˆ†è¡Œï¼Œä¸€èˆ¬ç¬¬ä¸€è¡Œæ˜¯ä½œè€…å§“åï¼Œåé¢æ˜¯ä½œè€…çš„å•ä½ã€è”ç³»æ–¹å¼ç­‰ï¼Œå¦‚æœæ–‡æ¡£æœ‰å¤šä¸ªä½œè€…ï¼Œåˆ™å¤šä¸ªä½œè€…ä¹‹é—´ç”¨<code>\and</code>åˆ†éš”ã€‚<br>åœ¨å£°æ˜æ ‡é¢˜å’Œä½œè€…æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>\thanks</code>å‘½ä»¤äº§ç”Ÿä¸€ç§ç‰¹æ®Šçš„è„šæ³¨ï¼Œå®ƒé»˜è®¤ä½¿ç”¨ç‰¹æ®Šç¬¦å·å’Œç¼–å·ï¼Œé€šå¸¸ç”¨æ¥è¡¨ç¤ºæ–‡ç« çš„è‡´è°¢ã€æ–‡æ¡£çš„ç‰ˆæœ¬ã€ä½œè€…çš„è¯¦ç»†ä¿¡æ¯ç­‰ã€‚<br>ä½¿ç”¨<code>\maketitle</code>å‘½ä»¤å¯ä»¥è¾“å‡ºå‰é¢å£°æ˜çš„æ ‡é¢˜ï¼Œé€šå¸¸<code>\maketitle</code>æ˜¯æ–‡æ¡£ä¸­documentç¯å¢ƒåé¢çš„ç¬¬ä¸€ä¸ªå‘½ä»¤ã€‚æ•´ä¸ªæ ‡é¢˜çš„æ ¼å¼æ˜¯é¢„è®¾å¥½çš„ï¼Œåœ¨<code>article</code>æˆ–<code>ctexart</code>ä¸­ï¼Œæ ‡é¢˜ä¸å•ç‹¬æˆé¡µï¼Œå¯ä»¥ä½¿ç”¨æ–‡æ¡£ç±»çš„é€‰é¡¹<code>titlepage</code>å’Œ<code>notitlepage</code>æ¥è®¾ç½®æ ‡é¢˜æ˜¯å¦å•ç‹¬æˆé¡µã€‚</p><h4 id="åˆ’åˆ†ç« èŠ‚"><a href="#åˆ’åˆ†ç« èŠ‚" class="headerlink" title="åˆ’åˆ†ç« èŠ‚"></a>åˆ’åˆ†ç« èŠ‚</h4><p>LaTeXçš„æ ‡å‡†æ–‡æ¡£ç±»å¯ä»¥åˆ’åˆ†å¤šå±‚ç« èŠ‚ï¼Œå¯ä»¥ä½¿ç”¨6åˆ°7ä¸ªå±‚æ¬¡çš„ç« èŠ‚ã€‚</p><table><thead><tr><th align="center">å±‚æ¬¡</th><th align="center">åç§°</th><th align="center">å‘½ä»¤</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">-1</td><td align="center">part(éƒ¨åˆ†)</td><td align="center"><code>\part</code></td><td align="center">å¯é€‰çš„æœ€é«˜å±‚</td></tr><tr><td align="center">0</td><td align="center">chapter(ç« )</td><td align="center"><code>\chapter</code></td><td align="center">report,bookæˆ–ctexrep,ctexbookæ–‡æ¡£ç±»çš„æœ€é«˜å±‚</td></tr><tr><td align="center">1</td><td align="center">section(èŠ‚)</td><td align="center"><code>\section</code></td><td align="center">articleæˆ–ctexartç±»çš„æœ€é«˜å±‚</td></tr><tr><td align="center">2</td><td align="center">subsection(å°èŠ‚)</td><td align="center"><code>\subsection</code></td><td align="center"></td></tr><tr><td align="center">3</td><td align="center">subsubsection(å°å°èŠ‚)</td><td align="center"><code>\subsubsection</code></td><td align="center">report,bookæˆ–ctexrep,ctexbookæ–‡æ¡£ç±»é»˜è®¤ä¸ç¼–å·ï¼Œä¸ç¼–ç›®å½•</td></tr><tr><td align="center">4</td><td align="center">paragraph(æ®µ)</td><td align="center"><code>\paragraph</code></td><td align="center">é»˜è®¤ä¸ç¼–å·ï¼Œä¸ç¼–ç›®å½•</td></tr><tr><td align="center">5</td><td align="center">subparagraph(å°æ®µ)</td><td align="center"><code>\subparagraph</code></td><td align="center">é»˜è®¤ä¸ç¼–å·ï¼Œä¸ç¼–ç›®å½•</td></tr><tr><td align="center">ä¸€ä¸ªæ–‡æ¡£çš„æœ€é«˜å±‚ç« èŠ‚å¯ä»¥æ˜¯<code>\part</code>ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨<code>\part</code>ç›´æ¥ä½¿ç”¨<code>\chapter</code>(å¯¹bookå’Œreportç­‰)æˆ–<code>\section</code>(å¯¹article)ã€‚é™¤<code>\part</code>å¤–ï¼Œåªæœ‰åœ¨ä¸Šä¸€å±‚ç« èŠ‚å­˜åœ¨æ—¶æ‰èƒ½ä½¿ç”¨ä¸‹ä¸€ç« èŠ‚ï¼Œå¦åˆ™ç¼–å·ä¼šå‡ºç°é”™è¯¯ã€‚åœ¨<code>\part</code>ä¸‹é¢ï¼Œ<code>\chapter</code>æˆ–<code>\section</code>æ˜¯è¿ç»­ç¼–å·çš„ï¼›åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œä¸‹ä¸€çº§çš„ç« èŠ‚éšä¸Šä¸€èŠ‚çš„ç¼–å·å¢åŠ ä¼šæ¸…é›¶é‡æ–°ç¼–å·ã€‚å¯ä»¥ä½¿ç”¨å¸¦æ˜Ÿå·çš„ç« èŠ‚å‘½ä»¤(å¦‚<code>\chapter*</code>)æ¥è¡¨ç¤ºä¸ç¼–å·ã€ä¸ç¼–ç›®å½•çš„ç« èŠ‚ã€‚</td><td align="center"></td><td align="center"></td><td align="center"></td></tr></tbody></table><h4 id="å¤šæ–‡ä»¶ç¼–è¯‘"><a href="#å¤šæ–‡ä»¶ç¼–è¯‘" class="headerlink" title="å¤šæ–‡ä»¶ç¼–è¯‘"></a>å¤šæ–‡ä»¶ç¼–è¯‘</h4><p>å¯¹äºä¸€ç¯‡åªæœ‰å‡ é¡µçš„æ–‡ç« ï¼ŒæŠŠæ‰€æœ‰çš„å†…å®¹éƒ½æ”¾è¿›ä¸€ä¸ªtexæºæ–‡ä»¶å°±è¶³å¤Ÿäº†ï¼Œä½†æ˜¯å¦‚æœè¦æ’ç‰ˆæ›´é•¿çš„å†…å®¹ï¼Œå•ä¸€æ–‡ä»¶ç¼–è¯‘çš„æ–¹å¼å°±ä¸é‚£ä¹ˆæ–¹ä¾¿å¯ï¼Œå¯ä»¥æŒ‰ç…§æ–‡æ¡£çš„é€»è¾‘å±‚æ¬¡ï¼ŒæŠŠæ•´ä¸ªæ–‡æ¡£åˆ†æˆå¤šä¸ªtexæºæ–‡ä»¶ï¼Œè¿™æ ·æ–‡æ¡£çš„å†…å®¹æ›´ä¾¿äºæ£€ç´¢å’Œç®¡ç†ï¼Œä¹Ÿé€‚åˆå¤§å‹æ–‡æ¡£çš„å¤šäººååŒç¼–å†™ã€‚<br>LaTeXæä¾›<code>\include&#123;&lt;æ–‡ä»¶å&gt;&#125;</code>å‘½ä»¤å¯ä»¥ç”¨æ¥å¯¼å…¥ä¸¤ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ä½œä¸ºä¸€ä¸ªç« èŠ‚ï¼Œæ–‡ä»¶åä¸ç”¨å¸¦<code>.tex</code>æ‰©å±•åï¼Œ<code>\include</code>å‘½ä»¤ä¼šåœ¨ä¹‹å‰å’Œä¹‹åä½¿ç”¨<code>\clearpage</code>æˆ–<code>\cleardoublepage</code>å¦èµ·æ–°é¡µï¼ŒåŒæ—¶å°†è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹è´´åˆ°<code>\include</code>å‘½ä»¤æ‰€åœ¨çš„æ–‡å­—ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥ç»„ç»‡ä¸€ç¯‡è¾ƒé•¿çš„æ–‡ç« ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\documentclass</span>[UTF8,titlepage]&#123;ctexart&#125;<br><span class="hljs-keyword">\title</span> &#123;è¯­è¨€&#125;<br><span class="hljs-keyword">\author</span>&#123;huangyuan<span class="hljs-keyword">\thanks</span>&#123;sdut&#125;<span class="hljs-keyword">\\</span>SDUT <span class="hljs-keyword">\and</span> xuan<span class="hljs-keyword">\thanks</span>&#123;sdut&#125;<span class="hljs-keyword">\\</span>SDUT&#125;<br><span class="hljs-keyword">\date</span>&#123;æˆŠæˆŒåˆæ˜¥&#125;<br><span class="hljs-keyword">\begin</span>&#123;document&#125;<br><span class="hljs-keyword">\maketitle</span><br><span class="hljs-keyword">\tableofcontents</span><br><span class="hljs-keyword">\include</span>&#123;lang-natural&#125;<br><span class="hljs-keyword">\include</span>&#123;lang-computer&#125;<br><span class="hljs-keyword">\end</span>&#123;document&#125;<br></code></pre></td></tr></table></figure><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">%lang-natural.tex ä¸èƒ½å•ç‹¬ç¼–è¯‘</span><br><span class="hljs-keyword">\chapter</span>&#123;è‡ªç„¶è¯­è¨€&#125;<br>è¿™æ˜¯è‡ªç„¶è¯­è¨€ç« èŠ‚<br></code></pre></td></tr></table></figure><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">% lang-computer.tex ä¸èƒ½å•ç‹¬ç¼–è¯‘</span><br><span class="hljs-keyword">\chapter</span>&#123;è®¡ç®—æœºè¯­è¨€&#125;<br>è¿™æ˜¯è®¡ç®—æœºè¯­è¨€ç« èŠ‚<br></code></pre></td></tr></table></figure><p>åˆ’åˆ†æ–‡æ¡£åï¼Œå¯ä»¥é€šè¿‡ä¸»æ–‡ä»¶æ¥æ§åˆ¶ç¼–è¯‘æ•´ä¸ªæ–‡æ¡£çš„ä¸€ç« æˆ–è€…æŸå‡ ç« ã€‚å½“ç„¶å¯ä»¥æŠŠä¸è¦çš„ç« èŠ‚æ³¨é‡Šæ‰ï¼Œæ›´å¥½çš„åŠæ³•æ˜¯é€šè¿‡<code>\includeonly&#123;&lt;æ–‡ä»¶åˆ—è¡¨&gt;&#125;</code>å‘½ä»¤ï¼Œå…¶ä¸­&lt;æ–‡ä»¶åˆ—è¡¨&gt;æ˜¯ç”¨è‹±æ–‡éƒ½å¥½éš”å¼€çš„è‹¥å¹²æ–‡ä»¶åã€‚åœ¨å¯¼è¨€åŒºä½¿ç”¨<code>\includeonly</code>å‘½ä»¤ä»¥åï¼Œåªæœ‰åœ¨æ–‡ä»¶åˆ—è¡¨ä¸­çš„æ–‡ä»¶æ‰ä¼šè¢«å®é™…çš„å¼•å…¥ä¸»æ–‡ä»¶ã€‚æ›´å¥½çš„æ˜¯ï¼Œå¦‚æœä»¥å‰æ›¾ç»å®Œæ•´çš„ç¼–è¯‘è¿‡æ•´ä¸ªæ–‡æ¡£ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨<code>\includeonly</code>é€‰æ‹©ç¼–è¯‘æ—¶ï¼ŒåŸæ¥çš„ç« èŠ‚ç¼–å·ã€é¡µç ã€äº¤å‰å¼•ç”¨ç­‰ä»ç„¶ä¼šä¿ç•™ä¸ºå‰ä¸€æ¬¡ç¼–è¯‘çš„æ•ˆæœï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\documentclass</span>[UTF8,titlepage]&#123;ctexart&#125;<br><span class="hljs-keyword">\title</span> &#123;è¯­è¨€&#125;<br><span class="hljs-keyword">\author</span>&#123;huangyuan<span class="hljs-keyword">\thanks</span>&#123;sdut&#125;<span class="hljs-keyword">\\</span>SDUT <span class="hljs-keyword">\and</span> xuan<span class="hljs-keyword">\thanks</span>&#123;sdut&#125;<span class="hljs-keyword">\\</span>SDUT&#125;<br><span class="hljs-keyword">\includeonly</span>&#123;lang-natural&#125;<br><span class="hljs-keyword">\date</span>&#123;æˆŠæˆŒåˆæ˜¥&#125;<br><span class="hljs-keyword">\begin</span>&#123;document&#125;<br><span class="hljs-keyword">\maketitle</span><br><span class="hljs-keyword">\tableofcontents</span><br><span class="hljs-keyword">\include</span>&#123;lang-natural&#125;<br><span class="hljs-keyword">\include</span>&#123;lang-computer&#125;<br><span class="hljs-keyword">\end</span>&#123;document&#125;<br></code></pre></td></tr></table></figure><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨<code>\include</code>å‘½ä»¤æ—¶ï¼Œæœ€å¥½ä¸è¦åœ¨å­æ–‡ä»¶ä¸­æ–°å®šä¹‰è®¡æ•°å™¨ã€å£°æ˜æ–°å­—ä½“ï¼Œå¦åˆ™åœ¨ä½¿ç”¨<code>\includeonly</code>æ—¶ï¼Œä¼šå› ä¸ºæ‰¾ä¸åˆ°å‡ºç°åœ¨è¾…åŠ©æ–‡ä»¶ä¸­è€Œåœ¨æºæ–‡ä»¶ä¸­ç¼ºå¤±çš„è®¡æ•°å™¨è€Œå‡ºé”™ã€‚<br>æ¯”<code>\include</code>å‘½ä»¤æ›´ä¸€èˆ¬çš„æ˜¯<code>\input</code>å‘½ä»¤ï¼Œå®ƒç›´æ¥æŠŠæ–‡ä»¶çš„å†…å®¹å¤åˆ¶åˆ°<code>\input</code>å‘½ä»¤æ‰€åœ¨çš„æ–‡å­—ï¼Œä¸åšå…¶ä»–å¤šä½™çš„æ“ä½œã€‚<code>\input</code>å‘½ä»¤æ¥å—ä¸€ä¸ªæ–‡ä»¶åå‚æ•°ï¼Œæ–‡ä»¶åå¯ä»¥å¸¦æ‰©å±•åï¼Œä¹Ÿå¯ä»¥ä¸å¸¦æ‰©å±•å(æ­¤æ—¶è®¤ä¸ºæ‰©å±•åæ˜¯.tex)ã€‚<br>ä¸€èˆ¬å¯ä»¥æŠŠå¯¼è¨€åŒºã€å¤æ‚å›¾æ ‡ä»£ç æ”¾åœ¨ä¸€ä¸ªå•ç‹¬æ–‡ä»¶ä¸­ï¼Œç„¶ååœ¨ä¸»æ–‡ä»¶ä¸­ä½¿ç”¨<code>\input</code>æ’å…¥ã€‚åœ¨<strong>è¢«å¼•å…¥çš„æ–‡ä»¶</strong>æœ«å°¾ï¼Œå¯ä»¥ä½¿ç”¨<code>\endinput</code>å‘½ä»¤æ˜¾å¼çš„ç»“æŸæ–‡ä»¶çš„è¯»å…¥ï¼Œåœ¨<code>\endinput</code>å‘½ä»¤çš„åé¢ï¼Œå°±å¯ä»¥ç›´æ¥å†™ä¸€äº›æ³¨é‡Šæ€§çš„æ–‡å­—ï¼Œè€Œä¸å¿…å†åŠ å…¥æ³¨é‡Šç¬¦å·ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>LaTeX</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LaTeXç¬”è®°(ä¸‰)(æ‚)</title>
    <link href="/2018/02/11/LaTeX%E7%AC%94%E8%AE%B0-%E4%B8%89/"/>
    <url>/2018/02/11/LaTeX%E7%AC%94%E8%AE%B0-%E4%B8%89/</url>
    
    <content type="html"><![CDATA[<p>å‰ä¸¤ç¯‡ç¬”è®°è®°å½•ä¸‹äº†å†™ä¸€ç¯‡å°æ–‡ç« æ‰€éœ€è¦çš„ä¸œè¥¿ï¼Œè¿™ä¸€ç‰‡å°±è®°å½•ä¸‹ä¸€äº›é›¶é›¶æ•£æ•£çš„ä¸œè¥¿ï¼Œè®¡ç®—æœºä¸“ä¸šçš„å˜›ï¼Œåªå…³å¿ƒä¸­æ–‡å’Œè‹±æ–‡ï¼Œåƒä»€ä¹ˆå¾·è¯­ã€æ³•è¯­ä¹‹ç±»çš„ä¸œè¥¿å°±ä¸åœ¨è€ƒè™‘èŒƒå›´å†…äº†ï¼Œç”¨çš„æ—¶å€™å†å»æŸ¥ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><span id="more"></span><h5 id="æ ‡ç‚¹"><a href="#æ ‡ç‚¹" class="headerlink" title="æ ‡ç‚¹"></a>æ ‡ç‚¹</h5><ul><li>åœ¨LaTeXä¸­é‡åˆ°å•å¼•å·ä¸åŒå¼•å·è¿ç»­å‡ºç°çš„æƒ…å½¢ï¼Œåœ¨ä¸­é—´ä½¿ç”¨<code>\,</code>å‘½ä»¤åˆ†å¼€ï¼š<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tex">``<span class="hljs-keyword">\,</span>`A&#x27; or `B&#x27;<span class="hljs-keyword">\,</span>&#x27;&#x27; he asked.<br>``It&#x27;s Knuth&#x27;s bookã€‚&#x27;&#x27;, he saidã€‚<br></code></pre></td></tr></table></figure>è¿™é‡Œ<code>\,</code>å‘½ä»¤äº§ç”Ÿå¾ˆå°çš„é—´è·ï¼Œä½†æ˜¯LaTexå¹¶ä¸ä¼šå¿½ç•¥ä»¥ç¬¦å·å‘½åçš„å®å‰åçš„ç©ºæ ¼ï¼Œæ‰€ä»¥åœ¨å®ƒçš„å‰åéƒ½ä¸è¦åŠ å¤šä½™çš„ç©ºæ ¼ã€‚ç¬¦å·<code>&#39;</code>åŒæ—¶ä¹Ÿæ˜¯è¡¨ç¤ºæ‰€æœ‰æ ¼å’Œçœå­—çš„æ’‡å¥½ã€‚</li><li>é™¤äº†åœ¨æ•°å­¦æ¨¡å¼ä¸­è¡¨ç¤ºå‡å·ï¼Œç¬¦å·<code>-</code>åœ¨LaTeXæ­£æ–‡ä¸­ä¹Ÿæœ‰å¤šç§ç”¨é€”ï¼šå•ç‹¬ä½¿ç”¨å®ƒæ˜¯è¿å­—ç¬¦(hyphen);ä¸¤ä¸ªè¿ç”¨<code>--</code>æ˜¯en dash,ç”¨æ¥è¡¨ç¤ºæ•°å­—èŒƒå›´;ä¸‰ä¸ªè¿ç”¨<code>---</code>æ˜¯ em dashï¼Œå³ç ´æŠ˜å·ã€‚ä¸è¿‡åœ¨ä¸­æ–‡ä¹¦å†™ä¸­ï¼Œè¡¨ç¤ºæ•°å­¦èŒƒå›´ä¹Ÿå¸¸ä½¿ç”¨ç¬¦å·<code>~</code>(æ•°å­¦æ¨¡å¼çš„ç¬¦å·$\sim$)ã€‚</li><li>è¥¿æ–‡çš„çœç•¥å·(ellipsis)ä½¿ç”¨<code>\ldots</code>æˆ–<code>\dots</code>å‘½ä»¤äº§ç”Ÿï¼Œç›¸æ¯”ç›´æ¥è¾“å…¥ä¸‰ä¸ªå¥å·ï¼Œæ‹‰å¼€çš„é—´è·è¦åˆç†çš„å¤šã€‚<h4 id="æ°´å¹³é—´è·"><a href="#æ°´å¹³é—´è·" class="headerlink" title="æ°´å¹³é—´è·"></a>æ°´å¹³é—´è·</h4>åœ¨æ­£æ–‡ä¸­å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¡¨ç¤ºä¸å¯æ¢è¡Œçš„æ°´å¹³é—´è·<br>ä¸å¯æ¢è¡Œçš„æ°´å¹³é—´è·</li></ul><table><thead><tr><th align="center">å‘½ä»¤</th><th align="center">é—´è·</th></tr></thead><tbody><tr><td align="center"><code>\thinspace</code> æˆ–<code>\,</code></td><td align="center">0.1667em</td></tr><tr><td align="center"><code>\negthinspace</code> æˆ–<code>\!</code></td><td align="center">-0.1667em</td></tr><tr><td align="center"><code>\enspace</code></td><td align="center">0.5em</td></tr><tr><td align="center"><code>\nobreakspace</code> æˆ–<code>~</code></td><td align="center">ç©ºæ ¼</td></tr></tbody></table><p>å¯æ¢è¡Œçš„æ°´å¹³é—´è·</p><table><thead><tr><th align="center">å‘½ä»¤</th><th align="center">é—´è·</th></tr></thead><tbody><tr><td align="center"><code>\quad</code></td><td align="center">1em</td></tr><tr><td align="center"><code>\qquad</code> æˆ–<code>\!</code></td><td align="center">2em</td></tr><tr><td align="center"><code>\enskip</code></td><td align="center">0.5em</td></tr><tr><td align="center"><code>\ç©ºæ ¼</code></td><td align="center">ç©ºæ ¼</td></tr></tbody></table><p>å½“ä¸Šé¢çš„å‘½ä»¤ä¸­æ²¡æœ‰åˆé€‚çš„è·ç¦»æ—¶ï¼Œå¯ä»¥ç”¨<code>\hspace&#123;è·ç¦»&#125;</code>å‘½ä»¤æ¥äº§ç”ŸæŒ‡å®šçš„æ°´å¹³é—´è·(è¿™é‡Œçš„<code>\,</code>ç”¨æ¥åˆ†éš”æ•°å­—å’Œå•ä½)</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">Space<span class="hljs-keyword">\hspace</span>&#123;1cm&#125;1<span class="hljs-keyword">\,</span>cm<br></code></pre></td></tr></table></figure><p><code>\hspace</code>å‘½ä»¤äº§ç”Ÿçš„è·ç¦»æ˜¯å¯æ–­è¡Œçš„ï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹(å¼ºåˆ¶æ–­è¡Œçš„è¡Œé¦–)ï¼Œæ”¹å‘½ä»¤äº§ç”Ÿçš„è·ç¦»ä¼šè¢«å¿½ç•¥ï¼Œæ­¤æ—¶å¯ä»¥ç”¨å¸¦æ˜Ÿå·çš„å‘½ä»¤<code>\hspace*&#123;è·ç¦»&#125;</code>é˜»æ­¢è·ç¦»è¢«å¿½ç•¥ã€‚</p><h4 id="ç›’å­"><a href="#ç›’å­" class="headerlink" title="ç›’å­"></a>ç›’å­</h4><p>ç›’å­(box)æ˜¯TeXä¸­çš„åŸºæœ¬å¤„ç†å•ä½ã€‚<br>æœ€ç®€å•çš„å‘½ä»¤æ˜¯<code>\mbox&#123;å†…å®¹&#125;</code>,å®ƒäº§ç”Ÿä¸€ä¸ªæ ¼å­ï¼Œå†…å®¹ä»¥å·¦å³æ¨¡å¼æ’åˆ—ï¼Œå¯ä»¥ç”¨å®ƒè¡¨ç¤ºä¸å…è®¸æ–­è¡Œçš„å†…å®¹ã€‚<br><code>\makebox</code>ä¸<code>\mbox</code>ç±»ä¼¼ï¼Œä½†å¯ä»¥å¸¦ä¸¤ä¸ªå¯é€‰å‚æ•°ï¼ŒæŒ‡å®šç›’å­çš„å®½åº¦å’Œå¯¹é½æ–¹å¼ï¼š<br><code>\makebox[&lt;å®½åº¦&gt;][&lt;ä½ç½®&gt;]&#123;&lt;å†…å®¹&gt;&#125;</code><br>å¯¹é½å‚æ•°å¯ä»¥å–c(å±…ä¸­)ã€lã€rã€s(åˆ†æ•£),é»˜è®¤å±…ä¸­ã€‚<br><code>\fbox</code> å’Œ <code>\framebox</code>äº§ç”Ÿå¸¦è¾¹æ¡†çš„ç›’å­ï¼Œè¯­æ³•å’Œ<code>\mbox</code>ã€<code>\makebox</code>ç±»ä¼¼</p><h4 id="åˆ—è¡¨ç¯å¢ƒ"><a href="#åˆ—è¡¨ç¯å¢ƒ" class="headerlink" title="åˆ—è¡¨ç¯å¢ƒ"></a>åˆ—è¡¨ç¯å¢ƒ</h4><p>åˆ—è¡¨æ˜¯å¸¸ç”¨çš„æ–‡æœ¬æ ¼å¼ï¼ŒLaTeXæ ‡å‡†æ–‡æ¡£ç±»æä¾›äº†ä¸‰ç§åˆ—è¡¨ç¯å¢ƒï¼šå¸¦ç¼–å·çš„<code>enumerate</code>ç¯å¢ƒã€ä¸ç¼–å·çš„<code>itemize</code>ç¯å¢ƒå’Œä½¿ç”¨å…³é”®å­—çš„<code>description</code>ç¯å¢ƒã€‚åœ¨åˆ—è¡¨å†…éƒ¨ä½¿ç”¨<code>\item</code>å‘½ä»¤å¼€å§‹ä¸€ä¸ªåˆ—è¡¨é¡¹ï¼Œå®ƒå¯ä»¥å¸¦ä¸€ä¸ªå¯é€‰å‚æ•°è¡¨ç¤ºæ‰‹åŠ¨ç¼–å·æˆ–å…³é”®å­—</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\begin</span>&#123;enumerate&#125;<br><span class="hljs-keyword">\item</span> ä¸­æ–‡<br><span class="hljs-keyword">\item</span> English<br><span class="hljs-keyword">\end</span>&#123;enumerate&#125;<br><br><span class="hljs-keyword">\begin</span>&#123;itemize&#125;<br><span class="hljs-keyword">\item</span> ä¸­æ–‡<br><span class="hljs-keyword">\item</span> English<br><span class="hljs-keyword">\end</span>&#123;itemize&#125;<br></code></pre></td></tr></table></figure><p>descriptionç¯å¢ƒæ€»æ˜¯ä½¿ç”¨<code>\item</code>å‘½ä»¤çš„å¯é€‰å‚æ•°ï¼ŒæŠŠå®ƒä½œä¸ºæ¡ç›®çš„å…³é”®å­—åŠ ç²—ã€‚</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\begin</span>&#123;description&#125;<br><span class="hljs-keyword">\item</span>[ä¸­æ–‡] ä¸­æ–‡<br><span class="hljs-keyword">\item</span>[è‹±æ–‡] English<br><span class="hljs-keyword">\end</span>&#123;description&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä¸‰ç§åˆ—è¡¨ç¯å¢ƒå¯ä»¥åµŒå¥—ä½¿ç”¨(æœ€å¤šå››å±‚)</p><h4 id="æŠ„å½•å’Œä»£ç ç¯å¢ƒ"><a href="#æŠ„å½•å’Œä»£ç ç¯å¢ƒ" class="headerlink" title="æŠ„å½•å’Œä»£ç ç¯å¢ƒ"></a>æŠ„å½•å’Œä»£ç ç¯å¢ƒ</h4><p><code>\verb</code>å‘½ä»¤å¯ç”¨æ¥è¡¨ç¤ºæ­æ¸©ä¸­çš„æŠ„å½•ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š<br><code>\verb&lt;ç¬¦å·&gt;&lt;æŠ„å½•å†…å®¹&gt;&lt;ç¬¦å·&gt;</code><br>åœ¨<code>\verb</code>åï¼Œä¸¤ä¸ªç¬¦å·ç›¸åŒï¼Œè¡¨ç¤ºèµ·å§‹ç¬¦å·å’Œæœ«å°¾ç¬¦å·ï¼Œä¸¤ä¸ªç¬¦å·ä¹‹é—´çš„å†…å®¹ä¼šåŸæ ·è¾“å‡ºã€‚<br>ä½¿ç”¨å¸¦æ˜Ÿå·çš„å‘½ä»¤<code>\verb*</code>åˆ™å¯ä»¥ä½¿è¾“å‡ºçš„ç©ºæ ¼ä¸ºå¯è§çš„ã€‚<br>å¤§æ®µçš„æŠ„å½•å¯ä»¥ä½¿ç”¨<code>verbatim</code>ç¯å¢ƒï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\begin</span>&#123;verbatim&#125;<span class="hljs-string"></span><br><span class="hljs-string">#! user/bin /env perl</span><br><span class="hljs-string">$name = &#x27;&#x27;guy&#x27;&#x27;;</span><br><span class="hljs-string">print &#x27;&#x27;Hello,$name!\n&#x27;&#x27;</span><br><span class="hljs-string"></span><span class="hljs-keyword">\end</span>&#123;verbatim&#125;<br></code></pre></td></tr></table></figure><p>åŒæ ·å¯ä»¥ä½¿ç”¨å¸¦æ˜Ÿå·çš„<code>verbatim*</code>ç¯å¢ƒè¾“å‡ºå¯è§ç©ºæ ¼ã€‚<br>å¦‚æœæƒ³åœ¨ç¨‹åºä»£ç ä¸­å¢åŠ è¯­æ³•é«˜äº®åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨<strong>listings</strong>å®åŒ…</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\begin</span>&#123;lstlisting&#125;[language=java]<br>class Test&#123;<br>public static void main(String ... args)&#123;<br>System.out.println(&#x27;&#x27;Hello Java&#x27;&#x27;);<br>&#125;<br>&#125;<br><span class="hljs-keyword">\end</span>&#123;lstlisting&#125;<br></code></pre></td></tr></table></figure><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>LaTeX</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LaTeXç¬”è®°(äºŒ)(å¼€ç¯‡)</title>
    <link href="/2018/01/27/LaTeX%E7%AC%94%E8%AE%B0-%E4%BA%8C/"/>
    <url>/2018/01/27/LaTeX%E7%AC%94%E8%AE%B0-%E4%BA%8C/</url>
    
    <content type="html"><![CDATA[<p>æ¥ä¸Šç¯‡ï¼Œå†™å¥½çš„texæ–‡ä»¶åœ¨è¿™ <a href="https://github.com/huangyuanlove/latex_practice/blob/master/latex(1)/chapter_one.tex">https://github.com/huangyuanlove/latex_practice/blob/master/latex(1)/chapter_one.tex</a></p><h5 id="å†™ä¸ªæ¡†æ¶"><a href="#å†™ä¸ªæ¡†æ¶" class="headerlink" title="å†™ä¸ªæ¡†æ¶"></a>å†™ä¸ªæ¡†æ¶</h5><p>æ—¢ç„¶æœ‰ç›®æ ‡äº†ï¼Œæˆ‘ä»¬å…ˆå†™ä¸ªå¤§æ¦‚çš„æ¡†æ¶ï¼Œç„¶åå¾€é‡Œé¢å¡«å……å†…å®¹</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-comment">% coding:UTF-8</span><br><br><br><span class="hljs-keyword">\documentclass</span>[UTF8]&#123;ctexart&#125;<br><br><span class="hljs-keyword">\title</span>&#123;æ‚è°ˆå‹¾è‚¡å®šç†&#125;<br><span class="hljs-keyword">\author</span>&#123;xuan&#125;<br><span class="hljs-keyword">\date</span>&#123;<span class="hljs-keyword">\today</span>&#125;<br><br><span class="hljs-keyword">\bibliographystyle</span>&#123;plain&#125;<br><br><span class="hljs-keyword">\begin</span>&#123;document&#125;<br><br><span class="hljs-keyword">\maketitle</span><br><span class="hljs-keyword">\tableofcontents</span><br><span class="hljs-keyword">\section</span>&#123;å‹¾è‚¡å®šç†åœ¨å¤ä»£&#125;<br><span class="hljs-keyword">\section</span>&#123;å‹¾è‚¡å®šç†çš„è¿‘ä»£å½¢å¼&#125;<br><span class="hljs-keyword">\bibliography</span>&#123;math&#125;<br><br><span class="hljs-keyword">\end</span>&#123;document&#125;<br></code></pre></td></tr></table></figure><span id="more"></span><ul><li>ä»¥ <code>%</code>å¼€å¤´çš„è¡Œæ˜¯æ³¨é‡Šï¼Œæºæ–‡ä»¶ä¸€è¡Œä¸­ç™¾åˆ†å·åé¢çš„å†…å®¹éƒ½ä¼šè¢«å¿½ç•¥ã€‚</li><li>ç¬¬<strong>4</strong>è¡Œæ˜¯æ–‡æ¡£ç±»ï¼Œå› ä¸ºæ˜¯ä¸­æ–‡çš„çŸ­æ–‡ï¼Œæ‰€ä»¥ç”¨çš„æ˜¯<code>ctexart</code>ï¼Œå¹¶ç”¨[UTF8]é€‰é¡¹è¯´æ˜ç¼–ç æ–¹å¼ã€‚</li><li>ç¬¬<strong>6-8</strong>è¡Œå£°æ˜äº†æ–‡ç« çš„æ ‡é¢˜ã€ä½œè€…ã€æ—¥æœŸã€‚å…¶ä¸­çš„<code>\today</code>æ˜¯å½“å‰æ—¥æœŸã€‚ä½†æ˜¯è¿™äº›ä¿¡æ¯æ˜¯é€šè¿‡<strong>14</strong>è¡Œçš„<code>\maketitle</code>æ’ç‰ˆçš„ã€‚</li><li>ç¬¬<strong>10</strong>è¡Œçš„<code>\bibliographystyle</code>å£°æ˜å‚è€ƒæ–‡çŒ®çš„æ ¼å¼ã€‚<br>ä»¥ä¸Šåœ¨<code>\begin&#123;document&#125;</code>ä¹‹å‰çš„éƒ¨åˆ†ç§°ä¸º<code>å¯¼è¨€åŒº(preamble)</code>ï¼Œå¯¼è¨€åŒºé€šå¸¸ç”¨æ¥å¯¹æ–‡æ¡£çš„æ€§è´¨åšä¸€äº›è®¾ç½®ï¼Œæˆ–è‡ªå®šä¹‰ä¸€äº›å‘½ä»¤ã€‚</li><li>ç¬¬<strong>12-20</strong>è¡Œä»¥<code>\begin&#123;document&#125;</code>å’Œ<code>\end&#123;socument&#125;</code>å£°æ˜äº†ä¸€ä¸ªdocumentç¯å¢ƒï¼Œé‡Œé¢æ˜¯è®ºæ–‡çš„æ­£æ–‡éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥è¾“å‡ºçš„éƒ¨åˆ†ã€‚</li><li>ç¬¬<strong>14</strong>è¡Œçš„<code>\maketitle</code>è¾“å‡ºè®ºæ–‡æ ‡é¢˜ã€‚</li><li>ç¬¬<strong>15</strong>è¡Œçš„<code>\tableofcontents</code>è¾“å‡ºç›®å½•ã€‚</li><li>ç¬¬<strong>16-17</strong>è¡Œä¸¤ä¸ª<code>\section</code>å¼€å§‹æ–°çš„ä¸€èŠ‚ã€‚</li><li>ç¬¬<strong>18</strong>è¡Œçš„<code>\bibliography&#123;math&#125;</code>åˆ™æ˜¯ä»æ–‡çŒ®æ•°æ®åº“math(è¿™é‡Œçš„mathæ–‡çŒ®æ•°æ®åº“æ˜¯æˆ‘ä»¬è‡ªå·±ç¼–è¾‘çš„ä¸€ä¸ªæ–‡ä»¶)ä¸­è·å–æ–‡çŒ®ä¿¡æ¯ï¼Œæ‰“å°å‚è€ƒæ–‡çŒ®åˆ—è¡¨ã€‚<blockquote><p>ä¸ºäº†æ ¼å¼æ¸…æ™°ï¼Œæºæ–‡ä»¶ä½¿ç”¨äº†ä¸€äº›ç©ºè¡Œä½œä¸ºåˆ†éš”ï¼Œåœ¨æ­£æ–‡å¤–çš„éƒ¨åˆ†ï¼Œç©ºè¡Œä¸ä»£è¡¨ä»»ä½•æ„ä¹‰</p></blockquote></li></ul><h5 id="å¡«å†™æ­£æ–‡"><a href="#å¡«å†™æ­£æ–‡" class="headerlink" title="å¡«å†™æ­£æ–‡"></a>å¡«å†™æ­£æ–‡</h5><p>è‡ªå·±æŠŠå¤§æ®µçš„æ–‡å­—å…ˆå†™ä¸Šå†è¯´ï¼Œè‡ªå·±è¯•è¯•æŸ¥çœ‹æ’ç‰ˆä¹‹åæ ¼å¼ã€‚</p><ul><li>ä½¿ç”¨ç©ºè¡Œåˆ†æ®µï¼Œ</li><li>æ®µè½çš„ç¬¬ä¸€è¡Œç¼©è¿›ä¸éœ€è¦è‡ªå·±æ‰“ç©ºæ ¼<h5 id="å‘½ä»¤ä¸ç¯å¢ƒ"><a href="#å‘½ä»¤ä¸ç¯å¢ƒ" class="headerlink" title="å‘½ä»¤ä¸ç¯å¢ƒ"></a>å‘½ä»¤ä¸ç¯å¢ƒ</h5><h6 id="è„šæ³¨"><a href="#è„šæ³¨" class="headerlink" title="è„šæ³¨"></a>è„šæ³¨</h6>è„šæ³¨æ˜¯åœ¨æ­£æ–‡<strong>æ¬§å‡ é‡Œå¾—</strong>çš„åé¢ç”¨è„šæ³¨å‘½ä»¤<code>\footnote</code>å¾—åˆ°çš„ã€‚<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tex">è¯¥å®šç†çš„ä¸¥æ ¼è¡¨è¿°å’Œè¯æ˜åˆ™è§äºæ¬§å‡ é‡Œå¾—<br><span class="hljs-keyword">\footnote</span>&#123;æ¬§å‡ é‡Œå¾—ï¼Œçº¦å…¬å…ƒå‰330--275å¹´ã€‚&#125;<br></code></pre></td></tr></table></figure>åœ¨è¿™é‡Œï¼Œ<code>\footnote</code>åé¢èŠ±æ‹¬å·å†…çš„éƒ¨åˆ†æ˜¯å‘½ä»¤çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è„šæ³¨çš„å†…å®¹ã€‚<br>æ³¨æ„ä¸€ä¸ªç»†èŠ‚ï¼Œåœ¨è¡¨ç¤ºèµ·æ­¢å¹´ä»½æ—¶ï¼Œç”¨ä¸¤ä¸ªå‡å·(â€“)ï¼Œé€šå¸¸ç”¨æ¥è¡¨ç¤ºæ•°å­—çš„èŒƒå›´ã€‚<br>æ–‡ä¸­è¿˜ä½¿ç”¨<code>\emph</code>å‘½ä»¤æ”¹å˜å­—ä½“çš„å½¢çŠ¶ï¼Œè¡¨ç¤ºå¼ºè°ƒçš„å†…å®¹ï¼š<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">çš„æ•´æ•°ç§°ä¸º<span class="hljs-keyword">\emph</span>&#123;å‹¾è‚¡æ•°&#125;<br></code></pre></td></tr></table></figure>ä¸€ä¸ªLaTeXå‘½ä»¤(å®)çš„æ ¼å¼ä¸ºï¼š<br>æ— å‚æ•°ï¼š<code>\command</code><br>æœ‰nä¸ªå‚æ•°:<code>\command&lt;arg1&gt;&lt;arg2&gt;&lt;arg3&gt;</code><br>æœ‰å¯é€‰å‚æ•°:<code>\command&lt;argâ€”â€”opt&gt;&lt;arg2&gt;&lt;arg3&gt;</code><br>å‘½ä»¤éƒ½ä¸€åæ–œçº¿<code>\</code>å¼€å¤´ï¼Œåæ¥å‘½ä»¤åï¼Œå¯ä»¥å¸¦ä¸€äº›å‚æ•°ï¼Œå¿…é€‰å‚æ•°ä½¿ç”¨èŠ±æ‹¬å·æ‹¬èµ·æ¥ï¼Œå¯é€‰å‚æ•°ä½¿ç”¨æ–¹æ‹¬å·æ‹¬èµ·æ¥ã€‚<br>å¼•ç”¨çš„å†…å®¹è¿™æ˜¯åœ¨æ­£æ–‡ä¸­ä½¿ç”¨<code>quote</code>ç¯å¢ƒå¾—åˆ°çš„ã€‚<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs tex">æˆ‘å›½ã€Šå‘¨é«€ç®—ç»ã€‹è½½å•†é«˜ï¼ˆçº¦å…¬å…ƒå‰12ä¸–çºªï¼‰ç­”å‘¨å…¬é—®ï¼š<br><span class="hljs-keyword">\begin</span>&#123;quote&#125;<br>å‹¾å¹¿ä¸‰ï¼Œè‚¡ä¿®å››ï¼Œç»éš…äº”ã€‚<br><span class="hljs-keyword">\end</span>&#123;quote&#125;<br></code></pre></td></tr></table></figure>quoteç¯å¢ƒå³ä»¥<code>\begin&#123;quote&#125;</code>å’Œ<code>\end&#123;quote&#125;</code>ä¸ºèµ·æ­¢ä½ç½®çš„éƒ¨åˆ†ï¼Œçªå‡ºå¼•ç”¨éƒ¨åˆ†ã€‚ä½†æ˜¯quoteç¯å¢ƒä¸èƒ½æ”¹å˜å¼•ç”¨å†…å®¹çš„å­—ä½“ï¼Œå› æ­¤è¿˜éœ€è¦å†ä½¿ç”¨æ”¹å˜å­—ä½“çš„å‘½ä»¤<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\begin</span>&#123;quote&#125;<br><span class="hljs-keyword">\kaishu</span><span class="hljs-keyword">\zihao</span>&#123;-5&#125; å¼•ç”¨çš„å†…å®¹<br><span class="hljs-keyword">\end</span>&#123;quote&#125;<br></code></pre></td></tr></table></figure>è¿™é‡Œ<code>\zihao</code>æ˜¯ä¸€ä¸ªæœ‰å‚æ•°çš„å‘½ä»¤ï¼Œé€‰æ‹©å­—å·(-5å°±æ˜¯å°äº”å·)ï¼Œè€Œ<code>\kaishu</code>åˆ™æ˜¯æ²¡æœ‰å‚æ•°çš„å‘½ä»¤ï¼ŒæŠŠå­—ä½“åˆ‡æ¢ä¸ºæ¥·ä¹¦ï¼Œæ³¨æ„ç”¨ç©ºæ ¼æŠŠå‘½ä»¤å’Œåé¢çš„æ–‡å­—åˆ†å¼€ã€‚<br>æ–‡ç« çš„æ‘˜è¦ä¹Ÿæ˜¯åœ¨<code>\maketitle</code>ä¹‹åç”¨<code>abstract</code>ç¯å¢ƒç”Ÿæˆçš„ï¼š<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\begin</span>&#123;abstract&#125;<br>åˆšå¼€å§‹å­¦<span class="hljs-keyword">\LaTeX</span>,å¦‚æœå­¦ä¹ ä¸æ˜¯ä¸ºäº†è£…é€¼ï¼Œé‚£ä¸€åˆ‡å°†æ¯«æ— æ„ä¹‰ã€‚<br><span class="hljs-keyword">\end</span>&#123;abstract&#125;<br></code></pre></td></tr></table></figure>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ç¯å¢ƒï¼Œæ¯”å¦‚ä¸Šé¢çš„çªå‡ºå¼•ç”¨çš„ç¯å¢ƒï¼š<br>åœ¨å¯¼è¨€åŒº<code>\maketitle</code>ä¹‹å<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\newenvironment</span>&#123;myquote&#125;&#123;<span class="hljs-keyword">\begin</span>&#123;quote&#125;<span class="hljs-keyword">\kaishu</span><span class="hljs-keyword">\zihao</span>&#123;-5&#125;&#125;&#123;<span class="hljs-keyword">\end</span>&#123;quote&#125;&#125;<br></code></pre></td></tr></table></figure>ä¹‹åæˆ‘ä»¬åœ¨çªå‡ºå¼•ç”¨çš„æ—¶å€™å°±å¯ä»¥è¿™ä¹ˆå†™ï¼š<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs tex">æˆ‘å›½ã€Šå‘¨é«€ç®—ç»ã€‹è½½å•†é«˜ï¼ˆçº¦å…¬å…ƒå‰12ä¸–çºªï¼‰ç­”å‘¨å…¬é—®ï¼š<br><span class="hljs-keyword">\begin</span>&#123;myquote&#125;<br>å‹¾å¹¿ä¸‰ï¼Œè‚¡ä¿®å››ï¼Œç»éš…äº”ã€‚<br><span class="hljs-keyword">\end</span>&#123;myquote&#125;<br></code></pre></td></tr></table></figure>æ–‡ç« ç¬¬äºŒèŠ‚çš„å®šç†ï¼Œæ˜¯ç”¨ä¸€ç±»å®šç†ç¯å¢ƒè¾“å‡ºçš„ï¼Œå®šç†ç¯å¢ƒæ˜¯ä¸€ç±»ç¯å¢ƒï¼Œåœ¨ä½¿ç”¨å‰éœ€è¦å…ˆåœ¨å¯¼è¨€åŒºåšå®šä¹‰ï¼š<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\newtheorem</span>&#123;thm&#125;&#123;å®šç†&#125;<br></code></pre></td></tr></table></figure>è¿™å°±å®šä¹‰äº†ä¸€ä¸ª<code>thm</code>ç¯å¢ƒï¼Œå®šç†ç¯å¢ƒå¯ä»¥æœ‰ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå°±æ˜¯å®šç†çš„åå­—ï¼Œæ‰€ä»¥æ–‡ç« ä¸­çš„å‹¾è‚¡å®šä¹‰å°±å¯ä»¥ç”±æ–°å®šä¹‰çš„<code>thm</code>ç¯å¢ƒå¾—åˆ°ï¼š<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\begin</span>&#123;thm&#125;[å‹¾è‚¡å®šç†]<br>ç›´è§’ä¸‰è§’å½¢æ–œè¾¹çš„å¹³æ–¹ç­‰äºä¸¤è…°çš„å¹³æ–¹å’Œã€‚<br><span class="hljs-keyword">\end</span>&#123;thm&#125;<br></code></pre></td></tr></table></figure><h6 id="æ•°å­¦å…¬å¼"><a href="#æ•°å­¦å…¬å¼" class="headerlink" title="æ•°å­¦å…¬å¼"></a>æ•°å­¦å…¬å¼</h6>æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯æŠŠå…¬å¼ç”¨<code>$</code>ç¬¦å·æ‹¬èµ·æ¥ï¼Œæ¯”å¦‚<code>$a+b$</code>å°±å¯ä»¥å¾—åˆ°æ–œä½“çš„<em>a+b</em>ï¼Œè¿™ç§å¤¹åœ¨è¡Œæ–‡ä¸­çš„å…¬å¼ç§°ä¸ºâ€æ­£æ–‡å…¬å¼(in-text formula)â€æˆ–â€è¡Œå†…å…¬å¼(inline formula)â€ã€‚ä¸ºäº†æ–¹ä¾¿å¼•ç”¨ï¼Œç»å¸¸ä¼šç»™å…¬å¼ç¼–å·ï¼Œè¿™ç§å…¬å¼è¢«ç§°ä¸ºâ€æ˜¾å¼å…¬å¼â€æˆ–â€åˆ—è¡¨å…¬å¼(display formula)â€,ä½¿ç”¨<code>equation</code>ç¯å¢ƒå°±å¯ä»¥æ–¹ä¾¿åœ°è¾“å…¥è¿™ç§å…¬å¼ã€‚<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\begin</span>&#123;equation&#125;<br>a(a+b) = ab + ac<br><span class="hljs-keyword">\end</span>&#123;equation&#125;<br></code></pre></td></tr></table></figure> é”®ç›˜ä¸Šæ²¡æœ‰çš„ç¬¦å·ï¼Œå°±éœ€è¦ä½¿ç”¨å‘½ä»¤æ¥è¾“å…¥ï¼Œâ€è§’â€ç¬¦å·â€âˆ â€,å°±å¯ä»¥ç”¨<code>\angle</code>è¾“å…¥(è™½ç„¶æœ‰çš„è¾“å…¥æ³•ä¹Ÿæä¾›äº†æ•°å­¦ç¬¦å·çš„é€‰é¡¹ï¼Œä½†æ˜¯ä¸å»ºè®®è¿™ä¹ˆåšï¼Œå¯ä»¥è‡ªå·±è¯•è¯•æœ‰ä»€ä¹ˆåŒºåˆ«)ã€‚<br> æ•°å­¦å…¬å¼è¿˜æœ‰ä¸Šçº¿æ ‡ã€åˆ†å¼ã€æ ¹å¼ç­‰ï¼Œåœ¨å‹¾è‚¡å®šç†çš„è¡¨è¾¾ä¸­ï¼Œå°±ç”¨åˆ°äº†ä¸Šæ ‡è¡¨ç¤ºä¹˜æ–¹ï¼š<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\begin</span>&#123;equation&#125;<br>AB<span class="hljs-built_in">^</span>2 = BC<span class="hljs-built_in">^</span>2 + AC<span class="hljs-built_in">^</span>2<br><span class="hljs-keyword">\end</span>&#123;equation&#125;<br></code></pre></td></tr></table></figure> ç¬¦å·<code>^</code>ç”¨æ¥å¼•å…¥ä¸€ä¸ªä¸Šæ ‡ï¼Œ<code>_</code>åŒ»ç”¨ä¸€ä¸ªä¸‹æ ‡ï¼Œå¦‚æœä¸Šä¸‹æ ‡è¯†å¤šä¸ªå­—ç¬¦ï¼Œåˆ™éœ€è¦ä½¿ç”¨èŠ±æ‹¬å·åˆ†ç»„ï¼š<code>2^&#123;10&#125;</code>ã€‚<br> æ‰€ä»¥90Â°æ€ä¹ˆè¾“å…¥ï¼Œåœ¨latexé»˜è®¤çš„å­—ä½“ä¸­ï¼Œå¹¶æ²¡æœ‰ä¸“ç”¨äºè¡¨ç¤ºè§’åº¦çš„ç¬¦å·ï¼Œè¾“å…¥è§’åº¦çš„æ—¶å€™æ˜¯é€šè¿‡ä¸Šæ ‡è¾“å…¥çš„:<code>^\circ</code>ï¼Œå…¶ä¸­<code>\circ</code>é€šå¸¸ç”¨æ¥è¡¨ç¤ºå‡½æ•°ç¬¦å·çš„äºŒå…ƒè¿ç®—ç¬¦<code>â—‹</code>ï¼Œæˆ‘ä»¬æŠŠå®ƒçš„ä¸Šæ ‡å€Ÿç”¨æ¥è¡¨ç¤ºè§’åº¦ã€‚</li></ul><h6 id="æ’å…¥å›¾ç‰‡"><a href="#æ’å…¥å›¾ç‰‡" class="headerlink" title="æ’å…¥å›¾ç‰‡"></a>æ’å…¥å›¾ç‰‡</h6><p> ä½¿ç”¨å›¾ç‰‡æœ‰ä¸¤ç§é€”å¾„ï¼šä¸€ä¸ªæ˜¯æ’å…¥äº‹å…ˆå‡†å¤‡å¥½çš„å›¾ç‰‡ï¼ŒäºŒæ˜¯ä½¿ç”¨latexä»£ç ç›´æ¥åœ¨æ–‡æ¡£ä¸­ç”»å›¾ã€‚<br> æ’å›¾åŠŸèƒ½ä¸æ˜¯ç”±latexå†…æ ¸ç›´æ¥æä¾›ï¼Œè€Œæ˜¯æœ‰<strong>graphicx</strong>å®åŒ…æä¾›çš„ï¼Œè¦ä½¿ç”¨<strong>graphicx</strong>å®åŒ…çš„æ’å›¾åŠŸèƒ½å‘¢ä¸ªï¼Œéœ€è¦åœ¨å¯¼è¨€åŒºä½¿ç”¨<code>\usepackage</code>å‘½ä»¤å¼•å…¥å®åŒ…ï¼š<br> <figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\documentclass</span>&#123;ctexart&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;graphicx&#125;<br></code></pre></td></tr></table></figure><br> å¼•å…¥<strong>graphicx</strong>å®åŒ…åï¼Œå°±å¯ä»¥ä½¿ç”¨<code>\includegraphics</code>å‘½ä»¤æ’å›¾äº†ï¼š<br> <figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\includegraphic</span>[width=3cm]&#123;gougu.png&#125;<br></code></pre></td></tr></table></figure></p><p>è¿™é‡Œ<code>\includegraphic</code>æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œæ–¹æ‹¬å·ä¸­å¯é€‰å‚æ•°<code>width=3cm</code>è®¾ç½®å›¾å½¢åœ¨æ–‡æ¡£ä¸­æ˜¾ç¤ºçš„å®½åº¦ä¸º3cmï¼Œç¬¬äºŒä¸ªå‚æ•°åˆ™æ˜¯å›¾ç‰‡çš„æ–‡ä»¶å(å’Œæºæ–‡ä»¶åŒçº§)ï¼Œè¿˜æœ‰ä¸€äº›ç±»ä¼¼çš„å‚æ•°å¦‚scale(ç¼©æ”¾)ã€heightç­‰ã€‚<br>é™¤äº†ä¸€äº›å¾ˆå°çš„å›¾æ ‡ï¼Œæˆ‘ä»¬å¾ˆå°‘è¿›è¡Œå›¾æ–‡æ··æ’ï¼Œè€Œæ˜¯ä½¿ç”¨å•ç‹¬çš„ç¯å¢ƒåˆ—å‡ºï¼Œè€Œä¸”å¾ˆå¤§çš„å›¾å½¢å¦‚æœä½ç½®æ˜¯å›ºå®šï¼Œä¼šç»™åˆ†é¡µé€ æˆå›°éš¾ï¼Œå› æ­¤ï¼Œé€šå¸¸éƒ½æŠŠå›¾åƒæ”¾åœ¨ä¸€ä¸ªå¯ä»¥å˜åŠ¨ç›¸å¯¹ä½ç½®çš„ç¯å¢ƒä¸­ï¼Œç§°ä¸ºæµ®åŠ¨ä½“ã€‚åœ¨æµ®åŠ¨ä½“ä¸­è¿˜å¯ä»¥ç»™å›¾ç‰‡åŠ å…¥è¯´æ˜æ€§æ ‡é¢˜ã€‚</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\begin</span>&#123;figure&#125;[ht]<br>  <span class="hljs-keyword">\centering</span><br>  <span class="hljs-keyword">\includegraphics</span>[width=3cm]&#123;gougu.png&#125;<br>  <span class="hljs-keyword">\caption</span> &#123;<span class="hljs-keyword">\kaishu</span><span class="hljs-keyword">\zihao</span>&#123;-5&#125; å®‹èµµçˆ½åœ¨ã€Šå‘¨é«€ç®—ç»ã€‹æ³¨ä¸­åšçš„å¼¦å›¾ï¼ˆä»¿åˆ¶ï¼‰ï¼Œè¯¥å›¾ç»™å‡ºäº†å‹¾è‚¡å®šç†çš„ä¸€ä¸ªæå…·å¯¹ç§°ç¾å¾·è¯æ˜ã€‚&#125;<br>  <span class="hljs-keyword">\label</span>&#123;fig:gougu&#125;<br><span class="hljs-keyword">\end</span>&#123;figure&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œç¬¬1è¡Œå’Œç¬¬6è¡Œä½¿ç”¨äº†<code>figure</code>ç¯å¢ƒï¼Œå°±æ˜¯æ’å›¾ä½¿ç”¨çš„æµ®åŠ¨ä½“ç¯å¢ƒï¼Œ<code>figure</code>ç¯å¢ƒæœ‰å¯é€‰å‚æ•°<code>[ht]</code>ï¼Œè¡¨ç¤ºæµ®åŠ¨ä½“å¯ä»¥å‡ºç°åœ¨ç¯å¢ƒå‘¨å›´çš„æ–‡æœ¬æ‰€åœ¨å¤„å’Œä¸€é¡µçš„é¡¶éƒ¨ã€‚<code>figure</code>ç¯å¢ƒå†…éƒ¨ç›¸å½“äºæ™®é€šçš„æ®µè½(é»˜è®¤æ²¡æœ‰ç¼©è¿›)ï¼›ç¬¬äºŒè¡Œç”¨ç”Ÿå‘½<code>\centering</code>è¡¨ç¤ºåé¢çš„å†…å®¹å±…ä¸­ï¼›ç¬¬3è¡Œæ’å…¥å›¾ç‰‡ï¼›ç¬¬4è¡Œä½¿ç”¨<code>\caption</code>å‘½ä»¤ç»™æ’å›¾åŠ ä¸Šè‡ªåŠ¨ç¼–å·å’Œæ ‡é¢˜ï¼›ç¬¬5è¡Œçš„<code>\lable</code>å‘½ä»¤åˆ™ç»™å›¾å½¢å®šä¹‰ä¸€ä¸ªæ ‡ç­¾ï¼Œè¿™ä¸ªæ ‡ç­¾å°±å¯ä»¥åœ¨æ–‡ç« çš„å…¶ä»–åœ°æ–¹å¼•ç”¨<code>\caption</code>äº§ç”Ÿçš„ç¼–å·ã€‚</p><h6 id="ä½¿ç”¨è¡¨æ ¼"><a href="#ä½¿ç”¨è¡¨æ ¼" class="headerlink" title="ä½¿ç”¨è¡¨æ ¼"></a>ä½¿ç”¨è¡¨æ ¼</h6><p>åˆ¶ä½œè¡¨æ ¼ï¼Œéœ€è¦ç¡®å®šæ˜¯è¡¨æ ¼çš„è¡Œã€åˆ—ã€å¯¹é½æ¨¡å¼å’Œè¡¨æ ¼çº¿ï¼Œè¿™æ˜¯ç”±<code>tabular</code>ç¯å¢ƒå®Œæˆçš„ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\begin</span>&#123;table&#125;[h]<br><span class="hljs-keyword">\begin</span>&#123;tabular&#125;&#123;|lcr|&#125;<br><span class="hljs-keyword">\hline</span><br>ç›´è§’è¾¹ <span class="hljs-built_in">$</span>a<span class="hljs-built_in">$</span> <span class="hljs-built_in">&amp;</span> ç›´è§’è¾¹ <span class="hljs-built_in">$</span>b<span class="hljs-built_in">$</span> <span class="hljs-built_in">&amp;</span> æ–œè¾¹ <span class="hljs-built_in">$</span>c<span class="hljs-built_in">$</span><span class="hljs-keyword">\\</span><br><span class="hljs-keyword">\hline</span><br>3 <span class="hljs-built_in">&amp;</span>  4 <span class="hljs-built_in">&amp;</span> 5<span class="hljs-keyword">\\</span><br>5 <span class="hljs-built_in">&amp;</span>  12<span class="hljs-built_in">&amp;</span>  13<span class="hljs-keyword">\\</span><br><span class="hljs-keyword">\hline</span><br><span class="hljs-keyword">\end</span>&#123;tabular&#125;<span class="hljs-comment">%</span><br><span class="hljs-keyword">\qquad</span><br>(<span class="hljs-built_in">$</span>a<span class="hljs-built_in">^</span>2 + b<span class="hljs-built_in">^</span>2 = c<span class="hljs-built_in">^</span>2<span class="hljs-built_in">$</span>)<br><span class="hljs-keyword">\end</span>&#123;table&#125;<br></code></pre></td></tr></table></figure><p>è¡¨æ ¼å’Œæ’å›¾ä¸€æ ·ï¼Œä¸€èˆ¬ä¹Ÿæ”¾åœ¨æµ®åŠ¨ç¯å¢ƒä¸­ï¼Œå³<code>table</code>ç¯å¢ƒä¸­ï¼Œå‚æ•°å¤§è‡´å’Œ<code>figure</code>å·®ä¸å¤šï¼›<br><code>tabular</code>ç¯å¢ƒæœ‰ä¸€ä¸ªå‚æ•°ï¼Œé‡Œé¢å£°æ˜äº†è¡¨æ ¼ä¸­åˆ—çš„æ¨¡å¼ï¼Œåœ¨ä¸Šé¢çš„è¡¨æ ¼ä¸­<code>|lcr|</code>è¡¨ç¤ºç¬¬ä¸€åˆ—çš„å†…å®¹å·¦å¯¹é½ï¼Œç¬¬äºŒç±»å±…ä¸­å¯¹é½ï¼Œç¬¬ä¸‰åˆ—å±…ä¸­å¯¹é½ï¼Œåœ¨ç¬¬ä¸€åˆ—å‰é¢å’Œç¬¬ä¸‰åˆ—åé¢å„æœ‰ä¸€æ¡å‚ç›´çš„è¡¨æ ¼çº¿ã€‚<br>åœ¨<code>tabular</code>ç¯å¢ƒä¸­ï¼Œè¡Œä¸è¡Œä¹‹é—´ç”¨å‘½ä»¤<code>\\</code>éš”å¼€ï¼Œæ¯ä¸€è¡Œå†…çš„è¡¨é¡¹ä½¿ç”¨ç¬¦å·<code>$</code>éš”å¼€ï¼Œè¡¨æ ¼ä¸­çš„æ¨ªçº¿æ˜¯ç”¨å‘½ä»¤<code>\hline</code>ç”Ÿæˆã€‚<br>è¿™é‡Œå¹¶æ²¡æœ‰ç»™è¡¨æ ¼åŠ æ ‡é¢˜ï¼Œä¹Ÿæ²¡æœ‰æŠŠå†…å®¹å±…ä¸­ï¼Œè€Œæ˜¯æŠŠè¡¨æ ¼ä¸ªä¸€ä¸ªå…¬å¼å¹¶æ’æ’å¼€ï¼Œä¸­é—´ä½¿ç”¨ä¸€ä¸ª<code>\qquad</code>åˆ†å‰²ï¼Œè¿™ä¸ªå‘½ä»¤äº§ç”Ÿé•¿ä¸º2em(å¤§çº¦ä¸¤ä¸ªâ€™Mâ€™çš„å®½åº¦)çš„ç©ºç™½ã€‚å› ä¸ºå·²ç»ä½¿ç”¨<code>\qquad</code>ç”Ÿæˆè¶³å¤Ÿé•¿åº¦çš„ç©ºæ ¼äº†ï¼Œæ‰€ä»¥å†ç”¨<code>\end&#123;tabular&#125;</code>åçš„æ³¨é‡Šç¬¦å–æ¶ˆæ¢è¡Œäº§ç”Ÿçš„ä¸€ä¸ªå¤šä½™ç©ºæ ¼ã€‚åˆå› ä¸ºè¡¨æ ¼æ˜¯å’Œæ­£æ–‡è¿åœ¨ä¸€èµ·çš„ï¼Œä¸å…è®¸å†æµ®åŠ¨äº†ï¼Œæ‰€ä»¥åœ¨<code>table</code>ç¯å¢ƒä¸­çš„è¡¨ç¤ºä½ç½®å‚æ•°å¤„ä½¿ç”¨äº†<code>[H]</code>ï¼Œä½†æ˜¯è¿™ä¸ªå‚æ•°æ˜¯ç”±<strong>float</strong>å®åŒ…æä¾›çš„ï¼Œæ‰€ä»¥è¿˜è¦åœ¨å¯¼è¨€åŒºä½¿ç”¨<code>\usepackage&#123;float&#125;</code>ã€‚</p><h6 id="æ–‡çŒ®å¼•ç”¨"><a href="#æ–‡çŒ®å¼•ç”¨" class="headerlink" title="æ–‡çŒ®å¼•ç”¨"></a>æ–‡çŒ®å¼•ç”¨</h6><p>ä¸Šé¢æåˆ°äº†å¼•ç”¨æ–‡çŒ®ï¼Œæ˜¯åœ¨<code>math.bib</code>è¿™ä¸ªæ–‡ä»¶ä¸­æŒ‡å®šçš„ï¼Œä¸‹é¢æ˜¯<code>math.bib</code>æ–‡ä»¶çš„å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bib">% Encoding: UTF-8<br><br>@Book&#123;Shiye,<br>  title  = &#123;å‡ ä½•çš„æœ‰åå®šç†&#125;,<br>  year   = &#123;1986&#125;,<br>  author = &#123;çŸ¢é‡å¥å¤ªéƒ&#125;,<br>&#125;<br><br>@Book&#123;Kline,<br>  title  = &#123;å¤ä»Šæ•°å­¦æ€æƒ³&#125;,<br>  year   = &#123;2002&#125;,<br>  author = &#123;å…‹è±å› &#125;,<br>&#125;<br><br>@Book&#123;quanjing,<br>  title   = &#123;å•†é«˜ã€èµµçˆ½ä¸åˆ˜å¾½å…³äºå‹¾è‚¡å®šç†çš„è¯æ˜&#125;,<br>  year    = &#123;1998&#125;,<br>  author  = &#123;æ›²å®‰äº¬&#125;,<br>  volume  = &#123;20&#125;,<br>  number  = &#123;3&#125;,<br>  journal = &#123;æ•°å­¦ä¼ æ’­&#125;,<br>&#125;<br><br>@Comment&#123;jabref-meta: databaseType:bibtex;&#125;<br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªæ–‡çŒ®æ•°æ®æ–‡ä»¶çš„æ ¼å¼å¹¶ä¸å¤æ‚ï¼Œæ¯ä¸€ä¸ªæ¡ç›®åŒ…æ‹¬ç±»å‹ã€å¼•ç”¨æ ‡ç­¾ã€æ ‡é¢˜ã€å¹´é™ã€ä½œè€…ç­‰ä¿¡æ¯ï¼Œå¯ä»¥æ‰‹å·¥è¾“å…¥ï¼Œä¹Ÿå¯ä»¥é€šè¿‡jabrefåˆ¶ä½œã€‚<br>åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒBIBTEXæ•°æ®å¹¶ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å½•å…¥ï¼Œå¯ä»¥ä»ç›¸å…³çš„å­¦ç§‘ç½‘ç«™ç›´æ¥ç°åœ¨æˆ–æ˜¯ä»å…¶ä»–ç±»å‹çš„æ–‡çŒ®æ•°æ®åº“è½¬æ¢å¾—åˆ°ã€‚<br>BIBTEXæ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºå¤„ç†LATEXæ–‡æ¡£æ–‡çŒ®åˆ—è¡¨çš„ç¨‹åºï¼Œä½¿ç”¨BIBTEXå¤„ç†æ–‡çŒ®æ—¶ï¼Œç¼–è¯‘æºæ–‡ä»¶éœ€è¦å¢åŠ ä¸ºå››æ¬¡è¿è¡Œç¨‹åº(åœ¨TexWorksä¸­ç‚¹å‡»å››æ¬¡æŒ‰é’®)<br><code>pdflatex ***.tex</code><br><code>bibtex ***.aux</code><br><code>pdflatex ***.tex</code><br><code>pdflatex ***.tex</code><br>ç¬¬ä¸€æ¬¡è¿è¡Œä¸ºBIBTEXå‡†å¤‡å¥½è¾…åŠ©æ–‡ä»¶ï¼Œç¡®å®šæ•°æ®åº“ä¸­çš„å“ªäº›æ–‡çŒ®å°†è¢«åˆ—å‡ºæ¥ï¼Œç„¶åbibtexå¤„ç†è¾…åŠ©æ–‡ä»¶auxï¼Œä»æ–‡çŒ®æ•°æ®åº“ä¸­é€‰å–æ–‡ä»¶ï¼ŒæŒ‰æŒ‡å®šçš„æ ¼å¼ç”Ÿæˆæ–‡çŒ®åˆ—è¡¨çš„latexä»£ç ï¼Œåé¢ä¸¤æ¬¡å†è¯»å…¥æ–‡çŒ®åˆ—è¡¨ä»£ç å¹¶ç”Ÿæˆæ­£ç¡®çš„å¼•ç”¨ä¿¡æ¯ã€‚<br>latexåªé€‰æ‹©è¢«å¼•ç”¨çš„æ–‡çŒ®ï¼Œå¼•ç”¨æ–‡çŒ®çš„æ–¹æ³•æ˜¯åœ¨æ­£æ–‡ä¸­ä½¿ç”¨<code>\cite</code>å‘½ä»¤ï¼Œå¦‚ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tex">å°†å‹¾è‚¡å®šç†çš„å‘ç°å½’åŠŸäºå…¬å…ƒå‰ 6 ä¸–çºªçš„æ¯•è¾¾å“¥æ‹‰æ–¯å­¦æ´¾<span class="hljs-keyword">\cite</span>&#123;Kline&#125;ã€‚è¯¥å­¦æ´¾å¾—åˆ°äº†ä¸€ä¸ªæ³•åˆ™...<br>...æ˜¯æˆ‘å›½å¤ä»£å¯¹å‹¾è‚¡å®šç†çš„ä¸€ç§è¯æ˜<span class="hljs-keyword">\cite</span>&#123;quanjing&#125;ã€‚ <br></code></pre></td></tr></table></figure><p><code>\cite</code>å‘½ä»¤çš„å‚æ•°<code>Kline</code>å’Œ<code>quanjing</code>åˆ†åˆ«æ˜¯å…¶ä¸­ä¸¤ç¯‡çš„å¼•ç”¨æ ‡ç­¾ï¼Œä¹Ÿå°±æ˜¯åœ¨<code>math.bib</code>ä¸­æ¯ä¸ªæ¡ç›®ç¬¬ä¸€è¡Œå‡ºç°çš„æ˜Ÿç³»ï¼Œä½¿ç”¨<code>\cite</code>å‘½ä»¤ä¼šåœ¨å¼•ç”¨çš„æ–‡å­—æ˜¾ç¤ºæ–‡çŒ®åœ¨åˆ—è¡¨ä¸­çš„æ ‡å·(å®ƒåœ¨ç¬¬3æ¬¡pdflatexç¼–è¯‘åæ‰èƒ½ç¡®å®š)ï¼ŒåŒæ—¶åœ¨è¾…åŠ©æ–‡ä»¶ä¸­è¯´æ˜æŸæ–‡çŒ®å°†è¢«å¼•ç”¨ã€‚å¦‚æœè¦åœ¨åˆ—è¡¨ä¸­æ˜¾ç¤ºå¹¶ä¸ç›´æ¥å¼•ç”¨çš„æ–‡çŒ®ï¼Œå¯ä»¥ä½¿ç”¨<code>\nocite</code>å‘½ä»¤ï¼Œä¸€èˆ¬æ˜¯æŠŠå®ƒæ”¾åœ¨<code>\bibliography</code>ä¹‹å‰ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\nocite</span>&#123;Shiye&#125;<br><span class="hljs-keyword">\bibliography</span>&#123;math&#125;<br></code></pre></td></tr></table></figure><p>ç›®å½•ä¹Ÿæ˜¯è‡ªåŠ¨ä»ç« èŠ‚å‘½ä»¤ä¸­æå–å¹¶å†™å…¥ç›®å½•æ–‡ä»¶ä¸­çš„ï¼Œåœ¨æ–‡ç« ä¸­æˆ‘ä»¬å°±ä½¿ç”¨äº†<code>\tableofcontents</code>å‘½ä»¤ï¼Œå®ƒå°†åœ¨ç¬¬äºŒæ¬¡ç¼–è¯‘æ—¶ç”Ÿæ•ˆã€‚<br>å¼•ç”¨å¹¶ä¸ä»…é™äºå‚è€ƒæ–‡çŒ®ï¼Œå›¾è¡¨ã€å…¬å¼çš„ç¼–å·ï¼Œåªè¦äº‹å…ˆè®¾å®šäº†æ ‡ç­¾ï¼ŒåŒæ ·å¯ä»¥å¼•ç”¨ã€‚åŸºæœ¬çš„äº¤å‰å¼•ç”¨å‘½ä»¤æ˜¯<code>\ref</code>ï¼Œå®ƒä»¥æ ‡ç­¾é—®å‚æ•°ï¼Œå¾—åˆ°è¢«å¼•ç”¨æ ‡å·ã€‚æ¯”å¦‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œåœ¨æ’å…¥å›¾ç‰‡æ—¶æ˜¯å¼•ç”¨<code>\label</code>å‘½ä»¤ä¸ºå¼¦å›¾å®šä¹‰äº†æ ‡ç­¾<code>\label&#123;fig:gougu&#125;</code>ï¼Œè¿™æ ·åœ¨æ­£æ–‡ä¸­å°±å¯ä»¥ä½¿ç”¨</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">å›¾<span class="hljs-keyword">\ref</span>&#123;fig:gougu&#125;æ˜¯æˆ‘å›½å¤ä»£å¯¹å‹¾è‚¡å®šç†çš„ä¸€ç§è¯æ˜<span class="hljs-keyword">\cite</span>&#123;quanjing&#125;ã€‚<br></code></pre></td></tr></table></figure><p>å…¬å¼ç¼–å·çš„å¼•ç”¨ä¹Ÿå¯ç…§æ­¤åšæ³•ï¼Œä¸è¿‡éœ€è¦å…ˆåœ¨å…¬å¼ä¸­å®šä¹‰æ ‡ç­¾ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\begin</span>&#123;equation&#125; <span class="hljs-keyword">\label</span>&#123;eq:gougu&#125;<br>AB<span class="hljs-built_in">^</span>2 = BC<span class="hljs-built_in">^</span>2 + AC<span class="hljs-built_in">^</span>2<br><span class="hljs-keyword">\end</span>&#123;equation&#125;<br></code></pre></td></tr></table></figure><p>å¼•ç”¨æ•°å­¦å…¬å¼çš„æ—¶å€™ä¸€èˆ¬ä½¿ç”¨æ•°å­¦å®åŒ…<code>amsmath</code>å°±å®šä¹‰äº†<code>\eqref</code>å‘½ä»¤ï¼Œä¸“é—¨ç”¨äºå…¬å¼çš„å¼•ç”¨ï¼Œå¹¶èƒ½äº§ç”Ÿæ‹¬å·ï¼š<br>å¯¼è¨€åŒºå¼•å…¥åŒ…</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex"><span class="hljs-keyword">\usepackage</span>&#123;amsmath&#125;<br></code></pre></td></tr></table></figure><p>æ­£æ–‡ä¸­å¼•ç”¨å…¬å¼ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tex">æ»¡è¶³å¼<span class="hljs-keyword">\eqref</span>&#123;eq:gougu&#125;çš„æ•´æ•°ç§°ä¸º<span class="hljs-keyword">\emph</span>&#123;å‹¾è‚¡æ•°&#125;ã€‚<br></code></pre></td></tr></table></figure><hr><p>ä»¥ä¸Šã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>LaTeX</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LaTeXç¬”è®°(ä¸€)(å‡†å¤‡å·¥ä½œ)</title>
    <link href="/2018/01/18/LaTeX%E7%AC%94%E8%AE%B0-%E4%B8%80/"/>
    <url>/2018/01/18/LaTeX%E7%AC%94%E8%AE%B0-%E4%B8%80/</url>
    
    <content type="html"><![CDATA[<p>å¦‚æœå­¦ä¹ ä¸æ˜¯ä¸ºäº†è£…é€¼ï¼Œé‚£ä¸€åˆ‡éƒ½å°†æ¯«æ— æ„ä¹‰ã€‚<br>æ²¡é”™ï¼Œæˆ‘åˆæƒ³å­¦<strong>LaTeX</strong>äº†ï¼Œä½œä¸ºä¸–ç•Œä¸Šæœ€å¥½çš„æ’ç‰ˆç³»ç»Ÿ(æ²¡æœ‰ä¹‹ä¸€)ï¼Œæˆ‘ä¹Ÿåªæ˜¯åœ¨å†™ç®€å†çš„æ—¶å€™ç”¨è¿‡(è£…ä¸Šç¼–è¯‘å™¨ï¼Œæ”¹æ¨¡æ¿è€Œå·²)ï¼Œæ²¡æœ‰æ€ä¹ˆäº†è§£è¿‡ã€‚æœ€è¿‘å¦¹å­æœ‰æåˆ°è¿‡è¯´äº›æ¯•ä¸šè®ºæ–‡çš„æ—¶å€™å¯èƒ½è¦ç”¨ï¼Œè¿™å°±éœ€è¦ç³»ç»Ÿçš„å­¦ä¹ ä¸€ä¸‹äº†ã€‚</p><h4 id="å‡†å¤‡é˜¶æ®µ"><a href="#å‡†å¤‡é˜¶æ®µ" class="headerlink" title="å‡†å¤‡é˜¶æ®µ"></a>å‡†å¤‡é˜¶æ®µ</h4><p>æœ¬ç€å®ç”¨è‡³ä¸Šçš„åŸåˆ™ï¼ŒLaTeXçš„å†å²ä»¥åŠå…‰è¾‰äº‹è¿¹å°±ä¸åœ¨æäº†ï¼Œæƒ³çœ‹çš„è‡ªå·±å»æœ</p><ol><li><strong>TexLive2017å¥—è£…</strong>ï¼šä¸‹è½½åœ°å€<a href="http://mirrors.tuna.tsinghua.edu.cn/CTAN/systems/texlive/Images/texlive2017-20170524.iso">http://mirrors.tuna.tsinghua.edu.cn/CTAN/systems/texlive/Images/texlive2017-20170524.iso</a> è¿™ä¸ªæ˜¯æ¸…åé•œåƒç«™ç‚¹ã€‚<a href="http://mirror.ctan.org/systems/texlive/Images/texlive2017.iso">http://mirror.ctan.org/systems/texlive/Images/texlive2017.iso</a> è¿™ä¸ªæ˜¯å®˜æ–¹çš„é•œåƒä¸‹è½½åœ°å€ã€‚<br>ä¸æ¨èä½¿ç”¨<strong>CTex</strong></li><li><strong>TexWorks</strong>ï¼šTexæ–‡ä»¶ç¼–è¾‘å™¨ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–ç¼–è¾‘å™¨+æ’ä»¶ï¼šæ¯”å¦‚ VisualStudioCodeï¼ŒSublimeï¼ŒNotepad++ç­‰ã€‚</li><li><strong>JabRef</strong>ï¼šä¸‹è½½åœ°å€ <a href="https://www.fosshub.com/JabRef.html">https://www.fosshub.com/JabRef.html</a> å¤§éƒ¨åˆ†ç”¨åœ¨å†™è®ºæ–‡çš„å¼•ç”¨æ–‡çŒ®ä¸Šï¼Œåªæœ‰ä½¿ç”¨LaTeXæ’°å†™ç§‘æŠ€è®ºæ–‡çš„ç ”ç©¶äººå‘˜æ‰èƒ½å®Œå…¨é¢†ç•¥åˆ°JabRefçš„å¦™ä¸å¯è¨€ã€‚</li><li><strong>å­¦ä¹ èµ„æ–™</strong>ï¼šLaTeXå®åœ¨å¤ªåºå¤§äº†ï¼ŒåŠ ä¸Šå„ç§packageï¼Œç½‘ä¸Šå„ç§åšå®¢èµ„æ–™ä¸æ˜¯å¾ˆå…¨é¢ï¼Œåªç…§é¡¾åˆ°ä¸€éƒ¨åˆ†ï¼Œæ¨è<em>åˆ˜æµ·æ´‹</em>çš„<em>LaTeXå…¥é—¨</em>ã€‚</li><li><strong>å»ºè®®</strong>ï¼šå¤šç»ƒä¹ ï¼Œå°±åƒå­¦ç¼–ç¨‹ä¸€æ ·ï¼ŒæŠŠä¹¦ä¸Šçš„ä¾‹å­éƒ½è‡ªå·±æ•²ä¸€éã€‚</li></ol><span id="more"></span><h4 id="å®‰è£…è½¯ä»¶"><a href="#å®‰è£…è½¯ä»¶" class="headerlink" title="å®‰è£…è½¯ä»¶"></a>å®‰è£…è½¯ä»¶</h4><p>å°†<code>TexLive2017å¥—è£…</code>åŠ è½½åˆ°å…‰é©±ï¼Œ</p><ul><li>Windows ç”¨æˆ·åŒå‡» install-tl-advanced.batï¼›</li><li>*nix ç”¨æˆ·æ‰§è¡Œ install-tlã€‚<br>ç„¶åæŒ‰ç…§æç¤ºæ¥å®‰è£…å°±å¥½äº†ï¼Œæœ€åå°†<code>texlive\2017\bin\win32</code>åŠ å…¥ç¯å¢ƒå˜é‡ï¼Œ*nixç”¨æˆ·è‡ªå·±æ‰¾æ‰§è¡Œæ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„åŠ åˆ°ç¯å¢ƒå˜é‡é‡Œé¢ã€‚<br>å…¶ä»–çš„ä¸œè¥¿å¯ä»¥å‚è€ƒè¿™ä¸ªç½‘ç«™ <a href="http://www.latexstudio.net/archives/10208">http://www.latexstudio.net/archives/10208</a></li></ul><h4 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h4><p>è€è§„çŸ©ï¼Œå…ˆè·‘ä¸ª<code>Hello World</code>ã€‚</p><ol><li>æ‰“å¼€<code>TexWork</code>,åœ¨ç¼–è¾‘åŒºè¾“å…¥ä»¥ä¸‹ä»£ç ï¼š<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs Tex"><span class="hljs-keyword">\documentclass</span>&#123;article&#125;<br><br><span class="hljs-keyword">\begin</span>&#123;document&#125;<br><br>Hello World!<br><br><span class="hljs-keyword">\LaTeX</span><br><br><span class="hljs-keyword">\end</span>&#123;document&#125;<br></code></pre></td></tr></table></figure>ç„¶åä¿å­˜ä¸€ä¸‹æ–‡ä»¶ï¼Œæ³¨æ„ä¸€å®šè¦ä½¿ç”¨UTF-8ç¼–ç (é»˜è®¤)ï¼ŒTexæ–‡ä»¶çš„åç¼€åä¸º<code>.tex</code>ï¼Œç¼–è¯‘è¿‡ç¨‹ä¼šå¤šå‡ºå¥½å¤šä¸´æ—¶æ–‡ä»¶ã€‚</li><li>åœ¨ä¸‹å›¾çº¢æ¡†å¤„(ç•Œé¢å·¦ä¸Šè§’)é€‰æ‹©<code>pafLaTeX</code>,ç„¶åç‚¹å‡»ç»¿è‰²æŒ‰é’®è¿›è¡Œç¼–è¯‘ï¼Œç¼–è¯‘è¿‡ç¨‹ä¸­ç»¿è‰²æŒ‰é’®ä¼šå˜æˆçº¢å‰ï¼Œç¼–è¯‘æˆåŠŸååˆå˜æˆç»¿è‰²æŒ‰é’®ã€‚ä½ ä¼šåœ¨å¼¹å‡ºçš„çª—å£çœ‹åˆ°â€Hello World LaTeXâ€ï¼Œå¹¶ä¸”åœ¨<code>tex</code>æ–‡ä»¶åŒçº§çš„æ–‡ä»¶å¤¹ä¸‹çœ‹åˆ°ç”Ÿæˆçš„<code>pdf</code>æ–‡ä»¶ã€‚<br>å¦‚æœæ²¡æœ‰ç¼–è¯‘æˆåŠŸï¼Œå¯ä»¥å°è¯•é€‰æ‹©ä¸åŒçš„ç¼–è¯‘ç±»å‹ï¼Œä¹Ÿå¯ä»¥æœç´¢æ§åˆ¶å°æŠ¥é”™ä¿¡æ¯æ¥è§£å†³ã€‚<br><img src="/image/latex/latex_note_one_1.png" alt="TexWorksç•Œé¢"></li><li>å¦‚æœä½ è§‰å¾—ç¼–è¾‘çª—å£çš„å­—ä½“çœ‹ç€ä¸èˆ’æœï¼Œå¯ä»¥åœ¨<code>ç¼–è¾‘</code>â€“&gt;<code>é¦–é€‰é¡¹</code>â€“&gt;<code>ç¼–è¾‘å™¨</code>æˆ–è€…<code>æ ¼å¼</code>â€“&gt;<code>å­—ä½“</code>é‡Œé¢è°ƒæ•´ã€‚</li><li>å¤šè¯´ä¸€å¥ï¼Œ<code>TexWorks</code>æ”¯æŒä»£ç è¡¥å…¨</li></ol><h4 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h4><p><code>\documentclass[UTF-8]&#123;article&#125;</code> å£°æ˜æ–‡æ¡£ç±»å‹æ˜¯ä¸€ç¯‡æ–‡ç« ã€‚<br><code>\begin&#123;document&#125;</code> å’Œ <code>\end&#123;document&#125;</code> æ ‡è¯†å‡ºæ­£æ–‡çš„èŒƒå›´<br><code>\LaTeX</code> çœ‹ç»“æœå°±çŸ¥é“æ˜¯è¡¨ç¤ºç»“æœä¸­é«˜ä½ä¸å¹³çš„LaTeX<br>ä½†æ˜¯ï¼Œå½“ä½ æŠŠå†…å®¹æ›¿æ¢ä¸ºæ±‰å­—çš„æ—¶å€™ï¼Œå‘ç°æ±‰å­—å¹¶ä¸èƒ½åœ¨pdfæ–‡ä»¶ä¸­å±•ç¤ºï¼Œè¿™æ˜¯å› ä¸ºLaTeXåŸæœ¬æ˜¯é¢å‘è¥¿æ–‡å†™ä½œçš„ï¼Œé»˜è®¤æ²¡æœ‰åŠ è½½ä¸­æ–‡å­—ä½“ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ›¿æ¢æ–‡æ¡£ç±»å‹æ¥æ˜¾ç¤ºä¸­æ–‡ï¼Œå°† <code>\documentclass&#123;article&#125;</code> æ›¿æ¢ä¸º <code>\documentclass[UTF-8]&#123;ctexart&#125;</code> å°±å¯ä»¥æ˜¾ç¤ºä¸­æ–‡äº†ã€‚</p><h4 id="ä¸‹ä¸€ä¸ªç›®æ ‡"><a href="#ä¸‹ä¸€ä¸ªç›®æ ‡" class="headerlink" title="ä¸‹ä¸€ä¸ªç›®æ ‡"></a>ä¸‹ä¸€ä¸ªç›®æ ‡</h4><p>å¦‚ä¸‹å›¾ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥æ…¢æ…¢å†™å‡ºæ¥å›¾ç‰‡æ‰€ç¤ºçš„æ ·å¼ã€‚<br><img src="/image/latex/latex_note_one_2.png" alt="ç›®æ ‡"></p><hr><p>ä»¥ä¸Šã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>LaTeX</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Androidå¸ƒå±€æ–‡ä»¶ä¸­çš„xmlns:tools</title>
    <link href="/2018/01/04/Android%E5%B8%83%E5%B1%80%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84xmlns-tools/"/>
    <url>/2018/01/04/Android%E5%B8%83%E5%B1%80%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84xmlns-tools/</url>
    
    <content type="html"><![CDATA[<p>åœ¨ä½¿ç”¨AndroidStudioåˆ›å»ºå¸ƒå±€æ–‡ä»¶çš„æ—¶å€™ï¼Œè·Ÿå¸ƒå±€ä¸‹æ€»æ˜¯æœ‰å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">RootTag</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">&quot;http://schemas.android.com/tools&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:context</span>=<span class="hljs-string">&quot;***.***Activity&quot;</span> &gt;</span><br></code></pre></td></tr></table></figure><p>äºæ˜¯åœ¨å®˜ç½‘æŸ¥äº†ä¸€ä¸‹è¿™ä¿©è´§æ˜¯å¹²å˜›ç”¨çš„ï¼Œä¸‹é¢æ˜¯è‡ªå·±çš„ç¿»è¯‘+å®è·µ</p><span id="more"></span><p><code>xmlns</code>çš„å…¨ç§°æ˜¯<code>xmlnamespace</code>,å’Œc++ä¸­<code>namespace</code>å·®ä¸å¤šï¼Œéƒ½æ˜¯ä¸ºäº†è§£å†³å‘½åä¸Šçš„å†²çªé—®é¢˜ã€‚<br>åœ¨Androidå¸ƒå±€æ–‡ä»¶ä¸­ï¼Œå¸¸è§çš„<code>xmlns</code>å¤§æ¦‚æœ‰ä¸‰ä¸ªï¼ˆä½ å¯ä»¥éšæ„å‘½åï¼ŒæŠŠtoolsæ”¹æˆbugä¹Ÿå¯ä»¥ï¼Œåªè¦å¯¹åº”ä½¿ç”¨toolsçš„åœ°æ–¹éƒ½æ”¹æˆbugï¼Œè¯´ç™½äº†ï¼Œå®ƒåªæ˜¯ä¸ªå˜é‡è€Œå·²ï¼‰ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml">xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;<br>xmlns:tools=&quot;http://schemas.android.com/tools&quot;<br>xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;<br></code></pre></td></tr></table></figure><h6 id="android"><a href="#android" class="headerlink" title="android"></a>android</h6><p>ç”¨äºAndroidç³»ç»Ÿå®šä¹‰çš„ä¸€äº›å±æ€§</p><h6 id="app"><a href="#app" class="headerlink" title="app"></a>app</h6><p>ç”¨äºæˆ‘ä»¬è‡ªå®šä¹‰çš„ä¸€äº›å±æ€§</p><h6 id="tools"><a href="#tools" class="headerlink" title="tools"></a>tools</h6><p>ç»™IDEæˆ–è€…é¢„è§ˆç•Œé¢ç”¨çš„ï¼Œå½“æ‰“åŒ…ç¼–è¯‘æ—¶å¹¶ä¸ä¼šåŒ…å«åœ¨apkä¸­ã€‚</p><h4 id="toolså¯ä»¥å¹²ä»€ä¹ˆ"><a href="#toolså¯ä»¥å¹²ä»€ä¹ˆ" class="headerlink" title="toolså¯ä»¥å¹²ä»€ä¹ˆ"></a>toolså¯ä»¥å¹²ä»€ä¹ˆ</h4><p>å…ˆçœ‹å®˜ç½‘ä»‹ç» <a href="https://developer.android.com/studio/write/tool-attributes.html">https://developer.android.com/studio/write/tool-attributes.html</a></p><blockquote><p>Android Studio supports a variety of XML attributes in the tools namespace that enable design-time features (such as which layout to show in a fragment) or compile-time behaviors (such as which shrinking mode to apply to your XML resources). When you build your app, the build tools remove these attributes so there is no effect on your APK size or runtime behavior.</p></blockquote><p>å¤§è‡´æ„æ€å°±æ˜¯è¯´ä½¿ç”¨<code>tools</code>åé¢çš„å±æ€§ä¸ä¼šå†ç¼–è¯‘æ—¶å­˜åœ¨ï¼Œåªå­˜åœ¨äºè®¾è®¡æ—¶çš„é¢„è§ˆï¼Œä¸ä¼šå½±å“apkçš„ä½“ç§¯ï¼Œ</p><h5 id="Error-handling-attributes"><a href="#Error-handling-attributes" class="headerlink" title="Error handling attributes"></a>Error handling attributes</h5><p>å½±å“Lintæç¤ºçš„å±æ€§ä¸»è¦æœ‰ä¸‹é¢ä¸‰ç§ï¼š</p><blockquote><p><strong>tools:ignore</strong><br>Intended for: Any element<br>Used by: Lint</p></blockquote><blockquote><p><strong>tools:targetApi</strong><br>Intended for: Any element<br>Used by: Lint</p></blockquote><blockquote><p><strong>tools:locale</strong><br>Intended for: resources<br>Used by: Lint, Android Studio editor</p></blockquote><p><code>ignore</code>å±æ€§æ˜¯å‘Šè¯‰Lintå¿½ç•¥xmlä¸­çš„æŸäº›è­¦å‘Šï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨<code>ImageView</code>æˆ–è€…<code>ImageButton</code>ä¸­æ²¡æœ‰å†™<code>contentDescription</code>å±æ€§ï¼ŒLintä¼šæœ‰è­¦å‘Šï¼š<code>Missing contentDescription attribute on image</code>,åŸå› æ˜¯è¿™ä¸ªå±æ€§æ˜¯æä¾›æ— éšœç¢é˜…è¯»çš„ï¼Œæ²¡æœ‰è¿™ä¸ªå±æ€§çš„è¯<code>Screen Reader</code>æ— æ³•æ­£å¸¸å·¥ä½œï¼Œä½†æ˜¯æœ‰äº›ç‰¹å®šåˆ†ç±»çš„è½¯ä»¶æ˜¯ä¸è€ƒè™‘è¿™äº›ä¸œè¥¿çš„ã€‚è™½ç„¶è¿™ç§è­¦å‘Šæ— æ‰€è°“ï¼Œä½†æ˜¯å¯¹äºè¦æ±‚ä»£ç ä¸­ä¸èƒ½æœ‰warningçš„å…¬å¸æ¥è¯´ï¼Œè¿™æ˜¯ä¸å¯å–çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨<code>ignore</code>å±æ€§æ¥å¿½ç•¥è¿™ä¸ªè­¦å‘Š(å¦‚æœä½ è¯´ä½ æ”¹äº†Lintçš„è­¦å‘Šçº§åˆ«ï¼Œå½“æˆ‘æ²¡è¯´)ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">ImageView</span></span><br><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">android:layout_marginStart</span>=<span class="hljs-string">&quot;@dimen/margin_main&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">android:layout_marginTop</span>=<span class="hljs-string">&quot;@dimen/margin_main&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">android:scaleType</span>=<span class="hljs-string">&quot;center&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">android:src</span>=<span class="hljs-string">&quot;@drawable/divider&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">tools:ignore</span>=<span class="hljs-string">&quot;contentDescription&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><p><code>targetApi</code>å’Œä»£ç ä¸­çš„æ³¨è§£<code>@RequiresApi(api = Build.VERSION_CODES.JELLY_BEAN_MR2)</code>å·®ä¸å¤šã€‚å‡è®¾é…ç½®æ–‡ä»¶ä¸­çš„æœ€å°sdkLevelä¸º11ï¼Œè€Œå¸ƒå±€æ–‡ä»¶ä¸­ä½¿ç”¨äº†21çš„æ§ä»¶æ¯”å¦‚<code>GridLayout</code>,Lintä¼šæœ‰è­¦å‘Šï¼Œä¸ºäº†æ¶ˆé™¤è¿™ä¸ªè­¦å‘Šï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">GridLayout</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">&quot;http://schemas.android.com/tools&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:targetApi</span>=<span class="hljs-string">&quot;14&quot;</span> &gt;</span><br></code></pre></td></tr></table></figure><p><code>locale</code>æ˜¯å‘Šè¯‰Lintå’ŒAndroidStudio editoré»˜è®¤çš„æ˜¯ä»€ä¹ˆè¯­è¨€ï¼Œå¦‚æœä¸æŒ‡å®šçš„è¯ï¼Œé»˜è®¤æ˜¯è‹±è¯­ã€‚å¯ä»¥æŠŠè¿™ä¸ªå±æ€§æ·»åŠ åˆ°<code>values/strings.xml</code>ä¸­ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resources</span> <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">&quot;http://schemas.android.com/tools&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:locale</span>=<span class="hljs-string">&quot;es&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><h5 id="Design-time-view-attributes-è®¾è®¡æ—¶è¯•å›¾å±æ€§"><a href="#Design-time-view-attributes-è®¾è®¡æ—¶è¯•å›¾å±æ€§" class="headerlink" title="Design-time view attributes(è®¾è®¡æ—¶è¯•å›¾å±æ€§)"></a>Design-time view attributes(è®¾è®¡æ—¶è¯•å›¾å±æ€§)</h5><h6 id="tools-instead-of-android"><a href="#tools-instead-of-android" class="headerlink" title="tools: instead of android"></a>tools: instead of android</h6><p><strong>Intended for:</strong> <em><code>View</code></em><br><strong>Used by:</strong>  <em>Android Studio layout editor</em></p><p>æˆ‘ä»¬æœ‰ä¸€ä¸ª<code>TextView</code>ï¼Œéœ€è¦æ˜¾ç¤ºä»ç½‘ç»œè·å–åˆ°çš„æ–‡ä»¶ï¼Œæ§ä»¶å¤§å°æ˜¯<code>wrap_content</code>,ä½†æ˜¯<code>TextView</code>ä¸­æ²¡æœ‰æ–‡å­—çš„è¯åœ¨é¢„è§ˆç•Œé¢ä¸­æ˜¯çœ‹ä¸åˆ°çš„ï¼Œå¤§éƒ¨åˆ†åŒå­¦å¯èƒ½ä¼šä½¿ç”¨<code>android:text=XXXX</code>è¿™ä¸ªå±æ€§ï¼Œè°ƒæ•´å¥½å¸ƒå±€ä¹‹åå†æŠŠæ–‡å­—åˆ é™¤ã€‚ä¸€ä¸¤ä¸ªæ§ä»¶è¿˜å¥½è¯´ï¼Œæ§ä»¶å¤šäº†æŒ‡ä¸å®šå“ªä¸ªæ§ä»¶å°±å¿˜è®°åˆ é™¤æ–‡æœ¬äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>tools</code>è¿™ä¸ªä¸œè¥¿ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/unlock_bike&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:background</span>=<span class="hljs-string">&quot;#12345678&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:paddingBottom</span>=<span class="hljs-string">&quot;10dp&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:paddingTop</span>=<span class="hljs-string">&quot;10dp&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:text</span>=<span class="hljs-string">&quot;æµ‹è¯•ç”¨ä¾‹&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™æ—¶æˆ‘ä»¬åœ¨IDEé¢„è§ˆç•Œé¢æ˜¯å¯ä»¥çœ‹åˆ°æ–‡å­—çš„ï¼Œæ‰“åŒ…æˆapkè¿è¡Œåœ¨æ‰‹æœºä¸Šæ—¶æ˜¯çœ‹ä¸åˆ°çš„ã€‚<br>æ€»ä¹‹ï¼Œ<code>tools</code>å¯ä»¥å‘Šè¯‰<code>Android Studio</code>å“ªäº›å±æ€§åœ¨è¿è¡Œçš„æ—¶å€™æ˜¯è¢«å¿½ç•¥çš„ï¼Œåªåœ¨è®¾è®¡å¸ƒå±€çš„æ—¶å€™æœ‰æ•ˆã€‚åŸºæœ¬ä¸ŠåŸç”Ÿæ§ä»¶çš„å±æ€§éƒ½å¯ä»¥è¿™ä¹ˆä½¿ç”¨ã€‚</p><h6 id="tools-context"><a href="#tools-context" class="headerlink" title="tools:context"></a>tools:context</h6><p><strong>Intended for:</strong> <em>Any root View</em><br><strong>Used by:</strong>  <em>Lint, Android Studio layout editor</em><br>è¿™ä¸ªå±æ€§å‘Šè¯‰IDEå½“å‰å¸ƒå±€å’Œå“ªä¸ªactivityç›¸å…³è”ï¼Œåœ¨é¢„è§ˆç•Œé¢ä½¿ç”¨å…³è”Activityçš„ä¸»é¢˜å±•ç¤ºã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">android.support.constraint.ConstraintLayout</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">&quot;http://schemas.android.com/tools&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:context</span>=<span class="hljs-string">&quot;.MainActivity&quot;</span> &gt;</span><br></code></pre></td></tr></table></figure><h6 id="tools-itemCount"><a href="#tools-itemCount" class="headerlink" title="tools:itemCount"></a>tools:itemCount</h6><p><strong>Intended for:</strong> <em>RecyclerView</em><br><strong>Used by:</strong> <em>Android Studio layout editor</em><br>è¿™ä¸ªå±æ€§å‘Šè¯‰ç¼–è¾‘å™¨åœ¨é¢„è§ˆçª—å£å±•ç¤ºå¤šå°‘ä¸ªåˆ—è¡¨é¡¹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">android.support.v7.widget.RecyclerView</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/recyclerView&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:itemCount</span>=<span class="hljs-string">&quot;3&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><h6 id="tools-layout"><a href="#tools-layout" class="headerlink" title="tools:layout"></a>tools:layout</h6><p><strong>Intended for:</strong> <em><code>fragment</code></em><br><strong>Used by:</strong> <em>Android Studio layout editor</em><br>è¿™ä¸ªå±æ€§å‘Šè¯‰ç¼–è¾‘å™¨fragmentä¸­æ˜¾ç¤ºå“ªä¸ªå¸ƒå±€æ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">fragment</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;com.example.master.ItemListFragment&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:layout</span>=<span class="hljs-string">&quot;@layout/list_content&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><h6 id="tools-listitem-x2F-tools-listheader-x2F-tools-listfooter"><a href="#tools-listitem-x2F-tools-listheader-x2F-tools-listfooter" class="headerlink" title="tools:listitem &#x2F; tools:listheader &#x2F; tools:listfooter"></a>tools:listitem &#x2F; tools:listheader &#x2F; tools:listfooter</h6><p><strong>Intended for:</strong> <em><code>AdapterView</code> (and subclasses like <code>ListView</code>)</em><br><strong>Used by:</strong> <em>Android Studio layout editor</em><br>çœ‹å±æ€§åå­—å°±èƒ½çŒœå‡ºæ¥äº†ï¼Œé¢„è§ˆç•Œé¢æ˜¾ç¤ºåˆ—è¡¨çš„å¤´éƒ¨ï¼Œåº•éƒ¨å’Œåˆ—è¡¨é¡¹å¸ƒå±€</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">ListView</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">&quot;http://schemas.android.com/tools&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@android:id/list&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:listitem</span>=<span class="hljs-string">&quot;@layout/sample_list_item&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:listheader</span>=<span class="hljs-string">&quot;@layout/sample_list_header&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:listfooter</span>=<span class="hljs-string">&quot;@layout/sample_list_footer&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><h6 id="tools-showIn"><a href="#tools-showIn" class="headerlink" title="tools:showIn"></a>tools:showIn</h6><p><strong>Intended for:</strong> <em>Any root <code>View</code> in a layout thatâ€™s referred to by an <code>include</code></em><br><strong>Used by:</strong> <em>Android Studio layout editor</em><br>æ­¤å±æ€§å¯ä»¥é€šè¿‡æŒ‡å‘ä½¿ç”¨æ­¤å¸ƒå±€åŒ…å«çš„å¸ƒå±€ï¼Œå› æ­¤æ‚¨å¯ä»¥é¢„è§ˆ(å’Œç¼–è¾‘)è¿™ä¸ªæ–‡ä»¶ï¼Œå› ä¸ºå®ƒåµŒå…¥åœ¨å…¶çˆ¶å¸ƒå±€æ—¶å‡ºç°</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">TextView</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">&quot;http://schemas.android.com/tools&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:text</span>=<span class="hljs-string">&quot;@string/hello_world&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:showIn</span>=<span class="hljs-string">&quot;@layout/activity_main&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><h6 id="tools-menu"><a href="#tools-menu" class="headerlink" title="tools:menu"></a>tools:menu</h6><p><strong>Intended for:</strong>  <em>Any root <code>View</code></em><br><strong>Used by:</strong> <em>Android Studio layout editor</em><br>æ­¤å±æ€§æŒ‡å®šèœå•åº”è¯¥æ˜¾ç¤ºåœ¨åº”ç”¨ç¨‹åºæ çš„å¸ƒå±€é¢„è§ˆã€‚è¯¥å€¼å¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªèœå•idï¼Œç”±é€—å·åˆ†éš”</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">&quot;http://schemas.android.com/tools&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">&quot;vertical&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:menu</span>=<span class="hljs-string">&quot;menu1,menu2&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><h6 id="tools-minValue-x2F-tools-maxValue"><a href="#tools-minValue-x2F-tools-maxValue" class="headerlink" title="tools:minValue &#x2F; tools:maxValue"></a>tools:minValue &#x2F; tools:maxValue</h6><p><strong>Intended for:</strong> <em><code>NumberPicker</code></em><br><strong>Used by:</strong> <em>Android Studio layout editor</em><br>è®¾ç½®NumberPickerçš„æœ€å¤§å€¼å’Œæœ€å°å€¼</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">NumberPicker</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">&quot;http://schemas.android.com/tools&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/numberPicker&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:minValue</span>=<span class="hljs-string">&quot;0&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:maxValue</span>=<span class="hljs-string">&quot;10&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><h6 id="tools-openDrawer"><a href="#tools-openDrawer" class="headerlink" title="tools:openDrawer"></a>tools:openDrawer</h6><p><strong>Intended for:</strong> <em><code>DrawerLayout</code></em><br><strong>Used by:</strong> <em>Android Studio layout editor</em><br>è®¾ç½®<code>DrawerLayout</code>åœ¨é¢„è§ˆçª—å£çš„æ‰“å¼€ä½ç½®</p><table><thead><tr><th align="center">Constant</th><th align="center">Value</th><th align="center">Description</th></tr></thead><tbody><tr><td align="center">end</td><td align="center">800005</td><td align="center">Push object to the end of its container, not changing its size.</td></tr><tr><td align="center">left</td><td align="center">3</td><td align="center">Push object to the left of its container, not changing its size.</td></tr><tr><td align="center">right</td><td align="center">5</td><td align="center">Push object to the right of its container, not changing its size.</td></tr><tr><td align="center">start</td><td align="center">800003</td><td align="center">Push object to the beginning of its container, not changing its size.</td></tr></tbody></table><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">android.support.v4.widget.DrawerLayout</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">&quot;http://schemas.android.com/tools&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/drawer_layout&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:openDrawer</span>=<span class="hljs-string">&quot;start&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸‹é¢çš„ä¸æƒ³ç¿»è¯‘äº†ï¼Œé“¾æ¥åœ¨ä¸‹é¢<br><a href="https://developer.android.com/studio/write/tool-attributes.html#resource_shrinking_attributes">https://developer.android.com/studio/write/tool-attributes.html#resource_shrinking_attributes</a><br>è‡ªå·±æ’¸å§</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å†™åœ¨2018å…ƒæ—¦ä¹‹å‰:2017çš„æ€»ç»“</title>
    <link href="/2017/12/30/%E5%86%99%E5%9C%A82018%E5%85%83%E6%97%A6%E4%B9%8B%E5%89%8D-2017%E7%9A%84%E6%80%BB%E7%BB%93/"/>
    <url>/2017/12/30/%E5%86%99%E5%9C%A82018%E5%85%83%E6%97%A6%E4%B9%8B%E5%89%8D-2017%E7%9A%84%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<p>2017å¹´å·²ç»è¿‡å»äº†ï¼Œç°åœ¨å·²ç»æ˜¯2018å¹´1æœˆ1å·äº†ï¼Œå†™å†™è¿™ä¸€å¹´çš„æ”¶è·æ€»ç»“å’Œ2018çš„è®¡åˆ’å§ã€‚<br>ä¸€ä¸ªå­—æ€»ç»“äº†ä¸€ä¸‹2018å¹´ï¼šç©·ã€‚æˆ‘ä¹Ÿä¸çŸ¥é“é’±èŠ±åˆ°å“ªé‡Œå»äº†ã€æ— å¥ˆã€æ‘Šæ‰‹ã€‘ã€‚<br>å½“ç„¶è¿™æ˜¯å¼€ç©ç¬‘å¼çš„æ€»ç»“ï¼Œä½†ä¹Ÿæ˜¯æœ€æ¥è¿‘äº‹å®çš„äº†ã€‚<br>åˆšåˆšç¿»äº†ç¿»2016å¹´å¹´æœ«å†™äº†æ€»ç»“ä¸ª2017çš„è®¡åˆ’ï¼Œæˆ‘å…ˆæ‚ä¼šè„¸ã€‚</p><span id="more"></span><h4 id="å…ˆçœ‹çœ‹å®Œæˆäº†å“ªäº›å§ï¼š"><a href="#å…ˆçœ‹çœ‹å®Œæˆäº†å“ªäº›å§ï¼š" class="headerlink" title="å…ˆçœ‹çœ‹å®Œæˆäº†å“ªäº›å§ï¼š"></a>å…ˆçœ‹çœ‹å®Œæˆäº†å“ªäº›å§ï¼š</h4><ul><li>pythonè¾¾åˆ°åˆçº§æ°´å¹³:è¿™ä¸ªå‹‰å‹‰å¼ºå¼ºç®—æ˜¯è¾¾åˆ°äº†å§ã€‚</li><li>J2EEå­¦ä¹ ssmå’Œnginx:è¿™ä¸ªå°±å¾ˆæƒ­æ„§äº†ï¼Œä¸€ç›´æ²¡çœ‹ï¼Œä¸æ˜¯æ²¡æ—¶é—´ï¼Œå°±æ˜¯å¹³æ—¶å¤§æ¦‚äº†è§£äº†ä¸€ä¸‹ï¼Œæ ¹æœ¬å°±æ²¡æœ‰ç³»ç»Ÿçš„å­¦ä¹ è¿‡ã€‚</li><li>Javaå’ŒAndroidï¼šè¿™ä¸ªä¸€ç›´æ²¡åœä¸‹è¿‡ï¼Œæ¯•ç«Ÿæ˜¯é¥­ç¢—ï¼Œåœ¨åˆ«äººçœ‹æ¥å·®ä¸å¤šå·²ç»æ˜¯é«˜çº§å·¥ç¨‹å¸ˆäº†ï¼Œå¯æˆ‘è§‰å¾—æˆ‘åˆšåˆšåˆ°ä¸­çº§æ°´å¹³å§(æ ‡å‡†ä¸ä¸€æ ·å˜›)ã€‚</li><li>Linuxï¼šè¿™ä¸ªä¹Ÿæ²¡æ€ä¹ˆæ·±å…¥ï¼Œèƒ½åœ¨linuxå¹³å°ä¸‹åšå¼€å‘ã€äº†è§£å¸¸è§é…ç½®ï¼Œé™¤äº†é—®é¢˜èƒ½æ‰¾åˆ°è§£å†³æ–¹æ¡ˆå°±å¥½ã€‚å…¬å¸å¼€å‘åå¢ƒæ˜¯windows,å°±ç®—æˆ‘æƒ³ç”¨linuxï¼Œè¿™ä¸ªä¹Ÿä¸å¤§å¥½ï¼Œåªèƒ½å¹³æ—¶è‡ªå·±ç©ç©ã€‚</li></ul><p>æƒ³æƒ³è‡ªå·±2017å¹´éƒ½å­¦åˆ°äº†å•¥ï¼Œå…¶å®æˆ‘ä¹Ÿä¸çŸ¥é“è‡ªå·±åˆå­¦åˆ°äº†å•¥ï¼Œæœ‰äº›ä¸œè¥¿éƒ½æ˜¯åŸºç¡€æ€§ã€åº•å±‚çš„ä¸œè¥¿ï¼Œè¡¨é¢ä¸Šçœ‹èµ·æ¥æ²¡ä»€ä¹ˆæé«˜ï¼Œå®é™…ä¸Šç°åœ¨æˆ‘ä¹Ÿæ²¡è§‰å¾—æœ‰å•¥ç”¨æˆ·ï¼Œæˆ–è®¸æ˜¯å› ä¸ºè‡ªå·±è¿˜æ²¡æœ‰åˆ°é‚£ä¸ªå±‚æ¬¡å§ã€‚</p><h4 id="è¡¨é¢ä¸Šå­¦åˆ°çš„ä¸œè¥¿å¦‚ä¸‹ï¼š"><a href="#è¡¨é¢ä¸Šå­¦åˆ°çš„ä¸œè¥¿å¦‚ä¸‹ï¼š" class="headerlink" title="è¡¨é¢ä¸Šå­¦åˆ°çš„ä¸œè¥¿å¦‚ä¸‹ï¼š"></a>è¡¨é¢ä¸Šå­¦åˆ°çš„ä¸œè¥¿å¦‚ä¸‹ï¼š</h4><ul><li>è®°å½•äº†ä¸€ä¸‹åœ¨ä½¿ç”¨é«˜å¾·åœ°å›¾è¸©çš„å‘(å†™åˆ°åšå®¢ä¸Šäº†)ã€‚</li><li>å¤§è‡´çœ‹äº†ä¸€ä¸‹tcpåè®®ï¼Œå°±å½“æ˜¯å¤ä¹ äº†ï¼Œå½“æ—¶å­¦ccnaçš„æ—¶å€™ä¹Ÿæ²¡æ€ä¹ˆåœ¨æ„ã€‚</li><li>å¤§è‡´çœ‹äº†ä¸€éã€ŠAndroidå¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹ï¼Œå¯æƒœIPCè¿˜æ˜¯æ²¡å­¦ä¼šã€‚</li><li>å¤§è‡´çœ‹äº†ä¸€ä¸‹pythonç¼–ç¨‹ï¼Œäº†è§£äº†ä¸€ä¸‹flaskå’ŒDjangoã€‚</li><li>åˆå¤§è‡´çœ‹äº†ä¸€éã€Šæ·±å…¥ç†è§£JVMè™šæ‹Ÿæœºã€‹ï¼Œæ„Ÿè§‰ä¸å‡ºæ¥æœ‰ä»€ä¹ˆæé«˜ï¼Œåªæ˜¯èŠå¤©å¹æ°´çš„æ—¶å€™åˆå¤šäº†ç‚¹ä¸œè¥¿ã€‚</li><li>å¤§è‡´çœ‹äº†ä¸€ä¸‹C++ï¼Œæ²¡æ·±å…¥å­¦ä¹ ï¼ŒåšæŒä¸ä¸‹å»äº†ã€‚</li><li>åŠ¨æ‰‹æ­å»ºäº†ä¸€ä¸‹elkï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨ï¼Œæ¯•ç«Ÿå…¬å¸æœ‰ä¸“é—¨çš„è¿ç»´ã€‚</li><li>åŠ¨æ‰‹æ­å»ºäº†ä¸€ä¸‹Jenkinsï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨ï¼Œæ¯•ç«Ÿå…¬å¸æœ‰ä¸“é—¨çš„è¿ç»´ã€‚</li><li>åŠ¨æ‰‹æ­å»ºäº†ä¸€ä¸‹gitæœåŠ¡ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨ï¼Œæ¯•ç«Ÿå…¬å¸æœ‰ä¸“é—¨çš„è¿ç»´ã€‚</li><li>å†™äº†ä¸¤ä¸ªIDEAçš„æ’ä»¶ï¼Œå†™å®Œä¹‹åæ‰å‘ç°æœ‰äººå†™è¿‡äº†ï¼Œè€Œä¸”è¿˜æ˜¯å·²ç»å‘å¸ƒäº†çš„ã€‚</li><li>ç”¨ä¸åŒçš„æ–¹å¼æ–¹æ³•ã€æ¡†æ¶ã€è¯­è¨€æŠŠã€Šç…è›‹ã€‹å†™äº†å¥½å‡ éã€‚</li><li>å¤§è‡´å­¦ä¹ äº†ä¸€ä¸‹kotlinã€‚</li><li>å…¶ä»–çš„å°±æ˜¯è¯»äº†å‡ æœ¬ä¹¦ã€è®¤è¯†äº†å‡ ä¸ªæœ‹å‹ã€‚</li></ul><h4 id="é—æ†¾çš„äº‹"><a href="#é—æ†¾çš„äº‹" class="headerlink" title="é—æ†¾çš„äº‹"></a>é—æ†¾çš„äº‹</h4><ul><li>å’Œå¦¹å­å¼‚åœ°ï¼Œæ²¡æœ‰å¤šé™ªé™ªå¦¹å­ã€‚</li><li>æ²¡æœ‰é”»ç‚¼ï¼Œèº«ä½“ç´ è´¨å·®çš„ä¸è¦ä¸è¦çš„ï¼Œæ‰‹æ— ç¼šé¸¡ä¹‹åŠ›ã€‚</li><li>è‡ªå·±ä¸€ç›´å¿µå¿µä¸å¿˜çš„çƒ­ä¿®å¤æ²¡æœ‰åŠ¨æ‰‹å®è·µè¿‡ã€‚</li><li>è‡ªå·±ä¸€ç›´å¿µå¿µä¸å¿˜çš„å¾®ä¿¡å°ç¨‹åºä¹Ÿæ²¡æœ‰å»è¯•è¯•ã€‚</li><li>è‡ªå·±ä¸€ç›´å¿µå¿µä¸å¿˜çš„æ—¥è¯­ä¹Ÿæ”¾å¼ƒäº†ã€‚</li><li>è„¾æ°”ä¼¼ä¹æš´èºäº†è®¸å¤šï¼Œç«Ÿç„¶å–œæ¬¢ã€Šæ­»äº¡ç¬”è®°ã€‹ä¸­æ‰€æè¿°çš„ä¸–ç•Œã€‚</li></ul><h4 id="æˆ‘å¯èƒ½æ˜¯å…¬å¸é‡Œåœ¨æŠ€æœ¯ä¸Šæœ€èƒ½ä½œ-zuo-ä¸€å£°-çš„äººäº†ï¼Œæ²¡æœ‰ä¹‹ä¸€ï¼š"><a href="#æˆ‘å¯èƒ½æ˜¯å…¬å¸é‡Œåœ¨æŠ€æœ¯ä¸Šæœ€èƒ½ä½œ-zuo-ä¸€å£°-çš„äººäº†ï¼Œæ²¡æœ‰ä¹‹ä¸€ï¼š" class="headerlink" title="æˆ‘å¯èƒ½æ˜¯å…¬å¸é‡Œåœ¨æŠ€æœ¯ä¸Šæœ€èƒ½ä½œ(zuo,ä¸€å£°)çš„äººäº†ï¼Œæ²¡æœ‰ä¹‹ä¸€ï¼š"></a>æˆ‘å¯èƒ½æ˜¯å…¬å¸é‡Œåœ¨æŠ€æœ¯ä¸Šæœ€èƒ½ä½œ(zuo,ä¸€å£°)çš„äººäº†ï¼Œæ²¡æœ‰ä¹‹ä¸€ï¼š</h4><ul><li>ä¸€å¼€å§‹åšè¿è¥ç«¯appï¼Œå«Œå†™<code>findViewById</code>éº»çƒ¦ï¼Œè¯´æœåŒäº‹ç”¨<code>ButterKnife</code>æ³¨è§£ã€‚</li><li>åæ¥éœ€è¦åšå†…éƒ¨æœåŠ¡ç«¯appï¼Œè§‰å¾—ç”¨<code>ButterKnife</code>ä¹ŸæŒºéº»çƒ¦çš„ï¼Œè¿˜å¾—å†™å˜é‡(ç»™å˜é‡å»åå­—å¤ªè›‹ç–¼äº†ï¼Œç•Œé¢å¤æ‚çš„è¯ä¸€ä¸ªç•Œé¢å¥½å‡ åä¸ªæ§ä»¶å˜é‡)ï¼Œä¸Š<code>databinding</code>å§ï¼ŒèŠ±ä¸€å‘¨æ—¶é—´æŠŠåŸæ¥çš„æ³¨è§£å…¨éƒ¨å¹²æ‰ï¼Œæ¢æˆ<code>databinding</code></li><li>åæ¥æƒ³æ”¹ç½‘ç»œæ¡†æ¶æ¥ç€ï¼Œä½†æ˜¯ä¸€ç›´æ²¡æ—¶é—´ï¼Œå¼€å‘éœ€æ±‚ä¸€ç‰ˆæ¥ä¸€ç‰ˆï¼ŒVersionCodeä¸€å¹´å†…å·²ç»åˆ°40äº†ï¼Œåªèƒ½ä½œç½¢ã€‚</li><li>ç°åœ¨ä¸€ç›´æƒ³ä¸Šçƒ­ä¿®å¤æ¥ç€ï¼Œä½†æ˜¯è¿˜æ²¡å¼„ï¼Œåç«¯è¿˜æ²¡å¼„å¥½ï¼Œæœºåˆ¶è¿˜ä¸å®Œå–„ï¼Œä¸è¿‡æˆ‘è§‰å¾—è¿Ÿæ—©å¾—ä¸Šï¼Œæ¯•ç«Ÿæœ‰å•¥æŠ€æœ¯æ”¹åŠ¨éƒ½æ˜¯å†…éƒ¨æœåŠ¡ç«¯appå…ˆä¸Šã€å…ˆç”¨ã€è¶Ÿé›·(æ¯•ç«Ÿå†…éƒ¨äººå‘˜ä½¿ç”¨ï¼Œå¥½è¯´è¯),ç„¶åè¿è¥ç«¯appå†ä¸Š.</li><li></li></ul><h4 id="2018è®¡åˆ’"><a href="#2018è®¡åˆ’" class="headerlink" title="2018è®¡åˆ’"></a>2018è®¡åˆ’</h4><ul><li>æœ‰æ—¶é—´å¤šé™ªé™ªå¦¹å­ã€‚</li><li>åšæŒé”»ç‚¼ã€‚</li><li>è‡³å°‘è¯»3æœ¬ä¹¦ï¼Œè¦æœ‰æ€»ç»“å’Œè¯»åæ„Ÿçš„é‚£ç§ã€‚</li><li>æœ‰æ—¶é—´çš„è¯ï¼Œè‡³å°‘å‚ä¸ä¸€æ¬¡å¼€æºç¿»è¯‘è®¡åˆ’(Apche-CN)\</li><li>äººå·¥æ™ºèƒ½å’Œæœºå™¨å­¦ä¹ æŒºç«çš„ï¼Œå¦¹å­ç ”ç©¶ç”Ÿä¹Ÿæ˜¯è¿™ä¸ªæ–¹å‘ï¼Œå­¦å­¦è¿™ä¸€å—çš„ä¸œè¥¿ï¼Œè‡³å°‘ä¸è¦æ‹–å¦¹å­åè…¿å§ã€‚</li><li>Javaå’ŒAndroidæ–¹å‘ç»§ç»­åŠªåŠ›ï¼Œæ’¸æºç ï¼Œå¤šå­¦ä¹ ã€‚</li><li>åšæŒå†™åšå®¢ï¼Œä¸èƒ½å·æ‡’äº†ã€‚</li><li>ä¿®èº«å…»æ€§ï¼Œåˆ«è¿™ä¹ˆå¤§è„¾æ°”äº†ï¼Œä¸€ç‚¹å°±çˆ†(æŠ±ä¸ªæ¯å­ï¼Œæ³¡ç‚¹æ¸ææŒºä¸é”™çš„)ã€‚</li></ul><h2 id=""><a href="#" class="headerlink" title=""></a><img src="/image/2018_01_01.png" alt="2018"></h2><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>ä¹±ä¸ƒå…«ç³Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Androidä¸­ä½¿ç”¨WebSocket-2</title>
    <link href="/2017/12/26/Android%E4%B8%AD%E4%BD%BF%E7%94%A8WebSocket-2/"/>
    <url>/2017/12/26/Android%E4%B8%AD%E4%BD%BF%E7%94%A8WebSocket-2/</url>
    
    <content type="html"><![CDATA[<p>ä¸Šä¸€ç¯‡æåˆ°åœ¨Androidä¸­ä½¿ç”¨WebSocketå’ŒæœåŠ¡ç«¯è¿›è¡Œé€šä¿¡ã€‚æ˜¯ç›´æ¥åœ¨Activityé‡Œé¢è¿›è¡Œæ“ä½œçš„è¿™æ ·ä¼šä¿æŒä¸€ä¸ªé•¿è¿æ¥ï¼Œä¸€ä¸ªåº”ç”¨é‡Œé¢æ²¡å¿…è¦ä¹Ÿä¸åº”è¯¥ä¿æŒå¤šä¸ªé•¿è¿æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠWebSocketå®¢æˆ·ç«¯æŒªåˆ°Serviceé‡Œé¢ï¼Œä½¿ç”¨å¹¿æ’­å’ŒActivityè¿›è¡Œé€šä¿¡ã€‚</p><span id="more"></span><ol><li>APPç«¯ï¼š<br>ç»§æ‰¿<code>BroadcastReceiver</code>ï¼Œé‡å†™<code>public void onReceive(Context context, Intent intent)</code>æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­è¿›è¡Œä¸šåŠ¡å¤„ç†ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">View</span>.OnClickListener &#123;<br><br>    <span class="hljs-keyword">private</span> TextView showMessage;<br>    <span class="hljs-keyword">private</span> EditText editText;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>    <span class="hljs-keyword">private</span> WebSocketBroadcastReceiver webSocketBroadcastReceiver;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_main);<br>        <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(<span class="hljs-built_in">this</span>, WebSocketService.class);<br>        startService(intent);<br>        showMessage = findViewById(R.id.show_message);<br>        editText = findViewById(R.id.edit_text);<br>        findViewById(R.id.send).setOnClickListener(<span class="hljs-built_in">this</span>);<br>        webSocketBroadcastReceiver = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocketBroadcastReceiver</span>();<br>        <span class="hljs-type">IntentFilter</span> <span class="hljs-variable">intentFilter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntentFilter</span>(<span class="hljs-string">&quot;web_socket&quot;</span>);<br>        registerReceiver(webSocketBroadcastReceiver, intentFilter);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> &#123;<br>        <span class="hljs-keyword">switch</span> (v.getId()) &#123;<br>            <span class="hljs-keyword">case</span> R.id.send:<br><br>                sb.append(<span class="hljs-string">&quot;å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼š&quot;</span>);<br>                sb.append(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().toLocaleString());<br>                sb.append(<span class="hljs-string">&quot;\n&quot;</span>);<br>                sb.append(editText.getText().toString().trim());<br>                sb.append(<span class="hljs-string">&quot;\n&quot;</span>);<br>                showMessage.setText(sb.toString());<br>                <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(<span class="hljs-built_in">this</span>, WebSocketService.class);<br>                intent.putExtra(<span class="hljs-string">&quot;message&quot;</span>, editText.getText().toString().trim());<br>                startService(intent);<br>                editText.setText(<span class="hljs-string">&quot;&quot;</span>);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">default</span>:<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketBroadcastReceiver</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BroadcastReceiver</span> &#123;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> intent.getStringExtra(<span class="hljs-string">&quot;message&quot;</span>);<br>            sb.append(<span class="hljs-string">&quot;æœåŠ¡ç«¯è¿”å›æ¶ˆæ¯ï¼š&quot;</span>);<br>            sb.append(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().toLocaleString());<br>            sb.append(<span class="hljs-string">&quot;\n&quot;</span>);<br>            sb.append(message);<br>            sb.append(<span class="hljs-string">&quot;\n&quot;</span>);<br>            showMessage.setText(sb.toString());<br><br>    &#125;<br>&#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(<span class="hljs-built_in">this</span>, WebSocketService.class);<br>        stopService(intent);<br>        unregisterReceiver(webSocketBroadcastReceiver);<br>        <span class="hljs-built_in">super</span>.onDestroy();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li>Service<br>ç»§æ‰¿<code>Service</code>,åœ¨<code>onCreate()</code>æ–¹æ³•é‡Œé¢åˆ›å»º<code>WebSocketClient</code>å¹¶å’ŒæœåŠ¡ç«¯è¿›è¡Œè¿æ¥ã€‚åœ¨<code>AndroidManifest.xml</code>ä¸­æ³¨å†ŒæœåŠ¡ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Service</span> &#123;<br>    <span class="hljs-keyword">private</span> IoTWebSocketClient ioTWebSocketClient;<br>    <span class="hljs-keyword">private</span> Intent broadcastIntent;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> IBinder <span class="hljs-title function_">onBind</span><span class="hljs-params">(Intent intent)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate();<br>        broadcastIntent = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>();<br>        broadcastIntent.setAction(<span class="hljs-string">&quot;web_socket&quot;</span>);<br>        ioTWebSocketClient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IoTWebSocketClient</span>(URI.create(<span class="hljs-string">&quot;ws://192.168.1.64:8887&quot;</span>));<br>        ioTWebSocketClient.connect();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">onStartCommand</span><span class="hljs-params">(Intent intent, <span class="hljs-type">int</span> flags, <span class="hljs-type">int</span> startId)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> intent.getStringExtra(<span class="hljs-string">&quot;message&quot;</span>);<br>        <span class="hljs-keyword">if</span>(ioTWebSocketClient.isClosing() || ioTWebSocketClient.isClosed())&#123;<br>            stopSelf();<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.onStartCommand(intent, flags, startId);<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            ioTWebSocketClient.send(message);<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.onStartCommand(intent, flags, startId);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> &#123;<br>        ioTWebSocketClient.close();<br>        ioTWebSocketClient = <span class="hljs-literal">null</span>;<br>        <span class="hljs-built_in">super</span>.onDestroy();<br>    &#125;<br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">IoTWebSocketClient</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebSocketClient</span> &#123;<br><br>        IoTWebSocketClient(URI serverUri) &#123;<br>            <span class="hljs-built_in">super</span>(serverUri);<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onOpen</span><span class="hljs-params">(ServerHandshake handshakedata)</span> &#123;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(String message)</span> &#123;<br>            broadcastIntent.putExtra(<span class="hljs-string">&quot;message&quot;</span>, message);<br>            WebSocketService.<span class="hljs-built_in">this</span>.sendBroadcast(broadcastIntent);<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClose</span><span class="hljs-params">(<span class="hljs-type">int</span> code, String reason, <span class="hljs-type">boolean</span> remote)</span> &#123;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Exception ex)</span> &#123;<br>            stopSelf();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>åœ¨<code>onStartCommand()</code>æ–¹æ³•é‡Œé¢ï¼Œå¯¹å‘é€æ¶ˆæ¯æ–¹æ³•çš„è°ƒç”¨è¿›è¡Œå¼‚å¸¸æ•è·ï¼Œæ˜¯å› ä¸ºè¿™æ—¶å€™å¯èƒ½æœåŠ¡ç«¯é‡å¯æˆ–è€…æœåŠ¡ç«¯è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œè¿™æ˜¯å‘é€æ¶ˆæ¯ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚è¿›è¡Œæ”¹è¿›ã€‚</li></ol><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>WebSocket</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Androidä¸­ä½¿ç”¨WebSocket</title>
    <link href="/2017/12/25/Android%E4%B8%AD%E4%BD%BF%E7%94%A8WebSocket/"/>
    <url>/2017/12/25/Android%E4%B8%AD%E4%BD%BF%E7%94%A8WebSocket/</url>
    
    <content type="html"><![CDATA[<p>èƒŒæ™¯ï¼šåç«¯é€»è¾‘æ¡†æ¶è°ƒæ•´ï¼Œå°†åŸæ¥çš„æ¨é€å’Œè½®è¯¢æ–¹å¼æ”¹æˆäº†ä½¿ç”¨<code>WebSocket</code>é€šä¿¡ã€‚åŸæ¥çš„è¯·æ±‚æ–¹å¼æ˜¯ç”±appå‘èµ·è¯·æ±‚ï¼ŒappServerå¯¹è¯·æ±‚è¿›è¡Œåˆ†å‘ï¼Œä¸­è½¬ä¸­ç»§æœåŠ¡å™¨å°†å…·ä½“è¯·æ±‚ä¸‹å‘åˆ°å¯¹åº”çš„ç‰©è”ç½‘æœåŠ¡å™¨ï¼Œç‰©è”ç½‘æœåŠ¡å™¨å°†æŒ‡ä»¤ä¸‹å‘åˆ°æŒ‡å®šçš„è®¾å¤‡ã€‚æ•´ä¸ªæµç¨‹æ¶‰åŠåˆ°å¾ˆå¤šå±‚httpè¯·æ±‚ï¼Œå¹¶ä¸”æ¯ä¸ªæœåŠ¡çš„å›è°ƒæ¥å£è¿˜ä¸ä¸€è‡´ï¼Œåªèƒ½åœ¨appå‘æƒ…è¯·æ±‚ä¹‹åï¼Œæ¥ç€å»è½®è¯¢æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ç«¯å»æŸ¥è¯¢è®¾å¤‡çŠ¶æ€ã€æ˜¯å¦å¯¹æŒ‡ä»¤æœ‰å“åº”ã€‚<br>æ”¹ç‰ˆåæ¶‰åŠåˆ°å¯¹ç‰©è”ç½‘çš„è¯·æ±‚å…¨éƒ¨æ”¹æˆ<code>WebSocket</code>,ä¸åœ¨è½®è¯¢ï¼Œè€Œæ˜¯è¢«åŠ¨ç­‰å¾…ã€‚<br>åç«¯ä½¿ç”¨çš„æ˜¯<code>Spring</code>å®ç°çš„<code>WebSocket</code>,appç«¯ä½¿ç”¨çš„æ˜¯<a href="https://github.com/TooTallNate/Java-WebSocket">https://github.com/TooTallNate/Java-WebSocket</a>è¿™ä¸ªå¼€æºé¡¹ç›®ã€‚</p><span id="more"></span><h4 id="APPç«¯å®ç°"><a href="#APPç«¯å®ç°" class="headerlink" title="APPç«¯å®ç°"></a>APPç«¯å®ç°</h4><ol><li>æ·»åŠ ä¾èµ–<code>compile &quot;org.java-websocket:Java-WebSocket:1.3.7&quot;</code></li><li>æˆ‘ä»¬åªéœ€è¦å…³å¿ƒä¸‰æ–¹åº“ä¸­<code>WebSocketClient</code>ç±»å°±å¯ä»¥äº†ï¼Œå…¶ä»–ç»†èŠ‚åº•å±‚å·²ç»å°è£…å¥½äº†ã€‚</li><li>ç±»ä¸­æœ‰å››ä¸ªæ–¹æ³•éœ€è¦é‡å†™ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**æ‰“å¼€è¿æ¥*/</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onOpen</span><span class="hljs-params">(ServerHandshake handshakedata)</span><br> <span class="hljs-comment">/**æœåŠ¡ç«¯è¿”å›æ¶ˆæ¯*/</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(String message)</span> <br> <span class="hljs-comment">/**å…³é—­è¿æ¥*/</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClose</span><span class="hljs-params">(<span class="hljs-type">int</span> code, String reason, <span class="hljs-type">boolean</span> remote)</span><br> <span class="hljs-comment">/**å‡ºç°å¼‚å¸¸*/</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Exception ex)</span><br></code></pre></td></tr></table></figure></li><li>ä¸€ä¸ªç®€å•çš„å°æµ‹è¯•ï¼Œappç«¯å®šä¹‰äº†ä¸€ä¸ªå‘é€æŒ‰é’®ï¼Œå’Œä¸€ä¸ªå±•ç¤ºæ¶ˆæ¯çš„æ–‡æœ¬<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">&quot;http://schemas.android.com/tools&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">&quot;vertical&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:context</span>=<span class="hljs-string">&quot;com.huangyuanlove.testwebsocket.MainActivity&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ScrollView</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;0dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_weight</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/show_message&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">ScrollView</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">&quot;horizontal&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">EditText</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/edit_text&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;0dp&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_weight</span>=<span class="hljs-string">&quot;1&quot;</span> /&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/send&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:background</span>=<span class="hljs-string">&quot;@color/colorAccent&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:padding</span>=<span class="hljs-string">&quot;10dp&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:text</span>=<span class="hljs-string">&quot;å‘é€&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:textColor</span>=<span class="hljs-string">&quot;@android:color/black&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li>åœ¨ä»£ç é‡Œé¢å¤„ç†å…·ä½“é€»è¾‘ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> android.os.Bundle;<br><span class="hljs-keyword">import</span> android.os.Handler;<br><span class="hljs-keyword">import</span> android.os.Message;<br><span class="hljs-keyword">import</span> android.support.design.widget.Snackbar;<br><span class="hljs-keyword">import</span> android.support.v7.app.AppCompatActivity;<br><span class="hljs-keyword">import</span> android.view.View;<br><span class="hljs-keyword">import</span> android.widget.EditText;<br><span class="hljs-keyword">import</span> android.widget.TextView;<br><br><span class="hljs-keyword">import</span> org.java_websocket.client.WebSocketClient;<br><span class="hljs-keyword">import</span> org.java_websocket.handshake.ServerHandshake;<br><br><span class="hljs-keyword">import</span> java.net.URI;<br><span class="hljs-keyword">import</span> java.util.Date;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">View</span>.OnClickListener &#123;<br><br><br>    <span class="hljs-keyword">private</span> TextView showMessage;<br>    <span class="hljs-keyword">private</span> EditText editText;<br>    <span class="hljs-keyword">private</span> WebSocketClient webSocketClient;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Handler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>.Callback() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(Message msg)</span> &#123;<br>            sb.append(<span class="hljs-string">&quot;æœåŠ¡å™¨è¿”å›æ•°æ®ï¼š&quot;</span>);<br>            sb.append(msg.obj.toString());<br>            sb.append(<span class="hljs-string">&quot;\n&quot;</span>);<br>            showMessage.setText(sb.toString());<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;);<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_main);<br>        showMessage = findViewById(R.id.show_message);<br>        editText = findViewById(R.id.edit_text);<br>        findViewById(R.id.send).setOnClickListener(<span class="hljs-built_in">this</span>);<br>        <span class="hljs-type">URI</span> <span class="hljs-variable">serverURI</span> <span class="hljs-operator">=</span> URI.create(<span class="hljs-string">&quot;ws://192.168.1.199:8887&quot;</span>);<br>        webSocketClient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocketClient</span>(serverURI) &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onOpen</span><span class="hljs-params">(ServerHandshake handshakedata)</span> &#123;<br>                sb.append(<span class="hljs-string">&quot;onOpen at timeï¼š&quot;</span>);<br>                sb.append(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>                sb.append(<span class="hljs-string">&quot;æœåŠ¡å™¨çŠ¶æ€ï¼š&quot;</span>);<br>                sb.append(handshakedata.getHttpStatusMessage());<br>                sb.append(<span class="hljs-string">&quot;\n&quot;</span>);<br>                showMessage.setText(sb.toString());<br>            &#125;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(String message)</span> &#123;<br>                <span class="hljs-type">Message</span> <span class="hljs-variable">handlerMessage</span> <span class="hljs-operator">=</span> Message.obtain();<br>                handlerMessage.obj = message;<br>                handler.sendMessage(handlerMessage);<br>            &#125;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClose</span><span class="hljs-params">(<span class="hljs-type">int</span> code, String reason, <span class="hljs-type">boolean</span> remote)</span> &#123;<br>                sb.append(<span class="hljs-string">&quot;onClose at timeï¼š&quot;</span>);<br>                sb.append(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>                sb.append(<span class="hljs-string">&quot;\n&quot;</span>);<br>                sb.append(<span class="hljs-string">&quot;onClose info:&quot;</span>);<br>                sb.append(code);<br>                sb.append(reason);<br>                sb.append(remote);<br>                sb.append(<span class="hljs-string">&quot;\n&quot;</span>);<br>                showMessage.setText(sb.toString());<br>            &#125;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Exception ex)</span> &#123;<br>                sb.append(<span class="hljs-string">&quot;onError at timeï¼š&quot;</span>);<br>                sb.append(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>                sb.append(<span class="hljs-string">&quot;\n&quot;</span>);<br>                sb.append(ex);<br>                sb.append(<span class="hljs-string">&quot;\n&quot;</span>);<br>                showMessage.setText(sb.toString());<br>            &#125;<br>        &#125;;<br>        webSocketClient.connect();<br><br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> &#123;<br>        <span class="hljs-keyword">switch</span> (v.getId()) &#123;<br>            <span class="hljs-keyword">case</span> R.id.send:<br>                <span class="hljs-keyword">if</span>(webSocketClient.isClosed() || webSocketClient.isClosing())&#123;<br>                    Snackbar.make(v,<span class="hljs-string">&quot;Clientæ­£åœ¨å…³é—­&quot;</span>,Snackbar.LENGTH_SHORT).show();<br>                    webSocketClient.connect();<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>                webSocketClient.send(editText.getText().toString().trim());<br>                sb.append(<span class="hljs-string">&quot;å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼š&quot;</span>);<br>                sb.append(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>                sb.append(<span class="hljs-string">&quot;\n&quot;</span>);<br>                sb.append(editText.getText().toString().trim());<br>                sb.append(<span class="hljs-string">&quot;\n&quot;</span>);<br>                showMessage.setText(sb.toString());<br>                editText.setText(<span class="hljs-string">&quot;&quot;</span>);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">default</span>:<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="æœåŠ¡ç«¯å®ç°"><a href="#æœåŠ¡ç«¯å®ç°" class="headerlink" title="æœåŠ¡ç«¯å®ç°"></a>æœåŠ¡ç«¯å®ç°</h4>ä¸Šé¢æåˆ°æˆ‘ä»¬åç«¯ä½¿ç”¨çš„Springä¸­çš„WebSocketå®ç°ï¼Œå…¶å®ç”¨ä»€ä¹ˆå®ç°æœåŠ¡ç«¯æ— æ‰€è°“ï¼Œåªè¦éµå¾ªåè®®å°±å¯ä»¥ã€‚ä¸ªäººåœ¨æœ¬åœ°åšæµ‹è¯•çš„æ—¶å€™ç”¨çš„è¿˜æ˜¯è¿™ä¸ªå¼€æºé¡¹ç›®ã€‚</li><li>æœåŠ¡ç«¯åªéœ€è¦å…³å¿ƒ<code>WebSocketServer</code>è¿™ä¸ªç±»å°±å¥½ï¼Œè¿™ä¸ªç±»é‡Œé¢æœ‰äº”ä¸ªæ–¹æ³•éœ€è¦é‡å†™ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**æœåŠ¡å¼€å¯*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onStart</span><span class="hljs-params">()</span> <br><span class="hljs-comment">/**æœ‰å®¢æˆ·ç«¯è¿æ¥*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onOpen</span><span class="hljs-params">(WebSocket webSocket, ClientHandshake clientHandshake)</span><br><span class="hljs-comment">/**æœåŠ¡ç«¯å…³é—­*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClose</span><span class="hljs-params">(WebSocket webSocket, <span class="hljs-type">int</span> i, String s, <span class="hljs-type">boolean</span> b)</span><br><span class="hljs-comment">/**æ”¶åˆ°å®¢æˆ·ç«¯çš„æ¶ˆæ¯*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(WebSocket webSocket, String s)</span><br><span class="hljs-comment">/**å‡ºç°å¼‚å¸¸*/</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(WebSocket webSocket, Exception e)</span> <br></code></pre></td></tr></table></figure></li><li>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.huangyuanlove;<br><br><span class="hljs-keyword">import</span> org.java_websocket.WebSocket;<br><span class="hljs-keyword">import</span> org.java_websocket.WebSocketImpl;<br><span class="hljs-keyword">import</span> org.java_websocket.handshake.ClientHandshake;<br><span class="hljs-keyword">import</span> org.java_websocket.server.WebSocketServer;<br><br><span class="hljs-keyword">import</span> java.io.BufferedReader;<br><span class="hljs-keyword">import</span> java.io.InputStreamReader;<br><span class="hljs-keyword">import</span> java.net.InetSocketAddress;<br><span class="hljs-keyword">import</span> java.net.UnknownHostException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestWebSocket</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebSocketServer</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TestWebSocket</span><span class="hljs-params">(<span class="hljs-type">int</span> port)</span> <span class="hljs-keyword">throws</span> UnknownHostException &#123;<br>        <span class="hljs-built_in">super</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InetSocketAddress</span>(port));<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TestWebSocket</span><span class="hljs-params">(InetSocketAddress address)</span> &#123;<br>        <span class="hljs-built_in">super</span>(address);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        WebSocketImpl.DEBUG = <span class="hljs-literal">true</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> <span class="hljs-number">8887</span>; <span class="hljs-comment">// 843 flash policy port</span><br>            <span class="hljs-type">TestWebSocket</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestWebSocket</span>(port);<br>            s.start();<br>            System.out.println(<span class="hljs-string">&quot;ChatServer started on port: &quot;</span> + s.getPort());<br><br>            <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">sysin</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(System.in));<br>            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>                <span class="hljs-type">String</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> sysin.readLine();<br>                s.broadcast(in);<br>                <span class="hljs-keyword">if</span> (in.equals(<span class="hljs-string">&quot;exit&quot;</span>)) &#123;<br>                    s.stop(<span class="hljs-number">1000</span>);<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>            ex.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onOpen</span><span class="hljs-params">(WebSocket webSocket, ClientHandshake clientHandshake)</span> &#123;<br><br>        broadcast(<span class="hljs-string">&quot;new connection: &quot;</span> + clientHandshake.getResourceDescriptor());<br>        System.out.println(webSocket.getRemoteSocketAddress().getAddress().getHostAddress() + <span class="hljs-string">&quot; entered the room!&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClose</span><span class="hljs-params">(WebSocket webSocket, <span class="hljs-type">int</span> i, String s, <span class="hljs-type">boolean</span> b)</span> &#123;<br>        broadcast(webSocket + <span class="hljs-string">&quot; onClose&quot;</span>);<br>        System.out.println(webSocket + <span class="hljs-string">&quot; onClose&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(WebSocket webSocket, String s)</span> &#123;<br><br>        broadcast(s);<br>        System.out.println(webSocket + <span class="hljs-string">&quot;: &quot;</span> + s);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(WebSocket webSocket, Exception e)</span> &#123;<br>        e.printStackTrace();<br>        <span class="hljs-keyword">if</span> (webSocket != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// some errors like port binding failed may not be assignable to a specific websocket</span><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onStart</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Server started!&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>ä¸Šé¢ä»£ç ä¸­<code>onMessage</code>æ–¹æ³•ä¸­çš„<code>broadcast</code>æ–¹æ³•æ˜¯å‘æ‰€æœ‰è¿æ¥åˆ°æœåŠ¡å™¨çš„å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯(å¹¿æ’­å‘é€ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå°å‹çš„å±€åŸŸç½‘èŠå¤©å®¤)ï¼Œå¦‚æœåªæ˜¯è°å‘æ¥çš„æ¶ˆæ¯å°±å›å¤ç»™è°ï¼Œå¯ä»¥è°ƒç”¨<code>webSocket.send()</code>æ–¹æ³•ã€‚<br>æ˜¯ç”¨çš„æ—¶å€™å…ˆå¼€å¯æœåŠ¡ç«¯ï¼Œç„¶åå¼€å¯å®¢æˆ·ç«¯(app)ï¼Œéœ€è¦æ³¨æ„æ˜¯çš„ï¼Œåœ¨å®¢æˆ·ç«¯ä¸­é‡å†™çš„æ–¹æ³•éƒ½ä¸æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œå¦‚æœéœ€è¦æ›´æ–°UIï¼Œè¯·åˆ‡æ¢åˆ°UIçº¿ç¨‹ã€‚<br>æˆ–è€…åœ¨å®¢æˆ·ç«¯ä¸­ä½¿ç”¨<code>Service</code>,åœ¨<code>Service</code>ä¸­æ”¶åˆ°æ¶ˆæ¯ä¹‹åï¼Œå¹¿æ’­ç»™UIç•Œé¢ã€‚</li></ol><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>WebSocket</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šæˆ‘çš„å®‰å“çˆ¬å‘ä¹‹æ—…ã€‹-é«˜å¾·åœ°å›¾é‡åˆ°çš„å‘-3</title>
    <link href="/2017/12/19/%E3%80%8A%E6%88%91%E7%9A%84%E5%AE%89%E5%8D%93%E7%88%AC%E5%9D%91%E4%B9%8B%E6%97%85%E3%80%8B-%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BE%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91-3/"/>
    <url>/2017/12/19/%E3%80%8A%E6%88%91%E7%9A%84%E5%AE%89%E5%8D%93%E7%88%AC%E5%9D%91%E4%B9%8B%E6%97%85%E3%80%8B-%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BE%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91-3/</url>
    
    <content type="html"><![CDATA[<p>è¿™æ¬¡æ˜¯é€†åœ°ç†ä½ç½®ç¼–ç å‡ºç°çš„å‘ï¼Œåœ¨æäº¤å·¥å•åï¼Œå®˜æ–¹å›å¤æ˜¯badcaseï¼Œå·²ç»æ”¶å½•ï¼Œåç»­ç€æ‰‹ä¼˜åŒ–ã€‚<br>SDKç‰ˆæœ¬å·ï¼š<code>com.amap.api:location:3.6.1</code>ã€<code>com.amap.api:map3d:4.1.3</code>ã€<code>com.amap.api:map3d-native:4.1.3</code>ã€<code>com.amap.api:search:5.5.0</code>ã€‚</p><span id="more"></span><p>è¿‡ç¨‹å¦‚ä¸‹ï¼š<br>2017å¹´12æœˆ5å·æ¥åˆ°ç”¨æˆ·åé¦ˆï¼Œå®šä½ä½ç½®å‡†ç¡®ï¼Œä½†æ˜¯æ˜¾ç¤ºçš„ä¸­æ–‡å…·ä½“ä½ç½®ä¸å‡†ç¡®ï¼Œè¯¯å·®å¤§æ¦‚åœ¨åƒç±³çº§åˆ«ã€‚å½“æ—¶å°±éº»çˆªäº†ï¼Œè¿™å¯ä¸æ˜¯è¯¯å·®ï¼Œè¿™æ˜¯é”™è¯¯ã€‚</p><ol><li>é¦–å…ˆæ’é™¤ç½‘ç»œä»¥åŠä¿¡å·é—®é¢˜ï¼š<br>æ ¹æ®ç”¨æˆ·åé¦ˆï¼Œå¾—çŸ¥ç”¨æˆ·æ‰€åœ¨ä½ç½®ä¿¡å·è‰¯å¥½ï¼Œå‘¨å›´ä¸å­˜åœ¨é®ç›–ç‰©ï¼Œä¹Ÿä¸åœ¨åœ°ä¸‹å®¤ä¹‹ç±»çš„ä¿¡å·å·®çš„åœ°æ–¹ï¼Œä¸å­˜åœ¨å®šä½åå·®é—®é¢˜(appä¸Šæ˜¾ç¤ºçš„å®šä½å’Œæ‰‹æœºä½ç½®ä¸€è‡´)ã€‚<br>ç½‘ç»œçŠ¶å†µè‰¯å¥½ï¼Œæµè§ˆå™¨å¯ä»¥æ‰“å¼€ç½‘é¡µã€appå¯ä»¥è¿›è¡Œå…¶ä»–æ“ä½œã€‚<br>å…ˆæ’é™¤ç”¨æˆ·ä½¿ç”¨æƒ…å†µçš„åŸå› æ˜¯ï¼šæ¥åˆ°è¿‡å¤šæ¬¡åé¦ˆï¼Œæ˜¯å› ä¸ºç”¨æˆ·æ²¡æœ‰çœ‹appæç¤ºï¼Œæˆ–è€…ç›´æ¥å¿½ç•¥æ‰æç¤ºå¯¼è‡´çš„è¯¯æŠ¥ã€‚</li><li>æ’é™¤ä»£ç é—®é¢˜</li></ol><ul><li>åœ¨æµ‹è¯•æœä¸Šè¿›è¡ŒåŒæ ·æ“ä½œï¼Œå¾—åˆ°çš„åæ ‡å€¼æ­£ç¡®(æ‰‹æœºæ‹¿åˆ°åæ ‡å€¼åœ¨appä¸Šæ˜¾ç¤ºï¼Œç„¶åæŠŠåæ ‡æ‹¿åˆ°é«˜å¾·åæ ‡æ‹¾å–ç³»ç»Ÿè¿›è¡Œå®šä½ï¼Œæ˜¾ç¤ºä½ç½®ä¸€è‡´)ï¼Œå®šä½ä»¥åŠå±•ç¤ºä»£ç æ²¡é—®é¢˜ã€‚</li><li>æ‹¿åˆ°åæ ‡å€¼åœ¨å®¢æˆ·ç«¯è¿›è¡Œé€†åœ°ç†ä½ç½®ç¼–ç (<code>RegeocodeQuery query = new RegeocodeQuery(new LatLonPoint(lat, lon), 200,GeocodeSearch.AMAP); geocoderSearch.getFromLocationAsyn(query);</code>)ï¼Œå¾—åˆ°çš„åœ°ç†ä½ç½®æ­£ç¡®ï¼Œè¯¯å·®åœ¨æ‰€ä¼ å‚æ•°ä»¥å†…ï¼Œæ”¹å˜é€†åœ°ç†ä½ç½®ç¼–ç çš„ç»ç¡®å®šï¼Œæ”¹å˜å®šä½ä½ç½®(åŒ—äº¬å¸‚å†…éšæœºå–ç‚¹)ï¼Œå¤šæ¬¡æ“ä½œï¼Œå®šä½åŠå±•ç¤ºä»¥åŠé€†åœ°ç†ä½ç½®ç¼–ç å‡æ­£ç¡®ã€‚<br>åˆ°è¿™ï¼Œå°±æœ‰ç‚¹æŠ“ç‹‚äº†ï¼Œè¿™TMä»€ä¹ˆé—®é¢˜ï¼Œåˆ°åº•å“ªé‡Œå‡ºé—®é¢˜äº†ã€‚ã€‚</li><li>å…¨å›½èŒƒå›´å†…å–ç‚¹ï¼Œä»£ç å‚æ•°å’Œç”Ÿäº§ç¯å¢ƒä¿æŒä¸€è‡´ï¼Œç¥ˆç¥·ç€æˆ–è®¸æ˜¯å› ä¸ºåœ¨æ–°ç–†è¿™ç§ç©ºæ—·ã€å»ºç­‘ç‰©å°‘çš„åœ°æ–¹ï¼Œè¯¯å·®å¯èƒ½ä¼šå¤§äº›(å¥½å‡ å…¬é‡Œæ²¡æœ‰å»ºç­‘ç‰©ï¼Œæ²¡æœ‰æ˜æ˜¾åœ°æ ‡ï¼Œæ€»ä¸èƒ½å±•ç¤ºç¬¬å‡ è¯¾ç™½æ¨æ ‘ä¸‹å§ï¼Œ23333)ã€‚æŠ“åˆ°äº†åè¿œåœ°åŒºçš„åæ ‡ä»¥åŠååˆ†ç©ºæ—·åœ°åŒºçš„åæ ‡ï¼Œå±•ç¤ºä»¥åŠä½ åœ°ç†ä½ç½®ç¼–ç å‡æ­£ç¡®ã€‚</li><li>è¿™æ—¶å€™ä¹Ÿå†·é™ä¸‹æ¥äº†ï¼Œå‡ºäº†é—®é¢˜ä¸ä¸€å®šæ˜¯è‡ªå·±ä»£ç é—®é¢˜å—ï¼Œæœ‰å¯èƒ½æ˜¯äºŒæ–¹ã€ä¸‰æ–¹ä»£ç çš„é”…ï¼Œåªæ˜¯ä¹ æƒ¯ä¸Šå…»æˆäº†å‡ºäº†é—®é¢˜å…ˆæ‰¾è‡ªå·±çš„åŸå› ï¼Œæ‰¾ä¸åˆ°å†æ‰¾å…¶ä»–çš„ã€‚æ‰¾é«˜å¾·ï¼Œæå·¥å•ï¼Œè¯¦ç»†æè¿°é—®é¢˜ï¼š<blockquote><p>å…·ä½“æƒ…å†µè¿™æ ·ï¼š<br>æˆ‘æŠŠ(119.564298,31.995402)è¿™ä¸ªåæ ‡ç”¨å®¢æˆ·ç«¯è°ƒç”¨é€†åœ°ç†ä½ç½®ç¼–ç æ¥å£:<br>RegeocodeQuery query &#x3D; new RegeocodeQuery(new LatLonPoint(lat, lon), 200,GeocodeSearch.AMAP);<br>geocoderSearch.getFromLocationAsyn(query);<br>åœ¨å›è°ƒå‡½æ•°public void onRegeocodeSearched(RegeocodeResult result, int rCode)ä¸­å–å¾—ç»“æœï¼šresult.getRegeocodeAddress().getFormatAddress() æ˜¯<strong>æ±Ÿè‹çœé•‡æ±Ÿå¸‚ä¸¹é˜³å¸‚äº‘é˜³é•‡åŒ—ç¯è·¯6å·</strong>ã€‚<br>ä½†å®é™…ä¸Š<strong>æ±Ÿè‹çœé•‡æ±Ÿå¸‚ä¸¹é˜³å¸‚äº‘é˜³é•‡åŒ—ç¯è·¯6å·</strong>è¿™ä¸ªåœ°å€ä¸ä¸Šè¿°åæ ‡ç‚¹è·ç¦»å¾ˆè¿œ(è¿™ä¸ªæ˜¯åœ¨é«˜å¾·åæ ‡æ‹¾å–å™¨ <a href="http://lbs.amap.com/console/show/picker">http://lbs.amap.com/console/show/picker</a> ä¸Šçœ‹åˆ°çš„)ã€‚</p></blockquote></li></ul><ol start="3"><li>é«˜å¾·å›å¤<br>ç¬¬äºŒå¤©é«˜å¾·ç»™äº†å›å¤ï¼š<blockquote><p>æ‚¨å¥½ï¼Œæ„Ÿè°¢åé¦ˆï¼Œç›®å‰è¿™å—çš„ç®—æ³•ç¡®å®æœ‰ä¸€äº›é—®é¢˜ï¼Œæ‚¨çš„badcaseæˆ‘ä»¬å·²ç»æ”¶å½•ï¼Œåç»­ä¼šé’ˆå¯¹è¿™å—åšä¼˜åŒ–ã€‚ç»™æ‚¨é€ æˆä¸ä¾¿æ•¬è¯·è°…è§£ã€‚<br>æ„Ÿè°¢æ‚¨çš„è‡´ä¿¡ï¼Œæ¬¢è¿æŒç»­å…³æ³¨é«˜å¾·å¼€æ”¾å¹³å°ï¼</p></blockquote></li></ol><h2 id=""><a href="#" class="headerlink" title=""></a><img src="/image/gaode/geocoderSearch_bug.png" alt="geocoderSearch"></h2><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Androidçˆ¬å‘ä¹‹æ—…</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>flaskç¬”è®°ä¸€ å¿«é€Ÿå…¥é—¨</title>
    <link href="/2017/07/15/flask%E7%AC%94%E8%AE%B0%E4%B8%80(%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8)/"/>
    <url>/2017/07/15/flask%E7%AC%94%E8%AE%B0%E4%B8%80(%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8)/</url>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ pythonå’Œflaskä¸­çœ‹è¿‡çš„èµ„æ–™å’Œè‡ªå·±çš„å®è·µæ€»ç»“<br><a href="http://flask.pocoo.org/">Flaskè‹±æ–‡</a><br>ä»¥ä¸‹å†…å®¹æ¥è‡ª<a href="http://docs.jinkan.org/docs/flask">flaskä¸­æ–‡</a></p><span id="more"></span><h4 id="ç¯å¢ƒå®‰è£…"><a href="#ç¯å¢ƒå®‰è£…" class="headerlink" title="ç¯å¢ƒå®‰è£…"></a>ç¯å¢ƒå®‰è£…</h4><p>Flaskä¾èµ–ä¸¤ä¸ªå¤–éƒ¨åº“ï¼šWerkzeugå’ŒJinja2ã€‚Werkzeugæ˜¯ä¸€ä¸ªWSGIå·¥å…·é›†ã€Jinja2è´Ÿè´£æ¸²æŸ“æ¨¡æ¿ã€‚é¦–å…ˆéœ€è¦python2.6æˆ–è€…æ›´é«˜çš„ç‰ˆæœ¬ï¼Œpython3.Xå®‰è£…æ–¹å¼å¯èƒ½æœ‰æ‰€ä¸ä¸€è‡´ã€‚</p><h6 id="virtualenv"><a href="#virtualenv" class="headerlink" title="virtualenv"></a>virtualenv</h6><p>virtualenv ä¸ºæ¯ä¸ªä¸åŒé¡¹ç›®æä¾›ä¸€ä»½ Python å®‰è£…ã€‚å®ƒå¹¶æ²¡æœ‰çœŸæ­£å®‰è£…å¤šä¸ª Python å‰¯æœ¬ï¼Œä½†æ˜¯å®ƒç¡®å®æä¾›äº†ä¸€ç§å·§å¦™çš„æ–¹å¼æ¥è®©å„é¡¹ç›®ç¯å¢ƒä¿æŒç‹¬ç«‹ã€‚<br><code>sudo apt-get install python-virtualenv</code><br>virtualenvå®‰è£…å®Œæˆåï¼Œç”¨IDEæ¯”å¦‚pycharmåˆ›å»ºä¸€ä¸ªFlaskçš„é¡¹ç›®å·¥ç¨‹ï¼Œå¹¶åœ¨å…¶ä¸‹åˆ›å»ºä¸€ä¸ªvenvæ–‡ä»¶å¤¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> myproject</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> myproject</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">virtualenv venv</span><br>New python executable in venv/bin/python<br>Installing distribute............done.<br></code></pre></td></tr></table></figure><p>ç„¶åæ¿€æ´»ç›¸åº”çš„ç¯å¢ƒ<br><code>$ . venv/bin/activate</code><br>ç„¶åæ¿€æ´»virtualenvä¸­çš„Flask<br><code>$ pip install Flask</code></p><h4 id="é¡¹ç›®é…ç½®"><a href="#é¡¹ç›®é…ç½®" class="headerlink" title="é¡¹ç›®é…ç½®"></a>é¡¹ç›®é…ç½®</h4><p>åœ¨pycharmä¸­ï¼Œæ‰“å¼€setting<br><img src="/image/python/Flask/pycharm_project_setting1.png" alt="é¡¹ç›®è®¾ç½®"><br>åœ¨Project Interpreterä¸­é€‰æ‹©å½“å‰å·¥ç¨‹æ–‡ä»¶ä¸‹çš„virtualenv<br>æ‰“å¼€å·¥ç¨‹çš„Configuration<br><img src="/image/python/Flask/pycharm_project_setting2.png" alt="é¡¹ç›®è®¾ç½®"><br>åœ¨python interpreterä¸­é€‰æ‹©å½“å‰å·¥ç¨‹æ–‡ä»¶ä¸‹çš„virtualenv</p><h4 id="é¡¹ç›®è¯´æ˜"><a href="#é¡¹ç›®è¯´æ˜" class="headerlink" title="é¡¹ç›®è¯´æ˜"></a>é¡¹ç›®è¯´æ˜</h4><h6 id="æ€»è¿°"><a href="#æ€»è¿°" class="headerlink" title="æ€»è¿°"></a>æ€»è¿°</h6><p>åˆšåˆšæ–°å»ºçš„å·¥ç¨‹çœ‹èµ·æ¥ä¼šæ˜¯è¿™æ ·çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_world</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello World!&#x27;</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run()<br></code></pre></td></tr></table></figure><p>è¿è¡Œè¿™æ®µç¨‹åº(æ–‡ä»¶åä¸è¦æ˜¯ flask.pyï¼Œè¿™ä¼šå’Œå·²æœ‰çš„æ–‡ä»¶å†²çª)ï¼Œæµè§ˆå™¨è®¿é—®<code>127.0.0.1:5000</code>ï¼Œç„¶åå°±ä¼šçœ‹åˆ°ç†Ÿæ‚‰çš„<code>hello world</code>.<br>é‚£ä¹ˆï¼Œè¿™æ®µä»£ç åšäº†ä»€ä¹ˆï¼Ÿ</p><ol><li>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥äº† Flask ç±»ã€‚è¿™ä¸ªç±»çš„å®ä¾‹å°†ä¼šæ˜¯æˆ‘ä»¬çš„ WSGI åº”ç”¨ç¨‹åºã€‚<br>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¯¥ç±»çš„å®ä¾‹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åº”ç”¨æ¨¡å—æˆ–è€…åŒ…çš„åç§°ã€‚ å¦‚æœä½ ä½¿ç”¨å•ä¸€çš„æ¨¡å—ï¼ˆå¦‚æœ¬ä¾‹ï¼‰ï¼Œä½ åº”è¯¥ä½¿ç”¨ <strong>name</strong> ï¼Œå› ä¸ºæ¨¡å—çš„åç§°å°†ä¼šå› å…¶ä½œä¸ºå•ç‹¬åº”ç”¨å¯åŠ¨è¿˜æ˜¯ä½œä¸ºæ¨¡å—å¯¼å…¥è€Œæœ‰ä¸åŒï¼ˆ ä¹Ÿå³æ˜¯ â€˜<strong>main</strong>â€˜ æˆ–å®é™…çš„å¯¼å…¥åï¼‰ã€‚è¿™æ˜¯å¿…é¡»çš„ï¼Œè¿™æ · Flask æ‰çŸ¥é“åˆ°å“ªå»æ‰¾æ¨¡æ¿ã€é™æ€æ–‡ä»¶ç­‰ç­‰ã€‚è¯¦æƒ…è§ Flask çš„æ–‡æ¡£ã€‚</li><li>ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ route() è£…é¥°å™¨å‘Šè¯‰ Flask ä»€ä¹ˆæ ·çš„URL èƒ½è§¦å‘æˆ‘ä»¬çš„å‡½æ•°ã€‚<br>è¿™ä¸ªå‡½æ•°çš„åå­—ä¹Ÿåœ¨ç”Ÿæˆ URL æ—¶è¢«ç‰¹å®šçš„å‡½æ•°é‡‡ç”¨ï¼Œè¿™ä¸ªå‡½æ•°è¿”å›æˆ‘ä»¬æƒ³è¦æ˜¾ç¤ºåœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­çš„ä¿¡æ¯ã€‚</li><li>æœ€åæˆ‘ä»¬ç”¨ run() å‡½æ•°æ¥è®©åº”ç”¨è¿è¡Œåœ¨æœ¬åœ°æœåŠ¡å™¨ä¸Šã€‚ å…¶ä¸­ if <strong>name</strong> &#x3D;&#x3D; â€˜<strong>main</strong>â€˜: ç¡®ä¿æœåŠ¡å™¨åªä¼šåœ¨è¯¥è„šæœ¬è¢« Python è§£é‡Šå™¨ç›´æ¥æ‰§è¡Œçš„æ—¶å€™æ‰ä¼šè¿è¡Œï¼Œè€Œä¸æ˜¯ä½œä¸ºæ¨¡å—å¯¼å…¥çš„æ—¶å€™ã€‚<br>  æ¬²å…³é—­æœåŠ¡å™¨ï¼ŒæŒ‰ Ctrl+Cã€‚<br>ä½ ä¼šå‘ç°å®ƒåªèƒ½ä»è‡ªå·±çš„è®¡ç®—æœºä¸Šè®¿é—®ï¼Œç½‘ç»œä¸­å…¶ä»–ä»»ä½•åœ°æ–¹éƒ½ä¸èƒ½è®¿é—®ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹run()æ–¹æ³•ä½¿è¯¥æœåŠ¡å…¬å¼€å¯ç”¨<br><code>app.run(host=&#39;0.0.0.0&#39;)</code><br>è¿™æ ·ä¼šè®©æ“ä½œç³»ç»Ÿç›‘å¬æ‰€æœ‰çš„å…¬ç½‘IP<br>åŒæ ·å¯ä»¥å¼€å¯debugæ¨¡å¼<br><code>app.debug = True;app.run()</code><br>æˆ–è€…<br><code>app.run(debug=True)</code> <h6 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h6>å¦‚ä¸Šé¢çš„ä»£ç æ‰€ç¤ºï¼Œroute()è£…é¥°å…¶å§ä¸€ä¸ªå‡½æ•°ç»‘å®šåˆ°å¯¹åº”çš„URLä¸Š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Index Page&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/hello&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello World&#x27;</span><br></code></pre></td></tr></table></figure>ä¸ä»…å¦‚æ­¤ï¼Œè¿˜å¯ä»¥æ„é€ å«æœ‰åŠ¨æ€éƒ¨åˆ†çš„URLï¼Œä¹Ÿå¯ä»¥åœ¨ä¸€ä¸ªå‡½æ•°ä¸Šé™„ç€å¤šä¸ªè§„åˆ™<h6 id="å˜é‡è§„åˆ™"><a href="#å˜é‡è§„åˆ™" class="headerlink" title="å˜é‡è§„åˆ™"></a>å˜é‡è§„åˆ™</h6>è¦ç»™ URL æ·»åŠ å˜é‡éƒ¨åˆ†ï¼Œä½ å¯ä»¥æŠŠè¿™äº›ç‰¹æ®Šçš„å­—æ®µæ ‡è®°ä¸º <variable_name> ï¼Œ è¿™ä¸ªéƒ¨åˆ†å°†ä¼šä½œä¸ºå‘½åå‚æ•°ä¼ é€’åˆ°ä½ çš„å‡½æ•°ã€‚è§„åˆ™å¯ä»¥ç”¨ <a href="converter:variable_name">converter:variable_name</a> æŒ‡å®šä¸€ä¸ªå¯é€‰çš„è½¬æ¢å™¨ã€‚å¦‚ä¸‹æ‰€ç¤º</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/user/&lt;username&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show_user_profile</span>(<span class="hljs-params">username</span>):<br>    <span class="hljs-comment"># show the user profile for that user</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;User %s&#x27;</span> % username<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/post/&lt;int:post_id&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show_post</span>(<span class="hljs-params">post_id</span>):<br>    <span class="hljs-comment"># show the post with the given id, the id is an integer</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Post %d&#x27;</span> % post_id<br></code></pre></td></tr></table></figure><h6 id="HTTPæ–¹æ³•"><a href="#HTTPæ–¹æ³•" class="headerlink" title="HTTPæ–¹æ³•"></a>HTTPæ–¹æ³•</h6><p>HTTPæœ‰è®¸å¤šä¸åŒçš„è®¿é—®URLæ–¹æ³•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè·¯ç”±åªå›åº”GETè¯·æ±‚ï¼Œä½†æ˜¯é€šè¿‡route()è£…é¥°å™¨ä¼ é€’methodså‚æ•°å¯ä»¥æ”¹å˜è¿™ä¸ªè¡Œä¸ºã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        do_the_login()<br>    <span class="hljs-keyword">else</span>:<br>        show_the_login_form()<br></code></pre></td></tr></table></figure><h6 id="æ¨¡æ¿æ¸²æŸ“"><a href="#æ¨¡æ¿æ¸²æŸ“" class="headerlink" title="æ¨¡æ¿æ¸²æŸ“"></a>æ¨¡æ¿æ¸²æŸ“</h6><p>åƒjavawebä¸€æ ·ï¼Œä¸ä¼šç›´æ¥ç”¨servletç›´æ¥è¾“å‡ºhtmlä»£ç ï¼ŒFlaskå¯ä»¥ä½¿ç”¨render_template()æ–¹æ³•æ¥æ¸²æŸ“æ¨¡æ¿ï¼ŒFlaské…å¤‡Jinja2æ¨¡æ¿å¼•æ“<a href="http://docs.jinkan.org/docs/jinja2/">Jinja2ä¸­æ–‡</a>ï¼Œ<a href="http://jinja.pocoo.org/">Jinja2è‹±æ–‡</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> render_template<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/hello/&#x27;</span></span>)</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/hello/&lt;name&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>(<span class="hljs-params">name=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;hello.html&#x27;</span>, name=name)<br></code></pre></td></tr></table></figure><p>Flask ä¼šåœ¨ templates æ–‡ä»¶å¤¹é‡Œå¯»æ‰¾æ¨¡æ¿ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ çš„åº”ç”¨æ˜¯ä¸ªæ¨¡å—ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹åº”è¯¥ä¸æ¨¡å—åŒçº§ï¼›å¦‚æœå®ƒæ˜¯ä¸€ä¸ªåŒ…ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶å¤¹ä½œä¸ºåŒ…çš„å­ç›®å½•:<br>æƒ…å†µ 1: æ¨¡å—:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">/application.py<br>/templates<br>    /hello.html<br></code></pre></td></tr></table></figure><p>æƒ…å†µ 2: åŒ…:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">/application<br>    /__init__.py<br>    /templates<br>        /hello.html<br></code></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯<code>hello.html</code>æ–‡ä»¶å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Jinja2">&lt;!doctype html&gt;<br>&lt;title&gt;Hello from Flask&lt;/title&gt;<br>&#123;% if name %&#125;<br>  &lt;h1&gt;Hello &#123;&#123; name &#125;&#125;!&lt;/h1&gt;<br>&#123;% else %&#125;<br>  &lt;h1&gt;Hello World!&lt;/h1&gt;<br>&#123;% endif %&#125;<br></code></pre></td></tr></table></figure><h6 id="è®¿é—®è¯·æ±‚æ•°æ®"><a href="#è®¿é—®è¯·æ±‚æ•°æ®" class="headerlink" title="è®¿é—®è¯·æ±‚æ•°æ®"></a>è®¿é—®è¯·æ±‚æ•°æ®</h6><p>å¯ä»¥é€šè¿‡<code>request.form</code>å±æ€§æ¥è®¿é—®è¡¨å•æ•°æ®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/signin&quot;</span>, methods=[<span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">signin</span>():<br>    <span class="hljs-built_in">print</span> request.args.get(<span class="hljs-string">&quot;username&quot;</span>)<br>    username = request.form[<span class="hljs-string">&quot;username&quot;</span>]<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;hello.html&#x27;</span>, name=username)<br></code></pre></td></tr></table></figure><p>å¦‚æœformè¡¨å•ä¸­ä¸å­˜åœ¨æ‰€è¦è·å–çš„é”®ï¼Œä¼šæŠ›å‡ºç‰¹æ®Šçš„KeyErrorå¼‚å¸¸ã€‚</p><h6 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h6><p>é¦–å…ˆç¡®ä¿HTMLè¡¨å•ä¸­è®¾ç½® <code>enctype=&quot;multipart/form-data&quot; </code>å±æ€§ï¼Œå¦åˆ™æµè§ˆå™¨æ ¹æœ¬ä¸ä¼šå‘é€æ–‡ä»¶ã€‚<br>å·²ä¸Šä¼ çš„æ–‡ä»¶å­˜å‚¨åœ¨å†…å­˜æˆ–æ˜¯æ–‡ä»¶ç³»ç»Ÿä¸­ä¸€ä¸ªä¸´æ—¶çš„ä½ç½®ã€‚å¯ä»¥é€šè¿‡è¯·æ±‚å¯¹è±¡çš„<code>file</code>å±æ€§è®¿é—®å®ƒã€‚æ¯ä¸ªä¸Šä¼ çš„æ–‡ä»¶éƒ½ä¼šå­˜å‚¨åœ¨è¿™ä¸ªå­—å…¸é‡Œã€‚åŒæ—¶å®ƒè¿˜æœ‰ä¸€ä¸ª<code>save()</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å…è®¸æŠŠæ–‡ä»¶ä¿é¢å“¦æ‘åˆ°æœåŠ¡å™¨çš„æ–‡ä»¶ç³»ç»Ÿä¸Šã€‚å¦‚æœåƒçŸ¥é“ä¸Šä¼ çš„æ–‡ä»¶åœ¨å®¢æˆ·ç«¯æ˜¯ä»€ä¹ˆåå­—ï¼Œå¯ä»¥è®¿é—®<code>filename</code>å±æ€§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> request<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/upload&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_file</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        f = request.files[<span class="hljs-string">&#x27;the_file&#x27;</span>]<br>        f.save(<span class="hljs-string">&#x27;/var/www/uploads/uploaded_file.txt&#x27;</span>)<br></code></pre></td></tr></table></figure><h6 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h6><p>å¯ä»¥é€šè¿‡<code>cookies</code>å±æ€§æ¥è®¿é—®Cookiesï¼Œç”¨å“åº”å¯¹è±¡çš„<code>set_cookie</code>æ–¹æ³•æ¥è®¾ç½®Cookiesã€‚è¯·æ±‚å¯¹è±¡çš„<code>cookies</code>å±æ€§æ˜¯ä¸€ä¸ªå†…å®¹ä¸ºå®¢æˆ·ç«¯æäº¤çš„æ‰€æœ‰Cookiesçš„å­—å…¸.<br>è¯»å–cookiesï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> request<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    username = request.cookies.get(<span class="hljs-string">&#x27;username&#x27;</span>)<br>    <span class="hljs-comment"># use cookies.get(key) instead of cookies[key] to not get a</span><br>    <span class="hljs-comment"># KeyError if the cookie is missing.</span><br></code></pre></td></tr></table></figure><p>å­˜å‚¨cookieï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> make_response<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    resp = make_response(render_template(...))<br>    resp.set_cookie(<span class="hljs-string">&#x27;username&#x27;</span>, <span class="hljs-string">&#x27;the username&#x27;</span>)<br>    <span class="hljs-keyword">return</span> resp<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCookiesæ˜¯è®¾ç½®åœ¨å“åº”å¯¹è±¡ä¸Šçš„ã€‚ç”±äºé€šå¸¸è§†å›¾å‡½æ•°åªæ˜¯è¿”å›å­—ç¬¦ä¸²ï¼Œä¹‹åFlaskå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå“åº”å¯¹è±¡ã€‚</p><h6 id="é‡å®šå‘å’Œé”™è¯¯"><a href="#é‡å®šå‘å’Œé”™è¯¯" class="headerlink" title="é‡å®šå‘å’Œé”™è¯¯"></a>é‡å®šå‘å’Œé”™è¯¯</h6><p>å¯ä»¥ä½¿ç”¨<code>redirect()</code>å‡½æ•°æŠŠç”¨æˆ·é‡å®šå‘åˆ°å…¶ä»–åœ°æ–¹ã€‚ç”¨<code>abort()</code>å‡½æ•°æ”¾å¼ƒè¯·æ±‚å¹¶è¿”å›é”™è¯¯ä»£ç ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> abort, redirect, url_for<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;login&#x27;</span>))<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    abort(<span class="hljs-number">401</span>)<br>    this_is_never_executed()<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªå®Œå…¨æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„ä»£ç ï¼Œå› ä¸ºç”¨æˆ·ä¼šä»ä¸»é¡µé‡å®šå‘åˆ°ä¸€ä¸ªä¸èƒ½è®¿é—®çš„é¡µé¢ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œé”™è¯¯ä»£ç ä¼šæ˜¾ç¤ºä¸€ä¸ªé»‘ç™½çš„é”™è¯¯é¡µé¢ï¼Œå¦‚æœè¦å®šåˆ¶é”™è¯¯é¡µé¢ï¼Œå¯ä»¥ä½¿ç”¨<code>errorhandler()</code>è£…é¥°å™¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> render_template<br><br><span class="hljs-meta">@app.errorhandler(<span class="hljs-params"><span class="hljs-number">404</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">page_not_found</span>(<span class="hljs-params">error</span>):<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;page_not_found.html&#x27;</span>), <span class="hljs-number">404</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„&#96;render_template()è°ƒç”¨ä¹‹åçš„404ï¼Œè¿™å‘Šè¯‰Flaskï¼Œè¯¥é¡µçš„é”™è¯¯ä»£ç æ˜¯404ã€‚é»˜è®¤æ˜¯200,ä¹Ÿå°±æ˜¯ä¸€åˆ‡æ­£å¸¸</p><h6 id="å…³äºå“åº”"><a href="#å…³äºå“åº”" class="headerlink" title="å…³äºå“åº”"></a>å…³äºå“åº”</h6><p>è§†å›¾å‡½æ•°çš„è¿”å›å€¼ä¼šè¢«è‡ªåŠ¨è½¬æ¢ä¸ºä¸€ä¸ªå“åº”å¯¹è±¡ã€‚å¦‚æœè¿”å›å€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ å®ƒè¢«è½¬æ¢ä¸ºè¯¥å­—ç¬¦ä¸²ä¸ºä¸»ä½“çš„ã€çŠ¶æ€ç ä¸º 200 OK<code>çš„ ã€ MIME ç±»å‹æ˜¯ </code>text&#x2F;html çš„å“åº”å¯¹è±¡ã€‚Flask æŠŠè¿”å›å€¼è½¬æ¢ä¸ºå“åº”å¯¹è±¡çš„é€»è¾‘æ˜¯è¿™æ ·ï¼š</p><ol><li>å¦‚æœè¿”å›çš„æ˜¯ä¸€ä¸ªåˆæ³•çš„å“åº”å¯¹è±¡ï¼Œå®ƒä¼šä»è§†å›¾ç›´æ¥è¿”å›ã€‚</li><li>å¦‚æœè¿”å›çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå“åº”å¯¹è±¡ä¼šç”¨å­—ç¬¦ä¸²æ•°æ®å’Œé»˜è®¤å‚æ•°åˆ›å»ºã€‚</li><li>å¦‚æœè¿”å›çš„æ˜¯ä¸€ä¸ªå…ƒç»„ï¼Œä¸”å…ƒç»„ä¸­çš„å…ƒç´ å¯ä»¥æä¾›é¢å¤–çš„ä¿¡æ¯ã€‚è¿™æ ·çš„å…ƒç»„å¿…é¡»æ˜¯ (response, status, headers) çš„å½¢å¼ï¼Œä¸”è‡³å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ã€‚ status å€¼ä¼šè¦†ç›–çŠ¶æ€ä»£ç ï¼Œ headers å¯ä»¥æ˜¯ä¸€ä¸ªåˆ—è¡¨æˆ–å­—å…¸ï¼Œä½œä¸ºé¢å¤–çš„æ¶ˆæ¯æ ‡å¤´å€¼ã€‚</li><li>å¦‚æœä¸Šè¿°æ¡ä»¶å‡ä¸æ»¡è¶³ï¼Œ Flask ä¼šå‡è®¾è¿”å›å€¼æ˜¯ä¸€ä¸ªåˆæ³•çš„ WSGI åº”ç”¨ç¨‹åºï¼Œå¹¶è½¬æ¢ä¸ºä¸€ä¸ªè¯·æ±‚å¯¹è±¡ã€‚<br>å¦‚æœä½ æƒ³åœ¨è§†å›¾é‡Œæ“çºµä¸Šè¿°æ­¥éª¤ç»“æœçš„å“åº”å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ make_response() å‡½æ•°ã€‚</li></ol><p>è­¬å¦‚ä½ æœ‰è¿™æ ·ä¸€ä¸ªè§†å›¾:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.errorhandler(<span class="hljs-params"><span class="hljs-number">404</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">not_found</span>(<span class="hljs-params">error</span>):<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;error.html&#x27;</span>), <span class="hljs-number">404</span><br></code></pre></td></tr></table></figure><p>åªéœ€è¦æŠŠè¿”å›å€¼è¡¨è¾¾å¼ä¼ é€’ç»™<code>make_response()</code>ï¼Œè·å–ç»“æœå¯¹è±¡å¹¶ä¿®æ”¹ï¼Œç„¶åå†è¿”å›å®ƒ:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.errorhandler(<span class="hljs-params"><span class="hljs-number">404</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">not_found</span>(<span class="hljs-params">error</span>):<br>    resp = make_response(render_template(<span class="hljs-string">&#x27;error.html&#x27;</span>), <span class="hljs-number">404</span>)<br>    resp.headers[<span class="hljs-string">&#x27;X-Something&#x27;</span>] = <span class="hljs-string">&#x27;A value&#x27;</span><br>    <span class="hljs-keyword">return</span> resp<br></code></pre></td></tr></table></figure><h6 id="ä¼šè¯"><a href="#ä¼šè¯" class="headerlink" title="ä¼šè¯"></a>ä¼šè¯</h6><p>é™¤è¯·æ±‚å¯¹è±¡ä¹‹åï¼Œè¿˜æœ‰ä¸€ä¸ª<code>session</code>å¯¹è±¡ï¼Œå®ƒå…è®¸ä½ åœ¨ä¸åŒè¯·æ±‚é—´å­˜å‚¨ç‰¹å®šç”¨æˆ·çš„ä¿¡æ¯ã€‚ä»–æ˜¯åœ¨Cookiesçš„åŸºç¡€ä¸Šå®ç°ï¼Œå¹¶ä¸”å¯¹Cookiesè¿›è¡Œå¯†é’¥ç­¾åã€‚è¿™æ„å‘³ç€ç”¨æˆ·å¯ä»¥æŸ¥çœ‹ä½ Cookieçš„å†…å®¹ï¼Œä½†å´ä¸èƒ½ä¿®æ”¹å®ƒï¼Œé™¤éç”¨æˆ·çŸ¥é“ç­¾åçš„å¯†é’¥ã€‚<br>è¦ä½¿ç”¨ä¼šè¯ï¼Œéœ€è¦è®¾ç½®ä¸€ä¸ªå¯†é’¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, session, redirect, url_for, escape, request<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;username&#x27;</span> <span class="hljs-keyword">in</span> session:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Logged in as %s&#x27;</span> % escape(session[<span class="hljs-string">&#x27;username&#x27;</span>])<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;You are not logged in&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        session[<span class="hljs-string">&#x27;username&#x27;</span>] = request.form[<span class="hljs-string">&#x27;username&#x27;</span>]<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">        &lt;form action=&quot;&quot; method=&quot;post&quot;&gt;</span><br><span class="hljs-string">            &lt;p&gt;&lt;input type=text name=username&gt;</span><br><span class="hljs-string">            &lt;p&gt;&lt;input type=submit value=Login&gt;</span><br><span class="hljs-string">        &lt;/form&gt;</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/logout&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">logout</span>():<br>    <span class="hljs-comment"># remove the username from the session if it&#x27;s there</span><br>    session.pop(<span class="hljs-string">&#x27;username&#x27;</span>, <span class="hljs-literal">None</span>)<br>    <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br><br><span class="hljs-comment"># set the secret key.  keep this really secret:</span><br>app.secret_key = <span class="hljs-string">&#x27;A0Zr98j/3yX R~XHH!jmN]LWX/,?RT&#x27;</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œæåˆ°çš„<code>escape()</code>å¯ä»¥åœ¨æ¨¡æ¿å¼•æ“å¤–åšè½¬ä¹‰</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>Flask</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TCPåè®®çš„ç®€å•ç†è§£</title>
    <link href="/2017/07/03/TCP%E5%8D%8F%E8%AE%AE%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3/"/>
    <url>/2017/07/03/TCP%E5%8D%8F%E8%AE%AE%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<p>å°½ç®¡TCPå’ŒUDPéƒ½ä½¿ç”¨ç›¸åŒçš„ç½‘ç»œå±‚(IP)ï¼ŒTCPå´å‘åº”ç”¨å±‚æä¾›ä¸UDPå®Œå…¨ä¸åŒçš„æœåŠ¡ã€‚TCPæä¾›ä¸€ç§é¢å‘è¿æ¥çš„ã€å¯é çš„å­—èŠ‚æµæœåŠ¡ã€‚è¿™é‡Œçš„é¢å‘è¿æ¥æ˜¯æŒ‡ï¼šä¸¤ä¸ªä½¿ç”¨TCPçš„åº”ç”¨ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå®¢æˆ·ä¸€ä¸ªæœåŠ¡å™¨ï¼‰åœ¨å½¼æ­¤äº¤æ¢æ•°æ®ä¹‹å‰å¿…é¡»å…ˆå»ºç«‹ä¸€ä¸ªTCPè¿æ¥ã€‚</p><span id="more"></span><h4 id="TCPçš„ä¸»è¦ç‰¹ç‚¹"><a href="#TCPçš„ä¸»è¦ç‰¹ç‚¹" class="headerlink" title="TCPçš„ä¸»è¦ç‰¹ç‚¹"></a>TCPçš„ä¸»è¦ç‰¹ç‚¹</h4><ul><li>TCPæ˜¯é¢å‘è¿æ¥çš„è¿è¾“å±‚åè®®</li><li>æ¯ä¸€æ¡TCPè¿æ¥åªèƒ½ä¸¤ä¸ªçŸ­ç‚¹ï¼Œæ¯ä¸€æ¡TCPéƒ½æ˜¯ç‚¹å¯¹ç‚¹çš„</li><li>æä¾›å¯é äº¤ä»˜æœåŠ¡</li><li>æä¾›å…¨åŒå·¥æœåŠ¡</li><li>é¢å‘å­—èŠ‚æµ<h4 id="TCPé€šè¿‡ä¸‹åˆ—æ–¹å¼æ¥æä¾›å¯é æ€§"><a href="#TCPé€šè¿‡ä¸‹åˆ—æ–¹å¼æ¥æä¾›å¯é æ€§" class="headerlink" title="TCPé€šè¿‡ä¸‹åˆ—æ–¹å¼æ¥æä¾›å¯é æ€§"></a>TCPé€šè¿‡ä¸‹åˆ—æ–¹å¼æ¥æä¾›å¯é æ€§</h4></li><li>åº”ç”¨æ•°æ®è¢«åˆ†å‰²æˆTCPè®¤ä¸ºæœ€åˆé€‚å‘é€çš„æ•°æ®å—ã€‚è¿™ä¸ªUDPå®Œå…¨ä¸åŒï¼Œåº”ç”¨ç¨‹åºäº§ç”Ÿçš„æ•°æ®æŠ¥é•¿åº¦å°†ä¿æŒä¸å˜ã€‚ç”±TCPä¼ é€’ç»™IPçš„ä¿¡æ¯å•ä½ç§°ä¸ºæŠ¥æ–‡æ®µæˆ–æ®µ(segment)</li><li>å½“TCPå‘å‡ºä¸€ä¸ªæ®µä¹‹åï¼Œå®ƒå°†å¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œç­‰å¾…ç›®çš„ç«¯ç¡®è®¤æ”¶åˆ°è¿™ä¸ªæŠ¥æ–‡æ®µï¼Œå¦‚æœç›®çš„ç«¯ä¸èƒ½åŠæ—¶ç¡®è®¤æ¥æ”¶ï¼Œå°†é‡å‘è¿™ä¸ªæŠ¥æ–‡æ®µ</li><li>å½“TCPæ”¶åˆ°å‘è‡³TCPè¿æ¥çš„å¦ä¸€ç«¯çš„æ•°æ®ï¼Œå®ƒå°†å‘é€ä¸€ä¸ªç¡®è®¤ã€‚</li><li>TCPä¿æŒå®ƒé¦–éƒ¨å’Œæ•°æ®çš„æ£€éªŒå’Œã€‚è¿™æ˜¯ä¸€ä¸ªç«¯åˆ°ç«¯çš„æ£€éªŒå’Œï¼Œç›®çš„æ˜¯æ£€æµ‹æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„ä»»ä½•å˜åŒ–ã€‚å¦‚æœæ£€éªŒå’Œæœ‰å·®é”™ï¼ŒTCPå°†ä¸¢å¼ƒè¿™ä¸ªæŠ¥æ–‡æ®µå’Œä¸ç¡®è®¤æ¥æ”¶æ­¤æŠ¥æ–‡æ®µï¼Œå¹¶å¸Œæœ›å¦ä¸€ç«¯é‡ä¼ æ­¤æŠ¥æ–‡æ®µã€‚</li><li>æ—¢ç„¶TCPæŠ¥æ–‡æ®µä½œä¸ºIPæ•°æ®æŠ¥æ¥ä¼ è¾“ï¼Œè€ŒIPæ•°æ®æŠ¥çš„åˆ°è¾¾å¯èƒ½ä¼šå¤±åºï¼Œå› æ­¤TCPæŠ¥æ–‡æ®µçš„åˆ°è¾¾ä¹Ÿå¯èƒ½ä¼šå¤±åºã€‚å¦‚æœå¿…è¦ï¼ŒTCPå°†å¯¹æ”¶åˆ°çš„æ•°æ®è¿›è¡Œé‡æ–°æ’åºï¼Œå°†æ”¶åˆ°çš„æ•°æ®ä»¥æ­£ç¡®çš„é¡ºåºäº¤ç»™åº”ç”¨å±‚ã€‚</li><li>æ—¢ç„¶IPæ•°æ®æŠ¥ä¼šå‘ç”Ÿé‡å¤ï¼ŒTCPçš„æ¥æ”¶ç«¯å¿…é¡»ä¸¢å¼ƒé‡å¤çš„æ•°æ®ã€‚</li><li>TCPè¿˜èƒ½æä¾›æµé‡æ§åˆ¶ã€‚TCPè¿æ¥çš„æ¯ä¸€æ–¹éƒ½æœ‰å›ºå®šå¤§å°çš„ç¼“å†²ç©ºé—´ï¼ŒTCPçš„æ¥æ”¶ç«¯åªå…è®¸å¦ä¸€ç«¯å‘é€æ¥æ”¶ç«¯ç¼“å†²åŒºæ‰€èƒ½æ¥çº³çš„æ•°æ®ã€‚è¿™å°†é˜²æ­¢è¾ƒå¿«ä¸»æœºè‡´ä½¿è¾ƒæ…¢ä¸»æœºç¼“å†²åŒºæº¢å‡ºã€‚<h4 id="åœæ­¢ç­‰å¾…åè®®"><a href="#åœæ­¢ç­‰å¾…åè®®" class="headerlink" title="åœæ­¢ç­‰å¾…åè®®"></a>åœæ­¢ç­‰å¾…åè®®</h4>åœæ­¢ç­‰å¾…åè®®ç”¨ä¸‹é¢çš„å›¾æ¥è¯´æ˜ï¼šå›¾ç‰‡æ¥æºäºã€Šè®¡ç®—æœºç½‘ç»œç¬¬å…­ç‰ˆã€‹è°¢å¸Œä»ç¼–è‘—<br>åœ¨å…¨åŒå·¥é€šä¿¡çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸€ç«¯æ—¢æ˜¯æ¥æ”¶æ–¹ä¹Ÿæ˜¯å‘é€æ–¹ï¼Œä¸ºæ–¹ä¾¿ï¼Œç®€åŒ–ä¸ºAå‘Bå‘é€æ•°æ®.</li></ul><ol><li>åœ¨æ— å·®é”™çš„æƒ…å†µä¸‹ï¼ŒAå‘Bå‘é€æ•°æ®åˆ†ç»„M1ï¼Œå‘é€å®Œäº†å°±ç­‰å¾…Bçš„ç¡®è®¤ã€‚Bç¡®è®¤æ¥æ”¶M1ä¹‹åå‘Aå‘é€ç¡®è®¤æ”¶åˆ°M1çš„æ•°æ®ã€‚Aæ”¶åˆ°Bå‘é€çš„â€ç¡®è®¤æ”¶åˆ°M1â€çš„æ¶ˆæ¯åï¼Œå†å‘Bå‘é€ä¸‹ä¸€ç»„æ•°æ®åˆ†ç»„ã€‚</li><li>åœ¨æœ‰å·®é”™çš„æƒ…å†µä¸‹ï¼ŒBæ”¶åˆ°çš„æ•°æ®åˆ†ç»„å¯èƒ½æ˜¯å†…å®¹ä¸å¯¹ï¼ŒBå°±æŠŠæ•°æ®ç›´æ¥ä¸¢å¼ƒï¼›ä¹Ÿå¯èƒ½æ˜¯æ•°æ®åˆ†ç»„åœ¨ ä¼ è¾“è¿‡ç¨‹ä¸­ä¸¢å¤±äº†ï¼ŒBä»€ä¹ˆä¹Ÿæ²¡æœ‰æ¥æ”¶åˆ°ã€‚è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼ŒBä»€ä¹ˆä¹Ÿä¸æ“ä½œï¼ˆä¸é€šçŸ¥Aæ•°æ®æœ‰é”™æˆ–è€…æ²¡æ”¶åˆ°æ•°æ®ã€‚ç­‰åˆ°è¿‡ä¸€æ®µæ—¶é—´ï¼ŒAæ²¡æœ‰æ”¶åˆ°Bçš„ç¡®è®¤æ¶ˆæ¯ï¼Œå°±è®¤ä¸ºåˆšåˆšå‘é€çš„æ•°æ®ä¸¢å¤±äº†ï¼Œç„¶åé‡æ–°ä¼ è¾“åˆšæ‰å‘é€çš„åˆ†ç»„ã€‚è¿™è¦æ±‚Aåœ¨æ¯æ¬¡å‘é€ä¸€ä¸ªæ•°æ®åˆ†ç»„æ—¶ï¼Œéƒ½è¦è®¾è®¡ä¸€ä¸ªè¶…æ—¶è®¡æ•°å™¨ã€‚<br> ä½†æ˜¯è¦æ³¨æ„<ol><li>Aåœ¨å‘é€å®Œä¸€ä¸ªåˆ†ç»„åï¼Œå¿…é¡»æš‚æ—¶ä¿ç•™å·²å‘é€çš„åˆ†ç»„çš„å‰¯æœ¬ï¼ˆè¶…æ—¶é‡ä¼ ï¼‰ã€‚åªæœ‰ç­‰åˆ°åˆ†ç»„ç¡®è®¤åæ‰èƒ½æ¸…é™¤æš‚æ—¶ä¿ç•™çš„å‰¯æœ¬</li><li>åˆ†ç»„å’Œç¡®è®¤åˆ†ç»„å¿…é¡»éƒ½è¿›è¡Œç¼–å·</li><li>è¶…æ—¶åŠæ—¶å™¨è®¾ç½®çš„é‡ä¼ æ—¶é—´åº”å½“æ¯”æ•°æ®åœ¨åˆ†ç»„ä¼ è¾“çš„å¹³å‡å¾€è¿”æ—¶é—´æ›´é•¿ä¸€äº›ã€‚<br><img src="/image/tcp/tcp1.png" alt="æ— å·®é”™å·¦/æœ‰å·®é”™å³"></li></ol></li><li>ç¡®è®¤ä¸¢å¤±å’Œç¡®è®¤è¿Ÿåˆ°<br>ä¸‹å›¾å·¦è¾¹çš„æƒ…å†µæ˜¯Bå‘Aå‘é€çš„ç¡®è®¤æ”¶åˆ°M1çš„æ¶ˆæ¯ä¸¢å¤±äº†ã€‚Aåœ¨è®¾å®šçš„è¶…æ—¶é‡ä¼ æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼Œä½†å¹¶æ— æ³•çŸ¥é“æ˜¯è‡ªå·±å‘é€çš„åˆ†ç»„å‡ºé”™ã€ä¸¢å¤±ï¼Œæˆ–è€…æ˜¯Bå‘é€çš„ç¡®è®¤ä¸¢å¤±äº†ï¼Œå› æ­¤Aåœ¨è¶…æ—¶è®¡æ—¶å™¨åˆ°æœŸåå°±è¦é‡ä¼ M1ã€‚å‡å®šBåˆæ”¶åˆ°äº†é‡ä¼ çš„åˆ†ç»„M1.è¿™æ—¶åº”é‡‡å–ä¸¤ä¸ªè¡ŒåŠ¨ï¼š<ol><li>ä¸¢å¼ƒè¿™ä¸ªé‡å¤çš„åˆ†ç»„M1ï¼Œä¸å‘ä¸Šå±‚äº¤ä»˜ã€‚</li><li>å‘Aå‘é€ç¡®è®¤ï¼Œä¸èƒ½è®¤ä¸ºå·²ç»å‘é€è¿‡ç¡®è®¤å°±ä¸å†å‘é€ï¼Œå› ä¸ºAä¹‹æ‰€ä»¥é‡ä¼ M1å°±è¡¨ç¤ºAæ²¡æœ‰æ”¶åˆ°M1çš„ç¡®è®¤ã€‚<br>ä¸‹å›¾å³è¾¹çš„æƒ…å†µæ˜¯ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰å‡ºç°å·®é”™ï¼Œä½†æ˜¯Bå¯¹åˆ†ç»„M1çš„ç¡®è®¤è¿Ÿåˆ°äº†ï¼ŒAä¼šæ”¶åˆ°é‡å¤ç¡®è®¤ï¼Œç„¶åä¸¢å¼ƒæ‰ï¼Œä½†æ˜¯è¿™æ—¶Aå·²ç»é‡å‘æ•°æ®åˆ†ç»„M1äº†ï¼ŒBæ”¶åˆ°é‡å¤çš„åˆ†ç»„M1èƒ¡åŒæ ·ä¸¢å¼ƒé‡å¤çš„åˆ†ç»„M1ï¼Œå¹¶é‡ä¼ ç¡®è®¤åˆ†ç»„ã€‚<br><img src="/image/tcp/tcp2.png" alt="ç¡®è®¤ä¸¢å¤±å·¦/ç¡®è®¤è¿Ÿåˆ°å³"><h4 id="è¿ç»­ARQåè®®"><a href="#è¿ç»­ARQåè®®" class="headerlink" title="è¿ç»­ARQåè®®"></a>è¿ç»­ARQåè®®</h4>ã€€ã€€æ»‘åŠ¨çª—å£åè®®æ¯”è¾ƒå¤æ‚ã€‚å›¾ç‰‡æ¥æºäºã€Šè®¡ç®—æœºç½‘ç»œç¬¬å…­ç‰ˆã€‹è°¢å¸Œä»ç¼–è‘—<br>ä¸‹å›¾aè¡¨ç¤ºå‘é€å‘ç»´æŒçš„å‘é€çª—å£ï¼Œå®ƒçš„æ„ä¹‰æ˜¯ï¼šä½äºå‘é€çª—å£å†…çš„5ä¸ªåˆ†ç»„éƒ½å¯ä»¥è¿ç»­å‘é€å‡ºå»ï¼Œè€Œä¸éœ€è¦ç­‰å¾…å¯¹æ–¹ç¡®è®¤ã€‚<br>è¿ç»­ARQåè®®è§„å®šï¼Œå‘é€æ–¹æ¯æ”¶åˆ°ä¸€ä¸ªç¡®è®¤ï¼Œå°±æŠŠçª—å£å‘å‰æ»‘åŠ¨ä¸€ä¸ªåˆ†ç»„çš„ä½ç½®ï¼Œbè¡¨ç¤ºå‘é€å‘æ”¶åˆ°äº†å¯¹ç¬¬ä¸€ä¸ªåˆ†ç»„çš„ç¡®è®¤ï¼Œäºæ˜¯æŠŠå‘é€çš„åˆ†ç»„å‘å‰ç§»åŠ¨ä¸€ä¸ªåˆ†ç»„çš„ä½ç½®ã€‚<br>æ¥æ”¶æ–¹ä¸€èˆ¬éƒ½æ˜¯é‡‡ç”¨<strong>ç´¯è®¡ç¡®è®¤</strong>çš„æ–¹å¼ã€‚è¿™å°±æ˜¯è¯´ï¼Œæ¥æ”¶æ–¹ä¸å¿…å¯¹æ”¶åˆ°çš„åˆ†ç»„é€ä¸ªå‘é€ç¡®è®¤ï¼Œè€Œæ˜¯åœ¨æ”¶åˆ°å‡ ä¸ªåˆ†ç»„åï¼Œå¯¹æŒ‰åºåˆ°è¾¾çš„çš„æœ€åä¸€ä¸ªåˆ†ç»„å‘é€ç¡®è®¤ï¼Œè¿™å°±è¡¨ç¤ºï¼šåˆ°è¿™ä¸ªåˆ†ç»„ä¸ºæ­¢çš„æ‰€æœ‰åˆ†ç»„éƒ½å·²ç»æ­£ç¡®æ”¶åˆ°äº†ã€‚<br><img src="/image/tcp/tcp3.png" alt="å‘é€çª—å£"><h4 id="æ»‘åŠ¨çª—å£"><a href="#æ»‘åŠ¨çª—å£" class="headerlink" title="æ»‘åŠ¨çª—å£"></a>æ»‘åŠ¨çª—å£</h4>ã€€ã€€TCPçš„æ»‘åŠ¨çª—å£æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„ã€‚ç°åœ¨å‡å®šAæ”¶åˆ°äº†Bå‘æ¥çš„ç¡®è®¤æŠ¥æ–‡æ®µï¼Œå…¶ä¸­çª—å£æ˜¯20ï¼Œè€Œç¡®è®¤å·æ˜¯31(è¿™è¡¨æ˜BæœŸæœ›æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªåºå·æ˜¯31,åˆ°åºå·30ä¸ºæ­¢çš„æ•°æ®å·²ç»æ”¶åˆ°äº†)ã€‚æ ¹æ®è¿™ä¸¤ä¸ªæ•°æ®ï¼ŒAå°±æ„é€ å‡ºè‡ªå·±çš„å‘é€çª—å£ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º<br><img src="/image/tcp/tcp4.png" alt="æ»‘åŠ¨çª—å£"><br>ã€€ã€€å‘é€çª—å£è¡¨ç¤ºï¼šåœ¨æ²¡æœ‰æ”¶åˆ°Bçš„ç¡®è®¤æƒ…å†µä¸‹ï¼ŒAå¯ä»¥æŠŠçª—å£å†…çš„æ•°æ®éƒ½å‘é€å‡ºå»ã€‚å‡¡æ˜¯å·²ç»å‘é€è¿‡çš„æ•°æ®ï¼Œåœ¨æœªæ”¶åˆ°ç¡®è®¤ä¹‹å‰éƒ½å¿…é¡»æš‚æ—¶ä¿ç•™ï¼Œä»¥ä¾¿åœ¨è¶…æ—¶é‡ä¼ æ—¶ä½¿ç”¨ã€‚<br>å‘é€çª—å£é‡Œé¢çš„åºå·è¡¨ç¤ºå…è®¸å‘é€çš„åºå·ã€‚æ˜¾ç„¶ï¼Œçª—å£è¶Šå¤§ï¼Œå‘é€æ–¹å°±å¯ä»¥åœ¨æ”¶åˆ°å¯¹æ–¹ç¡®è®¤ä¹‹å‰è¿ç»­å‘é€æ›´å¤šçš„æ•°æ®ï¼Œå› è€Œå¯èƒ½è·å¾—æ›´é«˜çš„ä¼ è¾“æ•ˆç‡ã€‚ä½†æ˜¯æ¥æ”¶æ–¹å¿…é¡»æ¥å¾—åŠå¤„ç†è¿™äº›æ”¶åˆ°çš„æ•°æ®ã€‚<br>å‘é€çª—å£åå»¶çš„åé¢éƒ¨åˆ†è¡¨ç¤ºå·²å‘é€ä¸”å·²æ”¶åˆ°äº†ç¡®è®¤ã€‚è¿™äº›æ•°æ®æ˜¾ç„¶ä¸éœ€è¦å†ä¿ç•™ã€‚è€Œå‘é€çª—å£å‰æ²¿çš„å‰é¢éƒ¨åˆ†è¡¨ç¤ºä¸å…è®¸å‘é€çš„ï¼Œå› ä¸ºæ¥æ”¶æ–¹éƒ½æ²¡æœ‰ä¸ºè¿™éƒ¨åˆ†æ•°æ®ä¿ç•™ä¸´æ—¶å­˜æ”¾çš„ç¼“å­˜ç©ºé—´ã€‚<br>ã€€ã€€å‘é€çª—å£çš„ä½ç½®ç”±çª—å£å‰æ²¿å’Œåå»¶çš„ä½ç½®å…±åŒç¡®å®šã€‚å‘é€çª—å£åæ²¿çš„å˜æ¢æƒ…å†µæœ‰ä¸¤ç§å¯èƒ½ï¼Œå³ä¸æ‡‚(æ²¡æœ‰æ”¶åˆ°æ–°çš„ç¡®è®¤)å’Œå‰ç§»(æ”¶åˆ°äº†æ–°çš„ç¡®è®¤)ã€‚å‘é€çª—å£åæ²¿ä¸å¯èƒ½å‘åç§»åŠ¨ï¼Œå› ä¸ºä¸èƒ½æ’¤é”€æ‰å·²æ”¶åˆ°çš„ç¡®è®¤ã€‚å‘é€çª—å£å‰æ²¿é€šå¸¸æ˜¯ä¸æ–­å‘å‰ç§»åŠ¨ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½ä¸åŠ¨ã€‚è¿™å¯¹åº”äºä¸¤ç§æƒ…å†µï¼šä¸€æ—¶æ²¡æœ‰æ”¶åˆ°ä¿¡çš„ç¡®è®¤ï¼Œå¯¹æ–¹é€šçŸ¥çš„çª—å£å¤§å°ä¹Ÿä¸å˜ï¼›äºŒæ˜¯æ”¶åˆ°äº†æ–°çš„ç¡®è®¤ä½†å¯¹æ–¹é€šçŸ¥çš„çª—å£ç¼©å°äº†ï¼Œä½¿å¾—å‘é€çª—å£å‰æ²¿æ­£å¥½ä¸åŠ¨ã€‚å‘é€çª—å£å‰æ²¿ä¹Ÿå¯èƒ½å‘åæ”¶ç¼©ï¼Œä½†æ˜¯TCPçš„æ ‡å‡†å¼ºçƒˆä¸èµæˆè¿™ä¹ˆåšã€‚<h4 id="TCPè¿æ¥çš„å»ºç«‹"><a href="#TCPè¿æ¥çš„å»ºç«‹" class="headerlink" title="TCPè¿æ¥çš„å»ºç«‹"></a>TCPè¿æ¥çš„å»ºç«‹</h4>å‡å®šä¸»æœºAè¿è¡Œçš„æ˜¯TCPå®¢æˆ·ç¨‹åºï¼Œè€ŒBè¿è¡ŒTCPæœåŠ¡å™¨ç¨‹åºã€‚æœ€åˆä¸¤ç«¯çš„TCPè¿›ç¨‹éƒ½å¤„äºCLOSED(å…³é—­)çŠ¶æ€ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ç°åœ¨Aä¸»åŠ¨æ‰“å¼€è¿æ¥ï¼Œè€ŒBæ˜¯è¢«åŠ¨æ‰“å¼€è¿æ¥ã€‚<br><img src="/image/tcp/tcp5.png" alt="ä¸‰æ¬¡æ¡æ‰‹"><br>ã€€ã€€Bçš„TCPæœåŠ¡å™¨å…ˆåˆ›å»ºä¼ è¾“æ§åˆ¶å—TCBï¼Œå‡†å¤‡æ¥å—å®¢æˆ·ç¨‹åºçš„è¿æ¥è¯·æ±‚ï¼Œç„¶åæœåŠ¡å™¨è¿›åœºå°±å¤„äºLISTEN(ç›‘å¬)çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚å¦‚æœæœ‰ï¼Œå³ä½œå‡ºå“åº”ã€‚<br>ã€€ã€€Açš„TCPå®¢æˆ·è¿›ç¨‹ä¹Ÿæ˜¯é¦–å…ˆåˆ›å»ºä¼ è¾“æ§åˆ¶æ¨¡å—TCBï¼Œç„¶åå‘Bå‘å‡ºè¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µï¼Œè¿™æ—¶é¦–éƒ¨ä¸­çš„åŒéƒ¨ä½SYN&#x3D;1ï¼ŒåŒæ—¶é€‰æ‹©ä¸€ä¸ªåˆå§‹åºå· seq&#x3D;x ã€‚TCPè§„å®šï¼ŒSYNæŠ¥æ–‡æ®µ(å³SYN&#x3D;1çš„æŠ¥æ–‡æ®µ)ä¸èƒ½æºå¸¦æ•°æ®ï¼Œä½†è¦æ¶ˆè€—æ‰ä¸€ä¸ªåºå·ã€‚è¿™æ—¶ï¼ŒTCPå®¢æˆ·è¿›ç¨‹è¿›å…¥SYN-SENT(åŒæ­¥å·²å‘é€)çŠ¶æ€ã€‚<br>ã€€ã€€Bæ”¶åˆ°è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µåï¼Œå¦‚æœåŒæ„å»ºç«‹è¿æ¥ï¼Œåˆ™å‘Aå‘é€ç¡®è®¤ã€‚åœ¨ç¡®è®¤æŠ¥æ–‡æ®µä¸­åº”æŠŠSYNä½å’ŒACKä½éƒ½ç½®1ï¼Œç¡®è®¤å·æ˜¯ack&#x3D;x+1 ,åŒæ—¶ä¹Ÿä¸ºè‡ªå·±é€‰æ‹©ä¸€ä¸ªåˆå§‹åºå·seq&#x3D;yã€‚è¿™ä¸ªæŠ¥æ–‡æ®µä¹Ÿä¸èƒ½æºå¸¦æ•°æ®ï¼Œä½†åŒæ ·è¦æ¶ˆè€—æ‰ä¸€ä¸ªåºå·ã€‚è¿™æ—¶TCPæœåŠ¡å™¨è¿›ç¨‹è¿›å…¥SYN-RCVD(åŒæ­¥æ”¶åˆ°)çŠ¶æ€ã€‚<br>ã€€ã€€TCPå®¢æˆ·è¿›ç¨‹æ”¶åˆ°Bçš„ç¡®è®¤åï¼Œè¿˜è¦å‘Bç»™å‡ºç¡®è®¤ã€‚ç¡®è®¤æŠ¥æ–‡æ®µçš„ACKç½®1ï¼Œç¡®è®¤å·ack&#x3D;y+1ï¼Œè€Œè‡ªå·±çš„åºå·seq&#x3D;x+1ã€‚TCPçš„æ ‡å‡†è§„å®šï¼ŒACKæŠ¥æ–‡æ®µå¯ä»¥æºå¸¦æ•°æ®ã€‚ä½†å¦‚æœä¸æºå¸¦æ•°æ®åˆ™ä¸æ¶ˆè€—åºå·ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸‹ä¸€ä¸ªæ•°æ®æŠ¥æ–‡æ®µçš„åºå·ä»ç„¶æ˜¯seq&#x3D;x+1ã€‚è¿™æ—¶TCPè¿æ¥å·²ç»å»ºç«‹ï¼ŒAè¿›å…¥ESTABLISHED(å·²å»ºç«‹è¿æ¥)çŠ¶æ€ã€‚<br>ã€€ã€€å½“Bæ”¶åˆ°Açš„ç¡®è®¤åï¼Œä¹Ÿè¿›å…¥ESTABLISHEDçŠ¶æ€<br>ã€€ã€€Aæœ€åå‘é€ä¸€æ¬¡ç¡®è®¤ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢å·²å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µçªç„¶åˆä¼ é€åˆ°äº†Bï¼Œå› è€Œäº§ç”Ÿé”™è¯¯ã€‚<h4 id="TCPè¿æ¥çš„é‡Šæ”¾"><a href="#TCPè¿æ¥çš„é‡Šæ”¾" class="headerlink" title="TCPè¿æ¥çš„é‡Šæ”¾"></a>TCPè¿æ¥çš„é‡Šæ”¾</h4>æ•°æ®ä¼ è¾“ç»“æŸåï¼Œé€šä¿¡çš„åŒæ–¹éƒ½å¯é‡Šæ”¾è¿æ¥ã€‚<br><img src="/image/tcp/tcp6.png" alt="å››æ¬¡æŒ¥æ‰‹"><br>ã€€ã€€ç°åœ¨Aå’ŒBéƒ½å¤„äºESTABLISHEDçŠ¶æ€ï¼ŒAçš„åº”ç”¨è¿›ç¨‹å…ˆå‘å…¶TCPå‘å‡ºè¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µï¼Œå¹¶åœæ­¢å†å‘é€æ•°æ®ï¼Œä¸»åŠ¨å…³é—­TCPè¿æ¥ï¼ŒAæŠŠè¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µé¦–éƒ¨çš„å®—æ—¨æ§åˆ¶ä½FINç½®1ï¼Œå…¶åºå·seq&#x3D;uï¼Œå®ƒç­‰äºå‰é¢å·²ä¼ é€è¿‡çš„æ•°æ®çš„æœ€åä¸€ä¸ªç›´æ¥çš„åºå·åŠ 1.è¿™æ—¶Aè¿›å…¥FIN-WAIT-1(ç»ˆæ­¢ç­‰å¾…1)çŠ¶æ€ï¼Œç­‰å¾…Bçš„ç¡®è®¤ã€‚TCPè§„å®šï¼ŒFINæŠ¥æ–‡æ®µå³ä½¿ä¸æºå¸¦æ•°æ®ï¼Œå®ƒä¹Ÿæ¶ˆè€—æ‰ä¸€ä¸ªåºå·ã€‚<br>ã€€ã€€Bæ”¶åˆ°è¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µåå³å‘å‡ºç¡®è®¤ï¼Œç¡®è®¤å·æ˜¯ack&#x3D;u+1ï¼Œè€Œè¿™ä¸ªæŠ¥æ–‡æ®µè‡ªå·±çš„åºå·æ˜¯vï¼Œç­‰äºBå‰é¢å·²ä¼ é€è¿‡çš„æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·åŠ 1ã€‚ç„¶åBå°±è¿›å…¥CLOSE-WAIT(å…³é—­ç­‰å¾…)çŠ¶æ€ã€‚TCPæœåŠ¡å™¨è¿›ç¨‹è¿™æ—¶åº”é€šçŸ¥é«˜å±‚åº”ç”¨è¿›ç¨‹ï¼Œå› è€Œä»Aåˆ°Bè¿™ä¸ªæ–¹å‘çš„è¿æ¥å°±é‡Šæ”¾äº†ï¼Œè¿™æ—¶çš„TCPè¿æ¥å¤„äºåŠå…³é—­(half-close)çŠ¶æ€ï¼Œå³Aå·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä½†Bè‹¥å‘é€æ•°æ®ï¼ŒAä»è¦æ¥æ”¶ï¼Œå°±æ˜¯è¯´ï¼Œä»Båˆ°Aè¿™ä¸ªæ–¹å‘çš„è¿æ¥å¹¶æœªå…³é—­ï¼Œè¿™ä¸ªçŠ¶æ€å¯èƒ½ä¼šæŒç»­ä¸€äº›æ—¶é—´ã€‚<br>ã€€ã€€Aæ”¶åˆ°æ¥è‡ªBçš„ç¡®è®¤åï¼Œå°±è¿›å›¾FIN-WAIT-2(ç»ˆæ­¢ç­‰å¾…2)çŠ¶æ€ï¼Œç­‰å¾…Bå‘å‡ºçš„è¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µã€‚<br>ã€€ã€€è‹¥Bå·²ç»æ²¡æœ‰è¦å‘Aå‘é€çš„æ•°æ®ï¼Œå…¶åº”ç”¨è¿›ç¨‹å°±é€šçŸ¥TCPé‡Šæ”¾è¿æ¥ã€‚è¿™æ—¶Bå‘å‡ºçš„è¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µå¿…é¡»ä½¿ç”¨FIN&#x3D;1.ç°åœ¨å‡å®šBçš„åºå·ä¸ºw(åœ¨åŠå…³é—­çŠ¶æ€Bå¯èƒ½åˆå‘é€äº†ä¸€äº›æ•°æ®)ï¼ŒBè¿˜å¿…é¡»é‡å¤ä¸Šæ¬¡å·²å‘é€è¿‡çš„ç¡®è®¤å·ack&#x3D;u+1ã€‚è¿™æ—¶Bå°±è¿›å…¥LAST-ACK(æœ€åç¡®è®¤)çŠ¶æ€ï¼Œç­‰å¾…Açš„ç¡®è®¤ã€‚<br>ã€€ã€€Aåœ¨æ”¶åˆ°Bçš„è¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µåï¼Œå¿…é¡»å¯¹æ­¤å‘å‡ºç¡®è®¤ã€‚åœ¨ç¡®è®¤æŠ¥æ–‡æ®µä¸­æŠŠACKç½®1ï¼Œç¡®è®¤å·ack&#x3D;w+1ï¼Œè€Œè‡ªå·±çš„åºå·æ˜¯seq&#x3D;u+1ï¼ŒTCPè§„å®šï¼Œå‰é¢å‘é€çš„FINæŠ¥æ–‡æ®µè¦æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚ç„¶åè¿›å…¥åˆ°TIME-WAIT(æ—¶é—´ç­‰å¾…)çŠ¶æ€ã€‚ç°åœ¨TCPè¿æ¥è¿˜æ²¡æœ‰é‡Šæ”¾æ‰ã€‚å¿…é¡»ç»è¿‡æ—¶é—´ç­‰å¾…è®¡æ—¶å™¨(TIME-WAIT timer)è®¾ç½®çš„æ—¶é—´2MSLåï¼ŒAæ‰è¿›å…¥åˆ°CLOSEDçŠ¶æ€ï¼Œæ—¶é—´MSLå«åšæœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½ã€‚<br>ã€€ã€€Båªè¦æ”¶åˆ°äº†Aå‘å‡ºçš„ç¡®è®¤ï¼Œå°±è¿›å…¥CLOSEDçŠ¶æ€ã€‚åŒæ ·ï¼ŒBåœ¨æ’¤é”€ç›¸åº”çš„å‡ºä¹¦æ§åˆ¶å—TCBåï¼Œå°±ç»“æŸäº†è¿™æ¬¡çš„TCPè¿æ¥ã€‚Bç»“æŸTCPè¿æ¥çš„æ—¶é—´è¦æ¯”Aæ—©ä¸€äº›ã€‚<h4 id="TCPæœ‰é™çŠ¶æ€æœº"><a href="#TCPæœ‰é™çŠ¶æ€æœº" class="headerlink" title="TCPæœ‰é™çŠ¶æ€æœº"></a>TCPæœ‰é™çŠ¶æ€æœº</h4><img src="/image/tcp/tcp7.png" alt="æœ‰é™çŠ¶æ€æœº"><br>ç²—å®çº¿ç®­å¤´è¡¨ç¤ºå¯¹å®¢æˆ·è¿›ç¨‹çš„æ­£å¸¸å˜è¿ã€ç²—è™šçº¿ç®­å¤´è¡¨ç¤ºå¯¹æœåŠ¡å™¨è¿›ç¨‹çš„æ­£å¸¸å˜è¿ã€å¦ä¸€ç§ç»†çº¿ç®­å¤´è¡¨ç¤ºå¼‚å¸¸å˜è¿ã€‚</li></ol></li></ol><hr><p>ä»¥ä¸Šæ–‡å­—å’Œå›¾ç‰‡å‡æ¥è‡ªäºã€Šè®¡ç®—æœºç½‘ç»œç¬¬6ç‰ˆã€‹è°¢å¸Œä»è‘—</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>tcpåè®®</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Jenkinså®‰è£…ä¸ä½¿ç”¨</title>
    <link href="/2017/06/28/Jenkins%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/"/>
    <url>/2017/06/28/Jenkins%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>å…¬å¸éœ€æ±‚ï¼Œä¸šåŠ¡è¶Šæ¥è¶Šå¤šï¼ŒæœåŠ¡å™¨è¶Šæ¥è¶Šå¤šï¼Œåå°éƒ¨ç½²é¡¹ç›®éº»çƒ¦çš„è¦æ­»ï¼Œäºæ˜¯ä¸Šäº†<code>jenkins</code>è¿™è´§ã€‚<br>å…³äºè¿™è´§æ˜¯å¹²å˜›çš„ï¼Œè¯·ç§»æ­¥è¿™é‡Œ<a href="https://jenkins.io/">https://jenkins.io/</a>,ä¸‹è½½è¯·ç§»æ­¥è¿™é‡Œ<a href="https://jenkins.io/download/">https://jenkins.io/download/</a><br>å®‰è£…ç¯å¢ƒï¼šubuntu 16.04ã€tomcat7(è¿™ä¸ªæ˜¯å› ä¸ºJenkinsæ˜¯ä¸ªwaråŒ…)ã€maven(è¿™ä¸ªæ˜¯å› ä¸ºåå°çš„é¡¹ç›®æ˜¯mavenå·¥ç¨‹)ã€jdk8(è¿™ä¸ªæ˜¯å› ä¸ºéœ€è¦tomcat)ã€gradle(æ„å»ºAndroidå·¥ç¨‹)ã€SDK(æ„å»ºAndroidå·¥ç¨‹)</p><span id="more"></span><h4 id="Jenkins-ç¯å¢ƒ"><a href="#Jenkins-ç¯å¢ƒ" class="headerlink" title="Jenkins ç¯å¢ƒ"></a>Jenkins ç¯å¢ƒ</h4><p>å®‰è£…JDKã€Tomcatã€MAVEN(å¦‚æœ‰éœ€è¦)ã€gradle(æ„å»ºAndroidå·¥ç¨‹)ã€SDK(æ„å»ºAndroidå·¥ç¨‹)</p><h4 id="å®‰è£…Jenkins"><a href="#å®‰è£…Jenkins" class="headerlink" title="å®‰è£…Jenkins"></a>å®‰è£…Jenkins</h4><p>åœ¨ä¸Šé¢çš„ä¸‹è½½åœ°å€ä¸‹è½½warï¼Œä¸¢åˆ°tomcatçš„webappsæ–‡ä»¶å¤¹ä¸‹ï¼Œç„¶åå¯åŠ¨tomcatï¼Œæµè§ˆå™¨è®¿é—®jenkinå·¥ç¨‹<code>127.0.0.1:8080/jenkins</code>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/image/jenkins/jenkins_start.png" alt="jenkinsé¦–æ¬¡å¯åŠ¨"><br>æ‰“å¼€çº¢å­—æç¤ºçš„æ–‡ä»¶ï¼Œé‡Œé¢æ˜¯é¦–æ¬¡è¿›å…¥æ—¶éœ€è¦çš„å¯†ç ,ç‚¹å‡»å³ä¸‹è§’continueã€‚</p><h5 id="jenkinså®‰è£…æ’ä»¶"><a href="#jenkinså®‰è£…æ’ä»¶" class="headerlink" title="jenkinså®‰è£…æ’ä»¶"></a>jenkinså®‰è£…æ’ä»¶</h5><p>å¯ä»¥è‡ªå®šä¹‰ä¹Ÿå¯ä»¥å®‰è£…æ¨èçš„æ’ä»¶ï¼Œæˆ‘è¿™é‡Œå®‰è£…çš„æ˜¯å»ºè®®çš„æ’ä»¶.ç¨ç­‰ä¸€ä¼šï¼Œæ’ä»¶å®‰è£…å®Œæˆåä¼šè‡ªåŠ¨è·³è½¬åˆ°åˆ›å»ºjenkinsç”¨æˆ·çš„ç•Œé¢</p><h5 id="åˆ›å»ºjenkinsç”¨æˆ·"><a href="#åˆ›å»ºjenkinsç”¨æˆ·" class="headerlink" title="åˆ›å»ºjenkinsç”¨æˆ·"></a>åˆ›å»ºjenkinsç”¨æˆ·</h5><p>æŒ‰ç…§æç¤ºåˆ›å»ºå³å¯ï¼Œç‚¹å‡»å³ä¸‹è§’<code>Save and finish</code></p><h5 id="é…ç½®Jenkins"><a href="#é…ç½®Jenkins" class="headerlink" title="é…ç½®Jenkins"></a>é…ç½®Jenkins</h5><p>ä»¥åå†æ¬¡è®¿é—®jenkinsçš„æ—¶å€™å°±ä¸ç”¨å†å»ä½¿ç”¨åˆå§‹å¯†ç ï¼Œåªéœ€è¦ä½¿ç”¨ä¸Šä¸€æ­¥åˆ›å»ºçš„è´¦å·å³å¯ï¼Œç™»å½•åé¦–ç•Œé¢å¦‚ä¸‹ï¼Œ<br><img src="/image/jenkins/jenkins_index.png" alt="jenkinsé¦–é¡µ"><br>ç‚¹å‡»å·¦ä¾§çš„<code>ç³»ç»Ÿç®¡ç†</code>ï¼Œåœ¨ä¸­é—´åˆ—å‡ºçš„å·¥å…·é‡Œé¢ç‚¹å‡»<code>Global Tool Configuration</code>ï¼ŒæŒ‡å®šJDKå’ŒMAVENçš„è·¯å¾„ï¼Œå¦‚ä¸‹<br><img src="/image/jenkins/jenkins_jdk.png" alt="jenkinsé…ç½®JDK"><br><img src="/image/jenkins/jenkins_maven.png" alt="jenkinsé…ç½®MAVEN"><br>ç„¶åSaveä¿å­˜</p><h4 id="åˆ›å»ºä¸€ä¸ªæ–°çš„Mavenå·¥ç¨‹"><a href="#åˆ›å»ºä¸€ä¸ªæ–°çš„Mavenå·¥ç¨‹" class="headerlink" title="åˆ›å»ºä¸€ä¸ªæ–°çš„Mavenå·¥ç¨‹"></a>åˆ›å»ºä¸€ä¸ªæ–°çš„Mavenå·¥ç¨‹</h4><p>ç‚¹å‡»å·¦ä¾§èœå•æ <code>æ–°å»º</code>,è¾“å…¥å·¥ç¨‹åå­—ï¼Œç„¶åé€‰æ‹©<code>æ„å»ºä¸€ä¸ªåªæœ‰é£æ ¼çš„è½¯ä»¶é¡¹ç›®</code>,ç„¶å<code>ok</code><br><img src="/image/jenkins/jenkins_create_new_project.png" alt="jenkinsåˆ›å»ºæ–°å·¥ç¨‹"></p><h4 id="é…ç½®å·¥ç¨‹"><a href="#é…ç½®å·¥ç¨‹" class="headerlink" title="é…ç½®å·¥ç¨‹"></a>é…ç½®å·¥ç¨‹</h4><p>åœ¨æ–°çš„ç•Œé¢å¯ä»¥é…ç½®é¡¹ç›®çš„æ„å»ºã€æºç ç®¡ç†ç­‰<br>æˆ‘çš„å·¥ç¨‹æ˜¯å­˜æ”¾åœ¨gitä¸Šé¢çš„ï¼Œæ‰€ä»¥å°±é€‰æ‹©git<br><img src="/image/jenkins/jenkins_config_project.png" alt="jenkinsæºç ç®¡ç†"><br>æ„å»ºè§¦å‘å™¨å¯ä»¥é…ç½®åœ¨ä»€ä¹ˆæ—¶é—´é…ç½®ï¼Œæˆ‘ä»¬æš‚æ—¶æ²¡æœ‰ï¼Œéœ€è¦æ‰‹åŠ¨ç‚¹å‡»æ„å»ºæ‰è¡Œ<br>æ„å»ºç¯å¢ƒæ²¡æœ‰é…ç½®<br>æ„å»ºä¸€é¡¹é€‰æ‹© <code>Invoke top-level Maven target</code>,å½“ç„¶æ ¹æ®éœ€æ±‚å¯ä»¥é€‰æ‹©å…¶ä»–æ„å»ºæ–¹å¼<br><code>Maven Version</code>æ˜¯ä¸Šé¢é…ç½®mavenæ—¶é€‰æ‹©çš„åˆ«åï¼Œ<code>Goals</code>æ˜¯éœ€è¦æ‰§è¡Œçš„mavenå‘½ä»¤(å‰é¢ä¸éœ€è¦åŠ maven)<br><img src="/image/jenkins/jenkins_project_build.png" alt="jenkinsæ„å»ºé¡¹ç›®"><br>ç‚¹å‡»å·¦ä¸‹è§’ä¿å­˜</p><h4 id="å¼€å§‹æ„å»º"><a href="#å¼€å§‹æ„å»º" class="headerlink" title="å¼€å§‹æ„å»º"></a>å¼€å§‹æ„å»º</h4><p>ç‚¹å‡»å·¦ä¾§çš„ç«‹å³æ„å»ºï¼Œå¯ä»¥åœ¨æ„å»ºå†å²ä¸­æŸ¥çœ‹åŸæ¥æ„å»ºçš„ä¸ªè¿‡ç¨‹<br><img src="/image/jenkins/jenkins_start_build_project.png" alt="jenkinsæ„å»º"><br>ç‚¹å‡»æ„å»ºå†å²åˆ—è¡¨é‡Œé¢å¯¹åº”æ„å»ºå†å²çš„å°åœ†ç‚¹ï¼Œå¯ä»¥æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º<br><img src="/image/jenkins/jenkins_build_history.png" alt="jenkinsæ„å»ºå†å²"><br><img src="/image/jenkins/jenkins_build_console_output.png" alt="jenkins"><br>psï¼šå¦‚æœæ˜¯æ™®é€šç”¨æˆ·å¯åŠ¨çš„tomcatï¼Œä½¿ç”¨gitç®¡ç†æºç ï¼Œåˆ™ä¸‹è½½ä¸‹æ¥çš„å·¥ç¨‹æºç åœ¨<code>/home/username/.jenkins/workspace</code>ï¼Œå¦‚æœæ˜¯rootç”¨æˆ·ï¼Œåˆ™åœ¨ <code>/root/.jenkins/workspace</code>ä¸‹<br>pps:æ®è¯´<code>jenkins</code>çš„åŒ…ä¸éœ€è¦tomcatä¹Ÿå¯ä»¥ï¼Œæ‰§è¡Œ<code>java -jar ***.war</code>å³å¯</p>]]></content>
    
    
    
    <tags>
      
      <tag>jenkins</tag>
      
      <tag>è¿ç»´</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>elkç®€å•ç¯å¢ƒæ­å»º for linux</title>
    <link href="/2017/06/13/elk%E7%AE%80%E5%8D%95%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA-for-linux/"/>
    <url>/2017/06/13/elk%E7%AE%80%E5%8D%95%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA-for-linux/</url>
    
    <content type="html"><![CDATA[<p>ç¯å¢ƒï¼šubuntu 16.06è™šæ‹Ÿæœºï¼š4æ ¸8Gå†…å­˜<br>åœ¨å®˜ç½‘ä¸‹è½½çš„<code>tag.gz</code>åŒ…ï¼Œå®˜ç½‘åœ°å€<a href="https://www.elastic.co/webinars/introduction-elk-stack">https://www.elastic.co/webinars/introduction-elk-stack</a><br>å®‰è£…ç‰ˆæœ¬æ˜¯<strong>5.4.1</strong>ï¼Œæœ¬æ–‡åªå®‰è£…äº†<code>Elasticsearch</code>ã€<code>Logstash</code>ã€<code>Kibana</code></p><span id="more"></span><h4 id="Elasticsearch"><a href="#Elasticsearch" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h4><ol><li>ä¸‹è½½å‹ç¼©åŒ…å¹¶è§£å‹</li><li>åœ¨esçš„æ ¹ç›®å½•ä¸‹<code>config/elasticsearch.yml</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Use a descriptive name for the node:</span><br><span class="hljs-attr">node.name:</span> <span class="hljs-string">xuannode</span>  <span class="hljs-comment">##ä¸è¦æœ‰&#x27;-&#x27;ã€&#x27;_&#x27;ã€&#x27;+&#x27;</span><br><span class="hljs-comment"># Path to directory where to store the data (separate multiple locations by comma):</span><br><span class="hljs-comment">#</span><br><span class="hljs-attr">path.data:</span> <span class="hljs-string">/home/huangyuan/elk/elasticsearch/data</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Path to log files:</span><br><span class="hljs-comment">#</span><br><span class="hljs-attr">path.logs:</span> <span class="hljs-string">/home/huangyuan/elk/elasticsearch/logs/*</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Set the bind address to a specific IP (IPv4 or IPv6):</span><br><span class="hljs-comment">#</span><br><span class="hljs-attr">network.host:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Set a custom port for HTTP:</span><br><span class="hljs-comment">#</span><br><span class="hljs-attr">http.port:</span> <span class="hljs-number">9200</span><br><span class="hljs-attr">discovery.zen.ping.unicast.hosts:</span> [<span class="hljs-string">&quot;0.0.0.0&quot;</span>]<br><span class="hljs-attr">http.cors.enabled:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">http.cors.allow-origin:</span> <span class="hljs-string">&quot;*&quot;</span><br></code></pre></td></tr></table></figure><h4 id="logstash"><a href="#logstash" class="headerlink" title="logstash"></a>logstash</h4></li><li>ä¸‹è½½å‹ç¼©åŒ…å¹¶è§£å‹</li><li>åˆ›å»ºä¸€ä¸ª<code>logstash.conf</code>æ–‡ä»¶ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹å¹¶ä¿å­˜:<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs conf">input&#123;<br>file &#123;<br>path =&gt; &quot;/home/huangyuan/elkdata/*.log&quot;<br>&#125;<br>&#125;<br>output &#123;<br>elasticsearch &#123;<br>hosts =&gt; &quot;http://192.168.1.179:9200&quot;<br>index =&gt; &quot;logstash-%&#123;+YYYY.MM.dd&#125;&quot;<br>&#125;<br>    stdout &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li>å¯åŠ¨æ—¶æ‰§è¡Œ <code>bin/logstash -f logstash.conf</code><h4 id="kibana"><a href="#kibana" class="headerlink" title="kibana"></a>kibana</h4></li><li>ä¸‹è½½å‹ç¼©åŒ…å¹¶è§£å‹ç¼©</li><li>ç¼–è¾‘<code>config/kibana.yml</code><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Kibana is served by a back end server. This setting specifies the port to use.</span><br><span class="hljs-attr">server.port:</span> <span class="hljs-number">5601</span><br><span class="hljs-comment"># Specifies the address to which the Kibana server will bind. IP addresses and host names are both valid values.</span><br><span class="hljs-comment"># The default is &#x27;localhost&#x27;, which usually means remote machines will not be able to connect.</span><br><span class="hljs-comment"># To allow connections from remote users, set this parameter to a non-loopback address.</span><br><span class="hljs-attr">server.host:</span> <span class="hljs-string">&quot;192.168.1.179&quot;</span><br><span class="hljs-comment"># The Kibana server&#x27;s name.  This is used for display purposes.</span><br><span class="hljs-attr">server.name:</span> <span class="hljs-string">&quot;xuankibina&quot;</span><br><span class="hljs-comment"># The URL of the Elasticsearch instance to use for all your queries.</span><br><span class="hljs-attr">elasticsearch.url:</span> <span class="hljs-string">&quot;http://192.168.1.179:9200&quot;</span><br></code></pre></td></tr></table></figure></li></ol><hr><p>å¯åŠ¨çš„æ—¶å€™ä¾æ¬¡å¯åŠ¨ esã€logstashã€kibanaå°±å¯ä»¥äº†<br>PS:<br>1.åœ¨LogStashçš„é…ç½®æ–‡ä»¶<code>logstash.conf</code>ä¸­,<code>input</code>é…ç½®çš„å°±æ˜¯logstashè¦ç›‘å¬çš„æ–‡ä»¶è·¯å¾„ï¼Œå¯åŠ¨ä¹‹åï¼Œå…ˆåœ¨ç›‘å¬çš„æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªlogæ–‡ä»¶å¹¶è¾“å…¥éšæ„å†…å®¹ã€‚<br>2. <code>elasticsearch</code>ä¸èƒ½ç”¨<code>root</code>ç”¨æˆ·å¯åŠ¨<br>3. å¯åŠ¨esæŠ¥é”™<code>max virtual memory areas vm.max_map_count [65530]is too low, increase to at least [262144]</code>:è§£å†³æ–¹æ³•æ˜¯ä¿®æ”¹<code>/etc/sysctl.conf</code>é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ <code>vm.max_map_count=262144</code>ï¼Œé‡å¯æœºå™¨æ‰èµ·ä½œç”¨.</p><hr>ä»¥ä¸Š]]></content>
    
    
    
    <tags>
      
      <tag>è¿ç»´</tag>
      
      <tag>elk</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gitå·¥å…·</title>
    <link href="/2017/05/10/git%E5%B7%A5%E5%85%B7/"/>
    <url>/2017/05/10/git%E5%B7%A5%E5%85%B7/</url>
    
    <content type="html"><![CDATA[<p>å…¬å¸ä»£ç ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿç”±svnè¿åˆ°äº†gitï¼Œå¯¹äºAndroidStudioæ¥è®²ï¼Œå†…ç½®çš„GUIå·¥å…·è¶³ä»¥åº”ä»˜æ—¥å¸¸å¼€å‘ï¼Œä½†åœ¨è¯·æ±‚å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œå¯¹å¤±è´¥åŸå› çš„æç¤ºä¸å¤Ÿæ¸…æ™°ã€‚ä¸ªäººä¹ æƒ¯ä¸Šç”¨å‘½ä»¤è¡Œï¼Œä½†æ˜¯å¯¹äºå‘½ä»¤è¡Œä¸­æ¯”è¾ƒä¸¤ä¸ªæ–‡ä»¶å·®å¼‚ä»¥åŠåˆå¹¶æ¥è¯´ï¼Œä¸ªäººè¿˜æ˜¯ä¸å¤§ä¹ æƒ¯ï¼Œäºæ˜¯å°±é…ç½®æˆäº†ä½¿ç”¨å…¶ä»–è½¯ä»¶è¿›è¡Œåˆå¹¶ã€‚å¯ä»¥ä½¿ç”¨<code>$ git difftool --tool-help</code>æŸ¥çœ‹å¯¹æ¯”æ–‡ä»¶å·®å¼‚æ”¯æŒçš„è½¯ä»¶ï¼Œç”¨<code>$ git mergetool --tool-help</code>æŸ¥çœ‹åˆå¹¶ä»£ç æ”¯æŒçš„è½¯ä»¶ï¼Œä¸ªäººåªè¯•è¿‡ä¸¤ç§:<code>codecompare</code>å’Œ<code>beyond compare</code>ã€‚ä¸ä¹ æƒ¯<code>bc</code>çš„ç•Œé¢ï¼Œæœ€åå†³å®šä½¿ç”¨<code>codecompare</code>ã€‚</p><span id="more"></span><h4 id="é…ç½®codecompareä¸ºdiffå’Œmergeå·¥å…·"><a href="#é…ç½®codecompareä¸ºdiffå’Œmergeå·¥å…·" class="headerlink" title="é…ç½®codecompareä¸ºdiffå’Œmergeå·¥å…·"></a>é…ç½®codecompareä¸ºdiffå’Œmergeå·¥å…·</h4><ol><li>å®‰è£…codecompareè½¯ä»¶</li><li>é…ç½®codecompareä¸ºdiffå·¥å…·<br> <code>git config --global diff.tool codecompare</code></li><li>é…ç½®codecompareçš„è·¯å¾„<code>path åé¢æ˜¯è½¯ä»¶çš„å®‰è£…è·¯å¾„</code><br> <code>git config --global difftool.codecompare.path D://CodeCompare//CodeCompare.exe</code></li><li>é…ç½®codecompareä¸ºmergeå·¥å…·<br> <code>git config --global merge.tool codecompare</code></li><li>é…ç½®codecompareçš„è·¯å¾„<code>path åé¢æ˜¯è½¯ä»¶çš„å®‰è£…è·¯å¾„</code><br> <code>git config --global mergetool.codecompare.path D://CodeCompare//CodeMerge.exe</code></li></ol><p>åœ¨æ¯”è¾ƒæœ¬åœ°ä¿®æ”¹åçš„æ–‡ä»¶ä¸æœ¬åœ°ä»“åº“ä¸­çš„æ–‡ä»¶å·®å¼‚æ—¶ï¼Œæ‰§è¡Œ <code>git difftool &lt;filename&gt;</code>å³å¯ã€‚<br><img src="/image/git/git_diff_tool_codecompare.png" alt="codecompareå®ä¾‹"><br>å½“æ›´æ–°ä»£ç è‡ªåŠ¨åˆå¹¶å¤±è´¥çš„æ—¶å€™ï¼Œæ‰§è¡Œ <code>git mergetool</code>å³å¯ã€‚<br><img src="/image/git/git_merge_tool_codecompare.png" alt="codecompareå®ä¾‹"></p><h4 id="é…ç½®beyond-compareä¸ºdiffå’Œmergeå·¥å…·"><a href="#é…ç½®beyond-compareä¸ºdiffå’Œmergeå·¥å…·" class="headerlink" title="é…ç½®beyond compareä¸ºdiffå’Œmergeå·¥å…·"></a>é…ç½®beyond compareä¸ºdiffå’Œmergeå·¥å…·</h4><p>é…ç½®æ–¹å¼å’Œcodecompareä¸€æ ·ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p><ol><li>å¦‚æœ<code>beyond compare</code>è½¯ä»¶æ˜¯4.X</li></ol><ol><li>å¦‚æœgitçš„ç‰ˆæœ¬ä½äº2.2.0,é…ç½®çš„æ—¶å€™ç”¨<code>bc3</code></li><li>å¦‚æœgitçš„ç‰ˆæœ¬å¤§äºç­‰äº2.2.0,é…ç½®çš„æ—¶å€™ç”¨<code>bc</code><br>è¿™ä¸ªå¦‚ä½•é…ç½®<a href="http://www.scootersoftware.com/support.php?zz=kb_vcs#gitwindows">å®˜ç½‘</a>æœ‰è¯´æ˜ï¼Œå°±ä¸å†èµ˜è¿°<br>åœ¨æ¯”è¾ƒæœ¬åœ°ä¿®æ”¹åçš„æ–‡ä»¶ä¸æœ¬åœ°ä»“åº“ä¸­çš„æ–‡ä»¶å·®å¼‚æ—¶ï¼Œæ‰§è¡Œ <code>git difftool &lt;filename&gt;</code>å³å¯ã€‚<br><img src="/image/git/git_diff_tool_bc.png" alt="bcå®ä¾‹"><br>å½“æ›´æ–°ä»£ç è‡ªåŠ¨åˆå¹¶å¤±è´¥çš„æ—¶å€™ï¼Œæ‰§è¡Œ <code>git mergetool</code>å³å¯ã€‚<br><img src="/image/git/git_merge_tool_bc.png" alt="bcå®ä¾‹"><br>æœ‰äººä¸ä¹ æƒ¯gitè‡ªåŠ¨mergeæˆåŠŸåå¡«å†™mergeä¿¡æ¯çš„ç¼–è¾‘å™¨ï¼Œè¯´æ˜ä¸€ä¸‹ï¼Œé»˜è®¤çš„ç¼–è¾‘å™¨æ˜¯<code>vim</code>,ä¸ä¹ æƒ¯ç”¨çš„è¯å¯ä»¥ä½¿ç”¨ <code>git config --global core.edit &lt;è½¯ä»¶è·¯å¾„&gt;</code>æ¥ä¿®æ”¹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œgitå‘½ä»¤è¡Œä¼¼ä¹è¯»ä¸åˆ°windowsç³»ç»Ÿçš„pathï¼Œéœ€è¦å†™è½¯ä»¶çš„ç»å¯¹è·¯å¾„ã€‚</li></ol><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ­å»ºgitæœåŠ¡</title>
    <link href="/2017/04/15/%E6%90%AD%E5%BB%BAgit%E6%9C%8D%E5%8A%A1/"/>
    <url>/2017/04/15/%E6%90%AD%E5%BB%BAgit%E6%9C%8D%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<p>å…¬å¸çš„ç‰ˆæœ¬æ§åˆ¶è¦ä»SVNè¿ç§»åˆ°gitï¼Œæ­£å¼çš„å¼€å‘ç¯å¢ƒè¿˜æ²¡æœ‰æ­å»ºå¥½ï¼Œäºæ˜¯è‡ªå·±åšäº†ä¸€ä¸ªç®€å•gitæœåŠ¡ã€‚<br>ç¯å¢ƒï¼š<br>æœ¬æœº: win10ï¼ŒæœåŠ¡å™¨ï¼šubuntu 16.04 LTS,ip:192.168.1.103</p><span id="more"></span><p>æœ¬åœ°å®‰è£…gitç¯å¢ƒï¼Œé…ç½®ç”¨æˆ·åå’Œé‚®ç®±ä¹‹ç±»çš„ä¿¡æ¯ï¼Œç„¶åç”Ÿæˆç§˜é’¥ï¼Œç”Ÿæˆæ–¹å¼è§ <a href="http://blog.csdn.net/huangyuan_xuan/article/details/49125597%E3%80%82">http://blog.csdn.net/huangyuan_xuan/article/details/49125597ã€‚</a><br>æœåŠ¡å™¨ï¼š</p><ol><li>å®‰è£…git,sshæœåŠ¡<br><code>sudo apt install git ssh</code></li><li>æ–°å¢ç”¨æˆ·ï¼Œç”¨æˆ·åä¸ºgit<br><code>adduser git</code></li><li>åˆå§‹åŒ–gitä»“åº“ï¼Œæˆ‘æ”¾åœ¨&#x2F;home&#x2F;git&#x2F;repository<br><code>cd /home/git/repository</code><br><code>git init --bare test.git</code><br><code>--base</code>å‚æ•°æ˜¯åˆå§‹åŒ–è£¸ä»“åº“ã€‚<br>æ‰§è¡Œ<code>tree</code>å‘½ä»¤å¯ä»¥æŸ¥çœ‹ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š<br><img src="/image/git/git_init_tree.png" alt="git_init_tree"> </li><li>æ·»åŠ ç§˜é’¥<br>å°†æœ¬åœ°ç”Ÿæˆçš„<code>id_rsa.pub</code>æ–‡ä»¶é‡Œé¢çš„å†…å®¹è¿½åŠ åˆ°<code>/home/git/.ssh/authorized_keys</code>æ–‡ä»¶ä¸­ã€‚<br>å¯ä»¥å…ˆå°†ç§˜é’¥æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œç„¶ååœ¨æœåŠ¡å™¨ä¸Šæ“ä½œæ–‡ä»¶ï¼Œæ·»åŠ å†…å®¹ã€‚</li><li>ä¿®æ”¹æƒé™<br>å°† &#x2F;home&#x2F;git æ‰€æœ‰è€…æ›´æ”¹ä¸ºgitç”¨æˆ·<br><code>chown -R git:git /home/git</code><br>ç”¨æˆ·homeç›®å½•755æƒé™<br><code>chmod 755 /home/git</code><br>.sshç›®å½•700æƒé™<br><code>chmod 700 .ssh</code><br>authorized_keys 600æƒé™<br><code>chmod 600 .ssh/authorized_keys</code></li><li>ä¿®æ”¹sshé…ç½®æ–‡ä»¶<br>é…ç½®æ–‡ä»¶æ˜¯<code>/etc/ssh/sshd_config</code>ï¼Œå–æ¶ˆè¿™è¡Œ <code>AuthorizedKeysFile    %h/.ssh/authorized_keys</code> å‰é¢çš„æ³¨é‡Š</li><li>é‡å¯<code>ssh</code>æœåŠ¡<br><code>sudo service ssh restart</code></li><li>å¯é€‰é¡¹ï¼šä¸ºäº†å®‰å…¨ ç¦æ­¢gitç”¨æˆ·shellç™»å½•ï¼Œéœ€è¦ä¿®æ”¹&#x2F;etc&#x2F;passwd<br>å°† git:x:1001:1001:,,,:&#x2F;home&#x2F;git:&#x2F;bin&#x2F;bash<br>æ”¹ä¸º git:x:1001:1001:,,,:&#x2F;home&#x2F;git:&#x2F;usr&#x2F;bin&#x2F;git-shell</li></ol><p>å›åˆ°æœ¬åœ°ï¼Œè¿›è¡Œå…‹éš†<br><code>git clone git@192.168.1.103:/home/git/code/test.git</code><br>æˆ–è€…<br><code>git clone git@192.168.1.103:code/test.git</code><br>å¦‚æœsshä¸æ˜¯é»˜è®¤çš„22ç«¯å£ï¼Œåˆ™åœ¨ipåæ·»åŠ ç«¯å£ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>è¿ç»´</tag>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JVM-å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥</title>
    <link href="/2017/04/07/JVM-%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E4%B8%8E%E5%9B%9E%E6%94%B6%E7%AD%96%E7%95%A5/"/>
    <url>/2017/04/07/JVM-%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E4%B8%8E%E5%9B%9E%E6%94%B6%E7%AD%96%E7%95%A5/</url>
    
    <content type="html"><![CDATA[<p>ã€€ã€€JavaæŠ€æœ¯ä½“ç³»ä¸­æ‰€æå€¡çš„è‡ªåŠ¨å†…å­˜ç®¡ç†æœ€ç»ˆå¯ä»¥å½’ç»“ä¸ºè‡ªåŠ¨åŒ–çš„è§£å†³äº†ä¸¤ä¸ªé—®é¢˜ï¼šç»™å¯¹è±¡åˆ†é…å†…å­˜ä»¥åŠå›æ”¶åˆ†é…ç»™å¯¹è±¡çš„å†…å­˜ã€‚å¯¹è±¡çš„å†…å­˜åˆ†é…ï¼Œå¾€å¤§æ–¹å‘è®²ï¼Œå°±æ˜¯åœ¨å †ä¸Šåˆ†é…(ä½†ä¹Ÿå¯èƒ½ç»è¿‡JITç¼–è¯‘åè¢«æ‹†æ•£ä¸ºæ ‡é‡ç±»å‹å¹¶é—´æ¥åœ°æ ˆä¸Šåˆ†é…)ï¼Œå¯¹è±¡ä¸»è¦åˆ†é…åœ¨æ–°ç”Ÿä»£çš„EdenåŒºä¸Šï¼Œå¦‚æœå¯åŠ¨äº†æœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å†²ï¼Œå°†æŒ‰çº¿ç¨‹ä¼˜å…ˆåœ¨TLABä¸Šåˆ†é…ã€‚å°‘æ•°æƒ…å†µä¸‹ä¹Ÿå¯èƒ½ä¼šç›´æ¥åˆ†é…åœ¨è€å¹´ä»£ä¸­ï¼Œåˆ†é…çš„è§„åˆ™å¹¶ä¸æ˜¯ç™¾åˆ†ç™¾å›ºå®šçš„ï¼Œå…¶ç»†èŠ‚å–å†³äºå½“å‰ä½¿ç”¨çš„æ˜¯å“ªä¸€ç§åƒåœ¾å›æ”¶å™¨ç»„åˆï¼Œè¿˜æœ‰è™šæ‹Ÿæœºä¸­ä¸å†…å­˜ç›¸å…³çš„å‚æ•°è®¾ç½®ã€‚</p><span id="more"></span><h3 id="å¯¹è±¡ä¼˜å…ˆåœ¨Edenåˆ†é…"><a href="#å¯¹è±¡ä¼˜å…ˆåœ¨Edenåˆ†é…" class="headerlink" title="å¯¹è±¡ä¼˜å…ˆåœ¨Edenåˆ†é…"></a>å¯¹è±¡ä¼˜å…ˆåœ¨Edenåˆ†é…</h3><p>ã€€ã€€å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡åœ¨æ–°ç”Ÿä»£EdenåŒºä¸­åˆ†é…ï¼Œå½“EdenåŒºæ²¡æœ‰è¶³å¤Ÿç©ºé—´è¿›è¡Œåˆ†é…æ—¶ï¼Œè™šæ‹Ÿæœºå°†å‘èµ·ä¸€æ¬¡Minor GCã€‚è™šæ‹Ÿæœºæä¾›äº†-XXï¼š+PrintGCDetailsè¿™ä¸ªæ”¶é›†å™¨æ—¥å¿—å‚æ•°ï¼Œå‘Šè¯‰è™šæ‹Ÿæœºåœ¨å‘ç”Ÿåƒåœ¾æ”¶é›†è¡Œä¸ºæ—¶æ‰“å°å†…å­˜å›æ”¶æ—¥å¿—ï¼Œå¹¶ä¸”åœ¨è¿›ç¨‹é€€å‡ºçš„æ—¶å€™è¾“å‡ºå½“å‰çš„å†…å­˜å„åŒºåŸŸåˆ†é…æƒ…å†µã€‚<br>ã€€ã€€æ–°ç”Ÿä»£GC(Minor GC):æŒ‡å‘ç”Ÿåœ¨æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†åŠ¨ä½œï¼Œå› ä¸ºJavaå¯¹è±¡å¤§å¤šéƒ½å…·å¤‡æœç”Ÿå¤•ç­çš„ç‰¹æ€§ï¼Œæ‰€ä»¥Minor GCéå¸¸é¢‘ç¹ï¼Œä¸€èˆ¬å›æ”¶é€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«ã€‚<br>ã€€ã€€è€å¹´ä»£GC(Major GC&#x2F;Full GC):æŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„GCï¼Œå‡ºç°äº†Major GCï¼Œç»å¸¸ä¼šä¼´éšè‡³å°‘ä¸€æ¬¡çš„Minor GCï¼Œ(ä½†éç»å¯¹çš„ï¼Œåœ¨Parallel Scavengeæ”¶é›†å™¨çš„æ‰‹æœºç­–ç•¥é‡Œå°±æœ‰ç›´æ¥è¿›è¡ŒMajor GCçš„ç­–ç•¥é€‰æ‹©è¿‡ç¨‹)ã€‚Major GCçš„é€Ÿåº¦ä¸€èˆ¬ä¼šæ¯”Minor GCæ…¢10å€ä»¥ä¸Šã€‚</p><h3 id="å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£"><a href="#å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£" class="headerlink" title="å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£"></a>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</h3><p>ã€€ã€€æ‰€è°“çš„å¤§å¯¹è±¡æ˜¯æŒ‡ï¼Œéœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„Javaå¯¹è±¡ï¼Œæœ€å…¸å‹çš„å¤§å¯¹è±¡å°±æ˜¯é‚£ç§å¾ˆé•¿çš„å­—ç¬¦ä¸²ä»¥åŠæ•°ç»„ï¼Œå¤§å¯¹è±¡å¯¹è™šæ‹Ÿæœºçš„å†…å­˜åˆ†é…æ¥è¯´å°±æ˜¯ä¸€ä¸ªåæ¶ˆæ¯ï¼Œç»å¸¸å‡ºç°å¤§å¯¹è±¡å®¹æ˜“å¯¼è‡´å†…å­˜è¿˜æœ‰ä¸å°‘ç©ºé—´æ—¶å°±æå‰å‡ºå‘åƒåœ¾æ”¶é›†ä»¥è·å–è¶³å¤Ÿçš„è¿ç»­ç©ºé—´æ¥â€å®‰ç½®â€å®ƒä»¬ã€‚</p><h3 id="é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£"><a href="#é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£" class="headerlink" title="é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£"></a>é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£</h3><p>ã€€ã€€æ—¢ç„¶è™šæ‹Ÿæœºé‡‡ç”¨äº†åˆ†ä»£æ”¶é›†çš„æ€æƒ³æ¥ç®¡ç†å†…å­˜ï¼Œé‚£ä¹ˆå†…å­˜å›æ”¶æ—¶å°±å¿…é¡»èƒ½è¯†åˆ«å“ªäº›å¯¹è±¡åº”æ”¾åœ¨æ–°ç”Ÿä»£ï¼Œå“ªäº›å¯¹è±¡åº”æ”¾åœ¨è€å¹´ä»£ä¸­ã€‚ä¸ºäº†åšåˆ°è¿™ç‚¹ï¼Œè™šæ‹Ÿæœºç»™æ¯ä¸ªå¯¹è±¡å®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡å¹´é¾„(Age)è®¡æ•°å™¨ã€‚å¦‚æœå¯¹è±¡åœ¨Edenå‡ºç”Ÿå¹¶ç»è¿‡ç¬¬ä¸€ä¸ªMinor GCåä»ç„¶å­˜æ´»ï¼Œå¹¶ä¸”èƒ½è¢«Survivorå®¹çº³çš„è¯ï¼Œå°†è¢«ç§»åŠ¨åˆ°Survivorç©ºé—´ä¸­ï¼Œå¹¶ä¸”å¯¹è±¡å¹´é¾„è®¾ä¸º1ã€‚å¯¹è±¡åœ¨SurvivoråŒºä¸­æ¯ç»è¿‡ä¸€ä¸ªMinor GCï¼Œå¹´é¾„å°±å¢åŠ 1å²ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦(é»˜è®¤æ˜¯15å²)ï¼Œå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚å¯¹è±¡æ™‹å‡è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ï¼Œå¯ä»¥é€šè¿‡å‚æ•°-XXï¼š<br>MaxTenuringThresholdè®¾ç½®ã€‚</p><h3 id="åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š"><a href="#åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š" class="headerlink" title="åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š"></a>åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š</h3><p>ã€€ã€€ä¸ºäº†èƒ½æ›´å¥½çš„é€‚åº”ä¸åŒç¨‹åºçš„å†…å­˜çŠ¶å†µï¼Œè™šæ‹Ÿæœºå¹¶ä¸æ˜¯æ°¸è¿œçš„è¦æ±‚å¯¹è±¡çš„å¹´é¾„å¿…é¡»è¾¾åˆ°äº†MaxTenuringThresholdæ‰èƒ½æ™‹å‡åˆ°è€å¹´ä»£ï¼Œå¦‚æœSurvivorç©ºé—´ä¸­ç›¸åŒçš„å¹´é¾„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äºSurvivorç©ºé—´çš„ä¸€èˆ¬ï¼Œå¹´é¾„å¤§äºæˆ–ç­‰äºæ”¹å¹´é¾„çš„å¯¹è±¡å°±å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œæ— åºç­‰åˆ°MaxTenuringThresholdä¸­è¦æ±‚çš„å¹´é¾„ã€‚</p><h3 id="ç©ºé—´åˆ†é…æ‹…ä¿"><a href="#ç©ºé—´åˆ†é…æ‹…ä¿" class="headerlink" title="ç©ºé—´åˆ†é…æ‹…ä¿"></a>ç©ºé—´åˆ†é…æ‹…ä¿</h3><p>ã€€ã€€åœ¨å‘ç”ŸMinor GCä¹‹å‰ï¼Œè™šæ‹Ÿæœºä¼šå…ˆæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡æ€»ç©ºé—´ï¼Œå¦‚æœè¿™ä¸ªæ¡ä»¶æˆç«‹ï¼Œé‚£ä¹ˆMinor GCå¯ä»¥ç¡®ä¿æ˜¯å®‰å…¨çš„ã€‚å¦‚æœä¸æˆç«‹ï¼Œåˆ™è™šæ‹Ÿæœºä¼šæŸ¥çœ‹HandlePromotionFailureè®¾ç½®å€¼æ˜¯å¦å…è®¸æ‹…ä¿å¤±è´¥ã€‚å¦‚æœå…è®¸ï¼Œé‚£ä¹ˆä¼šç»§ç»­æ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºå†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å°ï¼Œå¦‚æœå¤§äºï¼Œå°†å°è¯•ç€è¿›è¡Œä¸€æ¬¡Minor GCï¼Œå°½ç®¡è¿™æ¬¡Minor GCæ˜¯æœ‰é£é™©çš„ï¼›å¦‚æœå°äºï¼Œæˆ–è€…HandlePromotionFailureè®¾ç½®ä¸å…è®¸å†’é™©ï¼Œé‚£è¿™æ—¶ä¹Ÿè¦æ”¹ä¸ºè¿›è¡Œä¸€æ¬¡Full GCã€‚<br>æ–°ç”Ÿä»£ä½¿ç”¨å¤åˆ¶æ”¶é›†ç®—æ³•ï¼Œä½†ä¸ºäº†å†…å­˜åˆ©ç”¨ç‡ï¼Œåªä½¿ç”¨å…¶ä¸­ä¸€ä¸ªSurvivorç©ºé—´æ¥ä½œä¸ºè½®æ¢å¤‡ä»½ï¼Œå› æ­¤å½“å‡ºç°å¤§é‡å¯¹è±¡åœ¨Minor GCåä»ç„¶å­˜æ´»çš„æƒ…å†µ(æœ€æç«¯çš„æƒ…å†µå°±æ˜¯å†…å­˜å›æ”¶åæ–°ç”Ÿä»£ä¸­æ‰€æœ‰å¯¹è±¡éƒ½å­˜æ´»)ï¼Œå°±éœ€è¦è€å¹´ä»£è¿›è¡Œåˆ†é…æ‹…ä¿ï¼ŒæŠŠSurvivoræ— æ³•å®¹çº³çš„å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚ ä¸ç”Ÿæ´»ä¸­çš„è´·æ¬¾æ‹…ä¿ç±»ä¼¼ï¼Œè€å¹´ä»£è¦è¿›è¡Œè¿™æ ·çš„æ‹…ä¿ï¼Œå‰ææ˜¯è€å¹´ä»£æœ¬èº«è¿˜æœ‰å®¹çº³è¿™äº›å¯¹è±¡çš„å‰©ä½™ç©ºé—´ï¼Œä¸€å…±æœ‰å¤šå°‘å¯¹è±¡ä¼šæ´»ä¸‹æ¥åœ¨å®é™…å®Œæˆå†…å­˜å›æ”¶ä¹‹å‰æ˜¯æ— æ³•æ˜ç¡®çŸ¥é“çš„ï¼Œæ‰€ä»¥åªå¥½å–ä¹‹å‰æ¯ä¸€æ¬¡å›æ”¶æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡å®¹é‡çš„å¹³å‡å¤§å°å€¼ä½œä¸ºç»éªŒå€¼ï¼Œä¸è€å¹´ä»£çš„å‰©ä½™ç©ºé—´è¿›è¡Œæ¯”è¾ƒï¼Œå†³å®šæ˜¯å¦è¿›è¡ŒFull GCæ¥è®©è€å¹´ä»£è…¾å‡ºæ›´å¤šç©ºé—´ã€‚<br>å–å¹³å‡å€¼è¿›è¡Œæ¯”è¾ƒå…¶å®ä»ç„¶æ˜¯ä¸€ç§åŠ¨æ€æ¦‚ç‡çš„æ‰‹æ®µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæŸæ¬¡Minor GCå­˜æ´»åçš„å¯¹è±¡çªå¢ï¼Œè¿œè¿œé«˜äºå¹³å‡å€¼çš„è¯ï¼Œä¾ç„¶ä¼šå¯¼è‡´æ‹…ä¿å¤±è´¥(Handle Promotion Failure)ã€‚å¦‚æœå‡ºç°äº†HandlePromotionFailureå¤±è´¥ï¼Œé‚£å°±åªå¥½åœ¨å¤±è´¥åé‡æ–°å‘èµ·ä¸€æ¬¡Full GCã€‚ è™½ç„¶æ‹…ä¿å¤±è´¥æ—¶ç»•çš„åœˆå­æ˜¯æœ€å¤§çš„ï¼Œä½†å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½è¿˜æ˜¯ä¼šå°†HandlePromotionFailureå¼€å…³æ‰“å¼€ï¼Œé¿å…Full GCè¿‡äºé¢‘ç¹ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>JVM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JVM-åƒåœ¾æ”¶é›†ç®—æ³•ä¸å®ç°</title>
    <link href="/2017/03/30/JVM-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95/"/>
    <url>/2017/03/30/JVM-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<p>ã€€ã€€ç”±äºåƒåœ¾æ”¶é›†ç®—æ³•çš„å®ç°æ¶‰åŠå¤§é‡çš„ç¨‹åºç»†èŠ‚ï¼Œè€Œä¸”å„ä¸ªå¹³å°çš„è™šæ‹Ÿæœºæ“ä½œå†…å­˜çš„æ–¹æ³•åˆå„ä¸ç›¸åŒï¼Œè¿™é‡Œåªæ˜¯ä»‹ç»å‡ ç§ç®—æ³•çš„æ€æƒ³åŠå…¶å‘å±•è¿‡ç¨‹ã€‚</p><span id="more"></span><h3 id="åƒåœ¾æ”¶é›†ç®—æ³•"><a href="#åƒåœ¾æ”¶é›†ç®—æ³•" class="headerlink" title="åƒåœ¾æ”¶é›†ç®—æ³•"></a>åƒåœ¾æ”¶é›†ç®—æ³•</h3><h4 id="æ ‡è®°-æ¸…é™¤ç®—æ³•"><a href="#æ ‡è®°-æ¸…é™¤ç®—æ³•" class="headerlink" title="æ ‡è®°-æ¸…é™¤ç®—æ³•"></a>æ ‡è®°-æ¸…é™¤ç®—æ³•</h4><p>ã€€ã€€æœ€åŸºç¡€çš„ç®—æ³•æ˜¯â€æ ‡è®°-æ¸…é™¤â€(Mark-Sweep)ç®—æ³•ï¼Œç®—æ³•åˆ†ä¸ºâ€™æ ‡è®°â€™å’Œâ€™æ¸…é™¤â€™ä¸¤ä¸ªé˜¶æ®µï¼šé¦–å…ˆæ ‡è®°å¤„æ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåœ¨æ ‡è®°åç»Ÿä¸€å›æ”¶æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ã€‚å®ƒçš„ä¸»è¦ä¸è¶³æœ‰ä¸¤ä¸ªï¼šä¸€ä¸ªäº‹æ•ˆç‡é—®é¢˜ï¼Œæ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªè¿‡ç¨‹çš„æ•ˆç‡éƒ½ä¸é«˜ï¼›å¦å¤–ä¸€ä¸ªäº‹ç©ºé—´é—®é¢˜ï¼Œæ ‡è®°æ¸…é™¤ä¹‹åä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ï¼Œç©ºé—´ç¢ç‰‡å¤ªå¤šå¯èƒ½ä¼šå¯¼è‡´ä»¥åå†ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦åˆ†é…è¾ƒå¤§å¯¹è±¡æ—¶ï¼Œæ— æ³•æ‰¾åˆ°è¶³å¤Ÿçš„è¿ç»­å†…å­˜è€Œä¸å¾—ä¸æå‰è§¦å‘å¦ä¸€æ¬¡åƒåœ¾æ”¶é›†åŠ¨ä½œã€‚</p><h4 id="1-å¤åˆ¶ç®—æ³•"><a href="#1-å¤åˆ¶ç®—æ³•" class="headerlink" title="1. å¤åˆ¶ç®—æ³•"></a>1. å¤åˆ¶ç®—æ³•</h4><p>ã€€ã€€å®ƒå°†å¯ç”¨å†…å­˜æŒ‰å®¹é‡åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€å—ï¼Œå½“è¿™ä¸€å—çš„å†…å­˜ç”¨å®Œäº†ï¼Œå°±å°†è¿˜å­˜æ´»ç€çš„å¯¹è±¡å¤åˆ¶åˆ°å¦å¤–ä¸€å—ä¸Šé¢ï¼Œç„¶åæŠŠå·²ç»ä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ã€‚è¿™æ ·ä½¿å¾—æ¯æ¬¡éƒ½æ˜¯å¯¹æ•´ä¸ªåŠåŒºè¿›è¡Œå†…å­˜å›æ”¶ï¼Œå†…å­˜åˆ†é…æ—¶ä¹Ÿå°±ä¸ç”¨è€ƒè™‘å†…å­˜ç¢ç‰‡ç­‰å¤æ‚æƒ…å†µã€‚åªè¦ç§»åŠ¨å †é¡¶æŒ‡é’ˆï¼ŒæŒ‰é¡ºåºåˆ†é…å†…å­˜å³å¯ï¼Œå®ç°ç®€å•ï¼Œè¿è¡Œé«˜æ•ˆï¼Œåªæ˜¯è¿™ç§ç®—æ³•çš„ä»£ä»·æ˜¯å°†å†…å­˜ç¼©å°ä¸ºäº†åŸæ¥çš„ä¸€èˆ¬ï¼Œä»£ä»·å¤ªé«˜ã€‚<br>ç°åœ¨çš„å•†ä¸šè™šæ‹Ÿæœºéƒ½é‡‡ç”¨è¿™ç§æ‰‹æœºç®—æ³•å›æ”¶æ–°ç”Ÿä»£ï¼ŒIBMå…¬å¸çš„ä¸“é—¨ç ”ç©¶è¡¨æ˜ï¼Œæ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡98%æ˜¯æœç”Ÿå¤•æ­»çš„ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦æŒ‰ç…§1:1çš„æ¯”ä¾‹æ¥åˆ’åˆ†å†…å­˜ç©ºé—´ï¼Œè€Œæ˜¯å°†å†…å­˜åˆ†ä¸ºä¸€å—è¾ƒå¤§çš„Edenç©ºé—´å’Œä¸¤å—è¾ƒå°çš„Survivorç©ºé—´ï¼Œæ¯æ¬¡ä½¿ç”¨Edenå’Œå…¶ä¸­ä¸€å—Survivorç©ºé—´ä¸Šï¼Œæœ€åæ¸…ç†æ‰Edenå’Œåˆšæ‰ç”¨è¿‡çš„Survivorä¸­è¿˜å­˜æ´»ç€çš„å¯¹è±¡ä¸€æ¬¡æ€§å¤åˆ¶åˆ°å¦å¤–ä¸€å—Survivorç©ºé—´ä¸Šï¼Œæœ€åæ¸…ç†æ‰Edenå’Œåˆšæ‰ç”¨è¿‡çš„Survivorç©ºé—´ã€‚</p><h4 id="2-æ ‡è®°-æ•´ç†ç®—æ³•"><a href="#2-æ ‡è®°-æ•´ç†ç®—æ³•" class="headerlink" title="2. æ ‡è®°-æ•´ç†ç®—æ³•"></a>2. æ ‡è®°-æ•´ç†ç®—æ³•</h4><p>ã€€ã€€å¤åˆ¶æ”¶é›†çŸ­å‘åœ¨å¯¹è±¡å­˜æ´»ç‡è¾ƒé«˜æ—¶å°±è¦è¿›è¡Œè¾ƒå¤šçš„å¤åˆ¶æ“ä½œï¼Œæ•ˆç‡å°†ä¼šå˜ä½ã€‚æ›´å…³é”®çš„æ˜¯ï¼Œå¦‚æœä¸æƒ³æµªè´¹ä¸€åŠçš„ç©ºé—´ï¼Œå°±éœ€è¦é¢å¤–çš„æ§ä»¶è¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œä»¥åº”å¯¹è¢«ä½¿ç”¨çš„çš„å†…å­˜ä¸­æ‰€æœ‰å¯¹è±¡éƒ½100%å­˜æ´»çš„æç«¯æƒ…å†µï¼Œæ‰€ä»¥åœ¨è€å¹´ä»£ä¸€åŠä¸èƒ½ç›´æ¥é€‰ç”¨è¿™ç§ç®—æ³•ã€‚<br>æ ¹æ®è€å¹´ä»£çš„ç‰¹ç‚¹ï¼Œæœ‰äººæå‡ºäº†å¦å¤–ä¸€ç§â€æ ‡è®°-æ•´ç†â€(Mark-Compact)ç®—æ³•ï¼Œæ ‡è®°è¿‡ç¨‹ä»»ç„¶ä¸â€æ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¸€æ ·ï¼Œä½†åç»­æ­¥éª¤ä¸æ˜¯ç›´æ¥å¯¹å¯å›æ”¶å¯¹è±¡è¿›è¡Œæ¸…ç†ï¼Œè€Œæ˜¯è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯ä¾¿æ·ä»¥å¤–çš„å†…å­˜ã€‚</p><h4 id="3-åˆ†ä»£æ”¶é›†ç®—æ³•"><a href="#3-åˆ†ä»£æ”¶é›†ç®—æ³•" class="headerlink" title="3. åˆ†ä»£æ”¶é›†ç®—æ³•"></a>3. åˆ†ä»£æ”¶é›†ç®—æ³•</h4><p>ã€€ã€€å½“å‰å•†ä¸šè™šæ‹Ÿæœºçš„åƒåœ¾æ”¶é›†éƒ½é‡‡ç”¨â€åˆ†ä»£æ”¶é›†â€(Generational Collection)ç®—æ³•ï¼Œè¿™ç§ç®—æ³•å¹¶æ²¡æœ‰ä»€ä¹ˆæ–°çš„æ€æƒ³ï¼Œåªæ˜¯æ ¹æ®å¯¹è±¡çš„å­˜è´§å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œä¸€èˆ¬æ˜¯æŠŠJavaå †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹é‡‡ç”¨æœ€é€‚å½“çš„æ”¶é›†ç®—æ³•ã€‚åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œæ¯æ¬¡åƒåœ¾æ”¶é›†æ—¶éƒ½å‘ç°æœ‰å¤§æ‰¹å¯¹è±¡æ­»å»ï¼Œåªæœ‰å°‘é‡å­˜æ´»ï¼Œé‚£å°±é€‰ç”¨å¤åˆ¶ç®—æ³•ï¼Œåªéœ€è¦ä»˜å‡ºå°‘é‡å­˜æ´»å¯¹è±¡çš„å¤åˆ¶æˆæœ¬å°±å¯ä»¥å®Œæˆæ”¶é›†ã€‚è€Œè€å¹´ä»£ä¸­å› ä¸ºå¯¹è±¡å­˜æ´»ç‡é«˜ã€æ²¡æœ‰é¢å¤–ç©ºé—´å¯¹å®ƒè¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œå°±å¿…é¡»ä½¿ç”¨â€æ ‡è®°-æ¸…ç†â€æˆ–è€…â€æ ‡è®°-æ•´ç†â€ç®—æ³•æ¥è¿›è¡Œå›æ”¶ã€‚</p><h3 id="HotSpotç®—æ³•å®ç°"><a href="#HotSpotç®—æ³•å®ç°" class="headerlink" title="HotSpotç®—æ³•å®ç°"></a>HotSpotç®—æ³•å®ç°</h3><h4 id="æšä¸¾æ ¹èŠ‚ç‚¹"><a href="#æšä¸¾æ ¹èŠ‚ç‚¹" class="headerlink" title="æšä¸¾æ ¹èŠ‚ç‚¹"></a>æšä¸¾æ ¹èŠ‚ç‚¹</h4><p>ã€€ã€€ä»å¯è¾¾æ€§åˆ†æä¸­ä»GC RootsèŠ‚ç‚¹å¼•ç”¨é“¾è¿™ä¸ªæ“ä½œä¸ºä¾‹ï¼Œå¯ä½œä¸ºGC Rootsçš„èŠ‚ç‚¹ä¸»è¦åœ¨å…¨å±€æ€§çš„å¼•ç”¨(ä¾‹å¦‚å¸¸é‡æˆ–ç±»é™æ€å±æ€§)ä¸æ‰§è¡Œä¸Šä¸‹æ–‡(ä¾‹å¦‚æ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨)ä¸­ï¼Œç°åœ¨å¾ˆå¤šåº”ç”¨ä»…ä»…æ–¹æ³•åŒºå°±æœ‰æ•°ç™¾å…†ï¼Œå¦‚æœè¦é€ä¸ªæ£€æŸ¥è¿™é‡Œé¢çš„å¼•ç”¨ï¼Œé‚£ä¹ˆå¿…ç„¶ä¼šæ¶ˆè€—å¾ˆå¤šæ—¶é—´ã€‚<br>å¦å¤–ï¼Œå¯è¾¾æ€§åˆ†æå¯¹æ‰§è¡Œæ—¶é—´çš„æ•æ„Ÿè¿˜ä½“ç°åœ¨GCåœé¡¿ä¸Šï¼Œå› ä¸ºè¿™é¡¹åˆ†æå·¥ä½œå¿…é¡»åœ¨ä¸€ä¸ªèƒ½ç¡®ä¿ä¸€è‡´æ€§çš„å¿«ç…§ä¸­è¿›è¡Œâ€”-è¿™é‡Œ<code>ä¸€è‡´æ€§</code>çš„æ„æ€æ˜¯æŒ‡åœ¨è¿™ä¸ªåˆ†ææœŸé—´æ•´ä¸ªæ‰§è¡Œç³»ç»Ÿçœ‹èµ·æ¥å°±åƒè¢«å†»ç»“åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œä¸å¯ä»¥å‡ºç°åˆ†æè¿‡ç¨‹ä¸­å¯¹è±¡å¼•ç”¨å…³ç³»è¿˜åœ¨ä¸æ–­å˜åŒ–çš„æƒ…å†µï¼Œè¯¥ç‚¹ä¸æ»¡è¶³çš„è¯åˆ†æç»“æœå‡†ç¡®æ€§å°±æ— æ³•å¾—åˆ°æŠ±æ•ã€‚è¿™ç‚¹æ˜¯å¯¼è‡´GCè¿›è¡Œæ—¶å¿…é¡»åœé¡¿æ‰€æœ‰Javaæ‰§è¡Œçº¿ç¨‹(Sunå°†è¿™ä»¶äº‹æƒ…ç§°ä¸ºâ€Stop The Worldâ€)çš„å…¶ä¸­ä¸€ä¸ªé‡è¦åŸå› ï¼Œå³ä½¿æ˜¯åœ¨å·ç§°å‡ ä¹ä¸ä¼šå‘ç”Ÿåœé¡¿çš„CMSæ”¶é›†å™¨ä¸­ï¼Œæšä¸¾æ ¹èŠ‚ç‚¹æ—¶ä¹Ÿæ˜¯å¿…é¡»è¦åœé¡¿çš„ã€‚<br>ç”±äºç›®å‰çš„ä¸»æµjavaè™šæ‹Ÿæœºä½¿ç”¨çš„éƒ½æ˜¯å‡†ç¡®å¼GCï¼Œæ‰€ä»¥å½“æ‰§è¡Œç³»ç»Ÿåœé¡¿ä¸‹æ¥åï¼Œå¹¶ä¸éœ€è¦ä¸€ä¸ªä¸æ¼çš„æ£€æŸ¥å®Œæ‰€æœ‰æ‰§è¡Œä¸Šä¸‹æ–‡å’Œå…¨å±€å¼•ç”¨ä½ç½®ï¼Œè™šæ‹Ÿæœºåº”å½“æ˜¯æœ‰åŠæ³•ç›´æ¥å¾—çŸ¥å“ªäº›åœ°æ–¹å­˜æ”¾ç€å¯¹è±¡å¼•ç”¨ã€‚åœ¨HotSpotçš„å®ç°ä¸­ï¼Œæ˜¯ä½¿ç”¨ä¸€ç»„ç§°ä¸ºOopMapçš„æ•°æ®ç»“æ„æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„çš„ï¼Œåœ¨ç±»åŠ è½½å®Œæˆçš„æ—¶å€™ï¼ŒHotSpotå°±æŠŠå¯¹è±¡å†…ä»€ä¹ˆåç§»é‡ä¸Šæ˜¯ä»€ä¹ˆç±»å‹çš„æ•°æ®è®¡ç®—å‡ºæ¥ï¼Œåœ¨JITç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šåœ¨ç‰¹å®šçš„ä½ç½®è®°å½•ä¸‹æ ˆå’Œå¯„å­˜å™¨ä¸­å“ªäº›ä½ç½®æ˜¯å¼•ç”¨ï¼Œè¿™æ ·ï¼ŒGCåœ¨æ‰«ææ—¶å°±å¯ä»¥ç›´æ¥å¾—çŸ¥è¿™äº›ä¿¡æ¯äº†ã€‚</p><h4 id="å®‰å…¨ç‚¹"><a href="#å®‰å…¨ç‚¹" class="headerlink" title="å®‰å…¨ç‚¹"></a>å®‰å…¨ç‚¹</h4><p>ã€€ã€€åœ¨OopMapçš„ååŠ©ä¸‹ï¼ŒHotSpotå¯ä»¥å¿«é€Ÿä¸”å‡†ç¡®åœ°å®ŒæˆGC Rootsæšä¸¾ï¼Œä½†ä¸€ä¸ªå¾ˆç°å®çš„é—®é¢˜éšä¹‹è€Œæ¥ï¼šå¯èƒ½å¯¼è‡´å¼•ç”¨å…³ç³»å˜åŒ–ï¼Œæˆ–è€…è¯´OopMapå†…å®¹å˜åŒ–çš„æŒ‡ä»¤éå¸¸å¤šï¼Œå¦‚æœä¸ºæ¯ä¸€æ¡æŒ‡ä»¤éƒ½ç”Ÿæˆå¯¹åº”çš„OopMapï¼Œé‚£å°†ä¼šéœ€è¦å¤§é‡çš„é¢å¤–ç©ºé—´ï¼Œè¿™æ ·GCçš„ç©ºé—´æˆæœ¬å°†ä¼šå˜å¾—å¾ˆé«˜ã€‚å®é™…ä¸Šï¼ŒHotSpotä¹Ÿçš„ç¡®æ²¡æœ‰ä¸ºæ¯æ¡æŒ‡ä»¤éƒ½ç”ŸæˆOopMapï¼Œå‰é¢å·²ç»æåˆ°ï¼Œåªæ˜¯åœ¨â€œç‰¹å®šçš„ä½ç½®â€è®°å½•äº†è¿™äº›ä¿¡æ¯ï¼Œè¿™äº›ä½ç½®ç§°ä¸ºå®‰å…¨ç‚¹ï¼ˆSafepointï¼‰ï¼Œå³ç¨‹åºæ‰§è¡Œæ—¶å¹¶éåœ¨æ‰€æœ‰åœ°æ–¹éƒ½èƒ½åœé¡¿ä¸‹æ¥å¼€å§‹GCï¼Œåªæœ‰åœ¨åˆ°è¾¾å®‰å…¨ç‚¹æ—¶æ‰èƒ½æš‚åœã€‚ Safepointçš„é€‰å®šæ—¢ä¸èƒ½å¤ªå°‘ä»¥è‡´äºè®©GCç­‰å¾…æ—¶é—´å¤ªé•¿ï¼Œä¹Ÿä¸èƒ½è¿‡äºé¢‘ç¹ä»¥è‡´äºè¿‡åˆ†å¢å¤§è¿è¡Œæ—¶çš„è´Ÿè·ã€‚ æ‰€ä»¥ï¼Œå®‰å…¨ç‚¹çš„é€‰å®šåŸºæœ¬ä¸Šæ˜¯ä»¥ç¨‹åºâ€œæ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾â€ä¸ºæ ‡å‡†è¿›è¡Œé€‰å®šçš„â€”â€”å› ä¸ºæ¯æ¡æŒ‡ä»¤æ‰§è¡Œçš„æ—¶é—´éƒ½éå¸¸çŸ­æš‚ï¼Œç¨‹åºä¸å¤ªå¯èƒ½å› ä¸ºæŒ‡ä»¤æµé•¿åº¦å¤ªé•¿è¿™ä¸ªåŸå› è€Œè¿‡é•¿æ—¶é—´è¿è¡Œï¼Œâ€œé•¿æ—¶é—´æ‰§è¡Œâ€çš„æœ€æ˜æ˜¾ç‰¹å¾å°±æ˜¯æŒ‡ä»¤åºåˆ—å¤ç”¨ï¼Œä¾‹å¦‚æ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ã€ å¼‚å¸¸è·³è½¬ç­‰ï¼Œæ‰€ä»¥å…·æœ‰è¿™äº›åŠŸèƒ½çš„æŒ‡ä»¤æ‰ä¼šäº§ç”ŸSafepointã€‚<br>å¯¹äºSefepointï¼Œå¦ä¸€ä¸ªéœ€è¦è€ƒè™‘çš„é—®é¢˜æ˜¯å¦‚ä½•åœ¨GCå‘ç”Ÿæ—¶è®©æ‰€æœ‰çº¿ç¨‹ï¼ˆè¿™é‡Œä¸åŒ…æ‹¬æ‰§è¡ŒJNIè°ƒç”¨çš„çº¿ç¨‹ï¼‰éƒ½â€œè·‘â€åˆ°æœ€è¿‘çš„å®‰å…¨ç‚¹ä¸Šå†åœé¡¿ä¸‹æ¥ã€‚ è¿™é‡Œæœ‰ä¸¤ç§æ–¹æ¡ˆå¯ä¾›é€‰æ‹©ï¼šæŠ¢å…ˆå¼ä¸­æ–­ï¼ˆPreemptive Suspensionï¼‰å’Œä¸»åŠ¨å¼ä¸­æ–­ï¼ˆVoluntary Suspensionï¼‰ï¼Œå…¶ä¸­æŠ¢å…ˆå¼ä¸­æ–­ä¸éœ€è¦çº¿ç¨‹çš„æ‰§è¡Œä»£ç ä¸»åŠ¨å»é…åˆï¼Œåœ¨GCå‘ç”Ÿæ—¶ï¼Œé¦–å…ˆæŠŠæ‰€æœ‰çº¿ç¨‹å…¨éƒ¨ä¸­æ–­ï¼Œå¦‚æœå‘ç°æœ‰çº¿ç¨‹ä¸­æ–­çš„åœ°æ–¹ä¸åœ¨å®‰å…¨ç‚¹ä¸Šï¼Œå°±æ¢å¤çº¿ç¨‹ï¼Œè®©å®ƒâ€œè·‘â€åˆ°å®‰å…¨ç‚¹ä¸Šã€‚ ç°åœ¨å‡ ä¹æ²¡æœ‰è™šæ‹Ÿæœºå®ç°é‡‡ç”¨æŠ¢å…ˆå¼ä¸­æ–­æ¥æš‚åœçº¿ç¨‹ä»è€Œå“åº”GCäº‹ä»¶ã€‚<br>è€Œä¸»åŠ¨å¼ä¸­æ–­çš„æ€æƒ³æ˜¯å½“GCéœ€è¦ä¸­æ–­çº¿ç¨‹çš„æ—¶å€™ï¼Œä¸ç›´æ¥å¯¹çº¿ç¨‹æ“ä½œï¼Œä»…ä»…ç®€å•åœ°è®¾ç½®ä¸€ä¸ªæ ‡å¿—ï¼Œå„ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶ä¸»åŠ¨å»è½®è¯¢è¿™ä¸ªæ ‡å¿—ï¼Œå‘ç°ä¸­æ–­æ ‡å¿—ä¸ºçœŸæ—¶å°±è‡ªå·±ä¸­æ–­æŒ‚èµ·ã€‚è½®è¯¢æ ‡å¿—çš„åœ°æ–¹å’Œå®‰å…¨ç‚¹æ˜¯é‡åˆçš„ï¼Œå¦å¤–å†åŠ ä¸Šåˆ›å»ºå¯¹è±¡éœ€è¦åˆ†é…å†…å­˜çš„åœ°æ–¹ã€‚</p><h4 id="å®‰å…¨åŒºåŸŸ"><a href="#å®‰å…¨åŒºåŸŸ" class="headerlink" title="å®‰å…¨åŒºåŸŸ"></a>å®‰å…¨åŒºåŸŸ</h4><p>ã€€ã€€ä½¿ç”¨Safepointä¼¼ä¹å·²ç»å®Œç¾åœ°è§£å†³äº†å¦‚ä½•è¿›å…¥GCçš„é—®é¢˜ï¼Œä½†å®é™…æƒ…å†µå´å¹¶ä¸ä¸€å®šã€‚Safepointæœºåˆ¶ä¿è¯äº†ç¨‹åºæ‰§è¡Œæ—¶ï¼Œåœ¨ä¸å¤ªé•¿çš„æ—¶é—´å†…å°±ä¼šé‡åˆ°å¯è¿›å…¥GCçš„Safepointã€‚ä½†æ˜¯ï¼Œç¨‹åºâ€œä¸æ‰§è¡Œâ€çš„æ—¶å€™å‘¢ï¼Ÿæ‰€è°“çš„ç¨‹åºä¸æ‰§è¡Œå°±æ˜¯æ²¡æœ‰åˆ†é…CPUæ—¶é—´ï¼Œå…¸å‹çš„ä¾‹å­å°±æ˜¯çº¿ç¨‹å¤„äºSleepçŠ¶æ€æˆ–è€…BlockedçŠ¶æ€ï¼Œè¿™æ—¶å€™çº¿ç¨‹æ— æ³•å“åº”JVMçš„ä¸­æ–­è¯·æ±‚ï¼Œâ€œèµ°â€åˆ°å®‰å…¨çš„åœ°æ–¹å»ä¸­æ–­æŒ‚èµ·ï¼ŒJVMä¹Ÿæ˜¾ç„¶ä¸å¤ªå¯èƒ½ç­‰å¾…çº¿ç¨‹é‡æ–°è¢«åˆ†é…CPUæ—¶é—´ã€‚ å¯¹äºè¿™ç§æƒ…å†µï¼Œå°±éœ€è¦å®‰å…¨åŒºåŸŸï¼ˆSafe Regionï¼‰æ¥è§£å†³ã€‚<br>å®‰å…¨åŒºåŸŸæ˜¯æŒ‡åœ¨ä¸€æ®µä»£ç ç‰‡æ®µä¹‹ä¸­ï¼Œå¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚ åœ¨è¿™ä¸ªåŒºåŸŸä¸­çš„ä»»æ„åœ°æ–¹å¼€å§‹GCéƒ½æ˜¯å®‰å…¨çš„ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠSafe Regionçœ‹åšæ˜¯è¢«æ‰©å±•äº†çš„Safepointã€‚<br>åœ¨çº¿ç¨‹æ‰§è¡Œåˆ°Safe Regionä¸­çš„ä»£ç æ—¶ï¼Œé¦–å…ˆæ ‡è¯†è‡ªå·±å·²ç»è¿›å…¥äº†Safe Regionï¼Œé‚£æ ·ï¼Œå½“åœ¨è¿™æ®µæ—¶é—´é‡ŒJVMè¦å‘èµ·GCæ—¶ï¼Œå°±ä¸ç”¨ç®¡æ ‡è¯†è‡ªå·±ä¸ºSafe RegionçŠ¶æ€çš„çº¿ç¨‹äº†ã€‚åœ¨çº¿ç¨‹è¦ç¦»å¼€Safe Regionæ—¶ï¼Œå®ƒè¦æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²ç»å®Œæˆäº†æ ¹èŠ‚ç‚¹æšä¸¾ï¼ˆæˆ–è€…æ˜¯æ•´ä¸ªGCè¿‡ç¨‹ï¼‰ï¼Œå¦‚æœå®Œæˆäº†ï¼Œé‚£çº¿ç¨‹å°±ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™å®ƒå°±å¿…é¡»ç­‰å¾…ç›´åˆ°æ”¶åˆ°å¯ä»¥å®‰å…¨ç¦»å¼€Safe Regionçš„ä¿¡å·ä¸ºæ­¢ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>JVM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JVMåƒåœ¾å›æ”¶-å¯¹è±¡å·²æ­»ï¼Ÿ</title>
    <link href="/2017/03/29/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6-%E5%AF%B9%E8%B1%A1%E5%B7%B2%E6%AD%BB%EF%BC%9F/"/>
    <url>/2017/03/29/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6-%E5%AF%B9%E8%B1%A1%E5%B7%B2%E6%AD%BB%EF%BC%9F/</url>
    
    <content type="html"><![CDATA[<p>ã€€ã€€åœ¨å †é‡Œé¢å­˜æ”¾ç€Javaä¸–ç•Œä¸­å‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ï¼Œåƒåœ¾æ”¶é›†å™¨åœ¨å¯¹å †è¿›è¡Œå›æ”¶å‰ï¼Œç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯è¦ç¡®å®šè¿™äº›å¯¹è±¡ä¹‹ä¸­å“ªäº›è¿˜<code>å­˜æ´»</code>ç€ï¼Œå“ªäº›å·²ç»<code>æ­»å»</code>(å³ä¸èƒ½å†è¢«ä»»ä½•é€”å¾„ä½¿ç”¨çš„å¯¹è±¡)ã€‚</p><span id="more"></span><h3 id="å¼•ç”¨è®¡æ•°ç®—æ³•"><a href="#å¼•ç”¨è®¡æ•°ç®—æ³•" class="headerlink" title="å¼•ç”¨è®¡æ•°ç®—æ³•"></a>å¼•ç”¨è®¡æ•°ç®—æ³•</h3><p>ã€€ã€€å¾ˆå¤šæ•™ç§‘ä¹¦åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»çš„ç®—æ³•æ˜¯è¿™æ ·çš„ï¼šç»™å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒæ—¶ï¼Œè®¡æ•°å™¨å€¼å°±åŠ 1;å½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å°±å‡1ï¼›ä»»ä½•æ—¶åˆ»è®¡æ•°å™¨ä¸º0çš„å¯¹è±¡å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚<br>å®¢è§‚æ¥è®²ï¼Œå¼•ç”¨è®¡æ•°æ³•(Reference Counting)çš„å®ç°ç®€å•ï¼Œåˆ¤å®šæ•ˆç‡ä¹Ÿå¾ˆé«˜ï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹å®ƒéƒ½æ˜¯ä¸€ä¸ªä¸é”™çš„ç®—æ³•ï¼Œä½†æ˜¯ï¼Œè‡³å°‘ä¸»æµçš„Javaè™šæ‹Ÿæœºé‡Œé¢æ²¡æœ‰é€‰ç”¨å¼•ç”¨è®¡æ•°å™¨ç®—æ³•æ¥ç®¡ç†å†…å­˜ï¼Œå…¶ä¸­ä¸»è¦çš„åŸå› æ˜¯å®ƒå¾ˆéš¾è§£å†³å¯¹è±¡ä¹‹é—´ç›¸äº’å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</p><h3 id="å¯è¾¾æ€§åˆ†æç®—æ³•"><a href="#å¯è¾¾æ€§åˆ†æç®—æ³•" class="headerlink" title="å¯è¾¾æ€§åˆ†æç®—æ³•"></a>å¯è¾¾æ€§åˆ†æç®—æ³•</h3><p>ã€€ã€€åœ¨ä¸»æµçš„å•†ç”¨ç¨‹åºè¯­è¨€çš„ä¸»æµå®ç°ä¸­ï¼Œéƒ½æ˜¯é€šè¿‡å¯è¾¾æ€§åˆ†æ(Reachability Analysis)æ¥åˆ¤å®šå¯¹è±¡æ˜¯å¦å­˜æ´»çš„ã€‚è¿™ä¸ªç®—å—çš„åŸºæœ¬æ€è·¯å°±æ˜¯é€šè¿‡ä¸€ç³»åˆ—çš„ç§°ä¸º<code>GC Roots</code>çš„å¯¹è±¡ä½œä¸ºèµ·å§‹ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å¼€å§‹å‘ä¸‹æœç´¢ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾(Reference Chain),å½“ä¸€ä¸ªå¯¹è±¡åˆ°GC Rootsæ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿æ—¶(åœ¨å›¾è®ºä¸­ï¼Œå°±æ˜¯ä»GC Rootsåˆ°è¿™ä¸ªå¯¹è±¡ä¸å¯è¾¾)ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ã€‚åœ¨Javaè¯­è¨€ä¸­ï¼Œå¯ä½œä¸ºGC Rootsçš„å¯¹è±¡åŒ…æ‹¬ä¸€ä¸‹å‡ ç§ï¼š</p><ul><li>è™šæ‹Ÿæœºæ ˆ(æ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨)ä¸­å¼•ç”¨çš„å¯¹è±¡ã€‚</li><li>æ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ã€‚</li><li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ã€‚</li><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­JNI(ä¸€èˆ¬è¯´çš„Nativeæ–¹æ³•)å¼•ç”¨çš„å¯¹è±¡</li></ul><h3 id="ç”Ÿå­˜è¿˜æ˜¯æ­»äº¡"><a href="#ç”Ÿå­˜è¿˜æ˜¯æ­»äº¡" class="headerlink" title="ç”Ÿå­˜è¿˜æ˜¯æ­»äº¡"></a>ç”Ÿå­˜è¿˜æ˜¯æ­»äº¡</h3><p>ã€€ã€€å³ä½¿åœ¨å¯è¾¾æ€§åˆ†æç®—æ³•ä¸­ä¸å¯è¾¾çš„å¯¹è±¡ï¼Œä¹Ÿå¹¶éæ˜¯éæ­»ä¸å¯çš„ï¼Œè¿™æ—¶å€™ä»–ä»¬æš‚æ—¶å¤„äºç¼“åˆ‘é˜¶æ®µï¼Œè¦çœŸæ­£å®£å‘Šä¸€ä¸ªå¯¹è±¡æ­»äº¡ï¼Œè‡³å°‘è¦ç»å†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ï¼šå¦‚æœå¯¹è±¡åœ¨è¿›è¡Œå¯è¾¾æ€§åˆ†æåå‘ç°æ²¡æœ‰ä¸GC Rootsç›¸è¿æ¥çš„å¼•ç”¨é“¾ï¼Œé‚£å®ƒå°†ä¼šè¢«ç¬¬ä¸€æ¬¡æ ‡è®°å¹¶ä¸”è¿›è¡Œä¸€æ¬¡ç­›é€‰ï¼Œç­›é€‰çš„æ¡ä»¶æ˜¯æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œfinalize()æ–¹æ³•ã€‚å½“å¯¹è±¡æ²¡æœ‰è¦†ç›–finalize()æ–¹æ³•ï¼Œæˆ–è€…finalize()æ–¹æ³•å·²ç»è¢«è™šæ‹Ÿæœºè°ƒç”¨è¿‡ï¼Œè™šæ‹Ÿæœºå°†è¿™ä¸¤ç§æƒ…å†µéƒ½è§†ä¸ºâ€æ²¡æœ‰å¿…è¦æ‰§è¡Œâ€ã€‚<br>å¦‚æœè¿™ä¸ªå¯¹è±¡å‘—åˆ¤å®šä¸ºæœ‰å¿…è¦æ‰§è¡Œfinalize()æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°†ä¼šæ”¾ç½®åœ¨ä¸€ä¸ªå«åš<code>F-Queue</code>çš„é˜Ÿåˆ—ä¹‹ä¸­ï¼Œå¹¶åœ¨ç¨åç”±ä¸€ä¸ªè™šæ‹Ÿæœºè‡ªåŠ¨å»ºç«‹çš„ã€ä¼˜å…ˆçº§ä½çš„Finalizerçº¿ç¨‹å»æ‰§è¡Œå®ƒã€‚è¿™é‡Œæ‰€è°“çš„æ‰§è¡Œæ˜¯æŒ‡è™šæ‹Ÿæœºä¼šè§¦å‘è¿™ä¸ªæ–¹æ³•ï¼Œä½†å¹¶ä¸æ‰¿è¯ºä¼šç­‰å¾…å®ƒè¿è¡Œç»“æŸï¼Œè¿™æ ·åšçš„åŸå› æ˜¯ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡åœ¨finalize()æ–¹æ³•ä¸­æ‰§è¡Œç¼“æ…¢ï¼Œæˆ–è€…å‘ç”Ÿäº†æ­»å¾ªç¯ï¼Œå°†å¾ˆå¯èƒ½ä¼šå¯¼è‡´<code>F-Queue</code>é˜Ÿåˆ—ä¸­å…¶ä»–å¯¹è±¡æ°¸ä¹…å¤„äºç­‰å¾…ï¼Œç”šè‡³å¯¼è‡´æ•´ä¸ªå†…å­˜å›æ”¶ç³»ç»Ÿå´©æºƒã€‚finalize()æ–¹æ³•æ˜¯å¯¹è±¡ é€ƒè„±æ­»äº¡å‘½è¿çš„æœ€åä¸€æ¬¡æœºä¼šï¼Œç¨åGCå°†å¯¹<code>F-Queue</code>ä¸­çš„å¯¹è±¡è¿›è¡Œç¬¬äºŒæ¬¡å°è§„æ¨¡çš„æ ‡è®°ã€‚</p><h3 id="å›æ”¶æ–¹æ³•åŒº"><a href="#å›æ”¶æ–¹æ³•åŒº" class="headerlink" title="å›æ”¶æ–¹æ³•åŒº"></a>å›æ”¶æ–¹æ³•åŒº</h3><p>ã€€ã€€å¾ˆå¤šäººè®¤ä¸ºæ–¹æ³•åŒºæ˜¯æ²¡æœ‰åƒåœ¾æ”¶é›†çš„ï¼ŒJavaè™šæ‹Ÿæœºè§„èŒƒä¸­ç¡®å®è¯´è¿‡å¯ä»¥ä¸è¦æ±‚è™šæ‹Ÿæœºæ–¹æ³•åŒºå®ç°åƒåœ¾æ”¶é›†ï¼Œè€Œä¸”åœ¨æ–¹æ³•åŒºä¸­è¿›è¡Œåƒåœ¾æ”¶é›†çš„æ€§ä»·æ¯”ä¸€èˆ¬æ¯”è¾ƒä½ï¼šåœ¨å †ä¸­ï¼Œå°¤å…¶æ˜¯åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œå¸¸è§„åº”ç”¨è¿›è¡Œä¸€æ¬¡åƒåœ¾æ”¶é›†ä¸€èˆ¬å¯ä»¥å›æ”¶70%-95%çš„ç©ºé—´ï¼Œè€Œæ°¸ä¹…ä»£çš„åƒåœ¾æ”¶é›†æ•ˆç‡è¿œä½äºæ­¤ã€‚<br>æ°¸ä¹…ä»£çš„åƒåœ¾æ”¶é›†ä¸»è¦å›æ”¶ä¸¤éƒ¨åˆ†å†…å®¹ï¼šåºŸå¼ƒå¸¸é‡å’Œæ— ç”¨çš„ç±»ã€‚å›æ”¶åºŸå¼ƒå¸¸é‡ä¸å›æ”¶Javaå †ä¸­çš„å¯¹è±¡éå¸¸ç±»ä¼¼ã€‚ä»¥å¸¸é‡æ± ä¸­å­—é¢é‡çš„å›æ”¶ä¸ºä¾‹ï¼šå‡å¦‚ä¸€ä¸ªå­—ç¬¦ä¸²â€ABCâ€å·²ç»è¿›å…¥äº†å¸¸é‡æ± ä¸­ï¼Œä½†æ˜¯å½“å‰ç³»ç»Ÿæ²¡æœ‰ä»»ä½•ä¸€ä¸ªStringå¯¹è±¡æ˜¯å«åšâ€ABCâ€çš„ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯æ²¡æœ‰ä»»ä½•Stringå¯¹è±¡å¼•ç”¨å¸¸é‡æ± ä¸­çš„â€ABCâ€å¸¸é‡ï¼Œä¹Ÿæ²¡æœ‰å…¶ä»–åœ°æ–¹å¼•ç”¨äº†è¿™ä¸ªå­—é¢é‡ï¼Œå¦‚æœè¿™æ—¶ç¹ç››å†…å­˜å›æ”¶ï¼Œè€Œä¸”å¿…è¦çš„è¯ï¼Œè¿™ä¸ªâ€ABCâ€å¸¸é‡å°±ä¼šè¢«ç³»ç»Ÿæ¸…ç†å‡ºå¸¸é‡æ± ï¼Œå¸¸é‡æ± ä¸­çš„å…¶ä»–ç±»ã€æ–¹æ³•ã€å­—æ®µçš„ç¬¦å·å¼•ç”¨ä¹Ÿä¸æ­¤ç±»ä¼¼ã€‚<br>åˆ¤å®šä¸€ä¸ªå¸¸é‡æ˜¯å¦æ˜¯â€åºŸå¼ƒå¸¸é‡â€æ¯”è¾ƒç®€å•ï¼Œè€Œè¦åˆ¤å®šä¸€ä¸ªç±»æ˜¯å¦æ˜¯â€æ— ç”¨çš„ç±»â€çš„æ¡ä»¶åˆ™ç›¸å¯¹è‹›åˆ»è®¸å¤šã€‚ç±»éœ€è¦åŒæ—¶æ»¡è¶³ä¸‹é¢ä¸‰ä¸ªè°ƒæ•™æ‰èƒ½ç®—æ˜¯â€æ— ç”¨çš„ç±»â€ï¼š</p><ul><li>è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯Javaå †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹ã€‚</li><li>åŠ è½½è¯¥ç±»çš„ClassLoaderå·²ç»è¢«å›æ”¶ã€‚</li><li>è¯¥ç±»å¯¹ç”¨çš„java.lang.Classå¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•å¯¹æ–¹è¢«å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•ã€‚<br>ã€€ã€€è™šæ‹Ÿæœºå¯ä»¥å¯¹æ»¡è¶³ä¸Šè¿°3ä¸ªæ¡ä»¶çš„æ— ç”¨ç±»è¿›è¡Œå›æ”¶ï¼Œè¿™é‡Œè¯´çš„ä»…ä»…æ˜¯â€œå¯ä»¥â€ï¼Œè€Œå¹¶ä¸æ˜¯å’Œå¯¹è±¡ä¸€æ ·ï¼Œä¸ä½¿ç”¨äº†å°±å¿…ç„¶ä¼šå›æ”¶ã€‚ æ˜¯å¦å¯¹ç±»è¿›è¡Œå›æ”¶ï¼ŒHotSpotè™šæ‹Ÿæœºæä¾›äº†-Xnoclassgcå‚æ•°è¿›è¡Œæ§åˆ¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨-verboseï¼šclassä»¥åŠ-XXï¼š+TraceClassLoadingã€ -XXï¼š+TraceClassUnLoadingæŸ¥çœ‹ç±»åŠ è½½å’Œå¸è½½ä¿¡æ¯ï¼Œå…¶ä¸­-verboseï¼šclasså’Œ-XXï¼š+TraceClassLoadingå¯ä»¥åœ¨Productç‰ˆçš„è™šæ‹Ÿæœºä¸­ä½¿ç”¨ï¼Œ-XXï¼š+TraceClassUnLoadingå‚æ•°éœ€è¦FastDebugç‰ˆçš„è™šæ‹Ÿæœºæ”¯æŒã€‚åœ¨å¤§é‡ä½¿ç”¨åå°„ã€ åŠ¨æ€ä»£ç†ã€ CGLibç­‰ByteCodeæ¡†æ¶ã€ åŠ¨æ€ç”ŸæˆJSPä»¥åŠOSGiè¿™ç±»é¢‘ç¹è‡ªå®šä¹‰ClassLoaderçš„åœºæ™¯éƒ½éœ€è¦è™šæ‹Ÿæœºå…·å¤‡ç±»å¸è½½çš„åŠŸèƒ½ï¼Œä»¥ä¿è¯æ°¸ä¹…ä»£ä¸ä¼šæº¢å‡ºã€‚</li></ul><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>JVM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android N åº”ç”¨å†…æ›´æ–°</title>
    <link href="/2017/03/28/Android-N-%E5%BA%94%E7%94%A8%E5%86%85%E6%9B%B4%E6%96%B0/"/>
    <url>/2017/03/28/Android-N-%E5%BA%94%E7%94%A8%E5%86%85%E6%9B%B4%E6%96%B0/</url>
    
    <content type="html"><![CDATA[<p>ç»§ä¹‹å‰è·ªåœ¨Android Mçš„åŠ¨æ€æƒé™ä¹‹åï¼Œæœ€è¿‘åˆè·ªåœ¨äº†Android Nçš„<code>StrictMode</code>ä¸Šäº†ã€‚æ‰€ä»¥å•Šï¼Œè¦å¯¹æŠ€æœ¯æŒæœ‰æ•¬ç•çš„æ€åº¦ã€‚<br>åœºæ™¯å¦‚ä¸‹ï¼š<br>æˆ‘å¸å†…éƒ¨å‘˜å·¥ä½¿ç”¨çš„APPéœ€è¦æœ‰åº”ç”¨å†…æ›´æ–°çš„åŠŸèƒ½ï¼Œæ„æ€å°±æ˜¯åœ¨åº”ç”¨å†…ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„åº”ç”¨å¹¶ä¸”è°ƒèµ·å®‰è£…ç•Œé¢ã€‚<br>æ–¹æ¡ˆï¼šç”±äºæ¯æ¬¡ä»æ–°æ‰“å¼€appéƒ½éœ€è¦é‡æ–°ç™»å½•ï¼Œé‚£å°±åœ¨ç™»å½•ç•Œé¢åŠ ä¸Šæ£€æŸ¥æ›´æ–°çš„æ¥å£è¯·æ±‚ï¼Œåå°å¯¹æ¯”å½“å‰ç‰ˆæœ¬Appçš„VersionCode å’Œ æ•°æ®åº“å­˜å‚¨çš„VersionCodeå¯¹æ¯”ï¼Œå¦‚æœéœ€è¦æ›´æ–°ï¼Œåˆ™è¿”å›æœ€æ–°ç‰ˆæœ¬è½¯ä»¶çš„ä¸‹è½½åœ°å€ï¼Œå‰ç«¯è¿›è¡Œä¸‹è½½å®‰è£…ã€‚<br>å½“å‰ç«¯è§£æå‡ºä¸‹è½½åœ°å€åï¼Œå¼¹å‡ºæç¤ºæ¡†ï¼Œä¸‹è½½æˆ–è€…å–æ¶ˆã€‚ç‚¹å‡»ä¸‹è½½åˆ™å¼€å¯çº¿ç¨‹ä¸‹è½½ï¼ŒåŒæ—¶åœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºä¸‹è½½è¿›åº¦ï¼Œä¸‹è½½å®Œæˆåï¼Œè°ƒèµ·å®‰è£…ç•Œé¢è¿›è¡Œå®‰è£…ã€‚<br>ä»£ç å¾ˆç®€å•ï¼Œè¿™é‡Œæ”¾å‡ºä¸æ¶‰åŠæˆ‘å¸ä¸šåŠ¡çš„ä»£ç ï¼š</p><span id="more"></span><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">downLoadAPK</span><span class="hljs-params">()</span> &#123;<br>        downLoadThread = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(downLoadUrl);<br><br>                    <span class="hljs-type">HttpURLConnection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> (HttpURLConnection) url<br>                            .openConnection();<br>                    conn.connect();<br>                    <span class="hljs-type">int</span> <span class="hljs-variable">length</span> <span class="hljs-operator">=</span> conn.getContentLength();<br>                    <span class="hljs-type">InputStream</span> <span class="hljs-variable">is</span> <span class="hljs-operator">=</span> conn.getInputStream();<br><br>                    <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;&quot;</span>);<br>                    <span class="hljs-keyword">if</span> (!file.exists()) &#123;<br>                        file.mkdir();<br>                    &#125;<br>                    <span class="hljs-type">File</span> <span class="hljs-variable">apkFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(saveFilePath);<br>                    <span class="hljs-keyword">if</span> (apkFile.exists()) &#123;<br>                        apkFile.delete();<br>                    &#125;<br>                    <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(apkFile);<br><br>                    <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>                    <span class="hljs-type">byte</span> buf[] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>];<br><br>                    <span class="hljs-comment">// ç‚¹å‡»å–æ¶ˆå°±åœæ­¢ä¸‹è½½.</span><br>                    <span class="hljs-keyword">while</span> (!interceptFlag) &#123;<br>                        <span class="hljs-type">int</span> <span class="hljs-variable">numread</span> <span class="hljs-operator">=</span> is.read(buf);<br>                        count += numread;<br>                        progress = (<span class="hljs-type">int</span>) (((<span class="hljs-type">float</span>) count / length) * <span class="hljs-number">100</span>);<br>                        <span class="hljs-comment">// æ›´æ–°è¿›åº¦</span><br>                        getHandler().sendEmptyMessage(DOWN_UPDATE);<br>                        <span class="hljs-keyword">if</span> (numread &lt;= <span class="hljs-number">0</span>) &#123;<br>                            <span class="hljs-comment">// ä¸‹è½½å®Œæˆé€šçŸ¥å®‰è£…</span><br>                            getHandler().sendEmptyMessage(DOWN_OVER);<br>                            interceptFlag = <span class="hljs-literal">false</span>;<br>                        &#125;<br>                        fos.write(buf, <span class="hljs-number">0</span>, numread);<br>                    &#125;<br>                    fos.close();<br>                    is.close();<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br><br>            &#125;<br>        &#125;);<br>        downLoadThread.start();<br>    &#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šä¸ºä¸‹è½½æ–‡ä»¶çš„ä»£ç ï¼Œé€»è¾‘å¾ˆç®€å•ï¼Œèµ·ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œä½¿ç”¨HttpURLConnectionè¿›è¡Œæ–‡ä»¶ä¸‹è½½ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">installAPK</span><span class="hljs-params">(String filePath)</span> &#123;<br>    <span class="hljs-type">File</span> <span class="hljs-variable">apkFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(filePath);<br>    <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(Intent.ACTION_VIEW);<br>    <span class="hljs-keyword">if</span> (!apkFile.exists()) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    intent.setDataAndType(Uri.fromFile(apkFile), <span class="hljs-string">&quot;application/vnd.android.package-archive&quot;</span>);<br>    context.startActivity(intent);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç æ˜¯åˆšå¼€å§‹å†™çš„å®‰è£…è½¯ä»¶çš„ä»£ç ï¼Œåœ¨Android N ä»¥ä¸‹è¿è¡Œæ­£å¸¸ï¼Œä½†æ˜¯åœ¨Android Nä¸Šå´çˆ†å‡ºäº†å¦‚ä¸‹é”™è¯¯ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java">android.os.FileUriExposedException: file: exposed beyond app through Intent.getData()<br>at android.os.StrictMode.onFileUriExposed(StrictMode.java:<span class="hljs-number">1799</span>)<br>at android.net.Uri.checkFileUriExposed(Uri.java:<span class="hljs-number">2346</span>)<br>at android.content.Intent.prepareToLeaveProcess(Intent.java:<span class="hljs-number">8949</span>)<br>at android.content.Intent.prepareToLeaveProcess(Intent.java:<span class="hljs-number">8908</span>)<br>at android.app.Instrumentation.execStartActivity(Instrumentation.java:<span class="hljs-number">1519</span>)<br>at android.app.ContextImpl.startActivity(ContextImpl.java:<span class="hljs-number">829</span>)<br>at android.app.ContextImpl.startActivity(ContextImpl.java:<span class="hljs-number">806</span>)<br>at android.content.ContextWrapper.startActivity(ContextWrapper.java:<span class="hljs-number">366</span>)<br>at com.mmuu.travel.service.ui.LoginFrg.installAPK(LoginFrg.java:<span class="hljs-number">349</span>)<br>at com.mmuu.travel.service.ui.LoginFrg.access$<span class="hljs-number">200</span>(LoginFrg.java:<span class="hljs-number">66</span>)<br>at com.mmuu.travel.service.ui.LoginFrg$<span class="hljs-number">1.</span>onFinish(LoginFrg.java:<span class="hljs-number">134</span>)<br>at android.os.CountDownTimer$<span class="hljs-number">1.</span>handleMessage(CountDownTimer.java:<span class="hljs-number">127</span>)<br>at android.os.Handler.dispatchMessage(Handler.java:<span class="hljs-number">102</span>)<br>at android.os.Looper.loop(Looper.java:<span class="hljs-number">154</span>)<br>at android.app.ActivityThread.main(ActivityThread.java:<span class="hljs-number">6114</span>)<br>at java.lang.reflect.Method.invoke(Native Method)<br>at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:<span class="hljs-number">874</span>)<br>at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:<span class="hljs-number">764</span>)<br></code></pre></td></tr></table></figure><p>ç½‘ä¸Šæœäº†ä¸€ä¸‹ï¼Œæ˜¯Android Nåœ¨æƒé™ä¸Šåšäº†ä¸€äº›ä¿®æ”¹ï¼š<a href="https://developer.android.google.cn/about/versions/nougat/android-7.0-changes.html">å‚è€ƒé“¾æ¥</a> <a href="https://developer.android.google.cn/about/versions/nougat/android-7.0-changes.html">https://developer.android.google.cn/about/versions/nougat/android-7.0-changes.html</a></p><blockquote><p>ç³»ç»Ÿæƒé™æ›´æ”¹<br>ä¸ºäº†æé«˜ç§æœ‰æ–‡ä»¶çš„å®‰å…¨æ€§ï¼Œé¢å‘ Android 7.0 æˆ–æ›´é«˜ç‰ˆæœ¬çš„åº”ç”¨ç§æœ‰ç›®å½•è¢«é™åˆ¶è®¿é—®ã€€(0700)ã€‚æ­¤è®¾ç½®å¯é˜²æ­¢ç§æœ‰æ–‡ä»¶çš„å…ƒæ•°æ®æ³„æ¼ï¼Œå¦‚å®ƒä»¬çš„å¤§å°æˆ–å­˜åœ¨æ€§ã€‚æ­¤æƒé™æ›´æ”¹æœ‰å¤šé‡å‰¯ä½œç”¨ï¼š<br>ç§æœ‰æ–‡ä»¶çš„æ–‡ä»¶æƒé™ä¸åº”å†ç”±æ‰€æœ‰è€…æ”¾å®½ï¼Œä¸ºä½¿ç”¨ MODE_WORLD_READABLE å’Œ&#x2F;æˆ– MODE_WORLD_WRITEABLE è€Œè¿›è¡Œçš„æ­¤ç±»å°è¯•å°†è§¦å‘ SecurityExceptionã€‚</p><blockquote><p>æ³¨ï¼šè¿„ä»Šä¸ºæ­¢ï¼Œè¿™ç§é™åˆ¶å°šä¸èƒ½å®Œå…¨æ‰§è¡Œã€‚åº”ç”¨ä»å¯èƒ½ä½¿ç”¨åŸç”Ÿ API æˆ– File API æ¥ä¿®æ”¹å®ƒä»¬çš„ç§æœ‰ç›®å½•æƒé™ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¼ºçƒˆåå¯¹æ”¾å®½ç§æœ‰ç›®å½•çš„æƒé™ã€‚</p></blockquote></blockquote><blockquote><p>ä¼ é€’è½¯ä»¶åŒ…ç½‘åŸŸå¤–çš„ file:&#x2F;&#x2F; URI å¯èƒ½ç»™æ¥æ”¶å™¨ç•™ä¸‹æ— æ³•è®¿é—®çš„è·¯å¾„ã€‚å› æ­¤ï¼Œå°è¯•ä¼ é€’ file:&#x2F;&#x2F; URI ä¼šè§¦å‘ FileUriExposedExceptionã€‚åˆ†äº«ç§æœ‰æ–‡ä»¶å†…å®¹çš„æ¨èæ–¹æ³•æ˜¯ä½¿ç”¨ FileProviderã€‚<br>DownloadManager ä¸å†æŒ‰æ–‡ä»¶ååˆ†äº«ç§äººå­˜å‚¨çš„æ–‡ä»¶ã€‚æ—§ç‰ˆåº”ç”¨åœ¨è®¿é—® COLUMN_LOCAL_FILENAME æ—¶å¯èƒ½å‡ºç°æ— æ³•è®¿é—®çš„è·¯å¾„ã€‚é¢å‘ Android 7.0 æˆ–æ›´é«˜ç‰ˆæœ¬çš„åº”ç”¨åœ¨å°è¯•è®¿é—® COLUMN_LOCAL_FILENAME æ—¶ä¼šè§¦å‘ SecurityExceptionã€‚é€šè¿‡ä½¿ç”¨ DownloadManager.Request.setDestinationInExternalFilesDir() æˆ– DownloadManager.Request.setDestinationInExternalPublicDir() å°†ä¸‹è½½ä½ç½®è®¾ç½®ä¸ºå…¬å…±ä½ç½®çš„æ—§ç‰ˆåº”ç”¨ä»å¯ä»¥è®¿é—® COLUMN_LOCAL_FILENAME ä¸­çš„è·¯å¾„ï¼Œä½†æ˜¯æˆ‘ä»¬å¼ºçƒˆåå¯¹ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚å¯¹äºç”± DownloadManager å…¬å¼€çš„æ–‡ä»¶ï¼Œé¦–é€‰çš„è®¿é—®æ–¹å¼æ˜¯ä½¿ç”¨ContentResolver.openFileDescriptor()ã€‚</p></blockquote><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>FileProvider<br>1.1 åœ¨mainfestä¸­åŠ å…¥FileProvideræ³¨å†Œ<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">application</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">provider</span></span><br><span class="hljs-tag">         <span class="hljs-attr">android:authorities</span>=<span class="hljs-string">&quot;ä½ çš„åº”ç”¨å.fileprovider&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.support.v4.content.FileProvider&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">android:grantUriPermissions</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">android:exported</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">meta-data</span></span><br><span class="hljs-tag">           <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.support.FILE_PROVIDER_PATHS&quot;</span></span><br><span class="hljs-tag">           <span class="hljs-attr">android:resource</span>=<span class="hljs-string">&quot;@xml/filepaths&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">provider</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">application</span>&gt;</span><br></code></pre></td></tr></table></figure>1.2 åœ¨<code>res</code>æ–‡ä»¶å¤¹ä¸‹æ–°å»º<code>xml</code>æ–‡ä»¶å¤¹ï¼Œåœ¨<code>xml</code>æ–‡ä»¶å¤¹ä¸­æ–°å»º<code>filepaths</code>æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åå­—å’Œä¸Šé¢çš„ Android:resourceåé¢çš„åå­—è¦ä¸€è‡´<br>ç¼–è¾‘è¯¥æ–‡ä»¶ï¼š<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">paths</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">external-path</span></span><br><span class="hljs-tag">        <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;external_storage_root&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">paths</span>&gt;</span><br></code></pre></td></tr></table></figure>1.3 ä¿®æ”¹å®‰è£…ä»£ç <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">installAPK</span><span class="hljs-params">(String filePath)</span> &#123;<br>        <span class="hljs-type">File</span> <span class="hljs-variable">apkFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(filePath);<br>        <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(Intent.ACTION_VIEW);<br>        <span class="hljs-keyword">if</span> (!apkFile.exists()) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;<br>            intent.setFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);<br>            <span class="hljs-type">Uri</span> <span class="hljs-variable">contentUri</span> <span class="hljs-operator">=</span> FileProvider.getUriForFile(context, BuildConfig.APPLICATION_ID + <span class="hljs-string">&quot;.fileProvider&quot;</span>, apkFile);<br>            intent.setDataAndType(contentUri, <span class="hljs-string">&quot;application/vnd.android.package-archive&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            intent.setDataAndType(Uri.fromFile(apkFile), <span class="hljs-string">&quot;application/vnd.android.package-archive&quot;</span>);<br>        &#125;<br>        getActivity().getApplicationContext().startActivity(intent);<br>        context.finish();<br>    &#125;<br></code></pre></td></tr></table></figure>é¦–å…ˆåˆ¤æ–­è®¾å¤‡çš„Androidç‰ˆæœ¬ï¼ŒNæˆ–è€…Nä»¥ä¸Šä½¿ç”¨<code>FileProvider</code>è¿›è¡Œå®‰è£…ï¼ŒNä¸€ä¸‹è¿˜æ˜¯åŸæ¥çš„æ–¹å¼ã€‚æ³¨æ„è°ƒç”¨startActivityè¦ä½¿ç”¨ApplicationContextï¼Œä½¿ç”¨Activity.thisä¼šæŠ¥é”™ã€‚</li><li>ä½¿ç”¨DownloadManager<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApkDownLoad</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DOWNLOAD_FOLDER_NAME</span> <span class="hljs-operator">=</span> getLocalForderPath();<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DOWNLOAD_FILE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;XXX.apk&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">APK_DOWNLOAD_ID</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;apkDownloadId&quot;</span>;<br>    <span class="hljs-keyword">private</span> Context context;<br>    <span class="hljs-keyword">private</span> String url;<br>    <span class="hljs-keyword">private</span> String notificationTitle;<br>    <span class="hljs-keyword">private</span> String notificationDescription;<br><br>    <span class="hljs-keyword">private</span> DownloadManager downloadManager;<br>    <span class="hljs-keyword">private</span> CompleteReceiver completeReceiver;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> context</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> url                     ä¸‹è½½apkçš„url</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> notificationTitle       é€šçŸ¥æ æ ‡é¢˜</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> notificationDescription é€šçŸ¥æ æè¿°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ApkDownLoad</span><span class="hljs-params">(Context context, String url, String notificationTitle,</span><br><span class="hljs-params">                       String notificationDescription)</span> &#123;<br>        <span class="hljs-built_in">super</span>();<br>        <span class="hljs-built_in">this</span>.context = context;<br>        <span class="hljs-built_in">this</span>.url = url;<br>        <span class="hljs-built_in">this</span>.notificationTitle = notificationTitle;<br>        <span class="hljs-built_in">this</span>.notificationDescription = notificationDescription;<br>        downloadManager = (DownloadManager) context<br>                .getSystemService(Context.DOWNLOAD_SERVICE);<br>        completeReceiver = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompleteReceiver</span>();<br><br>        <span class="hljs-comment">/** register download success broadcast **/</span><br>        context.registerReceiver(completeReceiver, <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntentFilter</span>(<br>                DownloadManager.ACTION_DOWNLOAD_COMPLETE));<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> &#123;<br><br>        <span class="hljs-comment">// æ¸…é™¤å·²ä¸‹è½½çš„å†…å®¹é‡æ–°ä¸‹è½½</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">downloadId</span> <span class="hljs-operator">=</span> UpdateUtils.getLong(context, APK_DOWNLOAD_ID);<br>        <span class="hljs-keyword">if</span> (downloadId != -<span class="hljs-number">1</span>) &#123;<br>            downloadManager.remove(downloadId);<br>            UpdateUtils.removeSharedPreferenceByKey(context, APK_DOWNLOAD_ID);<br>        &#125;<br>        <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>(Uri.parse(url));<br>        <span class="hljs-comment">// è®¾ç½®Notificationä¸­æ˜¾ç¤ºçš„æ–‡å­—</span><br>        request.setTitle(notificationTitle);<br>        request.setDescription(notificationDescription);<br>        <span class="hljs-comment">// è®¾ç½®å¯ç”¨çš„ç½‘ç»œç±»å‹</span><br>        request.setAllowedNetworkTypes(Request.NETWORK_MOBILE<br>                | Request.NETWORK_WIFI);<br>        <span class="hljs-comment">// è®¾ç½®çŠ¶æ€æ ä¸­æ˜¾ç¤ºNotification</span><br>        request.setNotificationVisibility(DownloadManager.Request.VISIBILITY_VISIBLE_NOTIFY_COMPLETED);<br>        <span class="hljs-comment">// ä¸æ˜¾ç¤ºä¸‹è½½ç•Œé¢</span><br>        request.setVisibleInDownloadsUi(<span class="hljs-literal">false</span>);<br>        <span class="hljs-comment">// è®¾ç½®ä¸‹è½½åæ–‡ä»¶å­˜æ”¾çš„ä½ç½®</span><br>        <span class="hljs-type">File</span> <span class="hljs-variable">folder</span> <span class="hljs-operator">=</span> Environment<br>                .getExternalStoragePublicDirectory(DOWNLOAD_FOLDER_NAME);<br>        <span class="hljs-keyword">if</span> (!folder.exists() || !folder.isDirectory()) &#123;<br>            folder.mkdirs();<br>        &#125;<br>        <span class="hljs-comment">// è®¾ç½®ä¸‹è½½æ–‡ä»¶çš„ä¿å­˜è·¯å¾„</span><br>        request.setDestinationInExternalPublicDir(DOWNLOAD_FOLDER_NAME,<br>                DOWNLOAD_FILE_NAME);<br>        <span class="hljs-comment">// è®¾ç½®æ–‡ä»¶ç±»å‹</span><br>        <span class="hljs-type">MimeTypeMap</span> <span class="hljs-variable">mimeTypeMap</span> <span class="hljs-operator">=</span> MimeTypeMap.getSingleton();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">mimeString</span> <span class="hljs-operator">=</span> mimeTypeMap.getMimeTypeFromExtension(MimeTypeMap<br>                .getFileExtensionFromUrl(url));<br>        request.setMimeType(mimeString);<br>        <span class="hljs-comment">// ä¿å­˜è¿”å›å”¯ä¸€çš„downloadId</span><br>        UpdateUtils.putLong(context, APK_DOWNLOAD_ID,<br>                downloadManager.enqueue(request));<br>    &#125;<br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">CompleteReceiver</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BroadcastReceiver</span> &#123;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> &#123;<br>            <span class="hljs-comment">/**</span><br><span class="hljs-comment">             * get the id of download which have download success, if the id is</span><br><span class="hljs-comment">             * my id and it&#x27;s status is successful, then install it</span><br><span class="hljs-comment">             **/</span><br>            <span class="hljs-type">long</span> <span class="hljs-variable">completeDownloadId</span> <span class="hljs-operator">=</span> intent.getLongExtra(<br>                    DownloadManager.EXTRA_DOWNLOAD_ID, <span class="hljs-number">0</span>);<br>            <span class="hljs-type">long</span> <span class="hljs-variable">downloadId</span> <span class="hljs-operator">=</span> UpdateUtils.getLong(context, APK_DOWNLOAD_ID);<br><br>            <span class="hljs-keyword">if</span> (completeDownloadId == downloadId) &#123;<br><br>                <span class="hljs-comment">// if download successful</span><br>                <span class="hljs-keyword">if</span> (queryDownloadStatus(downloadManager, downloadId) == DownloadManager.STATUS_SUCCESSFUL) &#123;<br><br>                    <span class="hljs-comment">// clear downloadId</span><br>                    UpdateUtils.removeSharedPreferenceByKey(context,<br>                            APK_DOWNLOAD_ID);<br><br>                    <span class="hljs-comment">// unregisterReceiver</span><br>                    context.unregisterReceiver(completeReceiver);<br><br>                    <span class="hljs-comment">// install apk</span><br>                    <span class="hljs-type">String</span> <span class="hljs-variable">apkFilePath</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(Environment<br>                            .getExternalStorageDirectory().getAbsolutePath())<br>                            .append(File.separator)<br>                            .append(DOWNLOAD_FOLDER_NAME)<br>                            .append(File.separator).append(DOWNLOAD_FILE_NAME)<br>                            .toString();<br>                    install(context, apkFilePath);<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æŸ¥è¯¢ä¸‹è½½çŠ¶æ€</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">queryDownloadStatus</span><span class="hljs-params">(DownloadManager downloadManager,</span><br><span class="hljs-params">                                          <span class="hljs-type">long</span> downloadId)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;<br>        DownloadManager.<span class="hljs-type">Query</span> <span class="hljs-variable">query</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DownloadManager</span>.Query()<br>                .setFilterById(downloadId);<br>        <span class="hljs-type">Cursor</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            c = downloadManager.query(query);<br>            <span class="hljs-keyword">if</span> (c != <span class="hljs-literal">null</span> &amp;&amp; c.moveToFirst()) &#123;<br>                result = c.getInt(c<br>                        .getColumnIndex(DownloadManager.COLUMN_STATUS));<br>            &#125;<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">if</span> (c != <span class="hljs-literal">null</span>) &#123;<br>                c.close();<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * install app</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> context</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> filePath</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> whether apk exist</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">install</span><span class="hljs-params">(Context context, String filePath)</span> &#123;<br>        <span class="hljs-type">Intent</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(Intent.ACTION_VIEW);<br>        <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(filePath);<br>        <span class="hljs-keyword">if</span> (file != <span class="hljs-literal">null</span> &amp;&amp; file.length() &gt; <span class="hljs-number">0</span> &amp;&amp; file.exists() &amp;&amp; file.isFile()) &#123;<br>            i.setDataAndType(Uri.parse(<span class="hljs-string">&quot;file://&quot;</span> + filePath),<br>                    <span class="hljs-string">&quot;application/vnd.android.package-archive&quot;</span>);<br>            i.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);<br>            context.startActivity(i);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>æ£€æµ‹åˆ°éœ€è¦å‡çº§æ—¶  <code>new ApkDownLoad().execute()</code>å°±å¯ä»¥äº†ï¼Œå…¶ä¸­<code>UpdateUtils.getLong()</code>æ˜¯ä¸€ä¸ª<code>SharedPreferences</code>å°è£…ã€‚</li></ol><hr><h2 id="ä»¥ä¸Šä¸¤ç§æ–¹å¼åœ¨å°ç±³5Android-N-ä¸Šå®æµ‹æœ‰æ•ˆ"><a href="#ä»¥ä¸Šä¸¤ç§æ–¹å¼åœ¨å°ç±³5Android-N-ä¸Šå®æµ‹æœ‰æ•ˆ" class="headerlink" title="ä»¥ä¸Šä¸¤ç§æ–¹å¼åœ¨å°ç±³5Android N ä¸Šå®æµ‹æœ‰æ•ˆ"></a>ä»¥ä¸Šä¸¤ç§æ–¹å¼åœ¨å°ç±³5Android N ä¸Šå®æµ‹æœ‰æ•ˆ</h2><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Androidçˆ¬å‘ä¹‹æ—…</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JVMå†…å­˜åŒºåŸŸ</title>
    <link href="/2017/03/27/JVM%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F/"/>
    <url>/2017/03/27/JVM%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F/</url>
    
    <content type="html"><![CDATA[<p>ã€€ã€€Javaè™šæ‹Ÿæœºåœ¨æ‰§è¡ŒJavaç¨‹åºçš„è¿‡ç¨‹ä¸­ä¼šæŠŠå®ƒæ‰€ç®¡ç†çš„å†…å­˜åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºåŸŸ.è¿™äº›åŒºåŸŸéƒ½æœ‰å„è‡ªçš„ç”¨é€”,ä»¥åŠåˆ›å»ºå’Œé”€æ¯çš„æ—¶é—´.æœ‰çš„åŒºåŸŸéšç€è™šæ‹Ÿæœºè¿›ç¨‹çš„å¯åŠ¨è€Œå­˜åœ¨,æœ‰äº›åŒºåŸŸåˆ™ä¾èµ–ç”¨æˆ·çº¿ç¨‹çš„å¯åŠ¨å’Œç»“æŸè€Œå»ºç«‹å’Œé”€æ¯.æ ¹æ®ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒ(JavaSE 7ç‰ˆ)ã€‹çš„è§„å®š,Javaè™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜å°†ä¼šåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªè¿è¡Œæ—¶æ•°æ®åŒºåŸŸ.å¦‚ä¸‹æ‰€ç¤º:<br><img src="/image/JVM/JVM_RunTime_Area.png" alt="JVMå†…å­˜åŒºåŸŸ"></p><span id="more"></span><h3 id="ç¨‹åºè®¡æ•°å™¨"><a href="#ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨"></a>ç¨‹åºè®¡æ•°å™¨</h3><p>ã€€ã€€<code>ç¨‹åºè®¡æ•°å™¨</code>(Program Counter Register)æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´,å®ƒå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨.åœ¨è™šæ‹Ÿæœºçš„æ¦‚å¿µæ¨¡å‹é‡Œ(ä»…æ˜¯æ¦‚å¿µæ¨¡å‹,å„ç§è™šæ‹Ÿæœºå¯èƒ½ä¼šé€šè¿‡ä¸€äº›æ›´é«˜æ•ˆçš„æ–¹å¼å»å®ç°),å­—èŠ‚ç è§£é‡Šå™¨å·¥ä½œæ—¶å°±æ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤,åˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆ.<br>ç”±äºJavaè™šæ‹Ÿæœºçš„å¤šçº¿ç¨‹æ˜¯é€šè¿‡çº¿ç¨‹è½®æµåˆ‡æ¢å¹¶åˆ†é…å¤„ç†å™¨æ‰§è¡Œæ—¶é—´çš„æ–¹å¼æ¥å®ç°çš„,åœ¨ä»»ä½•ä¸€ä¸ªç¡®å®šçš„æ—¶åˆ»,ä¸€ä¸ªå¤„ç†å™¨(å¯¹äºå¤šæ ¸å¤„ç†å™¨æ¥è¯´æ˜¯ä¸€ä¸ªå†…æ ¸)éƒ½åªä¼šæ‰§è¡Œä¸€æ¡çº¿ç¨‹ä¸­çš„æŒ‡ä»¤.å› æ­¤,ä¸ºäº†çº¿ç¨‹åˆ‡æ¢åèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®,æ¯æ¡çº¿ç¨‹éƒ½éœ€è¦æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨,å„æ¡çº¿ç¨‹ä¹‹é—´è®¡æ•°å™¨äº’ä¸å½±å“,ç‹¬ç«‹å­˜å‚¨,æˆ‘ä»¬ç§°è¿™ç±»å†…å­˜åŒºåŸŸä¸ºâ€çº¿ç¨‹ç§æœ‰â€çš„å†…å­˜.å¦‚æœçº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ˜¯ä¸€ä¸ªJavaæ–¹æ³•,è¿™ä¸ªè®¡æ•°å™¨è®°å½•çš„æ˜¯æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€;å¦‚æœæ­£åœ¨æ‰§è¡Œçš„æ˜¯Nativeæ–¹æ³•,è¿™ä¸ªè®¡æ•°å™¨å€¼åˆ™ä¸ºç©º(Undefined).æ­¤å†…å­˜åŒºåŸŸæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­æ²¡æœ‰è§„å®šä»»ä½•<code>OutOfMemoryError</code>æƒ…å†µçš„åŒºåŸŸ.</p><h3 id="Javaè™šæ‹Ÿæœºæ ˆ"><a href="#Javaè™šæ‹Ÿæœºæ ˆ" class="headerlink" title="Javaè™šæ‹Ÿæœºæ ˆ"></a>Javaè™šæ‹Ÿæœºæ ˆ</h3><p>ã€€ã€€ä¸ç¨‹åºè®¡æ•°å™¨ä¸€æ ·,Javaè™šæ‹Ÿæœºæ ˆ(Java Virtual Machine Stacks)ä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„,å®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒ.è™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹:æ¯ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§(Stack Frame)ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯.æ¯ä¸€ä¸ªæ–¹æ³•ä»è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹,å°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹.ç»å¸¸æœ‰äººæŠŠJavaå†…å­˜åŒºåˆ†ä¸ºå †å†…å­˜(Heap)å’Œæ ˆå†…å­˜(Stack),è¿™ç§åˆ†æ³•æ¯”è¾ƒç²—ç³™,Javaå†…å­˜åŒºåŸŸçš„åˆ’åˆ†å®é™…ä¸Šè¿œæ¯”è¿™å¤æ‚. è¿™ç§åˆ’åˆ†æ–¹å¼çš„æµè¡Œåªèƒ½è¯´æ˜å¤§å¤šæ•°ç¨‹åºå‘˜æœ€å…³æ³¨çš„ã€ä¸å¯¹è±¡å†…å­˜åˆ†é…å…³ç³»æœ€å¯†åˆ‡çš„å†…å­˜åŒºåŸŸæ˜¯è¿™ä¸¤å—.æ‰€æŒ‡çš„â€æ ˆâ€å°±æ˜¯ç°åœ¨è®²çš„è™šæ‹Ÿæœºæ ˆ,æˆ–è€…è¯´æ˜¯è™šæ‹Ÿæœºæ ˆä¸­å±€éƒ¨å˜é‡è¡¨éƒ¨åˆ†.å±€éƒ¨å˜é‡è¡¨å­˜æ”¾äº†ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§åŸºæœ¬æ•°æ®ç±»å‹(booleanã€byteã€charã€shortã€intã€floatã€longã€double)ã€å¯¹è±¡å¼•ç”¨(referenceç±»å‹,å®ƒä¸ç­‰åŒäºå¯¹è±¡æœ¬èº«,å¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„å¼•ç”¨æŒ‡é’ˆ,ä¹Ÿå¯èƒ½æ˜¯æŒ‡å‘ä¸€ä¸ªä»£è¡¨å¯¹è±¡çš„å¥æŸ„æˆ–å…¶ä»–ä¸æ­¤å¯¹è±¡ç›¸å…³çš„ä½ç½®)å’ŒreturnAddressç±»å‹(æŒ‡å‘äº†ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€).å…¶ä¸­64ä½é•¿åº¦çš„longå’Œdoubleç±»å‹çš„æ•°æ®ä¼šå ç”¨2ä¸ªå±€éƒ¨å˜é‡ç©ºé—´(Slot),å…¶ä½™çš„æ•°æ®ç±»å‹åªå ç”¨1ä¸ª. å±€éƒ¨å˜é‡è¡¨æ‰€éœ€çš„å†…å­˜ç©ºé—´åœ¨ç¼–è¯‘æœŸé—´å®Œæˆåˆ†é…,å½“è¿›å…¥ä¸€ä¸ªæ–¹æ³•æ—¶,è¿™ä¸ªæ–¹æ³•éœ€è¦åœ¨å¸§ä¸­åˆ†é…å¤šå¤§çš„å±€éƒ¨å˜é‡ç©ºé—´æ˜¯å®Œå…¨ç¡®å®šçš„,åœ¨æ–¹æ³•è¿è¡ŒæœŸé—´ä¸ä¼šæ”¹å˜å±€éƒ¨å˜é‡è¡¨çš„å¤§å°.åœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­,å¯¹è¿™ä¸ªåŒºåŸŸè§„å®šäº†ä¸¤ç§å¼‚å¸¸çŠ¶å†µ:å¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æ·±åº¦,å°†æŠ›å‡º<code>StackOverflowError</code>å¼‚å¸¸;å¦‚æœè™šæ‹Ÿæœºæ ˆå¯ä»¥åŠ¨æ€æ‰©å±•(å½“å‰å¤§éƒ¨åˆ†çš„Javaè™šæ‹Ÿæœºéƒ½å¯åŠ¨æ€æ‰©å±•,åªä¸è¿‡Javaè™šæ‹Ÿæœºè§„èŒƒä¸­ä¹Ÿå…è®¸å›ºå®šé•¿åº¦çš„è™šæ‹Ÿæœºæ ˆ),å¦‚æœæ‰©å±•æ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜,å°±ä¼šæŠ›å‡º<code>OutOfMemoryError</code>å¼‚å¸¸.</p><h3 id="æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ ˆ"></a>æœ¬åœ°æ–¹æ³•æ ˆ</h3><p>ã€€ã€€æœ¬åœ°æ–¹æ³•æ ˆ(Native Method Stack)ä¸è™šæ‹Ÿæœºæ ˆæ‰€å‘æŒ¥çš„ä½œç”¨æ˜¯éå¸¸ç›¸ä¼¼çš„,å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ä¸è¿‡æ˜¯è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡ŒJavaæ–¹æ³•(ä¹Ÿå°±æ˜¯å­—èŠ‚ç )æœåŠ¡,è€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„Nativeæ–¹æ³•æœåŠ¡. åœ¨è™šæ‹Ÿæœºè§„èŒƒä¸­å¯¹æœ¬åœ°æ–¹æ³•æ ˆä¸­æ–¹æ³•ä½¿ç”¨çš„è¯­è¨€ã€ ä½¿ç”¨æ–¹å¼ä¸æ•°æ®ç»“æ„å¹¶æ²¡æœ‰å¼ºåˆ¶è§„å®š,å› æ­¤å…·ä½“çš„è™šæ‹Ÿæœºå¯ä»¥è‡ªç”±å®ç°å®ƒ. ç”šè‡³æœ‰çš„è™šæ‹Ÿæœº(è­¬å¦‚Sun HotSpotè™šæ‹Ÿæœº)ç›´æ¥å°±æŠŠæœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€. ä¸è™šæ‹Ÿæœºæ ˆä¸€æ ·,æœ¬åœ°æ–¹æ³•æ ˆåŒºåŸŸä¹Ÿä¼šæŠ›å‡º<code>StackOverflowError</code>å’Œ<code>OutOfMemoryError</code>å¼‚å¸¸.</p><h3 id="Javaå †"><a href="#Javaå †" class="headerlink" title="Javaå †"></a>Javaå †</h3><p>ã€€ã€€å¯¹äºå¤§å¤šæ•°åº”ç”¨æ¥è¯´,Javaå †(Java Heap)æ˜¯Javaè™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—.Javaå †æ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸ,åœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»º.æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹,å‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜.è¿™ä¸€ç‚¹åœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­çš„æè¿°æ˜¯:æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½è¦åœ¨å †ä¸Šåˆ†é…,ä½†æ˜¯éšç€JITç¼–è¯‘å™¨çš„å‘å±•ä¸é€ƒé€¸åˆ†ææŠ€æœ¯é€æ¸æˆç†Ÿ,æ ˆä¸Šåˆ†é…ã€æ ‡é‡æ›¿æ¢ä¼˜åŒ–æŠ€æœ¯å°†ä¼šå¯¼è‡´ä¸€äº›å¾®å¦™çš„å˜åŒ–å‘ç”Ÿ,æ‰€æœ‰çš„å¯¹è±¡éƒ½åˆ†é…åœ¨å †ä¸Šä¹Ÿæ¸æ¸å˜å¾—ä¸æ˜¯é‚£ä¹ˆâ€ç»å¯¹â€äº†.Javaå †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸ,å› æ­¤å¾ˆå¤šæ—¶å€™ä¹Ÿè¢«ç§°åšâ€GCå †â€(Garbage Collected Heap).ä»å†…å­˜å›æ”¶çš„è§’åº¦æ¥çœ‹,ç”±äºç°åœ¨æ”¶é›†å™¨åŸºæœ¬éƒ½é‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•,æ‰€ä»¥Javaå †ä¸­è¿˜å¯ä»¥ç»†åˆ†ä¸º:æ–°ç”Ÿä»£å’Œè€å¹´ä»£;å†ç»†è‡´ä¸€ç‚¹çš„æœ‰Edenç©ºé—´ã€From Survivorç©ºé—´ã€To Survivorç©ºé—´ç­‰.ä»å†…å­˜åˆ†é…çš„è§’åº¦æ¥çœ‹,çº¿ç¨‹å…±äº«çš„Javaå †ä¸­å¯èƒ½åˆ’åˆ†å‡ºå¤šä¸ªçº¿ç¨‹ç§æœ‰çš„åˆ†é…ç¼“å†²åŒº(Thread Local Allocation Buffer,TLAB).ä¸è¿‡æ— è®ºå¦‚ä½•åˆ’åˆ†,éƒ½ä¸å­˜æ”¾å†…å®¹æ— å…³,æ— è®ºå“ªä¸ªåŒºåŸŸ,å­˜å‚¨çš„éƒ½ä»ç„¶æ˜¯å¯¹è±¡å®ä¾‹,è¿›ä¸€æ­¥åˆ’åˆ†çš„ç›®çš„æ˜¯ä¸ºäº†æ›´å¥½åœ°å›æ”¶å†…å­˜,æˆ–è€…æ›´å¿«åœ°åˆ†é…å†…å­˜.æ ¹æ®Javaè™šæ‹Ÿæœºè§„èŒƒçš„è§„å®š,Javaå †å¯ä»¥å¤„äºç‰©ç†ä¸Šä¸è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­,åªè¦é€»è¾‘ä¸Šæ˜¯è¿ç»­çš„å³å¯,å°±åƒæˆ‘ä»¬çš„ç£ç›˜ç©ºé—´ä¸€æ ·.åœ¨å®ç°æ—¶,æ—¢å¯ä»¥å®ç°æˆå›ºå®šå¤§å°çš„,ä¹Ÿå¯ä»¥æ˜¯å¯æ‰©å±•çš„,ä¸è¿‡å½“å‰ä¸»æµçš„è™šæ‹Ÿæœºéƒ½æ˜¯æŒ‰ç…§å¯æ‰©å±•æ¥å®ç°çš„(é€šè¿‡-Xmxå’Œ-Xmsæ§åˆ¶). å¦‚æœåœ¨å †ä¸­æ²¡æœ‰å†…å­˜å®Œæˆå®ä¾‹åˆ†é…,å¹¶ä¸”å †ä¹Ÿæ— æ³•å†æ‰©å±•æ—¶,å°†ä¼šæŠ›å‡º<code>OutOfMemoryError</code>å¼‚å¸¸.</p><h3 id="æ–¹æ³•åŒº"><a href="#æ–¹æ³•åŒº" class="headerlink" title="æ–¹æ³•åŒº"></a>æ–¹æ³•åŒº</h3><p>ã€€ã€€æ–¹æ³•åŒº(Method Area)ä¸Javaå †ä¸€æ ·,æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸ,å®ƒç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®.è™½ç„¶Javaè™šæ‹Ÿæœºè§„èŒƒæŠŠæ–¹æ³•åŒºæè¿°ä¸ºå †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†,ä½†æ˜¯å®ƒå´æœ‰ä¸€ä¸ªåˆ«åå«åšNon-Heap(éå †),ç›®çš„åº”è¯¥æ˜¯ä¸Javaå †åŒºåˆ†å¼€æ¥.å¯¹äºä¹ æƒ¯åœ¨HotSpotè™šæ‹Ÿæœºä¸Šå¼€å‘ã€ éƒ¨ç½²ç¨‹åºçš„å¼€å‘è€…æ¥è¯´,å¾ˆå¤šäººéƒ½æ›´æ„¿æ„æŠŠæ–¹æ³•åŒºç§°ä¸ºâ€æ°¸ä¹…ä»£â€(Permanent Generation),æœ¬è´¨ä¸Šä¸¤è€…å¹¶ä¸ç­‰ä»·,ä»…ä»…æ˜¯å› ä¸ºHotSpotè™šæ‹Ÿæœºçš„è®¾è®¡å›¢é˜Ÿé€‰æ‹©æŠŠGCåˆ†ä»£æ”¶é›†æ‰©å±•è‡³æ–¹æ³•åŒº,æˆ–è€…è¯´ä½¿ç”¨æ°¸ä¹…ä»£æ¥å®ç°æ–¹æ³•åŒºè€Œå·²,è¿™æ ·HotSpotçš„åƒåœ¾æ”¶é›†å™¨å¯ä»¥åƒç®¡ç†Javaå †ä¸€æ ·ç®¡ç†è¿™éƒ¨åˆ†å†…å­˜,èƒ½å¤Ÿçœå»ä¸“é—¨ä¸ºæ–¹æ³•åŒºç¼–å†™å†…å­˜ç®¡ç†ä»£ç çš„å·¥ä½œ.å¯¹äºå…¶ä»–è™šæ‹Ÿæœº(å¦‚BEA JRockitã€ IBM J9ç­‰)æ¥è¯´æ˜¯ä¸å­˜åœ¨æ°¸ä¹…ä»£çš„æ¦‚å¿µçš„.åŸåˆ™ä¸Š,å¦‚ä½•å®ç°æ–¹æ³•åŒºå±äºè™šæ‹Ÿæœºå®ç°ç»†èŠ‚,ä¸å—è™šæ‹Ÿæœºè§„èŒƒçº¦æŸ,ä½†ä½¿ç”¨æ°¸ä¹…ä»£æ¥å®ç°æ–¹æ³•åŒº,ç°åœ¨çœ‹æ¥å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„,å› ä¸ºè¿™æ ·æ›´å®¹æ˜“é‡åˆ°å†…å­˜æº¢å‡ºé—®é¢˜(æ°¸ä¹…ä»£æœ‰-XX:MaxPermSizeçš„ä¸Šé™,J9å’ŒJRockitåªè¦æ²¡æœ‰è§¦ç¢°åˆ°è¿›ç¨‹å¯ç”¨å†…å­˜çš„ä¸Šé™,ä¾‹å¦‚32ä½ç³»ç»Ÿä¸­çš„4GB,å°±ä¸ä¼šå‡ºç°é—®é¢˜),è€Œä¸”æœ‰æå°‘æ•°æ–¹æ³•(ä¾‹å¦‚String.intern())ä¼šå› è¿™ä¸ªåŸå› å¯¼è‡´ä¸åŒè™šæ‹Ÿæœºä¸‹æœ‰ä¸åŒçš„è¡¨ç°. å› æ­¤,å¯¹äºHotSpotè™šæ‹Ÿæœº,æ ¹æ®å®˜æ–¹å‘å¸ƒçš„è·¯çº¿å›¾ä¿¡æ¯,ç°åœ¨ä¹Ÿæœ‰æ”¾å¼ƒæ°¸ä¹…ä»£å¹¶é€æ­¥æ”¹ä¸ºé‡‡ç”¨Native Memoryæ¥å®ç°æ–¹æ³•åŒºçš„è§„åˆ’äº†,åœ¨ç›®å‰å·²ç»å‘å¸ƒçš„JDK1.7çš„HotSpotä¸­,å·²ç»æŠŠåŸæœ¬æ”¾åœ¨æ°¸ä¹…ä»£çš„å­—ç¬¦ä¸²å¸¸é‡æ± ç§»å‡º.Javaè™šæ‹Ÿæœºè§„èŒƒå¯¹æ–¹æ³•åŒºçš„é™åˆ¶éå¸¸å®½æ¾,é™¤äº†å’ŒJavaå †ä¸€æ ·ä¸éœ€è¦è¿ç»­çš„å†…å­˜å’Œå¯ä»¥é€‰æ‹©å›ºå®šå¤§å°æˆ–è€…å¯æ‰©å±•å¤–,è¿˜å¯ä»¥é€‰æ‹©ä¸å®ç°åƒåœ¾æ”¶é›†.ç›¸å¯¹è€Œè¨€,åƒåœ¾æ”¶é›†è¡Œä¸ºåœ¨è¿™ä¸ªåŒºåŸŸæ˜¯æ¯”è¾ƒå°‘å‡ºç°çš„,ä½†å¹¶éæ•°æ®è¿›å…¥äº†æ–¹æ³•åŒºå°±å¦‚æ°¸ä¹…ä»£çš„åå­—ä¸€æ ·â€æ°¸ä¹…â€å­˜åœ¨äº†.è¿™åŒºåŸŸçš„å†…å­˜å›æ”¶ç›®æ ‡ä¸»è¦æ˜¯é’ˆå¯¹å¸¸é‡æ± çš„å›æ”¶å’Œå¯¹ç±»å‹çš„å¸è½½,ä¸€èˆ¬æ¥è¯´,è¿™ä¸ªåŒºåŸŸçš„å›æ”¶â€æˆç»©â€æ¯”è¾ƒéš¾ä»¥ä»¤äººæ»¡æ„,å°¤å…¶æ˜¯ç±»å‹çš„å¸è½½,æ¡ä»¶ç›¸å½“è‹›åˆ»,ä½†æ˜¯è¿™éƒ¨åˆ†åŒºåŸŸçš„å›æ”¶ç¡®å®æ˜¯å¿…è¦çš„.æ ¹æ®Javaè™šæ‹Ÿæœºè§„èŒƒçš„è§„å®š,å½“æ–¹æ³•åŒºæ— æ³•æ»¡è¶³å†…å­˜åˆ†é…éœ€æ±‚æ—¶,å°†æŠ›å‡º<code>OutOfMemoryError</code>å¼‚å¸¸.</p><h3 id="è¿è¡Œæ—¶å¸¸é‡æ± "><a href="#è¿è¡Œæ—¶å¸¸é‡æ± " class="headerlink" title="è¿è¡Œæ—¶å¸¸é‡æ± "></a>è¿è¡Œæ—¶å¸¸é‡æ± </h3><p>ã€€ã€€è¿è¡Œæ—¶å¸¸é‡æ± (Runtime Constant Pool)æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†. Classæ–‡ä»¶ä¸­é™¤äº†æœ‰ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–,è¿˜æœ‰ä¸€é¡¹ä¿¡æ¯æ˜¯å¸¸é‡æ± (Constant Pool Table),ç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨,è¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åè¿›å…¥æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­å­˜æ”¾.Javaè™šæ‹Ÿæœºå¯¹Classæ–‡ä»¶æ¯ä¸€éƒ¨åˆ†(è‡ªç„¶ä¹ŸåŒ…æ‹¬å¸¸é‡æ± )çš„æ ¼å¼éƒ½æœ‰ä¸¥æ ¼è§„å®š,æ¯ä¸€ä¸ªå­—èŠ‚ç”¨äºå­˜å‚¨å“ªç§æ•°æ®éƒ½å¿…é¡»ç¬¦åˆè§„èŒƒä¸Šçš„è¦æ±‚æ‰ä¼šè¢«è™šæ‹Ÿæœºè®¤å¯ã€è£…è½½å’Œæ‰§è¡Œ,ä½†å¯¹äºè¿è¡Œæ—¶å¸¸é‡æ± ,Javaè™šæ‹Ÿæœºè§„èŒƒæ²¡æœ‰åšä»»ä½•ç»†èŠ‚çš„è¦æ±‚,ä¸åŒçš„æä¾›å•†å®ç°çš„è™šæ‹Ÿæœºå¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€è¦æ¥å®ç°è¿™ä¸ªå†…å­˜åŒºåŸŸ.ä¸è¿‡,ä¸€èˆ¬æ¥è¯´,é™¤äº†ä¿å­˜Classæ–‡ä»¶ä¸­æè¿°çš„ç¬¦å·å¼•ç”¨å¤–,è¿˜ä¼šæŠŠç¿»è¯‘å‡ºæ¥çš„ç›´æ¥å¼•ç”¨ä¹Ÿå­˜å‚¨åœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­.è¿è¡Œæ—¶å¸¸é‡æ± ç›¸å¯¹äºClassæ–‡ä»¶å¸¸é‡æ± çš„å¦å¤–ä¸€ä¸ªé‡è¦ç‰¹å¾æ˜¯å…·å¤‡åŠ¨æ€æ€§,Javaè¯­è¨€å¹¶ä¸è¦æ±‚å¸¸é‡ä¸€å®šåªæœ‰ç¼–è¯‘æœŸæ‰èƒ½äº§ç”Ÿ,ä¹Ÿå°±æ˜¯å¹¶éé¢„ç½®å…¥Classæ–‡ä»¶ä¸­å¸¸é‡æ± çš„å†…å®¹æ‰èƒ½è¿›å…¥æ–¹æ³•åŒºè¿è¡Œæ—¶å¸¸é‡æ± ,è¿è¡ŒæœŸé—´ä¹Ÿå¯èƒ½å°†æ–°çš„å¸¸é‡æ”¾å…¥æ± ä¸­,è¿™ç§ç‰¹æ€§è¢«å¼€å‘äººå‘˜åˆ©ç”¨å¾—æ¯”è¾ƒå¤šçš„ä¾¿æ˜¯Stringç±»çš„intern()æ–¹æ³•.æ—¢ç„¶è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†,è‡ªç„¶å—åˆ°æ–¹æ³•åŒºå†…å­˜çš„é™åˆ¶,å½“å¸¸é‡æ± æ— æ³•å†ç”³è¯·åˆ°å†…å­˜æ—¶ä¼šæŠ›å‡º<code>OutOfMemoryError</code>å¼‚å¸¸.</p><h3 id="ç›´æ¥å†…å­˜"><a href="#ç›´æ¥å†…å­˜" class="headerlink" title="ç›´æ¥å†…å­˜"></a>ç›´æ¥å†…å­˜</h3><p>ã€€ã€€ç›´æ¥å†…å­˜(Direct Memory)å¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†,ä¹Ÿä¸æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸ.ä½†æ˜¯è¿™éƒ¨åˆ†å†…å­˜ä¹Ÿè¢«é¢‘ç¹åœ°ä½¿ç”¨,è€Œä¸”ä¹Ÿå¯èƒ½å¯¼è‡´<code>OutOfMemoryError</code>å¼‚å¸¸å‡ºç°,æ‰€ä»¥æˆ‘ä»¬æ”¾åˆ°è¿™é‡Œä¸€èµ·è®²è§£.åœ¨JDK 1.4ä¸­æ–°åŠ å…¥äº†NIO(New Input&#x2F;Output)ç±»,å¼•å…¥äº†ä¸€ç§åŸºäºé€šé“(Channel)ä¸ç¼“å†²åŒº(Buffer)çš„I&#x2F;Oæ–¹å¼,å®ƒå¯ä»¥ä½¿ç”¨Nativeå‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜,ç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨Javaå †ä¸­çš„DirectByteBufferå¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œ.è¿™æ ·èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜æ€§èƒ½,å› ä¸ºé¿å…äº†åœ¨Javaå †å’ŒNativeå †ä¸­æ¥å›å¤åˆ¶æ•°æ®.æ˜¾ç„¶,æœ¬æœºç›´æ¥å†…å­˜çš„åˆ†é…ä¸ä¼šå—åˆ°Javaå †å¤§å°çš„é™åˆ¶,ä½†æ˜¯,æ—¢ç„¶æ˜¯å†…å­˜,è‚¯å®šè¿˜æ˜¯ä¼šå—åˆ°æœ¬æœºæ€»å†…å­˜(åŒ…æ‹¬RAMä»¥åŠSWAPåŒºæˆ–è€…åˆ†é¡µæ–‡ä»¶)å¤§å°ä»¥åŠå¤„ç†å™¨å¯»å€ç©ºé—´çš„é™åˆ¶.æœåŠ¡å™¨ç®¡ç†å‘˜åœ¨é…ç½®è™šæ‹Ÿæœºå‚æ•°æ—¶,ä¼šæ ¹æ®å®é™…å†…å­˜è®¾ç½®-Xmxç­‰å‚æ•°ä¿¡æ¯,ä½†ç»å¸¸å¿½ç•¥ç›´æ¥å†…å­˜,ä½¿å¾—å„ä¸ªå†…å­˜åŒºåŸŸæ€»å’Œå¤§äºç‰©ç†å†…å­˜é™åˆ¶(åŒ…æ‹¬ç‰©ç†çš„å’Œæ“ä½œç³»ç»Ÿçº§çš„é™åˆ¶),ä»è€Œå¯¼è‡´åŠ¨æ€æ‰©å±•æ—¶å‡ºç°<code>OutOfMemoryError</code>å¼‚å¸¸.</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>JVM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Androidçš„æ¶ˆæ¯æœºåˆ¶</title>
    <link href="/2017/03/23/Android%E7%9A%84%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6/"/>
    <url>/2017/03/23/Android%E7%9A%84%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<p>ã€€ã€€Androidæ¶ˆæ¯æœºåˆ¶ä¸»è¦æ˜¯æŒ‡Handlerçš„è¿è¡Œæœºåˆ¶ï¼ŒHandlerçš„è¿è¡Œéœ€è¦åº•å±‚çš„MessageQueueå’ŒLooperçš„æ”¯æ’‘ã€‚MessageQueueçš„ä¸­æ–‡ç¿»è¯‘æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒçš„å†…éƒ¨å­˜å‚¨äº†ä¸€ç»„æ¶ˆæ¯ï¼Œä»¥é˜Ÿåˆ—çš„å½¢å¼å¯¹å¤–æä¾›æ’å…¥å’Œåˆ é™¤çš„å·¥ä½œã€‚è™½ç„¶å«æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä½†æ˜¯å®ƒçš„å†…éƒ¨å­˜å‚¨ç»“æ„å¹¶ä¸æ˜¯çœŸæ­£çš„é˜Ÿåˆ—ï¼Œè€Œæ˜¯é‡‡ç”¨å•é“¾è¡¨çš„æ•°æ®ç»“æ„æ¥å­˜å‚¨æ¶ˆæ¯é˜Ÿåˆ—ã€‚Looperå¯ä»¥ç†è§£ä¸ºæ¶ˆæ¯å¾ªç¯ã€‚ç”±äºMessageQueueåªæ˜¯ä¸€ä¸ªæ¶ˆæ¯çš„å­˜å‚¨å•å…ƒï¼Œå®ƒä¸èƒ½å»å¤„ç†æ¶ˆæ¯ï¼Œè€ŒLooperå°±å¡«è¡¥äº†è¿™ä¸ªåŠŸèƒ½ï¼ŒLooperä¼šä»¥æ— é™å¾ªç¯çš„å½¢å¼å»æŸ¥æ‰¾æ˜¯å¦æœ‰æ–°æ¶ˆæ¯ï¼Œå¦‚æœæœ‰çš„è¯å°±å¤„ç†æ¶ˆæ¯ï¼Œå¦åˆ™å°±ç­‰å¾…ã€‚Looperä¸­è¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„æ¦‚å¿µï¼šThreadLocalï¼ŒThreadLocalå¹¶ä¸æ˜¯çº¿ç¨‹ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¯ä»¥åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­å­˜å‚¨æ•°æ®ã€‚Handleråˆ›å»ºçš„æ—¶å€™ä¼šé‡‡ç”¨å½“å‰çº¿ç¨‹çš„Looperæ¥æ„é€ æ¶ˆæ¯å¾ªç¯ç³»ç»Ÿï¼ŒThreadLocalå¯ä»¥åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­äº’ä¸å¹²æ‰°çš„å­˜å‚¨å¹¶æä¾›æ•°æ®ï¼ŒHandlerå¯ä»¥é€šè¿‡ThreadLocalè½»æ¾è·å–æ¯ä¸ªçº¿ç¨‹çš„Looperã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œçº¿ç¨‹é»˜è®¤æ˜¯æ²¡æœ‰Looperçš„ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨Handlerå°±å¿…é¡»ä¸ºç°æˆåˆ›å»ºLooperï¼Œæˆ‘ä»¬ç»å¸¸æåˆ°çš„ä¸»çº¿ç¨‹ï¼Œä¹Ÿå«UIçº¿ç¨‹ï¼Œå®ƒå°±æ˜¯ActivityThreadï¼ŒActivityThreadè¢«åˆ›å»ºæ—¶å°±ä¼šåˆå§‹åŒ–Looperï¼Œè¿™ä¹Ÿæ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­é»˜è®¤å¯ä»¥ä½¿ç”¨Handlerçš„åŸå› ã€‚</p><span id="more"></span><h3 id="ThreadLocalçš„å·¥ä½œåŸç†"><a href="#ThreadLocalçš„å·¥ä½œåŸç†" class="headerlink" title="ThreadLocalçš„å·¥ä½œåŸç†"></a>ThreadLocalçš„å·¥ä½œåŸç†</h3><p>ThreadLocalæ˜¯ä¸€ä¸ªçº¿ç¨‹å†…éƒ¨çš„æ•°æ®å­˜å‚¨ç±»ï¼Œé€šè¿‡å®ƒå¯ä»¥åœ¨æŒ‡å®šçš„çº¿ç¨‹ä¸­å­˜å‚¨æ•°æ®ï¼Œæ•°æ®å­˜å‚¨ä»¥åï¼Œåªèƒ½åœ¨æŒ‡å®šçš„çº¿ç¨‹ä¸­æ‰å¯ä»¥è·å–åˆ°å­˜å‚¨çš„æ•°æ®ï¼Œå¯¹äºå…¶ä»–çº¿ç¨‹æ¥è¯´åˆ™æ— æ³•è·å–åˆ°ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> ThreadLocal&lt;Boolean&gt; mBooleanThreadLocal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();<br>       <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-string">&quot;Thread#1&quot;</span>)&#123;<br>           <span class="hljs-meta">@Override</span><br>           <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>               mBooleanThreadLocal.set(<span class="hljs-literal">false</span>);<br>               Log.d(<span class="hljs-string">&quot;huangyuan&quot;</span>,<span class="hljs-string">&quot;Thread#1&quot;</span> + mBooleanThreadLocal.get());<br>           &#125;<br>       &#125;.start();<br><br>       <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-string">&quot;Thread#2&quot;</span>)&#123;<br><br>           <span class="hljs-meta">@Override</span><br>           <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>               mBooleanThreadLocal.set(<span class="hljs-literal">true</span>);<br>               Log.d(<span class="hljs-string">&quot;huangyuan&quot;</span>,<span class="hljs-string">&quot;Thread#2&quot;</span> + mBooleanThreadLocal.get());<br>           &#125;<br>       &#125;.start();<br></code></pre></td></tr></table></figure><p>ã€€ã€€è¿™æ ·ï¼Œæˆ‘ä»¬è™½ç„¶åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­è®¿é—®çš„æ˜¯åŒä¸€ä¸ªThreadLocalå¯¹è±¡ï¼Œä½†æ˜¯ä»–ä»¬çš„å€¼å´æ˜¯ä¸ä¸€æ ·çš„ã€‚è¿™æ˜¯å› ä¸ºä¸åŒçš„çº¿ç¨‹è®¿é—®åŒä¸€ä¸ªThreadLocalçš„getæ–¹æ³•ï¼ŒThreadLocalå†…éƒ¨ä¼šä»å„è‡ªçš„çº¿ç¨‹ä¸­å–å‡ºä¸€ä¸ªæ•°ç»„ï¼Œç„¶åå†ä»æ•°ç»„ä¸­æ ¹æ®å½“å‰ThreadLocalçš„ç´¢å¼•å»æŸ¥æ‰¾å‡ºå¯¹åº”çš„valueå€¼ã€‚<br>ThreadLocalæ˜¯ä¸€ä¸ªæ³›å‹ç±»ï¼Œå®šä¹‰ä¸º<code>public class ThreadLocal&lt;T&gt;</code>,é¦–å…ˆçœ‹ThreadLocalçš„setæ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(T value)</span> &#123;<br>       <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();<br>       <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);<br>       <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>)<br>           map.set(<span class="hljs-built_in">this</span>, value);<br>       <span class="hljs-keyword">else</span><br>           createMap(t, value);<br>   &#125;<br></code></pre></td></tr></table></figure><p>ã€€ã€€ä¸Šé¢çš„æ–¹æ³•ä¸­ï¼Œé¦–å…ˆä¼šé€šè¿‡getMapæ–¹æ³•è·å–ThreadLocalMapï¼ˆå­˜å‚¨çº¿ç¨‹çš„ThreadLocalæ•°æ®ï¼‰ï¼ŒThreadLocalMapæ˜¯ThreadLocalç±»çš„é™æ€å†…éƒ¨ç±»ï¼Œå…¶å†…éƒ¨åŒ…å«äº†ä¸€ä¸ªé™æ€å†…éƒ¨ç±»Entryï¼Œå£°æ˜å¦‚ä¸‹<code>static class Entry extends WeakReference&lt;ThreadLocal&gt;</code>,ThreadLocalMapç±»ä¸­æœ‰ä¸€ä¸ªEntryç±»å‹çš„æ•°ç»„<code>private Entry[] table;</code>,ä¸‹é¢æ˜¯setæ–¹æ³•çš„å…·ä½“å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(ThreadLocal key, Object value)</span> &#123;<br><br>          <span class="hljs-comment">// We don&#x27;t use a fast path as with get() because it is at</span><br>          <span class="hljs-comment">// least as common to use set() to create new entries as</span><br>          <span class="hljs-comment">// it is to replace existing ones, in which case, a fast</span><br>          <span class="hljs-comment">// path would fail more often than not.</span><br><br>          Entry[] tab = table;<br>          <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> tab.length;<br>          <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> key.threadLocalHashCode &amp; (len-<span class="hljs-number">1</span>);<br><br>          <span class="hljs-keyword">for</span> (<span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> tab[i];<br>               e != <span class="hljs-literal">null</span>;<br>               e = tab[i = nextIndex(i, len)]) &#123;<br>              <span class="hljs-type">ThreadLocal</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> e.get();<br><br>              <span class="hljs-keyword">if</span> (k == key) &#123;<br>                  e.value = value;<br>                  <span class="hljs-keyword">return</span>;<br>              &#125;<br><br>              <span class="hljs-keyword">if</span> (k == <span class="hljs-literal">null</span>) &#123;<br>                  replaceStaleEntry(key, value, i);<br>                  <span class="hljs-keyword">return</span>;<br>              &#125;<br>          &#125;<br><br>          tab[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>(key, value);<br>          <span class="hljs-type">int</span> <span class="hljs-variable">sz</span> <span class="hljs-operator">=</span> ++size;<br>          <span class="hljs-keyword">if</span> (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold)<br>              rehash();<br>      &#125;<br></code></pre></td></tr></table></figure><p>ThreadLocalçš„getæ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> T <span class="hljs-title function_">get</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();<br>        <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);<br>        <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) &#123;<br>            ThreadLocalMap.<span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> map.getEntry(<span class="hljs-built_in">this</span>);<br>            <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>)<br>                <span class="hljs-keyword">return</span> (T)e.value;<br>        &#125;<br>        <span class="hljs-keyword">return</span> setInitialValue();<br>    &#125; <br></code></pre></td></tr></table></figure><p>ã€€ã€€ä»ThreadLocalçš„setå’Œgetæ–¹æ³•å¯ä»¥çœ‹å‡ºï¼Œä»–ä»¬æ‰€æ“ä½œçš„å¯¹è±¡éƒ½æ˜¯å½“å‰çº¿ç¨‹çš„ThreadLocalMapå¯¹è±¡çš„tableæ•°ç»„ï¼Œå› æ­¤åœ¨ä¸åŒçº¿ç¨‹ä¸­è®¿é—®åŒä¸€ä¸ªThreadLocalçš„setå’Œgetæ–¹æ³•ï¼Œä»–ä»¬å¯¹ThreadLocalæ‰€åšçš„è¯»å†™æ“ä½œä»…é™äºå„è‡ªçº¿ç¨‹çš„å†…éƒ¨ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆThreadLocalå¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¸­äº’ä¸å¹²æ‰°çš„å­˜å‚¨å’Œä¿®æ”¹æ•°æ®ã€‚</p><h3 id="æ¶ˆæ¯é˜Ÿåˆ—çš„å·¥ä½œåŸç†"><a href="#æ¶ˆæ¯é˜Ÿåˆ—çš„å·¥ä½œåŸç†" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—çš„å·¥ä½œåŸç†"></a>æ¶ˆæ¯é˜Ÿåˆ—çš„å·¥ä½œåŸç†</h3><p>ã€€ã€€æ¶ˆæ¯é˜Ÿåˆ—åœ¨Androidä¸­æŒ‡çš„æ˜¯MessageQueueï¼ŒMessageQueueä¸»è¦åŒ…å«ä¸¤ä¸ªæ“ä½œï¼Œæ’å…¥å’Œè¯»å–ã€‚è¯»å–æ“ä½œæœ¬èº«ä¼šä¼´éšç€åˆ é™¤æ“ä½œï¼Œæ’å…¥å’Œè¯»å–å¯¹åº”çš„æ–¹æ³•åˆ†åˆ«ä¸ºenqueueMessageå’Œnextï¼Œå…¶ä¸­enqueueMessageçš„ä½œç”¨æ˜¯å¾€æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ’å…¥ä¸€è·³æ¶ˆæ¯ï¼Œè€Œnextçš„ä½œç”¨æ˜¯ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºä¸€æ¡æ¶ˆæ¯å¹¶å°†å…¶ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œå°½ç®¡MessageQueueå«æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä½†æ˜¯å®ƒçš„å†…éƒ¨å®ç°å¹¶ä¸æ˜¯ç”¨çš„é˜Ÿåˆ—ï¼Œå®é™…ä¸Šå®ƒæ˜¯é€šè¿‡ä¸€ä¸ªå•é“¾è¡¨çš„æ•°æ®ç»“æ„æ¥ç»´æŠ¤æ¶ˆæ¯åˆ—è¡¨ï¼Œå•é“¾è¡¨åœ¨æ’å…¥å’Œåˆ é™¤ä¸Šæ¯”è¾ƒæœ‰ä¼˜åŠ¿ã€‚ä¸‹é¢æ˜¯enqueueMessageçš„å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">boolean</span> <span class="hljs-title function_">enqueueMessage</span><span class="hljs-params">(Message msg, <span class="hljs-type">long</span> when)</span> &#123;<br>        <span class="hljs-keyword">if</span> (msg.target == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Message must have a target.&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (msg.isInUse()) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(msg + <span class="hljs-string">&quot; This message is already in use.&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>            <span class="hljs-keyword">if</span> (mQuitting) &#123;<br>                <span class="hljs-type">IllegalStateException</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<br>                        msg.target + <span class="hljs-string">&quot; sending message to a Handler on a dead thread&quot;</span>);<br>                Log.w(TAG, e.getMessage(), e);<br>                msg.recycle();<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br><br>            msg.markInUse();<br>            msg.when = when;<br>            <span class="hljs-type">Message</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> mMessages;<br>            <span class="hljs-type">boolean</span> needWake;<br>            <span class="hljs-keyword">if</span> (p == <span class="hljs-literal">null</span> || when == <span class="hljs-number">0</span> || when &lt; p.when) &#123;<br>                <span class="hljs-comment">// New head, wake up the event queue if blocked.</span><br>                msg.next = p;<br>                mMessages = msg;<br>                needWake = mBlocked;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">// Inserted within the middle of the queue.  Usually we don&#x27;t have to wake</span><br>                <span class="hljs-comment">// up the event queue unless there is a barrier at the head of the queue</span><br>                <span class="hljs-comment">// and the message is the earliest asynchronous message in the queue.</span><br>                needWake = mBlocked &amp;&amp; p.target == <span class="hljs-literal">null</span> &amp;&amp; msg.isAsynchronous();<br>                Message prev;<br>                <span class="hljs-keyword">for</span> (;;) &#123;<br>                    prev = p;<br>                    p = p.next;<br>                    <span class="hljs-keyword">if</span> (p == <span class="hljs-literal">null</span> || when &lt; p.when) &#123;<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                    <span class="hljs-keyword">if</span> (needWake &amp;&amp; p.isAsynchronous()) &#123;<br>                        needWake = <span class="hljs-literal">false</span>;<br>                    &#125;<br>                &#125;<br>                msg.next = p; <span class="hljs-comment">// invariant: p == prev.next</span><br>                prev.next = msg;<br>            &#125;<br><br>            <span class="hljs-comment">// We can assume mPtr != 0 because mQuitting is false.</span><br>            <span class="hljs-keyword">if</span> (needWake) &#123;<br>                nativeWake(mPtr);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><p>ä»å…¶å®ç°æ¥å®‰ï¼Œä¸»è¦æ“ä½œå…¶å®å°±æ˜¯å•é“¾è¡¨çš„æ’å…¥æ“ä½œã€‚<br>nextçš„å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs java">Message <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// Return here if the message loop has already quit and been disposed.</span><br>        <span class="hljs-comment">// This can happen if the application tries to restart a looper after quit</span><br>        <span class="hljs-comment">// which is not supported.</span><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">ptr</span> <span class="hljs-operator">=</span> mPtr;<br>        <span class="hljs-keyword">if</span> (ptr == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">pendingIdleHandlerCount</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>; <span class="hljs-comment">// -1 only during first iteration</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">nextPollTimeoutMillis</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (;;) &#123;<br>            <span class="hljs-keyword">if</span> (nextPollTimeoutMillis != <span class="hljs-number">0</span>) &#123;<br>                Binder.flushPendingCommands();<br>            &#125;<br><br>            nativePollOnce(ptr, nextPollTimeoutMillis);<br><br>            <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>                <span class="hljs-comment">// Try to retrieve the next message.  Return if found.</span><br>                <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> SystemClock.uptimeMillis();<br>                <span class="hljs-type">Message</span> <span class="hljs-variable">prevMsg</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>                <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> mMessages;<br>                <span class="hljs-keyword">if</span> (msg != <span class="hljs-literal">null</span> &amp;&amp; msg.target == <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-comment">// Stalled by a barrier.  Find the next asynchronous message in the queue.</span><br>                    <span class="hljs-keyword">do</span> &#123;<br>                        prevMsg = msg;<br>                        msg = msg.next;<br>                    &#125; <span class="hljs-keyword">while</span> (msg != <span class="hljs-literal">null</span> &amp;&amp; !msg.isAsynchronous());<br>                &#125;<br>                <span class="hljs-keyword">if</span> (msg != <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-keyword">if</span> (now &lt; msg.when) &#123;<br>                        <span class="hljs-comment">// Next message is not ready.  Set a timeout to wake up when it is ready.</span><br>                        nextPollTimeoutMillis = (<span class="hljs-type">int</span>) Math.min(msg.when - now, Integer.MAX_VALUE);<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        <span class="hljs-comment">// Got a message.</span><br>                        mBlocked = <span class="hljs-literal">false</span>;<br>                        <span class="hljs-keyword">if</span> (prevMsg != <span class="hljs-literal">null</span>) &#123;<br>                            prevMsg.next = msg.next;<br>                        &#125; <span class="hljs-keyword">else</span> &#123;<br>                            mMessages = msg.next;<br>                        &#125;<br>                        msg.next = <span class="hljs-literal">null</span>;<br>                        <span class="hljs-keyword">if</span> (DEBUG) Log.v(TAG, <span class="hljs-string">&quot;Returning message: &quot;</span> + msg);<br>                        msg.markInUse();<br>                        <span class="hljs-keyword">return</span> msg;<br>                    &#125;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-comment">// No more messages.</span><br>                    nextPollTimeoutMillis = -<span class="hljs-number">1</span>;<br>                &#125;<br><br>                <span class="hljs-comment">// Process the quit message now that all pending messages have been handled.</span><br>                <span class="hljs-keyword">if</span> (mQuitting) &#123;<br>                    dispose();<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>                &#125;<br><br>                <span class="hljs-comment">// If first time idle, then get the number of idlers to run.</span><br>                <span class="hljs-comment">// Idle handles only run if the queue is empty or if the first message</span><br>                <span class="hljs-comment">// in the queue (possibly a barrier) is due to be handled in the future.</span><br>                <span class="hljs-keyword">if</span> (pendingIdleHandlerCount &lt; <span class="hljs-number">0</span><br>                        &amp;&amp; (mMessages == <span class="hljs-literal">null</span> || now &lt; mMessages.when)) &#123;<br>                    pendingIdleHandlerCount = mIdleHandlers.size();<br>                &#125;<br>                <span class="hljs-keyword">if</span> (pendingIdleHandlerCount &lt;= <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-comment">// No idle handlers to run.  Loop and wait some more.</span><br>                    mBlocked = <span class="hljs-literal">true</span>;<br>                    <span class="hljs-keyword">continue</span>;<br>                &#125;<br><br>                <span class="hljs-keyword">if</span> (mPendingIdleHandlers == <span class="hljs-literal">null</span>) &#123;<br>                    mPendingIdleHandlers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IdleHandler</span>[Math.max(pendingIdleHandlerCount, <span class="hljs-number">4</span>)];<br>                &#125;<br>                mPendingIdleHandlers = mIdleHandlers.toArray(mPendingIdleHandlers);<br>            &#125;<br><br>            <span class="hljs-comment">// Run the idle handlers.</span><br>            <span class="hljs-comment">// We only ever reach this code block during the first iteration.</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; pendingIdleHandlerCount; i++) &#123;<br>                <span class="hljs-keyword">final</span> <span class="hljs-type">IdleHandler</span> <span class="hljs-variable">idler</span> <span class="hljs-operator">=</span> mPendingIdleHandlers[i];<br>                mPendingIdleHandlers[i] = <span class="hljs-literal">null</span>; <span class="hljs-comment">// release the reference to the handler</span><br><br>                <span class="hljs-type">boolean</span> <span class="hljs-variable">keep</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    keep = idler.queueIdle();<br>                &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;<br>                    Log.wtf(TAG, <span class="hljs-string">&quot;IdleHandler threw exception&quot;</span>, t);<br>                &#125;<br><br>                <span class="hljs-keyword">if</span> (!keep) &#123;<br>                    <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>                        mIdleHandlers.remove(idler);<br>                    &#125;<br>                &#125;<br>            &#125;<br><br>            <span class="hljs-comment">// Reset the idle handler count to 0 so we do not run them again.</span><br>            pendingIdleHandlerCount = <span class="hljs-number">0</span>;<br><br>            <span class="hljs-comment">// While calling an idle handler, a new message could have been delivered</span><br>            <span class="hljs-comment">// so go back and look again for a pending message without waiting.</span><br>            nextPollTimeoutMillis = <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥è¿”ç°nextæ–¹æ³•æ˜¯ä¸€ä¸ªæ— é™å¾ªç¯çš„æ–¹æ³•ï¼Œå¦‚æœæ¶ˆæ¯é˜Ÿåˆ—ä¸ºç©ºï¼Œé‚£ä¹ˆnextæ–¹æ³•ä¼šä¸€ç›´é˜»å¡åœ¨è¿™é‡Œï¼Œå½“æœ‰æ¶ˆæ¯åˆ°æ¥æ—¶ï¼Œnextæ–¹æ³•ä¼šè¿”å›è¿™æ¡æ¶ˆæ¯å¹¶å°†å…¶ä»å•é“¾è¡¨ä¸­ç§»é™¤</p><h3 id="Looperçš„å·¥ä½œåŸç†"><a href="#Looperçš„å·¥ä½œåŸç†" class="headerlink" title="Looperçš„å·¥ä½œåŸç†"></a>Looperçš„å·¥ä½œåŸç†</h3><p>ã€€ã€€Looperåœ¨Androidçš„æ¶ˆæ¯æœºåˆ¶ä¸­æ‰®æ¼”è€…æ¶ˆæ¯å¾ªç¯çš„è§’è‰²ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯å®ƒä¼šä¸åœåœ°ä»MessageQueueä¸­æŸ¥çœ‹æ˜¯å¦æœ‰æ–°æ¶ˆæ¯ï¼Œå¦‚æœæœ‰æ–°æ¶ˆæ¯å°±ä¼šç«‹åˆ»å¤„ç†ï¼Œå¦åˆ™å°±ä¸€ç›´é˜»å¡åœ¨é‚£é‡Œã€‚é¦–å…ˆçœ‹ä¸€ä¸‹å®ƒçš„æ„é€ æ–¹æ³•ï¼Œåœ¨æ„é€ ä¸­å®ƒä¼šåˆ›å»ºä¸€ä¸ªMessageQueueä¹Ÿå°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç„¶åå°†å½“å‰çº¿ç¨‹çš„å¯¹è±¡ä¿å­˜èµ·æ¥ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-title function_">Looper</span><span class="hljs-params">(<span class="hljs-type">boolean</span> quitAllowed)</span> &#123;<br>      mQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageQueue</span>(quitAllowed);<br>      mThread = Thread.currentThread();<br>  &#125;<br></code></pre></td></tr></table></figure><p>ã€€ã€€Handlerçš„å·¥ä½œéœ€è¦Looperï¼Œæ²¡æœ‰Looperçš„çº¿ç¨‹å°±ä¼šæŠ¥é”™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Looper.prepare()å³å¯ä¸ºå½“å‰çº¿ç¨‹åˆ›å»ºä¸€ä¸ªLooperï¼Œæ¥ç€é€šè¿‡Looper.loop()æ¥å¼€å¯æ¶ˆæ¯å¾ªç¯ã€‚Looperé™¤äº†prepareæ–¹æ³•å¤–ï¼Œè¿˜æä¾›äº†prepareMainLoopæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯ç»™ä¸»çº¿ç¨‹ä¹Ÿå°±æ˜¯ActivityThreadåˆ›å»ºLooperä½¿ç”¨çš„ï¼Œå…¶æœ¬è´¨ä¹Ÿæ˜¯é€šè¿‡prepareæ–¹æ³•æ¥å®ç°çš„ã€‚ç”±äºä¸»çº¿ç¨‹çš„Looperæ¯”è¾ƒç‰¹æ®Šï¼Œæ‰€ä»¥Looperæä¾›äº†ä¸€ä¸ªgetMainLooperæ–¹æ³•ï¼Œé€šè¿‡å®ƒå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è·å–åˆ°ä¸»çº¿ç¨‹çš„Looperã€‚Looperä¹Ÿæ˜¯å¯ä»¥é€€å‡ºçš„ï¼ŒLooperæä¾›äº†quitå’ŒquitSafelyæ¥é€€å‡ºä¸€ä¸ªLooperï¼ŒäºŒè€…çš„åŒºåˆ«æ˜¯ï¼šquitä¼šç›´æ¥çªå‡ºLooperï¼Œè€ŒquitSafelyåªæ˜¯è®¾å®šä¸€ä¸ªé€€å‡ºæ ‡è®°ï¼Œç„¶åæŠŠæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„å·²æœ‰æ¶ˆæ¯å¤„ç†å®Œæ¯•åæ‰å®‰å…¨çš„é€€å‡ºã€‚Looperé€€å‡ºåï¼Œé€šè¿‡Handlerå‘é€çš„æ¶ˆæ¯ä¼šå¤±è´¥ï¼Œè¿™ä¸ªæ—¶å€™Handlerçš„sendæ–¹æ³•ä¼šè¿”å›falseã€‚åœ¨å­çº¿ç¨‹ä¸­ï¼Œå¦‚æœæ‰‹åŠ¨ä¸ºå…¶åˆ›å»ºäº†Looperï¼Œé‚£ä¹ˆåœ¨æ‰€æœ‰çš„äº‹æƒ…å®Œæˆä»¥ååº”è¯¥è°ƒç”¨quitæ–¹æ³•æ¥æ€»ä¹‹æ¶ˆæ¯å¾ªç¯ï¼Œå¦åˆ™è¿™ä¸ªå­çº¿ç¨‹å°±ä¼šä¸€ç›´å¤„äºç­‰å¾…çš„çŠ¶æ€ï¼Œè€Œå¦‚æœé€€å‡ºLooperä»¥åï¼Œè¿™ä¸ªçº¿ç¨‹å°±ä¼šç«‹åˆ»ç»ˆæ­¢ï¼Œå› æ­¤å»ºè®®ä¸éœ€è¦çš„æ—¶å€™ç»ˆæ­¢Looperã€‚<br> Looperæœ€é‡è¦çš„ä¸€ä¸ªæ–¹æ³•æ˜¯loopæ–¹æ³•ï¼Œåªæœ‰è°ƒç”¨äº†loopåï¼Œæ¶ˆæ¯å¾ªç¯ç³»ç»Ÿæ‰ä¼šçœŸæ­£çš„èµ·ä½œç”¨ï¼Œå®ç°å¦‚ä¸‹ï¼š<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">   * Run the message queue in this thread. Be sure to call</span><br><span class="hljs-comment">   * &#123;<span class="hljs-doctag">@link</span> #quit()&#125; to end the loop.</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loop</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-keyword">final</span> <span class="hljs-type">Looper</span> <span class="hljs-variable">me</span> <span class="hljs-operator">=</span> myLooper();<br>      <span class="hljs-keyword">if</span> (me == <span class="hljs-literal">null</span>) &#123;<br>          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;No Looper; Looper.prepare() wasn&#x27;t called on this thread.&quot;</span>);<br>      &#125;<br>      <span class="hljs-keyword">final</span> <span class="hljs-type">MessageQueue</span> <span class="hljs-variable">queue</span> <span class="hljs-operator">=</span> me.mQueue;<br><br>      <span class="hljs-comment">// Make sure the identity of this thread is that of the local process,</span><br>      <span class="hljs-comment">// and keep track of what that identity token actually is.</span><br>      Binder.clearCallingIdentity();<br>      <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">ident</span> <span class="hljs-operator">=</span> Binder.clearCallingIdentity();<br><br>      <span class="hljs-keyword">for</span> (;;) &#123;<br>          <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> queue.next(); <span class="hljs-comment">// might block</span><br>          <span class="hljs-keyword">if</span> (msg == <span class="hljs-literal">null</span>) &#123;<br>              <span class="hljs-comment">// No message indicates that the message queue is quitting.</span><br>              <span class="hljs-keyword">return</span>;<br>          &#125;<br><br>          <span class="hljs-comment">// This must be in a local variable, in case a UI event sets the logger</span><br>          <span class="hljs-keyword">final</span> <span class="hljs-type">Printer</span> <span class="hljs-variable">logging</span> <span class="hljs-operator">=</span> me.mLogging;<br>          <span class="hljs-keyword">if</span> (logging != <span class="hljs-literal">null</span>) &#123;<br>              logging.println(<span class="hljs-string">&quot;&gt;&gt;&gt;&gt;&gt; Dispatching to &quot;</span> + msg.target + <span class="hljs-string">&quot; &quot;</span> +<br>                      msg.callback + <span class="hljs-string">&quot;: &quot;</span> + msg.what);<br>          &#125;<br><br>          <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">traceTag</span> <span class="hljs-operator">=</span> me.mTraceTag;<br>          <span class="hljs-keyword">if</span> (traceTag != <span class="hljs-number">0</span>) &#123;<br>              Trace.traceBegin(traceTag, msg.target.getTraceName(msg));<br>          &#125;<br>          <span class="hljs-keyword">try</span> &#123;<br>              msg.target.dispatchMessage(msg);<br>          &#125; <span class="hljs-keyword">finally</span> &#123;<br>              <span class="hljs-keyword">if</span> (traceTag != <span class="hljs-number">0</span>) &#123;<br>                  Trace.traceEnd(traceTag);<br>              &#125;<br>          &#125;<br><br>          <span class="hljs-keyword">if</span> (logging != <span class="hljs-literal">null</span>) &#123;<br>              logging.println(<span class="hljs-string">&quot;&lt;&lt;&lt;&lt;&lt; Finished to &quot;</span> + msg.target + <span class="hljs-string">&quot; &quot;</span> + msg.callback);<br>          &#125;<br><br>          <span class="hljs-comment">// Make sure that during the course of dispatching the</span><br>          <span class="hljs-comment">// identity of the thread wasn&#x27;t corrupted.</span><br>          <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">newIdent</span> <span class="hljs-operator">=</span> Binder.clearCallingIdentity();<br>          <span class="hljs-keyword">if</span> (ident != newIdent) &#123;<br>              Log.wtf(TAG, <span class="hljs-string">&quot;Thread identity changed from 0x&quot;</span><br>                      + Long.toHexString(ident) + <span class="hljs-string">&quot; to 0x&quot;</span><br>                      + Long.toHexString(newIdent) + <span class="hljs-string">&quot; while dispatching to &quot;</span><br>                      + msg.target.getClass().getName() + <span class="hljs-string">&quot; &quot;</span><br>                      + msg.callback + <span class="hljs-string">&quot; what=&quot;</span> + msg.what);<br>          &#125;<br><br>          msg.recycleUnchecked();<br>      &#125;<br>  &#125;<br></code></pre></td></tr></table></figure><br> ã€€ã€€loopæ–¹æ³•æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œå”¯ä¸€è·³å‡ºå¾ªç¯çš„æ–¹å¼æ˜¯MessageQueueçš„nextæ–¹æ³•è¿”å›äº†nullï¼Œå½“Looperçš„quitæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼ŒLooperå°±ä¼šé€šçŸ¥æ¶ˆæ¯é˜Ÿåˆ—é€€å‡ºï¼Œå½“æ¶ˆæ¯é˜Ÿåˆ—è¢«æ ‡è®°ä¸ºé€€å‡ºçŠ¶æ€æ—¶ï¼Œå®ƒçš„nextæ–¹æ³•å°±ä¼šè¿”å›nullï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒLooperå¿…é¡»é€€å‡ºï¼Œå¦åˆ™loopæ–¹æ³•å°±ä¼šæ— é™å¾ªç¯ä¸‹å»ï¼Œloopæ–¹æ³•ä¼šè°ƒç”¨MessageQueueçš„nextæ–¹æ³•æ¥è·å–æ–°æ¶ˆæ¯ï¼Œè€Œnextæ–¹æ³•æ˜¯ä¸€ä¸ªé˜»å¡æ“ä½œï¼Œå½“æ²¡æœ‰æ¶ˆæ¯æ—¶ï¼Œnextæ–¹æ³•ä¼šä¸€ç›´é˜»å¡åœ¨é‚£é‡Œï¼Œè¿™ä¹Ÿå¯¼è‡´loopæ–¹æ³•ä¸€ç›´é˜»å¡åœ¨é‚£é‡Œï¼Œå¦‚æœMessageQueueçš„nextæ–¹æ³•è¿”å›äº†æ–°æ¶ˆæ¯ï¼ŒLooperå°±ä¼šå¤„ç†è¿™æ¡æ¶ˆæ¯ï¼Œ  msg.target.dispatchMessage(msg)ï¼Œè¿™é‡Œçš„  msg.targetæ˜¯å‘é€è¿™æ¡æ¶ˆæ¯çš„handlerå¯¹è±¡ï¼Œè¿™æ ·Handlerå‘é€çš„æ¶ˆæ¯æœ€ç»ˆåˆäº¤ä¸ªå®ƒçš„  dispatchMessage(msg);æ–¹æ³•æ¥å¤„ç†äº†ï¼Œä½†æ˜¯è¿™é‡Œä¸åŒçš„æ˜¯ï¼ŒHandlerçš„dispatchMessageæ–¹æ³•æ˜¯åœ¨åˆ›å»ºHandleræ—¶æ‰€ä½¿ç”¨çš„Looperä¸­æ‰§è¡Œçš„ï¼Œè¿™æ ·å°±æˆåŠŸçš„å°†ä»£ç é€»è¾‘åˆ‡æ¢åˆ°æŒ‡å®šçš„çº¿ç¨‹ä¸­å»æ‰§è¡Œäº†ã€‚</p><h3 id="Handlerçš„å·¥ä½œåŸç†"><a href="#Handlerçš„å·¥ä½œåŸç†" class="headerlink" title="Handlerçš„å·¥ä½œåŸç†"></a>Handlerçš„å·¥ä½œåŸç†</h3><p> Handlerçš„å·¥ä½œä¸»è¦åŒ…å«æ¶ˆæ¯çš„å‘é€å’Œæ¥æ”¶è¿‡ç¨‹ã€‚æ¶ˆæ¯çš„å‘é€å¯ä»¥é€šè¿‡postçš„ä¸€ç³»åˆ—æ–¹æ³•ä»¥åŠsendçš„ä¸€ç³»åˆ—æ–¹æ³•æ¥å®ç°ï¼Œpostçš„ä¸€ç³»åˆ—æ–¹æ³•æœ€ç»ˆæ˜¯é€šè¿‡sendçš„ä¸€åˆ—æ–¹æ³•æ¥å®ç°çš„ã€‚å‘é€ä¸€æ¡æ¶ˆæ¯çš„å…¸å‹è¿‡ç¨‹å¦‚ä¸‹ï¼š<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">sendMessage</span><span class="hljs-params">(Message msg)</span><br>   &#123;<br>       <span class="hljs-keyword">return</span> sendMessageDelayed(msg, <span class="hljs-number">0</span>);<br>   &#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">sendMessageDelayed</span><span class="hljs-params">(Message msg, <span class="hljs-type">long</span> delayMillis)</span><br>   &#123;<br>       <span class="hljs-keyword">if</span> (delayMillis &lt; <span class="hljs-number">0</span>) &#123;<br>           delayMillis = <span class="hljs-number">0</span>;<br>       &#125;<br>       <span class="hljs-keyword">return</span> sendMessageAtTime(msg, SystemClock.uptimeMillis() + delayMillis);<br>   &#125;<br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">sendMessageAtTime</span><span class="hljs-params">(Message msg, <span class="hljs-type">long</span> uptimeMillis)</span> &#123;<br>       <span class="hljs-type">MessageQueue</span> <span class="hljs-variable">queue</span> <span class="hljs-operator">=</span> mQueue;<br>       <span class="hljs-keyword">if</span> (queue == <span class="hljs-literal">null</span>) &#123;<br>           <span class="hljs-type">RuntimeException</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<br>                   <span class="hljs-built_in">this</span> + <span class="hljs-string">&quot; sendMessageAtTime() called with no mQueue&quot;</span>);<br>           Log.w(<span class="hljs-string">&quot;Looper&quot;</span>, e.getMessage(), e);<br>           <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>       &#125;<br>       <span class="hljs-keyword">return</span> enqueueMessage(queue, msg, uptimeMillis);<br>   &#125;<br><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">enqueueMessage</span><span class="hljs-params">(MessageQueue queue, Message msg, <span class="hljs-type">long</span> uptimeMillis)</span> &#123;<br>       msg.target = <span class="hljs-built_in">this</span>;<br>       <span class="hljs-keyword">if</span> (mAsynchronous) &#123;<br>           msg.setAsynchronous(<span class="hljs-literal">true</span>);<br>       &#125;<br>       <span class="hljs-keyword">return</span> queue.enqueueMessage(msg, uptimeMillis);<br>   &#125;<br></code></pre></td></tr></table></figure><br> ã€€ã€€å¯ä»¥å‘ç°ï¼ŒHandlerå‘é€æ¶ˆæ¯çš„è¿‡ç¨‹ä»…ä»…æ˜¯å‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ’å…¥äº†ä¸€æ¡æ¶ˆæ¯ï¼ŒMessageQueueçš„nextæ–¹æ³•å°±ä¼šè¿”å›è¿™æ¡æ¶ˆæ¯ç»™Looperï¼ŒLooperæ”¶åˆ°æ¶ˆæ¯åå°±å¼€å§‹å¤„ç†äº†ï¼Œæœ€ç»ˆæ¶ˆæ¯ç”±Looperäº¤ç”±Handlerå¤„ç†ï¼Œå³Handlerçš„dispatchMessageæ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œè¿™æ—¶Handlerå°±æ˜¯è¿›å…¥äº†å¤„ç†æ¶ˆæ¯çš„é˜¶æ®µã€‚dispatchMessageçš„å®ç°å¦‚ä¸‹ï¼š<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dispatchMessage</span><span class="hljs-params">(Message msg)</span> &#123;<br>    <span class="hljs-keyword">if</span> (msg.callback != <span class="hljs-literal">null</span>) &#123;<br>        handleCallback(msg);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">if</span> (mCallback != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">if</span> (mCallback.handleMessage(msg)) &#123;<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>        &#125;<br>        handleMessage(msg);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><br> Handlerå¤„ç†æ¶ˆæ¯çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>æ£€æŸ¥Messageçš„callbackæ˜¯å¦ä¸ºnullï¼Œä¸ä¸ºnullå°±é€šè¿‡handleCallbackæ¥å¤„ç†æ¶ˆæ¯ï¼ŒMessageçš„callbackæ˜¯ä¸€ä¸ªRunnableå¯¹è±¡ï¼Œå®é™…ä¸Šå°±æ˜¯Handlerçš„postæ–¹æ³•æ‰€ä¼ é€’çš„Runnableå‚æ•°ã€‚handleCallbackçš„é€»è¾‘å¦‚ä¸‹ï¼š <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleCallback</span><span class="hljs-params">(Message message)</span> &#123;<br>       message.callback.run();<br>   &#125;<br></code></pre></td></tr></table></figure></li><li>å…¶æ¬¡ï¼Œæ£€æŸ¥mCallbackæ˜¯å¦ä¸ºnullï¼Œä¸ä¸ºnullå°±è°ƒç”¨æ²¡CallBackçš„HandlerMessageæ–¹æ³•æ¥å¤„ç†æ¶ˆæ¯ï¼ŒCallbackæ˜¯ä¸ªæ¥å£ï¼Œå®ƒçš„å®šä¹‰å¦‚ä¸‹ï¼š</li></ol> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    * Callback interface you can use when instantiating a Handler to avoid</span><br><span class="hljs-comment">    * having to implement your own subclass of Handler.</span><br><span class="hljs-comment">    *</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> msg A &#123;<span class="hljs-doctag">@link</span> android.os.Message Message&#125; object</span><br><span class="hljs-comment">    * <span class="hljs-doctag">@return</span> True if no further handling is desired</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Callback</span> &#123;<br>       <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(Message msg)</span>;<br>   &#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡Callbackå¯ä»¥é‡‡ç”¨å¦‚ä¸‹æ–¹å¼æ¥åˆ›å»ºHandlerå¯¹è±¡ï¼šHandler handler &#x3D; new Handler(callback)ã€‚</p><ol start="3"><li>æœ€åï¼Œè°ƒç”¨Handlerçš„handleMessaheæ–¹æ³•æ¥å¤„ç†æ¶ˆæ¯ã€‚</li></ol><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windowå’ŒWindowManager</title>
    <link href="/2017/03/21/Window%E5%92%8CWindowManager/"/>
    <url>/2017/03/21/Window%E5%92%8CWindowManager/</url>
    
    <content type="html"><![CDATA[<p>ã€€ã€€Windowè¡¨ç¤ºä¸€ä¸ªçª—å£çš„æ¦‚å¿µï¼Œåœ¨æ—¥å¸¸å¼€å‘ä¸­ç›´æ¥æ¥è§¦WIndowçš„æœºä¼šå¹¶ä¸å¯¹ï¼Œå†è¯•åœ¨æŸäº›ç‰¹æ®Šæ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨æ¡Œé¢ä¸Šæ˜¾ç¤ºä¸€ä¸ªç±»ä¼¼æ‚¬æµ®çª—çš„ä¸œè¥¿ï¼Œé‚£ä¹ˆè¿™ç§æ•ˆæœå°±éœ€è¦ç”¨åˆ°Windowæ¥å®ç°ã€‚<br>ã€€ã€€Windowåªæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒçš„å…·ä½“å®ç°æ˜¯PhoneWindowã€‚åˆ›å»ºä¸€ä¸ªWindowæ˜¯å¾ˆç®€å•çš„äº‹ï¼Œåªéœ€è¦é€šè¿‡WindowManagerå³å¯å®Œæˆï¼ŒWindowManageræ˜¯å¤–ç•Œè®¿é—®Windowçš„å…¥å£ï¼ŒWindowçš„å…·ä½“å®ç°ä½äºWindowMangerServiceä¸­ï¼ŒWindowMnagerå’ŒWWindowMangerServiceçš„äº¤äº’æ˜¯ä¸€ä¸ªIPCè¿‡ç¨‹ï¼ŒAndroidä¸­æ‰€æœ‰çš„è§†å›¾éƒ½æ˜¯é€šè¿‡Windowæ¥å‘ˆç°çš„ï¼Œä¸ç®¡æ˜¯Activityã€Dialogè¿˜æ˜¯Toastï¼Œå®ƒä»¬çš„è§†å›¾å®é™…ä¸Šéƒ½æ˜¯é™„åŠ åœ¨Windowä¸Šçš„ï¼Œå› æ­¤Windowå®é™…æ˜¯Viewçš„ç›´æ¥ç®¡ç†è€…ã€‚</p><span id="more"></span><h3 id="Windowçš„å†…éƒ¨æœºåˆ¶"><a href="#Windowçš„å†…éƒ¨æœºåˆ¶" class="headerlink" title="Windowçš„å†…éƒ¨æœºåˆ¶"></a>Windowçš„å†…éƒ¨æœºåˆ¶</h3><p>ã€€ã€€Windowæ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œæ¯ä¸€ä¸ªWindowéƒ½å¯¹åº”ç€ä¸€ä¸ªViewå’Œä¸€ä¸ªViewRootImplï¼ŒWindowå’ŒViewé€šè¿‡ViewRootImplæ¥å»ºç«‹è”ç³»ï¼Œå› æ­¤Windowå¹¶ä¸æ˜¯å®é™…å­˜åœ¨çš„ï¼Œå®ƒæ˜¯ä»¥Viewçš„å½¢å¼å­˜åœ¨ï¼Œã€‚è¿™ç‚¹ä»WindowManagerçš„å®šä¹‰ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œå®ƒæä¾›çš„ä¸‰ä¸ªæ¥å£æ–¹æ³•addView,updateViewLayoutä»¥åŠremoveViewéƒ½æ˜¯é’ˆå¯¹Viewï¼Œè¿™è¯´æ˜Viewæ‰æ˜¯Windowå­˜åœ¨çš„å®ä½“ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­æ— æ³•ç›´æ¥è®¿é—®Windowï¼Œå¯¹Windowçš„è®¿é—®å¿…é¡»é€šè¿‡WindowMangerã€‚</p><h4 id="Windowçš„æ·»åŠ è¿‡ç¨‹"><a href="#Windowçš„æ·»åŠ è¿‡ç¨‹" class="headerlink" title="Windowçš„æ·»åŠ è¿‡ç¨‹"></a>Windowçš„æ·»åŠ è¿‡ç¨‹</h4><p>ã€€ã€€Windowçš„æ·»åŠ è¿‡ç¨‹éœ€è¦é€šè¿‡WindowManagerçš„addViewæ¥å®ç°ï¼ŒWindowManageræ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒçš„çœŸæ­£å®ç°æ˜¯WindowManagerImplç±»ï¼Œåœ¨WindowManagerImplä¸­Windowçš„ä¸‰å¤§æ“ä½œå®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addView</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> View view, <span class="hljs-meta">@NonNull</span> ViewGroup.LayoutParams params)</span> &#123;<br>       applyDefaultToken(params);<br>       mGlobal.addView(view, params, mContext.getDisplay(), mParentWindow);<br>   &#125;<br>   <br><span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateViewLayout</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> View view, <span class="hljs-meta">@NonNull</span> ViewGroup.LayoutParams params)</span> &#123;<br>       applyDefaultToken(params);<br>       mGlobal.updateViewLayout(view, params);<br>   &#125;<br><br><span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeView</span><span class="hljs-params">(View view)</span> &#123;<br>       mGlobal.removeView(view, <span class="hljs-literal">false</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeViewImmediate</span><span class="hljs-params">(View view)</span> &#123;<br>       mGlobal.removeView(view, <span class="hljs-literal">true</span>);<br>   &#125;<br></code></pre></td></tr></table></figure><p>ã€€ã€€WindowManagerImplå¹¶æ²¡æœ‰ç›´æ¥å®ç°Windowçš„ä¸‰å¤§æ“ä½œï¼Œè€Œæ˜¯å…¨éƒ¨äº¤ç»™äº†WindowManagerGlobalæ¥å¤„ç†ï¼ŒWindowManagerGlobalä»¥å·¥å‚çš„å½¢å¼å‘å¤–æä¾›è‡ªå·±çš„å®ç°ï¼ŒWindowManagerImplè¿™ç§å·¥ä½œæ¨¡å¼æ˜¯å…¸å‹çš„æ¡¥æ¥æ¨¡å¼ï¼Œå°†æ‰€æœ‰çš„æ“ä½œå…¨éƒ¨å§”æ‰˜ç»™WindowManagerGlobalæ¥å®ç°ã€‚åœ¨WindowManagerGlobalçš„addViewæ–¹æ³•ä¸»è¦åˆ†ä¸ºå¦‚ä¸‹å‡ æ­¥ï¼š</p><ol><li><strong>æ£€æŸ¥å‚æ•°æ˜¯å¦åˆæ³•ï¼Œå¦‚æœæ˜¯å­Windowï¼Œé‚£ä¹ˆè¿˜éœ€è¦è°ƒæ•´ä¸€äº›å¸ƒå±€å‚æ•°ã€‚</strong></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addView</span><span class="hljs-params">(View view, ViewGroup.LayoutParams params,</span><br><span class="hljs-params">           Display display, Window parentWindow)</span> &#123;<br>       <span class="hljs-keyword">if</span> (view == <span class="hljs-literal">null</span>) &#123;<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;view must not be null&quot;</span>);<br>       &#125;<br>       <span class="hljs-keyword">if</span> (display == <span class="hljs-literal">null</span>) &#123;<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;display must not be null&quot;</span>);<br>       &#125;<br>       <span class="hljs-keyword">if</span> (!(params <span class="hljs-keyword">instanceof</span> WindowManager.LayoutParams)) &#123;<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Params must be WindowManager.LayoutParams&quot;</span>);<br>       &#125;<br><br>       <span class="hljs-keyword">final</span> WindowManager.<span class="hljs-type">LayoutParams</span> <span class="hljs-variable">wparams</span> <span class="hljs-operator">=</span> (WindowManager.LayoutParams) params;<br>       <span class="hljs-keyword">if</span> (parentWindow != <span class="hljs-literal">null</span>) &#123;<br>           parentWindow.adjustLayoutParamsForSubWindow(wparams);<br>       &#125; <span class="hljs-keyword">else</span> &#123;<br>           <span class="hljs-comment">// If there&#x27;s no parent, then hardware acceleration for this view is</span><br>           <span class="hljs-comment">// set from the application&#x27;s hardware acceleration setting.</span><br>           <span class="hljs-keyword">final</span> <span class="hljs-type">Context</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> view.getContext();<br>           <span class="hljs-keyword">if</span> (context != <span class="hljs-literal">null</span><br>                   &amp;&amp; (context.getApplicationInfo().flags<br>                           &amp; ApplicationInfo.FLAG_HARDWARE_ACCELERATED) != <span class="hljs-number">0</span>) &#123;<br>               wparams.flags |= WindowManager.LayoutParams.FLAG_HARDWARE_ACCELERATED;<br>           &#125;<br>       &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li><strong>åˆ›å»ºViewRootImplå¹¶å°†Viewæ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚</strong><br>åœ¨WindowManagerGlobalå†…éƒ¨æœ‰å¦‚ä¸‹å‡ ä¸ªåˆ—è¡¨æ¯”è¾ƒé‡è¦ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArrayList&lt;View&gt; mViews = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;View&gt;();<br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArrayList&lt;ViewRootImpl&gt; mRoots = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;ViewRootImpl&gt;();<br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArrayList&lt;WindowManager.LayoutParams&gt; mParams =<br>           <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;WindowManager.LayoutParams&gt;();<br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArraySet&lt;View&gt; mDyingViews = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArraySet</span>&lt;View&gt;();<br></code></pre></td></tr></table></figure><p>ã€€ã€€åœ¨ä»¥ä¸Šå£°æ˜ä¸­ï¼ŒmViewå­˜å‚¨çš„æ˜¯å¤šæœ‰WIndowæ‰€å¯¹åº”çš„View,mRootså­˜å‚¨çš„æ˜¯æ‰€æœ‰Windowæ‰€å¯¹åº”çš„ViewRootImplï¼ŒmParamså­˜å‚¨çš„æ˜¯æ‰€æœ‰Windowæ‰€å¯¹åº”çš„å¸ƒå±€å‚æ•°ï¼Œè€ŒmDyingViewåˆ™å­˜å‚¨äº†é‚£äº›æ­£åœ¨è¢«åˆ é™¤çš„Viewå¯¹è±¡ï¼Œæˆ–è€…è¯´æ˜¯é‚£äº›å·²ç»è°ƒç”¨removeViewæ–¹æ³•ä½†æ˜¯åˆ é™¤æ“ä½œè¿˜æœªå®Œæˆçš„Windowå¯¹è±¡ï¼Œåœ¨addViewä¸­é€šè¿‡å¦‚ä¸‹æ–¹å¼å°†Windowçš„ä¸€ç³»åˆ—å¯¹è±¡æ·»åŠ åˆ°åˆ—è¡¨ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">root = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ViewRootImpl</span>(view.getContext(), display);<br>   view.setLayoutParams(wparams);<br>   mViews.add(view);<br>   mRoots.add(root);<br>   mParams.add(wparams);<br></code></pre></td></tr></table></figure><ol start="3"><li><strong>é€šè¿‡ViewRootImplæ¥æ›´æ–°ç•Œé¢å¹¶å®ŒæˆWindowçš„æ·»åŠ è¿‡ç¨‹ã€‚</strong><br>è¿™ä¸ªè¿‡ç¨‹ç”±ViewRootImplçš„setViewæ–¹æ³•æ¥å®Œæˆï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// do this last because it fires off messages to start doing things</span><br>       <span class="hljs-keyword">try</span> &#123;<br>           root.setView(view, wparams, panelParentView);<br>       &#125; <span class="hljs-keyword">catch</span> (RuntimeException e) &#123;<br>           <span class="hljs-comment">// BadTokenException or InvalidDisplayException, clean up.</span><br>           <span class="hljs-keyword">synchronized</span> (mLock) &#123;<br>               <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> findViewLocked(view, <span class="hljs-literal">false</span>);<br>               <span class="hljs-keyword">if</span> (index &gt;= <span class="hljs-number">0</span>) &#123;<br>                   removeViewLocked(index, <span class="hljs-literal">true</span>);<br>               &#125;<br>           &#125;<br>           <span class="hljs-keyword">throw</span> e;<br>       &#125;<br></code></pre></td></tr></table></figure>åœ¨setViewå†…éƒ¨ä¼šé€šè¿‡requestLayoutæ¥å®Œæˆå¼‚æ­¥åˆ·æ–°è¯·æ±‚ã€‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼ŒscheduleTraversalså®é™…æ˜¯Viewç»˜åˆ¶çš„å…¥å£ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">requestLayout</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-keyword">if</span> (!mHandlingLayoutInLayoutRequest) &#123;<br>           checkThread();<br>           mLayoutRequested = <span class="hljs-literal">true</span>;<br>           scheduleTraversals();<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure>æ¥ç€ä¼šé€šè¿‡WindowSessionæœ€ç»ˆæ¥å®ŒæˆWindowçš„æ·»åŠ è¿‡ç¨‹ã€‚<h4 id="Windowçš„åˆ é™¤è¿‡ç¨‹"><a href="#Windowçš„åˆ é™¤è¿‡ç¨‹" class="headerlink" title="Windowçš„åˆ é™¤è¿‡ç¨‹"></a>Windowçš„åˆ é™¤è¿‡ç¨‹</h4>Windowçš„åˆ é™¤è¿‡ç¨‹å’Œæ·»åŠ è¿‡ç¨‹ä¸€æ ·ï¼Œéƒ½æ˜¯å…ˆé€šè¿‡WindowManagerImplåï¼Œå†è¿›ä¸€æ­¥é€šè¿‡WindowManagerGlobalæ¥å®ç°çš„ï¼Œå¦‚ä¸‹ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeView</span><span class="hljs-params">(View view, <span class="hljs-type">boolean</span> immediate)</span> &#123;<br>        <span class="hljs-keyword">if</span> (view == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;view must not be null&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">synchronized</span> (mLock) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> findViewLocked(view, <span class="hljs-literal">true</span>);<br>            <span class="hljs-type">View</span> <span class="hljs-variable">curView</span> <span class="hljs-operator">=</span> mRoots.get(index).getView();<br>            removeViewLocked(index, immediate);<br>            <span class="hljs-keyword">if</span> (curView == view) &#123;<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;Calling with view &quot;</span> + view<br>                    + <span class="hljs-string">&quot; but the ViewAncestor is attached to &quot;</span> + curView);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>ã€€ã€€removeViewçš„é€»è¾‘å¾ˆæ¸…æ™°ï¼Œé¦–å…ˆé€šè¿‡findViewLockedæ¥æŸ¥æ‰¾å¾…åˆ é™¤çš„Viewçš„ç´¢å¼•ï¼Œè¿™ä¸ªæŸ¥æ‰¾è¿‡ç¨‹å°±æ˜¯å»ºç«‹çš„æ•°æ®éå†ï¼Œç„¶åå†é€šè¿‡è°ƒç”¨removeViewLockedæ¥åšè¿›ä¸€æ­¥çš„åˆ é™¤ï¼Œå¦‚ä¸‹ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeViewLocked</span><span class="hljs-params">(<span class="hljs-type">int</span> index, <span class="hljs-type">boolean</span> immediate)</span> &#123;<br>        <span class="hljs-type">ViewRootImpl</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> mRoots.get(index);<br>        <span class="hljs-type">View</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> root.getView();<br><br>        <span class="hljs-keyword">if</span> (view != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-type">InputMethodManager</span> <span class="hljs-variable">imm</span> <span class="hljs-operator">=</span> InputMethodManager.getInstance();<br>            <span class="hljs-keyword">if</span> (imm != <span class="hljs-literal">null</span>) &#123;<br>                imm.windowDismissed(mViews.get(index).getWindowToken());<br>            &#125;<br>        &#125;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">deferred</span> <span class="hljs-operator">=</span> root.die(immediate);<br>        <span class="hljs-keyword">if</span> (view != <span class="hljs-literal">null</span>) &#123;<br>            view.assignParent(<span class="hljs-literal">null</span>);<br>            <span class="hljs-keyword">if</span> (deferred) &#123;<br>                mDyingViews.add(view);<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>ã€€ã€€removeViewLockedæ˜¯é€šè¿‡ViewRootImplæ¥å®Œæˆåˆ é™¤æ“ä½œçš„ï¼Œåœ¨WindowManagerä¸­æä¾›äº†ä¸¤ç§åˆ é™¤æ¥å£removeViewå’ŒremoveViewImmediate,å®ƒä»¬åˆ†åˆ«è¡¨ç¤ºå¼‚æ­¥åˆ é™¤å’ŒåŒæ­¥åˆ é™¤ï¼Œä¸€èˆ¬ä¸éœ€è¦ä½¿ç”¨removeViewImmediateè¿™ä¸ªæ–¹æ³•ã€‚è¿™é‡Œä¸»è¦è¯´å¼‚æ­¥åˆ é™¤çš„æƒ…å†µï¼šå…·ä½“çš„åˆ é™¤æ“ä½œç”±ViewRootImplçš„dieæ–¹æ³•æ¥å®Œæˆï¼Œåœ¨å¼‚æ­¥åˆ é™¤çš„æƒ…å†µä¸‹ï¼Œdieæ–¹æ³•åªæ˜¯å‘é€äº†ä¸€ä¸ªè¯·æ±‚åˆ é™¤çš„æ¶ˆæ¯åå°±ç«‹åˆ»è¿”å›äº†ï¼Œ<strong>è¿™ä¸ªæ—¶å€™Viewå¹¶æ²¡æœ‰å®Œæˆåˆ é™¤æ“ä½œ</strong>ï¼Œæ‰€ä»¥æœ€åä¼šå°†å…¶æ·»åŠ åˆ°mDyingViewä¸­ã€‚ViewRootImplçš„dieæ–¹æ³•å¦‚ä¸‹ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">boolean</span> <span class="hljs-title function_">die</span><span class="hljs-params">(<span class="hljs-type">boolean</span> immediate)</span> &#123;<br>   <span class="hljs-comment">// Make sure we do execute immediately if we are in the middle of a traversal or the damage</span><br>   <span class="hljs-comment">// done by dispatchDetachedFromWindow will cause havoc on return.</span><br>   <span class="hljs-keyword">if</span> (immediate &amp;&amp; !mIsInTraversal) &#123;<br>       doDie();<br>       <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>   &#125;<br><br>   <span class="hljs-keyword">if</span> (!mIsDrawing) &#123;<br>       destroyHardwareRenderer();<br>   &#125; <span class="hljs-keyword">else</span> &#123;<br>       Log.e(mTag, <span class="hljs-string">&quot;Attempting to destroy the window while drawing!\n&quot;</span> +<br>               <span class="hljs-string">&quot;  window=&quot;</span> + <span class="hljs-built_in">this</span> + <span class="hljs-string">&quot;, title=&quot;</span> + mWindowAttributes.getTitle());<br>   &#125;<br>   mHandler.sendEmptyMessage(MSG_DIE);<br>   <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>   &#125;<br></code></pre></td></tr></table></figure>ã€€ã€€åœ¨dieæ–¹æ³•ä¸­åªæ˜¯åšäº†ç®€å•çš„åˆ¤æ–­ï¼Œå¦‚æœæ˜¯å¼‚æ­¥åˆ é™¤ï¼Œé‚£ä¹ˆå°±å‘é€ä¸€ä¸ªMSG_DIEçš„æ¶ˆæ¯ï¼ŒViewRootImplä¸­çš„Handlerä¼šå¤„ç†æ­¤æ¶ˆæ¯å¹¶è°ƒç”¨doDieæ–¹æ³•ï¼Œå¦‚æœæ˜¯åŒæ­¥åˆ é™¤ï¼Œé‚£ä¹ˆå°±ä¸å‘é€æ¶ˆæ¯ç›´æ¥è°ƒç”¨doDieæ–¹æ³•ã€‚åœ¨doDieå†…éƒ¨ä¼šè°ƒç”¨dispatchDetachedFromWindowæ–¹æ³•ï¼ŒçœŸæ­£åˆ é™¤Viewçš„é€»è¾‘åœ¨dispatchDetachedFromWindowæ–¹æ³•å†…éƒ¨å®ç°ã€‚dispatchDetachedFromWindowæ–¹æ³•ä¸»è¦åšå››ä»¶äº‹ï¼š</li><li>åƒåœ¾å›æ”¶ç›¸å…³çš„å·¥ä½œï¼Œæ¯”å¦‚æ¸…é™¤æ•°æ®å’Œæ¶ˆæ¯ï¼Œç§»é™¤å›è°ƒç­‰ã€‚</li><li>é€šè¿‡Sessionçš„removeæ–¹æ³•åˆ é™¤Windowï¼šmWindowSession.remove(mWindow)ï¼Œè¿™åŒæ ·æ˜¯ä¸€ä¸ªIPCè¿‡ç¨‹ï¼Œæœ€ç»ˆä¼šè°ƒç”¨WindowManagerServiceçš„removeWindowæ–¹æ³•ã€‚</li><li>è°ƒç”¨Viewçš„dispatchDetachedFromWindowæ–¹æ³•ï¼Œåœ¨å†…éƒ¨ä¼šè°ƒç”¨Viewçš„onDetachedFromWindowä»¥åŠonDetachedFromWindowInternal()ã€‚</li><li>è°ƒç”¨WindowManagerGlobalçš„doRemoveViewæ–¹æ³•åˆ·æ–°æ•°æ®ï¼ŒåŒ…æ‹¬mRootsã€mParamsä»¥åŠmDyingViewsï¼Œéœ€è¦å°†å½“å‰Windowé”å…³è”çš„è¿™ä¸‰ç±»å¯¹è±¡ä»åˆ—è¡¨ä¸­åˆ é™¤ã€‚<h4 id="Windowçš„æ›´æ–°è¿‡ç¨‹"><a href="#Windowçš„æ›´æ–°è¿‡ç¨‹" class="headerlink" title="Windowçš„æ›´æ–°è¿‡ç¨‹"></a>Windowçš„æ›´æ–°è¿‡ç¨‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateViewLayout</span><span class="hljs-params">(View view, ViewGroup.LayoutParams params)</span> &#123;<br>       <span class="hljs-keyword">if</span> (view == <span class="hljs-literal">null</span>) &#123;<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;view must not be null&quot;</span>);<br>       &#125;<br>       <span class="hljs-keyword">if</span> (!(params <span class="hljs-keyword">instanceof</span> WindowManager.LayoutParams)) &#123;<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Params must be WindowManager.LayoutParams&quot;</span>);<br>       &#125;<br><br>       <span class="hljs-keyword">final</span> WindowManager.<span class="hljs-type">LayoutParams</span> <span class="hljs-variable">wparams</span> <span class="hljs-operator">=</span> (WindowManager.LayoutParams)params;<br><br>       view.setLayoutParams(wparams);<br><br>       <span class="hljs-keyword">synchronized</span> (mLock) &#123;<br>           <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> findViewLocked(view, <span class="hljs-literal">true</span>);<br>           <span class="hljs-type">ViewRootImpl</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> mRoots.get(index);<br>           mParams.remove(index);<br>           mParams.add(index, wparams);<br>           root.setLayoutParams(wparams, <span class="hljs-literal">false</span>);<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure>é¦–å…ˆå®ƒéœ€è¦æ›´æ–°Viewçš„LayoutParamså¹¶æ›¿æ¢æ‰è€çš„LayoutParamsï¼Œæ¥ç€å†æ›´æ–°ViewRootImplä¸­çš„layoutParamsï¼Œè¿™ä¸€æ­¥æ˜¯é€šè¿‡ViewRootImplçš„setLayoutParamsæ–¹æ³•æ¥å®ç°çš„ã€‚åœ¨ViewRootImplä¸­ä¼šé€šè¿‡scheduleTraversalsæ–¹æ³•æ¥å¯¹Viewé‡æ–°å¸ƒå±€ï¼ŒåŒ…æ‹¬æµ‹é‡ã€å¸ƒå±€ã€é‡ç»˜è¿™ä¸‰ä¸ªè¿‡ç¨‹ï¼Œé™¤äº†Viewæœ¬èº«çš„é‡ç»˜ä»¥å¤–ï¼ŒViewRootImplè¿˜ä¼šé€šè¿‡WindowSessionå¼€æ›´æ–°Windowçš„è§†å›¾ï¼Œè¿™ä¸ªè¿‡ç¨‹æœ€ç»ˆæ˜¯ç”±WindowManagerServiceçš„relayoutWindow()æ¥å…·ä½“å®ç°ï¼Œå®ƒåŒæ ·æ˜¯ä¸€ä¸ªIPCçš„è¿‡ç¨‹ã€‚</li></ol><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç®€å•çš„æ¡Œé¢å°éƒ¨ä»¶</title>
    <link href="/2017/03/20/%E7%AE%80%E5%8D%95%E7%9A%84%E6%A1%8C%E9%9D%A2%E5%B0%8F%E9%83%A8%E4%BB%B6/"/>
    <url>/2017/03/20/%E7%AE%80%E5%8D%95%E7%9A%84%E6%A1%8C%E9%9D%A2%E5%B0%8F%E9%83%A8%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<p>å®ç°ä¸€ä¸ªç®€å•çš„æ¡Œé¢å°éƒ¨ä»¶ï¼Œå“åº”ç‚¹å‡»äº‹ä»¶ï¼Œæ›´æ–°ç­‰åŠŸèƒ½ã€‚</p><ol><li>å®šä¹‰å°éƒ¨ä»¶ç•Œé¢</li><li>å®šä¹‰å°éƒ¨ä»¶é…ç½®ä¿¡æ¯</li><li>å®šä¹‰å°éƒ¨ä»¶çš„å®ç°ç±»</li><li>å£°æ˜å°éƒ¨ä»¶<br>åœ¨AndroidStudioä¸­åªéœ€è¦åœ¨<code>main\java</code>ä¸‹æ–°å»ºä¸€ä¸ª<code>widget</code>,å°±å¯ä»¥äº†ï¼ŒIDEä¼šè‡ªåŠ¨åœ¨<code>res\layout</code>æ·»åŠ å¸ƒå±€æ–‡ä»¶ï¼Œåœ¨<code>res\xml</code>ä¸‹æ–°å»ºé…ç½®ä¿¡æ¯æ–‡ä»¶ã€‚ç„¶åå°±å¯ä»¥è¿›è¡Œå…·ä½“å®ç°äº†ã€‚</li></ol><span id="more"></span><p><img src="/image/new_widget.png" alt="ASä¸‹æ–°å»ºwidget"></p><h3 id="å®šä¹‰å°éƒ¨ä»¶ç•Œé¢"><a href="#å®šä¹‰å°éƒ¨ä»¶ç•Œé¢" class="headerlink" title="å®šä¹‰å°éƒ¨ä»¶ç•Œé¢"></a>å®šä¹‰å°éƒ¨ä»¶ç•Œé¢</h3><p>RemoteViewç›®å‰å¹¶ä¸èƒ½æ”¯æŒæ‰€æœ‰çš„Viewï¼Œç°åœ¨æ”¯æŒçš„ç±»å‹å¦‚ä¸‹ï¼š</p><ul><li>Layout<ul><li>FrameLayout</li><li>LinearLayout</li><li>RelativeLayout</li><li>GridLayout</li></ul></li><li>View<ul><li>AnalogClock</li><li>Button</li><li>Chronometer</li><li>ImageButton</li><li>ImageView</li><li>ProgressBar</li><li>TextView</li><li>ViewFlipper</li><li>ListView</li><li>GridView</li><li>StackView</li><li>AdapterViewFlipper</li><li>ViewStub</li></ul></li></ul><p>è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼ŒæŒ‰ç…§å†™ç•Œé¢å¸ƒå±€çš„æ–¹å¼å†™å°±å¥½äº†ï¼Œä½†æ˜¯ä¸å»ºè®®å†™è¿‡äºå¤æ‚çš„å¸ƒå±€ã€‚</p><h3 id="å®šä¹‰å°éƒ¨ä»¶é…ç½®ä¿¡æ¯"><a href="#å®šä¹‰å°éƒ¨ä»¶é…ç½®ä¿¡æ¯" class="headerlink" title="å®šä¹‰å°éƒ¨ä»¶é…ç½®ä¿¡æ¯"></a>å®šä¹‰å°éƒ¨ä»¶é…ç½®ä¿¡æ¯</h3><p>ä¸‹é¢çš„ä»£ç å°±æ˜¯IDEè‡ªåŠ¨æˆçš„é…ç½®ä¿¡æ¯æ–‡ä»¶ï¼Œä¸å–œæ¬¢IDEä»£åŠ³çš„åŒå­¦å¯ä»¥è‡ªå·±åˆ›å»ºã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">appwidget-provider</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:initialKeyguardLayout</span>=<span class="hljs-string">&quot;@layout/test_remote_view_widget&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:initialLayout</span>=<span class="hljs-string">&quot;@layout/test_remote_view_widget&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:minHeight</span>=<span class="hljs-string">&quot;40dp&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:minWidth</span>=<span class="hljs-string">&quot;40dp&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:previewImage</span>=<span class="hljs-string">&quot;@drawable/example_appwidget_preview&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:resizeMode</span>=<span class="hljs-string">&quot;horizontal|vertical&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:updatePeriodMillis</span>=<span class="hljs-string">&quot;86400000&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:widgetCategory</span>=<span class="hljs-string">&quot;home_screen&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">appwidget-provider</span>&gt;</span> <br></code></pre></td></tr></table></figure><p><code>initialLayout</code>ï¼šå¸ƒå±€æ–‡ä»¶<br><code>previewImage</code>ï¼š é¢„è§ˆçš„å›¾ç‰‡<br><code>updatePeriodMillis</code>ï¼šåˆ·æ–°å‘¨æœŸï¼Œå•ä½æ¯«ç§’</p><h3 id="å®šä¹‰å°éƒ¨ä»¶çš„å®ç°ç±»"><a href="#å®šä¹‰å°éƒ¨ä»¶çš„å®ç°ç±»" class="headerlink" title="å®šä¹‰å°éƒ¨ä»¶çš„å®ç°ç±»"></a>å®šä¹‰å°éƒ¨ä»¶çš„å®ç°ç±»</h3><p>å®ç°çš„åŠŸèƒ½æ˜¯å½“ç‚¹å‡»è¿™ä¸ªå°éƒ¨ä»¶çš„æ—¶å€™æ”¹å˜æ–‡å­—å†…å®¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestRemoteViewWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppWidgetProvider</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CLICK_ACTION</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;com.huangyuan.testwidget.TAP_CLICK_ACTION&quot;</span>;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onReceive(context, intent);<br>        Toast.makeText(context,<span class="hljs-string">&quot;onReceive:&quot;</span> + intent.getAction(),Toast.LENGTH_SHORT).show();<br>        <span class="hljs-keyword">if</span>(intent.getAction().equals(CLICK_ACTION))&#123;<br>            <span class="hljs-type">AppWidgetManager</span> <span class="hljs-variable">appWidgetManager</span> <span class="hljs-operator">=</span> AppWidgetManager.getInstance(context);<br>            <span class="hljs-type">RemoteViews</span> <span class="hljs-variable">remoteViews</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RemoteViews</span>(context.getPackageName(),R.layout.test_remote_view_widget);<br>            remoteViews.setTextViewText(R.id.appwidget_text,<span class="hljs-string">&quot;ç‚¹å‡»&quot;</span>);<br>            appWidgetManager.updateAppWidget(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ComponentName</span>(context,TestRemoteViewWidget.class),remoteViews);<br>        &#125;<br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onUpdate</span><span class="hljs-params">(Context context, AppWidgetManager appWidgetManager, <span class="hljs-type">int</span>[] appWidgetIds)</span> &#123;<br>        Toast.makeText(context,<span class="hljs-string">&quot;onUpdate&quot;</span> ,Toast.LENGTH_SHORT).show();<br>        <span class="hljs-type">RemoteViews</span> <span class="hljs-variable">remoteViews</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RemoteViews</span>(context.getPackageName(),R.layout.test_remote_view_widget);<br>        <span class="hljs-type">Intent</span> <span class="hljs-variable">clickIntent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>();<br>        clickIntent.setAction(CLICK_ACTION);<br>        <span class="hljs-type">PendingIntent</span> <span class="hljs-variable">pendingIntent</span> <span class="hljs-operator">=</span> PendingIntent.getBroadcast(context,<span class="hljs-number">0</span>,clickIntent,<span class="hljs-number">0</span>);<br>        remoteViews.setOnClickPendingIntent(R.id.appwidget_text,pendingIntent);<br>        appWidgetManager.updateAppWidget(appWidgetIds,remoteViews);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­è¿˜æœ‰å…¶ä»–æ–¹æ³•ï¼š</p><ul><li>onEnabled:å½“è¯¥çª—å£å°éƒ¨ä»¶ç¬¬ä¸€æ¬¡æ·»åŠ åˆ°æ¡Œé¢æ—¶è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå¯æ·»åŠ å¤šæ¬¡ï¼Œä½†åªåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨</li><li>onUpdate:å°éƒ¨ä»¶è¢«æ·»åŠ æ—¶æˆ–è€…æ¯æ¬¡å°éƒ¨ä»¶æ›´æ–°æ—¶éƒ½ä¼šè°ƒç”¨ä¸€æ¬¡è¯¥æ–¹æ³•ï¼Œå°éƒ¨ä»¶çš„æ›´æ–°æ—¶æœºç”±<code>updatePeriodMillis</code>æŒ‡å®šã€‚</li><li>onDeleted:æ¯åˆ é™¤ä¸€æ¬¡æ¡Œé¢å°éƒ¨ä»¶å°±è°ƒç”¨ä¸€æ¬¡ã€‚</li><li>onDisabled:å½“æœ€åä¸€ä¸ªè¯¥ç±»å‹çš„æ¡Œé¢å°éƒ¨ä»¶è¢«åˆ é™¤æ—¶è°ƒç”¨è¯¥æ–¹æ³•ï¼Œè¿½æ—¶æœ€åä¸€ä¸ªã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ›´æ–°remoteViewæ—¶ï¼Œä¸èƒ½ç›´æ¥è®¿é—®é‡Œé¢çš„View,éœ€è¦é€šè¿‡RemoteViewæ‰€æä¾›çš„ä¸€ç³»åˆ—æ–¹æ³•æ›´æ–°Viewã€‚</li><li>æ›´æ–°æ–‡æœ¬ï¼š remoteViews.setTextViewText();</li><li>æ›´æ–°å›¾ç‰‡ï¼š remoteViews.setImageViewResource();remoteViews.setImageViewBitmap();</li><li>æ·»åŠ å•å‡»äº‹ä»¶ï¼šremoteViews.setOnClickPendingIntent();</li></ul><hr>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é€šè¿‡ç®€å•çš„è‡ªå®šä¹‰viewæ¥çœ‹Viewçš„å·¥ä½œæµç¨‹</title>
    <link href="/2017/03/18/%E9%80%9A%E8%BF%87%E7%AE%80%E5%8D%95%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89view%E6%9D%A5%E7%9C%8BView%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/"/>
    <url>/2017/03/18/%E9%80%9A%E8%BF%87%E7%AE%80%E5%8D%95%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89view%E6%9D%A5%E7%9C%8BView%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<p>é€šè¿‡ç®€å•çš„è‡ªå®šä¹‰View(ç”»ä¸ªåœ†)ï¼Œæ¥äº†è§£ä¸€ä¸‹Viewçš„å·¥ä½œæµç¨‹ä»¥åŠè‡ªå®šä¹‰Viewåº”è¯¥æ³¨æ„çš„åœ°æ–¹ã€‚</p><span id="more"></span><h3 id="ä¸€ã€è‡ªå®šä¹‰Viewçš„åˆ†ç±»"><a href="#ä¸€ã€è‡ªå®šä¹‰Viewçš„åˆ†ç±»" class="headerlink" title="ä¸€ã€è‡ªå®šä¹‰Viewçš„åˆ†ç±»"></a>ä¸€ã€è‡ªå®šä¹‰Viewçš„åˆ†ç±»</h3><h4 id="1-1-ç»§æ‰¿Viewé‡å†™onDrawæ–¹æ³•"><a href="#1-1-ç»§æ‰¿Viewé‡å†™onDrawæ–¹æ³•" class="headerlink" title="1.1 ç»§æ‰¿Viewé‡å†™onDrawæ–¹æ³•"></a>1.1 ç»§æ‰¿Viewé‡å†™onDrawæ–¹æ³•</h4><p>è¿™ç§æ–¹æ³•ä¸»è¦ç”¨äºå®ç°ä¸€äº›ä¸è§„åˆ™çš„æ•ˆæœï¼Œæ¯”å¦‚åŠ¨æ€æˆ–è€…é™æ€æ˜¾ç¤ºä¸€äº›ä¸è§„åˆ™çš„å›¾å½¢ï¼Œé‡‡ç”¨è¿™ç§æ–¹å¼éœ€è¦è‡ªå·±æ”¯æŒ<code>wrap_content</code>,å¹¶ä¸”<code>padding</code>éœ€è¦è‡ªå·±å¤„ç†.</p><h4 id="1-2-ç»§æ‰¿ViewGroupæ´¾ç”Ÿç‰¹æ®Šçš„Layout"><a href="#1-2-ç»§æ‰¿ViewGroupæ´¾ç”Ÿç‰¹æ®Šçš„Layout" class="headerlink" title="1.2 ç»§æ‰¿ViewGroupæ´¾ç”Ÿç‰¹æ®Šçš„Layout"></a>1.2 ç»§æ‰¿ViewGroupæ´¾ç”Ÿç‰¹æ®Šçš„Layout</h4><p>è¿™ç§æ–¹å¼ä¸»è¦ç”¨äºå®ç°è‡ªå®šä¹‰å¸ƒå±€ï¼Œå¦‚æµå¼å¸ƒå±€ã€‚é‡‡ç”¨è¿™ç§æ–¹å¼éœ€è¦åˆé€‚çš„å¤„ç†ViewGroupçš„æµ‹é‡ã€å¸ƒå±€è¿™ä¸¤ä¸ªè¿‡ç¨‹ï¼Œå¹¶åŒæ—¶å¤„ç†å­å…ƒç´ çš„æµ‹é‡å’Œå¸ƒå±€è¿‡ç¨‹ã€‚</p><h4 id="1-3-ç»§æ‰¿ç‰¹å®šçš„View-å¦‚TextView"><a href="#1-3-ç»§æ‰¿ç‰¹å®šçš„View-å¦‚TextView" class="headerlink" title="1.3 ç»§æ‰¿ç‰¹å®šçš„View(å¦‚TextView)"></a>1.3 ç»§æ‰¿ç‰¹å®šçš„View(å¦‚TextView)</h4><p>è¿™ç§æ–¹æ³•ä¸€èˆ¬ç”¨äºæ‰©å±•æŸç§å·²æœ‰çš„<code>View</code>çš„åŠŸèƒ½ï¼Œæ¯”å¦‚<code>TextView</code>ï¼Œè¿™ç§æ–¹æ³•æ¯”è¾ƒå®¹æ˜“å®ç°ï¼Œä¸éœ€è¦è‡ªå·±æ”¯æŒ<code>wrap_content</code>å’Œ<code>padding</code>ã€‚</p><h4 id="1-4-ç»§æ‰¿ç‰¹å®šçš„ViewGroup"><a href="#1-4-ç»§æ‰¿ç‰¹å®šçš„ViewGroup" class="headerlink" title="1.4 ç»§æ‰¿ç‰¹å®šçš„ViewGroup"></a>1.4 ç»§æ‰¿ç‰¹å®šçš„ViewGroup</h4><p>é‡‡ç”¨è¿™ç§æ–¹å¼ä¸éœ€è¦è‡ªå·±å¤„ç†<code>ViewGroup</code>çš„æµ‹é‡å’Œå¸ƒå±€è¿™ä¸¤ä¸ªè¿‡ç¨‹ã€‚</p><h3 id="äºŒã€å€¼å¾—æ³¨æ„çš„åœ°æ–¹"><a href="#äºŒã€å€¼å¾—æ³¨æ„çš„åœ°æ–¹" class="headerlink" title="äºŒã€å€¼å¾—æ³¨æ„çš„åœ°æ–¹"></a>äºŒã€å€¼å¾—æ³¨æ„çš„åœ°æ–¹</h3><h4 id="2-1-è®©Viewæ”¯æŒwrap-content"><a href="#2-1-è®©Viewæ”¯æŒwrap-content" class="headerlink" title="2.1 è®©Viewæ”¯æŒwrap_content"></a>2.1 è®©Viewæ”¯æŒwrap_content</h4><p>è¿™æ˜¯å› ä¸ºç›´æ¥ç»§æ‰¿Viewæˆ–è€…ViewGroupçš„æ§ä»¶ï¼Œå¦‚æœä¸åœ¨<code>onMeasure</code>ä¸­å¯¹<code>wrap_content</code>åšç‰¹æ®Šå¤„ç†ï¼Œé‚£ä¹ˆå½“å¤–ç•Œåœ¨é€‚ç”¨<code>wrap_content</code>æ—¶å°±æ— æ³•è¾¾åˆ°é¢„æœŸçš„æ•ˆæœã€‚</p><h4 id="2-2-å¦‚æœæœ‰å¿…è¦ï¼Œè®©Viewæ”¯æŒpadding"><a href="#2-2-å¦‚æœæœ‰å¿…è¦ï¼Œè®©Viewæ”¯æŒpadding" class="headerlink" title="2.2 å¦‚æœæœ‰å¿…è¦ï¼Œè®©Viewæ”¯æŒpadding"></a>2.2 å¦‚æœæœ‰å¿…è¦ï¼Œè®©Viewæ”¯æŒpadding</h4><p>è¿™æ˜¯å› ä¸ºå¦‚æœç›´æ¥ç»§æ‰¿Viewï¼Œå¦‚æœä¸åœ¨drawæ–¹æ³•ä¸­å¤„ç†paddingï¼Œé‚£ä¹ˆpaddingå±æ€§æ˜¯æ— æ³•èµ·ä½œç”¨çš„ã€‚å¦å¤–ï¼Œç›´æ¥ç»§æ‰¿è‡ªViewGroupçš„æ§ä»¶éœ€è¦åœ¨<code>onMeasure</code>å’Œ<code>onLayout</code>ä¸­è€ƒè™‘paddingå’Œå­å…ƒç´ çš„marginå¯¹å…¶é€ æˆçš„å½±å“ï¼Œä¸ç„¶å°†å¯¼è‡´paddingå’Œå­å…ƒç´ çš„marginå¤±æ•ˆã€‚</p><h4 id="2-3-å°½é‡ä¸è¦åœ¨Viewä¸­ä½¿ç”¨Handlerï¼Œæ²¡å¿…è¦"><a href="#2-3-å°½é‡ä¸è¦åœ¨Viewä¸­ä½¿ç”¨Handlerï¼Œæ²¡å¿…è¦" class="headerlink" title="2.3 å°½é‡ä¸è¦åœ¨Viewä¸­ä½¿ç”¨Handlerï¼Œæ²¡å¿…è¦"></a>2.3 å°½é‡ä¸è¦åœ¨Viewä¸­ä½¿ç”¨Handlerï¼Œæ²¡å¿…è¦</h4><p>å› ä¸ºViewå†…éƒ¨æœ¬èº«å°±æä¾›äº†postç³»åˆ—çš„æ–¹æ³•ï¼Œ å®Œå…¨å¯ä»¥æ›¿ä»£Handlerçš„ä½œç”¨ï¼Œå½“ç„¶é™¤éä½ å¾ˆæ˜ç¡®è¦ä½¿ç”¨Handleræ¥å‘é€æ¶ˆæ¯</p><h4 id="2-4-åŠæ—¶åœæ­¢åŠ¨ç”»å’Œçº¿ç¨‹"><a href="#2-4-åŠæ—¶åœæ­¢åŠ¨ç”»å’Œçº¿ç¨‹" class="headerlink" title="2.4 åŠæ—¶åœæ­¢åŠ¨ç”»å’Œçº¿ç¨‹"></a>2.4 åŠæ—¶åœæ­¢åŠ¨ç”»å’Œçº¿ç¨‹</h4><p>å¦‚æœéœ€è¦åœæ­¢çº¿ç¨‹æˆ–è€…åŠ¨ç”»ï¼Œå¯ä»¥åœ¨<code>onDetachedFromWindow</code>æ–¹æ³•ä¸­å¤„ç†ï¼Œå½“åŒ…å«æ­¤Viewçš„Activityé€€å‡ºæˆ–è€…å½“å‰Viewè¢«removeæ—¶ï¼ŒViewçš„<code>onDetachedFromWindow</code>æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œå’Œæ­¤æ–¹æ³•å¯¹åº”çš„æ˜¯<code>onAttachedToWindow</code>ï¼Œå½“åŒ…å«æ­¤Viewçš„Activityå¯åŠ¨æ—¶ï¼ŒViewçš„<code>onAttachedToWindow</code>æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚</p><h4 id="2-5-Viewå¸¦æœ‰æ»‘åŠ¨åµŒå¥—æƒ…å½¢æ—¶ï¼Œéœ€è¦å¤„ç†å¥½æ»‘åŠ¨å†²çª"><a href="#2-5-Viewå¸¦æœ‰æ»‘åŠ¨åµŒå¥—æƒ…å½¢æ—¶ï¼Œéœ€è¦å¤„ç†å¥½æ»‘åŠ¨å†²çª" class="headerlink" title="2.5 Viewå¸¦æœ‰æ»‘åŠ¨åµŒå¥—æƒ…å½¢æ—¶ï¼Œéœ€è¦å¤„ç†å¥½æ»‘åŠ¨å†²çª"></a>2.5 Viewå¸¦æœ‰æ»‘åŠ¨åµŒå¥—æƒ…å½¢æ—¶ï¼Œéœ€è¦å¤„ç†å¥½æ»‘åŠ¨å†²çª</h4><p>å¦‚æœæœ‰æ»‘åŠ¨å†²çªçš„è¯ï¼Œé‚£ä¹ˆè¦åˆé€‚çš„å¤„ç†æ»‘åŠ¨å†²çªï¼Œå¦åˆ™å°†ä¼šä¸¥é‡å½±å“Viewçš„æ•ˆæœã€‚</p><h3 id="ä¸‰ã€è‡ªå®šä¹‰View"><a href="#ä¸‰ã€è‡ªå®šä¹‰View" class="headerlink" title="ä¸‰ã€è‡ªå®šä¹‰View"></a>ä¸‰ã€è‡ªå®šä¹‰View</h3><h4 id="3-1-ç»§æ‰¿Viewé‡å†™onDrawæ–¹æ³•"><a href="#3-1-ç»§æ‰¿Viewé‡å†™onDrawæ–¹æ³•" class="headerlink" title="3.1 ç»§æ‰¿Viewé‡å†™onDrawæ–¹æ³•"></a>3.1 ç»§æ‰¿Viewé‡å†™onDrawæ–¹æ³•</h4><p>é¦–å…ˆæ¥çœ‹ä¸€ä¸‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestCustomCircleView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">View</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">color</span> <span class="hljs-operator">=</span> Color.RED;<br>    <span class="hljs-keyword">private</span> Paint paint;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TestCustomCircleView</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context);<br>        init();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TestCustomCircleView</span><span class="hljs-params">(Context context, AttributeSet attrs)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context, attrs);<br>        init();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TestCustomCircleView</span><span class="hljs-params">(Context context, AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);<br>        init();<br>    &#125;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span>&#123;<br>        paint = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paint</span>();<br>        paint.setColor(color);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDraw</span><span class="hljs-params">(Canvas canvas)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onDraw(canvas);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">width</span> <span class="hljs-operator">=</span> getWidth();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">height</span> <span class="hljs-operator">=</span> getHeight();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">radius</span> <span class="hljs-operator">=</span> Math.min(width,height)/<span class="hljs-number">2</span>;<br>        canvas.drawCircle(width/<span class="hljs-number">2</span>,height/<span class="hljs-number">2</span>,radius,paint);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç åªæ˜¯ä¸€ç§åˆçº§çš„å®ç°ï¼Œå½“æˆ‘ä»¬è¿›è¡Œä½¿ç”¨çš„æ—¶å€™ï¼Œåªæ”¯æŒmarginå±æ€§ï¼Œå¹¶ä¸æ”¯æŒpaddingå±æ€§ã€‚å¯¹<code>onDraw</code>æ–¹æ³•è¿›è¡Œä¿®æ”¹ï¼Œåªè¦åœ¨ç»˜åˆ¶çš„æ—¶å€™è€ƒè™‘ä¸€ä¸‹paddingå³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDraw</span><span class="hljs-params">(Canvas canvas)</span> &#123;<br>       <span class="hljs-built_in">super</span>.onDraw(canvas);<br>       <span class="hljs-type">int</span> <span class="hljs-variable">paddingLeft</span> <span class="hljs-operator">=</span> getPaddingLeft();<br>       <span class="hljs-type">int</span> <span class="hljs-variable">paddingRight</span> <span class="hljs-operator">=</span> getPaddingRight();<br>       <span class="hljs-type">int</span> <span class="hljs-variable">paddingTop</span> <span class="hljs-operator">=</span> getPaddingTop();<br>       <span class="hljs-type">int</span> <span class="hljs-variable">paddingBottom</span> <span class="hljs-operator">=</span> getPaddingBottom();<br>       <span class="hljs-type">int</span> <span class="hljs-variable">width</span> <span class="hljs-operator">=</span> getWidth() - paddingLeft - paddingRight;<br>       <span class="hljs-type">int</span> <span class="hljs-variable">height</span> <span class="hljs-operator">=</span> getHeight() - paddingBottom - paddingTop;<br>       <span class="hljs-type">int</span> <span class="hljs-variable">radius</span> <span class="hljs-operator">=</span> Math.min(width, height) / <span class="hljs-number">2</span>;<br>       canvas.drawCircle(paddingLeft + width / <span class="hljs-number">2</span>, paddingTop + height / <span class="hljs-number">2</span>, radius, paint);<br>   &#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ç°åœ¨è¿˜ä¸èƒ½æ”¯æŒ<code>warp_content</code>å±æ€§ï¼Œç°åœ¨ä½¿ç”¨<code>wrap_content</code>å’Œä½¿ç”¨<code>match_parent</code>æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼šå¯¹äºç›´æ¥ç»§æ‰¿è‡ªViewçš„æ§ä»¶ï¼Œå¦‚æœä¸å¯¹<code>wrap_content</code>åšç‰¹æ®Šå¤„ç†ï¼Œé‚£ä¹ˆä½¿ç”¨<code>wrap_content</code>å°±ç›¸å½“äºä½¿ç”¨<code>match_parent</code>.è¿™é‡Œå°±éœ€è¦æˆ‘ä»¬é‡å†™<code>onMeasure</code>æ–¹æ³•ï¼Œå½“å®½é«˜å±æ€§ä¸º<code>wrap_content</code>æ—¶ï¼Œå–ä¸€ä¸ªé»˜è®¤å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMeasure</span><span class="hljs-params">(<span class="hljs-type">int</span> widthMeasureSpec, <span class="hljs-type">int</span> heightMeasureSpec)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">desiredWidth</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">desiredHeight</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">widthMode</span> <span class="hljs-operator">=</span> MeasureSpec.getMode(widthMeasureSpec);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">widthSize</span> <span class="hljs-operator">=</span> MeasureSpec.getSize(widthMeasureSpec);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">heightMode</span> <span class="hljs-operator">=</span> MeasureSpec.getMode(heightMeasureSpec);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">heightSize</span> <span class="hljs-operator">=</span> MeasureSpec.getSize(heightMeasureSpec);<br><br>    <span class="hljs-type">int</span> width;<br>    <span class="hljs-type">int</span> height;<br><br>    <span class="hljs-comment">//å®½åº¦</span><br>    <span class="hljs-keyword">if</span> (widthMode == MeasureSpec.AT_MOST) &#123;<br>        width = Math.min(desiredWidth, widthSize);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (widthMode == MeasureSpec.EXACTLY) &#123;<br>        width = widthSize;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        width = desiredWidth;<br>    &#125;<br>    <span class="hljs-comment">//é«˜åº¦</span><br>    <span class="hljs-keyword">if</span> (heightMode == MeasureSpec.AT_MOST) &#123;<br>        height = Math.min(desiredHeight, heightSize);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (heightMode == MeasureSpec.EXACTLY) &#123;<br>        height = heightSize;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        height = desiredHeight;<br>    &#125;<br>    setMeasuredDimension(width, height);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨wrap_contentæ—¶ï¼Œå°±æ˜¯ä½¿ç”¨é»˜è®¤çš„100pxçš„å€¼ã€‚</p><h3 id="å››ã€ä½¿ç”¨è‡ªå®šä¹‰å±æ€§"><a href="#å››ã€ä½¿ç”¨è‡ªå®šä¹‰å±æ€§" class="headerlink" title="å››ã€ä½¿ç”¨è‡ªå®šä¹‰å±æ€§"></a>å››ã€ä½¿ç”¨è‡ªå®šä¹‰å±æ€§</h3><h4 id="4-1-åˆ›å»ºè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶"><a href="#4-1-åˆ›å»ºè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶" class="headerlink" title="4.1 åˆ›å»ºè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶"></a>4.1 åˆ›å»ºè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶</h4><p>åœ¨valuesç›®å½•ä¸‹é¢åˆ›å»ºè‡ªå®šä¹‰å±æ€§çš„XMLï¼Œæ¯”å¦‚attrs.xmlï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ç±»ä¼¼äºattrs_circle_view.xmlç­‰è¿™ç§ä»¥attrs_å¼€å¤´çš„æ–‡ä»¶åï¼Œå½“ç„¶è¿™ä¸ªæ–‡ä»¶åå¹¶æ²¡æœ‰ä»€ä¹ˆé™åˆ¶ï¼Œå¯ä»¥éšä¾¿å–åå­—ã€‚æˆ‘ä»¬é€‰æ‹©åˆ›å»ºattrs.xmlæ–‡ä»¶ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">declare-styleable</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;TestCustomCircleView&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;circle_color&quot;</span> <span class="hljs-attr">format</span>=<span class="hljs-string">&quot;color&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">declare-styleable</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="4-2-åœ¨æ„é€ æ–¹æ³•ä¸­è§£æè‡ªå®šä¹‰çš„å±æ€§å€¼å¹¶åšç›¸åº”çš„å¤„ç†"><a href="#4-2-åœ¨æ„é€ æ–¹æ³•ä¸­è§£æè‡ªå®šä¹‰çš„å±æ€§å€¼å¹¶åšç›¸åº”çš„å¤„ç†" class="headerlink" title="4.2 åœ¨æ„é€ æ–¹æ³•ä¸­è§£æè‡ªå®šä¹‰çš„å±æ€§å€¼å¹¶åšç›¸åº”çš„å¤„ç†"></a>4.2 åœ¨æ„é€ æ–¹æ³•ä¸­è§£æè‡ªå®šä¹‰çš„å±æ€§å€¼å¹¶åšç›¸åº”çš„å¤„ç†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">TestCustomCircleView</span><span class="hljs-params">(Context context, AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr)</span> &#123;<br>    <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);<br>    <span class="hljs-type">TypedArray</span> <span class="hljs-variable">typedArray</span> <span class="hljs-operator">=</span> context.obtainStyledAttributes(attrs, R.styleable.TestCustomCircleView);<br>    color = typedArray.getColor(R.styleable.TestCustomCircleView_circle_color,Color.RED);<br>    typedArray.recycle();<br>    init();<br>&#125;<br></code></pre></td></tr></table></figure><p>é¦–å…ˆåŠ è½½è‡ªå®šä¹‰å±æ€§é›†åˆï¼Œæ¥ç€è§£æå±æ€§é›†åˆä¸­<code>TestCustomCircleView_circle_color</code>ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šå±æ€§å€¼ï¼Œåˆ™ä½¿ç”¨<code>Color.RED</code>ä½œä¸ºé»˜è®¤å€¼ã€‚</p><h4 id="4-3-åœ¨å¸ƒå±€æ–‡ä»¶ä¸­ä½¿ç”¨è‡ªå®šä¹‰å±æ€§"><a href="#4-3-åœ¨å¸ƒå±€æ–‡ä»¶ä¸­ä½¿ç”¨è‡ªå®šä¹‰å±æ€§" class="headerlink" title="4.3 åœ¨å¸ƒå±€æ–‡ä»¶ä¸­ä½¿ç”¨è‡ªå®šä¹‰å±æ€§"></a>4.3 åœ¨å¸ƒå±€æ–‡ä»¶ä¸­ä½¿ç”¨è‡ªå®šä¹‰å±æ€§</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">com.example.huangyuan.custom.TestCustomCircleView</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_gravity</span>=<span class="hljs-string">&quot;center_horizontal&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:circle_color</span>=<span class="hljs-string">&quot;@color/grey&quot;</span></span><br><span class="hljs-tag">    /&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Viewçš„æ»‘åŠ¨</title>
    <link href="/2017/03/15/View%E7%9A%84%E6%BB%91%E5%8A%A8/"/>
    <url>/2017/03/15/View%E7%9A%84%E6%BB%91%E5%8A%A8/</url>
    
    <content type="html"><![CDATA[<p>ã€€ã€€Viewçš„ä½ç½®ä¸»è¦ç”±å®ƒçš„å››ä¸ªé¡¶ç‚¹æ¥å†³å®šï¼Œåˆ†åˆ«å¯¹åº”äºViewçš„å››ä¸ªå±æ€§ï¼štop,left,right,bottom,å…¶ä¸­topæ˜¯å·¦ä¸Šè§’çš„çºµåæ ‡ï¼Œleftæ˜¯å·¦ä¸Šè§’çš„æ¨ªåæ ‡ï¼Œrightæ˜¯å³ä¸‹è§’çš„æ¨ªåæ ‡ï¼Œbottomæ˜¯å³ä¸‹è§’çš„çºµåæ ‡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›åæ ‡éƒ½æ˜¯ç›¸å½“äºViewçš„çˆ¶å®¹å™¨æ¥è¯´çš„ï¼Œå› æ­¤å®ƒæ˜¯ä¸€ç§ç›¸å¯¹åæ ‡ï¼ŒViewçš„åæ ‡å’Œçˆ¶å®¹å™¨çš„å…³ç³»å¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="/image/location.png" alt="ç›¸å¯¹ä½ç½®å…³ç³»"></p><blockquote><p>width &#x3D; right - left<br>height &#x3D; bottom - top<br>left &#x3D; getLeft()<br>right &#x3D; getRight()<br>top &#x3D; getTop()<br>bottom &#x3D; getBottom()<br>ä»Android3.0 å¼€å§‹ï¼ŒViewå¢åŠ äº†é¢å¤–çš„å‡ ä¸ªå‚æ•°ï¼šx,y,trabslationXå’ŒtranslationYã€‚å…¶ä¸­xå’Œyæ˜¯Viewå·¦ä¸Šè§’çš„åæ ‡ï¼Œè€ŒtranslationXå’ŒtranslationYæ˜¯Viewå·¦ä¸Šè§’ç›¸å¯¹äºçˆ¶å®¹å™¨çš„åç§»é‡ã€‚è¿™å‡ ä¸ªå‚æ•°ä¹Ÿæ˜¯ç›¸å¯¹äºçˆ¶å®¹å™¨çš„åæ ‡ï¼Œå¹¶ä¸”translationXå’ŒtranslationYçš„é»˜è®¤å€¼æ˜¯0ï¼Œå’ŒViewçš„å››ä¸ªåŸºæœ¬çš„ä½ç½®å‚æ•°ä¸€æ ·ï¼ŒViewä¹Ÿä¸ºä»–ä»¬æä¾›äº†get&#x2F;setæ–¹æ³•ï¼Œè¿™å‡ ä¸ªå‚æ•°çš„æ¢ç®—å…³ç³»å¦‚ä¸‹<br><code>x = left + translationX</code><br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒViewåœ¨å¹³ç§»è¿‡ç¨‹ä¸­ï¼Œtopå’Œleftè¡¨ç¤ºçš„æ˜¯åŸå§‹å·¦ä¸Šè§’çš„ä½ç½®ä¿¡æ¯ï¼Œå…¶å€¼å¹¶ä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼Œæ­¤æ—¶å‘ç”Ÿæ”¹å˜çš„æ˜¯x,y,translationXå’ŒtranslationYã€‚</p></blockquote><span id="more"></span><h4 id="ä¸€-VelocityTracker-å’Œ-GestureDetector"><a href="#ä¸€-VelocityTracker-å’Œ-GestureDetector" class="headerlink" title="ä¸€ VelocityTracker å’Œ GestureDetector"></a>ä¸€ VelocityTracker å’Œ GestureDetector</h4><p>é€Ÿåº¦æœ€ç»ˆï¼Œç”¨äºè¿½è¸ªæ‰‹æŒ‡åœ¨æ»‘åŠ¨è¿‡ç¨‹ä¸­çš„é€Ÿåº¦ï¼ŒåŒ…æ‹¬æ°´å¹³å’Œç«–ç›´æ–¹å‘çš„é€Ÿåº¦ã€‚ä½¿ç”¨æ–¹æ³•åœ¨Viewçš„onTouchEventæ–¹æ³•ä¸­è¿½è¸ªå½“å‰å•å‡»äº‹ä»¶çš„é€Ÿåº¦ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">VelocityTracker</span> <span class="hljs-variable">velocityTracker</span> <span class="hljs-operator">=</span> VelocityTracker.obtain();<br>velocityTracker.addMovement(event);<br></code></pre></td></tr></table></figure><p>æ¥ç€ï¼Œå½“æˆ‘ä»¬æƒ³çŸ¥é“å½“å‰çš„æ»‘åŠ¨é€Ÿåº¦æ—¶ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥é‡‡ç”¨å¦‚ä¸‹æ–¹å¼æ¥è·å¾—å½“å‰é€Ÿåº¦ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">velocityTracker.computeCurrentVelocity(<span class="hljs-number">1000</span>);<br><span class="hljs-type">float</span> <span class="hljs-variable">xVelocity</span> <span class="hljs-operator">=</span> velocityTracker.getXVelocity();<br><span class="hljs-type">float</span> <span class="hljs-variable">yVelocity</span> <span class="hljs-operator">=</span> velocityTracker.getYVelocity();<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸€æ­¥ä¸­æœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„</p><ol><li>è·å–é€Ÿåº¦ä¹‹å‰å¿…é¡»å…ˆè®¡ç®—é€Ÿåº¦ï¼Œå³getXVelocity()å’ŒgetYVelocity()ä¹‹å‰å¿…é¡»è°ƒç”¨computeCurrentVelocity(1000)</li><li>è¿™é‡Œçš„é€Ÿåº¦æ—¶æŒ‡ä¸€æ®µæ—¶é—´å†…æ‰‹æŒ‡æ‰€åˆ’è¿‡çš„åƒç´ æ•°ï¼Œé€Ÿåº¦å¯ä»¥æ˜¯è´Ÿæ•°ï¼Œå½“æ‰‹æŒ‡åœ¨æ°´å¹³æ–¹å‘ä»å·¦å‘å³æ»‘åŠ¨æ—¶ï¼Œé€Ÿåº¦ä¸ºæ­£ï¼Œåä¹‹ä¸ºè´Ÿæ•°ã€‚<br>æœ€åï¼Œå½“ä¸åœ¨ä½¿ç”¨å®ƒçš„æ—¶å€™ï¼Œéœ€è¦è°ƒç”¨clearæ–¹æ³•æ¥é‡ç½®å¹¶å›æ”¶å†…å­˜:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">velocityTracker.clear();<br>velocityTracker.recycle();<br></code></pre></td></tr></table></figure></li></ol><hr><p>æ‰‹åŠ¿æ£€æµ‹ï¼Œç”¨äºè¾…åŠ©æ£€æµ‹ç”¨æˆ·çš„å•å‡»ã€æ»‘åŠ¨ã€é•¿æŒ‰ã€åŒå‡»ç­‰è¡Œä¸ºã€‚<br>é¦–å…ˆåˆ›å»ºGestureDetectorçš„å¯¹è±¡ï¼Œæ¥ç€æ¥ç®¡Viewçš„onTouchEventæ–¹æ³•ã€‚åšå®Œä¸‹é¢ä¸¤éƒ¨ï¼Œå°±å¯ä»¥æœ‰é€‰æ‹©çš„å®ç°æ¥å£ä¸­çš„æ–¹æ³•äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">GestureDetector</span> <span class="hljs-variable">gestureDetector</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GestureDetector</span>(<span class="hljs-built_in">this</span>,<span class="hljs-built_in">this</span>);<br>      gestureDetector.setIsLongpressEnabled(<span class="hljs-literal">false</span>);<br>      <span class="hljs-keyword">return</span> gestureDetector.onTouchEvent(event);<br></code></pre></td></tr></table></figure><p>å…¶ä¸­<code>gestureDetector.setIsLongpressEnabled(false)</code>æ˜¯ä¸ºäº†è§£å†³é•¿æŒ‰ä¹‹åæ— æ³•æ‹–åŠ¨çš„ç°è±¡ã€‚</p><h4 id="äºŒ-ä½¿ç”¨ScrollTo-x2F-ScrollBy"><a href="#äºŒ-ä½¿ç”¨ScrollTo-x2F-ScrollBy" class="headerlink" title="äºŒ ä½¿ç”¨ScrollTo&#x2F;ScrollBy"></a>äºŒ ä½¿ç”¨ScrollTo&#x2F;ScrollBy</h4><p>è°ƒç”¨æ–¹å¼ <code>View.scrollTo(int x, int y)</code>,<code>View.scrollBy(int x, int y)</code><br>æ–¹æ³•æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Set the scrolled position of your view. This will cause a call to</span><br><span class="hljs-comment">     * &#123;<span class="hljs-doctag">@link</span> #onScrollChanged(int, int, int, int)&#125; and the view will be</span><br><span class="hljs-comment">     * invalidated.</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> x the x position to scroll to</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> y the y position to scroll to</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scrollTo</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> &#123;<br>        <span class="hljs-keyword">if</span> (mScrollX != x || mScrollY != y) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">oldX</span> <span class="hljs-operator">=</span> mScrollX;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">oldY</span> <span class="hljs-operator">=</span> mScrollY;<br>            mScrollX = x;<br>            mScrollY = y;<br>            invalidateParentCaches();<br>            onScrollChanged(mScrollX, mScrollY, oldX, oldY);<br>            <span class="hljs-keyword">if</span> (!awakenScrollBars()) &#123;<br>                postInvalidateOnAnimation();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Move the scrolled position of your view. This will cause a call to</span><br><span class="hljs-comment">     * &#123;<span class="hljs-doctag">@link</span> #onScrollChanged(int, int, int, int)&#125; and the view will be</span><br><span class="hljs-comment">     * invalidated.</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> x the amount of pixels to scroll by horizontally</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> y the amount of pixels to scroll by vertically</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scrollBy</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> &#123;<br>        scrollTo(mScrollX + x, mScrollY + y);<br>    &#125;<br></code></pre></td></tr></table></figure><p>ã€€ã€€ä»æºç ä¸­å¯ä»¥çœ‹å‡ºï¼Œ<code>scrollBy</code>å®é™…ä¸Šä¹Ÿæ˜¯è°ƒç”¨<code>scrollBy</code>çš„æ–¹æ³•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯åœ¨<code>View</code>çš„æ»‘åŠ¨è¿‡ç¨‹ä¸­ï¼Œ<code>mScrollX</code>å’Œ<code>mScrollY</code>çš„æ”¹å˜è§„åˆ™ï¼š<br>åœ¨æ»‘åŠ¨è¿‡ç¨‹ä¸­ï¼Œ<code>mScrollX</code>çš„å€¼æ€»æ˜¯ç­‰äºViewå·¦è¾¹ç¼˜å’ŒViewå†…å®¹å·¦è¾¹ç¼˜åœ¨æ°´å¹³æ–¹å‘çš„è·ç¦»ï¼Œè€ŒmScrollYçš„å€¼æ€»æ˜¯ç­‰äºViewä¸Šè¾¹ç¼˜å’ŒViewå†…å®¹ä¸Šè¾¹ç¼˜åœ¨ç«–ç›´æ–¹å‘çš„è·ç¦»ã€‚å…¶ä¸­<code>mScrollX</code>å’Œ<code>mScrollY</code>çš„å•ä½æ˜¯åƒç´ ï¼Œå¹¶ä¸”å½“Viewå·¦è¾¹ç¼˜åœ¨Viewå†…å®¹å·¦è¾¹ç¼˜çš„å³è¾¹æ—¶ï¼Œ<code>mScrollX</code>ä¸ºæ­£å€¼ï¼Œåä¹‹ä¸ºè´Ÿå€¼ï¼›å½“Viewä¸Šè¾¹ç¼˜åœ¨Viewå†…å®¹ä¸Šè¾¹ç¼˜çš„ä¸‹è¾¹æ—¶ï¼Œ<code>mScrollY</code>ä¸ºæ­£å€¼ï¼Œåä¹‹ä¸ºè´Ÿå€¼ã€‚æ¢å¥è¯è¯´ï¼šä»å·¦å‘å³æ»‘åŠ¨ï¼Œ<code>mScrollX</code>ä¸ºè´Ÿå€¼ï¼Œåä¹‹ä¸ºæ­£å€¼ï¼›å¦‚æœä»ä¸Šå¾€ä¸‹æ»‘åŠ¨ï¼Œ<code>mScrollY</code>ä¸ºè´Ÿå€¼ï¼Œåä¹‹ä¸ºæ­£å€¼ã€‚<br><strong>æ„æ€å°±æ˜¯è¯´ScrollTo&#x2F;ScrollByåªèƒ½æ»‘åŠ¨Viewçš„å†…å®¹è€Œä¸èƒ½æ»‘åŠ¨Viewæœ¬èº«ï¼Œæ¯”å¦‚ï¼Œåªèƒ½æ»‘åŠ¨TextViewçš„æ–‡å­—ï¼Œè€Œä¸èƒ½æ»‘åŠ¨TextViewæ§ä»¶æœ¬èº«</strong></p><h4 id="ä¸‰-ä½¿ç”¨åŠ¨ç”»"><a href="#ä¸‰-ä½¿ç”¨åŠ¨ç”»" class="headerlink" title="ä¸‰ ä½¿ç”¨åŠ¨ç”»"></a>ä¸‰ ä½¿ç”¨åŠ¨ç”»</h4><p>è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½ä»‹ç»çš„ï¼Œæƒ³è¦å…¼å®¹3.0ä»¥ä¸‹çš„å±æ€§åŠ¨ç”»ï¼Œå»ºè®®ä½¿ç”¨nineoldandroidsæ¥å®ç°</p><h4 id="å››-æ”¹å˜å¸ƒå±€å‚æ•°"><a href="#å››-æ”¹å˜å¸ƒå±€å‚æ•°" class="headerlink" title="å›› æ”¹å˜å¸ƒå±€å‚æ•°"></a>å›› æ”¹å˜å¸ƒå±€å‚æ•°</h4><p>æ”¹å˜å¸ƒå±€å‚æ•°ï¼Œä¹Ÿå°±æ˜¯æ”¹å˜Â·LayoutParamsÂ·</p><h4 id="äº”-ä½¿ç”¨Scrollerè¿›è¡Œå¹³æ»‘ç§»åŠ¨"><a href="#äº”-ä½¿ç”¨Scrollerè¿›è¡Œå¹³æ»‘ç§»åŠ¨" class="headerlink" title="äº” ä½¿ç”¨Scrollerè¿›è¡Œå¹³æ»‘ç§»åŠ¨"></a>äº” ä½¿ç”¨Scrollerè¿›è¡Œå¹³æ»‘ç§»åŠ¨</h4><p>è‡ªå®šä¹‰ä¸€ä¸ªæ§ä»¶ï¼Œæ·»åŠ æˆå‘˜å˜é‡Â·ScrollerÂ·ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ScrollerTextView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">TextView</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Scroller mScroller;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ScrollerTextView</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context);<br>        mScroller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>(context);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ScrollerTextView</span><span class="hljs-params">(Context context, AttributeSet attrs)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context, attrs);<br>        mScroller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>(context);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ScrollerTextView</span><span class="hljs-params">(Context context, AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);<br>        mScroller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>(context);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">smoothScrollBy</span><span class="hljs-params">(<span class="hljs-type">int</span> dx,<span class="hljs-type">int</span> dy)</span>&#123;<br>        mScroller.startScroll(mScroller.getFinalX(),mScroller.getFinalY(),dx,dy,<span class="hljs-number">2000</span>);<br>        invalidate();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">smoothScrollTo</span><span class="hljs-params">(<span class="hljs-type">int</span> fx, <span class="hljs-type">int</span> fy)</span>&#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">dx</span> <span class="hljs-operator">=</span> fx - mScroller.getFinalX();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">dy</span> <span class="hljs-operator">=</span> fy - mScroller.getFinalY();<br>        smoothScrollBy(dx,dy);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">computeScroll</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-keyword">if</span>(mScroller.computeScrollOffset())&#123;<br>           scrollTo(mScroller.getCurrX(), mScroller.getCurrY());<br>           postInvalidate();<br>       &#125;<br>        <span class="hljs-built_in">super</span>.computeScroll();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶å®<code>Scroller</code>ä¹Ÿæ˜¯é€šè¿‡<code>ScrollTO/ScrollBy</code>å®ç°çš„ï¼ŒåŒæ ·åªèƒ½æ»‘åŠ¨å†…å®¹ï¼Œä¸èƒ½æ»‘åŠ¨æœ¬èº«ã€‚<br>PSï¼š<br>åœ¨è°ƒç”¨<code>startScroll</code>æ—¶ï¼Œå¹¶æ²¡æœ‰è®©<code>View</code>è¿›è¡Œæ»‘åŠ¨ã€‚è€Œæ˜¯åœ¨è°ƒç”¨<code>invalidate()</code>è¿›è¡Œé‡ç»˜çš„æ—¶å€™ï¼Œä¼šå»è°ƒç”¨<code>computeScroll</code>æ–¹æ³•ï¼Œä½†æ˜¯<code>computeScroll</code>åœ¨<code>View</code>åªæ˜¯ä¸ªç©ºå®ç°ï¼Œå› æ­¤éœ€è¦æˆ‘ä»¬è‡ªå·±å»å®ç°ã€‚åœ¨<code>computeScroll</code>ä¸­è¿›è¡Œå¹³ç§»ã€‚ä¹Ÿå°±æ˜¯è¯´å½“Viewé‡ç»˜ååœ¨<code>draw</code>æ–¹æ³•ä¸­è°ƒç”¨<code>computeScroll</code>,è€Œ<code>computeScroll</code>åˆä¼šå»å‘<code>Scroller</code>è·å–å½“å‰çš„<code>scrollX</code>å’Œ<code>scrollY</code>,ç„¶åé€šè¿‡<code>scrollTo</code>æ–¹æ³•å®ç°æ»‘åŠ¨ï¼Œæ¥ç€åˆè°ƒç”¨<code>postInvalidate()</code>æ–¹æ³•æ¥è¿›è¡Œç¬¬äºŒæ¬¡é‡ç»˜ï¼Œè¿™ä¸€æ¬¡é‡ç»˜è¿‡ç¨‹å’Œç¬¬ä¸€æ¬¡ä¸€æ ·ï¼Œè¿˜æ˜¯ä¼šå»è°ƒç”¨<code>computeScroll()</code>æ–¹æ³•ï¼Œå¦‚æ­¤åå¤ï¼Œç›´åˆ°æ•´ä¸ªæ»‘åŠ¨è¿‡ç¨‹ç»“æŸã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šæˆ‘çš„å®‰å“çˆ¬å‘ä¹‹æ—…ã€‹-é«˜å¾·åœ°å›¾é‡åˆ°çš„å‘(2)</title>
    <link href="/2017/02/25/%E3%80%8A%E6%88%91%E7%9A%84%E5%AE%89%E5%8D%93%E7%88%AC%E5%9D%91%E4%B9%8B%E6%97%85%E3%80%8B-%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BE%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91-2/"/>
    <url>/2017/02/25/%E3%80%8A%E6%88%91%E7%9A%84%E5%AE%89%E5%8D%93%E7%88%AC%E5%9D%91%E4%B9%8B%E6%97%85%E3%80%8B-%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BE%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91-2/</url>
    
    <content type="html"><![CDATA[<p>è¿™ç¯‡åšå®¢æ˜¯å…³äºé«˜å¾·ä½¿ç”¨ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œæˆ–è®¸æ˜¯å› ä¸ºå¼€å‘æ–‡æ¡£ä¸­æ²¡æœ‰è¯´æ˜ï¼Œæˆ–è®¸æ˜¯å› ä¸ºè‡ªå·±æ®µä½ä¸å¤Ÿï¼Œåæ­£å°±æ˜¯é‡åˆ°å‘äº†ã€‚</p><span id="more"></span><h4 id="å…³äºå®šä½ç‚¹å’Œè¦†ç›–ç‰©"><a href="#å…³äºå®šä½ç‚¹å’Œè¦†ç›–ç‰©" class="headerlink" title="å…³äºå®šä½ç‚¹å’Œè¦†ç›–ç‰©"></a>å…³äºå®šä½ç‚¹å’Œè¦†ç›–ç‰©</h4><p>ã€€ã€€æœ‰è¿™ä¹ˆä¸€ä¸ªä¸šåŠ¡éœ€æ±‚ï¼šå®šä½æ‰‹æœºæ‰€åœ¨ä½ç½®æˆåŠŸåï¼Œè¯·æ±‚æœåŠ¡å™¨æ•°æ®ï¼ŒæœåŠ¡å™¨è¿”å›æ‰‹æœºæ‰€åœ¨åœ°ç‚¹æŒ‡å®šèŒƒå›´å†…çš„çš„ç‚¹ï¼Œç„¶åæŠŠè¿™äº›ç‚¹æ·»åŠ åˆ°åœ°å›¾ä¸Šã€‚<br>åˆšå¼€å§‹è¿˜æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼ŒæŒ‰ç…§å®˜ç½‘çš„demoæ¥åšçš„ï¼Œåˆ°åæ¥æ•°æ®é‡å¤šçš„æ—¶å€™å°±å‡ºç°äº†markeré‡å çš„é—®é¢˜ã€‚å½“ç„¶ï¼Œmarkerç‚¹å¤šçš„è¯ï¼Œé‡å ä¹Ÿæ˜¯æ— æ³•é¿å…çš„ï¼Œä½†æ˜¯ï¼ŒæŠŠå®šä½çš„æ ‡è®°ä¹Ÿç»™è¦†ç›–æ‰äº†ï¼Œè¿™å°±æœ‰ç‚¹ä¸å¥½äº†ã€‚ä¹Ÿæ²¡æœ‰æŸ¥åˆ°ç›¸å…³çš„apiï¼Œdemoä¸Šæ·»åŠ å®šä½ç‚¹ä¹Ÿæ˜¯ç”¨çš„markerï¼Œä¼°è®¡éƒ½æ˜¯åŒä¸€çº§åˆ«ï¼ŒæŒ‰ç…§æ·»åŠ çš„å…ˆåé¡ºåºè¦†ç›–å åŠ ã€‚<br>åæ¥æ‰¾åˆ°äº†ä¸€ä¸ªæ–¹æ³• <code>mLocMarker.setToTop();</code>è¿™æ ·å¯ä»¥æŠŠæŸä¸ªmarkerè®¾ç½®åˆ°æœ€é«˜çš„å±‚çº§æ˜¾ç¤ºã€‚è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDisplayLevel</span><span class="hljs-params">(<span class="hljs-type">int</span> var1)</span> &#123;<br>    <span class="hljs-type">IMarkerAction</span> <span class="hljs-variable">var2</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.a.getIMarkerAction();<br>    <span class="hljs-keyword">if</span>(var2 != <span class="hljs-literal">null</span>) &#123;<br>        var2.setDisplayLevel(var1);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ˜¯Markerå¯¹è±¡ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯ä»å®˜æ–¹ä¸‹è½½ä¸‹æ¥çš„æ–‡æ¡£ä¸­å¹¶æ²¡æœ‰æåˆ°è¿™ä¸ªæ–¹æ³•ï¼Œè‡ªå·±ä¹Ÿæ²¡æœ‰å»ä½¿ç”¨ã€‚äº†è§£è¿‡çš„æœ‹å‹å¯ä»¥åœ¨è¯„è®ºåŒºå›å¤æˆ‘ä¸€ä¸‹ï¼Œè°¢è°¢ã€‚</p><h4 id="AndroidStudioç¬¬äºŒæ¬¡ç¼–è¯‘ä¹‹ååœ°å›¾ä¸æ˜¾ç¤º"><a href="#AndroidStudioç¬¬äºŒæ¬¡ç¼–è¯‘ä¹‹ååœ°å›¾ä¸æ˜¾ç¤º" class="headerlink" title="AndroidStudioç¬¬äºŒæ¬¡ç¼–è¯‘ä¹‹ååœ°å›¾ä¸æ˜¾ç¤º"></a>AndroidStudioç¬¬äºŒæ¬¡ç¼–è¯‘ä¹‹ååœ°å›¾ä¸æ˜¾ç¤º</h4><p>ã€€ã€€AS2.2ç‰ˆæœ¬åŠ äº† <code>Instant Run</code> æ¨¡å¼ï¼Œé€šå¸¸æƒ…å†µä¸‹è¿™å›èŠ‚çœæˆ‘ä»¬å¾ˆå¤šæ—¶é—´ï¼Œæ¯”å¦‚å½“æˆ‘ä»¬ä¿®æ”¹äº†ç•Œé¢å¸ƒå±€ï¼Œæƒ³è¦åœ¨æ‰‹æœºä¸Šçœ‹ä¸€ä¸‹æ•ˆæœï¼Œæ²¡æœ‰å¿…è¦é‡å¯æ•´ä¸ªåº”ç”¨ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨ <code>Instant Run</code> æ¨¡å¼äº†ï¼Œideå†…éƒ¨ä¼šè¿›è¡Œåˆ¤æ–­æ˜¯å¦éœ€è¦é‡å¯æ•´ä¸ªåº”ç”¨ï¼Œå¦‚æœä¸éœ€è¦ï¼Œåªä¼šçƒ­é‡å¯å½“å‰é¡µé¢ã€‚ä¸ºè¿™ä¸ªåŠŸèƒ½ç‚¹èµå•Šï¼Œæœ‰çš„æ—¶å€™é¡µé¢è—çš„æ¯”è¾ƒæ·±ï¼Œéœ€è¦å¤šæ­¥æ“ä½œæ‰èƒ½æ‰“å¼€ï¼Œè¿™ä¸ªåŠŸèƒ½å¯ä»¥èŠ‚çœå¾ˆå¤šæ—¶é—´ã€‚<br><img src="/image/gaode/install_run.png" alt="Install Run"><br>ä½†æ˜¯å•Šä½†æ˜¯ã€‚ã€‚ã€‚æˆ‘åœ¨Fragmentä¸­ä½¿ç”¨é«˜å¾·åœ°å›¾çš„æ—¶å€™ï¼Œä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ä¼šå‡ºç°åœ°å›¾åŠ è½½ä¸å‡ºæ¥ï¼ˆä¸€ç‰‡ç©ºç™½ï¼‰ï¼Œä½†æ˜¯å®šä½æˆåŠŸçš„é—®é¢˜ã€‚åˆšå¼€å§‹çš„æ˜¯å“å°¿äº†ï¼Œä»¥ä¸ºä»£ç å‡ºäº†ä»€ä¹ˆé—®é¢˜ï¼Œç›´åˆ°æˆ‘æäº†å·¥å•ï¼Œçœ‹åˆ°å›å¤åæ”¾å¿ƒäº†ï¼š<br><img src="/image/gaode/install_run_bug.png" alt="é«˜å¾·å·¥å•"></p><blockquote><p>æ‚¨å¥½ï¼ŒInstant Run ç¡®å®æ˜¯ä¸æ”¯æŒè¿™ç§ï¼Œç›®å‰ä»–ä»¬ä¹Ÿæ²¡æœ‰ç»™å‡ºè§£å†³æ–¹æ¡ˆï¼Œè¿™é‡Œæœ‰è¯¦ç»†çš„è§£é‡Š<a href="http://stackoverflow.com/questions/33902467/android-studio-2-0-why-does-instant-run-not-work-when-modifying-xml-layout-reso">http://stackoverflow.com/questions/33902467/android-studio-2-0-why-does-instant-run-not-work-when-modifying-xml-layout-reso</a><br>æ„Ÿè°¢æ‚¨çš„è‡´ä¿¡ï¼Œæ¬¢è¿æŒç»­å…³æ³¨é«˜å¾·å¼€æ”¾å¹³å°ï¼</p></blockquote><h4 id="åœ°å›¾åŠ è½½å®Œæˆçš„å›è°ƒå‡½æ•°"><a href="#åœ°å›¾åŠ è½½å®Œæˆçš„å›è°ƒå‡½æ•°" class="headerlink" title="åœ°å›¾åŠ è½½å®Œæˆçš„å›è°ƒå‡½æ•°"></a>åœ°å›¾åŠ è½½å®Œæˆçš„å›è°ƒå‡½æ•°</h4><p>å› ä¸ºä¸šåŠ¡ä¸Šçš„åŸå› ï¼Œéœ€è¦åœ¨åœ°å›¾åŠ è½½å®Œæˆååšä¸€äº›æ“ä½œï¼Œå½“æ—¶å®˜ç½‘çš„å¼€å‘è€…æ–‡æ¡£ä¸Šæ²¡æœ‰å•Šï¼Œäºæ˜¯åˆæäº†å·¥å•ï¼Œæ¥åˆ°å›å¤ååˆæ”¾å¿ƒäº†</p><blockquote><p>æ‚¨å¥½ï¼ŒAMap æä¾›äº†åœ°å›¾åŠ è½½å®Œæˆçš„æ–¹æ³•ï¼Œ å¯è¯¦è§ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">aMap.setOnMapLoadedListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AMap</span>.OnMapLoadedListener() &#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMapLoaded</span><span class="hljs-params">()</span> &#123;<br>&#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p>æ„Ÿè°¢æ‚¨çš„è‡´ä¿¡ï¼Œæ¬¢è¿æŒç»­å…³æ³¨é«˜å¾·å¼€æ”¾å¹³å°ï¼</p><h4 id="æ­¥è¡Œè·¯å¾„è§„åˆ’å½“è·ç¦»æ¯”è¾ƒçŸ­æ—¶è·¯çº¿ä¸åœ¨åœ°å›¾ä¸­é—´ä½ç½®"><a href="#æ­¥è¡Œè·¯å¾„è§„åˆ’å½“è·ç¦»æ¯”è¾ƒçŸ­æ—¶è·¯çº¿ä¸åœ¨åœ°å›¾ä¸­é—´ä½ç½®" class="headerlink" title="æ­¥è¡Œè·¯å¾„è§„åˆ’å½“è·ç¦»æ¯”è¾ƒçŸ­æ—¶è·¯çº¿ä¸åœ¨åœ°å›¾ä¸­é—´ä½ç½®"></a>æ­¥è¡Œè·¯å¾„è§„åˆ’å½“è·ç¦»æ¯”è¾ƒçŸ­æ—¶è·¯çº¿ä¸åœ¨åœ°å›¾ä¸­é—´ä½ç½®</h4><p>ã€€ã€€ç”±äºä¸šåŠ¡ä¸Šçš„åŸå› ï¼Œè‡ªå·±çš„ä½ç½®å’Œç›®çš„åœ°çš„è·ç¦»è¾ƒçŸ­ï¼Œéœ€è¦æ­¥è¡Œè·¯å¾„è§„åˆ’ï¼Œä½†æ˜¯å•Šä½†æ˜¯ï¼Œè·¯å¾„å¯ä»¥è§„åˆ’æˆåŠŸï¼Œä½†æ˜¯æŠŠè·¯å¾„æ·»åŠ åˆ°åœ°å›¾ä¸Šçš„æ—¶å€™ï¼Œè·¯å¾„æ²¡æœ‰æ˜¾ç¤ºåœ¨å±å¹•ä¸­é—´ä½ç½®å•Šï¼Œè€Œæ˜¯è¯¡å¼‚çš„é£˜åˆ°äº†ä¸€è¾¹ã€‚åå¤æ£€æŸ¥äº†Nè¾¹ä»£ç ï¼Œæ²¡æœ‰é—®é¢˜å•Šï¼Œå’Œå®˜ç½‘demoä¸€æ ·å•Šï¼ŒæŠŠåæ ‡ç‚¹æŠ å‡ºæ¥ï¼Œæ”¹ä¸€ä¸‹å®˜ç½‘demoçš„èµ·å§‹ç‚¹(å°±æ˜¯ä¸¤ä¸ªåæ ‡å€¼),ç„¶åï¼Œä¹Ÿå‡ºç°äº†è·¯å¾„é£˜åˆ°ä¸€è¾¹çš„æƒ…å†µï¼Œäºæ˜¯åˆå»æäº†ä¸‡èƒ½çš„å·¥å•ï¼Œçœ‹åˆ°å·¥å•çš„å›å¤åï¼Œæˆ‘åˆæ”¾å¿ƒäº†<br><img src="/image/gaode/walk_route_bug.png" alt="é«˜å¾·å·¥å•"></p><blockquote><p>æˆ‘ï¼šDemoæ˜¯ä»å®˜ç½‘çš„demoä¸Šæ”¹çš„ï¼Œå°±åœ¨<code>om.amap.map3d.demo.route</code>åŒ…ä¸‹çš„<code>WalkRouteActivity</code>è¿™ä¸ªç±»é‡Œé¢ï¼Œæ”¹äº†ä¸€ä¸‹mStartPointï¼Œå’Œ mEndPoint çš„å€¼ï¼Œé™„ä»¶å›¾ç‰‡æ˜¯æˆ‘ä¿®æ”¹ä¹‹åçš„å€¼<br> <code>private LatLonPoint mStartPoint = new LatLonPoint(39.990145, 116.481194);</code><br><code>private LatLonPoint mEndPoint = new LatLonPoint(39.99026006391499, 116.4813472288069);</code><br>ä»å®˜ç½‘ä¸‹è½½å›æ¥ååªæ”¹äº†è¿™ä¸¤ä¸ªåœ°æ–¹ï¼ŒæŠŠkeyæ¢æˆäº†è‡ªå·±çš„ï¼Œå…¶ä»–åœ°æ–¹çš„ä»£ç æ²¡æœ‰åŠ¨ã€‚<br>å¦‚æœå¯ä»¥çš„è¯ï¼Œä½ ä»¬å¯ä»¥è¯•ä¸€ä¸‹ï¼Œæ‰¾ä¸¤ä¸ªè·ç¦»éå¸¸è¿‘çš„ç‚¹ã€‚<br>ç­”å¤ï¼š<br>æ‚¨å¥½ï¼Œè¿™ä¸ªé—®é¢˜ç¡®å®æ˜¯ç”±SDKå†…éƒ¨å¤„ç†ä¸å½“å¼•èµ·çš„bugï¼Œæˆ‘ä»¬ä¼šåœ¨ä¸‹ä¸ªç‰ˆæœ¬ä¸­ä¿®å¤ï¼Œç»™æ‚¨å¸¦æ¥ä¸ä¾¿æ·±è¡¨æ­‰æ„<br>æ„Ÿè°¢æ‚¨çš„è‡´ä¿¡ï¼Œæ¬¢è¿æŒç»­å…³æ³¨é«˜å¾·å¼€æ”¾å¹³å°ï¼</p></blockquote><p>è§£å†³æ–¹æ³•ï¼š<br>åˆ¤æ–­ä¸¤ä¸ªç‚¹çš„è·ç¦»ï¼Œå°äº500ç±³çš„æ—¶å€™ï¼Œå–èµ·å§‹ç‚¹ä½ç½®è¿çº¿çš„ä¸­é—´ä½ç½®ä½œä¸ºåœ°å›¾ä¸­é—´ç‚¹ï¼Œå¼ºåˆ¶å°†åœ°å›¾ä¸Šçš„æ­¤ä½ç½®æ‹‰åˆ°å±å¹•ä¸­é—´ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Androidçˆ¬å‘ä¹‹æ—…</tag>
      
      <tag>é«˜å¾·åœ°å›¾</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å†™åœ¨2016å¹´æœ«</title>
    <link href="/2016/12/31/%E5%86%99%E5%9C%A82016%E5%B9%B4%E6%9C%AB/"/>
    <url>/2016/12/31/%E5%86%99%E5%9C%A82016%E5%B9%B4%E6%9C%AB/</url>
    
    <content type="html"><![CDATA[<p>2016å¹´çš„æœ€åä¸€å¤©çš„æœ€ååŠä¸ªå°æ—¶äº†ï¼Œå†™å†™è¿™ä¸€å¹´çš„æ”¶è·æ€»ç»“å’Œ2017çš„è®¡åˆ’å§ã€‚<br>ä¸€ä¸ªå­—æ€»ç»“äº†ä¸€ä¸‹2016å¹´ï¼šç©·ã€‚<br>å½“ç„¶è¿™æ˜¯å¼€ç©ç¬‘å¼çš„æ€»ç»“ï¼Œä½†ä¹Ÿæ˜¯æœ€æ¥è¿‘äº‹å®çš„äº†ã€‚</p><span id="more"></span><h4 id="2016æ€»ç»“"><a href="#2016æ€»ç»“" class="headerlink" title="2016æ€»ç»“"></a>2016æ€»ç»“</h4><p>æŠ€æœ¯æ–¹é¢ï¼š<br>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;è‡ªä»è¸ä¸ŠITè¿™æ¡ä¸å½’è·¯å¼€å§‹ï¼Œå°±æ‰“ç®—åšä¸€ä¸ªå…¨æ ˆæ”»åŸç‹®ï¼Œä»æ•²ä¸‹ç¬¬ä¸€è¡Œ<code>hello world</code>åˆ°è‡ªå·±ç‹¬ç«‹ç”¨javaå†™ä¸€ä¸ªå®Œæ•´çš„å¤§ä½œä¸šå†åˆ°å†™å‡ºå®é™…å¯ç”¨çš„ç¨‹åºåˆ°ç°åœ¨çš„å·¥ä½œï¼Œä»”ç»†æƒ³æƒ³å·²ç»äº”å¹´å¤šäº†å§ã€‚ä½†æ˜¯è¿™ä»…ä»…æ˜¯ä¸ªå¼€å§‹ï¼Œæˆ‘å¯¹è‡ªå·±ç°åœ¨çš„å®šä½æ˜¯å…¨æ ˆæ”»åŸç‹®çš„é“è·¯åˆšåˆšæ…¢å‡ºç¬¬ä¸€æ­¥ï¼Œç°åœ¨ä¹Ÿå°±ç®—æ˜¯ä¸ªå…¨æ ˆå­¦å¾’å§ã€‚</p><table><tr><th>ç¼–ç¨‹æŠ€èƒ½</th><th>è‡ªå®šçº§åˆ«</th></tr><tr><td>python</td><td>å…¥é—¨</td></tr><tr><td>HTML</td><td>åˆçº§</td></tr><tr><td>J2EE</td><td>åˆçº§</td></tr><tr><td>JAVA</td><td>ä¸­çº§</td></tr><tr><td>Android</td><td>ä¸­çº§</td></tr><tr><td>Linux</td><td>ä¸­çº§</td></tr></table><ul><li>åœ¨å·¥ä½œä¸­ä¹Ÿè¸©è¿‡ã€å¡«è¿‡ã€æŒ–è¿‡å¾ˆå¤šå‘ï¼Œä¸‡å¹¸çš„æ˜¯ä¸€ç›´åšæŒäº†ä¸‹æ¥ï¼Œæ²¡æœ‰æ”¾å¼ƒï¼Œä¹Ÿæ²¡æœ‰æƒ³è¿‡è¦è½¬è¡Œçš„äº‹ï¼Œå°±æƒ³ä¸€ç›´åœ¨è¿™ä¸ªè¡Œä¸šå‘å±•ï¼ŒåŠªåŠ›æé«˜è‡ªå·±çš„æŠ€æœ¯ã€‚</li><li>15å¹´åŒåäºŒå’Œä»Šå¹´çš„åäºŒæœˆå››å·ï¼Œéƒ½å‚åŠ äº†<code>å¼€æºä¸­å›½</code>ä¸¾åŠçš„<code>æºåˆ›æ±‡</code>å¹´ç»ˆç››å…¸ï¼Œæ¥è§¦åˆ°äº†å¾ˆå¤šå¤§ç‰›(è™½ç„¶ä»–ä»¬ä¸æ›¾è®°å¾—æˆ‘)ï¼Œæ¥è§¦åˆ°å¾ˆå¤šä»¥å‰æ²¡æœ‰è§è¯†è¿‡ä¹Ÿæ²¡æœ‰æƒ³è±¡è¿‡çš„ä¸œè¥¿ï¼Œå¯¹è‡ªå·±çš„æˆé•¿æœ‰å¾ˆå¤§å¸®åŠ©ã€‚</li><li>å¼€é€šäº†è‡ªå·±çš„åšå®¢(gitpage),æŠŠåšå®¢ä»csdnè¿ç§»åˆ°githubä¸Šï¼Œç§Ÿç”¨äº†è…¾è®¯äº‘ä¸»æœºï¼Œå¤‡æ¡ˆäº†è‡ªå·±çš„åŸŸåï¼Œæœ‰äº†è‡ªå·±çš„ç®€å•çš„ç½‘ç«™ï¼Œå¯ä»¥å†™ä¸€äº›è‡ªå·±æ„Ÿå…´è¶£çš„ä¸œè¥¿(è‡ªç”±çš„æ„Ÿè§‰çœŸå¥½ï¼Œæ³•æ— ç¦æ­¢çš†å¯ä¸º)ã€‚</li><li>ä¹Ÿæ„Ÿè°¢è¿™ä¸€å¹´æ¥å°ä¼™ä¼´çš„å¸®åŠ©ï¼Œå¹¸å¥½æœ‰ä½ ä»¬ï¼Œå¸®æˆ‘è§£å†³äº†å›°éš¾ã€‚</li><li>å½“ç„¶ï¼Œåœ¨è¿™ä¸€å¹´ä¸­ä¹Ÿæœ‰å¾ˆå¤šäº‹æƒ…ä¸æ˜¯é‚£ä¹ˆé¡ºåˆ©ï¼Œä»ä¸Šå®¶å…¬å¸ç¦»èŒï¼Œä»10æœˆåˆ°12æœˆï¼Œä¸­é—´ä¼‘æ¯äº†ä¸¤ä¸ªæœˆï¼Œå›äº†ä¸€æ¬¡å®¶ï¼Œè·‘å»æ·±åœ³å’Œå¦¹å­ç©äº†å››äº”å¤©çš„æ ·å­(å‡ ä¹æ˜¯å…¨éƒ¨æ—¶é—´éƒ½æ³¡åœ¨å›¾ä¹¦é¦†äº†ï¼Œæ²‰è¿·å­¦ä¹ æ— æ³•è‡ªæ‹”)ï¼Œå…¶ä½™æ—¶é—´ä¹Ÿå°±æ˜¯çœ‹çœ‹ä¹¦ï¼Œæ‰“æ‰“æ¸¸æˆä¹‹ç±»çš„ï¼Œæ€»ä¹‹è¿™ä¸¤ä¸ªæœˆçš„æ—¶é—´å¤§éƒ¨åˆ†éƒ½è¢«æµªè´¹æ‰äº†ï¼Œæ²¡æœ‰ä»»ä½•æ”¶è·ã€‚</li></ul><p>ç”Ÿæ´»ä¸Šä¹Ÿæ²¡å•¥å¥½è¯´çš„ï¼Œä¸šä½™æ—¶é—´å°±æ˜¯å®…åœ¨å®¶é‡Œï¼Œçœ‹çœ‹ä¹¦ï¼Œæ•²æ•²ä»£ç ï¼Œæ‰“æ‰“æ¸¸æˆï¼Œä¸å–œæ¬¢å‡ºå»é€›ï¼Œè²Œä¼¼å¥½åƒæ˜¯åœ¨6ã€7æœˆä»½çš„æ ·å­ï¼ŒäºŒå“¥æ¥åŒ—äº¬ç©ï¼Œçˆ¬äº†ä¸€æ¬¡å…«è¾¾å²­é•¿åŸï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå°±æ˜¯å»äº†ä¸‰æ¬¡æ¼«å±•ï¼Œå…¶ä»–çš„å°±æ²¡æœ‰ä»€ä¹ˆäº†ã€‚</p><h4 id="2017è®¡åˆ’"><a href="#2017è®¡åˆ’" class="headerlink" title="2017è®¡åˆ’"></a>2017è®¡åˆ’</h4><p>é¦–å…ˆï¼Œæœ€é‡è¦çš„å°±æ˜¯æå‡è‡ªå·±çš„æŠ€æœ¯èƒ½åŠ›ï¼š</p><ul><li>pythonè¾¾åˆ°åˆçº§æ°´å¹³;htmlæ–¹é¢å­¦ä¹ ä¸€ä¸‹h5;</li><li>J2EEæ–¹é¢å­¦ä¹ ä¸€ä¸‹ssmæ¡†æ¶ã€nginx;</li><li>JAVAå’ŒAndroidæ–¹é¢å°½å¯èƒ½çš„æå‡è‡ªå·±ï¼Œå°½é‡åœ¨ä¸¤å¹´å†…èƒ½åˆæ­¥è¾¾åˆ°é«˜çº§æ°´å¹³;</li><li>Linuxæ–¹é¢ï¼Œç†Ÿæ‚‰ä¸€ä¸‹vimï¼Œäº†è§£ä»¥ä¸‹æœåŠ¡å™¨æ–¹å‘çš„ç›¸å…³çŸ¥è¯†ï¼Œæ¯•ç«Ÿè‡ªå·±åªæ˜¯æ‹¿linuxåšå¼€å‘ï¼Œæ²¡æœ‰æŠŠç²¾åŠ›æ”¾åœ¨æœåŠ¡å™¨å‡è®¾æ–¹å‘ã€‚</li></ul><p>ç”Ÿæ´»æ–¹é¢å°±å°½é‡æ”¹å˜ä¸€ä¸‹è‡ªå·±å®…çš„å±æ€§,å°½é‡å¤šå‡ºå»èµ°èµ°å§(è¿™ä¸ªæœ‰ç‚¹éš¾ï¼Œæ¯”æå‡æŠ€æœ¯å®åŠ›è¿˜è¦éš¾)</p><hr><p>å€Ÿç”¨ä¸€æœ¬å°è¯´ä¸­çš„ä¸€æ®µè¯å§ï¼š</p><blockquote><pre>  â€œå…¶å®æ‰€æœ‰çš„æ™ºæ…§ç”Ÿç‰©éƒ½åœ¨é¥®é¸©æ­¢æ¸´ã€‚æ‰€æœ‰çš„æ™ºæ…§ç”Ÿç‰©éƒ½åœ¨é€šè¿‡ä¸æ–­çš„ç§‘æŠ€è¿›æ­¥ï¼Œä¸æ–­çš„æ¢ç´¢æœªçŸ¥æ¥æ»¡è¶³ç€è‡ªå·±çš„æ¢ç´¢æ¬²æœ›ã€‚è¿™äº›ç§‘æŠ€ï¼Œä»¥åŠç†è®ºè¿˜æœ‰çŸ¥è¯†ï¼Œä¸æ˜¯å¥½ä¸œè¥¿ï¼Œå®ƒä»¬æ˜¯æ¯’è¯ï¼Œå®ƒä»¬ä¼šè®©æ–‡æ˜å½¢æˆå¼ºçƒˆçš„ä¾èµ–ç—‡ï¼Œå½“æ‰€æœ‰çš„æœªçŸ¥éƒ½è¢«æ¢ç´¢å®Œæ¯•çš„æ—¶å€™ï¼Œè¿™ç§é¸©æ¯’å°±ä¼šæœ€ç»ˆå‘ä½œï¼Œå¹¶ä¸”è®©è¿™ä¸ªæ–‡æ˜æœ€ç»ˆé™·å…¥åˆ°æ¯’å‘èº«äº¡çš„å¢ƒåœ°ä¹‹ä¸­ã€‚å¯æ˜¯æœ€å¯ç¬‘çš„æ˜¯ï¼Œè™½ç„¶è¿™ä¸ªé“ç†ååˆ†æ˜æ˜¾ï¼Œå¯æ˜¯åŒ…æ‹¬æˆ‘åœ¨å†…çš„æ‰€æœ‰æ–‡æ˜ï¼Œéƒ½æ— æ³•é€ƒè„±è¿™ä¸ªæ€ªåœˆã€‚â€    â€œæˆ‘â€¦â€¦æˆ‘æ€ä¹ˆå¯ä»¥åœæ­¢å‘¢ï¼Ÿå°±ç®—å®ƒä»¬æ˜æ˜æ˜¯æ¯’è¯ï¼Œå¯æ˜¯æˆ‘ä¹Ÿè¦ä¸æ–­çš„å»åƒå•Šã€‚â€è§å®‡å–ƒå–ƒè‡ªè¯­ç€ï¼Œâ€œå¦‚æœæˆ‘çš„ç§‘æŠ€ä¸èƒ½è¿›æ­¥ï¼Œå¦‚æœç°åœ¨å°±æ–©æ–­æˆ‘è¿›æ­¥çš„é“è·¯ï¼Œæˆ‘ç°åœ¨å°±ä¼šå‘ç–¯çš„ã€‚è¿™ä¸€ç‚¹æ˜¯å¤©ç”Ÿæ³¨å®šçš„ï¼Œå½“æˆ‘è¿˜åœ¨åœ°çƒä¸Šçš„æ—¶å€™ï¼Œå½“æˆ‘æ‹¿èµ·ç¬”ï¼Œæ‹¿èµ·ä¹¦æœ¬ï¼Œå­¦ä¹ åˆ°ç¬¬ä¸€ä¸ªæ•°å­¦å…¬å¼ï¼Œå­¦ä¹ åˆ°ç¬¬ä¸€ä¸ªç‰©ç†å®šç†çš„æ—¶å€™ï¼Œè¿™ç§é¸©æ¯’å°±å·²ç»åœ¨æˆ‘çš„çµé­‚æ·±å¤„æ·±æ·±çš„æ‰ä¸‹äº†æ ¹ï¼Œè®©æˆ‘ç»ˆå…¶ä¸€ç”Ÿä¸å¾—è§£è„±ã€‚æˆ‘çš„æ¯’ç˜¾ä¼šè¶Šæ¥è¶Šå¤§ï¼Œæˆ‘æ‰€éœ€è¦çš„é¸©æ¯’åˆ†é‡ä¼šè¶Šæ¥è¶Šå¤šï¼Œæˆ‘åªèƒ½ç»§ç»­è¿™æ ·ç»´æŒä¸‹å»ã€‚ä»¥åå†æ¯’å‘ï¼Œæ€»æ¯”ç°åœ¨å°±æ¯’å‘è¦å¥½ã€‚â€    è¿™ä¸ªæ­»åœ¨æ—…é€”ä¹‹ä¸­çš„æ–‡æ˜ï¼Œè®©è§å®‡æƒ³åˆ°äº†å¾ˆå¤šå¾ˆå¤šï¼Œå¯¹è§å®‡çš„çµé­‚é€ æˆäº†å¾ˆæ·±çš„è§¦åŠ¨ã€‚å¯æ˜¯è§å®‡å·²ç»æ— æ³•åœä¸‹è‡ªå·±çš„è„šæ­¥äº†ã€‚æµ©ç€šå¹¿é˜”çš„æ˜Ÿç©ºï¼Œæ— è¾¹æ— é™…çš„å®‡å®™ï¼Œå°±åƒæ˜¯ç¾ä¸½å¼‚å¸¸çš„ç½‚ç²ŸèŠ±ï¼Œæ˜çŸ¥é“å±é™©ï¼Œå¯æ˜¯è¿˜æ˜¯æœ‰ä¸è®¡å…¶æ•°çš„æ–‡æ˜ï¼ŒåŒ…æ‹¬è§å®‡åœ¨å†…éƒ½è¸äº†è¿›å»ï¼Œå¹¶ä¸”ä¸€ä¸ªä¸ªè¸Šè·ƒå¼‚å¸¸ï¼Œç”Ÿæ€•è‡ªå·±å¸é£Ÿæ¯’å“çš„é€Ÿåº¦è¦æ¯”å…¶ä½™çš„æ–‡æ˜æ…¢äº†ä¸€ç‚¹ã€‚</blockquote><h2 id=""><a href="#" class="headerlink" title=""></a></pre></h2><p>ä»¥ä¸Šã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>ä¹±ä¸ƒå…«ç³Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šæˆ‘çš„å®‰å“çˆ¬å‘ä¹‹æ—…ã€‹--é«˜å¾·åœ°å›¾é‡åˆ°çš„å‘</title>
    <link href="/2016/12/18/%E3%80%8A%E6%88%91%E7%9A%84%E5%AE%89%E5%8D%93%E7%88%AC%E5%9D%91%E4%B9%8B%E6%97%85%E3%80%8B-%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BE%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91-1/"/>
    <url>/2016/12/18/%E3%80%8A%E6%88%91%E7%9A%84%E5%AE%89%E5%8D%93%E7%88%AC%E5%9D%91%E4%B9%8B%E6%97%85%E3%80%8B-%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BE%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91-1/</url>
    
    <content type="html"><![CDATA[<p>è¿™ç¯‡åšå®¢æ˜¯å…³äºé«˜å¾·ä½¿ç”¨ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œæˆ–è®¸æ˜¯å› ä¸ºå¼€å‘æ–‡æ¡£ä¸­æ²¡æœ‰è¯´æ˜ï¼Œæˆ–è®¸æ˜¯å› ä¸ºè‡ªå·±æ®µä½ä¸å¤Ÿï¼Œåæ­£å°±æ˜¯é‡åˆ°å‘äº†ã€‚</p><span id="more"></span><p>####ç”Ÿæˆkey</p><ol><li>ç”Ÿæˆkeyçš„æ—¶å€™ï¼ŒåŒä¸€ä¸ªappä¸‹ï¼Œå¯ä»¥å¡«å…¥ç›¸åŒçš„åŒ…åã€keyåç§°ç­‰ã€‚æ³¨æ„ä¸è¦ç”¨é”™äº†key</li><li>ç”±äºé«˜å¾·åœ°å›¾å‡çº§çš„åŸå› ï¼Œéœ€è¦å°†åŸæ¥æ²¡æœ‰æ•´ç†è¿‡çš„keyå…ˆæ•´ç†ï¼Œä½¿å…¶å±äºæŸä¸ªåº”ç”¨ï¼Œæ‰å¯ä»¥ç»§ç»­åˆ›å»ºå…¶ä»–çš„keyã€‚</li></ol><p>####æ–‡æ¡£</p><ol><li>ä»…åœ¨å…¥é—¨æŒ‡å—ä¸­æåˆ°äº†éœ€è¦åŠ å…¥ <strong><code>&lt;service android:name=&quot;com.amap.api.location.APSService&quot;&gt;&lt;/service&gt;</code></strong><br>å¼€å‘æ³¨æ„äº‹é¡¹é‡Œé¢å±…ç„¶æ²¡æœ‰æåˆ°ã€‚æœ€å…³é”®çš„æ˜¯ï¼Œæ²¡æœ‰åŠ å…¥è¿™ä¸ªserviceæ—¶ï¼Œå®šä½æœ‰æ—¶è¿˜èƒ½æˆåŠŸï¼Œåªæ˜¯ä¸èƒ½è¿ç»­å®šä½ã€‚æˆ‘çœ‹çš„æ—¶å€™æ—¶ä»å¼€å‘æ³¨æ„äº‹é¡¹å¼€å§‹çœ‹çš„ï¼Œå®Œå…¨æ²¡æœ‰æ³¨æ„åˆ°è¿™ä¸€ç‚¹ï¼Œåæ¥åœ¨demoä¸­çœ‹åˆ°äº†éœ€è¦åŠ å…¥è¿™ä¸ªé…ç½®ï¼Œæ‰èƒ½ç”Ÿæ•ˆã€‚</li><li>æ–‡æ¡£é‡Œé¢åªç»™å‡ºäº†éƒ¨åˆ†å…³é”®ä»£ç å’Œéƒ¨åˆ†å…³é”®ç±»ï¼Œå®Œå…¨ä¸çŸ¥é“è¿™ä¸ªç±»æ€ä¹ˆå®ä¾‹åŒ–ï¼Œæ€ä¹ˆå»è°ƒç”¨æ–¹æ³•ï¼Œè°ƒç”¨æ–¹æ³•çš„æ—¶å€™éœ€è¦ä¼ å…¥å“ªç§ç±»å‹çš„å‚æ•°ã€‚<hr>å°±æˆ‘ä¸ªäººçœ‹æ¥ï¼Œçœ‹å®˜æ–¹apiæ–‡æ¡£è¿˜ä¸å¦‚å»çœ‹ä»–ä»¬çš„demoï¼Œæ–‡æ¡£å†™çš„çœŸå¿ƒä¸ç®—å¥½ã€‚å®˜æ–¹éƒ¨åˆ†demoåœ°å€[å®˜æ–¹demoåœ°å€](http://lbs.amap.com/dev/demo) å®˜æ–¹sdkä»¥åŠå¼€å‘æ–‡æ¡£ã€demoç­‰ç›¸å…³ä¸‹è½½[å®˜æ–¹sdkã€å¼€å‘æ–‡æ¡£ä»¥åŠdemo](http://lbs.amap.com/api/android-sdk/download/) ä»¥åé‡åˆ°å‘å†è¡¥å……å§ï¼Œä¼°è®¡é‡åˆ°çš„éƒ½æ˜¯æ–‡æ¡£ä¸­æ²¡æœ‰æ ‡æ˜ä½†åœ¨demoä¸­æœ‰ç¤ºä¾‹çš„é‚£ç§ã€‚</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Androidçˆ¬å‘ä¹‹æ—…</tag>
      
      <tag>é«˜å¾·åœ°å›¾</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Šæˆ‘çš„å®‰å“çˆ¬å‘ä¹‹æ—…ã€‹--èäº‘IMé‡åˆ°çš„å‘</title>
    <link href="/2016/12/01/%E3%80%8A%E6%88%91%E7%9A%84%E5%AE%89%E5%8D%93%E7%88%AC%E5%9D%91%E4%B9%8B%E6%97%85%E3%80%8B-%E8%9E%8D%E4%BA%91IM%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/"/>
    <url>/2016/12/01/%E3%80%8A%E6%88%91%E7%9A%84%E5%AE%89%E5%8D%93%E7%88%AC%E5%9D%91%E4%B9%8B%E6%97%85%E3%80%8B-%E8%9E%8D%E4%BA%91IM%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/</url>
    
    <content type="html"><![CDATA[<p>è¿™ç¯‡åšå®¢æ˜¯å…³äºèäº‘IMä½¿ç”¨ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œä¸ç®—æ˜¯å‘ï¼Œåªèƒ½è¯´æ˜¯æ³¨æ„äº‹é¡¹å§</p><span id="more"></span><h4 id="åç«¯å‘"><a href="#åç«¯å‘" class="headerlink" title="åç«¯å‘"></a>åç«¯å‘</h4><p>  åœ¨è‡ªå·±çš„åº”ç”¨â€OurStoriesâ€ä¸­æ‰“ç®—æ¥å…¥IMå³æ—¶é€šè®¯åŠŸèƒ½ï¼Œå°±ä½¿ç”¨äº†èäº‘æä¾›çš„sdkï¼Œéœ€è¦è‡ªå·±å†™åå°è·å–Tokenï¼Œè¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œå®˜æ–¹ç»™å‡ºäº†Demoï¼ŒæŒ‰ç…§è‡ªå·±çš„ä¹ æƒ¯ï¼ŒæŠŠdemoé‡Œé¢çš„æ–¹æ³•å°è£…ä¸€ä¸‹å°±å¯ä»¥ä½¿ç”¨äº†ã€‚</p><h4 id="Tokenå‘"><a href="#Tokenå‘" class="headerlink" title="Tokenå‘"></a>Tokenå‘</h4><ol><li>è·å–Tokenæ—¶å¯ä»¥åœ¨èäº‘åå°ï¼ˆç™»å½•è‡ªå·±å¸å·ï¼Œæ§åˆ¶å°ï¼‰å¯ä»¥è®¾ç½®Tokenæœ‰æ•ˆæœŸã€‚</li><li>åœ¨åˆå§‹æƒ…å†µä¸‹å¼€å‘ç¯å¢ƒä¸‹æœ€å¤šåªèƒ½æœ‰100ä¸ªæµ‹è¯•ç”¨æˆ·ï¼Œå½“è¾¾åˆ°ä¸Šé™åå¯ä»¥ç‚¹å‡»æ·»åŠ ç”¨æˆ·çš„æŒ‰é’®ï¼Œæ¯æ¬¡æ·»åŠ 20äººä¸Šé™ï¼Œç”Ÿäº§ç¯å¢ƒæ²¡æœ‰ä¸Šé™ã€‚</li><li>å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒåœ¨èäº‘åå°æ˜¯ä¸¤å¥—ç‹¬ç«‹çš„ç¯å¢ƒï¼Œæ‹¥æœ‰ä¸åŒçš„<code>App Key</code>å’Œ<code>App Secret</code>ï¼Œå½“äº§å“ä¸Šçº¿æ—¶ä¸è¦å¿˜è®°åˆ‡æ¢è‡ªå·±æœåŠ¡å™¨å’Œappçš„é…ç½®ï¼Œå¦å¤–ï¼Œappçš„<code>App Key</code>å’ŒæœåŠ¡å™¨ç«¯çš„<code>App Key</code>è¦ä¸€è‡´ã€‚<h4 id="å‰ç«¯-Androidå‘"><a href="#å‰ç«¯-Androidå‘" class="headerlink" title="å‰ç«¯ Androidå‘"></a>å‰ç«¯ Androidå‘</h4></li><li>ç”±äºé›†æˆèäº‘çš„èŠå¤©ç•Œé¢ä¸ªä¼šè¯åˆ—è¡¨ç•Œé¢éƒ½æ˜¯Fragmentå½¢å¼ï¼Œåœ¨é›†æˆçš„è¿‡ç¨‹ä¸­ï¼ŒåŒ…å«è¯¥Fragmentçš„Activityè¦ç»§æ‰¿è‡ª<strong>FragmentActivity</strong>ï¼Œå¦åˆ™åœ¨å¼€å¯èŠå¤©ç•Œé¢çš„æ—¶å€™ä¼šæŠ¥å¦‚ä¸‹å¼‚å¸¸ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">Caused by: android.view.InflateException: Binary XML file line #<span class="hljs-number">6</span>: Binary XML file line #<span class="hljs-number">6</span>: Error inflating <span class="hljs-keyword">class</span> <span class="hljs-title class_">fragment</span> <br>Caused by: android.view.InflateException: Binary XML file line #<span class="hljs-number">6</span>: Error inflating <span class="hljs-keyword">class</span> <span class="hljs-title class_">fragment</span> <br>Caused by: android.app.Fragment$InstantiationException: Trying to instantiate a <span class="hljs-keyword">class</span> <span class="hljs-title class_">io</span>.rong.imkit.fragment.ConversationFragment that is not a Fragment <br>Caused by: java.lang.ClassCastException <br></code></pre></td></tr></table></figure></li><li>èäº‘åœ¨åˆå§‹åŒ–çš„æ—¶å€™å»ºè®®æ”¾åœ¨Applicatuonä¸­è¿›è¡Œï¼Œä½†æ˜¯èäº‘ä¼šå¼€å¯3ä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½ä¼šæ‰§è¡ŒApplicationçš„OnCreateæ–¹æ³•ï¼Œå»ºè®®åœ¨åˆå§‹åŒ–è‡ªå·±çš„é…ç½®æ—¶æ£€æµ‹ä»¥ä¸‹è¿›ç¨‹ï¼Œåœ¨è‡ªå·±çš„ä¸»è¿›ç¨‹ä¸­åˆå§‹åŒ–è‡ªå·±çš„é…ç½®.</li><li>åƒä¸‡ä¸è¦å¿˜è®°é…ç½®åŒ…å«èäº‘Fragmentçš„Activityçš„<code>&lt;intent-filter&gt;</code></li><li>èäº‘ä¸åŒæ­¥ä¹Ÿä¸ä¼šä¿å­˜åº”ç”¨ä¸‹çš„å¥½å‹å…³ç³»ï¼Œéœ€è¦è‡ªå·±çš„æœåŠ¡å™¨ä¿å­˜</li><li>æ³¨æ„é˜…è¯»èäº‘çš„å¼€å‘æ–‡æ¡£ï¼Œæ³¨æ„æ¯ä¸€ä¸ªç»†èŠ‚</li><li>æœ‰é—®é¢˜å…ˆå»æœçŸ¥è¯†åº“ï¼Œç„¶åæå·¥å•ã€‚æå·¥å•çš„æ—¶å€™å°½å¯èƒ½è¯¦ç»†çš„æè¿°è‡ªå·±çš„å¼€å‘ç¯å¢ƒï¼Œé‡åˆ°çš„é—®é¢˜ä»¥åŠå¼‚å¸¸æ—¥å¿—ã€‚</li><li>éå¿…è¦æƒ…å†µä¸‹ï¼Œä¸è¦è‡ªå·±å»åç¼–è¯‘å‡ºèäº‘çš„sdkï¼Œç„¶åè‡ªå·±ä½¿ç”¨ç”¨å…¶ä¸­çš„ä»£ç ã€‚</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>Android</tag>
      
      <tag>Androidçˆ¬å‘ä¹‹æ—…</tag>
      
      <tag>èäº‘IM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hexo+gitpageæ­å»ºè‡ªå·±çš„åšå®¢(ä¸‰)</title>
    <link href="/2016/10/30/hexo-gitpage%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2-%E4%B8%89/"/>
    <url>/2016/10/30/hexo-gitpage%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2-%E4%B8%89/</url>
    
    <content type="html"><![CDATA[<p>å‰ä¸¤ç¯‡ä»‹ç»äº†æ€ä¹ˆç”¨gitpage+githubæ­å»ºè‡ªå·±çš„åšå®¢ï¼Œè¿™æ¬¡ä¸»è¦ä»‹ç»æ€ä¹ˆæ›´æ¢ä¸»é¢˜å’ŒåŠ å…¥è¯„è®ºã€ç»Ÿè®¡ç­‰ã€‚</p><hr><span id="more"></span><p><strong>æ›´æ¢ä¸»é¢˜</strong><br>é¦–å…ˆå°† <code>yilia</code>ä¸»é¢˜ä»githubå…‹éš†åˆ°æœ¬åœ°<code>thems</code>æ–‡ä»¶å¤¹é‡Œé¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs git">git clone https://github.com/litten/hexo-theme-yilia.git themes/yilia<br></code></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹å½“å‰åšå®¢ç›®å½•çš„ç»“æ„<br><img src="/image/hexo/Catalog.png" alt="ç›®å½•ç»“æ„"></p><p>å…¶ä¸­<code>_config.yml</code>æ–‡ä»¶å°±æ˜¯æ•´ä¸ª<code>hexo</code>ç³»ç»Ÿçš„ä¸»é…ç½®æ–‡ä»¶<br>å¦å¤–åˆšæ‰å…‹éš†çš„<code>yilia</code>ä¸»é¢˜å°±åœ¨<code>thems</code>æ–‡ä»¶å¤¹ä¸‹é¢<br>é¦–å…ˆä¿®æ”¹æ ¹ç›®å½•ä¸‹çš„<code>_config.yml</code>æ–‡ä»¶ï¼Œåˆ‡æ¢åˆ°<code>yilia</code>ä¸»é¢˜<br>å¤§æ¦‚åœ¨æ–‡ä»¶çš„63-65è¡Œå·¦å³çš„ä½ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Extensions</span><br><span class="hljs-comment">## Plugins: https://hexo.io/plugins/</span><br><span class="hljs-comment">## Themes: https://hexo.io/themes/</span><br><span class="hljs-attr">theme:</span> <span class="hljs-string">yilia</span><br></code></pre></td></tr></table></figure><p>å°†åŸæ¥çš„<code>theme</code>åé¢çš„ <code>landscape</code>ä¸»é¢˜æ”¹æˆ<code>yilia</code><br>é‡å¯æœåŠ¡åä¸»é¢˜å°±åˆ‡æ¢åˆ°<code>yilia</code>äº†ï¼Œä¸‹é¢æ˜¯<code>thems/yilia</code>æ–‡ä»¶å¤¹ä¸‹çš„<code>_config.yml</code>æ–‡ä»¶çš„é…ç½®.</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs yml"><br><span class="hljs-comment"># Header</span><br><span class="hljs-attr">menu:</span><br>  <span class="hljs-string">ä¸»é¡µ:</span> <span class="hljs-string">/</span><br>  <span class="hljs-string">ç®€å†:</span> <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-comment"># SubNav</span><br><span class="hljs-attr">subnav:</span><br>  <span class="hljs-attr">github:</span> <span class="hljs-string">&quot;https://github.com/huangyuanlove&quot;</span><br>  <span class="hljs-comment">#weibo: &quot;#&quot;</span><br>  <span class="hljs-comment">#rss: &quot;#&quot;</span><br>  <span class="hljs-attr">zhihu:</span> <span class="hljs-string">&quot;https://www.zhihu.com/people/huangyuan_xuan&quot;</span><br>  <span class="hljs-comment">#douban: &quot;#&quot;</span><br>  <span class="hljs-comment">#mail: &quot;#&quot;</span><br>  <span class="hljs-comment">#facebook: &quot;#&quot;</span><br>  <span class="hljs-comment">#google: &quot;#&quot;</span><br>  <span class="hljs-comment">#twitter: &quot;#&quot;</span><br>  <span class="hljs-comment">#linkedin: &quot;#&quot;</span><br><br><span class="hljs-attr">rss:</span> <span class="hljs-string">/atom.xml</span><br><br><span class="hljs-comment"># æ˜¯å¦éœ€è¦ä¿®æ”¹ root è·¯å¾„</span><br><span class="hljs-comment"># å¦‚æœæ‚¨çš„ç½‘ç«™å­˜æ”¾åœ¨å­ç›®å½•ä¸­ï¼Œä¾‹å¦‚ http://yoursite.com/blogï¼Œ</span><br><span class="hljs-comment"># è¯·å°†æ‚¨çš„ url è®¾ä¸º http://yoursite.com/blog å¹¶æŠŠ root è®¾ä¸º /blog/ã€‚</span><br><span class="hljs-attr">root:</span><br><br><span class="hljs-comment"># Content</span><br><span class="hljs-attr">excerpt_link:</span> <span class="hljs-string">more</span><br><span class="hljs-attr">fancybox:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">mathjax:</span> <span class="hljs-literal">false</span><br><br><span class="hljs-comment"># æ˜¯å¦å¼€å¯åŠ¨ç”»æ•ˆæœ</span><br><span class="hljs-attr">animate:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-comment"># æ˜¯å¦åœ¨æ–°çª—å£æ‰“å¼€é“¾æ¥</span><br><span class="hljs-attr">open_in_new:</span> <span class="hljs-literal">false</span><br><br><span class="hljs-comment"># è‡ªå·±æ·»åŠ çš„ç™¾åº¦ç»Ÿè®¡</span><br><span class="hljs-attr">baidu_tongji:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-comment"># ç½‘ç«™icon</span><br><span class="hljs-attr">favicon:</span> <span class="hljs-string">favicon.ico</span><br><br><span class="hljs-comment">#ä½ çš„å¤´åƒurl</span><br><span class="hljs-attr">avatar:</span> <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-comment">#æ˜¯å¦å¼€å¯åˆ†äº«</span><br><span class="hljs-attr">share_jia:</span> <span class="hljs-literal">false</span><br><span class="hljs-attr">share_addthis:</span> <span class="hljs-literal">false</span><br><br><span class="hljs-comment">#å¤šè¯´è¯„è®º</span><br><span class="hljs-attr">duoshuo:</span><br><br><span class="hljs-comment"># å¦‚ä¸éœ€è¦ï¼Œå°†è¯¥é¡¹ç½®ä¸ºfalse</span><br><span class="hljs-comment"># æ¯”å¦‚</span><br><span class="hljs-comment">#smart_menu:</span><br><span class="hljs-comment">#  friends: false</span><br><br><span class="hljs-attr">smart_menu:</span><br>  <span class="hljs-attr">innerArchive:</span> <span class="hljs-string">&#x27;æ‰€æœ‰æ–‡ç« &#x27;</span><br>  <span class="hljs-attr">tagcloud:</span> <span class="hljs-string">&#x27;æ ‡ç­¾&#x27;</span><br>  <span class="hljs-comment">#friends: &#x27;å‹é“¾&#x27;</span><br>  <span class="hljs-attr">aboutme:</span> <span class="hljs-string">&#x27;å…³äºæˆ‘&#x27;</span><br><br><span class="hljs-attr">friends:</span><br><span class="hljs-attr">aboutme:</span> <span class="hljs-string">&lt;a</span> <span class="hljs-string">href=&quot;http://www.huangyuanlove.com&quot;&gt;ä»€ä¹ˆæ‡‚éƒ½ç‚¹çš„Androidæ”»åŸç‹®&lt;/a&gt;</span><br></code></pre></td></tr></table></figure><hr><p>ä»¥ä¸Šæ˜¯<code>yilia</code>ä¸»é¢˜çš„é…ç½®è¯´æ˜<br><strong>æ¥å…¥ç™¾åº¦ç»Ÿè®¡</strong><br>é¦–å…ˆåˆ°<a href="http://tongji.baidu.com/web/welcome/login">ç™¾åº¦ç»Ÿè®¡å¹³å°</a> ç”³è¯·ä¸€ä¸ªå¸å·ï¼ŒæŒ‰ç…§æç¤ºå¡«å†™å®Œè‡ªå·±ç½‘ç«™çš„ä¿¡æ¯ï¼Œåœ¨ç½‘ç«™ä¸­å¿ƒå·¦è¾¹æ ç‚¹å‡»ä»£ç è·å–ï¼Œå¾—åˆ°ç»Ÿè®¡è®¿é—®é‡çš„ä»£ç ã€‚<br>æ–°å»º<code>themes/yilia/layout/_partial/baidu_tongji.ejs</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">&lt;% <span class="hljs-keyword">if</span> (theme.<span class="hljs-property">baidu_tongji</span>) &#123; %&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="language-xml">  ç»Ÿè®¡è®¿é—®é‡çš„ä»£ç </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br>&lt;% &#125; %&gt;<br></code></pre></td></tr></table></figure><p>ç„¶åç¼–è¾‘<code>themes/yilia/_config.yml</code>æ–‡ä»¶ï¼Œæ·»åŠ ä¸€è¡Œ<code>baidu_tongji: true</code>ï¼Œæ³¨æ„å†’å·åé¢æœ‰ç©ºæ ¼ã€‚<br>ç¼–è¾‘<code>themes/yilia/layout/_partial/head.ejs</code> åœ¨ <code>&lt;/head&gt;</code> å‰æ·»åŠ <br><code>&lt;%- partial(&quot;baidu_tongji&quot;) %&gt;</code><br>é‡å¯éƒ¨ç½²ä»£ç å³å¯ã€‚<br>å®‰è£…å®Œæˆ20åˆ†é’Ÿåå°±å¯ä»¥åœ¨åå°çœ‹åˆ°ç»Ÿè®¡çš„ä¿¡æ¯äº†ï¼Œå¦‚æœçœ‹ä¸åˆ°ç»Ÿè®¡ä¿¡æ¯ï¼Œè¯·æ£€æŸ¥æ˜¯å¦é…ç½®æ­£ç¡®ï¼Œæ£€æµ‹æ–¹å¼ç‚¹<a href="http://tieba.baidu.com/p/3775626020">è¿™é‡Œ</a> <a href="http://tieba.baidu.com/p/3775626020">http://tieba.baidu.com/p/3775626020</a><br>ä»¥ä¸Šæ˜¯æ·»åŠ ç™¾åº¦ç»Ÿè®¡çš„æ–¹å¼<br><strong>æ·»åŠ å¤šè¯´è¯„è®º</strong><br>åˆ°<a href="http://duoshuo.com/">å¤šè¯´</a> ç”³è¯·å¸å·<br>ä½¿ç”¨ä¸‰æ–¹ç™»å½•å®Œæˆåï¼Œç‚¹å‡»<code>æˆ‘è¦å®‰è£…</code>ï¼Œæ ¹æ®æç¤ºå¡«å†™å®Œä¿¡æ¯<br><img src="/image/hexo/duoshuo.png" alt="å¤šè¯´"><br>è®°ä½ç«™ç‚¹åç§°ï¼Œå°†ç«™ç‚¹åç§°å¡«å…¥ <code>thems/yilia/_config.yml</code>æ–‡ä»¶é‡Œé¢å¤šè¯´è¯„è®ºä¹‹åï¼Œæ³¨æ„å†’å·åé¢æœ‰ç©ºæ ¼ã€‚<br>ä¿å­˜é‡æ–°éƒ¨ç½²å°±å¯ä»¥çœ‹åˆ°è¯„è®ºæ¡†äº†ã€‚<br>è‡³äºè¯„è®ºæ ·å¼ï¼Œå¯ä»¥åœ¨åå°ç®¡ç†é¡µé¢ä¸­çš„è®¾ç½®é€‰é¡¹ä¸­è®¾ç½®ã€‚åå°ç®¡ç†ä¸­è¿˜å¯ä»¥ç®¡ç†è¯„è®ºå†…å®¹ï¼Œæ·»åŠ æ•æ„Ÿè¯æ±‡è¿‡æ»¤ç­‰ã€‚<br>ä»¥ä¸Šæ˜¯æ·»åŠ å¤šè¯´è¯„è®ºçš„è¿‡ç¨‹ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>hexo</tag>
      
      <tag>gitpage</tag>
      
      <tag>blog</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hexo+gitpageæ­å»ºè‡ªå·±çš„åšå®¢(äºŒ)</title>
    <link href="/2016/10/25/hexo-gitpage%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2-%E4%BA%8C/"/>
    <url>/2016/10/25/hexo-gitpage%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2-%E4%BA%8C/</url>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰æˆ‘ä»¬å·²ç»å®‰è£…å¥½äº†<code>hexo</code>ï¼Œæ¥ä¸‹æ¥å°±æ˜¯åˆå§‹åŒ–äº†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo init &lt;dir&gt;<br>cd &lt;dir&gt;<br>npm install<br></code></pre></td></tr></table></figure><span id="more"></span><p><img src="/image/hexo/hexo_init.png" alt="hexo_install"><br><img src="/image/hexo/npm_install.png" alt="hexo_install"><br>ç°åœ¨hexoå°±å®‰è£…å®Œæˆäº†ï¼Œåœ¨å­˜æ”¾hexoçš„æ–‡ä»¶å¤¹ç›®å½•ä¸‹æ‰§è¡Œ <code>hexo s</code>ï¼Œå°±å¯ä»¥å¯åŠ¨hexoçš„æœåŠ¡ï¼Œå¯åŠ¨ä¹‹åæœ‰æç¤ºï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥<code>127.0.0.1:4000</code>å°±å¯ä»¥çœ‹åˆ°æœ€åˆçš„æ•ˆæœäº†ï¼Œå¦‚ä¸‹<br><img src="/image/hexo/hexo_hello.png" alt="hello_world"></p><hr><p>ã€€ã€€å¯¹äº†ï¼Œè¿˜è¦å‘å¸ƒåˆ°githubã€‚å‰æå‡†å¤‡æ˜¯åœ¨ä¸Šä¸€ç¯‡ä¸­å·²ç»åˆ›å»ºå¥½äº†githubçš„ä»“åº“ã€‚æ¥ä¸‹æ¥åœ¨å­˜æ”¾hexoèµ„æºçš„æ–‡ä»¶å¤¹ä¸‹(ä»¥ä¸‹ç”¨ heox_blogè¿™ä¸ªæ–‡ä»¶å¤¹ä»£æ›¿)æ‰§è¡Œ<br><code>npm install hexo-deployer-git --save</code><br>ä¿®æ”¹hexo_blogæ–‡ä»¶å¤¹ä¸‹çš„<code>_config.yml</code>æ–‡ä»¶<br>åœ¨æœ«å°¾æ·»åŠ </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">deploy:<br>  type: git<br>  repository: git@github.com:your name/your name.github.io.git<br>  branch: master<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œtypeï¼Œrepositoryï¼Œbranchå†’å·åé¢éƒ½æœ‰ä¸€ä¸ªç©ºæ ¼ã€‚ä¿å­˜åæ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs hexo">hexo clean<br>hexo g<br>hexo d<br></code></pre></td></tr></table></figure><p>å°±å¯ä»¥å°†å†™å¥½çš„åšå®¢éƒ¨ç½²åˆ°githubä¸Šäº†ã€‚ï¼ˆéƒ¨ç½²åˆ°githubæ—¶å»ºè®®æŒ‰ç…§é¡ºåºæ‰§è¡Œä»¥ä¸Šå‘½ä»¤ï¼‰</p><hr><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs hexo">hexo generate == hexo g    --&gt;å°†mdæ–‡ä»¶è§£ææˆé™æ€çš„htmlæ–‡ä»¶<br>hexo deploy == hexo d      --&gt; å°†æ–‡ä»¶éƒ¨ç½²åˆ°github<br>hexo server == hexo s      --&gt; å¯åŠ¨æœ¬åœ°hexoæœåŠ¡<br>hexo clean   --&gt; æ¸…é™¤ç¼“å­˜<br>hexo new &quot;title&quot; --&gt; åˆ›å»ºæ–°çš„æ–‡ç« ï¼Œæ–‡ä»¶åœ¨`hexo_blog/source/_posts`æ–‡ä»¶å¤¹ä¸‹<br></code></pre></td></tr></table></figure><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>hexo</tag>
      
      <tag>gitpage</tag>
      
      <tag>blog</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hexo+gitpageæ­å»ºè‡ªå·±çš„åšå®¢(ä¸€)</title>
    <link href="/2016/10/21/hexo-gitpage%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2-%E4%B8%80/"/>
    <url>/2016/10/21/hexo-gitpage%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2-%E4%B8%80/</url>
    
    <content type="html"><![CDATA[<p><strong>ä¸è¯´ç¯å¢ƒç›´æ¥å†™é…ç½®çš„è¡Œä¸ºéƒ½æ˜¯è€æµæ°“</strong><br>æŒ‰ç…§æƒ¯ä¾‹,å…ˆè¯´è‡ªå·±çš„ç¯å¢ƒ:<code>ubunu</code>,ç„¶åå°±æ²¡æœ‰ç„¶åäº†.<hr></p><span id="more"></span><p>ã€€ã€€<code>hexo</code>ç±»ä¼¼<code>wordpress</code>çš„åšå®¢æ¡†æ¶,<code>gitpage</code>æ˜¯<code>github</code>çš„ä¸€ä¸ªæœåŠ¡,è¯·åŸè°…æˆ‘è¿™ä¸ªä¸å¤§å‡†ç¡®çš„è¡¨è¾¾,äº‹å®ä¸ŠçœŸçš„å·®ä¸å¤š.<br>å®‰è£…<code>hexo</code>éœ€è¦å®‰è£…<code>nodejs</code>,ä½¿ç”¨<code>gitpage</code>éœ€è¦<code>git</code>,è‡³äºå¦‚ä½•å®‰è£…<code>git</code>,åœ¨åŸæ¥çš„csdnåšå®¢ä¸Šæœ‰,<a href="http://blog.csdn.net/huangyuan_xuan/article/details/49125597">ç‚¹å‡»è¿™é‡Œ</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/49125597">http://blog.csdn.net/huangyuan_xuan/article/details/49125597</a>.<br>ä¹‹åéœ€è¦åœ¨è‡ªå·±çš„githubä¸Šåˆ›å»ºä¸€ä¸ªä»“åº“,åç§°ç»“æ„å¦‚ä¸‹:<code>username.github.io</code>,ä¾‹å¦‚æˆ‘çš„githubä¸»é¡µæ˜¯<code>https://github.com/huangyuanlove</code>,é‚£ä¹ˆæˆ‘çš„<code>gitpage</code>å°±æ˜¯<code>huangyuanlove.github.io</code>.<br>åˆ°è¿™é‡Œ,é»˜è®¤å¤§å®¶çš„gitpageå’Œgitå·²ç»é…ç½®å¥½äº†,åŒ…æ‹¬sshkeyä¹‹ç±»çš„ä¸œè¥¿.</p><hr><p>ã€€ã€€æˆ‘å®‰è£…<code>node</code>æ˜¯ç”¨<code>nvm</code>(node version manager)å®‰è£…çš„,ç„¶åä½¿ç”¨<code>node</code>ä¸­çš„<code>npm</code>(node package manager)å®‰è£…hexo.windowsä¸‹å®‰è£…è¯·è½¬<a href="https://github.com/coreybutler/nvm-windows">è¿™é‡Œ</a> <a href="https://github.com/coreybutler/nvm-windows">https://github.com/coreybutler/nvm-windows</a><br>é¦–å…ˆå®‰è£…<code>nvm</code>:</p><blockquote><p><code>wget -qO- https://raw.github.com/creationix/nvm/master/install.sh | sh  </code></p></blockquote><p><img src="/image/hexo/hexo_install_nvm.png" alt="å®‰è£…nvm" title="å®‰è£…nvmå›¾ç‰‡"><br>å®‰è£…æ—¶é—´é•¿çŸ­è§†ç½‘é€Ÿè€Œå®š,æˆ‘å®‰è£…äº†å¤§æ¦‚åå¤šåˆ†é’Ÿ,ç„¶åé‡å¯ä¸€ä¸‹ç»ˆç«¯.<br>ç„¶åä½¿ç”¨ <code>nvm ls-remote</code>æŸ¥çœ‹ä¸€ä¸‹æœ‰å“ªäº›æœ¬ç‰ˆå¯ä»¥å®‰è£…,æˆ‘å½“æ—¶å®‰è£…çš„æœ€æ–°ç‰ˆæ˜¯<code>6.6.0</code>,ç°åœ¨ä¸çŸ¥é“æ˜¯å“ªä¸€ç‰ˆ,å¦‚bä¸‹<br><img src="/image/hexo/nvm_ls-remote.png" alt="nvm ls-remote"><br>æ‰¾ä¸€ä¸ªåˆé€‚çš„ç‰ˆæœ¬ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…<br><code>nvm install version</code>,ä¾‹å¦‚ <code>nvm install 6.6.0</code><br><img src="/image/hexo/nvm_install_6.6.0.png" alt="nvm ls-remote">,å®‰è£…æ—¶é—´è¿˜æ˜¯è§†ç½‘é€Ÿè€Œå®š,æˆ‘ä¹Ÿå¿˜äº†è£…äº†å¤šé•¿æ—¶é—´äº†.<br>å®‰è£…å®Œæˆä¹‹åæ˜¯è¿™æ ·çš„<br><img src="/image/hexo/nvm_install_down.png" alt="nvm_install_down"><br>ä¹‹å<code>npm install -g hexo</code>å®‰è£…<code>hexo</code>,<code>-g</code>å‚æ•°æ˜¯å…¨å±€å®‰è£…<br><img src="/image/hexo/npm_install_hexo.png" alt="npm_install_hexo"><br>å®‰è£…å®Œæˆä¹‹åä½¿ç”¨<code>hexo -v</code>æŸ¥çœ‹hexoçš„ç‰ˆæœ¬å·<br><img src="/image/hexo/hexo-v.png" alt="hexo-v"><br>åˆ°æ­¤<code>hexo</code>å®‰è£…å®Œæˆ,æ¥ä¸‹æ¥å°±æ˜¯åˆå§‹åŒ–,è¿›è¡Œé…ç½®äº†.ä¸‹ä¸€ç¯‡å†è¯´å§,ç¡è§‰äº†.</p><hr><p>ä»¥ä¸Š.</p>]]></content>
    
    
    
    <tags>
      
      <tag>hexo</tag>
      
      <tag>gitpage</tag>
      
      <tag>blog</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¦‚ä½•è·å–csdnä¸­ä¸ªäººæ‰€æœ‰æ–‡ç« æ ‡é¢˜åŠé“¾æ¥</title>
    <link href="/2016/10/19/%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96csdn%E4%B8%AD%E4%B8%AA%E4%BA%BA%E6%89%80%E6%9C%89%E6%96%87%E7%AB%A0%E6%A0%87%E9%A2%98%E5%8F%8A%E9%93%BE%E6%8E%A5/"/>
    <url>/2016/10/19/%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96csdn%E4%B8%AD%E4%B8%AA%E4%BA%BA%E6%89%80%E6%9C%89%E6%96%87%E7%AB%A0%E6%A0%87%E9%A2%98%E5%8F%8A%E9%93%BE%E6%8E%A5/</url>
    
    <content type="html"><![CDATA[<p>å°ä¼™ä¼´é—®å¦‚ä½•æŠŠè‡ªå·±csdnä¸Šçš„æ–‡ç« æ ‡é¢˜å’Œè¶…é“¾æ¥éƒ½æ‰’ä¸‹æ¥,é—®æˆ‘æ˜¯ä¸æ˜¯ä¸€ä¸ªä¸ªç‚¹å¼€ä¹‹åæŠ„è¿‡å»çš„â€¦å½“ç„¶ä¸æ˜¯,åšä¸ºä¸€ä¸ªçˆ±(sha)å¥½(dou)å¹¿(dong)æ³›(dian)çš„ç¨‹åºå‘˜,æ€ä¹ˆä¼šç”¨è¿™ä¹ˆéº»çƒ¦çš„æ–¹æ³•.</p><span id="more"></span><p>ã€€ã€€æœ¬æ¥æ‰“ç®—å†™javaæ¨¡æ‹Ÿç™»å½•ä¹‹åè·å–ç½‘é¡µæºç ,ç„¶åå†ç”¨jsoupå»è§£æ,å¾—åˆ°è‡ªå·±éœ€è¦çš„æ•°æ®.åŸæ¥å°±è¿™ä¹ˆå¹²è¿‡,å¥½åƒæ˜¯å†™å­¦æ ¡çš„ç»©ç‚¹è®¡ç®—å™¨æ¥ç€å§,å°±æ˜¯è¾“å…¥å¸å·å¯†ç å°±èƒ½æŸ¥åˆ°è‡ªå·±çš„æˆç»©å’Œç»©ç‚¹çš„é‚£ç§.<br>ç¿»å‡ºæ¥ä»£ç çœ‹äº†çœ‹å¤ªéº»çƒ¦äº†,æƒ³åˆ°è‡ªå·±æœ€è¿‘åœ¨çœ‹python,å°±æƒ³ç€ç”¨pythonæ¥è§£å†³,ä½†æ˜¯é—®é¢˜åˆæ¥äº†,pythonä¸ç†Ÿå•Š,å°±ç®—å†™å‡ºæ¥äº†ä¹Ÿå¾—çœ‹ç½‘é¡µæºç ,æ‰¾åˆ°è§„å¾‹æ‰è¡Œ,è®²é“ç†çš„è¯´æŒºçƒ¦è¿™ä¸œè¥¿çš„.<br>æœ€å,è¿˜æ˜¯ç”¨jsæ¥è§£å†³,æ¯•ç«Ÿè¿™ç§äº‹ä¹Ÿå¹²è¿‡,ä¹Ÿä¸æ˜¯å¤šéº»çƒ¦.<br>ç™»å½•è‡ªå·±çš„å¸å·,æ‰¾åˆ°æ–‡ç« åˆ—è¡¨,æ‰“å¼€æ§åˆ¶å°çª—å£,å¿˜äº†è¯´ä¸€ä¸‹è‡ªå·±çš„ç¯å¢ƒäº†<code>ubuntu</code>,<code>chrom</code>,æ‰¾åˆ°æ–‡ç« æ ‡é¢˜å’Œè¶…é“¾æ¥çš„éƒ¨åˆ†,å¦‚ä¸‹å›¾:<br><img src="/image/csdn_home.png" alt="csdnä¸ªäººåšå®¢åˆ—è¡¨"><br>å‘ç°æ‰€æœ‰çš„æ–‡ç« æ ‡é¢˜å’Œè¶…é“¾æ¥ç»“æ„å¦‚ä¸‹:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs HTML"> <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;link_title&quot;</span>&gt;</span><br> <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/huangyuan_xuan/article/details/51935666&quot;</span>&gt;</span><br>        åˆæ­¥ç¼–å†™IDEA\AndroidStudioç¿»è¯‘æ’ä»¶            <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å¦å¤–,ç•Œé¢ä¸­è¿˜å¼•å…¥äº†jQueryè¿™ä¸ªä¸‰æ–¹åº“,è¿™å°±æ›´ç®€å•äº†:<br>æ‰¾åˆ°å¼€å‘è€…å·¥å…·çš„æ§åˆ¶å°(console),å†™å…¥ä¸‹é¢ä¸¤è¡Œä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">var</span> aTags = $(<span class="hljs-string">&quot;.link_title &gt; a&quot;</span>)<br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;i&lt;<span class="hljs-number">50</span>;i++)<br>&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[&quot;</span> + aTags[i].<span class="hljs-property">text</span>.<span class="hljs-title function_">trim</span>() + <span class="hljs-string">&quot;](&quot;</span> + aTags[i].<span class="hljs-property">href</span> +<span class="hljs-string">&quot;) &quot;</span>+ aTags[i].<span class="hljs-property">href</span>) +<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ok,æ‰§è¡Œç»“æœå¦‚ä¸‹<br><img src="/image/csdn_blog_title.png" alt="csdnä¸ªäººåšå®¢æ ‡é¢˜å’Œè¶…é“¾æ¥"><br>ã€€ã€€åœ¨æ§åˆ¶å°å†™çš„ä»£ç ç¬¬ä¸€è¡Œæ˜¯ä½¿ç”¨jQueryåº“æ‰¾åˆ°æ‰€æœ‰æ–‡ç« çš„è¶…é“¾æ¥é›†åˆ,ç¬¬äºŒè¡Œæ˜¯æŒ‰ç…§<code>markdown</code>è¶…é“¾æ¥çš„è¯­æ³•æ‰“å°å‡ºæ¥æ–‡ç« æ ‡é¢˜å’Œè¶…é“¾æ¥,è‡³äºå¾ªç¯ä¸­çš„<code>50</code>è¿™ä¸ªæ•°å­—,ä¸€é¡µæœ€å¤šåªæœ‰50ç¯‡æ–‡ç« ,æˆ‘å·æ‡’äº†,å»ºè®®ä½¿ç”¨<code>aTags.length</code></p><hr>ä»¥ä¸Š]]></content>
    
    
    
    <tags>
      
      <tag>csdn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŸCSDNåšå®¢</title>
    <link href="/2016/10/16/%E5%8E%9FCSDN%E5%8D%9A%E5%AE%A2/"/>
    <url>/2016/10/16/%E5%8E%9FCSDN%E5%8D%9A%E5%AE%A2/</url>
    
    <content type="html"><![CDATA[<p>ä¸æ‰“ç®—åœ¨csdnä¸Šé¢å†™åšå®¢äº†,è½¬åˆ°gitpageä¸Šé¢,è‡ªå·±ç”¨hexoæ­å»ºäº†åšå®¢ç³»ç»Ÿ.<br>ç°åœ¨æŠŠåŸcsdnçš„åšå®¢é“¾æ¥æŠ„åœ¨ä¸‹é¢</p><span id="more"></span><p><a href="http://blog.csdn.net/huangyuan_xuan/article/details/52549416">ä½¿ç”¨openfireæ­å»ºIMèŠå¤©ç³»ç»Ÿ(ä¸€)</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/52549416">http://blog.csdn.net/huangyuan_xuan/article/details/52549416</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/52193006">æµ…è°ˆä½¿ç”¨å•å…ƒç´ çš„æšä¸¾ç±»å‹å®ç°å•ä¾‹æ¨¡å¼</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/52193006">http://blog.csdn.net/huangyuan_xuan/article/details/52193006</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/51935666">åˆæ­¥ç¼–å†™IDEA\AndroidStudioç¿»è¯‘æ’ä»¶</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/51935666">http://blog.csdn.net/huangyuan_xuan/article/details/51935666</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/50881452">å¤šçº¿ç¨‹ çš„ç†è§£ï¼ˆä¸€ï¼‰</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/50881452">http://blog.csdn.net/huangyuan_xuan/article/details/50881452</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/50570461">è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/50570461">http://blog.csdn.net/huangyuan_xuan/article/details/50570461</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/50569443">è™šæ‹Ÿæœºå­—èŠ‚ç æ‰§è¡Œå¼•æ“</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/50569443">http://blog.csdn.net/huangyuan_xuan/article/details/50569443</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/50550725">è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/50550725">http://blog.csdn.net/huangyuan_xuan/article/details/50550725</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/50513881">åƒåœ¾æ”¶é›†å™¨ä¸å†…å­˜åˆ†é…ç­–ç•¥</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/50513881">http://blog.csdn.net/huangyuan_xuan/article/details/50513881</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/50513861">JDKçš„ä¸€äº›å‘½ä»¤è¡Œå·¥å…·</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/50513861">http://blog.csdn.net/huangyuan_xuan/article/details/50513861</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/50155345">MongoDBåŸºç¡€</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/50155345">http://blog.csdn.net/huangyuan_xuan/article/details/50155345</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/49859151">tomcatå›¾å½¢åŒ–ç•Œé¢ç®¡ç†åŠæ•°æ®æºé…ç½®</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/49859151">http://blog.csdn.net/huangyuan_xuan/article/details/49859151</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/49362701">android å››å¤§å›¾ç‰‡ç¼“å­˜åŸç†ã€ç‰¹æ€§å¯¹æ¯”</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/49362701">http://blog.csdn.net/huangyuan_xuan/article/details/49362701</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/49356523">githubåˆ†æ”¯ç®¡ç†</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/49356523">http://blog.csdn.net/huangyuan_xuan/article/details/49356523</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/49356505">github è¿œç¨‹ä»“åº“</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/49356505">http://blog.csdn.net/huangyuan_xuan/article/details/49356505</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/49336403">githubå»ºç«‹æœ¬åœ°ä¸è¿œç¨‹ä»“åº“çš„è¿æ¥</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/49336403">http://blog.csdn.net/huangyuan_xuan/article/details/49336403</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/49162309">Git æœ¬åœ°ç‰ˆæœ¬æ§åˆ¶</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/49162309">http://blog.csdn.net/huangyuan_xuan/article/details/49162309</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/49125597">å®‰è£…github</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/49125597">http://blog.csdn.net/huangyuan_xuan/article/details/49125597</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/48915299">ubuntu 14.04 apt-get install ä¸èƒ½è‡ªåŠ¨è¡¥å…¨è§£å†³åŠæ³•</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/48915299">http://blog.csdn.net/huangyuan_xuan/article/details/48915299</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/48116365">Stringçš„ä¸€ç‚¹å°ä¸œè¥¿</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/48116365">http://blog.csdn.net/huangyuan_xuan/article/details/48116365</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/46632395">wireshark error: There are no interfaces on which a capture can be done.</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/46632395">http://blog.csdn.net/huangyuan_xuan/article/details/46632395</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/46564319">windowsä¸‹ä½¿ç”¨cmdï¼ˆå‘½ä»¤è¡Œï¼‰å‘é€é‚®ä»¶</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/46564319">http://blog.csdn.net/huangyuan_xuan/article/details/46564319</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/45936413">Notepad++ æ­å»ºjavaç¼–è¯‘ç¯å¢ƒ</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/45936413">http://blog.csdn.net/huangyuan_xuan/article/details/45936413</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/44537233">JVMè™šæ‹Ÿæœº</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/44537233">http://blog.csdn.net/huangyuan_xuan/article/details/44537233</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/43817631">servletå‘æµè§ˆå™¨è¾“å‡ºéªŒè¯ç å›¾ç‰‡</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/43817631">http://blog.csdn.net/huangyuan_xuan/article/details/43817631</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/43759585">ubuntu14.04å¼€çƒ­ç‚¹å…±äº«ç½‘ç»œ</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/43759585">http://blog.csdn.net/huangyuan_xuan/article/details/43759585</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/43739353">UNIX&#x2F;linuxçš„findå‘½ä»¤ç»†èŠ‚</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/43739353">http://blog.csdn.net/huangyuan_xuan/article/details/43739353</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/43490373">ç¼–å†™shellæ—¶ï¼Œæç¤ºletï¼šnot found</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/43490373">http://blog.csdn.net/huangyuan_xuan/article/details/43490373</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/42804537">cmdå‘½ä»¤å¤§å…¨</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/42804537">http://blog.csdn.net/huangyuan_xuan/article/details/42804537</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/41647447">åä¸º ap acè®¾å¤‡é…ç½®å‘½ä»¤</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/41647447">http://blog.csdn.net/huangyuan_xuan/article/details/41647447</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/41085629">æ›´æ”¹SQLserverçš„ç™»å½•æ–¹å¼</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/41085629">http://blog.csdn.net/huangyuan_xuan/article/details/41085629</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40949147">æ±‡ç¼–FLAGå¯„å­˜å™¨ç®€ä»‹</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40949147">http://blog.csdn.net/huangyuan_xuan/article/details/40949147</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40949119">æ±‡ç¼–æŒ‡ä»¤â€”â€”è½¬ç§»æŒ‡ä»¤</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40949119">http://blog.csdn.net/huangyuan_xuan/article/details/40949119</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40949109">æ±‡ç¼–æŒ‡ä»¤</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40949109">http://blog.csdn.net/huangyuan_xuan/article/details/40949109</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40949087">æ±‡ç¼–å¯»å€æ–¹å¼</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40949087">http://blog.csdn.net/huangyuan_xuan/article/details/40949087</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40949075">ä¸€æ®µæ±‡ç¼–å°ç¨‹åºåŠè¯´æ˜â€”â€”å°†æ•°æ®ï¼Œä»£ç ï¼Œæ ˆæ”¾å…¥ä¸åŒçš„æ®µ</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40949075">http://blog.csdn.net/huangyuan_xuan/article/details/40949075</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40949069">ä¸€æ®µç®€å•æ±‡ç¼–è¯­è¨€ç¨‹åºåŠè¯´æ˜</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40949069">http://blog.csdn.net/huangyuan_xuan/article/details/40949069</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40949063">8086å¯„å­˜å™¨</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40949063">http://blog.csdn.net/huangyuan_xuan/article/details/40949063</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40857207">oracleåˆ›å»ºå®ä¾‹åŒ–æ•°æ®åº“æˆ–è€…è¿æ¥åˆ«çš„è¿œç¨‹ä¸»æœºæ•°æ®åº“æç¤ºâ€œæ— ç›‘å¬ç¨‹åºâ€çš„è§£å†³åŠæ³•</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40857207">http://blog.csdn.net/huangyuan_xuan/article/details/40857207</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40821859">å®‰è£…tomcatæç¤ºFaild to install Tomcat7 service è§£å†³åŠæ³•</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40821859">http://blog.csdn.net/huangyuan_xuan/article/details/40821859</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40821521">mysqläº‹ç‰©å¤„ç†å’Œç®¡ç†é…ç½®</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40821521">http://blog.csdn.net/huangyuan_xuan/article/details/40821521</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40783341">mysql è¿æ¥æŸ¥è¯¢</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40783341">http://blog.csdn.net/huangyuan_xuan/article/details/40783341</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40783331">MySQLå¸¸ç”¨å‘½ä»¤</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40783331">http://blog.csdn.net/huangyuan_xuan/article/details/40783331</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40783317">ubuntuä¸‹MySQLé”®å€¼ä¸æ”¯æŒä¸­æ–‡è§£å†³åŠæ³•</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/40783317">http://blog.csdn.net/huangyuan_xuan/article/details/40783317</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/39992799">Myeclipseæ–°å»ºwebserviceå®¢æˆ·ç«¯</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/39992799">http://blog.csdn.net/huangyuan_xuan/article/details/39992799</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/39992723">MyEclipsæ–°å»ºwebservice</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/39992723">http://blog.csdn.net/huangyuan_xuan/article/details/39992723</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/39896009">intellij IDEAæ›´æ¢ä¸»é¢˜ä¸ºDarculaåä¸­æ–‡é¡¹ç›®åç§°å˜å£ï¼ˆæ–¹æ¡†ï¼‰çš„è§£å†³åŠæ³•</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/39896009">http://blog.csdn.net/huangyuan_xuan/article/details/39896009</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/39723251">javaæ¨¡æ‹Ÿç™»å½•æ ¡å†…æˆç»©æŸ¥è¯¢ç½‘ç«™ï¼Œå°†è·å¾—çš„HTMLä»£ç ç”¨jsoupè§£æ</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/39723251">http://blog.csdn.net/huangyuan_xuan/article/details/39723251</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/39119797">Ubuntu14.04 LTSæ›´æ–°æº</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/39119797">http://blog.csdn.net/huangyuan_xuan/article/details/39119797</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/39118723">ubuntu14.04å¼€æœºè‡ªåŠ¨æŒ‚è½½windowsç£ç›˜çš„é…ç½®æ–¹æ³•</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/39118723">http://blog.csdn.net/huangyuan_xuan/article/details/39118723</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/39081435">javaå®ç°MD5å’Œsha1åŠ å¯†</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/39081435">http://blog.csdn.net/huangyuan_xuan/article/details/39081435</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/38427607">22 PPPåè®®</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/38427607">http://blog.csdn.net/huangyuan_xuan/article/details/38427607</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/38427547">21 ä¸²è¡Œæ¥å£å°è£…</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/38427547">http://blog.csdn.net/huangyuan_xuan/article/details/38427547</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/38427527">20 internet connection</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/38427527">http://blog.csdn.net/huangyuan_xuan/article/details/38427527</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/38423675">19 å¹¿åŸŸç½‘ WAN</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/38423675">http://blog.csdn.net/huangyuan_xuan/article/details/38423675</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/38405103">javaçš„JDKçš„å®‰è£…é…ç½®å›¾æ–‡è¯¦è§£</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/38405103">http://blog.csdn.net/huangyuan_xuan/article/details/38405103</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/38387045">18 ACLè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆaccess control listï¼‰</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/38387045">http://blog.csdn.net/huangyuan_xuan/article/details/38387045</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/38342675">17 NATè½¬æ¢</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/38342675">http://blog.csdn.net/huangyuan_xuan/article/details/38342675</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/38278825">16 DHCP</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/38278825">http://blog.csdn.net/huangyuan_xuan/article/details/38278825</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/37957229">Javaå¸¸è§é”™è¯¯åˆ—è¡¨</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/37957229">http://blog.csdn.net/huangyuan_xuan/article/details/37957229</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/37937957">LXLE Linuxå–ä»£Windows XPçš„11ä¸ªå¤§æ‹›</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/37937957">http://blog.csdn.net/huangyuan_xuan/article/details/37937957</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/37738127">jQueryè¯­æ³•ç®€ä»‹</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/37738127">http://blog.csdn.net/huangyuan_xuan/article/details/37738127</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/37728211">cookieç®€ä»‹</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/37728211">http://blog.csdn.net/huangyuan_xuan/article/details/37728211</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/37699891">DOM ç®€ä»‹</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/37699891">http://blog.csdn.net/huangyuan_xuan/article/details/37699891</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/28880287">vim å‘½ä»¤</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/28880287">http://blog.csdn.net/huangyuan_xuan/article/details/28880287</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/28276437">æˆ‘ä»¬å¤§ç¥éƒ½è¿™æ ·â€”â€”æé—®çš„æ™ºæ…§</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/28276437">http://blog.csdn.net/huangyuan_xuan/article/details/28276437</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/27972015">åˆå­¦Cè¯­è¨€çš„äººçœ‹ä¸æ‡‚çš„å…³æœºä»£ç </a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/27972015">http://blog.csdn.net/huangyuan_xuan/article/details/27972015</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/27792089">ubuntuè¿æ¥è·¯ç”±å™¨æ— çº¿ç½‘ç»œï¼Œå´ä¸èƒ½ä¸Šç½‘</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/27792089">http://blog.csdn.net/huangyuan_xuan/article/details/27792089</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26969041">sublime-text2çš„ä¸­è‹±æ–‡å¯¹ç…§è¡¨ï¼ˆé™„å¸¦ä¸ªäººçš„é…ç½®ä¹ æƒ¯ï¼‰</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26969041">http://blog.csdn.net/huangyuan_xuan/article/details/26969041</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26246709">ç”µè„‘è“å±ä»£ç å¤§å…¨</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26246709">http://blog.csdn.net/huangyuan_xuan/article/details/26246709</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26245513">VC6.0 å¿«æ·é”®æ•´ç†</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26245513">http://blog.csdn.net/huangyuan_xuan/article/details/26245513</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26245135">ç©æ¸¸æˆæ— æ³•å…¨å±</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26245135">http://blog.csdn.net/huangyuan_xuan/article/details/26245135</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26244991">15 Ospf</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26244991">http://blog.csdn.net/huangyuan_xuan/article/details/26244991</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26244541">14 EIGRP é…ç½®</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26244541">http://blog.csdn.net/huangyuan_xuan/article/details/26244541</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26244439">13 ERGIP</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26244439">http://blog.csdn.net/huangyuan_xuan/article/details/26244439</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26244201">12    rip-2  é…ç½®å‘½ä»¤</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26244201">http://blog.csdn.net/huangyuan_xuan/article/details/26244201</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26244031">11    rip -1</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26244031">http://blog.csdn.net/huangyuan_xuan/article/details/26244031</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26243735">10åŠ¨æ€è·¯ç”±</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26243735">http://blog.csdn.net/huangyuan_xuan/article/details/26243735</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26243487">9é™æ€è·¯ç”±</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26243487">http://blog.csdn.net/huangyuan_xuan/article/details/26243487</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26243293">8ç½‘ç»œæ‹“æ‰‘ç»“æ„</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26243293">http://blog.csdn.net/huangyuan_xuan/article/details/26243293</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26243041">7VLSMå­ç½‘åˆ’åˆ†</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26243041">http://blog.csdn.net/huangyuan_xuan/article/details/26243041</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26242799">6å¸¸ç”¨ç½‘ç»œç›¸å…³å‘½ä»¤</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26242799">http://blog.csdn.net/huangyuan_xuan/article/details/26242799</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26242589">5æ•°æ®åŒ…å‘é€æµç¨‹</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26242589">http://blog.csdn.net/huangyuan_xuan/article/details/26242589</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26242183">ç½‘çº¿</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26242183">http://blog.csdn.net/huangyuan_xuan/article/details/26242183</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26242101">osiä¸ƒå±‚ç½‘ç»œæ¨¡å‹4</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26242101">http://blog.csdn.net/huangyuan_xuan/article/details/26242101</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26242015">osiä¸ƒå±‚ç½‘ç»œæ¨¡å‹3</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26242015">http://blog.csdn.net/huangyuan_xuan/article/details/26242015</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26241831">osiä¸ƒå±‚ç½‘ç»œæ¨¡å‹2</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26241831">http://blog.csdn.net/huangyuan_xuan/article/details/26241831</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26241631">OSIä¸ƒå±‚ç½‘ç»œæ¨¡å‹1</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26241631">http://blog.csdn.net/huangyuan_xuan/article/details/26241631</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26164349">sublime-text2 ç¼–è¯‘javaå‡ºé”™ Decode error - output not utf-8çš„è§£å†³åŠæ³•</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26164349">http://blog.csdn.net/huangyuan_xuan/article/details/26164349</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26162201">å®‰è£…è™šæ‹ŸæœºæŠ¥é”™è§£å†³åŠæ³• TheVMware Authorization Service is not running</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26162201">http://blog.csdn.net/huangyuan_xuan/article/details/26162201</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26162083">æˆ‘çš„vimé…ç½®</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26162083">http://blog.csdn.net/huangyuan_xuan/article/details/26162083</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26161983">sublime text 2 æ­å»ºjavaè¿è¡Œç¯å¢ƒ</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26161983">http://blog.csdn.net/huangyuan_xuan/article/details/26161983</a><br><br> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26160973">ubuntuçš„ä¸€ç‚¹å‘½ä»¤</a> <a href="http://blog.csdn.net/huangyuan_xuan/article/details/26160973">http://blog.csdn.net/huangyuan_xuan/article/details/26160973</a><br><br> ä»¥åä¸»è¦å°±åœ¨gitpageä¸Šå†™åšå®¢äº†.<br> ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>csdn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2016å¹´å›½åº†-åœ¨æ·±åœ³</title>
    <link href="/2016/10/08/2016%E5%9B%BD%E5%BA%86/"/>
    <url>/2016/10/08/2016%E5%9B%BD%E5%BA%86/</url>
    
    <content type="html"><![CDATA[<p>å›½åº†ä¹‹å‰,è¾äº†å·¥ä½œ,è·‘åˆ°æ·±åœ³æ‰¾å¦¹å­ç©äº†å‡ å¤©.å¦¹å­åœ¨å“ˆå·¥å¤§æ·±åœ³æ ¡åŒºè¯»ç ”ç©¶ç”Ÿ,å»äº†ä¹‹åä¹Ÿæ²¡æœ‰å‡ºå»é€›,åƒé¥­,å›¾ä¹¦é¦†,å†™ä½œä¸š,æŠ˜è…¾hexoå†™åšå®¢.<br>ä¹Ÿå°±åœ¨æ ¡å›­é‡Œé€›äº†ä¸€ä¸‹,æ‹äº†å‡ å¼ ç…§ç‰‡.<br>åœ¨æ·±åœ³å¸‚å—å±±åŒºçš„å¤§å­¦åŸé‡Œé¢,å¥½åƒæ˜¯æœ‰æ¸…ååŒ—å¤§å“ˆå·¥å¤§ä¸‰æ‰€ç ”ç©¶ç”Ÿé™¢æ ¡ç»„æˆçš„,æ®è¯´å“ˆå·¥å¤§æ·±ç ”é™¢å¼€å§‹æ‹›æœ¬ç§‘ç”Ÿäº†.<br><br/></p><span id="more"></span><p><strong>å—é—¨</strong> ,æ²¡å»å…¶ä»–çš„é—¨,å°±ä»è¿™è¾¹è¿›å»çš„,åˆ«é—®ä¸ºå•¥,è¿‘.<br> <img src="/image/South_Gate.jpg" alt="å—é—¨"><br><br/><br> **å“ˆå·¥å¤§æ·±ç ”é™¢çš„æ ‡å¿—?**ä¸çŸ¥é“æ˜¯ä¸æ˜¯æ ‡å¿—æ€§å»ºç­‘<br> <img src="/image/main_building.jpg" alt="æ ‡å¿—"><br> <img src="/image/sign.jpg" alt="æ ‡å¿—"><br><br/><br> <strong>å›¾ä¹¦é¦†</strong>,åæ§½ä¸€ä¸‹,å›¾ä¹¦é¦†çš„ä¹¦å¥½å°‘.ç”µæ¢¯çš„æµ·æŠ¥ä¸Šé¢è¯´æ˜¯æœ‰ç”µå½±æ”¾æ˜ ,ä½†æ˜¯æˆ‘ä»¬æ²‰è¿·äºå­¦ä¹ æ— æ³•è‡ªæ‹”,ç†æ‰€å½“ç„¶çš„é”™è¿‡äº†.<br> <img src="/image/Library.jpg" alt="å›¾ä¹¦é¦†"><br><br/><br> <strong>å›¾ä¹¦é¦†é—¨å£çš„æ¤ç‰©æ ‡æœ¬</strong>,æˆ‘ä¹Ÿä¸çŸ¥é“æ˜¯å•¥,è£…ä½œçœ‹æ‡‚çš„æ ·å­<br> <img src="/image/Library_Plant_specimen1.jpg" alt="æ¤ç‰©æ ‡æœ¬"><br> <img src="/image/Library_Plant_specimen2.jpg" alt="æ¤ç‰©æ ‡æœ¬"><br> <img src="/image/Library_Plant_specimen3.jpg" alt="æ¤ç‰©æ ‡æœ¬"><br> <img src="/image/Library_Plant_specimen4.jpg" alt="æ¤ç‰©æ ‡æœ¬"><br><br/><br> <strong>é£Ÿå ‚</strong>,é£Ÿå ‚çš„é¥­èœè¿˜æ˜¯ä¸é”™çš„,å¬è¯´éå­¦æ ¡äººå‘˜ä¹Ÿèƒ½åœ¨é‡Œé¢åŠå¡,åªæ˜¯æ¯”å­¦ç”Ÿä¹°é¥­è¦è´µ40%.è¡¨ç¤ºç†è§£.<br><img src="/image/Restaurant.jpg" alt="è”å›­é¤å…"><br><img src="/image/Meal1.jpg" alt="é£Ÿå ‚é¥­"><br><img src="/image/Meal2.jpg" alt="é£Ÿå ‚é¥­"><br><img src="/image/Meal3.jpg" alt="é£Ÿå ‚é¥­"><br><br/><br>  <strong>åŒ—å¤§æ±‡ä¸°å•†å­¦é™¢</strong>,å°±åœ¨å›¾ä¹¦é¦†æ—è¾¹<br><img src="/image/PHBS.jpg" alt="åŒ—å¤§æ±‡ä¸°å•†å­¦é™¢"><br><img src="/image/PHBS1.jpg" alt="åŒ—å¤§æ±‡ä¸°å•†å­¦é™¢"><br><br/><br><strong>å°æ ‘æ—é‡Œé¢æœ‰è›‡</strong>,æ™šä¸Šå»åƒé¥­çš„æ—¶å€™è·¯è¿‡çš„å°æ ‘æ—,é‡Œé¢çœŸçš„æœ‰è›‡,äº²çœ¼æ‰€è§,å¤§æ¦‚æœ‰é£ŸæŒ‡ç²—ç»†,ä¸€å°ºæ¥é•¿,é»‘ç°è‰².å¯æƒœæ²¡æ‹åˆ°.<br>![å°å¿ƒæœ‰è›‡](&#x2F;image&#x2F;Beware_of_ snakes.jpg)<br><br/><br><strong>æ¸…åå¤§å­¦æ·±ç ”é™¢</strong>,ä¸çŸ¥é“æ˜¯ä¸æ˜¯è¿™ä¹ˆå«çš„,åƒå®Œæ™šé¥­å»ç»ä»°äº†ä¸€ä¸‹<br><img src="/image/Tsinghua.jpg" alt="æ¸…åå¤§å­¦æ·±ç ”é™¢"><br><br/><br> æœ¬æ‰“ç®—å»è¹­è¯¾æ¥ç€,ä½†æ˜¯çœ‹ç€å¦¹å­çš„ä½œä¸šå°±ä¸æƒ³å»äº†,æˆ‘è§‰å¾—æˆ‘åº”è¯¥å¬ä¸å¤§æ‡‚.</p><hr/> å°±è¿™äº›,å¾…äº†è²Œä¼¼æœ‰å››äº”å¤©çš„æ ·å­,ç„¶åå°±æ»šå›åŒ—äº¬æ‰¾å·¥ä½œäº†. ä»¥ä¸Š. ]]></content>
    
    
    
    <tags>
      
      <tag>ä¹±ä¸ƒå…«ç³Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>UNIX/linuxçš„findå‘½ä»¤ç»†èŠ‚</title>
    <link href="/2015/02/11/UNIX-linux%E7%9A%84find%E5%91%BD%E4%BB%A4%E7%BB%86%E8%8A%82/"/>
    <url>/2015/02/11/UNIX-linux%E7%9A%84find%E5%91%BD%E4%BB%A4%E7%BB%86%E8%8A%82/</url>
    
    <content type="html"><![CDATA[<p>find å‘½ä»¤çš„å·¥ä½œæ–¹å¼å¦‚ä¸‹:</p><p>æ²¿ç€æ–‡ä»¶å±‚æ¬¡ç»“æ„å‘ä¸‹éå†,åŒ¹é…ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶,å¹¶æ‰§è¡Œç›¸åº”çš„æ“ä½œ.</p><span id="more"></span><h4 id="æ ¹æ®æ–‡ä»¶åæˆ–è€…æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æœç´¢"><a href="#æ ¹æ®æ–‡ä»¶åæˆ–è€…æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æœç´¢" class="headerlink" title="æ ¹æ®æ–‡ä»¶åæˆ–è€…æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æœç´¢"></a>æ ¹æ®æ–‡ä»¶åæˆ–è€…æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æœç´¢</h4><p>é€‰é¡¹-nameçš„å‚æ•°æŒ‡å®šäº†æ–‡ä»¶åæ‰€å¿…é¡»åŒ¹é…çš„å­—ç¬¦ä¸²,æˆ‘ä»¬å¯ä»¥å°†é€šé…ç¬¦ä½œä¸ºå‚æ•°ä½¿ç”¨.â€*.txtâ€ å¯ä»¥åŒ¹é…æ‰€æœ‰çš„ä»¥â€.txtâ€ç»“å°¾çš„æ–‡ä»¶.é€‰é¡¹-print åœ¨ç»ˆç«¯ä¸­æ‰“å°å‡ºç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶åæˆ–è€…æ–‡ä»¶è·¯å¾„,è¿™äº›åŒ¹é…æ¡ä»¶ä½œä¸ºfind çš„å‚æ•°ç»™å‡º</p><p>find &#x2F;home&#x2F;huangyuan -name â€œ*.txtâ€ -print</p><p>find æœ‰ä¸€ä¸ªé€‰é¡¹-iname å¯ä»¥å¿½ç•¥æ–‡ä»¶åçš„å¤§å°å†™</p><p>å¦‚æœæƒ³åŒ¹é…å¤šä¸ªæ¡ä»¶ä¸­çš„ä¸€ä¸ª,å¯ä»¥ä½¿ç”¨ OR æ¡ä»¶æ“ä½œ</p><p>find . (-name â€œ<em>.txtâ€ -o -name â€œ</em>.pdfâ€) -print</p><p>ä¸Šé¢çš„ä»£ç ä¼šæ‰“å°å‡ºæ‰€æœ‰çš„ â€œ.txtâ€ å’Œ â€œ.pdfâ€ æ–‡ä»¶,æ˜¯å› ä¸ºè¿™ä¸ªfind å‘½ä»¤å¯ä»¥åŒ¹é…æ‰€æœ‰çš„è¿™ä¸¤ç±»æ–‡ä»¶</p><p>å…¶ä¸­, â€œ(â€œ å’Œ â€œ)â€œ ç”¨äºå°† -name â€œ<em>.txtâ€ -o -name â€œ</em>.pdfâ€ è§†ä¸ºä¸€ä¸ªæ•´ä½“</p><p>é€‰é¡¹ -path å¯ä»¥ä½¿ç”¨é€šé…ç¬¦æ¥åŒ¹é…æ–‡ä»¶è·¯å¾„æˆ–è€…æ–‡ä»¶å</p><p>é€‰é¡¹ -regex æ˜¯åŸºäºæ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…æ–‡ä»¶è·¯å¾„è´§æ–‡ä»¶.æ­£åˆ™è¡¨è¾¾å¼æ˜¯é€šé…ç¬¦çš„é«˜çº§å½¢å¼,ä¾‹å¦‚,å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…Email ,ä¸€ä¸ª Email çš„å½¢å¼é€šå¸¸æ˜¯ <a href="mailto:&#110;&#x61;&#x6d;&#101;&#x40;&#104;&#x6f;&#x73;&#x74;&#x2e;&#x72;&#x6f;&#111;&#116;">&#110;&#x61;&#x6d;&#101;&#x40;&#104;&#x6f;&#x73;&#x74;&#x2e;&#x72;&#x6f;&#111;&#116;</a></p><p>æ‰€ä»¥å¯ä»¥å°†å…¶ä¸€èˆ¬åŒ–ä¸º [0-9a-zA-A]+@[0-9a-zA-A]+.[0-9a-zA-A] +</p><p> â€œ+â€ æŒ‡æ˜åœ¨å®ƒä¹‹å‰çš„å­—ç¬¦ç±»ä¸­å­—ç¬¦å¯ä»¥å‡ºç°ä¸€æ¬¡æˆ–è€…å¤šæ¬¡</p><h4 id="å¦å®šå‚æ•°"><a href="#å¦å®šå‚æ•°" class="headerlink" title="å¦å®šå‚æ•° !"></a>å¦å®šå‚æ•° !</h4><p>find ä¹Ÿå¯ä»¥ç”¨ â€œ!â€ æ¥å¦å®šå‚æ•°çš„å«ä¹‰</p><p>find . ! -name â€œ*.txtâ€ -print</p><p>ä¸Šé¢çš„å‘½ä»¤å¯ä»¥ç”¨æ¥ åŒ¹é…æ‰€æœ‰ä¸ä»¥ â€œ.txtâ€ ç»“å°¾çš„æ–‡ä»¶</p><h4 id="åŸºäºç›®å½•æ·±åº¦çš„æœç´¢"><a href="#åŸºäºç›®å½•æ·±åº¦çš„æœç´¢" class="headerlink" title="åŸºäºç›®å½•æ·±åº¦çš„æœç´¢"></a>åŸºäºç›®å½•æ·±åº¦çš„æœç´¢</h4><p>find å‘½ä»¤åœ¨ä½¿ç”¨æ—¶ä¼šéå†æ‰€æœ‰çš„å­ç›®å½•,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ -mindepth å’Œ -maxdepth æ¥é™åˆ¶æœç´¢å­ç›®å½•çš„æ·±åº¦</p><p>find . -maxdeoth 1 -print </p><p>è¿™æ¡ç›®å½•åªä¼šæ‰“å°å½“å‰ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶,è€Œä¸ä¼šæ‰“å°å­ç›®å½•ä¸­çš„æ–‡ä»¶</p><p>find . -mindepth 2 -print</p><p>è¿™æ¡ç›®å½•æ‰“å°ç›®å½•æ·±åº¦è‡³å°‘ä¸º2 çš„æ–‡ä»¶</p><h4 id="æ ¹æ®æ–‡ä»¶ç±»å‹æœç´¢"><a href="#æ ¹æ®æ–‡ä»¶ç±»å‹æœç´¢" class="headerlink" title="æ ¹æ®æ–‡ä»¶ç±»å‹æœç´¢"></a>æ ¹æ®æ–‡ä»¶ç±»å‹æœç´¢</h4><p>find . -type d -print</p><p>ä¸Šé¢çš„å‘½ä»¤åªä¼šæ‰“å°å‡ºç›®å½•</p><p>æ–‡ä»¶ç±»å‹                ç±»å‹å‚æ•°</p><p>æ™®é€šæ–‡ä»¶                f</p><p>ç¬¦å·è¿æ¥                l</p><p>ç›®å½•                       d</p><p>å­—ç¬¦è®¾å¤‡                c</p><p>å—è®¾å¤‡                    b</p><p>å¥—æ¥å­—                    s</p><p>Fifo                        p</p><h4 id="æ ¹æ®æ–‡ä»¶æ—¶é—´è¿›è¡Œæœç´¢"><a href="#æ ¹æ®æ–‡ä»¶æ—¶é—´è¿›è¡Œæœç´¢" class="headerlink" title="æ ¹æ®æ–‡ä»¶æ—¶é—´è¿›è¡Œæœç´¢"></a>æ ¹æ®æ–‡ä»¶æ—¶é—´è¿›è¡Œæœç´¢</h4><p>unix&#x2F;linux æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ¯ä¸€ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸‰ç§æ—¶é—´æˆ³(timestamp) ,å¦‚ä¸‹æ‰€ç¤º</p><p>è®¿é—®æ—¶é—´ (-atime) : ç”¨æˆ·æœ€è¿‘ä¸€æ¬¡è®¿é—®æ–‡ä»¶çš„æ—¶é—´</p><p>ä¿®æ”¹æ—¶é—´ (-mtime): æ–‡ä»¶å†…åŒæœ€åä¸€æ¬¡è¢«ä¿®æ”¹çš„æ—¶é—´</p><p>å˜åŒ–æ—¶é—´ (-ctime) : æ–‡ä»¶å…ƒæ•°æ®(metadata,ä¾‹å¦‚æƒé™æˆ–è€…æ‰€æœ‰æƒ)æœ€åä¸€æ¬¡è¢«ä¿®æ”¹çš„æ—¶é—´</p><p>åœ¨unux&#x2F;linuxä¸­æ²¡æœ‰åˆ›å»ºæ—¶é—´è¿™ä¸ªæ¦‚å¿µ</p><p>-atime,-mtime,-ctime å¯ä»¥ä½œä¸º find çš„æ—¶é—´å‚æ•°,ä¾‹å¦‚</p><p>æ‰“å°å‡º æœ€è¿‘ä¸ƒå¤©å†…è¢«è®¿é—®è¿‡çš„æ–‡ä»¶</p><p>find . -atime -7 -print</p><p>æ‰“å°å‡º åˆšå¥½ä¸ƒå¤©å‰è®¿é—®è¿‡çš„æ–‡ä»¶</p><p>find . -atime 7 -print</p><p>æ‰“å°å‡º è®¿é—®æ—¶é—´è¶…è¿‡7å¤©çš„æ–‡ä»¶</p><p>find . -atime +7 -print</p><p>è¿˜æœ‰å…¶ä»–ä¸€äº›åŸºäºæ—¶é—´çš„å‚æ•° (ä»¥åˆ†é’Ÿä¸ºå•ä½)</p><p>-amin</p><p>-mmin</p><p>-cmin</p><h4 id="åŸºäºæ–‡ä»¶å¤§å°æœç´¢"><a href="#åŸºäºæ–‡ä»¶å¤§å°æœç´¢" class="headerlink" title="åŸºäºæ–‡ä»¶å¤§å°æœç´¢"></a>åŸºäºæ–‡ä»¶å¤§å°æœç´¢</h4><p>find . -size +2k</p><p>å¤§äº2kçš„æ–‡ä»¶</p><p>find . -size -2k</p><p>å°äº2kçš„æ–‡ä»¶</p><p>find .-size 2k</p><p>ç­‰äº2kçš„æ–‡ä»¶</p><p>é™¤äº†Kä¹‹å¤–,è¿˜æœ‰å…¶ä»–å•å…ƒ</p><p>bâ€”â€”å—  512å­—èŠ‚</p><p>câ€”â€”å­—èŠ‚</p><p>wâ€”â€“å­—  2å­—èŠ‚</p><p>kâ€”â€“åƒå­—èŠ‚</p><p>mâ€”-å…†å­—èŠ‚</p><p>Gâ€”-å‰å­—èŠ‚</p><h4 id="åˆ é™¤åŒ¹é…æ–‡ä»¶"><a href="#åˆ é™¤åŒ¹é…æ–‡ä»¶" class="headerlink" title="åˆ é™¤åŒ¹é…æ–‡ä»¶"></a>åˆ é™¤åŒ¹é…æ–‡ä»¶</h4><p>-delete å¯ä»¥åˆ é™¤ find æŸ¥æ‰¾åˆ°çš„åŒ¹é…æ–‡ä»¶</p><p>find . -name â€œ*.flvâ€ -delete ##(åˆ é™¤æ‰€æœ‰flvæ–‡ä»¶)</p><p>åŸºäºæ–‡ä»¶æƒé™å’Œæ‰€æœ‰æƒçš„åŒ¹é…</p><p>find . -perm 644 -print</p><p>find . -user huangyuan -print</p><h4 id="ç»“åˆ-find-æ‰§è¡Œå‘½ä»¤æˆ–åŠ¨ä½œ"><a href="#ç»“åˆ-find-æ‰§è¡Œå‘½ä»¤æˆ–åŠ¨ä½œ" class="headerlink" title="ç»“åˆ find æ‰§è¡Œå‘½ä»¤æˆ–åŠ¨ä½œ"></a>ç»“åˆ find æ‰§è¡Œå‘½ä»¤æˆ–åŠ¨ä½œ</h4><p>find å‘½ä»¤å¯ä»¥å€ŸåŠ©é€‰é¡¹ -exec ä¸å…¶ä»–å‘½ä»¤ç»“åˆ</p><p>ä¾‹å¦‚  å°†åˆ¶å®šç›®å½•ä¸­çš„æ‰€æœ‰Cç¨‹åºæ–‡ä»¶æ‹¼æ¥èµ·æ¥å†™å…¥å•ä¸ªæ–‡ä»¶ all_C_file.txt </p><p>find . -name â€œ*.câ€ -exec cat {} ;&gt; all_C_file.txt</p><p>-exec åé¢å¯ä»¥æ¥ä»»ä½•å‘½ä»¤.{}è¡¨ç¤ºä¸€ä¸ªåŒ¹é….ä½¿ç”¨ &gt; è€Œä¸ä½¿ç”¨ &gt;&gt;ã€€çš„åŸå› æ˜¯ find å‘½ä»¤çš„è¾“å‡ºåªæ˜¯ä¸€ä¸ªå•æ•°æ®æµ,è€Œåªæœ‰å½“å¤šä¸ªæ•°æ®æµè¢«è¿½åŠ åˆ°å•ä¸ªæ–‡ä»¶ä¸­çš„æ—¶å€™æ‰æœ‰å¿…è¦ç”¨ &gt;&gt; </p><h4 id="è·³è¿‡æŒ‡å®šç›®å½•"><a href="#è·³è¿‡æŒ‡å®šç›®å½•" class="headerlink" title="è·³è¿‡æŒ‡å®šç›®å½•"></a>è·³è¿‡æŒ‡å®šç›®å½•</h4><p>find .  ( -name â€œ.getâ€ -prune  ) -o  ( -print )</p><p>è¿™æ¡å‘½ä»¤ä¸­  (-name â€œ.gitâ€ -prune ) æŒ‡æ˜ .git ç›®å½•åº”è¯¥æ’é™¤æ‰, è€Œ ( -print ) æŒ‡æ˜äº†æ‰§è¡Œçš„åŠ¨ä½œ.è¿™äº›åŠ¨ä½œéœ€è¦æ”¾åœ¨ç¬¬äºŒä¸ªè¯­å¥å—ä¸­.</p>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CCNA-Internet connection</title>
    <link href="/2014/05/19/CCNA-Internet-connection/"/>
    <url>/2014/05/19/CCNA-Internet-connection/</url>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç¬”è®°ï¼Œæ¯”è¾ƒé›¶æ•£</p><span id="more"></span><h4 id="ä¸»æµçš„å¹¿åŸŸç½‘è¿æ¥"><a href="#ä¸»æµçš„å¹¿åŸŸç½‘è¿æ¥" class="headerlink" title="ä¸»æµçš„å¹¿åŸŸç½‘è¿æ¥"></a>ä¸»æµçš„å¹¿åŸŸç½‘è¿æ¥</h4><p>åŒ…äº¤æ¢ï¼šè¿è¡Œå•†å¯ä»¥å°†ä¸€æ¡çº¿è·¯ç§Ÿç»™å¤šä¸ªç”¨æˆ·ï¼Œå› ä¸ºä»–ä»¬çš„ç½‘ç»œéœ€è¦é‡å°ã€‚</p><p>DSLï¼ˆæ•°å­—ç”¨æˆ·çº¿ï¼‰ï¼Œå®¶åº­ç»ˆç«¯ç”¨æˆ·å’Œä¸­å°å‹ä¼ä¸šï¼ˆADSLéå¯¹ç§°ç”¨æˆ·çº¿ï¼Œæ„æ€æ˜¯ä¸Šè¡Œæµé‡å’Œä¸‹è¡Œæµé‡ä¸ç›¸ç­‰ï¼Œä¸‹è¡Œé€Ÿç‡è¾ƒé«˜ï¼Œä¸Šè¡Œé€Ÿç‡è¾ƒä½ï¼‰ADSLæŠ€æœ¯å®é™…ä¸Šåªåº”ç”¨äºå®¶åº­ADSLçŒ«å’Œç½‘ç»œè¿è¥å•†çš„DSLAMçš„è¾¹ç•Œéƒ¨åˆ†ï¼Œè€Œè¿è¥å•†å†…éƒ¨è¿˜æ˜¯é«˜é€Ÿçš„äº¤æ¢ç½‘ç»œã€‚æ˜¯ä¸€å±‚æŠ€æœ¯ã€‚è§£å†³é•¿è·ç¦»ä¼ è¾“é—®é¢˜</p><p>å†ä¸Šå±‚æ˜¯PPPåè®®</p><p>DSLçš„ä¼˜ç‚¹ï¼š</p><p>é€Ÿåº¦è¾ƒå¿«ï¼Œå¯ä»¥è¾¾åˆ°ï¼˜ï¼­</p><p>å¯åŒæ—¶è¿›è¡Œå£°éŸ³å’Œæ•°æ®ä¼ è¾“</p><p>å¯ä»¥ï¼’ï¼”å°æ—¶åœ¨çº¿</p><p>å¯ä»¥å’Œä¼ ç»Ÿçš„æ¨¡æ‹Ÿç”µè¯çº¿è·¯å…¼å®¹</p><p>ç¼ºç‚¹ï¼š</p><p>é™åˆ¶å¤š</p><p>éœ€è¦æœ¬åœ°ç”µè¯å…¬å¸çš„æ”¯æŒ</p><p>å¼€æ”¾çš„çº¿è·¯ï¼Œå®‰å…¨æ€§è¾ƒå·®</p><h4 id="ä¸²è¡Œæ¥å£å°è£…"><a href="#ä¸²è¡Œæ¥å£å°è£…" class="headerlink" title="ä¸²è¡Œæ¥å£å°è£…"></a>ä¸²è¡Œæ¥å£å°è£…</h4><p>Circuit switching ç”µè·¯äº¤æ¢ï¼šåœ¨é€šä¿¡ä¹‹å‰ï¼Œè¦å…ˆå»ºç«‹è¿æ¥ï¼Œå»ºç«‹å¥½ä¹‹åçº¿è·¯ä¸“å±äºæŸä»¥ç”¨æˆ·ã€‚ä½†æ˜¯è¿æ¥é€Ÿç‡ä½ï¼Œé€šå¸¸æ˜¯åœ¨å¼‚æ­¥çº¿ç¼†ä¸Šè¿›è¡Œï¼Œé€šå¸¸åŸºäºPSTNï¼ˆ puclic switched telephon newworkå…¬å…±ç”µè¯äº¤æ¢ç½‘ç»œ)ï¼šç®€å•ï¼Œå¯ç”¨æ€§é«˜ï¼Œè´¹ç”¨ä½</p><p>ç§Ÿç”¨çº¿è·¯ï¼ˆleased Lineï¼‰ï¼šé€Ÿåº¦å¿«ï¼Œè´¹ç”¨é«˜ã€‚çº¿è·¯æ˜¯ä¸“é—¨ä¸ºç”¨æˆ·é¢„ç•™çš„</p><p>WAN connection bandwidthï¼šä¸²è¡Œæ¥å£è¦é…ç½®å§‹ç»ˆé¢‘ç‡ï¼Œä¸€èˆ¬æ˜¯åœ¨DCEç«¯è¿›è¡Œé…ç½®ï¼ŒDTEç«¯æ˜¯ç”¨æˆ·ç«¯ï¼ˆå®éªŒå®¤ç¯å¢ƒä¸‹ä¸¤å°è·¯ç”±å™¨ä¹‹é—´çš„çº¿ç¼†æ˜¯æ¨¡æ‹Ÿçš„å¹¿åŸŸç½‘ç½‘äº‘çš„ç¯å¢ƒã€‚ï¼‰</p><p>DTEå’ŒDCEç«¯æ˜¯çº¿ç¼†å†³å®šçš„ï¼Œçº¿ç¼†çš„DCEç«¯æ’åˆ°å“ªä¸ªç«¯å£ï¼Œå“ªè¾¹å°±æ˜¯DCEç«¯ã€‚</p><p>Pointï¼toï¼pointã€€considerations</p><p>ä¼˜ç‚¹ï¼š</p><p>ç®€å•ã€è´¨é‡é«˜ã€å¯ç”¨æ€§é«˜ï¼›</p><p>ç¼ºç‚¹ï¼š</p><p>è´¹ç”¨é«˜ã€çµæ´»æ€§å·®</p><p>æ€ç§‘çš„è®¾å¤‡å’Œåˆ«çš„è®¾å¤‡åœ¨äºŒå±‚å°è£…æ˜¯ä¸ä¸€æ ·çš„ï¼Œå‡å¦‚æ€ç§‘çš„è·¯ç”±å™¨å’Œåä¸ºçš„è·¯ç”±å™¨ï¼·ï½ï½å£ç›¸è¿ï¼Œæ˜¯è¿æ¥ä¸é€šçš„ï¼Œå› ä¸ºæ€ç§‘çš„äºŒå±‚å°è£…æ˜¯ä¿®æ”¹è¿‡çš„ã€‚</p><p>ä¿®æ”¹æ¥å£çš„å°è£…ç±»å‹å‘½ä»¤å¦‚ä¸‹ï¼š</p><p>Interfaceã€€sï¼ï¼ï¼ï¼ï¼ï¼ˆè¦ä¿®æ”¹çš„æ¥å£ï¼‰</p><p>Encapsulationã€€å°è£…ç±»å‹ï¼ˆï¼¨ï½„ï½Œï½ƒã€€PPPã€€ï¼³ï½”ï½•ï½ç­‰ï¼‰</p><p>é»˜è®¤æ˜¯hdlc</p><p>ä¸åŒå‚å•†çš„è®¾å¤‡ç›¸è¿ä¸€åŠæ—¶PPPåè®®</p><p>PPPåè®®ï¼šè®¤è¯ã€å‹ç¼©ã€å¤šé“¾è·¯ã€å›æ‹¨ï¼›</p><h4 id="Frame-relayï¼ˆå¸§ä¸­ç»§åè®®ï¼‰ï¼š"><a href="#Frame-relayï¼ˆå¸§ä¸­ç»§åè®®ï¼‰ï¼š" class="headerlink" title="Frameã€€relayï¼ˆå¸§ä¸­ç»§åè®®ï¼‰ï¼š"></a>Frameã€€relayï¼ˆå¸§ä¸­ç»§åè®®ï¼‰ï¼š</h4><p>å·¥ä½œåœ¨ç”¨æˆ·ç«¯å’Œè¿è¥å•†è¾¹ç•Œçš„åè®®</p><p>ATM å¼‚æ­¥ä¼ è¾“æ¨¡å¼ å±äºä¿¡æºäº¤æ¢   å°†æ•°æ®åˆ†ä¸º53å­—èŠ‚çš„å®šé•¿ä¿¡æºï¼›é€šå¸¸æ˜¯åœ¨ç¡¬ä»¶ä¹‹å†…å®Œæˆï¼Œé€šå¸¸è¿è¡Œäºè¿è¥å•†å†…éƒ¨é«˜é€Ÿç½‘ç»œ</p><p>ISDNã€‚ã€‚ã€‚ã€‚å¤§æ¦‚åªå‡ºç°è¿‡ä¸€å¹´çš„æ—¶é—´å·¦å³ï¼Œå°±è¿‡åº¦åˆ°adsläº†</p><p>å·¥ä½œåœ¨ç”¨æˆ·ç«¯åˆ°è¿è¥å•†çš„è¾¹ç•Œå¤„ï¼ˆç§°ä¸ºæœ€åä¸€å…¬é‡Œï¼‰</p><p>ä½¿ç”¨äº†è™šç”µè·¯çš„æ¦‚å¿µ</p><p>åœ¨ä¸€æ ¹ç”µç¼†ä¸Šé€šè¿‡å¤šè·¯å¤ç”¨æŠ€æœ¯åˆ’åˆ†å‡ºvirtual circuits ï¼ˆè™šæ‹Ÿç”µè·¯ï¼‰ç§Ÿç”¨ç»™å¤šä¸ªç”¨æˆ·ï¼Œç”¨æˆ·æ„Ÿè§‰å°±åƒç§Ÿç”¨äº†ä¸“çº¿ä¸€æ ·</p><p>è™šæ‹Ÿç”µè·¯åˆ†ä¸ºä¸´æ—¶çº¿è·¯ï¼ˆSVCï¼‰å’Œæ°¸ä¹…çº¿è·¯ï¼ˆPVCï¼‰</p><p>å¸§ä¸­ç»§é€šè¿‡DLCIå·ï¼ˆåªå…·æœ‰æœ¬åœ°æ„ä¹‰ï¼Œä¸ä¸€å®šå…¨å±€å”¯ä¸€ï¼Œé€šå¸¸æƒ…å†µä¸‹åšæˆå…¨å±€å”¯ä¸€çš„ï¼‰æ¥åˆ†è¾¨æ¯ä¸ªè™šæ‹Ÿç”µè·¯ï¼ˆäºŒå±‚ç¼–å€æŠ€æœ¯  0-1024ï¼‰</p><p>å¸§ä¸­ç»§æœ‰ä¸¤ç§å°è£…å½¢å¼ï¼šciscoï¼ˆæ€ç§‘è®¾å¤‡ç§æœ‰çš„ï¼‰å’ŒIETFå°è£…</p><p>LIMï¼šæœ¬åœ°ç®¡ç†æ¥å£ï¼Œä¸¤ä¸ªè®¾å¤‡ä¹‹é—´ä½¿ç”¨çš„ä¿¡ä»¤æ ‡å‡†ã€‚æœ‰ä¸‰ç§ç±»å‹ï¼š</p><p>Cisco  ansi  Q933a  å¯ä»¥ç†è§£ä¸ºè®¾å¤‡ä¹‹é—´çš„è¯­è¨€</p><p>é…ç½®çš„æ—¶å€™æ³¨æ„è®¾å¤‡é—´ä½¿ç”¨çš„å°è£…ç±»å‹å’Œä¿¡ä»¤æ ‡å‡†</p><p>å¸§ä¸­ç»§ æ˜¯NBMAç½‘ç»œï¼Œä¸æ”¯æŒå¹¿æ’­å’Œç»„æ’­ </p><p>å¸§ä¸­ç»§é€šè¿‡é€†å‘ARPè§£å†³IPâ€“&gt;DLCIå·çš„æ˜ å°„</p><p>å¸§ä¸­ç»§äº’è”æ‹“æ‰‘ç»“æ„ï¼š</p><p>å…¨äº’è”ã€éƒ¨åˆ†äº’è”ã€æ˜Ÿå½¢è¿æ¥</p><p>å¯ä»¥å°†ä¸€ä¸ªå¸§ä¸­ç»§æ¥å£åˆ’åˆ†ä¸ºå¤šä¸ªå­æ¥å£ï¼šå¯ä»¥å°†çº¿è·¯éš”ç¦»ï¼Œå¯ä»¥è§£å†³æ°´å¹³åˆ†å‰²é—®é¢˜ï¼›</p><p>ç‚¹å¯¹ç‚¹å­æ¥å£å¯ä»¥è§£å†³æ°´å¹³åˆ†å‰²é—®é¢˜ï¼Œä½†æ˜¯æµªè´¹IPåœ°å€</p><p>å¤šç‚¹å­æ¥å£ä¸å¯ä»¥è§£å†³æ°´å¹³åˆ†å‰²é—®é¢˜ï¼Œä½†æ˜¯ä¸æµªè´¹IPåœ°å€</p><h4 id="PPPåè®®"><a href="#PPPåè®®" class="headerlink" title="PPPåè®®"></a>PPPåè®®</h4><p>PPPåè®®å¯ä»¥è¯´æ˜¯åº”ç”¨æœ€å¹¿æ³›çš„å¹¿åŸŸç½‘äºŒå±‚åè®®ï¼Œåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šNCPï¼ˆç½‘ç»œæ§åˆ¶åè®®ï¼Œåœ¨ä¸‰å±‚ä¸äºŒå±‚åšå…¼å®¹è½¬æ¢ï¼‰ï¼ŒLCPï¼ˆé“¾è·¯æ§åˆ¶åè®®ï¼Œå»ºç«‹æ‹†é™¤çº¿è·¯ï¼‰ï¼›</p><p>PPPåè®®çš„ç‰¹ç‚¹ï¼šï¼ˆLCPçš„å®ç°ï¼‰ï¼ˆä¸åŒå‚å•†çš„è®¾å¤‡å¯ä»¥è¿æ¥ï¼‰</p><p>1 æ”¯æŒè®¤è¯ï¼ˆ2å±‚çš„è®¤è¯æœºåˆ¶ï¼‰</p><p>2 æ”¯æŒå›æ‹¨ï¼ˆé€šå¸¸ç”¨äºä¼ä¸šé›†ä¸­åŒ–ç®¡ç†è´¦å•ï¼‰</p><p>3æ”¯æŒå‹ç¼©ï¼ˆå¯ç”¨å‹ç¼©ä¹‹åï¼Œæ‰€æœ‰é€šè¿‡çº¿ç¼†çš„æ•°æ®éƒ½æ˜¯è¢«å‹ç¼©ï¼Œç›¸å½“äºä¾§é¢æé«˜äº†ä¼ è¾“é€Ÿç‡ï¼‰</p><p>4æ”¯æŒå¤šé“¾è·¯ï¼ˆå…è®¸å°†å¤šä¸ªç‰©ç†çº¿è·¯æ†ç»‘æˆä¸€ä¸ªé€»è¾‘çº¿è·¯ï¼Œæé«˜ä¼ è¾“sé€Ÿç‡ï¼‰</p><p>ã€ŠTCP&#x2F;IPåè®®è¯¦è§£ã€‹80å¹´ä»£çš„ä¹¦</p><p>PPPè¿æ¥å»ºç«‹çš„è¿‡ç¨‹ï¼š</p><p>1 è¯·æ±‚å»ºç«‹è¿æ¥ï¼›</p><p>2 LCPæ§åˆ¶è¿æ¥ï¼ˆå¯èƒ½ä¼šæœ‰è®¤è¯ï¼‰</p><p>3 NCPå¤„ç†ï¼›</p><p>PPPè®¤è¯åˆ†ä¸ºä¸¤ç§ï¼šPAPï¼ˆæ˜æ–‡è®¤è¯ï¼‰å’ŒCHAPï¼ˆæŒ‘æˆ˜æ¡æ‰‹è®¤è¯åè®®ï¼ˆä¸‰æ¬¡æ¡æ‰‹åŒå‘è®¤è¯ï¼‰ï¼‰ä½¿ç”¨çš„æ˜¯è·¯ç”±å™¨çš„å…¨å±€ç”¨æˆ·åå¯†ç </p><p>é…ç½®å‘½ä»¤ï¼šï¼ˆçº¿è·¯ä¸¤ç«¯çš„å°è£…åè®®å¿…é¡»ä¸€æ ·ï¼‰</p><p>Interfaceã€€ï½“ï¼ï¼ï¼ï¼ï¼</p><p>Encapsulationã€€ppp</p><p>è®¤è¯ï¼š</p><p>â‘ PAPè®¤è¯ï¼ˆæœ‰å‘èµ·æ–¹å’Œæ¥æ”¶æ–¹ï¼‰</p><p>åœ¨å…¨å±€æ¨¡å¼ä¸‹ï¼š</p><p>Username name password passwd</p><p>åœ¨è¦å¯ç”¨è®¤è¯çš„æ¥å£ä¸Šï¼š</p><p>Ppp authentication pap</p><p>åœ¨çº¿è·¯å¦ä¸€ç«¯</p><p>å…¨å±€é…ç½®æ¨¡å¼ä¸‹ï¼š</p><p>Ppp pap sent-usernam name password passed</p><p>â‘¡CHAPè®¤è¯ï¼š</p><p>å»ºç«‹çš„ç”¨æˆ·åæ˜¯å¯¹ç«¯çš„ä¸»æœºåï¼Œå¯†ç å¿…é¡»è¦ä¸€æ ·</p><p>åœ¨ä¸€ç«¯ï¼š</p><p>å…¨å±€é…ç½®æ¨¡å¼ï¼š</p><p>Usernameã€€å¯¹ç«¯çš„ä¸»æœºåã€€passwordã€€å¯†ç </p><p>Pppã€€authenticationã€€CHAP</p><p>å¦ä¸€ç«¯ç›¸åŒçš„é…ç½®</p><p>æŸ¥çœ‹è¿‡ç¨‹å¯ç”¨ã€€debugã€€pppã€€negotiation</p><h4 id="äº¤æ¢åŸºç¡€"><a href="#äº¤æ¢åŸºç¡€" class="headerlink" title="äº¤æ¢åŸºç¡€"></a>äº¤æ¢åŸºç¡€</h4><p>HUBè¿æ¥ï¼šä¼šäº§ç”Ÿæ•°æ®å†²çª</p><p>Bridgesï¼ˆç½‘æ¡¥ï¼‰ï¼šå…·æœ‰äºŒå±‚çš„è¿‡æ»¤åŠŸèƒ½ï¼ˆåŸºäºäºŒå±‚çš„macåœ°å€è¿›è¡Œè¿‡æ»¤ï¼‰ï¼Œï¼ˆè¿˜æ˜¯å±äºè½¯ä»¶å¤„ç†ï¼‰å¯ä»¥äº’è”å¤šä¸ªç½‘æ®µã€‚</p><p>switchesï¼ˆäº¤æ¢æœºï¼‰ï¼šå±äºç¡¬ä»¶å¤„ç†ï¼Œå¯ä»¥çº¿é€Ÿè½¬å‘ã€‚</p><p>åˆ’åˆ†äº†å¤šä¸ªå†²çªåŸŸï¼Œæ¯ä¸ªæ¥å£ä¸‹çš„ç»ˆç«¯è®¾å¤‡å±äºä¸€ä¸ªç‹¬ç«‹çš„å†²çªåŸŸï¼Œä¸ä¼šäº§ç”Ÿæ•°æ®å†²çªã€‚</p><p>å…¨åŒå·¥æ¨¡å¼ï¼Œå¯ä»¥åŒæ—¶è¿›è¡Œæ”¶å’Œå‘å…è®¸çº¿ç¼†ä¸¤ç«¯é€Ÿåº¦ä¸ä¸€æ ·ã€‚</p><p>å¯ä»¥é€šè¿‡mac table å¯¹æ•°æ®è¿›è¡Œæ™ºèƒ½è½¬å‘ï¼Œè€Œä¸”mac tableæ˜¯å¯ä»¥å­¦ä¹ çš„</p><p>äº¤æ¢æœºåˆšå¼€æœºçš„æ—¶å€™mac tableæ˜¯ç©ºçš„ï¼Œåœ¨è½¬å‘è¿‡ç¨‹ä¸­è¿›è¡Œå­¦ä¹ ã€‚å½“ä¸çŸ¥é“ç›®æ ‡macåœ°å€åœ¨å“ªçš„æ—¶å€™ï¼Œä¼šæŠŠæ•°æ®ä»å…¶ä½™çš„æ¥å£æ³›æ´ªå‡ºå»ã€‚å¯¹å±€åŸŸç½‘çš„ç»„æ’­å’Œå¹¿æ’­æ•°æ®è¿›è¡Œæ³›æ´ªæ“ä½œã€‚</p><p>ç‰¹ç‚¹ï¼š</p><p>å¤šæ¥å£ï¼Œå¾ˆé«˜å†—ä½™æ€§ï¼Œçº¿é€Ÿè½¬å‘ï¼Œå¯ä»¥æ··åˆä¸åŒçš„æ¥å£é€Ÿåº¦ï¼Œå¿«é€Ÿè½¬å‘</p><p>ä¸‰ç§å·¥ä½œæ¨¡å¼ï¼š</p><p>ç›´é€šäº¤æ¢ï¼Œæ— ç¢ç‰‡äº¤æ¢ï¼Œå­˜å‚¨è½¬å‘äº¤æ¢</p><h4 id="VLANå’ŒTrunks"><a href="#VLANå’ŒTrunks" class="headerlink" title="VLANå’ŒTrunks"></a>VLANå’ŒTrunks</h4><p>åˆ’åˆ†å†²çªåŸŸï¼Œå…·æœ‰äºŒå±‚éš”ç¦»æ€§ï¼Œä¸€ä¸ªvlanç›¸å½“äºä¸€ä¸ªå†²çªåŸŸï¼Œç­‰äºä¸€ä¸ªå±€åŸŸç½‘ã€‚vlanéš”ç¦»ä¹‹åæ˜¯ä¸¤ä¸ªå­ç½‘ï¼Œè¾¾åˆ°è·¯ç”±çš„éš”ç¦»æ€§ã€‚</p><p>ä¸åŒvlané€šä¿¡éœ€è¦é€šè¿‡ä¸‰å±‚è®¾å¤‡ã€‚</p><p>vlançš„åˆ’åˆ†æ˜¯åœ¨æ¥å£ä¸Šåˆ’åˆ†çš„ï¼Œä¸åŒçš„vlanæ˜¯ä¸åŒçš„é€»è¾‘å­ç½‘</p><p>åˆ’åˆ†å‡ºæ¥çš„vlanå°±ç›¸å½“äºä¸¤ä¸ªå¤„äºä¸åŒç½‘æ®µçš„äº¤æ¢æœº</p><p>vlanå¯ä»¥éš”ç¦»å¹¿æ’­åŸŸã€‚</p><p>Trunks å…è®¸ä¸åŒäº¤æ¢æœºçš„ç›¸åŒVlané€šä¿¡ï¼Œå…è®¸åœ¨ä¸€æ ¹çº¿è·¯ä¸Šæ‰¿è½½å¤šä¸ªvlanä¿¡æ¯ï¼Œè¿™ä¸ªæ¥å£å°±æ˜¯Trunkæ¥å£ã€‚</p><p>æ‰€æœ‰æ²¡æ‰“æ ‡è®°çš„æ•°æ®åŒ…ï¼Œç»Ÿä¸€åˆ’ç»™native Vlan</p>]]></content>
    
    
    
    <tags>
      
      <tag>CCNA</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CCNA-å¹¿åŸŸç½‘å’ŒACL</title>
    <link href="/2014/05/19/CCNA-%E5%B9%BF%E5%9F%9F%E7%BD%91%E5%92%8CACL/"/>
    <url>/2014/05/19/CCNA-%E5%B9%BF%E5%9F%9F%E7%BD%91%E5%92%8CACL/</url>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç¬”è®°ï¼Œæ¯”è¾ƒé›¶æ•£</p><span id="more"></span><h4 id="å¹¿åŸŸç½‘"><a href="#å¹¿åŸŸç½‘" class="headerlink" title="å¹¿åŸŸç½‘"></a>å¹¿åŸŸç½‘</h4><p>å±€åŸŸç½‘å†…åŸºæœ¬ä¸Šæ˜¯ä»¥å¤ªç½‘ç›¸è¿ï¼Œé€šå¸¸æœ€å¤§ä¼ è¾“è·ç¦»ä¸º100ç±³ã€‚</p><p>å¹¿åŸŸç½‘æŠ€æœ¯ä¸€èˆ¬æ˜¯ç”¨æ¥èŠ‚çº¦æˆæœ¬çš„</p><p>å¹¿åŸŸç½‘ä¸ç­‰äºInternet  Internetåªæ˜¯å¹¿åŸŸç½‘çš„ä¸€ç§</p><p>å¹¿åŸŸç½‘æŠ€æœ¯å¾€å¾€åªæ¶‰åŠä¸‹OSIä¸¤å±‚ï¼ˆæ•°æ®é“¾è·¯å±‚å’Œç‰©ç†å±‚ï¼‰å¯¹ä¸Šå±‚æ²¡æœ‰å½±å“ </p><p>åˆ†ä¸ºDTEç«¯ï¼ˆå®¢æˆ·ç«¯ï¼‰  DCEç«¯ï¼ˆæœåŠ¡å•†ç«¯ï¼Œåœ¨é…ç½®çš„æ—¶å€™æ—¶é’Ÿé¢‘ç‡åªèƒ½é…ç½®åœ¨DCEç«¯ï¼‰</p><p>åœ¨å±€åŸŸç½‘ä¸­äºŒå±‚ä½¿ç”¨çš„æ˜¯macåè®® </p><p>wanæ•°æ®é“¾è·¯å±‚åè®®ï¼š</p><p>HDLC</p><p>PPP</p><p>Frame Relayï¼ˆå¸§ä¸­ç»§ï¼‰ </p><p>ATMï¼ˆå¼‚æ­¥ä¼ è¾“ç½‘ç»œï¼‰ã€€</p><p>ISDN</p><p>WANåˆ†ä¸ºä¸“ç”¨çº¿è·¯ï¼ˆç§Ÿç”¨çº¿è·¯ï¼‰å’Œ</p><p>äº¤æ¢çº¿è·¯ï¼ˆç”µè·¯äº¤æ¢ï¼ŒPSTNï¼Œå®¶ç”¨ç”µè¯ï¼Œå±äºæ¨¡æ‹Ÿä¿¡å·ä¼ è¾“ï¼›åŒ…äº¤æ¢ï¼ˆå»‰ä»·ï¼Œä¿¡å·ä¸€èˆ¬ï¼‰ï¼Œæ•°å­—ä¿¡å·äº¤æ¢ï¼›ä¿¡æºäº¤æ¢ï¼ˆé€Ÿåº¦å¿«ï¼Œè´¹ç”¨é«˜ï¼‰ï¼Œæ•°å­—ä¿¡å·äº¤æ¢ï¼ŒAMTï¼Œå¼‚æ­¥ä¼ è¾“ç½‘ç»œï¼‰</p><p>å¹¿åŸŸç½‘åˆ†ä¸ºé—­ç½‘å’Œå¼€ç½‘</p><h4 id="ACL-è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆaccess-control-listï¼‰"><a href="#ACL-è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆaccess-control-listï¼‰" class="headerlink" title="ACL-è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆaccess control listï¼‰"></a>ACL-è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆaccess control listï¼‰</h4><p>å¯¹IPç½‘ç»œæµé‡è¿›è¡Œé…ç½®ï¼Œå…è®¸æˆ–è€…ä¸å…è®¸æŸäº›åŒ…è¿æ¥æŸäº›æœåŠ¡å™¨</p><p>å¯¹æµé‡è¿›è¡Œåˆ†ç±»</p><p>å¯ä»¥æŠŠå®ƒç®€å•è®¤ä¸ºæ˜¯ä¸€ä¸ªé˜²ç«å¢™</p><p>å½“æŠŠACLå½“ä½œè¿‡æ»¤å™¨æ¥ä½¿ç”¨çš„æ—¶å€™</p><p>å…è®¸æˆ–è€…ä¸å…è®¸æŸäº›åŒ…é€šè¿‡è·¯ç”±å™¨</p><p>æ²¡æœ‰ACLçš„æ—¶å€™ï¼Œæ‰€æœ‰çš„åŒ…éƒ½æ˜¯å…è®¸åˆ°æ‰€æœ‰çš„åœ°æ–¹å»çš„</p><p>ACLæ‰€èƒ½åˆ†è¾¨çš„ä¿¡æ¯åˆ°4å±‚ï¼ŒACLä¹Ÿç§°ä¸ºåŒ…é˜²ç«å¢™ï¼Œå¯ä»¥æ ¹æ®æµé‡çš„TCP&#x2F;IPæˆ–è€…UDPæˆ–è€…ç«¯å£å·æ¥è¿›è¡Œè¿‡æ»¤ï¼Œä½†æ˜¯å¹¶ä¸èƒ½è¿›è¡Œå†…å®¹è¿‡æ»¤</p><p>ACLå¯ä»¥å¯¹æµé‡è¿›è¡Œåˆ†ç±»ï¼Œä¸ä¼šå¯¹æµé‡è¿›è¡Œè¿‡æ»¤ï¼Œåªèƒ½èµ·åˆ°åˆ†æ£€å™¨çš„ä½œç”¨</p><p>å½“æ•°æ®åŒ…è¿›å»è·¯ç”±å™¨çš„æ—¶å€™ï¼Œå…ˆæ£€æŸ¥è·¯ç”±è¡¨ï¼Œæœ‰çš„è¯å»æ£€æŸ¥å‡ºæ¥å£æ˜¯å¤ŸæŒ‚è½½ACLï¼ˆACLå½“åšè¿‡æ»¤å™¨æ¥ä½¿ç”¨çš„æ—¶å€™ï¼Œæ˜¯éœ€è¦ç»‘å®šæ¥å£çš„ï¼Œä¸¤ä¸ªæ–¹å‘ï¼šå‡ºå‘è¿˜æ˜¯å…¥å‘ï¼Œå³æ£€æµ‹è¿›æ¥çš„è¿˜æ˜¯æ£€æµ‹å‡ºå»çš„åŒ…ã€‚ä¸€ä¸ªæ¥å£ä¸Šæœ€å¤šæŒ‚ä¸¤ä¸ªACLï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªæ–¹å‘æŒ‚è½½ä¸€ä¸ªï¼Œå¯ä»¥åœ¨ä¸€ä¸ªACLä¸Šè®¾å®šå¤šä¸ªè§„åˆ™ï¼‰ï¼Œæ˜¯çš„è¯è¿›è¡ŒACLæ§åˆ¶æµ‹è¯•ï¼ŒACLå…è®¸è¯¥åŒ…é€šè¿‡çš„è¯å°±è½¬å‘ã€‚è‹¥å…¶ä¸­ä»»æ„è¿‡ç¨‹ä¸ºå¦ï¼Œè¯¥åŒ…ä¸¢å¼ƒã€‚</p><p>ä¸€ä¸ªACLå¯ä»¥è®¾å®šå¤šä¸ªåˆ¤å®šæ¡ä»¶ï¼Œåªè¦åŒ¹é…ä¸€ä¸ªå°±å¯ä»¥è½¬å‘ï¼Œå¤šä¸ªæ¡ä»¶ä¹‹é—´çš„é€»è¾‘å…³ç³»æ˜¯æˆ–ï¼Œå½“åŒ¹é…åˆ°å…¶ä¸­ä¸€ä¸ªåˆ¤å®šæ¡ä»¶çš„æ—¶å€™ï¼Œç«‹å³æ‰§è¡Œè¯¥æ¡ä»¶åçš„åŠ¨ä½œï¼Œè‹¥å…¨éƒ¨ä¸åŒ¹é…ï¼Œåˆ™å°†è¯¥åŒ…ä¸¢å¼ƒã€‚</p><p>ACLåˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š</p><p>æ ‡å‡†ACLï¼šé€Ÿåº¦å¿«ï¼Œåªèƒ½åŸºäºå‘é€çš„æºIPåœ°å€è¿›è¡Œåˆ¤æ–­</p><p>æ‰©å±•ACLï¼šæ‰©å±•çš„ACLè¾ƒä¸ºç²¾ç»†ä¸€ç‚¹ï¼Œå¯ä»¥åŸºäºæºåœ°å€ï¼Œç›®æ ‡åœ°å€ï¼Œåè®®ï¼Œç«¯å£å·è¿›è¡Œåˆ¤æ–­ã€‚é€Ÿåº¦ç›¸å¯¹æ¥è¯´æ…¢ä¸€ç‚¹ã€‚</p><p>æ€ä¹ˆåŒºåˆ†ä¸¤ç§ACLï¼šåŸºäºç¼–å·ï¼šå½“ç¼–å·åœ¨1-99ï¼Œ1300-1999å°±æ˜¯æ ‡å‡†çš„</p><p>å½“ç¼–å·æ˜¯100-199ï¼Œ2000-2699å°±æ˜¯æ‰©å±•çš„</p><p>åŸºäºå‘½åï¼šæ˜ç¡®æŒ‡å‡ºACLç±»å‹</p><p>æ ‡å‡†è®¿é—®æ§åˆ¶åˆ—è¡¨çš„è¯­æ³•æ ¼å¼</p><p>Access-list access-list-number</p><p>ï½›permit | deny | remarkï½source ã€maskã€‘</p><p>ç¤ºä¾‹ï¼š</p><p>æ‹’ç»æ‰€æœ‰æ¥è‡ª1.1.1.1çš„æ•°æ®åŒ…</p><p>Access-list 1 deny 1.1.1.1 0.0.0.0ï¼ˆåç ï¼Œ0è¡¨ç¤ºåŒ¹é…ï¼Œ1è¡¨ç¤ºæ— æ‰€è°“ï¼‰</p><p>Access-list 1 permit 0.0.0.0 255.255.255.255 ï¼ˆå› ä¸ºé»˜è®¤æ˜¯æ‹’ç»æ‰€æœ‰ï¼Œæ²¡æœ‰è¿™æ¡å‘½ä»¤æ•°æ®åŒ…æ˜¯æ— æ³•é€šè¿‡çš„ï¼‰</p><p>æˆ–è€…ï¼š access-list 1 deny host 1.1.1.1</p><p>Access-list 1 permit any  ï¼ˆhostå’Œanyæ˜¯é¢„å…ˆè®¾å®šå¥½çš„é€šé…ç¬¦ï¼‰</p><p>å…è®¸æ‰€æœ‰æ¥è‡ª192.168.1.0&#x2F;24çš„æ•°æ®åŒ…</p><p>Access-list 1 permit 192.168.1.0 0.0.0.255</p><p>é…ç½®å®Œä¹‹åè¿˜è¦ç»‘å®šåˆ°ç«¯å£ã€‚</p><p>ï¼ˆè§„åˆ™é¡ºåºå¾ˆé‡è¦ï¼Œä½†æ˜¯ç¼–å·ACLä¸å…è®¸åˆ é™¤å•ç‹¬çš„ä¸€æ¡è§„åˆ™</p><p>ä¾‹å¦‚ </p><p>Access-list 1 deny 1.1.1.0 0.0.0.255</p><p>Access-list 1 permit 1.1.1.1 0.0.0.0</p><p>è¿™æ ·çš„è¯ç¬¬äºŒæ¡è§„åˆ™æ°¸è¿œä¸ä¼šç”Ÿæ•ˆï¼Œå› ä¸ºåœ¨åŒ¹é…äº†ç¬¬ä¸€æ¡è§„åˆ™åï¼Œå°±ä¼šç«‹å³æ‰§è¡Œç¬¬ä¸€æ¡è§„åˆ™ä¹‹åçš„åŠ¨ä½œï¼Œä¸å†å‘ä¸‹è¿›è¡ŒåŒ¹é…ï¼‰</p><p>åœ¨æ¥å£é…ç½®æ¨¡å¼ä¸‹ï¼š</p><p>Ip access-group access-list-number ï½›in | outï½</p><p>æ ‡å‡†ACLé…ç½®å¤§ä½“åˆ†ä¸ºä¸¤æ­¥ï¼š</p><p>â‘ ï¼šåœ¨å…¨å±€é…ç½®æ¨¡å¼ä¸‹åˆ›å»ºè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼Œå¹¶ä¸”è®¾å®šè§„åˆ™</p><p>â‘¡ï¼šåœ¨æ¥å£é…ç½®æ¨¡å¼ä¸‹æŒ‚è½½ACLï¼Œå¹¶æŒ‡å®šæ–¹å‘ã€‚</p><p>æ‰©å±•è®¿é—®æ§åˆ¶åˆ—è¡¨è¯­æ³•æ ¼å¼</p><p>ç¤ºä¾‹</p><p>æ‹’ç»æ‰€æœ‰ä»1.1.1.1 åˆ°2.2.2.2 çš„pingåŒ…ï¼ˆpingä½¿ç”¨çš„æ˜¯ICMPåè®®ï¼‰</p><p>Access-list 100 deny icmp host 1.1.1.1 host 2.2.2.2</p><p>Access-list 100 permit ip any any</p><p>æ‹’ç»æ‰€æœ‰ä»1.1.1.0&#x2F;24 åˆ°2.2.2.0&#x2F;24çš„httpæµé‡</p><p>Access-list 100 deny tcp 1.1.1.0 0.0.0.255 2.2.2.0 0.0.0.255 eqï¼ˆç«¯å£å·ï¼‰ 80</p><p>å‘½åè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆå¯ä»¥å•ç‹¬åˆ é™¤å…¶ä¸­çš„ä¸€æ¡è§„åˆ™ï¼‰</p><p>ç¤ºä¾‹ï¼š</p><p>Ip access-list standard name</p><p>Deny host 172.16.4.13</p><p>Permit 172.16.4.0 0.0.0.255</p><p>Interface e0</p><p>Ip access-group name ï½›out | inï½</p><p>åˆ é™¤çš„æ—¶å€™å¯ä»¥ç›´æ¥noå…¶ä¸­ä¸€æ¡</p><p>Remark æ³¨é‡Š  æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œåªæ˜¯ç®€å•çš„æ³¨é‡Š</p><p>å¯ä»¥é€šè¿‡ show access-list æŸ¥çœ‹</p>]]></content>
    
    
    
    <tags>
      
      <tag>CCNA</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CCNA-DHCPå’ŒNAT</title>
    <link href="/2014/05/19/CCNA-DHCP%E5%92%8CNAT/"/>
    <url>/2014/05/19/CCNA-DHCP%E5%92%8CNAT/</url>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç¬”è®°ï¼Œæ¯”è¾ƒé›¶æ•£</p><span id="more"></span><h4 id="åŠ¨æ€ä¸»æœºé…ç½®åè®®ï¼šdynamic-host-configuration-protocol-æ¶æ„ä¸ºC-x2F-S-å®¢æˆ·ç«¯-x2F-æœåŠ¡å™¨-å‰èº«æ˜¯-boot-protocol"><a href="#åŠ¨æ€ä¸»æœºé…ç½®åè®®ï¼šdynamic-host-configuration-protocol-æ¶æ„ä¸ºC-x2F-S-å®¢æˆ·ç«¯-x2F-æœåŠ¡å™¨-å‰èº«æ˜¯-boot-protocol" class="headerlink" title="åŠ¨æ€ä¸»æœºé…ç½®åè®®ï¼šdynamic host configuration protocol  æ¶æ„ä¸ºC&#x2F;S å®¢æˆ·ç«¯&#x2F;æœåŠ¡å™¨   å‰èº«æ˜¯ boot protocol"></a>åŠ¨æ€ä¸»æœºé…ç½®åè®®ï¼šdynamic host configuration protocol  æ¶æ„ä¸ºC&#x2F;S å®¢æˆ·ç«¯&#x2F;æœåŠ¡å™¨   å‰èº«æ˜¯ boot protocol</h4><p>DHCPä½¿ç”¨UDPåè®®ï¼Œç«¯å£å·ä¸º67(å®¢æˆ·ç«¯)ï¼Œ68ï¼ˆæœåŠ¡ç«¯ï¼‰</p><p>IPå¯ä»¥å’Œmacç»‘å®š</p><p>å·¥ä½œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>C â€”-&gt;ï¼³ï¼ˆdiscover messageï¼‰å‘ç°æ¶ˆæ¯ï¼Œåœ¨å±€åŸŸç½‘å†…å¹¿æ’­å‘é€</p><p>S â€”-&gt;ï¼£ï¼ˆoffer messageï¼‰ å›å¤æ¶ˆæ¯  å•æ’­å“åº”è¯·æ±‚çš„å®¢æˆ·ç«¯</p><p>C â€”-&gt;ï¼³ï¼ˆrequest messageï¼‰è¯·æ±‚æ¶ˆæ¯  å¹¿æ’­å‘é€ï¼ˆå› ä¸ºä¸€ä¸ªå±€åŸŸç½‘å¯èƒ½æœ‰å¤šä¸ªè·¯ç”±å™¨ï¼Œå…ˆæ”¶åˆ°å“ªä¸ªæœåŠ¡å™¨çš„offerå°±ç”¨è°çš„IPï¼‰</p><p>S â€”-&gt;ï¼£ (acknowledge message) ç¡®è®¤æ¶ˆæ¯  ACKæ¶ˆæ¯</p><p>DHCPã€€configurationã€€ï¼¯ï½ã€€IOS</p><p>ï¼ˆdhcpåªèƒ½é…ç½®åœ¨ä»¥å¤ªç½‘ä¸Šï¼Œä¸²å£æ˜¯æ²¡æœ‰åŠæ³•é…ç½®dhcpçš„ï¼‰</p><table><thead><tr><th>ï¼ˆconfigï¼‰#service dhcp</th><th>å¯åŠ¨DHCPæœåŠ¡</th></tr></thead><tbody><tr><td>(config)# ip dhcp pool name</td><td>æŒ‡å®šåœ°å€æ± çš„åå­—</td></tr><tr><td>(dhcp-config)#network 192.168.1.0 255.255.255.0</td><td>æŒ‡å®šä¸ºå“ªä¸ªç½‘æ®µæœåŠ¡</td></tr><tr><td>(dhcp-config)#default-router 192.168.1.254</td><td>å¯é€‰ï¼ŒæŒ‡å®šç½‘å…³</td></tr><tr><td>(dhcp-config)#domain-name name</td><td>å¯é€‰ï¼ŒæŒ‡å®šåŸŸå</td></tr><tr><td>(dhcp-config)#dns-server IP IP</td><td>å¯é€‰ï¼ŒDNSæœåŠ¡å™¨</td></tr><tr><td>(dhcp-config)#lease 7</td><td>å¯é€‰ï¼Œç§Ÿçº¦æœŸï¼Œå•ä½æ˜¯å¤©</td></tr><tr><td>configï¼‰# ip dhcp excluded-address 192.168.1.1 192.168.1.10</td><td>æ’é™¤ä¸æƒ³åˆ†é…çš„IPåœ°å€</td></tr></tbody></table><h4 id="NATï¼š-ç½‘ç»œåœ°å€è½¬æ¢ï¼Œç”¨æ¥ä¿®æ”¹IPæ•°æ®åŒ…ä¸­çš„æºã€ç›®çš„åœ°å€"><a href="#NATï¼š-ç½‘ç»œåœ°å€è½¬æ¢ï¼Œç”¨æ¥ä¿®æ”¹IPæ•°æ®åŒ…ä¸­çš„æºã€ç›®çš„åœ°å€" class="headerlink" title="NATï¼š ç½‘ç»œåœ°å€è½¬æ¢ï¼Œç”¨æ¥ä¿®æ”¹IPæ•°æ®åŒ…ä¸­çš„æºã€ç›®çš„åœ°å€"></a>NATï¼š ç½‘ç»œåœ°å€è½¬æ¢ï¼Œç”¨æ¥ä¿®æ”¹IPæ•°æ®åŒ…ä¸­çš„æºã€ç›®çš„åœ°å€</h4><h5 id="ç§æœ‰IPåœ°å€"><a href="#ç§æœ‰IPåœ°å€" class="headerlink" title="ç§æœ‰IPåœ°å€"></a>ç§æœ‰IPåœ°å€</h5><p>Aç±»  10.0.0.0 â€“ 10.255.255.255</p><p>Bç±» 172.16.0.0 â€“ 172.31.255.255</p><p>Cç±» 192.168.0.0 â€“ 192.168.255.255</p><p>åªèƒ½å­˜åœ¨äºå†…ç½‘ä¸­ï¼Œæ˜¯ä¸èƒ½å‡ºç°åœ¨äº’è”ç½‘ä¸Šçš„</p><h5 id="ä¸ºä½•ä½¿ç”¨NATæŠ€æœ¯"><a href="#ä¸ºä½•ä½¿ç”¨NATæŠ€æœ¯" class="headerlink" title="ä¸ºä½•ä½¿ç”¨NATæŠ€æœ¯"></a>ä¸ºä½•ä½¿ç”¨NATæŠ€æœ¯</h5><p>1 èŠ‚çœIPåœ°å€ ï¼ˆNAT + VLSM&#x2F;CIDRï¼‰</p><p>2 å®‰å…¨è€ƒè™‘ï¼Œéšè—å†…éƒ¨çœŸå®çš„IPåœ°å€</p><p>3 NAT TCPè´Ÿè½½å‡è¡¡</p><p>4 è§£å†³åœ°å€å†²çªé—®é¢˜ï¼ˆå…¬å¸åˆå¹¶ï¼‰</p><h5 id="ç¼ºç‚¹ï¼š"><a href="#ç¼ºç‚¹ï¼š" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h5><p>1 å½±å“è·¯ç”±å™¨çš„è½¬å‘æ€§èƒ½ï¼ˆé¢å¤–ä¿®æ”¹IPåœ°å€ï¼Œè®¡ç®—æ ¡éªŒå’Œç­‰ï¼‰</p><p>2 ç ´åäº†IPçš„ç«¯åˆ°ç«¯ç‰¹æ€§</p><p>3 ä¸å¾ˆå¤šå®‰å…¨ç›¸å…³åè®®ä¸å…¼å®¹ï¼ˆIPSecç­‰ï¼‰</p><h5 id="NAT-åˆ†ç±»"><a href="#NAT-åˆ†ç±»" class="headerlink" title="NAT  åˆ†ç±»"></a>NAT  åˆ†ç±»</h5><p>1 é™æ€NAT</p><p>â€“æ‰‹å·¥é…ç½®NATæ˜ å°„è¡¨</p><p>â€“ ä¸€å¯¹ä¸€è½¬æ¢</p><p>2 åŠ¨æ€NAT</p><p>â€“ å®šä¹‰åœ°å€æ± ï¼ŒåŠ¨æ€åˆ›å»ºNATæ˜ å°„è¡¨</p><p>â€“ ä¸€å¯¹ä¸€è½¬æ¢</p><p>3 PATï¼ˆNAT Overload NATè¿‡è½½ï¼‰ å°±æ˜¯æˆ‘ä»¬å¹³æ—¶è¯´çš„NATè½¬æ¢</p><p>â€“ å¤šå¯¹ä¸€è½¬æ¢</p><p>â€“ é€šè¿‡ç«¯å£å·æ ‡è¯†ä¸åŒæ•°æ®æµï¼ˆå’Œé€šä¿¡çš„ç«¯å£å·æ²¡æœ‰å…³ç³»ï¼‰</p><p><img src="/image/ccna/nat.png" alt="natç½‘ç»œæ‹“æ‰‘"></p><p>æ¨¡æ‹Ÿç½‘ç»œè¿æ¥å¦‚å›¾ï¼š</p><p>C1ã€C2å’ŒNATæœåŠ¡å™¨åœ¨192.168.1.0&#x2F;24çš„ç½‘æ®µï¼Œå…¶ä¸­NATæœåŠ¡å™¨çš„IPæ˜¯192.168.1.254ï¼ŒNATæœåŠ¡å™¨é€šè¿‡çª—å£å’ŒISPç›¸è¿ï¼Œå…¬ç½‘åœ°å€åœ¨61.1.1.0&#x2F;24ç½‘æ®µ</p><p>é…ç½®åå‘½ä»¤ï¼ˆæ²¡æœ‰å…¨æ‹¼ï¼Œè‡ªå·±è¡¥å…¨å³å¯ï¼‰</p><p>ï¼ˆéœ€è¦æŒ‡å®šè½¬æ¢çš„æ–¹å‘ï¼Œå³å“ªè¾¹æ˜¯å†…ç½‘ï¼Œå“ªè¾¹æ˜¯å¤–ç½‘ï¼‰</p><p>â‘  é™æ€NAT ï¼Œä¸€å¯¹ä¸€å…³ç³»(ä¸è¦å¿˜äº†æŒ‡å®šè½¬æ¢æ–¹å‘ï¼Œå³å“ªè¾¹æ˜¯å†…ç½‘ï¼Œå“ªè¾¹æ˜¯å¤–ç½‘)</p><p>åœ¨ c1ä¸Šçš„é…ç½®</p><p>1ï¼‰æŒ‡å®šæ¥å£çš„IPçš„åœ°å€ï¼Œå¹¶æŒ‡å®šç¼ºçœç½‘å…³</p><p>conf t</p><p>int f0&#x2F;0</p><p>ip add 192.168.1.1 255.255.255.</p><p>no sh</p><p>ip route 0.0.0.0 0.0.0.0 192.168.1.254</p><p>åœ¨C2ä¸Š</p><p>æŒ‡å®šæ¥å£çš„IPï¼Œå¹¶æŒ‡å®šç¼ºçœç½‘å…³</p><p>conf t</p><p>int f0&#x2F;0</p><p>ip add 192.168.1.2 255.255.255.</p><p>no sh</p><p>ip route 0.0.0.0 0.0.0.0 192.168.1.254</p><p>åœ¨NATæœåŠ¡å™¨ä¸Š</p><p>åˆ¶å®šIPåœ°å€ï¼Œå¹¶è¿›è¡Œé…ç½®ï¼Œå‘½ä»¤å¦‚ä¸‹</p><p>Conf t</p><p>Int f0&#x2F;0</p><p>Ip add 192.168.1.254 255.255.255.0</p><p>No sh</p><p>Int s1&#x2F;1  (åœ¨å’ŒISPç›¸è¿çš„æ¥å£ä¸Šé…ç½®IP)</p><p>Ip add 61.1.1.1 255.255.255.0</p><p>Cl ra 64000</p><p>No sh </p><p>End</p><p>(NATæ˜ å°„)</p><p>Ip nat inside source static 192.168.1.1(æºIPåœ°å€) 61.1.1.11(ç›®æ ‡IPåœ°å€)</p><p>Ip nat inside source static 192.168.1.2(æºIPåœ°å€) 61.1.1.12(ç›®æ ‡IPåœ°å€)</p><p>(å¯ä»¥é€šè¿‡ show ip nat traslationsæŸ¥çœ‹è½¬æ¢è¡¨)</p><p>Int fa0&#x2F;0</p><p>Ip nat inside(æŒ‡å®šä¸ºå†…ç½‘ï¼Œå³å…¥å£)</p><p>Int s1&#x2F;1</p><p>Ip nat outsideï¼ˆæŒ‡å®šä¸ºå¤–ç½‘ï¼Œå³å‡ºå£ï¼‰</p><p>3 åœ¨ISPä¸Š</p><p>æŒ‡å®šå’ŒNATç›¸è¿çš„æ¥å£Ip</p><p>Conf t </p><p>Int s1&#x2F;1</p><p>Ip add 61.1.1.2 255.255.255.0</p><p>Cl ra 64000 </p><p>No sh </p><p>End</p><p>â‘¡åŠ¨æ€NAT(ä¸è¦å¿˜äº†æŒ‡å®šè½¬æ¢æ–¹å‘ï¼Œå³å“ªè¾¹æ˜¯å†…ç½‘ï¼Œå“ªè¾¹æ˜¯å¤–ç½‘)</p><p>åœ¨natä¸Š</p><p>Ip nat pool pool-name 61.1.1.10 61.1.1.20 netmask 255.255.255.0</p><p>(å®šä¹‰è®¿é—®æ§åˆ¶åˆ—è¡¨)</p><p>Access-list 1 permit 192.168.1.0 0.0.0.255</p><p>Ip nat inside source list 1 pool pool-name</p><p>åœ¨C1ã€c2å’ŒIPSä¸Šçš„é…ç½®å’Œé™æ€natç›¸åŒ</p><p>â‘¢NATè¿‡è½½ ï¼ˆå¤šä¸ªå†…ç½‘å¯¹åº”ä¸€ä¸ªå¤–ç½‘ï¼‰(ä¸è¦å¿˜äº†æŒ‡å®šè½¬æ¢æ–¹å‘ï¼Œå³å“ªè¾¹æ˜¯å†…ç½‘ï¼Œå“ªè¾¹æ˜¯å¤–ç½‘)</p><p>Access-list 1 permit 192.168.1.0 0.0.0.255</p><p>Ip nat inside source list 1 pool pool-name</p><p>Ip nat inside source list 1 interface s1&#x2F;1 overload</p>]]></content>
    
    
    
    <tags>
      
      <tag>CCNA</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CCNA-ERGIPåè®®</title>
    <link href="/2014/05/19/CCNA-ERGIP%E5%8D%8F%E8%AE%AE/"/>
    <url>/2014/05/19/CCNA-ERGIP%E5%8D%8F%E8%AE%AE/</url>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç¬”è®°ï¼Œæ¯”è¾ƒé›¶æ•£ã€‚</p><span id="more"></span><h4 id="EIPGRPï¼ˆä¼ä¸šçº§ã€é«˜çº§çš„è·¯ç”±é€‰æ‹©åè®®ï¼‰"><a href="#EIPGRPï¼ˆä¼ä¸šçº§ã€é«˜çº§çš„è·¯ç”±é€‰æ‹©åè®®ï¼‰" class="headerlink" title="EIPGRPï¼ˆä¼ä¸šçº§ã€é«˜çº§çš„è·¯ç”±é€‰æ‹©åè®®ï¼‰"></a>EIPGRPï¼ˆä¼ä¸šçº§ã€é«˜çº§çš„è·¯ç”±é€‰æ‹©åè®®ï¼‰</h4><p>ï¼ˆciscoç§æœ‰çš„åè®®ï¼Œåªæœ‰ciscoçš„è®¾å¤‡æ‰æ”¯æŒï¼‰</p><p>ç‰¹ç‚¹</p><ul><li><p>é«˜çº§è·ç¦»çŸ¢é‡å‹åè®®ï¼ˆæœ‰æ²¡æœ‰å‘é€è·¯ç”±ä¿¡æ¯ï¼‰</p></li><li><p>æ”¶æ•›é€Ÿåº¦å¿«ï¼ˆDUALç®—æ³•ï¼Œæ‰©æ•£æ›´æ–°ç®—æ³•ï¼‰</p></li><li><p>æ”¯æŒVLSMå’Œä¸è¿ç»­å­ç½‘</p></li><li><p>éƒ¨åˆ†æ›´æ–°ï¼ˆç½‘ç»œå·²ç»æ”¶æ•›ï¼Œåœ¨ç½‘ç»œæ‹“æ‰‘ä¸å‡ºç°å˜åŠ¨çš„æ—¶å€™ï¼Œä¸åœ¨å‘é€æ›´æ–°ä¿¡æ¯,åªå‘æ”¶åˆ°å˜åŒ–å½±å“è·¯ç”±æ¡ç›®çš„è·¯ç”±å™¨å‘é€å˜åŒ–çš„è·¯ç”±ï¼‰</p></li><li><p>æ”¯æŒå¤šç§ç½‘ç»œå±‚åè®®</p></li><li><p>æ”¯æŒå¯æ‰©å±•çš„ç½‘ç»œè®¾è®¡ï¼ˆæ²¡æœ‰å¤ªå¤šçš„è®¾è®¡è¦æ±‚ï¼‰</p></li><li><p>ä½¿ç”¨ç»„æ’­æˆ–è€…å•æ’­è¿›è¡Œæ›´æ–°ï¼ˆ224.0.0.0ï¼‰</p></li><li><p>å¯ä»¥åœ¨ç½‘ç»œä¸­çš„ä»»ä½•ä¸€ç‚¹ï¼Œè¿›è¡Œæ‰‹å·¥æ±‡æ€»ï¼Œå¹¶ä¸”æ”¯æŒè¶…ç½‘æ±‡æ€»</p></li><li><p>100%æ”¯æŒæ— ç¯è·¯çš„æ— ç±»è·¯ç”±</p></li><li><p>åœ¨wanå’Œlanä¸Šå®¹æ˜“é…ç½®</p></li><li><p>å¯ä»¥æ”¯æŒç­‰å¼€é”€æˆ–è€…éç­‰å¼€é”€çš„è´Ÿè½½å‡è¡¡</p></li></ul><h4 id="å·¥ä½œåŸç†-é‚»å±…æœºåˆ¶"><a href="#å·¥ä½œåŸç†-é‚»å±…æœºåˆ¶" class="headerlink" title="å·¥ä½œåŸç† é‚»å±…æœºåˆ¶"></a>å·¥ä½œåŸç† é‚»å±…æœºåˆ¶</h4><p>EIGRP ä¸‰å¼ è¡¨</p><p>é‚»å±…(ä¸‹ä¸€è·³)è¡¨(å‘é€æ›´æ–°ä¹‹å‰å…ˆæœå¯»é‚»å±…)</p><p>é‚»å±…è¡¨å»ºç«‹ä¹‹åäº¤æ¢è·¯ç”±ä¿¡æ¯</p><p>æ‹“æ‰‘è¡¨(ä»é‚»å±…å­¦ä¹ æ¥çš„è·¯ç”±è¡¨)(è¿è¡ŒDUALç®—æ³•,é€‰æ‹©æœ€ä¼˜è·¯å¾„)</p><p>è·¯ç”±è¡¨ï¼ˆé€‰æ‹©å‡ºæ¥çš„æœ€ä¼˜è·¯å¾„ï¼‰</p><h5 id="DUAL-ç®—æ³•"><a href="#DUAL-ç®—æ³•" class="headerlink" title="DUAL ç®—æ³•"></a>DUAL ç®—æ³•</h5><p>1  é€‰æ‹©åˆ°è¾¾ç›®æ ‡ç½‘ç»œçš„æœ€ä¼˜çš„æ— ç¯çš„è·¯å¾„</p><p>2 AD  ä¸‹ä¸€è·³è·¯ç”±åˆ°è¾¾ç›®æ ‡ç½‘ç»œçš„å¼€é”€</p><p>3 FD  æœ¬åœ°è·¯ç”±åˆ°è¾¾ç›®æ ‡ç½‘ç»œçš„å¼€é”€&#x3D;AD+æœ¬åœ°è·¯ç”±åˆ°è¾¾é€šå‘Šç»™æˆ‘ADçš„ä¸‹ä¸€è·³è·¯ç”±çš„å¼€é”€</p><p>lowestï¼costï¼lowestã€€FD</p><p>ï¼ˆcurrentï¼‰successor&#x3D; åˆ°è¾¾ç›®æ ‡ç½‘ç»œçš„æœ€ä¼˜çš„ä¸‹ä¸€è·³è·¯ç”±å™¨</p><p>Feasible successor &#x3D;åˆ°è¾¾ç›®æ ‡ç½‘ç»œçš„æ¬¡ä¼˜çš„ä¸‹ä¸€è·³è·¯ç”±å™¨</p><p>FC å¯è¡Œæ¡ä»¶  ï¼¡ï¼¤ï¼œï¼¦ï¼¤ï½ï½‰ï½</p><p>FC ç”¨æ¥é˜²ç¯</p><p>EIGRP  æ•°æ®åŒ…ç›´æ¥ä½¿ç”¨IPåè®®ï¼Œåè®®å·88</p><p>â€”â€”hello   å‘ç°ç»´æŠ¤é‚»æ¥å…³ç³»ï¼ˆå”¯ä¸€å‘¨æœŸæ€§å‘é€çš„ï¼‰</p><p>å½“çº¿è·¯&gt;t1  å‘¨æœŸ5ç§’  å½“ä¸‰ä¸ªå‘¨æœŸä»¥ä¸Šæ²¡æœ‰æ”¶åˆ°hello  è®¤ä¸ºé‚»å±…æŒ‚æ‰</p><p>å½“çº¿è·¯&lt;t1ï¼ˆï¼‘ã€‚ï¼•ï¼”ï¼”Mï¼‰   å‘¨æœŸ30  åŒä¸Š</p><p>â€”â€”update  å‘é€è·¯ç”±æ›´æ–°ï¼ˆè·¯ç”±ä¿¡æ¯ï¼‰</p><p>â€”â€”query    å‘é‚»å±…æŸ¥è¯¢ç‰¹å®šè·¯ç”±ä¿¡æ¯</p><p>â€”â€”reply    å“åº”queryæŸ¥è¯¢</p><p>â€”â€”ACK     ç¡®å®šæ•°æ®åŒ…</p><p>ï¼ˆrtp  ç¡®å®šæ”¶åˆ°  å¯é ä¼ è¾“ï¼‰</p><p><img src="/image/ccna/ERGIP_ket_technologies.png" alt="geocoderSearch"></p><p>ç¬¦åˆåº¦é‡å€¼ï¼ˆäº”ç§ï¼‰</p><p>å¸¦å®½  å»¶æ—¶ å¯é æ€§  è´Ÿè½½ MTU</p><p>é»˜è®¤ä½¿ç”¨å¸¦å®½å’Œå»¶æ—¶ï¼ˆå¯é æ€§å’Œè´Ÿè½½æ˜¯å˜å€¼ï¼‰</p><p>K1   k2   k3  k4  k5 </p><p>10100(å¯¹åº”äº”ä¸ªåº¦é‡å€¼)</p><p>EIGRPå»ºç«‹é‚»æ¥å…³ç³»çš„æ¡ä»¶</p><p>ASå·ä¸€æ ·ï¼ˆè¿›ç¨‹åŸŸï¼‰</p><p>Kå€¼</p><p>è®¤è¯</p><p>ERGIPã€€ç²¾ç¡®é€šå‘Š</p><p>Routerã€€ã€€ERGIPã€€ï¼‘</p><p>no auto-suï½ï½ary</p><p>networkã€€ç›®æ ‡IP åç (ä¸å­ç½‘æ©ç ç›¸å) (ï¼è¡¨ç¤ºåŒ¹é…ï¼‘è¡¨ç¤ºæ— æ‰€è°“)</p><p>ERGIPçš„è¡¨ç¤ºæ˜¯E(è·³æ•°æœ€å¤§100 å†…éƒ¨ç®¡ç†è·ç¦»90 å¤–éƒ¨ç®¡ç†è·ç¦»170ï¼‰ã€€</p><p>show ipprotocols</p><p>show ip eigrp neighbor(é‚»å±…è¡¨)</p><p>show ip eigrp topology</p><p>show ip route ergip</p><p>show ip ergip traffic</p><p>åœ¨æ¥å£ä¿®æ”¹</p><p>ip hello-interval ergip aså· æ—¶é—´</p><p>ip hold-time ergip aså· ä¸‰å€äºhelloæ—¶é—´</p><p>ä¿®æ”¹å¤åˆåº¦é‡å€¼ã€€</p><p>Metricã€€weightsã€€ï¼ï¼‘ï¼ï¼‘ï¼ï¼</p><p>ç¬¬ä¸€ä¸ªåªæ”¯æŒï¼ã€‚</p><p>æ£€æŸ¥Kå€¼ã€€å…¨ç½‘çš„Kå€¼å¿…é¡»ä¸€æ ·</p><p><img src="/image/ccna/ERGIP_MD5_AUTH.png" alt="geocoderSearch"></p><p>keychainåˆ›å»ºå¥½ä¹‹åæ¯ä¸ªæ”¯æŒåŠ å¯†çš„åè®®éƒ½å¯ä»¥ç”¨</p><p> EIGRPå¯ä»¥åœ¨ç½‘ç»œä¸­çš„ä»»ä½•ä¸€ç‚¹è¿›è¡Œè·¯ç”±æ±‡æ€»ï¼ˆæ”¯æŒè¶…ç½‘æ±‡æ€»ï¼‰</p><p>åœ¨æ¥å£çº§åˆ«ä¸Šè¿›è¡Œè´Ÿè½½å‡è¡¡</p><p> bandwidth  ã€‚ã€‚ã€‚ã€‚Kå•ä½ä¸ºK  è¿›è¡Œè´Ÿè½½å‡è¡¡</p><p>EIGRP Load Balancing</p><p>é»˜è®¤æƒ…å†µä¸‹EIGRP ä½¿ç”¨ç­‰å¼€é”€</p><p>é»˜è®¤æœ€å¤šåœ¨4æ¡ç­‰å¼€é”€è·¯å¾„ä¸Šè¿›è¡Œè´Ÿè½½å‡è¡¡</p><p>æœ€å¤šé…ç½®åˆ°16æ¡è·¯å¾„ä¸Šè¿›è¡Œè´Ÿè½½å‡è¡¡</p><p>é€šè¿‡ maximum-paths å‘½ä»¤æŒ‡å®šæœ€å¤§çš„è·¯å¾„</p><p>éç­‰å¼€é”€</p><p>Unequal-Cost è´Ÿè½½å‡è¡¡</p><p>variance æ•°å­—</p><p>ç”¨æ³•  ï¼š  å°†æœ€ä¼˜çš„FDÃ—varianceå€¼ï¼Œåªè¦å¤§äºæŸä¸ªçº¿è·¯çš„FD   æ”¹çº¿è·¯å°±ä¼šè‡ªåŠ¨åŠ è¿›æ¥</p><p><img src="/image/ccna/ERGIP_Variance.png" alt="geocoderSearch"></p>]]></content>
    
    
    
    <tags>
      
      <tag>CCNA</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CCNA-ospfåè®®</title>
    <link href="/2014/05/19/CCNA-ospf%E5%8D%8F%E8%AE%AE/"/>
    <url>/2014/05/19/CCNA-ospf%E5%8D%8F%E8%AE%AE/</url>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç¬”è®°ï¼Œæ¯”è¾ƒé›¶æ•£</p><span id="more"></span><p>å¼€æ”¾å¼æœ€çŸ­è·¯å¾„ä¼˜å…ˆ  open æœ€çŸ­è·¯å¾„ä¼˜å…ˆç®—æ³• </p><p>é«˜çº§ä¼ä¸šçº§è·¯ç”±åè®®</p><p>é“¾è·¯çŠ¶æ€å‹çš„è·¯ç”±é€‰æ‹©åè®®</p><p>æ¯ä¸ªè·¯ç”±çš„é€‰æ‹©æ˜¯æ¯ä¸ªè·¯ç”±å™¨ç‹¬ç«‹é€‰æ‹©çš„   ä¸æ˜¯é åˆ«çš„è·¯ç”±å™¨å‘Šè¯‰çš„</p><p>DUï¼ˆè·ç¦»çŸ¢é‡å‹ï¼‰ äº¤æ¢çš„æ˜¯route</p><p>LS ï¼ˆé“¾è·¯çŠ¶æ€å‹ï¼‰äº¤æ¢çš„æ˜¯linkstateï¼ˆæç»˜ç½‘ç»œæ‹“æ‰‘çš„ä¿¡æ¯ï¼‰</p><p>é“¾è·¯çŠ¶æ€å‹</p><p>æ‹¥æœ‰å…¨ç½‘çš„è·¯ç”±ä¿¡æ¯,å¹¶ä¸”æ¯ä¸ªè·¯ç”±å™¨çš„è·¯ç”±ä¿¡æ¯éƒ½æ˜¯ä¸€è‡´çš„  </p><p>é“¾è·¯çŠ¶æ€ä¿¡æ¯é€šè¿‡LSAæ•°æ®ç»“æ„è¿›è¡Œæè¿° </p><p>è·¯ç”±å™¨ä¹‹é—´ç›¸äº’äº¤æ¢é“¾è·¯å¥½çŠ¶æ€ä¿¡æ¯,æ„æˆLSDB(æ‹“æ‰‘æ•°æ®åº“ é“¾è·¯çŠ¶æ€æ•°æ®åº“)</p><p>è¿è¡Œspf  æ„å»ºspftree  è§¦å‘æ›´æ–°  éƒ¨åˆ†æœ‰ç•Œæ›´æ–°</p><p>OSPF ç»´æŠ¤ä¸‰å¼ è¡¨</p><p>1é‚»å±…è¡¨</p><p>2æ‹“æ‰‘è¡¨</p><p>3è·¯ç”±è¡¨   </p><p>å»ºç«‹é‚»å±…å…³ç³»ï¼Œç›¸äº’äº¤æ¢LSDBå»ºç«‹æ‹“æ‰‘è¡¨ï¼ˆç½‘ç»œåœ°å›¾ï¼‰ï¼ŒåŸºäºæ‹“æ‰‘è¡¨è¿è¡ŒSPFç®—æ³•ï¼Œé€‰æ‹©æœ€ä¼˜è·¯å¾„ï¼Œæ„å»ºè·¯ç”±è¡¨ã€‚</p><p><img src="/image/ccna/link-state_routing_protocels.png" alt="é“¾è·¯çŠ¶æ€å‹"></p><p>è¿è¡Œä¸¤æ¬¡SPFç®—æ³•ï¼Œç¬¬ä¸€æ¬¡æ„å»ºå…¨å±€æ‹“æ‰‘è¡¨ï¼Œå»æ‰ç¯è·¯ï¼Œç¬¬äºŒæ¬¡è¿è¡Œæ—¶åˆ é™¤æ¬¡ä¼˜è·¯å¾„ï¼Œæ„å»ºè·¯ç”±è¡¨ã€‚</p><p>OSPFç®—æ³•éœ€è¦rourte-idå”¯ä¸€æ ‡è¯†æ¯ä¸€å°è·¯ç”±å™¨</p><p>ä½¿ç”¨ç¯å›æ¥å£åšä¸ºroute-idçš„åŸå› æ˜¯ï¼š</p><p>ç¯å›æ¥å£å¹¶ä¸æ˜¯å®é™…é€šä¿¡æ¥å£ï¼ŒæŒ‡å®šèµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ã€‚ä¸€å°è·¯ç”±å™¨ä¸Šè‡³å°‘è¦æœ‰ä¸€ä¸ªIPæ‰èƒ½å¼€å¯OSPFç®—æ³•</p><p><img src="/image/ccna/link-state_routing_protocels_router_id.png.png" alt="é“¾è·¯çŠ¶æ€å‹"></p>]]></content>
    
    
    
    <tags>
      
      <tag>CCNA</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CCNA-ripåè®®</title>
    <link href="/2014/05/19/CCNA-rip%E5%8D%8F%E8%AE%AE/"/>
    <url>/2014/05/19/CCNA-rip%E5%8D%8F%E8%AE%AE/</url>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç¬”è®°ï¼Œæ¯”è¾ƒé›¶æ•£</p><span id="more"></span><h4 id="è·ç¦»çŸ¢é‡å‹è·¯ç”±é€‰æ‹©åè®®"><a href="#è·ç¦»çŸ¢é‡å‹è·¯ç”±é€‰æ‹©åè®®" class="headerlink" title="è·ç¦»çŸ¢é‡å‹è·¯ç”±é€‰æ‹©åè®®"></a>è·ç¦»çŸ¢é‡å‹è·¯ç”±é€‰æ‹©åè®®</h4><p>è·ç¦»&#x3D;è·³æ•°ï¼ˆç»è¿‡å‡ å±‚ä¸‰å±‚è®¾å¤‡ï¼Œä¸‰å±‚ä»¥ä¸‹ä¸ç®—ï¼Œæ²¡æœ‰è·¯ç”±ï¼‰</p><p>çŸ¢é‡&#x3D;å‡ºæ¥å£ï¼ˆæ–¹å‘ï¼‰</p><p>è·¯ç”±å™¨å‘¨æœŸæ€§çš„ä»æ¥å£å‘å¤–å‘é€æœ¬æœºçš„å®Œæ•´è·¯ç”±è¡¨</p><p>å¯¹äºripï¼Œå‘¨æœŸæ˜¯30ç§’</p><h4 id="é—®é¢˜-ç¼ºç‚¹"><a href="#é—®é¢˜-ç¼ºç‚¹" class="headerlink" title="é—®é¢˜ ç¼ºç‚¹"></a>é—®é¢˜ ç¼ºç‚¹</h4><p>æ ¹æ®è·³æ•°é€‰æ‹©ï¼Œä¸ç²¾ç¡®</p><p>ä¸ä¸€è‡´çš„è·¯ç”±ä¿¡æ¯ä¼šå¯¼è‡´è·¯ç”±ç¯è·¯</p><p>å¯¼è‡´è·¯ç”±ç¯è·¯çš„åŸå› ï¼š</p><p>æ›´æ–°ä¸åŒæ­¥ï¼ˆè·³æ•°åˆ°æ— ç©·å¤§ï¼Œå› æ­¤ï¼Œå®šä¹‰æœ€å¤§è·³æ•°15ï¼Œ16è·³ä¸ºä¸å¯è¾¾ï¼Œç¼ºç‚¹ï¼Œé™åˆ¶çš„æœ€å¤§ç½‘ç»œç›´å¾„ï¼‰</p><p>æ°´å¹³åˆ†å‰²ï¼Œsplit horizonï¼ˆæ°¸è¿œä¸ä¼šå°†è·¯ç”±ä¿¡æ¯ä»æ¥å—è¿™ä¸ªä¿¡æ¯çš„æ¥å£ä¸Šå‘é€å›å»ï¼‰</p><p>è·¯ç”±æ¯’åŒ–ï¼ˆroute poisoningï¼‰ç½‘ç»œdownæ‰ä¹‹åä¸æ˜¯ä»…ä»…å°†è·¯ç”±æ¡ç›®åˆ é™¤ï¼Œå¹¶ä¸”æŠŠå…¶åº¦é‡å€¼æ ‡è®°ä¸ºæ— é™å¤§ï¼ˆ16è·³ï¼‰ï¼Œé€šå‘Šç½‘ç»œï¼ˆç±»ä¼¼ä¸æ³›æ´ªè¿‡ç¨‹ï¼Œä¼šè¦†ç›–æ°´å¹³åˆ†å‰²æœºåˆ¶ï¼Œï¼‰</p><p>æ¯’æ€§é€†è½¬ </p><p>æŠ‘åˆ¶è®¡æ—¶å™¨ï¼ˆhold-down timerï¼‰ï¼šé˜²æ­¢å› æ›´æ–°ä¸åŒæ­¥å¼•èµ·çš„é—®é¢˜ï¼ˆæ¥æ”¶åˆ°æ¬¡ä¼˜è·¯ç”±ä¿¡æ¯ä¸ç«‹å³ç›¸ä¿¡ï¼‰</p><p>è§¦å‘æ›´æ–°ï¼ˆtriggered updatesï¼‰ç½‘ç»œæ‹“æ‰‘å‘ç”Ÿå˜åŠ¨æ—¶ï¼Œç«‹å³å‘é€æ›´æ–°ä¿¡æ¯ï¼Œä¸å¿…ç­‰å¾…è®¡æ—¶å™¨</p><h4 id="è·ç¦»çŸ¢é‡â€”â€”æ”¶æ•›è¿‡ç¨‹"><a href="#è·ç¦»çŸ¢é‡â€”â€”æ”¶æ•›è¿‡ç¨‹" class="headerlink" title="è·ç¦»çŸ¢é‡â€”â€”æ”¶æ•›è¿‡ç¨‹"></a>è·ç¦»çŸ¢é‡â€”â€”æ”¶æ•›è¿‡ç¨‹</h4><p>è·¯ç”±å™¨åœ¨æ²¡æœ‰é…ç½®åè®®çš„æ—¶å€™åªçŸ¥é“ç›´è¿çš„è·¯ç”±</p><p>è·¯ç”±å™¨ä»æ”¶é›†åˆ°çš„æºä¿¡æ¯ä¸­é€‰æ‹©åˆ°è¾¾ç›®æ ‡åœ°å€çš„æœ€ä½³è·¯å¾„</p><p>å¯¹æ¯”è‡ªå·±çš„è·¯ç”±è¡¨ï¼Œå°†æ²¡æœ‰çš„è·¯ç”±ä¿¡æ¯åŠ å…¥åˆ°è‡ªå·±çš„è·¯ç”±è¡¨ä¸­ï¼Œå¹¶ä¸”è·³æ•°åŠ 1ï¼Œå°†å­¦ä¹ åˆ°çš„è·¯ç”±å™¨åšä¸ºä¸‹ä¸€è·³çš„å‡ºæ¥å£</p><p>å­¦ä¹ åˆ°æ‰€æœ‰çš„è·¯ç”±ä¿¡æ¯æ‰ç®—æ”¶æ•›å®Œæˆ</p><p>è·¯ç”±å¤±æ•ˆ</p><p>å½“æœ‰ä¸€å°è·¯ç”±å™¨æŒ‚äº†ï¼Œä¸å…¶ç›´è¿çš„è·¯ç”±ä¼šå°†æ¥å£è·¯ç”±æ–°åˆ é™¤ï¼Œå¯¹äºå­¦ä¹ æ¥çš„è·¯ç”±ä¿¡æ¯ï¼Œä¼šåŠ ä¸Šå¤±æ•ˆè®¡æ—¶å™¨ï¼ˆ180ç§’ï¼Œå…­ä¸ªæ›´æ–°å‘¨æœŸï¼‰æ¯æ”¶åˆ°ä¸€ä¸ªæ›´æ–°ï¼Œå°±ä¼šé‡ç½®ã€‚å½“180ç§’ä¹‹åæ²¡æœ‰æ”¶åˆ°æ›´æ–°ï¼Œå°±ä¼šå°†æ¥å£ç½®ä¸ºpossible down</p><p>åˆ·æ–°è®¡æ—¶å™¨ï¼ˆ240ç§’ï¼‰è¿‡å»240ç§’ï¼Œåˆ é™¤</p><h4 id="Ripï¼ˆroute-information-protocolï¼‰"><a href="#Ripï¼ˆroute-information-protocolï¼‰" class="headerlink" title="Ripï¼ˆroute information protocolï¼‰"></a>Ripï¼ˆroute information protocolï¼‰</h4><p>è·ç¦»çŸ¢é‡å‹è·¯ç”±åè®®ï¼ˆåˆ¤æ–­æ–¹æ³•ï¼šæ˜¯å¦ç›´æ¥å‘é€è·¯ç”±ä¿¡æ¯ï¼‰</p><ul><li>RIPv1æ˜¯æœ‰ç±»åˆ«çš„ï¼ŒRIPv2æ˜¯æ— ç±»åˆ«çš„ï¼ŒRIPngæ˜¯IPv6ç‰ˆæœ¬</li><li>RIPä½¿ç”¨è·³æ•°ï¼ˆhopï¼šä¸‰å±‚è®¾å¤‡ï¼‰ä½œä¸ºåº¦é‡æ ‡å‡†</li><li>ä½¿ç”¨UDPåè®®ï¼Œç«¯å£å·520</li><li>å‘¨æœŸæ€§å‘é€æ›´æ–°ï¼ˆé»˜è®¤30ç§’ï¼‰</li><li>Ripv1ä½¿ç”¨å¹¿æ’­æ›´æ–°ï¼ˆ255.255.255.255ï¼‰</li><li>Ripv2ä½¿ç”¨ç»„æ’­æ›´æ–°ï¼ˆ224.0.0.9ï¼‰</li><li>RIPè®¡æ—¶å™¨ï¼šæ›´æ–°update-30sï¼Œå¤±æ•ˆinvalid-180sï¼ŒæŠ‘åˆ¶holddown-180sï¼Œåˆ·æ–°flush-240s</li></ul><h4 id="ripé…ç½®å‘½ä»¤"><a href="#ripé…ç½®å‘½ä»¤" class="headerlink" title="ripé…ç½®å‘½ä»¤"></a>ripé…ç½®å‘½ä»¤</h4><p>Route rip</p><p>Version 1</p><p>Network 10.0.0.0(ç›´è¿çš„ç½‘ç»œï¼Œåªå®£å‘Šä¸»ç±»ç½‘ç»œ)</p><p>Network 172.168.0.0ï¼ˆç›´è¿ç½‘ç»œï¼Œåªå®£å‘Šä¸»ç±»ç½‘ç»œï¼‰</p><p>No auto-summary</p><p>Clear ip route *   æ¸…ç©ºè·¯ç”±è¡¨</p><p>Show IP rip database  ï¼ˆçœ‹ripåº•å±‚æ•°æ®åº“ï¼‰</p><p>Debug IP  rip</p><p>æŠ–åŠ¨è®¡æ—¶å™¨ ï¼ˆä¸Šä¸‹æµ®åŠ¨15%ï¼‰ä¸ä¸€å®šæ˜¯ç²¾ç¡®çš„30ï¼Œé˜²æ­¢ç½‘ç»œæµé‡è¿‡å¤§</p><p>ä¸€ä¸ªripæ›´æ–°æœ€å¤šæºå¸¦25ä¸ªè·¯ç”±</p><p>è°ƒæ•´RIPé»˜è®¤è®¡æ—¶å™¨</p><p>ä¿®æ”¹è®¡æ—¶å™¨çš„ç›®çš„ä¸€èˆ¬æ˜¯ä¸ºäº†åŠ å¿«æ”¶æ•›é€Ÿåº¦,å¹¶ä¸”æ‰€æœ‰çš„è·¯ç”±è®¡æ—¶å™¨ä¸€å®šè¦ä¸€è‡´,ä¸€èˆ¬æƒ…å†µä¸‹ä¸è¦ä¿®æ”¹é»˜è®¤è®¡æ—¶å™¨,å¦åˆ™å¯èƒ½å¯¼è‡´ç”±äºæ›´æ–°æ—¶é—´å¯¼è‡´çš„è·¯ç”±ä¿¡æ¯ä¸ä¸€è‡´æƒ…å†µ</p><p>Timer basic 30 180 180 240</p><p>æ›´æ–°è®¡æ—¶å™¨  å¤±æ•ˆ  æŠ‘åˆ¶  åˆ·æ–°</p><p>åªæœ‰RIPv2æ”¯æŒè®¤è¯(åŠ å¯†)</p><p>å¯ç”¨æ˜æ–‡è®¤è¯ä¹‹å   åªèƒ½æºå¸¦24ä¸ªè·¯ç”±ä¿¡æ¯</p><p>å¯ç”¨md5è®¤è¯  åªèƒ½æºå¸¦ 23ä¸ªè·¯ç”±ä¿¡æ¯</p><p>åœ¨æ¥å£ä¸‹å¯ç”¨è®¤è¯</p><p>1   åˆ›å»ºå¯†é’¥æ•°æ®åº“</p><p>Key chain  æ•°æ®åº“åå­—</p><p>Key 1</p><p>Key-string å¯†ç   ç©ºæ ¼ä¹Ÿç®—</p><p>2  å¯åŠ¨å¯†é’¥è®¤è¯</p><p>IP rip authentication mode [text | md5]</p><p>3  æŒ‚è½½å¯†é’¥</p><p>Ip rip authentication key-chain å¯†é’¥é“¾ï¼ˆåå­—ï¼‰ ï¼ˆæŒ‚è½½å¯ä»¥ä¸ä¸€æ ·ï¼‰</p><p>RIPv2æ‰‹å·¥æ±‡æ€»</p><p>åªæ”¯æŒå­ç½‘æ±‡æ€»ï¼Œä¸æ”¯æŒè¶…ç½‘ï¼ˆä¸è¶…è¿‡ä¸»ç±»ç½‘çš„è¾¹ç•Œï¼‰æ±‡æ€»</p><p>åœ¨æ¥å£å¤„å¯ç”¨</p><p>Ip summary-address rip æ±‡æ€»åçš„IP  å­ç½‘æ©ç </p><p>å…³é—­æ°´å¹³åˆ†å‰²ï¼ˆno ip split-rizonï¼‰</p><p>æ°´å¹³åˆ†å‰²é»˜è®¤ç”Ÿæ•ˆ</p><p>RIpè¢«åŠ¨æ¥å£åŠå•æ’­æ›´æ–°</p><p>è¢«åŠ¨æ¥å£åªæ¥æ”¶ä¸å‘é€è·¯ç”±æ›´æ–°</p><p>Passive-interface </p><p>åªå‘æŒ‡å®šçš„è®¾å¤‡å‘é€è·¯ç”±æ›´æ–°(å•æ’­)</p><p>Neighbor  ipåœ°å€</p><p>ç„¶åé…ç½®ç¼ºçœè·¯ç”±ï¼Œè¾¾åˆ°éšè—ç½‘ç»œçš„åœ°å€</p><p>Ripv1  å’Œ  ripv2å¹¶å­˜ï¼ˆå…¼å®¹ä¸€äº›ä¸æ”¯æŒripv2çš„è€å¼è·¯ç”±å™¨ï¼‰</p><p>åœ¨æ¥å£ä¸ŠæŒ‡å®šå‘é€æ¥æ”¶ä»€ä¹ˆç‰ˆæœ¬çš„rip</p><p>Ip rip send version</p><p>Ip rip received version</p>]]></content>
    
    
    
    <tags>
      
      <tag>CCNA</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CCNA-é™æ€è·¯ç”±å’ŒåŠ¨æ€è·¯ç”±</title>
    <link href="/2014/05/19/CCNA-%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E5%92%8C%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1/"/>
    <url>/2014/05/19/CCNA-%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E5%92%8C%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1/</url>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç¬”è®°ï¼Œæ¯”è¾ƒé›¶æ•£</p><span id="more"></span><h4 id="é™æ€è·¯ç”±"><a href="#é™æ€è·¯ç”±" class="headerlink" title="é™æ€è·¯ç”±"></a>é™æ€è·¯ç”±</h4><h5 id="è·¯ç”±åŠŸèƒ½"><a href="#è·¯ç”±åŠŸèƒ½" class="headerlink" title="è·¯ç”±åŠŸèƒ½"></a>è·¯ç”±åŠŸèƒ½</h5><ul><li><p>è´Ÿè´£åœ¨ä¸åŒç½‘æ®µä¹‹é—´è¿›è¡Œæ•°æ®è½¬å‘(ä¸‰å±‚è·¯ç”±)</p></li><li><p>é€šè¿‡è·¯ç”±è¡¨è¿›è¡Œä¸‰å±‚æ•°æ®è½¬å‘(åŸºäºè·¯ç”±è¡¨)</p></li><li><p>ç»´æŠ¤è·¯ç”±è¡¨ä¿¡æ¯</p></li><li><p>åœ¨å†—ä½™è·¯å¾„ä¸­è¿›è¡Œæœ€ä¼˜è·¯å¾„åˆ¤æ–­</p></li><li><p>åœ¨ä¸‰å±‚è½¬å‘æ—¶åº”ç”¨ç‰¹å®šçš„è½¬å‘ç­–ç•¥</p></li></ul><h5 id="é™æ€è·¯ç”±-static-routes"><a href="#é™æ€è·¯ç”±-static-routes" class="headerlink" title="é™æ€è·¯ç”± static routes"></a>é™æ€è·¯ç”± static routes</h5><ul><li><p>ç®¡ç†å‘˜æ‰‹åŠ¨è¾“å…¥</p></li><li><p>å ç”¨è·¯ç”±å™¨èµ„æºå°</p></li><li><p>å¯ä»¥ä¸¥æ ¼æ§åˆ¶è·¯ç”±è½¬å‘</p></li><li><p>æ”¯æŒå¹¿æ³›</p></li><li><p>å‡ºç°ç½‘ç»œæ‹“æ‰‘å˜åŠ¨çš„æ—¶å€™æ— æ³•è‡ªåŠ¨æ›´æ–°</p></li><li><p>å½“ç½‘ç»œå¾ˆå¤§çš„æ—¶å€™ç®¡ç†å¤æ‚</p></li></ul><h5 id="é™æ€è·¯ç”±é…ç½®"><a href="#é™æ€è·¯ç”±é…ç½®" class="headerlink" title="é™æ€è·¯ç”±é…ç½®"></a>é™æ€è·¯ç”±é…ç½®</h5><p>åœ¨å…¨å±€é…ç½®æ¨¡å¼ä¸‹</p><p>Router(config)# Ip route network [mask]</p><p>(ç›®æ ‡ç½‘ç»œ   å­ç½‘æ©ç   ä¸‹ä¸€è·³å‡ºå£)</p><p>è·Ÿä¸‹ä¸€è·³å‡ºæ¥å£åœ¨ä¸€å®šæ¡ä»¶ä¸‹æœ‰å¤‡ä»½ä½œç”¨,å†—ä½™.</p><p>ç¼ºçœè·¯ç”±   0.0.0.0 0.0.0.0  </p><h5 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h5><p>å½“æˆ‘ä»¬æ‹¥æœ‰åˆ°è¾¾ç›®æ ‡ç½‘ç»œçš„å¤šä¸ªè·¯å¾„çš„æ—¶å€™,æˆ‘ä»¬å¯ä»¥é…ç½®ä¸­é—´çš„è·¯ç”±å™¨åœ¨è¿™äº›è·¯å¾„ä¸Šè¿›è¡Œè´Ÿè½½å‡è¡¡</p><p>åº•å±‚ç½‘ç»œçš„è´Ÿè½½å‡è¡¡:</p><p>1ã€åŸºäºæ•°æ®åŒ…</p><p>2ã€åŸºäºæ•°æ®æµ</p><h4 id="åŠ¨æ€è·¯ç”±"><a href="#åŠ¨æ€è·¯ç”±" class="headerlink" title="åŠ¨æ€è·¯ç”±"></a>åŠ¨æ€è·¯ç”±</h4><p>è·¯ç”±åè®®ç”¨åœ¨ä¸åŒè·¯ç”±å™¨ä¹‹é—´,ç”¨æ¥åˆ¤æ–­åˆ°è¿œç¨‹ç½‘ç»œçš„è·¯å¾„å¹¶ç»´æŠ¤è·¯ç”±å™¨çš„è·¯ç”±è¡¨</p><p>å½“è·¯å¾„å†³å®šä¹‹å,è·¯ç”±å™¨ä¼šå°†è¢«è·¯ç”±åè®®è½¬å‘åˆ°ç›®çš„ç½‘ç»œ</p><p>åŠ¨æ€è·¯ç”±åè®®æ˜¯è¿è¡Œåœ¨è·¯ç”±å™¨ä¸Šçš„ä¸€ä¸ªç¨‹åº,ç›¸åŒçš„åŠ¨æ€è·¯ç”±åè®®é€šè¿‡åœ¨ä¸åŒçš„è·¯ç”±å™¨ä¹‹é—´äº¤æ¢æ­¤åŠ¨æ€è·¯ç”±åè®®è§„å®šçš„æ•°æ®åŒ…æ¥äº¤æ¢å„è‡ªçš„è·¯ç”±ä¿¡æ¯,ä»è€Œè¾¾åˆ°å­¦ä¹ è·¯ç”±,ç»´æŠ¤è·¯ç”±è¡¨,å‘ç°æ‹“æ‰‘å˜åŠ¨çš„ç›®çš„.</p><h4 id="åŠ¨æ€è·¯ç”±åè®®åˆ†ç±»"><a href="#åŠ¨æ€è·¯ç”±åè®®åˆ†ç±»" class="headerlink" title="åŠ¨æ€è·¯ç”±åè®®åˆ†ç±»"></a>åŠ¨æ€è·¯ç”±åè®®åˆ†ç±»</h4><h5 id="æŒ‰åº”ç”¨èŒƒå›´åˆ†-IGP-amp-EGP-ç°åœ¨ä½¿ç”¨BGPv4"><a href="#æŒ‰åº”ç”¨èŒƒå›´åˆ†-IGP-amp-EGP-ç°åœ¨ä½¿ç”¨BGPv4" class="headerlink" title="æŒ‰åº”ç”¨èŒƒå›´åˆ† IGP &amp; EGP(ç°åœ¨ä½¿ç”¨BGPv4)"></a>æŒ‰åº”ç”¨èŒƒå›´åˆ† IGP &amp; EGP(ç°åœ¨ä½¿ç”¨BGPv4)</h5><p>IGPï¼ˆå†…éƒ¨ç½‘å…³åè®®ï¼‰åº”ç”¨äºæ™®é€šä¼ä¸š(åœ¨ä¸€ä¸ªè‡ªæ²»ç³»ç»Ÿ(as)ä¹‹å†…è·¯ç”±)</p><p>EGPï¼ˆå¤–éƒ¨ç½‘å…³åè®®ï¼‰è·¯ç”±æ•´ä¸ªäº’è”ç½‘(åœ¨å¤šä¸ªè‡ªæ²»ç³»ç»Ÿï¼ˆasï¼‰ä¹‹é—´è·¯ç”±)</p><p>è‡ªæ²»ç³»ç»Ÿautonomous systemæ˜¯å¤„åœ¨åŒä¸€ä¸ªç®¡ç†èŒƒå›´çš„ç½‘ç»œé›†åˆï¼ˆç®¡ç†èŒƒå›´æ¯”ç½‘ç»œèŒƒå›´å¤§ï¼‰</p><p>asæœ‰ä¸ªç¼–å· 0<del>65535    64512</del>65535æ˜¯ç§æœ‰çš„ï¼Œä¸èƒ½å‡ºç°åœ¨å…¬ç½‘ä¸­</p><h5 id="æŒ‰ç®—æ³•åˆ†"><a href="#æŒ‰ç®—æ³•åˆ†" class="headerlink" title="æŒ‰ç®—æ³•åˆ†"></a>æŒ‰ç®—æ³•åˆ†</h5><p>è·ç¦»çŸ¢é‡å‹ distance vectorï¼ˆè´å°”æ›¼ ç¦ç‰¹ï¼‰</p><p>é«˜çº§è·ç¦»çŸ¢é‡å‹  advanced distance vectorï¼ˆDUAL cisocç§æœ‰ï¼‰</p><p>é“¾è·¯çŠ¶æ€å‹link-stateï¼ˆSPF æœ€çŸ­è·¯å¾„ä¼˜å…ˆï¼‰</p><h4 id="Classful-roting-æœ‰ç±»åˆ«è·¯ç”±åè®®"><a href="#Classful-roting-æœ‰ç±»åˆ«è·¯ç”±åè®®" class="headerlink" title="Classful roting  æœ‰ç±»åˆ«è·¯ç”±åè®®"></a>Classful roting  æœ‰ç±»åˆ«è·¯ç”±åè®®</h4><p>æœ‰ç±»åˆ«è·¯ç”±é€‰æ‹©åè®®åœ¨è·¯ç”±æ›´æ–°ä¸­ä¸æºå¸¦å­ç½‘æ©ç </p><p>åœ¨ä¸€ä¸ªç½‘ç»œä¸­åªèƒ½ä½¿ç”¨ç›¸åŒçš„å­ç½‘æ©ç (ä¸æ”¯æŒä¸è¿ç»­çš„å­ç½‘)</p><p>åœ¨ä¸»ç±»ç½‘çš„è¾¹ç•Œä¼šè¿›è¡Œè‡ªåŠ¨æ±‡æ€»</p><p>å¸¸è§æœ‰ç±»åˆ«è·¯ç”±åè®®</p><p>1 ripv1</p><p>2 IGRP</p><h5 id="æœ‰ç±»åˆ«è·¯ç”±åè®®å­¦ä¹ è·¯ç”±çš„è§„åˆ™"><a href="#æœ‰ç±»åˆ«è·¯ç”±åè®®å­¦ä¹ è·¯ç”±çš„è§„åˆ™" class="headerlink" title="æœ‰ç±»åˆ«è·¯ç”±åè®®å­¦ä¹ è·¯ç”±çš„è§„åˆ™"></a>æœ‰ç±»åˆ«è·¯ç”±åè®®å­¦ä¹ è·¯ç”±çš„è§„åˆ™</h5><p>æœ‰ç±»åˆ«è·¯ç”±åè®®åœ¨æ›´æ–°æ—¶ä¸æºå¸¦å­ç½‘æ©ç ,åœ¨å­¦ä¹ è·¯ç”±è¿‡ç¨‹ä¸­:</p><p>1 é¦–å…ˆåˆ¤æ–­æ¥å£æ¥å—çš„è·¯ç”±ä¸æ¥å—æ¥å£é…ç½®çš„IPåœ°å€æ˜¯å¦å¤„äºåŒä¸€ä¸ªä¸»ç±»ç½‘.</p><p>2å¦‚æœå¤„äºåŒä¸€ä¸ªä¸»ç±»ç½‘,åˆ™ä½¿ç”¨æ¥å—æ¥å£é…ç½®çš„å­ç½‘æ©ç åšä¸ºæ¥å—è·¯ç”±çš„å­ç½‘æ©ç </p><p>3å¦‚æœæ¥æ”¶è·¯ç”±ä¸æ¥æ”¶æ¥å£é…ç½®çš„IPåœ°å€ä¸åœ¨åŒä¸€ä¸ªä¸»ç±»ç½‘ä¸­,åˆ™ä½¿ç”¨æ¥æ”¶è·¯ç”±è‡ªèº«æ‰€å±çš„ä¸»ç±»ç½‘å­ç½‘æ©ç ä½œä¸ºè¯¥è·¯ç”±å­ç½‘æ©ç (åœ¨ä¸»ç±»ç½‘è¾¹ç•Œå‡ºç°è‡ªåŠ¨æ±‡æ€»)</p><h4 id="Classlessrouting-æ— ç±»åˆ«è·¯ç”±åè®®"><a href="#Classlessrouting-æ— ç±»åˆ«è·¯ç”±åè®®" class="headerlink" title="Classlessrouting æ— ç±»åˆ«è·¯ç”±åè®®"></a>Classlessrouting æ— ç±»åˆ«è·¯ç”±åè®®</h4><p>åœ¨è·¯ç”±æ›´æ–°ä¸­æºå¸¦å­ç½‘æ©ç (CIDR æ— ç±»åˆ«åŸŸé—´è·¯ç”± classless Internet domain route)</p><p>æ”¯æŒVLSM,åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­å¯ä»¥æ‹¥æœ‰ä¸åŒçš„å­ç½‘æ©ç </p><p>åœ¨ç½‘ç»œä¸­æ”¯æŒæ‰‹å·¥æ±‡æ€»</p><p>å¸¸è§çš„æ— ç±»åˆ«è·¯ç”±é€‰æ‹©åè®®</p><p>RIPv2  EIGRP  OSPF ISIS  BGPv4</p><p>RIPv2å’ŒEIGRPé»˜è®¤ä¼šåœ¨ä¸»ç±»ç½‘è¾¹ç•Œè¿›è¡Œè‡ªåŠ¨æ±‡æ€»,éœ€è¦æ‰‹å·¥å…³é—­</p><h5 id="æœ€ä½³è·¯ç”±åˆ¤å®šæ ‡å‡†"><a href="#æœ€ä½³è·¯ç”±åˆ¤å®šæ ‡å‡†" class="headerlink" title="æœ€ä½³è·¯ç”±åˆ¤å®šæ ‡å‡†"></a>æœ€ä½³è·¯ç”±åˆ¤å®šæ ‡å‡†</h5><p>RIP  æ ¹æ®è·³æ•°ï¼ˆhop countï¼‰ï¼ˆç»è¿‡å‡ ä¸ªè·¯ç”±å™¨ï¼‰</p><p>OSPF æ ¹æ®å¸¦å®½ï¼ˆcostï¼‰çº¿è·¯çš„é€Ÿåº¦</p><p>å¸¦å®½ bandwidth</p><p>å»¶æ—¶ delay</p><p>å¯é æ€§  reliable</p><p>è´Ÿè½½ load</p><p>åº¦é‡å€¼ä¸èƒ½å˜</p><p><img src="/image/ccna/Classlessrouting_ad.png" alt="geocoderSearch"></p>]]></content>
    
    
    
    <tags>
      
      <tag>CCNA</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CCNA-ç½‘ç»œæ‹“æ‰‘ç»“æ„</title>
    <link href="/2014/05/19/CCNA-%E7%BD%91%E7%BB%9C%E6%8B%93%E6%89%91%E7%BB%93%E6%9E%84/"/>
    <url>/2014/05/19/CCNA-%E7%BD%91%E7%BB%9C%E6%8B%93%E6%89%91%E7%BB%93%E6%9E%84/</url>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç¬”è®°ï¼Œæ¯”è¾ƒé›¶æ•£</p><span id="more"></span><p>åœ¨è®¾è®¡ç½‘ç»œçš„æ—¶å€™ç”¨åˆ°qos</p><p>åœ¨å“ªäº›æ–¹é¢è¯„ä¼°ç½‘ç»œ</p><p>1 é€Ÿåº¦ ï¼ˆspeedï¼‰ï¼ˆè·¯ç”±å™¨å€Ÿå£é€Ÿåº¦å’ŒåŒ…è½¬å‘é€Ÿåº¦ï¼ˆPPs packet per secondï¼‰ï¼‰</p><p>2å¼€é”€ ï¼ˆcostï¼‰ï¼ˆé’±çš„å¤šå°‘ï¼‰</p><p>3å®‰å…¨ ï¼ˆsecurityï¼‰ï¼ˆæ™®é€šç½‘ç»œè·¯ç”±å°±è¡Œï¼‰</p><p>4æœ‰æ•ˆæ€§æ€§ ï¼ˆavailabilityï¼‰ï¼ˆè¦æ±‚æ•…éšœæ—¶é—´çŸ­ï¼ˆå¦‚è¯åˆ¸äº¤æ˜“ï¼‰ï¼‰</p><p>5å¯æ‰©å±•æ€§ï¼ˆscalabilityï¼‰ï¼ˆå…¬å¸çš„æ‰©å±•ï¼‰</p><p>6  å¯é æ€§ï¼ˆreliableï¼‰</p><p>7æ‹“æ‰‘ç»“æ„ï¼ˆtopologyï¼‰ï¼ˆåŒçº¿å¤‡ä»½ç­‰ï¼‰</p><p>ï¼ˆæ€»çº¿å‹  BUS Topologyï¼‰</p><p>ï¼ˆæ˜Ÿå½¢ star topologyï¼‰</p><p>ï¼ˆæ‰©å±•æ˜Ÿå½¢ï¼‰</p><p>ç¯å½¢ï¼ˆä»¤ç‰Œç¯ç½‘  ring topologyï¼‰</p><p>å…¨ç½‘äº’è”ï¼ˆæ¯ä¸ªäº¤æ¢æœºç›¸è¿ï¼‰ï¼ˆé«˜æˆæœ¬ï¼‰</p><p>éƒ¨åˆ†äº’è”</p><p>æ‰¹é‡å¼åº”ç”¨ç¨‹åºï¼ˆbatch applicationï¼‰</p><p>ç±»ä¼¼äºæ–‡ä»¶å…±äº«å’Œä¸‹è½½</p><p>å¦‚FTP  TFTP </p><p>æµé‡å¤§ï¼Œå¯¹å»¶æ—¶å’Œä¸¢åŒ…ä¸æ•æ„Ÿ</p><p>TCPåè®®å¯ä»¥é‡ä¼ è¾“</p><p>äº¤äº’å¼Interactive application</p><p>æµé‡å° å¯¹å»¶æ—¶æ•æ„Ÿ</p><p>å¦‚QQèŠå¤© ssh  mstsc</p><p>å®æ—¶åº”ç”¨ç¨‹åºï¼ˆreal-time applicationï¼‰</p><p>å¯¹å»¶æ—¶å’Œä¸¢åŒ…æ•æ„Ÿ</p><p>æ²¡æœ‰é‡ä¼ è¾“</p><p>å¦‚ é€šè¯å’Œè§†é¢‘ï¼ˆè¶…è¿‡150MS  å¯ä»¥æ„Ÿå—å‡ºæ¥ï¼‰</p><p>UDPåè®®</p>]]></content>
    
    
    
    <tags>
      
      <tag>CCNA</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CCNA-VLSMå­ç½‘åˆ’åˆ†</title>
    <link href="/2014/05/19/CCNA-VLSM%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86/"/>
    <url>/2014/05/19/CCNA-VLSM%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86/</url>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç¬”è®°ï¼Œæ¯”è¾ƒé›¶æ•£</p><span id="more"></span><p>è¿è¥å•†åˆ†é…äº†ä»€ä¹ˆç½‘æ®µ</p><p>åŸºäºéœ€æ±‚  åˆ¤æ–­éœ€è¦å€Ÿç”¨å¤šå°‘ä½ å­ç½‘ä¸­æœ‰å¤šå°‘ä¸»æœº</p><p>è¿›è¡Œè¿ç®—</p><p>exï¼š</p><p>IP address 192.168.221.38</p><p>Subnet mask 29 ï¼ˆ255.255.255.248ï¼‰</p><p>å±äºå“ªä¸ªå­ç½‘ï¼ˆ192.168.221.32ï¼‰</p><p>ç¬¬ä¸€ä¸ªå­ç½‘  192.168.221.32</p><p>ç¬¬ä¸€ä¸ªä¸»æœºIPåœ°å€ 192.168.221.33</p><p>æœ€åä¸€ä¸ªä¸»æœºIP 192.168.221.39</p><p>ä¸‹ä¸€ä¸ªå­ç½‘  192.168.221.40</p><p><img src="/image/ccna/VLSM_classA.png" alt="VLSM-classA"></p><p><img src="/image/ccna/VLSM_classB.png" alt="VLSM-classB"></p><p><img src="/image/ccna/VLSM_classC.png" alt="VLSM-classC"></p><p>å­ç½‘åˆ’åˆ†å¸¦æ¥çš„ï¼š</p><p>è·¯ç”±æ±‡æ€» </p><p>å¤šå‡ºå¾ˆå¤šç½‘æ®µ  éœ€è¦è·¯ç”±è½¬å‘  éœ€è¦è·¯ç”±è¡¨</p><p>å ç”¨è¾ƒå¤šçš„å†…å­˜  </p><p>è·¯ç”±è½¬å‘æ•°æ®   åªåŒ¹é…å­ç½‘æ©ç è§„å®šçš„ä½æ•°</p><p> æ¯”å¯¹æœ€é•¿çš„ï¼ˆæœ€ç²¾ç¡®åŒ¹é…ï¼‰</p><p>è·¯ç”±æ±‡æ€»  å‡å°‘æ£€æµ‹çš„å­ç½‘æ©ç ä½æ•°</p><p>æ ¹æ®å®é™…æƒ…å†µç¡®å®šæ˜¯å¦éœ€è¦ç¦æ­¢æ±‡æ€»è·¯ç”±</p><p>è·¯ç”±æ±‡æ€»å¸¦æ¥çš„ï¼š</p><p>1å‡å°‘è·¯ç”±è¡¨æ¡ç›®</p><p>2éšè—æ‹“æ‰‘å˜åŠ¨</p><p>-1ç”±äºæ±‡æ€»  å‡å°‘äº†åŒ¹é…ä½æ•°   å¯¹äºä¸è¿ç»­çš„ç½‘æ®µ å¯èƒ½å¯¼è‡´ æ•°æ®è½¬å‘é”™è¯¯</p>]]></content>
    
    
    
    <tags>
      
      <tag>CCNA</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CCNA-æ•°æ®åŒ…å‘é€æµç¨‹åŠç½‘ç»œç›¸å…³å‘½ä»¤</title>
    <link href="/2014/05/19/CCNA-%E6%95%B0%E6%8D%AE%E5%8C%85%E5%8F%91%E9%80%81%E6%B5%81%E7%A8%8B%E5%8F%8A%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/"/>
    <url>/2014/05/19/CCNA-%E6%95%B0%E6%8D%AE%E5%8C%85%E5%8F%91%E9%80%81%E6%B5%81%E7%A8%8B%E5%8F%8A%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç¬”è®°ï¼Œæ¯”è¾ƒé›¶æ•£</p><span id="more"></span><p>åŒä¸€ä¸ªç½‘æ®µ:</p><p>åº”ç”¨ç¨‹åºäº§ç”Ÿæ•°æ®  ä¼ ç»™IPå±‚(åˆ¤æ–­æ˜¯å¦å¤„äºåŒä¸€ä¸ªç½‘æ®µ  å°è£…)  äºŒå±‚MAC(å°è£…   æŸ¥æœ¬æœºçš„ARPè¡¨ï¼ˆMACè¡¨) æ²¡æœ‰çš„è¯,ç”¨ARPåè®®   ï¼ˆè¦æœ‰æºMACå’Œç›®æ ‡MACï¼‰)</p><p>ä¸»è¦å°±æ˜¯å°è£…å’ŒèŠ‚å°è£…çš„è¿‡ç¨‹</p><p>å°è£…è¿›å»çš„ä¿¡æ¯ä¸»è¦æ˜¯æºå’Œç›®æ ‡çš„IPåœ°å€å’ŒMACåœ°å€</p><p>å¤„äºä¸åŒçš„ç½‘æ®µçš„æ—¶å€™   è·¯ç”±å™¨å…ˆå‘é€ç»™ç½‘å…³   ç½‘å…³é€šè¿‡è·¯ç”±è¡¨è¿›è¡Œæ¯”è¾ƒè½¬å‘ ä¸‹åŒ  åªæ˜¯æºIPæ˜¯ç½‘å…³çš„åœ°å€</p><p>Ping å‘½ä»¤</p><table><thead><tr><th>-t</th><th>æŒç»­pingç›®æ ‡ä¸»æœºç›´åˆ°æ¥æ”¶åˆ°åœæ­¢ä¿¡å·</th></tr></thead><tbody><tr><td>-a</td><td>å°†ç›®æ ‡IPåœ°å€è§£ææˆä¸»æœºå</td></tr><tr><td>-n</td><td>å¯¹ç›®æ ‡ä¸»æœºçš„pingçš„æ¬¡æ•°</td></tr><tr><td>-l</td><td>pingåŒ…çš„å¤§å°</td></tr><tr><td>-f</td><td>è®¾ç½®IPåŒ…çš„DFä½</td></tr></tbody></table><p>Nslookup</p><p>ï¼´ï½’ï½ï½ƒï½…ï½’ï½”</p><table><thead><tr><th>-d</th><th>ä¸è¿›è¡ŒIPåˆ°ä¸»æœºåçš„è§£æ</th></tr></thead><tbody><tr><td>-h</td><td>æœç´¢æœ€å¤§çš„è·³æ•°</td></tr><tr><td>-w</td><td>è¶…æ—¶æ—¶é—´</td></tr></tbody></table><p>Route print</p><p>Route add</p><p>Route change</p><p>Route delete</p><p>Arp</p><table><thead><tr><th>ï¼ï½“</th><th>ç»‘å®šé™æ€ARP</th></tr></thead><tbody><tr><td>ï¼ï½„</td><td>åˆ é™¤ARPä¿¡æ¯</td></tr><tr><td>-a</td><td>æ˜¾ç¤ºæ‰€æœ‰çš„ARPä¿¡æ¯</td></tr></tbody></table><p>Ipconfig</p><table><thead><tr><th>&#x2F;all</th><th>æ˜¾ç¤ºæ‰€æœ‰é€‚é…å™¨çš„TCP&#x2F;IPé…ç½®</th></tr></thead><tbody><tr><td>&#x2F;renew</td><td>æ›´æ–°é€‚é…å™¨çš„DHCPé…ç½®</td></tr><tr><td>&#x2F;release</td><td>æ›´æ–°DHCPç§Ÿçº¦æœŸ</td></tr><tr><td>&#x2F;displaydns</td><td>æ˜¾ç¤ºDNSç¼“å­˜ä¿¡æ¯</td></tr></tbody></table><p>Netstat</p><table><thead><tr><th>ï¼ï½</th><th>æ˜¾ç¤ºæ‰€æœ‰è¿æ¥åŠç›‘å¬ç«¯å£</th></tr></thead><tbody><tr><td>ï¼ï½</td><td>ä¸è¿›è¡ŒIPåˆ°ä¸»æœºåçš„è§£æ</td></tr><tr><td>ï¼ï½</td><td>åªæ˜¾ç¤ºæŒ‡å®šçš„åè®®</td></tr><tr><td>ï¼ï½“</td><td>æ˜¾ç¤ºæ¯ä¸ªåè®®çš„çŠ¶æ€</td></tr><tr><td>ï¼ï½…</td><td>æ˜¾ç¤ºä»¥å¤ªç½‘ä¿¡æ¯</td></tr></tbody></table>]]></content>
    
    
    
    <tags>
      
      <tag>CCNA</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CCNA-OSIæ¨¡å‹</title>
    <link href="/2014/05/19/CCNA-OSI%E6%A8%A1%E5%9E%8B/"/>
    <url>/2014/05/19/CCNA-OSI%E6%A8%A1%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<p>åªæ˜¯å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç¬”è®°ï¼Œè¾ƒä¸ºé›¶æ•£ï¼Œ</p><span id="more"></span><h4 id="ä¸ƒå±‚ä»‹ç»"><a href="#ä¸ƒå±‚ä»‹ç»" class="headerlink" title="ä¸ƒå±‚ä»‹ç»"></a>ä¸ƒå±‚ä»‹ç»</h4><p>7  application</p><p>6  presentation</p><p>5  session</p><p>4  transport</p><p>3  network</p><p>2  data link</p><p>1  physical</p><p>ä¼˜ç‚¹ï¼šæµæ°´åŒ–ä½œä¸š</p><p>æ ‡å‡†åŒ–å€Ÿå£ æ¨¡å—ç‹¬ç«‹</p><p>ç‰©ç†å±‚ï¼š åº•å±‚æ•°æ®ä¼ è¾“ ï¼ˆæ–¹å¼æ ‡å‡†ç­‰ï¼‰</p><p>æ•°æ®é“¾è·¯å±‚ï¼šæ•°æ®çš„åŸºæœ¬æ ¼å¼ä»¥åŠæ•°æ®åœ¨ç”µç¼†ä¸Šçš„ä¼ è¾“ï¼Œå¦‚ä½•è®¿é—®åº•å±‚ä»‹è´¨</p><p>ç½‘ç»œå±‚ï¼šä¸‰å±‚IPç¼–å€å’Œè·¯ç”±</p><p>ä¼ è¾“å±‚ï¼šç«¯åˆ°ç«¯é€šä¿¡çš„åŠŸèƒ½  TCP UDP å®šä¹‰æºå’Œç›®æ ‡ä¹‹é—´å¦‚ä½•ä¼ è¾“æ•°æ®ä»¥åŠä¿è¯ä¼ è¾“çš„å¯é æ€§ã€‚</p><p>ä¼šè¯å±‚ï¼š</p><p>è¡¨ç¤ºå±‚ï¼šæ•°æ®æ ¼å¼ï¼ˆè§†é¢‘æ ¼å¼ï¼šaviä»€ä¹ˆçš„ï¼‰ï¼Œæä¾›åŸºæœ¬å‹ç¼©å’ŒåŠ å¯†åŠŸèƒ½</p><p>åº”ç”¨å±‚ï¼šåº”ç”¨è½¯ä»¶</p><p>æ•°æ®å°è£…ï¼šdata encapsulation</p><p>æ•°æ®ç”±åº”ç”¨ç¨‹åºäº§ç”Ÿï¼ˆå¦‚QQèŠå¤©ï¼‰</p><p>æ¯å±‚çš„ä¿¡æ¯ä¿å­˜åœ¨æŠ¥å¤´é‡Œé¢ï¼ˆHDR&#x3D;headerï¼‰</p><p>æ•°æ®è§£å°è£…ï¼šdata de-encapsulation</p><p>é€æ¸åˆ†ææŠ¥å¤´ã€‚</p><p>ä¼ è¾“å±‚ï¼šæ®µ segment</p><p>ç½‘ç»œå±‚ï¼šåŒ… packets</p><p>æ•°æ®é“¾è·¯å±‚ï¼š ä¾¦ frames</p><p>ç‰©ç†å±‚ï¼šæ¯”ç‰¹æµ bits</p><h4 id="æ•°æ®é“¾è·¯å±‚"><a href="#æ•°æ®é“¾è·¯å±‚" class="headerlink" title="æ•°æ®é“¾è·¯å±‚"></a>æ•°æ®é“¾è·¯å±‚</h4><p>æ•°æ®é“¾è·¯å±‚èŠ‚ç”µç¼†ï¼šä¸»è¦æ˜¯äº¤æ¢æœºï¼Œç½‘å¡ï¼Œæ—©æœŸè¿˜æœ‰ç½‘æ¡¥ã€‚</p><p>lanï¼šlocal area network</p><p>çŸ­è·ç¦» ç›´æ¥ç›¸è¿</p><p>å…±äº«å‹ç½‘ç»œï¼ˆä»‹è´¨å…±äº«ï¼‰</p><p>Mac åœ°å€ï¼š48bit  (å›ºåŒ–åœ°å€ï¼Œä¿å­˜åœ¨ç½‘å¡çš„romé‡Œé¢ï¼Œä¸å¯ä»¥æ”¹å˜)</p><p>24bitç»„ç»‡å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆå“ªä¸€ä¸ªå…¬å¸ï¼‰ï¼ˆouiï¼‰24bitå‚å•†ç”Ÿäº§çš„è®¾å¤‡ï¼ˆvendor   </p><p>assignedï¼‰</p><p>ä¸€ä¸ªç½‘æ®µå†…æ˜¯é€šè¿‡macåœ°å€è¿›è¡Œé€šä¿¡</p><p>è½½æ³¢ç›‘å¬å¤šè·¯è®¿é—®&#x2F;å†²çªæ£€æµ‹ï¼ˆcsma&#x2F;cdï¼‰æœ‰çº¿</p><p>è½½æ³¢ç›‘å¬å¤šè·¯è®¿é—®&#x2F;å†²çªé¿å…ï¼ˆcsma&#x2F;caï¼‰æ— çº¿</p><p>netsh wlan set hostednetwork mode&#x3D;allow</p><p>netsh wlan set hostednetwork ssid&#x3D;AA key&#x3D;12345678 </p><p>netsh wlan start hostednetwork</p><h4 id="ç½‘ç»œå±‚"><a href="#ç½‘ç»œå±‚" class="headerlink" title="ç½‘ç»œå±‚"></a>ç½‘ç»œå±‚</h4><p>macç¼–å€çš„é—®é¢˜ï¼šæ²¡æœ‰å±‚æ¬¡åŒ–ï¼Œæ‰€æœ‰è®¾å¤‡å¤„åœ¨ä¸€ä¸ªå¹¿æ’­åŸŸï¼ˆå•æ’­ç»„æ’­å¹¿æ’­ï¼‰è®¾å¤‡çš„æŸ¥æ‰¾æ¯”è¾ƒå›°éš¾ï¼ˆå»æ‰¾å¼ ä¸‰ï¼‰éš¾ä»¥å¯¹è®¾å¤‡åŒºåˆ†åº”ç”¨ç­–ç•¥</p><p>ç½‘ç»œå±‚ï¼šIPç¼–å€å’Œè·¯ç”±åŠŸèƒ½</p><p>IPåè®®ï¼šç½‘ç»œåˆ’åˆ†ï¼Œä¾¿äºæŸ¥æ‰¾ï¼ˆåœ°åŒºçš„åˆ’åˆ†ï¼‰ä¾¿äºå®šä½</p><p>32ä½ï¼ˆç½‘ç»œåœ°å€ ä¸»æœºåœ°å€ï¼‰é¢å‘éè¿æ¥çš„ç¼–å€ï¼ˆåŒºåˆ«äºæºå’Œç›®æ ‡åœ¨ä¼ è¾“æ•°æ®ä¹‹å‰æ˜¯å¦éœ€è¦ä¸€å®šçš„è¿æ¥ï¼‰</p><p>IPåè®®æ˜¯å°½åŠ›è€Œä¸ºçš„åè®®ï¼Œä¸ä¿è¯ä¼ è¾“çš„çš„å¯é æ€§ï¼Œæ²¡æœ‰æ•°æ®æ¢å¤æœºåˆ¶ï¼ˆæ²¡æœ‰é‡å¤å‘é€ï¼‰</p><p>ä¸åŒç½‘ç»œä¹‹é—´é€šä¿¡å¿…é¡»è¦æœ‰è·¯ç”±ï¼ˆåŒä¸€ä¸ªç½‘æ®µpsï¼‰ï¼šé€šè¿‡è·¯ç”±è¡¨çš„è®°å½•ï¼Œåœ¨ä¸åŒçš„ç½‘æ®µä¹‹é—´ç›¸äº’è½¬å‘æ•°æ®ã€‚</p><p>ä¸»æœºéƒ¨åˆ†å…¨ä¸º0çš„æ˜¯ç½‘ç»œåœ°å€ å…¨ä¸º1æ˜¯å¹¿æ’­åœ°å€ </p><p>Aç±»10.0.0.0   â€”â€” 10.255.255.255</p><p>Bç±»172.16.0.0  â€”â€” 172.31.255.255</p><p>Cç±»192.168.0.0  â€”â€” 192.168.255.255</p><p>ç§æœ‰åœ°å€  ä½™ä¸‹çš„æ˜¯å…±æœ‰åœ°å€</p><p>DHCP åŠ¨æ€ä¸»æœºé…ç½®åè®®</p><p>DNS  åŸŸåè§£ææœåŠ¡</p><p>ARPï¼ˆåŒä¸€å±‚ï¼‰åœ°å€è§£æåè®®</p><p>ICMP  Internetæ§åˆ¶æŠ¥æ–‡åè®®  ç”¨æ¥è¿”å›é”™è¯¯æ¶ˆæ¯ï¼ˆç›®æ ‡ä¸»æœºä¸å¯è¾¾ï¼Œæ•°æ®æŸåï¼‰</p><h4 id="ä¼ è¾“å±‚"><a href="#ä¼ è¾“å±‚" class="headerlink" title="ä¼ è¾“å±‚"></a>ä¼ è¾“å±‚</h4><p>ä¼ è¾“å±‚ ï¼šç«¯åˆ°ç«¯çš„é€šä¿¡  ä¿è¯ä¼ è¾“çš„å¯é æ€§  æ¯”å¦‚å·®é”™æ¢å¤æœºåˆ¶</p><p>ä¼šè¯çš„å¤šè·¯å¤ç”¨</p><p>å¯¹æ•°æ®è¿›è¡Œåˆ†æ®µ</p><p>æµæ§æœºåˆ¶ï¼ˆç½‘ç»œæ‹¥å¡ å‡å°‘æµé‡ï¼‰</p><p>é¢å‘è¿æ¥çš„åè®®</p><p>1ã€å¤šè·¯å¤ç”¨ï¼Œä¸€ä¸ªåè®®å¯èƒ½ä¸ºå¤šä¸ªä¸Šå±‚åè®®æä¾›ç»Ÿä¸€çš„æœåŠ¡</p><p>é€šè¿‡ç«¯å£å·   åŒºåˆ†ä¸Šå±‚çš„åº”ç”¨ç¨‹åº</p><p>2 tcpï¼ˆå¯é çš„  ä½†æ•ˆç‡ä½ï¼‰å·¥ä½œåœ¨ç¬¬å››å±‚  æä¾›è®¿é—®ç½‘ç»œå±‚çš„åŠŸèƒ½  æ²¡æœ‰æ•°æ®æ¢å¤  é¢å‘è¿æ¥  å…¨åŒå·¥  å·®é”™æ ¡éªŒ æ•°æ®åºåˆ—å·æ ‡è¯†   ä¿è¯æ•°æ®çš„å¯é ä¼ è¾“   æœ‰ç¡®è®¤  å·®é”™æ¢å¤æœºåˆ¶</p><p>ä¸‰æ¬¡æ¡æ‰‹ï¼šAè¯·æ±‚å»ºç«‹è¿æ¥åŒæ—¶åå•†æŸäº›çŠ¶æ€ï¼ˆSYNï¼‰  Bè¿”å›ä¿¡æ¯ã€€ã€€ã€€Aã€€ç¡®å®šã€€ã€€ã€€ã€€æ•´ä¸ªè¿æ¥å»ºç«‹</p><p>æµæ§æœºåˆ¶</p><p>3udpï¼ˆç±»ä¼¼äºIP  å°½åŠ›è€Œä¸ºï¼Œä¸ä¿è¯å¯é æ€§ éé¡ºåº  æ•ˆç‡é«˜ï¼‰é¢å‘éè¿æ¥ï¼ˆä¼ è¾“ä¹‹å‰æ²¡æœ‰åå•†ï¼Œä¸ä¿è¯ä¼ è¾“çš„å¯é æ€§ï¼‰</p>]]></content>
    
    
    
    <tags>
      
      <tag>CCNA</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sublime text 2 æ­å»ºjavaè¿è¡Œç¯å¢ƒ</title>
    <link href="/2014/05/18/sublime-text-2-%E6%90%AD%E5%BB%BAjava%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83/"/>
    <url>/2014/05/18/sublime-text-2-%E6%90%AD%E5%BB%BAjava%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83/</url>
    
    <content type="html"><![CDATA[<p>åˆšå¼€å§‹å­¦javaï¼Œåœ¨windowsä¸‹å†™ä»£ç çš„æ—¶å€™ç”¨sublime2å†™çš„ï¼Œæ£é¼“äº†ä¸€ä¸‹ç¯å¢ƒï¼Œå¯ä»¥è¿›è¡Œä¸€é”®ç¼–è¯‘<br>éœ€è¦çš„ææ–™ï¼š</p><ol><li>å®‰è£…å¥½çš„ST2<br>2ï¼‰javaè¿è¡Œç¯å¢ƒ<span id="more"></span></li></ol><h4 id="åˆ›å»ºæ‰¹å¤„ç†æˆ–Bash-Shellè„šæœ¬æ–‡ä»¶"><a href="#åˆ›å»ºæ‰¹å¤„ç†æˆ–Bash-Shellè„šæœ¬æ–‡ä»¶" class="headerlink" title="åˆ›å»ºæ‰¹å¤„ç†æˆ–Bash Shellè„šæœ¬æ–‡ä»¶"></a>åˆ›å»ºæ‰¹å¤„ç†æˆ–Bash Shellè„šæœ¬æ–‡ä»¶</h4><p>æ‰“å¼€ä»»æ„çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œè¾“å…¥ä¸‹é¢çš„å†…å®¹ï¼Œå¹¶ä¿å­˜ä¸ºrunJava.batæ–‡ä»¶<br>ä»£ç å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">@ECHOÂ OFFÂ Â <br><span class="hljs-built_in">cd</span>Â %~dp1Â Â <br>ECHOÂ CompilingÂ %~nx1.......Â Â <br>IFÂ EXISTÂ %~n1.classÂ (Â Â <br>DELÂ %~n1.classÂ Â <br>)Â Â <br>javacÂ %~nx1Â Â <br>IFÂ EXISTÂ %~n1.classÂ (Â Â <br>ECHOÂ -----------OUTPUT-----------Â Â <br>javaÂ %~n1Â Â <br>) Â <br></code></pre></td></tr></table></figure><p>å¦‚æœæ˜¯åœ¨Windowsä¸‹ç¼–è¯‘æç¤º  ä¸æ˜¯utf-8ç¼–ç ä»€ä¹ˆçš„è¯ï¼Œåˆ™å°†ä¸Šè¯‰ä»£ç ä¿®æ”¹å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">@ECHOÂ OFFÂ Â <br><span class="hljs-built_in">cd</span>Â %~dp1Â Â <br>ECHOÂ CompilingÂ %~nx1.......Â Â <br>IFÂ EXISTÂ %~n1.classÂ (Â Â <br>DELÂ %~n1.classÂ Â <br>)Â Â <br>javacÂ -encodingÂ UTF-8Â %~nx1Â Â <br>IFÂ EXISTÂ %~n1.classÂ (Â Â <br>ECHOÂ -----------OUTPUT-----------Â Â <br>javaÂ %~n1Â Â <br>) <br></code></pre></td></tr></table></figure><p><img src="/image/sublime/runJavaBat.png" alt="geocoderSearch"></p><p>å°†è¿™ä¸ªæ–‡ä»¶æ”¾åˆ°JDKçš„binæ–‡ä»¶å¤¹ä¸‹</p><h4 id="åœ¨Sublime-Text-2ç¼–è¾‘å™¨ä¸­é…ç½®ç›¸åº”çš„Javaæ„å»ºç¯å¢ƒ"><a href="#åœ¨Sublime-Text-2ç¼–è¾‘å™¨ä¸­é…ç½®ç›¸åº”çš„Javaæ„å»ºç¯å¢ƒ" class="headerlink" title="åœ¨Sublime Text 2ç¼–è¾‘å™¨ä¸­é…ç½®ç›¸åº”çš„Javaæ„å»ºç¯å¢ƒ"></a>åœ¨Sublime Text 2ç¼–è¾‘å™¨ä¸­é…ç½®ç›¸åº”çš„Javaæ„å»ºç¯å¢ƒ</h4><p>æ‰“å¼€Sublimeçš„åŒ…ç›®å½•ï¼Œä½¿ç”¨èœå•Perferences-&gt;Browse Packages<br><img src="/image/sublime/browePackages.png" alt="geocoderSearch"><br>é€‰æ‹©Javaç›®å½•<br><img src="/image/sublime/javacSublimeBuild.png" alt="geocoderSearch"><br>æ‰“å¼€JavaC.sublime-buildï¼Œå¹¶ä¿®æ”¹ä¸‹é¢çš„è¡Œ<br><img src="/image/sublime/before_modify.png" alt="geocoderSearch"><br><img src="/image/sublime/afterModify.png.png" alt="geocoderSearch"></p><p>ç”»çº¢æ¡†çš„æ˜¯ä¿®æ”¹å®Œä¹‹åçš„ã€‚<br>ç„¶å Ctrl+s ä¿å­˜ä¸€ä¸‹å°±å¥½äº†ã€‚<br>å†™å®Œjavaä»£ç ä¹‹åï¼ŒCtrl+s ä¿å­˜ä¸€ä¸‹ï¼Œç„¶åCtrl+B å°±å¯ä»¥ç¼–è¯‘è¿è¡Œäº†ã€‚ã€‚ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    
    <tags>
      
      <tag>sublime</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
