<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æ”¾ç è¿‡æ¥</title>
  <icon>https://www.gravatar.com/avatar/771a5b96a1b55228dbb1eeb23619ef45</icon>
  <subtitle>æŠ€æœ¯å®… huangyuan@huangyuanlove.com</subtitle>
  <link href="https://blog.huangyuanlove.com/atom.xml" rel="self"/>
  
  <link href="https://blog.huangyuanlove.com/"/>
  <updated>2024-05-14T11:04:23.455Z</updated>
  <id>https://blog.huangyuanlove.com/</id>
  
  <author>
    <name>HuangYuan_xuan</name>
    <email>huangyuan@huangyuanlove.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>kotlinæ³›å‹:é€†å˜ä¸åå˜</title>
    <link href="https://blog.huangyuanlove.com/2024/04/30/kotlin%E6%B3%9B%E5%9E%8B-%E9%80%86%E5%8F%98%E4%B8%8E%E5%8D%8F%E5%8F%98/"/>
    <id>https://blog.huangyuanlove.com/2024/04/30/kotlin%E6%B3%9B%E5%9E%8B-%E9%80%86%E5%8F%98%E4%B8%8E%E5%8D%8F%E5%8F%98/</id>
    <published>2024-04-30T02:59:38.000Z</published>
    <updated>2024-05-14T11:04:23.455Z</updated>
    
    <content type="html"><![CDATA[<p>æ³›å‹ä¸­æ¶‰åŠåˆ°çš„æ¦‚å¿µä¹Ÿä¸å°‘,å‹å˜(Variance)ã€é€†å˜(Contravariance)ã€åå˜(Covariance)ã€ä¸å˜(Invariant).åœ¨ kotlin ä¸­è¿˜æœ‰ä¸‰ä¸ªå…³é”®å­—<code>in</code>ã€<code>out</code>ã€<code>where</code>ã€<code>reified</code>ç­‰,åœ¨javaä¸­åŒæ ·ä¹Ÿæœ‰<code>? extends</code>ã€<code>? super</code>ã€<code>?</code><br>è¿™äº›æ¦‚å¿µæ˜¯å•¥æ„æ€å˜ï¼Ÿå¼•ç”¨ç‚¹æ¦‚å¿µè¯´æ˜</p><blockquote><p>å‹å˜(Variance)ã€åå˜(Covariance)ã€é€†å˜(Contravariance)å’Œä¸å˜(Invariant)æ˜¯ç›¸å…³ä½†ä¸åŒçš„æ¦‚å¿µ.</p></blockquote><blockquote><p>å‹å˜æ˜¯æŒ‡æ³›å‹ç±»å‹å‚æ•°åœ¨å­ç±»å‹å…³ç³»ä¸­çš„è¡Œä¸º.å®ƒæè¿°äº†ä¸€ä¸ªæ³›å‹ç±»å‹æ˜¯å¦å…è®¸ç±»å‹å‚æ•°çš„å­ç±»å‹å…³ç³»ä¸æ³›å‹ç±»å‹å‚æ•°çš„å­ç±»å‹å…³ç³»ä¿æŒä¸€è‡´.åœ¨æ³›å‹ä¸­,å¯ä»¥æœ‰ä¸‰ç§å‹å˜ç±»å‹ï¼šåå˜ã€é€†å˜å’Œä¸å˜.</p></blockquote><blockquote><p>åå˜æ˜¯æŒ‡å¦‚æœä¸€ä¸ªæ³›å‹ç±»å‹çš„å­ç±»å‹å…³ç³»ä¸å…¶ç±»å‹å‚æ•°çš„å­ç±»å‹å…³ç³»ä¿æŒä¸€è‡´,åˆ™è¯¥æ³›å‹ç±»å‹æ˜¯åå˜çš„.ç®€è€Œè¨€ä¹‹,å¦‚æœå­ç±»å‹çš„æ³›å‹å‚æ•°æ˜¯çˆ¶ç±»å‹æ³›å‹å‚æ•°çš„å­ç±»å‹,å°±å¯ä»¥è¯´è¯¥æ³›å‹ç±»å‹æ˜¯åå˜çš„.</p></blockquote><blockquote><p>é€†å˜æ˜¯æŒ‡å¦‚æœä¸€ä¸ªæ³›å‹ç±»å‹çš„å­ç±»å‹å…³ç³»ä¸å…¶ç±»å‹å‚æ•°çš„å­ç±»å‹å…³ç³»ç›¸å,åˆ™è¯¥æ³›å‹ç±»å‹æ˜¯é€†å˜çš„.ç®€è€Œè¨€ä¹‹,å¦‚æœå­ç±»å‹çš„æ³›å‹å‚æ•°æ˜¯çˆ¶ç±»å‹æ³›å‹å‚æ•°çš„è¶…ç±»å‹,å°±å¯ä»¥è¯´è¯¥æ³›å‹ç±»å‹æ˜¯é€†å˜çš„.</p></blockquote><blockquote><p>ä¸å˜æ˜¯æŒ‡ä¸€ä¸ªæ³›å‹ç±»å‹çš„å­ç±»å‹å…³ç³»ä¸å…¶ç±»å‹å‚æ•°æ— å…³,å³ç±»å‹å‚æ•°çš„å­ç±»å‹å…³ç³»ä¸æ³›å‹ç±»å‹çš„å­ç±»å‹å…³ç³»æ— å…³.åœ¨ä¸å˜çš„æƒ…å†µä¸‹,ä¸èƒ½å°†çˆ¶ç±»å‹çš„å¯¹è±¡èµ‹å€¼ç»™å­ç±»å‹çš„å¯¹è±¡,ä¹Ÿä¸èƒ½å°†å­ç±»å‹çš„å¯¹è±¡èµ‹å€¼ç»™çˆ¶ç±»å‹çš„å¯¹è±¡.</p></blockquote><blockquote><p>å› æ­¤,å¯ä»¥è¯´åå˜å’Œé€†å˜æ˜¯å‹å˜çš„ä¸¤ç§å…·ä½“å½¢å¼,è€Œä¸å˜åˆ™æ˜¯å‹å˜çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µ.</p></blockquote><blockquote><p>æ€»ç»“èµ·æ¥,åå˜ã€é€†å˜å’Œä¸å˜æè¿°äº†æ³›å‹ç±»å‹å‚æ•°ä¸æ³›å‹ç±»å‹ä¹‹é—´å­ç±»å‹å…³ç³»çš„ä¸åŒè¡Œä¸º.åå˜å’Œé€†å˜æ˜¯å¯¹å­ç±»å‹å…³ç³»çš„å…·ä½“çº¦æŸ,è€Œä¸å˜åˆ™æ˜¯æ²¡æœ‰ä»»ä½•å­ç±»å‹å…³ç³»çš„çº¦æŸ.å®ƒä»¬ä¹‹é—´æ˜¯äº’ç›¸æ’æ–¥çš„å…³ç³»,ä¸æ˜¯åŒ…å«å…³ç³».</p></blockquote><p>ä¸€è„¸æ‡µäº†å§ğŸ˜³?é—®é¢˜ä¸å¤§,ç»“åˆä»£ç å…·ä½“çœ‹ä¸€ä¸‹å°±å·®ä¸å¤šäº†</p><p>æˆ‘ä»¬è¿˜æ˜¯ç»“åˆ java å’Œ kotlin å¯¹æ¯”æ¥çœ‹ä¸€ä¸‹</p><h3 id="Javaä¸­çš„æ³›å‹"><a href="#Javaä¸­çš„æ³›å‹" class="headerlink" title="Javaä¸­çš„æ³›å‹"></a>Javaä¸­çš„æ³›å‹</h3><p>æˆ‘ä»¬å…ˆç”¨Javaä»£ç æ¥çœ‹ä¸€ä¸‹,å‡å¦‚æˆ‘ä»¬æœ‰å¦‚ä¸‹ä¸‰ä¸ªç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> &#123;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span> &#123;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Poodle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Dog</span> &#123;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Bird</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”±äº java çš„å¤šæ€æ€§,æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Animal</span> <span class="hljs-variable">animalDog</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();<br><span class="hljs-type">Animal</span> <span class="hljs-variable">animalBird</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bird</span>();<br>ArrayList&lt;Animal&gt; animalList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>animalList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Bird</span>());<br>animalList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>());<br></code></pre></td></tr></table></figure><p>è¿™ä¹ˆå†™æ˜¯æ²¡é—®é¢˜çš„,æˆ‘ä»¬å¯ä»¥æŠŠå­ç±»æ·»åŠ åˆ°çˆ¶ç±»åˆ—è¡¨ä¸­,ä½†å½“æˆ‘ä»¬åœ¨<code>animalList</code>ä¸­è·å–æ•°æ®æ—¶è¿”å›çš„æ˜¯<code>Animal</code>ç±»å‹,å¦‚æœç”¨åˆ°å­ç±»çš„ç‰¹æ€§,è¿˜éœ€è¦ä½¿ç”¨<code>instanceof</code>æ¥åˆ¤æ–­ä¸€ä¸‹ç±»å‹.<br>ä½†å¦‚æœæˆ‘ä»¬è¿™ä¹ˆå†™æ˜¯ä¸è¡Œçš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Java">ArrayList&lt;Animal&gt; animalList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Dog&gt;();<br></code></pre></td></tr></table></figure><p>å› ä¸º java çš„æ³›å‹å…·æœ‰ä¸å˜æ€§,åœ¨Java é‡Œé¢è®¤ä¸º<code>ArrayList&lt;Animal&gt;</code>å’Œ<code>ArrayList&lt;Dog&gt;</code>æ²¡å•¥å…³ç³».<br>åŒæ ·çš„,å½“æˆ‘ä»¬æƒ³è¦ç”¨æ–¹æ³•é‡è½½æ—¶ä¹Ÿä¼šé‡åˆ°è¿™ç§æƒ…å†µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">animal</span><span class="hljs-params">(ArrayList&lt;Dog&gt; dogs)</span>&#123;<br>    <br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">animal</span><span class="hljs-params">(ArrayList&lt;Bird&gt; birds)</span>&#123;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬è¿™ä¹ˆå†™çš„è¯ä¼šæŠ¥é”™,IDE ä¼šæç¤ºæˆ‘ä»¬ç›¸åº”çš„ä¿¡æ¯</p><blockquote><p>animal(ArrayList<Dog>)â€™ clashes with â€˜animal(ArrayList<Bird>)â€™; both methods have same erasure</p></blockquote><p>ä¸¤ä¸ªæ–¹æ³•çš„å‚æ•°æœ‰ç›¸åŒçš„æ“¦é™¤ç±»å‹,ç¼–è¯‘åä¼šè¢«è®¤ä¸ºæ˜¯åŒä¸€ä¸ªæ–¹æ³•.<br>åŒæ ·çš„,æˆ‘ä»¬åœ¨<strong>æ•è·æ³›å‹å¼‚å¸¸</strong>æ—¶ä¹Ÿä¼šæœ‰ç±»ä¼¼çš„æŠ¥é”™ä¿¡æ¯.</p><h3 id="Javaä¸­çš„æ³›å‹æ“¦é™¤"><a href="#Javaä¸­çš„æ³›å‹æ“¦é™¤" class="headerlink" title="Javaä¸­çš„æ³›å‹æ“¦é™¤"></a>Javaä¸­çš„æ³›å‹æ“¦é™¤</h3><p>é¢è¯•å¸¸è§çš„å…«è‚¡æ–‡,æˆ‘ä»¬æ¥å¤ä¹ ä¸€ä¸‹,è¿™éƒ¨åˆ†å¯ä»¥è·³è¿‡ä¸çœ‹.<br>æ¯”å¦‚æˆ‘ä»¬åœ¨C#ä¸­æœ‰å¦‚ä¸‹ä»£ç </p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs C#"><span class="hljs-keyword">using</span> System; <br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>&#123; <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params">String[] args</span>)</span>&#123; <br>        test&lt;<span class="hljs-built_in">string</span>&gt;(); <br>    &#125;    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span>&lt;<span class="hljs-title">T</span>&gt;()</span>&#123; <br>        Console.WriteLine(<span class="hljs-keyword">typeof</span>(T)); <br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„æ³›å‹ T ç±»å‹string æ˜¯å¯ä»¥åœ¨è¿è¡Œæ—¶è·å–åˆ°çš„,å¹¶ä¸”åœ¨è¿™é‡Œæ˜¯ä¸€ä¸ªçœŸå®å¯ç”¨çš„ç±»å‹.<br>ä½†åœ¨Javaæ˜¯ä¸è¡Œçš„,ç”±äºå‘ä¸Šå…¼å®¹å†å²ä»£ç çš„åŸå›  Java é‡‡ç”¨äº†<code>Code sharing</code>çš„ç­–ç•¥,ä½¿å¾—æ³›å‹åªå­˜åœ¨äºæºç é˜¶æ®µ,ç¼–è¯‘è¿‡åçš„Classæ–‡ä»¶å¹¶ä¸å­˜åœ¨æ³›å‹,è™šæ‹Ÿæœºå¹¶ä¸çŸ¥é“æ³›å‹çš„å­˜åœ¨,æ‰€ä»¥è¯´Javaä¸­çš„æ³›å‹æ˜¯ä¸€ç§ä¼ªæ³›å‹,è¿™ç§å‚æ•°ç±»å‹åªå­˜åœ¨äºæºç é˜¶æ®µåœ¨ç¼–è¯‘åå¹¶ä¸å­˜åœ¨çš„æœºåˆ¶æˆ‘ä»¬å«åš<strong>æ³›å‹æ“¦é™¤</strong>.ä¸ºäº†ä¿æŒæ³›å‹ç»§æ‰¿æˆ–å®ç°å…³ç³»çš„æ­£ç¡®æ€§,java ä¸­è¿˜æœ‰ä¸€ç§ç­–ç•¥ï¼š<strong>æ¡¥æ–¹æ³•ç”Ÿæˆ(Bridge Method Generation)</strong>:<br>ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜æ¡¥æ–¹æ³•ç”Ÿæˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span>&lt;T&gt; &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">(T shape)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Drawing shape: &quot;</span> + shape.toString());<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span>&lt;String&gt; &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">(String shape)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Drawing circle: &quot;</span> + shape);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ç±»å‹æ“¦é™¤å,ç¼–è¯‘å™¨ä¼šç”Ÿæˆæ¡¥æ–¹æ³•æ¥ä¿æŒæ³›å‹ç»§æ‰¿å…³ç³»çš„æ­£ç¡®æ€§.åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­,ç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸€ä¸ªæ¡¥æ–¹æ³•,ä½¿å¾—Circleç±»çš„æ–¹æ³•ç­¾åä¸çˆ¶ç±»çš„æ–¹æ³•ç­¾åä¿æŒä¸€è‡´,ä½†è¿”å›ç±»å‹è¢«æ“¦é™¤ä¸ºçˆ¶ç±»çš„ç±»å‹å‚æ•°.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span>&lt;String&gt; &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">(String shape)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Drawing circle: &quot;</span> + shape);<br>    &#125;<br><br>    <span class="hljs-comment">// ç”Ÿæˆçš„æ¡¥æ–¹æ³•</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">(Object shape)</span> &#123;<br>        draw((String) shape);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡ç”Ÿæˆçš„æ¡¥æ–¹æ³•,å³draw(Object shape),åœ¨ç±»å‹æ“¦é™¤åä»ç„¶èƒ½å¤Ÿæ­£ç¡®åœ°è°ƒç”¨æ³›å‹æ–¹æ³•.è¿™æ ·,å³ä½¿åœ¨ç¼–è¯‘å™¨çœ‹ä¸åˆ°å…·ä½“çš„æ³›å‹ç±»å‹ä¿¡æ¯,ä»ç„¶å¯ä»¥é€šè¿‡æ¡¥æ–¹æ³•æ¥è°ƒç”¨æ­£ç¡®çš„æ–¹æ³•å®ç°.<br>æ„Ÿå…´è¶£çš„è¯å¯ä»¥æœä¸€ä¸‹å…³é”®å­—:æ³›å‹æ“¦é™¤ã€æ¡¥æ–¹æ³•ç”Ÿæˆã€Code sharinã€Code specialization</p><h3 id="Java-ä¸­çš„æ³›å‹é€šé…ç¬¦"><a href="#Java-ä¸­çš„æ³›å‹é€šé…ç¬¦" class="headerlink" title="Java ä¸­çš„æ³›å‹é€šé…ç¬¦"></a>Java ä¸­çš„æ³›å‹é€šé…ç¬¦</h3><p>å‡å¦‚æˆ‘ä»¬çœŸçš„æœ‰åƒä¸Šé¢é‚£ç§èµ‹å€¼éœ€æ±‚æ€ä¹ˆæï¼Ÿjava ç»™æˆ‘ä»¬æä¾›äº†<code>æ³›å‹é€šé…ç¬¦</code>: <strong>? extends</strong> å’Œ <strong>? super</strong> æ¥è§£å†³è¿™ä¸ªé—®é¢˜.<br>å•°å—¦ä¸€ä¸‹ï¼šåœ¨ç»§æ‰¿å…³ç³»ä¸Š,ä¸€èˆ¬æƒ…å†µä¸‹å°†çˆ¶ç±»æ”¾åœ¨ä¸Šæ–¹,å­ç±»æ”¾åœ¨ä¸‹æ–¹.æ¯”å¦‚ä¸Šé¢å®šä¹‰çš„ç±»</p><pre><code class="mermaid" >graph TBA(Animal)A10(Dog)A11(Bird)A20(Poodle)A-->A10A-->A11A10-->A20</code></pre><h4 id="extends"><a href="#extends" class="headerlink" title="? extends"></a>? extends</h4><p>æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Java">ArrayList&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span>&gt; arrayList ;<br>arrayList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Bird&gt;();<br>arrayList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Dog&gt;();<br>arrayList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Animal&gt;();<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>? extends</code>å«åš<strong>ä¸Šç•Œé€šé…ç¬¦</strong>,å¯ä»¥ä½¿ Java æ³›å‹å…·æœ‰<strong>åå˜æ€§ Covariance</strong>,åå˜å°±æ˜¯å…è®¸ä¸Šé¢çš„èµ‹å€¼æ˜¯åˆæ³•çš„.<br>ä¸è¿‡è¿™é‡Œçš„<code>extends</code>å’Œæˆ‘ä»¬å®šä¹‰<code>class</code>æ—¶ç»§æ‰¿æŸä¸ªç±»ç”¨çš„<code>extends</code>æœ‰ä¸€ç‚¹ç‚¹ä¸ä¸€æ ·,é™¤äº†ä¸Šç•Œæ‰€æœ‰çš„ç›´æ¥å­ç±»ã€é—´æ¥å­ç±»è¿˜åŒ…å«å®ƒæœ¬èº«,å¹¶ä¸”ä¸Šç•Œä¹Ÿå¯ä»¥æ˜¯ interface.<br>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­,<code>ArrayList&lt;? extends Animal&gt;</code>è¡¨ç¤ºåˆ—è¡¨ä¸­å¯ä»¥å­˜æ”¾ Animal åŠå…¶å­ç±»ã€é—´æ¥å­ç±»çš„ç±»å‹.ä¹Ÿå°±æ˜¯ç¡®è®¤äº†å®ƒçš„ä¸Šé™èƒ½åˆ°å“ªä¸€å±‚.<br>ä½†æˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ³›å‹é€šé…ç¬¦ä¹‹å,åœ¨ä½¿ç”¨ä¸Šä¼šæœ‰ä¸€äº›å°é—®é¢˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Java">arrayList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>());<span class="hljs-comment">//error</span><br>arrayList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Bird</span>());<span class="hljs-comment">//error</span><br>arrayList.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>());<span class="hljs-comment">//error</span><br><span class="hljs-type">Animal</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span>  arrayList.get(<span class="hljs-number">0</span>);<span class="hljs-comment">//ok</span><br></code></pre></td></tr></table></figure><p>ç”±äº<code>arrayList</code>ä¸­å­˜æ”¾çš„å¯ä»¥æ˜¯<strong>Animal åŠå…¶å­ç±»ã€é—´æ¥å­ç±»çš„ç±»å‹</strong>,æ‰€ä»¥æˆ‘ä»¬å¹¶ä¸ç¡®å®šæ˜¯å“ªç§ç±»å‹,å› æ­¤æˆ‘ä»¬æ— æ³•å‘åˆ—è¡¨ä¸­æ·»åŠ å…ƒç´ ,ä½†å¯ä»¥ç¡®å®šçš„æ˜¯,å°†åˆ—è¡¨ä¸­çš„å…ƒç´ èµ‹å€¼ç»™ Animalç±»å‹çš„å˜é‡æ˜¯æ²¡é—®é¢˜çš„.<br>åƒè¿™ç§åªèƒ½ä»åˆ—è¡¨ä¸­è¯»å–æ•°æ®æä¾›,ä½†ä¸èƒ½å‘åˆ—è¡¨ä¸­å†™å…¥çš„æƒ…å†µæˆ‘ä»¬ç§°ä¹‹ä¸º<code>ç”Ÿäº§è€…</code></p><h4 id="super"><a href="#super" class="headerlink" title="? super"></a>? super</h4><p>æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Java">ArrayList&lt;? <span class="hljs-built_in">super</span> Dog&gt; list ;<br>list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Dog&gt;();<br>list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Animal&gt;();<br>list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Poodle&gt;();<span class="hljs-comment">//error</span><br><br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>? super</code>å«åš<strong>ä¸‹ç•Œé€šé…ç¬¦</strong>,å¯ä»¥ä½¿Javaæ³›å‹å…·<strong>é€†å˜æ€§ Contravariance</strong>,é€†å˜å°±æ˜¯å…è®¸ä¸Šé¢çš„èµ‹å€¼æ˜¯åˆæ³•çš„.<br>é€šè¿‡ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‹ç•Œé€šé…ç¬¦ç¡®å®šäº†åˆ—è¡¨çš„ä¸‹é™,ä¹Ÿå°±æ˜¯ç¡®è®¤äº†ä¸‹é™åœ¨å“ªä¸€å±‚,æˆ‘ä»¬å¯ä»¥å°†è¯¥å±‚åŠä»¥ä¸Šçš„ç±»å‹èµ‹å€¼ç»™ list.åŒæ ·çš„,æˆ‘ä»¬åœ¨ä½¿ç”¨ä¸Šä¹Ÿæœ‰ä¸€ç‚¹ç‚¹å°é—®é¢˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Java">list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>());<br>list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Poodle</span>());<br>list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>());<span class="hljs-comment">//error</span><br><br><span class="hljs-type">Object</span> <span class="hljs-variable">dog</span> <span class="hljs-operator">=</span> list.get(<span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><p>å› ä¸ºlist ä¸­å­˜æ”¾çš„è‚¯å®šæ˜¯<strong>Dogæˆ–è€…å…¶çˆ¶ç±»ã€é—´æ¥çˆ¶ç±»</strong>,æ ¹æ®é‡Œæ°æ›¿æ¢åŸåˆ™,ä»»ä½•ä½¿ç”¨çˆ¶ç±»çš„åœ°æ–¹å¯ä»¥è¢«å®ƒçš„å­ç±»æ›¿æ¢,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å‘ list ä¸­æ·»åŠ <strong>Dogæˆ–å…¶å­ç±»ã€é—´æ¥å­ç±»</strong>.ä½†æ˜¯å½“æˆ‘ä»¬ä» list ä¸­å–æ•°æ®çš„æ—¶å€™,ç”±äºä¸çŸ¥é“ list ä¸­å­˜æ”¾çš„å…·ä½“æ˜¯ä»€ä¹ˆç±»å‹,åœ¨ java ä¸­ Object æ˜¯æ‰€æœ‰ç±»å‹çš„çˆ¶ç±»,æ‰€ä»¥è¿™é‡Œå–åˆ°çš„æ•°æ®è¿”å›çš„<strong>Object</strong>ç±»å‹.</p><p>ä¸€èˆ¬æƒ…å†µä¸‹,æˆ‘ä»¬è·å–åˆ°Objectå¯ä»¥é€šè¿‡<code>className</code>æˆ–è€…<code>instanceof</code>æ¥åˆ¤æ–­å…·ä½“ç±»å‹,ä½†æˆ‘ä»¬å°±å…ˆå¿½ç•¥å§.<br>åƒè¿™ç§åªå†™å…¥è€Œä¸è¯»å–çš„æ³›å‹ç±»å‹å£°æ˜æƒ…å†µç§°ä¹‹ä¸º<strong>æ¶ˆè´¹è€… Consumer</strong>.</p><h4 id="æ— è¾¹ç•Œé€šé…ç¬¦"><a href="#æ— è¾¹ç•Œé€šé…ç¬¦" class="headerlink" title="æ— è¾¹ç•Œé€šé…ç¬¦"></a>æ— è¾¹ç•Œé€šé…ç¬¦</h4><p>è¿˜æœ‰ä¸€ç§æ— è¾¹ç•Œé€šé…ç¬¦,ç”¨å•é—®å·è¡¨ç¤ºï¼šList&lt;?&gt;,ä¹Ÿå°±æ˜¯æ²¡æœ‰ä»»ä½•é™å®š,ç›¸å½“äº<code>? extends Object</code>.éœ€è¦æ³¨æ„çš„æ˜¯,å®ƒå’Œä¸ä½¿ç”¨ç±»å‹çš„ List è¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼š</p><ul><li>List&lt;?&gt; listè¡¨ç¤ºçš„æ˜¯åˆ—è¡¨ä¿å­˜æŸä¸ªç‰¹å®šç±»å‹çš„å¯¹è±¡,ä½†æˆ‘ä»¬ä¸èƒ½å‘å…¶ä¸­æ·»åŠ ä»»ä½•å…ƒç´ ,å› ä¸ºæˆ‘ä»¬ä¸æ¸…æ¥š list ä¸­ä¿å­˜çš„æ˜¯é‚£ç§ç±»å‹</li><li>æ²¡æœ‰æ³›å‹å‚æ•°çš„ List è¡¨ç¤ºè¯¥åˆ—è¡¨æŒæœ‰çš„å…ƒç´ ç±»å‹æ˜¯ Object,å› æ­¤å¯ä»¥æ·»åŠ ä»»ä½•ç±»å‹çš„å¯¹è±¡,ä½†ç¼–è¯‘å™¨ä¼šæœ‰è­¦å‘Šä¿¡æ¯.</li></ul><h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>å°å°çš„æ€»ç»“ä¸€ä¸‹ï¼š<br>åˆ©ç”¨<code>? extends</code>å½¢å¼çš„é€šé…ç¬¦å¯ä»¥å®ç°æ³›å‹çš„å‘ä¸Šè½¬å‹,ä¹Ÿå°±æ˜¯æ”¯æŒåå˜.ä½†ä½¿ç”¨ä¸Šé€šé…ç¬¦åç¼–è¯‘å™¨ä¸ºäº†ä¿è¯è¿è¡Œæ—¶çš„å®‰å…¨,ä¼šé™å®šå¯¹å…¶å†™çš„æ“ä½œ,å¼€æ”¾è¯»çš„æ“ä½œä¹Ÿå°±æ˜¯<strong>åªèƒ½è¯»å–ä¸èƒ½ä¿®æ”¹</strong><br>åˆ©ç”¨<code>? super T</code>å½¢å¼çš„é€šé…ç¬¦å¯ä»¥å®ç°æ³›å‹çš„å‘ä¸‹è½¬å‹,ä¹Ÿå°±æ˜¯æ”¯æŒé€†å˜,ä¸ä¸Šé€šé…ç¬¦ç›¸å,ä¸‹è¾¹ç•Œé€šé…ç¬¦é€šå¸¸é™å®šè¯»çš„æ“ä½œ,å¼€æ”¾å†™çš„æ“ä½œ,ä¹Ÿå°±æ˜¯<strong>åªèƒ½ä¿®æ”¹ä¸èƒ½è¯»å–</strong></p><p>Joshua Bloch åœ¨å…¶è‘—ä½œã€ŠEffective Javaã€‹ç¬¬ä¸‰ç‰ˆ ä¸­å¾ˆå¥½åœ°è§£é‡Šäº†è¯¥é—®é¢˜ (ç¬¬ 31 æ¡ï¼šâ€œåˆ©ç”¨æœ‰é™åˆ¶é€šé…ç¬¦æ¥æå‡ API çš„çµæ´»æ€§â€). ä»–ç§°é‚£äº›ä½ åªèƒ½ä»ä¸­è¯»å–çš„å¯¹è±¡ä¸ºç”Ÿäº§è€…, å¹¶ç§°é‚£äº›åªèƒ½å‘å…¶å†™å…¥çš„å¯¹è±¡ä¸ºæ¶ˆè´¹è€….ä»–å»ºè®®ï¼š</p><blockquote><p>ä¸ºäº†çµæ´»æ€§æœ€å¤§åŒ–,åœ¨è¡¨ç¤ºç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…çš„è¾“å…¥å‚æ•°ä¸Šä½¿ç”¨é€šé…ç¬¦ç±»å‹.</p></blockquote><p>ä»–è¿˜æå‡ºäº†ä»¥ä¸‹åŠ©è®°ç¬¦ï¼šPECS ä»£è¡¨ç”Ÿäº§è€…-Extendsã€æ¶ˆè´¹è€…-Super(Producer-Extends, Consumer-Super).</p><h3 id="kotlin-ä¸­çš„æ³›å‹é€šé…ç¬¦"><a href="#kotlin-ä¸­çš„æ³›å‹é€šé…ç¬¦" class="headerlink" title="kotlin ä¸­çš„æ³›å‹é€šé…ç¬¦"></a>kotlin ä¸­çš„æ³›å‹é€šé…ç¬¦</h3><p>ç†æ¸…æ¥šäº† java ä¸­çš„æ³›å‹é€šé…ç¬¦,æ¥ç€æˆ‘ä»¬çœ‹ä¸€ä¸‹ kotlin ä¸­çš„é€šé…ç¬¦,ç›¸å¯¹äº Java çš„é€šé…ç¬¦æå‡ºäº†ä¸€ç§æ–°çš„å®šä¹‰ï¼š<strong>å£°æ˜å¤„å‹å˜(declaration-site variance)<strong>ä¸</strong>ç±»å‹æŠ•å½±(type projections)</strong><br>å…ˆä» kotlin ä¸­çš„é€šé…ç¬¦è¯´èµ·ï¼š<br>å’Œ java æ³›å‹ä¸€æ ·ï¼Œkotlin ä¸­çš„æ³›å‹ä¹Ÿæ˜¯ä¸å˜çš„ï¼ŒåŒæ ·çš„ï¼Œä¹Ÿæä¾›äº†ç›¸åº”çš„å…³é”®å­—æ¥æ”¯æŒ<strong>åå˜</strong>å’Œ<strong>é€†å˜</strong></p><ul><li>ä½¿ç”¨å…³é”®å­—<code>out</code>æ¥æ”¯æŒåå˜ï¼Œç­‰åŒäº Java ä¸­çš„ä¸Šç•Œé€šé…ç¬¦<code>? extends</code>ã€‚</li><li>ä½¿ç”¨å…³é”®å­—<code>in</code>æ¥æ”¯æŒé€†å˜ï¼Œç­‰åŒäº Java ä¸­çš„ä¸‹ç•Œé€šé…ç¬¦<code>? super</code>ã€‚</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> outList: MutableList&lt;<span class="hljs-keyword">out</span> TestMain.Animal&gt; = mutableListOf()<br><span class="hljs-keyword">val</span> outListItem: TestMain.Animal = outList[<span class="hljs-number">0</span>]<br><br><br><span class="hljs-keyword">val</span> inList: MutableList&lt;<span class="hljs-keyword">in</span> TestMain.Animal&gt; = mutableListOf()<br>inList.add(TestMain.Dog())<br>inList.add(TestMain.Bird())<br>inList.add(TestMain.Poodle())<br><span class="hljs-keyword">val</span> inListItem: Any? = inList[<span class="hljs-number">0</span>]<br></code></pre></td></tr></table></figure><p>æ— éæ˜¯æ¢äº†ä¸ªå†™æ³•è€Œå·²ï¼Œæ²¡å¤šå¤§å·®åˆ«.ä¸è¿‡éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œkotlin åŒæ—¶æ”¯æŒä½¿ç”¨å¤„å‹å˜å’Œå£°æ˜å¤„å‹å˜ã€‚<br>ä¸¾ä¸€ä¸ªç”¨çƒ‚äº†çš„ä¾‹å­</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Producer</span>&lt;<span class="hljs-type">out T</span>&gt; </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">produce</span><span class="hljs-params">()</span></span>: T &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span> <span class="hljs-keyword">as</span> T<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Consumer</span>&lt;<span class="hljs-type">in T</span>&gt; </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">consume</span><span class="hljs-params">(t: <span class="hljs-type">T</span>)</span></span> &#123;<br>        println(t)<br>    &#125;<br>&#125;<br><span class="hljs-keyword">val</span> producer: Producer&lt;TestMain.Animal&gt; = Producer()<br><span class="hljs-keyword">val</span> animal: TestMain.Animal = producer.produce()<br><br><span class="hljs-keyword">val</span> consumer: Consumer&lt;TestMain.Animal&gt; = Consumer()<br>consumer.consume(TestMain.Dog())<br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬ç¡®è®¤æ³›å‹å‚æ•°åªç”¨æ¥è¾“å…¥æˆ–è€…è¾“å‡ºï¼Œå¯ä»¥åœ¨å£°æ˜å¤„ç›´æ¥æ·»åŠ <code>in</code>æˆ–è€…<code>out</code>.å½“ç„¶ä¹Ÿå¯ä»¥åœ¨ä½¿ç”¨å¤„æ·»åŠ å£°æ˜</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Producer1</span>&lt;<span class="hljs-type">T</span>&gt; </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">produce</span><span class="hljs-params">()</span></span>: T? &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span><br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Consumer1</span>&lt;<span class="hljs-type">T</span>&gt; </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">consume</span><span class="hljs-params">(t: <span class="hljs-type">T</span>)</span></span> &#123;<br>        println(t)<br>    &#125;<br>&#125;<br><span class="hljs-keyword">val</span> producer1: Producer1&lt;<span class="hljs-keyword">out</span> TestMain.Animal&gt; = Producer1()<br><span class="hljs-keyword">val</span> animal1: TestMain.Animal? = producer1.produce()<br><br><span class="hljs-keyword">val</span> consumer1: Consumer1&lt;<span class="hljs-keyword">in</span> TestMain.Animal&gt; = Consumer1()<br>consumer1.consume(TestMain.Dog())<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¹Ÿå°±æ˜¯ç»å¸¸è¯´çš„ <strong>æ¶ˆè´¹è€… in, ç”Ÿäº§è€… out</strong></p><h4 id="ç±»å‹æŠ•å½±"><a href="#ç±»å‹æŠ•å½±" class="headerlink" title="ç±»å‹æŠ•å½±"></a>ç±»å‹æŠ•å½±</h4><p>è¿™ä¸ªä¸œè¥¿å¯ä»¥ç†è§£ä¸ºå°±æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œæ ¹æ®å®˜æ–¹æè¿°æ˜¯è¿™æ ·çš„:<br>å°†ç±»å‹å‚æ•°<code>T</code>å£°æ˜ä¸º<code>out</code>éå¸¸ç®€å•ï¼Œå¹¶ä¸”èƒ½é¿å…ä½¿ç”¨å¤„å­ç±»å‹åŒ–çš„éº»çƒ¦ï¼Œä½†æ˜¯æœ‰äº›ç±»å®é™…ä¸Šä¸èƒ½é™åˆ¶ä¸ºåªè¿”å›<code>T</code>ï¼ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯<code>Array</code>ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Array</span>&lt;<span class="hljs-type">T</span>&gt;</span>(<span class="hljs-keyword">val</span> size: <span class="hljs-built_in">Int</span>) &#123;<br>    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">get</span><span class="hljs-params">(index: <span class="hljs-type">Int</span>)</span></span>: T &#123; â€¦â€¦ &#125;<br>    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">set</span><span class="hljs-params">(index: <span class="hljs-type">Int</span>, value: <span class="hljs-type">T</span>)</span></span> &#123; â€¦â€¦ &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯¥ç±»åœ¨<code>T</code>ä¸Šæ—¢ä¸èƒ½æ˜¯åå˜çš„ä¹Ÿä¸èƒ½æ˜¯é€†å˜çš„ã€‚è¿™é€ æˆäº†ä¸€äº›ä¸çµæ´»æ€§ã€‚è€ƒè™‘ä¸‹è¿°å‡½æ•°ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">copy</span><span class="hljs-params">(from: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">Any</span>&gt;, to: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">Any</span>&gt;)</span></span> &#123;<br>    assert(from.size == to.size)<br>    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> from.indices)<br>        to[i] = from[i]<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°åº”è¯¥å°†é¡¹ç›®ä»ä¸€ä¸ªæ•°ç»„å¤åˆ¶åˆ°å¦ä¸€ä¸ªæ•°ç»„ã€‚è®©æˆ‘ä»¬å°è¯•åœ¨å®è·µä¸­åº”ç”¨å®ƒï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> ints: Array&lt;<span class="hljs-built_in">Int</span>&gt; = arrayOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br><span class="hljs-keyword">val</span> any = Array&lt;Any&gt;(<span class="hljs-number">3</span>) &#123; <span class="hljs-string">&quot;&quot;</span> &#125; <br>copy(ints, any)<br><span class="hljs-comment">//   ^ å…¶ç±»å‹ä¸º Array&lt;Int&gt; ä½†æ­¤å¤„æœŸæœ› Array&lt;Any&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬é‡åˆ°åŒæ ·ç†Ÿæ‚‰çš„é—®é¢˜ï¼š<code>Array&lt;T&gt;</code>åœ¨<code>T</code>ä¸Šæ˜¯<strong>ä¸å‹å˜</strong>çš„ï¼Œå› æ­¤<code>Array&lt;Int&gt;</code> ä¸ <code>Array&lt;Any&gt;</code> éƒ½ä¸æ˜¯å¦ä¸€ä¸ªçš„å­ç±»å‹ã€‚ä¸ºä»€ä¹ˆï¼Ÿ å†æ¬¡é‡å¤ï¼Œå› ä¸º<code>copy</code>å¯èƒ½æœ‰éé¢„æœŸè¡Œä¸ºï¼Œä¾‹å¦‚å®ƒå¯èƒ½å°è¯•å†™ä¸€ä¸ª<code>String</code>åˆ°<code>from</code>ï¼Œå¹¶ä¸”å¦‚æœæˆ‘ä»¬å®é™…ä¸Šä¼ é€’ä¸€ä¸ª<code>Int</code>çš„æ•°ç»„ï¼Œä»¥åä¼šæŠ›<code>ClassCastException</code>å¼‚å¸¸ã€‚<br>å¦‚æœéœ€è¦ç¦æ­¢<code>copy</code>åŠŸèƒ½å†™å…¥<code>from</code>ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œ:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">copy</span><span class="hljs-params">(from: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">out</span> <span class="hljs-type">Any</span>&gt;, to: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">Any</span>&gt;)</span></span> &#123; â€¦â€¦ &#125;<br></code></pre></td></tr></table></figure><p>è¿™å°±æ˜¯ç±»å‹æŠ•å½±ï¼šæ„å‘³ç€<code>from</code>ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè€Œæ˜¯ä¸€ä¸ª<code>å—é™åˆ¶</code>çš„<strong>ï¼ˆæŠ•å½±çš„ï¼‰</strong>æ•°ç»„ã€‚ åªå¯ä»¥è°ƒç”¨è¿”å›ç±»å‹ä¸ºç±»å‹å‚æ•°<code>T</code>çš„æ–¹æ³•ï¼Œå¦‚ä¸Šï¼Œè¿™æ„å‘³ç€åªèƒ½è°ƒç”¨<code>get()</code>ã€‚ è¿™å°±æ˜¯ä½¿ç”¨å¤„å‹å˜çš„ç”¨æ³•ï¼Œå¹¶ä¸”æ˜¯å¯¹åº”äº Java çš„ <code>Array&lt;? extends Object&gt;</code>, ä½†æ›´ç®€å•ã€‚</p><p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨<code>in</code>æŠ•å½±ä¸€ä¸ªç±»å‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fill</span><span class="hljs-params">(dest: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">in</span> <span class="hljs-type">String</span>&gt;, value: <span class="hljs-type">String</span>)</span></span> &#123; â€¦â€¦ &#125;<br></code></pre></td></tr></table></figure><p><code>Array&lt;in String&gt;</code> å¯¹åº”äº Java çš„<code>Array&lt;? super String&gt;</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥ä¼ é€’ä¸€ä¸ª<code>CharSequence</code>æ•°ç»„æˆ–ä¸€ä¸ª<code>Object</code>æ•°ç»„ç»™<code>fill()</code>å‡½æ•°ã€‚<br><strong>ä»¥ä¸Šä¿¡æ¯æ¥è‡ª <a href="(https://book.kotlincn.net/text/generics.html)">kotlin ä¸­æ–‡ç½‘</a></strong></p><h4 id="æ˜ŸæŠ•å½±"><a href="#æ˜ŸæŠ•å½±" class="headerlink" title="æ˜ŸæŠ•å½±"></a>æ˜ŸæŠ•å½±</h4><p>æœ‰æ—¶ä½ æƒ³è¯´ï¼Œä½ å¯¹ç±»å‹å‚æ•°ä¸€æ— æ‰€çŸ¥ï¼Œä½†ä»ç„¶å¸Œæœ›ä»¥å®‰å…¨çš„æ–¹å¼ä½¿ç”¨å®ƒã€‚ è¿™é‡Œçš„å®‰å…¨æ–¹å¼æ˜¯å®šä¹‰æ³›å‹ç±»å‹çš„è¿™ç§æŠ•å½±ï¼Œè¯¥æ³›å‹ç±»å‹çš„æ¯ä¸ªå…·ä½“å®ä¾‹åŒ–éƒ½ä¼šæ˜¯è¯¥æŠ•å½±çš„å­ç±»å‹ã€‚</p><p>Kotlin ä¸ºæ­¤æä¾›äº†æ‰€è°“çš„<strong>æ˜ŸæŠ•å½±</strong>è¯­æ³•ï¼š</p><ul><li>å¯¹äº<code>Foo &lt;out T : TUpper&gt;</code>ï¼Œå…¶ä¸­<code>T</code>æ˜¯ä¸€ä¸ªå…·æœ‰ä¸Šç•Œ<code>TUpper</code>çš„åå˜ç±»å‹å‚æ•°ï¼Œ<code>Foo &lt;*&gt;</code>ç­‰ä»·äº<code>Foo &lt;out TUpper&gt;</code>ã€‚ æ„å‘³ç€å½“<code>T</code>æœªçŸ¥æ—¶ï¼Œä½ å¯ä»¥å®‰å…¨åœ°ä»<code>Foo &lt;*&gt;</code>è¯»å–<code>TUpper</code>çš„å€¼ã€‚</li><li>å¯¹äº<code>Foo &lt;in T&gt;</code>ï¼Œå…¶ä¸­<code>T</code>æ˜¯ä¸€ä¸ªé€†å˜ç±»å‹å‚æ•°ï¼Œ<code>Foo &lt;*&gt;</code>ç­‰ä»·äº<code>Foo &lt;in Nothing&gt;</code>ã€‚ æ„å‘³ç€å½“<code>T</code>æœªçŸ¥æ—¶ï¼Œ æ²¡æœ‰ä»€ä¹ˆå¯ä»¥ä»¥å®‰å…¨çš„æ–¹å¼å†™å…¥<code>Foo &lt;*&gt;</code>ã€‚</li><li>å¯¹äº<code>Foo &lt;T : TUpper&gt;</code>ï¼Œå…¶ä¸­<code>T</code>æ˜¯ä¸€ä¸ªå…·æœ‰ä¸Šç•Œ<code>TUpper</code>çš„ä¸å‹å˜ç±»å‹å‚æ•°,<code>Foo&lt;*&gt;</code>å¯¹äºè¯»å–å€¼æ—¶ç­‰ä»·äº<code>Foo&lt;out TUpper&gt;</code> è€Œå¯¹äºå†™å€¼æ—¶ç­‰ä»·äº<code>Foo&lt;in Nothing&gt;</code>ã€‚</li></ul><p>å¦‚æœæ³›å‹ç±»å‹å…·æœ‰å¤šä¸ªç±»å‹å‚æ•°ï¼Œåˆ™æ¯ä¸ªç±»å‹å‚æ•°éƒ½å¯ä»¥å•ç‹¬æŠ•å½±ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœç±»å‹è¢«å£°æ˜ä¸º interface Function &lt;in T, out U&gt;ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ˜ŸæŠ•å½±ï¼š</p><ul><li><code>Function&lt;*, String&gt;</code> è¡¨ç¤º<code>Function&lt;in Nothing, String&gt;</code>ã€‚</li><li><code>Function&lt;Int, *&gt;</code> è¡¨ç¤º<code>Function&lt;Int, out Any?&gt;</code>ã€‚</li><li><code>Function&lt;*, *&gt;</code> è¡¨ç¤º<code>Function&lt;in Nothing, out Any?&gt;</code>ã€‚</li></ul><p><strong>ä»¥ä¸Šä¿¡æ¯æ¥è‡ª <a href="(https://book.kotlincn.net/text/generics.html)">kotlin ä¸­æ–‡ç½‘</a></strong></p><h4 id="æ³›å‹æ–¹æ³•"><a href="#æ³›å‹æ–¹æ³•" class="headerlink" title="æ³›å‹æ–¹æ³•"></a>æ³›å‹æ–¹æ³•</h4><p>ä¸ä»…ç±»å¯ä»¥æœ‰ç±»å‹å‚æ•°ã€‚å‡½æ•°ä¹Ÿå¯ä»¥æœ‰ã€‚ç±»å‹å‚æ•°è¦æ”¾åœ¨å‡½æ•°åç§°ä¹‹å‰ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">singletonList</span><span class="hljs-params">(item: <span class="hljs-type">T</span>)</span></span>: List&lt;T&gt; &#123;<br>    <span class="hljs-comment">// â€¦â€¦</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> T.<span class="hljs-title">basicToString</span><span class="hljs-params">()</span></span>: String &#123; <span class="hljs-comment">// æ‰©å±•å‡½æ•°</span><br>    <span class="hljs-comment">// â€¦â€¦</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¦è°ƒç”¨æ³›å‹å‡½æ•°ï¼Œåœ¨è°ƒç”¨å¤„å‡½æ•°åä¹‹åæŒ‡å®šç±»å‹å‚æ•°å³å¯ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> l = singletonList&lt;<span class="hljs-built_in">Int</span>&gt;(<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœç•¥èƒ½å¤Ÿä»ä¸Šä¸‹æ–‡ä¸­æ¨æ–­å‡ºæ¥çš„ç±»å‹å‚æ•°ï¼Œæ‰€ä»¥ä»¥ä¸‹ç¤ºä¾‹åŒæ ·é€‚ç”¨ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> l = singletonList(<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><h4 id="æ³›å‹çº¦æŸ"><a href="#æ³›å‹çº¦æŸ" class="headerlink" title="æ³›å‹çº¦æŸ"></a>æ³›å‹çº¦æŸ</h4><p>èƒ½å¤Ÿæ›¿æ¢ç»™å®šç±»å‹å‚æ•°çš„æ‰€æœ‰å¯èƒ½ç±»å‹çš„é›†åˆå¯ä»¥ç”±<strong>æ³›å‹çº¦æŸ</strong>é™åˆ¶ã€‚<br>æœ€å¸¸è§çš„çº¦æŸç±»å‹æ˜¯ä¸Šç•Œï¼Œä¸Javaçš„<code>extends</code>å…³é”®å­—å¯¹åº”ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : Comparable&lt;T&gt;</span>&gt; <span class="hljs-title">sort</span><span class="hljs-params">(list: <span class="hljs-type">List</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> &#123;  â€¦â€¦ &#125;<br></code></pre></td></tr></table></figure><p>å†’å·ä¹‹åæŒ‡å®šçš„ç±»å‹æ˜¯ä¸Šç•Œï¼Œè¡¨æ˜åªæœ‰<code>Comparable&lt;T&gt;</code>çš„å­ç±»å‹å¯ä»¥æ›¿ä»£<code>T</code>ã€‚ ä¾‹å¦‚ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">sort(listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)) <span class="hljs-comment">// OKã€‚Int æ˜¯ Comparable&lt;Int&gt; çš„å­ç±»å‹</span><br>sort(listOf(HashMap&lt;<span class="hljs-built_in">Int</span>, String&gt;())) <span class="hljs-comment">// é”™è¯¯ï¼šHashMap&lt;Int, String&gt; ä¸æ˜¯ Comparable&lt;HashMap&lt;Int, String&gt;&gt; çš„å­ç±»å‹</span><br></code></pre></td></tr></table></figure><p>é»˜è®¤çš„ä¸Šç•Œï¼ˆå¦‚æœæ²¡æœ‰å£°æ˜ï¼‰æ˜¯ Any?ã€‚åœ¨å°–æ‹¬å·ä¸­åªèƒ½æŒ‡å®šä¸€ä¸ªä¸Šç•Œã€‚ å¦‚æœåŒä¸€ç±»å‹å‚æ•°éœ€è¦å¤šä¸ªä¸Šç•Œï¼Œéœ€è¦ä¸€ä¸ªå•ç‹¬çš„ where-å­å¥ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">copyWhenGreater</span><span class="hljs-params">(list: <span class="hljs-type">List</span>&lt;<span class="hljs-type">T</span>&gt;, threshold: <span class="hljs-type">T</span>)</span></span>: List&lt;String&gt;<br>    <span class="hljs-keyword">where</span> T : CharSequence,<br>          T : Comparable&lt;T&gt; &#123;<br>    <span class="hljs-keyword">return</span> list.filter &#123; it &gt; threshold &#125;.map &#123; it.toString() &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰€ä¼ é€’çš„ç±»å‹å¿…é¡»åŒæ—¶æ»¡è¶³<code>where</code>å­å¥çš„æ‰€æœ‰æ¡ä»¶ã€‚åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œç±»å‹<code>T</code>å¿…é¡»<strong>æ—¢å®ç°äº† CharSequence ä¹Ÿå®ç°äº† Comparable</strong>ã€‚<br>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œwhere å­å¥åé¢çš„ç¬¬ä¸€ä¸ªç±»å‹å¯ä»¥æ˜¯æ¥å£ä¹Ÿå¯ä»¥æ˜¯æŠ½è±¡ç±»ã€å®ç°ç±»ï¼Œåç»­çš„ç±»å‹åªèƒ½æ˜¯æ¥å£ã€‚åœ¨ Java ä¸­ä¹Ÿä¸€æ ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyInterface</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAbstractClass</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> &lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">MyInterface</span> &amp; MyAbstractClass&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">(T t)</span>&#123; <span class="hljs-comment">//errpr</span><br>    t.test();<br>&#125;<br><span class="hljs-keyword">public</span> &lt;T <span class="hljs-keyword">extends</span>  <span class="hljs-title class_">MyAbstractClass</span> &amp; MyInterface &gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">(T t)</span>&#123;<br>    t.test();<br>&#125;<br>    <br></code></pre></td></tr></table></figure><p>åŸå› å°±æ˜¯ java ä¸­ä¸å¯ä»¥å¤šç»§æ‰¿ä½†å¯ä»¥å¤šå®ç°</p><h4 id="UnsafeVariance"><a href="#UnsafeVariance" class="headerlink" title="@UnsafeVariance"></a>@UnsafeVariance</h4><p>å·®ç‚¹å¿˜äº†è¿™ä¸œè¥¿ï¼Œè¿™ä¸ªæ³¨è§£å°±æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨æˆ‘çŸ¥é“æˆ‘åœ¨åšä»€ä¹ˆï¼Œå¹¶ä¸”ä¿è¯ä¸ä¼šå‡ºé—®é¢˜ï¼Œå¿½ç•¥åå˜å’Œé€†å˜çš„çº¦æŸå°±å¥½äº†<br>æ¯”å¦‚ kotlin ä¸­çš„<code>Collection</code>è¿™ä¸ªç±»ä¸­çš„<code>contains</code>ã€<code>containsAll</code>æ–¹æ³•</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Collection</span>&lt;<span class="hljs-type">out E</span>&gt; : <span class="hljs-type">Iterable</span>&lt;<span class="hljs-type">E</span>&gt; </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">contains</span><span class="hljs-params">(element: @<span class="hljs-type">UnsafeVariance</span> <span class="hljs-type">E</span>)</span></span>: <span class="hljs-built_in">Boolean</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">containsAll</span><span class="hljs-params">(elements: <span class="hljs-type">Collection</span>&lt;@<span class="hljs-type">UnsafeVariance</span> <span class="hljs-type">E</span>&gt;)</span></span>: <span class="hljs-built_in">Boolean</span><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>å¯¹äºåå˜çš„ç±»å‹ï¼Œé€šå¸¸æˆ‘ä»¬æ˜¯ä¸å…è®¸å°†æ³›å‹ç±»å‹ä½œä¸ºä¼ å…¥å‚æ•°çš„ç±»å‹çš„ï¼Œæˆ–è€…è¯´ï¼Œå¯¹äºåå˜ç±»å‹ï¼Œæˆ‘ä»¬é€šå¸¸æ˜¯ä¸å…è®¸å…¶æ¶‰åŠæ³›å‹å‚æ•°çš„éƒ¨åˆ†è¢«æ”¹å˜çš„ã€‚<br>è¿™ä¹Ÿå¾ˆå®¹æ˜“è§£&gt;é‡Šä¸ºä»€ä¹ˆ MutableCollection æ˜¯ä¸å˜çš„ï¼Œè€Œ Collection æ˜¯åå˜çš„ï¼Œå› ä¸ºåœ¨ Kotlin å½“ä¸­ï¼Œå‰è€…æ˜¯å¯è¢«ä¿®æ”¹çš„ï¼Œåè€…æ˜¯ä¸å¯è¢«ä¿®æ”¹çš„ã€‚<br>é€†å˜çš„æƒ…å½¢æ­£å¥½ç›¸åï¼Œå³ä¸å¯ä»¥å°†æ³›å‹å‚æ•°ä½œä¸ºæ–¹æ³•çš„è¿”å›å€¼ã€‚</p></blockquote><p>æ¯”å¦‚è¿™ç§æƒ…å½¢ï¼Œä¸ºäº†è®©ç¼–è¯‘å™¨æ”¾è¿‡ä¸€é©¬ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ @UnsafeVariance æ¥å‘Šè¯‰ç¼–è¯‘å™¨ï¼šâ€œæˆ‘çŸ¥é“æˆ‘åœ¨å¹²å•¥ï¼Œä¿è¯ä¸ä¼šå‡ºé”™ï¼Œä½ ä¸ç”¨æ‹…å¿ƒâ€ã€‚<br><strong>ä»¥ä¸Šä¿¡æ¯æ¥è‡ª<a href="https://zhuanlan.zhihu.com/p/143380842">æ·±å…¥è§£æKotlin æ³›å‹</a></strong></p><h4 id="reified-å…³é”®å­—"><a href="#reified-å…³é”®å­—" class="headerlink" title="reified å…³é”®å­—"></a>reified å…³é”®å­—</h4><p>ç”±äºå­˜åœ¨ç±»å‹æ“¦é™¤ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•åœ¨è¿è¡Œæ—¶è·å–æ³›å‹çš„å…·ä½“ç±»å‹ï¼Œæœ‰äº›æ“ä½œæ— æ³•å®ç°ï¼Œæ¯”å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">testOne</span><span class="hljs-params">(Object param)</span>&#123;<br>    <span class="hljs-keyword">if</span>(param <span class="hljs-keyword">instanceof</span> T)&#123;<br>        System.out.println(<span class="hljs-string">&quot;T&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œåœ¨ kotlin ä¸­ä¹Ÿä¸è¡Œã€‚<br>ä½†åœ¨ java ä¸­æˆ‘ä»¬é€šå¸¸ä¼šä¼ å…¥ä¸€ä¸ª<code>Class&lt;T&gt;</code>æ¥åšç›¸åº”çš„æ“ä½œï¼Œåœ¨ kotlin ä¸­åŒæ ·ä¹Ÿå¯ä»¥ï¼Œä¸è¿‡ kotlin ä¸­æœ‰ä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ³•:ä½¿ç”¨<code>reified</code>é…åˆ<code>inline</code>æ¥å®ç°</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T&gt;</span> <span class="hljs-title">printIfTypeMatch</span><span class="hljs-params">(item: <span class="hljs-type">Any</span>)</span></span> &#123;<br>    <span class="hljs-keyword">if</span> (item <span class="hljs-keyword">is</span> T) &#123; <span class="hljs-comment">// ğŸ‘ˆ è¿™é‡Œå°±ä¸ä¼šåœ¨æç¤ºé”™è¯¯äº†</span><br>        println(item)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ç»å¸¸ç”¨çš„ gsonè§£ææ•°æ®ã€ååºåˆ—åŒ–çš„æ—¶å€™ç»å¸¸é‡åˆ°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">fromJson</span><span class="hljs-params">(String json, Class&lt;T&gt; classOfT)</span> <span class="hljs-keyword">throws</span> JsonSyntaxException &#123; <br>    <br>&#125; <br></code></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ˜¯é€šè¿‡å¤šä¼ å…¥ä¸€ä¸ª<code>Class&lt;T&gt;</code>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨ kotlin ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰©å±•æ¥å˜åŒ–ä¸€ä¸‹</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T&gt;</span> Gson.<span class="hljs-title">fromJson</span><span class="hljs-params">(json: <span class="hljs-type">String</span>)</span></span>: T&#123; <br>     <span class="hljs-keyword">return</span> fromJson(json, T::<span class="hljs-keyword">class</span>.java) <br> &#125; <br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ç»™ Gson æ·»åŠ äº†ä¸€ä¸ªæ‰©å±•æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œé€šè¿‡<code>inline</code>å’Œ<code>reified</code>å…³é”®å­—å°†æ³›å‹<code>T</code>å˜æˆäº†ä¸€ä¸ªçœŸå®å¯ç”¨çš„ç±»å‹ï¼Œè¿™ä¸¤ä¸ªå…³é”®å­—ç¼ºä¸€ä¸å¯ã€‚è¿™é‡Œå°±ç®€å•çš„è®¤ä¸ºå†…è”æ–¹æ³•(inline)æ˜¯å°†æ–¹æ³•åœ¨ç¼–è¯‘æ—¶å¤åˆ¶åˆ°è°ƒç”¨å¤„ï¼Œä½¿å¾—æ³›å‹ T çš„ç±»å‹åœ¨ç¼–è¯‘æ—¶å°±å¯ä»¥ç¡®å®šã€‚å½“ç„¶è¿™ä¹ˆç†è§£ä¸æ˜¯ç‰¹åˆ«æ­£ç¡®ã€‚åé¢å­¦åˆ°<code>inline</code>ã€<code>noinline</code>ã€<code>crossinline</code>è¿™å‡ ä¸ªå…³é”®å­—çš„æ—¶å€™å†è¯´å§</p><p>å‚è€ƒï¼š</p><p><a href="https://book.kotlincn.net/text/generics.html">æ³›å‹ï¼šinã€outã€where</a><br><a href="https://kotlinlang.org/docs/generics.html">Generics: in, out, where</a><br><a href="https://ethanhua.github.io/2018/01/09/genericity/">æ·±å…¥ç†è§£Javaå’ŒKotlinä¸­çš„æ³›å‹</a><br><a href="https://zhuanlan.zhihu.com/p/143380842">æ·±å…¥è§£æKotlin æ³›å‹</a></p><hr><p>å·²å­¦ä¹ ï¼š</p><ul><li><p>æ‰©å±•</p><ul><li><input type='checkbox' disabled='true' checked>æ‰©å±•å‡½æ•°</input></li><li><input type='checkbox' disabled='true' checked>æ‰©å±•å±æ€§</input></li><li><input type='checkbox' disabled='true' checked>ä½œç”¨åŸŸ</input></li></ul></li><li><p>å‡½æ•°ç±»å‹</p><ul><li><input type='checkbox' disabled='true' checked>å¸¦æœ‰æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹</input></li><li><input type='checkbox' disabled='true' checked>Lambdaè¡¨è¾¾å¼</input></li><li><input type='checkbox' disabled='true' checked>SAM è½¬æ¢</input></li></ul></li><li><p>æ³›å‹</p><ul><li><input type='checkbox' disabled='true' checked>é€†å˜</input></li><li><input type='checkbox' disabled='true' checked>åå˜</input></li><li><input type='checkbox' disabled='true' checked>ç±»å‹æŠ•å½±</input></li><li><input type='checkbox' disabled='true' checked>æ˜ŸæŠ•å½±</input></li><li><input type='checkbox' disabled='true' checked>æ³›å‹çº¦æŸ</input></li></ul></li></ul><p>æœªå­¦ä¹ ï¼š</p><ul><li><p>å…³é”®å­—</p><ul><li>object</li><li>Unit</li><li>Nothing</li><li>withã€letã€runã€applyã€also</li><li>inline,noinline,crossinline</li></ul></li><li><p>å§”æ‰˜</p><ul><li>å§”æ‰˜ç±»</li><li>å§”æ‰˜å±æ€§</li><li>è‡ªå®šä¹‰å§”æ‰˜</li></ul></li><li><p>åç¨‹</p><ul><li>å¯åŠ¨</li><li>æŒ‚èµ·</li><li>Job</li><li>Context</li><li>Channel</li><li>Flow</li><li>select</li><li>å¹¶å‘ã€å¼‚å¸¸</li><li>launch</li><li>Dispatchers</li><li>CoroutineScope</li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æ³›å‹ä¸­æ¶‰åŠåˆ°çš„æ¦‚å¿µä¹Ÿä¸å°‘,å‹å˜(Variance)ã€é€†å˜(Contravariance)ã€åå˜(Covariance)ã€ä¸å˜(Invariant).åœ¨ kotlin ä¸­è¿˜æœ‰ä¸‰ä¸ªå…³é”®å­—&lt;code&gt;in&lt;/code&gt;ã€&lt;code&gt;out&lt;/code&gt;ã€&lt;code&gt;where&lt;/</summary>
      
    
    
    
    
    <category term="Android" scheme="https://blog.huangyuanlove.com/tags/Android/"/>
    
    <category term="Kotlin" scheme="https://blog.huangyuanlove.com/tags/Kotlin/"/>
    
  </entry>
  
  <entry>
    <title>kotlinä½œç”¨åŸŸå‡½æ•°:runã€letã€alsoã€applyã€with</title>
    <link href="https://blog.huangyuanlove.com/2024/04/28/kotlin%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%87%BD%E6%95%B0-run%E3%80%81let%E3%80%81also%E3%80%81apply%E3%80%81with/"/>
    <id>https://blog.huangyuanlove.com/2024/04/28/kotlin%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%87%BD%E6%95%B0-run%E3%80%81let%E3%80%81also%E3%80%81apply%E3%80%81with/</id>
    <published>2024-04-28T08:23:11.000Z</published>
    <updated>2024-04-30T02:54:43.487Z</updated>
    
    <content type="html"><![CDATA[<p>åˆšå¼€å§‹å­¦ä¹  kotlin çš„æ—¶å€™ï¼Œå¯¹äºè¿™äº›ä½œç”¨åŸŸå‡½æ•°ä¸€å¤´é›¾æ°´ï¼Œæä¸æ˜ç™½ä¸ºä»€ä¹ˆè¦å¼„å‡ºæ¥è¿™ä¹ˆå¤šä¸œè¥¿ã€‚ç°åœ¨æ¥çœ‹çœ‹ä»–ä»¬å…·ä½“çš„åŒºåˆ«ä»¥åŠé€‚ç”¨çš„åœºæ™¯ã€‚<br>Kotlin æ ‡å‡†åº“åŒ…å«å‡ ä¸ªå‡½æ•°ï¼Œå®ƒä»¬çš„å”¯ä¸€ç›®çš„æ˜¯åœ¨å¯¹è±¡çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œä»£ç å—ã€‚ å½“å¯¹ä¸€ä¸ªå¯¹è±¡è°ƒç”¨è¿™æ ·çš„å‡½æ•°å¹¶æä¾›ä¸€ä¸ª<code>lambdaè¡¨è¾¾å¼</code>æ—¶ï¼Œå®ƒä¼šå½¢æˆä¸€ä¸ªä¸´æ—¶ä½œç”¨åŸŸã€‚åœ¨æ­¤ä½œç”¨åŸŸä¸­ï¼Œå¯ä»¥è®¿é—®è¯¥å¯¹è±¡è€Œæ— éœ€å…¶åç§°ã€‚è¿™äº›å‡½æ•°ç§°ä¸ºä½œç”¨åŸŸå‡½æ•°ã€‚ å…±æœ‰ä»¥ä¸‹äº”ç§ï¼š<code>let</code>ã€<code>run</code>ã€<code>with</code>ã€<code>apply</code>ä»¥åŠ<code>also</code>ã€‚<br>åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆæŠŠä» kotlin å®˜æ–¹ä¸Šæ‰’æ‹‰ä¸‹æ¥çš„ç»“è®ºæ”¾è¿™é‡Œ</p><span id="more"></span><p><a href="https://book.kotlincn.net/text/scope-functions.html">ä½œç”¨åŸŸå‡½æ•°ä¸­æ–‡ç‰ˆ</a><br><a href="https://kotlinlang.org/docs/scope-functions.html">ä½œç”¨åŸŸå‡½æ•°è‹±æ–‡ç‰ˆ</a></p><h3 id="æ€»ç»“åœ¨å‰é¢"><a href="#æ€»ç»“åœ¨å‰é¢" class="headerlink" title="æ€»ç»“åœ¨å‰é¢"></a>æ€»ç»“åœ¨å‰é¢</h3><p>æ–‡ç« å¤ªé•¿å¤ªå•°å—¦ï¼Œç›´æ¥çœ‹è¿™é‡Œçš„ç»“è®ºï¼š</p><table><thead><tr><th>å‡½æ•°</th><th>å¯¹è±¡å¼•ç”¨</th><th>è¿”å›å€¼</th><th>æ˜¯å¦æ˜¯æ‰©å±•å‡½æ•°</th></tr></thead><tbody><tr><td>let</td><td>it</td><td>Lambdaè¡¨è¾¾å¼ç»“æœ</td><td>æ˜¯</td></tr><tr><td>run</td><td>this</td><td>Lambdaè¡¨è¾¾å¼ç»“æœ</td><td>æ˜¯</td></tr><tr><td>run</td><td>-</td><td>Lambdaè¡¨è¾¾å¼ç»“æœ</td><td>ä¸æ˜¯ï¼šè°ƒç”¨æ— éœ€ä¸Šä¸‹æ–‡å¯¹è±¡</td></tr><tr><td>with</td><td>this</td><td>Lambdaè¡¨è¾¾å¼ç»“æœ</td><td>ä¸æ˜¯ï¼šæŠŠä¸Šä¸‹æ–‡å¯¹è±¡å½“åšå‚æ•°</td></tr><tr><td>apply</td><td>this</td><td>ä¸Šä¸‹æ–‡å¯¹è±¡</td><td>æ˜¯</td></tr><tr><td>also</td><td>it</td><td>ä¸Šä¸‹æ–‡å¯¹è±¡</td><td>æ˜¯</td></tr></tbody></table><p>ä»¥ä¸‹æ˜¯æ ¹æ®é¢„æœŸç›®çš„é€‰æ‹©ä½œç”¨åŸŸå‡½æ•°çš„ç®€çŸ­æŒ‡å—ï¼š</p><ul><li>å¯¹ä¸€ä¸ªéç©ºï¼ˆnon-nullï¼‰å¯¹è±¡æ‰§è¡Œ lambda è¡¨è¾¾å¼ï¼šlet</li><li>å°†è¡¨è¾¾å¼ä½œä¸ºå˜é‡å¼•å…¥ä¸ºå±€éƒ¨ä½œç”¨åŸŸä¸­ï¼šlet</li><li>å¯¹è±¡é…ç½®ï¼šapply</li><li>å¯¹è±¡é…ç½®å¹¶ä¸”è®¡ç®—ç»“æœï¼šrun</li><li>åœ¨éœ€è¦è¡¨è¾¾å¼çš„åœ°æ–¹è¿è¡Œè¯­å¥ï¼šéæ‰©å±•çš„ run</li><li>é™„åŠ æ•ˆæœï¼šalso</li><li>ä¸€ä¸ªå¯¹è±¡çš„ä¸€ç»„å‡½æ•°è°ƒç”¨ï¼šwith<br>ä¸åŒä½œç”¨åŸŸå‡½æ•°çš„ä½¿ç”¨åœºæ™¯å­˜åœ¨é‡å ï¼Œå¯ä»¥æ ¹æ®é¡¹ç›®æˆ–å›¢é˜Ÿä¸­ä½¿ç”¨çš„ç‰¹å®šçº¦å®šæ¥é€‰æ‹©ä½¿ç”¨å“ªäº›å‡½æ•°ã€‚</li></ul><p><font color='red'>è™½ç„¶ä½œç”¨åŸŸå‡½æ•°å¯ä»¥è®©ä»£ç æ›´åŠ ç®€æ´ï¼Œä½†æ˜¯è¦é¿å…è¿‡åº¦ä½¿ç”¨å®ƒä»¬ï¼šè¿™ä¼šä½¿ä»£ç éš¾ä»¥é˜…è¯»å¹¶å¯èƒ½å¯¼è‡´é”™è¯¯ã€‚ æˆ‘ä»¬è¿˜å»ºè®®é¿å…åµŒå¥—ä½œç”¨åŸŸå‡½æ•°ï¼ŒåŒæ—¶é“¾å¼è°ƒç”¨å®ƒä»¬æ—¶è¦å°å¿ƒï¼šå› ä¸ºå¾ˆå®¹æ˜“æ··æ·†å½“å‰ä¸Šä¸‹æ–‡å¯¹è±¡ä¸<code>this</code>æˆ–<code>it</code>çš„å€¼ã€‚</font></p><h3 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h3><p>å‡å¦‚æˆ‘ä»¬æœ‰è¿™ä¹ˆä¸€ä¸ªæ•°æ®ç±»</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">data</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span></span>(<span class="hljs-keyword">var</span> name: String, <span class="hljs-keyword">var</span> price: <span class="hljs-built_in">Int</span>) &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">changePrice</span><span class="hljs-params">(price: <span class="hljs-type">Int</span>)</span></span> &#123;<br>        <span class="hljs-keyword">this</span>.price = price<br>    &#125;<br>&#125;<br><span class="hljs-keyword">val</span> book = Book(<span class="hljs-string">&quot;book name&quot;</span>, <span class="hljs-number">68</span>)<br></code></pre></td></tr></table></figure><h4 id="å‡½æ•°å£°æ˜"><a href="#å‡½æ•°å£°æ˜" class="headerlink" title="å‡½æ•°å£°æ˜"></a>å‡½æ•°å£°æ˜</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> T.<span class="hljs-title">also</span><span class="hljs-params">(block: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span>: T<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> T.<span class="hljs-title">apply</span><span class="hljs-params">(block: <span class="hljs-type">T</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span>: T <br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T, R&gt;</span> T.<span class="hljs-title">let</span><span class="hljs-params">(block: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">R</span>)</span></span>: R<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T, R&gt;</span> T.<span class="hljs-title">run</span><span class="hljs-params">(block: <span class="hljs-type">T</span>.() -&gt; <span class="hljs-type">R</span>)</span></span>: R<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;R&gt;</span> <span class="hljs-title">run</span><span class="hljs-params">(block: () -&gt; <span class="hljs-type">R</span>)</span></span>: R<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T, R&gt;</span> <span class="hljs-title">with</span><span class="hljs-params">(receiver: <span class="hljs-type">T</span>, block: <span class="hljs-type">T</span>.() -&gt; <span class="hljs-type">R</span>)</span></span>: R<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æŠŠçœ‹èµ·æ¥ç›¸è¿‘çš„ä½œç”¨åŸŸå‡½æ•°çš„å£°æ˜æ”¾åœ¨ä¸€å—å¯¹æ¯”ç€çœ‹ï¼Œçœ‹åˆ°è¿™é‡Œå°±æ¸…æ¥šäº†çš„å°±ä¸è¦å¾€ä¸‹çœ‹äº†ï¼Œçœ‹äº†ä¹Ÿæ˜¯æµªè´¹æ—¶é—´ã€‚</p><h4 id="also"><a href="#also" class="headerlink" title="also"></a>also</h4><p>å‡½æ•°å£°æ˜</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> T.<span class="hljs-title">also</span><span class="hljs-params">(block: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span>: T<br></code></pre></td></tr></table></figure><p><code>also</code>å‡½æ•°æ˜¯å¯¹æ³›å‹ T çš„æ‰©å±•å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå‚æ•°ç±»å‹ä¸ºTã€æ— è¿”å›å€¼(è¿”å›å€¼ä¸ºUnitç±»å‹)çš„å‡½æ•°ï¼Œä¸”<code>also</code>å‡½æ•°çš„è¿”å›å€¼å°±æ˜¯è°ƒç”¨è€…ã€‚</p><ul><li>ä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸º lambda è¡¨è¾¾å¼çš„å‚æ•°ï¼ˆitï¼‰æ¥è®¿é—®ã€‚</li><li>è¿”å›å€¼æ˜¯ä¸Šä¸‹æ–‡å¯¹è±¡æœ¬èº«ã€‚</li></ul><p>å¯¹äºæ‰§è¡Œä¸€äº›å°†ä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸ºå‚æ•°çš„æ“ä½œå¾ˆæœ‰ç”¨ã€‚ å¯¹äºéœ€è¦å¼•ç”¨å¯¹è±¡è€Œä¸æ˜¯å…¶å±æ€§ä¸å‡½æ•°çš„æ“ä½œï¼Œæˆ–è€…ä¸æƒ³å±è”½æ¥è‡ªå¤–éƒ¨ä½œç”¨åŸŸçš„ this å¼•ç”¨æ—¶ï¼Œè¯·ä½¿ç”¨ alsoã€‚<br>å½“ä½ åœ¨ä»£ç ä¸­çœ‹åˆ° also æ—¶ï¼Œå¯ä»¥å°†å…¶ç†è§£ä¸º<strong>å¹¶ä¸”ç”¨è¯¥å¯¹è±¡æ‰§è¡Œä»¥ä¸‹æ“ä½œ</strong></p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> alsoResult = book.also &#123;<br>    it.changePrice(<span class="hljs-number">20</span>)<br>    it.name = <span class="hljs-string">&quot;alsoResult&quot;</span><br>&#125;<br>println(<span class="hljs-string">&quot;alsoResult <span class="hljs-variable">$alsoResult</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæ‰“å°ç»“æœæ˜¯<code>alsoResult Book(name=alsoResult, price=20)</code>,çœ‹æºç çš„è¯ï¼Œå¯ä»¥ç®€å•çš„é‡Œé¢ä¸ºè°ƒç”¨äº†ä¸€ä¸‹ä¼ å…¥çš„å‡½æ•°ï¼Œç„¶åè¿”å›äº†è°ƒç”¨è€…</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> T.<span class="hljs-title">also</span><span class="hljs-params">(block: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span>: T &#123;<br>    contract &#123;<br>        callsInPlace(block, InvocationKind.EXACTLY_ONCE)<br>    &#125;<br>    block(<span class="hljs-keyword">this</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h4><p>å‡½æ•°å£°æ˜</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> T.<span class="hljs-title">apply</span><span class="hljs-params">(block: <span class="hljs-type">T</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span>: T<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å¾—å‡ºæ¥<code>apply</code>æ˜¯æ³›å‹ T çš„æ‰©å±•å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå¸¦æœ‰ T ç±»å‹æ¥æ”¶è€…çš„æ— å‚ã€æ— è¿”å›å€¼çš„å‡½æ•°ï¼Œå¹¶ä¸”<code>apply</code>å‡½æ•°è¿”å›å€¼å°±æ˜¯ T ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨è€…çš„ç±»å‹ã€‚å› ä¸ºè¿™é‡Œå‚æ•°ä¸­çš„ T æ˜¯ä½œä¸ºæ¥æ”¶è€…ç±»å‹ï¼Œè€Œä¸æ˜¯å‚æ•°ï¼Œæ‰€ä»¥åœ¨ä¼ å…¥çš„å‡½æ•°ä¸­éœ€è¦ç”¨<code>this</code>è€Œé<code>it</code>æ¥æŒ‡ä»£è°ƒç”¨è€…ã€‚<br>ç”¨æ³•å’Œ<code>also</code>ç›¸å·®æ— å‡ ï¼Œåªä¸è¿‡ä¸€ä¸ªæ˜¯æ¥æ”¶è€…ç±»å‹ï¼Œä¸€ä¸ªæ˜¯å‚æ•°ã€‚</p><ul><li>ä¸Šä¸‹æ–‡å¯¹è±¡ ä½œä¸ºæ¥æ”¶è€…ï¼ˆthisï¼‰æ¥è®¿é—®ã€‚</li><li>è¿”å›å€¼ æ˜¯ä¸Šä¸‹æ–‡å¯¹è±¡æœ¬èº«ã€‚</li></ul><p>å¯¹äºä¸è¿”å›å€¼ä¸”ä¸»è¦åœ¨æ¥æ”¶è€…ï¼ˆthisï¼‰å¯¹è±¡çš„æˆå‘˜ä¸Šè¿è¡Œçš„ä»£ç å—ä½¿ç”¨å®ƒã€‚applyæœ€å¸¸è§çš„ä½¿ç”¨åœºæ™¯æ˜¯ç”¨äºå¯¹è±¡é…ç½®ã€‚è¿™æ ·çš„è°ƒç”¨å¯ä»¥ç†è§£ä¸º<strong>å°†ä»¥ä¸‹èµ‹å€¼æ“ä½œåº”ç”¨äºå¯¹è±¡</strong>ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> applyResult = book.apply &#123;<br>    changePrice(<span class="hljs-number">200</span>)<br>    name = <span class="hljs-string">&quot;applyResult&quot;</span><br>&#125;<br>println(<span class="hljs-string">&quot;applyResult <span class="hljs-variable">$applyResult</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæ‰“å°çš„ç»“æœæ˜¯<code>applyResult Book(name=applyResult, price=200)</code>.<br>æºç ä¹Ÿå’Œ<code>also</code>å‡ ä¹ä¸€æ ·</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> T.<span class="hljs-title">also</span><span class="hljs-params">(block: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span>: T &#123;<br>    contract &#123;<br>        callsInPlace(block, InvocationKind.EXACTLY_ONCE)<br>    &#125;<br>    block(<span class="hljs-keyword">this</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="let"><a href="#let" class="headerlink" title="let"></a>let</h4><p>å‡½æ•°ç±»å‹å£°æ˜å¦‚ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T, R&gt;</span> T.<span class="hljs-title">let</span><span class="hljs-params">(block: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">R</span>)</span></span>: R<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œlet æ˜¯å¯¹æ³›å‹ T çš„æ‰©å±•å‡½æ•°ï¼Œè¯¥æ‰©å±•å‡½æ•°æ¥æ”¶ä¸€ä¸ªå‡½æ•°å‚æ•°ï¼Œå¹¶ä¸”å‡½æ•°å‚æ•°çš„æ¥æ”¶ä¸€ä¸ª T ç±»å‹çš„å‚æ•°ï¼Œä¸”è¿”å›å€¼æ˜¯ R ç±»å‹ï¼Œä¹Ÿæ˜¯<code>let</code>è¿™ä¸ªæ‰©å±•å‡½æ•°çš„è¿”å›å€¼ç±»å‹ã€‚</p><ul><li>ä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸º lambda è¡¨è¾¾å¼çš„å‚æ•°ï¼ˆitï¼‰æ¥è®¿é—®ã€‚</li><li>è¿”å›å€¼æ˜¯ lambda è¡¨è¾¾å¼çš„ç»“æœã€‚</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> letResult = book.let &#123;<br>    it.changePrice(<span class="hljs-number">100</span>)<br>    it.name = <span class="hljs-string">&quot;letResult&quot;</span><br>&#125;<br>println(<span class="hljs-string">&quot;letResult <span class="hljs-variable">$letResult</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¼ å…¥çš„æ˜¯ä¸€ä¸ª Lambda è¡¨è¾¾å¼ï¼Œå‰é¢è¯´è¿‡ï¼Œå¯¹äºå•å‚æ•°å€¼çš„Lambda è¡¨è¾¾å¼ï¼Œå‚æ•°ä¼šè¢«éšå¼å£°æ˜ä¸º<code>it</code>,å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªå…·åæ„ä¹‰çš„å˜é‡ï¼Œæ¯”å¦‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> letResult = book.let &#123; bookEntry: Book -&gt;<br>    bookEntry.changePrice(<span class="hljs-number">100</span>)<br>    bookEntry.name = <span class="hljs-string">&quot;letResult&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæ‰“å°çš„ç»“æœæ˜¯<code>letResult kotlin.Unit</code>ã€‚å› ä¸ºå¯¹äº Lambda è¡¨è¾¾å¼æ¥è®²ï¼Œå¦‚æœæœ€åä¸€æ¡è¯­å¥æ˜¯éèµ‹å€¼è¯­å¥ï¼Œåˆ™è¿”å›è¯¥è¯­å¥çš„å€¼ï¼›å¦‚æœæ˜¯èµ‹å€¼è¯­å¥ï¼Œåˆ™è¿”å› Unitã€‚<br>æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™æ¥è¿”å›æˆ‘ä»¬éœ€è¦çš„å€¼ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> letResult = book.let &#123;<br>    it<span class="hljs-comment">//è¿”å›å€¼å°±æ˜¯ä¼ å…¥çš„ book å¯¹è±¡</span><br>&#125;<br><span class="hljs-keyword">val</span> letResult = book.let &#123;<br>    <span class="hljs-number">1</span><span class="hljs-comment">//è¿”å›å€¼å°±æ˜¯1</span><br>&#125;<br><span class="hljs-keyword">val</span> letResult = book.let &#123;<br>     <span class="hljs-keyword">return</span><span class="hljs-symbol">@let</span> <span class="hljs-number">1</span><span class="hljs-comment">//ä¹‹å‰çš„æ–‡ç« ä¸­è¯´è¿‡çš„æ˜¾ç¤ºæŒ‡å®šè¿”å›å€¼ï¼Œæ˜¯ 1</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä»å¦å¤–ä¸€ä¸ªè§’åº¦çœ‹ï¼Œ<code>let</code>å’Œ <code>also</code>ã€<code>apply</code>ä¹Ÿå·®ä¸å¤šï¼Œåªä¸è¿‡å¤šäº†ä¸€ä¸ªè¿”å›å€¼ç±»å‹ï¼Œè¿”å›å€¼å°±æ˜¯ä¼ å…¥çš„ Lambda è¡¨è¾¾å¼çš„è¿”å›å€¼<br>æºç ä¹Ÿå·®ä¸äº†å¤šå°‘</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T, R&gt;</span> T.<span class="hljs-title">let</span><span class="hljs-params">(block: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">R</span>)</span></span>: R &#123;<br>    contract &#123;<br>        callsInPlace(block, InvocationKind.EXACTLY_ONCE)<br>    &#125;<br>    <span class="hljs-keyword">return</span> block(<span class="hljs-keyword">this</span>)<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>let å¯ç”¨äºåœ¨è°ƒç”¨é“¾çš„ç»“æœä¸Šè°ƒç”¨ä¸€ä¸ªæˆ–å¤šä¸ªå‡½æ•°ã€‚</li><li>let ç»å¸¸ç”¨äºæ‰§è¡ŒåŒ…å«éç©ºå€¼ä»£ç å—ã€‚å¦‚éœ€å¯¹éç©ºå¯¹è±¡æ‰§è¡Œæ“ä½œï¼Œ å¯å¯¹å…¶ä½¿ç”¨å®‰å…¨è°ƒç”¨æ“ä½œç¬¦<code>?.</code>å¹¶è°ƒç”¨ let åœ¨ lambda è¡¨è¾¾å¼ä¸­æ‰§è¡Œæ“ä½œã€‚</li></ul><h4 id="run"><a href="#run" class="headerlink" title="run"></a>run</h4><p><code>run</code>è¿™ä¸ªå‡½æ•°ç»™äº†ä¸¤ç§æ–¹å¼</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T, R&gt;</span> T.<span class="hljs-title">run</span><span class="hljs-params">(block: <span class="hljs-type">T</span>.() -&gt; <span class="hljs-type">R</span>)</span></span>: R<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;R&gt;</span> <span class="hljs-title">run</span><span class="hljs-params">(block: () -&gt; <span class="hljs-type">R</span>)</span></span>: R<br></code></pre></td></tr></table></figure><p>å…ˆçœ‹ç¬¬ä¸€ç§ï¼Œçœ‹èµ·æ¥å°±æ˜¯æŠŠ<code>let</code>ä¸­å‡½æ•°å‚æ•°ä¸­çš„ T ç±»å‹å‚æ•°æ”¹æˆäº†æ¥æ”¶è€…ç±»å‹ï¼Œä¹Ÿæ˜¯è¿”å› R ç±»å‹ï¼›è¿™å’Œ<code>apply</code>ä¸<code>also</code>çš„åŒºåˆ«æ˜¯ä¸€æ ·çš„ã€‚</p><ul><li>ä¸Šä¸‹æ–‡å¯¹è±¡ ä½œä¸ºæ¥æ”¶è€…ï¼ˆthisï¼‰æ¥è®¿é—®ã€‚</li><li>è¿”å›å€¼ æ˜¯ lambda è¡¨è¾¾å¼ç»“æœã€‚</li></ul><p>å½“ lambda è¡¨è¾¾å¼åŒæ—¶åˆå§‹åŒ–å¯¹è±¡å¹¶è®¡ç®—è¿”å›å€¼æ—¶ï¼Œrun å¾ˆæœ‰ç”¨ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> runResult = book.run &#123;<br>    name = <span class="hljs-string">&quot;runResult&quot;</span><br>    changePrice(<span class="hljs-number">110</span>)<br>    <span class="hljs-keyword">this</span> <span class="hljs-comment">//ä½œä¸ºè¿”å›å€¼</span><br>&#125;<br>println(<span class="hljs-string">&quot;runResult <span class="hljs-variable">$runResult</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>æºç æ˜¯è¿™æ ·çš„</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T, R&gt;</span> T.<span class="hljs-title">run</span><span class="hljs-params">(block: <span class="hljs-type">T</span>.() -&gt; <span class="hljs-type">R</span>)</span></span>: R &#123;<br>    contract &#123;<br>        callsInPlace(block, InvocationKind.EXACTLY_ONCE)<br>    &#125;<br>    <span class="hljs-keyword">return</span> block()<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¬¬äºŒç§</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> otherRunResult =  run &#123;<br>    Book(<span class="hljs-string">&quot;run&quot;</span>, <span class="hljs-number">120</span>) <span class="hljs-comment">//ä½œä¸ºè¿”å›å€¼</span><br>&#125;<br>println(<span class="hljs-string">&quot;otherRunResult <span class="hljs-variable">$otherRunResult</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>æºç </p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;R&gt;</span> <span class="hljs-title">run</span><span class="hljs-params">(block: () -&gt; <span class="hljs-type">R</span>)</span></span>: R &#123;<br>    contract &#123;<br>        callsInPlace(block, InvocationKind.EXACTLY_ONCE)<br>    &#125;<br>    <span class="hljs-keyword">return</span> block()<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¹Ÿæ²¡å•¥å¥½è¯´çš„ï¼Œåªä¸è¿‡æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰è¾“å…¥å‚æ•°ï¼Œåªæ˜¯å¯ä»¥ä½¿ä½ åœ¨éœ€è¦è¡¨è¾¾å¼çš„åœ°æ–¹å°±å¯ä»¥æ‰§è¡Œä¸€ä¸ªè¯­å¥ã€‚</p><h4 id="with"><a href="#with" class="headerlink" title="with"></a>with</h4><p>å‡½æ•°å£°æ˜</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T, R&gt;</span> <span class="hljs-title">with</span><span class="hljs-params">(receiver: <span class="hljs-type">T</span>, block: <span class="hljs-type">T</span>.() -&gt; <span class="hljs-type">R</span>)</span></span>: R<br></code></pre></td></tr></table></figure><p><code>with</code>å¹¶ä¸æ˜¯æ‰©å±•å‡½æ•°ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªT ç±»å‹çš„receiverï¼Œå¯ä»¥åœ¨ block ä¸­è®¿é—®è¿™ä¸ªreceiverçš„æ–¹æ³•å’Œå±æ€§ï¼Œ</p><ul><li>ä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸ºæ¥æ”¶è€…ï¼ˆthisï¼‰ä½¿ç”¨ã€‚</li><li>è¿”å›å€¼æ˜¯ lambda è¡¨è¾¾å¼ç»“æœã€‚</li></ul><p>å»ºè®®å½“ä¸éœ€è¦ä½¿ç”¨ lambda è¡¨è¾¾å¼ç»“æœæ—¶ï¼Œä½¿ç”¨ with æ¥è°ƒç”¨ä¸Šä¸‹æ–‡å¯¹è±¡ä¸Šçš„å‡½æ•°ã€‚ åœ¨ä»£ç ä¸­ï¼Œwith å¯ä»¥ç†è§£ä¸º<strong>å¯¹äºè¿™ä¸ªå¯¹è±¡ï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œ.</strong></p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> withResult = with(book) &#123;<br>    changePrice(<span class="hljs-number">300</span>)<br>    name = <span class="hljs-string">&quot;withResult&quot;</span><br>    <span class="hljs-keyword">this</span> <span class="hljs-comment">//ä½œä¸ºè¿”å›å€¼</span><br>&#125;<br>println(<span class="hljs-string">&quot;withResult <span class="hljs-variable">$withResult</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„æ‰“å°ç»“æœæ˜¯<code>withResult Book(name=withResult, price=300)</code></p><h3 id="å¦‚ä½•é€‰æ‹©"><a href="#å¦‚ä½•é€‰æ‹©" class="headerlink" title="å¦‚ä½•é€‰æ‹©"></a>å¦‚ä½•é€‰æ‹©</h3><p>è¿™é‡Œå†æ¬è¿ä¸€ä¸ªæ€»ç»“çš„è¡¨æ ¼</p><table>    <tr>         <th >å‡½æ•°å</th>         <th >ä½œç”¨</th>         <th >åº”ç”¨åœºæ™¯</th>         <th >å¤‡æ³¨</th>     </tr>    <tr>      <td>let</td>      <td rowspan="2">å®šä¹‰ä¸€ä¸ªå˜é‡åœ¨ç‰¹å®šä½œç”¨åŸŸå†…<br/>ç»Ÿä¸€åšåˆ¤ç©ºå¤„ç†</td>      <td rowspan="2">æ˜ç¡®ä¸€ä¸ªå˜é‡æ‰€å¤„ç‰¹å®šçš„ä½œç”¨åŸŸèŒƒå›´å†…å¯ä½¿ç”¨<br/>é’ˆå¯¹ä¸€ä¸ªå¯ç©ºå¯¹è±¡ç»Ÿä¸€åšåˆ¤ç©ºå¤„ç†</td>      <td rowspan="2">åŒºåˆ«åœ¨äºè¿”å›å€¼<br/>letå‡½æ•°ï¼šè¿”å›å€¼=æœ€åä¸€è¡Œ|returnçš„è¡¨è¾¾å¼<br/>alsoå‡½æ•°ï¼šè¿”å›å€¼=ä¼ å…¥å¯¹è±¡æœ¬èº«</td>    </tr>    <tr>      <td>also</td>    </tr>    <tr>      <td>with</td>      <td>è°ƒç”¨åŒä¸€ä¸ªå¯¹è±¡çš„å¤šä¸ªæ–¹æ³•|å±æ€§æ—¶ï¼Œå¯ä»¥çœå»å¯¹è±¡åï¼Œç›´æ¥è°ƒç”¨æ–¹æ³•ã€è®¿é—®å±æ€§</td>      <td>éœ€è¦å¤šæ¬¡è°ƒç”¨åŒä¸€ä¸ªå¯¹è±¡çš„å±æ€§|æ–¹æ³•</td>      <td>è¿”å›å€¼=æœ€åä¸€è¡Œ|returnè¡¨è¾¾å¼</td>    </tr>    <tr>      <td>run</td>      <td rowspan="2">ç»“åˆäº†let å‡½æ•°å’Œ with å‡½æ•°çš„ä½œç”¨</td>      <td>1.è°ƒç”¨åŒä¸€ä¸ªå¯¹è±¡çš„å¤šä¸ªæ–¹æ³•/å±æ€§æ—¶å¯ä»¥çœå»å¯¹è±¡åé‡å¤ï¼Œç›´æ¥è°ƒç”¨æ–¹æ³•å /å±æ€§å³å¯<br/>2.å®šä¹‰ä¸€ä¸ªå˜é‡åœ¨ç‰¹å®šä½œç”¨åŸŸå†…<br/>3.ç»Ÿä¸€åšåˆ¤ç©ºå¤„</</td>      <td>ä¼˜ç‚¹:é¿å…äº†letå‡½æ•°å¿…é¡»ä½¿ç”¨itå‚æ•°æ›¿ä»£å¯¹è±¡å¼¥è¡¥äº†withå‡½æ•°æ— æ³•åˆ¤ç©ºçš„ç¼ºç‚¹</td>    </tr>    <tr>      <td>apply</td>      <td>å¯¹è±¡å®ä¾‹åˆå§‹åŒ–æ—¶éœ€è¦å¯¹å¯¹è±¡ä¸­çš„å±æ€§è¿›è¡Œèµ‹å€¼ä¸”è¿”å›è¯¥å¯¹è±¡</td>      <td>äºŒè€…åŒºåˆ«åœ¨äºè¿”å›å€¼:<br/>runå‡½æ•°è¿”å›æœ€åä¸€è¡Œçš„å€¼|è¡¨è¾¾å¼<br/>applyå‡½æ•°è¿”å›ä¼ å…¥çš„å¯¹è±¡çš„æœ¬èº«</td>    <tr></table><h3 id="å¦å¤–ä¸€ä¸ªè§’åº¦çš„é€‰æ‹©"><a href="#å¦å¤–ä¸€ä¸ªè§’åº¦çš„é€‰æ‹©" class="headerlink" title="å¦å¤–ä¸€ä¸ªè§’åº¦çš„é€‰æ‹©"></a>å¦å¤–ä¸€ä¸ªè§’åº¦çš„é€‰æ‹©</h3><h4 id="it-or-this"><a href="#it-or-this" class="headerlink" title="it or this"></a>it or this</h4><p>æ¯ä¸ªä½œç”¨åŸŸå‡½æ•°éƒ½ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼ä¹‹ä¸€æ¥å¼•ç”¨ä¸Šä¸‹æ–‡å¯¹è±¡</p><ol><li>ä½œä¸º lambda è¡¨è¾¾å¼çš„æ¥æ”¶è€… ï¼ˆthisï¼‰</li><li>ä½œä¸º lambda è¡¨è¾¾å¼çš„å‚æ•°ï¼ˆitï¼‰</li></ol><p>ä¸¤è€…éƒ½æä¾›äº†åŒæ ·çš„åŠŸèƒ½ï¼Œ<code>run</code>ã€<code>with</code>ä»¥åŠ<code>apply</code>é€šè¿‡å…³é”®å­—<code>this</code>å°†ä¸Šä¸‹æ–‡å¯¹è±¡å¼•ç”¨ä¸º<code>lambda</code>è¡¨è¾¾å¼çš„æ¥æ”¶è€…ã€‚ å› æ­¤ï¼Œåœ¨å®ƒä»¬çš„<code>lambdaè¡¨è¾¾å¼</code>ä¸­å¯ä»¥åƒåœ¨æ™®é€šçš„ç±»å‡½æ•°ä¸­ä¸€æ ·è®¿é—®ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚åœ¨å¤§å¤šæ•°åœºæ™¯ï¼Œå½“ä½ è®¿é—®æ¥æ”¶è€…å¯¹è±¡æ—¶ä½ å¯ä»¥çœç•¥<code>this</code>ï¼Œ æ¥è®©ä½ çš„ä»£ç æ›´ç®€çŸ­ã€‚ ç›¸å¯¹åœ°ï¼Œå¦‚æœçœç•¥äº†<code>this</code>ï¼Œå°±å¾ˆéš¾åŒºåˆ†æ¥æ”¶è€…å¯¹è±¡çš„æˆå‘˜åŠå¤–éƒ¨å¯¹è±¡æˆ–å‡½æ•°ã€‚å› æ­¤ï¼Œå¯¹äºä¸»è¦å¯¹å¯¹è±¡çš„æˆå‘˜è¿›è¡Œæ“ä½œï¼ˆè°ƒç”¨å…¶å‡½æ•°æˆ–èµ‹å€¼å…¶å±æ€§ï¼‰çš„lambdaè¡¨è¾¾å¼ï¼Œ å»ºè®®å°†ä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸ºæ¥æ”¶è€…ï¼ˆthisï¼‰ã€‚<br>åè¿‡æ¥ï¼Œ<code>let</code>åŠ<code>also</code>å°†ä¸Šä¸‹æ–‡å¯¹è±¡å¼•ç”¨ä¸º<code>lambdaè¡¨è¾¾å¼å‚æ•°</code>ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šå‚æ•°åï¼Œå¯¹è±¡å¯ä»¥ç”¨éšå¼é»˜è®¤åç§°<code>it</code>è®¿é—®ã€‚<code>it</code>æ¯”<code>this</code>ç®€çŸ­ï¼Œå¸¦æœ‰<code>it</code>çš„è¡¨è¾¾å¼é€šå¸¸æ›´æ˜“è¯»ã€‚ä¸è¿‡ï¼Œå½“è°ƒç”¨å¯¹è±¡å‡½æ•°æˆ–å±æ€§æ—¶ï¼Œä¸èƒ½åƒ<code>this</code>è¿™æ ·éšå¼åœ°è®¿é—®å¯¹è±¡ã€‚ å› æ­¤ï¼Œå½“ä¸Šä¸‹æ–‡å¯¹è±¡åœ¨ä½œç”¨åŸŸä¸­ä¸»è¦ç”¨ä½œå‡½æ•°è°ƒç”¨ä¸­çš„å‚æ•°æ—¶ï¼Œé€šè¿‡<code>it</code>è®¿é—®ä¸Šä¸‹æ–‡å¯¹è±¡ä¼šæ›´å¥½ã€‚ åœ¨ä»£ç å—ä¸­ä½¿ç”¨å¤šä¸ªå˜é‡æ—¶ï¼Œ<code>it</code>ä¹Ÿæ›´å¥½ä¸€äº›ã€‚</p><h4 id="è¿”å›å€¼"><a href="#è¿”å›å€¼" class="headerlink" title="è¿”å›å€¼"></a>è¿”å›å€¼</h4><p>æ ¹æ®è¿”å›ç»“æœï¼Œä½œç”¨åŸŸå‡½æ•°å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸¤ç±»ï¼š</p><p>apply åŠ also è¿”å›ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚<br>letã€run åŠ with è¿”å› lambda è¡¨è¾¾å¼ç»“æœ.<br>apply åŠ also çš„è¿”å›å€¼æ˜¯ä¸Šä¸‹æ–‡å¯¹è±¡æœ¬èº«ã€‚å› æ­¤ï¼Œå®ƒä»¬å¯ä»¥ä½œä¸ºè¾…åŠ©æ­¥éª¤åŒ…å«åœ¨è°ƒç”¨é“¾ä¸­ï¼šå¯ä»¥ç»§ç»­åœ¨åŒä¸€ä¸ªå¯¹è±¡ä¸Šä¸€ä¸ªæ¥ä¸€ä¸ªåœ°è¿›è¡Œé“¾å¼å‡½æ•°è°ƒç”¨ã€‚</p><h3 id="å†™åœ¨æœ€åçš„æ³¨æ„äº‹é¡¹"><a href="#å†™åœ¨æœ€åçš„æ³¨æ„äº‹é¡¹" class="headerlink" title="å†™åœ¨æœ€åçš„æ³¨æ„äº‹é¡¹"></a>å†™åœ¨æœ€åçš„æ³¨æ„äº‹é¡¹</h3><p>åœ¨æœ€å¼€å§‹çš„çº¢è‰²éƒ¨åˆ†ä¹Ÿæé«˜è¿‡å°½é‡ä¸è¦åµŒå¥—ä½¿ç”¨ä½œç”¨åŸŸå‡½æ•°ï¼Œè­¦æƒ•å¼•å‘çš„ä¸Šä¸‹æ–‡æ··æ·†ã€‚çœ‹ä¸‹é¢çš„ä»£ç çŒœä¸€ä¸‹æ‰“å°ç»“æœæ˜¯ä»€ä¹ˆã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> length = <span class="hljs-number">0</span><br>    <span class="hljs-string">&quot;hello&quot;</span>.apply &#123;<br>        println(<span class="hljs-string">&quot;this is apply <span class="hljs-variable">$length</span>&quot;</span>)<br>        println(<span class="hljs-string">&quot;this is apply <span class="hljs-subst">$&#123;this.length&#125;</span>&quot;</span>)<br>    &#125;<br><br>    <span class="hljs-string">&quot;hello&quot;</span>.let &#123;<br>        println(<span class="hljs-string">&quot;this is let <span class="hljs-variable">$it</span>&quot;</span>)<br>        <span class="hljs-string">&quot;world&quot;</span>.also &#123;<br>            println(<span class="hljs-string">&quot;this is run <span class="hljs-variable">$it</span>&quot;</span>)<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">innerFunc</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-string">&quot;hi&quot;</span>.apply &#123;<br>            println(<span class="hljs-string">&quot;this is innerFunc apply <span class="hljs-variable">$length</span>&quot;</span>)<br>            println(<span class="hljs-string">&quot;this is innerFunc apply <span class="hljs-subst">$&#123;this.length&#125;</span>&quot;</span>)<br><br>        &#125;<br>    &#125;<br>    innerFunc()<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»“æœæ˜¯å¦‚ä¸‹ï¼š</p><blockquote><p>this is apply 0<br>this is apply 5<br>this is let hello<br>this is run world<br>this is innerFunc apply 0<br>this is innerFunc apply 2</p></blockquote><p>è¿™é‡Œæˆ‘ä»¬åœ¨å†™ä»£ç çš„æ—¶å€™ï¼ŒIDE ç»™äº†æç¤º:<strong>Implicit parameter â€˜itâ€™ of enclosing lambda is shadowed</strong><br><img src="/image/kotlin/scope_func_implicit_param.png" alt="Implicit parameter &#39;it&#39; of enclosing lambda is shadowed "><br>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹éšå¼ it çš„åå­—æ¥é¿å…è¿™ä¸ªé—®é¢˜</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-string">&quot;hello&quot;</span>.let &#123;<br>    println(<span class="hljs-string">&quot;this is let <span class="hljs-variable">$it</span>&quot;</span>)<br>    <span class="hljs-string">&quot;world&quot;</span>.also &#123; world-&gt;<br>        println(<span class="hljs-string">&quot;this is run <span class="hljs-variable">$world</span>&quot;</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æœ€å¥½è¿˜æ˜¯é¿å…è¿™ç§åµŒå¥—è°ƒç”¨çš„æƒ…å†µ</p><hr><p>å·²å­¦ä¹ ï¼š</p><ul><li><p>æ‰©å±•</p><ul><li><input type='checkbox' disabled='true' checked>æ‰©å±•å‡½æ•°</input></li><li><input type='checkbox' disabled='true' checked>æ‰©å±•å±æ€§</input></li><li><input type='checkbox' disabled='true' checked>ä½œç”¨åŸŸ</input></li></ul></li><li><p>å‡½æ•°ç±»å‹</p><ul><li><input type='checkbox' disabled='true' checked>å¸¦æœ‰æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹</input></li><li><input type='checkbox' disabled='true' checked>Lambdaè¡¨è¾¾å¼</input></li><li><input type='checkbox' disabled='true' checked>SAM è½¬æ¢</input></li></ul></li><li><p>å…³é”®å­—</p><ul><li><input type='checkbox' disabled='true' checked>ä½œç”¨åŸŸå‡½æ•°ï¼šwithã€letã€runã€applyã€also</input></li></ul></li></ul><p>æœªå­¦ä¹ ï¼š</p><ul><li><p>å…³é”®å­—</p><ul><li>object</li><li>Unit</li><li>Nothing</li><li>inline,noinline,crossinline</li></ul></li><li><p>æ³›å‹</p><ul><li>é€†å˜</li><li>åå˜</li></ul></li><li><p>å§”æ‰˜</p><ul><li>å§”æ‰˜ç±»</li><li>å§”æ‰˜å±æ€§</li><li>è‡ªå®šä¹‰å§”æ‰˜</li></ul></li><li><p>åç¨‹</p><ul><li>å¯åŠ¨</li><li>æŒ‚èµ·</li><li>Job</li><li>Context</li><li>Channel</li><li>Flow</li><li>select</li><li>å¹¶å‘ã€å¼‚å¸¸</li><li>launch</li><li>Dispatchers</li><li>CoroutineScope</li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;åˆšå¼€å§‹å­¦ä¹  kotlin çš„æ—¶å€™ï¼Œå¯¹äºè¿™äº›ä½œç”¨åŸŸå‡½æ•°ä¸€å¤´é›¾æ°´ï¼Œæä¸æ˜ç™½ä¸ºä»€ä¹ˆè¦å¼„å‡ºæ¥è¿™ä¹ˆå¤šä¸œè¥¿ã€‚ç°åœ¨æ¥çœ‹çœ‹ä»–ä»¬å…·ä½“çš„åŒºåˆ«ä»¥åŠé€‚ç”¨çš„åœºæ™¯ã€‚&lt;br&gt;Kotlin æ ‡å‡†åº“åŒ…å«å‡ ä¸ªå‡½æ•°ï¼Œå®ƒä»¬çš„å”¯ä¸€ç›®çš„æ˜¯åœ¨å¯¹è±¡çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œä»£ç å—ã€‚ å½“å¯¹ä¸€ä¸ªå¯¹è±¡è°ƒç”¨è¿™æ ·çš„å‡½æ•°å¹¶æä¾›ä¸€ä¸ª&lt;code&gt;lambdaè¡¨è¾¾å¼&lt;/code&gt;æ—¶ï¼Œå®ƒä¼šå½¢æˆä¸€ä¸ªä¸´æ—¶ä½œç”¨åŸŸã€‚åœ¨æ­¤ä½œç”¨åŸŸä¸­ï¼Œå¯ä»¥è®¿é—®è¯¥å¯¹è±¡è€Œæ— éœ€å…¶åç§°ã€‚è¿™äº›å‡½æ•°ç§°ä¸ºä½œç”¨åŸŸå‡½æ•°ã€‚ å…±æœ‰ä»¥ä¸‹äº”ç§ï¼š&lt;code&gt;let&lt;/code&gt;ã€&lt;code&gt;run&lt;/code&gt;ã€&lt;code&gt;with&lt;/code&gt;ã€&lt;code&gt;apply&lt;/code&gt;ä»¥åŠ&lt;code&gt;also&lt;/code&gt;ã€‚&lt;br&gt;åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆæŠŠä» kotlin å®˜æ–¹ä¸Šæ‰’æ‹‰ä¸‹æ¥çš„ç»“è®ºæ”¾è¿™é‡Œ&lt;/p&gt;</summary>
    
    
    
    
    <category term="Android" scheme="https://blog.huangyuanlove.com/tags/Android/"/>
    
    <category term="Kotlin" scheme="https://blog.huangyuanlove.com/tags/Kotlin/"/>
    
  </entry>
  
  <entry>
    <title>Kotlinä¸­çš„å‡½æ•°ç±»å‹åŠ Lambda è¡¨è¾¾å¼</title>
    <link href="https://blog.huangyuanlove.com/2024/04/23/Kotlin%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B%E5%8F%8A-Lambda-%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    <id>https://blog.huangyuanlove.com/2024/04/23/Kotlin%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B%E5%8F%8A-Lambda-%E8%A1%A8%E8%BE%BE%E5%BC%8F/</id>
    <published>2024-04-23T03:41:47.000Z</published>
    <updated>2024-04-28T03:46:21.614Z</updated>
    
    <content type="html"><![CDATA[<p>ç»§ç»­ä¸Šæ¬¡åœ¨æ‰©å±•å‡½æ•°ä¸­é—ç•™ä¸‹çš„é—®é¢˜ï¼šå‡½æ•°ç±»å‹ã€‚æ€»æ‰€å‘¨çŸ¥ï¼Œåœ¨Kotlin ä¸­å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯é«˜é˜¶å‡½æ•°å˜ï¼Ÿåˆ°å¤„ç¿»äº†ç¿»ï¼Œå‘ç°å·®ä¸å¤šæ˜¯è¿™ä¹ˆä¸ªæ„æ€ï¼š<strong>æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œæˆ–è€…è¿”å›ä¸€ä¸ªå‡½æ•°ã€‚</strong>åœ¨ Kotlin åç¨‹ä¸­çš„ launchã€asyncå‡½æ•°ä»¥åŠå„ç§å„æ ·çš„æ¡†æ¶ä¸­åˆ°å¤„éƒ½æ˜¯é«˜é˜¶å‡½æ•°çš„å½±å­ï¼Œç§°é«˜é˜¶å‡½æ•°æ˜¯ Kotlinå‡½æ•°å¼ç¼–ç¨‹ã€å„å¤§æ¡†æ¶çš„åŸºçŸ³ä¹Ÿä¸è¿‡åˆ†ã€‚</p><span id="more"></span><p>ä¸å¾—ä¸è¯´ï¼Œè¿™é‡Œé¢æ¦‚å¿µæŒºå¤šçš„ï¼Œæœ‰çš„æ—¶å€™æˆ‘ä»¬ä¼šç”¨ï¼Œä½†å¹¶ä¸çŸ¥é“å«ä»€ä¹ˆåå­—ã€‚æœ‰çš„çŸ¥é“åå­—ä½†ä¸çŸ¥é“æ˜¯ä»€ä¹ˆä¸œè¥¿ã€‚</p><ul><li>é«˜é˜¶å‡½æ•°</li><li>æ‰©å±•å‡½æ•°</li><li>Lambda</li><li>SAMè½¬æ¢</li><li>å¸¦æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹</li><li>å¸¦æœ‰æ¥æ”¶è€…çš„å‡½æ•°å­—é¢å€¼</li></ul><p>é—®é¢˜ä¸å¤§ï¼Œæ…¢æ…¢æ•´ï¼Œæ…¢æ…¢ç†è§£ï¼Œå¤šè¯»å‡ éæ–‡æ¡£ï¼Œå‚è€ƒä¸€ä¸‹åˆ«äººçš„çœ‹æ³•ï¼Œä¹Ÿå°±ç†Ÿæ‚‰äº†ã€‚</p><h3 id="å‡½æ•°ç±»å‹"><a href="#å‡½æ•°ç±»å‹" class="headerlink" title="å‡½æ•°ç±»å‹"></a>å‡½æ•°ç±»å‹</h3><p>è¿™é‡Œæƒ³è¡¨è¾¾çš„å¹¶ä¸æ˜¯è¯´kotlin ä¸­çš„å‡½æ•°åˆ†ç±»ï¼Œæ¯”å¦‚ä»€ä¹ˆå†…è”å‡½æ•°ã€æ‰©å±•å‡½æ•°ã€æ ‡å‡†å‡½æ•°ã€é«˜é˜¶å‡½æ•°ç­‰ç­‰è¿™ç§åˆ†ç±»ï¼Œè€Œæ˜¯è¯´åœ¨å‡½æ•°ä½œä¸ºè¿”å›å€¼æˆ–è€…å‚æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ€ä¹ˆç¡®è®¤è¿™ä¸ªå‡½æ•°å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç±»å‹ï¼Œæˆ–è€…è¯´å¦‚ä½•ä½¿ç”¨ç¼–ç¨‹è¯­è¨€æ¥æè¿°ä¸€ä¸ªå‡½æ•°ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨è°ƒç”¨å‡½æ•°çš„æ—¶å€™ä¼ å…¥çš„å‚æ•°ï¼Œæˆ‘ä»¬ä¼šè®²è¿™ä¸ªå‡½æ•°éœ€è¦ä¸€ä¸ª Int ç±»å‹çš„å‚æ•°ï¼Œé‚£å¦‚æœæˆ‘ä»¬è°ƒç”¨çš„å‡½æ•°éœ€è¦å¦å¤–ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°æˆ‘ä»¬åº”è¯¥æ€ä¹ˆè¡¨ç¤ºå˜ï¼Ÿè¿™é‡Œå°±å¼•å‡ºäº†å‡½æ•°ç±»å‹ã€‚<br>ä¸¾ä¸ªä¾‹å­</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">functionA</span><span class="hljs-params">()</span></span>:<span class="hljs-built_in">Unit</span>&#123;<br>    println(<span class="hljs-string">&quot;functionA&quot;</span>)<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">functionA1</span><span class="hljs-params">(name:<span class="hljs-type">String</span>)</span></span>:<span class="hljs-built_in">Unit</span>&#123;<br>    <br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">functionA11</span><span class="hljs-params">(name:<span class="hljs-type">String</span>)</span></span>:String&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hi <span class="hljs-variable">$name</span>&quot;</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åº”è¯¥å¦‚ä½•æè¿°ä¸Šé¢çš„ä¸‰ä¸ªæ–¹æ³•å˜ï¼Ÿ</p><blockquote><p>functionA,ä¸éœ€è¦å‚æ•°ï¼Œè¿”å›å€¼ä¸º Unit<br>functionA1, éœ€è¦ä¸€ä¸ªString ç±»å‹çš„å‚æ•°ï¼Œè¿”å›å€¼ä¸º Unit<br>functionA11,éœ€è¦ä¸€ä¸ªString ç±»å‹çš„å‚æ•°ï¼Œè¿”å›å€¼ä¸º String</p></blockquote><p>é‚£ä¹ˆåœ¨ kotlin ç¼–ç¨‹è¯­è¨€ä¸­åˆæ˜¯å¦‚ä½•æè¿°çš„ï¼Ÿ<br><img src="/image/kotlin/kotlin_function0%3CUnit%3E.png"><br><img src="/image/kotlin/kotlin_function1%3CString,Unit%3E.png"><br><img src="/image/kotlin/kotlin_function1%3CString,String%3E.png"></p><p>ä¸Šé¢çš„å›¾æ˜¯å°†é¼ æ ‡æ‚¬åœåœ¨å˜é‡ä¸Šå°±ä¼šå‡ºç°ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€‰ä¸­å˜é‡æˆ–è€…è¡¨è¾¾å¼ï¼ŒæŒ‰ ctrl+shift+pæ¥æ˜¾ç¤ºç±»å‹</p><p>å¯ä»¥çœ‹åˆ°åœ¨<code>kotlin</code>ä¸­æ˜¯ç”¨<code>KFunction0&lt;Unit&gt;</code>ã€<code>KFunction1&lt;String, Unit&gt;</code>ã€<code>KFunction1&lt;String, String&gt;</code>è¿™ç§å½¢å¼æ¥æè¿°ä¸€ä¸ªå‡½æ•°ã€‚è¿™é‡Œçš„ KFunction åé¢çš„æ•°å­—è¡¨ç¤ºè¿™ä¸ªå‡½æ•°çš„å‚æ•°ä¸ªæ•°ï¼Œå°–æ‹¬å·ä¸­çš„ç±»å‹è¡¨ç¤ºå‚æ•°çš„ç±»å‹ï¼Œæœ€åä¸€ä¸ªç±»å‹è¡¨ç¤ºå‡½æ•°çš„è¿”å›å€¼ç±»å‹ã€‚æ¯”å¦‚<code>KFunction1&lt;String, Unit&gt;</code>è¡¨ç¤ºè¿™ä¸ªå‡½æ•°éœ€è¦<code>1</code>ä¸ª<code>String</code>ç±»å‹çš„å‚æ•°ï¼Œè¿”å›å€¼ç±»å‹ä¸º<code>Unit</code>ã€‚è€Œ<code>KFunction1&lt;String, String&gt;</code>è¡¨ç¤ºè¿™ä¸ªå‡½æ•°éœ€è¦<code>1</code>ä¸ª<code>String</code>ç±»å‹çš„å‚æ•°ï¼Œè¿”å›å€¼ä¸º<code>String</code>ã€‚<br>å¦‚æœå‡½æ•°æ˜¯æŒ‚èµ·å‡½æ•°(è¢«suspendä¿®é¥°)ï¼Œåˆ™å¯¹åº”çš„ç±»å‹ä¸º<code> KSuspendFunction0&lt;Unit&gt;</code>,ä»¥æ­¤ç±»æ¨ã€‚<br>é‚£ä¹ˆå¦‚æœæ˜¯é«˜é˜¶å‡½æ•°å˜ï¼Ÿ</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">functionC</span><span class="hljs-params">(method:()-&gt;<span class="hljs-type">String</span>)</span></span>:String&#123;<br>    <span class="hljs-keyword">return</span> method()<br>&#125;<br><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span>  <span class="hljs-title">suspendFunctionC</span><span class="hljs-params">(method: () -&gt; <span class="hljs-type">String</span>)</span></span>: String &#123;<br>    <span class="hljs-keyword">return</span> method()<br>&#125;<br><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span>  <span class="hljs-title">suspendFunctionC1</span><span class="hljs-params">(method:<span class="hljs-type">suspend</span> () -&gt; <span class="hljs-type">String</span>)</span></span>: String &#123;<br>    <span class="hljs-keyword">return</span> method()<br>&#125;<br></code></pre></td></tr></table></figure><p>åŒæ ·çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°</p><blockquote><p><code>functionC</code>å¯¹åº”çš„æè¿°æ˜¯<code>KFunction1&lt;() -&gt; String, String&gt;</code><br><code>suspendFunctionC</code>å¯¹åº”çš„æè¿°æ˜¯<code> KSuspendFunction1&lt;() -&gt; String, String&gt;</code><br><code>suspendFunctionC1</code>å¯¹åº”çš„æè¿°æ˜¯<code> KSuspendFunction1&lt;suspend () -&gt; String, String&gt;</code>ã€‚</p></blockquote><p>å¯¹äºæ‰©å±•å‡½æ•°ä¹Ÿä¸€æ ·</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> String.<span class="hljs-title">A1</span><span class="hljs-params">()</span></span> &#123;<br>    println(<span class="hljs-keyword">this</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> String.<span class="hljs-title">A11</span><span class="hljs-params">()</span></span>: String &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span><br>&#125;    <br><span class="hljs-keyword">val</span> stringA1 = String::A1 <span class="hljs-comment">// KFunction1&lt;String, Unit&gt;</span><br><span class="hljs-keyword">val</span> stringA11 = String::A11 <span class="hljs-comment">// KFunction1&lt;String, String&gt;</span><br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨<code>typealias</code>ç»™å‡½æ•°ç±»å‹å–ä¸€ä¸ªåˆ«å<br><code>typealias ClickHandler = (Button, ClickEvent) -&gt; Unit</code></p><h3 id="å¸¦æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹"><a href="#å¸¦æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹" class="headerlink" title="å¸¦æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹"></a>å¸¦æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹</h3><p>ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ç±»å‹ï¼Œå®ƒå…è®¸æ‚¨åœ¨å‡½æ•°ç±»å‹ä¸­æŒ‡å®šä¸€ä¸ªæ¥æ”¶è€…å¯¹è±¡ï¼Œä½¿å¾—åœ¨å‡½æ•°ä½“å†…å¯ä»¥ç›´æ¥è®¿é—®è¯¥æ¥æ”¶è€…å¯¹è±¡çš„æˆå‘˜å‡½æ•°å’Œå±æ€§ã€‚è¿™ç§å‡½æ•°ç±»å‹çš„è¯­æ³•æ˜¯åœ¨å‡½æ•°ç±»å‹å£°æ˜ä¹‹å‰æ·»åŠ æ¥æ”¶è€…ç±»å‹ã€‚<br>å¸¦æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><blockquote><p>æ¥æ”¶è€…ç±»å‹.() -&gt; è¿”å›ç±»å‹</p></blockquote><p>é€šè¿‡ä½¿ç”¨å¸¦æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå…·æœ‰æ¥æ”¶è€…çš„å‡½æ•°å˜é‡ã€å‡½æ•°å‚æ•°æˆ–å‡½æ•°è¿”å›ç±»å‹ï¼Œä»¥ä¾¿åœ¨è°ƒç”¨å‡½æ•°æ—¶å¯ä»¥ç›´æ¥æ“ä½œæ¥æ”¶è€…å¯¹è±¡ã€‚è¿™æ ·å¯ä»¥å®ç°ä¸€ç§ç±»ä¼¼æ‰©å±•å‡½æ•°çš„æ•ˆæœã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">data</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span></span>(<span class="hljs-keyword">val</span> name: String)<br><br><span class="hljs-comment">// å¸¦æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹</span><br><span class="hljs-keyword">val</span> greeting: Person.() -&gt; String = &#123;<br>    <span class="hljs-string">&quot;Hello, <span class="hljs-variable">$name</span>!&quot;</span><br>&#125;<br><br><span class="hljs-comment">// æ‰©å±•å‡½æ•°</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> Person.<span class="hljs-title">greet</span><span class="hljs-params">()</span></span>: String &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello, <span class="hljs-variable">$name</span>!&quot;</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> person: Person = Person(<span class="hljs-string">&quot;huang&quot;</span>)<br><br>    <span class="hljs-comment">// ä½¿ç”¨å¸¦æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹è°ƒç”¨å‡½æ•°</span><br>    <span class="hljs-keyword">val</span> message1 = person.greeting()<br><br>    <span class="hljs-comment">// ä½¿ç”¨æ‰©å±•å‡½æ•°è°ƒç”¨å‡½æ•°</span><br>    <span class="hljs-keyword">val</span> message2 = person.greet()<br><br>    println(message1) <span class="hljs-comment">// è¾“å‡º: Hello, huang!</span><br>    println(message2) <span class="hljs-comment">// è¾“å‡º: Hello, huang!</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ€»ç»“èµ·æ¥ï¼Œå¸¦æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹æ›´é€‚åˆåœ¨å‡½æ•°ç±»å‹çš„å£°æ˜å’Œä¼ é€’ä¸­ä½¿ç”¨ï¼Œä»¥æä¾›ç‰¹å®šä¸Šä¸‹æ–‡çš„å‡½æ•°æ“ä½œã€‚è€Œæ‰©å±•å‡½æ•°åˆ™æ›´é€‚åˆåœ¨å·²æœ‰ç±»ä¸Šæ·»åŠ æ–°çš„å‡½æ•°ï¼Œä½¿å¾—åœ¨è°ƒç”¨è¯¥ç±»æ—¶å¯ä»¥ä½¿ç”¨è¿™äº›é¢å¤–çš„å‡½æ•°ã€‚</p><h3 id="å°æ€»ç»“"><a href="#å°æ€»ç»“" class="headerlink" title="å°æ€»ç»“"></a>å°æ€»ç»“</h3><p>å…ˆå°å°çš„æ€»ç»“ä¸€ä¸‹ï¼š</p><ul><li>æ‰€æœ‰å‡½æ•°ç±»å‹éƒ½æœ‰ä¸€ä¸ªåœ†æ‹¬å·æ‹¬èµ·æ¥çš„å‚æ•°ç±»å‹åˆ—è¡¨ä»¥åŠä¸€ä¸ªè¿”å›ç±»å‹ï¼š(A, B) -&gt; C è¡¨ç¤ºæ¥å—ç±»å‹åˆ†åˆ«ä¸º A ä¸ B ä¸¤ä¸ªå‚æ•°å¹¶è¿”å›ä¸€ä¸ª C ç±»å‹å€¼çš„å‡½æ•°ç±»å‹ã€‚ å‚æ•°ç±»å‹åˆ—è¡¨å¯ä»¥ä¸ºç©ºï¼Œå¦‚ () -&gt; Aã€‚Unit è¿”å›ç±»å‹ä¸å¯çœç•¥ã€‚</li><li>å‡½æ•°ç±»å‹å¯ä»¥æœ‰ä¸€ä¸ªé¢å¤–çš„æ¥æ”¶è€…ç±»å‹ï¼Œå®ƒåœ¨è¡¨ç¤ºæ³•ä¸­çš„ç‚¹ä¹‹å‰æŒ‡å®šï¼š ç±»å‹ A.(B) -&gt; C è¡¨ç¤ºå¯ä»¥åœ¨ A çš„æ¥æ”¶è€…å¯¹è±¡ä¸Šä»¥ä¸€ä¸ª B ç±»å‹å‚æ•°æ¥è°ƒç”¨å¹¶è¿”å›ä¸€ä¸ª C ç±»å‹å€¼çš„å‡½æ•°ã€‚ <code>å¸¦æœ‰æ¥æ”¶è€…çš„å‡½æ•°å­—é¢å€¼</code>é€šå¸¸ä¸è¿™äº›ç±»å‹ä¸€èµ·ä½¿ç”¨ã€‚</li><li>æŒ‚èµ·å‡½æ•°å±äºå‡½æ•°ç±»å‹çš„ç‰¹æ®Šç§ç±»ï¼Œå®ƒçš„è¡¨ç¤ºæ³•ä¸­æœ‰ä¸€ä¸ª suspend ä¿®é¥°ç¬¦ ï¼Œä¾‹å¦‚ suspend () -&gt; Unit æˆ–è€… suspend A.(B) -&gt; Cã€‚</li><li>å¦‚éœ€å°†å‡½æ•°ç±»å‹æŒ‡å®šä¸ºå¯ç©ºï¼Œè¯·ä½¿ç”¨åœ†æ‹¬å·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ((Int, Int) -&gt; Int)?ã€‚</li></ul><p>è¿™æ ·æˆ‘ä»¬åœ¨çœ‹å…¶ä»–æ¡†æ¶çš„æ—¶å€™å°±çŸ¥é“æ¡†æ¶ä¸­çš„é«˜é˜¶å‡½æ•°æ€ä¹ˆè°ƒç”¨äº†ï¼š</p><blockquote><p>å½“å‚æ•°ç±»å‹ä¸º<code>() -&gt; String</code>æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¼ å…¥ä¸€ä¸ªæ²¡æœ‰å‚æ•°ä¸”è¿”å›å€¼ä¸ºStringç±»å‹çš„å‡½æ•°ï¼Œå¯¹åº”çš„ç±»å‹æ˜¯<code>KFunction0&lt;String&gt;</code></p></blockquote><h3 id="å‡½æ•°å®ä¾‹åŒ–"><a href="#å‡½æ•°å®ä¾‹åŒ–" class="headerlink" title="å‡½æ•°å®ä¾‹åŒ–"></a>å‡½æ•°å®ä¾‹åŒ–</h3><p>æ—¢ç„¶å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œé‚£ä¹ˆç†æ‰€å½“ç„¶çš„å¯ä»¥è¢«å®ä¾‹åŒ–ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡ ç§æ–¹å¼è·å–å‡½æ•°ç±»å‹çš„å®ä¾‹</p><ul><li>ä½¿ç”¨å‡½æ•°å­—é¢å€¼çš„ä»£ç å—<ul><li>lambda è¡¨è¾¾å¼: { a, b -&gt; a + b },</li><li>åŒ¿åå‡½æ•°: fun(s: String): Int { return s.toIntOrNull() ?: 0 }</li></ul></li><li>ä½¿ç”¨å·²æœ‰å£°æ˜çš„å¯è°ƒç”¨å¼•ç”¨<ul><li>é¡¶å±‚ã€å±€éƒ¨ã€æˆå‘˜ã€æ‰©å±•å‡½æ•°ï¼š::isOddã€ String::toIntï¼Œ</li><li>é¡¶å±‚ã€æˆå‘˜ã€æ‰©å±•å±æ€§ï¼šList<Int>::sizeï¼Œ</li><li>æ„é€ å‡½æ•°ï¼š::Regex</li></ul></li><li>ä½¿ç”¨å®ç°å‡½æ•°ç±»å‹æ¥å£çš„è‡ªå®šä¹‰ç±»çš„å®ä¾‹ï¼š<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IntTransformer</span>: <span class="hljs-type"></span></span>(<span class="hljs-built_in">Int</span>) -&gt; <span class="hljs-built_in">Int</span> &#123;<br>  <span class="hljs-keyword">override</span> <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">invoke</span><span class="hljs-params">(x: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> = TODO()<br>&#125;<br><span class="hljs-keyword">val</span> intFunction: (<span class="hljs-built_in">Int</span>) -&gt; <span class="hljs-built_in">Int</span> = IntTransformer()<br></code></pre></td></tr></table></figure></li></ul><h3 id="æœ‰æ— Receiverçš„å‡½æ•°ç›¸äº’è½¬åŒ–"><a href="#æœ‰æ— Receiverçš„å‡½æ•°ç›¸äº’è½¬åŒ–" class="headerlink" title="æœ‰æ— Receiverçš„å‡½æ•°ç›¸äº’è½¬åŒ–"></a>æœ‰æ— Receiverçš„å‡½æ•°ç›¸äº’è½¬åŒ–</h3><p>å¸¦ä¸ä¸å¸¦æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹éå­—é¢å€¼å¯ä»¥äº’æ¢ï¼Œå…¶ä¸­æ¥æ”¶è€…å¯ä»¥æ›¿ä»£ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåä¹‹äº¦ç„¶ã€‚ä¾‹å¦‚ï¼Œ(A, B) -&gt; C ç±»å‹çš„å€¼å¯ä»¥ä¼ ç»™æˆ–èµ‹å€¼ç»™æœŸå¾… A.(B) -&gt; C ç±»å‹å€¼çš„åœ°æ–¹ï¼Œåä¹‹äº¦ç„¶ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ<code>String.A1()</code>æ˜æ˜æ²¡æœ‰å£°æ˜éœ€è¦å‚æ•°ï¼Œä¸ºå•¥å’Œä¸Šé¢çš„<code>functionA1</code>æ–¹æ³•æ˜¯ç›¸åŒçš„ç±»å‹å˜ï¼Ÿå¯ä»¥è¿™ä¹ˆè®¤ä¸º:Kotlinä¸­çš„æ‰©å±•å‡½æ•°å°†æ¥æ”¶è€…æœ¬èº«å½“åšç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ï¼Œè¦ä¸ç„¶ä¸ºå•¥åœ¨<code>String.A1()</code>é‡Œé¢å¯ä»¥ä½¿ç”¨<code>this</code>æ¥ä»£æ›¿è°ƒç”¨è€…æœ¬èº«å˜ï¼Ÿ<br>é‚£æ—¢ç„¶è¿™æ ·çš„è¯ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸¤è€…æ˜¯å¯ä»¥äº’æ¢çš„ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">d</span><span class="hljs-params">(block :(<span class="hljs-type">String</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span> &#123;<br>   block(<span class="hljs-string">&quot;hello&quot;</span>);<br>&#125;<br>d(String::A1)<br>d(::functionA1)<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œä»…é’ˆå¯¹åœ¨å¼•ç”¨å’Œè°ƒç”¨æ—¶å¯ä»¥äº’ç›¸è½¬æ¢ï¼Œæ¯”å¦‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> sayHi: (String) -&gt; <span class="hljs-built_in">Unit</span> = &#123; name:String-&gt;  println(<span class="hljs-string">&quot;hi <span class="hljs-variable">$name</span>&quot;</span>) &#125;<br>sayHi.invoke(<span class="hljs-string">&quot;huangyuan&quot;</span>)<br>sayHi(<span class="hljs-string">&quot;huangyuan&quot;</span>)<br><br><span class="hljs-keyword">val</span> sayHello: String.() -&gt; <span class="hljs-built_in">Unit</span> = &#123; println(<span class="hljs-string">&quot;hello <span class="hljs-variable">$this</span>&quot;</span>) &#125;<br>sayHello.invoke(<span class="hljs-string">&quot;huangyuan&quot;</span>)<br>sayHello(<span class="hljs-string">&quot;huangyuan&quot;</span>)<br><span class="hljs-string">&quot;huangyuan&quot;</span>.sayHello()<br><br><span class="hljs-keyword">val</span> sayHiRef:(String)-&gt;<span class="hljs-built_in">Unit</span> =sayHi<br><span class="hljs-keyword">val</span> sayHiRef1: String.() -&gt; <span class="hljs-built_in">Unit</span> = sayHi<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœå°† sayHello å’ŒsayHiè¿™ä¸¤ä¸ªå‡½æ•°ç­‰å·å³è¾¹äº’æ¢ä¸€ä¸‹åˆ™ä¼šæŠ¥é”™ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ¦‚å¿µï¼š<code>å¸¦æ¥æ”¶è€…çš„å‡½æ•°å­—é¢å€¼</code>ï¼ˆFunction Literals with Receiverï¼‰ï¼Œä¹Ÿç§°ä¸ºå¸¦æ¥æ”¶è€…çš„ Lambda è¡¨è¾¾å¼ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„ Lambda è¡¨è¾¾å¼ã€‚å®ƒå…è®¸åœ¨ Lambda è¡¨è¾¾å¼ä¸­è®¿é—®ç‰¹å®šç±»å‹çš„å¯¹è±¡çš„æˆå‘˜ï¼Œå°±åƒåœ¨è¯¥å¯¹è±¡çš„æˆå‘˜å‡½æ•°ä¸­ä¸€æ ·ã€‚é€šè¿‡ä½¿ç”¨å¸¦æ¥æ”¶è€…çš„å‡½æ•°å­—é¢å€¼ï¼Œå¯ä»¥åœ¨ Lambda è¡¨è¾¾å¼ä¸­ä»¥æ›´ç®€æ´çš„æ–¹å¼æ“ä½œç‰¹å®šç±»å‹çš„å¯¹è±¡ã€‚ä¸Šé¢å¯¹<code>sayHello</code>çš„å®šä¹‰å°±å±äºè¿™ç§å½¢å¼ã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼šå¸¦æœ‰æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹ï¼Œä¾‹å¦‚ A.(B) -&gt; Cï¼Œå¯ä»¥ç”¨ç‰¹æ®Šå½¢å¼çš„å‡½æ•°å­—é¢å€¼å®ä¾‹åŒ–â€”-å¸¦æœ‰æ¥æ”¶è€…çš„å‡½æ•°å­—é¢å€¼ã€‚<br>è¿™é‡Œè§£é‡Šä¸€ä¸‹ï¼šæ‰€è°“çš„å­—é¢é‡ï¼Œå°±æ˜¯ä¸ç”¨å˜é‡åç§°ç›´æ¥ç”¨ç›¸å¯¹åº”çš„å€¼å†™å‡ºæ¥ã€‚æ¯”å¦‚â€œhello worldâ€å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢é‡ã€12.23æ˜¯ä¸€ä¸ª Double çš„å­—é¢é‡ã€4æ˜¯ä¸€ä¸ª Int çš„å­—é¢é‡ã€‚</p><h3 id="å‡½æ•°ç±»å‹å®ä¾‹è°ƒç”¨"><a href="#å‡½æ•°ç±»å‹å®ä¾‹è°ƒç”¨" class="headerlink" title="å‡½æ•°ç±»å‹å®ä¾‹è°ƒç”¨"></a>å‡½æ•°ç±»å‹å®ä¾‹è°ƒç”¨</h3><p>æ—¢ç„¶èƒ½è·å–åˆ°å‡½æ•°ç±»å‹çš„å®ä¾‹ï¼Œé‚£ä¹ˆè‚¯å®šå°±å¯ä»¥è°ƒç”¨äº†ã€‚<br>è¿™é‡Œè°ƒç”¨æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯é€šè¿‡<code>invoke()</code>ï¼Œæ¯”å¦‚<code>func.invoke()</code>,æˆ–è€…ç›´æ¥åœ¨å¼•ç”¨åé¢åŠ ä¸Šæ‹¬å·<code>func()</code>:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> functionOne: <span class="hljs-built_in">Int</span>.() -&gt; <span class="hljs-built_in">Unit</span> = &#123; println(<span class="hljs-string">&quot;aaFunRefRec <span class="hljs-variable">$this</span>  &quot;</span>) &#125;<br>functionOne.invoke(<span class="hljs-number">10001</span>)<br>functionOne(<span class="hljs-number">10001</span>)<br><br><span class="hljs-keyword">val</span> functionTwo: <span class="hljs-built_in">Int</span>.(String) -&gt; <span class="hljs-built_in">Unit</span> = &#123; println(<span class="hljs-string">&quot;other <span class="hljs-variable">$this</span>  &quot;</span>) &#125;<br>functionTwo.invoke(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;other&quot;</span>)<br>functionTwo(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;other&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="Lambdaè¡¨è¾¾å¼"><a href="#Lambdaè¡¨è¾¾å¼" class="headerlink" title="Lambdaè¡¨è¾¾å¼"></a>Lambdaè¡¨è¾¾å¼</h3><p>æˆ‘ä»¬åœ¨ä½¿ç”¨Javaè¯­è¨€å¼€å‘Android åº”ç”¨çš„æ—¶å€™å¯èƒ½å·²ç»ä½“éªŒè¿‡ Lambda è¡¨è¾¾å¼äº†ï¼Œæœ€å¸¸è§çš„å°±æ˜¯ç»™ View è®¾ç½®ç‚¹å‡»ç›‘å¬çš„æ—¶å€™<br><img src="/image/kotlin/replace_with_lambda_tip.png" alt="replace_with_lambda_tip"><br>å½“æˆ‘ä»¬ç‚¹å‡»äº†ä¹‹åï¼Œä»£ç å°±æˆäº†è¿™æ ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Java">llShowMoreDialog.setOnClickListener(v -&gt; showToast(<span class="hljs-string">&quot;ç‚¹å‡»äº†&quot;</span>));<br></code></pre></td></tr></table></figure><p>ç›®å‰åœ¨ java ä¸­åªèƒ½ç®€åŒ–æˆè¿™æ ·çš„ï¼Œkotlin ä¸­è¿˜å¯ä»¥è¿›ä¸€æ­¥ç®€åŒ–ï¼Œåé¢å†è¯´ã€‚è¿™é‡Œå…ˆçœ‹çœ‹Lambdaè¡¨è¾¾å¼è¯­æ³•ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> sum: (<span class="hljs-built_in">Int</span>, <span class="hljs-built_in">Int</span>) -&gt; <span class="hljs-built_in">Int</span> = &#123; x: <span class="hljs-built_in">Int</span>, y: <span class="hljs-built_in">Int</span> -&gt; x + y &#125;<br></code></pre></td></tr></table></figure><ul><li>lambda è¡¨è¾¾å¼æ€»æ˜¯æ‹¬åœ¨èŠ±æ‹¬å·ä¸­ã€‚</li><li>å®Œæ•´è¯­æ³•å½¢å¼çš„å‚æ•°å£°æ˜æ”¾åœ¨èŠ±æ‹¬å·å†…ï¼Œå¹¶æœ‰å¯é€‰çš„ç±»å‹æ ‡æ³¨ã€‚</li><li>å‡½æ•°ä½“è·Ÿåœ¨ä¸€ä¸ª -&gt; ä¹‹åã€‚</li><li>å¦‚æœæ¨æ–­å‡ºçš„è¯¥ lambda çš„è¿”å›ç±»å‹ä¸æ˜¯ Unitï¼Œé‚£ä¹ˆè¯¥ lambda ä¸»ä½“ä¸­çš„æœ€åä¸€ä¸ªï¼ˆæˆ–å¯èƒ½æ˜¯å•ä¸ªï¼‰è¡¨è¾¾å¼ä¼šè§†ä¸ºè¿”å›å€¼ã€‚</li></ul><p>å¦‚æœLambda è¡¨è¾¾å¼çš„å‚æ•°å¯ä»¥æ¨æ–­å‡ºæ¥ï¼Œæˆ‘ä»¬å¯ä»¥çœç•¥ä¸€äº›ç±»å‹ï¼Œæ¯”å¦‚ä¸Šé¢çš„ sum å‡½æ•°å¯ä»¥çœç•¥ä¸º</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> sum1 = &#123; x: <span class="hljs-built_in">Int</span>, y: <span class="hljs-built_in">Int</span> -&gt; x + y &#125;<br><span class="hljs-keyword">val</span> sum2: (<span class="hljs-built_in">Int</span>, <span class="hljs-built_in">Int</span>) -&gt; <span class="hljs-built_in">Int</span> = &#123; x, y -&gt; x + y &#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨å†™ Android æ—¶ç»å¸¸ä¼šç”¨åˆ°ç»™æŸä¸ªæ§ä»¶è®¾ç½®ç‚¹å‡»äº‹ä»¶ï¼Œå°±åƒä¸Šé¢çš„ä¾‹å­ä¸€æ ·</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">view.setOnClickListener(<span class="hljs-keyword">object</span> :View.OnClickListener&#123;<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onClick</span><span class="hljs-params">(view: <span class="hljs-type">View</span>?)</span></span> &#123;<br>        println(<span class="hljs-string">&quot;click <span class="hljs-subst">$&#123;view?.id&#125;</span>&quot;</span>)<br>    &#125;<br>&#125;)<br>view.setOnClickListener &#123; println(<span class="hljs-string">&quot;click <span class="hljs-variable">$it</span> &quot;</span>) &#125;<br></code></pre></td></tr></table></figure><h4 id="SAMè½¬æ¢"><a href="#SAMè½¬æ¢" class="headerlink" title="SAMè½¬æ¢"></a>SAMè½¬æ¢</h4><p>é‚£ä¹ˆå®ƒæ˜¯æ€ä¹ˆä»ä¸Šé¢ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»å˜æˆä¸‹é¢æ ·å­çš„ï¼Ÿè¿™é‡Œå°±è¦æä¸€ä¸‹<code>SAMè½¬æ¢</code>äº†ï¼šSAMæ˜¯Single Abstract Methodçš„ç¼©å†™ï¼Œæ„æ€å°±æ˜¯åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„ç±»æˆ–è€…æ¥å£ã€‚ä½†åœ¨Kotlinå’ŒJava 8é‡Œï¼ŒSAMä»£è¡¨ç€åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ã€‚åªè¦æ˜¯ç¬¦åˆSAMè¦æ±‚çš„æ¥å£ï¼Œç¼–è¯‘å™¨å°±èƒ½è¿›è¡ŒSAMè½¬æ¢ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Lambdaè¡¨è¾¾å¼ï¼Œæ¥ç®€å†™æ¥å£ç±»çš„å‚æ•°ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒJava 8ä¸­çš„SAMæœ‰æ˜ç¡®çš„åç§°ï¼Œå«åš<code>å‡½æ•°å¼æ¥å£(FunctionalInterface)</code>ã€‚FunctionalInterfaceçš„é™åˆ¶å¦‚ä¸‹ï¼Œç¼ºä¸€ä¸å¯ï¼š</p><ul><li>å¿…é¡»æ˜¯æ¥å£ï¼ŒæŠ½è±¡ç±»ä¸è¡Œï¼›</li><li>è¯¥æ¥å£æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæŠ½è±¡çš„æ–¹æ³•ï¼ŒæŠ½è±¡æ–¹æ³•ä¸ªæ•°å¿…é¡»æ˜¯1ï¼Œé»˜è®¤å®ç°çš„æ–¹æ³•å¯ä»¥æœ‰å¤šä¸ªã€‚</li></ul><p>åŒæ ·çš„ï¼Œåœ¨kotlinä¸­ä¹Ÿæœ‰é™åˆ¶ï¼š</p><ul><li>å¿…é¡»æ˜¯å‡½æ•°æ¥å£ï¼Œä¹Ÿå°±æ˜¯å£°æ˜ä¸º<code>fun interface</code></li><li>åªèƒ½åŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå¹¶ä¸”ä¸èƒ½åŒ…å«é»˜è®¤æ–¹æ³•</li></ul><p>å› æ­¤,kotlin ç¼–è¯‘å™¨ä¼šå°†è¯¥æ–¹æ³•è‡ªåŠ¨è½¬åŒ–ä¸º<code>fun setOnClickListener(l: ((View!) -&gt; Unit)?)</code>ï¼Œæˆ‘ä»¬æ‰å¾—ä»¥ä½¿ç”¨ Lambdaè¡¨è¾¾å¼æ¥ç®€åŒ–ä»£ç ã€‚å¯ä»¥å°†ä»£ç å†™æˆè¿™æ ·</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">view.setOnClickListener(&#123;view:View?-&gt; println(<span class="hljs-string">&quot;click <span class="hljs-subst">$&#123;view?.id&#125;</span>&quot;</span>)&#125;)<br></code></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸‹ï¼Œç”±äº kotlin æ”¯æŒç±»å‹æ¨å¯¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†<code>View?</code>ä¹Ÿçœç•¥æ‰ï¼Œæ¥ç€è¿˜ä¼šè§¦å‘ä¸€ä¸ªè¢«ç§°ä¹‹ä¸º<code>å•ä¸ªå‚æ•°çš„éšå¼åç§°</code>çš„ä¸œè¥¿ï¼ŒåŸè¯æ˜¯è¿™ä¹ˆè¯´çš„</p><blockquote><p>If the compiler can parse the signature without any parameters, the parameter does not need to be declared and -&gt; can be omitted. è¯¥å‚æ•°ä¼šéšå¼å£°æ˜ä¸º it<br>å› æ­¤ï¼Œæˆ‘ä»¬å¾—åˆ°äº†è¿™æ ·å­çš„ä»£ç </p></blockquote><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">view.setOnClickListener(&#123;println(<span class="hljs-string">&quot;click <span class="hljs-subst">$&#123;it?.id&#125;</span>&quot;</span>)&#125;)<br></code></pre></td></tr></table></figure><p>æŒ‰ç…§ Kotlin æƒ¯ä¾‹ï¼Œå¦‚æœå‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆä½œä¸ºç›¸åº”å‚æ•°ä¼ å…¥çš„ lambda è¡¨è¾¾å¼å¯ä»¥æ”¾åœ¨åœ†æ‹¬å·ä¹‹å¤–ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">view.setOnClickListener()&#123;println(<span class="hljs-string">&quot;click <span class="hljs-subst">$&#123;it?.id&#125;</span>&quot;</span>)&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§è¯­æ³•ä¹Ÿç§°ä¸º<code>æ‹–å°¾lambda(trailing lambda)</code>è¡¨è¾¾å¼ã€‚<br>å¦‚æœè¯¥ lambda è¡¨è¾¾å¼æ˜¯è°ƒç”¨æ—¶å”¯ä¸€çš„å‚æ•°ï¼Œé‚£ä¹ˆåœ†æ‹¬å·å¯ä»¥å®Œå…¨çœç•¥ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">view.setOnClickListener&#123;println(<span class="hljs-string">&quot;click <span class="hljs-subst">$&#123;it?.id&#125;</span>&quot;</span>)&#125;<br></code></pre></td></tr></table></figure><p>è¿™å°±æ˜¯æˆ‘ä»¬æœ€ç»ˆå¾—åˆ°çš„ä»£ç æ ·å­</p><h4 id="ä»lambdaè¡¨è¾¾å¼ä¸­è¿”å›ä¸€ä¸ªå€¼"><a href="#ä»lambdaè¡¨è¾¾å¼ä¸­è¿”å›ä¸€ä¸ªå€¼" class="headerlink" title="ä»lambdaè¡¨è¾¾å¼ä¸­è¿”å›ä¸€ä¸ªå€¼"></a>ä»lambdaè¡¨è¾¾å¼ä¸­è¿”å›ä¸€ä¸ªå€¼</h4><p>è¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯éšå¼è¿”å›ï¼šå¦‚æœæˆ‘ä»¬ä»€ä¹ˆéƒ½ä¸åšï¼Œå°†è¿”å›æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚<br>å¦å¤–ä¸€ç§å°±æ˜¯ä½¿ç”¨é™å®šçš„è¿”å›è¯­æ³•ä»lambdaæ˜¾å¼è¿”å›ä¸€ä¸ªå€¼</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">ints.filter &#123;<br>    <span class="hljs-keyword">val</span> shouldFilter = it &gt; <span class="hljs-number">0</span><br>    shouldFilter<br>&#125;<br><br>ints.filter &#123;<br>    <span class="hljs-keyword">val</span> shouldFilter = it &gt; <span class="hljs-number">0</span><br>    <span class="hljs-keyword">return</span><span class="hljs-symbol">@filter</span> shouldFilter<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸¤ç§æ–¹å¼æ˜¯ç­‰ä»·çš„ã€‚<br>é‚£ä¹ˆè¿™ä¸ªæ ‡ç­¾ <strong>@filter</strong>æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿ<br>åœ¨ Kotlin ä¸­ä»»ä½•è¡¨è¾¾å¼éƒ½å¯ä»¥ç”¨æ ‡ç­¾æ¥æ ‡è®°ã€‚ æ ‡ç­¾çš„æ ¼å¼ä¸ºæ ‡è¯†ç¬¦åè·Ÿ @ ç¬¦å·ï¼Œä¾‹å¦‚ï¼šabc@ã€fooBar@ã€‚ è¦ä¸ºä¸€ä¸ªè¡¨è¾¾å¼åŠ æ ‡ç­¾ï¼Œæˆ‘ä»¬åªè¦åœ¨å…¶å‰åŠ æ ‡ç­¾å³å¯.<br>æ¯”å¦‚æˆ‘ä»¬åœ¨åµŒå¥—å‡½æ•°ä¸­ï¼Œæ ‡ç­¾é™å®šçš„ return å…è®¸æˆ‘ä»¬ä»å¤–å±‚å‡½æ•°è¿”å›ï¼Œæ¯”å¦‚ä» Lambda è¡¨è¾¾å¼ä¸­è¿”å›</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span></span> &#123;<br>    listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>).forEach &#123;<br>        <span class="hljs-keyword">if</span> (it == <span class="hljs-number">3</span>) <span class="hljs-keyword">return</span> <span class="hljs-comment">// éå±€éƒ¨ç›´æ¥è¿”å›åˆ° foo() çš„è°ƒç”¨è€…</span><br>        print(it)<br>    &#125;<br>    println(<span class="hljs-string">&quot;this point is unreachable&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span></span> &#123;<br>    listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>).forEach <span class="hljs-symbol">lit@</span>&#123;<br>        <span class="hljs-keyword">if</span> (it == <span class="hljs-number">3</span>) <span class="hljs-keyword">return</span><span class="hljs-symbol">@lit</span> <span class="hljs-comment">// å±€éƒ¨è¿”å›åˆ°è¯¥ lambda è¡¨è¾¾å¼çš„è°ƒç”¨è€…â€”â€”forEach å¾ªç¯</span><br>        print(it)<br>    &#125;<br>    print(<span class="hljs-string">&quot; done with explicit label&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šå¸¸æƒ…å†µä¸‹ä½¿ç”¨<strong>éšå¼æ ‡ç­¾</strong>æ›´æ–¹ä¾¿ï¼Œå› ä¸ºè¯¥æ ‡ç­¾ä¸æ¥å—è¯¥ lambda çš„å‡½æ•°åŒåã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span></span> &#123;<br>    listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>).forEach &#123;<br>        <span class="hljs-keyword">if</span> (it == <span class="hljs-number">3</span>) <span class="hljs-keyword">return</span><span class="hljs-symbol">@forEach</span> <span class="hljs-comment">// å±€éƒ¨è¿”å›åˆ°è¯¥ lambda è¡¨è¾¾å¼çš„è°ƒç”¨è€…â€”â€”forEach å¾ªç¯</span><br>        print(it)<br>    &#125;<br>    print(<span class="hljs-string">&quot; done with implicit label&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>å®˜æ–¹è¿™é‡Œä¹Ÿç»™äº†ä¸€ä¸ªæç¤ºï¼š<strong>æ³¨æ„ï¼Œè¿™ç§éå±€éƒ¨çš„è¿”å›åªæ”¯æŒä¼ ç»™å†…è”å‡½æ•°çš„ lambda è¡¨è¾¾å¼</strong>ï¼Œè¿™ä¸ªé—®é¢˜åé¢å†è¯´æŠŠï¼Œå°±æ˜¯<code>inline</code>ã€<code>noinline</code>ã€<code>crossinline</code>è¿™ä¸‰ä¸ªå…³é”®å­—å¸¦æ¥çš„ä¼˜åŒ–ä»¥åŠæ»¥ç”¨çš„åå¤„ã€‚<br>å¦å¤–è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå° tipï¼šå¦‚æœ lambda è¡¨è¾¾å¼çš„å‚æ•°æœªä½¿ç”¨ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ä¸‹åˆ’çº¿å–ä»£å…¶åç§°</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">map.forEach &#123; (_, value) -&gt; println(<span class="hljs-string">&quot;<span class="hljs-variable">$value</span>!&quot;</span>) &#125;<br></code></pre></td></tr></table></figure><h3 id="åŒ¿åå‡½æ•°"><a href="#åŒ¿åå‡½æ•°" class="headerlink" title="åŒ¿åå‡½æ•°"></a>åŒ¿åå‡½æ•°</h3><p>ä¸Šæ–‡ä¸­çš„ Lambda è¡¨è¾¾å¼ç¼ºå°‘æŒ‡å®šè¿”å›ç±»å‹çš„èƒ½åŠ›ï¼Œè™½ç„¶å¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿”å›å€¼ç±»å‹å¯ä»¥æ¨å¯¼å‡ºæ¥ï¼Œä½†å¦‚æœç¡®å®éœ€è¦æŒ‡å®šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>åŒ¿åå‡½æ•°</strong>ï¼Œ<br>å®ƒçœ‹èµ·æ¥éå¸¸åƒä¸€ä¸ªå¸¸è§„å‡½æ•°å£°æ˜ï¼Œé™¤äº†å…¶åç§°çœç•¥äº†ã€‚å…¶å‡½æ•°ä½“æ—¢å¯ä»¥æ˜¯è¡¨è¾¾å¼ä¹Ÿå¯ä»¥æ˜¯ä»£ç å—ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-title">fun</span><span class="hljs-params">(x: <span class="hljs-type">Int</span>, y: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> = x + y<br><span class="hljs-function"><span class="hljs-title">fun</span><span class="hljs-params">(x: <span class="hljs-type">Int</span>, y: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> &#123;<br>    <span class="hljs-keyword">return</span> x + y<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœå‚æ•°ç±»å‹å¯ä»¥æ¨æ–­å‡ºæ¥ï¼Œåˆ™å‚æ•°ç±»å‹å¯ä»¥çœç•¥</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">ints.filter(<span class="hljs-function"><span class="hljs-title">fun</span><span class="hljs-params">(item)</span></span> = item &gt; <span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><hr><p>å¯¹äºä¸Šé¢çš„å†…å®¹<br>å‡½æ•°å¼ï¼ˆSAMï¼‰æ¥å£ è‹±æ–‡ç‰ˆ: <a href="https://kotlinlang.org/docs/fun-interfaces.html">Functional (SAM) interfaces</a><br>å‡½æ•°å¼ï¼ˆSAMï¼‰æ¥å£ ä¸­æ–‡ç‰ˆ: <a href="https://book.kotlincn.net/text/fun-interfaces.html">å‡½æ•°å¼ï¼ˆSAMï¼‰æ¥å£</a><br>é«˜é˜¶å‡½æ•°å’ŒLambda è‹±æ–‡ç‰ˆ: <a href="https://kotlinlang.org/docs/lambdas.html">Higher-order functions and lambdas</a><br>é«˜é˜¶å‡½æ•°å’ŒLambda ä¸­æ–‡ç‰ˆ: <a href="https://book.kotlincn.net/text/lambdas.html">é«˜é˜¶å‡½æ•°ä¸ lambda è¡¨è¾¾å¼</a><br>è¿”å›ä¸è·³è½¬ ä¸­æ–‡ç‰ˆ: <a href="https://book.kotlincn.net/text/returns.html">è¿”å›ä¸è·³è½¬</a><br>è¿”å›ä¸è·³è½¬ è‹±æ–‡ç‰ˆ: <a href="https://kotlinlang.org/docs/returns.html">Returns and jumps</a></p><hr><p>å·²å­¦ä¹ ï¼š</p><ul><li><p>æ‰©å±•</p><ul><li><input type='checkbox' disabled='true' checked>æ‰©å±•å‡½æ•°</input></li><li><input type='checkbox' disabled='true' checked>æ‰©å±•å±æ€§</input></li><li><input type='checkbox' disabled='true' checked>ä½œç”¨åŸŸ</input></li></ul></li><li><p>å‡½æ•°ç±»å‹</p><ul><li><input type='checkbox' disabled='true' checked>å¸¦æœ‰æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹</input></li><li><input type='checkbox' disabled='true' checked>Lambdaè¡¨è¾¾å¼</input></li><li><input type='checkbox' disabled='true' checked>SAM è½¬æ¢</input></li></ul></li></ul><p>æœªå­¦ä¹ ï¼š</p><ul><li><p>å…³é”®å­—</p><ul><li>object</li><li>Unit</li><li>Nothing</li><li>withã€letã€runã€applyã€also</li><li>inline,noinline,crossinline</li></ul></li><li><p>æ³›å‹</p><ul><li>é€†å˜</li><li>åå˜</li></ul></li><li><p>å§”æ‰˜</p><ul><li>å§”æ‰˜ç±»</li><li>å§”æ‰˜å±æ€§</li><li>è‡ªå®šä¹‰å§”æ‰˜</li></ul></li><li><p>åç¨‹</p><ul><li>å¯åŠ¨</li><li>æŒ‚èµ·</li><li>Job</li><li>Context</li><li>Channel</li><li>Flow</li><li>select</li><li>å¹¶å‘ã€å¼‚å¸¸</li><li>launch</li><li>Dispatchers</li><li>CoroutineScope</li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç»§ç»­ä¸Šæ¬¡åœ¨æ‰©å±•å‡½æ•°ä¸­é—ç•™ä¸‹çš„é—®é¢˜ï¼šå‡½æ•°ç±»å‹ã€‚æ€»æ‰€å‘¨çŸ¥ï¼Œåœ¨Kotlin ä¸­å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯é«˜é˜¶å‡½æ•°å˜ï¼Ÿåˆ°å¤„ç¿»äº†ç¿»ï¼Œå‘ç°å·®ä¸å¤šæ˜¯è¿™ä¹ˆä¸ªæ„æ€ï¼š&lt;strong&gt;æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œæˆ–è€…è¿”å›ä¸€ä¸ªå‡½æ•°ã€‚&lt;/strong&gt;åœ¨ Kotlin åç¨‹ä¸­çš„ launchã€asyncå‡½æ•°ä»¥åŠå„ç§å„æ ·çš„æ¡†æ¶ä¸­åˆ°å¤„éƒ½æ˜¯é«˜é˜¶å‡½æ•°çš„å½±å­ï¼Œç§°é«˜é˜¶å‡½æ•°æ˜¯ Kotlinå‡½æ•°å¼ç¼–ç¨‹ã€å„å¤§æ¡†æ¶çš„åŸºçŸ³ä¹Ÿä¸è¿‡åˆ†ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Android" scheme="https://blog.huangyuanlove.com/tags/Android/"/>
    
    <category term="Kotlin" scheme="https://blog.huangyuanlove.com/tags/Kotlin/"/>
    
  </entry>
  
  <entry>
    <title>Kotlinä¸­çš„å‡½æ•°ç±»å‹åŠæ‰©å±•å‡½æ•°</title>
    <link href="https://blog.huangyuanlove.com/2024/04/22/Kotlin%E4%B8%AD%E7%9A%84%E6%89%A9%E5%B1%95%E5%87%BD%E6%95%B0%E5%8F%8A%E6%89%A9%E5%B1%95%E5%B1%9E%E6%80%A7/"/>
    <id>https://blog.huangyuanlove.com/2024/04/22/Kotlin%E4%B8%AD%E7%9A%84%E6%89%A9%E5%B1%95%E5%87%BD%E6%95%B0%E5%8F%8A%E6%89%A9%E5%B1%95%E5%B1%9E%E6%80%A7/</id>
    <published>2024-04-22T09:28:13.000Z</published>
    <updated>2024-04-28T03:12:44.861Z</updated>
    
    <content type="html"><![CDATA[<p>ç»§ç»­kotlin çš„å­¦ä¹ ï¼Œä¹‹å‰åªæ˜¯å­¦äº†ç‚¹çš®æ¯›ä¸­çš„çš®æ¯›ï¼Œä¼šäº†ä¸€äº›ç®€å•è¯­æ³•è€Œå·²ã€‚æœ€åé¢åˆ—äº†ä¸€ä¸ªå¤§çº²ï¼Œè®¤çœŸçš„å­¦ä¹ ä¸€ä¸‹ã€‚<br>ä»Šå¤©çš„å†…å®¹æ˜¯<strong>æ‰©å±•</strong>ã€‚gradleï¼š8.5ï¼Œæ’ä»¶ï¼šid â€˜org.jetbrains.kotlin.jvmâ€™ version â€˜1.9.23â€™</p><span id="more"></span><h3 id="ç®€ä»‹å’Œä½¿ç”¨"><a href="#ç®€ä»‹å’Œä½¿ç”¨" class="headerlink" title="ç®€ä»‹å’Œä½¿ç”¨"></a>ç®€ä»‹å’Œä½¿ç”¨</h3><p>kotlin ä¸­æ‰©å±•å¯ä»¥ç»™å·²æœ‰çš„ç±»æ·»åŠ é¢å¤–çš„æ–¹æ³•å’Œå±æ€§ï¼Œçœ‹èµ·æ¥å°±åƒæ˜¯ä¿®æ”¹äº†ç±»çš„æºç ä¸€æ ·ï¼Œè€Œä¸æ˜¯åƒ java ä¸€æ ·éœ€è¦ç»§æ‰¿è¯¥ç±»ç„¶åæ·»åŠ è‡ªå·±çš„æ–¹æ³•ã€‚æ‰©å±•åˆåˆ†ä¸ºæ‰©å±•å‡½æ•°å’Œæ‰©å±•å±æ€§ã€‚<br>é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨å˜ï¼Ÿå…¶å®å’Œå£°æ˜æ™®é€šå‡½æ•°å‡ ä¹ä¸€è‡´ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ªå«åšâ€æ¥æ”¶è€…â€çš„ä¸œè¥¿ï¼Œä¹Ÿå°±æ˜¯æ–‡æ¡£ä¸­çš„Receiverï¼Œè¯´ç™½äº†ï¼Œå…¶å®å°±æ˜¯é™åˆ¶è¿™ä¸ªæ¥æ”¶è€…ç±»å‹æ‰èƒ½ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦å¯¹è¿™ä¸ªç±»å‹ <strong>â€œæ·»åŠ â€</strong> ä¸€ä¸ªæ–¹æ³•ã€‚<br>æ¯”å¦‚æˆ‘ä»¬æƒ³è¦ç»™å­—ç¬¦ä¸²ç±»å‹æ·»åŠ ä¸€ä¸ªè·å–æœ€åä¸€ä¸ªå…ƒç´ çš„æ–¹æ³•ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> String.<span class="hljs-title">lastChar</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Char</span>?&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.isEmpty())&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">get</span>(length - <span class="hljs-number">1</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ–¹æ³•å£°æ˜è¡¨ç¤ºï¼šå¯¹<code>String</code>ç±»å‹å®šä¹‰ä¸€ä¸ªæ— å‚çš„<code>lastChar</code>æ–¹æ³•ï¼Œè¿”å›å€¼æ˜¯<code>Char?</code>ï¼Œä½¿ç”¨çš„æ—¶å€™å°±åƒä½¿ç”¨ String ç±»ä¸­çš„æ–¹æ³•ä¸€æ ·ä½¿ç”¨å°±å¥½äº†ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> s = <span class="hljs-string">&quot;kotlin&quot;</span><br>    println(s.lastChar())<br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆæ‰©å±•å±æ€§æ€ä¹ˆä½¿ç”¨å˜ï¼Ÿå’Œæ‰©å±•å‡½æ•°å·®ä¸å¤šï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> String.firstChar:<span class="hljs-built_in">Char</span>?<br>    <span class="hljs-keyword">get</span>() = <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.isEmpty()) <span class="hljs-literal">null</span> <span class="hljs-keyword">else</span> <span class="hljs-keyword">get</span>(<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><p>å¯ä»¥ç®€å•çš„è®¤ä¸ºä¸Šé¢çš„å£°æ˜æ˜¯è¿™æ ·:å¯¹<code>String</code>ç±»å‹é¡¶ä¸€ä¸ª<code>firstChar</code>å±æ€§ï¼Œç±»å‹æ˜¯<code>Char?</code>,ä½¿ç”¨æ—¶å’Œä½¿ç”¨ String ç±»ä¸­çš„å±æ€§ä¸€æ ·å°±å¥½äº†:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> s = <span class="hljs-string">&quot;kotlin&quot;</span><br>    println(s.lastChar())<br>    println(s.firstChar)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ€è€ƒï¼šJavaä¸­å¦‚ä½•ä½¿ç”¨ï¼Ÿ"><a href="#æ€è€ƒï¼šJavaä¸­å¦‚ä½•ä½¿ç”¨ï¼Ÿ" class="headerlink" title="æ€è€ƒï¼šJavaä¸­å¦‚ä½•ä½¿ç”¨ï¼Ÿ"></a>æ€è€ƒï¼šJavaä¸­å¦‚ä½•ä½¿ç”¨ï¼Ÿ</h3><p>æ¥ä¸‹æ¥æ€è€ƒä¸€ä¸‹åœ¨ java ä¸­å¦‚ä½•è°ƒç”¨å˜ï¼Ÿå¾—å…ˆçœ‹çœ‹ kotlin æ˜¯å¦‚ä½•å®ç°æ‰©å±•çš„ã€‚æœ€ç®€å•çš„æ–¹æ³•ï¼Œçœ‹åç¼–è¯‘åçš„å­—èŠ‚ç æ–‡ä»¶ï¼š<br>é¡¶éƒ¨èœå•ä¸­ toolsâ€“&gt;kotlinâ€“&gt;Show Kotlin Bytecodeï¼Œç„¶åç‚¹Decompileå°±å¯ä»¥çœ‹åˆ°äº†<br><img src="/image/kotlin/show_kotlin_bytecode.png" alt="decompile kotlin bytecode"><br>ä»£ç å¤§è‡´å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainKt</span> &#123;<br>   <span class="hljs-meta">@Nullable</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Character <span class="hljs-title function_">lastChar</span><span class="hljs-params">(<span class="hljs-meta">@NotNull</span> String $<span class="hljs-built_in">this</span>$lastChar)</span> &#123;<br>      Intrinsics.checkNotNullParameter($<span class="hljs-built_in">this</span>$lastChar, <span class="hljs-string">&quot;&lt;this&gt;&quot;</span>);<br>      <span class="hljs-keyword">return</span> ((CharSequence)$<span class="hljs-built_in">this</span>$lastChar).length() == <span class="hljs-number">0</span> ? <span class="hljs-literal">null</span> : $<span class="hljs-built_in">this</span>$lastChar.charAt($<span class="hljs-built_in">this</span>$lastChar.length() - <span class="hljs-number">1</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Nullable</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Character <span class="hljs-title function_">getFirstChar</span><span class="hljs-params">(<span class="hljs-meta">@NotNull</span> String $<span class="hljs-built_in">this</span>$firstChar)</span> &#123;<br>      Intrinsics.checkNotNullParameter($<span class="hljs-built_in">this</span>$firstChar, <span class="hljs-string">&quot;&lt;this&gt;&quot;</span>);<br>      <span class="hljs-keyword">return</span> ((CharSequence)$<span class="hljs-built_in">this</span>$firstChar).length() == <span class="hljs-number">0</span> ? <span class="hljs-literal">null</span> : $<span class="hljs-built_in">this</span>$firstChar.charAt(<span class="hljs-number">0</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;kotlin&quot;</span>;<br>      <span class="hljs-type">Character</span> <span class="hljs-variable">var1</span> <span class="hljs-operator">=</span> lastChar(s);<br>      System.out.println(var1);<br>      var1 = getFirstChar(s);<br>      System.out.println(var1);<br>   &#125;<br><br>   <span class="hljs-comment">// $FF: synthetic method</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      main();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åç¼–è¯‘ä¹‹åçš„ä»£ç åªæ˜¯æ·»åŠ äº†ä¸¤ä¸ªé™æ€æ–¹æ³•è€Œå·²ï¼Œè¿™æ ·çš„è¯ï¼Œåœ¨ Java ä¸­æˆ‘ä»¬å°±å¯ä»¥è¿™ä¹ˆä½¿ç”¨äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestMain</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Hello World!&quot;</span>;<br>        System.out.println( MainKt.lastChar(s));<br>        System.out.println( MainKt.getFirstChar(s));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ€è€ƒï¼šä½œç”¨åŸŸï¼Œç»§æ‰¿ä¸é‡è½½"><a href="#æ€è€ƒï¼šä½œç”¨åŸŸï¼Œç»§æ‰¿ä¸é‡è½½" class="headerlink" title="æ€è€ƒï¼šä½œç”¨åŸŸï¼Œç»§æ‰¿ä¸é‡è½½"></a>æ€è€ƒï¼šä½œç”¨åŸŸï¼Œç»§æ‰¿ä¸é‡è½½</h3><p>æ¥ä¸‹æ¥æ€è€ƒå¦å¤–ä¸€ä¸ªé—®é¢˜ï¼šä½œç”¨åŸŸï¼Œæˆ–è€…è¯´æˆ‘ä»¬å¯ä»¥åœ¨å“ªé‡Œå£°æ˜ã€åœ¨å“ªé‡Œè°ƒç”¨æ‰©å±•å‡½æ•°ï¼Ÿ<br>ä¸Šé¢çš„ä¾‹å­ä¸­éƒ½æ˜¯å£°æ˜ä¸ºäº†é¡¶çº§å‡½æ•°(top level),æˆ‘ä»¬å¯ä»¥åœ¨ä»»æ„åœ°æ–¹ä½¿ç”¨å¯¹åº”çš„ç±»å‹è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœå£°æ˜åœ¨ç±»é‡Œé¢ä¼šæ€ä¹ˆæ ·ï¼Ÿ</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Example</span></span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> String.<span class="hljs-title">isEmail</span><span class="hljs-params">()</span></span>:<span class="hljs-built_in">Boolean</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.contains(<span class="hljs-string">&quot;@&quot;</span>)<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">test</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">val</span> email = <span class="hljs-string">&quot;a@a.com&quot;</span><br>        println(email.isEmail())<br>    &#125;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">test</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">val</span> email = <span class="hljs-string">&quot;a@a.com&quot;</span><br>    println(email.isEmail())<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨ç±»é‡Œé¢å®šä¹‰çš„æ‰©å±•å‡½æ•°ï¼Œåªèƒ½åœ¨ç±»é‡Œé¢è°ƒç”¨ï¼Œåœ¨ç±»å¤–æ˜¯æ— æ³•ä½¿ç”¨çš„ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç»§æ‰¿Exampleçš„ç±»ä¸­ä½¿ç”¨ï¼Œæ¯”å¦‚è¿™æ ·</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SubExample</span> :<span class="hljs-type">Example</span></span>()&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subTest</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">val</span> email = <span class="hljs-string">&quot;a@a&quot;</span><br>        println(email.isEmail())<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœå¯¹<code>Example</code>å®šä¹‰ä¸€ä¸ªæ‰©å±•å‡½æ•°ï¼Œé‚£ä¹ˆåœ¨å­ç±»SubExampleä¸­èƒ½è°ƒç”¨ä¹ˆï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ä¸èƒ½è¦†å†™ï¼Œå› ä¸ºkotlinä¸­çš„å‡½æ•°é»˜è®¤æ˜¯<code>final</code>ä¸èƒ½è¢«è¦†å†™çš„ï¼ŒåŒæ—¶å®šä¹‰æ‰©å±•å‡½æ•°æ—¶åˆä¸èƒ½è¢«<code>open</code>ä¿®é¥°ï¼Œä»è¯­æ³•ä¸Šè®²ï¼Œè¿™æ˜¯æ‰©å±•å‡½æ•°ä¸èƒ½è¢«è¦†å†™çš„åŸå› ã€‚çœ‹åç¼–è¯‘ä¹‹åçš„ä»£ç ï¼Œå®šä¹‰ä¸ºé¡¶çº§å‡½æ•°çš„æ‰©å±•å‡½æ•°æ˜¯ static çš„ï¼Œå› æ­¤ä¹Ÿä¸èƒ½è¢«è¦†å†™ã€‚<br>é‚£ä¹ˆåœ¨ Java ä¸­èƒ½ä¸èƒ½ç”¨å˜ï¼Ÿé‡äº‹ä¸å†³å…ˆçœ‹åç¼–è¯‘åçš„ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmail</span><span class="hljs-params">(<span class="hljs-meta">@NotNull</span> String $<span class="hljs-built_in">this</span>$isEmail)</span> &#123;<br>      Intrinsics.checkNotNullParameter($<span class="hljs-built_in">this</span>$isEmail, <span class="hljs-string">&quot;&lt;this&gt;&quot;</span>);<br>      <span class="hljs-keyword">return</span> StringsKt.contains$<span class="hljs-keyword">default</span>((CharSequence)$<span class="hljs-built_in">this</span>$isEmail, (CharSequence)<span class="hljs-string">&quot;@&quot;</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">2</span>, (Object)<span class="hljs-literal">null</span>);<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-type">String</span> <span class="hljs-variable">email</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;a@a.com&quot;</span>;<br>      <span class="hljs-type">boolean</span> <span class="hljs-variable">var2</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.isEmail(email);<br>      System.out.println(var2);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯å°±å¯ä»¥é€šè¿‡<code>Example</code>å®ä¾‹æ¥è°ƒç”¨äº†ã€‚åŒæ ·æ³¨æ„åˆ°åœ¨<code>Example</code>ç±»ä¸­å®šä¹‰çš„æ‰©å±•å‡½æ•°<code>isEmail</code>è¢« final ä¿®é¥°äº†ï¼Œå› æ­¤ä¹Ÿæ— æ³•é€šè¿‡ç»§æ‰¿æ¥è¦†å†™è¯¥æ–¹æ³•ã€‚</p><h3 id="æ€è€ƒï¼šæ‰©å±•å‡½æ•°å¦‚ä½•å¼•ç”¨ï¼Ÿ"><a href="#æ€è€ƒï¼šæ‰©å±•å‡½æ•°å¦‚ä½•å¼•ç”¨ï¼Ÿ" class="headerlink" title="æ€è€ƒï¼šæ‰©å±•å‡½æ•°å¦‚ä½•å¼•ç”¨ï¼Ÿ"></a>æ€è€ƒï¼šæ‰©å±•å‡½æ•°å¦‚ä½•å¼•ç”¨ï¼Ÿ</h3><p>å˜¿å˜¿å˜¿,æˆ‘ä»¬çŸ¥é“å‡½æ•°æ˜¯å¯ä»¥é€šè¿‡åŒå†’å·å¼•ç”¨çš„</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">sayHi</span><span class="hljs-params">(name: <span class="hljs-type">String</span>)</span></span> &#123;<br>    println(<span class="hljs-string">&quot;hi <span class="hljs-variable">$name</span>&quot;</span>)<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">referenceMethod</span><span class="hljs-params">(method: (<span class="hljs-type">String</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span> &#123;<br>    method(<span class="hljs-string">&quot;xuan&quot;</span>)<br>    method.invoke(<span class="hljs-string">&quot;yuan&quot;</span>)<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    referenceMethod(::sayHi)<br>    referenceMethod &#123; name -&gt; println(<span class="hljs-string">&quot;hello <span class="hljs-variable">$name</span>&quot;</span>) &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆæ‰©å±•å‡½æ•°åº”è¯¥å¦‚ä½•å¼•ç”¨å˜ï¼Ÿè¿™é‡Œå…ˆå­¦æ€ä¹ˆç”¨ï¼Œåé¢å†å­¦å‡½æ•°ç±»å‹å§<br>å¦‚æœæˆ‘ä»¬å°†æ‰©å±•å‡½æ•°å®šä¹‰ä¸ºé¡¶çº§å‡½æ•°ï¼Œé‚£ä¹ˆåœ¨åº”ç”¨çš„æ—¶å€™å’Œå¼•ç”¨è¿™ä¸ªç±»æœ¬èº«çš„æˆå‘˜å‡½æ•°æ²¡å•¥åŒºåˆ«,æ¯”å¦‚åœ¨ä¸€å¼€å§‹æˆ‘ä»¬å¯¹ String å®šä¹‰çš„æ‰©å±•å‡½æ•° lastChar,æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå¼•ç”¨ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-keyword">val</span> lastCharFun1 = String::lastChar<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å°†æ‰©å±•å‡½æ•°å®šä¹‰åœ¨ç±»é‡Œé¢åˆè¯¥å¦‚ä½•åº”å¯¹ï¼Ÿåº”å¯¹ä¸äº†ï¼Œæ²¡æ³•å¼•ç”¨ã€‚<br>ä¸ºä»€ä¹ˆï¼Ÿæ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œæ‰©å±•å‡½æ•°å±äºå“ªä¸ªç±»ï¼Ÿå®é™…ä¸Šå¯ä»¥è®¤ä¸ºæ‰©å±•å‡½æ•°è°éƒ½ä¸å±äºï¼Œåªæ˜¯åŠ äº†ä¸€ä¸ªé™å®šï¼Œé™å®šå“ªä¸ªç±»å‹çš„å¯¹è±¡å¯ä»¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚<br>å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œè¯­æ³•ä¸Šå¼•ç”¨ç±»çš„æˆå‘˜å‡½æ•°æ˜¯ç±»ååŒå†’å·å‡½æ•°åï¼Œé‚£å¼•ç”¨æ‰©å±•å‡½æ•°ä¹Ÿæ˜¯è¿™æ ·ï¼Œä½†æ˜¯æŠŠæ‰©å±•å‡½æ•°å®šä¹‰åœ¨å…¶ä»–ç±»ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥ç”¨å“ªä¸ªç±»åï¼Ÿå¹²è„†ä¸èƒ½å¼•ç”¨å°±å¥½äº†ã€‚</p><hr><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>äº†è§£äº†æ‰©å±•å‡½æ•°ã€æ‰©å±•å±æ€§ åŠå…¶ä½œç”¨åŸŸã€‚äº†è§£äº†åœ¨ Java å±‚é¢å¦‚ä½•å®ç°çš„ä»¥åŠ Java ä¸­å¦‚ä½•ä½¿ç”¨ã€‚ç¿»çœ‹ kotlin æºç ï¼Œæœ‰å¾ˆå¤šéƒ½æ˜¯åŸºäºæ‰©å±•æ¥å®ç°çš„ï¼Œæ¯”å¦‚ Stringã€æ¯”å¦‚ä¸€äº›æ•°å­—ç±»å‹ Floatã€Double ç­‰ã€‚</p><p>åˆ°æ­¤ï¼Œæ‰©å±•å°±å·®ä¸å¤šäº†ï¼Œåº”è¯¥è¿˜ä¼šæœ‰ä¸€äº›å°ç»†èŠ‚ä¸Šçš„é—®é¢˜ï¼Œä½†é—®é¢˜åº”è¯¥ä¸å¤§ã€‚æ¥ä¸‹æ¥åº”è¯¥ä¼šå­¦ä¹ ä¸€ä¸‹é—ç•™ä¸‹æ¥çš„é—®é¢˜ï¼šå‡½æ•°ç±»å‹ä»¥åŠlambda è¡¨è¾¾å¼</p><hr><p>å·²å­¦ä¹ ï¼š</p><ul><li>æ‰©å±•<ul><li><input type='checkbox' disabled='true' checked>æ‰©å±•å‡½æ•°</input></li><li><input type='checkbox' disabled='true' checked>æ‰©å±•å±æ€§</input></li><li><input type='checkbox' disabled='true' checked>ä½œç”¨åŸŸ</input></li></ul></li></ul><p>æœªå­¦ä¹ ï¼š</p><ul><li><p>Lambdaè¡¨è¾¾å¼</p><ul><li>SAM è½¬æ¢</li><li>å‡½æ•°ç±»å‹</li></ul></li><li><p>å‡½æ•°ç±»å‹</p><ul><li>å¸¦æœ‰æ¥æ”¶è€…çš„å‡½æ•°ç±»å‹</li></ul></li><li><p>å…³é”®å­—</p><ul><li>object</li><li>Unit</li><li>Nothing</li><li>withã€letã€runã€applyã€also</li></ul></li><li><p>æ³›å‹</p><ul><li>é€†å˜</li><li>åå˜</li></ul></li><li><p>å§”æ‰˜</p><ul><li>å§”æ‰˜ç±»</li><li>å§”æ‰˜å±æ€§</li><li>è‡ªå®šä¹‰å§”æ‰˜</li></ul></li><li><p>åç¨‹</p><ul><li>å¯åŠ¨</li><li>æŒ‚èµ·</li><li>Job</li><li>Context</li><li>Channel</li><li>Flow</li><li>select</li><li>å¹¶å‘ã€å¼‚å¸¸</li><li>launch</li><li>Dispatchers</li><li>CoroutineScope</li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç»§ç»­kotlin çš„å­¦ä¹ ï¼Œä¹‹å‰åªæ˜¯å­¦äº†ç‚¹çš®æ¯›ä¸­çš„çš®æ¯›ï¼Œä¼šäº†ä¸€äº›ç®€å•è¯­æ³•è€Œå·²ã€‚æœ€åé¢åˆ—äº†ä¸€ä¸ªå¤§çº²ï¼Œè®¤çœŸçš„å­¦ä¹ ä¸€ä¸‹ã€‚&lt;br&gt;ä»Šå¤©çš„å†…å®¹æ˜¯&lt;strong&gt;æ‰©å±•&lt;/strong&gt;ã€‚gradleï¼š8.5ï¼Œæ’ä»¶ï¼šid â€˜org.jetbrains.kotlin.jvmâ€™ version â€˜1.9.23â€™&lt;/p&gt;</summary>
    
    
    
    
    <category term="Android" scheme="https://blog.huangyuanlove.com/tags/Android/"/>
    
    <category term="Kotlin" scheme="https://blog.huangyuanlove.com/tags/Kotlin/"/>
    
  </entry>
  
  <entry>
    <title>Retrofitæµç¨‹åˆ†æ</title>
    <link href="https://blog.huangyuanlove.com/2024/04/07/Retrofit%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90/"/>
    <id>https://blog.huangyuanlove.com/2024/04/07/Retrofit%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90/</id>
    <published>2024-04-07T07:35:44.000Z</published>
    <updated>2024-04-08T06:31:54.409Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ä»‹ç»äº†ã€Šåœ¨kotlinåç¨‹ä¸­ä½¿ç”¨è‡ªå®šä¹‰CallAdapterå¤„ç†é”™è¯¯ã€‹ï¼Œæ—¢ç„¶é€‰æ‹©äº†å®ƒï¼Œå½“ç„¶å¾—å…ˆå…¨é¢äº†è§£ä¸€ä¸‹ã€‚<br>å…ˆä¸‹è½½ä¸€ä¸‹æºç ï¼Œæ­å»ºä¸€ä¸‹ç¯å¢ƒï¼Œä¹Ÿæ²¡å•¥å¥½è¯´çš„ï¼Œæˆ‘ä¸‹è½½çš„æ˜¯2.11.0 ç‰ˆæœ¬çš„ä»£ç ï¼Œä½¿ç”¨çš„ IDEA2023.3.6ã€‚è¿™éƒ½æ˜¯å°äº‹æƒ…ï¼Œåªè¦èƒ½æœ‰ä»£ç è·³è½¬åŠŸèƒ½å°±å¥½ã€‚é¦–æ¬¡é…ç½®éœ€è¦ä¸‹è½½ç›¸åº”ä¾èµ–ï¼Œæ—¶é—´ä¼šé•¿ä¸€äº›ï¼Œè¿™ä¸é‡è¦ã€‚ç­‰é…ç½®å®Œæˆåï¼Œæ‰¾åˆ° simple moduleï¼Œæœ‰å„ç§å„æ ·çš„ç¤ºä¾‹ä»£ç ã€‚æ˜¯å¯ä»¥ç›´æ¥è¿è¡Œçš„ã€‚</p><span id="more"></span><h2 id="åˆ›å»ºRetrofitå¯¹è±¡"><a href="#åˆ›å»ºRetrofitå¯¹è±¡" class="headerlink" title="åˆ›å»ºRetrofitå¯¹è±¡"></a>åˆ›å»ºRetrofitå¯¹è±¡</h2><p>æˆ‘ä»¬å…ˆä»å¦‚ä½•åˆ›å»ºçš„<code>Retrofit</code>å¯¹è±¡å¼€å§‹<br>å…ˆçœ‹ä¸€ä¸‹æˆ‘ä»¬å¯ä»¥è®¾ç½®å“ªäº›å‚æ•°ï¼Œæ’¸ä¸€ä¸‹æºç ï¼Œæ‰¾ä¸€ä¸‹<code>Retrofit.Builder</code>ç±»</p><h3 id="è®¾ç½®OkHttpClient"><a href="#è®¾ç½®OkHttpClient" class="headerlink" title="è®¾ç½®OkHttpClient"></a>è®¾ç½®<code>OkHttpClient</code></h3><p>è¿™é‡Œçš„<code>OkHttpClient</code>å®ç°äº†<code>Call.Factory</code>æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">client</span><span class="hljs-params">(OkHttpClient client)</span> &#123;<br>  <span class="hljs-keyword">return</span> callFactory(Objects.requireNonNull(client, <span class="hljs-string">&quot;client == null&quot;</span>));<br>&#125;<br><span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">callFactory</span><span class="hljs-params">(okhttp3.Call.Factory factory)</span> &#123;<br>  <span class="hljs-built_in">this</span>.callFactory = Objects.requireNonNull(factory, <span class="hljs-string">&quot;factory == null&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è®¾ç½®-baseUrl"><a href="#è®¾ç½®-baseUrl" class="headerlink" title="è®¾ç½® baseUrl"></a>è®¾ç½® baseUrl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">baseUrl</span><span class="hljs-params">(URL baseUrl)</span> &#123;<br>  Objects.requireNonNull(baseUrl, <span class="hljs-string">&quot;baseUrl == null&quot;</span>);<br>  <span class="hljs-keyword">return</span> baseUrl(HttpUrl.get(baseUrl.toString()));<br>&#125;<br><span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">baseUrl</span><span class="hljs-params">(String baseUrl)</span> &#123;<br>  Objects.requireNonNull(baseUrl, <span class="hljs-string">&quot;baseUrl == null&quot;</span>);<br>  <span class="hljs-keyword">return</span> baseUrl(HttpUrl.get(baseUrl));<br>&#125;<br><span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">baseUrl</span><span class="hljs-params">(HttpUrl baseUrl)</span> &#123;<br>  Objects.requireNonNull(baseUrl, <span class="hljs-string">&quot;baseUrl == null&quot;</span>);<br>  List&lt;String&gt; pathSegments = baseUrl.pathSegments();<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-string">&quot;&quot;</span>.equals(pathSegments.get(pathSegments.size() - <span class="hljs-number">1</span>))) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;baseUrl must end in /: &quot;</span> + baseUrl);<br>  &#125;<br>  <span class="hljs-built_in">this</span>.baseUrl = baseUrl;<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åºåˆ—åŒ–å’Œååºåˆ—åŒ–"><a href="#åºåˆ—åŒ–å’Œååºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–å’Œååºåˆ—åŒ–"></a>åºåˆ—åŒ–å’Œååºåˆ—åŒ–</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">addConverterFactory</span><span class="hljs-params">(Converter.Factory factory)</span> &#123;<br>  converterFactories.add(Objects.requireNonNull(factory, <span class="hljs-string">&quot;factory == null&quot;</span>));<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ”¯æŒâ€™Callâ€™å¯¹è±¡ä¹‹å¤–çš„è¿”å›ç±»å‹"><a href="#æ”¯æŒâ€™Callâ€™å¯¹è±¡ä¹‹å¤–çš„è¿”å›ç±»å‹" class="headerlink" title="æ”¯æŒâ€™Callâ€™å¯¹è±¡ä¹‹å¤–çš„è¿”å›ç±»å‹"></a>æ”¯æŒâ€™Callâ€™å¯¹è±¡ä¹‹å¤–çš„è¿”å›ç±»å‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">addCallAdapterFactory</span><span class="hljs-params">(CallAdapter.Factory factory)</span> &#123;<br>  callAdapterFactories.add(Objects.requireNonNull(factory, <span class="hljs-string">&quot;factory == null&quot;</span>));<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è°ƒç”¨-callBack-æ—¶ä½¿ç”¨çš„Executor"><a href="#è°ƒç”¨-callBack-æ—¶ä½¿ç”¨çš„Executor" class="headerlink" title="è°ƒç”¨ callBack æ—¶ä½¿ç”¨çš„Executor"></a>è°ƒç”¨ callBack æ—¶ä½¿ç”¨çš„Executor</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">callbackExecutor</span><span class="hljs-params">(Executor executor)</span> &#123;<br>  <span class="hljs-built_in">this</span>.callbackExecutor = Objects.requireNonNull(executor, <span class="hljs-string">&quot;executor == null&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ˜¯å¦æå‰éªŒè¯æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•"><a href="#æ˜¯å¦æå‰éªŒè¯æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•" class="headerlink" title="æ˜¯å¦æå‰éªŒè¯æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•"></a>æ˜¯å¦æå‰éªŒè¯æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> Builder <span class="hljs-title function_">validateEagerly</span><span class="hljs-params">(<span class="hljs-type">boolean</span> validateEagerly)</span> &#123;<br>  <span class="hljs-built_in">this</span>.validateEagerly = validateEagerly;<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è°ƒç”¨-build-æ–¹æ³•åˆ›å»º-Retrofit-å¯¹è±¡"><a href="#è°ƒç”¨-build-æ–¹æ³•åˆ›å»º-Retrofit-å¯¹è±¡" class="headerlink" title="è°ƒç”¨ build()æ–¹æ³•åˆ›å»º Retrofit å¯¹è±¡"></a>è°ƒç”¨ build()æ–¹æ³•åˆ›å»º Retrofit å¯¹è±¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> Retrofit <span class="hljs-title function_">build</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-keyword">if</span> (baseUrl == <span class="hljs-literal">null</span>) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;Base URL required.&quot;</span>);<br>  &#125;<br><br>  okhttp3.Call.<span class="hljs-type">Factory</span> <span class="hljs-variable">callFactory</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.callFactory;<br>  <span class="hljs-keyword">if</span> (callFactory == <span class="hljs-literal">null</span>) &#123;<br>      callFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpClient</span>();<br>  &#125;<br><br>  <span class="hljs-type">Executor</span> <span class="hljs-variable">callbackExecutor</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.callbackExecutor;<br>  <span class="hljs-keyword">if</span> (callbackExecutor == <span class="hljs-literal">null</span>) &#123;<br>      callbackExecutor = Platform.callbackExecutor;<br>  &#125;<br><br>  <span class="hljs-type">BuiltInFactories</span> <span class="hljs-variable">builtInFactories</span> <span class="hljs-operator">=</span> Platform.builtInFactories;<br><br>  <span class="hljs-comment">// Make a defensive copy of the adapters and add the default Call adapter.</span><br>  List&lt;CallAdapter.Factory&gt; callAdapterFactories = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(<span class="hljs-built_in">this</span>.callAdapterFactories);<br>  List&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CallAdapter</span>.Factory&gt; defaultCallAdapterFactories =<br>  builtInFactories.createDefaultCallAdapterFactories(callbackExecutor);<br>  callAdapterFactories.addAll(defaultCallAdapterFactories);<br><br>  <span class="hljs-comment">// Make a defensive copy of the converters.</span><br>  List&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Converter</span>.Factory&gt; defaultConverterFactories =<br>  builtInFactories.createDefaultConverterFactories();<br>  <span class="hljs-type">int</span> <span class="hljs-variable">defaultConverterFactoriesSize</span> <span class="hljs-operator">=</span> defaultConverterFactories.size();<br>  List&lt;Converter.Factory&gt; converterFactories =<br>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(<span class="hljs-number">1</span> + <span class="hljs-built_in">this</span>.converterFactories.size() + defaultConverterFactoriesSize);<br><br>  <span class="hljs-comment">// Add the built-in converter factory first. This prevents overriding its behavior but also</span><br>  <span class="hljs-comment">// ensures correct behavior when using converters that consume all types.</span><br>  converterFactories.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BuiltInConverters</span>());<br>  converterFactories.addAll(<span class="hljs-built_in">this</span>.converterFactories);<br>  converterFactories.addAll(defaultConverterFactories);<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Retrofit</span>(<br>      callFactory,<br>      baseUrl,<br>      unmodifiableList(converterFactories),<br>      defaultConverterFactoriesSize,<br>      unmodifiableList(callAdapterFactories),<br>      defaultCallAdapterFactories.size(),<br>      callbackExecutor,<br>      validateEagerly);<br>&#125;<br></code></pre></td></tr></table></figure><ol><li>é¦–å…ˆæ£€æŸ¥æ˜¯å¦è®¾ç½®äº† baseUrlï¼Œæ²¡è®¾ç½®ç›´æ¥æŠ›å¼‚å¸¸</li><li>è®¾ç½®callFactoryï¼Œé»˜è®¤ä¸ºOkHttpClient</li><li>è®¾ç½®callbackExecutoré»˜è®¤ä¸ºplatform.defaultCallbackExecutor()ï¼ŒAndroidå¹³å°ä¸ºMainThreadExecutorï¼Œå…¶ä»–å¹³å°ä¸º nullã€‚è¿™é‡Œçš„ AndroidMainExecutor åªæ˜¯ç®€å•çš„ä½¿ç”¨ handler è½¬å‘åˆ°ä¸»çº¿ç¨‹<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AndroidMainExecutor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Executor</span> &#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Handler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>(Looper.getMainLooper());<br><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(Runnable r)</span> &#123;<br>      handler.post(r);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li>callAdapterFactories é»˜è®¤æ·»åŠ  platform.defaultCallAdapterFactories,è¿”å›å€¼ä¸ºDefaultCallAdapterFactoryï¼Œä¹‹ååœ¨ kotlin ä¸­ä½¿ç”¨å¯†é—­ç±»ä»£æ›¿ callback æ—¶å°±æ˜¯æŠ„çš„è¿™ä¸ªç±»ä¸­çš„æ–¹æ³•</li><li>converterFactories<br>  â—‹ å…ˆæ·»åŠ  new BuiltInConverters()<br>  â—‹ å†æ·»åŠ è‡ªå®šä¹‰çš„<br>  â—‹ æœ€åæ·»åŠ platform.defaultConverterFactories() é»˜è®¤æ˜¯ç©ºçš„<br>è¿™æ ·å°±é…ç½®å¥½çš„ Retrofit å¯¹è±¡</li></ol><h2 id="å¦‚ä½•å‘é€è¯·æ±‚"><a href="#å¦‚ä½•å‘é€è¯·æ±‚" class="headerlink" title="å¦‚ä½•å‘é€è¯·æ±‚"></a>å¦‚ä½•å‘é€è¯·æ±‚</h2><p>æˆ‘ä»¬åœ¨å®šä¹‰ç½‘ç»œè¯·æ±‚æ—¶æ˜¯è¿™ä¹ˆå†™çš„</p><h3 id="å®šä¹‰ç½‘ç»œè¯·æ±‚"><a href="#å®šä¹‰ç½‘ç»œè¯·æ±‚" class="headerlink" title="å®šä¹‰ç½‘ç»œè¯·æ±‚"></a>å®šä¹‰ç½‘ç»œè¯·æ±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GitHub</span> &#123;<br>  <span class="hljs-meta">@GET(&quot;/repos/&#123;owner&#125;/&#123;repo&#125;/contributors&quot;)</span><br>  Call&lt;List&lt;Contributor&gt;&gt; <span class="hljs-title function_">contributors</span><span class="hljs-params">(<span class="hljs-meta">@Path(&quot;owner&quot;)</span> String owner, <span class="hljs-meta">@Path(&quot;repo&quot;)</span> String repo)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åˆ›å»ºGitHubå¯¹è±¡-å’Œå‘é€è¯·æ±‚"><a href="#åˆ›å»ºGitHubå¯¹è±¡-å’Œå‘é€è¯·æ±‚" class="headerlink" title="åˆ›å»ºGitHubå¯¹è±¡ å’Œå‘é€è¯·æ±‚"></a>åˆ›å»º<strong>GitHubå¯¹è±¡</strong> å’Œå‘é€è¯·æ±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-comment">// Create an instance of our GitHub API interface.</span><br><span class="hljs-type">GitHub</span> <span class="hljs-variable">github</span> <span class="hljs-operator">=</span> retrofit.create(GitHub.class);<br><span class="hljs-comment">// Create a call instance for looking up Retrofit contributors.</span><br>Call&lt;List&lt;Contributor&gt;&gt; call = github.contributors(<span class="hljs-string">&quot;square&quot;</span>, <span class="hljs-string">&quot;retrofit&quot;</span>);<br><span class="hljs-comment">// Fetch and print a list of the contributors to the library.</span><br>List&lt;Contributor&gt; contributors = call.execute().body();<br></code></pre></td></tr></table></figure><p>é‡ç‚¹åœ¨æˆ‘ä»¬è°ƒç”¨<code>retrofit.create</code>æ–¹æ³•æ—¶ç”¨åˆ°çš„åŠ¨æ€ä»£ç†å•†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">create</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Class&lt;T&gt; service)</span> &#123;<br>  validateServiceInterface(service);<br>  <span class="hljs-keyword">return</span> (T)<br>      Proxy.newProxyInstance(<br>          service.getClassLoader(),<br>          <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>&lt;?&gt;[] &#123;service&#125;,<br>          <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvocationHandler</span>() &#123;<br>            <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object[] emptyArgs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[<span class="hljs-number">0</span>];<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-meta">@Nullable</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, <span class="hljs-meta">@Nullable</span> Object[] args)</span><br>                <span class="hljs-keyword">throws</span> Throwable &#123;<br>              <span class="hljs-comment">// If the method is a method from Object then defer to normal invocation.</span><br>              <span class="hljs-keyword">if</span> (method.getDeclaringClass() == Object.class) &#123;<br>                <span class="hljs-keyword">return</span> method.invoke(<span class="hljs-built_in">this</span>, args);<br>              &#125;<br>              args = args != <span class="hljs-literal">null</span> ? args : emptyArgs;<br>              <span class="hljs-type">Reflection</span> <span class="hljs-variable">reflection</span> <span class="hljs-operator">=</span> Platform.reflection;<br>              <span class="hljs-keyword">return</span> reflection.isDefaultMethod(method)<br>                  ? reflection.invokeDefaultMethod(method, service, proxy, args)<br>                  : loadServiceMethod(service, method).invoke(proxy, args);<br>            &#125;<br>          &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="validateServiceInterface"><a href="#validateServiceInterface" class="headerlink" title="validateServiceInterface"></a>validateServiceInterface</h3><p>åˆ›å»º Github å¯¹è±¡æ—¶ä½¿ç”¨äº†åŠ¨æ€ä»£ç†ï¼Œä¸è¿‡åœ¨åˆ›å»ºä¹‹å‰ï¼Œå…ˆè°ƒç”¨äº†<code>validateServiceInterface(service);</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validateServiceInterface</span><span class="hljs-params">(Class&lt;?&gt; service)</span> &#123;<br>    <span class="hljs-keyword">if</span> (!service.isInterface()) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;API declarations must be interfaces.&quot;</span>);<br>    &#125;<br><br>    Deque&lt;Class&lt;?&gt;&gt; check = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayDeque</span>&lt;&gt;(<span class="hljs-number">1</span>);<br>    check.add(service);<br>    <span class="hljs-keyword">while</span> (!check.isEmpty()) &#123;<br>      Class&lt;?&gt; candidate = check.removeFirst();<br>      <span class="hljs-keyword">if</span> (candidate.getTypeParameters().length != <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span><br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(<span class="hljs-string">&quot;Type parameters are unsupported on &quot;</span>).append(candidate.getName());<br>        <span class="hljs-keyword">if</span> (candidate != service) &#123;<br>          message.append(<span class="hljs-string">&quot; which is an interface of &quot;</span>).append(service.getName());<br>        &#125;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(message.toString());<br>      &#125;<br>      Collections.addAll(check, candidate.getInterfaces());<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (validateEagerly) &#123;<br>      <span class="hljs-type">Reflection</span> <span class="hljs-variable">reflection</span> <span class="hljs-operator">=</span> Platform.reflection;<br>      <span class="hljs-keyword">for</span> (Method method : service.getDeclaredMethods()) &#123;<br>        <span class="hljs-keyword">if</span> (!reflection.isDefaultMethod(method)<br>            &amp;&amp; !Modifier.isStatic(method.getModifiers())<br>            &amp;&amp; !method.isSynthetic()) &#123;<br>          loadServiceMethod(service, method);<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></figure><p>å…ˆæ£€æŸ¥ Github ç±»æ˜¯ä¸æ˜¯ Interfaceï¼Œæ¥ç€å®šä¹‰ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ï¼Œå¯¹å½“å‰æ¥å£åŠå…¶çˆ¶æ¥å£è¿›è¡Œé€’å½’æ£€æŸ¥ï¼Œè¿™é‡Œæ˜¯ä¸æ”¯æŒæ³›å‹å‚æ•°çš„ã€‚<br>åœ¨æ¥ä¸‹æ¥åˆ¤æ–­ä¸€ä¸‹åœ¨åˆ›å»º Retrofit æ—¶ä¼ å…¥çš„validateEagerlyå‚æ•°ï¼Œå¦‚æœæ˜¯ trueï¼Œå¹¶ä¸”å£°æ˜çš„æ–¹æ³•ä¸æ˜¯é»˜è®¤ã€ä¸æ˜¯é™æ€ã€ä¸æ˜¯åˆæˆæ–¹æ³•ï¼Œåˆ™è°ƒç”¨loadServiceMethodæ–¹æ³•è§£ææ¥å£ä¸­å£°æ˜çš„æ–¹æ³•ã€‚</p><h3 id="loadServiceMethod"><a href="#loadServiceMethod" class="headerlink" title="loadServiceMethod"></a>loadServiceMethod</h3><p>é¦–å…ˆè°ƒç”¨<code>ServiceMethod.parseAnnotations(this, service, method);</code>ï¼Œå…ˆä»ç¼“å­˜çš„mapä¸­è·å–æœ‰æ²¡æœ‰å·²ç»è§£æå¥½çš„ServiceMethodã€‚å¦‚æœæ²¡æœ‰åˆ™è°ƒç”¨ServiceMethod.parseAnnotations(this, method)æ–¹æ³•è¿›è¡Œè§£æã€‚</p><h4 id="ç¬¬ä¸€æ­¥åˆ›å»ºrequestFactoryå¯¹è±¡"><a href="#ç¬¬ä¸€æ­¥åˆ›å»ºrequestFactoryå¯¹è±¡" class="headerlink" title="ç¬¬ä¸€æ­¥åˆ›å»ºrequestFactoryå¯¹è±¡"></a>ç¬¬ä¸€æ­¥åˆ›å»ºrequestFactoryå¯¹è±¡</h4><p>è°ƒç”¨äº† <code>RequestFactory requestFactory = RequestFactory.parseAnnotations(retrofit, service, method); </code>ï¼Œè§£æäº†ä¾‹å¦‚è¯·æ±‚æ–¹å¼ï¼ˆå³ POST è¿˜æ˜¯ GET ç­‰è¯·æ±‚ï¼‰ï¼Œè¯·æ±‚å¤´ï¼ŒcontentType ç­‰ç­‰å‚æ•°å¹¶è¿”å›äº†ä¸€ä¸ª<code>RequestFactory</code>å¯¹è±¡</p><h4 id="ç¬¬äºŒæ­¥åˆ›å»ºHttpServiceMethodå­ç±»CallAdapted"><a href="#ç¬¬äºŒæ­¥åˆ›å»ºHttpServiceMethodå­ç±»CallAdapted" class="headerlink" title="ç¬¬äºŒæ­¥åˆ›å»ºHttpServiceMethodå­ç±»CallAdapted"></a>ç¬¬äºŒæ­¥åˆ›å»ºHttpServiceMethodå­ç±»CallAdapted</h4><p>æ¥ç€é€šè¿‡<code>HttpServiceMethod</code>çš„é™æ€æ–¹æ³•<code>parseAnnotations</code>è¿›ä¸€æ­¥è§£æï¼Œå…¥å‚æœ‰<code>Retrofit</code>å¯¹è±¡ï¼Œ<code>Method</code>å¯¹è±¡å’Œåˆšæ‰åˆ›å»ºçš„<code>RequestFactory </code>å¯¹è±¡ã€‚<code>HttpServiceMethod</code>ç»§æ‰¿è‡ª<code>ServiceMethod</code>ï¼Œä½†ä¹Ÿæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œè¿™ä¸ªç±»æä¾›çš„<code>parseAnnotations</code>æ–¹æ³•çš„ä¸»è¦å†…å®¹æ˜¯è¿›ä¸€æ­¥è§£æï¼Œå¹¶é€šè¿‡<code>createCallAdapter</code>åˆ›å»ºé€‚é…å™¨ã€é€šè¿‡<code>createResponseConverter</code>åˆ›å»ºè½¬æ¢å™¨ï¼Œæœ€ååˆ©ç”¨<code>RequestFactory</code>å¯¹è±¡ï¼Œ<code>OkHttp</code>å¯¹è±¡ï¼Œ<code>è½¬æ¢å™¨</code>å¯¹è±¡ï¼Œ<code>é€‚é…å™¨</code>å¯¹è±¡åˆ›å»ºäº†ä¸€ä¸ª<code>CallAdapted</code>ç±»å‹çš„å¯¹è±¡å¹¶è¿”å›ã€‚</p><h5 id="åˆ›å»ºé€‚é…å™¨"><a href="#åˆ›å»ºé€‚é…å™¨" class="headerlink" title="åˆ›å»ºé€‚é…å™¨"></a>åˆ›å»ºé€‚é…å™¨</h5><p>å¦‚æœæˆ‘ä»¬å‰é¢æ²¡æœ‰è°ƒç”¨<code>addCallAdapterFactory(CallAdapter.Factory factory)</code>æ·»åŠ è‡ªå®šä¹‰çš„Factoryçš„è¯ï¼Œè¿™é‡Œè¿”å›çš„æ˜¯é»˜è®¤çš„<code>DefaultCallAdapterFactory</code>å¯¹è±¡ã€‚<br>åœ¨è¯¥ç±»çš„<code>adapt</code>æ–¹æ³•ä¸­è¿”å›çš„<code>CallAdapter</code>å¯¹è±¡ä¸­ï¼Œå…ˆåˆ¤æ–­äº†<code>executor</code>æ˜¯ä¸æ˜¯ç©ºï¼Œè¿™é‡Œçš„<code>executor</code>å°±æ˜¯åœ¨åˆ›å»º<code>Retrofit</code>æ—¶è°ƒç”¨<code>public Builder callbackExecutor(Executor executor)</code>æ–¹æ³•æ—¶ä¼ å…¥çš„å¯¹è±¡ï¼Œå‰é¢ä¹Ÿè¯´è¿‡ï¼Œåœ¨**Android(Dalvik)**å¹³å°ä¸Šé»˜è®¤æ˜¯<code>AndroidMainExecutor</code>,å…¶ä»–å¹³å°é»˜è®¤ä¸ºç©ºã€‚</p><p>ç®€å•è®²ï¼Œ<code>DefaultCallAdapterFactory</code>å¤§è‡´å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultCallAdapterFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CallAdapter</span>.Factory &#123;<br>    <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-meta">@Nullable</span> CallAdapter&lt;?, ?&gt; get(Type returnType, Annotation[] annotations, Retrofit retrofit) &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">Executor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span><br>        Utils.isAnnotationPresent(annotations, SkipCallbackExecutor.class)<br>            ? <span class="hljs-literal">null</span><br>            : callbackExecutor;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CallAdapter</span>&lt;Object, Call&lt;?&gt;&gt;() &#123;<br>      <span class="hljs-meta">@Override</span><br>      <span class="hljs-keyword">public</span> Type <span class="hljs-title function_">responseType</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> responseType;<br>      &#125;<br><br>      <span class="hljs-meta">@Override</span><br>      <span class="hljs-keyword">public</span> Call&lt;Object&gt; <span class="hljs-title function_">adapt</span><span class="hljs-params">(Call&lt;Object&gt; call)</span> &#123;<br>        <span class="hljs-type">return</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span>= <span class="hljs-literal">null</span> ? call : <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutorCallbackCall</span>&lt;&gt;(executor, call);<br>      &#125;<br>    &#125;;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExecutorCallbackCall</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Call</span>&lt;T&gt; &#123;<br>   ExecutorCallbackCall(Executor callbackExecutor, Call&lt;T&gt; delegate) &#123;<br>      <span class="hljs-built_in">this</span>.callbackExecutor = callbackExecutor;<br>      <span class="hljs-built_in">this</span>.delegate = delegate;<br>    &#125;<br>    <span class="hljs-comment">//ã€‚ã€‚ã€‚ã€‚ä¸€ç³»åˆ—çš„æ–¹æ³•ï¼Œé™¤äº†enqueue(final Callback&lt;T&gt; callback)æ–¹æ³•å¤–ï¼Œéƒ½æ˜¯è°ƒç”¨delegateä¸­å¯¹åº”çš„æ–¹æ³•</span><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="åˆ›å»ºè½¬æ¢å™¨"><a href="#åˆ›å»ºè½¬æ¢å™¨" class="headerlink" title="åˆ›å»ºè½¬æ¢å™¨"></a>åˆ›å»ºè½¬æ¢å™¨</h5><p>æˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™ä¸€èˆ¬ä¼šä¼ å…¥ä¸€ä¸ªConverterFactoryå¯¹è±¡ï¼Œæ¯”å¦‚MoshiConverterFactoryã€GsonConverterFactoryç­‰ã€‚æœ€ä¸»è¦çš„å°±ä¸¤ä¸ªæ–¹æ³•<br><code>responseBodyConverter</code> and <code>requestBodyConverter</code>.åœ¨è°ƒç”¨<code>HttpServiceMethod.createResponseConverter</code>æ—¶ï¼Œå…œå…œè½¬è½¬æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨äº† <code>Retrofit.nextCallAdapter</code>æ–¹æ³•ï¼Œä»æˆ‘ä»¬ä¸€å¼€å§‹æ„å»ºçš„ Retrofit å¯¹è±¡ä¸­æŸ¥æ‰¾å¯¹åº”çš„è½¬æ¢å™¨</p><h5 id="åˆ›å»ºCallAdaptedå¯¹è±¡"><a href="#åˆ›å»ºCallAdaptedå¯¹è±¡" class="headerlink" title="åˆ›å»ºCallAdaptedå¯¹è±¡"></a>åˆ›å»ºCallAdaptedå¯¹è±¡</h5><p>è¿™é‡Œç›´æ¥è°ƒç”¨çš„æ„é€ æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CallAdapted</span>&lt;&gt;(requestFactory, callFactory, responseConverter, callAdapter);<br></code></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œä¼ å…¥çš„<code>callAdapter</code>å¯¹è±¡å°±æ˜¯å‰é¢æåˆ°çš„è°ƒç”¨<code>createCallAdapter</code>è¿”å›çš„é»˜è®¤<code>DefaultCallAdapterFactory</code>ç¤ºä¾‹ã€‚<br><code>CallAdapted</code>ç±»æ˜¯<code>HttpServiceMethod</code>çš„å­ç±»ï¼Œå®ç°äº†çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•<code>adapt</code>ã€‚è€Œ<code>HttpServiceMethod</code>åˆå®ç°äº†<code>ServiceMethod</code>çš„æŠ½è±¡æ–¹æ³•<code>invoke</code>ï¼Œåœ¨<code>invoke</code>æ–¹æ³•é‡Œè°ƒç”¨äº†<code>adapt</code>æ–¹æ³•ã€‚</p><h4 id="loadServiceMethodè¿‡ç¨‹æ€»ç»“"><a href="#loadServiceMethodè¿‡ç¨‹æ€»ç»“" class="headerlink" title="loadServiceMethodè¿‡ç¨‹æ€»ç»“"></a>loadServiceMethodè¿‡ç¨‹æ€»ç»“</h4><p>æ‰€ä»¥å‰é¢è¯´åˆ°çš„åŠ è½½è¿‡ç¨‹(loadServiceMethod)ï¼Œæœ€ç»ˆå°±æ˜¯è¿”å›äº†ä¸€ä¸ª<code>CallAdapted</code>ç±»å‹çš„å¯¹è±¡ï¼Œå¹¶å­˜åˆ°ç¼“å­˜ä¸­ã€‚æ¥ä¸‹å»å°±æ˜¯è°ƒç”¨äº†<code>CallAdapted</code>å¯¹è±¡çš„<code>invoke</code>æ–¹æ³•ï¼Œæ˜¾ç„¶æœ€ç»ˆè°ƒç”¨äº†<code>CallAdapted</code>è‡ªèº«çš„<code>adapt</code>æ–¹æ³•ã€‚<code>CallAdapted</code>æä¾›çš„<code>adapt</code>æ–¹æ³•é‡Œå°±ä¸€å¥ï¼Œé‚£å°±æ˜¯è°ƒç”¨é€‚é…å™¨çš„<code>adapt</code>æ–¹æ³•ï¼Œå¹¶è¿”å›ä¸€ä¸ªå€¼ã€‚è¿™ä¸ªå€¼å°±æ˜¯æˆ‘ä»¬å®šä¹‰çš„æ¥å£ç±»å‹çš„ä»£ç†å¯¹è±¡.ä¹‹åè°ƒç”¨è°ƒç”¨å®šä¹‰çš„æ¥å£æ–¹æ³•è·å–åˆ°Callå¯¹è±¡ï¼Œè°ƒç”¨enqueueå¼‚æ­¥æ‰§è¡Œï¼›è°ƒç”¨executeåŒæ­¥æ‰§è¡Œï¼›</p><h3 id="invokeè¿‡ç¨‹"><a href="#invokeè¿‡ç¨‹" class="headerlink" title="invokeè¿‡ç¨‹"></a>invokeè¿‡ç¨‹</h3><p>å‰é¢çŸ¥é“äº†<code>loadServiceMethod</code>è¿”å›çš„æ˜¯ä¸€ä¸ª<code>CallAdapted</code>å¯¹è±¡ï¼Œç„¶åç´§æ¥ç€è°ƒç”¨äº†<code>invoke</code>æ–¹æ³•ã€‚ä½†<code>CallAdapted</code>å¹¶æ²¡æœ‰é‡å†™è¯¥æ–¹æ³•ï¼Œæ‰€ä»¥å®é™…ä¸Šè¿˜æ˜¯è°ƒç”¨çš„<code>HttpServiceMethod</code>ç±»ä¸­çš„<code>invoke</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">final</span> <span class="hljs-meta">@Nullable</span> ReturnT <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object instance, Object[] args)</span> &#123;<br>  Call&lt;ResponseT&gt; call =<br>      <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpCall</span>&lt;&gt;(requestFactory, instance, args, callFactory, responseConverter);<br>  <span class="hljs-keyword">return</span> adapt(call, args);<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/image/Android/retrofit/NewOkHttpCall.png"><br><img src="/image/Android/retrofit/NewOkhttpCallArgs.png"></p><p>æ¥ç€è°ƒç”¨äº†<code>adapt(call, args)</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±éœ€è¦å­ç±»å®ç°äº†ï¼Œè¿™é‡Œçš„å­ç±»æ˜¯<code>CallAdapted</code>,åœ¨<code>CallAdapted</code>ä¸­æ¥ç€è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> ReturnT <span class="hljs-title function_">adapt</span><span class="hljs-params">(Call&lt;ResponseT&gt; call, Object[] args)</span> &#123;<br>  <span class="hljs-keyword">return</span> callAdapter.adapt(call);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯¥æ–¹æ³•ä¸­çš„<code>callAdapter</code>å¯¹è±¡å°±æ˜¯å‰é¢æåˆ°çš„<code>DefaultCallAdapterFactory.get</code>æ–¹æ³•ä¸­è¿”å›çš„<code>CallAdapter</code>,è°ƒç”¨äº†è¯¥å¯¹åº”çš„<code>adapt</code>æ–¹æ³•ã€‚åœ¨ä¸Šé¢çš„ä»‹ç»çš„<strong>åˆ›å»ºé€‚é…å™¨</strong>å°ç»“ä¸­æåˆ°ï¼Œåœ¨**Android(Dalvik)**å¹³å°ä¸Šé»˜è®¤æœ‰<code>AndroidMainExecutor</code>,å…¶ä»–å¹³å°é»˜è®¤ä¸ºç©ºã€‚æ‰€ä»¥åœ¨æ²¡æœ‰é¢å¤–æ·»åŠ <code>callbackExecutor</code>çš„æƒ…å†µä¸‹ï¼ŒAndroid å¹³å°ä¸Šè¿”å›çš„æ˜¯<code>ExecutorCallbackCall</code>,åœ¨å…¶ä»–å¹³å°ä¸Šé»˜è®¤è¿”å›çš„å°±æ˜¯å‚æ•°ä¸­çš„<code>call</code>å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯<code>retrofit2.OkHttpCall</code>ã€‚ è¿™ä¸ªå¯¹è±¡ä¹Ÿå°±æ˜¯æˆ‘ä»¬è°ƒç”¨æ¥å£ä¸­çš„æ–¹æ³•è¿”å›çš„å¯¹è±¡ã€‚</p><h4 id="å‘é€è¯·æ±‚"><a href="#å‘é€è¯·æ±‚" class="headerlink" title="å‘é€è¯·æ±‚"></a>å‘é€è¯·æ±‚</h4><p>ä¸Šé¢æåˆ°åœ¨ Android å¹³å°ä¸Šä¼šè¿”å›<code>ExecutorCallbackCall</code>å¯¹è±¡ï¼Œå…¶ä»–å¹³å°è¿”å›<code>retrofit2.OkHttpCall</code>å¯¹è±¡ã€‚ä½†åœ¨åˆ›å»º<code>ExecutorCallbackCall</code><br>å¯¹è±¡çš„æ—¶å€™ä¹Ÿä¼šå°†<code>retrofit2.OkHttpCall</code>ä¼ è¿›å»ï¼Œåœ¨è°ƒç”¨å„ç§æ–¹æ³•çš„æ—¶å€™è¿˜æ˜¯è°ƒç”¨çš„<code>retrofit2.OkHttpCall</code>å¯¹è±¡çš„æ–¹æ³•ï¼Œåªä¸è¿‡åœ¨è°ƒç”¨<code>void enqueue(Callback&lt;T&gt; callback);</code>æ–¹æ³•çš„<code>callback</code>å›è°ƒä¸­ä½¿ç”¨<code>callbackExecutor</code>å°†å›è°ƒåˆ‡æ¢å›ä¸»çº¿ç¨‹è€Œå·²ã€‚</p><p>åœ¨è°ƒç”¨<code>retrofit2.OkHttpCall</code>çš„<code>enqueue</code>æˆ–è€…<code>execute</code>æ–¹æ³•æ—¶ï¼Œä¼šè°ƒç”¨<code>createRawCall</code>æ–¹æ³•åˆ›å»ºä¸€ä¸ª<code>okhttp3.Call</code>å¯¹è±¡ï¼Œå®é™…ä¸Šçš„ç½‘ç»œè¯·æ±‚è¿˜æ˜¯ okhttp å‘å‡ºçš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">private</span> okhttp3.Call <span class="hljs-title function_">createRawCall</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>  okhttp3.<span class="hljs-type">Call</span> <span class="hljs-variable">call</span> <span class="hljs-operator">=</span> callFactory.newCall(requestFactory.create(instance, args));<br>  <span class="hljs-keyword">if</span> (call == <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>(<span class="hljs-string">&quot;Call.Factory returned null.&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> call;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>requestFactory</code>æ˜¯ä¸Šé¢æåˆ°çš„<code>parseAnnotations</code>æ—¶åˆ›å»ºçš„<code>RequestFactory</code>å¯¹è±¡ï¼ŒåŒ…å«äº†éƒ¨åˆ†è¯·æ±‚ä¿¡æ¯ã€‚è¿™é‡Œåˆç”¨å®ƒåˆ›å»ºäº†<code>okhttp3.Request</code>å¯¹è±¡ã€‚åˆ›å»ºå¥½ä¹‹åæ¥ç€å°±åˆ›å»ºäº†<code>okhttp3.Call</code>å¯¹è±¡ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è°ƒç”¨<code>enqueue</code>æˆ–è€…<code>execute</code>æ–¹æ³•å‘é€è¯·æ±‚ã€‚<br>å½“è¯·æ±‚æ•°æ®è¿”å›æ—¶ï¼Œä¼šè°ƒç”¨<code>parseResponse(okhttp3.Response rawResponse)</code>æ–¹æ³•ï¼Œæœ€ç»ˆè°ƒç”¨çš„æ˜¯<code>responseConverter.convert(catchingBody)</code>æ–¹æ³•ï¼Œè¿™é‡Œçš„<code>responseConverter</code>å°±æ˜¯æˆ‘ä»¬åœ¨åˆ›å»º<code>Retrofit</code>å¯¹è±¡è°ƒç”¨<code>addConverterFactory</code>æ—¶ä¼ å…¥çš„è§£ææ–¹æ³•.<br>è‡³æ­¤ï¼Œå®Œæˆäº†ä¸€æ¬¡ç½‘ç»œè¯·æ±‚ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ä»‹ç»äº†ã€Šåœ¨kotlinåç¨‹ä¸­ä½¿ç”¨è‡ªå®šä¹‰CallAdapterå¤„ç†é”™è¯¯ã€‹ï¼Œæ—¢ç„¶é€‰æ‹©äº†å®ƒï¼Œå½“ç„¶å¾—å…ˆå…¨é¢äº†è§£ä¸€ä¸‹ã€‚&lt;br&gt;å…ˆä¸‹è½½ä¸€ä¸‹æºç ï¼Œæ­å»ºä¸€ä¸‹ç¯å¢ƒï¼Œä¹Ÿæ²¡å•¥å¥½è¯´çš„ï¼Œæˆ‘ä¸‹è½½çš„æ˜¯2.11.0 ç‰ˆæœ¬çš„ä»£ç ï¼Œä½¿ç”¨çš„ IDEA2023.3.6ã€‚è¿™éƒ½æ˜¯å°äº‹æƒ…ï¼Œåªè¦èƒ½æœ‰ä»£ç è·³è½¬åŠŸèƒ½å°±å¥½ã€‚é¦–æ¬¡é…ç½®éœ€è¦ä¸‹è½½ç›¸åº”ä¾èµ–ï¼Œæ—¶é—´ä¼šé•¿ä¸€äº›ï¼Œè¿™ä¸é‡è¦ã€‚ç­‰é…ç½®å®Œæˆåï¼Œæ‰¾åˆ° simple moduleï¼Œæœ‰å„ç§å„æ ·çš„ç¤ºä¾‹ä»£ç ã€‚æ˜¯å¯ä»¥ç›´æ¥è¿è¡Œçš„ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Android" scheme="https://blog.huangyuanlove.com/tags/Android/"/>
    
    <category term="Retrofit" scheme="https://blog.huangyuanlove.com/tags/Retrofit/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨kotlinåç¨‹ä¸­ä½¿ç”¨è‡ªå®šä¹‰CallAdapterå¤„ç†é”™è¯¯</title>
    <link href="https://blog.huangyuanlove.com/2024/03/29/kotlin%E4%B8%ADRetrofit2-x%E8%87%AA%E5%AE%9A%E4%B9%89CallAdapter%E5%81%9A%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/"/>
    <id>https://blog.huangyuanlove.com/2024/03/29/kotlin%E4%B8%ADRetrofit2-x%E8%87%AA%E5%AE%9A%E4%B9%89CallAdapter%E5%81%9A%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/</id>
    <published>2024-03-29T10:14:05.000Z</published>
    <updated>2024-04-07T07:36:41.916Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Retrofitåœ¨2019-06-05å‘å¸ƒçš„2.6.0ç‰ˆæœ¬ä¸­å°±å·²ç»æ”¯æŒKotlin ä¸­çš„ suspendä¿®é¥°ç¬¦äº†ï¼Œç›®å‰æ­£å‡†å¤‡åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ Kotlinï¼Œé¡ºä¾¿æ›¿æ¢ä¸€ä¸‹ç½‘ç»œåº“ã€‚è¿™é‡Œå…ˆåšä¸€ä¸‹è°ƒç ”å’ŒåŸºç¡€å»ºè®¾ï¼Œæ–¹ä¾¿åç»­çš„æ¥å…¥å·¥ä½œã€‚<br>é—®å°±æ˜¯15 å¹´ 16 å¹´çš„è€é¡¹ç›®ï¼Œä¹‹å‰å¹¶æ²¡æœ‰ä½¿ç”¨ Kotlin çš„æ‰“ç®—ã€‚</p><p>Retrofitå·²ç»åœ¨2024-03-28æ›´æ–°åˆ°2.11.0ç‰ˆæœ¬äº†ï¼Œå°±ç”¨è¿™ä¸ªæ¥åšè°ƒç ”å¥½äº†ã€‚</p><h3 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs groovy">implementation <span class="hljs-string">&#x27;com.squareup.retrofit2:retrofit:2.11.0&#x27;</span><br>implementation <span class="hljs-string">&#x27;com.squareup.retrofit2:converter-gson:2.11.0&#x27;</span><br>implementation <span class="hljs-string">&#x27;com.squareup.okhttp3:okhttp:4.12.0&#x27;</span><br></code></pre></td></tr></table></figure><p>ç”±äºéœ€è¦å¯¹ OKHttpClient åšä¸€äº›æ“ä½œå’Œå®šåˆ¶ï¼Œè¿™é‡Œæ·»åŠ äº† okhttp çš„ä¾èµ–ã€‚å®ä½“ç±»çš„è½¬æ¢ä½¿ç”¨äº† gsonï¼Œä¸ºå•¥ç”¨ gsonï¼Œé—®å°±æ˜¯é¡¹ç›®é‡Œé¢å°±æ˜¯ç”¨çš„ gsonï¼Œåé¢å†ä»‹ç»ä¸€ä¸‹å…¶ä»–çš„converterã€‚</p><ul><li>Gson: com.squareup.retrofit2:converter-gson</li><li>Jackson: com.squareup.retrofit2:converter-jackson</li><li>Moshi: com.squareup.retrofit2:converter-moshi</li><li>Protobuf: com.squareup.retrofit2:converter-protobuf</li><li>Wire: com.squareup.retrofit2:converter-wire</li><li>Simple XML: com.squareup.retrofit2:converter-simplexml</li><li>JAXB: com.squareup.retrofit2:converter-jaxb</li><li>Scalars (primitives, boxed, and String): com.squareup.retrofit2:converter-scalars</li></ul><h3 id="å£°æ˜è¯·æ±‚æ¥å£"><a href="#å£°æ˜è¯·æ±‚æ¥å£" class="headerlink" title="å£°æ˜è¯·æ±‚æ¥å£"></a>å£°æ˜è¯·æ±‚æ¥å£</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MainPageApi</span></span>&#123;<br>  <span class="hljs-meta">@GET(<span class="hljs-string">&quot;app_interface/home_pag/&quot;</span>)</span><br>  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getMainPageInfoWithRow</span><span class="hljs-params">()</span></span>:Call&lt;MainPageInfo&gt;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åˆ›å»º-Retrofit-å¯¹è±¡"><a href="#åˆ›å»º-Retrofit-å¯¹è±¡" class="headerlink" title="åˆ›å»º Retrofit å¯¹è±¡"></a>åˆ›å»º Retrofit å¯¹è±¡</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-keyword">val</span> retrofit = Retrofit.Builder()<br>    .baseUrl(BASE_URL)<br>    .addConverterFactory(GsonConverterFactory.create())<br>    .build()<br></code></pre></td></tr></table></figure><h3 id="å‘é€è¯·æ±‚"><a href="#å‘é€è¯·æ±‚" class="headerlink" title="å‘é€è¯·æ±‚"></a>å‘é€è¯·æ±‚</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-keyword">val</span> mainPageApi = retrofit.create(MainPageApi::<span class="hljs-keyword">class</span>.java)<br>mainPageApi.getMainPageInfoWithCall().enqueue(<span class="hljs-keyword">object</span>:retrofit2.Callback&lt;MainPageInfo&gt;&#123;<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onResponse</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        call: <span class="hljs-type">Call</span>&lt;<span class="hljs-type">MainPageInfo</span>&gt;,</span></span><br><span class="hljs-params"><span class="hljs-function">        response: <span class="hljs-type">retrofit2</span>.<span class="hljs-type">Response</span>&lt;<span class="hljs-type">MainPageInfo</span>&gt;</span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span> &#123;<br>        Log.e(<span class="hljs-string">&quot;KotlinActivity&quot;</span>,<span class="hljs-string">&quot;getMainPageInfoWithCall onResponse&quot;</span>)<br>    &#125;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onFailure</span><span class="hljs-params">(call: <span class="hljs-type">Call</span>&lt;<span class="hljs-type">MainPageInfo</span>&gt;, t: <span class="hljs-type">Throwable</span>)</span></span> &#123;<br>        Log.e(<span class="hljs-string">&quot;KotlinActivity&quot;</span>,<span class="hljs-string">&quot;getMainPageInfoWithCall onFailure&quot;</span>)<br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰ä½¿ç”¨ä»»ä½•åç¨‹ç›¸å…³çš„ç‰¹æ€§ï¼Œå¹¶ä¸”æ²¡æœ‰éƒ½å¾—å†™å›è°ƒï¼Œå’Œ Java å†™èµ·æ¥ä¹Ÿæ²¡å•¥å·®åˆ«ã€‚</p><h3 id="æ”¯æŒåç¨‹"><a href="#æ”¯æŒåç¨‹" class="headerlink" title="æ”¯æŒåç¨‹"></a>æ”¯æŒåç¨‹</h3><p>æˆ‘ä»¬å¯¹æ¥å£çš„å£°æ˜åŠ ä¸Š<code>suspend</code>ä¿®é¥°</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-meta">@GET(<span class="hljs-string">&quot;app_interface/home_pag/&quot;</span>)</span><br><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getMainPageInfoWithRow</span><span class="hljs-params">()</span></span>:Call&lt;MainPageInfo&gt;<br></code></pre></td></tr></table></figure><p>è¿™æ—¶å€™ä¸Šé¢ç›´æ¥å‘é€è¯·æ±‚çš„ä»£ç ä¼šæŠ¥é”™ï¼š<br><img src="/image/Android/kotlin/suspend_retrofit_error.png" alt="suspend_retrofit_error"><br>æç¤ºæˆ‘ä»¬éœ€è¦åœ¨åç¨‹ä¸­è°ƒç”¨ï¼Œè¿™ä¹Ÿç®€å•ï¼Œkotlin å¯¹ activity æœ‰ä¸ªæ‰©å±•çš„<code>lifecycleScope</code>æˆå‘˜å˜é‡ï¼Œç¨å¾®ä¿®æ”¹ä¸€ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin">lifecycleScope.launch(Dispatchers.IO) &#123;<br>  mainPageApi.getMainPageInfoWithCall().enqueue(.....)<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ä¹ æƒ¯è¿™ä¹ˆå†™çš„è¯ï¼Œå¯ä»¥å°†ç½‘ç»œè¯·æ±‚å†™åœ¨ ViewModel ä¸­ï¼Œé€šè¿‡ LiveDataåˆ›å»ºä¸€ä¸ªå¯è§‚å¯Ÿå¯¹è±¡å®ç°æ•°æ®ç»‘å®šã€‚</p><p>ä¸å‡ºæ„å¤–çš„å‡ºæ„å¤–äº†ï¼Œåº”ç”¨å´©æºƒï¼Œé”™è¯¯ä¿¡æ¯</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml">java.lang.IllegalArgumentException: Suspend functions should not return Call, as they already execute asynchronously.<br>Change its return type to class com.huangyuanlove.androidtest.kotlin.retrofit.MainPageInfo<br></code></pre></td></tr></table></figure><p>æ„æ€æ˜¯åœ¨åç¨‹ä¸­å‘èµ·è¯·æ±‚å·²ç»æ˜¯å¼‚æ­¥çš„äº†ï¼Œä¸éœ€è¦å†è¿”å› Call å¯¹è±¡äº†ï¼Œç›´æ¥è¿”å›å¯¹åº”çš„å®ä½“å³å¯ã€‚<br>ç®€å•ï¼Œä¿®æ”¹ä¸€ä¸‹æ¥å£å£°æ˜</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-meta">@GET(<span class="hljs-string">&quot;app_interface/home_page/&quot;</span>)</span><br><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getMainPageInfoWithRow</span><span class="hljs-params">()</span></span>:MainPageInfo<br></code></pre></td></tr></table></figure><p>ç„¶åä¿®æ”¹ä¸€ä¸‹è¯·æ±‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin">lifecycleScope.launch(Dispatchers.IO) &#123;<br>  <span class="hljs-keyword">val</span> mainPageInfo = mainPageApi.getMainPageInfo()<br>  withContext(Dispatchers.Main) &#123;<br>    refreshUI(mainPageInfo)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œä¸€ä¸‹ï¼Œä¸€åˆ‡æ­£å¸¸ã€‚æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹æ¥å£ï¼Œè¯·æ±‚ä¸€ä¸ªä¸å­˜åœ¨çš„åœ°å€ï¼Œä¼šè¿”å›404ï¼Œä¸å‡ºæ„å¤–ï¼Œåº”ç”¨è¿˜æ˜¯å´©æºƒ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml">retrofit2.HttpException: HTTP 404 <br>at retrofit2.KotlinExtensions$await$2$2.onResponse(KotlinExtensions.kt:53)<br>at retrofit2.OkHttpCall$1.onResponse(OkHttpCall.java:164)<br>at okhttp3.internal.connection.RealCall$AsyncCall.run(RealCall.kt:519)<br>at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)<br>at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641)<br>at java.lang.Thread.run(Thread.java:929)<br>Suppressed: kotlinx.coroutines.internal.DiagnosticCoroutineContextException: [StandaloneCoroutine&#123;Cancelling&#125;@ffa6ad2, Dispatchers.IO]<br></code></pre></td></tr></table></figure><p>å“¦~å¼‚å¸¸æ²¡æœ‰å¤„ç†ï¼Œç²—æš´ç‚¹ï¼Œç›´æ¥ try-catchï¼Œkotlin ä¸­è¿˜æœ‰<code>runCatching</code>è¿™ä¸ªè¯­æ³•ç³–</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-keyword">val</span> mainPageInfoRow = runCatching &#123; mainPageApi.getMainPageInfoWithRow() &#125;<br><span class="hljs-keyword">if</span> (mainPageInfoRow.isFailure) &#123;<br>    ToastUtils.showToast(<span class="hljs-string">&quot;è¯·æ±‚å¤±è´¥&quot;</span>)<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (mainPageInfoRow.isSuccess) &#123;<br>    ToastUtils.showToast(<span class="hljs-string">&quot;è¯·æ±‚æˆåŠŸ&quot;</span>)<br>    withContext(Dispatchers.Main) &#123;<br>        <span class="hljs-keyword">if</span> (mainPageInfoRow.getOrNull() == <span class="hljs-literal">null</span>) &#123;<br>            ToastUtils.showToast(<span class="hljs-string">&quot;è¯·æ±‚ç»“æœä¸ºç©º&quot;</span>)<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            refreshViewWithLaunch(mainPageInfoRow.getOrNull()!!)<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬ä¼šç”¨<code>HTTPçŠ¶æ€ç </code>æ¥è¡¨ç¤ºä¸€äº›ä¸šåŠ¡ä¸Šé€»è¾‘é”™è¯¯ï¼Œå¹¶ä¸”ä¸åŒçš„çŠ¶æ€ç è¿”å›çš„ JSON ç»“æ„è¿˜å¯èƒ½ä¸ä¸€æ ·ã€‚ åˆ«é—®ä¸ºå•¥è¦è¿™ä¹ˆæï¼Œåº”è¯¥æ˜¯HTTP çŠ¶æ€ç å°±åº”è¯¥è¡¨ç¤ºç½‘ç»œè¯·æ±‚çš„çŠ¶æ€ï¼Œä¸šåŠ¡çŠ¶æ€åº”è¯¥æ”¾åœ¨è¿”å›çš„æ•°æ®ä¸­çº¦å®šå­—æ®µæ¥å¤„ç†ã€‚é—®å°±æ˜¯15å¹´çš„è€ä»£ç ï¼Œä¹‹å‰å°±æ˜¯è¿™ä¹ˆæçš„ï¼Œå¹¶ä¸”å¤§èŒƒå›´åº”ç”¨ï¼Œæ¶‰åŠåˆ°çš„éƒ¨é—¨ã€ä¸šåŠ¡å åŠæ•°ä»¥ä¸Šã€‚<br>è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰<code>CallAdapter</code>äº†</p><h3 id="è‡ªå®šä¹‰-CallAdapter"><a href="#è‡ªå®šä¹‰-CallAdapter" class="headerlink" title="è‡ªå®šä¹‰ CallAdapter"></a>è‡ªå®šä¹‰ CallAdapter</h3><p>è¿™æ—¶å€™å°±åº”è¯¥ç¿»ä¸€ä¸‹æºç äº†ï¼Œåœ¨<code>example</code>æœ‰ä¸ª<code>ErrorHandlingAdapter.java</code>,è·¯å¾„åœ¨<a href="https://github.com/square/retrofit/blob/trunk/samples/src/main/java/com/example/retrofit/ErrorHandlingAdapter.java">samples&#x2F;src&#x2F;main&#x2F;java&#x2F;com&#x2F;example&#x2F;retrofit&#x2F;ErrorHandlingAdapter.java</a>ã€‚<br>æˆ‘ä»¬æ¥ä»¿å†™ä¸€ä¸‹ï¼Œæœ€å…³é”®çš„ç‚¹åœ¨å®ç°è‡ªå·±çš„ Call ç±»çš„æ—¶å€™ï¼Œå¯¹callback çš„å¤„ç†ã€‚</p><h4 id="å®šä¹‰ä¸åŒçš„è¿”å›çŠ¶æ€"><a href="#å®šä¹‰ä¸åŒçš„è¿”å›çŠ¶æ€" class="headerlink" title="å®šä¹‰ä¸åŒçš„è¿”å›çŠ¶æ€"></a>å®šä¹‰ä¸åŒçš„è¿”å›çŠ¶æ€</h4><p>ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºå¯†é—­ç±»ï¼Œæ¥è¡¨ç¤ºä¸åŒçš„çŠ¶æ€ï¼Œè¿™é‡Œæš‚ä¸”å®šä¹‰äº†ä¸‰ç§æƒ…å†µ</p><ul><li>Success:HTTPçŠ¶æ€ç åœ¨<code>[200,300)</code>è¿™ä¸ªåŒºé—´</li><li>NetError:HTTPçŠ¶æ€ç ä¸åœ¨<code>[200,300)</code>è¿™ä¸ªåŒºé—´</li><li>UnknownError:å…¶ä»–é”™è¯¯</li></ul><p>sealed class NetworkResponse&lt;out T : Any, out U : Any&gt; {<br>    data class Success<T : Any>(val body: T) : NetworkResponse&lt;T, Nothing&gt;()<br>    data class NetError(val httpCode:Int?,val errorMsg:String?,val exception: Throwable?) : NetworkResponse&lt;Nothing, Nothing&gt;()<br>    data class UnknownError(val error: Throwable?) : NetworkResponse&lt;Nothing, Nothing&gt;()<br>}</p><h4 id="åˆ›å»ºè‡ªå·±çš„Callç±»"><a href="#åˆ›å»ºè‡ªå·±çš„Callç±»" class="headerlink" title="åˆ›å»ºè‡ªå·±çš„Callç±»"></a>åˆ›å»ºè‡ªå·±çš„Callç±»</h4><p>è¿™é‡Œä¸ºäº†ç®€åŒ–æ–¹ä¾¿ï¼Œé™¤äº†<code>enqueue</code>ä¹‹å¤–å¿…é¡»é‡å†™çš„æ–¹æ³•ï¼Œéƒ½æ˜¯ç›´æ¥è°ƒç”¨<code>delegate</code>å¯¹åº”çš„æ–¹æ³•</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-keyword">internal</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NetworkResponseCall</span>&lt;<span class="hljs-type">S : Any, E : Any</span>&gt;</span>(<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> delegate: Call&lt;S&gt;,<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> errorConverter: Converter&lt;ResponseBody, E&gt;<br>) : Call&lt;NetworkResponse&lt;S, E&gt;&gt; &#123;<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">clone</span><span class="hljs-params">()</span></span>: Call&lt;NetworkResponse&lt;S, E&gt;&gt; &#123;<br>        <span class="hljs-keyword">return</span> NetworkResponseCall(delegate.clone(), errorConverter);<br>    &#125;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span></span>: Response&lt;NetworkResponse&lt;S, E&gt;&gt; &#123;<br>        <span class="hljs-keyword">throw</span> UnsupportedOperationException(<span class="hljs-string">&quot;NetworkResponseCall doesn&#x27;t support execute&quot;</span>)<br>    &#125;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isExecuted</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> &#123;<br>        <span class="hljs-keyword">return</span> delegate.isExecuted;<br>    &#125;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">cancel</span><span class="hljs-params">()</span></span> &#123;<br>        delegate.cancel()<br>    &#125;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isCanceled</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> &#123;<br>        <span class="hljs-keyword">return</span> delegate.isCanceled<br>    &#125;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">request</span><span class="hljs-params">()</span></span>: Request &#123;<br>        <span class="hljs-keyword">return</span> delegate.request()<br>    &#125;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">timeout</span><span class="hljs-params">()</span></span>: Timeout &#123;<br>        <span class="hljs-keyword">return</span> delegate.timeout();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯å…³é”®çš„<code>enqueue</code>æ–¹æ³•,åœ¨è¿™é‡Œé¢ï¼Œå°†æ‰€æœ‰çš„è¯·æ±‚éƒ½ç”¨<code>Response.success</code>è¿”å›ï¼Œä¸å†èµ°<code>Response.error</code>.å¹¶ä¸”æ ¹æ®ä¸åŒçš„ HTTP çŠ¶æ€ç ï¼Œè¿”å›çš„æ•°æ®ç­‰æ¡ä»¶è½¬æˆä¸€å¼€å§‹å®šä¹‰çš„å¯†é—­ç±»ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><br><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">enqueue</span><span class="hljs-params">(callback: <span class="hljs-type">Callback</span>&lt;<span class="hljs-type">NetworkResponse</span>&lt;<span class="hljs-type">S</span>, E&gt;&gt;)</span></span> &#123;<br>    <span class="hljs-keyword">return</span> delegate.enqueue(<span class="hljs-keyword">object</span> : Callback&lt;S&gt; &#123;<br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onResponse</span><span class="hljs-params">(call: <span class="hljs-type">Call</span>&lt;<span class="hljs-type">S</span>&gt;, response: <span class="hljs-type">Response</span>&lt;<span class="hljs-type">S</span>&gt;)</span></span> &#123;<br>            <span class="hljs-keyword">val</span> body = response.body()<br>            <span class="hljs-keyword">val</span> code = response.code()<br>            <span class="hljs-keyword">val</span> error = response.errorBody()<br><br>            <span class="hljs-keyword">if</span> (response.isSuccessful) &#123;<br>                <span class="hljs-keyword">if</span> (body != <span class="hljs-literal">null</span>) &#123;<br>                    callback.onResponse(<br>                        <span class="hljs-keyword">this</span><span class="hljs-symbol">@NetworkResponseCall</span>,<br>                        Response.success(NetworkResponse.Success(body))<br>                    )<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <br>                    callback.onResponse(<br>                        <span class="hljs-keyword">this</span><span class="hljs-symbol">@NetworkResponseCall</span>,<br>                        Response.success(NetworkResponse.UnknownError(<span class="hljs-literal">null</span>))<br>                    )<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">val</span> errorBody = <span class="hljs-keyword">when</span> &#123;<br>                    error == <span class="hljs-literal">null</span> -&gt; <span class="hljs-literal">null</span><br>                    error.contentLength() == <span class="hljs-number">0L</span> -&gt; <span class="hljs-literal">null</span><br>                    <span class="hljs-keyword">else</span> -&gt; NetworkResponse.NetError(code, error.toString(), <span class="hljs-literal">null</span>)<br>                &#125;<br>                <span class="hljs-keyword">if</span> (errorBody != <span class="hljs-literal">null</span>) &#123;<br>                    callback.onResponse(<br>                        <span class="hljs-keyword">this</span><span class="hljs-symbol">@NetworkResponseCall</span>,<br>                        Response.success(errorBody)<br>                    )<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    callback.onResponse(<br>                        <span class="hljs-keyword">this</span><span class="hljs-symbol">@NetworkResponseCall</span>,<br>                        Response.success(NetworkResponse.UnknownError(<span class="hljs-literal">null</span>))<br>                    )<br>                &#125;<br>            &#125;<br><br><br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onFailure</span><span class="hljs-params">(call: <span class="hljs-type">Call</span>&lt;<span class="hljs-type">S</span>&gt;, t: <span class="hljs-type">Throwable</span>)</span></span> &#123;<br>            <span class="hljs-keyword">val</span> networkResponse = <span class="hljs-keyword">when</span> (t) &#123;<br>                <span class="hljs-keyword">is</span> Exception -&gt; NetworkResponse.NetError(<span class="hljs-literal">null</span>,<span class="hljs-literal">null</span>,t)<br>                <span class="hljs-keyword">else</span> -&gt; NetworkResponse.UnknownError(t)<br>            &#125;<br>            callback.onResponse(<span class="hljs-keyword">this</span><span class="hljs-symbol">@NetworkResponseCall</span>, Response.success(networkResponse))<br>        &#125;<br><br>    &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åˆ›å»º-CallAdapter"><a href="#åˆ›å»º-CallAdapter" class="headerlink" title="åˆ›å»º CallAdapter"></a>åˆ›å»º CallAdapter</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NetworkResponseAdapter</span>&lt;<span class="hljs-type">S : Any, E : Any</span>&gt;</span>(<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> successType: Type,<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> errorBodyConverter: Converter&lt;ResponseBody, E&gt;<br>) : CallAdapter&lt;S, Call&lt;NetworkResponse&lt;S, E&gt;&gt;&gt; &#123;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">responseType</span><span class="hljs-params">()</span></span>: Type = successType<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">adapt</span><span class="hljs-params">(call: <span class="hljs-type">Call</span>&lt;<span class="hljs-type">S</span>&gt;)</span></span>: Call&lt;NetworkResponse&lt;S, E&gt;&gt; &#123;<br>        <span class="hljs-keyword">return</span> NetworkResponseCall(call, errorBodyConverter)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åˆ›å»ºCallAdapterFactory"><a href="#åˆ›å»ºCallAdapterFactory" class="headerlink" title="åˆ›å»ºCallAdapterFactory"></a>åˆ›å»ºCallAdapterFactory</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span>  <span class="hljs-title">NetworkResponseAdapterFactory</span>:<span class="hljs-type">CallAdapter.Factory</span></span>()&#123;<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">get</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        returnType: <span class="hljs-type">Type</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">        annotations: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">out</span> <span class="hljs-type">Annotation</span>&gt;,</span></span><br><span class="hljs-params"><span class="hljs-function">        retrofit: <span class="hljs-type">Retrofit</span></span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span>: CallAdapter&lt;*, *&gt;? &#123;<br>        <span class="hljs-comment">// suspend functions wrap the response type in `Call`</span><br>        <span class="hljs-keyword">if</span>(Call::<span class="hljs-keyword">class</span>.java != getRawType(returnType))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span><br>        &#125;<br>        check(returnType <span class="hljs-keyword">is</span> ParameterizedType)&#123;<br>            <span class="hljs-string">&quot;return type must be parameterized as Call&lt;NetworkResponse&lt;&lt;Foo&gt;&gt; or Call&lt;NetworkResponse&lt;out Foo&gt;&gt;&quot;</span><br>        &#125;<br>        <span class="hljs-comment">// get the response type inside the `Call` type</span><br>        <span class="hljs-keyword">val</span> responseType = getParameterUpperBound(<span class="hljs-number">0</span>,returnType)<br>        <span class="hljs-comment">// if the response type is not ApiResponse then we can&#x27;t handle this type, so we return null</span><br>        <span class="hljs-keyword">if</span>(getRawType(responseType) != NetworkResponse::<span class="hljs-keyword">class</span>.java)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span><br>        &#125;<br><br><br>        <span class="hljs-comment">// the response type is ApiResponse and should be parameterized</span><br>        check(responseType <span class="hljs-keyword">is</span> ParameterizedType) &#123; <span class="hljs-string">&quot;Response must be parameterized as NetworkResponse&lt;Foo&gt; or NetworkResponse&lt;out Foo&gt;&quot;</span> &#125;<br><br>        <span class="hljs-keyword">val</span> successBodyType = getParameterUpperBound(<span class="hljs-number">0</span>, responseType)<br>        <span class="hljs-keyword">val</span> errorBodyType = getParameterUpperBound(<span class="hljs-number">1</span>, responseType)<br><br>        <span class="hljs-keyword">val</span> errorBodyConverter =<br>            retrofit.nextResponseBodyConverter&lt;Any&gt;(<span class="hljs-literal">null</span>, errorBodyType, annotations)<br><br>        <span class="hljs-keyword">return</span> NetworkResponseAdapter&lt;Any, Any&gt;(successBodyType, errorBodyConverter)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ„å»º-Retrofit-å®ä¾‹æ—¶æ·»åŠ è¯¥-Factory"><a href="#æ„å»º-Retrofit-å®ä¾‹æ—¶æ·»åŠ è¯¥-Factory" class="headerlink" title="æ„å»º Retrofit å®ä¾‹æ—¶æ·»åŠ è¯¥ Factory"></a>æ„å»º Retrofit å®ä¾‹æ—¶æ·»åŠ è¯¥ Factory</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-keyword">val</span> retrofit = Retrofit.Builder()<br>    .baseUrl(BASE_URL)<br>    .addCallAdapterFactory(NetworkResponseAdapterFactory())<br>    .addConverterFactory(GsonConverterFactory.create())<br>    .build()<br></code></pre></td></tr></table></figure><h4 id="ä½¿ç”¨typealiasç®€åŒ–è¿”å›ç±»å‹-å¯é€‰"><a href="#ä½¿ç”¨typealiasç®€åŒ–è¿”å›ç±»å‹-å¯é€‰" class="headerlink" title="ä½¿ç”¨typealiasç®€åŒ–è¿”å›ç±»å‹(å¯é€‰)"></a>ä½¿ç”¨typealiasç®€åŒ–è¿”å›ç±»å‹(å¯é€‰)</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-keyword">data</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HttpError</span></span>(<span class="hljs-keyword">val</span> httpCode:<span class="hljs-built_in">Int</span>,<span class="hljs-keyword">val</span> errorMsg:String?,<span class="hljs-keyword">val</span> exception: Throwable?)<br><span class="hljs-comment">// before</span><br><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">DemoApiService</span> </span>&#123;<br>    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">mainPageInfo</span><span class="hljs-params">()</span></span>: NetworkResponse&lt;MainPageInfo, HttpError&gt;<br>&#125;<br><span class="hljs-comment">// after</span><br><span class="hljs-keyword">typealias</span> GenericResponse&lt;S&gt; = NetworkResponse&lt;S, HttpError&gt;<br><br><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ApiService</span> </span>&#123;<br>    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">mainPageInfo</span><span class="hljs-params">()</span></span>: GenericResponse&lt;MainPageInfo&gt;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>åœ¨ Activity ä¸­ç›´æ¥ä½¿ç”¨lifecycleScopeå¯åŠ¨åç¨‹ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin">lifecycleScope.launch(Dispatchers.IO) &#123;<br>    Log.e(<span class="hljs-string">&quot;KotlinActivity&quot;</span>, <span class="hljs-string">&quot;lifecycleScope.launch --&gt;&gt;&quot;</span> + Thread.currentThread().name);<br>    <span class="hljs-keyword">val</span> mainPageInfo = mainPageApi.getMainPageInfo()<br><br>    withContext(Dispatchers.Main) &#123;<br>        Log.e(<br>            <span class="hljs-string">&quot;KotlinActivity&quot;</span>,<br>            <span class="hljs-string">&quot;withContext(Dispatchers.Main) --&gt;&gt;&quot;</span> + Thread.currentThread().name<br>        );<br>        <span class="hljs-keyword">when</span>(mainPageInfo)&#123;<br><br>            <span class="hljs-keyword">is</span> NetworkResponse.NetError -&gt; Log.e(<span class="hljs-string">&quot;KotlinActivity&quot;</span>,<br>                <span class="hljs-string">&quot;NetError-&gt;<span class="hljs-variable">$mainPageInfo</span>&quot;</span><br>            )<br>            <span class="hljs-keyword">is</span> NetworkResponse.Success -&gt;  refreshViewWithLaunch(mainPageInfo.body)<br>            <span class="hljs-keyword">is</span> NetworkResponse.UnknownError -&gt; Log.e(<span class="hljs-string">&quot;KotlinActivity&quot;</span>,<span class="hljs-string">&quot;UnknownError-&gt;&quot;</span> + mainPageInfo.error)<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ–è€…åœ¨ ViewModel ä¸­å€ŸåŠ© LiveData å°†è¿”å›å€¼è½¬åŒ–ä¸ºå¯è§‚å¯Ÿå¯¹è±¡</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainPageInfoViewModel</span>:<span class="hljs-type">ViewModel</span></span>() &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _mainPageInfo  = MutableLiveData&lt;MainPageInfo&gt;()<br>    <span class="hljs-keyword">val</span> mainPageInfo: LiveData&lt;MainPageInfo&gt; <span class="hljs-keyword">get</span>() = _mainPageInfo<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getMainPageInfo</span><span class="hljs-params">()</span></span>&#123;<br>        viewModelScope.launch(Dispatchers.IO)&#123;<br>            <span class="hljs-keyword">val</span> result = mainPageApi.getMainPageInfo()<br>            withContext(Dispatchers.Main)&#123;<br>                <span class="hljs-keyword">when</span>(result)&#123;<br>                    <span class="hljs-keyword">is</span> NetworkResponse.NetError -&gt; Log.e(<span class="hljs-string">&quot;MainPageInfoViewModel&quot;</span>,<br>                        <span class="hljs-string">&quot;NetError-&gt;<span class="hljs-variable">$result</span>&quot;</span><br>                    )<br>                    <span class="hljs-keyword">is</span> NetworkResponse.Success -&gt;  _mainPageInfo.value =  result.body<br>                    <span class="hljs-keyword">is</span> NetworkResponse.UnknownError -&gt; Log.e(<span class="hljs-string">&quot;MainPageInfoViewModel&quot;</span>,<span class="hljs-string">&quot;UnknownError-&gt;&quot;</span> + result.error)<br>                &#125;<br><br>            &#125;<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ Activity ä¸­ä½¿ç”¨</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Kotlin">mainPageInfoModel = ViewModelProvider(<span class="hljs-keyword">this</span>).<span class="hljs-keyword">get</span>(MainPageInfoViewModel::<span class="hljs-keyword">class</span>.java)<br>mainPageInfoModel.mainPageInfo.observe(<span class="hljs-keyword">this</span>, Observer &#123;<br>    <span class="hljs-keyword">if</span> (it != <span class="hljs-literal">null</span>) &#123;<br>        Log.e(<span class="hljs-string">&quot;KotlinActivity&quot;</span>, <span class="hljs-string">&quot;viewmodelè·å–ç»“æœæˆåŠŸ&quot;</span>)<br>        refreshViewWithViewModelResult(it);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        Log.e(<span class="hljs-string">&quot;KotlinActivity&quot;</span>, <span class="hljs-string">&quot;viewmodelè·å–ç»“æœä¸ºç©º&quot;</span>)<br>    &#125;<br>&#125;)<br>mainPageInfoModel.getMainPageInfo()<br></code></pre></td></tr></table></figure><p>æš‚æ—¶å…ˆè¿™æ ·å§ï¼ŒåŸºæœ¬ä¸Šå¤Ÿç”¨äº†</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;Retrofitåœ¨2019-06-05å‘å¸ƒçš„2.6.0ç‰ˆæœ¬ä¸­å°±å·²ç»æ”¯æŒKotlin ä¸­çš„ suspendä¿®é¥°ç¬¦äº†ï¼Œç›®å‰æ­£å‡†å¤‡åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ K</summary>
      
    
    
    
    
    <category term="Android" scheme="https://blog.huangyuanlove.com/tags/Android/"/>
    
    <category term="Kotlin" scheme="https://blog.huangyuanlove.com/tags/Kotlin/"/>
    
    <category term="Retrofit" scheme="https://blog.huangyuanlove.com/tags/Retrofit/"/>
    
  </entry>
  
  <entry>
    <title>é¸¿è’™ArkUI-X è·¨å¹³å°é€šä¿¡ï¼šä»å…¥åœŸåˆ°å¤æ´»</title>
    <link href="https://blog.huangyuanlove.com/2024/03/27/%E9%B8%BF%E8%92%99ArkUI-X-%E8%B7%A8%E5%B9%B3%E5%8F%B0%E9%80%9A%E4%BF%A1%EF%BC%9A%E4%BB%8E%E5%85%A5%E5%9C%9F%E5%88%B0%E5%A4%8D%E6%B4%BB/"/>
    <id>https://blog.huangyuanlove.com/2024/03/27/%E9%B8%BF%E8%92%99ArkUI-X-%E8%B7%A8%E5%B9%B3%E5%8F%B0%E9%80%9A%E4%BF%A1%EF%BC%9A%E4%BB%8E%E5%85%A5%E5%9C%9F%E5%88%B0%E5%A4%8D%E6%B4%BB/</id>
    <published>2024-03-27T06:21:02.000Z</published>
    <updated>2024-03-27T06:24:39.185Z</updated>
    
    <content type="html"><![CDATA[<hr><p>2024.01.31 æ›´æ–°<br>åœ¨ä¸Šä¸€ç¯‡ <a href="https://juejin.cn/post/7327910163628294154">é¸¿è’™è·¨å¹³å° ArkUI-Xä»å…¥é—¨åˆ°å…¥åœŸ </a>ä¸­æåˆ°åˆ›å»º Bridge å¯¹è±¡æ—¶å¤±è´¥çš„é—®é¢˜ï¼Œåœ¨æœ¬æ–‡ä¸­æåˆ°çš„é—®é¢˜åˆé‡æ–°éªŒè¯äº†å‡ æ¬¡ï¼Œå’¨è¯¢äº†ä¸€ä¸‹ç›¸å…³äººå‘˜ï¼Œç»“è®ºæ˜¯è¿™æ ·çš„</p><ol><li>åœ¨ Arkui-X ä¸­ï¼Œå¦‚æœ Bridge å¯¹è±¡å£°æ˜ä¸ºæˆå‘˜å˜é‡å¹¶ä¸”ç«‹å³åˆ›å»ºï¼Œè¿™æ—¶å€™ preview ä¼šç™½å±ï¼Œæ˜¯åŠ è½½ç•Œé¢æ—¶å°±æŒ‚äº†ï¼Œå› ä¸ºè¿™ä¸ªbridgeå¯¹è±¡ï¼Œæ˜¯éœ€è¦ native ä¾§çš„æ–‡ä»¶æ”¯æŒçš„ï¼Œæ¯”å¦‚Androidä¸­çš„libbridge.so(é›†æˆäº§ç‰©åˆ° Android å·¥ç¨‹æ—¶å¤åˆ¶è¿‡å»çš„)ã€‚è¿™æ—¶å€™é›†æˆåˆ° Android å·¥ç¨‹ä¸­æ˜¯æ­£å¸¸è¿è¡Œçš„ã€‚</li><li>DevEco ä¸­çš„ preview ç›¸å½“äºçº¯é¸¿è’™ç³»ç»Ÿ(HarmonyOS next),åœ¨çº¯é¸¿è’™ç³»ç»Ÿä¸­æ˜¯æ— æ³•ä½¿ç”¨Bridge çš„ï¼Œå› ä¸ºçº¯é¸¿è’™ä¸Šæ²¡æœ‰è¿™ä¸ª so åº“ã€‚æ‰€ä»¥åœ¨åˆ›å»ºè¿™ä¸ª Bridge å¯¹è±¡çš„æ—¶å€™éœ€è¦åˆ¤æ–­ä¸€ä¸‹æ˜¯ä¸æ˜¯è·¨å¹³å°ï¼Œä¸€èˆ¬ä»deviceInfo.osFullNameåˆ¤æ–­ï¼š<br><code>let osName: string = deviceInfo.osFullName;</code>è·å–å¯¹åº”OSåå­—ï¼Œè¯¥æ¥å£å·²æ”¯æŒè·¨å¹³å°ï¼Œä¸åŒå¹³å°ä¸Šå…¶è¿”å›å€¼å¦‚ä¸‹:</li></ol><ul><li>OpenHarmonyä¸Šï¼ŒosNameç­‰äº<code>OpenHarmony XXX</code></li><li>Androidä¸Šï¼ŒosNameç­‰äº<code>Android XXX</code></li><li>iOSä¸Šï¼ŒosNameç­‰äº<code>iOS XXX</code><br>å…·ä½“æ–‡æ¡£åœ¨è¿™é‡Œ <a href="https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/quick-start/platform-different-introduction.md#%E5%B9%B3%E5%8F%B0%E5%B7%AE%E5%BC%82%E5%8C%96">å¹³å°å·®å¼‚åŒ–</a></li></ul><hr><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>è¯è¯´å‰ä¸¤å¤©åˆšè°ƒç ”äº† ArkUI-X è·¨å¹³å°æ–¹æ¡ˆï¼Œæœ€ç»ˆå¡æ­»åœ¨äº†è·¨å¹³å°å’Œ native é€šä¿¡ä¸Šï¼Œæ–‡ç« åœ¨è¿™é‡Œ<a href="https://juejin.cn/post/7327910163628294154">é¸¿è’™è·¨å¹³å° ArkUI-Xä»å…¥é—¨åˆ°å…¥åœŸ</a>ï¼Œä»Šå¤©åœ¨ç¤¾åŒºçš„å¸®åŠ©ä¸‹è·‘é€šäº†é€šä¿¡æ–¹æ¡ˆï¼Œè¯¥æŒ–å‡ºæ¥å¤æ´»äº†ã€‚<br><strong>æ³¨æ„æ–‡ç« æ‰€è¯´çš„å®˜æ–¹æ˜¯æŒ‡ç¤¾åŒºï¼Œå¹¶ä¸æ˜¯æŒ‡åä¸ºå…¬å¸ï¼Œæ›´ä¸æ˜¯å…¶ä»–</strong></p><h3 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h3><p>è¿™é‡Œåªå¯¹ Android ä¾§è¿›è¡Œäº†å®ç°ï¼ŒiOS ä¾§å› ä¸ºæ²¡æœ‰å®ä½“æœºçš„åŸå› ï¼Œå…ˆæ”¾ä¸€æ”¾ï¼ŒåŸç†éƒ½ä¸€æ ·ï¼Œä»£ç ä¹Ÿå·®ä¸å¤šã€‚å®˜æ–¹æ–‡æ¡£å…ˆæ”¾åœ¨è¿™é‡Œäº† <a href="https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/tutorial/how-to-use-bridge-on-android.md#%E5%B9%B3%E5%8F%B0%E6%A1%A5%E6%8E%A5%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97">å¹³å°æ¡¥æ¥å¼€å‘æŒ‡å—</a></p><blockquote><p>å¹³å°æ¡¥æ¥ç”¨äºå®¢æˆ·ç«¯ï¼ˆArkUIï¼‰å’Œå¹³å°ï¼ˆAndroidæˆ–iOSï¼‰ä¹‹é—´ä¼ é€’æ¶ˆæ¯ï¼Œå³ç”¨äºArkUIä¸å¹³å°åŒå‘æ•°æ®ä¼ é€’ã€ArkUIä¾§è°ƒç”¨å¹³å°çš„æ–¹æ³•ã€å¹³å°è°ƒç”¨ArkUIä¾§çš„æ–¹æ³•ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»Androidå¹³å°ä¸ArkUIäº¤äº’ï¼ŒArkUIä¾§å…·ä½“ç”¨æ³•è¯·å‚è€ƒ<a href="https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/reference/apis/js-apis-bridge.md">Bridge API</a>ï¼ŒAndroidä¾§å‚è€ƒ<a href="https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/reference/arkui-for-android/BridgePlugin.md">BridgePlugin</a>ã€‚</p></blockquote><p>å®˜æ–¹åœ¨ Android ä¾§æä¾›äº†ä¸€ä¸ªæŠ½è±¡ç±»<code>BridgePlugin</code>ï¼Œæˆ‘ä»¬éœ€è¦ç»§æ‰¿å®ƒå®ç°ä¸€äº›æ–¹æ³•æ¥è¿›è¡Œé€šä¿¡ã€‚åœ¨ ArkUI-X ä¾§åŒæ ·æä¾›äº†<code>&#39;@arkui-x.bridge</code>åŒ…æ¥è¿›è¡Œé€šä¿¡ã€‚</p><h4 id="ArkUI-X-ä¾§-Bridge"><a href="#ArkUI-X-ä¾§-Bridge" class="headerlink" title="ArkUI-X ä¾§ Bridge"></a>ArkUI-X ä¾§ Bridge</h4><p>å…ˆçœ‹ä¸‹ArkUI-X ä¾§æä¾›çš„æ–¹æ¡ˆï¼Œå®˜æ–¹æ–‡æ¡£åœ¨è¿™é‡Œ <a href="https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/reference/apis/js-apis-bridge.md#arkui-xbridgedts-%E5%B9%B3%E5%8F%B0%E6%A1%A5%E6%8E%A5">@arkui-x.bridge.d.ts (å¹³å°æ¡¥æ¥)</a>ã€‚<br>åœ¨å®˜æ–¹æä¾›çš„<a href="https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/tutorial/how-to-use-bridge-on-android.md#%E5%9C%BA%E6%99%AF%E7%A4%BA%E4%BE%8B">åœºæ™¯ç¤ºä¾‹ä¸­</a>ä¸­ï¼Œæ˜¯åœ¨é¡µé¢(ä¹Ÿå°±æ˜¯è¢«<code>@Entry</code>è£…é¥°çš„ç±»)ä¸­åˆ›å»ºçš„ï¼Œä½†æ˜¯åœ¨å®è·µä¸­å‘ç°ä¸èƒ½æ­£å¸¸è¿è¡Œï¼Œä¼šåˆ›å»º Bridge å¯¹è±¡æ—¶ä¼šæŠ¥é”™</p><blockquote><p>Error message: Cannot read property createBridge of undefined</p></blockquote><p>æŒ‡å‘äº†<code>private bridgeImpl = bridge.createBridge(&#39;Bridge&#39;);</code>è¿™ä¸€è¡Œä»£ç ï¼Œå‘å®˜æ–¹æäº¤äº† issueï¼Œåœ¨å…¶å¸®åŠ©ä¸‹ï¼Œå°†åˆ›å»º Bridge å¯¹è±¡çš„ä»£ç æ”¾åœ¨äº†å¦å¤–çš„ ets æ–‡ä»¶ä¸­å¯ä»¥æ­£å¸¸è¿è¡Œã€‚</p><h5 id="åˆ›å»º-Bridge"><a href="#åˆ›å»º-Bridge" class="headerlink" title="åˆ›å»º Bridge"></a>åˆ›å»º Bridge</h5><p>å…ˆå¯¼åŒ… <code>import Bridge from &#39;@arkui-x.bridge&#39;;</code><br>å†åˆ›å»º<code> bridgeObj: BridgeObject = Bridge.createBridge(&#39;Bridge&#39;);</code><br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œä¼ å…¥çš„å‚æ•°å€¼éœ€è¦<strong>å’Œ native ä¾§ä¸€è‡´ï¼Œå¦åˆ™æ— æ³•è°ƒç”¨</strong>ã€‚ </p><h4 id="Android-ä¾§-BridgePlugin"><a href="#Android-ä¾§-BridgePlugin" class="headerlink" title="Android ä¾§ BridgePlugin"></a>Android ä¾§ BridgePlugin</h4><p>çœ‹å…ˆ Android ä¾§æä¾›çš„æ–¹æ¡ˆï¼Œå®˜æ–¹æ–‡æ¡£åœ¨è¿™é‡Œ <a href="https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/reference/arkui-for-android/BridgePlugin.md#bridgeplugin-%E5%B9%B3%E5%8F%B0%E6%A1%A5%E6%8E%A5">BridgePlugin (å¹³å°æ¡¥æ¥)</a> ã€‚<br>æš´éœ²çš„ api ä¹Ÿä¸å¤šï¼ŒåŒ…æ‹¬æ„é€ æ–¹æ³•ã€callMethodã€sendMessageï¼Œä¸¤ä¸ªå›è°ƒç›‘å¬ï¼šsetMessageListenerå’ŒsetMethodResultListenerã€‚</p><h5 id="åˆ›å»º-BridgePlugin"><a href="#åˆ›å»º-BridgePlugin" class="headerlink" title="åˆ›å»º BridgePlugin"></a>åˆ›å»º BridgePlugin</h5><p>ä¸€èˆ¬æ¥è®²ï¼Œæˆ‘ä»¬ä¼šè‡ªå·±å†™ä¸ªç±»ç»§æ‰¿<code>BridgePlugin</code>æ¥è¿›è¡Œæ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArkUIBridge</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BridgePlugin</span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ArkUIBridge&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ArkUIBridge</span><span class="hljs-params">(Context context, String bridgeName, <span class="hljs-type">int</span> instanceId)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context, bridgeName, instanceId);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œçš„<code>bridgeName</code>å‚æ•°ï¼Œä¼ å…¥çš„å€¼<strong>å¿…é¡»</strong>ä¸ ArkUI-X ä¾§ä¸€è‡´ï¼Œè‡³äº instanceId åˆ™æ˜¯<code>StageActivity</code>è¿™ä¸ªç”¨æ¥å±•ç¤º ArkUI-X å†…å®¹çš„å®¹å™¨æä¾›çš„æ–¹æ³•ï¼Œå…¶å®ä¹Ÿå°±æ˜¯è°ƒç”¨çš„<code>InstanceIdGenerator.getAndIncrement()</code>ï¼Œå…·ä½“å®ç°å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">package</span> ohos.stage.ability.adapter;<br><br><span class="hljs-keyword">import</span> java.util.concurrent.atomic.AtomicInteger;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InstanceIdGenerator</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">ID_GENERATOR</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">1</span>);<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">InstanceIdGenerator</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAndIncrement</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> ID_GENERATOR.getAndIncrement();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">get</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> ID_GENERATOR.get();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥åœ¨å…¶ä»–ä½ç½®è°ƒç”¨<code>InstanceIdGenerator.get()</code>æ¥è·å–åˆ° idã€‚ä½†éœ€è¦æ³¨æ„ï¼Œæ¯æ¬¡åˆ›å»º ArkUI-X äº§ç‰©çš„å®¹å™¨é¡µé¢ä¹Ÿå°±æ˜¯StageActivityæ—¶ï¼Œè¯¥ id éƒ½ä¼šè‡ªå¢ï¼Œå¦‚æœ id æ— æ³•å¯¹åº”åˆ™æ— æ³•äº’ç›¸é€šä¿¡</p><h4 id="ArkUIä¾§å‘Androidä¾§ä¼ é€’æ•°æ®"><a href="#ArkUIä¾§å‘Androidä¾§ä¼ é€’æ•°æ®" class="headerlink" title="ArkUIä¾§å‘Androidä¾§ä¼ é€’æ•°æ®"></a>ArkUIä¾§å‘Androidä¾§ä¼ é€’æ•°æ®</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-comment">// xxx.ets</span><br>bridgeImpl.<span class="hljs-title function_">sendMessage</span>(<span class="hljs-string">&#x27;text&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>)=&gt;</span>&#123;<br>    <span class="hljs-comment">// ç›‘å¬Androidä¾§çš„å›æ‰§</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;response: &#x27;</span> + res);<br>&#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;error: &#x27;</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));<br>&#125;);<br></code></pre></td></tr></table></figure><p>åœ¨ Android ä¾§æ¥æ”¶æ¶ˆæ¯,åœ¨æ„é€ æ–¹æ³•é‡Œé¢è®¾ç½®ä¸€ä¸‹ç›‘å¬äº‹ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-comment">//ArkUIBridge extends BridgePlugin</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">ArkUIBridge</span><span class="hljs-params">(Context context, String bridgeName, <span class="hljs-type">int</span> instanceId)</span> &#123;<br>    <span class="hljs-built_in">super</span>(context, bridgeName, instanceId);<br>    setMessageListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">IMessageListener</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">onMessage</span><span class="hljs-params">(Object o)</span> &#123;<br>            Log.e(TAG,<span class="hljs-string">&quot;onMessage--&gt;&quot;</span> + o.toString());<br>            <span class="hljs-type">JSONObject</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONObject</span>();<br>            <span class="hljs-keyword">try</span> &#123;<br>                result.put(<span class="hljs-string">&quot;platform&quot;</span>,<span class="hljs-string">&quot;Android&quot;</span>);<br>                result.put(<span class="hljs-string">&quot;result_code&quot;</span>,<span class="hljs-number">0</span>);<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>            <span class="hljs-keyword">return</span> result.toString();<br>        &#125;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessageResponse</span><span class="hljs-params">(Object o)</span> &#123;<br>            Log.e(TAG,<span class="hljs-string">&quot;onMessageResponse--&gt;&quot;</span> + o.toString());<br>        &#125;<br>    &#125;);<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="Androidä¾§å‘ArkUI-Xä¾§ä¼ é€’æ•°æ®"><a href="#Androidä¾§å‘ArkUI-Xä¾§ä¼ é€’æ•°æ®" class="headerlink" title="Androidä¾§å‘ArkUI-Xä¾§ä¼ é€’æ•°æ®"></a>Androidä¾§å‘ArkUI-Xä¾§ä¼ é€’æ•°æ®</h4><p>æ–¹å¼éƒ½ä¸€æ ·ï¼Œéœ€è¦åœ¨ ArkUI-X ä¾§è®¾ç½®ä¸€ä¸‹ç›‘å¬äº‹ä»¶</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-variable language_">this</span>.<span class="hljs-property">bridge</span> = <span class="hljs-title class_">Bridge</span>.<span class="hljs-title function_">createBridge</span>(<span class="hljs-string">&#x27;BridgeCommon&#x27;</span>);<br><span class="hljs-variable language_">this</span>.<span class="hljs-property">bridge</span>!.<span class="hljs-title function_">setMessageListener</span>(<span class="hljs-function">(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) =&gt;</span> &#123;<br><span class="hljs-keyword">if</span> (message) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`receive messageï¼š<span class="hljs-subst">$&#123;message&#125;</span>`</span>);<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">scanResult</span> = message<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ArkUI-X setMessageListener&quot;</span>;<br>&#125;)<br></code></pre></td></tr></table></figure><p>åœ¨ Android ä¾§ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-comment">////ArkUIBridge extends BridgePlugin</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMessageToArkUI</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">JSONObject</span> <span class="hljs-variable">jsonObject</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONObject</span>();<br>    <span class="hljs-keyword">try</span> &#123;<br>        jsonObject.put(<span class="hljs-string">&quot;code&quot;</span>,<span class="hljs-string">&quot;0&quot;</span>);<br>        jsonObject.put(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;æ‰«æç»“æœ&quot;</span>);<br>        jsonObject.put(<span class="hljs-string">&quot;data&quot;</span>,<span class="hljs-string">&quot;scan result from Android&quot;</span>);<br><br>    &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>        e.printStackTrace();<br>    &#125;<br>    Log.e(TAG,<span class="hljs-string">&quot;toScan before sendMessage&quot;</span> );<br>    sendMessage(jsonObject.toString());<br><br>&#125;<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ Android ä¸­è°ƒç”¨ sendMessage æ–¹æ³•æ˜¯æ²¡æœ‰è¿”å›å€¼çš„ï¼ŒArkUI-X ä¾§æ”¶åˆ°æ¶ˆæ¯åçš„è¿”å›å€¼æ˜¯åœ¨<code>setMessageListener</code>çš„<code>onMessageResponse</code>å›è°ƒä¸­æ¥æ”¶çš„ã€‚</p><h4 id="ArkUI-X-ä¾§è°ƒç”¨-Android-ä¾§çš„æ–¹æ³•"><a href="#ArkUI-X-ä¾§è°ƒç”¨-Android-ä¾§çš„æ–¹æ³•" class="headerlink" title="ArkUI-X ä¾§è°ƒç”¨ Android ä¾§çš„æ–¹æ³•"></a>ArkUI-X ä¾§è°ƒç”¨ Android ä¾§çš„æ–¹æ³•</h4><p>åœ¨ ArkUI-X ä¸­</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">getAppVersion</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initBridge</span>();<span class="hljs-comment">//åˆ›å»º bridge å¯¹è±¡</span><br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">params</span>:<span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>,<span class="hljs-title class_">Bridge</span>.<span class="hljs-property">Parameter</span>&gt; =&#123;<br>    <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;xuan&quot;</span>,<br>    <span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">18</span><br>  &#125;<br>  <span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">bridge</span>!.<span class="hljs-title function_">callMethod</span>(<span class="hljs-string">&#x27;getAppVersion&#x27;</span>,params);<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;getAppVersionè¿”å›å€¼ï¼š&#x27;</span> + result)<br>  <span class="hljs-keyword">return</span> result!.<span class="hljs-title function_">toString</span>();<br>&#125;<br><br></code></pre></td></tr></table></figure><p>åœ¨ Android</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getAppVersion</span><span class="hljs-params">(JSONObject params)</span>&#123;<br>    Log.e(TAG,<span class="hljs-string">&quot;getAppVersion from arkui-xï¼Œparams--&gt; &quot;</span>  );<br>    <span class="hljs-keyword">if</span>(params == <span class="hljs-literal">null</span>)&#123;<br>        Log.e(TAG,<span class="hljs-string">&quot;is null&quot;</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        Log.e(TAG,params.toString());<br>    &#125;<br>    <span class="hljs-type">JSONObject</span> <span class="hljs-variable">jsonObject</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONObject</span>();<br>    <span class="hljs-keyword">try</span> &#123;<br>        jsonObject.put(<span class="hljs-string">&quot;version&quot;</span>,BuildConfig.VERSION_NAME);<br>        jsonObject.put(<span class="hljs-string">&quot;buildVersion&quot;</span>,<span class="hljs-string">&quot;getAppVersion(Object params)&quot;</span>);<br><br>    &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>        e.printStackTrace();<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> jsonObject.toString();<br>&#125;<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸¤ä¾§éƒ½ä¸æ”¯æŒæ–¹æ³•é‡è½½ï¼Œåœ¨ Android ä¾§æ˜¯é€šè¿‡ HashMap ä¿å­˜çš„åœ¨ BridgePlugin ä¸­çš„æ–¹æ³•å¹¶ä¸”æ˜¯ä»¥æ–¹æ³•åä¸º keyï¼Œjava.lang.reflect.Methodä¸ºå€¼ã€‚åœ¨ Android ä¾§çš„æ–¹æ³•ä¼šè¢«è‡ªåŠ¨æ³¨å†Œï¼Œä¸éœ€è¦æˆ‘ä»¬è°ƒç”¨ä»£ç æ³¨å†Œã€‚</p><h4 id="Android-ä¾§è°ƒç”¨-ArkUI-X-ä¾§-çš„æ–¹æ³•"><a href="#Android-ä¾§è°ƒç”¨-ArkUI-X-ä¾§-çš„æ–¹æ³•" class="headerlink" title="Android ä¾§è°ƒç”¨ ArkUI-X ä¾§ çš„æ–¹æ³•"></a>Android ä¾§è°ƒç”¨ ArkUI-X ä¾§ çš„æ–¹æ³•</h4><p>åœ¨ ArkUI-X ä¸­ï¼Œéœ€è¦è‡ªå·±è°ƒç”¨registerMethodæ–¹æ³•æ¥æ³¨å†Œä¾› native è°ƒç”¨çš„æ–¹æ³•ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-comment">//æ–¹æ³•å£°æ˜</span><br><span class="hljs-title function_">getString</span>(parameters?: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>,<span class="hljs-title class_">Bridge</span>.<span class="hljs-property">Message</span>&gt;):<span class="hljs-title class_">Bridge</span>.<span class="hljs-property">ResultValue</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`----è°ƒç”¨ getStringï¼šparameters--&gt;<span class="hljs-subst">$&#123;<span class="hljs-built_in">JSON</span>.stringify(parameters)&#125;</span>`</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;call js getString success&#x27;</span>;<br>&#125;<br><span class="hljs-comment">//æ³¨å†Œæ–¹æ³•</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">bridge</span>!.<span class="hljs-title function_">registerMethod</span>(&#123;<span class="hljs-attr">name</span>:<span class="hljs-string">&quot;getString&quot;</span>,<span class="hljs-attr">method</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">getString</span>&#125;)<br></code></pre></td></tr></table></figure><p>åœ¨ Android ä¾§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-type">JSONObject</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONObject</span>();<br><span class="hljs-keyword">try</span> &#123;<br>    params.put(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;xuan&quot;</span>);<br>    params.put(<span class="hljs-string">&quot;age&quot;</span>,<span class="hljs-number">18</span>);<br>&#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>    e.printStackTrace();<br>&#125;<br>Object[] paramObject = &#123;params&#125;;<br><span class="hljs-type">MethodData</span> <span class="hljs-variable">methodData</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MethodData</span>(<span class="hljs-string">&quot;getString&quot;</span>, paramObject);<br>callMethod(methodData);<br></code></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼ŒAndroid è°ƒç”¨ ArkUI çš„æ–¹æ³•å¹¶æ²¡æœ‰è¿”å›å€¼ï¼Œéœ€è¦åœ¨<code>setMethodResultListener</code>çš„<code>onSuccess</code>æ–¹æ³•ä¸­è·å–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-comment">//è®¾ç½®è°ƒç”¨ ArkUI-X æ–¹æ³•çš„ç»“æœå›è°ƒ</span><br>setMethodResultListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">IMethodResult</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(Object o)</span> &#123;<br>        Log.e(TAG,<span class="hljs-string">&quot;IMethodResult#onSuccess--&gt;&quot;</span> +o.toString());<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(String s, <span class="hljs-type">int</span> i, String s1)</span> &#123;<br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMethodCancel</span><span class="hljs-params">(String s)</span> &#123;<br><br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><h4 id="BridgePlugin-ä¸­æä¾›ç»™-ArkUI-X-è°ƒç”¨çš„æ–¹æ³•ä¸æ”¯æŒæ–¹æ³•é‡è½½"><a href="#BridgePlugin-ä¸­æä¾›ç»™-ArkUI-X-è°ƒç”¨çš„æ–¹æ³•ä¸æ”¯æŒæ–¹æ³•é‡è½½" class="headerlink" title="BridgePlugin ä¸­æä¾›ç»™ ArkUI-X è°ƒç”¨çš„æ–¹æ³•ä¸æ”¯æŒæ–¹æ³•é‡è½½"></a>BridgePlugin ä¸­æä¾›ç»™ ArkUI-X è°ƒç”¨çš„æ–¹æ³•ä¸æ”¯æŒæ–¹æ³•é‡è½½</h4><p>åŸå› ä¸Šé¢ä¹Ÿè¯´äº†ï¼Œæ˜¯å› ä¸ºä¿å­˜çš„æ—¶å€™æ˜¯ç”¨æ–¹æ³•åä½œä¸º key ä¿å­˜åœ¨ HashMap ä¸­çš„ï¼Œé‡è½½ä¹Ÿæ²¡ç”¨ï¼Œè™½ç„¶å†™äº†ä¸æŠ¥é”™ï¼Œä½†ç»“æœä¸ä¿è¯ã€‚ä¹Ÿçœ‹ä¸€ä¸‹ä¸ºå•¥ Android ä¸ç”¨è‡ªå·±å†™ä»£ç æ³¨å†Œä¾› ArkUI-Xè°ƒç”¨çš„æ–¹æ³•ã€‚<br>åœ¨<code>ohos.ace.adapter.capability.bridge.BridgePlugin</code>è¿™ä¸ªç±»ä¸­ï¼Œé‡ç‚¹å…³æ³¨<code>HashMap&lt;String, Method&gt; methodsMap_</code>è¿™ä¸ªæˆå‘˜å˜é‡å’Œè¿™å‡ ä¸ªæ–¹æ³•ï¼š  </p><ul><li>protected Object jsCallMethod(Object object, MethodData methodData) </li><li>private Method findMethod(String methodName)</li><li>private void registerMethod(String methodName, Method methods)</li></ul><p>å½“ ArkUI-X è°ƒç”¨ Android æ–¹æ³•æ—¶ï¼Œé¦–å…ˆè°ƒç”¨çš„æ˜¯<code>jsCallMethod</code>ï¼Œåœ¨<code>jsCallMethod</code>ä¸­é¦–å…ˆè°ƒç”¨<code>findMethod</code>æ–¹æ³•ä»<code>methodsMap_</code>ä¸­è·å–å¯¹åº”çš„æ–¹æ³•ï¼Œæ‰¾äº†åˆ™ç›´æ¥è°ƒç”¨ã€‚æ²¡æ‰¾åˆ°åˆ™åå°„è·å– BridgePlugin å®ç°ç±»ä¸­çš„æ–¹æ³•ï¼Œç„¶åä½¿ç”¨æ–¹æ³•ååšåŒ¹é…ï¼Œæ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•ã€‚åˆ°è¿™é‡Œä¹Ÿå°±è§£é‡Šäº†ä¸ºå•¥ä¸æ”¯æŒæ–¹æ³•é‡è½½ã€‚ä¹Ÿè§£é‡Šäº†ä¸ºå•¥æ–¹æ³•å‚æ•°å¯¹åº”ä¸ä¸Šä¼šæœ‰å¼‚å¸¸ã€‚<br>cpp çš„æºç åœ¨ <a href="https://gitee.com/arkui-x/arkui_for_android/tree/master/capability/java/jni/bridge">https://gitee.com/arkui-x/arkui_for_android&#x2F;tree&#x2F;master&#x2F;capability&#x2F;java&#x2F;jni&#x2F;bridge</a><br>Java æºç åœ¨ <a href="https://gitee.com/arkui-x/arkui_for_android/tree/master/capability/java/src/ohos/ace/adapter/capability/bridge">https://gitee.com/arkui-x/arkui_for_android&#x2F;tree&#x2F;master&#x2F;capability&#x2F;java&#x2F;src&#x2F;ohos&#x2F;ace&#x2F;adapter&#x2F;capability&#x2F;bridge</a></p><p><img src="/image/HarmonyOS/arkui-x_debug.png" alt="image.png"></p><h4 id="å‚æ•°ç±»å‹å¯¹åº”å…³ç³»"><a href="#å‚æ•°ç±»å‹å¯¹åº”å…³ç³»" class="headerlink" title="å‚æ•°ç±»å‹å¯¹åº”å…³ç³»"></a>å‚æ•°ç±»å‹å¯¹åº”å…³ç³»</h4><p>Arkui-X ä¸­callMethodæ˜¯è¿™ä¹ˆå£°æ˜çš„</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-title function_">callMethod</span>(<span class="hljs-attr">methodName</span>: <span class="hljs-built_in">string</span>, parameters?: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Parameter</span>&gt;):<br><span class="hljs-title function_">callMethod</span>(<span class="hljs-attr">methodName</span>: <span class="hljs-built_in">string</span>, ...<span class="hljs-attr">parameters</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">any</span>&gt;): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ResultValue</span>&gt;;<br></code></pre></td></tr></table></figure><p>sendMessageæ˜¯è¿™ä¹ˆå£°æ˜çš„</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-title function_">sendMessage</span>(<span class="hljs-attr">message</span>: <span class="hljs-title class_">Message</span>, <span class="hljs-attr">callback</span>: <span class="hljs-title class_">AsyncCallback</span>&lt;<span class="hljs-title class_">Response</span>&gt;): <span class="hljs-built_in">void</span>;<br><span class="hljs-title function_">sendMessage</span>(<span class="hljs-attr">message</span>: <span class="hljs-title class_">Message</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Response</span>&gt;;<br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-keyword">type</span> S = <span class="hljs-built_in">number</span> | <span class="hljs-built_in">boolean</span> | <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">type</span> T = S | <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; | <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">boolean</span>&gt; | <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Message</span> = T | <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, T&gt;;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Parameter</span> = <span class="hljs-title class_">Message</span>;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Response</span> = <span class="hljs-title class_">Message</span>;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ResultValue</span> = T | <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, T&gt;;<br></code></pre></td></tr></table></figure><p>åœ¨ Android ä¸­sendMessage</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendMessage</span><span class="hljs-params">(Object data)</span>&#123;&#125;<br></code></pre></td></tr></table></figure><p>callMethod</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">callMethod</span><span class="hljs-params">(MethodData methodData)</span><br></code></pre></td></tr></table></figure><p>è€Œ MethodData åªæœ‰ä¸¤ä¸ªæˆå‘˜å˜é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MethodData</span> &#123;<br>    <span class="hljs-keyword">private</span> String methodName_;<br>    <span class="hljs-keyword">private</span> Object[] Parameters_;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MethodData</span><span class="hljs-params">(String methodName, Object[] parameter)</span> &#123;<br>        <span class="hljs-built_in">this</span>.methodName_ = methodName;<br>        <span class="hljs-built_in">this</span>.Parameters_ = parameter;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getMethodName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.methodName_;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Object[] getMethodParameter() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.Parameters_;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆåœ¨ä½¿ç”¨çš„æ—¶å€™å¯ä»¥è¿™æ ·:  </p><h5 id="ArkUI-Xä¸»åŠ¨è°ƒç”¨-Android"><a href="#ArkUI-Xä¸»åŠ¨è°ƒç”¨-Android" class="headerlink" title="ArkUI-Xä¸»åŠ¨è°ƒç”¨ Android"></a>ArkUI-Xä¸»åŠ¨è°ƒç”¨ Android</h5><p>åœ¨ ArkUI-X ä¸­è°ƒç”¨</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-keyword">let</span> <span class="hljs-attr">params</span>:<span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>,<span class="hljs-title class_">Bridge</span>.<span class="hljs-property">Parameter</span>&gt; =&#123;<br>  <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;xuan&quot;</span>,<br>  <span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">18</span><br>&#125;<br><span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">bridge</span>!.<span class="hljs-title function_">callMethod</span>(<span class="hljs-string">&#x27;getAppVersion&#x27;</span>,params);<br><br></code></pre></td></tr></table></figure><p>åœ¨ Android ç«¯å¯¹åº”å‚æ•°ç±»å‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getAppVersion</span><span class="hljs-params">(JSONObject params)</span>&#123;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="Android-ä¸»åŠ¨è°ƒç”¨-ArkUI-X"><a href="#Android-ä¸»åŠ¨è°ƒç”¨-ArkUI-X" class="headerlink" title="Android ä¸»åŠ¨è°ƒç”¨ ArkUI-X"></a>Android ä¸»åŠ¨è°ƒç”¨ ArkUI-X</h5><p>åœ¨ Android ä¸­è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-type">JSONObject</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONObject</span>();<br><span class="hljs-keyword">try</span> &#123;<br>    params.put(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;xuan&quot;</span>);<br>    params.put(<span class="hljs-string">&quot;age&quot;</span>,<span class="hljs-number">18</span>);<br>&#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>    e.printStackTrace();<br>&#125;<br>Object[] paramObject = &#123;params&#125;;<br><span class="hljs-type">MethodData</span> <span class="hljs-variable">methodData</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MethodData</span>(<span class="hljs-string">&quot;getString&quot;</span>, paramObject);<br>callMethod(methodData);<br></code></pre></td></tr></table></figure><p>åœ¨ ArkUI-X ä¸­å¯¹åº”ç±»å‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-title function_">getString</span>(parameters?: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>,<span class="hljs-title class_">Bridge</span>.<span class="hljs-property">Message</span>&gt;):<span class="hljs-title class_">Bridge</span>.<span class="hljs-property">ResultValue</span> &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`----è°ƒç”¨ getStringï¼šparameters--&gt;<span class="hljs-subst">$&#123;<span class="hljs-built_in">JSON</span>.stringify(parameters)&#125;</span>`</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;call js getString success&#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="BrigePluginçš„bridgeType"><a href="#BrigePluginçš„bridgeType" class="headerlink" title="BrigePluginçš„bridgeType_"></a>BrigePluginçš„bridgeType_</h4><p>BrigePluginæä¾›äº†ä¸€ä¸ªå¯ä»¥æŒ‡å®š<code>bridgeType_</code>çš„æ„é€ æ–¹æ³•ï¼Œ<br><img src="/image/HarmonyOS/arkui-x_bridge_type.png" alt="image.png"><br>å¦‚æœæˆ‘ä»¬ä¸æŒ‡å®šç±»å‹çš„è¯ï¼Œé»˜è®¤å°±æ˜¯ <code>BridgeType.JSON_TYPE</code>ï¼Œä¼ ä¸€äº›éäºŒè¿›åˆ¶çš„æ•°æ®ã€‚ä½†å‡å¦‚æˆ‘ä»¬éœ€è¦ç©¿ä¸€äº›äºŒè¿›åˆ¶æ•°æ®ï¼Œæ¯”å¦‚å›¾ç‰‡ã€éŸ³è§†é¢‘æ•°æ®ç­‰ï¼Œå¯ä»¥æŒ‡å®šä¸º<code>BridgeType.BINARY_TYPE</code>ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
      
      
    <summary type="html">&lt;hr&gt;
&lt;p&gt;2024.01.31 æ›´æ–°&lt;br&gt;åœ¨ä¸Šä¸€ç¯‡ &lt;a href=&quot;https://juejin.cn/post/7327910163628294154&quot;&gt;é¸¿è’™è·¨å¹³å° ArkUI-Xä»å…¥é—¨åˆ°å…¥åœŸ &lt;/a&gt;ä¸­æåˆ°åˆ›å»º Bridge å¯¹è±¡æ—¶å¤±è´¥çš„é—®é¢˜ï¼Œåœ¨æœ¬æ–‡ä¸­æåˆ°çš„é—®é¢˜åˆé‡</summary>
      
    
    
    
    
    <category term="HarmonyOS" scheme="https://blog.huangyuanlove.com/tags/HarmonyOS/"/>
    
  </entry>
  
  <entry>
    <title>é¸¿è’™è·¨å¹³å° ArkUI-Xä»å…¥é—¨åˆ°å…¥åœŸ</title>
    <link href="https://blog.huangyuanlove.com/2024/03/27/%E9%B8%BF%E8%92%99%E8%B7%A8%E5%B9%B3%E5%8F%B0-ArkUI-X%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/"/>
    <id>https://blog.huangyuanlove.com/2024/03/27/%E9%B8%BF%E8%92%99%E8%B7%A8%E5%B9%B3%E5%8F%B0-ArkUI-X%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/</id>
    <published>2024-03-27T03:13:02.000Z</published>
    <updated>2024-03-27T06:20:14.729Z</updated>
    
    <content type="html"><![CDATA[<hr><p>2024.01.31 æ›´æ–°<br>ç å®Œäº†<br><a href="https://juejin.cn/post/7329310941106421811">é¸¿è’™ArkUI-X è·¨å¹³å°é€šä¿¡ï¼šä»å…¥åœŸåˆ°å¤æ´»</a><br>åœ¨æœ¬æ–‡ä¸­æåˆ°çš„é—®é¢˜åˆé‡æ–°éªŒè¯äº†å‡ æ¬¡ï¼Œå’¨è¯¢äº†ä¸€ä¸‹ç›¸å…³äººå‘˜ï¼Œç»“è®ºæ˜¯è¿™æ ·çš„</p><ol><li>åœ¨ Arkui-X ä¸­ï¼Œå¦‚æœ Bridge å¯¹è±¡å£°æ˜ä¸ºæˆå‘˜å˜é‡å¹¶ä¸”ç«‹å³åˆ›å»ºï¼Œè¿™æ—¶å€™ preview ä¼šç™½å±ï¼Œæ˜¯åŠ è½½ç•Œé¢æ—¶å°±æŒ‚äº†ï¼Œå› ä¸ºè¿™ä¸ªbridgeå¯¹è±¡ï¼Œæ˜¯éœ€è¦ native ä¾§çš„æ–‡ä»¶æ”¯æŒçš„ï¼Œæ¯”å¦‚Androidä¸­çš„libbridge.so(é›†æˆäº§ç‰©åˆ° Android å·¥ç¨‹æ—¶å¤åˆ¶è¿‡å»çš„)ã€‚è¿™æ—¶å€™é›†æˆåˆ° Android å·¥ç¨‹ä¸­æ˜¯æ­£å¸¸è¿è¡Œçš„ã€‚</li><li>DevEco ä¸­çš„ preview ç›¸å½“äºçº¯é¸¿è’™ç³»ç»Ÿ(HarmonyOS next),åœ¨çº¯é¸¿è’™ç³»ç»Ÿä¸­æ˜¯æ— æ³•ä½¿ç”¨Bridge çš„ï¼Œå› ä¸ºçº¯é¸¿è’™ä¸Šæ²¡æœ‰è¿™ä¸ª so åº“ã€‚æ‰€ä»¥åœ¨åˆ›å»ºè¿™ä¸ª Bridge å¯¹è±¡çš„æ—¶å€™éœ€è¦åˆ¤æ–­ä¸€ä¸‹æ˜¯ä¸æ˜¯è·¨å¹³å°ï¼Œä¸€èˆ¬ä»deviceInfo.osFullNameåˆ¤æ–­ï¼š<br><code>let osName: string = deviceInfo.osFullName;</code>è·å–å¯¹åº”OSåå­—ï¼Œè¯¥æ¥å£å·²æ”¯æŒè·¨å¹³å°ï¼Œä¸åŒå¹³å°ä¸Šå…¶è¿”å›å€¼å¦‚ä¸‹:</li></ol><ul><li>OpenHarmonyä¸Šï¼ŒosNameç­‰äº<code>OpenHarmony XXX</code></li><li>Androidä¸Šï¼ŒosNameç­‰äº<code>Android XXX</code></li><li>iOSä¸Šï¼ŒosNameç­‰äº<code>iOS XXX</code><br>å…·ä½“æ–‡æ¡£åœ¨è¿™é‡Œ <a href="https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/quick-start/platform-different-introduction.md#%E5%B9%B3%E5%8F%B0%E5%B7%AE%E5%BC%82%E5%8C%96">å¹³å°å·®å¼‚åŒ–</a></li></ul><hr><p>2024.01.28 æ›´æ–°<br><del>ä¸Šé¢</del>æ–‡ç« ä¸­æåˆ°è·¨å¹³å°é€šä¿¡(Bridge)çš„é—®é¢˜åœ¨ç¤¾åŒºçš„å¸®åŠ©ä¸‹è§£å†³äº†ï¼Œæ–¹æ¡ˆå°±ä¸è¦åœ¨é¡µé¢(ä¹Ÿå°±æ˜¯@Entryä¿®é¥°)ä¸­è¿›è¡Œåˆå§‹åŒ–ï¼Œå¯ä»¥å†™ä¸ªå·¥å…·ç±»ï¼Œåœ¨å·¥å…·ç±»ä¸­åˆå§‹åŒ–ï¼Œè™½ç„¶ debug ä¹Ÿæ˜¯æç¤º undefinedï¼Œä½†è¿è¡Œçš„æ—¶å€™å¯ä»¥æ­£å¸¸å·¥ä½œã€‚<br>æ–°çš„åšå®¢è®°å½•å·²ç»åœ¨ç äº†ã€‚ã€‚ã€‚ã€‚</p><hr><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>å–Šäº†å¥½é•¿æ—¶é—´è¦åšé¸¿è’™åº”ç”¨ï¼Œè‡ªå·±ä¹Ÿå†™äº†ä¸€ç‚¹ï¼Œä½†è¦åŒæ—¶ç…§é¡¾ä¸‰ä¸ªç§»åŠ¨å¹³å°æœ‰ç‚¹æ¶å¿ƒï¼Œå¤§è‡´çœ‹äº†ä¸€ä¸‹é¸¿è’™ç¤¾åŒºçš„ arkui-x è·¨å¹³å°æ–¹æ¡ˆ <a href="https://gitee.com/arkui-x">https://gitee.com/arkui-x</a> ,å…ˆè°ƒç ”ä¸€ä¸‹è¯•è¯•æ°´<br><strong>æ³¨æ„æ–‡ç« æ‰€è¯´çš„å®˜æ–¹æ˜¯æŒ‡ç¤¾åŒºï¼Œå¹¶ä¸æ˜¯æŒ‡åä¸ºå…¬å¸ï¼Œæ›´ä¸æ˜¯å…¶ä»–</strong></p><h3 id="é™åˆ¶"><a href="#é™åˆ¶" class="headerlink" title="é™åˆ¶"></a>é™åˆ¶</h3><p>ä¸‘è¯è¯´åœ¨å‰å¤´ï¼Œå…ˆè¯´é™åˆ¶ï¼ŒæŒ‰ç…§å®˜æ–¹æ–‡æ¡£è¯´æ³•ï¼Œå¿˜è®°åœ¨å“ªé‡Œçœ‹åˆ°äº†<br>Androidç³»ç»Ÿç‰ˆæœ¬8+ ä¸”ä»… arm è®¾å¤‡æ”¯æŒ<br>iOSç³»ç»Ÿç‰ˆæœ¬ 10+ ä¸”ä»… arm è®¾å¤‡æ”¯æŒ</p><h3 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h3><p>å®˜æ–¹æ–‡æ¡£çœ‹è¿™é‡Œï¼š<a href="https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/README.md">https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/README.md</a></p><p>å®˜æ–¹ä»“åº“åœ¨è¿™é‡Œï¼š<a href="https://gitee.com/arkui-x">https://gitee.com/arkui-x</a></p><p>ä½¿ç”¨å®˜æ–¹çš„å¥—ä»¶è¿˜æ˜¯éœ€è¦ç”³è¯·ï¼Œæ–¹å¼å’Œä¹‹å‰ä¸€æ ·ï¼Œå°±æ˜¯æ‰¾å•†åŠ¡è°ˆåˆä½œï¼Œç­¾åè®®ã€‚ç„¶åç»™è´¦å·å¼€é€šä¸‹è½½æƒé™ç„¶åå»ä¸‹è½½ã€‚</p><h4 id="IDE"><a href="#IDE" class="headerlink" title="IDE"></a>IDE</h4><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ OpenHarmony ç¤¾åŒºæä¾›çš„å¼€å‘å¥—ä»¶</p><p><img src="/image/HarmonyOS/deveco.png" alt="image.png"><br>ä¸‹è½½é“¾æ¥ï¼š</p><p><a href="https://gitee.com/openharmony/docs/blob/master/zh-cn/release-notes/OpenHarmony-v4.0-release.md#%E9%85%8D%E5%A5%97%E5%85%B3%E7%B3%BB">https://gitee.com/openharmony/docs/blob/master/zh-cn/release-notes/OpenHarmony-v4.0-release.md#%E9%85%8D%E5%A5%97%E5%85%B3%E7%B3%BB</a></p><p>å®‰è£…æ­¥éª¤éƒ½ä¸€æ ·ï¼Œ<strong>æ³¨æ„ node å’Œohpmç‰ˆæœ¬</strong>ï¼Œé€‰æ‹©ideå»ºè®®çš„ç‰ˆæœ¬ï¼Œå¯ä»¥é‡æ–°ä¸‹è½½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æœ¬æœºä¸Šå·²ç»å®‰è£…å¥½çš„ï¼Œæˆ‘è¿™é‡Œç”¨çš„ nodeæ˜¯ 16.20.0ï¼Œä¸è¦å¤´é“æä¸ª 18.x.x 20.x.xçš„ç‰ˆæœ¬ï¼Œå¯èƒ½ä¼šæœ‰ä¸€äº›è¯¡å¼‚çš„é—®é¢˜</p><h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>å¯åŠ¨ IDEï¼Œé¡µé¢å·¦ä¾§æœ‰diagnoseå¯ä»¥æ£€æµ‹ä¸€äº›åŸºç¡€é…ç½®å’Œç½‘ç»œè¿æ¥æƒ…å†µã€‚ç‚¹å‡»å·¦ä¾§Customizeï¼Œåœ¨å³ä¾§åº•éƒ¨ç‚¹å‡»â€All settingsâ€è¿›å…¥é¦–é€‰é¡¹é…ç½®</p><p><img src="/image/HarmonyOS/deveco_customize.png" alt="image.png"></p><p>é€‰æ‹© SDKï¼Œå®‰è£… OpenHarmony SDK api 10ï¼Œå®‰è£…å®Œæˆä¹‹åå†å®‰è£… ArkUI-X</p><p><img src="/image/HarmonyOS/deveco_sdk.png" alt="image.png"></p><p>å®‰è£…å®Œæˆåå°±å¯ä»¥äº†ï¼Œæ²¡æœ‰å…¶ä»–éœ€è¦å®‰è£…çš„äº†</p><h3 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h3><h4 id="åˆ›å»ºå·¥ç¨‹"><a href="#åˆ›å»ºå·¥ç¨‹" class="headerlink" title="åˆ›å»ºå·¥ç¨‹"></a>åˆ›å»ºå·¥ç¨‹</h4><p>æ²¡æœ‰æä¾›ç›´æ¥åˆ›å»ºè·¨å¹³å°åº”ç”¨çš„åœ°æ–¹ï¼Œç›®å‰åªèƒ½ç”¨ import çš„å½¢å¼</p><p><img src="/image/HarmonyOS/deveco_import_project.png" alt="image.png"></p><p>æ‰¾åˆ° import Sample,æ–°é¡µé¢å·¦ä¸Šè§’é€‰æ‹© OpenHarmonyï¼Œä¸‹é¢ä¼šå‡ºç° ArkUI-Xï¼Œè¿™é‡Œç”¨ HelloWorld æ¥åšç¤ºä¾‹ã€‚</p><p><img src="/image/HarmonyOS/select_sample_to_improt.png" alt="image.png"></p><p>æ‰“å¼€å·¥ç¨‹åå¼€å§‹è‡ªåŠ¨åŒæ­¥ï¼Œä½†è¿™é‡Œä¼šå¤±è´¥ï¼Œå› ä¸ºå„ç§æ’ä»¶ç‰ˆæœ¬ä¸é€‚é…ï¼Œç‚¹ä¸€ä¸‹è“è‰²çš„æ–‡å­—ï¼Œä¼šå¸®ä½ å…¨éƒ¨ä¿®æ”¹å¥½ï¼Œé‡æ–°åŒæ­¥ï¼Œåˆ°è¿™é‡Œå°±å·²ç»å…¨éƒ¨å‡†å¤‡å¥½äº†ã€‚</p><p><img src="/image/HarmonyOS/sync_failed.png" alt="image.png"></p><h4 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h4><p>çª—å£é¡¶éƒ¨èœå• Buildâ€“&gt; Build Hap(s)&#x2F;APP(s)â€“&gt;Build APP(s)ã€‚ä¼šåŒæ—¶æ„å»º Android å’Œ iOS äº§ç‰©</p><p><img src="/image/HarmonyOS/build_result.png" alt="image.png"></p><p>ä¸å‡ºæ„å¤–çš„è¯å‡ºæ„å¤–äº†ï¼Œæ‰“åŒ…å¤±è´¥ï¼Œä½†è¿™æ—¶å¯¹åº”çš„èµ„æºéƒ½å·²ç»å¤åˆ¶åˆ°ç›¸åº”çš„æ–‡ä»¶å¤¹ä¸­äº†ã€‚å¯¹åº”çš„è¯´æ˜å¯ä»¥çœ‹è¿™é‡Œ</p><p><a href="https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/quick-start/package-structure-guide.md">https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/quick-start/package-structure-guide.md</a></p><p>è¿™æ—¶å€™æˆ‘ä»¬è¿›å…¥åˆ°é¡¹ç›®å·¥ç¨‹çš„ .arkui-x&#x2F;androidç›®å½•ä¸‹ï¼Œæ‰§è¡Œ <strong>.&#x2F;gradlew assembleDebug</strong> æ¥ç¼–è¯‘ android å®‰è£…åŒ…ã€‚æ³¨æ„è¿™é‡Œ gradlew å¯èƒ½æ²¡æœ‰æ‰§è¡Œæƒé™ï¼Œ<strong>chmod +x gradlew</strong> ç»™ä¸€ä¸‹æ‰§è¡Œæƒé™å°±å¥½äº†ã€‚</p><p>å¯¹äº iOS å·¥ç¨‹ï¼Œå¯ä»¥ç”¨ Xcode æ‰“å¼€ä¹‹åé…ç½®ä¸€ä¸‹ç­¾åç„¶åæ‰“åŒ…ã€‚</p><p>åˆ°è¿™é‡Œï¼Œæ–°å»ºå·¥ç¨‹ç¼–è¯‘å¤šå¹³å°å°±å·²ç»å®Œæˆäº†ã€‚ä½†æˆ‘ä»¬æœ‰å¾ˆå¤šé¡¹ç›®ä¸æ˜¯ä»å¤´å¼€å§‹ï¼Œéƒ¨åˆ†æ–°å¢å†…å®¹éœ€è¦ä½¿ç”¨ add-onæ–¹å¼ï¼Œè¿™é‡Œä»¥ Android ä¸ºä¾‹</p><h3 id="æ·»åŠ åˆ°ç°æœ‰å·¥ç¨‹"><a href="#æ·»åŠ åˆ°ç°æœ‰å·¥ç¨‹" class="headerlink" title="æ·»åŠ åˆ°ç°æœ‰å·¥ç¨‹"></a>æ·»åŠ åˆ°ç°æœ‰å·¥ç¨‹</h3><p>æ¥ä¸Šé¢ <strong>çª—å£é¡¶éƒ¨èœå• Buildâ€“&gt; Build Hap(s)&#x2F;APP(s)â€“&gt;Build APP(s)ã€‚ä¼šåŒæ—¶æ„å»º Android å’Œ iOS äº§ç‰©</strong> ä¹‹åï¼Œå¯¹åº”èµ„æºæ–‡ä»¶å·²ç»å¤åˆ¶åˆ°å¯¹ç›¸åº”æ–‡ä»¶å¤¹äº†ã€‚</p><p>å…ˆå‡†å¤‡ä¸€ä¸ª Android é¡¹ç›®ï¼Œæ³¨æ„ä¸€ä¸ª ArkUI-x è·¨å¹³å°çš„ç‰ˆæœ¬è¦æ±‚ï¼ŒAndroid ç³»ç»Ÿ 8 ä»¥ä¸Šï¼Œåªæ”¯æŒ arm è®¾å¤‡ã€‚</p><p>çœ‹ä¸€ä¸‹ .arkui-x&#x2F;androidçš„ä»£ç ï¼Œå°±ä¸€ä¸ª<strong>ç»§æ‰¿è‡ªStageApplicationçš„MyApplication</strong>å’Œä¸€ä¸ªç»§æ‰¿è‡ª <strong>Activity çš„EntryEntryAbilityActivityï¼Œ</strong> è¯¥ç±»åé€šè¿‡é€šè¿‡moduleåå’Œabilityåæ‹¼æ¥è€Œå¾—ï¼Œä¸€ä¸ªabilityå¯¹åº”ä¸€ä¸ªAndroidå·¥ç¨‹ä¾§çš„Activityç±»ã€‚</p><h4 id="é›†æˆ"><a href="#é›†æˆ" class="headerlink" title="é›†æˆ"></a>é›†æˆ</h4><ol><li>libs ä¸‹é¢çš„ jar åŒ…å’Œso æ–‡ä»¶å¤åˆ¶åˆ° Android å·¥ç¨‹ä¸­ï¼Œæ³¨æ„arkui-x çš„ Android å·¥ç¨‹ä¸­æŒ‡å®šäº†å­˜æ”¾ so æ–‡ä»¶çš„æ–‡ä»¶å¤¹å°±æ˜¯ libsï¼Œå¤åˆ¶åˆ° Android å·¥ç¨‹ä¸­çš„æ—¶å€™åˆ«æ•´é”™äº†</li><li>assetsæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ä¹ŸåŸå°ä¸åŠ¨çš„å¤åˆ¶åˆ° Android å·¥ç¨‹çš„ assets æ–‡ä»¶å¤¹ä¸­</li><li>Android å·¥ç¨‹ä¸­çš„ Applicationæ”¹é€ ï¼Œè¿™é‡Œæä¾›äº†ä¸‰ç§æ–¹å¼<br>  3.1 ç»§æ‰¿StageApplication</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">import</span> ohos.stage.ability.adapter.StageApplication;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HiStageApplication</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">StageApplication</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>   3.2 åœ¨ Application ä¸­ä½¿ç”¨StageApplicationDelegate</p><p>è¿™ä¸ªæ–¹æ³•å’Œ StageApplication æºç ä¸€æ ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplication</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Application</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">StageApplicationDelegate</span> <span class="hljs-variable">appDelegate</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">StageApplication</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">()</span> &#123;<br>        Log.i(<span class="hljs-string">&quot;StageApplication&quot;</span>, <span class="hljs-string">&quot;StageApplication onCreate called&quot;</span>);<br>        <span class="hljs-built_in">super</span>.onCreate();<br>        <span class="hljs-built_in">this</span>.appDelegate = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StageApplicationDelegate</span>();<br>        <span class="hljs-built_in">this</span>.appDelegate.initApplication(<span class="hljs-built_in">this</span>);<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onConfigurationChanged</span><span class="hljs-params">(Configuration newConfig)</span> &#123;<br>        Log.i(<span class="hljs-string">&quot;StageApplication&quot;</span>, <span class="hljs-string">&quot;StageApplication onConfigurationChanged called&quot;</span>);<br>        <span class="hljs-built_in">super</span>.onConfigurationChanged(newConfig);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.appDelegate == <span class="hljs-literal">null</span>) &#123;<br>            Log.e(<span class="hljs-string">&quot;StageApplication&quot;</span>, <span class="hljs-string">&quot;appDelegate is null&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-built_in">this</span>.appDelegate.onConfigurationChanged(newConfig);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>3.3 åœ¨ Activity ä¸­ä½¿ç”¨ StageApplicationDelegat</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> android.app.Activity;<br><span class="hljs-keyword">import</span> ohos.stage.ability.adapter.StageApplicationDelegate;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryEntryAbilityActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> &#123;<br><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">StageApplicationDelegate</span> <span class="hljs-variable">appDelegate_</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        appDelegate_ = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StageApplicationDelegate</span>();<br>        appDelegate_.initApplication(<span class="hljs-built_in">this</span>.getApplication());<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="4"><li>ç”¨äºå±•ç¤ºå†…å®¹çš„ Activity</li></ol><p>ç›´æ¥å¤åˆ¶ä¹Ÿè¡Œï¼Œè‡ªå·±åˆ›å»ºä¸€ä¸ªåŒå Activity æŠŠå†…å®¹å¤åˆ¶è¿‡æ¥ï¼Œæ¸…å•æ–‡ä»¶ä¸­æ³¨å†Œä¸€ä¸‹ä¹Ÿè¡Œã€‚</p><ol><li>åŸç”Ÿæ‹‰èµ· arkui-x è·¨å¹³å°é¡µé¢å¹¶ä¼ å‚</li></ol><p>ä½¿ç”¨åŸç”ŸActivityæ‹‰èµ·Abilityæ—¶ï¼Œéœ€ä½¿ç”¨åŸç”Ÿåº”ç”¨çš„startActivityæ–¹æ³•ï¼Œå‚æ•°çš„ä¼ é€’éœ€è¦é€šè¿‡Intentä¸­çš„putExtra()è¿›è¡Œè®¾ç½®ï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</p><p>keyå€¼ä¸ºparams</p><p>valueä¸ºjsonæ ¼å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>();<br>        intent.setClass(<span class="hljs-built_in">this</span>, EntryEntryAbilityTwoActivity.class);<br>        intent.putExtra(<span class="hljs-string">&quot;params&quot;</span>,<br>                <span class="hljs-string">&quot;&#123;&quot;</span>params<span class="hljs-string">&quot;:[&#123;&quot;</span>key<span class="hljs-string">&quot;:&quot;</span>bool<span class="hljs-string">&quot;,&quot;</span>type<span class="hljs-string">&quot;:1,&quot;</span>value<span class="hljs-string">&quot;:&quot;</span><span class="hljs-literal">true</span><span class="hljs-string">&quot;&#125;,&quot;</span> +<br>                <span class="hljs-string">&quot;&#123;&quot;</span>key<span class="hljs-string">&quot;:&quot;</span><span class="hljs-type">double</span><span class="hljs-string">&quot;,&quot;</span>type<span class="hljs-string">&quot;:9,&quot;</span>value<span class="hljs-string">&quot;:&quot;</span><span class="hljs-number">2.3</span><span class="hljs-string">&quot;&#125;,&quot;</span> +<br>                <span class="hljs-string">&quot;&#123;&quot;</span>key<span class="hljs-string">&quot;:&quot;</span><span class="hljs-type">int</span><span class="hljs-string">&quot;,&quot;</span>type<span class="hljs-string">&quot;:5,&quot;</span>value<span class="hljs-string">&quot;:&quot;</span><span class="hljs-number">2</span><span class="hljs-string">&quot;&#125;,&quot;</span> +<br>                <span class="hljs-string">&quot;&#123;&quot;</span>key<span class="hljs-string">&quot;:&quot;</span>string<span class="hljs-string">&quot;,&quot;</span>type<span class="hljs-string">&quot;:10,&quot;</span>value<span class="hljs-string">&quot;:&quot;</span>test<span class="hljs-string">&quot;&#125;]&#125;&quot;</span>);<br>        startActivity(intent);<br></code></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œé›†æˆå®Œæˆã€‚<br>åœ¨ Android é¡¹ç›®ä¸­è°ƒç”¨ä¸€ä¸‹å°±å¯ä»¥çœ‹åˆ°é¡µé¢äº†</p><h3 id="arkui-x-å’Œ-native-é€šä¿¡"><a href="#arkui-x-å’Œ-native-é€šä¿¡" class="headerlink" title="arkui-x å’Œ native é€šä¿¡"></a>arkui-x å’Œ native é€šä¿¡</h3><p>åŸç”Ÿå’Œè·¨å¹³å°é€šä¿¡æ˜¯éå¸¸é‡è¦çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œä¹Ÿæ˜¯ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ï¼Œå®˜æ–¹ç»™å‡ºäº†æ¡¥æ¥å¹³å° Bridgeï¼Œåœ¨ Androidã€iOS å’Œ arkui-x ä¾§éƒ½æœ‰é…å¥—è¯´æ˜ï¼š</p><blockquote><p>å¹³å°æ¡¥æ¥ç”¨äºå®¢æˆ·ç«¯ï¼ˆArkUIï¼‰å’Œå¹³å°ï¼ˆAndroidæˆ–iOSï¼‰ä¹‹é—´ä¼ é€’æ¶ˆæ¯ï¼Œå³ç”¨äºArkUIä¸å¹³å°åŒå‘æ•°æ®ä¼ é€’ã€ArkUIä¾§è°ƒç”¨å¹³å°çš„æ–¹æ³•ã€å¹³å°è°ƒç”¨ArkUIä¾§çš„æ–¹æ³•ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»Androidå¹³å°ä¸ArkUIäº¤äº’ï¼ŒArkUIä¾§å…·ä½“ç”¨æ³•è¯·å‚è€ƒBridge APIï¼ŒAndroidä¾§å‚è€ƒBridgePluginã€‚  </p></blockquote><p>è¿™é‡Œä¹Ÿç»™å‡ºäº†ä¸€ä¸ª<br><a href="https://gitee.com/arkui-x/docs/blob/master/zh-cn/application-dev/tutorial/how-to-use-bridge-on-android.md#%E5%9C%BA%E6%99%AF%E7%A4%BA%E4%BE%8B">åœºæ™¯ç¤ºä¾‹</a>ï¼Œä½†å¥‡æ€ªçš„æ˜¯ä¸èƒ½æ­£å¸¸è¿è¡Œï¼Œå¤ç°æ­¥éª¤å’Œç°è±¡æ”¾åœ¨è¿™ä¸ª <a href="https://gitee.com/arkui-x/docs/issues/I8YWM2?from=project-issue">issue</a> ä¸­äº†ã€‚ç›®å‰æ˜¯å¾…ç¡®è®¤çŠ¶æ€ã€‚</p><p>åˆ°è¿™é‡Œä¹Ÿæ²¡æœ‰éœ€è¦ç»§ç»­ä¸‹å»çš„ä¸œè¥¿ï¼Œå°±å…ˆå…¥åœŸå§ï¼Œä¸Šé¢è¿™ä¸ªé—®é¢˜æœ‰ç­”æ¡ˆäº†å†æŒ–å‡ºæ¥ç»§ç»­ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
      
      
    <summary type="html">&lt;hr&gt;
&lt;p&gt;2024.01.31 æ›´æ–°&lt;br&gt;ç å®Œäº†&lt;br&gt;&lt;a href=&quot;https://juejin.cn/post/7329310941106421811&quot;&gt;é¸¿è’™ArkUI-X è·¨å¹³å°é€šä¿¡ï¼šä»å…¥åœŸåˆ°å¤æ´»&lt;/a&gt;&lt;br&gt;åœ¨æœ¬æ–‡ä¸­æåˆ°çš„é—®é¢˜åˆé‡æ–°éªŒè¯äº†å‡ æ¬¡ï¼Œå’¨è¯¢äº†ä¸€ä¸‹ç›¸å…³</summary>
      
    
    
    
    
    <category term="HarmonyOS" scheme="https://blog.huangyuanlove.com/tags/HarmonyOS/"/>
    
  </entry>
  
  <entry>
    <title>é¸¿è’™--canvas ç”»æ—¶é’Ÿ</title>
    <link href="https://blog.huangyuanlove.com/2024/03/27/%E9%B8%BF%E8%92%99-canvas-%E7%94%BB%E6%97%B6%E9%92%9F/"/>
    <id>https://blog.huangyuanlove.com/2024/03/27/%E9%B8%BF%E8%92%99-canvas-%E7%94%BB%E6%97%B6%E9%92%9F/</id>
    <published>2024-03-27T03:01:33.000Z</published>
    <updated>2024-03-27T03:10:26.782Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>ä½ åœ¨ Android ä¸Šèƒ½ç”»å‡ºæ¥çš„ä¸œè¥¿ï¼Œåœ¨é¸¿è’™ä¸Šç”»ä¸å‡ºæ¥ï¼Ÿ<br>ç”»ä¸ªæ—¶é’Ÿå˜›ï¼Œæœ‰å•¥éš¾çš„ï¼Ÿ<br>ä½ è¡Œä½ ä¸Šï¼<br>ç»™é’±å°±ä¸Šï¼<br>ç»™é’±ï¼Ÿæ—©è¯´å˜›ï¼Œæ¥æ¥æ¥ï¼Œç°åœ¨å°±ç”»</p><h3 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h3><p>ç”»æ—¶é’Ÿéœ€è¦ç”»å“ªäº›å…ƒç´ ï¼Ÿ<br>åœ†åœˆã€ç›´çº¿ï¼Œæ²¡äº†ï¼Œå°±è¿™äº›ï¼Œä¸´æ—¶çœ‹ä¸€ä¸‹canvas ç›¸å…³çš„ apiï¼Œè¿™ä¸éƒ½æœ‰ä¹ˆï¼Ÿç›´æ¥ç”»ã€‚<br>çœ‹çœ‹éœ€è¦ç”¨çš„æ–¹æ³•  </p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-title function_">arc</span>(<span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">radius</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">startAngle</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">endAngle</span>: <span class="hljs-built_in">number</span>, counterclockwise?: <span class="hljs-built_in">boolean</span>): <span class="hljs-built_in">void</span><br></code></pre></td></tr></table></figure><p>çœ‹ä¸‹å‚æ•°å«ä¹‰</p><table><thead><tr><th align="left">å‚æ•°</th><th align="left">ç±»å‹</th><th align="left">å¿…å¡«</th><th align="left">é»˜è®¤å€¼</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">x</td><td align="left">number</td><td align="left">æ˜¯</td><td align="left">0</td><td align="left">å¼§çº¿åœ†å¿ƒçš„xåæ ‡å€¼ã€‚</td></tr><tr><td align="left">y</td><td align="left">number</td><td align="left">æ˜¯</td><td align="left">0</td><td align="left">å¼§çº¿åœ†å¿ƒçš„yåæ ‡å€¼ã€‚</td></tr><tr><td align="left">radius</td><td align="left">number</td><td align="left">æ˜¯</td><td align="left">0</td><td align="left">å¼§çº¿çš„åœ†åŠå¾„ã€‚</td></tr><tr><td align="left">startAngle</td><td align="left">number</td><td align="left">æ˜¯</td><td align="left">0</td><td align="left">å¼§çº¿çš„èµ·å§‹å¼§åº¦ã€‚</td></tr><tr><td align="left">endAngle</td><td align="left">number</td><td align="left">æ˜¯</td><td align="left">0</td><td align="left">å¼§çº¿çš„ç»ˆæ­¢å¼§åº¦ã€‚</td></tr><tr><td align="left">counterclockwise</td><td align="left">boolean</td><td align="left">å¦</td><td align="left">false</td><td align="left">æ˜¯å¦é€†æ—¶é’ˆç»˜åˆ¶åœ†å¼§ã€‚</td></tr></tbody></table><p>å¼§åº¦åˆ¶ï¼Œä¸€åœˆæ˜¯ 2Ï€ï¼Œè¿™ä¸ªéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œè¿˜æœ‰endAngleï¼Œæ˜¯ç»ˆæ­¢å¼§åº¦ï¼Œè€Œä¸æ˜¯éœ€è¦ç”»å¤šå°‘å¼§åº¦ï¼Œæµ…æµ…çš„å°è¯•ã€‚  </p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><br>struct <span class="hljs-title class_">ClockViewTest</span> &#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">settings</span>: <span class="hljs-title class_">RenderingContextSettings</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderingContextSettings</span>(<span class="hljs-literal">true</span>)<br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">canvasRendering</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasRenderingContext2D</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>)<br><br>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">&quot;100%&quot;</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">&quot;100%&quot;</span>)<br>      .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> &#123;<br><br>        <span class="hljs-keyword">let</span> width = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">width</span><br>        <span class="hljs-keyword">let</span> height = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">height</span><br><br>        <span class="hljs-keyword">let</span> centerX = width / <span class="hljs-number">2</span><br>        <span class="hljs-keyword">let</span> centerY = height / <span class="hljs-number">2</span><br>        <span class="hljs-comment">//å–é•¿å®½ä¸­å°çš„ä¸€ä¸ªåšç›´å¾„</span><br>        <span class="hljs-keyword">let</span> maxRadius = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(width, height) / <span class="hljs-number">2</span><br><br>        <span class="hljs-comment">//è®¾ç½®çº¿çš„ç²—ç»†</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">4</span><br><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">arc</span>(centerX, centerY, maxRadius-<span class="hljs-number">50</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">false</span>)<br>        <span class="hljs-comment">//è®¾ç½®çº¿çš„é¢œè‰²</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">&quot;#ff0000&quot;</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">stroke</span>()<br><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">beginPath</span>()<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">arc</span>(centerX, centerY, maxRadius - <span class="hljs-number">30</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>)<br>        <span class="hljs-comment">//è®¾ç½®çº¿çš„é¢œè‰²</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">&quot;#00ff00&quot;</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">stroke</span>()<br><br>      &#125;)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ•ˆæœæ˜¯è¿™æ ·çš„ï¼š  </p><p><img src="/image/HarmonyOS/canvas_circle.png" alt="image.png"><br>ç”»ç›´çº¿å°±ä¸ç”¨å¤šè¯´äº†ï¼Œå¼€å¹²~~  </p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="ç»„æˆéƒ¨åˆ†"><a href="#ç»„æˆéƒ¨åˆ†" class="headerlink" title="ç»„æˆéƒ¨åˆ†"></a>ç»„æˆéƒ¨åˆ†</h4><p>æŒ‡é’ˆæ˜¯éœ€è¦æ ¹æ®æ—¶é—´å˜åŒ–æ¥è½¬åŠ¨çš„ï¼Œè¡¨ç›˜ç”»å¥½ä¸€æ¬¡å°±ä¸éœ€è¦é‡ç»˜äº†ï¼Œå·ä¸ªæ‡’ï¼Œæä¸¤ä¸ª canvas æ‘èµ·æ¥ï¼Œåº•å±‚ç”»è¡¨ç›˜ï¼Œä¸Šå±‚ç”»æŒ‡é’ˆï¼Œæ—¶é—´å˜äº†åªé‡ç”»ä¸Šå±‚æŒ‡é’ˆå°±è¡Œäº†ã€‚  </p><h4 id="æ•°å€¼è®¡ç®—"><a href="#æ•°å€¼è®¡ç®—" class="headerlink" title="æ•°å€¼è®¡ç®—"></a>æ•°å€¼è®¡ç®—</h4><p>ç®€å•çš„ä¸‰è§’å‡½æ•°ï¼Œä½†è¦æ³¨æ„æ˜¯å¼§åº¦åˆ¶ï¼Œæ•°å€¼åˆ«æé”™äº†ã€‚<br>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ç”»å¸ƒå·¦ä¸Šè§’åæ ‡æ˜¯(0,0)ï¼Œå³ä¸‹è§’åæ ‡ä¸º(width,height)ã€‚  </p><h4 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h4><ol><li>å…ˆç”»ä¸€å¤§ä¸€å°ä¸¤ä¸ªåœ†åœˆç»„æˆä¸€ä¸ªåœ†ç¯ã€‚  </li><li>å†åˆ’çº¿æŠŠåœ†ç¯å‡åˆ† 60 ä»½ï¼Œæ¯ 5 æ¡çº¿åŠ ç²—ä¸€ä¸‹ã€‚  </li><li>å†æŠŠåœ†å‘¨åˆ†æˆ 12 ä»½ï¼Œå¯¹åº”ä½ç½®ç”»ä¸Š1~12 æ•°å­—ã€‚  </li><li>è·å–å½“å‰æ—¶é—´ï¼Œè®¡ç®—å‡ºæŒ‡é’ˆä½ç½®ï¼Œåˆ’çº¿ã€‚  </li><li>å®šæ—¶æ›´æ–°æŒ‡é’ˆä½ç½®ã€‚  </li><li>ç»“æŸã€‚</li></ol><h3 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h3><h4 id="ç¬¬ä¸€æ­¥-ç”»åœ†ç¯"><a href="#ç¬¬ä¸€æ­¥-ç”»åœ†ç¯" class="headerlink" title="ç¬¬ä¸€æ­¥ ç”»åœ†ç¯"></a>ç¬¬ä¸€æ­¥ ç”»åœ†ç¯</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">&quot;100%&quot;</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">&quot;100%&quot;</span>)<br>  .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> &#123;<br><br>    <span class="hljs-keyword">let</span> width = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">width</span><br>    <span class="hljs-keyword">let</span> height = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">height</span><br><br>    <span class="hljs-keyword">let</span> centerX = width / <span class="hljs-number">2</span><br>    <span class="hljs-keyword">let</span> centerY = height / <span class="hljs-number">2</span><br>    <span class="hljs-comment">//å–é•¿å®½ä¸­å°çš„ä¸€ä¸ªåšç›´å¾„</span><br>    <span class="hljs-keyword">let</span> maxRadius = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(centerX, centerY)<br><br>    <span class="hljs-comment">//ç•™ä¸€äº›å¤–è¾¹è·</span><br>    <span class="hljs-keyword">let</span> outerCircleRadius = maxRadius - <span class="hljs-number">20</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">&quot;#1b91e0&quot;</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">2</span><br>    <span class="hljs-comment">//æœ€ä¸­é—´çš„å°åœˆåœˆ</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">arc</span>(centerX, centerY, <span class="hljs-number">10</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">false</span>)<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">stroke</span>()<br><br>    <span class="hljs-comment">//ç”»å†…åœˆ</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">beginPath</span>()<br>    <span class="hljs-keyword">let</span> innerCircleRadius = outerCircleRadius -<span class="hljs-number">20</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">arc</span>(centerX, centerY, innerCircleRadius, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">false</span>)<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">stroke</span>()<br><br>    <span class="hljs-comment">//ç”»å¤–åœˆ</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">beginPath</span>()<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">arc</span>(centerX, centerY, outerCircleRadius, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">false</span>);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">stroke</span>()<br>    <br>  &#125;)<br></code></pre></td></tr></table></figure><p>æ•ˆæœå›¾  </p><p><img src="/image/HarmonyOS/canvas_ring.png" alt="image.png"></p><p>çœ‹ç€è¿˜è¡Œï¼Œé¢œè‰²å’Œç²—ç»†å¤§å®¶è‡ªå·±è°ƒã€‚</p><h4 id="ç¬¬äºŒæ­¥-ç”»æ ¼å­"><a href="#ç¬¬äºŒæ­¥-ç”»æ ¼å­" class="headerlink" title="ç¬¬äºŒæ­¥ ç”»æ ¼å­"></a>ç¬¬äºŒæ­¥ ç”»æ ¼å­</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-comment">//ç”» 60 ä¸ªæ ¼å­ï¼Œ5 çš„å€æ•°åˆ™çº¿æ¡ç²—ä¸€äº›</span><br><span class="hljs-keyword">let</span> perMinuteDegree = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span> / <span class="hljs-number">60</span><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>;i &lt;= <span class="hljs-number">60</span>; i++) &#123;<br>  <span class="hljs-comment">//ç»“æŸåæ ‡ï¼Œä¹Ÿå°±æ˜¯åœ¨å¤–åœ†ä¸Šçš„ç‚¹</span><br>  <span class="hljs-keyword">let</span> endX = centerX + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(i * perMinuteDegree) * outerCircleRadius<br>  <span class="hljs-keyword">let</span> endY = centerY + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(i * perMinuteDegree + <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>) * outerCircleRadius<br>  <span class="hljs-comment">//èµ·å§‹åæ ‡ï¼Œä¹Ÿå°±æ˜¯åœ¨å†…åœ†ä¸Šçš„ç‚¹</span><br>  <span class="hljs-keyword">let</span> startX = centerX + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(i * perMinuteDegree) * innerCircleRadius<br>  <span class="hljs-keyword">let</span> startY = centerY + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(i * perMinuteDegree + <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>) * innerCircleRadius<br><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">&quot;#000000&quot;</span><br>  <span class="hljs-keyword">let</span> path2D = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path2D</span>()<br>  path2D.<span class="hljs-title function_">moveTo</span>(startX, startY)<br>  path2D.<span class="hljs-title function_">lineTo</span>(endX, endY)<br>  <span class="hljs-keyword">if</span> (i % <span class="hljs-number">5</span> == <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">6</span><br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">2</span><br>  &#125;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">stroke</span>(path2D)<br>&#125;<br></code></pre></td></tr></table></figure><p>æ•ˆæœå›¾  </p><p><img src="/image/HarmonyOS/canvas_ring_clock.png" alt="image.png"><br>é©¬é©¬è™è™ï¼Œä¸å¤ªå¥½çœ‹ã€‚<br>è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œç”»å¸ƒæ˜¯ä»¥å‚ç›´å‘ä¸‹ä¸º Y è½´çš„æ­£æ–¹å‘ï¼Œè®¡ç®—æ—¶åŠ äº† <code>Math.PI</code> å¼§åº¦çº æ­£ä¸€ä¸‹  </p><h4 id="ç¬¬ä¸‰æ­¥-ç”»æ•°å­—"><a href="#ç¬¬ä¸‰æ­¥-ç”»æ•°å­—" class="headerlink" title="ç¬¬ä¸‰æ­¥ ç”»æ•°å­—"></a>ç¬¬ä¸‰æ­¥ ç”»æ•°å­—</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-comment">//ç”» 1~12 æ•°å­—åœ†å½¢åˆ†å¸ƒ</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">font</span> = <span class="hljs-string">&quot;40px&quot;</span><br><span class="hljs-keyword">let</span> perNumberDegree = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span> / <span class="hljs-number">12</span><br><span class="hljs-keyword">let</span> numberRadius = outerCircleRadius - <span class="hljs-number">40</span><br><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>;i &lt;= <span class="hljs-number">12</span>; i++) &#123;<br>  <span class="hljs-keyword">let</span> x = centerX + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(i * perNumberDegree) * numberRadius<br>  <span class="hljs-keyword">let</span> y = centerY + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(i * perNumberDegree + <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>) * numberRadius<br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span> = i + <span class="hljs-string">&quot;&quot;</span><br><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">&quot;#000000&quot;</span><br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">textMetrics</span>: <span class="hljs-title class_">TextMetrics</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">measureText</span>(text)<br>  <span class="hljs-comment">//å¡«å……æ–‡å­—æ—¶ï¼Œä¼ å…¥çš„åæ ‡æ˜¯æ–‡å­—çš„å·¦ä¸‹è§’åæ ‡</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">fillText</span>(text, x-textMetrics.<span class="hljs-property">width</span>/<span class="hljs-number">2</span> , y+textMetrics.<span class="hljs-property">height</span>/<span class="hljs-number">2</span>)<br>  <span class="hljs-comment">//æŠŠä¸‹é¢è¿™ä¸¤è¡Œæ³¨é‡Šæ‰å°±æ²¡æœ‰å°æ–¹å—äº†</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">&quot;#aaff6134&quot;</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">fillRect</span>(x,y,textMetrics.<span class="hljs-property">width</span>,textMetrics.<span class="hljs-property">height</span>)<br><br>&#125;<br></code></pre></td></tr></table></figure><p>æ•ˆæœå›¾</p><p><img src="/image/HarmonyOS/canvas_ring_clock_number.png" alt="image.png"><br>å›¾ä¸Šçš„æ–¹å—æ˜¯ä¸ºäº†å¯¹æ¯”ç”»æ–‡å­—å’Œç”»æ–¹å—çš„åæ ‡åŒºåˆ«å±•ç¤ºå‡ºæ¥çš„ï¼šå¡«å……æ–‡å­—æ—¶ä¼ å…¥çš„åæ ‡æ˜¯<code>æ–‡å­—å·¦ä¸‹è§’çš„åæ ‡</code>ï¼Œè€Œç”»æ–¹å—æ—¶æ˜¯ä¼ å…¥çš„<code>æ–¹å—å·¦ä¸Šè§’åæ ‡</code>,è¿™é‡Œæ³¨æ„ä¸€ä¸‹å°±å¥½äº†ï¼Œä»£ç ä¸­æµ‹é‡äº†ä¸€ä¸‹æ–‡å­—å®½é«˜ï¼Œç²—æš´çš„åšäº†ä¸€ä¸‹çº åã€‚  </p><h4 id="ç¬¬å››ã€äº”æ­¥-ç”»æŒ‡é’ˆ-amp-å®šæ—¶æ›´æ–°"><a href="#ç¬¬å››ã€äº”æ­¥-ç”»æŒ‡é’ˆ-amp-å®šæ—¶æ›´æ–°" class="headerlink" title="ç¬¬å››ã€äº”æ­¥ ç”»æŒ‡é’ˆ&amp;å®šæ—¶æ›´æ–°"></a>ç¬¬å››ã€äº”æ­¥ ç”»æŒ‡é’ˆ&amp;å®šæ—¶æ›´æ–°</h4><p>ä¸Šé¢ä¹Ÿè¯´è¦æŠŠæŒ‡é’ˆç”»åœ¨å¦å¤–ä¸€ä¸ª <code>canvas</code> ä¸Šï¼Œå‡å°‘ä¸€ä¸‹ç»˜åˆ¶æ—¶çš„å†…å®¹ï¼Œæ²¡åšå¯¹æ¯”ï¼Œä¹Ÿä¸çŸ¥é“æœ‰æ²¡æœ‰ä½œç”¨ã€‚<br>å‡†å¤‡å¦å¤–ä¸ªç”»å¸ƒï¼ŒæŠŠä¸¤ä¸ªç”»å¸ƒç”¨ <code>Stack</code> åŒ…ä¸€ä¸‹ã€‚  </p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRenderingClock</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">&quot;100%&quot;</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">&quot;100%&quot;</span>).<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">timer</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-attr">date</span>: <span class="hljs-title class_">Date</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">minute</span> = date.<span class="hljs-title function_">getMinutes</span>()<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hour</span> = date.<span class="hljs-title function_">getHours</span>()<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">second</span> = date.<span class="hljs-title function_">getSeconds</span>()<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">draw</span>()<br>  &#125;.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), <span class="hljs-number">500</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æŠŠç¬¬ä¸€å—ä»£ç ä¸­çš„ <code>innerCircleRadius</code> å˜é‡æåˆ°å¤–éƒ¨ï¼Œä½œä¸ºç±»æˆå‘˜ä¸¤ä¸ªç”»å¸ƒå…±ç”¨ä¸€ä¸‹ï¼Œä¸»è¦æ˜¯è®¡ç®—æŒ‡é’ˆç»ˆç‚¹åæ ‡ç”¨çš„ã€‚<code>centerX</code> å’Œ <code>centerY</code> æ— æ‰€è°“ï¼Œåªè¦ä¸¤ä¸ªç”»å¸ƒå¯¹é½äº†ï¼Œç”¨å“ªä¸ªéƒ½è¡Œï¼Œè¿™é‡Œè¿˜æ˜¯æåˆ°äº†å¤–éƒ¨ï¼Œç”¨çš„ç¬¬ä¸€å—ç”»å¸ƒçš„ã€‚  </p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-keyword">private</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) &#123;<br>  æ¸…ç©ºä¸€ä¸‹ç”»å¸ƒ<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRenderingClock</span>.<span class="hljs-title function_">clearRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerX</span> * <span class="hljs-number">2</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerY</span> * <span class="hljs-number">2</span>)<br><br>  <span class="hljs-comment">//ç”»ç§’é’ˆ</span><br>  <span class="hljs-comment">//è®¡ç®—ç§’é’ˆçš„è§’åº¦</span><br>  <span class="hljs-keyword">let</span> secondDegree = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span> / <span class="hljs-number">60</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">second</span><br>  <span class="hljs-keyword">let</span> secondStartX = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerX</span><br>  <span class="hljs-keyword">let</span> secondStartY = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerY</span><br>  <span class="hljs-keyword">let</span> secondEndX = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerX</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(secondDegree) * <span class="hljs-variable language_">this</span>.<span class="hljs-property">innerCircleRadius</span><br>  <span class="hljs-keyword">let</span> secondEndY = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerY</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(secondDegree + <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>) * <span class="hljs-variable language_">this</span>.<span class="hljs-property">innerCircleRadius</span><br>  <span class="hljs-keyword">let</span> secondPath = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path2D</span>()<br>  secondPath.<span class="hljs-title function_">moveTo</span>(secondStartX, secondStartY)<br>  secondPath.<span class="hljs-title function_">lineTo</span>(secondEndX, secondEndY)<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRenderingClock</span>.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">2</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRenderingClock</span>.<span class="hljs-title function_">stroke</span>(secondPath)<br><br><br>  <span class="hljs-comment">//ç”»åˆ†é’ˆ é¢œè‰²å¼„ç‚¹é€æ˜åº¦ï¼Œè¦ä¸ç„¶é‡åˆçš„æ—¶å€™çœ‹ä¸æ¸…æ¥š</span><br>  <span class="hljs-comment">//ç§’é’ˆèµ°ä¸€åœˆï¼Œåˆ†é’ˆèµ°ä¸€æ ¼ï¼Œå…¶å®å¯ä»¥å¿½ç•¥ä¸è®¡</span><br>  <span class="hljs-keyword">let</span> minuteDegree = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span> / <span class="hljs-number">60</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">minute</span><br>  <span class="hljs-keyword">let</span> minuteStartX = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerX</span><br>  <span class="hljs-keyword">let</span> minuteStartY = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerY</span><br>  <span class="hljs-keyword">let</span> minuteEndX = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerX</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(minuteDegree) * (<span class="hljs-variable language_">this</span>.<span class="hljs-property">innerCircleRadius</span> / <span class="hljs-number">5</span> * <span class="hljs-number">4</span>)<br>  <span class="hljs-keyword">let</span> minuteEndY = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerY</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(minuteDegree + <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>) * (<span class="hljs-variable language_">this</span>.<span class="hljs-property">innerCircleRadius</span> / <span class="hljs-number">5</span> * <span class="hljs-number">4</span>)<br>  <span class="hljs-keyword">let</span> minutePath = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path2D</span>()<br>  minutePath.<span class="hljs-title function_">moveTo</span>(minuteStartX, minuteStartY)<br>  minutePath.<span class="hljs-title function_">lineTo</span>(minuteEndX, minuteEndY)<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRenderingClock</span>.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">&quot;#aa1b91e0&quot;</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRenderingClock</span>.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">4</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRenderingClock</span>.<span class="hljs-title function_">stroke</span>(minutePath)<br><br>  <span class="hljs-comment">//ç”»æ—¶é’ˆ</span><br>  <span class="hljs-comment">//åˆ†é’ˆèµ°ä¸€åœˆï¼Œæ—¶é’ˆèµ° 5 å°æ ¼</span><br>  <span class="hljs-keyword">let</span> hourDegree = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span> / <span class="hljs-number">12</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">hour</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">minute</span> / <span class="hljs-number">60</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span> / <span class="hljs-number">12</span><br>  <span class="hljs-keyword">let</span> hourStartX = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerX</span><br>  <span class="hljs-keyword">let</span> hourStartY = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerY</span><br>  <span class="hljs-keyword">let</span> hourEndX = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerX</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(hourDegree) * (<span class="hljs-variable language_">this</span>.<span class="hljs-property">innerCircleRadius</span> / <span class="hljs-number">4</span> * <span class="hljs-number">3</span>)<br>  <span class="hljs-keyword">let</span> hourEndY = <span class="hljs-variable language_">this</span>.<span class="hljs-property">centerY</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(hourDegree + <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>) * (<span class="hljs-variable language_">this</span>.<span class="hljs-property">innerCircleRadius</span> / <span class="hljs-number">4</span> * <span class="hljs-number">3</span>)<br>  <span class="hljs-keyword">let</span> hourPath = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path2D</span>()<br>  hourPath.<span class="hljs-title function_">moveTo</span>(hourStartX, hourStartY)<br>  hourPath.<span class="hljs-title function_">lineTo</span>(hourEndX, hourEndY)<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRenderingClock</span>.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">6</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRenderingClock</span>.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">&quot;#aa39d167&quot;</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRenderingClock</span>.<span class="hljs-title function_">stroke</span>(hourPath)<br>&#125;<br></code></pre></td></tr></table></figure><p>è®¡ç®—æŒ‡é’ˆè§’åº¦çš„æ—¶å€™ä¹Ÿå·æ‡’äº†ï¼Œæ—¶é’ˆåªè€ƒè™‘äº†å½“å‰åˆ†é’Ÿæ•°ï¼Œæ²¡æœ‰è€ƒè™‘ç§’æ•°ï¼Œå®é™…å·®ä¸å¤šï¼Œå…ˆè¿™æ ·å§ã€‚  </p><h4 id="æœ€åä¸€æ­¥"><a href="#æœ€åä¸€æ­¥" class="headerlink" title="æœ€åä¸€æ­¥"></a>æœ€åä¸€æ­¥</h4><p>æ•ˆæœå›¾</p><p><img src="/image/HarmonyOS/canvas_clock_finish.png" alt="image.png"><br>å°±å…ˆè¿™æ ·å§ï¼Œå‹‰å‹‰å¼ºå¼ºï¼Œå¯ä»¥è‡ªå·±è°ƒè°ƒé¢œè‰²ï¼Œè°ƒè°ƒæ ·å¼ï¼Œæˆ–è€…æä¸€äº›å›¾ç‰‡æ¥ä»£æ›¿è¿™äº›å…ƒç´ ä¹Ÿè¡Œã€‚  </p><p>æºç åœ¨è¿™é‡Œ <a href="https://github.com/huangyuanlove/HelloArkUI/blob/main/entry/src/main/ets/pages/playground/AlarmClockPage.ets">github</a> ,<br><a href="https://gitee.com/huangyuan/HelloArkUI/blob/main/entry/src/main/ets/pages/playground/AlarmClockPage.ets">gitee</a></p><p>ä»“åº“åœ°å€ï¼š<a href="https://github.com/huangyuanlove/HelloArkUI">https://github.com/huangyuanlove/HelloArkUI</a>  </p><p><a href="https://gitee.com/huangyuan/HelloArkUI">https://gitee.com/huangyuan/HelloArkUI</a></p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;ä½ åœ¨ Android ä¸Šèƒ½ç”»å‡ºæ¥çš„ä¸œè¥¿ï¼Œåœ¨é¸¿è’™ä¸Šç”»ä¸å‡ºæ¥ï¼Ÿ&lt;br&gt;ç”»ä¸ªæ—¶é’Ÿå˜›ï¼Œæœ‰å•¥éš¾çš„ï¼Ÿ&lt;br&gt;ä½ è¡Œä½ ä¸Šï¼&lt;br&gt;ç»™é’±å°±ä¸Šï¼&lt;br&gt;ç»™é’±ï¼Ÿæ—©</summary>
      
    
    
    
    
    <category term="HarmonyOS" scheme="https://blog.huangyuanlove.com/tags/HarmonyOS/"/>
    
  </entry>
  
  <entry>
    <title>é¸¿è’™--canvas å®ç°æ³¢æµªæ•ˆæœ</title>
    <link href="https://blog.huangyuanlove.com/2024/03/27/%E9%B8%BF%E8%92%99-canvas-%E5%AE%9E%E7%8E%B0%E6%B3%A2%E6%B5%AA%E6%95%88%E6%9E%9C/"/>
    <id>https://blog.huangyuanlove.com/2024/03/27/%E9%B8%BF%E8%92%99-canvas-%E5%AE%9E%E7%8E%B0%E6%B3%A2%E6%B5%AA%E6%95%88%E6%9E%9C/</id>
    <published>2024-03-27T02:44:55.000Z</published>
    <updated>2024-03-27T02:53:17.246Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>Android ä¸­ canvas èƒ½ç”»å‡ºæ¥çš„ä¸œè¥¿é¸¿è’™çš„ canvas è¿˜ç”»ä¸äº†ï¼Œä¸å¤§å¯èƒ½å§ï¼Ÿæœ‰ä¸ªæœ‹å‹é—®é¸¿è’™åº”ç”¨ä¸­æƒ³å®ç°æ³¢æµªæ•ˆæœï¼Œåº”è¯¥å’‹ç”»ï¼Ÿè¿™ä¸ªé—®é¢˜ï¼Œä½ èƒ½åœ¨ Android ä¸Šç”¨ canvas ç”»å‡ºæ¥ï¼Œåœ¨é¸¿è’™é‡Œé¢ç”¨ canvas ç”»ä¸å‡ºæ¥ï¼Ÿè¿˜æ˜¯ api ä¸ç†Ÿæ‚‰å§ï¼Ÿ</p><h3 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h3><p>æ³¢æµªæ•ˆæœå˜›ï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯æ­£å¼¦ã€ä½™å¼¦å‡½æ•°ã€è´å¡å°”æ›²çº¿ï¼Œè¿˜æœ‰ä¸€ä¸ªå‚…é‡Œå¶å˜æ¢ï¼Œä¸è¿‡è¿™ä¸ªæœ‰ç‚¹æä¸å®šã€‚è¿™é‡Œé€‰æ‹©ä½¿ç”¨è´å¡å°”æ›²çº¿ï¼Œå› ä¸ºä¹‹å‰åœ¨ Android ä¸­ç”»è¿‡ï¼Œåº”è¯¥å¯ä»¥å¾ˆä¸æ»‘çš„è¿ç§»è¿‡æ¥<br>å…ˆå¤ä¹ ä¸€ä¸‹åœ¨ Android ä¸­æ€ä¹ˆå®ç°ï¼š<a href="https://blog.huangyuanlove.com/2019/01/20/%E8%87%AA%E5%AE%9A%E4%B9%89View-%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF%E3%80%81Shader/">https://blog.huangyuanlove.com/2019/01/20/%E8%87%AA%E5%AE%9A%E4%B9%89View-%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF%E3%80%81Shader/</a></p><p>ç¡®è®¤èµ·å§‹ç‚¹ï¼Œç¡®è®¤ç»ˆç‚¹ï¼Œè®¡ç®—æ§åˆ¶ç‚¹ï¼Œç„¶åè°ƒç”¨ api åˆ’çº¿ï¼Œæœ€åå¡«å……ä¸€ä¸‹å°±å¥½äº†ã€‚<br>æ€ä¹ˆåŠ¨èµ·æ¥ï¼ŸAndroid è¿™è¾¹ç”¨çš„åŠ¨ç”»ï¼Œå…¶å®ç”¨ handler æˆ–è€…å…¶ä»–ä¸œè¥¿æä¸ªå®šæ—¶æ›´æ–°ä¹Ÿè¡Œã€‚<br>å…ˆçœ‹æ•ˆæœå›¾<br><img src="/image/HarmonyOS/wave.gif" alt="wave.gif">  </p><p>çœ‹ä¸‹é¸¿è’™å¯¹åº”çš„ apiï¼Œç›®å‰å¼€æ”¾çš„æœ€æ–°çš„HarmonyOSæ–‡æ¡£æ˜¯ 3.1&#x2F;4.0çš„ï¼Œå¯¹åº”åœ°å€æ˜¯è¿™ä¸ª <a href="https://developer.harmonyos.com/cn/docs/documentation/doc-references-V3/ts-canvasrenderingcontext2d-0000001478181441-V3#ZH-CN_TOPIC_0000001573928937__quadraticcurveto">https://developer.harmonyos.com/cn/docs/documentation/doc-references-V3/ts-canvasrenderingcontext2d-0000001478181441-V3#ZH-CN_TOPIC_0000001573928937__quadraticcurveto</a><br>ç›®å‰å¼€æ”¾çš„æœ€æ–°çš„ OpenHarmony æ–‡æ¡£æ˜¯4.0 çš„ï¼Œå¯¹åº”åœ°å€åœ¨è¿™é‡Œ <a href="https://docs.openharmony.cn/pages/v4.0/zh-cn/application-dev/ui/arkts-drawing-customization-on-canvas.md/#%E7%94%BB%E5%B8%83%E7%BB%84%E4%BB%B6%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95">https://docs.openharmony.cn/pages/v4.0/zh-cn/application-dev/ui/arkts-drawing-customization-on-canvas.md/#%E7%94%BB%E5%B8%83%E7%BB%84%E4%BB%B6%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95</a><br>æ­¥éª¤éƒ½å·®ä¸å¤šï¼Œåªä¸è¿‡é¸¿è’™ä¸­æ²¡æœ‰ç”»ç¬”çš„æ¦‚å¿µï¼Œéœ€è¦å¯¹<code>CanvasRenderingContext2D</code>å¯¹è±¡è¿›è¡Œæ“ä½œè®¾ç½®ï¼ŒåŒ…æ‹¬è®¾ç½®çº¿æ¡é¢œè‰²ã€çº¿æ¡å®½åº¦ã€å›¾å‹å¡«å……é¢œè‰²ç­‰ã€‚<br>æƒ³è¦ç”»çº¿ã€ç”»å‡ºå„ç§å½¢çŠ¶ï¼Œå¯ä»¥ç›´æ¥æ“ä½œ<code>CanvasRenderingContext2D</code>å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥åˆ›å»º<code>Path2D</code>å¯¹è±¡è¿›è¡Œæ“ä½œã€‚å…¶ä½™ api å¯ä»¥æŸ¥çœ‹å¯¹åº”çš„æ–‡æ¡£ã€‚  </p><h3 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h3><p>è¿™è¿˜æœ‰å•¥å¥½è®¾è®¡çš„ï¼Œç›´æ¥<del>æŠ„</del>ç§»æ¤ Android ä¸Šé¢çš„å®ç°å°±å¥½äº†<br>ç”±äºéœ€è¦åŠ¨èµ·æ¥ï¼Œä¸ºäº†é¿å…ç§»åŠ¨åå·¦å³æœ‰ç©ºç™½ï¼Œè¿™é‡Œéœ€è¦<strong>å¤šç”»ä¸€ä¸ªæ³¢æµª</strong></p><p><img src="/image/HarmonyOS/wave.png" alt="WX20240108-233545@2x.png">  </p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦ä¸Šé¢è¿™æ¡è“è‰²çš„çº¿ï¼Œè€Œä¸æ˜¯ä¸‹é¢è¿™æ¡ç»¿è‰²çš„ã€‚</p><p>åœ¨ Android ä¸­ç”»äºŒé˜¶è´å¡å°”æ›²çº¿æœ‰ä¸¤ä¸ª api,ä¸€ä¸ªæ˜¯<br><code>public void rQuadTo(float dx1, float dy1, float dx2, float dy2)</code><br>è¿™ä¸ªè¡¨ç¤ºçš„æ˜¯æ§åˆ¶ç‚¹å’Œç»ˆç‚¹ç›¸å¯¹äºä¸Šä¸€ä¸ªæ§åˆ¶ç‚¹å’Œç»ˆç‚¹çš„åç§»é‡<br>å¦å¤–ä¸€ä¸ªæ˜¯<br><code>public void quadTo(float x1, float y1, float x2, float y2)</code><br>è¿™ä¸ªè¡¨ç¤ºæ˜¯æ§åˆ¶ç‚¹å’Œç»ˆç‚¹çš„ç»å¯¹åæ ‡å€¼<br>ä½†åœ¨é¸¿è’™ä¸­æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ apiï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±è®¡ç®—ä¸€ä¸‹ï¼šè¿™é‡Œçš„æ§åˆ¶ç‚¹çš„æ¨ªåæ ‡æ˜¯èµ·ç‚¹å’Œç»ˆç‚¹çš„ä¸­é—´å€¼ï¼Œæ§åˆ¶ç‚¹çš„çºµåæ ‡å–çš„æ˜¯æ³¢æµªé«˜åº¦<br>æ‰€ä»¥ä¸Šé¢ä¸¤æ¡çº¿çš„ç”»æ³•æ˜¯è¿™æ ·çš„</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">&quot;100%&quot;</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">&quot;30%&quot;</span>)<br>        .<span class="hljs-title function_">onAreaChange</span>(<span class="hljs-function">(<span class="hljs-params">oldValue,newValue</span>)=&gt;</span>&#123;<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">&quot;#39d167&quot;</span><br><br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">&quot;#39d167&quot;</span><br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">10</span><br>          <span class="hljs-keyword">let</span> canvasWidth = <span class="hljs-built_in">parseInt</span>(newValue.<span class="hljs-property">width</span>.<span class="hljs-title function_">toString</span>())<br>          <span class="hljs-keyword">let</span> canvasHeight = <span class="hljs-built_in">parseInt</span>(newValue.<span class="hljs-property">height</span>.<span class="hljs-title function_">toString</span>())<br><br>          <span class="hljs-keyword">let</span> waveWidth = canvasWidth/<span class="hljs-number">2</span><br>          <span class="hljs-keyword">let</span> waveHeight = <span class="hljs-number">100</span><br>          <span class="hljs-keyword">let</span> baseHeight =canvasHeight<br><br>          <span class="hljs-keyword">let</span> <span class="hljs-attr">path</span>:<span class="hljs-title class_">Path2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path2D</span>()<br>          <br>          path.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">0</span>,baseHeight)<br>          <span class="hljs-comment">//æ³¢æµªå®½åº¦æ˜¯ç”»å¸ƒçš„ä¸€åŠï¼Œè¿™é‡Œå·æ‡’ç›´æ¥å†™äº†</span><br>          path.<span class="hljs-title function_">quadraticCurveTo</span>( waveWidth/<span class="hljs-number">2</span>,baseHeight-waveHeight ,waveWidth,baseHeight)<br>          path.<span class="hljs-title function_">quadraticCurveTo</span>(waveWidth+waveWidth/<span class="hljs-number">2</span>,  baseHeight-waveHeight ,canvasWidth,baseHeight)<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">stroke</span>(path)<br><br><br>          path = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path2D</span>()<br>          baseHeight /=<span class="hljs-number">3</span><br>          path.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">0</span>,baseHeight)<br>          <span class="hljs-comment">//æ³¢æµªå®½åº¦æ˜¯ç”»å¸ƒçš„ä¸€åŠï¼Œè¿™é‡Œå·æ‡’ç›´æ¥å†™äº†</span><br>          path.<span class="hljs-title function_">quadraticCurveTo</span>( waveWidth/<span class="hljs-number">2</span>,baseHeight-waveHeight ,waveWidth,baseHeight)<br>          path.<span class="hljs-title function_">quadraticCurveTo</span>(waveWidth+waveWidth/<span class="hljs-number">2</span>,  baseHeight+waveHeight ,canvasWidth,baseHeight)<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">&quot;#1b91e0&quot;</span><br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">stroke</span>(path)<br>          <br>        &#125;)<br></code></pre></td></tr></table></figure><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>å®ç°ä¹Ÿä¸€æ ·ï¼Œç›´æ¥<del>æŠ„</del> ç§»æ¤è¿‡æ¥å°±å¥½äº†ï¼Œå¯¹åº”çš„ api æ€ä¹ˆç”¨ä¹Ÿæå®šäº†ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">WaveView</span>&#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">settings</span>: <span class="hljs-title class_">RenderingContextSettings</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderingContextSettings</span>(<span class="hljs-literal">true</span>)<br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">canvasRendering</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasRenderingContext2D</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>)<br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">canvasHeight</span>: <span class="hljs-built_in">number</span> = -<span class="hljs-number">1</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">canvasWidth</span>: <span class="hljs-built_in">number</span> = -<span class="hljs-number">1</span><br>  <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-attr">dx</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span> <span class="hljs-comment">//æœ€å¤§å€¼ç­‰äº waveWidthï¼Œæ¯æ¬¡ç§»åŠ¨çš„è·ç¦»</span><br>  <span class="hljs-keyword">private</span> waveHeight = <span class="hljs-number">50</span> <span class="hljs-comment">//æ‹è„‘è¢‹è®¢çš„æ•°å€¼</span><br>  <span class="hljs-keyword">private</span> baseHeight = <span class="hljs-number">300</span> <span class="hljs-comment">//æ‹è„‘è¢‹è®¢çš„æ•°å€¼</span><br>  <span class="hljs-keyword">private</span> waveWidth = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">intervalTimer</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span><br>  <span class="hljs-title function_">drawWave</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dx</span> += <span class="hljs-number">4</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">dx</span> &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">waveWidth</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">dx</span> = <span class="hljs-number">0</span><br>    &#125;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">clearRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span>)<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">waveWidth</span> == <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">waveWidth</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span> / <span class="hljs-number">2</span><br>    &#125;<br><br>    <span class="hljs-keyword">let</span> <span class="hljs-attr">path</span>: <span class="hljs-title class_">Path2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path2D</span>()<br>    <span class="hljs-comment">//éœ€è¦åœ¨å±å¹•å¤–å¤šç”»ä¸€ä¸ªæ³¢æµªï¼Œè¿™é‡Œå…ˆå°†ç”»ç¬”ç§»åŠ¨åˆ°ç”»å¸ƒ|å±å¹•å¤–ï¼Œè®°å¾—åŠ ä¸ŠåŠ¨ç”»çš„åç§»é‡ dx</span><br>    path.<span class="hljs-title function_">moveTo</span>(-<span class="hljs-variable language_">this</span>.<span class="hljs-property">waveWidth</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">dx</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseHeight</span>)<br>    <span class="hljs-keyword">let</span> startX = -<span class="hljs-variable language_">this</span>.<span class="hljs-property">waveWidth</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">dx</span><span class="hljs-comment">//è®°å½•å¼€å§‹ç‚¹çš„æ¨ªåæ ‡</span><br>    <span class="hljs-comment">//éœ€è¦å¤šç”»ä¸€ä¸ªæ³¢æµªï¼Œç›´æ¥å¾ªç¯å¼€å§‹ç”»å°±å¥½äº†</span><br>    <span class="hljs-keyword">while</span> (startX &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">dx</span>) &#123;<br><br>      <span class="hljs-keyword">let</span> endY = <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseHeight</span><br>      <span class="hljs-comment">//ç”»å‘ä¸‹å’Œå‘ä¸Šçš„æ³¢æµªï¼Œå…¨é æ§åˆ¶ç‚¹çš„çºµåæ ‡æ§åˆ¶æ³¢æµªçš„ä¸Šçº¿</span><br>      path.<span class="hljs-title function_">quadraticCurveTo</span>(startX + <span class="hljs-variable language_">this</span>.<span class="hljs-property">waveWidth</span> / <span class="hljs-number">4</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseHeight</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">waveHeight</span>, startX + <span class="hljs-variable language_">this</span>.<span class="hljs-property">waveWidth</span>/<span class="hljs-number">2</span>, endY)<br>      path.<span class="hljs-title function_">quadraticCurveTo</span>(startX + <span class="hljs-variable language_">this</span>.<span class="hljs-property">waveWidth</span> / <span class="hljs-number">4</span>*<span class="hljs-number">3</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseHeight</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">waveHeight</span>, startX + <span class="hljs-variable language_">this</span>.<span class="hljs-property">waveWidth</span>, endY)<br>      <span class="hljs-comment">//ç”»å®Œä¸€ä¸Šä¸€ä¸‹è¿™ä¸€ç»„æ³¢æµªåæ›´æ–°èµ·å§‹ç‚¹åæ ‡</span><br>      startX += <span class="hljs-variable language_">this</span>.<span class="hljs-property">waveWidth</span><br>    &#125;<br>    <span class="hljs-comment">//éœ€è¦å°†æ³¢æµªçº¿ä¸‹æ–¹çš„åŒºåŸŸå¡«æ»¡é¢œè‰²ï¼Œè¿™é‡Œå–å·§åœˆèµ·æ¥ä¸€ä¸ªæ¡†ï¼Œä½¿ç”¨ fill æ–¹æ³•å¡«å……</span><br>    path.<span class="hljs-title function_">lineTo</span>(startX ,<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span>) <span class="hljs-comment">//æ³¢æµªçº¿æœ€å³ä¾§ç”»ä¸€æ¡åˆ°ç”»å¸ƒåº•éƒ¨çš„å‚çº¿</span><br>    path.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">0</span> ,<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span>)<span class="hljs-comment">//ç”»å¸ƒåº•éƒ¨çš„æ¨ªçº¿</span><br>    path.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">0</span> ,<span class="hljs-variable language_">this</span>.<span class="hljs-property">baseHeight</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">waveHeight</span>) <span class="hljs-comment">//æ³¢æµªçº¿æœ€å·¦ä¾§åˆ°ç”»å¸ƒåº•éƒ¨çš„å‚çº¿</span><br><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">&quot;#39d167&quot;</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">&quot;#39d167&quot;</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">10</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">fill</span>(path)<br><br>  &#125;<br><br>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Column</span>() &#123;<br>      <span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>).<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">&quot;100%&quot;</span>)<br>        .<span class="hljs-title function_">onAreaChange</span>(<span class="hljs-function">(<span class="hljs-params">oldValue, newValue</span>) =&gt;</span> &#123;<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span> = <span class="hljs-built_in">parseInt</span>(newValue.<span class="hljs-property">width</span>.<span class="hljs-title function_">toString</span>())<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span> = <span class="hljs-built_in">parseInt</span>(newValue.<span class="hljs-property">height</span>.<span class="hljs-title function_">toString</span>())<br><br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseHeight</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span> - <span class="hljs-number">300</span><br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">waveWidth</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span> / <span class="hljs-number">2</span><br>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawWave</span>()<br><br>        &#125;)<br>      <span class="hljs-title class_">Row</span>() &#123;<br>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">&quot;å¼€å§‹&quot;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">intervalTimer</span> != <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">intervalTimer</span>)<br>          &#125;<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">intervalTimer</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawWave</span>()<br>          &#125;.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), <span class="hljs-number">10</span>)<br>        &#125;)<br>        <span class="hljs-title class_">Blank</span>().<span class="hljs-title function_">width</span>(<span class="hljs-number">15</span>)<br>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">&quot;åœæ­¢&quot;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">intervalTimer</span> != <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">intervalTimer</span>)<br>          &#125;<br>        &#125;)<br>      &#125;.<span class="hljs-title function_">margin</span>(&#123; <span class="hljs-attr">bottom</span>: <span class="hljs-number">10</span> &#125;)<br><br>    &#125;<br>  &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä¸Šé¢å°±æ˜¯å®Œæ•´çš„ä»£ç äº†ï¼Œgithub ä»“åº“åœ¨è¿™é‡Œï¼š<a href="https://github.com/huangyuanlove/HelloArkUI/blob/main/entry/src/main/ets/pages/playground/WaveView.ets">https://github.com/huangyuanlove/HelloArkUI/blob/main/entry/src/main/ets/pages/playground/WaveView.ets</a><br><a href="https://github.com/huangyuanlove/HelloArkUI/blob/main/entry/src/main/ets/pages/playground/WaveLinePage.ets">https://github.com/huangyuanlove/HelloArkUI/blob/main/entry/src/main/ets/pages/playground/WaveLinePage.ets</a></p><h3 id="è¿›åŒ–"><a href="#è¿›åŒ–" class="headerlink" title="è¿›åŒ–"></a>è¿›åŒ–</h3><p>ç¨å¾®ä¿®æ”¹ä¸€ä¸‹å°±å¯ä»¥åšæˆå…¶ä»–æ•ˆæœ<br>æ¯”å¦‚å°†<code>baseHeight</code>ä¹Ÿç”¨<code>@State</code>ä¿®é¥°ä¸€ä¸‹ï¼ŒåŒæ—¶åœ¨å®šæ—¶å™¨ä¸­æ›´æ–°ä¸€ä¸‹ï¼Œå°±å¯ä»¥å®ç°æ³¨æ°´æ•ˆæœ<br>å†å°†ç”»å¸ƒè£æˆåœ†å½¢ï¼Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„å……ç”µã€å†…å­˜åŠ é€Ÿçƒæ•ˆæœã€‚å†åšç‚¹éšæœºçš„ç²’å­æ•ˆæœæˆ–è€…å¤šç”»å‡ æ¡æµ…è‰²çš„æ³¢æµªçº¿ï¼Œæ•ˆæœå°±æ›´å¥½äº†</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;Android ä¸­ canvas èƒ½ç”»å‡ºæ¥çš„ä¸œè¥¿é¸¿è’™çš„ canvas è¿˜ç”»ä¸äº†ï¼Œä¸å¤§å¯èƒ½å§ï¼Ÿæœ‰ä¸ªæœ‹å‹é—®é¸¿è’™åº”ç”¨ä¸­æƒ³å®ç°æ³¢æµªæ•ˆæœï¼Œåº”è¯¥å’‹ç”»ï¼Ÿè¿™</summary>
      
    
    
    
    
    <category term="HarmonyOS" scheme="https://blog.huangyuanlove.com/tags/HarmonyOS/"/>
    
  </entry>
  
  <entry>
    <title>riverpod2ä¸­çš„ä¿®é¥°ç¬¦åŠæ³¨è§£</title>
    <link href="https://blog.huangyuanlove.com/2024/03/27/riverpod2%E4%B8%AD%E7%9A%84%E4%BF%AE%E9%A5%B0%E7%AC%A6%E5%8F%8A%E6%B3%A8%E8%A7%A3/"/>
    <id>https://blog.huangyuanlove.com/2024/03/27/riverpod2%E4%B8%AD%E7%9A%84%E4%BF%AE%E9%A5%B0%E7%AC%A6%E5%8F%8A%E6%B3%A8%E8%A7%A3/</id>
    <published>2024-03-27T02:43:24.000Z</published>
    <updated>2024-03-27T02:44:14.329Z</updated>
    
    <content type="html"><![CDATA[<p>åŸæ–‡æ¥è‡ªï¼š<a href="https://codewithandrea.com/articles/flutter-state-management-riverpod/">https://codewithandrea.com/articles/flutter-state-management-riverpod/</a></p><h3 id="ç›‘å¬ã€è§‚å¯Ÿã€é€‰æ‹©ã€è®°å½•ã€é‡å»º"><a href="#ç›‘å¬ã€è§‚å¯Ÿã€é€‰æ‹©ã€è®°å½•ã€é‡å»º" class="headerlink" title="ç›‘å¬ã€è§‚å¯Ÿã€é€‰æ‹©ã€è®°å½•ã€é‡å»º"></a>ç›‘å¬ã€è§‚å¯Ÿã€é€‰æ‹©ã€è®°å½•ã€é‡å»º</h3><h4 id="ref-read-or-ref-watch"><a href="#ref-read-or-ref-watch" class="headerlink" title="ref.read or ref.watch"></a>ref.read or ref.watch</h4><p>åœ¨ä¸Šä¸€ç¯‡ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† ref.readå’Œ ref.watchï¼Œé‚£ä¹ˆè¿™ä¸¤è€…åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨ï¼Ÿ<br>ä¸€èˆ¬æ¥è®²ï¼Œå¦‚æœéœ€è¦åœ¨Provider å€¼å‘ç”Ÿæ”¹å˜æ—¶æ›´æ–°ä¾èµ–å®ƒçš„ widgetï¼Œå°±ä½¿ç”¨ watchã€‚æ¯”å¦‚ æˆ‘ä»¬åœ¨ build å‡½æ•°ä¸­ä½¿ç”¨watch,è¿™ç¡®ä¿äº†å¦‚æœæä¾›è€…çš„å€¼å‘ç”Ÿæ›´æ”¹ï¼Œæˆ‘ä»¬ä¼šé‡å»ºä¾èµ–å®ƒçš„widget.</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> counterStateProvider = StateProvider&lt;<span class="hljs-built_in">int</span>&gt;((_) =&gt; <span class="hljs-number">0</span>);<br>  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CounterWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>    <span class="hljs-meta">@override</span><br>    Widget build(BuildContext context, WidgetRef ref) &#123;<br>      <span class="hljs-comment">// 1. watch the provider and rebuild when the value changes</span><br>      <span class="hljs-keyword">final</span> counter = ref.watch(counterStateProvider);<br>      <span class="hljs-keyword">return</span> ElevatedButton(<br>        <span class="hljs-comment">// 2. use the value</span><br>        child: Text(<span class="hljs-string">&#x27;Value: <span class="hljs-subst">$counter</span>&#x27;</span>),<br>        <span class="hljs-comment">// 3. change the state inside a button callback</span><br>        onPressed: () =&gt; ref.read(counterStateProvider.notifier).state++,<br>      );<br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬åªæ˜¯è¯»å–åˆ° Provider çš„å€¼åšæ“ä½œï¼Œä¸€èˆ¬ä½¿ç”¨ readï¼Œæ¯”å¦‚ä¸Šé¢ç‚¹å‡» ElevatedButton æ—¶æˆ‘ä»¬è·å–åˆ° notifier ä¹‹åå¯¹count åšäº†++æ“ä½œ<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šnotifierè¯­æ³•ä»…é€‚ç”¨äºStateProviderå’ŒStateNotifierProviderï¼Œå…¶å·¥ä½œæ–¹å¼å¦‚ä¸‹ï¼š</p><ul><li>åœ¨StateProviderä¸Šè°ƒç”¨ref.read(provider.notifier)ï¼Œä»¥è¿”å›åº•å±‚çš„StateControllerï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥ä¿®æ”¹çŠ¶æ€ã€‚</li><li>åœ¨StateNotifierProviderä¸Šè°ƒç”¨ref.read(provider.notifier)ï¼Œä»¥è¿”å›åº•å±‚çš„StateNotifierï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥è°ƒç”¨å…¶æ–¹æ³•ã€‚</li></ul><h4 id="select"><a href="#select" class="headerlink" title="select"></a>select</h4><p>æˆ‘ä»¬æœ‰æ—¶å€™ä¹Ÿä¼šé‡åˆ°è¿™ç§éœ€æ±‚ï¼šä¸€ä¸ªå¯¹è±¡æœ‰å¤šä¸ªå±æ€§ï¼Œå¸Œæœ›åªæœ‰ç‰¹å®šå±æ€§å‘ç”Ÿå˜åŒ–æ—¶æ‰æ›´æ–°é¡µé¢ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ select æ¥å®Œæˆ</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> </span>&#123;<br>  Student(<span class="hljs-keyword">this</span>.firstName, <span class="hljs-keyword">this</span>.lastName, <span class="hljs-keyword">this</span>.age);<br><br>  <span class="hljs-built_in">String</span> firstName;<br>  <span class="hljs-built_in">String</span> lastName;<br>  <span class="hljs-built_in">int</span> age;<br>  Student copy() &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Student(firstName, lastName, age);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åªéœ€è¦åœ¨å¹´é¾„å‘ç”Ÿæ”¹å˜æ—¶æ›´æ–°é¡µé¢</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart">Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> age = ref.watch( provider.select((value) =&gt; value.age) );<br>    <span class="hljs-keyword">return</span> Text(<span class="hljs-string">&quot;<span class="hljs-subst">$age</span>&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="listen"><a href="#listen" class="headerlink" title="listen"></a>listen</h4><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜æœ‰ listenï¼Œ æ¯”å¦‚æˆ‘ä»¬å¸Œæœ›åœ¨ Provider å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶å¼¹å‡ºä¸€ä¸ª SnakeBaræç¤ºç”¨æˆ·ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åš:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> counterStateProvider = StateProvider&lt;<span class="hljs-built_in">int</span>&gt;((_) =&gt; <span class="hljs-number">0</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CounterWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-comment">// if we use a StateProvider&lt;T&gt;, the type of the previous and current </span><br>    <span class="hljs-comment">// values is StateController&lt;T&gt;</span><br>    ref.listen&lt;StateController&lt;<span class="hljs-built_in">int</span>&gt;&gt;(counterStateProvider.state, (previous, current) &#123;<br>      <span class="hljs-comment">// note: this callback executes when the provider value changes,</span><br>      <span class="hljs-comment">// not when the build method is called</span><br>      ScaffoldMessenger.of(context).showSnackBar(<br>        SnackBar(content: Text(<span class="hljs-string">&#x27;Value is <span class="hljs-subst">$&#123;current.state&#125;</span>&#x27;</span>)),<br>      );<br>    &#125;);<br>    <span class="hljs-comment">// watch the provider and rebuild when the value changes</span><br>    <span class="hljs-keyword">final</span> counter = ref.watch(counterStateProvider);<br>    <span class="hljs-keyword">return</span> ElevatedButton(<br>      <span class="hljs-comment">// use the value</span><br>      child: Text(<span class="hljs-string">&#x27;Value: <span class="hljs-subst">$counter</span>&#x27;</span>),<br>      <span class="hljs-comment">// change the state inside a button callback</span><br>      onPressed: () =&gt; ref.read(counterStateProvider.notifier).state++,<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h4><p>æˆ‘ä»¬éœ€è¦åœ¨ Provider å†…å®¹å‘ç”Ÿæ”¹å˜æ—¶æ‰“å°æ—¥å¿—ï¼Œä»¥æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œè°ƒè¯•ï¼Œä½†åˆä¸æƒ³åœ¨æ¯ä¸ª Provider ä¸­éƒ½åŠ ä¸Šæ‰“å°ä»£ç ï¼Œåº”è¯¥æ€ä¹ˆåŠï¼Ÿ<br>åœ¨ Rivepod ä¸­æœ‰ä¸€ä¸ªProviderObserverç±»ï¼Œæˆ‘ä»¬å¯ä»¥ç»§æ‰¿å®ƒå®ç°è‡ªå·±çš„é€»è¾‘</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProviderLogger</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ProviderObserver</span> </span>&#123;<br>    <span class="hljs-meta">@override</span><br>    <span class="hljs-keyword">void</span> didUpdateProvider(<br>      ProviderBase provider,<br>      <span class="hljs-built_in">Object?</span> previousValue,<br>      <span class="hljs-built_in">Object?</span> newValue,<br>      ProviderContainer container,<br>    ) &#123;<br>      <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[<span class="hljs-subst">$&#123;provider.name ?? provider.runtimeType&#125;</span>] value: <span class="hljs-subst">$newValue</span>&#x27;</span>);<br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼Œéœ€è¦å°†å®ƒæ·»åŠ åˆ° ProviderScopeå†…çš„è§‚å¯Ÿè€…åˆ—è¡¨ä¸­</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> main() &#123;<br>    runApp(<br>      ProviderScope(observers: [ProviderLogger()], child: MyApp()),<br>    );<br>  &#125;<br></code></pre></td></tr></table></figure><p>ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬åŒºåˆ†æ˜¯å“ªä¸€ä¸ª Provider çš„æ—¥å¿—ï¼Œæˆ‘ä»¬åœ¨å£°æ˜ Provider æ—¶å¯ä»¥æä¾›ä¸€ä¸ªåå­—</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> counterStateProvider = StateProvider&lt;<span class="hljs-built_in">int</span>&gt;((ref) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;, name: <span class="hljs-string">&#x27;main_page_counter&#x27;</span>);<br></code></pre></td></tr></table></figure><h3 id="ä¿®é¥°ç¬¦"><a href="#ä¿®é¥°ç¬¦" class="headerlink" title="ä¿®é¥°ç¬¦"></a>ä¿®é¥°ç¬¦</h3><h4 id="autoDispose"><a href="#autoDispose" class="headerlink" title="autoDispose"></a>autoDispose</h4><p>ä¸Šä¸€ç¯‡ä¸­æåˆ°Riverpod ä½œè€…å¼ºçƒˆå»ºè®®å°† Provider å£°æ˜ä¸ºå…¨å±€çš„è€Œä¸æ˜¯ç±»å†…éƒ¨ï¼Œè¿™æ ·æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé¡µé¢é”€æ¯æ—¶ä¹Ÿå°±æ˜¯provideræ²¡æœ‰ä»»ä½•ç›‘å¬è€…æ—¶å¹¶ä¸ä¼šè¢«é‡ç½®ã€‚å†æ¬¡è¿›å…¥é¡µé¢åè¿˜æ˜¯é¡µé¢é”€æ¯ä¹‹å‰çš„å€¼ï¼Œæ¯”å¦‚ StateProvider å®ç°çš„è®¡æ•°åŠŸèƒ½ã€‚å½“æˆ‘ä»¬åœ¨é¡µé¢ä¸­ç‚¹å‡»åŠ å·ï¼Œå°†æ•°å­—å˜ä¸º 5 åï¼Œè¿”å›ä¸Šä¸€ä¸ªé¡µé¢åå†æ¬¡æ‰“å¼€è¯¥é¡µé¢ï¼Œä¼šå‘ç°é¡µé¢è¿˜æ˜¯ 5ã€‚è¿™æœ‰æ—¶ä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨autoDisposeæ¥å®ç°ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> autoDisposeProvider = StateProvider.autoDispose&lt;<span class="hljs-built_in">int</span>&gt;(((ref) &#123;<br>  ref.onDispose(() &#123;<br>    debugPrint(<span class="hljs-string">&quot;countProvider onDispose&quot;</span>);<br>  &#125;);<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;));<br><br><span class="hljs-keyword">final</span> countProvider = StateProvider&lt;<span class="hljs-built_in">int</span>&gt;((ref) =&gt; <span class="hljs-number">1</span>);<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RiverpodAutoDisposeWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-keyword">final</span> autoDisposeValue = ref.watch(autoDisposeProvider);<br>    <span class="hljs-keyword">final</span> normalValue = ref.watch(countProvider);<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;AutoDispose&quot;</span>),<br>        centerTitle: <span class="hljs-keyword">true</span>,<br>      ),<br>      body: Column(children: [<br>        Text(<span class="hljs-string">&quot;autoDispose:å½“privderä¸è¢«ä½¿ç”¨æ—¶ï¼Œå¯ä»¥è¢«è‡ªåŠ¨é‡Šæ”¾&quot;</span>),<br>        Text(<span class="hljs-string">&quot;autoDisposeValue-&gt; <span class="hljs-subst">$&#123;autoDisposeValue&#125;</span>&quot;</span>),<br>        Text(<span class="hljs-string">&quot;normalValue-&gt; <span class="hljs-subst">$&#123;normalValue&#125;</span>&quot;</span>),<br>        Row(<br>          children: [<br>            ElevatedButton(<br>                onPressed: (() &#123;<br>                  ref.read(autoDisposeProvider.notifier).state++;<br>                  ref.read(countProvider.notifier).state++;<br>                &#125;),<br>                child: Text(<span class="hljs-string">&quot;å¢åŠ è®¡æ•°&quot;</span>))<br>          ],<br>        )<br>      ]),<br>    );<br>  &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å½“é¡µé¢è¢«é”€æ¯æ—¶ï¼Œè¢«autoDisposeä¿®é¥°çš„ provider ä¼šè¢«é‡Šæ”¾å¹¶é‡ç½®ã€‚è¿™é‡Œçš„ ref.onDisposeä¼šåœ¨æ²¡æœ‰ç›‘å¬è€…ä¹‹åè°ƒç”¨ã€‚</p><h4 id="keepAlive"><a href="#keepAlive" class="headerlink" title="keepAlive"></a>keepAlive</h4><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ref.keepAliveå®ç°è¶…æ—¶ç¼“å­˜ã€‚<br>ç®€å•ç²—æš´ç‚¹å°±æ˜¯è¿™æ ·ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> tmpProvider = StateProvider.autoDispose&lt;<span class="hljs-built_in">int</span>&gt;((ref)&#123;<br><br>    <span class="hljs-comment">// get the [KeepAliveLink]</span><br>    <span class="hljs-keyword">final</span> link = ref.keepAlive();<br>    <span class="hljs-comment">// start a 30 second timer</span><br>    <span class="hljs-keyword">final</span> timer = Timer(<span class="hljs-keyword">const</span> <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">30</span>), () &#123;<br>      <span class="hljs-comment">// dispose on timeout</span><br>      link.close();<br>    &#125;);<br>    <span class="hljs-comment">// make sure to cancel the timer when the provider state is disposed</span><br>    <span class="hljs-comment">// (prevents undesired test failures)</span><br>    ref.onDispose(() =&gt; timer.cancel());<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;);<br><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>extension</code>å°è£…ä¸€ä¸‹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">extension</span> AutoDisposeRefCache <span class="hljs-keyword">on</span> AutoDisposeRef &#123;<br>  <span class="hljs-keyword">void</span> cacheFor(<span class="hljs-built_in">Duration</span> duration) &#123;<br>    <span class="hljs-keyword">final</span> link = keepAlive();<br>    <span class="hljs-keyword">final</span> timer = Timer(duration, () &#123;<br>      link.close();<br>    &#125;);<br>    onDispose(() &#123;<br>      timer.cancel();<br>    &#125;);<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">//ä½¿ç”¨</span><br><span class="hljs-keyword">final</span> timerCachedProvider = Provider.autoDispose&lt;<span class="hljs-built_in">int</span>&gt;((ref) &#123;<br>  ref.cacheFor(<span class="hljs-built_in">Duration</span>(minutes: <span class="hljs-number">5</span>));<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="family"><a href="#family" class="headerlink" title="family"></a>family</h4><p>æˆ‘ä»¬å¯ä»¥ç”¨å®ƒå‘ Provider æä¾›å‚æ•°ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„è®¡æ•°å™¨ç¤ºä¾‹ï¼Œæ¯”å¦‚æƒ³ä»æŒ‡å®šçš„æ•°å­—å¼€å§‹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> countProviderBase = StateProvider.autoDispose.family&lt;<span class="hljs-built_in">int</span>,<span class="hljs-built_in">int</span>&gt; ((ref,start)&#123;<br>  <span class="hljs-keyword">return</span> start;<br>&#125;);<br><span class="hljs-comment">//ä½¿ç”¨</span><br><span class="hljs-keyword">final</span> startValue =  ref.watch(countProviderBase(<span class="hljs-number">10</span>));<br></code></pre></td></tr></table></figure><h4 id="ä¾èµ–è¦†ç›–"><a href="#ä¾èµ–è¦†ç›–" class="headerlink" title="ä¾èµ–è¦†ç›–"></a>ä¾èµ–è¦†ç›–</h4><p>æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ Provider å­˜å‚¨æ— æ³•ç«‹å³è·å–çš„å¯¹è±¡æˆ–è€…å€¼ï¼Œæ¯”å¦‚åšæœ¬åœ°å­˜å‚¨æ—¶ç”¨çš„<code>shared_preferences</code>ã€‚ä½†æ˜¯å®ƒçš„åˆå§‹åŒ–æ˜¯å¼‚æ­¥çš„ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥åœ¨ Provider ä¸­ä½¿ç”¨åˆ™ä¼šæç¤º</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> spProvider = Provider&lt;SharedPreferences&gt;((ref) &#123;<br>  <span class="hljs-keyword">return</span> SharedPreferences.getInstance();<span class="hljs-comment">//ä¸å¯ä»¥è¿™æ ·ä½¿ç”¨</span><br>  <span class="hljs-comment">//The return type &#x27;Future&lt;SharedPreferences&gt;&#x27; isn&#x27;t a &#x27;SharedPreferences&#x27;, as required by the closure&#x27;s context.</span><br>&#125;);<br></code></pre></td></tr></table></figure><p>è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥å…ˆæŠ›å‡ºä¸€ä¸ªä¸ºå®ç°çš„å¼‚å¸¸</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> sharedPreferencesProvider = Provider&lt;SharedPreferences&gt;((ref) &#123;<br>    <span class="hljs-keyword">throw</span> UnimplementedError();<br>  &#125;);<br></code></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨ ProviderScope ç»„ä»¶ä¸­è¿›è¡Œä¾èµ–è¦†ç›–</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dart">Future&lt;<span class="hljs-keyword">void</span>&gt; main() <span class="hljs-keyword">async</span> &#123;<br>  WidgetsFlutterBinding.ensureInitialized();<br>  <span class="hljs-keyword">final</span> sharedPreferences = <span class="hljs-keyword">await</span> SharedPreferences.getInstance();<br>  runApp(ProviderScope(<br>    overrides: [<br>      <span class="hljs-comment">// override the previous value with the new object</span><br>      sharedPreferencesProvider.overrideWithValue(sharedPreferences),<br>    ],<br>    child: MyApp(),<br>  ));<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è§‚å¯ŸsharedPreferencesProviderå¯¹è±¡ï¼Œè€Œæ— éœ€ä½¿ç”¨åŸºäºFutureçš„API</p><h3 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h3><p>æˆ‘ä»¬åœ¨ä½¿ç”¨ Provider æ—¶éƒ½éœ€è¦æ‰‹åŠ¨ç¼–å†™ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥ä½¿ç”¨ build_runnerç”Ÿæˆï¼ŸRiverpod ä¸­å·²ç»æä¾›äº†è¿™ç§æ–¹å¼ï¼Œä½†å½“å‰åªæ”¯æŒä»¥ä¸‹å‡ ç§</p><ul><li>Provider</li><li>FutureProvider</li><li>StreamProvider</li><li>NotifierProvider</li><li>AsyncNotifierProvider</li></ul><h4 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-comment"># or flutter_riverpod/hooks_riverpod as per https://riverpod.dev/docs/getting_started</span><br>  <span class="hljs-attr">riverpod:</span> <span class="hljs-string">^2.4.10</span><br>  <span class="hljs-comment"># the annotation package containing @riverpod</span><br>  <span class="hljs-attr">riverpod_annotation:</span> <span class="hljs-string">^2.3.4</span><br><span class="hljs-attr">dev_dependencies:</span><br>  <span class="hljs-comment"># a tool for running code generators</span><br>  <span class="hljs-attr">build_runner:</span><br>  <span class="hljs-comment"># the code generator</span><br>  <span class="hljs-attr">riverpod_generator:</span> <span class="hljs-string">^2.3.9</span><br>  <span class="hljs-comment"># riverpod_lint makes it easier to work with Riverpod</span><br>  <span class="hljs-attr">riverpod_lint:</span> <span class="hljs-string">^2.3.7</span><br>  <span class="hljs-comment"># import custom_lint too as riverpod_lint depends on it</span><br>  <span class="hljs-attr">custom_lint:</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­<code>riverpod_lint</code>å’Œ<code>custom_lint</code>è¿™ä¸¤ä¸ªåŒ…æ˜¯å¯é€‰çš„ã€‚<br>ä¹‹åæˆ‘ä»¬éœ€è¦åœ¨<code>watch</code>æ¨¡å¼ä¸‹å¯åŠ¨ä»£ç ç”Ÿæˆå™¨<br><code>flutter pub run build_runner watch -d</code>,è¾ƒæ–°çš„flutterç‰ˆæœ¬ä¼šæç¤ºä½¿ç”¨<code>dart run build_runner watch -d</code>ã€‚</p><h4 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h4><p>æˆ‘ä»¬æ¥çœ‹ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œä» Provider å¼€å§‹<br>æ²¡æœ‰ä½¿ç”¨æ³¨è§£ç”Ÿæˆå™¨ä¹‹å‰ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// dio_provider.dart</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:dio/dio.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_riverpod/flutter_riverpod.dart&#x27;</span>;<br><span class="hljs-comment">// a provider for the Dio client to be used by the rest of the app</span><br><span class="hljs-keyword">final</span> dioProvider = Provider&lt;Dio&gt;((ref) &#123;<br>  <span class="hljs-keyword">return</span> Dio();<br>&#125;);<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ³¨è§£ç”Ÿæˆå™¨ä¹‹å</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:dio/dio.dart&#x27;</span>;<br><span class="hljs-comment">// 1. import the riverpod_annotation package</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:riverpod_annotation/riverpod_annotation.dart&#x27;</span>;<br><span class="hljs-comment">// 2. add a part file</span><br><span class="hljs-keyword">part</span> <span class="hljs-string">&#x27;dio_provider.g.dart&#x27;</span>;<br><br><br><span class="hljs-comment">//éœ€è¦æ‰§è¡Œ flutter pub run build_runner watch -d æ¥ç”Ÿæˆå¯¹åº”ä»£ç </span><br><span class="hljs-meta">@riverpod</span><br>Dio dio(DioRef ref)&#123;<br>  <span class="hljs-keyword">return</span> Dio();<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¼šç”Ÿæˆ<code>dio_provider.g.dart</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// GENERATED CODE - DO NOT MODIFY BY HAND</span><br><br><span class="hljs-keyword">part</span> of <span class="hljs-string">&#x27;dio_provider.dart&#x27;</span>;<br><br><span class="hljs-comment">// **************************************************************************</span><br><span class="hljs-comment">// RiverpodGenerator</span><br><span class="hljs-comment">// **************************************************************************</span><br><br><span class="hljs-built_in">String</span> _$dioHash() =&gt; <span class="hljs-string">r&#x27;58eeefbd0832498ca2574c1fe69ed783c58d1d8f&#x27;</span>;<br><br><span class="hljs-comment">/// <span class="language-markdown">See also [dio].</span></span><br><span class="hljs-meta">@ProviderFor</span>(dio)<br><span class="hljs-keyword">final</span> dioProvider = AutoDisposeProvider&lt;Dio&gt;.internal(<br>  dio,<br>  name: <span class="hljs-string">r&#x27;dioProvider&#x27;</span>,<br>  debugGetCreateSourceHash:<br>      <span class="hljs-keyword">const</span> <span class="hljs-built_in">bool</span>.fromEnvironment(<span class="hljs-string">&#x27;dart.vm.product&#x27;</span>) ? <span class="hljs-keyword">null</span> : _$dioHash,<br>  dependencies: <span class="hljs-keyword">null</span>,<br>  allTransitiveDependencies: <span class="hljs-keyword">null</span>,<br>);<br><br><span class="hljs-keyword">typedef</span> DioRef = AutoDisposeProviderRef&lt;Dio&gt;;<br><span class="hljs-comment">// ignore_for_file: type=lint</span><br><span class="hljs-comment">// ignore_for_file: subtype_of_sealed_class, invalid_use_of_internal_member, invalid_use_of_visible_for_testing_member</span><br><br></code></pre></td></tr></table></figure><h4 id="autoDisposeå’Œ-keepAlive"><a href="#autoDisposeå’Œ-keepAlive" class="headerlink" title="autoDisposeå’Œ keepAlive"></a>autoDisposeå’Œ keepAlive</h4><p>åœ¨ä½¿ç”¨æ³¨è§£ç”Ÿæˆä»£ç æ—¶ï¼ŒautoDispose ç°åœ¨é»˜è®¤å¯ç”¨ï¼Œå¹¶å·²é‡å‘½åä¸º keepAliveã€‚å¦‚æœä¸æƒ³é”€æ¯ providerï¼Œå¯ä»¥å°†keepAliveè®¾ç½®ä¸º true</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@Riverpod</span>(keepAlive: <span class="hljs-keyword">true</span>)<br><span class="hljs-built_in">int</span> counter(CounterRef ref)&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆçš„ä»£ç æ˜¯è¿™æ ·çš„</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-built_in">String</span> _$counterHash() =&gt; <span class="hljs-string">r&#x27;6b26baf29ab7c65258c6367ad62133458d88a2b3&#x27;</span>;<br><br><span class="hljs-comment">/// <span class="language-markdown">See also [counter].</span></span><br><span class="hljs-meta">@ProviderFor</span>(counter)<br><span class="hljs-keyword">final</span> counterProvider = Provider&lt;<span class="hljs-built_in">int</span>&gt;.internal(<br>  counter,<br>  name: <span class="hljs-string">r&#x27;counterProvider&#x27;</span>,<br>  debugGetCreateSourceHash:<br>      <span class="hljs-keyword">const</span> <span class="hljs-built_in">bool</span>.fromEnvironment(<span class="hljs-string">&#x27;dart.vm.product&#x27;</span>) ? <span class="hljs-keyword">null</span> : _$counterHash,<br>  dependencies: <span class="hljs-keyword">null</span>,<br>  allTransitiveDependencies: <span class="hljs-keyword">null</span>,<br>);<br><br><span class="hljs-keyword">typedef</span> CounterRef = ProviderRef&lt;<span class="hljs-built_in">int</span>&gt;;<br><span class="hljs-comment">// ignore_for_file: type=lint</span><br><span class="hljs-comment">// ignore_for_file: subtype_of_sealed_class, invalid_use_of_internal_member, invalid_use_of_visible_for_testing_member</span><br><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“ keepAlive æ˜¯é»˜è®¤å€¼(true)æ—¶ï¼Œä½¿ç”¨çš„æ˜¯<code>AutoDisposeProvider</code>,ä¸º false æ—¶ï¼Œä½¿ç”¨çš„æ˜¯<code>Provider</code></p><h4 id="FutureProvider-å’Œ-StreamProvider"><a href="#FutureProvider-å’Œ-StreamProvider" class="headerlink" title="FutureProvider å’Œ StreamProvider"></a>FutureProvider å’Œ StreamProvider</h4><p>å‡ ä¹æ˜¯ä¸€æ ·çš„å†™æ³•</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@riverpod</span><br>Future&lt;<span class="hljs-built_in">String</span>&gt; generateName(GenerateNameRef ref) <span class="hljs-keyword">async</span> &#123;<br>    <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">5</span>));<br>    <span class="hljs-keyword">final</span> wordPair = generateWordPairs().first;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;wordPair.first&#125;</span>  <span class="hljs-subst">$&#123;wordPair.second&#125;</span>&quot;</span>;<br>&#125;<br><br><span class="hljs-meta">@riverpod</span><br>Stream&lt;<span class="hljs-built_in">int</span>&gt; timeCount(TimeCountRef ref)&#123;<br>  <span class="hljs-keyword">return</span> Stream.periodic(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">1</span>),(number)&#123;<br>    <span class="hljs-keyword">return</span> number +<span class="hljs-number">1</span>;<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="NotifierProvider"><a href="#NotifierProvider" class="headerlink" title="NotifierProvider"></a>NotifierProvider</h4><p>æˆ‘ä»¬æŠŠä¸Šä¸€ç¯‡ä¸­<code>NotifierProvider</code>ä¾‹å­ç®€åŒ–ä¸€ä¸‹ï¼Œè¿˜æ˜¯é‚£ä¸ªä¸‡èƒ½çš„è®¡æ•°å™¨</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//å£°æ˜ä¸€ä¸ªNotifierå¯¹è±¡</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Counter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Notifier</span>&lt;<span class="hljs-title">int</span>&gt;</span>&#123;<br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-built_in">int</span> build() &#123;<br>   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br><br> <span class="hljs-comment">//å¯¹ state è¿›è¡Œæ“ä½œï¼Œä¹Ÿå¯ä»¥åœ¨å¤–éƒ¨ç›´æ¥æ“ä½œ</span><br>  <span class="hljs-keyword">void</span> increment()&#123;<br>    state ++;<br>  &#125;<br><br>&#125;<br><span class="hljs-comment">//ä¸¤ç§ provider çš„å£°æ˜æ–¹å¼</span><br><span class="hljs-keyword">final</span> counterProvider = NotifierProvider&lt;Counter, <span class="hljs-built_in">int</span>&gt;(() &#123;<br>  <span class="hljs-keyword">return</span> Counter();<br>&#125;);<br><span class="hljs-comment">// final counterProvider = NotifierProvider&lt;Counter, int&gt;(Counter.new);</span><br></code></pre></td></tr></table></figure><p>åœ¨ widget ä¸­ä½¿ç”¨</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RiverpodGeneratorWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span></span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-keyword">final</span> count = ref.watch(counterProvider);<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(title: Text(<span class="hljs-string">&quot;RiverpodGeneratorWidget&quot;</span>),centerTitle: <span class="hljs-keyword">true</span>,),<br>      body: Column(children: [<br>        Text(<span class="hljs-string">&quot;count <span class="hljs-subst">$count</span>&quot;</span>)<br>      ],),<br>      floatingActionButton: FloatingActionButton(onPressed: ()&#123;<br>        <span class="hljs-comment">//è°ƒç”¨ notifier ä¸­å®šä¹‰çš„æ–¹æ³•</span><br>        ref.read(counterProvider.notifier).increment();<br>        <span class="hljs-comment">//ç›´æ¥è·å–åˆ° state è¿›è¡Œæ“ä½œ</span><br>        ref.read(counterProvider.notifier).state++;<br>      &#125;,child: Icon(Icons.add),<br>      ),<br>    );<br>  &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬å¦‚æ˜¯ç”¨æ³¨è§£ä»£ç ç”Ÿæˆï¼Ÿ</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//counter.dart</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:riverpod_annotation/riverpod_annotation.dart&#x27;</span>;<br><span class="hljs-keyword">part</span> <span class="hljs-string">&#x27;counter.g.dart&#x27;</span>;<br><span class="hljs-meta">@riverpod</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Counter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">_</span>$<span class="hljs-title">Counter</span></span>&#123;<br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-built_in">int</span> build() &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">void</span> increment()&#123;<br>    state ++;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦ç»§æ‰¿<code>_$Counter</code>è€Œä¸æ˜¯<code>Notifier</code>ã€‚<br>å› ä¸º <code>Counter</code>ä¸­çš„ <code>build</code> æ–¹æ³•è¿”å›å€¼æ˜¯<code>int</code>ç±»å‹ï¼Œç”Ÿæˆçš„ä»£ç ä¸­ä¹Ÿå°±ä½¿ç”¨äº† <code>int</code>ç±»å‹ã€‚ç®€å•æ¥è®²å°±æ˜¯<code>build</code>æ–¹æ³•çš„è¿”å›å€¼ç±»å‹å†³å®šäº† <code>state</code> çš„ç±»å‹.</p><p>è¿˜æ˜¯éœ€è¦è¿è¡Œ <code>flutter pub run build_runner watch</code> æˆ–è€… <code>dart run build_runner watch</code>,è¿™æ—¶ä¼šç”Ÿæˆ<code>counter.g.dart</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// GENERATED CODE - DO NOT MODIFY BY HAND</span><br><br><span class="hljs-keyword">part</span> of <span class="hljs-string">&#x27;counter.dart&#x27;</span>;<br><br><span class="hljs-comment">// **************************************************************************</span><br><span class="hljs-comment">// RiverpodGenerator</span><br><span class="hljs-comment">// **************************************************************************</span><br><br><span class="hljs-built_in">String</span> _$counterHash() =&gt; <span class="hljs-string">r&#x27;7015b4a05f8ed24a914f6b3aad12be335d0c73d7&#x27;</span>;<br><br><span class="hljs-comment">/// <span class="language-markdown">See also [Counter].</span></span><br><span class="hljs-meta">@ProviderFor</span>(Counter)<br><span class="hljs-keyword">final</span> counterProvider = AutoDisposeNotifierProvider&lt;Counter, <span class="hljs-built_in">int</span>&gt;.internal(<br>  Counter.<span class="hljs-keyword">new</span>,<br>  name: <span class="hljs-string">r&#x27;counterProvider&#x27;</span>,<br>  debugGetCreateSourceHash:<br>      <span class="hljs-keyword">const</span> <span class="hljs-built_in">bool</span>.fromEnvironment(<span class="hljs-string">&#x27;dart.vm.product&#x27;</span>) ? <span class="hljs-keyword">null</span> : _$counterHash,<br>  dependencies: <span class="hljs-keyword">null</span>,<br>  allTransitiveDependencies: <span class="hljs-keyword">null</span>,<br>);<br><br><span class="hljs-keyword">typedef</span> _$Counter = AutoDisposeNotifier&lt;<span class="hljs-built_in">int</span>&gt;;<br><span class="hljs-comment">// ignore_for_file: type=lint</span><br><span class="hljs-comment">// ignore_for_file: subtype_of_sealed_class, invalid_use_of_internal_member, invalid_use_of_visible_for_testing_member</span><br><br></code></pre></td></tr></table></figure><h4 id="AsyncNotifierProvider"><a href="#AsyncNotifierProvider" class="headerlink" title="AsyncNotifierProvider"></a>AsyncNotifierProvider</h4><p>ä¹Ÿæ˜¯åŒæ ·çš„</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@riverpod</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AsyncCounters</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">_</span>$<span class="hljs-title">AsyncCounters</span></span>&#123;<br>  <span class="hljs-meta">@override</span><br>  FutureOr&lt;<span class="hljs-built_in">int</span>&gt; build()&#123;<br>    <span class="hljs-keyword">return</span> Future.delayed(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">3</span>),()&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆçš„ä»£ç å¦‚ä¸‹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// GENERATED CODE - DO NOT MODIFY BY HAND</span><br><br><span class="hljs-keyword">part</span> of <span class="hljs-string">&#x27;async_counter.dart&#x27;</span>;<br><br><span class="hljs-comment">// **************************************************************************</span><br><span class="hljs-comment">// RiverpodGenerator</span><br><span class="hljs-comment">// **************************************************************************</span><br><br><span class="hljs-built_in">String</span> _$asyncCountersHash() =&gt; <span class="hljs-string">r&#x27;787b7c6513c7794fa310550d32594b97238e7e3c&#x27;</span>;<br><br><span class="hljs-comment">/// <span class="language-markdown">See also [AsyncCounters].</span></span><br><span class="hljs-meta">@ProviderFor</span>(AsyncCounters)<br><span class="hljs-keyword">final</span> asyncCountersProvider =<br>    AutoDisposeAsyncNotifierProvider&lt;AsyncCounters, <span class="hljs-built_in">int</span>&gt;.internal(<br>  AsyncCounters.<span class="hljs-keyword">new</span>,<br>  name: <span class="hljs-string">r&#x27;asyncCountersProvider&#x27;</span>,<br>  debugGetCreateSourceHash: <span class="hljs-keyword">const</span> <span class="hljs-built_in">bool</span>.fromEnvironment(<span class="hljs-string">&#x27;dart.vm.product&#x27;</span>)<br>      ? <span class="hljs-keyword">null</span><br>      : _$asyncCountersHash,<br>  dependencies: <span class="hljs-keyword">null</span>,<br>  allTransitiveDependencies: <span class="hljs-keyword">null</span>,<br>);<br><br><span class="hljs-keyword">typedef</span> _$AsyncCounters = AutoDisposeAsyncNotifier&lt;<span class="hljs-built_in">int</span>&gt;;<br><span class="hljs-comment">// ignore_for_file: type=lint</span><br><span class="hljs-comment">// ignore_for_file: subtype_of_sealed_class, invalid_use_of_internal_member, invalid_use_of_visible_for_testing_member</span><br><br></code></pre></td></tr></table></figure><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><h4 id="Notifier-å’Œ-AsyncNotifierï¼šæ˜¯å¦å€¼å¾—ä½¿ç”¨ï¼Ÿ"><a href="#Notifier-å’Œ-AsyncNotifierï¼šæ˜¯å¦å€¼å¾—ä½¿ç”¨ï¼Ÿ" class="headerlink" title="Notifier å’Œ AsyncNotifierï¼šæ˜¯å¦å€¼å¾—ä½¿ç”¨ï¼Ÿ"></a>Notifier å’Œ AsyncNotifierï¼šæ˜¯å¦å€¼å¾—ä½¿ç”¨ï¼Ÿ</h4><p>é•¿æ—¶é—´ä»¥æ¥ï¼ŒStateNotifier ä¸€ç›´åœ¨ä¸ºæˆ‘ä»¬æä¾›æœåŠ¡ï¼Œæä¾›äº†ä¸€ä¸ªå­˜å‚¨å¤æ‚çŠ¶æ€å’Œä¿®æ”¹çŠ¶æ€é€»è¾‘çš„åœ°æ–¹ï¼Œä½¿å…¶ä¸å†ä¾èµ–äºå°éƒ¨ä»¶æ ‘ã€‚</p><p>Notifier å’Œ AsyncNotifier æ—¨åœ¨å–ä»£ StateNotifier å¹¶å¸¦æ¥ä¸€äº›æ–°çš„å¥½å¤„ï¼š</p><p>æ›´å®¹æ˜“æ‰§è¡Œå¤æ‚çš„å¼‚æ­¥åˆå§‹åŒ–<br>æ›´ç¬¦åˆäººä½“å·¥ç¨‹å­¦çš„ APIï¼šä¸å†éœ€è¦ä¼ é€’ ref<br>ä¸å†éœ€è¦æ‰‹åŠ¨å£°æ˜æä¾›è€…ï¼ˆå¦‚æœä½¿ç”¨ Riverpod Generatorï¼‰<br>å¯¹äºæ–°é¡¹ç›®æ¥è¯´ï¼Œè¿™äº›å¥½å¤„æ˜¯å€¼å¾—çš„ï¼Œå› ä¸ºæ–°çš„ç±»å¯ä»¥å¸®åŠ©æ‚¨ç”¨æ›´å°‘çš„ä»£ç å®ç°æ›´å¤šçš„åŠŸèƒ½ã€‚</p><p>ä½†å¦‚æœæ‚¨æœ‰å¾ˆå¤šç°æœ‰ä»£ç ä½¿ç”¨ StateNotifierï¼Œåˆ™ç”±æ‚¨å†³å®šæ˜¯å¦ï¼ˆæˆ–ä½•æ—¶ï¼‰è¿ç§»åˆ°æ–°çš„è¯­æ³•ã€‚</p><p>æ— è®ºå¦‚ä½•ï¼ŒStateNotifier è¿˜ä¼šå­˜åœ¨ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœæ‚¨æ„¿æ„ï¼Œå¯ä»¥é€ä¸ªè¿ç§»æ‚¨çš„æä¾›è€…ã€‚</p><h4 id="ä½¿ç”¨-generator-è¿˜æ˜¯æ‰‹åŠ¨ç¼–å†™-provider"><a href="#ä½¿ç”¨-generator-è¿˜æ˜¯æ‰‹åŠ¨ç¼–å†™-provider" class="headerlink" title="ä½¿ç”¨ generator è¿˜æ˜¯æ‰‹åŠ¨ç¼–å†™ provider"></a>ä½¿ç”¨ generator è¿˜æ˜¯æ‰‹åŠ¨ç¼–å†™ provider</h4><p>ä½¿ç”¨ generator éœ€è¦æˆ‘ä»¬æ‰§è¡Œé¢å¤–çš„ä»£ç æ¥ç”Ÿæˆå¯¹åº”çš„ä»£ç æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨ç¼–å†™ç”Ÿæˆä»£ç æ—¶ä½“éªŒä¸æ˜¯é‚£ä¹ˆçš„å‹å¥½ã€‚ä½†å¦å¤–ä¸€æ–¹é¢ï¼Œèƒ½çœå»æˆ‘ä»¬ç¼–å†™æ¨¡æ¿çš„ä»£ç çš„æ—¶é—´ã€‚å¦‚ä½•ä½¿ç”¨ï¼Œçœ‹ä¸ªäººå–œå¥½ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åŸæ–‡æ¥è‡ªï¼š&lt;a href=&quot;https://codewithandrea.com/articles/flutter-state-management-riverpod/&quot;&gt;https://codewithandrea.com/articles/flutter-state-m</summary>
      
    
    
    
    
    <category term="Flutter" scheme="https://blog.huangyuanlove.com/tags/Flutter/"/>
    
    <category term="riverpod" scheme="https://blog.huangyuanlove.com/tags/riverpod/"/>
    
  </entry>
  
  <entry>
    <title>riverpod2.xä¸­çš„ Provider ç®€ä»‹</title>
    <link href="https://blog.huangyuanlove.com/2024/03/27/riverpod2-x%E4%B8%AD%E7%9A%84-Provider-%E7%AE%80%E4%BB%8B/"/>
    <id>https://blog.huangyuanlove.com/2024/03/27/riverpod2-x%E4%B8%AD%E7%9A%84-Provider-%E7%AE%80%E4%BB%8B/</id>
    <published>2024-03-27T02:13:58.000Z</published>
    <updated>2024-04-01T02:18:11.659Z</updated>
    
    <content type="html"><![CDATA[<p>åŸæ–‡æ¥è‡ªï¼š<a href="https://codewithandrea.com/articles/flutter-state-management-riverpod/">https://codewithandrea.com/articles/flutter-state-management-riverpod/</a></p><h3 id="æ˜¯ä»€ä¹ˆ"><a href="#æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h3><p>Riverpodæ˜¯ä¸€ä¸ªå“åº”å¼ç¼“å­˜å’Œæ•°æ®ç»‘å®šæ¡†æ¶ï¼Œç”±Providerè½¯ä»¶åŒ…æ¼”åŒ–è€Œæ¥ã€‚æ ¹æ®å®˜æ–¹æ–‡æ¡£çš„è¯´æ³•ï¼Œriverpod æ˜¯æŠŠ provider é‡å†™äº†ï¼Œå®ç°äº†åŸæ¥æ— æ³•å®ç°çš„åŠŸèƒ½ã€‚</p><h3 id="ä¸ºä»€ä¹ˆä½¿ç”¨-riverpod"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨-riverpod" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨ riverpod"></a>ä¸ºä»€ä¹ˆä½¿ç”¨ riverpod</h3><p>ä»è®¾è®¡ä¸Šæ¥è¯´ï¼ŒProvideræ˜¯å¯¹<code>InheritedWidget</code>çš„æ”¹è¿›ï¼Œå› æ­¤å®ƒä¾èµ–äºå°éƒ¨ä»¶æ ‘ã€‚<br>è¿™æ˜¯ä¸€ä¸ªä¸å¹¸çš„è®¾è®¡å†³ç­–ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¸¸è§çš„<code>ProviderNotFoundException</code>ï¼š<br><img src="/image/riverpod/provider_demo.png" alt="provider_demo"><br>å¦ä¸€æ–¹é¢ï¼ŒRiverpodæ˜¯ç¼–è¯‘æ—¶å®‰å…¨çš„ï¼Œå› ä¸ºæ‰€æœ‰çš„ provider éƒ½è¢«å£°æ˜ä¸ºå…¨å±€çš„ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è®¿é—®ï¼Œè¿™ä¹Ÿæ„å‘³ç€è¿™äº› provider å¯ä»¥ä¸ä¾èµ–äºwidget tree æ¥å­˜å‚¨åº”ç”¨çŠ¶æ€å’Œä¸šåŠ¡é€»è¾‘ã€‚ç”±äº Riverpod æ˜¯ä¸€ä¸ªååº”å¼æ¡†æ¶ï¼Œå› æ­¤åªéœ€åœ¨éœ€è¦æ—¶é‡å»ºproviderså’Œwidgetså³å¯ã€‚</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>3.0 å·²ç»æœ‰ preview ç‰ˆæœ¬äº†ï¼Œä½†è¿˜æ²¡æœ‰å‡ºæ­£å¼ç‰ˆï¼Œè¿™é‡Œä½¿ç”¨ç¨å¾®æ—§ä¸€ç‚¹çš„ç‰ˆæœ¬</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-attr">flutter_riverpod:</span> <span class="hljs-string">^2.4.10</span><br></code></pre></td></tr></table></figure><p>ä¸ºäº†ç®€å•èµ·è§ï¼Œè¿™é‡Œæ²¡æœ‰ä½¿ç”¨<code>hooks_riverpod</code>,è‡³äºä½¿ç”¨æ³¨è§£æ¥ç”Ÿæˆ provierï¼Œä¼šåœ¨åç»­ä»‹ç»ã€‚</p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦æ”¹é€ ä¸€ä¸‹ç¨‹åºå…¥å£ï¼Œæä¾›ä¸€ä¸ª<code>ProviderScope</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(<br>    ProviderScope(<br>      child: MyApp(),<br>    ),<br>  );<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€å£°æ˜ä¸€ä¸ªå…¨å±€çš„<code>Provider</code>ï¼Œå’Œè¿™ä¸ª main æ–¹æ³•å¹³çº§å°±å¯ä»¥</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> authorNameProvider = Provider&lt;<span class="hljs-built_in">String</span>&gt;(<br>  (ref) =&gt; <span class="hljs-string">&quot;xuan&quot;</span>,<br>);<br></code></pre></td></tr></table></figure><p>ç„¶åæ”¹é€ ä¸€ä¸‹<code>MyApp</code>,è®©å®ƒå¯ä»¥è¯»å–åˆ°æ•°æ®ã€‚æ”¹é€ å‰æ˜¯ç»§æ‰¿<code>StatelessWidget</code>,è¿™é‡Œéœ€è¦æ”¹æˆç»§æ‰¿è‡ª<code>ConsumerWidget</code>.</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> value = ref.watch(helloWorldProvider);<br><br>    <span class="hljs-keyword">return</span> MaterialApp(<br>      home: Scaffold(<br>        appBar: AppBar(title:  Text(<span class="hljs-string">&#x27;ProviderWidget&#x27;</span>)),<br>        body: Center(<br>          child: Text(value),<br>        ),<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œç»§æ‰¿<code>ConsumerWidget</code>ä¹‹åï¼Œ<code>build</code>æ–¹æ³•çš„ç­¾åå˜äº†ï¼Œå¤šäº†ä¸€ä¸ª<code>WidgetRef</code>å¯¹è±¡ï¼Œæˆ‘ä»¬å°±æ˜¯ä½¿ç”¨è¿™ä¸ªå¯¹è±¡æ¥è¯»å–ã€è§‚å¯Ÿã€ç›‘å¬å„ç§ providerã€‚</p><p>é™¤äº†ç»§æ‰¿<code>ConsumerWidget</code>ä¹‹å¤–ï¼Œè¿˜æœ‰å…¶ä»–æ–¹æ¡ˆå¯ä¾›ä½¿ç”¨</p><h4 id="ä½¿ç”¨-Consumer"><a href="#ä½¿ç”¨-Consumer" class="headerlink" title="ä½¿ç”¨ Consumer"></a>ä½¿ç”¨ Consumer</h4><p>åœ¨æ—§ä»£ç ä¸­æ–°å¢ä½¿ç”¨ riverpodï¼Œä½†åˆä¸æ‰“ç®—å¤§é¢ç§¯é‡æ„æ—¶ï¼Œå¯ä»¥è€ƒè™‘è¿™ç§æ–¹æ¡ˆ:ä½¿ç”¨<code>Consumer</code>åŒ…è£¹éœ€è¦æ›´æ–°çš„æ§ä»¶ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_riverpod/flutter_riverpod.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_widget/third_part/riverpod/riverpod_widget.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:widget_with_codeview/widget_with_codeview.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProviderWithConsumer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;ProviderWithConsumer&quot;</span>),<br>        centerTitle: <span class="hljs-keyword">true</span>,<br>      ),<br>      body: WidgetWithCodeView(<br>        child: Column(children: [<br>          Text(<br>            <span class="hljs-string">&quot;æœ‰ä¸€ä¸ªåŒ…å«å¤æ‚å¸ƒå±€çš„å¤§å‹å°éƒ¨ä»¶ç±»ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Consumer æ¥ä»…é‡æ–°æ„å»ºä¾èµ–äºæä¾›è€…çš„å°éƒ¨ä»¶\nåˆ›å»ºå°è€Œå¯é‡ç”¨çš„å°éƒ¨ä»¶æœ‰åˆ©äºç»„åˆï¼Œä½¿ä»£ç æ›´åŠ ç®€æ´ã€æ€§èƒ½æ›´é«˜ï¼Œæ›´æ˜“äºç†è§£ã€‚\nå¦‚æœæ‚¨éµå¾ªè¿™ä¸€åŸåˆ™å¹¶åˆ›å»ºå°è€Œå¯é‡ç”¨çš„å°éƒ¨ä»¶ï¼Œé‚£ä¹ˆå¤§éƒ¨åˆ†æ—¶é—´æ‚¨å°†è‡ªç„¶è€Œç„¶åœ°ä½¿ç”¨ ConsumerWidgetã€‚&quot;</span>,<br>            style: TextStyle(color: Colors.blue, fontSize: <span class="hljs-number">16</span>),<br>          ),<br>          Consumer(builder: (_, ref, __) &#123;<br>            <span class="hljs-keyword">return</span> Text(ref.read(helloWorldProvider));<br>          &#125;)<br>        ]),<br>        filePath: <span class="hljs-string">&quot;lib/third_part/riverpod/provider_with_consumer.dart&quot;</span>,<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸­çš„<code>WidgetWithCodeView</code>æ˜¯ä¸‰æ–¹åº“<code>widget_with_codeview</code>ç”¨æ¥å±•ç¤ºä»£ç çš„æ§ä»¶ã€‚å»é™¤åæ²¡æœ‰å½±å“ã€‚</p><h4 id="ä½¿ç”¨ConsumerStatefulWidget"><a href="#ä½¿ç”¨ConsumerStatefulWidget" class="headerlink" title="ä½¿ç”¨ConsumerStatefulWidget"></a>ä½¿ç”¨ConsumerStatefulWidget</h4><p>ç›¸å¯¹äº<code>ConsumerWidget</code>æ¥ä»£æ›¿<code>StatelessWidget</code>,<code>ä½¿ç”¨ConsumerStatefulWidget</code>æ˜¯ç”¨æ¥ä»£æ›¿<code>StatefulWidget</code>.</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_riverpod/flutter_riverpod.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_widget/third_part/riverpod/riverpod_widget.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:widget_with_codeview/widget_with_codeview.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProviderWithConsumerStatefulWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerStatefulWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  ConsumerState&lt;ProviderWithConsumerStatefulWidget&gt; createState() &#123;<br>    <span class="hljs-keyword">return</span> ProviderWithConsumerStatefulWidgetState();<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProviderWithConsumerStatefulWidgetState</span></span><br><span class="hljs-class">    <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerState</span>&lt;<span class="hljs-title">ProviderWithConsumerStatefulWidget</span>&gt; </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> initState() &#123;<br>    <span class="hljs-keyword">super</span>.initState();<br>    <span class="hljs-comment">// 3. if needed, we can read the provider inside initState</span><br>    <span class="hljs-keyword">final</span> helloWorld = ref.read(helloWorldProvider);<br>    <span class="hljs-built_in">print</span>(helloWorld); <span class="hljs-comment">// &quot;Hello world&quot;</span><br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-comment">// 4. use ref.watch() to get the value of the provider</span><br>    <span class="hljs-keyword">final</span> helloWorld = ref.watch(helloWorldProvider);<br><br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;ProviderWithConsumerStatefulWidget&quot;</span>),<br>        centerTitle: <span class="hljs-keyword">true</span>,<br>      ),<br>      body: WidgetWithCodeView(<br>        child: Column(<br>          children: [<br>            Text(<br>              <span class="hljs-string">&quot;ConsumerStatefulWidgetå¯ä»¥ç”¨æ¥ä»£æ›¿StatefulWidget\nå½“æˆ‘ä»¬ä»ConsumerStateè¿›è¡Œå­ç±»åŒ–æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ‰€æœ‰å°éƒ¨ä»¶ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­è®¿é—®refå¯¹è±¡ã€‚è¿™æ˜¯å› ä¸ºConsumerStateå£°æ˜WidgetRefä½œä¸ºå±æ€§ï¼Œç±»ä¼¼äºFlutterçš„Stateç±»å£°æ˜BuildContextä½œä¸ºå¯ä»¥åœ¨æ‰€æœ‰å°éƒ¨ä»¶ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­ç›´æ¥è®¿é—®çš„å±æ€§ã€‚&quot;</span>,<br>              style: TextStyle(color: Colors.blue, fontSize: <span class="hljs-number">16</span>),<br>            ),<br>            Text(helloWorld),<br>          ],<br>        ),<br>        filePath:<br>            <span class="hljs-string">&quot;lib/third_part/riverpod/provider_with_consumerStatefulWidget.dart&quot;</span>,<br>      ),<br>    );<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>åŒæ ·çš„éœ€è¦ä½¿ç”¨<code>ConsumerState</code>ä»£æ›¿åŸæ¥çš„<code>State</code>.éœ€è¦æ³¨æ„çš„æ˜¯,åœ¨è¿™é‡Œé¢æˆ‘ä»¬å¹¶æ²¡æœ‰çœ‹åˆ°<code>WidgetRef</code>,ä½†æˆ‘ä»¬ä¾æ—§å¯ä»¥åœ¨æ•´ä¸ªé¡µé¢å£°æ˜å‘¨æœŸå†…è®¿é—®<code>WidgetRef</code>å¯¹è±¡çš„å®ä¾‹<code>ref</code>,è¿™æ˜¯å› ä¸º<code>ConsumerState</code>å°†<code>WidgetRef</code>å£°æ˜ä¸ºå±æ€§ã€‚</p><h3 id="WidgetRefæ˜¯ä»€ä¹ˆ"><a href="#WidgetRefæ˜¯ä»€ä¹ˆ" class="headerlink" title="WidgetRefæ˜¯ä»€ä¹ˆ"></a>WidgetRefæ˜¯ä»€ä¹ˆ</h3><p>å®˜æ–¹æ–‡æ¡£å®šä¹‰<code>WidgetRef</code>ä¸ºå…è®¸Widgetså’ŒProvideräº¤äº’çš„å¯¹è±¡ã€‚å¯ä»¥ç”¨æ¥è§‚å¯Ÿ(watch)Provider å€¼çš„æ”¹å˜ï¼Œä¹Ÿå¯ä»¥ä½œä¸º<code>Consumer</code>å’Œ<code>ConsumerWidget</code>çš„å‚æ•°ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥ä½œä¸º<code>ConsumerState</code>çš„å±æ€§ã€‚<br>å°†<code>WidgetRef</code>å’Œ<code>BuildContext</code>åšä¸€ä¸‹æ¯”è¾ƒï¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>BuildContext</code>åœ¨ Widget tree ä¸­è®¿é—®ç¥–å…ˆèŠ‚ç‚¹ï¼Œæ¯”å¦‚<code>Theme.of(context)</code> å’Œ <code>MediaQuery.of(context)</code><br>è€Œ<code>WidgetRef</code>å¯ä»¥è®©æˆ‘ä»¬åœ¨ app ä¸­è®¿é—®ä»»æ„providerï¼Œå‰ææ˜¯providerè¢«å£°æ˜ä¸ºå…¨å±€çš„ã€‚è¿™ä¹Ÿæ˜¯è®¾è®¡çš„åˆè¡·ã€‚<br>å½“ç„¶ï¼Œå°† provider å£°æ˜åœ¨ç±»å†…éƒ¨ï¼Œåªå…è®¸è¯¥ç±»è®¿é—®åœ¨ç¼–è¯‘ã€è¿è¡Œæ—¶ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œä½†è¿™ä¼šå½±å“å…³æ³¨ç‚¹åˆ†ç¦»çš„åŸåˆ™ã€‚</p><h3 id="å…«ä¸­ä¸åŒçš„-Provider"><a href="#å…«ä¸­ä¸åŒçš„-Provider" class="headerlink" title="å…«ä¸­ä¸åŒçš„ Provider"></a>å…«ä¸­ä¸åŒçš„ Provider</h3><ul><li>Provider</li><li><del>StateProvider</del> (è¢«NotifierProviderä»£æ›¿)</li><li><del>StateNotifierProvider</del> (è¢«NotifierProviderä»£æ›¿)</li><li>FutureProvider</li><li>StreamProvider</li><li><del>ChangeNotifierProvider</del> (è¢«NotifierProviderä»£æ›¿)</li><li>NotifierProvider (Riverpod 2.0æ–°å¢)</li><li>AsyncNotifierProvider (Riverpod 2.0æ–°å¢)</li></ul><p>ä»¥åä¼šæåˆ°ä½¿ç”¨<code>riverpod_generator</code>åŒ…ä¸­çš„<code>@riverpod</code>æ³¨è§£æ¥ä»£æ›¿æˆ‘ä»¬çš„æ‰‹åŠ¨å£°æ˜provider</p><h4 id="Provider"><a href="#Provider" class="headerlink" title="Provider"></a>Provider</h4><p>ä¸Šé¢ç¤ºä¾‹ä¸­çš„ä»£ç å°±æ˜¯ç”¨çš„è¿™ä¸€ä¸ªï¼Œæ›´é€‚åˆæä¾›ä¸€äº›ä¸ä¼šå˜çš„å¸¸é‡å€¼ï¼Œæ¯”å¦‚ Dio å®ä¾‹ã€ç‰ˆæœ¬å·ã€æ ¼å¼åŒ–å¯¹è±¡ã€æ•°æ®åº“å¯¹è±¡ç­‰</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> dateFormatterProvider = Provider&lt;DateFormat&gt;((ref) &#123;<br>  <span class="hljs-keyword">return</span> DateFormat.MMMEd();<br>&#125;);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-comment">// retrieve the formatter</span><br>    <span class="hljs-keyword">final</span> formatter = ref.watch(dateFormatterProvider);<br>    <span class="hljs-comment">// use it</span><br>    <span class="hljs-keyword">return</span> Text(formatter.format(<span class="hljs-built_in">DateTime</span>.now()));<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="StateProvider"><a href="#StateProvider" class="headerlink" title="StateProvider"></a>StateProvider</h4><p>å¯ä»¥ç”¨æ¥å­˜å‚¨ä¸€äº›ç®€å•çš„å˜é‡ï¼Œæ¯”å¦‚è®¡æ•°å™¨</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_riverpod/flutter_riverpod.dart&#x27;</span>;<br><br><span class="hljs-keyword">final</span> globalStateProvider = StateProvider((ref) =&gt; <span class="hljs-number">1</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StateProviderDemoWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>  <span class="hljs-comment">//ä¸æ¨è</span><br>  <span class="hljs-keyword">final</span> localStateProvider = StateProvider((ref) =&gt; <span class="hljs-number">1</span>);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;StateProviderDemoWidget&quot;</span>),<br>        centerTitle: <span class="hljs-keyword">true</span>,<br>      ),<br>      body: Center(<br>          child: Flex(<br>        direction: Axis.vertical,<br>        children: [<br>          Text(<span class="hljs-string">&quot;globalStateProvider count <span class="hljs-subst">$&#123;ref.watch(globalStateProvider)&#125;</span>&quot;</span>),<br>          Text(<span class="hljs-string">&quot;localStateProvider count <span class="hljs-subst">$&#123;ref.watch(localStateProvider)&#125;</span>&quot;</span>),<br>          Text(<br>            <span class="hljs-string">&quot;StateProvider.stateæ ‡è®°ä¸ºè¿‡æ—¶ï¼Œå¹¶å°†åœ¨3.0ç§»é™¤&quot;</span>,<br>            style: TextStyle(color: Colors.red, fontSize: <span class="hljs-number">14</span>),<br>          ),<br>          Text(<span class="hljs-string">&quot;å£°æ˜ä¸ºå…¨å±€ï¼Œåˆ™çŠ¶æ€ä¸€ç›´è¢«ä¿å­˜ï¼Œç›´åˆ°åº”ç”¨é‡å¯ã€‚&quot;</span>,<br>              style: TextStyle(color: Colors.blue, fontSize: <span class="hljs-number">14</span>)),<br>          Text(<span class="hljs-string">&quot;å£°æ˜ä¸ºç±»æˆå‘˜ï¼Œåˆ™é¡µé¢é‡å¯åˆ™é‡æ–°åˆå§‹åŒ–ã€‚&quot;</span>,<br>              style: TextStyle(color: Colors.blue, fontSize: <span class="hljs-number">14</span>)),<br>          Text(<span class="hljs-string">&quot;StateProvideré€‚ç”¨äºå­˜å‚¨ç®€å•çš„çŠ¶æ€å˜é‡ï¼Œå¦‚æšä¸¾ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼å’Œæ•°å­—&quot;</span>,<br>              style: TextStyle(color: Colors.blue, fontSize: <span class="hljs-number">14</span>)),<br>          IconButton(<br>            icon: Icon(Icons.plus_one_sharp),<br>            onPressed: () &#123;<br>              ref.read(globalStateProvider.notifier).state++;<br>              ref.read(localStateProvider.notifier).state++;<br>            &#125;,<br>          ),<br>        ],<br>      )),<br>    );<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€äº›æœ‰æ„æ€çš„äº‹æƒ…ã€‚æˆ‘ä»¬å£°æ˜äº†ä¸¤ä¸ª Providerï¼Œä¸€ä¸ªæ˜¯å…¨å±€çš„ï¼Œä¸€ä¸ªæ˜¯ç±»å†…éƒ¨çš„ã€‚<br>å½“æˆ‘ä»¬æ‰“å¼€é¡µé¢ç‚¹å‡»å‡ æ¬¡æŒ‰é’®ä¹‹åï¼Œé¡µé¢å†…å®¹æ›´æ–°ï¼Œè¿™æ—¶å€™æˆ‘ä»¬è¿”å›ä¸Šä¸€é¡µå†æ¬¡æ‰“å¼€è¿™ä¸ªé¡µé¢ï¼Œä¼šå‘ç°<code>globalStateProvider</code>æä¾›çš„å€¼è¿˜æ˜¯ä¸Šä¸€æ¬¡è¿”å›æ—¶å€™çš„å€¼ï¼Œè€Œ<code>localStateProvider</code>æä¾›çš„å€¼æ˜¯åˆå§‹å€¼ã€‚å› ä¸º<code>localStateProvider</code>åœ¨é¡µé¢å…³é—­æ—¶å°±è¢«é”€æ¯äº†ï¼Œè¿™ç§æƒ…å†µä¼¼ä¹æ›´ç¬¦åˆæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ riverpod çš„ä¹ æƒ¯ã€‚è¿™é‡Œå¯ä»¥ä½¿ç”¨ autoDispose è®©<code>globalStateProvider</code>åœ¨æ‰€æœ‰ watcher è¢«é”€æ¯ä¹Ÿå¯ä»¥é‡ç½®ã€‚</p><h4 id="StateNotifierProvider"><a href="#StateNotifierProvider" class="headerlink" title="StateNotifierProvider"></a>StateNotifierProvider</h4><p>å¯ä»¥ç”¨å®ƒæ¥ç›‘å¬å’Œå¯¼å‡ºä¸€ä¸ª <code>StateNotifier</code> ,<code>StateNotifierProvider</code> å’Œ <code>StateNotifier</code> éå¸¸é€‚åˆç®¡ç†å› äº‹ä»¶æˆ–ç”¨æˆ·äº¤äº’è€Œæ”¹å˜çš„çŠ¶æ€ã€‚è¿™é‡Œæœ‰ä¸€ä¸ª <code>todolist</code>ç¤ºä¾‹ã€‚<br>æˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ª todo çš„å¯¹è±¡,å®ç°ä¸€ä¸ª copyWith æ–¹æ³•æ¥å¤åˆ¶å½“å‰å¯¹è±¡ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@immutable</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Todo</span> </span>&#123;<br>  <span class="hljs-keyword">const</span> Todo(<br>      &#123;<span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.id, <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.description, <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.completed&#125;);<br><br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> id;<br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> description;<br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> completed;<br>  Todo copyWith(&#123;<span class="hljs-built_in">String?</span> id, <span class="hljs-built_in">String?</span> description, <span class="hljs-built_in">bool?</span> completed&#125;) &#123;<br>    <span class="hljs-keyword">return</span> Todo(<br>      id: id ?? <span class="hljs-keyword">this</span>.id,<br>      description: description ?? <span class="hljs-keyword">this</span>.description,<br>      completed: completed ?? <span class="hljs-keyword">this</span>.completed,<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬ç»§æ‰¿<code>StateNotifier</code>å®ç°è‡ªå·±çš„<code>TodosNotifier</code>ç±»ï¼Œå¹¶å®Œå–„æ‰€éœ€é€»è¾‘</p><ol><li>ç»Ÿè®¡å·²å®Œæˆçš„å¾…åŠ</li><li>æ·»åŠ å¾…åŠ</li><li>åˆ é™¤å¾…åŠ</li><li>å®Œæˆã€å–æ¶ˆå®Œæˆå¾…åŠ</li><li>å…¨é€‰ï¼Œåå…¨é€‰</li><li>æ˜¯å¦é€‰ä¸­å…¨éƒ¨</li></ol><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs dart"><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TodosNotifier</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StateNotifier</span>&lt;<span class="hljs-title">List</span>&lt;<span class="hljs-title">Todo</span>&gt;&gt; </span>&#123;<br>  TodosNotifier() : <span class="hljs-keyword">super</span>([]);<br><br>  <span class="hljs-keyword">void</span> addTodo(Todo todo) &#123;<br>    state = [...state, todo];<br>  &#125;<br><br>  <span class="hljs-built_in">int</span> completedCount() &#123;<br>    <span class="hljs-built_in">int</span> count = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> todo <span class="hljs-keyword">in</span> state) &#123;<br>      <span class="hljs-keyword">if</span> (todo.completed) &#123;<br>        count++;<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> count;<br>  &#125;<br><br>  <span class="hljs-keyword">void</span> removeTodo(<span class="hljs-built_in">String</span> todoId) &#123;<br>    state = [<br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> todo <span class="hljs-keyword">in</span> state)<br>        <span class="hljs-keyword">if</span> (todo.id != todoId) todo,<br>    ];<br>  &#125;<br><br>  <span class="hljs-keyword">void</span> toggle(<span class="hljs-built_in">String</span> todoID) &#123;<br>    state = [<br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> todo <span class="hljs-keyword">in</span> state)<br>        <span class="hljs-keyword">if</span> (todo.id == todoID)<br>          todo.copyWith(completed: !todo.completed)<br>        <span class="hljs-keyword">else</span><br>          todo<br>    ];<br>  &#125;<br><br>  <span class="hljs-keyword">void</span> selectAll() &#123;<br>    state = [<span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> todo <span class="hljs-keyword">in</span> state) todo.copyWith(completed: <span class="hljs-keyword">true</span>)];<br>  &#125;<br><br>  <span class="hljs-keyword">void</span> unSelectAll() &#123;<br>    state = [<span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> todo <span class="hljs-keyword">in</span> state) todo.copyWith(completed: <span class="hljs-keyword">false</span>)];<br>  &#125;<br><br>  <span class="hljs-built_in">bool</span> isSelectAll() &#123;<br>    <span class="hljs-built_in">bool</span> result = <span class="hljs-keyword">true</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> todo <span class="hljs-keyword">in</span> state) &#123;<br>      <span class="hljs-keyword">if</span> (!todo.completed) &#123;<br>        result = <span class="hljs-keyword">false</span>;<br>        <span class="hljs-keyword">break</span>;<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> result;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€å£°æ˜ä¸€ä¸ªå…¨å±€çš„<code>StateNotifierProvider</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> todoProvider =<br>    StateNotifierProvider&lt;TodosNotifier, <span class="hljs-built_in">List</span>&lt;Todo&gt;&gt;((ref) =&gt; TodosNotifier());<br></code></pre></td></tr></table></figure><p>æœ€åæˆ‘ä»¬å°±å¯ä»¥åœ¨é¡µé¢ä¸­ä½¿ç”¨äº†</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_riverpod/flutter_riverpod.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StateNotifierProviderWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-built_in">List</span>&lt;Todo&gt; todos = ref.watch(todoProvider);<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;State Notifier Provider Widget&quot;</span>),<br>        centerTitle: <span class="hljs-keyword">true</span>,<br>      ),<br>      body: Column(<br>        children: [<br>          Text(<span class="hljs-string">&quot;StateNotifierProviderå’ŒStateNotifieréå¸¸é€‚åˆç®¡ç†å¯èƒ½ä¼šå› äº‹ä»¶æˆ–ç”¨æˆ·äº¤äº’è€Œå‘ç”Ÿå˜åŒ–çš„çŠ¶æ€ã€‚&quot;</span>),<br>          Text(<span class="hljs-string">&quot;æ³¨æ„StateNotifierä¸­é€šçŸ¥æ›´æ–°æ—¶æ˜¯æ¯”è¾ƒçš„å¯¹è±¡å†…å­˜åœ°å€&quot;</span>),<br>          Divider(),<br>          Container(<br>            child: Text(<br>                <span class="hljs-string">&quot;å…±<span class="hljs-subst">$&#123;todos.length.toString()&#125;</span>,å®Œæˆ-ã€‹<span class="hljs-subst">$&#123;ref.read(todoProvider.notifier).completedCount()&#125;</span>&quot;</span>),<br>          ),<br>          CheckboxListTile(<br>            value: ref.read(todoProvider.notifier).isSelectAll(),<br>            onChanged: (value) &#123;<br>              <span class="hljs-keyword">if</span> (value ?? <span class="hljs-keyword">false</span>) &#123;<br>                ref.read(todoProvider.notifier).selectAll();<br>              &#125; <span class="hljs-keyword">else</span> &#123;<br>                ref.read(todoProvider.notifier).unSelectAll();<br>              &#125;<br>            &#125;,<br>            title: Text(<span class="hljs-string">&quot;å…¨é€‰&quot;</span>),<br>          ),<br>          Expanded(<br>              child: ListView(<br>            shrinkWrap: <span class="hljs-keyword">true</span>,<br>            children: [<br>              <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> todo <span class="hljs-keyword">in</span> todos)<br>                Dismissible(<br>                  key: Key(todo.id),<br>                  child: CheckboxListTile(<br>                    value: todo.completed,<br>                    onChanged: (value) =&gt;<br>                        ref.read(todoProvider.notifier).toggle(todo.id),<br>                    title: Text(todo.description),<br>                  ),<br>                  onDismissed: (direction) =&gt;<br>                      &#123;ref.read(todoProvider.notifier).removeTodo(todo.id)&#125;,<br>                ),<br>            ],<br>          )),<br>        ],<br>      ),<br>      floatingActionButton: FloatingActionButton(<br>        child: <span class="hljs-keyword">const</span> Icon(Icons.add),<br>        onPressed: () &#123;<br>          <span class="hljs-keyword">final</span> notifier = ref.read(todoProvider.notifier);<br>          notifier.addTodo(Todo(<br>              id: <span class="hljs-built_in">DateTime</span>.now().microsecond.toString(),<br>              description: <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;DateTime.now().microsecondsSinceEpoch&#125;</span>&quot;</span>,<br>              completed: <span class="hljs-keyword">false</span>));<br>        &#125;,<br>      ),<br>    );<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†ä¸€ä¸ªç®€æ˜“ç‰ˆçš„å¾…åŠé¡µé¢</p><p><img src="/image/riverpod/state_notifier_demo.png" alt="state_notifier_demo"></p><h4 id="FutureProvider"><a href="#FutureProvider" class="headerlink" title="FutureProvider"></a>FutureProvider</h4><p>æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸€äº›è€—æ—¶æ“ä½œï¼Œæ¯”å¦‚è¯·æ±‚æœåŠ¡å™¨æ¥å£è·å–åˆ°æ•°æ®åå±•ç¤ºåœ¨é¡µé¢ä¸Šï¼›æ¯”å¦‚è¯»å–é…ç½®æ–‡ä»¶ç­‰ã€‚è¿™ç§æƒ…å†µæˆ‘ä»¬å°±éœ€è¦ <code>FutureProvider</code>äº†ã€‚<br>è¿™é‡Œä»¥è¯»å– assets ä¸­çš„é…ç½®æ–‡ä»¶ä¸ºä¾‹:<br>é¦–å…ˆå£°æ˜ä¸€ä¸ª<code>FutureProvider</code>æ³›å‹ä¸­å¡«å…¥è¿”å›å€¼ï¼Œä½¿ç”¨<code>rootBundle.loadString</code>æ¥è¯»å–èµ„æºæ–‡ä»¶çš„å†…å®¹ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> getConfigFutureProvider =<br>    FutureProvider&lt;<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;&gt;((ref) <span class="hljs-keyword">async</span> &#123;<br>  <span class="hljs-built_in">String</span> configContant =<br>      <span class="hljs-keyword">await</span> rootBundle.loadString(<span class="hljs-string">&quot;assets/fake_configurations.json&quot;</span>);<br>  <span class="hljs-keyword">final</span> configMap = jsonDecode(configContant) <span class="hljs-keyword">as</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;;<br>  <span class="hljs-keyword">return</span> configMap;<br>&#125;);<br></code></pre></td></tr></table></figure><p>ç„¶åå†å£°æ˜ä¸€ä¸ªç”¨æ¥æ¨¡æ‹Ÿè¯·æ±‚æœåŠ¡ç«¯çš„<code>FutureProvider</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> wordPairProvider = FutureProvider&lt;<span class="hljs-built_in">String</span>&gt;((ref)  <span class="hljs-keyword">async</span>&#123;<br>  <span class="hljs-keyword">final</span> wordPair = generateWordPairs().first;<br>  <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">2</span>));<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;wordPair.first&#125;</span> - <span class="hljs-subst">$&#123;wordPair.second&#125;</span>&quot;</span>;<br>&#125;);<br></code></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œçš„<code>generateWordPairs</code>æ˜¯ä¸‰æ–¹åŒ…<code>english_words: ^4.0.0</code>æä¾›çš„ã€‚åœ¨<code>wordPairProvider</code>ä¸­æˆ‘ä»¬å»¶è¿Ÿ 2 ç§’è¿”å›äº†ç»“æœï¼Œç”¨ä»¥æ¨¡æ‹Ÿç½‘ç»œè€—æ—¶ã€‚<br>åœ¨é¡µé¢ä¸­æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆä½¿ç”¨:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs dart"><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FutureProviderWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-keyword">final</span> AsyncValue&lt;<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;&gt; getConfigResult =<br>        ref.watch(getConfigFutureProvider);<br>    <span class="hljs-keyword">final</span> AsyncValue&lt;<span class="hljs-built_in">String</span>&gt; wordPairResult = ref.watch(wordPairProvider);<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;FutureProvider&quot;</span>),<br>        centerTitle: <span class="hljs-keyword">true</span>,<br>      ),<br>      body: RefreshIndicator(<br>        onRefresh: () =&gt; ref.refresh(wordPairProvider.future),<br>        child: ListView(<br>          children: [<br>            getConfigResult.when(<br>                data: (data) &#123;<br>                  <span class="hljs-keyword">return</span> Text(data.toString());<br>                &#125;,<br>                error: (error, stack) &#123;<br>                  <span class="hljs-keyword">return</span> Text(error.toString());<br>                &#125;,<br>                loading: () =&gt; <span class="hljs-keyword">const</span> CircularProgressIndicator()),<br>            wordPairResult.when(data: (data) &#123;<br>              <span class="hljs-keyword">return</span> Text(data);<br>            &#125;, error: (error, stack) &#123;<br>              <span class="hljs-keyword">return</span> ElevatedButton(<br>                  onPressed: () &#123;<br>                    ref.refresh(wordPairProvider.future);<br>                  &#125;,<br>                  child: Text(<span class="hljs-string">&quot;ç‚¹å‡»åˆ·æ–°&quot;</span>));<br>            &#125;, loading: () &#123;<br>              <span class="hljs-keyword">return</span> CircularProgressIndicator();<br>            &#125;),<br>          ],<br>        ),<br>      ),<br>    );<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<code>ref.watch(FutureProvider)</code>çš„è¿”å›å€¼æ˜¯AsyncValueç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡å¼åŒ¹é…çš„æ–¹å¼æ¥æ›´æ–°UIã€‚è¿™é‡Œä¼šæœ‰ä¸‰ä¸ªçŠ¶æ€:data,loading,errorã€‚<br>æˆ‘ä»¬åœ¨é¡µé¢ä¸Šæ·»åŠ äº†ä¸€ä¸ªä¸‹æ‹‰åˆ·æ–°çš„æ§ä»·æ¥åˆ·æ–°æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚çš„ provider:<code>ref.refresh(wordPairProvider.future)</code>ã€‚</p><ul><li>FutureProvideråŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œå¯ä»¥ç”¨å®ƒæ¥</li><li>æ‰§è¡Œå’Œç¼“å­˜å¼‚æ­¥æ“ä½œï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ï¼‰</li><li>å¤„ç†å¼‚æ­¥æ“ä½œçš„é”™è¯¯å’ŒåŠ è½½çŠ¶æ€</li><li>å°†å¤šä¸ªå¼‚æ­¥å€¼åˆå¹¶ä¸ºå¦ä¸€ä¸ªå€¼</li><li>é‡æ–°è·å–å’Œåˆ·æ–°æ•°æ®ï¼ˆé€‚ç”¨äºæ‹‰åˆ°åˆ·æ–°æ“ä½œï¼‰<br>å¦‚æœé€€å‡ºé¡µé¢éœ€è¦é‡æ–°è¿›è¡Œåˆ·æ–°ï¼Œæˆ‘ä»¬å¯ä»¥é…åˆautoDisposeä½¿ç”¨:<code>FutureProvider.autoDispose&lt;String&gt;((ref) async &#123;&#125;</code></li></ul><h4 id="StreamProvider"><a href="#StreamProvider" class="headerlink" title="StreamProvider"></a>StreamProvider</h4><p>è¿™é‡Œä¾‹å­ä¸å¤§å¥½å†™ï¼Œå®ƒå’Œ FutureProvider ç±»ä¼¼ï¼Œè¢« watch æ—¶è¿”å›çš„ä¹Ÿæ˜¯ AsyncValue ç±»å‹ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªè®¡æ—¶å™¨çš„ç¤ºä¾‹ã€‚<br>åŒæ ·çš„ï¼Œå…ˆå£°æ˜ä¸€ä¸ª<code>StreamProvider</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> streamProvider = StreamProvider.autoDispose&lt;<span class="hljs-built_in">int</span>&gt;((ref) &#123;<br>    ref.onDispose(() &#123;<br>      debugPrint(<span class="hljs-string">&quot;streamProvider autoDispose&quot;</span>);<br>    &#125;);<br><br>    <span class="hljs-keyword">return</span> Stream.periodic(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">1</span>), (number) &#123;<br>      <span class="hljs-keyword">return</span> number + <span class="hljs-number">1</span>;<br>    &#125;);<br>  &#125;);<br><br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨é¡µé¢ä¸­ä½¿ç”¨</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs dart"><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StreamProviderWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-keyword">final</span> AsyncValue&lt;<span class="hljs-built_in">int</span>&gt; streamResult = ref.watch(streamProvider);<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;StreamProviderWidget&quot;</span>),<br>        centerTitle: <span class="hljs-keyword">true</span>,<br>      ),<br>      body: Column(<br>        children: [<br>          Text(streamResult.toString()),<br>          streamResult.when(<br>                  data: (data) &#123;<br>                    <span class="hljs-keyword">return</span> Text(data.toString());<br>                  &#125;,<br>                  error: (error, stack) &#123;<br>                    <span class="hljs-keyword">return</span> Text(error.toString());<br>                  &#125;,<br>                  loading: () =&gt; CircularProgressIndicator())<br>        ],<br>      ),<br>    );<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="ChangeNotifierProvider"><a href="#ChangeNotifierProvider" class="headerlink" title="ChangeNotifierProvider"></a>ChangeNotifierProvider</h4><p>å»ºè®®ä½¿ç”¨ NotifierProvider ä»£æ›¿ã€‚<br>è¿™é‡Œæ˜¯ä¸€ä¸ªè®¡æ•°å™¨ç¤ºä¾‹ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs dart"><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CounterNotifier</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ChangeNotifier</span> </span>&#123;<br>  <span class="hljs-built_in">int</span> _count = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">int</span> <span class="hljs-keyword">get</span> count =&gt; _count;<br>  <span class="hljs-keyword">void</span> increment() &#123;<br>    _count++;<br>    notifyListeners(); <span class="hljs-comment">// å½“è®¡æ•°å™¨å€¼æ”¹å˜æ—¶é€šçŸ¥æ‰€æœ‰ç›‘å¬è€…</span><br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// å®šä¹‰ChangeNotifierProvider</span><br><span class="hljs-keyword">final</span> counterProvider = ChangeNotifierProvider&lt;CounterNotifier&gt;((ref) &#123;<br>  <span class="hljs-keyword">return</span> CounterNotifier();<br>&#125;);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChangeNotifierProviderWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span></span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-keyword">return</span>  Scaffold(<br>        appBar: AppBar(title: Text(<span class="hljs-string">&#x27;ChangeNotifierProviderWidget&#x27;</span>)),<br>        body: Center(<br>          child: Consumer(builder: (context, ref, _) &#123; <span class="hljs-comment">// ä½¿ç”¨Consumerè¯»å–å¹¶æ˜¾ç¤ºçŠ¶æ€</span><br>            <span class="hljs-keyword">final</span> counter = ref.watch(counterProvider);<br>            <span class="hljs-keyword">return</span> Text(<span class="hljs-string">&#x27;Count: <span class="hljs-subst">$&#123;counter.count&#125;</span>&#x27;</span>);<br>          &#125;),<br>        ),<br>        floatingActionButton: FloatingActionButton(<br>          onPressed: () &#123;<br>            <span class="hljs-comment">// åœ¨ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œé€šè¿‡refè°ƒç”¨notifierçš„æ–¹æ³•æ›´æ–°çŠ¶æ€</span><br>            ref.read(counterProvider.notifier).increment();<br>          &#125;,<br>          child: Icon(Icons.add),<br>        ),<br>      );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="NotifierProvider"><a href="#NotifierProvider" class="headerlink" title="NotifierProvider"></a>NotifierProvider</h4><p>ç”¨æ¥ä»£æ›¿ StateProvider å’Œ ChangeNotifierProviderã€‚<br>åŒæ ·çš„ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªæ•°æ®ç±» Student</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> </span>&#123;<br>  Student(&#123;<span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.name, <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.id&#125;);<br>  <span class="hljs-built_in">String</span> name;<br>  <span class="hljs-built_in">String</span> id;<br><br>  Student copyWith(&#123;<span class="hljs-built_in">String?</span> copyID, <span class="hljs-built_in">String?</span> copyName&#125;) &#123;<br>    <span class="hljs-keyword">return</span> Student(name: copyName ?? <span class="hljs-keyword">this</span>.name, id: copyID ?? <span class="hljs-keyword">this</span>.id);<br>  &#125;<br>  <span class="hljs-built_in">String</span> toString()&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;<span class="hljs-subst">$id</span> : <span class="hljs-subst">$name</span>&quot;</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®šä¹‰ä¸€ä¸ªç»§æ‰¿è‡ª Notifier çš„ç±»</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs dart"><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StudentNotifier</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Notifier</span>&lt;<span class="hljs-title">Student</span>&gt; </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Student build() &#123;<br>    <span class="hljs-keyword">return</span> generateStudent();<br>  &#125;<br><br>  Student generateStudent() &#123;<br>    <span class="hljs-keyword">final</span> wordPair = generateWordPairs().first;<br>    <span class="hljs-keyword">final</span> id = Random().nextInt(<span class="hljs-number">100</span>);<br><br>    <span class="hljs-keyword">return</span> Student(<br>        name: <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;wordPair.first&#125;</span> - <span class="hljs-subst">$&#123;wordPair.second&#125;</span>&quot;</span>, id: id.toString());<br>  &#125;<br><br>  <span class="hljs-built_in">String</span> toString() &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;state.id&#125;</span> : <span class="hljs-subst">$&#123;state.name&#125;</span>&quot;</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">void</span> change() &#123;<br>    state = generateStudent();<br>  &#125;<br><br>  <span class="hljs-keyword">void</span> changeNameWithCopy(<span class="hljs-built_in">String</span> name) &#123;<br>    state = state.copyWith(copyName: name);<br>  &#125;<br><br>  <span class="hljs-keyword">void</span> justChangeName(<span class="hljs-built_in">String</span> name) &#123;<br>    state.name = name;<br>  &#125;<br><br>  <span class="hljs-keyword">void</span> changeIdWithCopy(<span class="hljs-built_in">String</span> id) &#123;<br>    state = state.copyWith(copyID: id);<br>  &#125;<br><br>  <span class="hljs-keyword">void</span> justChangeId(<span class="hljs-built_in">String</span> id) &#123;<br>    state.id = id;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œè¿™é‡Œçš„ build æ–¹æ³•æ˜¯å¿…é¡»çš„ã€‚åŒæ—¶ä¸ºäº†è§£é‡Šåˆ·æ–°é¡µé¢çš„æ¡ä»¶ï¼Œè¿™é‡Œå®šä¹‰äº†å‡ ä¸ªæ”¹å˜å±æ€§çš„æ–¹æ³•ã€‚xxxWithCopyæ˜¯é‡æ–°ç”Ÿæˆäº†å¯¹è±¡ï¼Œjustxxx åˆ™æ˜¯åœ¨åŸå¯¹è±¡ä¸Šç›´æ¥ä¿®æ”¹å±æ€§å€¼ã€‚<br>ç„¶åå£°æ˜<code>NotifierProvider</code>,è¿™é‡Œæä¾›äº†ä¸¤ç§æ–¹å¼ï¼Œå“ªä¸€ç§éƒ½å¯ä»¥ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> counterProvider = NotifierProvider&lt;StudentNotifier, Student&gt;(() &#123;<br>  <span class="hljs-keyword">return</span> StudentNotifier();<br>&#125;);<br><span class="hljs-keyword">final</span> counterProviderOther =<br>    NotifierProvider&lt;StudentNotifier, Student&gt;(StudentNotifier.<span class="hljs-keyword">new</span>);<br></code></pre></td></tr></table></figure><p>åœ¨é¡µé¢ä¸­æˆ‘ä»¬è¿™æ ·ä½¿ç”¨</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs dart"><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CounterNotifierWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-keyword">final</span> student = ref.watch(counterProvider);<br>    ref.listen(counterProvider, (oldValue, newValue) &#123;<br>      logger.d(<br>          <span class="hljs-string">&quot;oldValue--&gt; <span class="hljs-subst">$&#123;oldValue?.id.toString()&#125;</span> \n newValue--&gt; <span class="hljs-subst">$&#123;newValue.id&#125;</span>&quot;</span>);<br>    &#125;);<br><br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;CounterNotifierWidget&quot;</span>),<br>        centerTitle: <span class="hljs-keyword">true</span>,<br>      ),<br>      body: Column(<br>        children: [<br>          Text(<span class="hljs-string">&quot;student <span class="hljs-subst">$&#123;student.id.toString()&#125;</span> : <span class="hljs-subst">$&#123;student.name&#125;</span>  --&gt; <span class="hljs-subst">$&#123;student.toString()&#125;</span>&quot;</span>),<br><br>          ElevatedButton(<br>              onPressed: () &#123;<br>                ref<br>                    .read(counterProvider.notifier)<br>                    .changeIdWithCopy(Random().nextInt(<span class="hljs-number">100</span>).toString());<br>              &#125;,<br>              child: Text(<span class="hljs-string">&quot;changeIdWithCopy&quot;</span>)),<br>          ElevatedButton(<br>              onPressed: () &#123;<br>                <span class="hljs-keyword">final</span> wordPair = generateWordPairs().first;<br>                ref.read(counterProvider.notifier).changeNameWithCopy(<br>                    <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;wordPair.first&#125;</span> - -<span class="hljs-subst">$&#123;wordPair.second&#125;</span>&quot;</span>);<br>              &#125;,<br>              child: Text(<span class="hljs-string">&quot;changeNameWithCopy&quot;</span>)),<br><br>          ElevatedButton(<br>              onPressed: () &#123;<br>                ref<br>                    .read(counterProvider.notifier)<br>                    .justChangeId(Random().nextInt(<span class="hljs-number">100</span>).toString());<br>              &#125;,<br>              child: Text(<span class="hljs-string">&quot;justChangeId&quot;</span>)),<br>          ElevatedButton(<br>              onPressed: () &#123;<br>                <span class="hljs-keyword">final</span> wordPair = generateWordPairs().first;<br>                ref<br>                    .read(counterProvider.notifier)<br>                    .justChangeName(<span class="hljs-string">&quot;<span class="hljs-subst">$&#123;wordPair.first&#125;</span> - -<span class="hljs-subst">$&#123;wordPair.second&#125;</span>&quot;</span>);<br>              &#125;,<br>              child: Text(<span class="hljs-string">&quot;justChangeName&quot;</span>)),<br>        ],<br>      ),<br>      floatingActionButton: FloatingActionButton(<br>        onPressed: () &#123;<br>          ref.read(counterProvider.notifier).change();<br>        &#125;,<br>        child: Icon(Icons.change_circle),<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œä¹‹åå¯ä»¥çœ‹åˆ°ï¼Œåªæœ‰å½“æˆ‘ä»¬è°ƒç”¨<code>xxxwithCopy</code>æ—¶æ‰ä¼šåˆ·æ–°é¡µé¢ã€‚æˆ³åˆ°<code>NotifierProviderElement</code>æºç ä¸­æŸ¥çœ‹<code>updateShouldNotify</code>æ–¹æ³•ï¼Œå‘ç°æ˜¯è°ƒç”¨çš„identical(previous, next)æ–¹æ³•æ¥åšåˆ¤æ–­çš„ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@protected</span><br><span class="hljs-built_in">bool</span> updateShouldNotify(State previous, State next) &#123;<br>  <span class="hljs-keyword">return</span> !identical(previous, next);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="AsyncNotifierProvider"><a href="#AsyncNotifierProvider" class="headerlink" title="AsyncNotifierProvider"></a>AsyncNotifierProvider</h4><p>ç›¸æ¯”<code>NotifierProvider</code>,å®ƒæ˜¯å¼‚æ­¥è€Œå·².<br>è¿˜æ˜¯å…ˆå£°æ˜ä¸€ä¸ªæ•°æ®ç±»Student</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span></span>&#123;<br>  Student(&#123;<span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.name,<span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.id&#125;);<br>  <span class="hljs-built_in">String</span> name;<br>  <span class="hljs-built_in">String</span> id;<br><br>  <span class="hljs-built_in">String</span> toString()&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;<span class="hljs-subst">$id</span> - <span class="hljs-subst">$name</span>&quot;</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å£°æ˜ä¸€ä¸ªç»§æ‰¿è‡ªAsyncNotifierçš„ç±»</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs dart"><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StudentAsyncNotifier</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AsyncNotifier</span>&lt;<span class="hljs-title">Student</span>&gt;</span>&#123;<br>  <span class="hljs-meta">@override</span><br>  FutureOr&lt;Student&gt; build() <span class="hljs-keyword">async</span> &#123;<br><br>      <span class="hljs-keyword">return</span> getInfo();<br>  &#125;<br><br> Future&lt;Student&gt; getInfo()<span class="hljs-keyword">async</span>&#123;<br>    <br>    <span class="hljs-keyword">await</span>  Future.delayed(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">3</span>));<br>    <span class="hljs-keyword">final</span> wordPair = generateWordPairs().first;<br>    <span class="hljs-keyword">return</span> Student(name: <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;wordPair.first&#125;</span> - <span class="hljs-subst">$&#123;wordPair.second&#125;</span>&quot;</span>, id: Random().nextInt(<span class="hljs-number">100</span>).toString());<br>    <br>  &#125; <br><br>  Future&lt;<span class="hljs-keyword">void</span>&gt; refresh() <span class="hljs-keyword">async</span>&#123;<br>      state = AsyncValue.loading();<br>      state = <span class="hljs-keyword">await</span> AsyncValue.guard(()<span class="hljs-keyword">async</span> &#123;<br>        <span class="hljs-keyword">return</span> getInfo();<br>      &#125;);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å£°æ˜ä¸€ä¸ª Provider</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> studentAsyncNotifier = AsyncNotifierProvider&lt;StudentAsyncNotifier, Student&gt;(() &#123;<br>  <span class="hljs-keyword">return</span> StudentAsyncNotifier();<br>&#125;);<br></code></pre></td></tr></table></figure><p>åœ¨é¡µé¢ä¸­ä½¿ç”¨</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs dart"><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AsyncNotifierProviderWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span></span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br><br>    <span class="hljs-keyword">final</span> asyncValue = ref.watch(studentAsyncNotifier);<br><br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(title: Text(<span class="hljs-string">&quot;AsyncNotifierProviderWidget&quot;</span>),centerTitle: <span class="hljs-keyword">false</span>,),<br>      body: asyncValue.when(data: (data)&#123;<br>       <span class="hljs-keyword">return</span> Center(child: Text(data .toString()),);<br>      &#125;, error: (error,stack)&#123;<br>       <span class="hljs-keyword">return</span> Center(child: Text(error.toString()),);<br>      &#125;, loading: ()&#123;<br>        <span class="hljs-keyword">return</span> Center(child: CircularProgressIndicator());<br>      &#125;),<br>      floatingActionButton: FloatingActionButton(onPressed: ()&#123;<br>        ref.read(studentAsyncNotifier.notifier).refresh();<br>      &#125;,child: Icon(Icons.refresh),),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šä½¿ç”¨AsyncNotifierä¸autoDisposeçš„æ­£ç¡®æ–¹å¼æ˜¯ç»§æ‰¿ AutoDisposeAsyncNotifierç±»è€Œä¸æ˜¯ä½¿ç”¨ autoDispose ä¿®é¥°ç¬¦ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯ riverpod ä¸­å¸¸è§çš„ Provider çš„ç”¨æ³•ç¤ºä¾‹ï¼Œåé¢ä¼šä»‹ç»ä¸€äº›ä¿®é¥°ç¬¦ã€æ³¨è§£ç›¸å…³çš„ä¿¡æ¯ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åŸæ–‡æ¥è‡ªï¼š&lt;a href=&quot;https://codewithandrea.com/articles/flutter-state-management-riverpod/&quot;&gt;https://codewithandrea.com/articles/flutter-state-m</summary>
      
    
    
    
    
    <category term="Flutter" scheme="https://blog.huangyuanlove.com/tags/Flutter/"/>
    
    <category term="riverpod" scheme="https://blog.huangyuanlove.com/tags/riverpod/"/>
    
  </entry>
  
  <entry>
    <title>é¸¿è’™åº”ç”¨å¼€å‘ä½¿ç”¨canvaså®ç°çƒé¢è¿åŠ¨åŠ¨ç”»</title>
    <link href="https://blog.huangyuanlove.com/2023/12/24/%E9%B8%BF%E8%92%99%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E4%BD%BF%E7%94%A8canvas%E5%AE%9E%E7%8E%B0%E7%90%83%E9%9D%A2%E8%BF%90%E5%8A%A8%E5%8A%A8%E7%94%BB/"/>
    <id>https://blog.huangyuanlove.com/2023/12/24/%E9%B8%BF%E8%92%99%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E4%BD%BF%E7%94%A8canvas%E5%AE%9E%E7%8E%B0%E7%90%83%E9%9D%A2%E8%BF%90%E5%8A%A8%E5%8A%A8%E7%94%BB/</id>
    <published>2023-12-24T03:38:04.000Z</published>
    <updated>2024-03-27T02:20:27.914Z</updated>
    
    <content type="html"><![CDATA[<h3 id="åæ§½"><a href="#åæ§½" class="headerlink" title="åæ§½"></a>åæ§½</h3><p>ä¹ æƒ¯äº† Android çš„ Canvas,ç”¨é¸¿è’™çš„ canvas å¤šå°‘æœ‰ç‚¹åˆ«æ‰­<br>æ•ˆæœå›¾<br><img src="/image/HarmonyOS/canvas_ball_animation.gif" alt="canvas_ball_animation.gif"><br>ä¸Šé¢çš„å›¾æ˜¯ç”¨ transform å±æ€§åšçš„åŠ¨ç”»<br>ä¸‹é¢çš„å›¾æ˜¯ç”¨ canvas ç”»çš„ï¼Œå‚è€ƒè‡ª<a href="https://mp.weixin.qq.com/s/p_gy8s1SqPUTAa3wCIk7FQ">https://mp.weixin.qq.com/s/p_gy8s1SqPUTAa3wCIk7FQ</a></p><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œæˆ‘ä»¬åœ¨æ‰‹æœºæˆ–è€…å¹³æ¿ä¸Šçœ‹åˆ°çš„ 3D åŠ¨ç”»åªæ˜¯åœ¨äºŒç»´çš„æŠ•å½±ï¼Œæˆ‘ä»¬åªéœ€è¦è®¡ç®—å¥½è¿åŠ¨ç‰©ä½“çš„å¤§å°å’Œä½ç½®çš„å¯¹åº”å…³ç³»ï¼Œå°±å¯ä»¥å®ç°ç±»ä¼¼ 3D çš„æ•ˆæœã€‚æƒ³è¦äº†è§£å…·ä½“çš„ç®—æ³•ä»¥åŠæ˜ å°„å…³ç³»ï¼Œå¯ä»¥é˜…è¯»åŸæ–‡ã€‚<br>æ ¹æ®å‚è€ƒæ–‡ç« ä¸­çš„è®¡ç®—æ–¹å¼ï¼Œæˆ‘ä»¬åªéœ€è¦ç§»æ¤ä¸€ä¸‹å°±è¡Œã€‚è¿™é‡Œæ˜¯æ ¹æ®<code>æ€»ç»“</code>ä¸­çš„ä»£ç å®ç°çš„<br>åŸæ–‡ä¸­çš„å…³é”®ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-type">double</span>Â <span class="hljs-variable">xr</span>Â <span class="hljs-operator">=</span>Â Math.toRadians(<span class="hljs-number">5</span>);Â Â <span class="hljs-comment">//ç»•xè½´æ—‹è½¬åˆ™æŠŠè¿™ä¸ªå€¼è®¾ç½®ä¸ºå¤§äº 0</span><br>Â Â Â Â <span class="hljs-type">double</span>Â <span class="hljs-variable">yr</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-number">0</span>;Â Â <span class="hljs-comment">//ç»•yè½´æ—‹è½¬åˆ™æŠŠè¿™ä¸ªå€¼è®¾ç½®ä¸ºå¤§äº 0;  </span><br>Â Â Â Â <span class="hljs-type">double</span>Â <span class="hljs-variable">zr</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-number">0</span>;  <span class="hljs-comment">//ç»•zè½´æ—‹è½¬åˆ™æŠŠè¿™ä¸ªå€¼è®¾ç½®ä¸ºå¤§äº 0;  </span><br><br><span class="hljs-comment">//ä¿å­˜å°çƒçš„ä½ç½®ã€é¢œè‰²åŠç¼©æ”¾</span><br><span class="hljs-keyword">static</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">Point</span>Â &#123;  <br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-type">int</span>Â color;  <br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-type">float</span>Â x;  <br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-type">float</span>Â y;  <br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-type">float</span>Â z;   <br>Â Â Â Â Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-type">float</span>Â <span class="hljs-variable">scale</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-number">1f</span>;  <br>Â Â Â Â &#125;<br><span class="hljs-comment">//pointList ä¿å­˜çš„æ˜¯éšæœºç”Ÿæˆçš„å°çƒç›¸å…³ä¿¡æ¯</span><br><span class="hljs-keyword">for</span>Â (<span class="hljs-type">int</span>Â <span class="hljs-variable">i</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-number">0</span>;Â iÂ &lt;Â pointList.size();Â i++)Â &#123;  <br>  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">Point</span>Â <span class="hljs-variable">point</span>Â <span class="hljs-operator">=</span>Â pointList.get(i);  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">x</span>Â <span class="hljs-operator">=</span>Â point.x;  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">y</span>Â <span class="hljs-operator">=</span>Â point.y;  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">z</span>Â <span class="hljs-operator">=</span>Â point.z;  <br>  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//ç»•Xè½´æ—‹è½¬ï¼Œä¹˜ä»¥Xè½´çš„æ—‹è½¬çŸ©é˜µ  </span><br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">rx1</span>Â <span class="hljs-operator">=</span>Â x;  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">ry1</span>Â <span class="hljs-operator">=</span>Â (<span class="hljs-type">float</span>)Â (yÂ *Â Math.cos(xr)Â +Â zÂ *Â -Math.sin(xr));  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">rz1</span>Â <span class="hljs-operator">=</span>Â (<span class="hljs-type">float</span>)Â (yÂ *Â Math.sin(xr)Â +Â zÂ *Â Math.cos(xr));  <br>  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â ç»•Yè½´æ—‹è½¬,ä¹˜ä»¥Yè½´çš„æ—‹è½¬çŸ©é˜µ  </span><br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">rx2</span>Â <span class="hljs-operator">=</span>Â (<span class="hljs-type">float</span>)Â (rx1Â *Â Math.cos(yr)Â +Â rz1Â *Â Math.sin(yr));  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">ry2</span>Â <span class="hljs-operator">=</span>Â ry1;  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">rz2</span>Â <span class="hljs-operator">=</span>Â (<span class="hljs-type">float</span>)Â (rx1Â *Â -Math.sin(yr)Â +Â rz1Â *Â Math.cos(yr));  <br>  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â ç»•Zè½´æ—‹è½¬,ä¹˜ä»¥Zè½´çš„æ—‹è½¬çŸ©é˜µ  </span><br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">rx3</span>Â <span class="hljs-operator">=</span>Â (<span class="hljs-type">float</span>)Â (rx2Â *Â Math.cos(zr)Â +Â ry2Â *Â -Math.sin(zr));  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">ry3</span>Â <span class="hljs-operator">=</span>Â (<span class="hljs-type">float</span>)Â (rx2Â *Â Math.sin(zr)Â +Â ry2Â *Â Math.cos(zr));  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">rz3</span>Â <span class="hljs-operator">=</span>Â rz2;  <br>  <br>  <br>Â Â Â Â Â Â Â Â Â Â Â Â point.xÂ =Â rx3;  <br>Â Â Â Â Â Â Â Â Â Â Â Â point.yÂ =Â ry3;  <br>Â Â Â Â Â Â Â Â Â Â Â Â point.zÂ =Â rz3;  <br>  <br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â é€è§†é™¤æ³•ï¼Œzè½´å‘å†…çš„æ–¹å‘  </span><br>Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">float</span>Â <span class="hljs-variable">scale</span>Â <span class="hljs-operator">=</span>Â (<span class="hljs-number">2</span>Â *Â radius)Â /Â ((<span class="hljs-number">2</span>Â *Â radius)Â +Â rz3);  <br>Â Â Â Â Â Â Â Â Â Â Â Â point.scaleÂ =Â scale;  <br>        <span class="hljs-comment">//åˆ°è¿™é‡Œå°±å®Œæˆäº†å°çƒä½ç½®çš„è®¡ç®—ï¼Œæ¥ä¸‹æ¥å°±æ˜¯éœ€è¦å®šæ—¶æ›´æ–°ä¸Šé¢xrã€yrã€zrçš„å€¼å°±å¯ä»¥å®ç°å°çƒæ²¿çƒé¢è¿åŠ¨äº†</span><br>  <br>Â Â Â Â Â Â Â Â &#125;<br><br></code></pre></td></tr></table></figure><h3 id="é¸¿è’™-transform-å®ç°"><a href="#é¸¿è’™-transform-å®ç°" class="headerlink" title="é¸¿è’™ transform å®ç°"></a>é¸¿è’™ transform å®ç°</h3><p>æ¸…æ¥šäº†åŸç†åŠè®¡ç®—æ–¹å¼ï¼Œå®ç°èµ·æ¥å°±ç®€å•äº†<br>å…ˆ stack å †å ä¸¤ä¸ªåœ†çƒï¼Œå°çƒéœ€è¦ä¸æ–­è¿åŠ¨ï¼Œxã€yã€zéœ€è¦ä¸€ç›´å˜åŒ–ï¼Œä½¿ç”¨<code>@State</code>ä¿®é¥°ä¸€ä¸‹ã€‚å€¼çš„å˜åŒ–è¿‡ç¨‹å°±ç”¨ä¸Šé¢åŸæ–‡ä¸­çš„è®¡ç®—æ–¹æ³•ã€‚å®šæ—¶æ›´æ–°å°±ç”¨<code>setInterval</code>,ç»„ä»¶çš„ä½ç§»å˜åŒ–ç»™æˆ‘ä»¬æä¾›äº†<code>transform</code>æ–¹æ³•ï¼Œéœ€è¦ä¸€ä¸ª<code>matrix4</code>å¯¹è±¡ï¼Œç§»åŠ¨å˜åŒ–ä¹Ÿä¸éœ€è¦æˆ‘ä»¬å»å¡«å……çŸ©é˜µï¼Œæœ‰å¯¹åº”çš„<code>translate</code>æ–¹æ³•ï¼Œç»„åˆèµ·æ¥ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-keyword">import</span> matrix4 <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@ohos.matrix4&#x27;</span><br><br><span class="hljs-meta">@Preview</span><br><span class="hljs-meta">@Entry</span><br><span class="hljs-meta">@Component</span><br>struct <span class="hljs-title class_">AnimationOfSphericalPaths</span> &#123;<br>  <span class="hljs-meta">@State</span> <span class="hljs-attr">angleX</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span><br>  <span class="hljs-meta">@State</span> <span class="hljs-attr">translateX</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span><br>  <span class="hljs-meta">@State</span> <span class="hljs-attr">translateY</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span><br>  <span class="hljs-meta">@State</span> <span class="hljs-attr">translateZ</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span><br>  <span class="hljs-meta">@State</span> <span class="hljs-attr">ballRadius</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">30</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">timerInterval</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span><br>  <span class="hljs-keyword">private</span> radius = <span class="hljs-number">200</span><br>  <span class="hljs-keyword">private</span> a = <span class="hljs-number">90</span><br>  <span class="hljs-keyword">private</span> b = <span class="hljs-number">0</span><br><br><br>  <span class="hljs-title function_">toRadians</span>(degrees): <span class="hljs-built_in">number</span> &#123;<br>    <span class="hljs-keyword">return</span> degrees * (<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>)<br>  &#125;<br><br>  <span class="hljs-title function_">changeAngle</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">b</span> += <span class="hljs-number">3</span><br>    <span class="hljs-comment">// this.a += 3</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">a</span> &gt; <span class="hljs-number">360</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">a</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">a</span> - <span class="hljs-number">360</span><br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">b</span> &gt; <span class="hljs-number">360</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">b</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">b</span> - <span class="hljs-number">360</span><br>    &#125;<br><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateX</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">toRadians</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">a</span>)) * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">toRadians</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">b</span>)) * <span class="hljs-number">2</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateY</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">toRadians</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">a</span>)) * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">toRadians</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">b</span>)) * <span class="hljs-number">2</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateZ</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">toRadians</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">b</span>)) * <span class="hljs-number">2</span><br><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ballRadius</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateZ</span> / <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> * <span class="hljs-number">10</span> + <span class="hljs-number">50</span><br><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`translateX-&gt; <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.translateX&#125;</span> ,translateY-&gt; <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.translateY&#125;</span> ,translateZ-&gt; <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.translateZ&#125;</span>`</span>)<br><br>  &#125;<br><br>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Column</span>() &#123;<br>      <span class="hljs-title class_">Stack</span>() &#123;<br>        <span class="hljs-title class_">Circle</span>(&#123; <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> * <span class="hljs-number">2</span>, <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> * <span class="hljs-number">2</span> &#125;).<span class="hljs-title function_">fill</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Yellow</span>)<br>        <span class="hljs-title class_">Circle</span>(&#123; <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">ballRadius</span>, <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">ballRadius</span> &#125;).<span class="hljs-title function_">fill</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>)<br>          .<span class="hljs-title function_">transform</span>(matrix4.<span class="hljs-title function_">identity</span>().<span class="hljs-title function_">translate</span>(&#123; <span class="hljs-attr">x</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateX</span>, <span class="hljs-attr">y</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateY</span>, <span class="hljs-attr">z</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">translateZ</span> &#125;))<br>      &#125;.<span class="hljs-title function_">alignContent</span>(<span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Center</span>).<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> * <span class="hljs-number">2</span>).<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> * <span class="hljs-number">2</span>)<br><br>      <span class="hljs-title class_">Row</span>() &#123;<br>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">&quot;start&quot;</span>)<br>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">timerInterval</span> &gt; <span class="hljs-number">0</span>) &#123;<br>              <span class="hljs-keyword">return</span><br>            &#125;<br><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">timerInterval</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br><br>              <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">changeAngle</span>()<br><br>            &#125;.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), <span class="hljs-number">20</span>)<br>          &#125;)<br>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">&quot;stop&quot;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>          <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">timerInterval</span>)<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">timerInterval</span> = <span class="hljs-number">0</span><br>        &#125;).<span class="hljs-title function_">margin</span>(&#123; <span class="hljs-attr">left</span>: <span class="hljs-number">48</span> &#125;)<br>      &#125;.<span class="hljs-title function_">margin</span>(&#123; <span class="hljs-attr">top</span>: <span class="hljs-number">48</span> &#125;)<br><br>    &#125;.<span class="hljs-title function_">width</span>(<span class="hljs-string">&quot;100%&quot;</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">&quot;100%&quot;</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)<br>  &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="é¸¿è’™canvaså®ç°"><a href="#é¸¿è’™canvaså®ç°" class="headerlink" title="é¸¿è’™canvaså®ç°"></a>é¸¿è’™canvaså®ç°</h3><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé¸¿è’™é‡Œé¢çš„ math åŒ…ä¸‹æ²¡æœ‰<code>toRadians</code>æ–¹æ³•ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±å®ç°ä¸€ä¸‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-title function_">toRadians</span>(degrees): <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">return</span> degrees * (<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>å®šæ—¶æ›´æ–°è¿™é‡Œç”¨äº†<code>setInterval</code><br>é¸¿è’™çš„ canvas ä¸­ä¹Ÿæ²¡æœ‰ç”»ç¬”çš„æ¦‚å¿µï¼Œéœ€è¦è®¾ç½®<code>RenderingContextSettings</code>å®ä¾‹çš„å¡«å……æ–¹å¼åŠå¡«å……é¢œè‰²<br>é¸¿è’™çš„ canvas ä¸­ä¹Ÿæ²¡æœ‰ drawcircle æ–¹æ³•ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯<code>Path2D</code>å¯¹è±¡ä¸­ç”»åœ†å¼§æ–¹æ³•(arc)ç„¶åå¡«å……é¢œè‰²çš„æ–¹å¼ï¼Œéœ€è¦æ³¨æ„æ˜¯<code>Path2D.arc()</code>ä¸­çš„è§’åº¦å•ä½  </p><p>æ•´ä½“æµç¨‹å¦‚ä¸‹</p><ol><li>å…ˆç”Ÿæˆéšæœºçš„å°çƒï¼Œåˆ†å¸ƒåœ¨ä¸€ä¸ªåœ†ä¸ŠgenerateBall()</li><li>è®¡ç®—å°çƒçš„ç¼©æ”¾æ¯”ä¾‹åŠä½ç½®calculateRotateValue()</li><li>å¯¹å°çƒæ’åºï¼Œz è½´è¶Šå¤§ï¼Œè¶Šé è¿‘æˆ‘ä»¬ï¼Œå°çƒè¶Šå¤§ï¼Œè¶Šè¦é®ç›–ä½å…¶ä»–å°çƒï¼Œè¶Šè¦æœ€åç”»</li><li>æ‰€ä»¥å…ˆç”»èƒŒé¢çš„ï¼Œå†ç”»æ­£é¢çš„ã€‚è¿™é‡Œçš„æ­£é¢å’ŒèƒŒé¢æ˜¯ç›¸å¯¹äºä¸­é—´çš„å¤§çƒæ¥è¯´çš„ï¼Œä¸ºäº†é€è§†æ•ˆæœï¼ŒèƒŒé¢çš„å°çƒåŠ ä¸Šé€æ˜åº¦ï¼Œæ­£é¢çš„å°çƒä¸é€æ˜</li><li>å®šæ—¶æ›´æ–°å°±å¯ä»¥äº†</li></ol><p>ä¸‹é¢æ˜¯å…¨éƒ¨ä»£ç </p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-meta">@Preview</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">export</span> struct <span class="hljs-title class_">CanvasBallAnimation</span> &#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">settings</span>: <span class="hljs-title class_">RenderingContextSettings</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderingContextSettings</span>(<span class="hljs-literal">true</span>)<br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">canvasRendering</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasRenderingContext2D</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>)<br>  <span class="hljs-keyword">private</span> canvasWidth = <span class="hljs-number">0</span><br>  <span class="hljs-keyword">private</span> canvasHeight = <span class="hljs-number">0</span><br>  <span class="hljs-meta">@State</span> <span class="hljs-attr">canvasBallRoundRadius</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">canvasBallAnimationTimer</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">startDegree</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">5</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">xr</span>: <span class="hljs-built_in">number</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">toRadians</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">startDegree</span>)<br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">yr</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">zr</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">pointList</span>: <span class="hljs-title class_">Point</span>[] = []<br><br>  <span class="hljs-title function_">toRadians</span>(degrees): <span class="hljs-built_in">number</span> &#123;<br>    <span class="hljs-keyword">return</span> degrees * (<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>)<br>  &#125;<br><br>  <span class="hljs-title function_">canvasBallAnimation</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">startDegree</span> += <span class="hljs-number">5</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">startDegree</span> &gt; <span class="hljs-number">360</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">startDegree</span> -= <span class="hljs-number">360</span><br>    &#125;<br><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">clearRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span>)<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calculateRotateValue</span>()<br>    <span class="hljs-comment">//æ’åºï¼Œå…ˆç”»èƒŒé¢çš„ï¼Œå†ç”»æ­£é¢çš„</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pointList</span>.<span class="hljs-title function_">sort</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">comparator</span>)<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawFrontBall</span>()<br><br>    <span class="hljs-comment">//åœ¨ä¸­é—´ç”»ä¸€ä¸ªå¤§åœ†</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawCenterBall</span>()<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawBackBall</span>()<br><br><br>  &#125;<br><br>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Column</span>() &#123;<br><br><br>      <span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>)<br>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">&quot;100%&quot;</span>)<br>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">&quot;40%&quot;</span>)<br>        .<span class="hljs-title function_">onAreaChange</span>(<span class="hljs-function">(<span class="hljs-params">oldValue: Area, newValue: Area</span>) =&gt;</span> &#123;<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span> = <span class="hljs-built_in">parseInt</span>(newValue.<span class="hljs-property">width</span>.<span class="hljs-title function_">toString</span>())<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span> = <span class="hljs-built_in">parseInt</span>(newValue.<span class="hljs-property">height</span>.<span class="hljs-title function_">toString</span>())<br><br>          <span class="hljs-comment">//å°çƒè¿åŠ¨çš„åŠå¾„</span><br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallRoundRadius</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span>) / <span class="hljs-number">3</span><br>          <span class="hljs-comment">// this.canvasRendering.translate(this.canvasWidth / 2, this.canvasHeight / 2)</span><br>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">generateBall</span>()<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calculateRotateValue</span>()<br>          <span class="hljs-comment">//æ’åºï¼Œå…ˆç”»èƒŒé¢çš„ï¼Œå†ç”»æ­£é¢çš„</span><br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">pointList</span>.<span class="hljs-title function_">sort</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">comparator</span>)<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawFrontBall</span>()<br><br>          <span class="hljs-comment">//åœ¨ä¸­é—´ç”»ä¸€ä¸ªå¤§åœ†</span><br>         <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawCenterBall</span>()<br><br>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawBackBall</span>()<br><br><br>        &#125;)<br>      <span class="hljs-title class_">Row</span>() &#123;<br>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">&quot;canvas ball start&quot;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallAnimationTimer</span> &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span><br>          &#125;<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallAnimationTimer</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">canvasBallAnimation</span>()<br>          &#125;.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), <span class="hljs-number">20</span>)<br>        &#125;)<br>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">&quot;canvas ball end&quot;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>          <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallAnimationTimer</span>)<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallAnimationTimer</span> = <span class="hljs-number">0</span><br>        &#125;)<br>      &#125;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-title function_">comparator</span>(<span class="hljs-attr">left</span>: <span class="hljs-title class_">Point</span>, <span class="hljs-attr">right</span>: <span class="hljs-title class_">Point</span>): <span class="hljs-built_in">number</span> &#123;<br>    <span class="hljs-keyword">if</span> (left.<span class="hljs-property">z</span> - right.<span class="hljs-property">z</span> &lt; <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (left.<span class="hljs-property">z</span> == right.<span class="hljs-property">z</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br><br>  &#125;<br><br>  <span class="hljs-title function_">randomColor</span>(): <span class="hljs-built_in">string</span> &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-attr">r</span>: <span class="hljs-built_in">string</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">256</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)<br>    <span class="hljs-keyword">let</span> <span class="hljs-attr">g</span>: <span class="hljs-built_in">string</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">256</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)<br>    <span class="hljs-keyword">let</span> <span class="hljs-attr">b</span>: <span class="hljs-built_in">string</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">256</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)<br>    <span class="hljs-keyword">let</span> result = <span class="hljs-string">`<span class="hljs-subst">$&#123;r&#125;</span><span class="hljs-subst">$&#123;g&#125;</span><span class="hljs-subst">$&#123;b&#125;</span>`</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`éšæœºé¢œè‰²--&gt; <span class="hljs-subst">$&#123;result&#125;</span>`</span>)<br>    <span class="hljs-keyword">return</span> result<br>  &#125;<br><br>  <span class="hljs-title function_">generateBall</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">pointList</span>.<span class="hljs-property">length</span> == <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-keyword">let</span> maxBallCount = <span class="hljs-number">10</span><br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pointList</span> = []<br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; maxBallCount; i++) &#123;<br><br>        <span class="hljs-keyword">let</span> v = -<span class="hljs-number">1.0</span> + (<span class="hljs-number">2.0</span> * i - <span class="hljs-number">1.0</span>) / maxBallCount;<br>        <span class="hljs-keyword">if</span> (v &lt; -<span class="hljs-number">1.0</span>) &#123;<br>          v = <span class="hljs-number">1.0</span><br>        &#125;<br><br>        <span class="hljs-keyword">let</span> delta = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">acos</span>(v)<br>        <span class="hljs-keyword">let</span> alpha = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(maxBallCount * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>) * delta<br>        <span class="hljs-keyword">let</span> point = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Point</span>()<br>        point.<span class="hljs-property">x</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallRoundRadius</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(alpha) * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(delta)<br>        point.<span class="hljs-property">y</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallRoundRadius</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(alpha) * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(delta)<br>        point.<span class="hljs-property">z</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallRoundRadius</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(delta)<br>        point.<span class="hljs-property">color</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">randomColor</span>()<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">pointList</span>.<span class="hljs-title function_">push</span>(point)<br>      &#125;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-title function_">calculateRotateValue</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">pointList</span>.<span class="hljs-property">length</span>; i++) &#123;<br><br>      <span class="hljs-keyword">let</span> point = <span class="hljs-variable language_">this</span>.<span class="hljs-property">pointList</span>[i];<br>      <span class="hljs-keyword">let</span> x = point.<span class="hljs-property">x</span>;<br>      <span class="hljs-keyword">let</span> y = point.<span class="hljs-property">y</span>;<br>      <span class="hljs-keyword">let</span> z = point.<span class="hljs-property">z</span>;<br><br>      <span class="hljs-comment">//ç»•Xè½´æ—‹è½¬ï¼Œä¹˜ä»¥Xè½´çš„æ—‹è½¬çŸ©é˜µ</span><br>      <span class="hljs-keyword">let</span> rx1 = x;<br>      <span class="hljs-keyword">let</span> ry1 = (y * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">xr</span>) + z * -<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">xr</span>));<br>      <span class="hljs-keyword">let</span> rz1 = (y * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">xr</span>) + z * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">xr</span>));<br><br>      <span class="hljs-comment">// ç»•Yè½´æ—‹è½¬,ä¹˜ä»¥Yè½´çš„æ—‹è½¬çŸ©é˜µ</span><br>      <span class="hljs-keyword">let</span> rx2 = (rx1 * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">yr</span>) + rz1 * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">yr</span>));<br>      <span class="hljs-keyword">let</span> ry2 = ry1;<br>      <span class="hljs-keyword">let</span> rz2 = (rx1 * -<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">yr</span>) + rz1 * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">yr</span>));<br><br>      <span class="hljs-comment">// ç»•Zè½´æ—‹è½¬,ä¹˜ä»¥Zè½´çš„æ—‹è½¬çŸ©é˜µ</span><br>      <span class="hljs-keyword">let</span> rx3 = (rx2 * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">zr</span>) + ry2 * -<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">zr</span>));<br>      <span class="hljs-keyword">let</span> ry3 = (rx2 * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">zr</span>) + ry2 * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">zr</span>));<br>      <span class="hljs-keyword">let</span> rz3 = rz2;<br><br><br>      point.<span class="hljs-property">x</span> = rx3;<br>      point.<span class="hljs-property">y</span> = ry3;<br>      point.<span class="hljs-property">z</span> = rz3;<br><br>      <span class="hljs-comment">// é€è§†é™¤æ³•ï¼Œzè½´å‘å†…çš„æ–¹å‘</span><br>      <span class="hljs-keyword">let</span> scale = (<span class="hljs-number">2</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallRoundRadius</span>) / ((<span class="hljs-number">2</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallRoundRadius</span>) + rz3);<br>      point.<span class="hljs-property">scale</span> = scale;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-title function_">drawFrontBall</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">pointList</span>.<span class="hljs-property">length</span>; i++) &#123;<br>      <span class="hljs-keyword">let</span> point = <span class="hljs-variable language_">this</span>.<span class="hljs-property">pointList</span>[i];<br>      <span class="hljs-keyword">if</span> (point.<span class="hljs-property">z</span> &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawBall</span>(point)<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">break</span>;<br>      &#125;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-title function_">drawBall</span>(<span class="hljs-params">point: Point</span>) &#123;<br>    <span class="hljs-keyword">if</span> (point.<span class="hljs-property">scale</span> &gt; <span class="hljs-number">1</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">`#FF<span class="hljs-subst">$&#123;point.color&#125;</span>`</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">let</span> fillColor = <span class="hljs-string">`#<span class="hljs-subst">$&#123; <span class="hljs-built_in">Math</span>.round(point.scale * <span class="hljs-number">255</span>).toString(<span class="hljs-number">16</span>)&#125;</span><span class="hljs-subst">$&#123;point.color&#125;</span>`</span><br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">fillStyle</span> = fillColor<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;å¡«å……é¢œè‰²--&gt;&quot;</span> +fillColor)<br>    &#125;<br><br>    <span class="hljs-keyword">let</span> ballPath2D = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path2D</span>()<br>    ballPath2D.<span class="hljs-title function_">arc</span>(point.<span class="hljs-property">x</span> * point.<span class="hljs-property">scale</span> +<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span> / <span class="hljs-number">2</span> , point.<span class="hljs-property">y</span> * point.<span class="hljs-property">scale</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span> / <span class="hljs-number">2</span>, <span class="hljs-number">5</span> + <span class="hljs-number">25</span> * point.<span class="hljs-property">scale</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>)<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">beginPath</span>()<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">fill</span>(ballPath2D)<br>  &#125;<br><br>  <span class="hljs-title function_">drawBackBall</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-variable language_">this</span>.<span class="hljs-property">pointList</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) &#123;<br>      <span class="hljs-keyword">let</span> point = <span class="hljs-variable language_">this</span>.<span class="hljs-property">pointList</span>[i];<br>      <span class="hljs-keyword">if</span> (point.<span class="hljs-property">z</span> &lt;= <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawBall</span>(point)<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">break</span>;<br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-title function_">drawCenterBall</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">let</span> circlePath2D = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path2D</span>()<br>    circlePath2D.<span class="hljs-title function_">arc</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span>/<span class="hljs-number">2</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span>/<span class="hljs-number">2</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallRoundRadius</span>,<span class="hljs-number">0</span>,<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>)<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">beginPath</span>()<br><br>    <span class="hljs-keyword">let</span> radialGradient = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">createRadialGradient</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span>/<span class="hljs-number">2</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span>/<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasWidth</span>/<span class="hljs-number">2</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasHeight</span>/<span class="hljs-number">2</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasBallRoundRadius</span>)<br>    radialGradient.<span class="hljs-title function_">addColorStop</span>(<span class="hljs-number">0.0</span>,<span class="hljs-string">&quot;#ff0000&quot;</span>)<br>    radialGradient.<span class="hljs-title function_">addColorStop</span>(<span class="hljs-number">0.3</span>,<span class="hljs-string">&quot;#aaec5533&quot;</span>)<br>    radialGradient.<span class="hljs-title function_">addColorStop</span>(<span class="hljs-number">0.9</span>,<span class="hljs-string">&quot;#11000000&quot;</span>)<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-property">fillStyle</span>=radialGradient<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRendering</span>.<span class="hljs-title function_">fill</span>(circlePath2D)<br>  &#125;<br>&#125;<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Point</span> &#123;<br>  <span class="hljs-attr">color</span>: <span class="hljs-built_in">string</span><br>  <span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span><br>  <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span><br>  <span class="hljs-attr">z</span>: <span class="hljs-built_in">number</span><br>  <span class="hljs-attr">scale</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;åæ§½&quot;&gt;&lt;a href=&quot;#åæ§½&quot; class=&quot;headerlink&quot; title=&quot;åæ§½&quot;&gt;&lt;/a&gt;åæ§½&lt;/h3&gt;&lt;p&gt;ä¹ æƒ¯äº† Android çš„ Canvas,ç”¨é¸¿è’™çš„ canvas å¤šå°‘æœ‰ç‚¹åˆ«æ‰­&lt;br&gt;æ•ˆæœå›¾&lt;br&gt;&lt;img src=&quot;/image/Har</summary>
      
    
    
    
    
    <category term="HarmonyOS" scheme="https://blog.huangyuanlove.com/tags/HarmonyOS/"/>
    
  </entry>
  
  <entry>
    <title>é¸¿è’™åº”ç”¨å¼€å‘è¸©å‘è®°å½•</title>
    <link href="https://blog.huangyuanlove.com/2023/11/29/%E9%B8%BF%E8%92%99%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/"/>
    <id>https://blog.huangyuanlove.com/2023/11/29/%E9%B8%BF%E8%92%99%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/</id>
    <published>2023-11-29T06:50:40.000Z</published>
    <updated>2023-12-22T06:53:20.156Z</updated>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨HarmonyOS4+ArkUI+Stageæ¨¡å‹è¿›è¡Œå¼€å‘çš„ç¿»è¯‘è½¯ä»¶ï¼Œç›®å‰åªæ˜¯åŠæˆå“ï¼Œä»£ç å†™çš„å¾ˆæŒ«ã€‚è®°å½•ä¸€ä¸‹å¼€å‘è¿‡ç¨‹ä¸­è¸©è¿‡çš„å‘ã€‚<br>é¡¹ç›®åœ°å€ï¼š<br>ç äº‘<br><a href="https://gitee.com/huangyuan/HarmonyTranslator">https://gitee.com/huangyuan/HarmonyTranslator</a><br>github<br><a href="https://github.com/huangyuanlove/HarmonyTranslator">https://github.com/huangyuanlove/HarmonyTranslator</a><br>ç äº‘é¡¹ç›®æ˜¯ä»githubå¯¼å…¥çš„ï¼Œå¶å°”ä¼šå¿˜è®°åŒæ­¥</p><h4 id="å†»å±ã€é»‘å±ã€å‡æ­»"><a href="#å†»å±ã€é»‘å±ã€å‡æ­»" class="headerlink" title="å†»å±ã€é»‘å±ã€å‡æ­»"></a>å†»å±ã€é»‘å±ã€å‡æ­»</h4><p>è¿è¡Œç¯å¢ƒæ˜¯MetaPadPro 2019 é¸¿è’™4.0.0ï¼Œä½¿ç”¨api9+stageæ¨¡å‹å¼€å‘ï¼Œè¿è¡Œåœ¨æ¨¡æ‹Ÿå™¨ä¸Šæ­£å¸¸ï¼Œä½†æ˜¯è¿è¡Œåœ¨è¯¥è®¾å¤‡ä¸Šå‡ºç°å†»å±ç°è±¡ï¼Œé¡µé¢è½®æ’­å›¾æ— æ³•è½®æ’­ï¼Œæ»‘åŠ¨ç»„ä»¶æ— æ³•å‘æ»‘åŠ¨ï¼Œå°±åƒå¡åœ¨äº†è¿™ä¸€å¸§ä¸Šä¸€æ ·ã€‚ç‚¹å‡»è¾“å…¥æ¡†é”®ç›˜èƒ½å¼¹å‡ºï¼Œä½†é¡µé¢æ˜¯é»‘çš„ã€‚å¯ä»¥é€šè¿‡é”å±ã€è§£é”æˆ–è€…éŸ³é‡é”®åˆ·æ–°é¡µé¢ã€‚</p><p>æ„Ÿè§‰ä¸Šå°±æ˜¯å±å¹•ä¸ä¼šä¸»åŠ¨åˆ·æ–°ï¼Œéœ€è¦æŒ‰ç‰©ç†é”®è®©å±å¹•åˆ·æ–°ä¸€æ¬¡ä¼¼çš„ã€‚  </p><p>è¯¢é—®è¿‡æœ‹å‹åå‘ç°ï¼Œè¿™ä¸ªç°è±¡åªä¼šå‡ºç°åœ¨éº’éºŸç³»åˆ—èŠ¯ç‰‡çš„æ‰‹æœºæˆ–å¹³æ¿ä¸Šï¼Œçœ‹åˆ°è®ºå›ä¹Ÿæœ‰äººå’¨è¯¢ç›¸åŒçš„é—®é¢˜ã€‚å‘å®˜æ–¹æå·¥å•åå®˜æ–¹å›å¤æ˜¯å·²çŸ¥é—®é¢˜ï¼Œå°†ä¼šåœ¨HarmonyOS nextç³»ç»Ÿä¸­ä¿®å¤  </p><p>å¦‚æœåªæ˜¯è‡ªå·±å†™ç€ç©ï¼Œå¯ä»¥å®‰è£… <a href="https://github.com/Genymobile/scrcpy">scrcpy</a> å°†å±å¹•å†…å®¹åŒæ­¥åˆ°ç”µè„‘ä¸Šï¼Œåœ¨ç”µè„‘ä¸Šæ“ä½œæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚  </p><p>å¦‚æœæ˜¯å…¬å¸ç”¨ï¼Œå»ºè®®å’¨è¯¢é¸¿è’™è¿è¥ï¼Œæˆä¸ºåˆä½œä¼™ä¼´ï¼Œç›´æ¥ä¸ŠHarmonyOS Nextè¿›è¡Œå¼€å‘ã€‚æˆ–è€…é™ä½apiç‰ˆæœ¬ã€‚</p><h4 id="PersistentStorageå’Œ-StorageLink"><a href="#PersistentStorageå’Œ-StorageLink" class="headerlink" title="PersistentStorageå’Œ@StorageLink"></a>PersistentStorageå’Œ@StorageLink</h4><p>é¡¹ç›®ä¸­æœ‰äº›è®¾ç½®éœ€è¦æŒä¹…åŒ–å­˜å‚¨ï¼Œäºæ˜¯é€‰æ‹©äº†PersistentStorageå’Œ@StorageLinkæ–¹å¼è¿›è¡Œå­˜å‚¨ï¼Œå¤§è‡´å¦‚ä¸‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age<br>  &#125;<br>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span><br>  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span><br>&#125;<br><br><span class="hljs-title class_">PersistentStorage</span>.<span class="hljs-property">PersistProp</span>&lt;<span class="hljs-title class_">User</span>&gt;(<span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&#x27;xuan&#x27;</span>,<span class="hljs-number">18</span>))<br><span class="hljs-meta">@Entry</span><br><span class="hljs-meta">@Component</span><br>struct <span class="hljs-title class_">Tmp</span> &#123;<br>  <span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">&#x27;user&#x27;</span>) <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&#x27;xuan&#x27;</span>, <span class="hljs-number">18</span>)<br>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.user.name&#125;</span> : <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.user.age&#125;</span>`</span>)<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å½“æˆ‘ç¬¬ä¸€è¿è¡Œçš„æ—¶å€™ï¼Œé¡µé¢æ˜¾ç¤ºæ­£å¸¸ï¼ŒTextæ˜¾ç¤ºçš„å†…å®¹æ˜¯<code>xuan : 18</code><br/><br>ä½†æ˜¯å½“æˆ‘é‡æ–°æ‰“å¼€åº”ç”¨(ä¸æ˜¯é‡æ–°ç¼–è¯‘ï¼Œå°±æ˜¯ç®€å•çš„åœ¨è®¾å¤‡ä¸Šå…³æ‰åº”ç”¨ç„¶åç‚¹å‡»æ¡Œé¢å›¾æ ‡æ‰“å¼€åº”ç”¨)çš„æ—¶å€™ï¼ŒTextæ˜¾ç¤ºå†…å®¹æ˜¯ <code>undefined : undefined</code><br/><br>æ‰“ä¸Šæ–­ç‚¹å‘ç°é‡æ–°æ‰“å¼€åº”ç”¨çš„æ—¶å€™ <code>user</code> æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹ï¼Œå€¼ä¸º {â€˜nameâ€™:â€™xuanâ€™,â€™ageâ€™:18}ï¼Œä½†å­—ç¬¦ä¸²å¯¹è±¡æ²¡æœ‰nameå’Œageå±æ€§ï¼Œæ‰€ä»¥æ˜¾ç¤ºäº† undefined.<br/><br>çœ‹åˆ°æ–‡æ¡£ä¸­æœ‰å†™ <a href="https://developer.harmonyos.com/cn/docs/documentation/doc-references-V3/arkts-state-management-0000001504151156-V3#ZH-CN_TOPIC_0000001523808562__persistprop">https://developer.harmonyos.com/cn/docs/documentation/doc-references-V3/arkts-state-management-0000001504151156-V3#ZH-CN_TOPIC_0000001523808562__persistprop</a></p><blockquote><p>AppStorageçš„å±æ€§å‘PersistentStorageä¸­æŒä¹…åŒ–çš„å…è®¸çš„ç±»å‹æ˜¯ï¼š<br/><br>numberï¼Œstringï¼Œbooleanï¼ŒenumåŸºç¡€ç±»å‹ã€‚<br/><br>Objectä¸­å¯åºåˆ—åŒ–çš„å±æ€§ã€‚<br/><br>ä¸å…è®¸undefinedå’Œnullã€‚</p></blockquote><p>ä½†åŒæ ·çš„ï¼Œåœ¨æŒ‡å—ä¸­åŒæ ·æœ‰PersistentStorageæè¿° <a href="https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V3/arkts-persiststorage-0000001474017166-V3#section610120319595">https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V3/arkts-persiststorage-0000001474017166-V3#section610120319595</a></p><blockquote><p>PersistentStorageå…è®¸çš„ç±»å‹å’Œå€¼æœ‰ï¼š<br/><br>number, string, boolean, enum ç­‰ç®€å•ç±»å‹ã€‚<br/><br>å¯ä»¥è¢«JSON.stringify()å’ŒJSON.parse()é‡æ„çš„å¯¹è±¡ã€‚ä¾‹å¦‚Date, Map, Setç­‰å†…ç½®ç±»å‹åˆ™ä¸æ”¯æŒï¼Œä»¥åŠå¯¹è±¡çš„å±æ€§æ–¹æ³•ä¸æ”¯æŒæŒä¹…åŒ–ã€‚<br/></p></blockquote><p>çœ‹åˆ°è®ºå›æœ‰åŒæ ·çš„æ±‚åŠ©ï¼Œæœ‰å¼€å‘è€…å›å¤è¯´ä»–æ˜¯å°†å¯¹è±¡è½¬æˆå­—ç¬¦ä¸²ä¿å­˜çš„ï¼Œä½¿ç”¨çš„æ—¶å€™å†parseä¸€ä¸‹ã€‚</p><h4 id="å‰ªè´´æ¿-pasteboard-getSystemPasteboard"><a href="#å‰ªè´´æ¿-pasteboard-getSystemPasteboard" class="headerlink" title="å‰ªè´´æ¿ pasteboard.getSystemPasteboard()"></a>å‰ªè´´æ¿ pasteboard.getSystemPasteboard()</h4><p>åœ¨ä½¿ç”¨å‰ªè´´æ¿æ—¶éœ€è¦å…ˆåˆ›å»ºå‰ªè´´æ¿æ•°æ®ï¼Œ<br>åˆ›å»ºæ–¹æ³•å¦‚ä¸‹ </p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-title function_">createData</span>(<span class="hljs-attr">mimeType</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">value</span>: <span class="hljs-title class_">ValueType</span>): <span class="hljs-title class_">PasteData</span>  <br><span class="hljs-title function_">createRecord</span>(<span class="hljs-attr">mimeType</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">value</span>: <span class="hljs-title class_">ValueType</span>):<span class="hljs-title class_">PasteDataRecord</span><br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªå‚æ•°å«ä¹‰ä¸ºï¼šè‡ªå®šä¹‰æ•°æ®çš„MIMEç±»å‹ã€‚ æ–‡æ¡£ä¸­ <a href="https://developer.harmonyos.com/cn/docs/documentation/doc-references-V3/js-apis-pasteboard-0000001544384177-V3#ZH-CN_TOPIC_0000001523648478__pasteboardcreatedata9">é¸¿è’™å¼€å‘apiå‚è€ƒ</a><br>ä¸­å†™çš„ç¤ºä¾‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> pasteboard <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@ohos.pasteboard&#x27;</span>;<br><span class="hljs-keyword">let</span> dataXml = <span class="hljs-string">&#x27;Hello World&#x27;</span>;<br><span class="hljs-keyword">let</span> pasteDataRecord = pasteboard.<span class="hljs-title function_">createRecord</span>(<span class="hljs-string">&#x27;app/xml&#x27;</span>, dataXml);<br></code></pre></td></tr></table></figure><p>å®é™…ä¸­å‘ç°æ—¶ä¸èƒ½ä½¿ç”¨è¿™è‡ªå®šä¹‰çš„<code>app/xml</code>å€¼ï¼Œä¼šå´©æºƒï¼Œåªèƒ½ä½¿ç”¨pasteboardä¸­é¢„å®šä¹‰çš„MIMEç±»å‹</p><h4 id="å¯¹è±¡å±æ€§ä»æœ‰å€¼å˜ä¸ºç©ºï¼Œåº”ç”¨ä¼šå´©æºƒ"><a href="#å¯¹è±¡å±æ€§ä»æœ‰å€¼å˜ä¸ºç©ºï¼Œåº”ç”¨ä¼šå´©æºƒ" class="headerlink" title="å¯¹è±¡å±æ€§ä»æœ‰å€¼å˜ä¸ºç©ºï¼Œåº”ç”¨ä¼šå´©æºƒ"></a>å¯¹è±¡å±æ€§ä»æœ‰å€¼å˜ä¸ºç©ºï¼Œåº”ç”¨ä¼šå´©æºƒ</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Entry</span><br><span class="hljs-meta">@Component</span><br>struct <span class="hljs-title class_">PlayGround</span> &#123;<br>  <span class="hljs-meta">@State</span> <span class="hljs-attr">people</span>:<span class="hljs-title class_">People</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">People</span>()<br>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">log</span>(<span class="hljs-attr">log</span>:<span class="hljs-built_in">string</span>):<span class="hljs-built_in">boolean</span>&#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`---------<span class="hljs-subst">$&#123;log&#125;</span>---------`</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>  &#125;<br><br>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-title class_">Column</span>() &#123;<br>      <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">people</span>)&#123;<br>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`å§“åï¼š <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.people.name&#125;</span>  å¹´é¾„ï¼š<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.people.age&#125;</span>`</span>)<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">people</span>.<span class="hljs-property">address</span>)&#123;<br>          <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;address æœ‰å€¼&#x27;</span>))&#123;<br>            <span class="hljs-title class_">Text</span>( <span class="hljs-string">`åœ°å€ï¼š <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.people.address.name&#125;</span>  é‚®ç¼–ï¼š<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.people.address.zipCode&#125;</span>`</span>)<br>          &#125;<br>          <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">&#x27;address ä¸ºç©º å†…éƒ¨&#x27;</span>)<br>          &#125;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>          <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;address ä¸ºç©º æœ€å¤–å±‚&#x27;</span>))&#123;<br>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">&#x27;address ä¸ºç©º æœ€å¤–å±‚&#x27;</span>)<br>          &#125;<br>        &#125;<br>      &#125;<br>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">&#x27;ç½‘ç»œè¯·æ±‚è¿”å›ä¸€ä¸ªæœ‰åœ°å€çš„å¯¹è±¡&#x27;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>&#123;<br>        <span class="hljs-keyword">let</span> tmpPeople = <span class="hljs-keyword">new</span> <span class="hljs-title class_">People</span>()<br>        <span class="hljs-keyword">let</span> tmpAddress = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>()<br>        tmpAddress.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;æµ‹è¯•åœ°å€&#x27;</span><br>        tmpAddress.<span class="hljs-property">zipCode</span> = -<span class="hljs-number">1000</span><br>        tmpPeople.<span class="hljs-property">address</span> = tmpAddress<br><br>        tmpPeople.<span class="hljs-property">age</span> = <span class="hljs-number">10</span><br>        tmpPeople.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;æœ‰åœ°å€&#x27;</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">people</span> = tmpPeople<br>      &#125;)<br><br>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">&#x27;ç½‘ç»œè¯·æ±‚è¿”å›ä¸€ä¸ªæ²¡æœ‰åœ°å€çš„å¯¹è±¡&#x27;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>&#123;<br>        <span class="hljs-keyword">let</span> tmpPeople = <span class="hljs-keyword">new</span> <span class="hljs-title class_">People</span>()<br>        tmpPeople.<span class="hljs-property">age</span> = <span class="hljs-number">10</span><br>        tmpPeople.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;æ²¡æœ‰åœ°å€&#x27;</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">people</span> = tmpPeople<br>      &#125;)<br>    &#125;.<span class="hljs-title function_">margin</span>(&#123;<span class="hljs-attr">top</span>:<span class="hljs-number">48</span>&#125;)<br>  &#125;<br>&#125;<br><span class="hljs-keyword">class</span>  <span class="hljs-title class_">Address</span>&#123;<br>  <span class="hljs-attr">zipCode</span>:<span class="hljs-built_in">number</span><br>  <span class="hljs-attr">name</span>:<span class="hljs-built_in">string</span><br>&#125;<br><span class="hljs-keyword">class</span>  <span class="hljs-title class_">People</span>&#123;<br>  <span class="hljs-attr">name</span>:<span class="hljs-built_in">string</span><br>  <span class="hljs-attr">age</span>:<span class="hljs-built_in">number</span><br>  address :<span class="hljs-title class_">Address</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¾ˆç®€å•çš„é¡µé¢ï¼Œå±•ç¤ºå¯¹è±¡å±æ€§ï¼Œ<br>åˆšå¼€å§‹è¿è¡Œï¼Œä¸€åˆ‡æ­£å¸¸ã€‚ç‚¹å‡»è¿”å›æœ‰åœ°å€çš„å¯¹è±¡ï¼Œé¡µé¢æ­£å¸¸åˆ·æ–°å¹¶ä¸”å±•ç¤ºã€‚ç„¶åç‚¹å‡»è¿”å›æ²¡æœ‰åœ°å€çš„å¯¹è±¡ï¼Œè¿™æ—¶å€™ä¼šå´©æºƒã€‚<br>æ—¥å¿—æŒ‡å‘äº† Text( <code>åœ°å€ï¼š $&#123;this.people.address.name&#125;  é‚®ç¼–ï¼š$&#123;this.people.address.zipCode&#125;</code>)<br>è¯´æ˜¯<code>ä¸èƒ½ä»undefinedå¯¹è±¡ä¸­è¯»å–nameå±æ€§</code> å…·ä½“å¯ä»¥çœ‹è¿™é‡Œï¼š<a href="https://developer.huawei.com/consumer/cn/forum/topic/0204136377582311317?fid=0102683795438680754">å¼€å‘è¿™è®ºå›</a><br>è§„é¿æ–¹æ¡ˆï¼šæˆ‘æœ‰ä¸€ä¸ªæœ‹å‹ï¼Œå°è¯•å‡ºäº†ä½¿ç”¨ <code>?.</code>æ¥è§„é¿çš„æ–¹æ³•ã€‚ å–å¯¹è±¡å±æ€§é™¤äº†è¦ç”¨ifåˆ¤æ–­æ¥æ§åˆ¶æ¸²æŸ“ä¹‹å¤–ï¼Œéœ€è¦ç”¨ <code>?.</code>æ¥å–å€¼ï¼Œé˜²å´©æºƒï¼Œå°†ä¸Šé¢çš„ä»£ç ä¿®æ”¹ä¸º<br>Text( <code>åœ°å€ï¼š $&#123;this.people.address?.name&#125;  é‚®ç¼–ï¼š$&#123;this.people.address?.zipCode&#125;</code>)<br>åº”ç”¨ä¸ä¼šå´©æºƒï¼Œè¿™ä¸ªå¯¹è±¡ä¹Ÿä¸ä¼šæ¸²æŸ“åœ¨é¡µé¢ä¸Š<br/><br>ä½†æ ¹æ®æ–‡æ¡£æè¿°ï¼Œæ—¢ç„¶ifæ¡ä»¶ä¸æˆç«‹ï¼Œä¸‹é¢çš„Textç»„ä»¶å°±ä¸åº”è¯¥è¢«æ¸²æŸ“ï¼Œä¹Ÿä¸åº”è¯¥è¯»å–addressçš„nameå±æ€§ã€‚åŒæ ·æå·¥å•ï¼Œå›å¤è¯´æ˜¯åŒæ¡†æ¶é—®é¢˜ï¼Œå°†åœ¨HarmonyOS Nextç‰ˆæœ¬è§£å†³</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ–‡æ¡£ä¸Šå†™çš„è¢«çŠ¶æ€ç®¡ç†è£…é¥°å™¨ä¿®é¥°çš„å˜é‡ï¼ŒåŸºæœ¬ä¸Šéƒ½ä¸æ”¯æŒanyã€undefinedã€nullå€¼ï¼Œä½†å®é™…å†™ä»£ç çš„è¿‡ç¨‹ä¸­æ˜¯æ²¡æœ‰æ ¡éªŒçš„ï¼Œç›®å‰æ¥çœ‹å³ä½¿æ˜¯è¿™äº›ç±»å‹æˆ–è€…å€¼ï¼Œä¹Ÿæ˜¯æ²¡ä»€ä¹ˆå¤§é—®é¢˜çš„ï¼Œä½†è¿˜æ˜¯å»ºè®®å¤§å®¶æŒ‰æ–‡æ¡£å†™ï¼Œæœ‰é—®é¢˜å’¨è¯¢ç›¸å…³æŠ€æœ¯äººå‘˜æˆ–è€…è®ºå›ã€æå·¥å•ã€‚</p><hr><p>ä»¥ä¸Š</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä½¿ç”¨HarmonyOS4+ArkUI+Stageæ¨¡å‹è¿›è¡Œå¼€å‘çš„ç¿»è¯‘è½¯ä»¶ï¼Œç›®å‰åªæ˜¯åŠæˆå“ï¼Œä»£ç å†™çš„å¾ˆæŒ«ã€‚è®°å½•ä¸€ä¸‹å¼€å‘è¿‡ç¨‹ä¸­è¸©è¿‡çš„å‘ã€‚&lt;br&gt;é¡¹ç›®åœ°å€ï¼š&lt;br&gt;ç äº‘&lt;br&gt;&lt;a href=&quot;https://gitee.com/huangyuan/HarmonyTranslato</summary>
      
    
    
    
    
    <category term="HarmonyOS" scheme="https://blog.huangyuanlove.com/tags/HarmonyOS/"/>
    
  </entry>
  
  <entry>
    <title>Javaä½¿ç”¨Protocol Bufferä¸æœåŠ¡ç«¯äº¤äº’</title>
    <link href="https://blog.huangyuanlove.com/2023/05/09/Java%E4%BD%BF%E7%94%A8Protocol-Buffer%E4%B8%8E%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%BA%A4%E4%BA%92/"/>
    <id>https://blog.huangyuanlove.com/2023/05/09/Java%E4%BD%BF%E7%94%A8Protocol-Buffer%E4%B8%8E%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%BA%A4%E4%BA%92/</id>
    <published>2023-05-09T06:14:26.000Z</published>
    <updated>2023-05-19T12:51:02.220Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘å’Œä¸‰æ–¹å¯¹æ¥æ—¶ï¼Œå¯¹æ–¹ç»™å‡ºçš„æ¥å£æ–‡æ¡£æ˜¯ä½¿ç”¨protol bufferè¿›è¡Œäº¤äº’çš„ï¼Œå¹¶éæ˜¯æˆ‘ä»¬å¸¸è§çš„jsonã€xmlè¿™ç§æ ¼å¼ï¼Œäº†è§£äº†ä¸€ä¸‹è¿™ç§æ ¼å¼æˆ–è€…è¯´äº¤åè®®çš„ç‰¹ç‚¹ã€‚<br>é¦–å…ˆï¼ŒProtocol Bufferåºåˆ—åŒ–ä¹‹åæ˜¯äºŒè¿›åˆ¶æµï¼Œä¸è¿›è¡Œååºåˆ—åŒ–åŸºæœ¬ä¸å¯è¯»ã€‚<br>å…¶æ¬¡ï¼Œåºåˆ—åŒ–ä¹‹åçš„ä½“ç§¯å¾ˆå°ï¼Œé€‚åˆç½‘ç»œä¼ è¾“æˆ–è€…è®¾å¤‡ä¹‹é—´ä¼ è¾“<br>æœ€åï¼Œå¯ä»¥è·¨å¹³å°ã€è·¨è¯­è¨€ä½¿ç”¨<br>ä¸è¿‡è¿™äº›ç‰¹ç‚¹æ—¢æ˜¯ä¼˜ç‚¹ä¹Ÿæ˜¯ç¼ºç‚¹ï¼šåºåˆ—åŒ–ä¹‹åçš„æ•°æ®ä¸å¯è¯»ï¼Œè¿˜åŸåºåˆ—åŒ–ä¹‹åçš„æ•°æ®éœ€è¦äº‹å…ˆå®šä¹‰å¥½çš„æ•°æ®æ ¼å¼</p><span id="more"></span><h4 id="å®‰è£…Protocol-Bufferçš„ç¼–è¯‘å™¨"><a href="#å®‰è£…Protocol-Bufferçš„ç¼–è¯‘å™¨" class="headerlink" title="å®‰è£…Protocol Bufferçš„ç¼–è¯‘å™¨"></a>å®‰è£…Protocol Bufferçš„ç¼–è¯‘å™¨</h4><p>æˆ‘ä»¬éœ€è¦ä½¿ç”¨ç›¸åº”çš„ç¼–è¯‘å™¨å°†<code>.proto</code>æ–‡ä»¶è½¬åŒ–ä¸ºå¯¹åº”çš„ç¼–ç¨‹è¯­è¨€çš„ä»£ç ã€‚<br>ç¼–è¯‘å™¨å¯ä»¥åœ¨è¿™é‡Œä¸‹è½½<a href="https://github.com/protocolbuffers/protobuf">https://github.com/protocolbuffers/protobuf</a><br>è¿™é‡Œæˆ‘ä¸‹è½½çš„ç‰ˆæœ¬æ˜¯22.3ã€‚ä¸‹è½½å®Œæˆåè§£å‹ã€æ·»åŠ ç¯å¢ƒå˜é‡ï¼Œå‘½ä»¤è¡Œæ‰§è¡Œ <code>protoc --version</code>èƒ½å¤Ÿè¾“å‡ºç‰ˆæœ¬å·å°±å¯ä»¥äº†</p><h4 id="ç¼–å†™-protoæ–‡ä»¶"><a href="#ç¼–å†™-protoæ–‡ä»¶" class="headerlink" title="ç¼–å†™ .protoæ–‡ä»¶"></a>ç¼–å†™ .protoæ–‡ä»¶</h4><p>æ–‡ä»¶å†…å®¹åŠæ ¼å¼å¯ä»¥å‚è€ƒè¿™é‡Œ<a href="https://protobuf.dev/">https://protobuf.dev/</a><br>ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs protocol">syntax = &quot;proto2&quot;;<br><br>package tutorial;<br><br>option java_multiple_files = true;<br>option java_package = &quot;com.example.tutorial.protos&quot;;<br>option java_outer_classname = &quot;AddressBookProtos&quot;;<br><br>message Person &#123;<br>  optional string name = 1;<br>  optional int32 id = 2;<br>  optional string email = 3;<br><br>  enum PhoneType &#123;<br>    MOBILE = 0;<br>    HOME = 1;<br>    WORK = 2;<br>  &#125;<br><br>  message PhoneNumber &#123;<br>    optional string number = 1;<br>    optional PhoneType type = 2 [default = HOME];<br>  &#125;<br><br>  repeated PhoneNumber phones = 4;<br>&#125;<br><br>message AddressBook &#123;<br>  repeated Person people = 1;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸Šé¢å®‰è£…å¥½çš„ç¼–è¯‘å·¥å…·å°†æ–‡ä»¶ç¼–è¯‘è½¬åŒ–ä¸ºå¯¹åº”ç¼–ç¨‹è¯­è¨€çš„æ–‡ä»¶ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯java</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><br>protocol --java_out=src/main/java src/main/protobuf/AddressBookProtos.proto<br><br></code></pre></td></tr></table></figure><p><code>src/main/java</code>æ˜¯è¾“å‡ºæ–‡ä»¶çš„ä½ç½®ï¼Œ<code>src/main/protobuf/tgssp.proto</code>æ˜¯æ•°æ®æ ¼å¼æ–‡ä»¶çš„ä½ç½®</p><p>æ²¡æœ‰æŠ¥é”™çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è¾“å‡ºæ–‡ä»¶çš„ä½ç½®çœ‹åˆ°ç”Ÿæˆçš„javaæ–‡ä»¶äº†</p><h4 id="å¦‚ä½•ä½¿ç”¨"><a href="#å¦‚ä½•ä½¿ç”¨" class="headerlink" title="å¦‚ä½•ä½¿ç”¨"></a>å¦‚ä½•ä½¿ç”¨</h4><p>æƒ³è¦ä½¿ç”¨è¯¥æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å·¥ç¨‹ä¸­å¼•å…¥ç›¸åº”çš„ä¾èµ–åº“ï¼Œè¿™é‡Œè¿˜æ˜¯ç”¨javaä¸¾ä¾‹</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">implementation <span class="hljs-attr">group:</span> <span class="hljs-string">&#x27;com.google.protobuf&#x27;</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;protobuf-java&#x27;</span>, <span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.22.3&#x27;</span><br></code></pre></td></tr></table></figure><p>å› ä¸ºä¸Šé¢çš„<code>.proto</code>æ–‡ä»¶ä¸­å®šä¹‰çš„<code>java_multiple_files</code>ä¸ºtrueï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯åˆ†å¼€ç”Ÿæˆçš„æ–‡ä»¶ã€‚<br>ç„¶åæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> Person.newBuilder()<br>        .setEmail(<span class="hljs-string">&quot;123@123.com&quot;</span>)<br>        .setId(<span class="hljs-number">1</span>)<br>        .setName(<span class="hljs-string">&quot;null&quot;</span>)<br>        .build();<br><span class="hljs-type">AddressBook</span> <span class="hljs-variable">addressBook</span> <span class="hljs-operator">=</span> AddressBook.newBuilder()<br>        .addPeople(person)<br>        .build();<br>System.out.println(addressBook);<br></code></pre></td></tr></table></figure><p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†<code>addressBook</code>å¯¹è±¡è°ƒç”¨<code>toByteArray()</code>æ–¹æ³•åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶æ•°æ®æµ;ä¹Ÿå¯ä»¥è°ƒç”¨<code>AddressBook.parseFrom(byte[] bytes)</code>ä»äºŒè¿›åˆ¶æ•°æ®ä¸­ååºåˆ—åŒ–</p><h4 id="ä¸æœåŠ¡å™¨äº¤äº’"><a href="#ä¸æœåŠ¡å™¨äº¤äº’" class="headerlink" title="ä¸æœåŠ¡å™¨äº¤äº’"></a>ä¸æœåŠ¡å™¨äº¤äº’</h4><p>è¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œç›´æ¥ä½¿ç”¨çš„apacheçš„ç½‘ç»œè¯·æ±‚åº“ï¼Œä½¿ç”¨å…¶ä»–åº“åŸç†æ˜¯ä¸€æ ·çš„<br>ä¾èµ–</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs groovy">implementation <span class="hljs-attr">group:</span> <span class="hljs-string">&#x27;org.apache.httpcomponents&#x27;</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;httpcore&#x27;</span>, <span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;4.4.14&#x27;</span><br>implementation <span class="hljs-attr">group:</span> <span class="hljs-string">&#x27;org.apache.httpcomponents&#x27;</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;httpclient&#x27;</span>, <span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;4.5.13&#x27;</span><br></code></pre></td></tr></table></figure><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">HttpPost</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpPost</span>(<span class="hljs-string">&quot;https://a.b.com&quot;</span>);<br>request.setEntity(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayEntity</span>(tgrequest.toByteArray()));<br><span class="hljs-type">CloseableHttpClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> HttpClients.createDefault();<br><span class="hljs-type">CloseableHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.execute(request);<br><span class="hljs-comment">// å¤„ç† HTTP å“åº”</span><br><span class="hljs-type">HttpEntity</span> <span class="hljs-variable">entity</span> <span class="hljs-operator">=</span> response.getEntity();<br><span class="hljs-keyword">if</span> (entity != <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-comment">// å°†å“åº”å®ä½“è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„</span><br>    <span class="hljs-type">byte</span>[] data = toByteArray(entity.getContent());<br>    <span class="hljs-type">AddressBook</span> <span class="hljs-variable">addressBook</span> <span class="hljs-operator">=</span> AddressBook.parseFrom(data);<br>    System.out.println(addressBook);<br>&#125;<br><br><span class="hljs-comment">//è¯»å–å“åº”</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] toByteArray(InputStream in) <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>    <span class="hljs-type">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">4096</span>];<br>    <span class="hljs-type">int</span> len;<br>    <span class="hljs-keyword">while</span> ((len = in.read(buffer)) != -<span class="hljs-number">1</span>) &#123;<br>        out.write(buffer, <span class="hljs-number">0</span>, len);<br>    &#125;<br>    <span class="hljs-keyword">return</span> out.toByteArray();<br>&#125;<br><br></code></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œå°±ç®—æ˜¯å®Œæˆäº†ä¸€æ¬¡ä½¿ç”¨protocol bufferçš„äº¤äº’</p><h4 id="å…¶ä»–æ–¹å¼"><a href="#å…¶ä»–æ–¹å¼" class="headerlink" title="å…¶ä»–æ–¹å¼"></a>å…¶ä»–æ–¹å¼</h4><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>protostuff</code>è¿™ä¸ªåº“ï¼Œä»è€Œä¸å€ŸåŠ©<code>.proto</code>æ–‡ä»¶å°±å¯ä»¥ç›´æ¥å¯¹POJOè¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚<br>è¯¦æƒ…å¯ä»¥æŸ¥çœ‹è¿™ä¸ªä»“åº“ <a href="https://github.com/protostuff/protostuff">https://github.com/protostuff/protostuff</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ€è¿‘å’Œä¸‰æ–¹å¯¹æ¥æ—¶ï¼Œå¯¹æ–¹ç»™å‡ºçš„æ¥å£æ–‡æ¡£æ˜¯ä½¿ç”¨protol bufferè¿›è¡Œäº¤äº’çš„ï¼Œå¹¶éæ˜¯æˆ‘ä»¬å¸¸è§çš„jsonã€xmlè¿™ç§æ ¼å¼ï¼Œäº†è§£äº†ä¸€ä¸‹è¿™ç§æ ¼å¼æˆ–è€…è¯´äº¤åè®®çš„ç‰¹ç‚¹ã€‚&lt;br&gt;é¦–å…ˆï¼ŒProtocol Bufferåºåˆ—åŒ–ä¹‹åæ˜¯äºŒè¿›åˆ¶æµï¼Œä¸è¿›è¡Œååºåˆ—åŒ–åŸºæœ¬ä¸å¯è¯»ã€‚&lt;br&gt;å…¶æ¬¡ï¼Œåºåˆ—åŒ–ä¹‹åçš„ä½“ç§¯å¾ˆå°ï¼Œé€‚åˆç½‘ç»œä¼ è¾“æˆ–è€…è®¾å¤‡ä¹‹é—´ä¼ è¾“&lt;br&gt;æœ€åï¼Œå¯ä»¥è·¨å¹³å°ã€è·¨è¯­è¨€ä½¿ç”¨&lt;br&gt;ä¸è¿‡è¿™äº›ç‰¹ç‚¹æ—¢æ˜¯ä¼˜ç‚¹ä¹Ÿæ˜¯ç¼ºç‚¹ï¼šåºåˆ—åŒ–ä¹‹åçš„æ•°æ®ä¸å¯è¯»ï¼Œè¿˜åŸåºåˆ—åŒ–ä¹‹åçš„æ•°æ®éœ€è¦äº‹å…ˆå®šä¹‰å¥½çš„æ•°æ®æ ¼å¼&lt;/p&gt;</summary>
    
    
    
    
    <category term="Java" scheme="https://blog.huangyuanlove.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>flutter_Key</title>
    <link href="https://blog.huangyuanlove.com/2023/01/23/flutter-Key/"/>
    <id>https://blog.huangyuanlove.com/2023/01/23/flutter-Key/</id>
    <published>2023-01-23T06:31:47.000Z</published>
    <updated>2023-05-19T12:51:02.230Z</updated>
    
    <content type="html"><![CDATA[<p>å®˜æ–¹è§†é¢‘åœ¨è¿™é‡Œï¼Œæœ‰æ¡ä»¶çš„å¯ä»¥çœ‹ä¸‹<br><a href="https://www.youtube.com/watch?v=kn0EOS-ZiIc">https://www.youtube.com/watch?v=kn0EOS-ZiIc</a><br>ä¹Ÿå¯ä»¥çœ‹ä¸‹è¿™ä¸ªå¯¹diffç®—æ³•çš„è¯¦è§£<br><a href="https://juejin.cn/post/6935422635194974244">https://juejin.cn/post/6935422635194974244</a><br>ä¸»è¦ä»£ç å¦‚ä¸‹</p><span id="more"></span><p>ä¸€ä¸ªç”¨äºè·å–é¢œè‰²çš„RandomColor</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RandomColor</span> </span>&#123;<br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Random _random = Random();<br><br>  <span class="hljs-keyword">static</span> Color getColor() &#123;<br>    <span class="hljs-keyword">return</span> Color.fromRGBO(<br>      _random.nextInt(<span class="hljs-number">256</span>),<br>      _random.nextInt(<span class="hljs-number">256</span>),<br>      _random.nextInt(<span class="hljs-number">256</span>),<br>      <span class="hljs-number">1</span>,<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªç»§æ‰¿è‡ªStatefulWidgetçš„widgetï¼Œä½¿ç”¨Stateä¿å­˜äº†é¢œè‰²ä¿¡æ¯</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RandomColorBoxStateful</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  RandomColorBoxStateful(&#123;Key? key&#125;) : <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-meta">@override</span><br>  State&lt;RandomColorBoxStateful&gt; createState() =&gt; RandomColorBoxState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RandomColorBoxState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">RandomColorBoxStateful</span>&gt; </span>&#123;<br><br>  <span class="hljs-keyword">late</span> Color myColor;<br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> initState() &#123;<br>    <span class="hljs-keyword">super</span>.initState();<br>    myColor = RandomColor.getColor();<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Text(<span class="hljs-string">&quot;<span class="hljs-subst">$myColor</span>&quot;</span>,style: TextStyle(color: myColor),);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªç»§æ‰¿è‡ªStatelessWidgetçš„widgetï¼Œå†…å®¹å·®ä¸å¤š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RandomColorBoxStateless</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>   RandomColorBoxStateless(&#123;Key? key&#125;) : <span class="hljs-keyword">super</span>(key: key);<br>  Color myColor = RandomColor.getColor();<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>      <span class="hljs-keyword">return</span> Text(<span class="hljs-string">&quot;<span class="hljs-subst">$myColor</span>&quot;</span>,style: TextStyle(color: myColor),););<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªç”¨æ¥æ˜¾ç¤ºç•Œé¢çš„SwapColorBox</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SwapColorBox</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  State&lt;StatefulWidget&gt; createState() =&gt; SwapColorBoxState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SwapColorBoxState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">SwapColorBox</span>&gt; </span>&#123;<br>  <span class="hljs-built_in">List</span>&lt;Widget&gt; tiles = [ RandomColorBoxStateful(), RandomColorBoxStateful() ];<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      body: SafeArea(child: Column(children: tiles)),<br>      floatingActionButton: FloatingActionButton(<br>        child: Icon(Icons.sentiment_very_satisfied),<br>        onPressed: swapTiles,<br>      ),<br>    );<br>  &#125;<br><br>  <span class="hljs-keyword">void</span> swapTiles() &#123;<br>    setState(() &#123;<br>      <span class="hljs-built_in">List</span>&lt;Widget&gt; tmp = [tiles[<span class="hljs-number">1</span>],tiles[<span class="hljs-number">0</span>]];<br>      tiles = tmp;<br>    &#125;);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ—¶ç‚¹å‡»floatingActionButtonä¼šå‘ç°é¡µé¢æ²¡æœ‰å˜åŒ–ã€‚</p><h3 id="å¦‚ä½•ä¿®æ”¹"><a href="#å¦‚ä½•ä¿®æ”¹" class="headerlink" title="å¦‚ä½•ä¿®æ”¹"></a>å¦‚ä½•ä¿®æ”¹</h3><p>å¥½å‡ ç§åŠæ³•</p><ul><li>å°†SwapColorBoxStateä¸­çš„tilesæ”¹ä¸º List<Widget> tiles &#x3D; [ RandomColorBoxStateless(), RandomColorBoxStateless() ]</li><li>å°†SwapColorBoxStateä¸­çš„tilesä¸­RandomColorBoxStatefulåŠ ä¸ŠUniqueKey: List<Widget> tiles &#x3D; [ RandomColorBoxStateful(key: UniqueKey(),), RandomColorBoxStateful(key: UniqueKey(),) ];</li><li>å°†RandomColorBoxStatefulä¸­çš„myColoræ”¾åœ¨RandomColorBoxStatefulä¸­è€Œä¸æ˜¯RandomColorBoxStateä¸­</li></ul><h3 id="ä¸ºä»€ä¹ˆ"><a href="#ä¸ºä»€ä¹ˆ" class="headerlink" title="ä¸ºä»€ä¹ˆ"></a>ä¸ºä»€ä¹ˆ</h3><p>å…ƒç´ æ ‘æ²¡æœ‰äº¤æ¢ï¼Œè™½ç„¶æˆ‘ä»¬äº¤æ¢äº†Widgetï¼Œä½†æ˜¯å…¶Elementå¹¶æ²¡æœ‰äº¤æ¢ï¼Œè€Œé¢œè‰²çŠ¶æ€åˆæ˜¯ç”±Stateç»´æŠ¤ï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œbuildçš„æ—¶å€™é¢œè‰²å¹¶æ²¡æœ‰å˜åŒ–ã€‚<br>å…ˆçœ‹ä¸‹æ›´æ–°çš„ä»£ç </p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">Element</span>&gt; updateChildren(<span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">Element</span>&gt; oldChildren, <span class="hljs-built_in">List</span>&lt;Widget&gt; newWidgets, &#123; <span class="hljs-built_in">Set</span>&lt;<span class="hljs-built_in">Element</span>&gt;? forgottenChildren, <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">Object?</span>&gt;? slots &#125;) &#123;<br><br><br>  <span class="hljs-built_in">Element?</span> replaceWithNullIfForgotten(<span class="hljs-built_in">Element</span> child) &#123;<br>    <span class="hljs-keyword">return</span> forgottenChildren != <span class="hljs-keyword">null</span> &amp;&amp; forgottenChildren.contains(child) ? <span class="hljs-keyword">null</span> : child;<br>  &#125;<br><br>  <span class="hljs-built_in">Object?</span> slotFor(<span class="hljs-built_in">int</span> newChildIndex, <span class="hljs-built_in">Element?</span> previousChild) &#123;<br>    <span class="hljs-keyword">return</span> slots != <span class="hljs-keyword">null</span><br>      ? slots[newChildIndex]<br>      : IndexedSlot&lt;<span class="hljs-built_in">Element?</span>&gt;(newChildIndex, previousChild);<br>  &#125;<br><br><br>  <span class="hljs-built_in">int</span> newChildrenTop = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">int</span> oldChildrenTop = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">int</span> newChildrenBottom = newWidgets.length - <span class="hljs-number">1</span>;<br>  <span class="hljs-built_in">int</span> oldChildrenBottom = oldChildren.length - <span class="hljs-number">1</span>;<br><br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">Element</span>&gt; newChildren = oldChildren.length == newWidgets.length ?<br>      oldChildren : <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">Element</span>&gt;.filled(newWidgets.length, _NullElement.instance);<br><br>  <span class="hljs-built_in">Element?</span> previousChild;<br><br>  <span class="hljs-comment">// Update the top of the list.</span><br>  <span class="hljs-keyword">while</span> ((oldChildrenTop &lt;= oldChildrenBottom) &amp;&amp; (newChildrenTop &lt;= newChildrenBottom)) &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">Element?</span> oldChild = replaceWithNullIfForgotten(oldChildren[oldChildrenTop]);<br>    <span class="hljs-keyword">final</span> Widget newWidget = newWidgets[newChildrenTop];<br>   <br>    <span class="hljs-keyword">if</span> (oldChild == <span class="hljs-keyword">null</span> || !Widget.canUpdate(oldChild.widget, newWidget))<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">Element</span> newChild = updateChild(oldChild, newWidget, slotFor(newChildrenTop, previousChild))!;<br>    <br>    newChildren[newChildrenTop] = newChild;<br>    previousChild = newChild;<br>    newChildrenTop += <span class="hljs-number">1</span>;<br>    oldChildrenTop += <span class="hljs-number">1</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// Scan the bottom of the list.</span><br>  <span class="hljs-keyword">while</span> ((oldChildrenTop &lt;= oldChildrenBottom) &amp;&amp; (newChildrenTop &lt;= newChildrenBottom)) &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">Element?</span> oldChild = replaceWithNullIfForgotten(oldChildren[oldChildrenBottom]);<br>    <span class="hljs-keyword">final</span> Widget newWidget = newWidgets[newChildrenBottom];<br>    <br>    <span class="hljs-keyword">if</span> (oldChild == <span class="hljs-keyword">null</span> || !Widget.canUpdate(oldChild.widget, newWidget))<br>      <span class="hljs-keyword">break</span>;<br>    oldChildrenBottom -= <span class="hljs-number">1</span>;<br>    newChildrenBottom -= <span class="hljs-number">1</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// Scan the old children in the middle of the list.</span><br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> haveOldChildren = oldChildrenTop &lt;= oldChildrenBottom;<br>  <span class="hljs-built_in">Map</span>&lt;Key, <span class="hljs-built_in">Element</span>&gt;? oldKeyedChildren;<br>  <span class="hljs-keyword">if</span> (haveOldChildren) &#123;<br>    oldKeyedChildren = &lt;Key, <span class="hljs-built_in">Element</span>&gt;&#123;&#125;;<br>    <span class="hljs-keyword">while</span> (oldChildrenTop &lt;= oldChildrenBottom) &#123;<br>      <span class="hljs-keyword">final</span> <span class="hljs-built_in">Element?</span> oldChild = replaceWithNullIfForgotten(oldChildren[oldChildrenTop]);<br>     <br>      <span class="hljs-keyword">if</span> (oldChild != <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-keyword">if</span> (oldChild.widget.key != <span class="hljs-keyword">null</span>)<br>          oldKeyedChildren[oldChild.widget.key!] = oldChild;<br>        <span class="hljs-keyword">else</span><br>          deactivateChild(oldChild);<br>      &#125;<br>      oldChildrenTop += <span class="hljs-number">1</span>;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-comment">// Update the middle of the list.</span><br>  <span class="hljs-keyword">while</span> (newChildrenTop &lt;= newChildrenBottom) &#123;<br>    <span class="hljs-built_in">Element?</span> oldChild;<br>    <span class="hljs-keyword">final</span> Widget newWidget = newWidgets[newChildrenTop];<br>    <span class="hljs-keyword">if</span> (haveOldChildren) &#123;<br>      <span class="hljs-keyword">final</span> Key? key = newWidget.key;<br>      <span class="hljs-keyword">if</span> (key != <span class="hljs-keyword">null</span>) &#123;<br>        oldChild = oldKeyedChildren![key];<br>        <span class="hljs-keyword">if</span> (oldChild != <span class="hljs-keyword">null</span>) &#123;<br>          <span class="hljs-keyword">if</span> (Widget.canUpdate(oldChild.widget, newWidget)) &#123;<br>            <span class="hljs-comment">// we found a match!</span><br>            <span class="hljs-comment">// remove it from oldKeyedChildren so we don&#x27;t unsync it later</span><br>            oldKeyedChildren.remove(key);<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// Not a match, let&#x27;s pretend we didn&#x27;t see it for now.</span><br>            oldChild = <span class="hljs-keyword">null</span>;<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>   <br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">Element</span> newChild = updateChild(oldChild, newWidget, slotFor(newChildrenTop, previousChild))!;<br>   <br>    newChildren[newChildrenTop] = newChild;<br>    previousChild = newChild;<br>    newChildrenTop += <span class="hljs-number">1</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// We&#x27;ve scanned the whole list.</span><br>  <br>  newChildrenBottom = newWidgets.length - <span class="hljs-number">1</span>;<br>  oldChildrenBottom = oldChildren.length - <span class="hljs-number">1</span>;<br><br>  <span class="hljs-comment">// Update the bottom of the list.</span><br>  <span class="hljs-keyword">while</span> ((oldChildrenTop &lt;= oldChildrenBottom) &amp;&amp; (newChildrenTop &lt;= newChildrenBottom)) &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">Element</span> oldChild = oldChildren[oldChildrenTop];<br>   <br>    <span class="hljs-keyword">final</span> Widget newWidget = newWidgets[newChildrenTop];<br>   <br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">Element</span> newChild = updateChild(oldChild, newWidget, slotFor(newChildrenTop, previousChild))!;<br>   <br>    newChildren[newChildrenTop] = newChild;<br>    previousChild = newChild;<br>    newChildrenTop += <span class="hljs-number">1</span>;<br>    oldChildrenTop += <span class="hljs-number">1</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// Clean up any of the remaining middle nodes from the old list.</span><br>  <span class="hljs-keyword">if</span> (haveOldChildren &amp;&amp; oldKeyedChildren!.isNotEmpty) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> <span class="hljs-built_in">Element</span> oldChild <span class="hljs-keyword">in</span> oldKeyedChildren.values) &#123;<br>      <span class="hljs-keyword">if</span> (forgottenChildren == <span class="hljs-keyword">null</span> || !forgottenChildren.contains(oldChild))<br>        deactivateChild(oldChild);<br>    &#125;<br>  &#125;<br> <br>  <span class="hljs-keyword">return</span> newChildren;<br>&#125;<br></code></pre></td></tr></table></figure><p>å‰ç½®æ¡ä»¶ï¼š</p><h4 id="Widget-canUpdate"><a href="#Widget-canUpdate" class="headerlink" title="Widget.canUpdate()"></a>Widget.canUpdate()</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> canUpdate(Widget oldWidget, Widget newWidget) &#123;<br>  <span class="hljs-keyword">return</span> oldWidget.runtimeType == newWidget.runtimeType<br>      &amp;&amp; oldWidget.key == newWidget.key;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¯”è¾ƒä¸¤ä¸ªWidgetçš„runtimeTypeå’Œkeyæ˜¯å¦ç›¸åŒ</p><h4 id="Element-update"><a href="#Element-update" class="headerlink" title="Element.update()"></a>Element.update()</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> update(<span class="hljs-keyword">covariant</span> Widget newWidget) &#123;<br>   _widget = newWidget;<br>&#125;<br></code></pre></td></tr></table></figure><p>åªæ˜¯ç®€å•çš„æ›¿æ¢æ‰€æŒæœ‰Widgetï¼Œå¹¶æ²¡æœ‰æ›´æ–°è‡ªå·±çš„å…¶ä»–å±æ€§</p><h3 id="æ›´æ–°ç®—æ³•"><a href="#æ›´æ–°ç®—æ³•" class="headerlink" title="æ›´æ–°ç®—æ³•"></a>æ›´æ–°ç®—æ³•</h3><p>framworkä¸­å°†èŠ‚ç‚¹åˆ—è¡¨åˆ†æˆäº†ä¸‰éƒ¨åˆ†ï¼šé¡¶éƒ¨ã€ä¸­é—´éƒ¨åˆ†ã€åº•éƒ¨ï¼Œå½“å‘ç”Ÿæ›´æ–°æ—¶ï¼Œå°½æœ€å¤§å¯èƒ½çš„å¤ç”¨Elementï¼Œæ— æ³•å¤ç”¨çš„æ‰ä¼šå»åˆ›å»ºæ–°çš„Element</p><ol><li>é¦–å…ˆè‡ªé¡¶å‘ä¸‹çš„è¿›è¡Œdiffå¹¶æ›´æ–°å­èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªwhileå¾ªç¯ï¼Œæ˜¯å¦èƒ½å¤ç”¨å°±æ˜¯è°ƒç”¨çš„canUpdate</li><li>ç„¶åè‡ªåº•å‘ä¸Šçš„è¿›è¡Œdiff(è¿™é‡Œæ²¡æœ‰æ›´æ–°å­èŠ‚ç‚¹)ï¼Œä¹Ÿå°±æ˜¯ç¬¬äºŒä¸ªwhileå¾ªç¯ï¼Œä¾ç„¶æ˜¯ç”¨canUpdateçœ‹åˆ¤æ–­æ˜¯å¦å¯ä»¥å¤ç”¨</li><li>ç„¶ååœ¨è¿™ä¸¤ä¸ªä¸­é—´çš„éƒ¨åˆ†å¯»æ‰¾å¯ä»¥å¤ç”¨çš„Elementï¼Œå¹¶è¿›è¡Œå­˜å‚¨</li><li>è¿™æ—¶å€™å°±å·²ç»æ‰«æå®Œæ•´æ£µæ ‘äº†ï¼Œæ¥ä¸‹æ¥æ›´æ–°ä¸­é—´éƒ¨åˆ†</li><li>æœ€åæ›´æ–°åº•éƒ¨</li></ol><p>ä¸ºä»€ä¹ˆåœ¨è‡ªåº•å‘ä¸Šçš„è¿›è¡Œdiffæ—¶å€™æ²¡æœ‰æ›´æ–°ï¼šå› ä¸ºè¿™æ—¶å€™æ‹¿ä¸åˆ°Slotä¿¡æ¯<br>å›åˆ°æˆ‘ä»¬ä¸Šé¢æåˆ°çš„ä¾‹å­ä¸­ç‚¹å‡»æŒ‰é’®æ—¶ä¼šè§¦å‘<code>Column</code>çš„æ›´æ–°ï¼Œä¹Ÿå°±æ˜¯<code>MultiChildRenderObjectElement</code>çš„æ›´æ–°ï¼Œå°±ä¼šè§¦å‘ä¸Šé¢çš„<code>updateChildren()</code>æ–¹æ³•<br>æ‰€ä»¥åœ¨è‡ªé¡¶å‘ä¸‹çš„æ›´æ–°ä¸­ï¼Œ<code>canUpdate()</code>è¿”å›çš„æ˜¯<code>true</code>(å½“æˆ‘ä»¬è®¾ç½®äº†Keyä¹‹åï¼Œè¿™é‡Œä¼šè¿”å›falseï¼Œä¸è¿›è¡Œå¤ç”¨)ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å¤ç”¨<code>element</code>ï¼Œæ¥ç€æ‰§è¡Œäº†<code>updateChild(Element? child, Widget? newWidget, Object? newSlot)</code><br>è¿™é‡Œçš„<code>child</code>æ˜¯<em>æ—§element</em>ï¼Œ<code>newWidget</code>ä¹Ÿå°±æ˜¯è¦æ˜¾ç¤ºçš„<em>widget</em>ï¼Œä¸¤è€…å¹¶ä¸ç›¸ç­‰ï¼Œæ‰€ä»¥å°±æ‰§è¡Œäº†<code>child.update(newWidget);</code>åªæ˜¯ç®€å•çš„å¯¹æ‰€æŒæœ‰çš„<code>widget</code>è¿›è¡Œäº†èµ‹å€¼ã€‚æˆ‘ä»¬çŸ¥é“<code>StatefullWidget</code>ä¸­<code>State</code>å’Œ<code>StatefulElement</code>äº’ç›¸æŒæœ‰ï¼Œå¹¶ä¸”ä¸¤è€…éƒ½æŒæœ‰<code>StatefulWidget</code>ã€‚æ‰€ä»¥<code>State</code>å¹¶æ²¡æœ‰è¢«æ›´æ–°ï¼Œæ‰€æŒæœ‰çš„é¢œè‰²å€¼è¿˜æ˜¯äº¤æ¢ä¹‹å‰çš„é¢œè‰²å€¼ï¼Œæ‰€ä»¥ç‚¹å‡»äº¤æ¢æŒ‰é’®åï¼Œ<code>Widget</code>è™½ç„¶äº¤æ¢äº†ä½ç½®ï¼Œä½†æ˜¯<code>Element</code>å¹¶æ²¡æœ‰æ›´æ–°ã€‚<br>æœ‰ç‚¹åƒæ˜¯Aæœºå™¨ç”Ÿäº§Aç‰©å“ï¼ŒBæœºå™¨ç”Ÿäº§Bç‰©å“ï¼›åŸæ¥æ“ä½œæœºå™¨Açš„å»æ“ä½œæœºå™¨Bï¼ŒåŸæ¥æ“ä½œæœºå™¨Bçš„å»æ“ä½œæœºå™¨Aï¼Œè™½ç„¶æ¢äº†æ“ä½œå‘˜ï¼Œä½†ç”Ÿäº§Açš„æœºå™¨è¿˜æ˜¯ç”Ÿäº§Aï¼Œç”Ÿäº§Bçš„æœºå™¨è¿˜æ˜¯ç”Ÿäº§Bã€‚</p><h3 id="key"><a href="#key" class="headerlink" title="key"></a>key</h3><p>è¿™é‡Œçš„keyå°±ä¸¤ä¸ªåˆ†æ”¯<code>LocalKey</code> å’Œ<code>GlobalKey</code> ã€‚æˆ‘ä»¬çŸ¥é“<em>key</em>çš„ä½œç”¨å°±æ˜¯ä¸º<code>Widget</code>ç¡®è®¤å”¯ä¸€çš„èº«ä»½ï¼Œå¯ä»¥åœ¨å¤šå­ç»„ä»¶æ›´æ–°ä¸­è¢«è¯†åˆ«ï¼Œè¿™å°±æ˜¯<code>LocalKey</code>çš„ä½œç”¨ã€‚æ‰€ä»¥<code>LocalKey</code>ä¿è¯çš„æ˜¯ <strong>ç›¸åŒçˆ¶çº§</strong>ç»„ä»¶çš„èº«ä»½å”¯ä¸€æ€§ã€‚è€Œ <code>GlobalKey</code> æ˜¯æ•´ä¸ªåº”ç”¨ä¸­ï¼Œç»„ä»¶çš„èº«ä»½å”¯ä¸€ã€‚</p><p><code>LocalKey</code>ä¸‹é¢æœ‰<code>UniqueKey</code>ã€<code>ValueKey&lt;T&gt;</code>ã€<code>ObjectKey</code>,åŒºåˆ«ä¹Ÿå¾ˆç®€å•ï¼Œæˆ³è¿›å»çœ‹ä¸‹æºç å°±å¥½äº†</p><h4 id="Globalkey"><a href="#Globalkey" class="headerlink" title="Globalkey"></a>Globalkey</h4><p>å¯¹äº<code>GlobalKey</code>æ¥è®²ï¼Œåªè¦è·å–åˆ°äº†<code>Element</code>ï¼Œå°±èƒ½è·å–åˆ°<code>Widget</code>å¯¹è±¡ã€‚åªè¦<code>Element</code>æ˜¯<code>StatefulElement</code>ï¼Œå°±èƒ½è·å–åˆ°<code>State</code>.<br>é‚£ä¹ˆå¦‚ä½•è·å–åˆ°Elementå‘¢ï¼Ÿ</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-built_in">Element?</span> <span class="hljs-keyword">get</span> _currentElement =&gt; WidgetsBinding.instance.buildOwner!._globalKeyRegistry[<span class="hljs-keyword">this</span>];<br><br><span class="hljs-comment">///<span class="language-markdown">BuildOwner</span></span><br><span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;GlobalKey, <span class="hljs-built_in">Element</span>&gt; _globalKeyRegistry = &lt;GlobalKey, <span class="hljs-built_in">Element</span>&gt;&#123;&#125;;<br><span class="hljs-keyword">void</span> _registerGlobalKey(GlobalKey key, <span class="hljs-built_in">Element</span> element) &#123;<br>  _globalKeyRegistry[key] = element;<br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨_registerGlobalKeyæ³¨å†Œçš„å‘¢ï¼Ÿå‰é¢æåˆ°çš„mountæ–¹æ³•ä¸­</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">if</span> (key <span class="hljs-keyword">is</span> GlobalKey) &#123;<br>  owner!._registerGlobalKey(key, <span class="hljs-keyword">this</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° å°±æ˜¯åœ¨è¿™é‡Œæ³¨å†Œçš„ã€‚<br>å¹¶ä¸”ä¼šåœ¨unmountä¸­è¿›è¡Œåæ³¨å†Œ</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> Key? key = _widget?.key;<br><span class="hljs-keyword">if</span> (key <span class="hljs-keyword">is</span> GlobalKey) &#123;<br>  owner!._unregisterGlobalKey(key, <span class="hljs-keyword">this</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>æºç ä¸­ä¹Ÿå¯¹<code>GlobalKey</code>çš„ä½¿ç”¨åœºæ™¯åšå‡ºäº†ä»‹ç»ï¼Œå½“ä½ çœŸçš„éœ€è¦è·å–æŸä¸ª<code>BuildContext</code>æˆ–<code>State</code>æ—¶ï¼Œç”¨<code>GlobalKey</code>æ˜¯å®Œå…¨æ²¡æœ‰é—®é¢˜çš„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;å®˜æ–¹è§†é¢‘åœ¨è¿™é‡Œï¼Œæœ‰æ¡ä»¶çš„å¯ä»¥çœ‹ä¸‹&lt;br&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=kn0EOS-ZiIc&quot;&gt;https://www.youtube.com/watch?v=kn0EOS-ZiIc&lt;/a&gt;&lt;br&gt;ä¹Ÿå¯ä»¥çœ‹ä¸‹è¿™ä¸ªå¯¹diffç®—æ³•çš„è¯¦è§£&lt;br&gt;&lt;a href=&quot;https://juejin.cn/post/6935422635194974244&quot;&gt;https://juejin.cn/post/6935422635194974244&lt;/a&gt;&lt;br&gt;ä¸»è¦ä»£ç å¦‚ä¸‹&lt;/p&gt;</summary>
    
    
    
    
    <category term="Flutter" scheme="https://blog.huangyuanlove.com/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>flutter_StatefulWidget</title>
    <link href="https://blog.huangyuanlove.com/2023/01/18/flutter-StatefulWidget/"/>
    <id>https://blog.huangyuanlove.com/2023/01/18/flutter-StatefulWidget/</id>
    <published>2023-01-18T08:00:47.000Z</published>
    <updated>2023-05-19T12:51:02.230Z</updated>
    
    <content type="html"><![CDATA[<h3 id="createState-æ˜¯ä½•æ—¶è¢«è°ƒç”¨çš„ï¼Ÿ"><a href="#createState-æ˜¯ä½•æ—¶è¢«è°ƒç”¨çš„ï¼Ÿ" class="headerlink" title="createState()æ˜¯ä½•æ—¶è¢«è°ƒç”¨çš„ï¼Ÿ"></a>createState()æ˜¯ä½•æ—¶è¢«è°ƒç”¨çš„ï¼Ÿ</h3><p>æ–­ç‚¹æŸ¥çœ‹è°ƒç”¨æ ˆï¼Œå‘ç°æ˜¯åœ¨<code>StatefulElement</code>çš„æ„é€ æ–¹æ³•ä¸­åˆ›å»ºçš„,è€Œ<code>element</code>çš„åˆ›å»ºåˆ™æ˜¯åœ¨çˆ¶å…ƒç´ è°ƒç”¨<code>inflateWidget</code>æ—¶è§¦å‘å­å…ƒç´ çš„<code>createElement</code>æ–¹æ³•åˆ›å»ºçš„</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dart">StatefulElement(StatefulWidget widget)<br>    : _state = widget.createState(),<br>      <span class="hljs-keyword">super</span>(widget) &#123;<br>  state._element = <span class="hljs-keyword">this</span>;<br>  state._widget = widget;<br>&#125;<br></code></pre></td></tr></table></figure><p>å»æ‰æ–­è¨€ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ„é€ æ–¹æ³•ä¸­è°ƒç”¨äº†<code>createState()</code>æ¥åˆ›å»º<code>State</code>å¯¹è±¡ï¼Œæ¥ç€å¯¹<code>_state</code>å¯¹è±¡çš„<code>_element</code>å’Œ<code>_widget</code>æˆå‘˜è¿›è¡Œèµ‹å€¼ã€‚<br>åˆ°è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ¸…æ¥šçš„çŸ¥é“:<code>State</code>å’Œ<code>StatefulElement</code>äº’ç›¸æŒæœ‰ï¼Œå¹¶ä¸”ä¸¤è€…éƒ½æŒæœ‰<code>StatefulWidget</code>ã€‚</p><h3 id="Stateç±»ä¸­çš„æ–¹æ³•"><a href="#Stateç±»ä¸­çš„æ–¹æ³•" class="headerlink" title="Stateç±»ä¸­çš„æ–¹æ³•"></a>Stateç±»ä¸­çš„æ–¹æ³•</h3><p>è¿™é‡Œé¢å®šä¹‰äº†ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</p><ul><li>initState()</li><li>didUpdateWidget(covariant T oldWidget)</li><li>void reassemble()</li><li>void deactivate()</li><li>void activate()</li><li>void dispose()</li><li>Widget build(BuildContext context)</li><li>void didChangeDependencies()</li></ul><p>å…¶å®çœ‹ä¸€ä¸‹è¿™äº›æ–¹æ³•ä¸Šé¢çš„æ³¨é‡ŠåŸºæœ¬ä¸Šå°±èƒ½ç†è§£çš„å·®ä¸å¤šï¼Œæ–­ç‚¹èµ°ä¸€éæµç¨‹ï¼Œä¹Ÿå°±éƒ½äº†è§£äº†</p><h3 id="å›è°ƒæ—¶æœº"><a href="#å›è°ƒæ—¶æœº" class="headerlink" title="å›è°ƒæ—¶æœº"></a>å›è°ƒæ—¶æœº</h3><p><code>StatefulElement</code>ç»§æ‰¿è‡ª<code>ComponentElement</code>ç±»ï¼Œè¯¥ç±»åœ¨<code>mount()</code>æ—¶è°ƒç”¨çš„äº†<code>_firstBuild()</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è¢«<code>StatefulElement</code>è¦†å†™ï¼Œå¯ä»¥çœ‹åˆ°åœ¨è¿™é‡Œé‡Œé¢è°ƒç”¨äº†<code>state.initState()</code>æ–¹æ³•</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@override</span><br><span class="hljs-keyword">void</span> _firstBuild() &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    _debugSetAllowIgnoredCallsToMarkNeedsBuild(<span class="hljs-keyword">true</span>);<br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">Object?</span> debugCheckForReturnedFuture = state.initState() <span class="hljs-keyword">as</span> <span class="hljs-built_in">dynamic</span>;<br>  &#125; <span class="hljs-keyword">finally</span> &#123;<br>    _debugSetAllowIgnoredCallsToMarkNeedsBuild(<span class="hljs-keyword">false</span>);<br>  &#125;<br>  state.didChangeDependencies();<br>  <span class="hljs-keyword">super</span>._firstBuild();<br>&#125;<br></code></pre></td></tr></table></figure><p>ç´§ç€è¿™å°±è°ƒç”¨äº†<code>state.didChangeDependencies()</code>æ–¹æ³•,æœ€åè°ƒç”¨äº†<code>super._firstBuild()</code>;<br>è¿˜æ˜¯åœ¨<code>ComponentElement</code>ç±»ä¸­çš„<code>_firstBuild()</code>æ–¹æ³•ä¸­è°ƒç”¨äº†<code>rebuild()--&gt;performRebuild</code>,è¿™é‡Œ<code>performRebuild()</code>åœ¨<code>StatefulElement</code>æœ‰è¢«é‡å†™</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@override</span><br><span class="hljs-keyword">void</span> performRebuild() &#123;<br>  <span class="hljs-keyword">if</span> (_didChangeDependencies) &#123;<br>    state.didChangeDependencies();<br>    _didChangeDependencies = <span class="hljs-keyword">false</span>;<br>  &#125;<br>  <span class="hljs-keyword">super</span>.performRebuild();<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>_didChangeDependencies</code>é»˜è®¤ä¸º<code>false</code>ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡è¿›æ¥å¹¶ä¸ä¼šè§¦å‘<code>state.didChangeDependencies()</code>æ–¹æ³•;æ¥ä¸‹æ¥æ‰§è¡Œäº†<code>super.performRebuild()</code>;<br>åŒæ ·çš„åœ¨<code>ComponentElement</code>ç±»ä¸­çš„<code>performRebuild()</code>æ–¹æ³•ä¸­è°ƒç”¨äº†<code>build()</code>æ–¹æ³•,å½“ç„¶è¿™é‡Œçš„<code>build</code>æ–¹æ³•å·²ç»è¢«å­ç±»<code>StatefulElement</code>é‡å†™ï¼Œè°ƒç”¨äº†<code>state.build(this)</code>æ–¹æ³•ï¼Œç„¶åè°ƒç”¨äº†<code>updateChild()</code>æ–¹æ³•</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> performRebuild() &#123;<br>  <span class="hljs-keyword">assert</span>(_debugSetAllowIgnoredCallsToMarkNeedsBuild(<span class="hljs-keyword">true</span>));<br>  Widget? built;<br>  <span class="hljs-keyword">try</span> &#123;<br>    built = build();<br>    debugWidgetBuilderValue(widget, built);<br>  &#125; <span class="hljs-keyword">catch</span> (e, stack) &#123;<br>    _debugDoingBuild = <span class="hljs-keyword">false</span>;<br>    built = ErrorWidget.builder(...);<br>  &#125; <span class="hljs-keyword">finally</span> &#123;<br>     _dirty = <span class="hljs-keyword">false</span>;<br>    <br>  &#125;<br>  <span class="hljs-keyword">try</span> &#123;<br>    _child = updateChild(_child, built, slot);<br>    <br>  &#125; <span class="hljs-keyword">catch</span> (e, stack) &#123;<br>    built = ErrorWidget.builder();<br>    _child = updateChild(<span class="hljs-keyword">null</span>, built, slot);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ¥ä¸Šäº†æ§ä»¶æ˜¯å¦‚ä½•è¿›è¡ŒæŒ‚è½½çš„</p><h3 id="å¦‚ä½•æ›´æ–°"><a href="#å¦‚ä½•æ›´æ–°" class="headerlink" title="å¦‚ä½•æ›´æ–°"></a>å¦‚ä½•æ›´æ–°</h3><p>æˆ‘ä»¬çŸ¥é“åœ¨<code>StatefulWidget</code>ä¸­å¯ä»¥ä½¿ç”¨<code>setState()</code>æ¥æ›´æ–°é¡µé¢å†…å®¹ï¼Œé‚£ä¹ˆè¡¨ç¤ºçŠ¶æ€çš„å±æ€§æ˜¯åœ¨ä»€ä¹ˆæ—¶æœºèµ‹å€¼ï¼Œè¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">_color = Colors.red;<br>setState(()&#123;<br>&#125;);<br></code></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">setStaate(()&#123;<br>  _color = Colors.red;<br>&#125;);<br></code></pre></td></tr></table></figure><p>æˆ³è¿›å»çœ‹æºç </p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> setState(VoidCallback fn) &#123;<br>  <span class="hljs-keyword">assert</span>(fn != <span class="hljs-keyword">null</span>);<br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Object?</span> result = fn() <span class="hljs-keyword">as</span> <span class="hljs-built_in">dynamic</span>;<br>  <span class="hljs-keyword">assert</span>(() &#123;<br>    <span class="hljs-keyword">if</span> (result <span class="hljs-keyword">is</span> Future) &#123;<br>      <span class="hljs-keyword">throw</span> FlutterError.fromParts(&lt;DiagnosticsNode&gt;[<br>        ErrorSummary(<span class="hljs-string">&#x27;setState() callback argument returned a Future.&#x27;</span>),<br>        ErrorDescription(<br>          <span class="hljs-string">&#x27;The setState() method on <span class="hljs-subst">$this</span> was called with a closure or method that &#x27;</span><br>          <span class="hljs-string">&#x27;returned a Future. Maybe it is marked as &quot;async&quot;.&#x27;</span>,<br>        ),<br>        ErrorHint(<br>          <span class="hljs-string">&#x27;Instead of performing asynchronous work inside a call to setState(), first &#x27;</span><br>          <span class="hljs-string">&#x27;execute the work (without updating the widget state), and then synchronously &#x27;</span><br>          <span class="hljs-string">&#x27;update the state inside a call to setState().&#x27;</span>,<br>        ),<br>      ]);<br>    &#125;<br>    <span class="hljs-comment">// We ignore other types of return values so that you can do things like:</span><br>    <span class="hljs-comment">//   setState(() =&gt; x = 3);</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>  &#125;());<br>  _element!.markNeedsBuild();<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸€å¨æ–­è¨€ï¼Œåˆ¤æ–­<code>callback</code>æ˜¯ä¸æ˜¯ç©ºï¼Œ<code>callback</code>çš„è¿”å›å€¼æ˜¯ä¸æ˜¯<code>Future</code>ç±»å‹;ç„¶åè°ƒç”¨<code>_element!.markNeedsBuild()</code>ã€‚æ‰€ä»¥å°±è¿™æ®µä»£ç æ¥çœ‹ï¼Œä¸Šé¢ä¸¤ç§å†™æ³•éƒ½å¯ä»¥ï¼Œä½†è¿˜æ˜¯å»ºè®®å‘æºç çœ‹é½ï¼šçŠ¶æ€å±æ€§çš„æ”¹å˜å†™åœ¨<code>callback</code>ä¸­ï¼Œç¡®ä¿åœ¨<code>markNeedsBuild()</code>ä¹‹å‰ï¼ŒçŠ¶æ€å€¼æ˜¯è‡ªå·±æœŸæœ›çš„ç»“æœï¼›</p><h3 id="æ›´æ–°"><a href="#æ›´æ–°" class="headerlink" title="æ›´æ–°"></a>æ›´æ–°</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> markNeedsBuild() &#123;<br>  <span class="hljs-keyword">if</span> (_lifecycleState != _ElementLifecycle.active)<br>    <span class="hljs-keyword">return</span>;<br>  <span class="hljs-keyword">if</span> (dirty)<br>    <span class="hljs-keyword">return</span>;<br>  _dirty = <span class="hljs-keyword">true</span>;<br>  owner!.scheduleBuildFor(<span class="hljs-keyword">this</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœå½“å‰çŠ¶æ€ä¸æ˜¯activeåˆ™ä¸æ ‡è®°ï¼Œå¦‚æœå·²ç»æ ‡è®°è¿‡ä¹Ÿä¸åœ¨æ ‡è®°ï¼›</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">/// <span class="language-markdown">Adds an element to the dirty elements list so that it will be rebuilt</span></span><br><span class="hljs-comment">/// <span class="language-markdown">when [WidgetsBinding.drawFrame] calls [buildScope].</span></span><br><span class="hljs-keyword">void</span> scheduleBuildFor(<span class="hljs-built_in">Element</span> element) &#123;<br><br>  <span class="hljs-keyword">if</span> (element._inDirtyList) &#123;<br>    _dirtyElementsNeedsResorting = <span class="hljs-keyword">true</span>;<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (!_scheduledFlushDirtyElements &amp;&amp; onBuildScheduled != <span class="hljs-keyword">null</span>) &#123;<br>    _scheduledFlushDirtyElements = <span class="hljs-keyword">true</span>;<br>    onBuildScheduled!();<br>  &#125;<br>  _dirtyElements.add(element);<br>  element._inDirtyList = <span class="hljs-keyword">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¹Ÿæ˜¯è¿›è¡Œäº†äºŒæ¬¡åˆ¤æ–­ï¼Œä¿è¯ä¸ä¼šè¢«å¤šæ¬¡é‡ç»˜ã€‚æ³¨æ„<code>onBuildScheduled()</code>çš„è°ƒç”¨ï¼Œå®ƒçš„å®šä¹‰æ˜¯<code>VoidCallback? onBuildScheduled</code>;å¹¶ä¸”æ˜¯åœ¨<code>BuildOwner</code>ç±»ä¸­çš„æ„é€ æ–¹æ³•ä¸­åˆå§‹åŒ–çš„ï¼Œé‚£ä¹ˆè¿™ä¸ª<code>onBuildScheduled</code>åˆ°åº•æ˜¯ä»€ä¹ˆæ–¹æ³•?æ–­ç‚¹çœ‹ä¸€ä¸‹æ˜¯<code>WidgetsBinding#_handleBuildScheduled</code>è¿™ä¸ªæ–¹æ³•ã€‚å®ƒæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™è¢«èµ‹å€¼çš„ï¼Ÿ<code>owner</code>æ˜¯<code>element</code>å¯¹è±¡ä¸­çš„ä¸€ä¸ªæˆå‘˜å˜é‡<code>_owner</code>,æœä¸€ä¸‹çœ‹ä¸€çœ‹åˆ°æ˜¯åœ¨<code>mount()</code>æ–¹æ³•ä¸­èµ‹å€¼çš„ï¼Œå€¼ä¸º<code>parent.owner</code>ã€‚è¿˜è®°çš„ä¹‹å‰åˆå§‹åŒ–æ ¹èŠ‚ç‚¹çš„çš„æ—¶å€™è°ƒç”¨çš„<code>WidgetsBinding#attachRootWidget(Widget rootWidget)</code>è¿™ä¸ªæ–¹æ³•ä¸­åˆ›å»º<code>RenderObjectToWidgetAdapter</code>å¯¹è±¡åè°ƒç”¨çš„<code>attachToRenderTree()</code>æ–¹æ³•ä¸­æœ‰ä¼ å…¥<code>BuildOwner</code>å¯¹è±¡ï¼Œæ¥ç€å‘ä¸ŠæŸ¥æ‰¾ï¼Œå‘ç°æ˜¯åœ¨<code>initInstances()</code>æ–¹æ³•ä¸­åˆ›å»ºçš„.</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> initInstances() &#123;<br>  <span class="hljs-keyword">super</span>.initInstances();<br>  _instance = <span class="hljs-keyword">this</span>;<br>  <span class="hljs-comment">// Initialization of [_buildOwner] has to be done after</span><br>  <span class="hljs-comment">// [super.initInstances] is called, as it requires [ServicesBinding] to</span><br>  <span class="hljs-comment">// properly setup the [defaultBinaryMessenger] instance.</span><br>  _buildOwner = BuildOwner();<br>  buildOwner!.onBuildScheduled = _handleBuildScheduled;<br>  platformDispatcher.onLocaleChanged = handleLocaleChanged;<br>  platformDispatcher.onAccessibilityFeaturesChanged = handleAccessibilityFeaturesChanged;<br>  SystemChannels.navigation.setMethodCallHandler(_handleNavigationInvocation);<br><br>  platformMenuDelegate = DefaultPlatformMenuDelegate();<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨<code>_handleBuildScheduled</code> ä¸­å°±åªæ˜¯è°ƒç”¨äº†<code>ensureVisualUpdate()</code>æ–¹æ³•ï¼Œç„¶åè°ƒç”¨äº†<code>scheduleFrame()</code>;</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> scheduleFrame() &#123;<br>  <span class="hljs-keyword">if</span> (_hasScheduledFrame || !framesEnabled)<br>    <span class="hljs-keyword">return</span>;<br>  ensureFrameCallbacksRegistered();<br>  platformDispatcher.scheduleFrame();<br>  _hasScheduledFrame = <span class="hljs-keyword">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå…ˆç¡®ä¿ä¸¤ä¸ªå›è°ƒç¡®å®è¢«æ³¨å†Œäº†ï¼Œç„¶åé€šè¿‡<code>platformDispatcher.scheduleFrame()</code>è¿™ä¸ª<em>native</em>æ–¹æ³•å‘ç³»ç»Ÿå‘é€ä¸€ä¸ªå¸§è°ƒåº¦çš„è¯·æ±‚ã€‚<br>ç„¶åä¼šå›è°ƒ<code>_handleDrawFrame()</code>æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯<code>ensureFrameCallbacksRegistered()</code>æ–¹æ³•ä¸­ç¡®ä¿ä¸¤ä¸ªå›è°ƒæ–¹æ³•</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> handleDrawFrame() &#123;<br>  <span class="hljs-keyword">assert</span>(_schedulerPhase == SchedulerPhase.midFrameMicrotasks);<br>  _frameTimelineTask?.finish(); <span class="hljs-comment">// end the &quot;Animate&quot; phase</span><br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-comment">// PERSISTENT FRAME CALLBACKS</span><br>    _schedulerPhase = SchedulerPhase.persistentCallbacks;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> FrameCallback callback <span class="hljs-keyword">in</span> _persistentCallbacks)<br>      _invokeFrameCallback(callback, _currentFrameTimeStamp!);<br><br>    <span class="hljs-comment">// POST-FRAME CALLBACKS</span><br>    _schedulerPhase = SchedulerPhase.postFrameCallbacks;<br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;FrameCallback&gt; localPostFrameCallbacks =<br>        <span class="hljs-built_in">List</span>&lt;FrameCallback&gt;.of(_postFrameCallbacks);<br>    _postFrameCallbacks.clear();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> FrameCallback callback <span class="hljs-keyword">in</span> localPostFrameCallbacks)<br>      _invokeFrameCallback(callback, _currentFrameTimeStamp!);<br>  &#125; <span class="hljs-keyword">finally</span> &#123;<br>    _schedulerPhase = SchedulerPhase.idle;<br>    _frameTimelineTask?.finish(); <span class="hljs-comment">// end the Frame</span><br>    <span class="hljs-keyword">assert</span>(() &#123;<br>      <span class="hljs-keyword">if</span> (debugPrintEndFrameBanner)<br>        debugPrint(<span class="hljs-string">&#x27;â–€&#x27;</span> * _debugBanner!.length);<br>      _debugBanner = <span class="hljs-keyword">null</span>;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>    &#125;());<br>    _currentFrameTimeStamp = <span class="hljs-keyword">null</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åæ˜¯è°ƒç”¨ <code>_invokeFrameCallback</code>ï¼Œè¿™é‡Œçš„<code>_persistentCallbacks</code>æ˜¯ä¸ª<code>list</code>ï¼Œé€šè¿‡</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> addPersistentFrameCallback(FrameCallback callback) &#123;<br>  _persistentCallbacks.add(callback);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•æ·»åŠ å›è°ƒï¼›è¿™é‡Œçš„å›è°ƒæ˜¯åœ¨<code>RendererBinding</code>ç±»ä¸­çš„<code>initInstances()</code>æ–¹æ³•ä¸­æ³¨å†Œçš„ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ–¹æ³•æ˜¯</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart">_handlePersistentFrameCallback<br>  <span class="hljs-keyword">void</span> _handlePersistentFrameCallback(<span class="hljs-built_in">Duration</span> timeStamp) &#123;<br>    drawFrame();<br>    _scheduleMouseTrackerUpdate();<br>  &#125;<br></code></pre></td></tr></table></figure><p>ç„¶åè°ƒç”¨äº†<code>drawFrame();</code>æ–¹æ³•,éœ€è¦æ³¨æ„çš„æ˜¯:<code>RendererBinding</code>æ˜¯ä¸€ä¸ª<em>mixin</em>çš„ç±»ï¼Œè¢«<code>WidgetsBinding</code>æ··å…¥ï¼Œå¹¶ä¸”<code>WidgetsBinding</code>ç±»ä¸­é‡å†™äº†<code>drawFrame()</code>æ–¹æ³•ï¼Œæ‰€ä»¥æœ€åèµ°çš„æ˜¯<code>WidgetsBinding</code>ç±»ä¸­çš„<code>drawFrame()</code>æ–¹æ³•ï¼›åœ¨è¿™é‡Œé¢è°ƒç”¨äº†<code>buildOwner!.buildScope(renderViewElement!);</code><br>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å…ˆå¯¹è„åˆ—è¡¨è¿›è¡Œæ’åº</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> _sort(<span class="hljs-built_in">Element</span> a, <span class="hljs-built_in">Element</span> b) &#123;<br>  <span class="hljs-keyword">if</span> (a.depth &lt; b.depth)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  <span class="hljs-keyword">if</span> (b.depth &lt; a.depth)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span> (b.dirty &amp;&amp; !a.dirty)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  <span class="hljs-keyword">if</span> (a.dirty &amp;&amp; !b.dirty)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åå¾ªç¯è°ƒç”¨<code>element.rebuild();</code>è§¦å‘<code>performRebuild()</code>æ¥ç€å°±æ˜¯<code>widget</code>çš„<code>build()</code>æ–¹æ³•è¢«è§¦å‘.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;createState-æ˜¯ä½•æ—¶è¢«è°ƒç”¨çš„ï¼Ÿ&quot;&gt;&lt;a href=&quot;#createState-æ˜¯ä½•æ—¶è¢«è°ƒç”¨çš„ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;createState()æ˜¯ä½•æ—¶è¢«è°ƒç”¨çš„ï¼Ÿ&quot;&gt;&lt;/a&gt;createState()æ˜¯ä½•æ—¶è¢«è°ƒç”¨çš„ï¼Ÿ&lt;/h3</summary>
      
    
    
    
    
    <category term="Flutter" scheme="https://blog.huangyuanlove.com/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>flutter_runAppåˆ°æŒ‚è½½æ ¹èŠ‚ç‚¹</title>
    <link href="https://blog.huangyuanlove.com/2023/01/18/flutter-runApp%E5%88%B0%E6%8C%82%E8%BD%BD%E6%A0%B9%E8%8A%82%E7%82%B9/"/>
    <id>https://blog.huangyuanlove.com/2023/01/18/flutter-runApp%E5%88%B0%E6%8C%82%E8%BD%BD%E6%A0%B9%E8%8A%82%E7%82%B9/</id>
    <published>2023-01-18T02:18:15.000Z</published>
    <updated>2023-05-19T12:51:02.231Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å…¥å£"><a href="#å…¥å£" class="headerlink" title="å…¥å£"></a>å…¥å£</h2><p>flutteråº”ç”¨çš„å…¥å£ç‚¹åœ¨mainæ–¹æ³•ä¸­è°ƒç”¨çš„<code>runApp(Widget app)</code>æ–¹æ³•ä¸­</p><figure class="highlight dart"><figcaption><span>widgets.binding.runApp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> runApp(Widget app) &#123;<br>  WidgetsFlutterBinding.ensureInitialized()<br>    ..scheduleAttachRootWidget(app)<br>    ..scheduleWarmUpFrame();<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>WidgetsFlutterBinding</code>æ··å…¥äº†ä¸ƒä¸ª <code>xxxbinding</code></p><ul><li>[GestureBinding], which implements the basics of hit testing.</li><li>[SchedulerBinding], which introduces the concepts of frames.</li><li>[ServicesBinding], which provides access to the plugin subsystem.</li><li>[PaintingBinding], which enables decoding images.</li><li>[SemanticsBinding], which supports accessibility.</li><li>[RendererBinding], which handles the render tree.</li><li>[WidgetsBinding], which handles the widget tree.</li></ul><p>å¹¶ä¸”ç±»ä¸­åªæœ‰ä¸€ä¸ª<code>ensureInitialized()</code>æ–¹æ³•ç”¨æ¥åˆå§‹åŒ–<code>WidgetsBinding</code>å¯¹è±¡,æ¥ç€å»æ‰§è¡Œäº†<code>scheduleAttachRootWidget</code>ã€<code>scheduleWarmUpFrame</code>æ–¹æ³•<br>åœ¨<code>ensureInitialized</code>æ–¹æ³•ä¸­è°ƒç”¨<code>WidgetsFlutterBinding</code>è¿›è¡Œäº†åˆå§‹åŒ–</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">static</span> WidgetsBinding ensureInitialized() &#123;<br>  <span class="hljs-keyword">if</span> (WidgetsBinding._instance == <span class="hljs-keyword">null</span>)<br>    WidgetsFlutterBinding();<br>  <span class="hljs-keyword">return</span> WidgetsBinding.instance;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="scheduleAttachRootWidget"><a href="#scheduleAttachRootWidget" class="headerlink" title="scheduleAttachRootWidget"></a>scheduleAttachRootWidget</h3><p>æ¥ç€çœ‹ scheduleAttachRootWidgetè¿™ä¸ªæ–¹æ³•ä¸­æ‰§è¡Œäº†</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">Timer.run(() &#123;<br>  attachRootWidget(rootWidget);<br>&#125;);<br></code></pre></td></tr></table></figure><p>åœ¨attachRootWidgetæ–¹æ³•ä¸­</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> attachRootWidget(Widget rootWidget) &#123;<br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> isBootstrapFrame = renderViewElement == <span class="hljs-keyword">null</span>;<br>  _readyToProduceFrames = <span class="hljs-keyword">true</span>;<br>  _renderViewElement = RenderObjectToWidgetAdapter&lt;RenderBox&gt;(<br>    container: renderView,<br>    debugShortDescription: <span class="hljs-string">&#x27;[root]&#x27;</span>,<br>    child: rootWidget,<br>  ).attachToRenderTree(buildOwner!, renderViewElement <span class="hljs-keyword">as</span> RenderObjectToWidgetElement&lt;RenderBox&gt;?);<br>  <span class="hljs-keyword">if</span> (isBootstrapFrame) &#123;<br>    SchedulerBinding.instance.ensureVisualUpdate();<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„çœ‹è¿™é‡Œçš„<code>_renderViewElement</code>å¯¹è±¡æ˜¯ç”±<code>RenderObjectToWidgetAdapter.attachToRenderTree()</code>è¿”å›çš„;<br>åœ¨åˆå§‹åŒ–<code>RenderObjectToWidgetAdapter</code>å¯¹è±¡æ—¶ä¼ å…¥äº†<code>renderView</code> å’Œ<code>rootWidget</code>ä½œä¸ºå‚æ•°,è¿™é‡Œçš„<code>rootWidget</code>å°±æ˜¯æˆ‘ä»¬<code>runApp</code>ä¸­ä¼ å…¥çš„å‚æ•°;<br>é‚£ä¹ˆè¿™é‡Œçš„<code>renderView</code>æ˜¯ä»€ä¹ˆæ—¶å€™åˆå§‹åŒ–çš„?æˆ‘ä»¬åœ¨ä¸Šé¢æåˆ°çš„<code>WidgetsFlutterBinding</code>æ··å…¥äº†ä¸ƒä¸ª<code>xxxbinding</code>,è¿™é‡Œéœ€è¦äº†è§£mixinçš„æ‰§è¡Œé¡ºåº:<br>è™½ç„¶é¦–å…ˆæ‰§è¡Œçš„æ˜¯<code>WidgetsBinding</code>çš„<code>initInstances</code>æ–¹æ³•,ä½†ç”±äºç¬¬ä¸€å°±æ‰§è¡Œäº†<code>super.initInstances()</code>,æ‰€ä»¥ä¼šå…ˆæ‰§è¡Œå‰ä¸€ä¸ª<code>RenderBinding</code>çš„<code>initInstances</code>,ç„¶åä¸æ–­super,æ‰€ä»¥æœ€ç»ˆ<code>initInstances</code>å®é™…çš„é€»è¾‘æ‰§è¡Œé¡ºåº,å¯ä»¥çœ‹æˆæ˜¯ä»å‰é¢çš„Bindingå¾€åé¢çš„Binding,æ‰€ä»¥åœ¨<code>WidgetsBinding</code>çš„<code>attachRootWidget</code>æ–¹æ³•å†…<code>renderView</code>å·²ç»è¢«åˆå§‹åŒ–äº†.</p><h3 id="RenderObjectToWidgetAdapter"><a href="#RenderObjectToWidgetAdapter" class="headerlink" title="RenderObjectToWidgetAdapter"></a>RenderObjectToWidgetAdapter</h3><p>ç»§æ‰¿è‡ª<code>RenderObjectWidget</code>,å®ƒæœ‰ä¸¤ä¸ªå…³é”®çš„æŠ½è±¡æ–¹æ³•</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dart">RenderObjectElement createElement();<br>RenderObject createRenderObject(BuildContext context);<br></code></pre></td></tr></table></figure><p>çœ‹ä¸‹æ˜¯æ€ä¹ˆè¦†å†™çš„</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@override</span><br>RenderObjectToWidgetElement&lt;T&gt; createElement() =&gt; RenderObjectToWidgetElement&lt;T&gt;(<span class="hljs-keyword">this</span>);<br><br><span class="hljs-meta">@override</span><br>RenderObjectWithChildMixin&lt;T&gt; createRenderObject(BuildContext context) =&gt; container;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥ç€çœ‹attachToRenderTree</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs dart">RenderObjectToWidgetElement&lt;T&gt; attachToRenderTree(BuildOwner owner, [ RenderObjectToWidgetElement&lt;T&gt;? element ]) &#123;<br>  <span class="hljs-keyword">if</span> (element == <span class="hljs-keyword">null</span>) &#123;<br>    owner.lockState(() &#123;<br>      element = createElement();<br>      <span class="hljs-keyword">assert</span>(element != <span class="hljs-keyword">null</span>);<br>      element!.assignOwner(owner);<br>    &#125;);<br>    owner.buildScope(element!, () &#123;<br>      element!.mount(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>);<br>    &#125;);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    element._newWidget = <span class="hljs-keyword">this</span>;<br>    element.markNeedsBuild();<br>  &#125;<br>  <span class="hljs-keyword">return</span> element!;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¼ å…¥äº†<code>BuildOwner</code>çš„å®ä¾‹<code>owner</code>å’Œæ ¹å…ƒç´ å¯¹è±¡.é¦–å…ˆæ‰§è¡Œäº†<code>owner.lockState</code>,è¿™ä¸ªæ–¹æ³•åªæ˜¯è¿›è¡Œäº†ä¸€äº›æ–­è¨€æ¥ä¿è¯æ‰§è¡Œ<code>callback</code>æœŸé—´çŠ¶æ€çš„é”å®š,è¿™é‡Œ<code>callback</code>å°±æ˜¯4~6è¡Œä»£ç ;<br>åœ¨è¿™ä¸ª<code>callback</code>ä¸­æ‰§è¡Œäº†<code>createElement()</code>,ç”¨äºåˆ›å»ºå…ƒç´ ,åˆ›å»ºå‡ºæ¥çš„å…ƒç´ ä¹Ÿå°±æ˜¯æ ‘çš„æ ¹èŠ‚ç‚¹;è¿™é‡Œæ³¨æ„ä¸€ä¸‹<code>createElement</code>æ˜¯<code>RenderObjectToWidgetAdapter</code>å®ä¾‹çš„æ–¹æ³•,çœ‹ä¸‹ä¸Šé¢çš„æ–¹æ³•ä¸­ä¼ å…¥çš„<code>this</code>ä¹Ÿå°±æ˜¯<code>RenderObjectToWidgetAdapter</code>å¯¹è±¡æœ¬èº«;é‚£ä¹ˆåœ¨åˆ›å»ºElementæ—¶ä¸ºå•¥è¦ä¼ å…¥Widgetå¯¹è±¡ï¼Ÿè·Ÿè¸ªåˆ°æœ€çˆ¶çº§çš„Elementå‘ç°æ˜¯ä¸ºäº†ç»™_widgetèµ‹å€¼.<em>ä¹Ÿå°±æ˜¯è¯´ElementæŒæœ‰äº†Widgetå¯¹è±¡,å¹¶ä¸”è¯¥å…ƒç´ ç”±è¯¥ç»„ä»¶åˆ›å»º</em></p><h2 id="æŒ‚è½½"><a href="#æŒ‚è½½" class="headerlink" title="æŒ‚è½½"></a>æŒ‚è½½</h2><p>æ¥ä¸‹æ¥æ˜¯<code>owner.buildScope</code>,è¿™é‡Œä¼ å…¥äº†æ ¹å…ƒç´ å’Œå›è°ƒå‡½æ•°,åŒæ ·çš„æ˜¯è¿›è¡Œäº†ä¸€äº›æ–­è¨€åå›è°ƒäº†<code>callback</code>,åœ¨<code>callback</code>ä¸­æ‰§è¡Œäº†å…ƒç´ çš„æŒ‚è½½,æ³¨æ„è¿™é‡Œä¼ å…¥çš„ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯<code>null</code>.</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@override</span><br><span class="hljs-keyword">void</span> mount(<span class="hljs-built_in">Element?</span> parent, <span class="hljs-built_in">Object?</span> newSlot) &#123;<br>  <span class="hljs-keyword">assert</span>(parent == <span class="hljs-keyword">null</span>);<br>  <span class="hljs-keyword">super</span>.mount(parent, newSlot);<br>  _rebuild();<br>  <span class="hljs-keyword">assert</span>(_child != <span class="hljs-keyword">null</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>mount</code>æ–¹æ³•æ˜¯<code>RenderObjectToWidgetElement</code>ç±»è¦†å†™çš„<code>Element</code>ä¸­å®šä¹‰çš„æ–¹æ³•,è¿™é‡Œæ‰§è¡Œäº†çˆ¶ç±»çš„<code>mount</code>æ–¹æ³•å’Œ<code>_rebuild</code>æ–¹æ³•;<br>å…ˆçœ‹mountçš„è°ƒç”¨è·¯å¾„<br><code>RootRenderObjectElement--&gt;RenderObjectElement--&gt;Element</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> mount(<span class="hljs-built_in">Element?</span> parent, <span class="hljs-built_in">Object?</span> newSlot) &#123;<br>  <span class="hljs-keyword">assert</span>(_lifecycleState == _ElementLifecycle.initial);<br>  <span class="hljs-keyword">assert</span>(widget != <span class="hljs-keyword">null</span>);<br>  <span class="hljs-keyword">assert</span>(_parent == <span class="hljs-keyword">null</span>);<br>  <span class="hljs-keyword">assert</span>(parent == <span class="hljs-keyword">null</span> || parent._lifecycleState == _ElementLifecycle.active);<br>  <span class="hljs-keyword">assert</span>(slot == <span class="hljs-keyword">null</span>);<br>  _parent = parent;<br>  _slot = newSlot;<br>  _lifecycleState = _ElementLifecycle.active;<br>  _depth = _parent != <span class="hljs-keyword">null</span> ? _parent!.depth + <span class="hljs-number">1</span> : <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span> (parent != <span class="hljs-keyword">null</span>) &#123;<br>    <span class="hljs-comment">// Only assign ownership if the parent is non-null. If parent is null</span><br>    <span class="hljs-comment">// (the root node), the owner should have already been assigned.</span><br>    <span class="hljs-comment">// See RootRenderObjectElement.assignOwner().</span><br>    _owner = parent.owner;<br>  &#125;<br>  <span class="hljs-keyword">assert</span>(owner != <span class="hljs-keyword">null</span>);<br>  <span class="hljs-keyword">final</span> Key? key = widget.key;<br>  <span class="hljs-keyword">if</span> (key <span class="hljs-keyword">is</span> GlobalKey) &#123;<br>    owner!._registerGlobalKey(key, <span class="hljs-keyword">this</span>);<br>  &#125;<br>  _updateInheritance();<br>  attachNotificationTree();<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œç»´æŠ¤äº†ä¸€äº›æˆå‘˜ä¿¡æ¯,å¹¶å°†æ ‘çš„æ·±åº¦_depthåŠ 1,åˆ°è¿™é‡Œä¹Ÿå°±ä»¥ä¸ºç€æ ¹å…ƒç´ èŠ‚ç‚¹æŒ‚è½½å®Œæˆ<br>å½“<code>Element#mount</code>æ‰§è¡Œå®Œæˆå,å›åˆ°<code>RenderObjectToWidgetElement#mount</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@override</span><br><span class="hljs-keyword">void</span> mount(<span class="hljs-built_in">Element?</span> parent, <span class="hljs-built_in">Object?</span> newSlot) &#123;<br>  <span class="hljs-keyword">super</span>.mount(parent, newSlot);<br>  <span class="hljs-keyword">assert</span>(() &#123;<br>    _debugDoingBuild = <span class="hljs-keyword">true</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>  &#125;());<br>  _renderObject = (widget <span class="hljs-keyword">as</span> RenderObjectWidget).createRenderObject(<span class="hljs-keyword">this</span>);<br>  <span class="hljs-keyword">assert</span>(!_renderObject!.debugDisposed!);<br>  <span class="hljs-keyword">assert</span>(() &#123;<br>    _debugDoingBuild = <span class="hljs-keyword">false</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>  &#125;());<br>  <span class="hljs-keyword">assert</span>(() &#123;<br>    _debugUpdateRenderObjectOwner();<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>  &#125;());<br>  <span class="hljs-keyword">assert</span>(_slot == newSlot);<br>  attachRenderObject(newSlot);<br>  _dirty = <span class="hljs-keyword">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œé¢æ‰§è¡Œäº†<code>widget</code>çš„<code>createRenderObject(this)</code>æ–¹æ³•æ¥åˆ›å»º<code>_renderObject</code>;æ³¨æ„ä¸€ä¸‹,è¿™é‡Œçš„<code>widget</code>å…¶å®å°±æ˜¯æ ¹ç»„ä»¶.ä¹Ÿå°±æ˜¯<code>RenderObjectToWidgetAdapter</code>çš„å®ä¾‹å¯¹è±¡,è°ƒç”¨å…¶<code>createRenderObject</code>æ–¹æ³•è¿”å›çš„æ˜¯å…¶å®ä¾‹ä¸­çš„<code>container</code>å¯¹è±¡,ä¹Ÿå°±æ˜¯è¯´<code>Element</code>ä¸­çš„<code>_renderObject</code>æ˜¯åœ¨<code>mount</code>æ–¹æ³•ä¸­é€šè¿‡<code>widget.createRenderObject</code>æ–¹æ³•åˆ›å»ºçš„</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@override</span><br>RenderObjectWithChildMixin&lt;T&gt; createRenderObject(BuildContext context) =&gt; container;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>container</code>å¯¹è±¡ä¹Ÿå°±æ˜¯å‰é¢æåˆ°çš„<code>attachRootWidget</code>ä¸­ä¼ å…¥çš„<code>renderView</code>å¯¹è±¡.<br>å¯¹äºæ ¹èŠ‚ç‚¹çš„ä¸‰æ£µæ ‘æ¥è®²,å·²ç»å®Œæˆäº†åˆ›å»ºè¿‡ç¨‹,å•ç€å¹¶ä¸ä»£è¡¨æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æ˜¯è¿™ä¸­æƒ…å†µ.ä¸€èˆ¬æƒ…å†µä¸‹,ç»„ä»¶ä¸ä¼šæŒæœ‰æ¸²æŸ“å¯¹è±¡,åªä¸è¿‡æ ¹ç»„ä»¶æ¯”è¾ƒç‰¹æ®Š,éœ€è¦æœ‰ä¸€ä¸ªå¼€å§‹æ¸²æŸ“çš„èŠ‚ç‚¹,<code>createRenderObject</code>æ–¹æ³•è¿”å›çš„RenderViewä¹Ÿæœ‰ç‰¹æ®Šæ€§</p><p>æ€»ç»“ä¸€ä¸‹</p><ul><li><code>RenderObjectToWidgetAdapter</code>é€šè¿‡æ„é€ æ–¹æ³•æŒæœ‰<code>RenderView</code>å¯¹è±¡</li><li><code>RenderObjectToWidgetAdapter</code>é€šè¿‡<code>createElement</code>æ–¹æ³•åˆ›å»º<code>RenderObjectToWidgetElement</code>å¯¹è±¡</li><li><code>RenderObjectToWidgetElement</code>é€šè¿‡<code>mount</code>æ–¹æ³•æŒæœ‰<code>RenderView</code></li><li><code>RenderObjectToWidgetElement</code>é€šè¿‡æ„é€ æ–¹æ³•(Element)æŒæœ‰<code>RenderObjectToWidgetAdapter</code></li></ul><h3 id="æ ¹æ¸²æŸ“å¯¹è±¡çš„å…³è”"><a href="#æ ¹æ¸²æŸ“å¯¹è±¡çš„å…³è”" class="headerlink" title="æ ¹æ¸²æŸ“å¯¹è±¡çš„å…³è”"></a>æ ¹æ¸²æŸ“å¯¹è±¡çš„å…³è”</h3><p>æŒ‚è½½å®Œäº†æˆ‘ä»¬æ¥ç€çœ‹<code>RenderObjectElement#mount</code>æ–¹æ³•ä¸­è°ƒç”¨çš„<code>attachRenderObject(newSlot)</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@override</span><br><span class="hljs-keyword">void</span> attachRenderObject(<span class="hljs-built_in">Object?</span> newSlot) &#123;<br>  <span class="hljs-keyword">assert</span>(_ancestorRenderObjectElement == <span class="hljs-keyword">null</span>);<br>  _slot = newSlot;<br>  _ancestorRenderObjectElement = _findAncestorRenderObjectElement();<br>  _ancestorRenderObjectElement?.insertRenderObjectChild(renderObject, newSlot);<br>  <span class="hljs-keyword">final</span> ParentDataElement&lt;ParentData&gt;? parentDataElement = _findAncestorParentDataElement();<br>  <span class="hljs-keyword">if</span> (parentDataElement != <span class="hljs-keyword">null</span>)<br>    _updateParentData(parentDataElement.widget <span class="hljs-keyword">as</span> ParentDataWidget&lt;ParentData&gt;);<br>&#125;<br></code></pre></td></tr></table></figure><p>å…ˆè°ƒç”¨<code>_findAncestorRenderObjectElementä»</code>å…ƒç´ æ ‘ä¸­å‘ä¸ŠæŸ¥æ‰¾ç¬¬ä¸€ä¸ª<code>RenderObjectElement</code>ç±»å‹çš„å…ƒç´ èŠ‚ç‚¹ä½œä¸ºå…ˆç¥–èŠ‚ç‚¹,ç„¶åè°ƒç”¨å…¶<code>insertRenderObjectChild</code>æ–¹æ³•å°†è‡ªèº«æŒæœ‰çš„<code>renderObject</code>æ’å…¥çš„æ¸²æŸ“æ ‘ä¸­;<br>ç„¶åè°ƒç”¨<code>_findAncestorParentDataElement</code>æ–¹æ³•ä»å…ƒç´ æ ‘ä¸­å‘ä¸ŠæŸ¥æ‰¾ç¬¬ä¸€ä¸ª<code>ParentDataElement&lt;ParentData&gt;</code>ç±»å‹çš„èŠ‚ç‚¹,å¦‚æœéç©º,åˆ™æ‰§è¡Œ<code>_updateParentData</code>æ–¹æ³•;ç”±äºå½“å‰æ˜¯æ ¹èŠ‚ç‚¹,è¿™ä¸¤ä¸ªæŸ¥æ‰¾çš„æ–¹æ³•è¿”å›çš„éƒ½æ˜¯ç©º</p><h3 id="èŠ‚ç‚¹æŒ‚è½½"><a href="#èŠ‚ç‚¹æŒ‚è½½" class="headerlink" title="èŠ‚ç‚¹æŒ‚è½½"></a>èŠ‚ç‚¹æŒ‚è½½</h3><p>å½“çˆ¶ç±»çš„mountæ–¹æ³•æ‰§è¡Œå®Œæ¯•å,å›è¿‡å¤´æ¥çœ‹<code>RenderObjectToWidgetElement#mount</code>æ–¹æ³•ä¸­è°ƒç”¨çš„<code>_rebuild()</code>æ–¹æ³•.</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> _rebuild() &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    _child = updateChild(_child, (widget <span class="hljs-keyword">as</span> RenderObjectToWidgetAdapter&lt;T&gt;).child, _rootChildSlot);<br>  &#125; <span class="hljs-keyword">catch</span> (exception, stack) &#123;<br>    <span class="hljs-keyword">final</span> FlutterErrorDetails details = FlutterErrorDetails(<br>      exception: exception,<br>      stack: stack,<br>      <span class="hljs-keyword">library</span>: <span class="hljs-string">&#x27;widgets library&#x27;</span>,<br>      context: ErrorDescription(<span class="hljs-string">&#x27;attaching to the render tree&#x27;</span>),<br>    );<br>    FlutterError.reportError(details);<br>    <span class="hljs-keyword">final</span> Widget error = ErrorWidget.builder(details);<br>    _child = updateChild(<span class="hljs-keyword">null</span>, error, _rootChildSlot);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨äº†<code>updateChild</code>æ–¹æ³•,è¿™é‡Œé¢æœ‰ä¸‰ä¸ªå‚æ•°.ç¬¬ä¸€ä¸ªå‚æ•°<code>_child</code>ç°åœ¨ä¸º<code>null</code>,æœ€åä¸€ä¸ª<code>_rootChildSlot</code>æ˜¯ä¸€ä¸ª<code>object</code>,æ³¨æ„ä¸€ä¸‹ç¬¬äºŒä¸ªå‚æ•°<code>widget.child</code>:è¿™é‡Œçš„widgetæ˜¯rootä¹Ÿå°±æ˜¯<code>RenderObjectToWidgetAdapter</code>å¯¹è±¡çš„å®ä¾‹,å®ƒçš„<code>child</code>ä¹Ÿå°±æ˜¯æ˜¯æˆ‘ä»¬åœ¨<code>runApp</code>ä¸­ä¼ å…¥çš„<code>widget</code>å¯¹è±¡,ä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨å‰é¢<code>attachRootWidget</code>æ–¹æ³•ä¸­åˆ›å»º<code>RenderObjectToWidgetAdapter</code>æ—¶ä¼ å…¥çš„<code>child</code>å‚æ•°.</p><p>æ¥ç€çœ‹updateChildæ–¹æ³•,æˆ‘ä»¬åœ¨æ³¨é‡Šä¸­æ‰¾åˆ°äº†è¡Œä¸ºè¯´æ˜</p><table><thead><tr><th></th><th>newWidget &#x3D;&#x3D; null</th><th>newWidget !&#x3D; null</th></tr></thead><tbody><tr><td>child &#x3D;&#x3D; null</td><td>Returns null</td><td>Returns new [Element]</td></tr><tr><td>child !&#x3D; null</td><td>Old child is removed, returns null</td><td>Old child updated if possible, returns child or new [Element]</td></tr></tbody></table><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-built_in">Element?</span> updateChild(<span class="hljs-built_in">Element?</span> child, Widget? newWidget, <span class="hljs-built_in">Object?</span> newSlot) &#123;<br>  <span class="hljs-keyword">if</span> (newWidget == <span class="hljs-keyword">null</span>) &#123;...&#125;<br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Element</span> newChild;<br>  <span class="hljs-keyword">if</span> (child != <span class="hljs-keyword">null</span>) &#123;...&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">// The [debugProfileBuildsEnabled] code for this branch is inside</span><br>    <span class="hljs-comment">// [inflateWidget], since some [Element]s call [inflateWidget] directly</span><br>    <span class="hljs-comment">// instead of going through [updateChild].</span><br>    newChild = inflateWidget(newWidget, newSlot);<br>  &#125;<br>  <span class="hljs-keyword">assert</span>(...);<br>  <span class="hljs-keyword">return</span> newChild;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ºäº†èŠ‚çœç¯‡å¹…,è¿™é‡Œåˆ é™¤äº†æ²¡æœ‰æ‰§è¡Œçš„ä»£ç ;å› ä¸ºè¿™é‡Œçš„childä¸ºç©º,æ‰€ä»¥ä¼šèµ°inflateWidget(newWidget, newSlot)æ–¹æ³•</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-built_in">Element</span> inflateWidget(Widget newWidget, <span class="hljs-built_in">Object?</span> newSlot) &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">final</span> Key? key = newWidget.key;<br>    <span class="hljs-keyword">if</span> (key <span class="hljs-keyword">is</span> GlobalKey) &#123;<br>      <span class="hljs-keyword">final</span> <span class="hljs-built_in">Element?</span> newChild = _retakeInactiveElement(key, newWidget);<br>      <span class="hljs-keyword">if</span> (newChild != <span class="hljs-keyword">null</span>) &#123;<br>        newChild._activateWithParent(<span class="hljs-keyword">this</span>, newSlot);<br>        <span class="hljs-keyword">final</span> <span class="hljs-built_in">Element?</span> updatedChild = updateChild(newChild, newWidget, newSlot);<br>        <span class="hljs-keyword">return</span> updatedChild!;<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">Element</span> newChild = newWidget.createElement();<br>    newChild.mount(<span class="hljs-keyword">this</span>, newSlot);<br>    <span class="hljs-keyword">return</span> newChild;<br>  &#125; <span class="hljs-keyword">finally</span> &#123;<br>    <span class="hljs-keyword">if</span> (isTimelineTracked)<br>      Timeline.finishSync();<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæ£€æŸ¥äº†ç»„ä»¶æ˜¯å¦æœ‰keyå¹¶ä¸”keyæ˜¯ä¸æ˜¯GlobalKey.è¿™é‡Œå…ˆæ”¾ä¸€ä¸‹<br>åé¢è°ƒç”¨<code>newWidget.createElement()</code>åˆ›å»ºäº†<code>element</code>,å¹¶ä¸”è°ƒç”¨å…¶<code>mount</code>è¿›è¡ŒæŒ‚è½½.<br>ç„¶åå°±å¼€å§‹äº†æ ‘çš„éå†è¿›è¡ŒæŒ‚è½½,æ ¹æ®æˆ‘ä»¬åœ¨<code>runApp</code>ä¸­ä¼ å…¥çš„ç»„ä»¶ä¸åŒ,è°ƒç”¨ä¸åŒå¯¹è±¡çš„æ–¹æ³•,</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å…¥å£&quot;&gt;&lt;a href=&quot;#å…¥å£&quot; class=&quot;headerlink&quot; title=&quot;å…¥å£&quot;&gt;&lt;/a&gt;å…¥å£&lt;/h2&gt;&lt;p&gt;flutteråº”ç”¨çš„å…¥å£ç‚¹åœ¨mainæ–¹æ³•ä¸­è°ƒç”¨çš„&lt;code&gt;runApp(Widget app)&lt;/code&gt;æ–¹æ³•ä¸­&lt;/p&gt;
&lt;figure</summary>
      
    
    
    
    
    <category term="Flutter" scheme="https://blog.huangyuanlove.com/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>å†™åœ¨2023å¹´åˆ--2022æ€»ç»“</title>
    <link href="https://blog.huangyuanlove.com/2023/01/07/%E5%86%99%E5%9C%A82023%E5%B9%B4%E5%88%9D-2022%E6%80%BB%E7%BB%93/"/>
    <id>https://blog.huangyuanlove.com/2023/01/07/%E5%86%99%E5%9C%A82023%E5%B9%B4%E5%88%9D-2022%E6%80%BB%E7%BB%93/</id>
    <published>2023-01-07T15:22:57.000Z</published>
    <updated>2023-05-19T12:51:02.240Z</updated>
    
    <content type="html"><![CDATA[<p>2022å¹´ï¼Œæ–°å† ä¸‰å¹´ï¼Œæ–°å† è¯Šç–—æ–¹æ¡ˆç¬¬åç‰ˆå°†å…¶æ›´åä¸ºæ–°å‹å† çŠ¶ç—…æ¯’æ„ŸæŸ“ï¼›<br>è¿™ä¸€å¹´ä¸­æ–­äº†æ¯æœˆå­¦ä¹ è®¡åˆ’ï¼Œåšå®¢ä¹Ÿåœæ›´äº†ä¸€å¹´ï¼Œä¹Ÿä¸æ˜¯å¿™ï¼Œåªæ˜¯æ‡’æ•£ï¼Œæ¯•ç«Ÿå†å¿™ä¹Ÿä¸ä¼šå¿™åˆ°å†™ç‚¹ä¸œè¥¿çš„æ—¶é—´éƒ½æŒ¤ä¸å‡ºæ¥çš„åœ°æ­¥ã€‚å·¥ä½œä¸­ä¹Ÿåªæ˜¯åŠ å¼ºäº†ä¹‹å‰å­¦è¿‡çš„ä¸œè¥¿ï¼Œç†Ÿç»ƒåº¦æé«˜äº†è€Œå·²ã€‚<br>ç¿»éäº†è¿‡å»ä¸€å¹´ï¼Œä¹Ÿåªæ˜¯åˆ·äº†å‡ é“é¢˜ï¼Œå­¦å®Œäº†æå®¢æ—¶é—´å‡ ä¸ªè¯¾ç¨‹è€Œå·²ã€‚æ–°çš„ä¸€å¹´æœ‰æ–°çš„è®¡åˆ’ã€‚ä¸ä»…è¦æé«˜è‡ªå·±çš„æŠ€æœ¯ç¡¬å®åŠ›ï¼Œä¹Ÿéœ€è¦æé«˜è½¯æŠ€èƒ½ã€‚</p><h4 id="2023"><a href="#2023" class="headerlink" title="2023"></a>2023</h4><p>è¿˜æ˜¯å›´ç»•å¤§å‰ç«¯è¿›è¡Œ</p><ol><li>flutter<ol><li>æ˜é‡‘å°å†Œ</li><li>Bç«™è§†é¢‘ ç‹å”ä¸ç§ƒ <a href="https://space.bilibili.com/589533168">https://space.bilibili.com/589533168</a>?</li></ol></li><li>å‰ç«¯<ol><li>æå®¢æ—¶é—´è¯¾ç¨‹</li></ol></li><li>iOS</li><li>è½¯æŠ€èƒ½<ol><li>æå®¢æ—¶é—´è¯¾ç¨‹</li></ol></li></ol><p>å…±è®¡60ä¸ªè¯¾ç¨‹ï¼Œä¹è§‚ä¼°è®¡ä¹Ÿå°±åªèƒ½å®Œæˆ10ä¸ªï¼Œæ‚²è§‚å…ˆä¹Ÿå°±å››äº”ä¸ªçš„æ ·å­</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br></pre></td><td class="code"><pre><code class="hljs json"><br><span class="hljs-punctuation">[</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æœ±èµŸçš„æŠ€æœ¯ç®¡ç†è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»æŠ€æœ¯åˆ°ç®¡ç†ï¼Œè®©ä½ çš„ç›®æ ‡å‡½æ•°è¾¾åˆ°æœ€ä¼˜è§£&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æŠ€æœ¯é¢†å¯¼åŠ›å®æˆ˜ç¬”è®°&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;é€šå¾€ä¼˜ç§€æŠ€æœ¯é¢†å¯¼è€…ä¹‹è·¯&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç¡…è°·äº§å“å®æˆ˜36è®²&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç”¨å®ä¾‹æ­ç¤ºå¦‚ä½•æ‰“é€ ä¸–ç•Œçº§äº§å“&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»0å¼€å§‹å­¦æ¶æ„&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å‰é˜¿é‡ŒP9æŠ€æœ¯ä¸“å®¶çš„å®æˆ˜æ¶æ„å¿ƒæ³•&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Javaæ ¸å¿ƒæŠ€æœ¯é¢è¯•ç²¾è®²&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å‰Oracleé¦–å¸­å·¥ç¨‹å¸ˆå¸¦ä½ ä¿®ç‚¼Javaå†…åŠŸ&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è¶£è°ˆç½‘ç»œåè®®&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;åƒå°è¯´ä¸€æ ·çš„ç½‘ç»œåè®®å…¥é—¨è¯¾&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è½¯ä»¶æµ‹è¯•52è®²&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»å°å·¥åˆ°ä¸“å®¶çš„å®æˆ˜å¿ƒæ³•&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ·±å…¥æ‹†è§£Javaè™šæ‹Ÿæœº&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Oracle é«˜çº§ç ”ç©¶å‘˜æ‰‹æŠŠæ‰‹å¸¦ä½ å…¥é—¨JVM&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç¨‹åºå‘˜è¿›é˜¶æ”»ç•¥&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ¯ä¸ªç¨‹åºå‘˜éƒ½åº”è¯¥çŸ¥é“çš„æˆé•¿æ³•åˆ™&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æŠ€æœ¯ç®¡ç†å®æˆ˜36è®²&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å‰ç™¾åº¦æœ€ä½³ç»ç†äººçš„æˆ˜åœ°ç¬”è®°&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»£ç ç²¾è¿›ä¹‹è·¯&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä½ å†™çš„æ¯ä¸€è¡Œä»£ç éƒ½æ˜¯ä½ çš„åç‰‡&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç®—æ³•é¢è¯•é€šå…³40è®²&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å‰Facebookå·¥ç¨‹å¸ˆå¸¦ä½ åƒé€å¤§å‚é¢è¯•é¢˜&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br> <br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç©è½¬Gitä¸‰å‰‘å®¢&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¸¦ä½ æ·±å…¥æŒæ¡Gitã€GitHubå’ŒGitLab&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;10xç¨‹åºå‘˜å·¥ä½œæ³•&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æŒæ¡ä¸»åŠ¨æƒï¼Œå¿™åˆ°ç‚¹å­ä¸Š&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;é‡å­¦å‰ç«¯&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ¯å¤©10åˆ†é’Ÿï¼Œé‡æ„ä½ çš„å‰ç«¯çŸ¥è¯†ä½“ç³»&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç©è½¬Springå…¨å®¶æ¡¶&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä¸€ç«™é€šå…³Springã€Spring Bootä¸Spring Cloud&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è½¯ä»¶å·¥ç¨‹ä¹‹ç¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;é‡æ–°ç†è§£è½¯ä»¶å·¥ç¨‹&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å…¨é¢ç³»ç»Ÿæå‡ä½ çš„å¹¶å‘ç¼–ç¨‹èƒ½åŠ›&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br> <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;iOSå¼€å‘é«˜æ‰‹è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»åŸç†åˆ°å®æˆ˜ï¼Œå¸¦ä½ è§£å†³80%çš„å¼€å‘éš¾é¢˜&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»0å¼€å§‹åšå¢é•¿&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»0åˆ°1çš„å¢é•¿å®æˆ˜æ–¹æ³•è®º&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;é€è§†HTTPåè®®&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ·±å…¥ç†è§£HTTPåè®®æœ¬è´¨ä¸åº”ç”¨&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç©è½¬webpack&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å…¨æ–¹ä½æŒæ¡webpackæ ¸å¿ƒæŠ€èƒ½å’Œä¼˜åŒ–ç­–ç•¥&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;TypeScriptå¼€å‘å®æˆ˜&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç³»ç»ŸæŒæ¡TypeScriptæ ¸å¿ƒæŠ€æœ¯&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç½‘ç»œç¼–ç¨‹å®æˆ˜&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»åº•å±‚åˆ°å®æˆ˜ï¼Œæ·±åº¦è§£æç½‘ç»œç¼–ç¨‹&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æµè§ˆå™¨å·¥ä½œåŸç†ä¸å®è·µ&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;é€è¿‡æµè§ˆå™¨çœ‹æ‡‚å‰ç«¯æœ¬è´¨&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br> <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å…¨æ ˆå·¥ç¨‹å¸ˆä¿®ç‚¼æŒ‡å—&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»å…¨æ ˆå…¥é—¨åˆ°æŠ€èƒ½å®æˆ˜&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Node.jså¼€å‘å®æˆ˜&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¸¦ä½ å¼€å‘ä¸€ä¸ªå®Œæ•´çš„Node.jsé¡¹ç›®&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è¯´é€ä¸­å°&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»æ¦‚å¿µåˆ°è½åœ°ä¸€ç«™é€šå…³&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è‹æ°çš„äº§å“åˆ›æ–°è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä¸€æ¬¡ä»æƒ³æ³•åˆ°äº§å“çš„ä½æˆæœ¬å®éªŒ&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç§»åŠ¨ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•å®æˆ˜&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä¸€æ­¥ä¸€æ­¥å¸¦ä½ æˆä¸ºæµ‹è¯•é«˜æ‰‹&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;é›·è““è““çš„é¡¹ç›®ç®¡ç†å®æˆ˜è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä½¿ä¼—äººè¡Œï¼Œå¦‚ä½•å¸¦é¢†ä¸€ç¾¤äººæˆäº‹&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ€§èƒ½å·¥ç¨‹é«˜æ‰‹è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¾—æ€§èƒ½è€…å¾—å¤©ä¸‹&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ€§èƒ½æµ‹è¯•å®æˆ˜30è®²&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å‘Šåˆ«é‡è·¯å­ï¼Œæˆä¸ºçœŸæ­£çš„æ€§èƒ½æµ‹è¯•é«˜æ‰‹&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è¯´é€æ•æ·&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»åŸç†åˆ°å®æˆ˜å¸¦ä½ è½åœ°æ•æ·&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ¥å£æµ‹è¯•å…¥é—¨è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»åŸç†åˆ°å®æˆ˜ï¼Œå¸¦ä½ è¿›é˜¶æ¥å£æµ‹è¯•&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Javaä¸šåŠ¡å¼€å‘å¸¸è§é”™è¯¯100ä¾‹&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å…¨é¢é¿å‘ + æœ€ä½³å®è·µ=å¥å£®ä»£ç &quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å›¾è§£ Google V8&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä¸€é—¨è¯¾ææ‡‚ JavaScript æ‰§è¡Œé€»è¾‘&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;SREå®æˆ˜æ‰‹å†Œ&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»0åˆ°1å¸¦ä½ æå®šç³»ç»Ÿç¨³å®šæ€§&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;äº’è”ç½‘äººçš„è‹±è¯­ç§æ•™è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è®©ä½ å¿«é€Ÿæå‡è‹±è¯­é˜…è¯»èƒ½åŠ›&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¾®ä¿¡å°ç¨‹åºå…¨æ ˆå¼€å‘å®æˆ˜&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ‰‹æŠŠæ‰‹å¸¦ä½ å®ç°ä¸€æ¬¾ç”µå•†å°ç¨‹åº&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è½¯ä»¶è®¾è®¡ä¹‹ç¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¤šä¸€ç‚¹è®¾è®¡ï¼Œå°‘ä¸€ç‚¹é—®é¢˜&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æŠ€æœ¯ç®¡ç†æ¡ˆä¾‹è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è¸©å‘å¤ç›˜+æ¡ˆä¾‹åˆ†æ+ç²¾è¿›æ”»ç•¥=é«˜æ•ˆç®¡ç†&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç”¨æˆ·ä½“éªŒè®¾è®¡å®æˆ˜è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;äººäººå¯ç”¨çš„ä½“éªŒåˆ›æ–°æ€ç»´&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;WebAssemblyå…¥é—¨è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»0åˆ°1å®ç°ä¸€ä¸ªWebAssemblyå¤šåª’ä½“åº”ç”¨&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;åŠ¨æ€è§„åˆ’é¢è¯•å®å…¸&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å­¦å¥½åŠ¨æ€è§„åˆ’ï¼Œé¢è¯•æ™‹å‡éƒ½ä¸æ€•&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä¹”æ–°äº®çš„CTOæˆé•¿å¤ç›˜&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;åƒä¸‡å¹´è–ªCTOæ˜¯å¦‚ä½•ç‚¼æˆçš„&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;A/Bæµ‹è¯•ä»0åˆ°1&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»åŸç†åˆ°å®æˆ˜ï¼Œåƒé€A/Bæµ‹è¯•&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»£ç ä¹‹ä¸‘&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è¯†åˆ«åå‘³é“ï¼Œé‡æ„é—®é¢˜ä»£ç &quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä½“éªŒè®¾è®¡æ¡ˆä¾‹è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç”¨é‡åŒ–æ–¹å¼ï¼Œé‡æ–°å®šä¹‰ä½“éªŒè®¾è®¡&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æŠ€æœ¯é¢è¯•å®˜è¯†äººæ‰‹å†Œ&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è¾¨è¯†ç²¾è‹±ï¼Œæ‰“é€ é«˜æ•ˆèƒ½å›¢é˜Ÿ&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ€§èƒ½ä¼˜åŒ–é«˜æ‰‹è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä¸€ç«™é€šå…³ä»è®¾è®¡åˆ°äº¤ä»˜çš„æ€§èƒ½é—®é¢˜&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¦‚ä½•è½åœ°ä¸šåŠ¡å»ºæ¨¡&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Thoughtworks CTOå¸¦ä½ é‡æ„å»ºæ¨¡æŠ€èƒ½&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç¨‹åºå‘˜çš„æµ‹è¯•è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æŒæ¡æµ‹è¯•ï¼Œå†™å¥½é«˜è´¨é‡ä»£ç &quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç©è½¬Vue 3å…¨å®¶æ¡¶&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;åŸºç¡€+å®æˆ˜+æºç ï¼Œå…¨æ–¹ä½å­¦é€Vue 3&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ·±å…¥å‰–æJavaæ–°ç‰¹æ€§&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ‰‹æŠŠæ‰‹å¸¦ä½ åƒé€Javaæ–°ç‰¹æ€§&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ”»å…‹è§†é¢‘æŠ€æœ¯&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;é«˜æ‰‹å¸¦è·¯ï¼Œè½»æ¾å­¦ä¹ è§†é¢‘åŸç†&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æå®šéŸ³é¢‘æŠ€æœ¯&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ·±å…¥æµ…å‡ºéŸ³é¢‘æ ¸å¿ƒåŸç†åŠåº”ç”¨&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è‡ªåŠ¨åŒ–æµ‹è¯•é«˜æ‰‹è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ–°æ¨¡å‹+å…¨æ ˆè§†è§’\u003dé«˜æ•ˆè¿›é˜¶&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;é—ç•™ç³»ç»Ÿç°ä»£åŒ–å®æˆ˜&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¸®ä½ èµ°å‡ºé—ç•™ç³»ç»Ÿçš„æ³¥æ½­&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <br>  <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¤§å‚è®¾è®¡è¿›é˜¶å®æˆ˜è¯¾&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;subtitle&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è®©ä½ çªç ´ç“¶é¢ˆçš„é«˜è–ªè®¾è®¡è¯¾&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;2022å¹´ï¼Œæ–°å† ä¸‰å¹´ï¼Œæ–°å† è¯Šç–—æ–¹æ¡ˆç¬¬åç‰ˆå°†å…¶æ›´åä¸ºæ–°å‹å† çŠ¶ç—…æ¯’æ„ŸæŸ“ï¼›&lt;br&gt;è¿™ä¸€å¹´ä¸­æ–­äº†æ¯æœˆå­¦ä¹ è®¡åˆ’ï¼Œåšå®¢ä¹Ÿåœæ›´äº†ä¸€å¹´ï¼Œä¹Ÿä¸æ˜¯å¿™ï¼Œåªæ˜¯æ‡’æ•£ï¼Œæ¯•ç«Ÿå†å¿™ä¹Ÿä¸ä¼šå¿™åˆ°å†™ç‚¹ä¸œè¥¿çš„æ—¶é—´éƒ½æŒ¤ä¸å‡ºæ¥çš„åœ°æ­¥ã€‚å·¥ä½œä¸­ä¹Ÿåªæ˜¯åŠ å¼ºäº†ä¹‹å‰å­¦è¿‡çš„ä¸œè¥¿ï¼Œç†Ÿç»ƒåº¦æé«˜äº†è€Œå·²ã€‚&lt;br&gt;ç¿»éäº†è¿‡å»ä¸€å¹´ï¼Œä¹Ÿåªæ˜¯åˆ·</summary>
      
    
    
    
    
    <category term="ä¹±ä¸ƒå…«ç³Ÿ" scheme="https://blog.huangyuanlove.com/tags/%E4%B9%B1%E4%B8%83%E5%85%AB%E7%B3%9F/"/>
    
  </entry>
  
  <entry>
    <title>riverpod1.0+ç®€ä»‹</title>
    <link href="https://blog.huangyuanlove.com/2022/01/04/riverpod1-0-%E7%AE%80%E4%BB%8B/"/>
    <id>https://blog.huangyuanlove.com/2022/01/04/riverpod1-0-%E7%AE%80%E4%BB%8B/</id>
    <published>2022-01-04T15:47:43.000Z</published>
    <updated>2024-04-01T02:23:12.589Z</updated>
    
    <content type="html"><![CDATA[<p>Flutteræ›´æ–°åˆ°2.8äº†ï¼Œæœ€è¿‘æ‰“ç®—é‡æ‹¾ä¸€ä¸‹flutterï¼Œå†™ç‚¹ä¸œè¥¿ç»ƒç»ƒæ‰‹ã€‚å¤§å®¶éƒ½æ¸…æ¥šåœ¨flutterä¸­çŠ¶æ€ç®¡ç†ç¡®å®æŒºéº»çƒ¦çš„ï¼Œä»ä¸€å¼€å§‹çš„BLoCåˆ°provideã€Providerï¼Œè¿˜æœ‰getXã€Riverpodç­‰ç­‰å„å¼å„æ ·çš„çŠ¶æ€ç®¡ç†åº“ï¼Œæˆ‘ä¸ªäººå€¾å‘äºä½¿ç”¨riverpodï¼Œå®ƒæ›´åƒä¸€ä¸ªçŠ¶æ€ç®¡ç†åº“ï¼›è€ŒgetXæ›´åƒä¸€ä¸ªå¼€å‘çš„æ¡†æ¶ï¼Œå®åœ¨æ˜¯å¤ªå¤§äº†:å½“ä½ ä½¿ç”¨getXçš„æ—¶å€™ï¼Œä½ æ˜¯åœ¨ç”¨getXè€Œä¸æ˜¯flutterå†™åº”ç”¨ã€‚</p><span id="more"></span><h2 id="å¼•å…¥riverpod"><a href="#å¼•å…¥riverpod" class="headerlink" title="å¼•å…¥riverpod"></a>å¼•å…¥riverpod</h2><p>demoä¸­æ²¡æœ‰åŒ…å«flutter_hook,æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©å¼•å…¥flutter_riverpodå³å¯</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">environment:</span><br>  <span class="hljs-attr">sdk:</span> <span class="hljs-string">&quot;&gt;=2.15.1 &lt;3.0.0&quot;</span><br>  <span class="hljs-attr">flutter:</span> <span class="hljs-string">&quot;&gt;=2.0.0&quot;</span><br><br><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-attr">flutter:</span><br>    <span class="hljs-attr">sdk:</span> <span class="hljs-string">flutter</span><br>  <span class="hljs-attr">flutter_riverpod:</span> <span class="hljs-string">^1.0.3</span><br></code></pre></td></tr></table></figure><h2 id="hello-world"><a href="#hello-world" class="headerlink" title="hello world"></a>hello world</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>ProviderScope</code>æ¥åŒ…è£¹æ•´ä¸ªåº”ç”¨ï¼Œä¹Ÿå°±æ˜¯åœ¨mainæ–¹æ³•ä¸­</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(ProviderScope(child: Home()));<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å¯ä»¥å£°æ˜ä¸€ä¸ªProviderã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šæŠŠå„ç§å„æ ·çš„providerä½œä¸ºå…¨å±€å˜é‡æ¥å¼•ç”¨ï¼Œå£°æ˜ä¸€ä¸ªproviderå’Œå£°æ˜ä¸€ä¸ªå‡½æ•°æ²¡æœ‰å¤šå¤§çš„åŒºåˆ«ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> helloWorldProvider = Provider((_) =&gt; <span class="hljs-string">&#x27;Hello world&#x27;</span>);<br></code></pre></td></tr></table></figure><p>æœ€åæˆ‘ä»¬å°±å¯ä»¥è¯»å–Providerä¸­çš„æ•°æ®äº†ã€‚<br>åœ¨1.0.0ä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼ŒConsumerWidgetçš„buildæ–¹æ³•ä¸­æä¾›äº†<code>WidgetRef</code>å¯¹è±¡ï¼Œç”¨æ¥å–ä»£0.14ç‰ˆæœ¬ä¸­çš„<code>useProvider</code></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter_riverpod/flutter_riverpod.dart&#x27;</span>;<br><br><span class="hljs-keyword">final</span> helloWorldProvider  = Provider((_)=&gt;<span class="hljs-string">&quot;hello world&quot;</span>);<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(<span class="hljs-keyword">const</span> ProviderScope(child: Home()));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Home</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span></span>&#123;<br>  <span class="hljs-keyword">const</span> Home(&#123;Key? key&#125;) : <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br><br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> value = ref.watch(helloWorldProvider);<br><br>    <span class="hljs-keyword">return</span> MaterialApp(<br>      home: Scaffold(<br>        appBar: AppBar(title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&quot;riverpod demo&quot;</span>),),<br>        body: Center(<br>          child: Text(value),<br>        ),<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Provider"><a href="#Provider" class="headerlink" title="Provider"></a>Provider</h2><h3 id="å„ç§å„æ ·çš„Provider"><a href="#å„ç§å„æ ·çš„Provider" class="headerlink" title="å„ç§å„æ ·çš„Provider"></a>å„ç§å„æ ·çš„Provider</h3><p>å…·ä½“å¯ä»¥çœ‹è¿™é‡Œï¼Œ<a href="https://pub.dev/documentation/flutter_riverpod/latest/flutter_riverpod/flutter_riverpod-library.html">https://pub.dev/documentation/flutter_riverpod/latest/flutter_riverpod/flutter_riverpod-library.html</a></p><p>ä¸‹é¢åˆ—ä¸¾äº†ä¸€äº›å¸¸ç”¨çš„Providerç±»å‹</p><ul><li><p>Provider</p><p><a href="https://pub.dev/documentation/riverpod/latest/riverpod/Provider-class.html">https://pub.dev/documentation/riverpod/latest/riverpod/Provider-class.html</a></p></li><li><p>StateProvider</p></li></ul><p><a href="https://pub.dev/documentation/riverpod/latest/riverpod/StateProvider-class.html">https://pub.dev/documentation/riverpod/latest/riverpod/StateProvider-class.html</a></p><ul><li><p>StateNotifierProvider<br><a href="https://pub.dev/documentation/riverpod/latest/riverpod/StateNotifierProvider-class.html">https://pub.dev/documentation/riverpod/latest/riverpod/StateNotifierProvider-class.html</a></p></li><li><p>FutureProvider<br><a href="https://pub.dev/documentation/riverpod/latest/riverpod/FutureProvider-class.html">https://pub.dev/documentation/riverpod/latest/riverpod/FutureProvider-class.html</a></p></li><li><p>StreamProvider<br><a href="https://pub.dev/documentation/riverpod/latest/riverpod/StreamProvider-class.html">https://pub.dev/documentation/riverpod/latest/riverpod/StreamProvider-class.html</a></p></li></ul><h3 id="Providerçš„ä¿®é¥°ç¬¦"><a href="#Providerçš„ä¿®é¥°ç¬¦" class="headerlink" title="Providerçš„ä¿®é¥°ç¬¦"></a>Providerçš„ä¿®é¥°ç¬¦</h3><h4 id="family"><a href="#family" class="headerlink" title=".family"></a>.family</h4><h5 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><p>è¯¥ä¿®é¥°ç¬¦é€‚ç”¨äºé€‚ç”¨å¤–éƒ¨æ•°æ®æ¥æ„å»ºproviderçš„æƒ…å†µ</p><p>ä¸€äº›å¸¸ç”¨æƒ…å†µ</p><ul><li>å’Œ<a href="https://pub.dev/documentation/riverpod/latest/riverpod/FutureProvider-class.html">FutureProvider</a> ç»„åˆï¼Œæ¥æ ¹æ®idè·å–æ¶ˆæ¯</li><li>æŠŠå½“å‰Localeå¯¹è±¡ä¼ ç»™providerï¼Œç”¨æ¥è¿›è¡Œå›½é™…åŒ–</li><li>åœ¨ä¸è®¿é—®å¯¹æ–¹å±æ€§çš„å‰æä¸‹è¿æ¥ä¸¤ä¸ªprovider</li></ul><p>åœ¨ä½¿ç”¨familyæ—¶ï¼Œä¼šé¢å¤–çš„å‘provideræä¾›ä¸€ä¸ªå±æ€§ï¼Œåœ¨providerä¸­æˆ‘ä»¬å¯ä»¥è‡ªç”±çš„ä½¿ç”¨è¯¥å±æ€§æ¥åˆ›å»ºæŸäº›çŠ¶æ€</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> messagesFamily = FutureProvider.family&lt;Message, <span class="hljs-built_in">String</span>&gt;((ref, id) <span class="hljs-keyword">async</span> &#123;<br>  <span class="hljs-keyword">return</span> dio.<span class="hljs-keyword">get</span>(<span class="hljs-string">&#x27;http://my_api.dev/messages/<span class="hljs-subst">$id</span>&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸‹åœ¨ä½¿ç”¨<code>messagesFamily</code>æ—¶ä¼šæœ‰ç‚¹è¯­æ³•ä¸Šçš„å˜åŒ–ï¼Œæˆ‘ä»¬éœ€è¦é¢å¤–æä¾›ä¸€ä¸ªå‚æ•°</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">Widget build(BuildContext context, WidgetRef ref) &#123;<br>  <span class="hljs-keyword">final</span> response = ref.watch(messagesFamily(<span class="hljs-string">&#x27;id&#x27;</span>));<br>&#125;<br></code></pre></td></tr></table></figure><p>å®ƒè¿˜æ”¯æŒåŒæ—¶è·å–ä¸åŒçš„å±æ€§</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@override</span><br>Widget build(BuildContext context, WidgetRef ref) &#123;<br>  <span class="hljs-keyword">final</span> frenchTitle = ref.watch(titleFamily(<span class="hljs-keyword">const</span> Locale(<span class="hljs-string">&#x27;fr&#x27;</span>)));<br>  <span class="hljs-keyword">final</span> englishTitle = ref.watch(titleFamily(<span class="hljs-keyword">const</span> Locale(<span class="hljs-string">&#x27;en&#x27;</span>)));<br><br>  <span class="hljs-keyword">return</span> Text(<span class="hljs-string">&#x27;fr: <span class="hljs-subst">$frenchTitle</span> en: <span class="hljs-subst">$englishTitle</span>&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="å‚æ•°é™åˆ¶"><a href="#å‚æ•°é™åˆ¶" class="headerlink" title="å‚æ•°é™åˆ¶"></a>å‚æ•°é™åˆ¶</h5><p>å‚æ•°ä¸é™åˆ¶ç±»å‹ï¼Œä½†å¿…é¡»å®ç°<code>==</code>å’Œ<code>hashCode</code>ä¸¤ä¸ªæ–¹æ³•ï¼›</p><p>å¦‚æœå‚æ•°ä¸æ˜¯constantçš„ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³å°†è¾“å…¥æ¡†å†…å®¹ä¼ ç»™Providerï¼Œä½†æ˜¯è¾“å…¥æ¡†çš„å†…å®¹ä¼šå˜åŒ–çš„ç‰¹åˆ«é¢‘ç¹å¹¶ä¸”ä¸èƒ½å¤ç”¨ï¼Œè¿™ç§æƒ…å†µå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„éœ²ï¼Œå¯ä»¥ä½¿ç”¨<code>.autoDispose</code>ä¿®é¥°ç¬¦æ¥ä¿®å¤è¿™ä¸ªé—®é¢˜</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> characters = FutureProvider.autoDispose.family&lt;<span class="hljs-built_in">List</span>&lt;Character&gt;, <span class="hljs-built_in">String</span>&gt;((ref, filter) <span class="hljs-keyword">async</span> &#123;<br>  <span class="hljs-keyword">return</span> fetchCharacters(filter: filter);<br>&#125;);<br></code></pre></td></tr></table></figure><h5 id="ä¼ é€’å¤šä¸ªå‚æ•°"><a href="#ä¼ é€’å¤šä¸ªå‚æ•°" class="headerlink" title="ä¼ é€’å¤šä¸ªå‚æ•°"></a>ä¼ é€’å¤šä¸ªå‚æ•°</h5><p>.familyä¿®é¥°ç¬¦å¹¶æ²¡æœ‰å†…ç½®æä¾›è¿‡ä¸ªå‚æ•°çš„æ–¹æ³•ï¼Œå¦å¤–ä¸€æ–¹é¢ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥æ˜¯ä»»æ„ç¬¦åˆä¸Šé¢æåˆ°çš„é™åˆ¶çš„ç±»å‹ã€‚<br>æ¯”å¦‚</p><ul><li>å…ƒç»„</li><li>ä½¿ç”¨ Freezed æˆ– built_value ç”Ÿæˆçš„å¯¹è±¡</li><li>ä½¿ç”¨ equatable çš„å¯¹è±¡</li></ul><p>** freezed **</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@freezed</span><br><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyParameter</span> <span class="hljs-title">with</span> <span class="hljs-title">_</span>$<span class="hljs-title">MyParameter</span> </span>&#123;<br>  <span class="hljs-keyword">factory</span> MyParameter(&#123;<br>    <span class="hljs-keyword">required</span> <span class="hljs-built_in">int</span> userId,<br>    <span class="hljs-keyword">required</span> Locale locale,<br>  &#125;) = _MyParameter;<br>&#125;<br><br><span class="hljs-keyword">final</span> exampleProvider = Provider.autoDispose.family&lt;Something, MyParameter&gt;((ref, myParameter) &#123;<br>  <span class="hljs-built_in">print</span>(myParameter.userId);<br>  <span class="hljs-built_in">print</span>(myParameter.locale);<br>  <span class="hljs-comment">// Do something with userId/locale</span><br>&#125;);<br><br><span class="hljs-meta">@override</span><br>Widget build(BuildContext context, WidgetRef ref) &#123;<br>  <span class="hljs-built_in">int</span> userId; <span class="hljs-comment">// Read the user ID from somewhere</span><br>  <span class="hljs-keyword">final</span> locale = Localizations.localeOf(context);<br><br>  <span class="hljs-keyword">final</span> something = ref.watch(<br>    exampleProvider(MyParameter(userId: userId, locale: locale)),<br>  );<br><br>  ...<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>Equatable</strong></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyParameter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Equatable</span>  </span>&#123;<br>  MyParameter(&#123;<br>    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.userId,<br>    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.locale,<br>  &#125;);<br><br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> userId;<br>  <span class="hljs-keyword">final</span> Locale locale;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">Object</span>&gt; <span class="hljs-keyword">get</span> props =&gt; [userId, locale];<br>&#125;<br><br><span class="hljs-keyword">final</span> exampleProvider = Provider.family&lt;Something, MyParameter&gt;((ref, myParameter) &#123;<br>  <span class="hljs-built_in">print</span>(myParameter.userId);<br>  <span class="hljs-built_in">print</span>(myParameter.locale);<br>  <span class="hljs-comment">// Do something with userId/locale</span><br>&#125;);<br><br><span class="hljs-meta">@override</span><br>Widget build(BuildContext context, WidgetRef ref) &#123;<br>  <span class="hljs-built_in">int</span> userId; <span class="hljs-comment">// Read the user ID from somewhere</span><br>  <span class="hljs-keyword">final</span> locale = Localizations.localeOf(context);<br><br>  <span class="hljs-keyword">final</span> something = ref.watch(<br>    exampleProvider(MyParameter(userId: userId, locale: locale)),<br>  );<br><br>  ...<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="autoDispose"><a href="#autoDispose" class="headerlink" title=".autoDispose"></a>.autoDispose</h4><p>ä¸€ä¸ªé€šç”¨åœºæ™¯æ˜¯èƒ½å¤Ÿè‡ªåŠ¨é‡Šæ”¾é•¿æ—¶é—´ä¸é€‚ç”¨Providerï¼›</p><p>æœ‰å¾ˆå¤šä¸ªè®©æˆ‘ä»¬è¿™ä¹ˆåšå¾—ç†ç”±ï¼Œæ¯”å¦‚ï¼š</p><ul><li>åœ¨ä½¿ç”¨Firebaseæ—¶ï¼Œå…³é—­è¿æ¥é¿å…ä¸å¿…è¦çš„å¼€é”€</li><li>å½“ç”¨æˆ·ç¦»å¼€é¡µé¢å†è¿›å…¥é¡µé¢æ—¶é‡ç½®çŠ¶æ€</li></ul><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å†…åµŒçš„<code>.autoDispose</code>ä¿®é¥°ç¬¦æ¥æ”¯æŒä¸Šè¿°åœºæ™¯</p><h5 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><p>æƒ³è¦å‘Šè¯‰Riverpodåœ¨ä¸å†ä½¿ç”¨provideræ—¶å°†å…¶é”€æ¯ï¼Œåªéœ€è¦åœ¨Providerä¹‹å‰åŠ ä¸Š<code>.autoDispose</code>å³å¯</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> userProvider = StreamProvider.autoDispose&lt;User&gt;((ref) &#123;<br><br>&#125;);<br></code></pre></td></tr></table></figure><p>å°±è¿™æ ·ï¼Œå½“<code>userProvider</code>ä¸å†ä½¿ç”¨æ—¶å°†ä¼šè¢«è‡ªåŠ¨é”€æ¯</p><p>æ³¨æ„é€šç”¨å‚æ•°æ˜¯å¦‚ä½•åœ¨autoDisposeä¹‹åè€Œä¸æ˜¯ä¹‹å‰ä¼ é€’çš„â€“autoDisposeä¸æ˜¯ä¸€ä¸ªå‘½åçš„æ„é€ å‡½æ•°ã€‚</p><p>å½“ç„¶ï¼Œä¸Šé¢ä¹Ÿæåˆ°å¯ä»¥å’Œå…¶ä»–ä¿®é¥°ç¬¦ä¸€èµ·</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> userProvider = StreamProvider.autoDispose.family&lt;User, <span class="hljs-built_in">String</span>&gt;((ref, id) &#123;<br><br>&#125;);<br></code></pre></td></tr></table></figure><h5 id="ref-maintainState"><a href="#ref-maintainState" class="headerlink" title="ref.maintainState"></a>ref.maintainState</h5><p>ç”¨<code>autoDispose</code>æ ‡è®°ä¸€ä¸ªæä¾›è€…ï¼Œä¹Ÿä¼šåœ¨refä¸Šå¢åŠ ä¸€ä¸ªé¢å¤–çš„å±æ€§ï¼š <code>maintainState</code>ã€‚</p><p>è¯¥å±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆé»˜è®¤ä¸ºfalseï¼‰ï¼Œå…è®¸æä¾›è€…å‘Šè¯‰Riverpodå³ä½¿ä¸å†è¢«ç›‘å¬ï¼Œæ˜¯å¦åº”è¯¥ä¿ç•™æä¾›è€…çš„çŠ¶æ€ã€‚</p><p>ä¸€ä¸ªç”¨ä¾‹æ˜¯åœ¨ä¸€ä¸ªHTTPè¯·æ±‚å®Œæˆåï¼Œå°†è¿™ä¸ªæ ‡å¿—è®¾ç½®ä¸ºtrue:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> myProvider = FutureProvider.autoDispose((ref) <span class="hljs-keyword">async</span> &#123;<br>  <span class="hljs-keyword">final</span> response = <span class="hljs-keyword">await</span> dio.<span class="hljs-keyword">get</span>(...);<br>  ref.maintainState = <span class="hljs-keyword">true</span>;<br>  <span class="hljs-keyword">return</span> response;<br>&#125;);<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œå¦‚æœè¯·æ±‚å¤±è´¥ï¼Œç”¨æˆ·ç¦»å¼€å±å¹•ååˆé‡æ–°è¿›å…¥ï¼Œé‚£ä¹ˆè¯·æ±‚å°†è¢«å†æ¬¡æ‰§è¡Œã€‚ä½†å¦‚æœè¯·æ±‚æˆåŠŸå®Œæˆï¼ŒçŠ¶æ€å°†è¢«ä¿ç•™ï¼Œé‡æ–°è¿›å…¥å±å¹•å°†ä¸ä¼šè§¦å‘æ–°çš„è¯·æ±‚ã€‚</p><h5 id="ç¤ºä¾‹ï¼šå–æ¶ˆhttpè¯·æ±‚"><a href="#ç¤ºä¾‹ï¼šå–æ¶ˆhttpè¯·æ±‚" class="headerlink" title="ç¤ºä¾‹ï¼šå–æ¶ˆhttpè¯·æ±‚"></a>ç¤ºä¾‹ï¼šå–æ¶ˆhttpè¯·æ±‚</h5><p>autoDisposeä¿®æ”¹å™¨å¯ä»¥ä¸FutureProviderå’Œref.onDisposeç›¸ç»“åˆï¼Œä»¥ä¾¿åœ¨ä¸å†éœ€è¦HTTPè¯·æ±‚æ—¶è½»æ¾å–æ¶ˆã€‚</p><p>è¦æ±‚ï¼š</p><ul><li>å½“ç”¨æˆ·è¿›å…¥ä¸€ä¸ªå±å¹•æ—¶ï¼Œå¯åŠ¨ä¸€ä¸ªHTTPè¯·æ±‚</li><li>å¦‚æœç”¨æˆ·åœ¨è¯·æ±‚å®Œæˆå‰ç¦»å¼€å±å¹•ï¼Œåˆ™å–æ¶ˆHTTPè¯·æ±‚</li><li>å¦‚æœè¯·æ±‚æˆåŠŸï¼Œç¦»å¼€å¹¶é‡æ–°è¿›å…¥å±å¹•ä¸ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„è¯·æ±‚</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> myProvider = FutureProvider.autoDispose((ref) <span class="hljs-keyword">async</span> &#123;<br>  <span class="hljs-comment">// An object from package:dio that allows cancelling http requests</span><br>  <span class="hljs-keyword">final</span> cancelToken = CancelToken();<br>  <span class="hljs-comment">// When the provider is destroyed, cancel the http request</span><br>  ref.onDispose(() =&gt; cancelToken.cancel());<br><br>  <span class="hljs-comment">// Fetch our data and pass our `cancelToken` for cancellation to work</span><br>  <span class="hljs-keyword">final</span> response = <span class="hljs-keyword">await</span> dio.<span class="hljs-keyword">get</span>(<span class="hljs-string">&#x27;path&#x27;</span>, cancelToken: cancelToken);<br>  <span class="hljs-comment">// If the request completed successfully, keep the state</span><br>  ref.maintainState = <span class="hljs-keyword">true</span>;<br>  <span class="hljs-keyword">return</span> response;<br>&#125;);<br></code></pre></td></tr></table></figure><h5 id="å‚æ•°ç±»å‹â€™AutoDisposeProviderâ€™ä¸èƒ½åˆ†é…ç»™å‚æ•°ç±»å‹â€™AlwaysAliveProviderBaseâ€™ã€‚"><a href="#å‚æ•°ç±»å‹â€™AutoDisposeProviderâ€™ä¸èƒ½åˆ†é…ç»™å‚æ•°ç±»å‹â€™AlwaysAliveProviderBaseâ€™ã€‚" class="headerlink" title="å‚æ•°ç±»å‹â€™AutoDisposeProviderâ€™ä¸èƒ½åˆ†é…ç»™å‚æ•°ç±»å‹â€™AlwaysAliveProviderBaseâ€™ã€‚"></a>å‚æ•°ç±»å‹â€™AutoDisposeProviderâ€™ä¸èƒ½åˆ†é…ç»™å‚æ•°ç±»å‹â€™AlwaysAliveProviderBaseâ€™ã€‚</h5><p>å½“ä½¿ç”¨.autoDisposeæ—¶ï¼Œä½ å¯èƒ½ä¼šå‘ç°è‡ªå·±çš„åº”ç”¨ç¨‹åºæ— æ³•ç¼–è¯‘ï¼Œå‡ºç°ç±»ä¼¼çš„é”™è¯¯ã€‚</p><blockquote><p>The argument type â€˜AutoDisposeProviderâ€™ canâ€™t be assigned to the parameter type â€˜AlwaysAliveProviderBaseâ€™</p></blockquote><p>å¯èƒ½æ˜¯å› ä¸ºä½ è¯•å›¾åœ¨ä¸€ä¸ªæ²¡æœ‰æ ‡è®°ä¸º.autoDisposeçš„æä¾›è€…ä¸­ç›‘å¬ä¸€ä¸ªæ ‡è®°ä¸º.autoDisposeçš„æä¾›è€…ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> firstProvider = Provider.autoDispose((ref) =&gt; <span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">final</span> secondProvider = Provider((ref) &#123;<br>  <span class="hljs-comment">// The argument type &#x27;AutoDisposeProvider&lt;int&gt;&#x27; can&#x27;t be assigned to the</span><br>  <span class="hljs-comment">// parameter type &#x27;AlwaysAliveProviderBase&lt;Object, Null&gt;&#x27;</span><br>  ref.watch(firstProvider);<br>&#125;);<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸å¯å–çš„ï¼Œå› ä¸ºå®ƒå°†å¯¼è‡´firstProvideræ°¸è¿œä¸ä¼šè¢«disposeã€‚æˆ‘ä»¬å¯ä»¥è€ƒè™‘å°† <code>secondProvider</code> æ ‡è®°ä¸º &#96;.autoDisposeæ¥ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> firstProvider = Provider.autoDispose((ref) =&gt; <span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">final</span> secondProvider = Provider.autoDispose((ref) &#123;<br>  ref.watch(firstProvider);<br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="WidgetRef"><a href="#WidgetRef" class="headerlink" title="WidgetRef"></a>WidgetRef</h2><h3 id="è·å–WidgetRefå¯¹è±¡"><a href="#è·å–WidgetRefå¯¹è±¡" class="headerlink" title="è·å–WidgetRefå¯¹è±¡"></a>è·å–WidgetRefå¯¹è±¡</h3><h4 id="ä»å…¶ä»–Providerå¯¹è±¡ä¸­è·å–"><a href="#ä»å…¶ä»–Providerå¯¹è±¡ä¸­è·å–" class="headerlink" title="ä»å…¶ä»–Providerå¯¹è±¡ä¸­è·å–"></a>ä»å…¶ä»–Providerå¯¹è±¡ä¸­è·å–</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> provider = Provider((ref) &#123;<br>  <span class="hljs-comment">// use ref to obtain other providers</span><br>  <span class="hljs-keyword">final</span> repository = ref.watch(repositoryProvider);<br>  <span class="hljs-keyword">return</span> SomeValue(repository);<br>&#125;)<br></code></pre></td></tr></table></figure><p><code>ref</code>å¯¹è±¡å¯ä»¥å¾ˆå®‰å…¨çš„åœ¨providerä¹‹é—´ä¼ é€’ï¼Œä¸€ä¸ªå¸¸è§çš„ç”¨æ³•å°±æ˜¯è®²<code>ref</code>ä¼ é€’ç»™ <a href="https://pub.dev/documentation/state_notifier/latest/state_notifier/StateNotifier-class.html">StateNotifier</a></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> counter = StateNotifierProvider&lt;Counter, <span class="hljs-built_in">int</span>&gt;((ref) &#123;<br>  <span class="hljs-keyword">return</span> Counter(ref);<br>&#125;);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Counter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StateNotifier</span>&lt;<span class="hljs-title">int</span>&gt; </span>&#123;<br>  Counter(<span class="hljs-keyword">this</span>.ref): <span class="hljs-keyword">super</span>(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">final</span> Ref ref;<br><br>  <span class="hljs-keyword">void</span> increment() &#123;<br>    <span class="hljs-comment">// Counter can use the &quot;ref&quot; to read other providers</span><br>    <span class="hljs-keyword">final</span> repository = ref.read(repositoryProvider);<br>    repository.post(<span class="hljs-string">&#x27;...&#x27;</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¹ˆåšå¯ä»¥è®©Counterå†…éƒ¨è¯»å–providerçŠ¶æ€</p><h4 id="ä»Widgetå¯¹è±¡ä¸­è·å–ref"><a href="#ä»Widgetå¯¹è±¡ä¸­è·å–ref" class="headerlink" title="ä»Widgetå¯¹è±¡ä¸­è·å–ref"></a>ä»Widgetå¯¹è±¡ä¸­è·å–ref</h4><p>ä¸€èˆ¬æƒ…å†µä¸‹Widgetå¯¹è±¡ä¸­æ˜¯æ²¡æœ‰refå¯¹è±¡ä¸­ï¼Œä½†riverpodæä¾›äº†å‡ ç§è§£å†³æ–¹æ¡ˆ</p><ul><li>ä½¿ç”¨ConsumerWidgetæ›¿æ¢StatelessWidget</li></ul><p>ConsumerWidgetå’ŒStatelessWidgetåŸºæœ¬ç›¸åŒ(è™½ç„¶æ˜¯ç»§æ‰¿äº†StatefulWidget)ï¼Œåªæ˜¯åœ¨buildæ–¹æ³•ä¸­å¤šäº†ä¸€ä¸ªWidgetRefå¯¹è±¡</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>  <span class="hljs-keyword">const</span> HomeView(&#123;Key? key&#125;): <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-comment">// use ref to listen to a provider</span><br>    <span class="hljs-keyword">final</span> counter = ref.watch(counterProvider);<br>    <span class="hljs-keyword">return</span> Text(<span class="hljs-string">&#x27;<span class="hljs-subst">$counter</span>&#x27;</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ConsumerStatefulWidget+ConsumerState æ›¿æ¢ StatefulWidget+State</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerStatefulWidget</span> </span>&#123;<br>  <span class="hljs-keyword">const</span> HomeView(&#123;Key? key&#125;): <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-meta">@override</span><br>  HomeViewState createState() =&gt; HomeViewState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeViewState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerState</span>&lt;<span class="hljs-title">HomeView</span>&gt; </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> initState() &#123;<br>    <span class="hljs-keyword">super</span>.initState();<br>    <span class="hljs-comment">// &quot;ref&quot; can be used in all life-cycles of a StatefulWidget.</span><br>    ref.read(counterProvider);<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-comment">// We can also use &quot;ref&quot; to listen to a provider inside the build method</span><br>    <span class="hljs-keyword">final</span> counter = ref.watch(counterProvider);<br>    <span class="hljs-keyword">return</span> Text(<span class="hljs-string">&#x27;<span class="hljs-subst">$counter</span>&#x27;</span>);<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ HookConsumerWidget æ›¿æ¢ HookWidget</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HookConsumerWidget</span> </span>&#123;<br>  <span class="hljs-keyword">const</span> HomeView(&#123;Key? key&#125;): <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-comment">// HookConsumerWidget allows using hooks inside the build method</span><br>    <span class="hljs-keyword">final</span> state = useState(<span class="hljs-number">0</span>);<br><br>    <span class="hljs-comment">// We can also use the ref parameter to listen to providers.</span><br>    <span class="hljs-keyword">final</span> counter = ref.watch(counterProvider);<br>    <span class="hljs-keyword">return</span> Text(<span class="hljs-string">&#x27;<span class="hljs-subst">$counter</span>&#x27;</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="WidgetRefå¯¹è±¡çš„æ–¹æ³•"><a href="#WidgetRefå¯¹è±¡çš„æ–¹æ³•" class="headerlink" title="WidgetRefå¯¹è±¡çš„æ–¹æ³•"></a>WidgetRefå¯¹è±¡çš„æ–¹æ³•</h3><p>è¿™é‡Œçš„<code>WidgetRef</code>å¯¹è±¡åœ¨è¯»å–Providerä¸­çš„æ•°æ®æ—¶ï¼Œæä¾›äº†<code>read</code>ã€<code>listen</code>å’Œ<code>watch</code>æ–¹æ³•ã€‚è‡³äºä»€ä¹ˆæƒ…å†µä¸‹é€‰ç”¨å“ªä¸ªæ–¹æ³•ï¼Œè¿™é‡Œæœ‰ä¸‰ä¸ªå»ºè®®</p><blockquote><ul><li>å½“æˆ‘ä»¬éœ€è¦ç›‘å¬å˜åŒ–å¹¶ä¸”ä»Providerä¸­è·å–æ•°æ®æ—¶ï¼Œæ¯”å¦‚å½“æ•°æ®å˜åŒ–æ—¶æˆ‘ä»¬éœ€è¦é‡æ–°æ„å»ºWidgetï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>ref.watch</code></li><li>å½“æˆ‘ä»¬éœ€è¦ç›‘å¬å˜åŒ–å»æ‰§è¡ŒæŸä¸ªåŠ¨ä½œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>ref.listen</code></li><li>å½“æˆ‘ä»¬ä»…éœ€è¦è¯»å–æ•°æ®ä¸å…³å¿ƒæ•°æ®çš„å˜åŒ–æ—¶ï¼Œæ¯”å¦‚ç‚¹å‡»æŸä¸ªæŒ‰é’®æ—¶ï¼Œæ ¹æ®çŠ¶æ€æ¥åˆ¤æ–­ä¸‹ä¸€æ­¥åŠ¨ä½œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>ref.read</code></li></ul></blockquote><ul><li>ref.watch<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> counterProvider = StateProvider((_)=&gt; <span class="hljs-number">0</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Home</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span></span>&#123;<br>  <span class="hljs-keyword">const</span> Home(&#123;Key? key&#125;) : <span class="hljs-keyword">super</span>(key: key);<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> count = ref.watch(counterProvider);<br>    <span class="hljs-keyword">return</span> MaterialApp(<br>      home: Scaffold(<br>        appBar: AppBar(title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&quot;riverpod demo&quot;</span>),),<br>        body: Center(<br>          child: Column(<br>            children: [<br>              Text(<span class="hljs-string">&#x27;<span class="hljs-subst">$count</span>&#x27;</span>)<br>            ],<br>          ),<br>        ),<br>        floatingActionButton: FloatingActionButton(onPressed: ()=&gt;&#123;<br>          ref.read(counterProvider.state).state++<br>        &#125;,child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&quot;ç‚¹å‡»&quot;</span>),),<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li>ref.read</li></ul><p>ä½¿ç”¨è¯¥æ–¹æ³•å¯ä»¥æ²¡æœ‰ä»»ä½•å½±å“çš„è·å–ä¸€æ¬¡providerçš„çŠ¶æ€ï¼Œä½†æ˜¯ä½œè€…æç¤ºæˆ‘ä»¬å°½é‡ä¸è¦ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œå®ƒåªæ˜¯ç”¨æ¥è§£å†³ä½¿ç”¨<code>watch|listen</code>ä¸æ–¹ä¾¿çš„é—®é¢˜ï¼Œå¦‚æœå¯ä»¥ï¼Œå°½é‡ä½¿ç”¨<code>watch|listen.</code>è¿™é‡Œæœ‰ä¸ªä½¿ç”¨readæ–¹æ³•çš„ç¤ºä¾‹<a href="https://riverpod.dev/docs/concepts/combining_providers#can-i-read-a-provider-without-listening-to-it">https://riverpod.dev/docs/concepts/combining_providers#can-i-read-a-provider-without-listening-to-it</a></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> counterProvider = StateNotifierProvider&lt;Counter, <span class="hljs-built_in">int</span>&gt;((ref) =&gt; Counter());<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>  <span class="hljs-keyword">const</span> HomeView(&#123;Key? key&#125;): <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      floatingActionButton: FloatingActionButton(<br>        onPressed: () &#123;<br>          <span class="hljs-comment">// Call `increment()` on the `Counter` class</span><br>          ref.read(counterProvider.notifier).increment();<br>        &#125;,<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ref.listen</li></ul><p>å’Œ<code>ref.watch</code>ç›¸ä¼¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨<code>ref.listen</code>æ¥è§‚å¯Ÿproviderã€‚ä»–ä»¬çš„åŒºåˆ«å°±æ˜¯å½“providerçŠ¶æ€å˜åŒ–æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨è‡ªå·±å®šä¹‰çš„æ–¹æ³•ã€‚è¯¥æ–¹æ³•éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦ç›‘å¬çš„providerå¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å›è°ƒæ–¹æ³•ï¼Œ</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> counterProvider = StateNotifierProvider&lt;Counter, <span class="hljs-built_in">int</span>&gt;((ref) =&gt; Counter());<br><br><span class="hljs-keyword">final</span> anotherProvider = Provider((ref) &#123;<br>  ref.listen&lt;<span class="hljs-built_in">int</span>&gt;(counterProvider, (<span class="hljs-built_in">int?</span> previousCount, <span class="hljs-built_in">int</span> newCount) &#123;<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;The counter changed <span class="hljs-subst">$&#123;newCount&#125;</span>&#x27;</span>);<br>  &#125;);<br>  ...<br>&#125;);<br></code></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> counterProvider = StateNotifierProvider&lt;Counter, <span class="hljs-built_in">int</span>&gt;((ref) =&gt; Counter());<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>&#123;<br>  <span class="hljs-keyword">const</span> HomeView(&#123;Key? key&#125;): <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context, WidgetRef ref) &#123;<br>    ref.listen&lt;<span class="hljs-built_in">int</span>&gt;(counterProvider, (<span class="hljs-built_in">int?</span> previousCount, <span class="hljs-built_in">int</span> newCount) &#123;<br>      <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;The counter changed <span class="hljs-subst">$&#123;newCount&#125;</span>&#x27;</span>);<br>    &#125;);<br>    ...<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å†³å®šè®¢é˜…ä»€ä¹ˆ"><a href="#å†³å®šè®¢é˜…ä»€ä¹ˆ" class="headerlink" title="å†³å®šè®¢é˜…ä»€ä¹ˆ"></a>å†³å®šè®¢é˜…ä»€ä¹ˆ</h3><p>æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªStreamProvider</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> userProvider = StreamProvider&lt;User&gt;(...);<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå»è®¢é˜…</p><ul><li>é€šè¿‡ç›‘å¬provideræœ¬èº«æ¥åŒæ­¥è·å–å½“å‰çŠ¶æ€</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dart">Widget build(BuildContext context, WidgetRef ref) &#123;<br>  AsyncValue&lt;User&gt; user = ref.watch(userProvider);<br><br>  <span class="hljs-keyword">return</span> user.when(<br>    loading: () =&gt; <span class="hljs-keyword">const</span> CircularProgressIndicator(),<br>    error: (error, stack) =&gt; <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&#x27;Oops&#x27;</span>),<br>    data: (user) =&gt; Text(user.name),<br>  );<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>é€šè¿‡ç›‘å¬<code>userProvider.stream</code>æ¥è·å–å¯¹åº”çš„stream</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">Widget build(BuildContext context, WidgetRef ref) &#123;<br>  Stream&lt;User&gt; user = ref.watch(userProvider.stream);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>é€šè¿‡ç›‘å¬<code>userProvider.future</code>æ¥è·å–ä¸€ä¸ªèƒ½å¾—åˆ°æœ€æ–°çŠ¶æ€çš„Future</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">Widget build(BuildContext context, WidgetRef ref) &#123;<br>  Future&lt;User&gt; user = ref.watch(userProvider.future);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨â€selectâ€-æ¥å†³å®šå“ªäº›å€¼å˜åŒ–æ—¶è¿›è¡Œé‡å»º"><a href="#ä½¿ç”¨â€selectâ€-æ¥å†³å®šå“ªäº›å€¼å˜åŒ–æ—¶è¿›è¡Œé‡å»º" class="headerlink" title="ä½¿ç”¨â€selectâ€ æ¥å†³å®šå“ªäº›å€¼å˜åŒ–æ—¶è¿›è¡Œé‡å»º"></a>ä½¿ç”¨â€selectâ€ æ¥å†³å®šå“ªäº›å€¼å˜åŒ–æ—¶è¿›è¡Œé‡å»º</h3><p>æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªUserå¯¹è±¡</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br>  <span class="hljs-built_in">String</span> <span class="hljs-keyword">get</span> name;<br>  <span class="hljs-built_in">int</span> <span class="hljs-keyword">get</span> age;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘ä»¬åœ¨æ¸²æŸ“é¡µé¢æ—¶åªç”¨åˆ°äº†nameå±æ€§</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart">Widget build(BuildContext context, WidgetRef ref) &#123;<br>  User user = ref.watch(userProvider);<br>  <span class="hljs-keyword">return</span> Text(user.name);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœ<code>age</code>å±æ€§å‘ç”Ÿäº†å˜åŒ–ï¼Œè¯¥Widgetå°±ä¼šé‡å»ºï¼Œæ˜¾ç„¶è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>select</code>æ¥é€‰æ‹©å¯¹è±¡çš„æŸäº›å±æ€§æ¥ç›‘å¬</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart">Widget build(BuildContext context, WidgetRef ref) &#123;<br>  <span class="hljs-built_in">String</span> name = ref.watch(userProvider.select((user) =&gt; user.name))<br>  <span class="hljs-keyword">return</span> Text(name);<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œ<code>select</code>åŒæ ·é€‚ç”¨äº<code>listen</code>æ–¹æ³•</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dart">ref.listen&lt;<span class="hljs-built_in">String</span>&gt;(<br>  userProvider.select((user) =&gt; user.name),<br>  (<span class="hljs-built_in">String?</span> previousName, <span class="hljs-built_in">String</span> newName) &#123;<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;The user name changed <span class="hljs-subst">$newName</span>&#x27;</span>);<br>  &#125;<br>);<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæ²¡å¿…è¦ä¸€å®šè¿”å›å¯¹è±¡çš„å±æ€§ï¼Œåªè¦å¤å†™äº†<code>==</code>çš„å€¼éƒ½å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œæ¯”å¦‚</p><pre><code class="dart">final label = ref.watch(userProvider.select((user) =&gt; &#39;Mr $&#123;user.name&#125;&#39;));</code></pre>]]></content>
    
    
    <summary type="html">&lt;p&gt;Flutteræ›´æ–°åˆ°2.8äº†ï¼Œæœ€è¿‘æ‰“ç®—é‡æ‹¾ä¸€ä¸‹flutterï¼Œå†™ç‚¹ä¸œè¥¿ç»ƒç»ƒæ‰‹ã€‚å¤§å®¶éƒ½æ¸…æ¥šåœ¨flutterä¸­çŠ¶æ€ç®¡ç†ç¡®å®æŒºéº»çƒ¦çš„ï¼Œä»ä¸€å¼€å§‹çš„BLoCåˆ°provideã€Providerï¼Œè¿˜æœ‰getXã€Riverpodç­‰ç­‰å„å¼å„æ ·çš„çŠ¶æ€ç®¡ç†åº“ï¼Œæˆ‘ä¸ªäººå€¾å‘äºä½¿ç”¨riverpodï¼Œå®ƒæ›´åƒä¸€ä¸ªçŠ¶æ€ç®¡ç†åº“ï¼›è€ŒgetXæ›´åƒä¸€ä¸ªå¼€å‘çš„æ¡†æ¶ï¼Œå®åœ¨æ˜¯å¤ªå¤§äº†:å½“ä½ ä½¿ç”¨getXçš„æ—¶å€™ï¼Œä½ æ˜¯åœ¨ç”¨getXè€Œä¸æ˜¯flutterå†™åº”ç”¨ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Flutter" scheme="https://blog.huangyuanlove.com/tags/Flutter/"/>
    
    <category term="riverpod" scheme="https://blog.huangyuanlove.com/tags/riverpod/"/>
    
  </entry>
  
</feed>
