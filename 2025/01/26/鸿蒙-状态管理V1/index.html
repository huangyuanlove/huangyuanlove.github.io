

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://avatars.githubusercontent.com/u/4216225?v=4">
  <link rel="icon" href="https://avatars.githubusercontent.com/u/4216225?v=4">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="HuangYuan_xuan">
  <meta name="keywords" content="HarmonyOS,鸿蒙应用开发,鸿蒙手机应用开发,状态管理,UI刷新,List不刷新,@State,@ObjectLink,@Observed">
  
    <meta name="description" content="前言随着鸿蒙Next的推广，做鸿蒙开发的人是越来越多，提问和寻求帮助的人也是越来越多，就我自己回答的问题而言，大部分和状态管理相关，比如List刷新问题，，还有一些录音录像拍照问题。也不是太难的问题，需要特别仔细的阅读官方文档，有些问题的解决方法还分散在好几个文档里面，文档上也没有对一些关键点做特别讲解。这里就最常见的问题总结一下，希望后来的朋友少走一些弯路。 状态管理V1组件的状态管理一共就这几">
<meta property="og:type" content="article">
<meta property="og:title" content="鸿蒙-状态管理V1">
<meta property="og:url" content="https://blog.huangyuanlove.com/2025/01/26/%E9%B8%BF%E8%92%99-%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86V1/index.html">
<meta property="og:site_name" content="放码过来">
<meta property="og:description" content="前言随着鸿蒙Next的推广，做鸿蒙开发的人是越来越多，提问和寻求帮助的人也是越来越多，就我自己回答的问题而言，大部分和状态管理相关，比如List刷新问题，，还有一些录音录像拍照问题。也不是太难的问题，需要特别仔细的阅读官方文档，有些问题的解决方法还分散在好几个文档里面，文档上也没有对一些关键点做特别讲解。这里就最常见的问题总结一下，希望后来的朋友少走一些弯路。 状态管理V1组件的状态管理一共就这几">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.huangyuanlove.com/image/HarmonyOS/ObjectLink%E4%BF%AE%E9%A5%B0%E6%B2%A1%E6%9C%89%E8%A2%ABObserved%E8%A3%85%E9%A5%B0%E7%9A%84%E7%B1%BB%E5%AF%B9%E8%B1%A1.png">
<meta property="og:image" content="https://blog.huangyuanlove.com/image/HarmonyOS/%E8%B7%A8%E5%B5%8C%E5%A5%97%E5%B1%82%E7%BA%A7%E8%A7%82%E5%AF%9F%E5%A4%B1%E8%B4%A5.gif">
<meta property="article:published_time" content="2025-01-26T07:31:53.000Z">
<meta property="article:modified_time" content="2025-02-12T08:38:07.756Z">
<meta property="article:author" content="HuangYuan_xuan">
<meta property="article:tag" content="HarmonyOS">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog.huangyuanlove.com/image/HarmonyOS/ObjectLink%E4%BF%AE%E9%A5%B0%E6%B2%A1%E6%9C%89%E8%A2%ABObserved%E8%A3%85%E9%A5%B0%E7%9A%84%E7%B1%BB%E5%AF%B9%E8%B1%A1.png">
  
  
  
  <title>鸿蒙-状态管理V1 - 放码过来</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"blog.huangyuanlove.com","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":100,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":3},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":"7a06626d17ff9ce19e18d0f08e94d8ba","google":"UA-123314537-1","tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"gtag":null},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="放码过来" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>放码过来</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="鸿蒙-状态管理V1"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-01-26 15:31" pubdate>
          2025年1月26日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          11k 字
        
      </span>
    

    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">鸿蒙-状态管理V1</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>随着鸿蒙Next的推广，做鸿蒙开发的人是越来越多，提问和寻求帮助的人也是越来越多，就我自己回答的问题而言，大部分和状态管理相关，比如List刷新问题，，还有一些录音录像拍照问题。也不是太难的问题，需要特别仔细的阅读官方文档，有些问题的解决方法还分散在好几个文档里面，文档上也没有对一些关键点做特别讲解。这里就最常见的问题总结一下，希望后来的朋友少走一些弯路。</p>
<h2 id="状态管理V1"><a href="#状态管理V1" class="headerlink" title="状态管理V1"></a>状态管理V1</h2><p>组件的状态管理一共就这几个：<br>@State装饰器：组件内状态<br>@Prop装饰器：父子单向同步<br>@Link装饰器：父子双向同步<br>@Observed装饰器和@ObjectLink装饰器：嵌套类对象属性变化<br>@Provide装饰器和@Consume装饰器：与后代组件双向同步<br>其中<br>@Provide和@Consume群里也几乎没有人问过，姑且认为是大家都比较清楚应该怎么使用或者用的较少</p>
<h3 id="State装饰器"><a href="#State装饰器" class="headerlink" title="@State装饰器"></a>@State装饰器</h3><h4 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h4><p><strong>必须</strong>本地初始化。如果从父组件初始化，并且从父组件传入的值非<code>undefined</code>，将会覆盖本地初始化；如果从父组件传入的值为<code>undefined</code>，则初值为<code>@State</code>装饰变量自身的初值。<br>也就是说无论父组件是否传值，被<code>@State</code>修饰的变量都必须要指定初始值，即使被<code>@Require</code>修饰也必须指定初始值。</p>
<h4 id="观察能力"><a href="#观察能力" class="headerlink" title="观察能力"></a>观察能力</h4><p>能观察到简单对象的变化；能观察到class 或者 Object 的赋值变化；能观察到其属性赋值的变化，但无法观察嵌套类属性赋值的变化;<br>看个例子，假设我们的数据类是这样的:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">OutClass</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">outClassName: <span class="hljs-built_in">string</span></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">outClassName</span> = outClassName<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">innerClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">InnerClass</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;outClassName&#125;</span>_innerClass`</span>)<br>  &#125;<br>  <span class="hljs-attr">outClassName</span>: <span class="hljs-built_in">string</span><br>  <span class="hljs-attr">innerClass</span>: <span class="hljs-title class_">InnerClass</span><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">InnerClass</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">innerClassName: <span class="hljs-built_in">string</span></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">innerClassName</span> = innerClassName<br>  &#125;<br>  <span class="hljs-attr">innerClassName</span>: <span class="hljs-built_in">string</span><br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>我们的业务逻辑姑且简化为这样</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><br><span class="hljs-meta">@Component</span><br>struct <span class="hljs-title class_">AboutStateAnno</span> &#123;<br>  <span class="hljs-meta">@State</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span><br>  <span class="hljs-meta">@State</span> <span class="hljs-attr">grade</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">&#x27;a&#x27;</span><br>  <span class="hljs-meta">@State</span> <span class="hljs-attr">success</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span><br>  <span class="hljs-meta">@State</span> <span class="hljs-attr">outClass</span>: <span class="hljs-title class_">OutClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OutClass</span>(<span class="hljs-string">&quot;out_class&quot;</span>)<br><br>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Column</span>() &#123;<br>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`count: <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.count&#125;</span>`</span>)<br>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`grade: <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.grade&#125;</span>`</span>)<br>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`success: <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.success&#125;</span>`</span>)<br>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`out_class_name: <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.outClass.outClassName&#125;</span>`</span>)<br>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`inner_class_name: <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.outClass.innerClass.innerClassName&#125;</span>`</span>)<br>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">&#x27;改变简单数据,UI刷新&#x27;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">_</span>)=&gt;</span>&#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> ++<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">grade</span> += <span class="hljs-variable language_">this</span>.<span class="hljs-property">grade</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">success</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">success</span><br>      &#125;)<br>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">&#x27;改变outClassName,UI刷新&#x27;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">_</span>)=&gt;</span>&#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">outClass</span>.<span class="hljs-property">outClassName</span> = <span class="hljs-string">&#x27;out_afterChange&#x27;</span><br>      &#125;)<br>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">&#x27;改变innerClassName,UI不刷新&#x27;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">_</span>)=&gt;</span>&#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">outClass</span>.<span class="hljs-property">innerClass</span>.<span class="hljs-property">innerClassName</span> = <span class="hljs-string">&#x27;inner_afterChange&#x27;</span><br>      &#125;)<br>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">&#x27;改变innerClass,UI刷新&#x27;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">_</span>)=&gt;</span>&#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">outClass</span>.<span class="hljs-property">innerClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">InnerClass</span>(<span class="hljs-string">&#x27;new inner_class&#x27;</span>)<br>      &#125;)<br><br>    &#125;.<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>).<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>)<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>可以看到，改变简单数据后，UI 直接刷新了。修改对象中的属性，UI 也刷新了，但是在改变嵌套类属性时(改变innerClassName,UI不刷新)，UI 没有刷新，也就是说改变<code>Object.keys(observedObject)</code>返回的所有属性时，UI都可以刷新。<br>同样的，对于数组类型来讲：数组的整体赋值，数组项的赋值，调用 pop 和 push 也能观察到。<br>对于<code>Map</code>来讲：可以观察到<code>Map</code>整体的赋值，同时可通过调用<code>Map</code>的接口<code>set</code>, <code>clear</code>, <code>delete</code> 更新Map的值。<br>对于<code>Set</code>来讲：可以观察到<code>Set</code>整体的赋值，同时可通过调用<code>Set</code>的接口<code>add</code>, <code>clear</code>, <code>delete</code> 更新Set的值。<br>这里就不再过多赘述。</p>
<h4 id="小坑"><a href="#小坑" class="headerlink" title="小坑"></a>小坑</h4><p>但这里有个比较麻烦的地方：当在build方法内，当@State装饰的变量是Object类型、且通过a.b(this.object)形式调用时，<strong>修改对象中的属性后，UI 无法刷新</strong><br>比如有一个 Person 类，有个 age 属性，我们定义一个方法用来修改 age 属性。我能想到的大概有这么 5 种方式</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span><br>&#125;<br><span class="hljs-comment">//方法 1：定义一个工具类，写个静态方法，传入 person 对象</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AddAge</span> &#123;<br>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">addAge</span>(<span class="hljs-params">person: Person</span>) &#123;<br>    person.<span class="hljs-property">age</span> += <span class="hljs-number">2</span><br>  &#125;<br>&#125;<br><span class="hljs-comment">//方法 2：定义一个工具类，写个普通方法，传入 person 对象</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AddAge1</span> &#123;<br>  <span class="hljs-title function_">addAge</span>(<span class="hljs-params">person: Person</span>) &#123;<br>    person.<span class="hljs-property">age</span> += <span class="hljs-number">2</span><br>  &#125;<br>&#125;<br><span class="hljs-comment">//方法 3：在组件中定义一个方法，传入 person 对象</span><br><span class="hljs-title function_">addAge1</span>(<span class="hljs-params">person: Person</span>) &#123;<br>  person.<span class="hljs-property">age</span> += <span class="hljs-number">2</span><br>&#125;<br><span class="hljs-comment">//方法 4：在组件中定义一个方法，直接修改 person 对象</span><br><span class="hljs-title function_">addAge</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">person</span>.<span class="hljs-property">age</span> += <span class="hljs-number">2</span><br>&#125;<br><span class="hljs-comment">//方法 5：在需要的地方直接修改 person 对象的 age 属性，比如在onClick事件中</span><br><span class="hljs-title class_">Text</span>(<span class="hljs-string">`person.add:<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.person.age&#125;</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">_</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">person</span>.<span class="hljs-property">age</span> += <span class="hljs-number">2</span>;<br>&#125;)<br></code></pre></td></tr></table></figure>
<p>我们来试一下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-meta">@State</span> <span class="hljs-attr">person1</span>: <span class="hljs-title class_">Person</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>()<br><span class="hljs-meta">@State</span> <span class="hljs-attr">person2</span>: <span class="hljs-title class_">Person</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>()<br><span class="hljs-meta">@State</span> <span class="hljs-attr">person3</span>: <span class="hljs-title class_">Person</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>()<br><span class="hljs-meta">@State</span> <span class="hljs-attr">person4</span>: <span class="hljs-title class_">Person</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>()<br><span class="hljs-meta">@State</span> <span class="hljs-attr">person5</span>: <span class="hljs-title class_">Person</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>()<br><span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title class_">Column</span>() &#123;<br>  <span class="hljs-title class_">Text</span>(<span class="hljs-string">`person1.add: <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.person1.age&#125;</span>`</span>)<br>    .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">_</span>) =&gt;</span> &#123;<br>      <span class="hljs-title class_">AddAge</span>.<span class="hljs-title function_">addAge</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">person1</span>)<br>    &#125;).<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)<br>  <span class="hljs-title class_">Text</span>(<span class="hljs-string">`person2.add:<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.person2.age&#125;</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">_</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">AddAge1</span>().<span class="hljs-title function_">addAge</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">person2</span>)<br>  &#125;).<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)<br>  <span class="hljs-title class_">Text</span>(<span class="hljs-string">`person3.add:<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.person3.age&#125;</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">_</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addAge1</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">person3</span>)<br>  &#125;).<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)<br>  <span class="hljs-title class_">Text</span>(<span class="hljs-string">`person4.add:<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.person4.age&#125;</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">_</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addAge</span>()<br>  &#125;).<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)<br>  <span class="hljs-title class_">Text</span>(<span class="hljs-string">`person5.add:<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.person5.age&#125;</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">_</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">person5</span>.<span class="hljs-property">age</span> += <span class="hljs-number">2</span>;<br>  &#125;).<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)<br>&#125;.<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)<br>&#125;<br></code></pre></td></tr></table></figure>
<p>会发现只有方法 4 和方法 5 才能使得UI 刷新，这是因为方法内传过去的是原生对象，修改其属性后不能触发刷新。如果我们有一些理由非得这么做，可以先赋值给一个临时变量，再将这个临时变量传入方法中，就可以刷新 UI 了。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title class_">Column</span>() &#123;<br>    <span class="hljs-title class_">Column</span>() &#123;<br>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`person1.add: <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.person1.age&#125;</span>`</span>)<br>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">_</span>) =&gt;</span> &#123;<br>          <span class="hljs-keyword">let</span> tmp = <span class="hljs-variable language_">this</span>.<span class="hljs-property">person1</span><br>          <span class="hljs-title class_">AddAge</span>.<span class="hljs-title function_">addAge</span>(tmp)<br>        &#125;).<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)<br>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`person2.add:<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.person2.age&#125;</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">_</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">let</span> tmp = <span class="hljs-variable language_">this</span>.<span class="hljs-property">person2</span><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">AddAge1</span>().<span class="hljs-title function_">addAge</span>(tmp)<br>      &#125;).<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)<br>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`person3.add:<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.person3.age&#125;</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">_</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">let</span> tmp = <span class="hljs-variable language_">this</span>.<span class="hljs-property">person3</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addAge1</span>(tmp)<br>      &#125;).<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)<br>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`person4.add:<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.person4.age&#125;</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">_</span>) =&gt;</span> &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addAge</span>()<br>      &#125;).<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)<br>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`person5.add:<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.person5.age&#125;</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">_</span>) =&gt;</span> &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">person5</span>.<span class="hljs-property">age</span> += <span class="hljs-number">2</span>;<br>      &#125;).<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)<br>    &#125;.<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)<br>  &#125;.<span class="hljs-title function_">height</span>(<span class="hljs-string">&#x27;100%&#x27;</span>)<br>  .<span class="hljs-title function_">width</span>(<span class="hljs-string">&#x27;100%&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure>
<p>没想到吧，哈哈哈哈哈</p>
<h3 id="Prop装饰器-和-Link装饰器"><a href="#Prop装饰器-和-Link装饰器" class="headerlink" title="@Prop装饰器 和 @Link装饰器"></a>@Prop装饰器 和 @Link装饰器</h3><p>这两个装饰器的观察能力和坑点和@State 相同，只不过是用来自定义的子组件中。<br>其中@Prop装饰器是父组件向子组件同步数据：子组件改变数据不会同步到父组件，但父组件修改数据会同步到子组件。也就是说父组件的修改会覆盖掉子组件对变量的修改，并且被它装饰的变量会进行深拷贝，在拷贝的过程中除了基本类型、Map、Set、Date、Array外，都会丢失类型。因此建议深度嵌套的数据不要太多，文档上建议不要超过 5 层。<br>@Link装饰器是父子组件双向同步的，但禁止本地进行初始化。</p>
<h3 id="Observed装饰器和-ObjectLink装饰器"><a href="#Observed装饰器和-ObjectLink装饰器" class="headerlink" title="@Observed装饰器和@ObjectLink装饰器"></a>@Observed装饰器和@ObjectLink装饰器</h3><p>在实际开发中，我们使用的数据模型一般都会有多层嵌套的情况，但之前介绍过的装饰器只能观察到第一层变化，无法观察到第二层变化，这种情况我们就需要使用<code>@Observed</code>和<code>@ObjectLink</code>装饰器.</p>
<h4 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h4><p><code>@Observed</code>装饰class。需要放在class的定义前，使用<code>new</code>创建类对象。<br><code>@ObjectLink</code>变量装饰器只能装饰被<code>@Observed</code>装饰的class实例，<strong>必须</strong>指定类型，并且不支持简单类型。</p>
<p>另外这两个装饰器是配套使用的，单一的使用某个装饰器无法实现观察，并且<code>@ObjectLink</code>只能装饰被<code>@Observed</code>装饰的类对象变量，否则会报错</p>
<blockquote>
<p>The ‘@ObjectLink’ decorated attribute ‘education’ must be an ‘@Observed’ decorated class or a union of ‘@Observed’ decorated class and undefined or null, or both. <ArkTSCheck></p>
</blockquote>
<p><img src="/image/HarmonyOS/ObjectLink%E4%BF%AE%E9%A5%B0%E6%B2%A1%E6%9C%89%E8%A2%ABObserved%E8%A3%85%E9%A5%B0%E7%9A%84%E7%B1%BB%E5%AF%B9%E8%B1%A1.png" srcset="/img/loading.gif" lazyload alt="ObjectLink修饰没有被Observed装饰的类对象">  </p>
<p>我们先定义一个数据类，来模拟一下业务逻辑：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><br><span class="hljs-meta">@Observed</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span><br>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span><br>  <span class="hljs-attr">address</span>: <span class="hljs-title class_">Address</span><br>  <span class="hljs-attr">education</span>: <span class="hljs-title class_">Education</span><br><br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, name: <span class="hljs-built_in">string</span>, address: Address, education: Education</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">address</span> = address;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">education</span> = education;<br>  &#125;<br>&#125;<br><br><span class="hljs-meta">@Observed</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span> &#123;<br>  <span class="hljs-attr">zipCode</span>: <span class="hljs-built_in">number</span><br>  <span class="hljs-attr">location</span>: <span class="hljs-built_in">string</span><br><br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">zipCode: <span class="hljs-built_in">number</span>, location: <span class="hljs-built_in">string</span></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">zipCode</span> = zipCode;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">location</span> = location;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Education</span> &#123;<br>  <span class="hljs-attr">school</span>: <span class="hljs-built_in">string</span><br>  <span class="hljs-attr">degree</span>: <span class="hljs-built_in">string</span><br><br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">school: <span class="hljs-built_in">string</span>, degree: <span class="hljs-built_in">string</span></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">school</span> = school;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">degree</span> = degree;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>这里还有一点需要注意的，到目前为止<code>@ObjectLink</code>必须在自定义组件中使用。我们这里定义两个组件，用来展示<code>Address</code>和<code>Education</code>.  </p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-meta">@Component</span><br>struct <span class="hljs-title class_">UserAddress</span> &#123;<br>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">address</span>: <span class="hljs-title class_">Address</span><br><br>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Column</span>() &#123;<br>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`location:<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.address.location&#125;</span>`</span>)<br>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`zipCode:<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.address.zipCode&#125;</span>`</span>)<br>    &#125;.<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">padding</span>(<span class="hljs-number">5</span>)<br>  &#125;<br>&#125;<br><br><span class="hljs-meta">@Component</span><br>struct <span class="hljs-title class_">UserEducation</span> &#123;<br>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">education</span>: <span class="hljs-title class_">Education</span><br><br>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Column</span>() &#123;<br>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`school:<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.education.school&#125;</span>`</span>)<br>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`degree:<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.education.degree&#125;</span>`</span>)<br>    &#125;.<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">padding</span>(<span class="hljs-number">5</span>)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>简单的写个页面，看下效果。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-meta">@State</span> <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span><br><span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> &#123;<br>  <span class="hljs-comment">//这里必须使用 new 关键字创建对象，使用字面量创建出来的对象无法被观察</span><br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">address</span>: <span class="hljs-title class_">Address</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-number">10000</span>, <span class="hljs-string">&quot;北京&quot;</span>)<br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">education</span>: <span class="hljs-title class_">Education</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Education</span>(<span class="hljs-string">&#x27;university&#x27;</span>, <span class="hljs-string">&#x27;Master&#x27;</span>)<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;new User&#x27;</span>, address, education) <br>&#125;<br><span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title class_">Column</span>() &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>) &#123;<br>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`id:<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.user.id&#125;</span> , name:<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.user.name&#125;</span>`</span>)<br>        <span class="hljs-title class_">UserAddress</span>(&#123; <span class="hljs-attr">address</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">address</span> &#125;)<br>        <span class="hljs-title class_">UserEducation</span>(&#123; <span class="hljs-attr">education</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">education</span> &#125;)<br>        <span class="hljs-title class_">Flex</span>(&#123; <span class="hljs-attr">wrap</span>: <span class="hljs-title class_">FlexWrap</span>.<span class="hljs-property">Wrap</span>, <span class="hljs-attr">space</span>: &#123; <span class="hljs-attr">cross</span>: <span class="hljs-title class_">LengthMetrics</span>.<span class="hljs-title function_">vp</span>(<span class="hljs-number">5</span>), <span class="hljs-attr">main</span>: <span class="hljs-title class_">LengthMetrics</span>.<span class="hljs-title function_">vp</span>(<span class="hljs-number">5</span>) &#125; &#125;) &#123;<br>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">&#x27;修改 name&#x27;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">_</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>) &#123;<br>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">name</span> += <span class="hljs-string">&#x27;a&#x27;</span><br>            &#125;<br>          &#125;)<br>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">&#x27;修改address.location&#x27;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">_</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>) &#123;<br>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">address</span>.<span class="hljs-property">location</span> += <span class="hljs-string">&#x27;b&#x27;</span><br>            &#125;<br>          &#125;)<br>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">&#x27;修改education.degree&#x27;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">_</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>) &#123;<br>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">education</span>.<span class="hljs-property">degree</span> += <span class="hljs-string">&#x27;c&#x27;</span><br>            &#125;<br>          &#125;)<br>        &#125;<br>      &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>可以看到，点击<code>修改 name</code>和<code>修改address.location</code>都可以引起 UI 刷新，但点击<code>修改education.degree</code>UI不会刷新。</p>
<p>另外还有一点需要注意的：被@Observed 修饰的嵌套类，不能跨嵌套层观察。举个例子：我们有一个嵌套的三层的数据类，我们是无法在第二层的自定义控件中观察到第三层数据的变化。示例如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-comment">//嵌套了三层的数据类：也就是A类中有类型为B的属性，B类中又有类型为C的属性 </span><br><span class="hljs-meta">@Observed</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">FirstLevel</span> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span><br>  <span class="hljs-attr">secondLevel</span>: <span class="hljs-title class_">SecondLevel</span><br><br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, secondLevel: SecondLevel</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">secondLevel</span> = secondLevel;<br>  &#125;<br>&#125;<br><br><span class="hljs-meta">@Observed</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SecondLevel</span> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span><br>  <span class="hljs-attr">thirdLevel</span>: <span class="hljs-title class_">ThirdLevel</span><br><br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, thirdLevel: ThirdLevel</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">thirdLevel</span> = thirdLevel;<br>  &#125;<br>&#125;<br><span class="hljs-meta">@Observed</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ThirdLevel</span> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span><br><br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>然后我们定义两个用来展示<code>SecondLevel</code>和<code>ThirdLevel</code>的控件</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-meta">@Component</span><br>struct <span class="hljs-title class_">SecondLevelView</span>&#123;<br>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">secondLevel</span>:<span class="hljs-title class_">SecondLevel</span><br>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Column</span>()&#123;<br>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`second level:<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.secondLevel.name&#125;</span>`</span>)<br>      <span class="hljs-comment">//这里直接跨层级观察是无效的，修改thirdLevel.name时 UI 不会刷新</span><br>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`third level name:<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.secondLevel.thirdLevel.name&#125;</span>`</span>)<br>      <span class="hljs-title class_">ThirdLevelView</span>(&#123;<span class="hljs-attr">thirdLevel</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">secondLevel</span>.<span class="hljs-property">thirdLevel</span>&#125;).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">&#x27;#846f9b&#x27;</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)<br>    &#125;.<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)<br>  &#125;<br>&#125;<br><span class="hljs-meta">@Component</span><br>struct <span class="hljs-title class_">ThirdLevelView</span>&#123;<br>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">thirdLevel</span>:<span class="hljs-title class_">ThirdLevel</span><br>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`third level: <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.thirdLevel.name&#125;</span>`</span>)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>接着写个页面试一下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs TypeScript"><span class="hljs-meta">@State</span> <span class="hljs-attr">firstLevel</span>:<span class="hljs-title class_">FirstLevel</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span><br><span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> &#123;<br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">thirdLevel</span>:<span class="hljs-title class_">ThirdLevel</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThirdLevel</span>(<span class="hljs-string">&#x27;third level&#x27;</span>)<br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">secondLevel</span>:<span class="hljs-title class_">SecondLevel</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecondLevel</span>(<span class="hljs-string">&#x27;second level&#x27;</span>,thirdLevel)<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">firstLevel</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FirstLevel</span>(<span class="hljs-string">&#x27;first level&#x27;</span>,secondLevel)<br>&#125;<br><span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title class_">Column</span>() &#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">firstLevel</span>)&#123;<br>      <span class="hljs-title class_">Column</span>()&#123;<br>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`first level:<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.firstLevel.name&#125;</span>`</span>)<br>        <span class="hljs-title class_">SecondLevelView</span>(&#123;<span class="hljs-attr">secondLevel</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">firstLevel</span>.<span class="hljs-property">secondLevel</span>&#125;).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">&#x27;#aa42f5&#x27;</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)<br><br>        <span class="hljs-title class_">Flex</span>(&#123; <span class="hljs-attr">wrap</span>: <span class="hljs-title class_">FlexWrap</span>.<span class="hljs-property">Wrap</span>, <span class="hljs-attr">space</span>: &#123; <span class="hljs-attr">cross</span>: <span class="hljs-title class_">LengthMetrics</span>.<span class="hljs-title function_">vp</span>(<span class="hljs-number">5</span>), <span class="hljs-attr">main</span>: <span class="hljs-title class_">LengthMetrics</span>.<span class="hljs-title function_">vp</span>(<span class="hljs-number">5</span>) &#125; &#125;) &#123;<br>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">&#x27;修改 firstLevel.name&#x27;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">_</span>)=&gt;</span>&#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">firstLevel</span>)&#123;<br>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">firstLevel</span>.<span class="hljs-property">name</span>  += <span class="hljs-string">&#x27;a&#x27;</span><br>            &#125;<br>          &#125;)<br>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">&#x27;修改 secondLevel.name&#x27;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">_</span>)=&gt;</span>&#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">firstLevel</span>)&#123;<br>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">firstLevel</span>.<span class="hljs-property">secondLevel</span>.<span class="hljs-property">name</span>  += <span class="hljs-string">&#x27;a&#x27;</span><br>            &#125;<br>          &#125;)<br>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">&#x27;修改 thirdLevel.name&#x27;</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">_</span>)=&gt;</span>&#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">firstLevel</span>)&#123;<br>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">firstLevel</span>.<span class="hljs-property">secondLevel</span>.<span class="hljs-property">thirdLevel</span>.<span class="hljs-property">name</span>  += <span class="hljs-string">&#x27;a&#x27;</span><br>            &#125;<br>          &#125;)<br>        &#125;.<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)<br>      &#125;.<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">&quot;#657e57&quot;</span>)<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/image/HarmonyOS/%E8%B7%A8%E5%B5%8C%E5%A5%97%E5%B1%82%E7%BA%A7%E8%A7%82%E5%AF%9F%E5%A4%B1%E8%B4%A5.gif" srcset="/img/loading.gif" lazyload alt="跨嵌套层级观察失效"><br>可以看到，在对应的层级观察对应的嵌套类是生效的，但当我们点击<code>修改 thirdLevel.name</code>时，只有在<code>ThirdLevelView</code>中的控件刷新了，在<code>SecondLevelView</code>中观察<code>thirdLevel.name</code>的 Text内容并没有刷新。这是因为在<code>SecondLevelView</code>中，<code>@ObjectLink</code>仅能观察到其代理的<code>secondLevel:SecondLevel</code>对象的属性变化，而<code>secondLevel.thirdLevel.name</code>是<code>ThirdLevel</code>的属性，无法观察到嵌套类的变化。</p>
<h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><ul>
<li>不建议在被@Observed 修饰的类的构造函数中修改值，不会引起UI刷新，因为修改的是原始对象的值，并非是代理对象。</li>
<li>被<code>@Observed</code>修饰的嵌套类，不要跨嵌套层观察，建议一个数据类对应一个自定义控件。</li>
<li>必须使用new 创建的类对象，使用字面量对象无法被观察。比如网络请求返回的数据转成 JSON 后使用 as 强转为对应类型</li>
<li>通过a.b(this.object)形式调用时，修改对象中的属性后，UI 无法刷新，原因同@State</li>
<li>@ObjectLink的数据源更新依赖其父组件，当父组件中数据源改变引起父组件刷新时，会重新设置子组件@ObjectLink的数据源。这个过程不是在父组件数据源变化后立刻发生的，而是在父组件实际刷新时才会进行。</li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/HarmonyOS/" class="print-no-link">#HarmonyOS</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>鸿蒙-状态管理V1</div>
      <div>https://blog.huangyuanlove.com/2025/01/26/鸿蒙-状态管理V1/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>HuangYuan_xuan</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年1月26日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              BY HUANG兄
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/02/08/%E9%B8%BF%E8%92%99-%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86V2/" title="鸿蒙-状态管理V2">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">鸿蒙-状态管理V2</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/01/17/%E9%B8%BF%E8%92%99-hvigor%E5%AE%9A%E5%88%B6%E6%9E%84%E5%BB%BA/" title="鸿蒙-hvigor定制构建">
                        <span class="hidden-mobile">鸿蒙-hvigor定制构建</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="gitalk-container"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#gitalk-container', function() {
      Fluid.utils.createCssLink('/css/gitalk.css')
      Fluid.utils.createScript('https://lib.baomitu.com/gitalk/1.7.2/gitalk.min.js', function() {
        var options = Object.assign(
          {"clientID":"76c9d0ecf028751aa0d2","clientSecret":"392bc0405dfbdf4928343edef0ef46007f02c7e4","repo":"huangyuanlove.github.io","owner":"huangyuanlove","admin":["huangyuanlove"],"language":"zh-CN","labels":["Gitalk"],"perPage":10,"pagerDirection":"last","distractionFreeMode":false,"createIssueManually":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token"},
          {
            id: 'ae24b527011dda9ecaf4f99a91a0c4a0'
          }
        )
        var gitalk = new Gitalk(options);
        gitalk.render('gitalk-container');
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
